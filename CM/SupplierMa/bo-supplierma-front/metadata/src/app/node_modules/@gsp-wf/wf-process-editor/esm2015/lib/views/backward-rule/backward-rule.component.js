/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, HostBinding, Output, EventEmitter, Input, ViewChild, TemplateRef } from '@angular/core';
import { ProcessDesignerUIState } from '../../app/process-designer.uistate';
import { MessagerService } from '@farris/ui-messager';
import { of } from 'rxjs';
import { LookupGridComponent } from '@farris/ui-lookup';
export class BackwardRuleComponent {
    /**
     * @param {?} uiState
     * @param {?} message
     */
    constructor(uiState, message) {
        this.uiState = uiState;
        this.message = message;
        this.cls = 'farris-main-area flex-column';
        this.editorParams = {};
        this.nodeType = 'UserActivity';
        this.closeModal = new EventEmitter();
        this.submitModal = new EventEmitter();
        this.modalConfig = {
            title: '驳回规则',
            width: 430,
            height: 370,
            showButtons: true
        };
        this.listItems = [
            { Id: 'InitialActityId', Name: '开始节点' },
            { Id: 'PrecursorActivityId', Name: '前置节点' },
            { Id: 'Empty', Name: '空' }
        ];
        this.items = [];
        this.columns = [
            { title: '名称', field: 'Name', width: 100, searchField: 'Name' },
            { title: '标识', field: 'Id', width: 100, searchField: 'Id' },
        ];
        this.selectAbleChecked = false;
        this.waitReturnChecked = false;
        this.dynamicBackWardRuleAbleChecked = false;
        this.targetRef = this.listItems[0].Id;
        this.pageInfo = {
            pageIndex: 1,
            pageList: [10, 20, 30, 50],
            pageSize: 20
        };
        this.dictPicked = (/**
         * @param {?} arg
         * @return {?}
         */
        (arg) => {
            this.targetRef = arg.Id;
            this.displayText = arg.Name;
            return of({ closeDialog: true });
        });
        this.listItems = this.listItems.concat(this.uiState.userActList);
        this.items = this.listItems;
        this.total = this.listItems.length;
    }
    /**
     * @param {?} data
     * @return {?}
     */
    set value(data) {
        if (data) {
            this.selectAbleChecked = data.SelectTargetAble;
            this.waitReturnChecked = data.WaitReturn;
            this.dynamicBackWardRuleAbleChecked = data.DynamicBackWardRuleAble;
            if (!data.TargetRef) {
                this.targetRef = 'Empty';
            }
            else {
                this.targetRef = data.TargetRef;
            }
            /** @type {?} */
            const act = this.listItems.find((/**
             * @param {?} item
             * @return {?}
             */
            item => item.Id === this.targetRef));
            if (act) {
                this.displayText = act.Name;
            }
            else {
                this.displayText = '';
                setTimeout((/**
                 * @return {?}
                 */
                () => {
                    this.message.warning('驳回活动节点已不存在，请重新编辑');
                }), 500);
            }
        }
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.nodeType = this.editorParams.nodeType;
        if (this.nodeType !== 'UserActivity') {
            this.listItems = this.listItems.filter((/**
             * @param {?} i
             * @return {?}
             */
            i => i.Id !== 'Empty'));
            this.items = this.listItems;
            this.total = this.listItems.length;
        }
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
    }
    /**
     * @return {?}
     */
    selectAbleClick() {
        if (this.uiState.propertyData.ClrTypeID === 'wf.UserActivity'
            && this.uiState.propertyData.CompleteStrategy !== this.uiState.completeIterator[0].key
            && this.selectAbleChecked === true) {
            this.message.info('会签策略下，不允许“动态选择驳回级次”!', (/**
             * @return {?}
             */
            () => {
                this.selectAbleChecked = false;
            }));
        }
    }
    /**
     * @return {?}
     */
    waitReturnClick() {
        this.waitReturnChecked = !this.waitReturnChecked;
    }
    /**
     * @return {?}
     */
    dynamicBackWardRuleAbleClick() {
        this.dynamicBackWardRuleAbleChecked = !this.dynamicBackWardRuleAbleChecked;
    }
    /**
     * @return {?}
     */
    clickOK() {
        /** @type {?} */
        const backWardRule = {
            TargetRef: this.getTargetRef(),
            SelectTargetAble: this.selectAbleChecked,
            WaitReturn: this.waitReturnChecked,
            DynamicBackWardRuleAble: this.dynamicBackWardRuleAbleChecked,
        };
        /** @type {?} */
        const object = { value: backWardRule, parameters: null };
        this.submitModal.emit(object);
    }
    /**
     * @return {?}
     */
    clickCancel() {
        this.closeModal.emit();
    }
    /**
     * @param {?} arg
     * @return {?}
     */
    pagerChanged(arg) {
        this.pageInfo.pageIndex = arg.pageIndex;
        this.pageInfo.pageSize = arg.pageSize;
        /** @type {?} */
        const search = {
            field: arg.searchValue.searchField,
            value: arg.searchValue.searchValue
        };
        this.load(search);
    }
    /**
     * @param {?} arg
     * @return {?}
     */
    pageSizeChange(arg) {
        console.log(arg);
        this.pageInfo.pageIndex = arg.pageIndex;
        this.pageInfo.pageSize = arg.pageSize;
        /** @type {?} */
        const search = {
            field: arg.searchValue.searchField,
            value: arg.searchValue.searchValue
        };
        this.load(search);
    }
    /**
     * @param {?} arg
     * @return {?}
     */
    search(arg) {
        this.pageInfo.pageIndex = arg.pageInfo.pageIndex;
        this.pageInfo.pageSize = arg.pageInfo.pageSize;
        /** @type {?} */
        const search = arg.search;
        this.load(search);
    }
    /**
     * @param {?=} search
     * @return {?}
     */
    load(search) {
        /** @type {?} */
        const start = (this.pageInfo.pageIndex - 1) * this.pageInfo.pageSize;
        /** @type {?} */
        const end = start + this.pageInfo.pageSize;
        /** @type {?} */
        let items = [];
        if (search) {
            if (search.field === '*') {
                items = this.listItems.filter((/**
                 * @param {?} i
                 * @return {?}
                 */
                i => i.Name.indexOf(search.value) > -1 || i.Id.indexOf(search.value) > -1));
            }
            else {
                items = this.listItems.filter((/**
                 * @param {?} f
                 * @return {?}
                 */
                f => f[search.field].indexOf(search.value) > -1));
            }
        }
        else {
            items = this.listItems;
        }
        this.total = items.length;
        this.items = items; // .slice(start, end);
        this.hlp.componentRef.instance.loadData({
            // total: this.total,
            // pageSize: this.pageInfo.pageSize,
            // pageIndex: this.pageInfo.pageIndex,
            data: this.items
        });
    }
    /**
     * @private
     * @return {?}
     */
    getTargetRef() {
        if (this.targetRef === 'Empty') {
            return '';
        }
        else {
            return this.targetRef;
        }
    }
}
BackwardRuleComponent.decorators = [
    { type: Component, args: [{
                selector: 'procDesigner-backward-rule',
                template: "<div class=\"f-page\">\r\n  <div class=\"f-utils-fill-flex-column farris-split-section m-2 h-100\">\r\n    <section class=\"f-utils-fill-flex-column h-100\">\r\n      <div class=\"f-section-header pt-2 mx-2\">\r\n        <div class=\"f-title\">\r\n          <h4 class=\"f-title-text\">\u9A73\u56DE\u89C4\u5219\u8BBE\u7F6E</h4>\r\n        </div>\r\n      </div>\r\n      <div class=\"f-utils-fill-flex-column h-100\">\r\n        <div class=\"farris-form form-inline farris-form-inline\">\r\n          <div class=\"col-12 farris-group-auto my-4 pr-5\">\r\n            <div class=\"farris-group-wrap\">\r\n              <div class=\"form-group farris-form-group\">\r\n                <label class=\"col-form-label\">\r\n                  <span class=\"farris-label-info text-danger\">*</span>\r\n                  <span class=\"farris-label-text\">\u9A73\u56DE\u81F3</span>\r\n                </label>\r\n                <div class=\"farris-input-wrap\">\r\n                  <farris-lookup-grid #hlp [items]=\"items\" [columns]=\"columns\" [resizable]=\"true\"\r\n                    [singleSelect]=\"true\" [idField]=\"'Id'\" [textField]=\"'Name'\" [(ngModel)]=\"displayText\"\r\n                    [valueField]=\"'Id'\" [pagination]=\"false\" [pageIndex]=\"pageInfo.pageIndex\"\r\n                    [pageSize]=\"pageInfo.pageSize\" [pageList]=\"pageInfo.pageList\" [total]=\"total\"\r\n                    [title]=\"'\u6D3B\u52A8\u5217\u8868'\" [displayType]=\"'List'\" [dictPicked]=\"dictPicked\" [remoteSearch]='false'\r\n                    (pagerChanged)=\"pagerChanged($event)\" (search)=\"search($event)\" [enableClear]=\"false\"\r\n                    (pageSizeChange)=\"pageSizeChange($event)\">\r\n                  </farris-lookup-grid>\r\n                  <div class=\"farris-feedback valid-feedback\"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div *ngIf=\"nodeType==='UserActivity'\" class=\"col-12 farris-group-auto my-4\">\r\n            <div class=\"farris-group-wrap pl-5\">\r\n              <div class=\"form-group farris-form-group\">\r\n                <div class=\"farris-input-wrap\">\r\n                  <div class=\"custom-control custom-checkbox\">\r\n                    <input class=\"custom-control-input\" name=\"selectAble\" type=\"checkbox\" id=\"selectAble\"\r\n                      [(ngModel)]=\"selectAbleChecked\" (change)=\"selectAbleClick()\" />\r\n                    <label class=\"custom-control-label\" for=\"selectAble\">\u52A8\u6001\u9009\u62E9\u9A73\u56DE\u7EA7\u6B21</label>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class=\"col-12 farris-group-auto my-4\">\r\n            <div class=\"farris-group-wrap pl-5\">\r\n              <div class=\"form-group farris-form-group\">\r\n                <div class=\"farris-input-wrap\">\r\n                  <div class=\"custom-control custom-checkbox\">\r\n                    <input class=\"custom-control-input\" name=\"waitReturn\" type=\"checkbox\" id=\"waitReturn\" [checked]=\"waitReturnChecked\"\r\n                      (change)=\"waitReturnClick()\" />\r\n                    <label class=\"custom-control-label\" for=\"waitReturn\">\u9A73\u56DE\u540E\u91CD\u65B0\u63D0\u4EA4\u81F3\u672C\u8282\u70B9</label>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class=\"col-12 farris-group-auto my-4\">\r\n            <div class=\"farris-group-wrap pl-5\">\r\n              <div class=\"form-group farris-form-group\">\r\n                <div class=\"farris-input-wrap\">\r\n                  <div class=\"custom-control custom-checkbox\">\r\n                    <input class=\"custom-control-input\" name=\"dynamicBackWardRuleAble\" type=\"checkbox\" id=\"dynamicBackWardRuleAble\" [checked]=\"dynamicBackWardRuleAbleChecked\"\r\n                      (change)=\"dynamicBackWardRuleAbleClick()\" />\r\n                    <label class=\"custom-control-label\" for=\"dynamicBackWardRuleAble\">\u52A8\u6001\u9009\u62E9\u9A73\u56DE\u89C4\u5219</label>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <!-- <form class=\"h-100\">\r\n          <div class=\"f-utils-fill-flex-column justify-content-center h-100 pb-4\">\r\n            <div class=\"my-2 mx-5\">\r\n              <div class=\"farris-group-wrap\">\r\n                <div class=\"form-group\">\r\n                  <label class=\"col-form-label\">\r\n                    <span class=\"farris-label-text\">\u9A73\u56DE\u81F3</span>\r\n                  </label>\r\n                  <div class=\"farris-input-wrap mt-1\" style=\"width: 300px;\">\r\n                    <farris-combo-list [(ngModel)]=\"targetRef\" name=\"targetRef\" [ngModelOptions]=\"{standalone: true}\"\r\n                      [idField]=\"'value'\" [textField]=\"'text'\" [valueField]=\"'value'\" [data]=\"listItems\"\r\n                      [panelHeight]=\"100\">\r\n                    </farris-combo-list>\r\n                    <div class=\"farris-feedback valid-feedback\"></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div class=\"my-2 mx-5\">\r\n              <div class=\"farris-input-wrap\">\r\n                <div class=\"custom-control custom-checkbox\">\r\n                  <input class=\"custom-control-input\" name=\"selectAble\" type=\"checkbox\" id=\"selectAble\" [(ngModel)]=\"selectAbleChecked\"\r\n                    (change)=\"selectAbleClick()\" />\r\n                  <label class=\"custom-control-label\" for=\"selectAble\">\u52A8\u6001\u9009\u62E9\u9A73\u56DE\u7EA7\u6B21</label>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div class=\"my-2 mx-5\">\r\n              <div class=\"farris-input-wrap\">\r\n                <div class=\"custom-control custom-checkbox\">\r\n                  <input class=\"custom-control-input\" name=\"waitReturn\" type=\"checkbox\" id=\"waitReturn\" [checked]=\"waitReturnChecked\"\r\n                    (change)=\"waitReturnClick()\" />\r\n                  <label class=\"custom-control-label\" for=\"waitReturn\">\u9A73\u56DE\u540E\u91CD\u65B0\u63D0\u4EA4\u81F3\u672C\u8282\u70B9</label>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </form> -->\r\n      </div>\r\n    </section>\r\n  </div>\r\n</div>\r\n<ng-template #iconSelectFooter>\r\n  <button type=\"button\" class=\"btn btn-primary btn-sm mx-2\" (click)=\"clickOK()\">\u786E\u5B9A</button>\r\n  <button type=\"button\" class=\"btn btn-secondary btn-sm mx-2\" (click)=\"clickCancel()\">\u53D6\u6D88</button>\r\n</ng-template>\r\n",
                styles: [".item-header{padding:1rem}.item{padding:.5rem 5rem}"]
            }] }
];
/** @nocollapse */
BackwardRuleComponent.ctorParameters = () => [
    { type: ProcessDesignerUIState },
    { type: MessagerService }
];
BackwardRuleComponent.propDecorators = {
    cls: [{ type: HostBinding, args: ['class',] }],
    editorParams: [{ type: Input }],
    value: [{ type: Input }],
    nodeType: [{ type: Input }],
    closeModal: [{ type: Output }],
    submitModal: [{ type: Output }],
    modalFooter: [{ type: ViewChild, args: ['iconSelectFooter',] }],
    hlp: [{ type: ViewChild, args: ['hlp',] }]
};
if (false) {
    /** @type {?} */
    BackwardRuleComponent.prototype.cls;
    /** @type {?} */
    BackwardRuleComponent.prototype.editorParams;
    /** @type {?} */
    BackwardRuleComponent.prototype.nodeType;
    /** @type {?} */
    BackwardRuleComponent.prototype.closeModal;
    /** @type {?} */
    BackwardRuleComponent.prototype.submitModal;
    /** @type {?} */
    BackwardRuleComponent.prototype.modalFooter;
    /** @type {?} */
    BackwardRuleComponent.prototype.hlp;
    /** @type {?} */
    BackwardRuleComponent.prototype.modalConfig;
    /** @type {?} */
    BackwardRuleComponent.prototype.displayText;
    /** @type {?} */
    BackwardRuleComponent.prototype.listItems;
    /** @type {?} */
    BackwardRuleComponent.prototype.items;
    /** @type {?} */
    BackwardRuleComponent.prototype.columns;
    /** @type {?} */
    BackwardRuleComponent.prototype.selectAbleChecked;
    /** @type {?} */
    BackwardRuleComponent.prototype.waitReturnChecked;
    /** @type {?} */
    BackwardRuleComponent.prototype.dynamicBackWardRuleAbleChecked;
    /** @type {?} */
    BackwardRuleComponent.prototype.targetRef;
    /** @type {?} */
    BackwardRuleComponent.prototype.pageInfo;
    /** @type {?} */
    BackwardRuleComponent.prototype.total;
    /** @type {?} */
    BackwardRuleComponent.prototype.dictPicked;
    /**
     * @type {?}
     * @private
     */
    BackwardRuleComponent.prototype.uiState;
    /**
     * @type {?}
     * @private
     */
    BackwardRuleComponent.prototype.message;
}
export class BackwardRuleConverter {
    constructor() { }
    /**
     * @param {?} data
     * @return {?}
     */
    convertTo(data) {
        if (data) {
            return '（已设置）';
        }
        return '（未设置）';
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFja3dhcmQtcnVsZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLXdmL3dmLXByb2Nlc3MtZWRpdG9yLyIsInNvdXJjZXMiOlsibGliL3ZpZXdzL2JhY2t3YXJkLXJ1bGUvYmFja3dhcmQtcnVsZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsV0FBVyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxXQUFXLEVBQWlCLE1BQU0sZUFBZSxDQUFDO0FBRW5JLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLG9DQUFvQyxDQUFDO0FBQzVFLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN0RCxPQUFPLEVBQWMsRUFBRSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ3RDLE9BQU8sRUFBZ0IsbUJBQW1CLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQVF0RSxNQUFNLE9BQU8scUJBQXFCOzs7OztJQWlFaEMsWUFDVSxPQUErQixFQUMvQixPQUF3QjtRQUR4QixZQUFPLEdBQVAsT0FBTyxDQUF3QjtRQUMvQixZQUFPLEdBQVAsT0FBTyxDQUFpQjtRQWpFbEMsUUFBRyxHQUFHLDhCQUE4QixDQUFDO1FBQzVCLGlCQUFZLEdBQVEsRUFBRSxDQUFDO1FBdUJ2QixhQUFRLEdBQThDLGNBQWMsQ0FBQztRQUVwRSxlQUFVLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUNyQyxnQkFBVyxHQUFHLElBQUksWUFBWSxFQUFPLENBQUM7UUFJaEQsZ0JBQVcsR0FBRztZQUNaLEtBQUssRUFBRSxNQUFNO1lBQ2IsS0FBSyxFQUFFLEdBQUc7WUFDVixNQUFNLEVBQUUsR0FBRztZQUNYLFdBQVcsRUFBRSxJQUFJO1NBQ2xCLENBQUM7UUFFRixjQUFTLEdBQUc7WUFDVixFQUFFLEVBQUUsRUFBRSxpQkFBaUIsRUFBRSxJQUFJLEVBQUUsTUFB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Q0FBQzs7Ozs7SUFFakIsU0FBUyxDQUFDLElBQVM7UUFDakIsSUFBSSxJQUFJLEVBQUU7WUFDUixPQUFPLE9BQU8sQ0FBQztTQUNoQjtRQUNELE9BQU8sT0FBTyxDQUFDO0lBQ2pCLENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBIb3N0QmluZGluZywgT3V0cHV0LCBFdmVudEVtaXR0ZXIsIElucHV0LCBWaWV3Q2hpbGQsIFRlbXBsYXRlUmVmLCBBZnRlclZpZXdJbml0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFR5cGVDb252ZXJ0ZXIgfSBmcm9tICdAZmFycmlzL3VpLXByb3BlcnR5LXBhbmVsJztcclxuaW1wb3J0IHsgUHJvY2Vzc0Rlc2lnbmVyVUlTdGF0ZSB9IGZyb20gJy4uLy4uL2FwcC9wcm9jZXNzLWRlc2lnbmVyLnVpc3RhdGUnO1xyXG5pbXBvcnQgeyBNZXNzYWdlclNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW1lc3NhZ2VyJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgb2YgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgUGlja2VkUmVzdWx0LCBMb29rdXBHcmlkQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1sb29rdXAnO1xyXG5pbXBvcnQgeyBUSFJPV19JRl9OT1RfRk9VTkQgfSBmcm9tICdAYW5ndWxhci9jb3JlL3NyYy9kaS9pbmplY3Rvcic7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ3Byb2NEZXNpZ25lci1iYWNrd2FyZC1ydWxlJyxcclxuICB0ZW1wbGF0ZVVybDogJy4vYmFja3dhcmQtcnVsZS5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vYmFja3dhcmQtcnVsZS5jb21wb25lbnQuc2NzcyddXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBCYWNrd2FyZFJ1bGVDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIEFmdGVyVmlld0luaXQge1xyXG4gIEBIb3N0QmluZGluZygnY2xhc3MnKVxyXG4gIGNscyA9ICdmYXJyaXMtbWFpbi1hcmVhIGZsZXgtY29sdW1uJztcclxuICBASW5wdXQoKSBlZGl0b3JQYXJhbXM6IGFueSA9IHt9O1xyXG4gIEBJbnB1dCgpXHJcbiAgc2V0IHZhbHVlKGRhdGE6IGFueSkge1xyXG4gICAgaWYgKGRhdGEpIHtcclxuICAgICAgdGhpcy5zZWxlY3RBYmxlQ2hlY2tlZCA9IGRhdGEuU2VsZWN0VGFyZ2V0QWJsZTtcclxuICAgICAgdGhpcy53YWl0UmV0dXJuQ2hlY2tlZCA9IGRhdGEuV2FpdFJldHVybjtcclxuICAgICAgdGhpcy5keW5hbWljQmFja1dhcmRSdWxlQWJsZUNoZWNrZWQgPSBkYXRhLkR5bmFtaWNCYWNrV2FyZFJ1bGVBYmxlO1xyXG4gICAgICBpZiAoIWRhdGEuVGFyZ2V0UmVmKSB7XHJcbiAgICAgICAgdGhpcy50YXJnZXRSZWYgPSAnRW1wdHknO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMudGFyZ2V0UmVmID0gZGF0YS5UYXJnZXRSZWY7XHJcbiAgICAgIH1cclxuICAgICAgY29uc3QgYWN0ID0gdGhpcy5saXN0SXRlbXMuZmluZChpdGVtID0+IGl0ZW0uSWQgPT09IHRoaXMudGFyZ2V0UmVmKTtcclxuICAgICAgaWYgKGFjdCkge1xyXG4gICAgICAgIHRoaXMuZGlzcGxheVRleHQgPSBhY3QuTmFtZTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLmRpc3BsYXlUZXh0ID0gJyc7XHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICB0aGlzLm1lc3NhZ2Uud2FybmluZygn6amz5Zue5rS75Yqo6IqC54K55bey5LiN5a2Y5Zyo77yM6K+36YeN5paw57yW6L6RJyk7XHJcbiAgICAgICAgfSwgNTAwKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuICBASW5wdXQoKSBub2RlVHlwZTogJ1VzZXJBY3Rpdml0eScgfCAnQ2FsbEFjdGl2aXR5U3ViUHJvY2VzcycgPSAnVXNlckFjdGl2aXR5JztcclxuXHJcbiAgQE91dHB1dCgpIGNsb3NlTW9kYWwgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuICBAT3V0cHV0KCkgc3VibWl0TW9kYWwgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuXHJcbiAgQFZpZXdDaGlsZCgnaWNvblNlbGVjdEZvb3RlcicpIG1vZGFsRm9vdGVyOiBUZW1wbGF0ZVJlZjxhbnk+O1xyXG4gIEBWaWV3Q2hpbGQoJ2hscCcpIGhscDogTG9va3VwR3JpZENvbXBvbmVudDtcclxuICBtb2RhbENvbmZpZyA9IHtcclxuICAgIHRpdGxlOiAn6amz5Zue6KeE5YiZJyxcclxuICAgIHdpZHRoOiA0MzAsXHJcbiAgICBoZWlnaHQ6IDM3MCxcclxuICAgIHNob3dCdXR0b25zOiB0cnVlXHJcbiAgfTtcclxuICBkaXNwbGF5VGV4dDogc3RyaW5nO1xyXG4gIGxpc3RJdGVtcyA9IFtcclxuICAgIHsgSWQ6ICdJbml0aWFsQWN0aXR5SWQnLCBOYW1lOiAn5byA5aeL6IqC54K5JyB9LFxyXG4gICAgeyBJZDogJ1ByZWN1cnNvckFjdGl2aXR5SWQnLCBOYW1lOiAn5YmN572u6IqC54K5JyB9LFxyXG4gICAgeyBJZDogJ0VtcHR5JywgTmFtZTogJ+epuicgfVxyXG4gIF07XHJcblxyXG4gIGl0ZW1zID0gW107XHJcblxyXG4gIGNvbHVtbnMgPSBbXHJcbiAgICB7IHRpdGxlOiAn5ZCN56ewJywgZmllbGQ6ICdOYW1lJywgd2lkdGg6IDEwMCwgc2VhcmNoRmllbGQ6ICdOYW1lJyB9LFxyXG4gICAgeyB0aXRsZTogJ+agh+ivhicsIGZpZWxkOiAnSWQnLCB3aWR0aDogMTAwLCBzZWFyY2hGaWVsZDogJ0lkJyB9LFxyXG4gIF07XHJcbiAgc2VsZWN0QWJsZUNoZWNrZWQgPSBmYWxzZTtcclxuICB3YWl0UmV0dXJuQ2hlY2tlZCA9IGZhbHNlO1xyXG4gIGR5bmFtaWNCYWNrV2FyZFJ1bGVBYmxlQ2hlY2tlZCA9IGZhbHNlO1xyXG4gIHRhcmdldFJlZiA9IHRoaXMubGlzdEl0ZW1zWzBdLklkO1xyXG5cclxuICBwYWdlSW5mbyA9IHtcclxuICAgIHBhZ2VJbmRleDogMSxcclxuICAgIHBhZ2VMaXN0OiBbMTAsIDIwLCAzMCwgNTBdLFxyXG4gICAgcGFnZVNpemU6IDIwXHJcbiAgfTtcclxuXHJcbiAgdG90YWw6IG51bWJlcjtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIHVpU3RhdGU6IFByb2Nlc3NEZXNpZ25lclVJU3RhdGUsXHJcbiAgICBwcml2YXRlIG1lc3NhZ2U6IE1lc3NhZ2VyU2VydmljZVxyXG4gICkge1xyXG4gICAgdGhpcy5saXN0SXRlbXMgPSB0aGlzLmxpc3RJdGVtcy5jb25jYXQodGhpcy51aVN0YXRlLnVzZXJBY3RMaXN0KTtcclxuICAgIHRoaXMuaXRlbXMgPSB0aGlzLmxpc3RJdGVtcztcclxuICAgIHRoaXMudG90YWwgPSB0aGlzLmxpc3RJdGVtcy5sZW5ndGg7XHJcbiAgICB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gICAgdGhpcy5ub2RlVHlwZSA9IHRoaXMuZWRpdG9yUGFyYW1zLm5vZGVUeXBlO1xyXG4gICAgaWYgKHRoaXMubm9kZVR5cGUgIT09ICdVc2VyQWN0aXZpdHknKSB7XHJcbiAgICAgIHRoaXMubGlzdEl0ZW1zID0gdGhpcy5saXN0SXRlbXMuZmlsdGVyKGkgPT4gaS5JZCAhPT0gJ0VtcHR5Jyk7XHJcbiAgICAgIHRoaXMuaXRlbXMgPSB0aGlzLmxpc3RJdGVtcztcclxuICAgICAgdGhpcy50b3RhbCA9IHRoaXMubGlzdEl0ZW1zLmxlbmd0aDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcclxuICB9XHJcblxyXG4gIHNlbGVjdEFibGVDbGljaygpIHtcclxuICAgIGlmICh0aGlzLnVpU3RhdGUucHJvcGVydHlEYXRhLkNsclR5cGVJRCA9PT0gJ3dmLlVzZXJBY3Rpdml0eSdcclxuICAgICAgJiYgdGhpcy51aVN0YXRlLnByb3BlcnR5RGF0YS5Db21wbGV0ZVN0cmF0ZWd5ICE9PSB0aGlzLnVpU3RhdGUuY29tcGxldGVJdGVyYXRvclswXS5rZXlcclxuICAgICAgJiYgdGhpcy5zZWxlY3RBYmxlQ2hlY2tlZCA9PT0gdHJ1ZSkge1xyXG4gICAgICB0aGlzLm1lc3NhZ2UuaW5mbygn5Lya562+562W55Wl5LiL77yM5LiN5YWB6K644oCc5Yqo5oCB6YCJ5oup6amz5Zue57qn5qyh4oCdIScsICgpID0+IHtcclxuICAgICAgICB0aGlzLnNlbGVjdEFibGVDaGVja2VkID0gZmFsc2U7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuICB3YWl0UmV0dXJuQ2xpY2soKSB7XHJcbiAgICB0aGlzLndhaXRSZXR1cm5DaGVja2VkID0gIXRoaXMud2FpdFJldHVybkNoZWNrZWQ7XHJcbiAgfVxyXG4gIGR5bmFtaWNCYWNrV2FyZFJ1bGVBYmxlQ2xpY2soKSB7XHJcbiAgICB0aGlzLmR5bmFtaWNCYWNrV2FyZFJ1bGVBYmxlQ2hlY2tlZCA9ICF0aGlzLmR5bmFtaWNCYWNrV2FyZFJ1bGVBYmxlQ2hlY2tlZDtcclxuICB9XHJcbiAgZGljdFBpY2tlZCA9IChhcmc6IGFueSk6IE9ic2VydmFibGU8UGlja2VkUmVzdWx0PiA9PiB7XHJcbiAgICB0aGlzLnRhcmdldFJlZiA9IGFyZy5JZDtcclxuICAgIHRoaXMuZGlzcGxheVRleHQgPSBhcmcuTmFtZTtcclxuICAgIHJldHVybiBvZih7IGNsb3NlRGlhbG9nOiB0cnVlIH0pO1xyXG4gIH1cclxuICBjbGlja09LKCkge1xyXG4gICAgY29uc3QgYmFja1dhcmRSdWxlID0ge1xyXG4gICAgICBUYXJnZXRSZWY6IHRoaXMuZ2V0VGFyZ2V0UmVmKCksXHJcbiAgICAgIFNlbGVjdFRhcmdldEFibGU6IHRoaXMuc2VsZWN0QWJsZUNoZWNrZWQsXHJcbiAgICAgIFdhaXRSZXR1cm46IHRoaXMud2FpdFJldHVybkNoZWNrZWQsXHJcbiAgICAgIER5bmFtaWNCYWNrV2FyZFJ1bGVBYmxlOiB0aGlzLmR5bmFtaWNCYWNrV2FyZFJ1bGVBYmxlQ2hlY2tlZCxcclxuICAgIH07XHJcbiAgICBjb25zdCBvYmplY3QgPSB7IHZhbHVlOiBiYWNrV2FyZFJ1bGUsIHBhcmFtZXRlcnM6IG51bGwgfTtcclxuICAgIHRoaXMuc3VibWl0TW9kYWwuZW1pdChvYmplY3QpO1xyXG4gIH1cclxuXHJcbiAgY2xpY2tDYW5jZWwoKSB7XHJcbiAgICB0aGlzLmNsb3NlTW9kYWwuZW1pdCgpO1xyXG4gIH1cclxuXHJcbiAgcGFnZXJDaGFuZ2VkKGFyZzogYW55KSB7XHJcbiAgICB0aGlzLnBhZ2VJbmZvLnBhZ2VJbmRleCA9IGFyZy5wYWdlSW5kZXg7XHJcbiAgICB0aGlzLnBhZ2VJbmZvLnBhZ2VTaXplID0gYXJnLnBhZ2VTaXplO1xyXG4gICAgY29uc3Qgc2VhcmNoID0ge1xyXG4gICAgICBmaWVsZDogYXJnLnNlYXJjaFZhbHVlLnNlYXJjaEZpZWxkLFxyXG4gICAgICB2YWx1ZTogYXJnLnNlYXJjaFZhbHVlLnNlYXJjaFZhbHVlXHJcbiAgICB9O1xyXG4gICAgdGhpcy5sb2FkKHNlYXJjaCk7XHJcbiAgfVxyXG5cclxuICBwYWdlU2l6ZUNoYW5nZShhcmc6IGFueSkge1xyXG4gICAgY29uc29sZS5sb2coYXJnKTtcclxuICAgIHRoaXMucGFnZUluZm8ucGFnZUluZGV4ID0gYXJnLnBhZ2VJbmRleDtcclxuICAgIHRoaXMucGFnZUluZm8ucGFnZVNpemUgPSBhcmcucGFnZVNpemU7XHJcbiAgICBjb25zdCBzZWFyY2ggPSB7XHJcbiAgICAgIGZpZWxkOiBhcmcuc2VhcmNoVmFsdWUuc2VhcmNoRmllbGQsXHJcbiAgICAgIHZhbHVlOiBhcmcuc2VhcmNoVmFsdWUuc2VhcmNoVmFsdWVcclxuICAgIH07XHJcbiAgICB0aGlzLmxvYWQoc2VhcmNoKTtcclxuICB9XHJcbiAgc2VhcmNoKGFyZzogYW55KSB7XHJcbiAgICB0aGlzLnBhZ2VJbmZvLnBhZ2VJbmRleCA9IGFyZy5wYWdlSW5mby5wYWdlSW5kZXg7XHJcbiAgICB0aGlzLnBhZ2VJbmZvLnBhZ2VTaXplID0gYXJnLnBhZ2VJbmZvLnBhZ2VTaXplO1xyXG4gICAgY29uc3Qgc2VhcmNoID0gYXJnLnNlYXJjaDtcclxuXHJcbiAgICB0aGlzLmxvYWQoc2VhcmNoKTtcclxuICB9XHJcblxyXG4gIGxvYWQoc2VhcmNoPzogeyBmaWVsZDogc3RyaW5nLCB2YWx1ZTogc3RyaW5nfSkge1xyXG4gICAgY29uc3Qgc3RhcnQgPSAodGhpcy5wYWdlSW5mby5wYWdlSW5kZXggLSAxKSAqIHRoaXMucGFnZUluZm8ucGFnZVNpemU7XHJcbiAgICBjb25zdCBlbmQgPSBzdGFydCArIHRoaXMucGFnZUluZm8ucGFnZVNpemU7XHJcbiAgICBsZXQgaXRlbXMgPSBbXTtcclxuICAgIGlmIChzZWFyY2gpIHtcclxuICAgICAgaWYgKHNlYXJjaC5maWVsZCA9PT0gJyonKSB7XHJcbiAgICAgICAgaXRlbXMgPSB0aGlzLmxpc3RJdGVtcy5maWx0ZXIoaSA9PiBpLk5hbWUuaW5kZXhPZihzZWFyY2gudmFsdWUpID4gLTEgfHwgaS5JZC5pbmRleE9mKHNlYXJjaC52YWx1ZSkgPiAtMSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgaXRlbXMgPSB0aGlzLmxpc3RJdGVtcy5maWx0ZXIoZiA9PiBmW3NlYXJjaC5maWVsZF0uaW5kZXhPZihzZWFyY2gudmFsdWUpID4gLTEpO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBpdGVtcyA9IHRoaXMubGlzdEl0ZW1zO1xyXG4gICAgfVxyXG4gICAgdGhpcy50b3RhbCA9IGl0ZW1zLmxlbmd0aDtcclxuICAgIHRoaXMuaXRlbXMgPSBpdGVtczsgLy8gLnNsaWNlKHN0YXJ0LCBlbmQpO1xyXG4gICAgdGhpcy5obHAuY29tcG9uZW50UmVmLmluc3RhbmNlLmxvYWREYXRhKHtcclxuICAgICAgLy8gdG90YWw6IHRoaXMudG90YWwsXHJcbiAgICAgIC8vIHBhZ2VTaXplOiB0aGlzLnBhZ2VJbmZvLnBhZ2VTaXplLFxyXG4gICAgICAvLyBwYWdlSW5kZXg6IHRoaXMucGFnZUluZm8ucGFnZUluZGV4LFxyXG4gICAgICBkYXRhOiB0aGlzLml0ZW1zXHJcbiAgICB9KTtcclxuICB9XHJcbiAgcHJpdmF0ZSBnZXRUYXJnZXRSZWYoKSB7XHJcbiAgICBpZiAodGhpcy50YXJnZXRSZWYgPT09ICdFbXB0eScpIHtcclxuICAgICAgcmV0dXJuICcnO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIHRoaXMudGFyZ2V0UmVmO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5leHBvcnQgY2xhc3MgQmFja3dhcmRSdWxlQ29udmVydGVyIGltcGxlbWVudHMgVHlwZUNvbnZlcnRlciB7XHJcbiAgY29uc3RydWN0b3IoKSB7IH1cclxuXHJcbiAgY29udmVydFRvKGRhdGE6IGFueSk6IHN0cmluZyB7XHJcbiAgICBpZiAoZGF0YSkge1xyXG4gICAgICByZXR1cm4gJ++8iOW3suiuvue9ru+8iSc7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gJ++8iOacquiuvue9ru+8iSc7XHJcbiAgfVxyXG59XHJcblxyXG4iXX0=