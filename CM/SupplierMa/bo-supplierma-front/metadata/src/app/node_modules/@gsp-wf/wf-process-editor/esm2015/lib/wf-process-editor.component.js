/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, ViewChild, ElementRef, Injector, ComponentFactoryResolver, HostBinding, Output, EventEmitter } from '@angular/core';
import { ProcessTime } from './model/process-time';
import { DomSanitizer } from '@angular/platform-browser';
import { ProcessDesignerUIState } from './app/process-designer.uistate';
import { ResourceKeys } from './model/resourceKeys';
import { ProcessDesignerViewModel } from './app/process-designer.viewmodel';
import { ExecuteFormModel, TerminalType } from './views/execute-forms/entities/execute-form.entity';
import { BsModalService } from '@farris/ui-modal';
import { ProcessDesignerDataService } from './domain/process-designer.dataservice';
import { LoadingService } from '@farris/ui-loading';
import { NotifyService } from '@farris/ui-notify';
import { MessagerService } from '@farris/ui-messager';
import { WFFlowElementsViewModel } from './app/wf-flowElements.viewModel';
import { PropertyPanelComponent } from '@farris/ui-property-panel';
import { SignRuleComponent } from './views/sign-rule/sign-rule.component';
import { ProcessInfo } from './model/process-info';
import { RTProcessInfo } from './model/rt-process-info';
import { of } from 'rxjs';
import { AuditEvent } from './domain/entities/audit-processDef-info';
import { NoteComponent } from './views/note/note.component';
import { ProcessDeUtil } from './domain/process-de-util';
export class WfProcessEditorComponent {
    /**
     * @param {?} sanitizer
     * @param {?} uiState
     * @param {?} viewModel
     * @param {?} service
     * @param {?} loadService
     * @param {?} notify
     * @param {?} message
     * @param {?} activity
     * @param {?} injector
     * @param {?} modalService
     * @param {?} resolver
     */
    constructor(sanitizer, uiState, viewModel, service, loadService, notify, message, activity, injector, modalService, resolver) {
        this.sanitizer = sanitizer;
        this.uiState = uiState;
        this.viewModel = viewModel;
        this.service = service;
        this.loadService = loadService;
        this.notify = notify;
        this.message = message;
        this.activity = activity;
        this.injector = injector;
        this.modalService = modalService;
        this.resolver = resolver;
        this.flag = true;
        this.cls = 'farris-main-area flex-column';
        this.action = 'edit';
        this.mode = 'general';
        this.close = new EventEmitter();
        /**
         * 监听事件处理
         */
        this.eventHandler = (/**
         * @param {?} event
         * @return {?}
         */
        (event) => {
            /** @type {?} */
            const postData = (/** @type {?} */ (event.data));
            if (this.uiState.POST_MESSAGE_TARGET.search(event.origin) > -1) {
                switch (postData.action) {
                    case ResourceKeys.wf_initProperty:
                        if (this.flag) {
                            this.flag = false;
                            this.closeLoading();
                        }
                        this.viewModel.initProcessProperty(postData.data);
                        break;
                    case ResourceKeys.wf_save:
                        this.uiState.content = postData.data;
                        this.showLoading();
                        this.save();
                        break;
                    case ResourceKeys.wf_deploy:
                        this.uiState.content = postData.data;
                        this.showLoading();
                        this.viewModel.deployProcess(this.uiState.content).subscribe((/**
                         * @param {?} data
                         * @return {?}
                         */
                        (data) => {
                            this.closeLoading();
                            this.viewModel.saveProcess(this.uiState.content, this.processInfo, 0).subscribe((/**
                             * @param {?} r
                             * @return {?}
                             */
                            (r) => { }));
                            this.notify.success((/** @type {?} */ ({
                                title: '系统提示', msg: '发布成功', timeout: 3000
                            })));
                            /** @type {?} */
                            const process = JSON.parse(this.uiState.content);
                            this.viewModel.auditProcessDef(AuditEvent.WF_ProcessDef_Deploy, true, process.DefaultProcess.Key);
                        }), (/**
                         * @param {?} error
                         * @return {?}
                         */
                        (error) => {
                            this.closeLoading();
                            this.notify.error((/** @type {?} */ ({
                                title: '系统提示', msg: '发布失败，请检查流程是否正确！', timeout: 3000
                            })));
                            /** @type {?} */
                            const process = JSON.parse(this.uiState.content);
                            this.viewModel.auditProcessDef(AuditEvent.WF_ProcessDef_Deploy, false, process.DefaultProcess.Key);
                        }));
                        break;
                    case ResourceKeys.wf_saveAs:
                        /** @type {?} */
                        const prcoess = postData.data;
                        this.viewModel.saveAsProcess(prcoess, this.processInfo);
                        break;
                    case ResourceKeys.wf_sync:
                        /** @type {?} */
                        const content = postData.data;
                        this.viewModel.syncDtProcess(content, this.rtProcessInfo);
                        break;
                    case ResourceKeys.wf_note:
                        this.note(postData.data);
                        break;
                    case ResourceKeys.wf_closeDesigner:
                        this.close.emit();
                        break;
                    case ResourceKeys.getActivities: // 获取活动节点信息
                        this.uiState.getUserActList(postData.data);
                        break;
                    case ResourceKeys.getEndEvents: // 获取所有结束节点信息
                        this.uiState.getEndEventList(postData.data);
                        break;
                    case 'loaded':
                        this.openProcContent();
                        break;
                    case ResourceKeys.wf_showTip:
                        this.showTip(postData.data);
                        break;
                    default:
                        this.viewModel.setProperty(postData.data);
                        break;
                }
            }
        });
        // 如果存在消息监听，先删掉
        if (WfProcessEditorComponent.func) {
            window.removeEventListener('message', WfProcessEditorComponent.func, false);
        }
        this.addMessageListener();
        this.uiState.getAdministratorInfo();
    }
    /**
     * @param {?} t
     * @return {?}
     */
    set time(t) {
        this._time = t;
    }
    /**
     * @return {?}
     */
    get time() {
        return this._time;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.getSrc();
        this.uiState.initUIState();
        this.showLoading();
        this.updateProperty();
        // 获取消息列表
        this.uiState.getMessageChannels();
    }
    /**
     * @private
     * @return {?}
     */
    getSrc() {
        /** @type {?} */
        let processCategoryId;
        if (this._time === ProcessTime.rt) {
            processCategoryId = this.rtProcessInfo.flowFormId;
        }
        else {
            processCategoryId = this.processInfo.flowFormId;
        }
        this.viewModel.getProcessCategory(processCategoryId).subscribe((/**
         * @param {?} procCategory
         * @return {?}
         */
        (procCategory) => {
            this.src = '/platform/runtime/wf/web/designer/index.html';
            if (this._time === ProcessTime.rt) {
                this.src = this.src + '?time=rt';
            }
            else {
                this.src = this.src + `?time=dt`;
                if (procCategory) {
                    this.src = this.src + `&bizCategoryId=${procCategory.businessObjectId}`;
                }
            }
            if (this.action === 'view') {
                this.src = this.src + '&action=view';
            }
            else {
                this.src = this.src + '&action=edit';
            }
            if (this.mode === 'general') {
                this.src = this.src + '&mode=general';
            }
            else {
                this.src = this.src + '&mode=simplify';
            }
            this.src = this.sanitizer.bypassSecurityTrustResourceUrl(this.src);
        }));
    }
    /**
     * 添加事件监听
     * @private
     * @return {?}
     */
    addMessageListener() {
        window.addEventListener('message', this.eventHandler, false);
        WfProcessEditorComponent.func = this.eventHandler;
    }
    /**
     * @private
     * @return {?}
     */
    updateProperty() {
        this.propertyPanel.propertyChanged.subscribe((/**
         * @param {?} data
         * @return {?}
         */
        (data) => {
            this.updateChangeProperty(data);
        }));
        this.propertyPanel.submitModal.subscribe((/**
         * @param {?} data
         * @return {?}
         */
        (data) => {
            this.updateChangeProperty(data.changeObject);
        }));
        return false; // 防止冒泡
    }
    /**
     * 更新属性
     * @private
     * @param {?} data
     * @return {?}
     */
    updateChangeProperty(data) {
        data.Id = this.uiState.propertyData.Id;
        switch (data.propertyID) {
            case ResourceKeys.EntryForm:
                this.bindEntryFormInfo(data);
                break;
            case ResourceKeys.ApprovalItems:
                this.sendMessage(ResourceKeys.updateProperty, JSON.stringify(data));
                this.activity.buildCounterSignVariables(data.propertyValue);
                break;
            case ResourceKeys.CompleteStrategy:
                this.beforeCompleteStrategyChange(data).subscribe((/**
                 * @param {?} b
                 * @return {?}
                 */
                b => {
                    if (b) {
                        this.sendMessage(ResourceKeys.updateProperty, JSON.stringify(data));
                        this.completeStrategyChanged(data.propertyValue);
                    }
                    else { // 刷新属性框
                        this.sendMessage(ResourceKeys.refresh, JSON.stringify(data));
                    }
                }));
                break;
            case ResourceKeys.SignRule:
                this.sendMessage(ResourceKeys.updateProperty, JSON.stringify(data));
                break;
            default:
                this.sendMessage(ResourceKeys.updateProperty, JSON.stringify(data));
                break;
        }
    }
    /**
     * 绑定流程分类的参数列表，流程构件，表单赋值
     * @private
     * @param {?} data
     * @return {?}
     */
    bindEntryFormInfo(data) {
        /** @type {?} */
        const flowformId = data.propertyValue.id;
        if (flowformId) {
            this.viewModel.getFlowFormInfoById(flowformId).subscribe((/**
             * @param {?} info
             * @return {?}
             */
            (info) => {
                data.flowForm = info.flowForm;
                data.formalParameters = info.formalParameters;
                data.processBizComponnets = info.bizComponents;
                data.executeForms = [];
                info.excuteForms.forEach((/**
                 * @param {?} form
                 * @return {?}
                 */
                form => {
                    if (form.isDefault) {
                        /** @type {?} */
                        const executeForms = this.ConvertExecuteForm(form);
                        data.executeForms = data.executeForms.concat(executeForms); // 流程绑定默认单据
                    }
                }));
                data.customizeActions = info.customizeActions.filter((/**
                 * @param {?} a
                 * @return {?}
                 */
                a => a.isAll === true)).map((/**
                 * @param {?} a
                 * @return {?}
                 */
                a => ({
                    id: a.id, code: a.code, name: a.name, terminalType: a.terminal,
                    actualParameters: a.actualParameters.map((/**
                     * @param {?} p
                     * @return {?}
                     */
                    p => ({
                        Name: p.code, Value: p.value, ValueText: p.name, Tag: 'expression'
                    })))
                })));
                this.sendMessage(ResourceKeys.loadBizActivity, info.bizActivities || []);
                this.sendMessage(ResourceKeys.updateProperty, JSON.stringify(data));
            }));
        }
    }
    /**
     * @private
     * @param {?} record
     * @return {?}
     */
    note(record) {
        /** @type {?} */
        const compFactory = this.resolver.resolveComponentFactory(NoteComponent);
        /** @type {?} */
        const compRef = compFactory.create(this.injector);
        compRef.instance.record = record;
        /** @type {?} */
        const modalConfig = {
            title: '流程变更记录',
            width: 800,
            height: 520,
            showButtons: true,
            buttons: compRef.instance.footer
        };
        /** @type {?} */
        const dialog = this.modalService.show(compRef, modalConfig);
        compRef.instance.cancel.subscribe((/**
         * @param {?} $event
         * @return {?}
         */
        $event => dialog.close()));
        compRef.instance.submit.subscribe((/**
         * @param {?} data
         * @return {?}
         */
        (data) => {
            this.sendMessage(ResourceKeys.wf_note, data);
            dialog.close();
        }));
    }
    /**
     * @private
     * @return {?}
     */
    openProcContent() {
        if (this.time === ProcessTime.dt) {
            if (this.processInfo) {
                if (this.processInfo.processKey === ResourceKeys.new && this.processInfo.flowFormId) {
                    this.openNewProcess(this.processInfo.flowFormId);
                }
                else {
                    // TODO：首先获取流程分类信息，确保流程分类和流程构件获取到（会稍微影响设计器打开速度）
                    this.viewModel.getFlowFormInfoById(this.processInfo.flowFormId).subscribe((/**
                     * @param {?} info
                     * @return {?}
                     */
                    (info) => {
                        this.sendMessage(ResourceKeys.loadBizActivity, info.bizActivities || []);
                        this.getProcContent(this.processInfo.processKey).subscribe((/**
                         * @param {?} re
                         * @return {?}
                         */
                        re => {
                            this.uiState.content = this.checkModelContent(JSON.stringify(re));
                            this.sendMessage(ResourceKeys.open, {
                                content: this.uiState.content
                            });
                        }));
                    }));
                }
            }
            else {
                throw new Error('不存在设计时流程信息！请先赋值！');
            }
        }
        else if (this.time === ProcessTime.rt) {
            if (this.rtProcessInfo) {
                this.viewModel.getFlowFormInfoById(this.rtProcessInfo.flowFormId).subscribe((/**
                 * @param {?} info
                 * @return {?}
                 */
                (info) => {
                    this.sendMessage(ResourceKeys.loadBizActivity, info.bizActivities || []);
                    this.getProcContent(this.rtProcessInfo.rtProcDefId).subscribe((/**
                     * @param {?} re
                     * @return {?}
                     */
                    re => {
                        this.uiState.content = this.checkModelContent(JSON.stringify(re));
                        this.sendMessage(ResourceKeys.open, {
                            content: this.uiState.content
                        });
                    }));
                }));
            }
            else {
                throw new Error('不存在运行时流程信息！请先赋值！');
            }
        }
    }
    /**
     * 新增流程，基于流程分类获取参数列表，构件和表单
     * @private
     * @param {?} ffId 流程分类ID
     * @return {?}
     */
    openNewProcess(ffId) {
        this.viewModel.getFlowFormInfoById(ffId)
            .subscribe((/**
         * @param {?} info
         * @return {?}
         */
        (info) => {
            /** @type {?} */
            const processBizComponnets = info.bizComponents;
            /** @type {?} */
            const customizeActions = info.customizeActions.filter((/**
             * @param {?} a
             * @return {?}
             */
            a => a.isAll === true)).map((/**
             * @param {?} a
             * @return {?}
             */
            a => ({
                id: a.id, code: a.code, name: a.name, terminalType: a.terminal,
                actualParameters: a.actualParameters.map((/**
                 * @param {?} p
                 * @return {?}
                 */
                p => ({
                    Name: p.code, Value: p.value, ValueText: p.name, Tag: 'expression'
                })))
            })));
            /** @type {?} */
            let executeForms = [];
            info.excuteForms.forEach((/**
             * @param {?} form
             * @return {?}
             */
            form => {
                if (form.isDefault) {
                    /** @type {?} */
                    const forms = this.ConvertExecuteForm(form);
                    executeForms = executeForms.concat(forms); // 流程绑定默认单据
                }
            }));
            // 如果不存在表单定义，需要去表单格式列表取一下
            if (executeForms.length === 0
                || executeForms.findIndex((/**
                 * @param {?} e
                 * @return {?}
                 */
                e => e.TerminalType === TerminalType.PC)) === -1
                || executeForms.findIndex((/**
                 * @param {?} e
                 * @return {?}
                 */
                e => e.TerminalType === TerminalType.MOBILE)) === -1) {
                this.viewModel.getFormFormatsByBizCategory().subscribe((/**
                 * @param {?} formFormats
                 * @return {?}
                 */
                (formFormats) => {
                    if (formFormats && formFormats.length > 0) {
                        if (executeForms.findIndex((/**
                         * @param {?} e
                         * @return {?}
                         */
                        e => e.TerminalType === TerminalType.PC)) === -1) {
                            /** @type {?} */
                            const formFormat = formFormats.filter((/**
                             * @param {?} f
                             * @return {?}
                             */
                            f => f.terminal === 'PC' && f.status === 0))[0];
                            if (formFormat) {
                                executeForms.push(this.formFormat2ExecuteForm(formFormat));
                            }
                        }
                        if (executeForms.findIndex((/**
                         * @param {?} e
                         * @return {?}
                         */
                        e => e.TerminalType === TerminalType.MOBILE)) === -1) {
                            /** @type {?} */
                            const formFormat = formFormats.filter((/**
                             * @param {?} f
                             * @return {?}
                             */
                            f => f.terminal === 'Mobile' && f.status === 0))[0];
                            if (formFormat) {
                                executeForms.push(this.formFormat2ExecuteForm(formFormat));
                            }
                        }
                    }
                    this.sendMessage(ResourceKeys.loadBizActivity, info.bizActivities || []);
                    this.sendMessage(ResourceKeys.new, {
                        name: this.processInfo.processName,
                        bizObjId: this.processInfo.bizObjId,
                        ffId,
                        ffName: this.processInfo.flowFormName,
                        startMode: this.processInfo.startMode,
                        formalParameters: info.formalParameters,
                        processBizComponnets,
                        executeForms,
                        customizeActions,
                        processDescription: info.flowForm.processDescription
                    });
                }));
            }
            else {
                this.sendMessage(ResourceKeys.loadBizActivity, info.bizActivities || []);
                this.sendMessage(ResourceKeys.new, {
                    name: this.processInfo.processName,
                    bizObjId: this.processInfo.bizObjId,
                    ffId,
                    ffName: this.processInfo.flowFormName,
                    startMode: this.processInfo.startMode,
                    formalParameters: info.formalParameters,
                    processBizComponnets,
                    executeForms,
                    customizeActions,
                    processDescription: info.flowForm.processDescription
                });
            }
        }));
    }
    // 向子页面发送消息
    /**
     * @private
     * @param {?} action
     * @param {?} data
     * @return {?}
     */
    sendMessage(action, data) {
        /** @type {?} */
        const iframeWindow = this.iframe.nativeElement.contentWindow;
        /** @type {?} */
        const message = this.wrapMessage(action, data);
        iframeWindow.postMessage(message, this.uiState.POST_MESSAGE_TARGET);
    }
    // 包装消息内容
    /**
     * @private
     * @param {?} action
     * @param {?} data
     * @return {?}
     */
    wrapMessage(action, data) {
        return {
            action,
            data
        };
    }
    /**
     * @private
     * @param {?} data
     * @return {?}
     */
    showTip(data) {
        if (data.type === 'message') {
            switch (data.level) {
                case 'warning':
                    this.message.warning(data.message);
                    break;
                case 'error':
                    this.message.error(data.message);
                    break;
                default:
                    this.message.info(data.message);
                    break;
            }
        }
        else if (data.type === 'notify') {
            switch (data.level) {
                case 'warning':
                    this.notify.warning(data.message);
                    break;
                case 'error':
                    this.notify.error(data.message);
                    break;
                default:
                    this.notify.info(data.message);
                    break;
            }
        }
    }
    /**
     * 获取流程上下文
     * @param {?} id 流程定义ID（设计时使用流程定义Key，运行时使用流程定义ID）
     * @return {?}
     */
    getProcContent(id) {
        if (id) {
            if (this.time === ProcessTime.dt) {
                return this.service.getProcContentbyKey(id);
            }
            else if (this.time === ProcessTime.rt) {
                return this.service.getRTProcContentbyId(id);
            }
            else {
                throw new Error('设计器运行时机错误！');
            }
        }
    }
    /**
     * @private
     * @return {?}
     */
    save() {
        /** @type {?} */
        const process = JSON.parse(this.uiState.content);
        // this.uiState.content = this.checkModelContent(this.uiState.content);
        this.saveHttp().subscribe((/**
         * @param {?} data
         * @return {?}
         */
        (data) => {
            this.closeLoading();
            this.notify.success((/** @type {?} */ ({
                title: '系统提示', msg: '保存成功', timeout: 3000
            })));
            if (this.time === ProcessTime.dt) {
                this.viewModel.auditProcessDef(AuditEvent.WF_ProcessDef_SaveDT, true, process.DefaultProcess.Key);
            }
            else if (this.time === ProcessTime.rt) {
                this.viewModel.auditProcessDef(AuditEvent.WF_ProcessDef_SaveRT, true, process.DefaultProcess.Key);
            }
        }), (/**
         * @param {?} error
         * @return {?}
         */
        (error) => {
            this.closeLoading();
            this.notify.error((/** @type {?} */ ({
                title: '系统提示', msg: '保存失败，请检查流程是否正确！', timeout: 3000
            })));
            if (this.time === ProcessTime.dt) {
                this.viewModel.auditProcessDef(AuditEvent.WF_ProcessDef_SaveDT, false, process.DefaultProcess.Key);
            }
            else if (this.time === ProcessTime.rt) {
                this.viewModel.auditProcessDef(AuditEvent.WF_ProcessDef_SaveRT, false, process.DefaultProcess.Key);
            }
        }));
    }
    /**
     * 保存流程定义（设计时+运行时）
     * @private
     * @return {?}
     */
    saveHttp() {
        if (this.uiState.content) {
            if (this.time === ProcessTime.dt) {
                return this.viewModel.saveProcess(this.uiState.content, this.processInfo, 1);
            }
            else if (this.time === ProcessTime.rt) {
                return this.viewModel.saveRTProcess(this.uiState.content, this.rtProcessInfo.rtProcDefId);
            }
            else {
                throw new Error('设计器运行时机错误！');
            }
        }
    }
    /**
     * @return {?}
     */
    showLoading() {
        this.loadService.show({ container: 'body', message: '', type: 1 });
    }
    /**
     * @return {?}
     */
    closeLoading() {
        this.loadService.close();
    }
    /**
     * @private
     * @param {?} form
     * @return {?}
     */
    ConvertExecuteForm(form) {
        /** @type {?} */
        const executeForms = new Array();
        if (form.terminal === 'web,app') {
            /** @type {?} */
            const webForm = new ExecuteFormModel();
            webForm.ComponentId = form.appId;
            webForm.formFormatId = form.formFormatId;
            webForm.FormType = form.formType;
            webForm.Name = form.name;
            webForm.TerminalType = TerminalType.PC;
            if (form.actualParameters && form.actualParameters.length > 0) {
                webForm.ActualParameters = form.actualParameters.map((/**
                 * @param {?} p
                 * @return {?}
                 */
                p => ({
                    Name: p.code,
                    Value: p.value
                })));
            }
            executeForms.push(webForm);
            /** @type {?} */
            const appForm = new ExecuteFormModel();
            appForm.ComponentId = form.appId;
            appForm.formFormatId = form.formFormatId;
            appForm.FormType = form.formType;
            appForm.Name = form.name;
            appForm.TerminalType = TerminalType.MOBILE;
            if (form.actualParameters && form.actualParameters.length > 0) {
                appForm.ActualParameters = form.actualParameters.map((/**
                 * @param {?} p
                 * @return {?}
                 */
                p => ({
                    Name: p.code,
                    Value: p.value
                })));
            }
            executeForms.push(appForm);
        }
        else {
            /** @type {?} */
            const executeForm = new ExecuteFormModel();
            executeForm.ComponentId = form.appId;
            executeForm.formFormatId = form.formFormatId;
            executeForm.FormType = form.formType;
            executeForm.Name = form.name;
            switch (form.terminal) {
                case 'web':
                    executeForm.TerminalType = TerminalType.PC;
                    break;
                case 'app':
                    executeForm.TerminalType = TerminalType.MOBILE;
                    break;
            }
            if (form.actualParameters && form.actualParameters.length > 0) {
                executeForm.ActualParameters = form.actualParameters.map((/**
                 * @param {?} p
                 * @return {?}
                 */
                p => ({
                    Name: p.code,
                    Value: p.value
                })));
            }
            executeForms.push(executeForm);
        }
        return executeForms;
    }
    /**
     * @private
     * @param {?} formformat
     * @return {?}
     */
    formFormat2ExecuteForm(formformat) {
        /** @type {?} */
        const form = new ExecuteFormModel();
        form.Id = ProcessDeUtil.GenerateElementId();
        form.ComponentId = null;
        form.formFormatId = formformat.id;
        form.FormType = '0';
        form.Name = formformat.name;
        switch (formformat.terminal) {
            case 'PC':
                form.TerminalType = TerminalType.PC;
                break;
            case 'Mobile':
                form.TerminalType = TerminalType.MOBILE;
                break;
        }
        if (formformat.urlParameters && formformat.urlParameters.length > 0) {
            form.ActualParameters = formformat.urlParameters.map((/**
             * @param {?} p
             * @return {?}
             */
            p => ({
                Name: p.code,
                Value: p.value
            })));
        }
        return form;
    }
    /**
     * @private
     * @param {?} strategy
     * @return {?}
     */
    completeStrategyChanged(strategy) {
        if (strategy !== this.uiState.completeIterator[0].key) {
            // 参与者存在自动审批的情况下，不允许修改完成策略为会签规则
            // if (this.uiState.propertyData.ParticipantSchemes
            //   && this.uiState.propertyData.ParticipantSchemes.options
            //   && this.uiState.propertyData.ParticipantSchemes.options.automaticPerformers
            //   && this.uiState.propertyData.ParticipantSchemes.options.automaticPerformers.length > 0) {
            //   return;
            // } else {
            // 会签规则不存在，即由抢占模式，变为会签时
            if (!this.uiState.propertyData.SignRule) {
                // 会签是自动弹出会签规则编辑
                /** @type {?} */
                const compFactory = this.resolver.resolveComponentFactory(SignRuleComponent);
                /** @type {?} */
                const compRef = compFactory.create(this.injector);
                compRef.instance.value = [];
                // compRef.instance.counterSignVariables = this.uiState.counterSignVariables || [];
                // compRef.instance.approvalItems = this.uiState.approvalItems || [];
                /** @type {?} */
                const modalConfig = Object.assign(compRef.instance.modalConfig, { buttons: compRef.instance.modalFooter });
                /** @type {?} */
                const dialog = this.modalService.show(compRef, modalConfig);
                compRef.instance.closeModal.subscribe((/**
                 * @param {?} $event
                 * @return {?}
                 */
                $event => dialog.close()));
                compRef.instance.submitModal.subscribe((/**
                 * @param {?} data
                 * @return {?}
                 */
                (data) => {
                    this.updateChangeProperty({
                        categoryId: 'performerProperty',
                        propertyID: ResourceKeys.SignRule,
                        propertyValue: data.value
                    });
                    dialog.close();
                }));
            }
            // 会签规则下，驳回规则约束
            if (((/** @type {?} */ (this.uiState.propertyData.BackWardRule))).SelectTargetAble === true) {
                setTimeout((/**
                 * @return {?}
                 */
                () => {
                    this.message.warning('会签策略下,“驳回规则”不允许“动态选择驳回级次”，请修改！');
                }), 500);
            }
            // }
        }
    }
    /**
     * 完成策略调整校验
     * @private
     * @param {?} data
     * @return {?}
     */
    beforeCompleteStrategyChange(data) {
        if (this.time === ProcessTime.rt) {
            return this.viewModel.beforeCompleteStrategyChange(data, this.rtProcessInfo);
        }
        else {
            return of(true);
        }
    }
    /**
     * 保存，发布，另存，同步操作时
     * 校验模型的流程分类ID与列表存储是否一致，不一致时，以列表为准
     * @private
     * @param {?} content
     * @return {?}
     */
    checkModelContent(content) {
        /** @type {?} */
        const process = JSON.parse(content);
        /** @type {?} */
        const modelBizDefKey = process.DefaultProcess.extensionElements.find((/**
         * @param {?} e
         * @return {?}
         */
        e => e.ClrTypeID === 'wf.ProcessHeader')).BizDefKey;
        if (this.time === ProcessTime.dt) {
            if (modelBizDefKey === this.processInfo.flowFormId) {
                return content;
            }
            else {
                process.DefaultProcess.extensionElements.find((/**
                 * @param {?} e
                 * @return {?}
                 */
                e => e.ClrTypeID === 'wf.ProcessHeader')).BizDefKey = this.processInfo.flowFormId;
                process.DefaultProcess.extensionElements.find((/**
                 * @param {?} e
                 * @return {?}
                 */
                e => e.ClrTypeID === 'wf.ProcessHeader')).BizDefName = this.uiState.flowFormInfo.flowForm.name;
                return JSON.stringify(process);
            }
        }
        else if (this.time === ProcessTime.rt) {
            if (modelBizDefKey === this.rtProcessInfo.flowFormId) {
                return content;
            }
            else {
                process.DefaultProcess.extensionElements.find((/**
                 * @param {?} e
                 * @return {?}
                 */
                e => e.ClrTypeID === 'wf.ProcessHeader')).BizDefKey = this.rtProcessInfo.flowFormId;
                process.DefaultProcess.extensionElements.find((/**
                 * @param {?} e
                 * @return {?}
                 */
                e => e.ClrTypeID === 'wf.ProcessHeader')).BizDefName = this.uiState.flowFormInfo.flowForm.name;
                return JSON.stringify(process);
            }
        }
    }
}
/**
 * 消息监听处理方法
 */
WfProcessEditorComponent.func = null;
WfProcessEditorComponent.decorators = [
    { type: Component, args: [{
                selector: 'wf-process-editor',
                template: `
  <div class="f-utils-flex-column h-100 m-2">
    <div class="flex-auto d-flex flex-fill flex-row" style="position:relative; overflow: hidden">
      <div class="flex-grow-1">
        <div *ngIf="src" class="h-100">
          <iframe #iframe class="bpmn-designer" [src]="src" frameborder="0">
          </iframe>
        </div>
      </div>
      <div>
        <app-property-panel #propertyPanel [(propertyConfig)]="uiState.propertyConfig" [(propertyData)]="uiState.propertyData"
          width="235" showCloseBtn="false"></app-property-panel>
      </div>
    </div>
  </div>`,
                styles: [`
    .bpmn-designer {
      height: 100%;
      min-height: 400px;
      width: 100%;
    }`]
            }] }
];
/** @nocollapse */
WfProcessEditorComponent.ctorParameters = () => [
    { type: DomSanitizer },
    { type: ProcessDesignerUIState },
    { type: ProcessDesignerViewModel },
    { type: ProcessDesignerDataService },
    { type: LoadingService },
    { type: NotifyService },
    { type: MessagerService },
    { type: WFFlowElementsViewModel },
    { type: Injector },
    { type: BsModalService },
    { type: ComponentFactoryResolver }
];
WfProcessEditorComponent.propDecorators = {
    cls: [{ type: HostBinding, args: ['class',] }],
    time: [{ type: Input }],
    processInfo: [{ type: Input }],
    rtProcessInfo: [{ type: Input }],
    action: [{ type: Input }],
    mode: [{ type: Input }],
    close: [{ type: Output }],
    propertyPanel: [{ type: ViewChild, args: ['propertyPanel',] }],
    iframe: [{ type: ViewChild, args: ['iframe',] }]
};
if (false) {
    /**
     * 消息监听处理方法
     * @type {?}
     * @private
     */
    WfProcessEditorComponent.func;
    /** @type {?} */
    WfProcessEditorComponent.prototype.src;
    /**
     * @type {?}
     * @private
     */
    WfProcessEditorComponent.prototype.flag;
    /** @type {?} */
    WfProcessEditorComponent.prototype.cls;
    /**
     * @type {?}
     * @private
     */
    WfProcessEditorComponent.prototype._time;
    /** @type {?} */
    WfProcessEditorComponent.prototype.processInfo;
    /** @type {?} */
    WfProcessEditorComponent.prototype.rtProcessInfo;
    /** @type {?} */
    WfProcessEditorComponent.prototype.action;
    /** @type {?} */
    WfProcessEditorComponent.prototype.mode;
    /** @type {?} */
    WfProcessEditorComponent.prototype.close;
    /** @type {?} */
    WfProcessEditorComponent.prototype.propertyPanel;
    /** @type {?} */
    WfProcessEditorComponent.prototype.iframe;
    /**
     * 监听事件处理
     * @type {?}
     */
    WfProcessEditorComponent.prototype.eventHandler;
    /**
     * @type {?}
     * @private
     */
    WfProcessEditorComponent.prototype.sanitizer;
    /** @type {?} */
    WfProcessEditorComponent.prototype.uiState;
    /**
     * @type {?}
     * @private
     */
    WfProcessEditorComponent.prototype.viewModel;
    /**
     * @type {?}
     * @private
     */
    WfProcessEditorComponent.prototype.service;
    /**
     * @type {?}
     * @private
     */
    WfProcessEditorComponent.prototype.loadService;
    /**
     * @type {?}
     * @private
     */
    WfProcessEditorComponent.prototype.notify;
    /**
     * @type {?}
     * @private
     */
    WfProcessEditorComponent.prototype.message;
    /**
     * @type {?}
     * @private
     */
    WfProcessEditorComponent.prototype.activity;
    /**
     * @type {?}
     * @private
     */
    WfProcessEditorComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    WfProcessEditorComponent.prototype.modalService;
    /**
     * @type {?}
     * @private
     */
    WfProcessEditorComponent.prototype.resolver;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2YtcHJvY2Vzcy1lZGl0b3IuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdzcC13Zi93Zi1wcm9jZXNzLWVkaXRvci8iLCJzb3VyY2VzIjpbImxpYi93Zi1wcm9jZXNzLWVkaXRvci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsS0FBSyxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLHdCQUF3QixFQUFFLFdBQVcsRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3ZKLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUNuRCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDekQsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFDeEUsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBRXBELE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxNQUFNLGtDQUFrQyxDQUFDO0FBRTVFLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxZQUFZLEVBQUUsTUFBTSxvREFBb0QsQ0FBQztBQUVwRyxPQUFPLEVBQWdCLGNBQWMsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBRWhFLE9BQU8sRUFBRSwwQkFBMEIsRUFBRSxNQUFNLHVDQUF1QyxDQUFDO0FBQ25GLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUNwRCxPQUFPLEVBQUUsYUFBYSxFQUFpQixNQUFNLG1CQUFtQixDQUFDO0FBQ2pFLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN0RCxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSxpQ0FBaUMsQ0FBQztBQUcxRSxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUNuRSxPQUFPLEVBQUUsaUJB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N0IsMkNBQWdDOzs7OztJQUNoQyw0Q0FBeUM7Ozs7O0lBQ3pDLDRDQUEwQjs7Ozs7SUFDMUIsZ0RBQW9DOzs7OztJQUNwQyw0Q0FBMEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgSW5wdXQsIFZpZXdDaGlsZCwgRWxlbWVudFJlZiwgSW5qZWN0b3IsIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciwgSG9zdEJpbmRpbmcsIE91dHB1dCwgRXZlbnRFbWl0dGVyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFByb2Nlc3NUaW1lIH0gZnJvbSAnLi9tb2RlbC9wcm9jZXNzLXRpbWUnO1xyXG5pbXBvcnQgeyBEb21TYW5pdGl6ZXIgfSBmcm9tICdAYW5ndWxhci9wbGF0Zm9ybS1icm93c2VyJztcclxuaW1wb3J0IHsgUHJvY2Vzc0Rlc2lnbmVyVUlTdGF0ZSB9IGZyb20gJy4vYXBwL3Byb2Nlc3MtZGVzaWduZXIudWlzdGF0ZSc7XHJcbmltcG9ydCB7IFJlc291cmNlS2V5cyB9IGZyb20gJy4vbW9kZWwvcmVzb3VyY2VLZXlzJztcclxuaW1wb3J0IHsgRmxvd0Zvcm1JbmZvIH0gZnJvbSAnLi9kb21haW4vZW50aXRpZXMvZmxvd2Zvcm0taW5mbyc7XHJcbmltcG9ydCB7IFByb2Nlc3NEZXNpZ25lclZpZXdNb2RlbCB9IGZyb20gJy4vYXBwL3Byb2Nlc3MtZGVzaWduZXIudmlld21vZGVsJztcclxuaW1wb3J0IHsgQml6Q29tcG9uZW50RW50aXR5IH0gZnJvbSAnLi9kb21haW4vZW50aXRpZXMvYml6LWNvbXBvbmVudC5lbnRpdHknO1xyXG5pbXBvcnQgeyBFeGVjdXRlRm9ybU1vZGVsLCBUZXJtaW5hbFR5cGUgfSBmcm9tICcuL3ZpZXdzL2V4ZWN1dGUtZm9ybXMvZW50aXRpZXMvZXhlY3V0ZS1mb3JtLmVudGl0eSc7XHJcbmltcG9ydCB7IEV4Y3V0ZUZvcm1FbnRpdHkgfSBmcm9tICcuL2RvbWFpbi9lbnRpdGllcy9leGN1dGUtZm9ybS5lbnRpdHknO1xyXG5pbXBvcnQgeyBNb2RhbE9wdGlvbnMsIEJzTW9kYWxTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1tb2RhbCc7XHJcbmltcG9ydCB7IEJhY2tXYXJkUnVsZSB9IGZyb20gJy4vdmlld3MvYmFja3dhcmQtcnVsZS9iYWNrd2FyZC1ydWxlLmVudGl0eSc7XHJcbmltcG9ydCB7IFByb2Nlc3NEZXNpZ25lckRhdGFTZXJ2aWNlIH0gZnJvbSAnLi9kb21haW4vcHJvY2Vzcy1kZXNpZ25lci5kYXRhc2VydmljZSc7XHJcbmltcG9ydCB7IExvYWRpbmdTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1sb2FkaW5nJztcclxuaW1wb3J0IHsgTm90aWZ5U2VydmljZSwgTm90aWZ5T3B0aW9ucyB9IGZyb20gJ0BmYXJyaXMvdWktbm90aWZ5JztcclxuaW1wb3J0IHsgTWVzc2FnZXJTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1tZXNzYWdlcic7XHJcbmltcG9ydCB7IFdGRmxvd0VsZW1lbnRzVmlld01vZGVsIH0gZnJvbSAnLi9hcHAvd2YtZmxvd0VsZW1lbnRzLnZpZXdNb2RlbCc7XHJcbmltcG9ydCB7IFBvc3RNZXNzYWdlRGF0YSB9IGZyb20gJy4vbW9kZWwvcG9zdE1lc3NhZ2VEYXRhJztcclxuaW1wb3J0IHsgSHR0cEVycm9yUmVzcG9uc2UgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XHJcbmltcG9ydCB7IFByb3BlcnR5UGFuZWxDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLXByb3BlcnR5LXBhbmVsJztcclxuaW1wb3J0IHsgU2lnblJ1bGVDb21wb25lbnQgfSBmcm9tICcuL3ZpZXdzL3NpZ24tcnVsZS9zaWduLXJ1bGUuY29tcG9uZW50JztcclxuaW1wb3J0IHsgUHJvY2Vzc0luZm8gfSBmcm9tICcuL21vZGVsL3Byb2Nlc3MtaW5mbyc7XHJcbmltcG9ydCB7IFJUUHJvY2Vzc0luZm8gfSBmcm9tICcuL21vZGVsL3J0LXByb2Nlc3MtaW5mbyc7XHJcbmltcG9ydCB7IE9ic2VydmFibGUsIG9mLCBmb3JrSm9pbiB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBBdWRpdEV2ZW50IH0gZnJvbSAnLi9kb21haW4vZW50aXRpZXMvYXVkaXQtcHJvY2Vzc0RlZi1pbmZvJztcclxuaW1wb3J0IHsgTm90ZUNvbXBvbmVudCB9IGZyb20gJy4vdmlld3Mvbm90ZS9ub3RlLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IFByb2Nlc3NEZVV0aWwgfSBmcm9tICcuL2RvbWFpbi9wcm9jZXNzLWRlLXV0aWwnO1xyXG5pbXBvcnQgeyBGbG93Rm9ybUVudGl0eSB9IGZyb20gJy4vZG9tYWluL2VudGl0aWVzL2Zsb3dmb3JtLmVudGl0eSc7XHJcblxyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICd3Zi1wcm9jZXNzLWVkaXRvcicsXHJcbiAgdGVtcGxhdGU6IGBcclxuICA8ZGl2IGNsYXNzPVwiZi11dGlscy1mbGV4LWNvbHVtbiBoLTEwMCBtLTJcIj5cclxuICAgIDxkaXYgY2xhc3M9XCJmbGV4LWF1dG8gZC1mbGV4IGZsZXgtZmlsbCBmbGV4LXJvd1wiIHN0eWxlPVwicG9zaXRpb246cmVsYXRpdmU7IG92ZXJmbG93OiBoaWRkZW5cIj5cclxuICAgICAgPGRpdiBjbGFzcz1cImZsZXgtZ3Jvdy0xXCI+XHJcbiAgICAgICAgPGRpdiAqbmdJZj1cInNyY1wiIGNsYXNzPVwiaC0xMDBcIj5cclxuICAgICAgICAgIDxpZnJhbWUgI2lmcmFtZSBjbGFzcz1cImJwbW4tZGVzaWduZXJcIiBbc3JjXT1cInNyY1wiIGZyYW1lYm9yZGVyPVwiMFwiPlxyXG4gICAgICAgICAgPC9pZnJhbWU+XHJcbiAgICAgICAgPC9kaXY+XHJcbiAgICAgIDwvZGl2PlxyXG4gICAgICA8ZGl2PlxyXG4gICAgICAgIDxhcHAtcHJvcGVydHktcGFuZWwgI3Byb3BlcnR5UGFuZWwgWyhwcm9wZXJ0eUNvbmZpZyldPVwidWlTdGF0ZS5wcm9wZXJ0eUNvbmZpZ1wiIFsocHJvcGVydHlEYXRhKV09XCJ1aVN0YXRlLnByb3BlcnR5RGF0YVwiXHJcbiAgICAgICAgICB3aWR0aD1cIjIzNVwiIHNob3dDbG9zZUJ0bj1cImZhbHNlXCI+PC9hcHAtcHJvcGVydHktcGFuZWw+XHJcbiAgICAgIDwvZGl2PlxyXG4gICAgPC9kaXY+XHJcbiAgPC9kaXY+YCxcclxuICBzdHlsZXM6IFtgXHJcbiAgICAuYnBtbi1kZXNpZ25lciB7XHJcbiAgICAgIGhlaWdodDogMTAwJTtcclxuICAgICAgbWluLWhlaWdodDogNDAwcHg7XHJcbiAgICAgIHdpZHRoOiAxMDAlO1xyXG4gICAgfWBcclxuICBdXHJcbn0pXHJcblxyXG5leHBvcnQgY2xhc3MgV2ZQcm9jZXNzRWRpdG9yQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuXHJcbiAgLyoqXHJcbiAgICog5raI5oGv55uR5ZCs5aSE55CG5pa55rOVXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzdGF0aWMgZnVuYyA9IG51bGw7XHJcblxyXG4gIHNyYzogYW55O1xyXG5cclxuICBwcml2YXRlIGZsYWcgPSB0cnVlO1xyXG5cclxuICBASG9zdEJpbmRpbmcoJ2NsYXNzJylcclxuICBjbHMgPSAnZmFycmlzLW1haW4tYXJlYSBmbGV4LWNvbHVtbic7XHJcblxyXG4gIHByaXZhdGUgX3RpbWU6IFByb2Nlc3NUaW1lO1xyXG4gIEBJbnB1dCgpXHJcbiAgc2V0IHRpbWUodDogUHJvY2Vzc1RpbWUpIHtcclxuICAgIHRoaXMuX3RpbWUgPSB0O1xyXG4gIH1cclxuICBnZXQgdGltZSgpOiBQcm9jZXNzVGltZSB7XHJcbiAgICByZXR1cm4gdGhpcy5fdGltZTtcclxuICB9XHJcblxyXG4gIEBJbnB1dCgpXHJcbiAgcHJvY2Vzc0luZm86IFByb2Nlc3NJbmZvO1xyXG5cclxuICBASW5wdXQoKVxyXG4gIHJ0UHJvY2Vzc0luZm86IFJUUHJvY2Vzc0luZm87XHJcblxyXG4gIEBJbnB1dCgpXHJcbiAgYWN0aW9uOiAndmlldycgfCAnZWRpdCcgPSAnZWRpdCc7XHJcblxyXG4gIEBJbnB1dCgpXHJcbiAgbW9kZTogJ2dlbmVyYWwnIHwgJ3NpbXBsaWZ5JyA9ICdnZW5lcmFsJztcclxuXHJcbiAgQE91dHB1dCgpIGNsb3NlID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcblxyXG4gIEBWaWV3Q2hpbGQoJ3Byb3BlcnR5UGFuZWwnKVxyXG4gIHByb3BlcnR5UGFuZWw6IFByb3BlcnR5UGFuZWxDb21wb25lbnQ7XHJcblxyXG4gIEBWaWV3Q2hpbGQoJ2lmcmFtZScpXHJcbiAgaWZyYW1lOiBFbGVtZW50UmVmO1xyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgc2FuaXRpemVyOiBEb21TYW5pdGl6ZXIsXHJcbiAgICBwdWJsaWMgdWlTdGF0ZTogUHJvY2Vzc0Rlc2lnbmVyVUlTdGF0ZSxcclxuICAgIHByaXZhdGUgdmlld01vZGVsOiBQcm9jZXNzRGVzaWduZXJWaWV3TW9kZWwsXHJcbiAgICBwcml2YXRlIHNlcnZpY2U6IFByb2Nlc3NEZXNpZ25lckRhdGFTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBsb2FkU2VydmljZTogTG9hZGluZ1NlcnZpY2UsXHJcbiAgICBwcml2YXRlIG5vdGlmeTogTm90aWZ5U2VydmljZSxcclxuICAgIHByaXZhdGUgbWVzc2FnZTogTWVzc2FnZXJTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBhY3Rpdml0eTogV0ZGbG93RWxlbWVudHNWaWV3TW9kZWwsXHJcbiAgICBwcml2YXRlIGluamVjdG9yOiBJbmplY3RvcixcclxuICAgIHByaXZhdGUgbW9kYWxTZXJ2aWNlOiBCc01vZGFsU2VydmljZSxcclxuICAgIHByaXZhdGUgcmVzb2x2ZXI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcclxuICApIHtcclxuICAgIC8vIOWmguaenOWtmOWcqOa2iOaBr+ebkeWQrO+8jOWFiOWIoOaOiVxyXG4gICAgaWYgKFdmUHJvY2Vzc0VkaXRvckNvbXBvbmVudC5mdW5jKSB7XHJcbiAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgV2ZQcm9jZXNzRWRpdG9yQ29tcG9uZW50LmZ1bmMsIGZhbHNlKTtcclxuICAgIH1cclxuICAgIHRoaXMuYWRkTWVzc2FnZUxpc3RlbmVyKCk7XHJcbiAgICB0aGlzLnVpU3RhdGUuZ2V0QWRtaW5pc3RyYXRvckluZm8oKTtcclxuICB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gICAgdGhpcy5nZXRTcmMoKTtcclxuICAgIHRoaXMudWlTdGF0ZS5pbml0VUlTdGF0ZSgpO1xyXG4gICAgdGhpcy5zaG93TG9hZGluZygpO1xyXG4gICAgdGhpcy51cGRhdGVQcm9wZXJ0eSgpO1xyXG4gICAgLy8g6I635Y+W5raI5oGv5YiX6KGoXHJcbiAgICB0aGlzLnVpU3RhdGUuZ2V0TWVzc2FnZUNoYW5uZWxzKCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldFNyYygpIHtcclxuICAgIGxldCBwcm9jZXNzQ2F0ZWdvcnlJZDogc3RyaW5nO1xyXG4gICAgaWYgKHRoaXMuX3RpbWUgPT09IFByb2Nlc3NUaW1lLnJ0KSB7XHJcbiAgICAgIHByb2Nlc3NDYXRlZ29yeUlkID0gdGhpcy5ydFByb2Nlc3NJbmZvLmZsb3dGb3JtSWQ7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBwcm9jZXNzQ2F0ZWdvcnlJZCA9IHRoaXMucHJvY2Vzc0luZm8uZmxvd0Zvcm1JZDtcclxuICAgIH1cclxuICAgIHRoaXMudmlld01vZGVsLmdldFByb2Nlc3NDYXRlZ29yeShwcm9jZXNzQ2F0ZWdvcnlJZCkuc3Vic2NyaWJlKChwcm9jQ2F0ZWdvcnk6IEZsb3dGb3JtRW50aXR5KSA9PiB7XHJcbiAgICAgIHRoaXMuc3JjID0gJy9wbGF0Zm9ybS9ydW50aW1lL3dmL3dlYi9kZXNpZ25lci9pbmRleC5odG1sJztcclxuICAgICAgaWYgKHRoaXMuX3RpbWUgPT09IFByb2Nlc3NUaW1lLnJ0KSB7XHJcbiAgICAgICAgdGhpcy5zcmMgPSB0aGlzLnNyYyArICc/dGltZT1ydCc7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5zcmMgPSB0aGlzLnNyYyArIGA/dGltZT1kdGA7XHJcbiAgICAgICAgaWYocHJvY0NhdGVnb3J5KXtcclxuICAgICAgICAgIHRoaXMuc3JjID0gdGhpcy5zcmMgKyBgJmJpekNhdGVnb3J5SWQ9JHtwcm9jQ2F0ZWdvcnkuYnVzaW5lc3NPYmplY3RJZH1gO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBpZiAodGhpcy5hY3Rpb24gPT09ICd2aWV3Jykge1xyXG4gICAgICAgIHRoaXMuc3JjID0gdGhpcy5zcmMgKyAnJmFjdGlvbj12aWV3JztcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLnNyYyA9IHRoaXMuc3JjICsgJyZhY3Rpb249ZWRpdCc7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKHRoaXMubW9kZSA9PT0gJ2dlbmVyYWwnKSB7XHJcbiAgICAgICAgdGhpcy5zcmMgPSB0aGlzLnNyYyArICcmbW9kZT1nZW5lcmFsJztcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLnNyYyA9IHRoaXMuc3JjICsgJyZtb2RlPXNpbXBsaWZ5JztcclxuICAgICAgfVxyXG4gICAgICB0aGlzLnNyYyA9IHRoaXMuc2FuaXRpemVyLmJ5cGFzc1NlY3VyaXR5VHJ1c3RSZXNvdXJjZVVybCh0aGlzLnNyYyk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOa3u+WKoOS6i+S7tuebkeWQrFxyXG4gICAqL1xyXG4gIHByaXZhdGUgYWRkTWVzc2FnZUxpc3RlbmVyKCkge1xyXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCB0aGlzLmV2ZW50SGFuZGxlciwgZmFsc2UpO1xyXG4gICAgV2ZQcm9jZXNzRWRpdG9yQ29tcG9uZW50LmZ1bmMgPSB0aGlzLmV2ZW50SGFuZGxlcjtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOebkeWQrOS6i+S7tuWkhOeQhlxyXG4gICAqL1xyXG4gIGV2ZW50SGFuZGxlciA9IChldmVudCkgPT4ge1xyXG4gICAgY29uc3QgcG9zdERhdGEgPSBldmVudC5kYXRhIGFzIFBvc3RNZXNzYWdlRGF0YTtcclxuICAgIGlmICh0aGlzLnVpU3RhdGUuUE9TVF9NRVNTQUdFX1RBUkdFVC5zZWFyY2goZXZlbnQub3JpZ2luKSA+IC0xKSB7XHJcbiAgICAgIHN3aXRjaCAocG9zdERhdGEuYWN0aW9uKSB7XHJcbiAgICAgICAgY2FzZSBSZXNvdXJjZUtleXMud2ZfaW5pdFByb3BlcnR5OlxyXG4gICAgICAgICAgaWYgKHRoaXMuZmxhZykge1xyXG4gICAgICAgICAgICB0aGlzLmZsYWcgPSBmYWxzZTtcclxuICAgICAgICAgICAgdGhpcy5jbG9zZUxvYWRpbmcoKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHRoaXMudmlld01vZGVsLmluaXRQcm9jZXNzUHJvcGVydHkocG9zdERhdGEuZGF0YSk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIFJlc291cmNlS2V5cy53Zl9zYXZlOlxyXG4gICAgICAgICAgdGhpcy51aVN0YXRlLmNvbnRlbnQgPSBwb3N0RGF0YS5kYXRhO1xyXG4gICAgICAgICAgdGhpcy5zaG93TG9hZGluZygpO1xyXG4gICAgICAgICAgdGhpcy5zYXZlKCk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIFJlc291cmNlS2V5cy53Zl9kZXBsb3k6XHJcbiAgICAgICAgICB0aGlzLnVpU3RhdGUuY29udGVudCA9IHBvc3REYXRhLmRhdGE7XHJcbiAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nKCk7XHJcbiAgICAgICAgICB0aGlzLnZpZXdNb2RlbC5kZXBsb3lQcm9jZXNzKHRoaXMudWlTdGF0ZS5jb250ZW50KS5zdWJzY3JpYmUoKGRhdGEpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5jbG9zZUxvYWRpbmcoKTtcclxuICAgICAgICAgICAgdGhpcy52aWV3TW9kZWwuc2F2ZVByb2Nlc3ModGhpcy51aVN0YXRlLmNvbnRlbnQsIHRoaXMucHJvY2Vzc0luZm8sIDApLnN1YnNjcmliZSgocikgPT4geyB9KTtcclxuICAgICAgICAgICAgdGhpcy5ub3RpZnkuc3VjY2Vzcyh7XHJcbiAgICAgICAgICAgICAgdGl0bGU6ICfns7vnu5/mj5DnpLonLCBtc2c6ICflj5HluIPmiJDlip8nLCB0aW1lb3V0OiAzMDAwXHJcbiAgICAgICAgICAgIH0gYXMgTm90aWZ5T3B0aW9ucyk7XHJcbiAgICAgICAgICAgIGNvbnN0IHByb2Nlc3MgPSBKU09OLnBhcnNlKHRoaXMudWlTdGF0ZS5jb250ZW50KTtcclxuICAgICAgICAgICAgdGhpcy52aWV3TW9kZWwuYXVkaXRQcm9jZXNzRGVmKEF1ZGl0RXZlbnQuV0ZfUHJvY2Vzc0RlZl9EZXBsb3ksIHRydWUsIHByb2Nlc3MuRGVmYXVsdFByb2Nlc3MuS2V5KTtcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIChlcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpID0+IHtcclxuICAgICAgICAgICAgICB0aGlzLmNsb3NlTG9hZGluZygpO1xyXG4gICAgICAgICAgICAgIHRoaXMubm90aWZ5LmVycm9yKHtcclxuICAgICAgICAgICAgICAgIHRpdGxlOiAn57O757uf5o+Q56S6JywgbXNnOiAn5Y+R5biD5aSx6LSl77yM6K+35qOA5p+l5rWB56iL5piv5ZCm5q2j56Gu77yBJywgdGltZW91dDogMzAwMFxyXG4gICAgICAgICAgICAgIH0gYXMgTm90aWZ5T3B0aW9ucyk7XHJcbiAgICAgICAgICAgICAgY29uc3QgcHJvY2VzcyA9IEpTT04ucGFyc2UodGhpcy51aVN0YXRlLmNvbnRlbnQpO1xyXG4gICAgICAgICAgICAgIHRoaXMudmlld01vZGVsLmF1ZGl0UHJvY2Vzc0RlZihBdWRpdEV2ZW50LldGX1Byb2Nlc3NEZWZfRGVwbG95LCBmYWxzZSwgcHJvY2Vzcy5EZWZhdWx0UHJvY2Vzcy5LZXkpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgUmVzb3VyY2VLZXlzLndmX3NhdmVBczpcclxuICAgICAgICAgIGNvbnN0IHByY29lc3MgPSBwb3N0RGF0YS5kYXRhO1xyXG4gICAgICAgICAgdGhpcy52aWV3TW9kZWwuc2F2ZUFzUHJvY2VzcyhwcmNvZXNzLCB0aGlzLnByb2Nlc3NJbmZvKTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgUmVzb3VyY2VLZXlzLndmX3N5bmM6XHJcbiAgICAgICAgICBjb25zdCBjb250ZW50ID0gcG9zdERhdGEuZGF0YTtcclxuICAgICAgICAgIHRoaXMudmlld01vZGVsLnN5bmNEdFByb2Nlc3MoY29udGVudCwgdGhpcy5ydFByb2Nlc3NJbmZvKTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgUmVzb3VyY2VLZXlzLndmX25vdGU6XHJcbiAgICAgICAgICB0aGlzLm5vdGUocG9zdERhdGEuZGF0YSk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIFJlc291cmNlS2V5cy53Zl9jbG9zZURlc2lnbmVyOlxyXG4gICAgICAgICAgdGhpcy5jbG9zZS5lbWl0KCk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIFJlc291cmNlS2V5cy5nZXRBY3Rpdml0aWVzOiAvLyDojrflj5bmtLvliqjoioLngrnkv6Hmga9cclxuICAgICAgICAgIHRoaXMudWlTdGF0ZS5nZXRVc2VyQWN0TGlzdChwb3N0RGF0YS5kYXRhKTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgUmVzb3VyY2VLZXlzLmdldEVuZEV2ZW50czogLy8g6I635Y+W5omA5pyJ57uT5p2f6IqC54K55L+h5oGvXHJcbiAgICAgICAgICB0aGlzLnVpU3RhdGUuZ2V0RW5kRXZlbnRMaXN0KHBvc3REYXRhLmRhdGEpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnbG9hZGVkJzpcclxuICAgICAgICAgIHRoaXMub3BlblByb2NDb250ZW50KCk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIFJlc291cmNlS2V5cy53Zl9zaG93VGlwOlxyXG4gICAgICAgICAgdGhpcy5zaG93VGlwKHBvc3REYXRhLmRhdGEpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgIHRoaXMudmlld01vZGVsLnNldFByb3BlcnR5KHBvc3REYXRhLmRhdGEpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgdXBkYXRlUHJvcGVydHkoKTogYm9vbGVhbiB7XHJcbiAgICB0aGlzLnByb3BlcnR5UGFuZWwucHJvcGVydHlDaGFuZ2VkLnN1YnNjcmliZSgoZGF0YTogYW55KSA9PiB7XHJcbiAgICAgIHRoaXMudXBkYXRlQ2hhbmdlUHJvcGVydHkoZGF0YSk7XHJcbiAgICB9KTtcclxuICAgIHRoaXMucHJvcGVydHlQYW5lbC5zdWJtaXRNb2RhbC5zdWJzY3JpYmUoKGRhdGE6IGFueSkgPT4ge1xyXG4gICAgICB0aGlzLnVwZGF0ZUNoYW5nZVByb3BlcnR5KGRhdGEuY2hhbmdlT2JqZWN0KTtcclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiBmYWxzZTsgLy8g6Ziy5q2i5YaS5rOhXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmm7TmlrDlsZ7mgKdcclxuICAgKi9cclxuICBwcml2YXRlIHVwZGF0ZUNoYW5nZVByb3BlcnR5KGRhdGEpOiBhbnkge1xyXG4gICAgZGF0YS5JZCA9IHRoaXMudWlTdGF0ZS5wcm9wZXJ0eURhdGEuSWQ7XHJcbiAgICBzd2l0Y2ggKGRhdGEucHJvcGVydHlJRCkge1xyXG4gICAgICBjYXNlIFJlc291cmNlS2V5cy5FbnRyeUZvcm06XHJcbiAgICAgICAgdGhpcy5iaW5kRW50cnlGb3JtSW5mbyhkYXRhKTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSBSZXNvdXJjZUtleXMuQXBwcm92YWxJdGVtczpcclxuICAgICAgICB0aGlzLnNlbmRNZXNzYWdlKFJlc291cmNlS2V5cy51cGRhdGVQcm9wZXJ0eSwgSlNPTi5zdHJpbmdpZnkoZGF0YSkpO1xyXG4gICAgICAgIHRoaXMuYWN0aXZpdHkuYnVpbGRDb3VudGVyU2lnblZhcmlhYmxlcyhkYXRhLnByb3BlcnR5VmFsdWUpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlIFJlc291cmNlS2V5cy5Db21wbGV0ZVN0cmF0ZWd5OlxyXG4gICAgICAgIHRoaXMuYmVmb3JlQ29tcGxldGVTdHJhdGVneUNoYW5nZShkYXRhKS5zdWJzY3JpYmUoYiA9PiB7XHJcbiAgICAgICAgICBpZiAoYikge1xyXG4gICAgICAgICAgICB0aGlzLnNlbmRNZXNzYWdlKFJlc291cmNlS2V5cy51cGRhdGVQcm9wZXJ0eSwgSlNPTi5zdHJpbmdpZnkoZGF0YSkpO1xyXG4gICAgICAgICAgICB0aGlzLmNvbXBsZXRlU3RyYXRlZ3lDaGFuZ2VkKGRhdGEucHJvcGVydHlWYWx1ZSk7XHJcbiAgICAgICAgICB9IGVsc2UgeyAvLyDliLfmlrDlsZ7mgKfmoYZcclxuICAgICAgICAgICAgdGhpcy5zZW5kTWVzc2FnZShSZXNvdXJjZUtleXMucmVmcmVzaCwgSlNPTi5zdHJpbmdpZnkoZGF0YSkpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlIFJlc291cmNlS2V5cy5TaWduUnVsZTpcclxuICAgICAgICB0aGlzLnNlbmRNZXNzYWdlKFJlc291cmNlS2V5cy51cGRhdGVQcm9wZXJ0eSwgSlNPTi5zdHJpbmdpZnkoZGF0YSkpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBkZWZhdWx0OlxyXG4gICAgICAgIHRoaXMuc2VuZE1lc3NhZ2UoUmVzb3VyY2VLZXlzLnVwZGF0ZVByb3BlcnR5LCBKU09OLnN0cmluZ2lmeShkYXRhKSk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDnu5HlrprmtYHnqIvliIbnsbvnmoTlj4LmlbDliJfooajvvIzmtYHnqIvmnoTku7bvvIzooajljZXotYvlgLxcclxuICAgKiBAcGFyYW0gZGF0YVxyXG4gICAqL1xyXG4gIHByaXZhdGUgYmluZEVudHJ5Rm9ybUluZm8oZGF0YSkge1xyXG4gICAgY29uc3QgZmxvd2Zvcm1JZDogc3RyaW5nID0gZGF0YS5wcm9wZXJ0eVZhbHVlLmlkO1xyXG4gICAgaWYgKGZsb3dmb3JtSWQpIHtcclxuICAgICAgdGhpcy52aWV3TW9kZWwuZ2V0Rmxvd0Zvcm1JbmZvQnlJZChmbG93Zm9ybUlkKS5zdWJzY3JpYmUoKGluZm86IEZsb3dGb3JtSW5mbykgPT4ge1xyXG4gICAgICAgIGRhdGEuZmxvd0Zvcm0gPSBpbmZvLmZsb3dGb3JtO1xyXG4gICAgICAgIGRhdGEuZm9ybWFsUGFyYW1ldGVycyA9IGluZm8uZm9ybWFsUGFyYW1ldGVycztcclxuICAgICAgICBkYXRhLnByb2Nlc3NCaXpDb21wb25uZXRzID0gaW5mby5iaXpDb21wb25lbnRzO1xyXG4gICAgICAgIGRhdGEuZXhlY3V0ZUZvcm1zID0gW107XHJcbiAgICAgICAgaW5mby5leGN1dGVGb3Jtcy5mb3JFYWNoKGZvcm0gPT4ge1xyXG4gICAgICAgICAgaWYgKGZvcm0uaXNEZWZhdWx0KSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGV4ZWN1dGVGb3JtcyA9IHRoaXMuQ29udmVydEV4ZWN1dGVGb3JtKGZvcm0pO1xyXG4gICAgICAgICAgICBkYXRhLmV4ZWN1dGVGb3JtcyA9IGRhdGEuZXhlY3V0ZUZvcm1zLmNvbmNhdChleGVjdXRlRm9ybXMpOyAvLyDmtYHnqIvnu5Hlrprpu5jorqTljZXmja5cclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICBkYXRhLmN1c3RvbWl6ZUFjdGlvbnMgPSBpbmZvLmN1c3RvbWl6ZUFjdGlvbnMuZmlsdGVyKGEgPT4gYS5pc0FsbCA9PT0gdHJ1ZSkubWFwKGEgPT4gKHtcclxuICAgICAgICAgIGlkOiBhLmlkLCBjb2RlOiBhLmNvZGUsIG5hbWU6IGEubmFtZSwgdGVybWluYWxUeXBlOiBhLnRlcm1pbmFsLFxyXG4gICAgICAgICAgYWN0dWFsUGFyYW1ldGVyczogYS5hY3R1YWxQYXJhbWV0ZXJzLm1hcChwID0+ICh7XHJcbiAgICAgICAgICAgIE5hbWU6IHAuY29kZSwgVmFsdWU6IHAudmFsdWUsIFZhbHVlVGV4dDogcC5uYW1lLCBUYWc6ICdleHByZXNzaW9uJ1xyXG4gICAgICAgICAgfSkpXHJcbiAgICAgICAgfSkpO1xyXG4gICAgICAgIHRoaXMuc2VuZE1lc3NhZ2UoUmVzb3VyY2VLZXlzLmxvYWRCaXpBY3Rpdml0eSwgaW5mby5iaXpBY3Rpdml0aWVzIHx8IFtdKTtcclxuICAgICAgICB0aGlzLnNlbmRNZXNzYWdlKFJlc291cmNlS2V5cy51cGRhdGVQcm9wZXJ0eSwgSlNPTi5zdHJpbmdpZnkoZGF0YSkpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgbm90ZShyZWNvcmQ6IHN0cmluZykge1xyXG4gICAgY29uc3QgY29tcEZhY3RvcnkgPSB0aGlzLnJlc29sdmVyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KE5vdGVDb21wb25lbnQpO1xyXG4gICAgY29uc3QgY29tcFJlZiA9IGNvbXBGYWN0b3J5LmNyZWF0ZSh0aGlzLmluamVjdG9yKTtcclxuXHJcbiAgICBjb21wUmVmLmluc3RhbmNlLnJlY29yZCA9IHJlY29yZDtcclxuXHJcbiAgICBjb25zdCBtb2RhbENvbmZpZzogTW9kYWxPcHRpb25zID0ge1xyXG4gICAgICB0aXRsZTogJ+a1geeoi+WPmOabtOiusOW9lScsXHJcbiAgICAgIHdpZHRoOiA4MDAsXHJcbiAgICAgIGhlaWdodDogNTIwLFxyXG4gICAgICBzaG93QnV0dG9uczogdHJ1ZSxcclxuICAgICAgYnV0dG9uczogY29tcFJlZi5pbnN0YW5jZS5mb290ZXJcclxuICAgIH07XHJcbiAgICBjb25zdCBkaWFsb2cgPSB0aGlzLm1vZGFsU2VydmljZS5zaG93KGNvbXBSZWYsIG1vZGFsQ29uZmlnKTtcclxuICAgIGNvbXBSZWYuaW5zdGFuY2UuY2FuY2VsLnN1YnNjcmliZSgkZXZlbnQgPT4gZGlhbG9nLmNsb3NlKCkpO1xyXG4gICAgY29tcFJlZi5pbnN0YW5jZS5zdWJtaXQuc3Vic2NyaWJlKChkYXRhOiBzdHJpbmcpID0+IHtcclxuICAgICAgdGhpcy5zZW5kTWVzc2FnZShSZXNvdXJjZUtleXMud2Zfbm90ZSwgZGF0YSk7XHJcbiAgICAgIGRpYWxvZy5jbG9zZSgpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIG9wZW5Qcm9jQ29udGVudCgpIHtcclxuICAgIGlmICh0aGlzLnRpbWUgPT09IFByb2Nlc3NUaW1lLmR0KSB7XHJcbiAgICAgIGlmICh0aGlzLnByb2Nlc3NJbmZvKSB7XHJcbiAgICAgICAgaWYgKHRoaXMucHJvY2Vzc0luZm8ucHJvY2Vzc0tleSA9PT0gUmVzb3VyY2VLZXlzLm5ldyAmJiB0aGlzLnByb2Nlc3NJbmZvLmZsb3dGb3JtSWQpIHtcclxuICAgICAgICAgIHRoaXMub3Blbk5ld1Byb2Nlc3ModGhpcy5wcm9jZXNzSW5mby5mbG93Rm9ybUlkKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgLy8gVE9ET++8mummluWFiOiOt+WPlua1geeoi+WIhuexu+S/oeaBr++8jOehruS/nea1geeoi+WIhuexu+WSjOa1geeoi+aehOS7tuiOt+WPluWIsO+8iOS8mueojeW+ruW9seWTjeiuvuiuoeWZqOaJk+W8gOmAn+W6pu+8iVxyXG4gICAgICAgICAgdGhpcy52aWV3TW9kZWwuZ2V0Rmxvd0Zvcm1JbmZvQnlJZCh0aGlzLnByb2Nlc3NJbmZvLmZsb3dGb3JtSWQpLnN1YnNjcmliZSgoaW5mbzogRmxvd0Zvcm1JbmZvKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuc2VuZE1lc3NhZ2UoUmVzb3VyY2VLZXlzLmxvYWRCaXpBY3Rpdml0eSwgaW5mby5iaXpBY3Rpdml0aWVzIHx8IFtdKTtcclxuICAgICAgICAgICAgdGhpcy5nZXRQcm9jQ29udGVudCh0aGlzLnByb2Nlc3NJbmZvLnByb2Nlc3NLZXkpLnN1YnNjcmliZShyZSA9PiB7XHJcbiAgICAgICAgICAgICAgdGhpcy51aVN0YXRlLmNvbnRlbnQgPSB0aGlzLmNoZWNrTW9kZWxDb250ZW50KEpTT04uc3RyaW5naWZ5KHJlKSk7XHJcbiAgICAgICAgICAgICAgdGhpcy5zZW5kTWVzc2FnZShSZXNvdXJjZUtleXMub3Blbiwge1xyXG4gICAgICAgICAgICAgICAgY29udGVudDogdGhpcy51aVN0YXRlLmNvbnRlbnRcclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCfkuI3lrZjlnKjorr7orqHml7bmtYHnqIvkv6Hmga/vvIHor7flhYjotYvlgLzvvIEnKTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIGlmICh0aGlzLnRpbWUgPT09IFByb2Nlc3NUaW1lLnJ0KSB7XHJcbiAgICAgIGlmICh0aGlzLnJ0UHJvY2Vzc0luZm8pIHtcclxuICAgICAgICB0aGlzLnZpZXdNb2RlbC5nZXRGbG93Rm9ybUluZm9CeUlkKHRoaXMucnRQcm9jZXNzSW5mby5mbG93Rm9ybUlkKS5zdWJzY3JpYmUoKGluZm86IEZsb3dGb3JtSW5mbykgPT4ge1xyXG4gICAgICAgICAgdGhpcy5zZW5kTWVzc2FnZShSZXNvdXJjZUtleXMubG9hZEJpekFjdGl2aXR5LCBpbmZvLmJpekFjdGl2aXRpZXMgfHwgW10pO1xyXG4gICAgICAgICAgdGhpcy5nZXRQcm9jQ29udGVudCh0aGlzLnJ0UHJvY2Vzc0luZm8ucnRQcm9jRGVmSWQpLnN1YnNjcmliZShyZSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMudWlTdGF0ZS5jb250ZW50ID0gdGhpcy5jaGVja01vZGVsQ29udGVudChKU09OLnN0cmluZ2lmeShyZSkpO1xyXG4gICAgICAgICAgICB0aGlzLnNlbmRNZXNzYWdlKFJlc291cmNlS2V5cy5vcGVuLCB7XHJcbiAgICAgICAgICAgICAgY29udGVudDogdGhpcy51aVN0YXRlLmNvbnRlbnRcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ+S4jeWtmOWcqOi/kOihjOaXtua1geeoi+S/oeaBr++8geivt+WFiOi1i+WAvO+8gScpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmlrDlop7mtYHnqIvvvIzln7rkuo7mtYHnqIvliIbnsbvojrflj5blj4LmlbDliJfooajvvIzmnoTku7blkozooajljZVcclxuICAgKiBAcGFyYW0gZmZJZCDmtYHnqIvliIbnsbtJRFxyXG4gICAqL1xyXG4gIHByaXZhdGUgb3Blbk5ld1Byb2Nlc3MoZmZJZDogc3RyaW5nKSB7XHJcbiAgICB0aGlzLnZpZXdNb2RlbC5nZXRGbG93Rm9ybUluZm9CeUlkKGZmSWQpXHJcbiAgICAgIC5zdWJzY3JpYmUoKGluZm86IEZsb3dGb3JtSW5mbykgPT4ge1xyXG4gICAgICAgIGNvbnN0IHByb2Nlc3NCaXpDb21wb25uZXRzOiBCaXpDb21wb25lbnRFbnRpdHlbXSA9IGluZm8uYml6Q29tcG9uZW50cztcclxuICAgICAgICBjb25zdCBjdXN0b21pemVBY3Rpb25zID0gaW5mby5jdXN0b21pemVBY3Rpb25zLmZpbHRlcihhID0+IGEuaXNBbGwgPT09IHRydWUpLm1hcChhID0+ICh7XHJcbiAgICAgICAgICBpZDogYS5pZCwgY29kZTogYS5jb2RlLCBuYW1lOiBhLm5hbWUsIHRlcm1pbmFsVHlwZTogYS50ZXJtaW5hbCxcclxuICAgICAgICAgIGFjdHVhbFBhcmFtZXRlcnM6IGEuYWN0dWFsUGFyYW1ldGVycy5tYXAocCA9PiAoe1xyXG4gICAgICAgICAgICBOYW1lOiBwLmNvZGUsIFZhbHVlOiBwLnZhbHVlLCBWYWx1ZVRleHQ6IHAubmFtZSwgVGFnOiAnZXhwcmVzc2lvbidcclxuICAgICAgICAgIH0pKVxyXG4gICAgICAgIH0pKTtcclxuICAgICAgICBsZXQgZXhlY3V0ZUZvcm1zOiBFeGVjdXRlRm9ybU1vZGVsW10gPSBbXTtcclxuICAgICAgICBpbmZvLmV4Y3V0ZUZvcm1zLmZvckVhY2goZm9ybSA9PiB7XHJcbiAgICAgICAgICBpZiAoZm9ybS5pc0RlZmF1bHQpIHtcclxuICAgICAgICAgICAgY29uc3QgZm9ybXMgPSB0aGlzLkNvbnZlcnRFeGVjdXRlRm9ybShmb3JtKTtcclxuICAgICAgICAgICAgZXhlY3V0ZUZvcm1zID0gZXhlY3V0ZUZvcm1zLmNvbmNhdChmb3Jtcyk7IC8vIOa1geeoi+e7keWumum7mOiupOWNleaNrlxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIC8vIOWmguaenOS4jeWtmOWcqOihqOWNleWumuS5ie+8jOmcgOimgeWOu+ihqOWNleagvOW8j+WIl+ihqOWPluS4gOS4i1xyXG4gICAgICAgIGlmIChleGVjdXRlRm9ybXMubGVuZ3RoID09PSAwXHJcbiAgICAgICAgICB8fCBleGVjdXRlRm9ybXMuZmluZEluZGV4KGUgPT4gZS5UZXJtaW5hbFR5cGUgPT09IFRlcm1pbmFsVHlwZS5QQykgPT09IC0xXHJcbiAgICAgICAgICB8fCBleGVjdXRlRm9ybXMuZmluZEluZGV4KGUgPT4gZS5UZXJtaW5hbFR5cGUgPT09IFRlcm1pbmFsVHlwZS5NT0JJTEUpID09PSAtMSkge1xyXG4gICAgICAgICAgdGhpcy52aWV3TW9kZWwuZ2V0Rm9ybUZvcm1hdHNCeUJpekNhdGVnb3J5KCkuc3Vic2NyaWJlKChmb3JtRm9ybWF0czogYW55W10pID0+IHtcclxuICAgICAgICAgICAgaWYgKGZvcm1Gb3JtYXRzICYmIGZvcm1Gb3JtYXRzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICBpZiAoZXhlY3V0ZUZvcm1zLmZpbmRJbmRleChlID0+IGUuVGVybWluYWxUeXBlID09PSBUZXJtaW5hbFR5cGUuUEMpID09PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZm9ybUZvcm1hdCA9IGZvcm1Gb3JtYXRzLmZpbHRlcihmID0+IGYudGVybWluYWwgPT09ICdQQycgJiYgZi5zdGF0dXMgPT09IDApWzBdO1xyXG4gICAgICAgICAgICAgICAgaWYgKGZvcm1Gb3JtYXQpIHtcclxuICAgICAgICAgICAgICAgICAgZXhlY3V0ZUZvcm1zLnB1c2godGhpcy5mb3JtRm9ybWF0MkV4ZWN1dGVGb3JtKGZvcm1Gb3JtYXQpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgaWYgKGV4ZWN1dGVGb3Jtcy5maW5kSW5kZXgoZSA9PiBlLlRlcm1pbmFsVHlwZSA9PT0gVGVybWluYWxUeXBlLk1PQklMRSkgPT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBmb3JtRm9ybWF0ID0gZm9ybUZvcm1hdHMuZmlsdGVyKGYgPT4gZi50ZXJtaW5hbCA9PT0gJ01vYmlsZScgJiYgZi5zdGF0dXMgPT09IDApWzBdO1xyXG4gICAgICAgICAgICAgICAgaWYgKGZvcm1Gb3JtYXQpIHtcclxuICAgICAgICAgICAgICAgICAgZXhlY3V0ZUZvcm1zLnB1c2godGhpcy5mb3JtRm9ybWF0MkV4ZWN1dGVGb3JtKGZvcm1Gb3JtYXQpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5zZW5kTWVzc2FnZShSZXNvdXJjZUtleXMubG9hZEJpekFjdGl2aXR5LCBpbmZvLmJpekFjdGl2aXRpZXMgfHwgW10pO1xyXG4gICAgICAgICAgICB0aGlzLnNlbmRNZXNzYWdlKFJlc291cmNlS2V5cy5uZXcsIHtcclxuICAgICAgICAgICAgICBuYW1lOiB0aGlzLnByb2Nlc3NJbmZvLnByb2Nlc3NOYW1lLFxyXG4gICAgICAgICAgICAgIGJpek9iaklkOiB0aGlzLnByb2Nlc3NJbmZvLmJpek9iaklkLFxyXG4gICAgICAgICAgICAgIGZmSWQsXHJcbiAgICAgICAgICAgICAgZmZOYW1lOiB0aGlzLnByb2Nlc3NJbmZvLmZsb3dGb3JtTmFtZSxcclxuICAgICAgICAgICAgICBzdGFydE1vZGU6IHRoaXMucHJvY2Vzc0luZm8uc3RhcnRNb2RlLFxyXG4gICAgICAgICAgICAgIGZvcm1hbFBhcmFtZXRlcnM6IGluZm8uZm9ybWFsUGFyYW1ldGVycyxcclxuICAgICAgICAgICAgICBwcm9jZXNzQml6Q29tcG9ubmV0cyxcclxuICAgICAgICAgICAgICBleGVjdXRlRm9ybXMsXHJcbiAgICAgICAgICAgICAgY3VzdG9taXplQWN0aW9ucyxcclxuICAgICAgICAgICAgICBwcm9jZXNzRGVzY3JpcHRpb246IGluZm8uZmxvd0Zvcm0ucHJvY2Vzc0Rlc2NyaXB0aW9uXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRoaXMuc2VuZE1lc3NhZ2UoUmVzb3VyY2VLZXlzLmxvYWRCaXpBY3Rpdml0eSwgaW5mby5iaXpBY3Rpdml0aWVzIHx8IFtdKTtcclxuICAgICAgICAgIHRoaXMuc2VuZE1lc3NhZ2UoUmVzb3VyY2VLZXlzLm5ldywge1xyXG4gICAgICAgICAgICBuYW1lOiB0aGlzLnByb2Nlc3NJbmZvLnByb2Nlc3NOYW1lLFxyXG4gICAgICAgICAgICBiaXpPYmpJZDogdGhpcy5wcm9jZXNzSW5mby5iaXpPYmpJZCxcclxuICAgICAgICAgICAgZmZJZCxcclxuICAgICAgICAgICAgZmZOYW1lOiB0aGlzLnByb2Nlc3NJbmZvLmZsb3dGb3JtTmFtZSxcclxuICAgICAgICAgICAgc3RhcnRNb2RlOiB0aGlzLnByb2Nlc3NJbmZvLnN0YXJ0TW9kZSxcclxuICAgICAgICAgICAgZm9ybWFsUGFyYW1ldGVyczogaW5mby5mb3JtYWxQYXJhbWV0ZXJzLFxyXG4gICAgICAgICAgICBwcm9jZXNzQml6Q29tcG9ubmV0cyxcclxuICAgICAgICAgICAgZXhlY3V0ZUZvcm1zLFxyXG4gICAgICAgICAgICBjdXN0b21pemVBY3Rpb25zLFxyXG4gICAgICAgICAgICBwcm9jZXNzRGVzY3JpcHRpb246IGluZm8uZmxvd0Zvcm0ucHJvY2Vzc0Rlc2NyaXB0aW9uXHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLy8g5ZCR5a2Q6aG16Z2i5Y+R6YCB5raI5oGvXHJcbiAgcHJpdmF0ZSBzZW5kTWVzc2FnZShhY3Rpb246IHN0cmluZywgZGF0YTogYW55KTogdm9pZCB7XHJcbiAgICBjb25zdCBpZnJhbWVXaW5kb3cgPSB0aGlzLmlmcmFtZS5uYXRpdmVFbGVtZW50LmNvbnRlbnRXaW5kb3c7XHJcbiAgICBjb25zdCBtZXNzYWdlID0gdGhpcy53cmFwTWVzc2FnZShhY3Rpb24sIGRhdGEpO1xyXG4gICAgaWZyYW1lV2luZG93LnBvc3RNZXNzYWdlKG1lc3NhZ2UsIHRoaXMudWlTdGF0ZS5QT1NUX01FU1NBR0VfVEFSR0VUKTtcclxuICB9XHJcblxyXG4gIC8vIOWMheijhea2iOaBr+WGheWuuVxyXG4gIHByaXZhdGUgd3JhcE1lc3NhZ2UoYWN0aW9uOiBzdHJpbmcsIGRhdGE6IGFueSkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgYWN0aW9uLFxyXG4gICAgICBkYXRhXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBzaG93VGlwKGRhdGE6IGFueSkge1xyXG4gICAgaWYgKGRhdGEudHlwZSA9PT0gJ21lc3NhZ2UnKSB7XHJcbiAgICAgIHN3aXRjaCAoZGF0YS5sZXZlbCkge1xyXG4gICAgICAgIGNhc2UgJ3dhcm5pbmcnOlxyXG4gICAgICAgICAgdGhpcy5tZXNzYWdlLndhcm5pbmcoZGF0YS5tZXNzYWdlKTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ2Vycm9yJzpcclxuICAgICAgICAgIHRoaXMubWVzc2FnZS5lcnJvcihkYXRhLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgIHRoaXMubWVzc2FnZS5pbmZvKGRhdGEubWVzc2FnZSk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIGlmIChkYXRhLnR5cGUgPT09ICdub3RpZnknKSB7XHJcbiAgICAgIHN3aXRjaCAoZGF0YS5sZXZlbCkge1xyXG4gICAgICAgIGNhc2UgJ3dhcm5pbmcnOlxyXG4gICAgICAgICAgdGhpcy5ub3RpZnkud2FybmluZyhkYXRhLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnZXJyb3InOlxyXG4gICAgICAgICAgdGhpcy5ub3RpZnkuZXJyb3IoZGF0YS5tZXNzYWdlKTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICB0aGlzLm5vdGlmeS5pbmZvKGRhdGEubWVzc2FnZSk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+W5rWB56iL5LiK5LiL5paHXHJcbiAgICogQHBhcmFtIGlkIOa1geeoi+WumuS5iUlE77yI6K6+6K6h5pe25L2/55So5rWB56iL5a6a5LmJS2V577yM6L+Q6KGM5pe25L2/55So5rWB56iL5a6a5LmJSUTvvIlcclxuICAgKi9cclxuICBnZXRQcm9jQ29udGVudChpZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGlmIChpZCkge1xyXG4gICAgICBpZiAodGhpcy50aW1lID09PSBQcm9jZXNzVGltZS5kdCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnNlcnZpY2UuZ2V0UHJvY0NvbnRlbnRieUtleShpZCk7XHJcbiAgICAgIH0gZWxzZSBpZiAodGhpcy50aW1lID09PSBQcm9jZXNzVGltZS5ydCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnNlcnZpY2UuZ2V0UlRQcm9jQ29udGVudGJ5SWQoaWQpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcign6K6+6K6h5Zmo6L+Q6KGM5pe25py66ZSZ6K+v77yBJyk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgc2F2ZSgpIHtcclxuICAgIGNvbnN0IHByb2Nlc3MgPSBKU09OLnBhcnNlKHRoaXMudWlTdGF0ZS5jb250ZW50KTtcclxuICAgIC8vIHRoaXMudWlTdGF0ZS5jb250ZW50ID0gdGhpcy5jaGVja01vZGVsQ29udGVudCh0aGlzLnVpU3RhdGUuY29udGVudCk7XHJcbiAgICB0aGlzLnNhdmVIdHRwKCkuc3Vic2NyaWJlKChkYXRhKSA9PiB7XHJcbiAgICAgIHRoaXMuY2xvc2VMb2FkaW5nKCk7XHJcbiAgICAgIHRoaXMubm90aWZ5LnN1Y2Nlc3Moe1xyXG4gICAgICAgIHRpdGxlOiAn57O757uf5o+Q56S6JywgbXNnOiAn5L+d5a2Y5oiQ5YqfJywgdGltZW91dDogMzAwMFxyXG4gICAgICB9IGFzIE5vdGlmeU9wdGlvbnMpO1xyXG4gICAgICBpZiAodGhpcy50aW1lID09PSBQcm9jZXNzVGltZS5kdCkge1xyXG4gICAgICAgIHRoaXMudmlld01vZGVsLmF1ZGl0UHJvY2Vzc0RlZihBdWRpdEV2ZW50LldGX1Byb2Nlc3NEZWZfU2F2ZURULCB0cnVlLCBwcm9jZXNzLkRlZmF1bHRQcm9jZXNzLktleSk7XHJcbiAgICAgIH0gZWxzZSBpZiAodGhpcy50aW1lID09PSBQcm9jZXNzVGltZS5ydCkge1xyXG4gICAgICAgIHRoaXMudmlld01vZGVsLmF1ZGl0UHJvY2Vzc0RlZihBdWRpdEV2ZW50LldGX1Byb2Nlc3NEZWZfU2F2ZVJULCB0cnVlLCBwcm9jZXNzLkRlZmF1bHRQcm9jZXNzLktleSk7XHJcbiAgICAgIH1cclxuICAgIH0sXHJcbiAgICAgIChlcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpID0+IHtcclxuICAgICAgICB0aGlzLmNsb3NlTG9hZGluZygpO1xyXG4gICAgICAgIHRoaXMubm90aWZ5LmVycm9yKHtcclxuICAgICAgICAgIHRpdGxlOiAn57O757uf5o+Q56S6JywgbXNnOiAn5L+d5a2Y5aSx6LSl77yM6K+35qOA5p+l5rWB56iL5piv5ZCm5q2j56Gu77yBJywgdGltZW91dDogMzAwMFxyXG4gICAgICAgIH0gYXMgTm90aWZ5T3B0aW9ucyk7XHJcbiAgICAgICAgaWYgKHRoaXMudGltZSA9PT0gUHJvY2Vzc1RpbWUuZHQpIHtcclxuICAgICAgICAgIHRoaXMudmlld01vZGVsLmF1ZGl0UHJvY2Vzc0RlZihBdWRpdEV2ZW50LldGX1Byb2Nlc3NEZWZfU2F2ZURULCBmYWxzZSwgcHJvY2Vzcy5EZWZhdWx0UHJvY2Vzcy5LZXkpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy50aW1lID09PSBQcm9jZXNzVGltZS5ydCkge1xyXG4gICAgICAgICAgdGhpcy52aWV3TW9kZWwuYXVkaXRQcm9jZXNzRGVmKEF1ZGl0RXZlbnQuV0ZfUHJvY2Vzc0RlZl9TYXZlUlQsIGZhbHNlLCBwcm9jZXNzLkRlZmF1bHRQcm9jZXNzLktleSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOS/neWtmOa1geeoi+WumuS5ie+8iOiuvuiuoeaXtivov5DooYzml7bvvIlcclxuICAgKi9cclxuICBwcml2YXRlIHNhdmVIdHRwKCk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBpZiAodGhpcy51aVN0YXRlLmNvbnRlbnQpIHtcclxuICAgICAgaWYgKHRoaXMudGltZSA9PT0gUHJvY2Vzc1RpbWUuZHQpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy52aWV3TW9kZWwuc2F2ZVByb2Nlc3ModGhpcy51aVN0YXRlLmNvbnRlbnQsIHRoaXMucHJvY2Vzc0luZm8sIDEpO1xyXG4gICAgICB9IGVsc2UgaWYgKHRoaXMudGltZSA9PT0gUHJvY2Vzc1RpbWUucnQpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy52aWV3TW9kZWwuc2F2ZVJUUHJvY2Vzcyh0aGlzLnVpU3RhdGUuY29udGVudCwgdGhpcy5ydFByb2Nlc3NJbmZvLnJ0UHJvY0RlZklkKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ+iuvuiuoeWZqOi/kOihjOaXtuacuumUmeivr++8gScpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBzaG93TG9hZGluZygpIHtcclxuICAgIHRoaXMubG9hZFNlcnZpY2Uuc2hvdyh7IGNvbnRhaW5lcjogJ2JvZHknLCBtZXNzYWdlOiAnJywgdHlwZTogMSB9KTtcclxuICB9XHJcbiAgY2xvc2VMb2FkaW5nKCkge1xyXG4gICAgdGhpcy5sb2FkU2VydmljZS5jbG9zZSgpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBDb252ZXJ0RXhlY3V0ZUZvcm0oZm9ybTogRXhjdXRlRm9ybUVudGl0eSk6IEV4ZWN1dGVGb3JtTW9kZWxbXSB7XHJcbiAgICBjb25zdCBleGVjdXRlRm9ybXMgPSBuZXcgQXJyYXkoKTtcclxuICAgIGlmIChmb3JtLnRlcm1pbmFsID09PSAnd2ViLGFwcCcpIHtcclxuICAgICAgY29uc3Qgd2ViRm9ybSA9IG5ldyBFeGVjdXRlRm9ybU1vZGVsKCk7XHJcbiAgICAgIHdlYkZvcm0uQ29tcG9uZW50SWQgPSBmb3JtLmFwcElkO1xyXG4gICAgICB3ZWJGb3JtLmZvcm1Gb3JtYXRJZCA9IGZvcm0uZm9ybUZvcm1hdElkO1xyXG4gICAgICB3ZWJGb3JtLkZvcm1UeXBlID0gZm9ybS5mb3JtVHlwZTtcclxuICAgICAgd2ViRm9ybS5OYW1lID0gZm9ybS5uYW1lO1xyXG4gICAgICB3ZWJGb3JtLlRlcm1pbmFsVHlwZSA9IFRlcm1pbmFsVHlwZS5QQztcclxuICAgICAgaWYgKGZvcm0uYWN0dWFsUGFyYW1ldGVycyAmJiBmb3JtLmFjdHVhbFBhcmFtZXRlcnMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIHdlYkZvcm0uQWN0dWFsUGFyYW1ldGVycyA9IGZvcm0uYWN0dWFsUGFyYW1ldGVycy5tYXAocCA9PiAoe1xyXG4gICAgICAgICAgTmFtZTogcC5jb2RlLFxyXG4gICAgICAgICAgVmFsdWU6IHAudmFsdWVcclxuICAgICAgICB9KSk7XHJcbiAgICAgIH1cclxuICAgICAgZXhlY3V0ZUZvcm1zLnB1c2god2ViRm9ybSk7XHJcbiAgICAgIGNvbnN0IGFwcEZvcm0gPSBuZXcgRXhlY3V0ZUZvcm1Nb2RlbCgpO1xyXG4gICAgICBhcHBGb3JtLkNvbXBvbmVudElkID0gZm9ybS5hcHBJZDtcclxuICAgICAgYXBwRm9ybS5mb3JtRm9ybWF0SWQgPSBmb3JtLmZvcm1Gb3JtYXRJZDtcclxuICAgICAgYXBwRm9ybS5Gb3JtVHlwZSA9IGZvcm0uZm9ybVR5cGU7XHJcbiAgICAgIGFwcEZvcm0uTmFtZSA9IGZvcm0ubmFtZTtcclxuICAgICAgYXBwRm9ybS5UZXJtaW5hbFR5cGUgPSBUZXJtaW5hbFR5cGUuTU9CSUxFO1xyXG4gICAgICBpZiAoZm9ybS5hY3R1YWxQYXJhbWV0ZXJzICYmIGZvcm0uYWN0dWFsUGFyYW1ldGVycy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgYXBwRm9ybS5BY3R1YWxQYXJhbWV0ZXJzID0gZm9ybS5hY3R1YWxQYXJhbWV0ZXJzLm1hcChwID0+ICh7XHJcbiAgICAgICAgICBOYW1lOiBwLmNvZGUsXHJcbiAgICAgICAgICBWYWx1ZTogcC52YWx1ZVxyXG4gICAgICAgIH0pKTtcclxuICAgICAgfVxyXG4gICAgICBleGVjdXRlRm9ybXMucHVzaChhcHBGb3JtKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnN0IGV4ZWN1dGVGb3JtID0gbmV3IEV4ZWN1dGVGb3JtTW9kZWwoKTtcclxuICAgICAgZXhlY3V0ZUZvcm0uQ29tcG9uZW50SWQgPSBmb3JtLmFwcElkO1xyXG4gICAgICBleGVjdXRlRm9ybS5mb3JtRm9ybWF0SWQgPSBmb3JtLmZvcm1Gb3JtYXRJZDtcclxuICAgICAgZXhlY3V0ZUZvcm0uRm9ybVR5cGUgPSBmb3JtLmZvcm1UeXBlO1xyXG4gICAgICBleGVjdXRlRm9ybS5OYW1lID0gZm9ybS5uYW1lO1xyXG4gICAgICBzd2l0Y2ggKGZvcm0udGVybWluYWwpIHtcclxuICAgICAgICBjYXNlICd3ZWInOlxyXG4gICAgICAgICAgZXhlY3V0ZUZvcm0uVGVybWluYWxUeXBlID0gVGVybWluYWxUeXBlLlBDO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnYXBwJzpcclxuICAgICAgICAgIGV4ZWN1dGVGb3JtLlRlcm1pbmFsVHlwZSA9IFRlcm1pbmFsVHlwZS5NT0JJTEU7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgICBpZiAoZm9ybS5hY3R1YWxQYXJhbWV0ZXJzICYmIGZvcm0uYWN0dWFsUGFyYW1ldGVycy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgZXhlY3V0ZUZvcm0uQWN0dWFsUGFyYW1ldGVycyA9IGZvcm0uYWN0dWFsUGFyYW1ldGVycy5tYXAocCA9PiAoe1xyXG4gICAgICAgICAgTmFtZTogcC5jb2RlLFxyXG4gICAgICAgICAgVmFsdWU6IHAudmFsdWVcclxuICAgICAgICB9KSk7XHJcbiAgICAgIH1cclxuICAgICAgZXhlY3V0ZUZvcm1zLnB1c2goZXhlY3V0ZUZvcm0pO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGV4ZWN1dGVGb3JtcztcclxuICB9XHJcbiAgcHJpdmF0ZSBmb3JtRm9ybWF0MkV4ZWN1dGVGb3JtKGZvcm1mb3JtYXQpOiBFeGVjdXRlRm9ybU1vZGVsIHtcclxuICAgIGNvbnN0IGZvcm0gPSBuZXcgRXhlY3V0ZUZvcm1Nb2RlbCgpO1xyXG4gICAgZm9ybS5JZCA9IFByb2Nlc3NEZVV0aWwuR2VuZXJhdGVFbGVtZW50SWQoKTtcclxuICAgIGZvcm0uQ29tcG9uZW50SWQgPSBudWxsO1xyXG4gICAgZm9ybS5mb3JtRm9ybWF0SWQgPSBmb3JtZm9ybWF0LmlkO1xyXG4gICAgZm9ybS5Gb3JtVHlwZSA9ICcwJztcclxuICAgIGZvcm0uTmFtZSA9IGZvcm1mb3JtYXQubmFtZTtcclxuICAgIHN3aXRjaCAoZm9ybWZvcm1hdC50ZXJtaW5hbCkge1xyXG4gICAgICBjYXNlICdQQyc6XHJcbiAgICAgICAgZm9ybS5UZXJtaW5hbFR5cGUgPSBUZXJtaW5hbFR5cGUuUEM7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ01vYmlsZSc6XHJcbiAgICAgICAgZm9ybS5UZXJtaW5hbFR5cGUgPSBUZXJtaW5hbFR5cGUuTU9CSUxFO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgfVxyXG4gICAgaWYgKGZvcm1mb3JtYXQudXJsUGFyYW1ldGVycyAmJiBmb3JtZm9ybWF0LnVybFBhcmFtZXRlcnMubGVuZ3RoID4gMCkge1xyXG4gICAgICBmb3JtLkFjdHVhbFBhcmFtZXRlcnMgPSBmb3JtZm9ybWF0LnVybFBhcmFtZXRlcnMubWFwKHAgPT4gKHtcclxuICAgICAgICBOYW1lOiBwLmNvZGUsXHJcbiAgICAgICAgVmFsdWU6IHAudmFsdWVcclxuICAgICAgfSkpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZvcm07XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGNvbXBsZXRlU3RyYXRlZ3lDaGFuZ2VkKHN0cmF0ZWd5OiBzdHJpbmcpIHtcclxuXHJcbiAgICBpZiAoc3RyYXRlZ3kgIT09IHRoaXMudWlTdGF0ZS5jb21wbGV0ZUl0ZXJhdG9yWzBdLmtleSkge1xyXG5cclxuICAgICAgLy8g5Y+C5LiO6ICF5a2Y5Zyo6Ieq5Yqo5a6h5om555qE5oOF5Ya15LiL77yM5LiN5YWB6K645L+u5pS55a6M5oiQ562W55Wl5Li65Lya562+6KeE5YiZXHJcbiAgICAgIC8vIGlmICh0aGlzLnVpU3RhdGUucHJvcGVydHlEYXRhLlBhcnRpY2lwYW50U2NoZW1lc1xyXG4gICAgICAvLyAgICYmIHRoaXMudWlTdGF0ZS5wcm9wZXJ0eURhdGEuUGFydGljaXBhbnRTY2hlbWVzLm9wdGlvbnNcclxuICAgICAgLy8gICAmJiB0aGlzLnVpU3RhdGUucHJvcGVydHlEYXRhLlBhcnRpY2lwYW50U2NoZW1lcy5vcHRpb25zLmF1dG9tYXRpY1BlcmZvcm1lcnNcclxuICAgICAgLy8gICAmJiB0aGlzLnVpU3RhdGUucHJvcGVydHlEYXRhLlBhcnRpY2lwYW50U2NoZW1lcy5vcHRpb25zLmF1dG9tYXRpY1BlcmZvcm1lcnMubGVuZ3RoID4gMCkge1xyXG4gICAgICAvLyAgIHJldHVybjtcclxuICAgICAgLy8gfSBlbHNlIHtcclxuICAgICAgICAvLyDkvJrnrb7op4TliJnkuI3lrZjlnKjvvIzljbPnlLHmiqLljaDmqKHlvI/vvIzlj5jkuLrkvJrnrb7ml7ZcclxuICAgICAgICBpZiAoIXRoaXMudWlTdGF0ZS5wcm9wZXJ0eURhdGEuU2lnblJ1bGUpIHtcclxuICAgICAgICAgIC8vIOS8muetvuaYr+iHquWKqOW8ueWHuuS8muetvuinhOWImee8lui+kVxyXG4gICAgICAgICAgY29uc3QgY29tcEZhY3RvcnkgPSB0aGlzLnJlc29sdmVyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KFNpZ25SdWxlQ29tcG9uZW50KTtcclxuICAgICAgICAgIGNvbnN0IGNvbXBSZWYgPSBjb21wRmFjdG9yeS5jcmVhdGUodGhpcy5pbmplY3Rvcik7XHJcblxyXG4gICAgICAgICAgY29tcFJlZi5pbnN0YW5jZS52YWx1ZSA9IFtdO1xyXG4gICAgICAgICAgLy8gY29tcFJlZi5pbnN0YW5jZS5jb3VudGVyU2lnblZhcmlhYmxlcyA9IHRoaXMudWlTdGF0ZS5jb3VudGVyU2lnblZhcmlhYmxlcyB8fCBbXTtcclxuICAgICAgICAgIC8vIGNvbXBSZWYuaW5zdGFuY2UuYXBwcm92YWxJdGVtcyA9IHRoaXMudWlTdGF0ZS5hcHByb3ZhbEl0ZW1zIHx8IFtdO1xyXG5cclxuICAgICAgICAgIGNvbnN0IG1vZGFsQ29uZmlnOiBNb2RhbE9wdGlvbnMgPSBPYmplY3QuYXNzaWduKGNvbXBSZWYuaW5zdGFuY2UubW9kYWxDb25maWcsXHJcbiAgICAgICAgICAgIHsgYnV0dG9uczogY29tcFJlZi5pbnN0YW5jZS5tb2RhbEZvb3RlciB9KTtcclxuICAgICAgICAgIGNvbnN0IGRpYWxvZyA9IHRoaXMubW9kYWxTZXJ2aWNlLnNob3coY29tcFJlZiwgbW9kYWxDb25maWcpO1xyXG4gICAgICAgICAgY29tcFJlZi5pbnN0YW5jZS5jbG9zZU1vZGFsLnN1YnNjcmliZSgkZXZlbnQgPT4gZGlhbG9nLmNsb3NlKCkpO1xyXG4gICAgICAgICAgY29tcFJlZi5pbnN0YW5jZS5zdWJtaXRNb2RhbC5zdWJzY3JpYmUoKGRhdGE6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUNoYW5nZVByb3BlcnR5KHtcclxuICAgICAgICAgICAgICBjYXRlZ29yeUlkOiAncGVyZm9ybWVyUHJvcGVydHknLFxyXG4gICAgICAgICAgICAgIHByb3BlcnR5SUQ6IFJlc291cmNlS2V5cy5TaWduUnVsZSxcclxuICAgICAgICAgICAgICBwcm9wZXJ0eVZhbHVlOiBkYXRhLnZhbHVlXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBkaWFsb2cuY2xvc2UoKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyDkvJrnrb7op4TliJnkuIvvvIzpqbPlm57op4TliJnnuqbmnZ9cclxuICAgICAgICBpZiAoKHRoaXMudWlTdGF0ZS5wcm9wZXJ0eURhdGEuQmFja1dhcmRSdWxlIGFzIEJhY2tXYXJkUnVsZSkuU2VsZWN0VGFyZ2V0QWJsZSA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMubWVzc2FnZS53YXJuaW5nKCfkvJrnrb7nrZbnlaXkuIss4oCc6amz5Zue6KeE5YiZ4oCd5LiN5YWB6K644oCc5Yqo5oCB6YCJ5oup6amz5Zue57qn5qyh4oCd77yM6K+35L+u5pS577yBJyk7XHJcbiAgICAgICAgICB9LCA1MDApO1xyXG4gICAgICAgIH1cclxuICAgICAgLy8gfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5a6M5oiQ562W55Wl6LCD5pW05qCh6aqMXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBiZWZvcmVDb21wbGV0ZVN0cmF0ZWd5Q2hhbmdlKGRhdGE6IGFueSk6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xyXG4gICAgaWYgKHRoaXMudGltZSA9PT0gUHJvY2Vzc1RpbWUucnQpIHtcclxuICAgICAgcmV0dXJuIHRoaXMudmlld01vZGVsLmJlZm9yZUNvbXBsZXRlU3RyYXRlZ3lDaGFuZ2UoZGF0YSwgdGhpcy5ydFByb2Nlc3NJbmZvKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiBvZih0cnVlKTtcclxuICAgIH1cclxuICB9XHJcblxyXG5cclxuICAvKipcclxuICAgKiDkv53lrZjvvIzlj5HluIPvvIzlj6blrZjvvIzlkIzmraXmk43kvZzml7ZcclxuICAgKiDmoKHpqozmqKHlnovnmoTmtYHnqIvliIbnsbtJROS4juWIl+ihqOWtmOWCqOaYr+WQpuS4gOiHtO+8jOS4jeS4gOiHtOaXtu+8jOS7peWIl+ihqOS4uuWHhlxyXG4gICAqL1xyXG4gIHByaXZhdGUgY2hlY2tNb2RlbENvbnRlbnQoY29udGVudDogc3RyaW5nKTogc3RyaW5nIHtcclxuICAgIGNvbnN0IHByb2Nlc3MgPSBKU09OLnBhcnNlKGNvbnRlbnQpO1xyXG4gICAgY29uc3QgbW9kZWxCaXpEZWZLZXkgPSBwcm9jZXNzLkRlZmF1bHRQcm9jZXNzLmV4dGVuc2lvbkVsZW1lbnRzLmZpbmQoZSA9PiBlLkNsclR5cGVJRCA9PT0gJ3dmLlByb2Nlc3NIZWFkZXInKS5CaXpEZWZLZXk7XHJcbiAgICBpZiAodGhpcy50aW1lID09PSBQcm9jZXNzVGltZS5kdCkge1xyXG4gICAgICBpZiAobW9kZWxCaXpEZWZLZXkgPT09IHRoaXMucHJvY2Vzc0luZm8uZmxvd0Zvcm1JZCkge1xyXG4gICAgICAgIHJldHVybiBjb250ZW50O1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHByb2Nlc3MuRGVmYXVsdFByb2Nlc3MuZXh0ZW5zaW9uRWxlbWVudHMuZmluZChlID0+IGUuQ2xyVHlwZUlEID09PSAnd2YuUHJvY2Vzc0hlYWRlcicpLkJpekRlZktleSA9IHRoaXMucHJvY2Vzc0luZm8uZmxvd0Zvcm1JZDtcclxuICAgICAgICBwcm9jZXNzLkRlZmF1bHRQcm9jZXNzLmV4dGVuc2lvbkVsZW1lbnRzLmZpbmQoZSA9PiBlLkNsclR5cGVJRCA9PT0gJ3dmLlByb2Nlc3NIZWFkZXInKS5CaXpEZWZOYW1lID0gdGhpcy51aVN0YXRlLmZsb3dGb3JtSW5mby5mbG93Rm9ybS5uYW1lO1xyXG4gICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShwcm9jZXNzKTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIGlmICh0aGlzLnRpbWUgPT09IFByb2Nlc3NUaW1lLnJ0KSB7XHJcbiAgICAgIGlmIChtb2RlbEJpekRlZktleSA9PT0gdGhpcy5ydFByb2Nlc3NJbmZvLmZsb3dGb3JtSWQpIHtcclxuICAgICAgICByZXR1cm4gY29udGVudDtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBwcm9jZXNzLkRlZmF1bHRQcm9jZXNzLmV4dGVuc2lvbkVsZW1lbnRzLmZpbmQoZSA9PiBlLkNsclR5cGVJRCA9PT0gJ3dmLlByb2Nlc3NIZWFkZXInKS5CaXpEZWZLZXkgPSB0aGlzLnJ0UHJvY2Vzc0luZm8uZmxvd0Zvcm1JZDtcclxuICAgICAgICBwcm9jZXNzLkRlZmF1bHRQcm9jZXNzLmV4dGVuc2lvbkVsZW1lbnRzLmZpbmQoZSA9PiBlLkNsclR5cGVJRCA9PT0gJ3dmLlByb2Nlc3NIZWFkZXInKS5CaXpEZWZOYW1lID0gdGhpcy51aVN0YXRlLmZsb3dGb3JtSW5mby5mbG93Rm9ybS5uYW1lO1xyXG4gICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShwcm9jZXNzKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxufVxyXG4iXX0=