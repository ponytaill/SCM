/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ViewChild, TemplateRef } from '@angular/core';
import { ProcessDesignerUIState } from '../../../app/process-designer.uistate';
import { HttpService, SessionService } from '@ecp-caf/caf-common';
import { RtfAppHelpComponent } from '@gsp-sys/rtf-ui';
import { of, Subject, from, forkJoin } from 'rxjs';
import { ServerSideToken, LookupGridComponent } from '@farris/ui-lookup';
import { FormFormatService } from './form-format.service';
import { ExecuteFormModel, TerminalType, ActualParameter } from '../entities/execute-form.entity';
import { DatagridComponent } from '@farris/ui-datagrid';
import { MessagerService } from '@farris/ui-messager';
import { ExecuteForm } from '../entities/execute-form';
import { ProcessDeUtil } from '../../../domain/process-de-util';
import { map } from 'rxjs/operators';
export class AddExecuteFormComponent {
    /**
     * @param {?} state
     * @param {?} http
     * @param {?} session
     * @param {?} message
     */
    constructor(state, http, session, message) {
        this.state = state;
        this.http = http;
        this.session = session;
        this.message = message;
        this.submit = new Subject();
        this.cancel = new Subject();
        this.forms = new Array();
        // private formTypeCollection = [
        //   { text: '流程嵌表单', value: '0' },
        //   { text: '表单嵌流程', value: '1' },
        // ];
        this.columns = [
            { field: 'code', width: 100, title: '编号' },
            {
                field: 'name', width: 100, title: '名称',
            },
            {
                field: 'tag', width: 80, title: '单据类型',
                formatter: (/**
                 * @param {?} v
                 * @param {?} d
                 * @param {?} i
                 * @return {?}
                 */
                (v, d, i) => {
                    if (d.appId) {
                        return '功能菜单';
                    }
                    else if (d.formFormatId) {
                        return '表单格式';
                    }
                })
            }
            // {
            //   field: 'formType', width: 80, title: '联查类型',
            //   formatter: {
            //     type: 'enum',
            //     options: { valueField: 'value', textField: 'text', data: this.formTypeCollection }
            //   },
            // },
        ];
        // 表单格式显示列
        this.cols = [
            {
                field: 'code', width: 100, title: '单据格式编号', searchField: 'code'
            }, {
                field: 'name', width: 100, title: '单据格式名称', searchField: 'name'
            }
        ];
        this.dataUri = '/api/runtime/wf/v1.0/formFormat/page';
        this.dictPicking = (/**
         * @param {?} arg
         * @return {?}
         */
        (arg) => {
            return of({
                showDialog: true, data: {
                    tab: this.tab
                }
            });
        });
        this.dictPicked = (/**
         * @param {?} data
         * @return {?}
         */
        (data) => {
            /** @type {?} */
            const model = new ExecuteFormModel();
            model.Id = ProcessDeUtil.GenerateElementId();
            model.Name = data.name;
            model.ComponentId = null;
            model.FormType = '0';
            model.formFormatId = data.id;
            model.TerminalType = this.tab === 'web' ? TerminalType.PC : TerminalType.MOBILE;
            model.ActualParameters = data.urlParameters.map((/**
             * @param {?} p
             * @return {?}
             */
            p => {
                /** @type {?} */
                const a = new ActualParameter();
                a.Name = p.code;
                a.Value = p.value;
                return a;
            }));
            this.submit.next(model);
            return of({ closeDialog: true });
        });
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.getAllExecuteForms();
    }
    /**
     * @return {?}
     */
    clickOK() {
        if (this.grid.selectedRow) {
            /** @type {?} */
            const form = this.grid.selectedRow.data;
            /** @type {?} */
            const model = new ExecuteFormModel();
            model.Id = ProcessDeUtil.GenerateElementId();
            model.Name = form.name;
            model.ComponentId = form.appId;
            model.FormType = form.formType;
            model.formFormatId = form.formFormatId;
            model.TerminalType = this.tab === 'web' ? TerminalType.PC : TerminalType.MOBILE;
            model.ActualParameters = form.actualParameters.map((/**
             * @param {?} p
             * @return {?}
             */
            p => {
                /** @type {?} */
                const a = new ActualParameter();
                a.Name = p.code;
                a.Value = p.value;
                return a;
            }));
            this.submit.next(model);
        }
        else {
            this.message.info('尚未选择表单定义！');
        }
    }
    /**
     * @return {?}
     */
    clickCancel() {
        this.cancel.next();
    }
    /**
     * @return {?}
     */
    selectOtherFormFormat() {
        this.lookUp.showDialog();
    }
    /**
     * @return {?}
     */
    selectOtherFunc() {
        this.appHelper.showHelp(this.session.getUserSessionId());
    }
    /**
     * @param {?} apps
     * @return {?}
     */
    funcSelected(apps) {
        if (apps && apps.length > 0) {
            /** @type {?} */
            const model = new ExecuteFormModel();
            model.Id = ProcessDeUtil.GenerateElementId();
            model.Name = apps[0].Name;
            model.ComponentId = apps[0].Id;
            model.FormType = '0';
            model.formFormatId = null;
            model.TerminalType = this.tab === 'web' ? TerminalType.PC : TerminalType.MOBILE;
            model.ActualParameters = [];
            if (apps[0].InvokingConfig['entityParams']) {
                /** @type {?} */
                const paras = JSON.parse(apps[0].InvokingConfig['entityParams']);
                model.ActualParameters = paras.map((/**
                 * @param {?} p
                 * @return {?}
                 */
                p => ({
                    Name: p.name,
                    Value: ''
                })));
            }
            setTimeout((/**
             * @return {?}
             */
            () => {
                this.submit.next(model);
            }), 0);
        }
    }
    /**
     * @private
     * @return {?}
     */
    getAllExecuteForms() {
        forkJoin(this.getExecuteForms(), this.getFormFormats()).subscribe((/**
         * @param {?} re
         * @return {?}
         */
        re => {
            if (re[0]) {
                this.forms = re[0];
            }
            if (re[1] && re[1].length > 0) {
                /** @type {?} */
                const formFormats = re[1];
                for (const format of formFormats) {
                    if (this.forms.findIndex((/**
                     * @param {?} f
                     * @return {?}
                     */
                    f => f.formFormatId && f.formFormatId === format.id)) === -1) {
                        /** @type {?} */
                        const executeForm = new ExecuteForm();
                        executeForm.id = ProcessDeUtil.createNM();
                        executeForm.flowFormKey = this.state.flowFormInfo.flowForm.id;
                        executeForm.appId = null;
                        executeForm.code = format.code;
                        executeForm.name = format.name;
                        executeForm.actualParameters = [];
                        executeForm.isDefault = false;
                        executeForm.formType = '0';
                        executeForm.terminal = 'web';
                        executeForm.formFormatId = format.id;
                        executeForm.sysInit = 0;
                        executeForm.remarks = '';
                        if (format.urlParameters && format.urlParameters.length > 0) {
                            /** @type {?} */
                            const actPList = format.urlParameters.map((/**
                             * @param {?} p
                             * @return {?}
                             */
                            p => ({
                                code: p.code,
                                name: p.name,
                                value: p.value
                            })));
                            executeForm.actualParameters = actPList;
                        }
                        this.forms.push(executeForm);
                    }
                }
            }
        }));
    }
    /**
     * @private
     * @return {?}
     */
    getExecuteForms() {
        if (this.state.flowFormInfo.flowForm.id && this.tab) {
            /** @type {?} */
            const url = `/api/runtime/wf/v1.0/excuteForm?flowFormKey=${this.state.flowFormInfo.flowForm.id}`;
            return this.http.get(url).pipe(map((/**
             * @param {?} re
             * @return {?}
             */
            (re) => {
                if (this.tab === 'web') {
                    return re.filter((/**
                     * @param {?} f
                     * @return {?}
                     */
                    f => f.terminal.indexOf('web') > -1));
                }
                else if (this.tab === 'mobile') {
                    return re.filter((/**
                     * @param {?} f
                     * @return {?}
                     */
                    f => f.terminal.indexOf('app') > -1));
                }
            })));
        }
        else {
            return from(new Array());
        }
    }
    /**
     * @private
     * @return {?}
     */
    getFormFormats() {
        if (this.state.flowFormInfo.flowForm.businessObjectId && this.tab) {
            /** @type {?} */
            const terminal = this.tab === 'web' ? 'PC' : 'Mobile';
            /** @type {?} */
            let url = `/api/runtime/wf/v1.0/formFormat/query?param=`;
            /** @type {?} */
            let param = `{"bizCategory":"${this.state.flowFormInfo.flowForm.businessObjectId}","terminal":"${terminal}"}`;
            param = encodeURIComponent(param);
            url += param;
            return this.http.get(url);
        }
        else {
            return from(new Array());
        }
    }
}
AddExecuteFormComponent.decorators = [
    { type: Component, args: [{
                selector: 'lib-add-execute-form',
                template: "<div class=\"f-page f-page-is-managelist\">\r\n  <!-- <div class=\"f-page-header\">\r\n    <nav class=\"f-page-header-base mt-2 py-0\" style=\"min-height: 2rem;\">\r\n      <div class=\"f-title\">\r\n        <span class=\"f-title-icon f-text-orna-bill\">\r\n          <i class=\"f-icon f-icon-page-title-administer\"></i>\r\n        </span>\r\n        <h4 class=\"f-title-text\">\u8868\u5355\u683C\u5F0F\u5217\u8868</h4>\r\n      </div>\r\n      <div class=\"btn-toolbar btn-group-lg\">\r\n        <button class=\"btn btn-secondary mr-2\" (click)=\"selectOtherFormFormat()\">\r\n          \u5F15\u5165\u8868\u5355\u683C\u5F0F\r\n        </button>\r\n        <button class=\"btn btn-secondary\" (click)=\"selectOtherFunc()\">\r\n          \u5F15\u5165\u529F\u80FD\u83DC\u5355\r\n        </button>\r\n      </div>\r\n    </nav>\r\n  </div> -->\r\n  <div class=\"f-page-main my-0\">\r\n    <div class=\"f-struct-wrapper f-utils-fill-flex-column\">\r\n      <farris-section class=\"f-section-grid f-section-in-managelist p-2\" [showHeader]=\"false\">\r\n        <farris-datagrid class=\"f-component-grid\" [columns]=\"columns\" [data]=\"forms\" #grid\r\n          [idField]=\"'id'\" [showLineNumber]=\"true\" [striped]=\"true\"\r\n          [showCheckbox]=\"false\" [virtualized]=\"true\" [pagination]=\"false\" [fit]=\"true\" [fitColumns]=\"true\">\r\n        </farris-datagrid>\r\n      </farris-section>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<ng-template #iconSelectFooter>\r\n  <button type=\"button\" class=\"btn btn-primary btn-sm mx-2\" (click)=\"clickOK()\">\u786E\u5B9A</button>\r\n  <button type=\"button\" class=\"btn btn-secondary btn-sm\" (click)=\"clickCancel()\">\u53D6\u6D88</button>\r\n</ng-template>\r\n\r\n<app-rtf-app-help #appHelper (afterHelpConfirm)=\"funcSelected($event)\" [isLayeredLoad]=\"true\">\r\n</app-rtf-app-help>\r\n\r\n<!-- \u5355\u636E\u683C\u5F0F\u5E2E\u52A9 -->\r\n<farris-lookup-grid #lookup style=\"display: none;\" [editable]=\"false\" [columns]=\"cols\" [singleSelect]=\"true\"\r\n  [title]=\"'\u5355\u636E\u683C\u5F0F'\" [displayType]=\"'List'\" [uri]=\"dataUri\" [idField]=\"'id'\" [pageIndex]=\"1\" [pageSize]=\"20\"\r\n  [pagination]=\"true\" [valueField]=\"'id'\" [textField]=\"'name'\" [dialogWidth]=\"550\" [dictPicked]=\"dictPicked\"\r\n  [dictPicking]=\"dictPicking\">\r\n</farris-lookup-grid>\r\n",
                providers: [{ provide: ServerSideToken, useClass: FormFormatService }],
                styles: [""]
            }] }
];
/** @nocollapse */
AddExecuteFormComponent.ctorParameters = () => [
    { type: ProcessDesignerUIState },
    { type: HttpService },
    { type: SessionService },
    { type: MessagerService }
];
AddExecuteFormComponent.propDecorators = {
    modalFooter: [{ type: ViewChild, args: ['iconSelectFooter',] }],
    appHelper: [{ type: ViewChild, args: [RtfAppHelpComponent,] }],
    lookUp: [{ type: ViewChild, args: ['lookup',] }],
    grid: [{ type: ViewChild, args: ['grid',] }]
};
if (false) {
    /** @type {?} */
    AddExecuteFormComponent.prototype.modalFooter;
    /** @type {?} */
    AddExecuteFormComponent.prototype.appHelper;
    /** @type {?} */
    AddExecuteFormComponent.prototype.lookUp;
    /**
     * @type {?}
     * @private
     */
    AddExecuteFormComponent.prototype.grid;
    /** @type {?} */
    AddExecuteFormComponent.prototype.submit;
    /** @type {?} */
    AddExecuteFormComponent.prototype.cancel;
    /** @type {?} */
    AddExecuteFormComponent.prototype.tab;
    /** @type {?} */
    AddExecuteFormComponent.prototype.forms;
    /** @type {?} */
    AddExecuteFormComponent.prototype.columns;
    /** @type {?} */
    AddExecuteFormComponent.prototype.cols;
    /** @type {?} */
    AddExecuteFormComponent.prototype.dataUri;
    /** @type {?} */
    AddExecuteFormComponent.prototype.dictPicking;
    /** @type {?} */
    AddExecuteFormComponent.prototype.dictPicked;
    /**
     * @type {?}
     * @private
     */
    AddExecuteFormComponent.prototype.state;
    /**
     * @type {?}
     * @private
     */
    AddExecuteFormComponent.prototype.http;
    /**
     * @type {?}
     * @private
     */
    AddExecuteFormComponent.prototype.session;
    /**
     * @type {?}
     * @private
     */
    AddExecuteFormComponent.prototype.message;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWRkLWV4ZWN1dGUtZm9ybS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLXdmL3dmLXByb2Nlc3MtZWRpdG9yLyIsInNvdXJjZXMiOlsibGliL3ZpZXdzL2V4ZWN1dGUtZm9ybXMvYWRkLWV4ZWN1dGUtZm9ybS9hZGQtZXhlY3V0ZS1mb3JtLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBOEMsU0FBUyxFQUFFLFdBQVcsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUU5RyxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSx1Q0FBdUMsQ0FBQztBQUMvRSxPQUFPLEVBQUUsV0FBVyxFQUFFLGNBQWMsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ2xFLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBRXRELE9BQU8sRUFBRSxFQUFFLEVBQWMsT0FBTyxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDL0QsT0FBTyxFQUFnQixlQUFlLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUN2RixPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUMxRCxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsWUFBWSxFQUFFLGVBQWUsRUFBRSxNQUFNLGlDQUFpQyxDQUFDO0FBQ2xHLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3hELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN0RCxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDdkQsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGlDQUFpQyxDQUFDO0FBQ2hFLE9BQU8sRUFBRSxHQUFHLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQVFyQyxNQUFNLE9BQU8sdUJBQXVCOzs7Ozs7O0lB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QUVELDZDQWdCQzs7Ozs7SUFoRUMsd0NBQXFDOzs7OztJQUNyQyx1Q0FBeUI7Ozs7O0lBQ3pCLDBDQUErQjs7Ozs7SUFDL0IsMENBQWdDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIEluamVjdG9yLCBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsIFZpZXdDaGlsZCwgVGVtcGxhdGVSZWYgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgQnNNb2RhbFNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW1vZGFsJztcclxuaW1wb3J0IHsgUHJvY2Vzc0Rlc2lnbmVyVUlTdGF0ZSB9IGZyb20gJy4uLy4uLy4uL2FwcC9wcm9jZXNzLWRlc2lnbmVyLnVpc3RhdGUnO1xyXG5pbXBvcnQgeyBIdHRwU2VydmljZSwgU2Vzc2lvblNlcnZpY2UgfSBmcm9tICdAZWNwLWNhZi9jYWYtY29tbW9uJztcclxuaW1wb3J0IHsgUnRmQXBwSGVscENvbXBvbmVudCB9IGZyb20gJ0Bnc3Atc3lzL3J0Zi11aSc7XHJcbmltcG9ydCB7IFJ0ZkFwcCB9IGZyb20gJ0Bnc3Atc3lzL3J0Zi11aS9saWIvcnRmLWFwcC1oZWxwL2VudGl0aWVzL3J0Zi1hcHAnO1xyXG5pbXBvcnQgeyBvZiwgT2JzZXJ2YWJsZSwgU3ViamVjdCwgZnJvbSwgZm9ya0pvaW4gfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgUGlja2VkUmVzdWx0LCBTZXJ2ZXJTaWRlVG9rZW4sIExvb2t1cEdyaWRDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLWxvb2t1cCc7XHJcbmltcG9ydCB7IEZvcm1Gb3JtYXRTZXJ2aWNlIH0gZnJvbSAnLi9mb3JtLWZvcm1hdC5zZXJ2aWNlJztcclxuaW1wb3J0IHsgRXhlY3V0ZUZvcm1Nb2RlbCwgVGVybWluYWxUeXBlLCBBY3R1YWxQYXJhbWV0ZXIgfSBmcm9tICcuLi9lbnRpdGllcy9leGVjdXRlLWZvcm0uZW50aXR5JztcclxuaW1wb3J0IHsgRGF0YWdyaWRDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLWRhdGFncmlkJztcclxuaW1wb3J0IHsgTWVzc2FnZXJTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1tZXNzYWdlcic7XHJcbmltcG9ydCB7IEV4ZWN1dGVGb3JtIH0gZnJvbSAnLi4vZW50aXRpZXMvZXhlY3V0ZS1mb3JtJztcclxuaW1wb3J0IHsgUHJvY2Vzc0RlVXRpbCB9IGZyb20gJy4uLy4uLy4uL2RvbWFpbi9wcm9jZXNzLWRlLXV0aWwnO1xyXG5pbXBvcnQgeyBtYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ2xpYi1hZGQtZXhlY3V0ZS1mb3JtJyxcclxuICB0ZW1wbGF0ZVVybDogJy4vYWRkLWV4ZWN1dGUtZm9ybS5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vYWRkLWV4ZWN1dGUtZm9ybS5jb21wb25lbnQuc2NzcyddLFxyXG4gIHByb3ZpZGVyczogW3sgcHJvdmlkZTogU2VydmVyU2lkZVRva2VuLCB1c2VDbGFzczogRm9ybUZvcm1hdFNlcnZpY2UgfV1cclxufSlcclxuZXhwb3J0IGNsYXNzIEFkZEV4ZWN1dGVGb3JtQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuXHJcbiAgQFZpZXdDaGlsZCgnaWNvblNlbGVjdEZvb3RlcicpIG1vZGFsRm9vdGVyOiBUZW1wbGF0ZVJlZjxhbnk+O1xyXG4gIEBWaWV3Q2hpbGQoUnRmQXBwSGVscENvbXBvbmVudCkgcHVibGljIGFwcEhlbHBlcjogUnRmQXBwSGVscENvbXBvbmVudDtcclxuICBAVmlld0NoaWxkKCdsb29rdXAnKSBwdWJsaWMgbG9va1VwOiBMb29rdXBHcmlkQ29tcG9uZW50O1xyXG4gIEBWaWV3Q2hpbGQoJ2dyaWQnKSBwcml2YXRlIGdyaWQ6IERhdGFncmlkQ29tcG9uZW50O1xyXG5cclxuICBzdWJtaXQgPSBuZXcgU3ViamVjdDxFeGVjdXRlRm9ybU1vZGVsPigpO1xyXG4gIGNhbmNlbCA9IG5ldyBTdWJqZWN0KCk7XHJcblxyXG4gIHRhYjogJ3dlYicgfCAnbW9iaWxlJztcclxuXHJcbiAgZm9ybXMgPSBuZXcgQXJyYXk8RXhlY3V0ZUZvcm0+KCk7XHJcblxyXG4gIC8vIHByaXZhdGUgZm9ybVR5cGVDb2xsZWN0aW9uID0gW1xyXG4gIC8vICAgeyB0ZXh0OiAn5rWB56iL5bWM6KGo5Y2VJywgdmFsdWU6ICcwJyB9LFxyXG4gIC8vICAgeyB0ZXh0OiAn6KGo5Y2V5bWM5rWB56iLJywgdmFsdWU6ICcxJyB9LFxyXG4gIC8vIF07XHJcblxyXG4gIGNvbHVtbnMgPSBbXHJcbiAgICB7IGZpZWxkOiAnY29kZScsIHdpZHRoOiAxMDAsIHRpdGxlOiAn57yW5Y+3JyB9LFxyXG4gICAge1xyXG4gICAgICBmaWVsZDogJ25hbWUnLCB3aWR0aDogMTAwLCB0aXRsZTogJ+WQjeensCcsXHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICBmaWVsZDogJ3RhZycsIHdpZHRoOiA4MCwgdGl0bGU6ICfljZXmja7nsbvlnosnLFxyXG4gICAgICBmb3JtYXR0ZXI6ICh2LCBkLCBpKSA9PiB7XHJcbiAgICAgICAgaWYgKGQuYXBwSWQpIHtcclxuICAgICAgICAgIHJldHVybiAn5Yqf6IO96I+c5Y2VJztcclxuICAgICAgICB9IGVsc2UgaWYgKGQuZm9ybUZvcm1hdElkKSB7XHJcbiAgICAgICAgICByZXR1cm4gJ+ihqOWNleagvOW8jyc7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICAvLyB7XHJcbiAgICAvLyAgIGZpZWxkOiAnZm9ybVR5cGUnLCB3aWR0aDogODAsIHRpdGxlOiAn6IGU5p+l57G75Z6LJyxcclxuICAgIC8vICAgZm9ybWF0dGVyOiB7XHJcbiAgICAvLyAgICAgdHlwZTogJ2VudW0nLFxyXG4gICAgLy8gICAgIG9wdGlvbnM6IHsgdmFsdWVGaWVsZDogJ3ZhbHVlJywgdGV4dEZpZWxkOiAndGV4dCcsIGRhdGE6IHRoaXMuZm9ybVR5cGVDb2xsZWN0aW9uIH1cclxuICAgIC8vICAgfSxcclxuICAgIC8vIH0sXHJcbiAgXTtcclxuXHJcbiAgLy8g6KGo5Y2V5qC85byP5pi+56S65YiXXHJcbiAgY29scyA9IFtcclxuICAgIHtcclxuICAgICAgZmllbGQ6ICdjb2RlJywgd2lkdGg6IDEwMCwgdGl0bGU6ICfljZXmja7moLzlvI/nvJblj7cnLCBzZWFyY2hGaWVsZDogJ2NvZGUnXHJcbiAgICB9LCB7XHJcbiAgICAgIGZpZWxkOiAnbmFtZScsIHdpZHRoOiAxMDAsIHRpdGxlOiAn5Y2V5o2u5qC85byP5ZCN56ewJywgc2VhcmNoRmllbGQ6ICduYW1lJ1xyXG4gICAgfVxyXG4gIF07XHJcblxyXG4gIGRhdGFVcmkgPSAnL2FwaS9ydW50aW1lL3dmL3YxLjAvZm9ybUZvcm1hdC9wYWdlJztcclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgc3RhdGU6IFByb2Nlc3NEZXNpZ25lclVJU3RhdGUsXHJcbiAgICBwcml2YXRlIGh0dHA6IEh0dHBTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBzZXNzaW9uOiBTZXNzaW9uU2VydmljZSxcclxuICAgIHByaXZhdGUgbWVzc2FnZTogTWVzc2FnZXJTZXJ2aWNlXHJcbiAgKSB7IH1cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICB0aGlzLmdldEFsbEV4ZWN1dGVGb3JtcygpO1xyXG4gIH1cclxuXHJcbiAgY2xpY2tPSygpIHtcclxuICAgIGlmICh0aGlzLmdyaWQuc2VsZWN0ZWRSb3cpIHtcclxuICAgICAgY29uc3QgZm9ybTogRXhlY3V0ZUZvcm0gPSB0aGlzLmdyaWQuc2VsZWN0ZWRSb3cuZGF0YTtcclxuICAgICAgY29uc3QgbW9kZWwgPSBuZXcgRXhlY3V0ZUZvcm1Nb2RlbCgpO1xyXG4gICAgICBtb2RlbC5JZCA9IFByb2Nlc3NEZVV0aWwuR2VuZXJhdGVFbGVtZW50SWQoKTtcclxuICAgICAgbW9kZWwuTmFtZSA9IGZvcm0ubmFtZTtcclxuICAgICAgbW9kZWwuQ29tcG9uZW50SWQgPSBmb3JtLmFwcElkO1xyXG4gICAgICBtb2RlbC5Gb3JtVHlwZSA9IGZvcm0uZm9ybVR5cGU7XHJcbiAgICAgIG1vZGVsLmZvcm1Gb3JtYXRJZCA9IGZvcm0uZm9ybUZvcm1hdElkO1xyXG4gICAgICBtb2RlbC5UZXJtaW5hbFR5cGUgPSB0aGlzLnRhYiA9PT0gJ3dlYicgPyBUZXJtaW5hbFR5cGUuUEMgOiBUZXJtaW5hbFR5cGUuTU9CSUxFO1xyXG4gICAgICBtb2RlbC5BY3R1YWxQYXJhbWV0ZXJzID0gZm9ybS5hY3R1YWxQYXJhbWV0ZXJzLm1hcChwID0+IHtcclxuICAgICAgICBjb25zdCBhID0gbmV3IEFjdHVhbFBhcmFtZXRlcigpO1xyXG4gICAgICAgIGEuTmFtZSA9IHAuY29kZTtcclxuICAgICAgICBhLlZhbHVlID0gcC52YWx1ZTtcclxuICAgICAgICByZXR1cm4gYTtcclxuICAgICAgfSk7XHJcbiAgICAgIHRoaXMuc3VibWl0Lm5leHQobW9kZWwpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5tZXNzYWdlLmluZm8oJ+WwmuacqumAieaLqeihqOWNleWumuS5ie+8gScpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgY2xpY2tDYW5jZWwoKSB7XHJcbiAgICB0aGlzLmNhbmNlbC5uZXh0KCk7XHJcbiAgfVxyXG5cclxuICBzZWxlY3RPdGhlckZvcm1Gb3JtYXQoKSB7XHJcbiAgICB0aGlzLmxvb2tVcC5zaG93RGlhbG9nKCk7XHJcbiAgfVxyXG5cclxuICBkaWN0UGlja2luZyA9IChhcmcpID0+IHtcclxuICAgIHJldHVybiBvZih7XHJcbiAgICAgIHNob3dEaWFsb2c6IHRydWUsIGRhdGE6IHtcclxuICAgICAgICB0YWI6IHRoaXMudGFiXHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZGljdFBpY2tlZCA9IChkYXRhOiBhbnkpOiBPYnNlcnZhYmxlPFBpY2tlZFJlc3VsdD4gPT4ge1xyXG4gICAgY29uc3QgbW9kZWwgPSBuZXcgRXhlY3V0ZUZvcm1Nb2RlbCgpO1xyXG4gICAgbW9kZWwuSWQgPSBQcm9jZXNzRGVVdGlsLkdlbmVyYXRlRWxlbWVudElkKCk7XHJcbiAgICBtb2RlbC5OYW1lID0gZGF0YS5uYW1lO1xyXG4gICAgbW9kZWwuQ29tcG9uZW50SWQgPSBudWxsO1xyXG4gICAgbW9kZWwuRm9ybVR5cGUgPSAnMCc7XHJcbiAgICBtb2RlbC5mb3JtRm9ybWF0SWQgPSBkYXRhLmlkO1xyXG4gICAgbW9kZWwuVGVybWluYWxUeXBlID0gdGhpcy50YWIgPT09ICd3ZWInID8gVGVybWluYWxUeXBlLlBDIDogVGVybWluYWxUeXBlLk1PQklMRTtcclxuICAgIG1vZGVsLkFjdHVhbFBhcmFtZXRlcnMgPSBkYXRhLnVybFBhcmFtZXRlcnMubWFwKHAgPT4ge1xyXG4gICAgICBjb25zdCBhID0gbmV3IEFjdHVhbFBhcmFtZXRlcigpO1xyXG4gICAgICBhLk5hbWUgPSBwLmNvZGU7XHJcbiAgICAgIGEuVmFsdWUgPSBwLnZhbHVlO1xyXG4gICAgICByZXR1cm4gYTtcclxuICAgIH0pO1xyXG4gICAgdGhpcy5zdWJtaXQubmV4dChtb2RlbCk7XHJcbiAgICByZXR1cm4gb2YoeyBjbG9zZURpYWxvZzogdHJ1ZSB9KTtcclxuICB9XHJcblxyXG4gIHNlbGVjdE90aGVyRnVuYygpIHtcclxuICAgIHRoaXMuYXBwSGVscGVyLnNob3dIZWxwKHRoaXMuc2Vzc2lvbi5nZXRVc2VyU2Vzc2lvbklkKCkpO1xyXG4gIH1cclxuXHJcbiAgZnVuY1NlbGVjdGVkKGFwcHM6IFJ0ZkFwcFtdKSB7XHJcbiAgICBpZiAoYXBwcyAmJiBhcHBzLmxlbmd0aCA+IDApIHtcclxuICAgICAgY29uc3QgbW9kZWwgPSBuZXcgRXhlY3V0ZUZvcm1Nb2RlbCgpO1xyXG4gICAgICBtb2RlbC5JZCA9IFByb2Nlc3NEZVV0aWwuR2VuZXJhdGVFbGVtZW50SWQoKTtcclxuICAgICAgbW9kZWwuTmFtZSA9IGFwcHNbMF0uTmFtZTtcclxuICAgICAgbW9kZWwuQ29tcG9uZW50SWQgPSBhcHBzWzBdLklkO1xyXG4gICAgICBtb2RlbC5Gb3JtVHlwZSA9ICcwJztcclxuICAgICAgbW9kZWwuZm9ybUZvcm1hdElkID0gbnVsbDtcclxuICAgICAgbW9kZWwuVGVybWluYWxUeXBlID0gdGhpcy50YWIgPT09ICd3ZWInID8gVGVybWluYWxUeXBlLlBDIDogVGVybWluYWxUeXBlLk1PQklMRTtcclxuICAgICAgbW9kZWwuQWN0dWFsUGFyYW1ldGVycyA9IFtdO1xyXG4gICAgICBpZiAoYXBwc1swXS5JbnZva2luZ0NvbmZpZ1snZW50aXR5UGFyYW1zJ10pIHtcclxuICAgICAgICBjb25zdCBwYXJhcyA9IEpTT04ucGFyc2UoYXBwc1swXS5JbnZva2luZ0NvbmZpZ1snZW50aXR5UGFyYW1zJ10pO1xyXG4gICAgICAgIG1vZGVsLkFjdHVhbFBhcmFtZXRlcnMgPSBwYXJhcy5tYXAocCA9PiAoe1xyXG4gICAgICAgICAgTmFtZTogcC5uYW1lLFxyXG4gICAgICAgICAgVmFsdWU6ICcnXHJcbiAgICAgICAgfSkpO1xyXG4gICAgICB9XHJcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgIHRoaXMuc3VibWl0Lm5leHQobW9kZWwpO1xyXG4gICAgICB9LCAwKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0QWxsRXhlY3V0ZUZvcm1zKCkge1xyXG4gICAgZm9ya0pvaW4odGhpcy5nZXRFeGVjdXRlRm9ybXMoKSwgdGhpcy5nZXRGb3JtRm9ybWF0cygpKS5zdWJzY3JpYmUocmUgPT4ge1xyXG4gICAgICBpZiAocmVbMF0pIHtcclxuICAgICAgICB0aGlzLmZvcm1zID0gcmVbMF07XHJcbiAgICAgIH1cclxuICAgICAgaWYgKHJlWzFdICYmIHJlWzFdLmxlbmd0aCA+IDApIHtcclxuICAgICAgICBjb25zdCBmb3JtRm9ybWF0cyA9IHJlWzFdO1xyXG4gICAgICAgIGZvciAoY29uc3QgZm9ybWF0IG9mIGZvcm1Gb3JtYXRzKSB7XHJcbiAgICAgICAgICBpZiAodGhpcy5mb3Jtcy5maW5kSW5kZXgoZiA9PiBmLmZvcm1Gb3JtYXRJZCAmJiBmLmZvcm1Gb3JtYXRJZCA9PT0gZm9ybWF0LmlkKSA9PT0gLTEpIHtcclxuICAgICAgICAgICAgY29uc3QgZXhlY3V0ZUZvcm0gPSBuZXcgRXhlY3V0ZUZvcm0oKTtcclxuICAgICAgICAgICAgZXhlY3V0ZUZvcm0uaWQgPSBQcm9jZXNzRGVVdGlsLmNyZWF0ZU5NKCk7XHJcbiAgICAgICAgICAgIGV4ZWN1dGVGb3JtLmZsb3dGb3JtS2V5ID0gdGhpcy5zdGF0ZS5mbG93Rm9ybUluZm8uZmxvd0Zvcm0uaWQ7XHJcbiAgICAgICAgICAgIGV4ZWN1dGVGb3JtLmFwcElkID0gbnVsbDtcclxuICAgICAgICAgICAgZXhlY3V0ZUZvcm0uY29kZSA9IGZvcm1hdC5jb2RlO1xyXG4gICAgICAgICAgICBleGVjdXRlRm9ybS5uYW1lID0gZm9ybWF0Lm5hbWU7XHJcbiAgICAgICAgICAgIGV4ZWN1dGVGb3JtLmFjdHVhbFBhcmFtZXRlcnMgPSBbXTtcclxuICAgICAgICAgICAgZXhlY3V0ZUZvcm0uaXNEZWZhdWx0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGV4ZWN1dGVGb3JtLmZvcm1UeXBlID0gJzAnO1xyXG4gICAgICAgICAgICBleGVjdXRlRm9ybS50ZXJtaW5hbCA9ICd3ZWInO1xyXG4gICAgICAgICAgICBleGVjdXRlRm9ybS5mb3JtRm9ybWF0SWQgPSBmb3JtYXQuaWQ7XHJcbiAgICAgICAgICAgIGV4ZWN1dGVGb3JtLnN5c0luaXQgPSAwO1xyXG4gICAgICAgICAgICBleGVjdXRlRm9ybS5yZW1hcmtzID0gJyc7XHJcbiAgICAgICAgICAgIGlmIChmb3JtYXQudXJsUGFyYW1ldGVycyAmJiBmb3JtYXQudXJsUGFyYW1ldGVycy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgY29uc3QgYWN0UExpc3QgPSBmb3JtYXQudXJsUGFyYW1ldGVycy5tYXAocCA9PiAoe1xyXG4gICAgICAgICAgICAgICAgY29kZTogcC5jb2RlLFxyXG4gICAgICAgICAgICAgICAgbmFtZTogcC5uYW1lLFxyXG4gICAgICAgICAgICAgICAgdmFsdWU6IHAudmFsdWVcclxuICAgICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgICAgICAgZXhlY3V0ZUZvcm0uYWN0dWFsUGFyYW1ldGVycyA9IGFjdFBMaXN0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuZm9ybXMucHVzaChleGVjdXRlRm9ybSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0RXhlY3V0ZUZvcm1zKCk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBpZiAodGhpcy5zdGF0ZS5mbG93Rm9ybUluZm8uZmxvd0Zvcm0uaWQgJiYgdGhpcy50YWIpIHtcclxuICAgICAgY29uc3QgdXJsID0gYC9hcGkvcnVudGltZS93Zi92MS4wL2V4Y3V0ZUZvcm0/Zmxvd0Zvcm1LZXk9JHt0aGlzLnN0YXRlLmZsb3dGb3JtSW5mby5mbG93Rm9ybS5pZH1gO1xyXG4gICAgICByZXR1cm4gdGhpcy5odHRwLmdldCh1cmwpLnBpcGUoXHJcbiAgICAgICAgbWFwKChyZTogYW55KSA9PiB7XHJcbiAgICAgICAgICBpZiAodGhpcy50YWIgPT09ICd3ZWInKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZS5maWx0ZXIoZiA9PiBmLnRlcm1pbmFsLmluZGV4T2YoJ3dlYicpID4gLTEpO1xyXG4gICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnRhYiA9PT0gJ21vYmlsZScpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlLmZpbHRlcihmID0+IGYudGVybWluYWwuaW5kZXhPZignYXBwJykgPiAtMSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuICAgICAgKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiBmcm9tKG5ldyBBcnJheSgpKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0Rm9ybUZvcm1hdHMoKTogT2JzZXJ2YWJsZTxhbnk+ICB7XHJcbiAgICBpZiAodGhpcy5zdGF0ZS5mbG93Rm9ybUluZm8uZmxvd0Zvcm0uYnVzaW5lc3NPYmplY3RJZCAmJiB0aGlzLnRhYikge1xyXG4gICAgICBjb25zdCB0ZXJtaW5hbCA9IHRoaXMudGFiID09PSAnd2ViJyA/ICdQQycgOiAnTW9iaWxlJztcclxuICAgICAgbGV0IHVybCA9IGAvYXBpL3J1bnRpbWUvd2YvdjEuMC9mb3JtRm9ybWF0L3F1ZXJ5P3BhcmFtPWA7XHJcbiAgICAgIGxldCBwYXJhbSA9IGB7XCJiaXpDYXRlZ29yeVwiOlwiJHt0aGlzLnN0YXRlLmZsb3dGb3JtSW5mby5mbG93Rm9ybS5idXNpbmVzc09iamVjdElkfVwiLFwidGVybWluYWxcIjpcIiR7dGVybWluYWx9XCJ9YDtcclxuICAgICAgcGFyYW0gPSBlbmNvZGVVUklDb21wb25lbnQocGFyYW0pO1xyXG4gICAgICB1cmwgKz0gcGFyYW07XHJcbiAgICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0KHVybCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gZnJvbShuZXcgQXJyYXkoKSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxufVxyXG4iXX0=