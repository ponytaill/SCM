{"version":3,"sources":["node_modules/tslib/tslib.es6.js","ng://@gsp-wf/wf-task-handler/lib/service/task.service.ts","ng://@gsp-wf/wf-task-handler/lib/entity/task-action.ts","ng://@gsp-wf/wf-task-handler/lib/service/i18n/en.ts","ng://@gsp-wf/wf-task-handler/lib/service/i18n/index.ts","ng://@gsp-wf/wf-task-handler/lib/service/i18n/zh-chs.ts","ng://@gsp-wf/wf-task-handler/lib/service/i18n/zh-cht.ts","ng://@gsp-wf/wf-task-handler/lib/service/i18n/i18n.service.ts","ng://@gsp-wf/wf-task-handler/lib/entity/task-entity.ts","ng://@gsp-wf/wf-task-handler/lib/entity/complete-context.ts","ng://@gsp-wf/wf-task-handler/lib/entity/complete-response.ts","ng://@gsp-wf/wf-task-handler/lib/entity/task-center-config.ts","ng://@gsp-wf/wf-task-handler/lib/entity/workitem-execute-param.ts","ng://@gsp-wf/wf-task-handler/lib/entity/user.ts","ng://@gsp-wf/wf-task-handler/lib/entity/urge-handle.ts","ng://@gsp-wf/wf-task-handler/lib/entity/batchVerifysigned.ts","ng://@gsp-wf/wf-task-handler/lib/entity/wfContext.ts","ng://@gsp-wf/wf-task-handler/lib/components/urge-handle/urge-handle.component.ts","ng://@gsp-wf/wf-task-handler/lib/entity/base-payload.ts","ng://@gsp-wf/wf-task-handler/lib/entity/add-sign.ts","ng://@gsp-wf/wf-task-handler/lib/components/task-execute/task-execute.component.ts","ng://@gsp-wf/wf-task-handler/lib/entity/start-process-payload.ts","ng://@gsp-wf/wf-task-handler/lib/entity/postMessage.ts","ng://@gsp-wf/wf-task-handler/lib/entity/process-cache.ts","ng://@gsp-wf/wf-task-handler/lib/submit/process-selector/process-selector.component.ts","ng://@gsp-wf/wf-task-handler/lib/wf-task-handler.service.ts","ng://@gsp-wf/wf-task-handler/lib/service/i18n/translate.pipe.ts","ng://@gsp-wf/wf-task-handler/lib/components/task-assigninfo/task-assigninfo.component.ts","ng://@gsp-wf/wf-task-handler/lib/components/assignee-info/assignee-info.component.ts","ng://@gsp-wf/wf-task-handler/lib/throttleTime/throttleClickDirective.ts","ng://@gsp-wf/wf-task-handler/lib/entity/attachment.ts","ng://@gsp-wf/wf-task-handler/lib/entity/comment.ts","ng://@gsp-wf/wf-task-handler/lib/components/task-comment/task-comment.component.ts","ng://@gsp-wf/wf-task-handler/lib/wf-task-handler.module.ts"],"names":["extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","__extends","TypeError","String","__","this","constructor","create","__values","o","s","Symbol","iterator","m","i","length","next","value","done","__read","n","r","e","ar","push","error","__spread","arguments","concat","TaskService","getUsersByIds","ids","_this","forkJoin","map","id","httpSvc","get","getWorkItemActions","workItemId","url","complete","context","post","completeSimulate","getDestinationScope","action","getSimulationAssigneeInfo","nodeId","addSign","readTask","getAppInfo","formParUrl","getAssigneeInfo","taskId","getOrganizationScope","actionCode","getTaskByProcInstId","procInstId","state","getTaskByWorkItemId","assignNextUsersByWorkItemId","assigneesPa","retrieve","transfer","transferContext","comment","commentContext","claim","options","unClaim","Message","message","warning","startProcess","payload","startProcessSimulate","cancelSubmit","param","newId","S4","Math","random","toString","substring","getCommentList","addComment","getTaskCenterConfigByCode","code","ownerType","ownerId","addTaskCenterConfig","currentValue","getAllUserConfig","uploadAttachment","files","put","deleteAttachment","fileDeleteEntity","delete","uploadSignature","gspDocUploadEntity","header","setHeader","body","responseType","request","createNM","replace","c","getUserInfo","getUserSign","userId","createItem","attachmentInfo","pos","fileName","lastIndexOf","type","toLowerCase","indexOf","subjectRegister","subjectCode","token","gspframeworkService","rtf","broadcast","funcId","subjectNotify","subjectToken","notify","subjectResponse","observerToken","handler","response","urgeHandleSimulate","urgeHandle","batchVerifySigned","getWfUserHelpConfig","Date","getTime","getAdhocConfig","adhocAssignee","cancelConsult","Injectable","HttpService","MessagerService","tslib_1.__extends","TaskActionDef","TaskAction","translate","zh-CHS","static","assignee","title","noAssignee","successAssign","selectHandover","successTransfer","columnName","name","department","successComment","inputLabel","inputHolder","selectActivity","footOk","footCancel","selectUser","hideComment","cueWords","successClaim","successUnClaim","successRetrieve","successPass","successBack","successRefuse","success","inputOpinion","selectNode","select","processor","attachmentsRequired","assignUser","task","selectPlaceholder","passComment","processAlone","urgeText","backNodeText","selectProcessor","notFoundBill","nextNodeText","assignText","noUser","noTask","commentTooLong","activityName","receiver","urgeComment","noUrgeUsers","noUrgeSubject","noUrgeContent","person","selectProcess","submitSuccess","submitFailed","cancelSubmitSuccess","cancelSubmitFailed","dataIdIsNull","dataIdIsEmpty","bizDefKeyIsNull","row","failed","node","batchSubmit","single","batchStartProcess","validationFailed","add","save","cancel","content","order","manage","attachmentUpload","repeatFile","operate","confirm","clickToAdd","public","private","messageSubject","messageContent","attachment","tips","signature","reset","ok","sign","upload","dialogTitle","note1","note2","note3","disable","allowSignToSign","multiInstanceType","parallel","preempt","sequential","backWardConfig","allowResubmitToThisNode","en","addSignee","zh-CHT","I18nService","getValue","langData","split","reduce","obj","key","defaultLang","localStorage","getItem","TaskEntity","CompleteContext","Addendum","VerifySigned","AssigneeInfo","WorkItemExecuteParam","CounterSignParam","UrgeHandleSimulateContext","User","UrgeUser","UrgeHandleContext","BatchVerifySignedContext","WfContext","UrgeHandleComponent","ngOnInit","Component","args","selector","template","Input","placeholder","showMessageSubject","subjectEditable","contentEditable","Preempt","Parallel","Sequential","BasePayload","AddSignPayload","ActionBaseImplComponent","TaskExecuteComponent","ngAfterViewInit","load","loadingService","show","taskService","subscribe","configList","close","backComment","find","configCode","ConfigCode","if_store_comment","JSON","parse","pass","back","actionEntity","wfCacheComment","origin","ActionOrigin","TaskForm","initFormEvent","re","billMethodConfigs","processInstanceId","addMessageListener","window","addEventListener","eventHandler","func","setTask","sourceId","wfContext","processCategoryId","categoryId","setAction","execute","actionToken","gspWfEventService","register","formObject","ifRegistered","simulateToken","dataChanged","beforeCompleteSubmit","passPreActions","filter","executionTime","sort","x","y","sortOrder","executeFormActions","completeSubmit","formActions","Subject","console","log","data","result","subject","isClose","Error","formAction","shift","sendMessage","assignSimulate","showAttachment","transferSimulate","addSignSimulate","addSignFrontSimulate","notifySimulate","ifShowCommentToMySelf","dialogHeight","submit","assignSubmit","claimSubmit","unClaimSubmit","retrieveSubmit","transferSubmit","addSignSubmit","addSignFrontSubmit","commentSubmit","notifySubmit","readSubmit","urgeHandleSubmit","cancelConsultSubmit","asObservable","tasks","filterNum","BehaviorSubject","successSubmit","i18nService","noActionTasks","t","actions","findIndex","a","noActionTasks_1","tslib_1.__values","noActionTasks_1_1","showBatchSubmitInfo","actTasks_1","some","executeBatchEvent","preEvents","batch","passTasks","backTasks","backTasks_1","backTasks_1_1","batchVerifySignedcontext","batchverifySubmit","postEvents","successHandleTasks","verifyTasks","parameters","verifyTasksNum","that_1","caEvent","on","signedMsgOverToken","signedData","cert","gspCA","getCurCert","verifySigned","certBase64Info","getCertBase64","msg","signedmsg","useCase","batchComplete","otherTasks","getSignedMsg","conclusionValue","this_1","addendum","needInteraction","successNum","failedNum","errorNum","tasks_1","tasks_1_1","safeHtml","events","entities","injector","event_1","eventImpl","func_1","System","import","then","moduleFactories","moduleRef","values","taskList","preEventResult","instance","apply","ifAssignUser","dialogHeightBase","info","assignInfos","selectedAssignees","assigneeInfo","assignees","user","activityDefinitionName","dependency","anonymous","anonymousText","resolved","ifSelectUser","selectUserText","singleSelect","showSignToSign","originMultiInstType","organization","orgId","withAllOrg","includeChildren","orgList","ifSelectNode","ifUrgeType","commentPlaceHolder","showCommonComment","showUrgeMessageSubject","showSign","urgeHandleResponse","urgeUsers","urgeMessageSubject","urgeInfos","urgeMessageContent","addReminder","assignInfo","forEach","orgName","assigneeUsers","selectAssignee","multiSelect","load_1","selectNodeText","clearSimulateResult","showBackWardConfig","dynamicBackWardRuleAble","simulationPaths","destNodes","path","nodeInfoList","activityDefinitionId","join","defaultIndex","default","selectedNodeId","nodePlaceholder","setAssignInfo","cd","detectChanges","assigneeIds","submitResult","retrieveContext","selectedUsers","submitDisable","signAssignees","showMultiInstanceType","curMultiInstType","counterSignRule","completedRule","allowSignToSIgn","load_2","urgeHandleComponent","load_3","nextFlowNodes","dynamicBackWardRule","enable","nodes","nextFlowNode","startsWith","str","completeTask","completeContext","attachmentNecessary","entity","certificationNecessary","commentNecessary","verifySignature","taskComplete","executeFormActionsAfterCompleteTask","hander","postActions","executePostFormActions","afterConfirmForTransfer","selectedUserNgModule","MultiInstanceType","getSubject","selectNodeChange","index","every","nodeIds","load_4","selectNodeClear","afterConfirmForAssign","addAttachment","stringify","addSignature","signInfo","waterMarking","addPadding","cls","iframe","iframeWindow","nativeElement","contentWindow","target","command","method","methodParameters","postMessage","POST_MESSAGE_TARGET","that","cr","TaskCenter","handlerService","NotifyService","WfTaskHandlerService","LoadingService","Injector","ChangeDetectorRef","ViewChild","SysFarrisLookupComponent","HostBinding","_super","selectTargetAble","notGetCurrentUser","notGetStopUser","orderField","bindingData","textAreaHeight","groupIcon","document","location","event","removeEventListener","StartProcessPayload","FlowNodeInfo","CancelSubmitPayload","StartProcessCache","SelectedProcessItem","processDefinitionId","processDefinitionName","logTime","processCategory","ProcessSelectorComponent","defineProperty","dataId","_dataId","bizDefKey","showButtons","_bizDefKey","setParam","processDefinitionKey","dataModelId","startUserId","destProcesses","procDefs","process","procDefId","procDefName","version","selectedProcessId","setNextNode","processPlaceholder","selectedProcessId_1","getSelectedProcessCache","getDestNodes","selectProcessChange","nodeCombo","onClear","clearAssignInfos","nodeNames","payload_1","startProcessSubmit","openFromIframe","messager","subjectWithResponse","messageAfterSubmit","gspWfService","MessageType","handleSubmitMessage","setSelectedProcessCache","selectProcessClear","afterConfirm","subjectCancel","getSubjectWithResponse","getSubjectCancel","browserCache","selectedProcessList","undefined","item","setItem","browserCache_1","curLanguage","logService","showByDataId","refBizId","flowchartService","viewFlowChart","openApp","assignByInfo","compRef","resolver","resolveComponentFactory","modalConfig","width","height","buttons","dialog","modalService","getFormInfoLoading","loading","formInfo","appType","appId","appEntrance","tabId","isNewTab","Map","formType","set","entityParams","queryStringParams","openMenuLoading","frameworkService","openMenu$","refreshActions","pipe","switchMap","actionList","of","executeByProcInstId","executeByWorkItemId","configLoad","OwnerType","simulateLoad_1","showStartProcessDialog","executeLoad_1","withResponse","submitWithBizDefKey","cancelSubmitWithDataId","cancelSubmitPayload","batchSubmitWithBizDefKey","dataIds","startPayload","batchSubmitNum","batchSubmitHelpFunction","startPayload_1","variables","simulate","batchCancelSubmitWithDataId","batchCancelNum","batchCancelHelpFunction","cancelPayload","showBatchCancelSubmitInfo","childSubmit","parentDataId","childDataId","startProcessPayload","childCancelSubmit","childBatchSubmit","childDataIds","childBatchCancelSubmit","num","config","zh_CHS","zh_CHT","processSimulate","parent","viewFlowChartByDataId","viewFlowChartWithForecast","ForecastProcessPayload","viewProcess","WfApprovalLogsService","WFFlowchartService","ComponentFactoryResolver","BsModalService","FrameworkService","ApplicationRef","appRef","TranslatePipe","transform","defaultVal","Pipe","decorators","Optional","TaskAssigninfoComponent","AssigneeInfoComponent","ele","dataTableEle","querySelector","style","disabled","assignUserNgModule","_assigneeInfo","allowGlobalAssign","organizationScope","_selectedAssignees","clickAssignUser","extendUserHelp","showExtendUserHelp","showSysUserHelp","extendUserHelpUrl","showHelp","userList","emit","getAssignUsersByIds","myUserHelp","setTimeout","openMyUserHelpOutIframe","sysUserHelp","beforeOpenSysUserHelpOutIframe","myUserHelpDialog","myUserHelpEle","top","append","remove","secondDiv","marginLeft","marginTop","farrisLookUp","reSize","sysUserHelpDialog","el","parentElement","removeChild","draggable","resizable","showMaxButton","dialogOpened","openSysUserHelpOutIframe","afterUsersSelect","originAssignUserList","ID","Name","Code","OrgId","OrgName","orgNamePath","searchAssignUserList","myUserHelpSearch","value_1","includes","myUserHelpAfterSelect","myUserHelpTable","selections","myUserHelpCancel","assignUserClear","read","ElementRef","Output","myHelpBindingData","ifShowBlank","EventEmitter","columns","field","userHelpConfig","isExtend","ThrottleClickDirective","throttleTime","THROTTLE_TIME","click","throttleClick","ngOnDestroy","unsubscribe","onClick","evt","Directive","HostListener","FileUploadEntity","GspDocUploadEntity","GspDocMetadata","CommonComment","newEntity","TaskCommentComponent","enableSign","editSign","common","curUserId","userInfos","ifShowAttachment","ifShowSign","ifEnableSign","ifCanEditSign","_value","v","onModelChange","commentColumns","editor","EditorTypes","TEXTBOX","commentTypeCell","commentOperateCell","loadComments","onEditComment","dropDownEl","commentDialog","commentList","originCommentList","writeValue","registerOnChange","fn","registerOnTouched","onModelTouched","buttonClick","isRepeat","uploadDialog","uploadFile","_c","_d","_e","attachmentList","_f","messageService","rootId","metadataIdList","metadataId","attachmentDelete","gspDocDeleteEntity","mode","splice","imageUrl","showSignDialog","signDialog","clickToDeleteImage","signatureImage","clickToUseSign","ifUseImg","ifUseSign","canvas","signaturePad","canvasDiv","clickToUploadImg","farrisAvatar","clickToConfirm","image","isDraw","ifUploadImg","tmpSignatureImage","uploadSignatureImg","originSignId","clickToReset","clickToCancel","imgChange","base64","fileContent","filePath","metadata","docType","signId","lastModifiedTime","downloadService","getDownloadUrl","clickToDeleteComment","rowData","dataGrid","loadData","endCellEdit","httpSave","deleteIds","attachmentPreview","tabName","viewOptions","showHeader","showPaging","showThumbnails","showDownload","showSearch","showZoom","showPrint","showSecondaryToolBar","openMenu","providers","provide","NG_VALUE_ACCESSOR","useExisting","forwardRef","multi","UploadDialogService","DownloadService","beforeEdit","NgModule","declarations","imports","CommonModule","FormsModule","DataTableModule","FarrisDialogModule","PaginationModule","NotifyModule","ComboListModule","SysManagerUIModule","WfApprovalLogsModule","UiFlowchartModule","CommonSharedModule","LoadingModule","TaskImplApiModule","MessagerModule","InputGroupModule","WfSignModule","AvatarModule","FDropdownDirectiveTypeModule","DatagridModule","DatagridEditorsModule","forRoot","EditorProviders","FarrisFormsModule","SwitchModule","SessionService","CacheService","FrmEventBus","FuncsService","exports","entryComponents","WfTaskHandlerModule"],"mappings":"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","sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { HttpService } from '@ecp-caf/caf-common';\r\nimport { Observable, forkJoin } from 'rxjs';\r\nimport { AssignParameter } from '../entity/complete-response';\r\nimport { CompleteContext } from '../entity/complete-context';\r\nimport { BatchVerifySignedContext } from '../entity/batchVerifysigned';\r\nimport { MessagerService } from '@farris/ui-messager';\r\nimport { CancelSubmitPayload, StartProcessPayload } from '../entity/start-process-payload';\r\nimport { PostMessage } from '../entity/postMessage';\r\nimport { FileDeleteEntity, FileUploadEntity, GspDocUploadEntity } from '../entity/attachment';\r\nimport { WorkItemExecuteParam } from '../entity/workitem-execute-param';\r\nimport { UrgeHandleContext, UrgeHandleSimulateContext } from '../entity/urge-handle';\r\nimport { AddSignPayload } from '../entity/add-sign';\r\n\r\n@Injectable()\r\nexport class TaskService {\r\n\r\n    constructor(\r\n        private httpSvc: HttpService,\r\n        private message: MessagerService,\r\n    ) { }\r\n\r\n    getUsersByIds(ids: string[]): Observable<any> {\r\n        var pathUrl = '/api/runtime/sys/v1.0/users';\r\n        return forkJoin(ids.map(id => this.httpSvc.get(pathUrl + `/${id}` + `?mode=0002`)));\r\n    }\r\n    /**\r\n     * \r\n     */\r\n    getWorkItemActions(workItemId: string): Observable<any> {\r\n        const url = `/api/runtime/wf/v1.0/workItems/${workItemId}/actions`;\r\n        return this.httpSvc.get(url);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param context \r\n     */\r\n    complete(context: CompleteContext): Observable<any> {\r\n        const url = `/api/runtime/wf/v1.0/workItems/complete`;\r\n        return this.httpSvc.post(url, context);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param context \r\n     */\r\n    completeSimulate(context: CompleteContext): Observable<any> {\r\n        const url = `/api/runtime/wf/v1.0/workItems/complete-simulation`;\r\n        return this.httpSvc.post(url, context);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param workItemId Id\r\n     * @param action \r\n     */\r\n    getDestinationScope(workItemId: string, action: string): Observable<any> {\r\n        const url = `/api/runtime/wf/v1.0/workItems/${workItemId}/nextNodes/${action}`;\r\n        return this.httpSvc.get(url);\r\n    }\r\n\r\n    /**\r\n     * ID\r\n     * @param workItemId\r\n     * @param nodeId nodeIds=[\"node1\",\"node2\",]\r\n     * @returns  re: FlowNodeInfo[]\r\n     */\r\n    getSimulationAssigneeInfo(workItemId: string, nodeId: string): Observable<any> {\r\n        const url = `/api/runtime/wf/v1.0/workItems/${workItemId}/simulation-assigneeInfo?nodeIds=[${nodeId}]`;\r\n        return this.httpSvc.get(url);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param context \r\n     */\r\n    addSign(context: any): Observable<any> {\r\n        const url = `/api/runtime/wf/v1.0/workItems/counterSignAdd`;\r\n        return this.httpSvc.post(url, context);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param context \r\n     */\r\n    readTask(context: WorkItemExecuteParam): Observable<any> {\r\n        const url = `/api/runtime/wf/v1.0/workItems/read`;\r\n        return this.httpSvc.post(url, context);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param workItemId Id\r\n     */\r\n    getAppInfo(workItemId: string): Observable<any> {\r\n        const formParUrl = `/api/runtime/wf/v1.0/workItems/${workItemId}/formInfo`;\r\n        return this.httpSvc.get(formParUrl);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param taskId Id\r\n     * AssignInfo\r\n     */\r\n    getAssigneeInfo(taskId: string): Observable<any> {\r\n        const url = `/api/runtime/wf/v1.0/workItems/${taskId}/assigneeInfo`;\r\n        return this.httpSvc.get(url);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param workItemId\r\n     * @param actionCode\r\n     */\r\n    getOrganizationScope(workItemId: string, actionCode: string): Observable<any> {\r\n        const url = `/api/runtime/wf/v1.0/workItems/${workItemId}/organizationScope/${actionCode}`;\r\n        return this.httpSvc.get(url);\r\n    }\r\n\r\n    /**\r\n     * ID\r\n     * @param procInstId id\r\n     * @param state  25\r\n     */\r\n    getTaskByProcInstId(procInstId: string, state: number): Observable<any> {\r\n        const url = `/api/runtime/task/v1.0/tasks/processInstanceId?procInstId=${procInstId}&state=${state}`;\r\n        return this.httpSvc.get(url);\r\n    }\r\n\r\n    /**\r\n     * workitemID\r\n     * @param workItemId\r\n     */\r\n    getTaskByWorkItemId(workItemId: string): Observable<any> {\r\n        const url = `/api/runtime/task/v1.0/tasks/sourceId/${workItemId}`;\r\n        return this.httpSvc.get(url);\r\n    }\r\n\r\n    /**\r\n     * ID\r\n     * @param assigneesPa \r\n     */\r\n    assignNextUsersByWorkItemId(assigneesPa: AssignParameter): Observable<any> {\r\n        const url = `/api/runtime/wf/v1.0/workItems/assignUser`;\r\n        return this.httpSvc.post(url, assigneesPa);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param workItemId task id\r\n     * @param comment comment\r\n     */\r\n    retrieve(context: { workItemId: string, comment?: string }): Observable<any> {\r\n        const url = `/api/runtime/wf/v1.0/workItems/retrieve`;\r\n        return this.httpSvc.post(url, context);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param taskId Id\r\n     * @param targetUId Id\r\n     */\r\n    transfer(transferContext: any): Observable<any> {\r\n        const url = `/api/runtime/wf/v1.0/workItems/transfer`;\r\n        return this.httpSvc.post(url, transferContext);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param taskId Id\r\n     * @param targetUId Id\r\n     */\r\n    comment(commentContext: any): Observable<any> {\r\n        const url = `/api/runtime/wf/v1.0/workItems/comment`;\r\n        return this.httpSvc.post(url, commentContext);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param taskId Id\r\n     */\r\n    claim(taskId: string, comment: string): Observable<any> {\r\n        const url = `/api/runtime/wf/v1.0/workItems/claim`;\r\n        const options = {\r\n            workItemId: taskId,\r\n            comment: comment\r\n        };\r\n        return this.httpSvc.post(url, options);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param taskId Id\r\n     */\r\n    unClaim(taskId: string, comment: string): Observable<any> {\r\n        const url = `/api/runtime/wf/v1.0/workItems/unclaim`;\r\n        const options = {\r\n            workItemId: taskId,\r\n            comment: comment\r\n        };\r\n        return this.httpSvc.post(url, options);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param error\r\n     */\r\n    error(error: any) {\r\n        if (error && error.error && error.error.Message) {\r\n            var message = error.error.Message;\r\n            this.message.warning(message);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param payload API\r\n     */\r\n    startProcess(payload: StartProcessPayload): Observable<any> {\r\n        const url = `/api/runtime/wf/v1.0/processInstances/startProcess`;\r\n        return this.httpSvc.post(url, payload);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param payload API\r\n     */\r\n    startProcessSimulate(payload: StartProcessPayload): Observable<any> {\r\n        const url = `/api/runtime/wf/v1.0/processInstances/startProcess-simulation`;\r\n        return this.httpSvc.post(url, payload);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param param \r\n     */\r\n    cancelSubmit(param: CancelSubmitPayload): Observable<any> {\r\n        const url = `/api/runtime/wf/v1.0/processInstances/cancelSubmit`;\r\n        return this.httpSvc.post(url, param);\r\n    }\r\n\r\n    static newId() {\r\n        const S4 = () => (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);\r\n        return (S4() + S4() + '-' + S4() + '-' + S4() + '-' + S4() + '-' + S4() + S4() + S4());\r\n    }\r\n\r\n\r\n    getCommentList(): Observable<any> {\r\n        const url = `/api/runtime/wf/v1.0/commonComments`;\r\n        return this.httpSvc.get(url);\r\n    }\r\n\r\n    addComment(): Observable<any> {\r\n        const url = `/api/runtime/wf/v1.0/commonComments`;\r\n        return this.httpSvc.post(url, {});\r\n    }\r\n\r\n    /**\r\n       * \r\n       * @param code Code\r\n       */\r\n    getTaskCenterConfigByCode(code: string, ownerType?: string, ownerId?: string): Observable<any> {\r\n        let url = `/api/runtime/task/v1.0/task-center-setting/code?code=${code}`;\r\n        ownerType && (url += `&ownerType=${ownerType}`);\r\n        ownerId && (url += `&ownerId=${ownerId}`);\r\n        return this.httpSvc.get(url);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param code \r\n     */\r\n    addTaskCenterConfig(code: string, currentValue: string): Observable<any> {\r\n        let url = `/api/runtime/task/v1.0/task-center-setting/add?configCode=${code}&currentValue=${currentValue}`;\r\n        return this.httpSvc.post(url, null);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @returns\r\n     */\r\n    getAllUserConfig(): Observable<any> {\r\n        let url = `/api/runtime/task/v1.0/task-center-setting/all`;\r\n        return this.httpSvc.get(url);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param files\r\n     */\r\n    uploadAttachment(files: FileUploadEntity): Observable<any> {\r\n        let url = `/api/runtime/dfs/v1.0/doc/commit`;\r\n        return this.httpSvc.put(url, files);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param fileDeleteEntity\r\n     */\r\n    deleteAttachment(fileDeleteEntity: FileDeleteEntity): Observable<any> {\r\n        let url = `/api/runtime/dfs/v1.0/doc`;\r\n        return this.httpSvc.delete(url, fileDeleteEntity);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    uploadSignature(gspDocUploadEntity: GspDocUploadEntity): Observable<any> {\r\n        let url = `/api/runtime/dfs/v1.0/doc`;\r\n        let header = this.httpSvc.setHeader({\r\n            body: gspDocUploadEntity,\r\n            responseType: 'text'\r\n        })\r\n        return this.httpSvc.request('Post', url, header);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    createNM() {\r\n        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\r\n            const r = Math.random() * 16 | 0, v = c === 'x' ? r : (r & 0x3 | 0x8);\r\n            return v.toString(16);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    getUserInfo(): Observable<any> {\r\n        let url = `/api/runtime/sys/v1.0/userinfos?infoType=user`;\r\n        return this.httpSvc.get(url);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    getUserSign(userId: string): Observable<any> {\r\n        let url = `/api/runtime/dfs/v1.0/formdoc/fileinfo/form?formid=${userId}&rootid=taskcentersignature`;\r\n        return this.httpSvc.get(url);\r\n    }\r\n\r\n\r\n    /**\r\n     * \r\n     * @param attachmentInfo\r\n     */\r\n    createItem(attachmentInfo: any) {\r\n        var pos = attachmentInfo.fileName.lastIndexOf(\".\");\r\n        var type = attachmentInfo.fileName.substring(pos + 1);\r\n        type = (type == '' ? 'Default' : type.toLowerCase());\r\n        var docLib = 'doc-docx-htm-html-js-pdf-ppt-pptx-rar-zip-txt-xls-xlsx';\r\n        var videoLib = 'wav-aif-aiff-au-mp1-mp2-mp3-ra-rm-ram-mid-rmi';\r\n        var audioLib = 'avi-rm-rmvb-mpeg-mpg-dat-mov-qt-asf-wm-mp4';\r\n        var imgLib = 'webp-baibmp-dupcx-tif-gif-jpeg-tga-exif-fpx-svg-psd-cdr-pcd-dxf-ufo-eps-ai-png-hdri-raw-wmf-flic-emf-ico-jpg';\r\n        if (docLib.indexOf(type) >= 0) {\r\n            type = type.toLowerCase();\r\n        } else if (videoLib.indexOf(type) >= 0) {\r\n            type = 'video';\r\n        } else if (audioLib.indexOf(type) >= 0) {\r\n            type = 'audio';\r\n        } else if (imgLib.indexOf(type) >= 0) {\r\n            type = 'picture';\r\n        } else {\r\n            type = 'default';\r\n        }\r\n        return type;\r\n    }\r\n\r\n    /**\r\n     * token\r\n     * @param subjectCode token\r\n     * @param token \r\n     * @returns \r\n     */\r\n    subjectRegister(subjectCode: string, token: string) {\r\n        return (window as any).gspframeworkService.rtf.broadcast.subjectRegister(subjectCode, { funcId: token });\r\n    }\r\n\r\n    /**\r\n     * token\r\n     * @param subjectToken token\r\n     * @param message \r\n     */\r\n    subjectNotify(subjectToken: string, message: any) {\r\n        (window as any).gspframeworkService.rtf.broadcast.notify(subjectToken, message);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param subjectToken token\r\n     * @param observerToken token\r\n     * @param handler \r\n     */\r\n    subjectResponse(subjectToken: string, observerToken: string, handler: (value: any) => void) {\r\n        (window as any).gspframeworkService.rtf.broadcast.response(subjectToken, observerToken, handler);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param context \r\n     * @returns\r\n     */\r\n    urgeHandleSimulate(context: UrgeHandleSimulateContext): Observable<any> {\r\n        let url = `/api/runtime/wf/v1.0/processInstances/getUrgeHandleInfo`;\r\n        return this.httpSvc.post(url, context);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param context \r\n     * @returns\r\n     */\r\n    urgeHandle(context: UrgeHandleContext): Observable<any> {\r\n        let url = `/api/runtime/wf/v1.0/processInstances/urgeHandle`;\r\n        return this.httpSvc.post(url, context);\r\n    }\r\n\r\n    /**\r\n     * @param context \r\n     */\r\n    batchVerifySigned(context: BatchVerifySignedContext): Observable<any> {\r\n        const url = `/api/runtime/wf/v1.0/workItems/batchVerifySigned`;\r\n        return this.httpSvc.post(url, context);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @returns \r\n     */\r\n    getWfUserHelpConfig(): Observable<any> {\r\n        const url = `/platform/runtime/wf/web/wf-user-help/config.json?v=` + new Date().getTime();\r\n        return this.httpSvc.get(url);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    getAdhocConfig(workItemId: string): Observable<any> {\r\n        let url = `/api/runtime/wf/v1.0/workItems/${workItemId}/adhocConfig/AddSignBehind`;\r\n        return this.httpSvc.get(url);\r\n    }\r\n    /**\r\n     * \r\n     */\r\n    adhocAssignee(payload: AddSignPayload) {\r\n        let url = `/api/runtime/wf/v1.0/workItems/adhocAssignee`;\r\n        return this.httpSvc.post(url, payload);\r\n    }\r\n    /**\r\n     * \r\n     */\r\n    cancelConsult(payload: WorkItemExecuteParam) {\r\n        let url = `/api/runtime/wf/v1.0/workItems/cancelConsult`;\r\n        return this.httpSvc.post(url, payload);\r\n    }\r\n}\r\n","/**\r\n * \r\n */\r\nexport class ActionParameter {\r\n    /**\r\n     * \r\n     */\r\n    code: string;\r\n    /**\r\n     * \r\n     */\r\n    value: string;\r\n}\r\n/**\r\n * \r\n */\r\nexport class TaskActionDef {\r\n    /**\r\n     * id\r\n     */\r\n    id: string;\r\n    /**\r\n     * \r\n     */\r\n    code: string;\r\n    /**\r\n     * \r\n     */\r\n    name: string;\r\n    /**\r\n     * \r\n     */\r\n    impl: string;\r\n    /**\r\n     * \r\n     */\r\n    isBatchAction: boolean;\r\n    /**\r\n     * \r\n     */\r\n    isHyperlinkAction: boolean;\r\n    /**\r\n     * \r\n     */\r\n    isPrimaryAction: boolean;\r\n    /**\r\n     * \r\n     */\r\n    sortOrder: number;\r\n    /**\r\n     * id\r\n     */\r\n    typeId: string;\r\n    /**\r\n     * \r\n     */\r\n    preEvents?: ActionEvent[];\r\n    /**\r\n     * \r\n     */\r\n    postEvents?: ActionEvent[];\r\n}\r\n/**\r\n * \r\n */\r\nexport class TaskAction extends TaskActionDef {\r\n    /**\r\n     * \r\n     */\r\n    code: string;\r\n    /**\r\n     * \r\n     */\r\n    parameters: ActionParameter[];\r\n}\r\n\r\nexport class ActionEvent {\r\n    /**\r\n     * ID\r\n     */\r\n    id: string;\r\n    /**\r\n     * \r\n     */\r\n    taskCategoryId: string;\r\n    /**\r\n     * \r\n     */\r\n    actionCode: string;\r\n    /**\r\n     * \r\n     */\r\n    eventImpl: string;\r\n    /**\r\n     * \r\n     */\r\n    sortOrder: number;\r\n    /**\r\n     * webapp\r\n     */\r\n    terminal: string;\r\n    /**\r\n     * Pre,Post\r\n     */\r\n    type: string;\r\n    /**\r\n     * \r\n     */\r\n    batch: boolean;\r\n}\r\n","export const en = {\r\n  static: {\r\n    assignee: {\r\n      title: 'Select Operator',\r\n      noAssignee: 'Please select at least one approver.',\r\n      successAssign: 'Operate successfully.',\r\n    },\r\n    transfer: {\r\n      title: 'Select transfer person',\r\n      selectHandover: 'Please select transfer persons.',\r\n      successTransfer: 'Transfer successfully.'\r\n    },\r\n    comment: {\r\n      successComment: 'Comment success.'\r\n    },\r\n    columnName: {\r\n      name: 'Name',\r\n      code: 'Code',\r\n      department: 'Department',\r\n    },\r\n    title: 'Approval confirmation',\r\n    inputLabel: 'Approval comments',\r\n    inputHolder: 'Please enter an approval opinion',\r\n    selectActivity: 'Please select approve note',\r\n    addSignee: 'Add signee',\r\n    footOk: 'OK',\r\n    footCancel: 'Cancel',\r\n    selectUser: 'Select User',\r\n    hideComment: 'Hide comment',\r\n  },\r\n  cueWords: {\r\n    successClaim: 'Claim successfully.',\r\n    successUnClaim: 'Cancel to claim successfully.',\r\n    successRetrieve: 'Retrieve successfully.',\r\n    successPass: 'Approved successfully.',\r\n    successBack: 'Dismissed successfully.',\r\n    successRefuse: 'Veto successfully.',\r\n    success: 'Operate successfully.',\r\n    inputOpinion: 'Please input your opinion',\r\n    selectNode: 'Please select target nodes',\r\n    select: 'Please select',\r\n    processor: 'processor',\r\n    attachmentsRequired: 'Please upload the attachment',\r\n    assignUser: 'Assign user'\r\n  },\r\n  task: {\r\n    selectPlaceholder: 'Please select',\r\n    passComment: 'Pass',\r\n    processAlone: 'Please handle it separately',\r\n    urgeText: 'Receiver',\r\n    backNodeText: 'Back node',\r\n    selectProcessor: 'Please select the user',\r\n    notFoundBill: 'This document cannot be processed on the computer. Please try to process it on the mobile terminal',\r\n    nextNodeText: 'Next node',\r\n    assignText: 'Assign to',\r\n    noUser: 'No one',\r\n    title: 'Handle Task',\r\n    noTask: 'There is no task.',\r\n    commentTooLong: 'Comment is too long',\r\n    activityName: 'processor',\r\n    receiver: 'receiver',\r\n    urgeComment: \"Please input your comment\",\r\n    noUrgeUsers: \"There is no user to urge handle\",\r\n    noUrgeSubject: \"no urge subject\",\r\n    noUrgeContent: \"no urge content\",\r\n    person: \" people\",\r\n    addSign: \"Add sign\",\r\n  },\r\n  startProcess: {\r\n    selectProcess: 'Please select process',\r\n    title: 'Select process',\r\n    selectNode: 'Please select next node',\r\n    submitSuccess: 'Start process successfully',\r\n    submitFailed: 'Start process failed',\r\n    cancelSubmitSuccess: 'Cancel submit successfully',\r\n    cancelSubmitFailed: 'Cancel submit failed',\r\n    dataIdIsNull: 'Please select a data',\r\n    dataIdIsEmpty: 'Please select a data',\r\n    bizDefKeyIsNull: 'Biz definition key is null',\r\n    success: 'Success',\r\n    row: '',\r\n    failed: ', failed',\r\n    node: 'node, ',\r\n    noUser: 'no suitable handler was found'\r\n  },\r\n  batchSubmit: {\r\n    row: '',\r\n    success: 'Success',\r\n    error: 'Error',\r\n    failed: 'Failed',\r\n    validationFailed: 'Signature verification failed',\r\n    single: 'Failed tasks please process it singly'\r\n  },\r\n  batchStartProcess: {\r\n    row: '<br/>',\r\n    success: 'Success',\r\n    error: 'Error',\r\n    failed: 'Failed',\r\n    single: 'Failed tasks please process it singly'\r\n  },\r\n  comment: {\r\n    static: {\r\n      title: 'Approval comments',\r\n      add: 'Add',\r\n      delete: 'Delete',\r\n      save: 'Save',\r\n      cancel: 'Cancel',\r\n      content: 'Content',\r\n      order: 'Order',\r\n      inputLabel: 'Comments',\r\n      manage: 'Comments management',\r\n      attachmentUpload: 'Attachment',\r\n      repeatFile: 'Contains repeat files:',\r\n      type: 'Type',\r\n      operate: 'Operate',\r\n      confirm: 'Confirm',\r\n      clickToAdd: 'Click to add',\r\n      public: 'public',\r\n      private: 'private',\r\n      messageSubject: 'message subject',\r\n      messageContent: 'message content'\r\n    },\r\n    attachment: {\r\n      tips: 'click to upload attachments'\r\n    },\r\n    signature: {\r\n      title: 'Signature',\r\n      reset: 'Reset',\r\n      ok: 'OK',\r\n      sign: 'Sign, ',\r\n      upload: 'Upload',\r\n      tips: 'click to sign or upload a picture',\r\n      dialogTitle: 'Signature',\r\n      note1: '',\r\n      note2: 'or',\r\n      note3: '',\r\n      disable: 'disable signature'\r\n    }\r\n  },\r\n  addSign: {\r\n    allowSignToSign: 'Allow',\r\n    multiInstanceType: 'Multi instance type',\r\n    parallel: 'parallel',\r\n    preempt: 'preempt',\r\n    sequential: 'sequential'\r\n  },\r\n  backWardConfig: {\r\n    allowResubmitToThisNode:',resubmit to this node'\r\n  }\r\n};\r\n","import { en } from './en';\r\nimport { zh_CHT } from './zh-cht';\r\nimport { zh_CHS } from './zh-chs';\r\n\r\nexport const translate = {\r\n    'zh-CHS': zh_CHS,\r\n    'en': en,\r\n    'zh-CHT': zh_CHT\r\n};\r\n","export const zh_CHS = {\r\n  static: {\r\n    assignee: {\r\n      title: '',\r\n      noAssignee: '',\r\n      successAssign: '',\r\n    },\r\n    transfer: {\r\n      title: '',\r\n      selectHandover: '',\r\n      successTransfer: ''\r\n    },\r\n    columnName: {\r\n      name: '',\r\n      code: '',\r\n      department: '',\r\n    },\r\n    comment: {\r\n      successComment: ''\r\n    },\r\n    title: '',\r\n    inputLabel: '',\r\n    inputHolder: '',\r\n    selectActivity: '',\r\n    footOk: '',\r\n    footCancel: '',\r\n    selectUser: '',\r\n    hideComment: '',\r\n  },\r\n  cueWords: {\r\n    successClaim: '',\r\n    successUnClaim: '',\r\n    successRetrieve: '',\r\n    successPass: '',\r\n    successBack: '',\r\n    successRefuse: '',\r\n    success: '',\r\n    inputOpinion: '',\r\n    selectNode: '',\r\n    select: '',\r\n    processor: '',\r\n    attachmentsRequired: '',\r\n    assignUser: ''\r\n  },\r\n  task: {\r\n    selectPlaceholder: '',\r\n    passComment: '',\r\n    processAlone: '',\r\n    urgeText: '',\r\n    backNodeText: '',\r\n    selectProcessor: '',\r\n    notFoundBill: '',\r\n    nextNodeText: '',\r\n    assignText: '',\r\n    noUser: '',\r\n    title: '',\r\n    noTask: '',\r\n    commentTooLong: '',\r\n    activityName: '',\r\n    receiver: \"\",\r\n    urgeComment: \"\",\r\n    noUrgeUsers: \"\",\r\n    noUrgeSubject: \"\",\r\n    noUrgeContent: \"\",\r\n    person: \"\",\r\n    addSign: \"\",\r\n  },\r\n  startProcess: {\r\n    selectProcess: '',\r\n    title: '',\r\n    selectNode: '',\r\n    submitSuccess: '',\r\n    submitFailed: '',\r\n    cancelSubmitSuccess: '',\r\n    cancelSubmitFailed: '',\r\n    dataIdIsNull: '',\r\n    dataIdIsEmpty: '',\r\n    bizDefKeyIsNull: 'ID',\r\n    success: '',\r\n    row: '<br/>',\r\n    failed: '',\r\n    node: '',\r\n    noUser: ''\r\n  },\r\n  batchSubmit: {\r\n    row: '<br/>',\r\n    success: '',\r\n    error: '',\r\n    failed: '',\r\n    single: ''\r\n  },\r\n  batchStartProcess: {\r\n    row: '<br/>',\r\n    success: '',\r\n    error: '',\r\n    failed: '',\r\n    validationFailed: '',\r\n    single: ''\r\n  },\r\n  comment: {\r\n    static: {\r\n      title: '',\r\n      add: '',\r\n      delete: '',\r\n      save: '',\r\n      cancel: '',\r\n      content: '',\r\n      order: '',\r\n      inputLabel: '',\r\n      manage: '',\r\n      attachmentUpload: '',\r\n      repeatFile: '',\r\n      type: '',\r\n      operate: '',\r\n      confirm: '',\r\n      clickToAdd: '',\r\n      public: '',\r\n      private: '',\r\n      messageSubject: '',\r\n      messageContent: ''\r\n    },\r\n    attachment: {\r\n      tips: ''\r\n    },\r\n    signature: {\r\n      title: '',\r\n      reset: '',\r\n      ok: '',\r\n      sign: '',\r\n      upload: '',\r\n      tips: '',\r\n      dialogTitle: '',\r\n      note1: '',\r\n      note2: '',\r\n      note3: '',\r\n      disable: ''\r\n    }\r\n  },\r\n  addSign: {\r\n    allowSignToSign: '',\r\n    multiInstanceType: '',\r\n    parallel: '',\r\n    preempt: '',\r\n    sequential: ''\r\n  },\r\n  backWardConfig: {\r\n    allowResubmitToThisNode:''\r\n  }\r\n};\r\n","export const zh_CHT = {\r\n  static: {\r\n    assignee: {\r\n      title: '',\r\n      noAssignee: '',\r\n      successAssign: '',\r\n    },\r\n    transfer: {\r\n      title: '',\r\n      selectHandover: '',\r\n      successTransfer: ''\r\n    },\r\n    columnName: {\r\n      name: '',\r\n      code: '',\r\n      department: '',\r\n    },\r\n    comment: {\r\n      successComment: ''\r\n    },\r\n    title: '',\r\n    inputLabel: '',\r\n    inputHolder: '',\r\n    selectActivity: '',\r\n    addSignee: '',\r\n    footOk: '',\r\n    footCancel: '',\r\n    selectUser: '',\r\n    hideComment: '',\r\n  },\r\n  cueWords: {\r\n    successClaim: '',\r\n    successUnClaim: '',\r\n    successRetrieve: '',\r\n    successPass: '',\r\n    successBack: '',\r\n    successRefuse: '',\r\n    success: '',\r\n    inputOpinion: '',\r\n    selectNode: '',\r\n    select: '',\r\n    processor: '',\r\n    attachmentsRequired: '',\r\n    assignUser: ''\r\n  },\r\n  task: {\r\n    selectPlaceholder: '',\r\n    passComment: '',\r\n    processAlone: '',\r\n    urgeText: '',\r\n    backNodeText: '',\r\n    selectProcessor: '',\r\n    notFoundBill: '',\r\n    nextNodeText: '',\r\n    assignText: '',\r\n    noUser: '',\r\n    title: '',\r\n    noTask: '',\r\n    commentTooLong: '',\r\n    activityName: '',\r\n    receiver: \"\",\r\n    urgeComment: \"\",\r\n    noUrgeUsers: \"\",\r\n    noUrgeSubject: \"\",\r\n    noUrgeContent: \"\",\r\n    person: \"\",\r\n    addSign: \"\",\r\n  },\r\n  startProcess: {\r\n    selectProcess: '',\r\n    title: '',\r\n    selectNode: '',\r\n    submitSuccess: '',\r\n    submitFailed: '',\r\n    cancelSubmitSuccess: '',\r\n    cancelSubmitFailed: '',\r\n    dataIdIsNull: '',\r\n    dataIdIsEmpty: '',\r\n    bizDefKeyIsNull: 'ID',\r\n    success: '',\r\n    row: '<br/>',\r\n    failed: '',\r\n    node: '',\r\n    noUser: ''\r\n  },\r\n  batchSubmit: {\r\n    row: '<br/>',\r\n    success: '',\r\n    error: '',\r\n    failed: '',\r\n    single: ''\r\n  },\r\n  batchStartProcess: {\r\n    row: '<br/>',\r\n    success: '',\r\n    error: '',\r\n    failed: '',\r\n    validationFailed: '',\r\n    single: ''\r\n  },\r\n  comment: {\r\n    static: {\r\n      title: '',\r\n      add: '',\r\n      delete: '',\r\n      save: '',\r\n      cancel: '',\r\n      content: '',\r\n      order: '',\r\n      inputLabel: '',\r\n      manage: '',\r\n      attachmentUpload: '',\r\n      repeatFile: '',\r\n      type: '',\r\n      operate: '',\r\n      confirm: '',\r\n      clickToAdd: '',\r\n      public: '',\r\n      private: '',\r\n      messageSubject: '',\r\n      messageContent: ''\r\n    },\r\n    attachment: {\r\n      tips: ''\r\n    },\r\n    signature: {\r\n      title: '',\r\n      reset: '',\r\n      ok: '',\r\n      sign: '',\r\n      upload: '',\r\n      tips: '',\r\n      dialogTitle: '',\r\n      note1: '',\r\n      note2: '',\r\n      note3: '',\r\n      disable: ''\r\n    }\r\n  },\r\n  addSign: {\r\n    allowSignToSign: '',\r\n    multiInstanceType: '',\r\n    parallel: '',\r\n    preempt: '',\r\n    sequential: ''\r\n  },\r\n  backWardConfig: {\r\n    allowResubmitToThisNode:''\r\n  }\r\n};\r\n","import { Pipe, PipeTransform, Injectable } from '@angular/core';\r\nimport { Observable, of } from 'rxjs';\r\nimport { translate } from './index';\r\n\r\n@Injectable()\r\nexport class I18nService {\r\n    defaultLang: string;\r\n    langData: any;\r\n    constructor() {\r\n        this.defaultLang = localStorage.getItem('languageCode');\r\n        if (!this.defaultLang) {\r\n            this.langData = translate['zh-CHS'];\r\n        } else {\r\n            this.langData = translate[this.defaultLang];\r\n        }\r\n    }\r\n\r\n    getValue(name: string): any {\r\n        if (!name) {\r\n            return '';\r\n        }\r\n        let resultVal = '';\r\n        if (name.indexOf('.') === -1) {\r\n            resultVal = this.langData[name];\r\n        } else {\r\n            resultVal = name.split('.').reduce((obj, key) => {\r\n                if (obj) {\r\n                    return obj[key];\r\n                } else {\r\n                    return null;\r\n                }\r\n            }, this.langData);\r\n        }\r\n        return resultVal;\r\n    }\r\n}\r\n","import { TaskAction, ActionParameter } from './task-action';\r\n\r\n/**\r\n * \r\n */\r\nexport enum TaskState {\r\n    /**\r\n     * \r\n     */\r\n    todo = 2,\r\n    /**\r\n     * \r\n     */\r\n    done = 5,\r\n}\r\n/**\r\n * \r\n */\r\nexport class TaskEntity {\r\n\r\n    id: string;\r\n\r\n    name: string;\r\n\r\n    categoryId: string;\r\n\r\n    state: TaskState;\r\n\r\n    startTime: Date;\r\n\r\n    endTime?: Date;\r\n\r\n    dueDate?: string;\r\n\r\n    targetDate?: string;\r\n\r\n    owner: string;\r\n\r\n    executor: string;\r\n\r\n    sourceId: string;\r\n\r\n    description: string;\r\n\r\n    taskType: number;\r\n\r\n    priority: number;\r\n\r\n    submitter: string;\r\n\r\n    processInstanceId: string;\r\n\r\n    fStr1: string;\r\n    fStr2: string;\r\n    fStr3: string;\r\n    fStr4: string;\r\n    fStr5: string;\r\n    fStr6: string;\r\n    fStr7: string;\r\n    fStr8: string;\r\n\r\n    fTime1?: Date;\r\n    fTime2?: Date;\r\n    fTime3?: Date;\r\n    fTime4?: Date;\r\n\r\n    fDec1: number;\r\n    fDec2: number;\r\n    fDec3: number;\r\n    fDec4: number;\r\n\r\n    fText1: string;\r\n    fText2: string;\r\n    fText3: string;\r\n    fText4: string;\r\n\r\n    actions: TaskAction[];\r\n    refBizId: string;\r\n    conclusionValue: string;\r\n}\r\n","import { FlowNodeInfo } from './start-process-payload';\r\n\r\nexport class CompleteContext {\r\n\r\n    workItemId: string;\r\n\r\n    conclusionValue: string;\r\n\r\n    comment: string;\r\n\r\n    signAssignees: string[];\r\n\r\n    nextFlowNodes: FlowNodeInfo[];\r\n\r\n    addendum: Addendum;\r\n\r\n    verifySigned?: VerifySigned;\r\n\r\n    dynamicBackWardRule: string;\r\n}\r\n\r\nexport class Addendum {\r\n\r\n    signature: string;\r\n\r\n    attachment: string;\r\n}\r\n\r\nexport class VerifySigned {\r\n\r\n    certBase64Info: string;\r\n\r\n    msg: string[];\r\n\r\n    signedmsg: string;\r\n\r\n    useCase: string;\r\n}\r\n","import { OrganizationScope } from './organization-scope';\r\nimport { User } from './user';\r\nimport { FlowNodeInfo } from './start-process-payload';\r\nimport { ProcessDefinition } from './execution-response';\r\nimport { Addendum } from './complete-context';\r\n\r\n/**\r\n * \r\n */\r\nexport class AssigneeInfo {\r\n\r\n    /**\r\n     * ID\r\n     */\r\n    workItemId: string;\r\n\r\n    /**\r\n     * \r\n     */\r\n    assigneeIds: string[];\r\n\r\n    /**\r\n     * \r\n     */\r\n    assigneeUsers: User[];\r\n\r\n    /**\r\n     * \r\n     */\r\n    selectAssignee: boolean;\r\n\r\n    /**\r\n     * \r\n     */\r\n    multiSelect: boolean;\r\n\r\n    /**\r\n     * \r\n     */\r\n    allowGlobalAssign: boolean;\r\n\r\n    /**\r\n     * \r\n     */\r\n    organizationScope: OrganizationScope[];\r\n}\r\n\r\n/**\r\n * \r\n */\r\nexport class AssignParameter {\r\n\r\n    workItemId: string;\r\n\r\n    assigneeIds: string[];\r\n\r\n    comment: string;\r\n\r\n    addendum?: Addendum;\r\n}\r\n\r\n\r\n/**\r\n * \r\n */\r\nexport class CompleteResponse {\r\n\r\n    dataId: string;\r\n\r\n    needInteraction: boolean;\r\n\r\n    nextAssigneeInfos: AssigneeInfo[];\r\n\r\n    procInstId: string;\r\n\r\n    nextFlowNodes: FlowNodeInfo[];//\r\n\r\n    procDefs: ProcessDefinition[];\r\n}\r\n\r\n","/**\r\n * \r\n */\r\nexport class TaskCenterConfig {\r\n\r\n    id: string;\r\n\r\n    configCode: string;\r\n\r\n    configName: string;\r\n\r\n    configNote: string;\r\n\r\n    defaultValue: string;\r\n\r\n    currentValue: string;\r\n\r\n    displayText: string;\r\n\r\n    ownerId: string;\r\n\r\n    ownerType: string;\r\n\r\n    creator: string;\r\n\r\n    createTime: string;\r\n\r\n    lastModifier: string;\r\n\r\n    lastModifiedTime: string;\r\n\r\n}\r\n\r\n/**\r\n * Code\r\n */\r\nexport enum ConfigCode {\r\n\r\n    If_Show_Submit_Dialog = 'If_Show_Submit_Dialog',\r\n\r\n    Info_After_Submit = 'Info_After_Submit',\r\n\r\n    Info_After_Cancel_Submit = 'Info_After_Cancel_Submit',\r\n\r\n    If_Use_Sign_By_Default = 'If_Use_Sign_By_Default',\r\n\r\n    If_Show_Attachment = 'If_Show_Attachment',\r\n\r\n    If_Show_Signature = 'If_Show_Signature',\r\n\r\n    Default_Approval_Comment = 'Default_Approval_Comment',\r\n\r\n    If_Store_Comment = 'If_Store_Comment',\r\n\r\n    User_Help_Type = 'User_Help_Type',\r\n\r\n    If_Can_Edit_Signature = 'If_Can_Edit_Signature'\r\n}\r\n\r\n/**\r\n * \r\n */\r\nexport enum OwnerType {\r\n\r\n    User = 'user',//\r\n\r\n    Category = 'category',//\r\n\r\n    BizDefKey = 'bizdefkey',//\r\n\r\n    All = 'all',//\r\n}","import { Addendum } from \"./complete-context\";\r\n\r\n/**\r\n * \r\n */\r\nexport class WorkItemExecuteParam {\r\n\r\n    workItemId: string;\r\n\r\n    comment: string;\r\n\r\n    addendum: Addendum;\r\n\r\n    hideComment?: boolean;\r\n}\r\n\r\n/**\r\n * \r\n */\r\nexport class CounterSignParam extends WorkItemExecuteParam {\r\n\r\n    action: string;//AddSignFrontAddSignBehindNotify\r\n\r\n    assignees: string[];\r\n\r\n}","export class User {\r\n\r\n    id: string;\r\n\r\n    code?: string;\r\n\r\n    name: string;\r\n\r\n    note?: string;\r\n\r\n    orgId?: string;\r\n\r\n    orgCode?: string;\r\n\r\n    orgName?: string;\r\n\r\n    orgNamePath?: string;//\r\n\r\n    orderNum?: number\r\n}","import {User} from \"./user\";\r\n\r\n/**\r\n * body\r\n */\r\nexport class UrgeHandleSimulateContext {\r\n\r\n  procInstId: string;\r\n\r\n}\r\n\r\n/**\r\n * \r\n */\r\nexport class UrgeHandleResponse {\r\n\r\n  urgeUsers: UrgeUser[];\r\n\r\n}\r\n\r\n/**\r\n * \r\n */\r\nexport class UrgeUser extends User {\r\n\r\n  urgeInfos: UrgeInfo[];\r\n\r\n  anonymousText: string;\r\n\r\n  sendTypes: string;\r\n\r\n}\r\n\r\n/**\r\n * body\r\n */\r\nexport class UrgeHandleContext {\r\n\r\n  procInstId: string;\r\n\r\n  urgeUsers: UrgeUser[];\r\n\r\n  urgeMessageSubject: string;\r\n\r\n  urgeMessageContent: string;\r\n\r\n  addReminder: boolean;\r\n\r\n}\r\n\r\nexport class UrgeInfo {\r\n\r\n  workItemId: string;\r\n\r\n  activityInstanceId: string;\r\n\r\n  sendTypes: string;\r\n\r\n  urgeMessageSubject: string;\r\n\r\n  urgeMessageContent: string;\r\n\r\n  addReminder: boolean;\r\n\r\n  subjectEditable: boolean;\r\n\r\n  contentEditable: boolean;\r\n}\r\n","export class BatchVerifySignedContext {\r\n\r\n  verifySigned: VerifySigned;\r\n\r\n}\r\nexport class VerifySigned {\r\n\r\n  certBase64Info: string;\r\n\r\n  msg: string[];\r\n\r\n  signedmsg: string;\r\n\r\n  useCase: string;\r\n\r\n}\r\n","/**\r\n * \r\n */\r\nexport class WfContext {\r\n\r\n    processCategoryId: string;\r\n    \r\n}","import { Component, Input, OnInit } from '@angular/core';\r\n\r\n@Component({\r\n  selector: 'urge-handle',\r\n  templateUrl: './urge-handle.component.html',\r\n  styleUrls: ['./urge-handle.component.css', '../task-execute/task-execute.component.css']\r\n})\r\nexport class UrgeHandleComponent implements OnInit {\r\n\r\n  @Input() placeholder = '';\r\n  @Input() showMessageSubject = false;// \r\n  @Input() textAreaHeight: number;//\r\n  @Input() urgeMessageSubject: string; // \r\n  @Input() urgeMessageContent: string; // \r\n  @Input() subjectEditable: boolean = false; // \r\n  @Input() contentEditable: boolean = false; // \r\n\r\n  constructor() { }\r\n\r\n  ngOnInit() {\r\n  }\r\n\r\n}\r\n","import { Addendum } from \"./complete-context\";\r\n\r\n/**\r\n * payload\r\n */\r\nexport class BasePayload {\r\n\r\n    id?: string;\r\n    /**\r\n     Id\r\n     */\r\n    workItemId: string;\r\n    /**\r\n     \r\n     */\r\n    comment: string;\r\n    /**\r\n     * \r\n     */\r\n    addendum: Addendum;\r\n    /**\r\n     \r\n     */\r\n    conclusionValue: string;\r\n\r\n}","import { BasePayload } from \"./base-payload\";\r\nimport { OrganizationScope } from \"./organization-scope\";\r\n\r\n/**\r\n * \r\n */\r\nexport class AddSignSimulateResponse {\r\n    /**\r\n     * \r\n     */\r\n    organization: OrganizationScope;\r\n    /**\r\n     * \r\n     */\r\n    multiInstanceType: MultiInstanceType;\r\n    /**\r\n     * \r\n     */\r\n    showSignToSign: boolean;\r\n}\r\n\r\n/**\r\n *  \r\n */\r\nexport enum MultiInstanceType {\r\n    /**\r\n     * \r\n     */\r\n    Preempt = 'Preempt',\r\n    /**\r\n     * \r\n     */\r\n    Parallel = 'Parallel',\r\n    /**\r\n     * \r\n     */\r\n    Sequential = 'Sequential'\r\n\r\n}\r\n\r\n/**\r\n * payload\r\n */\r\nexport class AddSignPayload extends BasePayload {\r\n\r\n    /**\r\n     * /\r\n     */\r\n    actionCode: string;\r\n\r\n    /**\r\n     *  Preempt ParallelSequential\r\n     */\r\n    multiInstanceType: string;\r\n\r\n    /**\r\n     * allPassonePass\r\n     */\r\n    counterSignRule: string;\r\n\r\n    /**\r\n     * \r\n     * all\r\n     * compliance\r\n     */\r\n    completedRule: string;\r\n\r\n    /**\r\n     * \r\n     */\r\n    signAssignees: string[];\r\n\r\n    /**\r\n     * \r\n     */\r\n    activityName: string;\r\n\r\n    /**\r\n     * \r\n     */\r\n    allowSignToSign: boolean;\r\n\r\n\r\n}","import {\r\n  Component,\r\n  OnInit,\r\n  ViewChild,\r\n  TemplateRef,\r\n  HostBinding,\r\n  Injector,\r\n  AfterViewInit,\r\n  ChangeDetectorRef,\r\n  Input\r\n} from '@angular/core';\r\nimport { Addendum, VerifySigned, CompleteContext } from '../../entity/complete-context';\r\nimport { TaskService } from '../../service/task.service';\r\nimport { SysFarrisLookupComponent } from '@gsp-sys/sysmgr-ui';\r\nimport { NotifyService } from '@farris/ui-notify';\r\nimport { I18nService } from '../../service/i18n/i18n.service';\r\nimport { CompleteResponse, AssignParameter, AssigneeInfo } from '../../entity/complete-response';\r\nimport { Observable, BehaviorSubject, Subject } from 'rxjs';\r\nimport { TaskAction } from '../../entity/task-action';\r\nimport { WfTaskHandlerService } from '../../wf-task-handler.service';\r\nimport { TaskEntity } from '../../entity/task-entity';\r\nimport { SubmitResult, ActionBaseImplComponent, ActionEvent, TaskEventResult, TaskEventContext, ActionOrigin } from '@gsp-wf/task-impl-api';\r\nimport { LoadingService } from '@farris/ui-loading';\r\nimport { OrganizationScope } from '../../entity/organization-scope';\r\nimport { FlowNodeInfo, Assignee } from '../../entity/start-process-payload';\r\nimport { MessagerService } from '@farris/ui-messager';\r\nimport { AssignInfoHelpEntity } from '../../entity/assignInfoHelp';\r\nimport { SimulateResponse } from '../../entity/simulate-response';\r\nimport { BillMethodConfig, FormEventMessage } from '../../entity/formAction';\r\nimport { ConfigCode, TaskCenterConfig, OwnerType } from '../../entity/task-center-config';\r\nimport { CounterSignParam, WorkItemExecuteParam } from '../../entity/workitem-execute-param';\r\nimport { UrgeHandleContext, UrgeHandleResponse, UrgeHandleSimulateContext } from '../../entity/urge-handle';\r\nimport { BatchVerifySignedContext } from '../../entity/batchVerifysigned';\r\nimport { WfContext } from '../../entity/wfContext';\r\nimport { UrgeHandleComponent } from \"../urge-handle/urge-handle.component\";\r\nimport { AddSignPayload, AddSignSimulateResponse, MultiInstanceType } from '../../entity/add-sign';\r\n\r\ndeclare var System: any;\r\ndeclare const gspCA: any;\r\n\r\n@Component({\r\n  selector: 'lib-task-execute',\r\n  templateUrl: './task-execute.component.html',\r\n  styleUrls: ['./task-execute.component.css'],\r\n})\r\nexport class TaskExecuteComponent extends ActionBaseImplComponent implements OnInit, AfterViewInit {\r\n\r\n  /**\r\n   * \r\n   */\r\n  private static func = null;\r\n  task: TaskEntity;//\r\n  workItemId: string; // ID\r\n  processInstanceId: string; // ID\r\n  actionEntity = new TaskAction(); // \r\n  comment = ''; // \r\n  wfCacheComment: string;//\r\n  currentDefaultValue: string;//\r\n\r\n  ifSelectNode = false; // \r\n  ifSelectUser = false; // \r\n  ifAssignUser = false; // \r\n  ifUrgeType = false; // \r\n  ifShowCommentToMySelf = false;// \r\n\r\n  singleSelect = false; // \r\n  selectTargetAble = false; // \r\n  hideComment = false;//\r\n\r\n  filter = { notGetCurrentUser: true, notGetStopUser: true, orderField: 'order', withAllOrg: true, orgId: '' }; // \r\n  selectedUsers: string[] = []; // Id\r\n\r\n  selectedUserNgModule: string; // placeholder\r\n\r\n  @ViewChild('taskExecuteButtons') buttons: TemplateRef<any>; // \r\n  @ViewChild(SysFarrisLookupComponent) sysUserHelp: SysFarrisLookupComponent; // \r\n  @ViewChild(UrgeHandleComponent) urgeHandleComponent: UrgeHandleComponent;\r\n\r\n  subject = new BehaviorSubject<SubmitResult>(null);\r\n  submitResult: SubmitResult = { result: true, isClose: true }; // \r\n  bindingData: { id?: string, name?: string } = {}; // \r\n\r\n  selectNodeText: string = this.i18nService.getValue('task.nextNodeText'); // ,\"\"\r\n  selectUserText: string; // \r\n  commentPlaceHolder: string = this.i18nService.getValue('static.inputHolder');//placeholder\r\n  showAttachment: boolean = true;//\r\n  showSign: boolean = true;//\r\n  showCommonComment: boolean = true;//\r\n  textAreaHeight: number = 84;//\r\n\r\n  nodePlaceholder: string; // placeholder\r\n\r\n  selectedNodeId: string; // ID\r\n  destNodes: { id: string, name: string }[] = []; // \r\n\r\n  dialogHeight = 270; // \r\n  dialogHeightBase = 66;\r\n\r\n  addendum = new Addendum(); // \r\n  groupIcon = '<i class=\"f-icon f-icon-lookup\"></i>';\r\n\r\n  assignInfos: AssignInfoHelpEntity[] = [{ // \r\n    selectedAssignees: [],\r\n    assigneeInfo: null,\r\n    assignees: [],\r\n    activityName: '',\r\n    dependency: '',\r\n    anonymous: false,\r\n    anonymousText: null,\r\n    resolved: false,\r\n  }];\r\n\r\n  response: SimulateResponse; // \r\n  urgeHandleResponse: UrgeHandleResponse;//\r\n\r\n  formObject: any; // \r\n  ifRegistered = false; // \r\n  billMethodConfigs: BillMethodConfig[] = []; // \r\n  configList: TaskCenterConfig[] = []; //\r\n\r\n  verifySigned: VerifySigned = new VerifySigned(); // \r\n  submitDisable: boolean = false; // \r\n\r\n  //\r\n  addSign = {\r\n    showSignToSign: false,\r\n    allowSignToSIgn: false,\r\n    showMultiInstanceType: false,\r\n    multiInstanceType: [\r\n      { value: 'Parallel', name: this.i18nService.getValue('addSign.parallel') },\r\n      { value: 'Sequential', name: this.i18nService.getValue('addSign.sequential') },\r\n      { value: 'Preempt', name: this.i18nService.getValue('addSign.preempt') },\r\n    ],\r\n    originMultiInstType: '',\r\n    curMultiInstType: MultiInstanceType.Parallel.toString()\r\n  }\r\n  //\r\n  showBackWardConfig = {\r\n    dynamicBackWardRuleAble: false,\r\n    enable: false,\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  showUrgeMessageSubject: boolean = false; // \r\n  urgeMessageSubject: string; // \r\n  urgeMessageContent: string; // \r\n  addReminder: boolean; // \r\n  subjectEditable: boolean; // \r\n  contentEditable: boolean; // \r\n\r\n  wfContext = new WfContext();//\r\n\r\n  @HostBinding('class') cls = '';\r\n\r\n  POST_MESSAGE_TARGET = window.document.location.origin;\r\n  private messageSubject;\r\n\r\n\r\n  constructor(\r\n    private taskService: TaskService,\r\n    private notify: NotifyService,\r\n    private i18nService: I18nService,\r\n    private handlerService: WfTaskHandlerService,\r\n    private loadingService: LoadingService,\r\n    private message: MessagerService,\r\n    private injector: Injector,\r\n    private cd: ChangeDetectorRef,\r\n  ) {\r\n    super();\r\n    // \r\n    if (TaskExecuteComponent.func) {\r\n      window.removeEventListener('message', TaskExecuteComponent.func, false);\r\n    }\r\n    this.addMessageListener();\r\n  }\r\n\r\n  ngAfterViewInit(): void {\r\n  }\r\n\r\n  ngOnInit() {\r\n    const load = this.loadingService.show();\r\n    this.taskService.getAllUserConfig().subscribe((configList: TaskCenterConfig[]) => {\r\n      load.close();\r\n      this.configList = configList;\r\n      const comment = configList.find(c => c.configCode === ConfigCode.Default_Approval_Comment);\r\n      const if_store_comment = configList.find(c => c.configCode === ConfigCode.If_Store_Comment);\r\n      let passComment: string;\r\n      let backComment: string;\r\n      if (comment && comment.currentValue) {\r\n        passComment = JSON.parse(comment.currentValue).pass;\r\n        backComment = JSON.parse(comment.currentValue).back;\r\n        if (this.actionEntity.code === 'Pass') {\r\n          this.comment = passComment;\r\n        }\r\n        if (this.actionEntity.code === 'Back') {\r\n          this.comment = backComment;\r\n        }\r\n      }\r\n      if (if_store_comment && if_store_comment.currentValue === 'true') {\r\n        if (this.wfCacheComment) {\r\n          if (this.actionEntity.code == 'Back' && this.wfCacheComment == passComment) {\r\n          } else {\r\n            this.comment = this.wfCacheComment;\r\n          }\r\n        }\r\n      }\r\n    }, () => {\r\n      load.close();\r\n    })\r\n    // \r\n    if (this.origin === ActionOrigin.TaskForm) {\r\n      this.initFormEvent();\r\n\r\n      // \r\n      this.taskService.getAppInfo(this.workItemId).subscribe((re: any) => {\r\n        if (re && re.billMethodConfigs && re.billMethodConfigs.length) {\r\n          this.billMethodConfigs = re.billMethodConfigs;\r\n        }\r\n      });\r\n    }\r\n    let context = new UrgeHandleSimulateContext();\r\n    context.procInstId = this.processInstanceId;\r\n  }\r\n\r\n  private addMessageListener() {\r\n    window.addEventListener('message', this.eventHandler, false);\r\n    TaskExecuteComponent.func = this.eventHandler;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  eventHandler = (event) => {\r\n    this.messageSubject.next(event);\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param task\r\n   */\r\n  setTask(task: TaskEntity) {\r\n    if (task) {\r\n      this.task = task;\r\n      this.workItemId = task.sourceId;\r\n      this.processInstanceId = task.processInstanceId;\r\n      this.wfContext.processCategoryId = task.categoryId;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param action\r\n   */\r\n  setAction(action: TaskAction) {\r\n    if (action) {\r\n      this.actionEntity = action;\r\n      if (this.task) {// setAction\r\n        this.execute(this.actionEntity);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * window\r\n   * windowwindow.parent\r\n   */\r\n  private initFormEvent() {\r\n    // \r\n    const actionToken = this.workItemId + 'action';\r\n    const subjectCode = 'FormSubjectCode';\r\n    (window as any).gspWfEventService = (window as any).gspWfEventService || {};\r\n    (window as any).gspWfEventService.register = (formObject: any) => {\r\n      this.taskService.subjectRegister(subjectCode, actionToken);\r\n      this.ifRegistered = true;\r\n      this.formObject = formObject;\r\n    };\r\n\r\n    (window as any).gspWfEventService.notify = (value: FormEventMessage) => {\r\n      if (this.ifRegistered) {\r\n        this.taskService.subjectNotify(actionToken, value);\r\n      } else {// notify\r\n        const simulateToken = this.workItemId + 'simulate';\r\n        this.taskService.subjectRegister(subjectCode, simulateToken);\r\n        this.taskService.subjectResponse(simulateToken, '', (value: FormEventMessage) => {\r\n          value && value.dataChanged && this.completeSimulate();\r\n        });\r\n        this.taskService.subjectNotify(simulateToken, value);\r\n      }\r\n    };\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private beforeCompleteSubmit() {\r\n    const passPreActions = this.billMethodConfigs.filter(action => action.action === this.actionEntity.code && action.executionTime === 'Pre').sort((x, y) => x.sortOrder - y.sortOrder);\r\n    // \r\n    if (passPreActions && passPreActions.length) {\r\n      this.executeFormActions([...passPreActions]);\r\n    }\r\n    // \r\n    else {\r\n      this.completeSubmit();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @param formActions \r\n   */\r\n  private executeFormActions(formActions: BillMethodConfig[]) {\r\n    if (formActions.length > 0) {\r\n      this.messageSubject = new Subject<any>();\r\n      this.messageSubject.subscribe((re: any) => {\r\n        console.log(re.data);\r\n        const data = re.data.data;\r\n        if (data.result === true) {\r\n          if (data.dataChanged === true) {// \r\n            this.completeSimulate().subscribe((r) => {\r\n              if (r) {// \r\n                this.executeFormActions(formActions);\r\n              } else {// \r\n                this.subject.next({ result: false, isClose: false }); // \r\n              }\r\n            });\r\n          } else {// \r\n            this.executeFormActions(formActions);\r\n          }\r\n        } else {\r\n          this.subject.next({ result: false, isClose: false }); // \r\n          throw new Error('');\r\n        }\r\n      });\r\n      // \r\n      const formAction = formActions.shift();\r\n      this.sendMessage(this.workItemId, formAction);\r\n    } else {\r\n      this.completeSubmit();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param action\r\n   */\r\n  execute(action: TaskAction) {\r\n    switch (action.code) {\r\n      case 'AssignUser': //  \r\n        this.assignSimulate();\r\n        break;\r\n      case 'Claim': // \r\n        this.showAttachment = false;\r\n        break;\r\n      case 'Unclaim': // \r\n        break;\r\n      case 'Retrieve': // \r\n        break;\r\n      case 'Transfer': //  \r\n        this.transferSimulate();\r\n        break;\r\n      case 'AddSign': // \r\n        this.addSignSimulate();\r\n        break;\r\n      case 'AddSignFront': // \r\n        this.addSignFrontSimulate();\r\n        break;\r\n      case 'Notify': //\r\n        this.notifySimulate();\r\n        break;\r\n      case 'Refuse': // \r\n        break;\r\n      case 'Obsolete': // \r\n        break;\r\n      case 'Comment': // \r\n        break;\r\n      case 'ReadTask': // \r\n        this.ifShowCommentToMySelf = true;\r\n        this.dialogHeight = 340;\r\n        break;\r\n      case 'UrgeHandle'://\r\n        this.urgeHandleSimulate();\r\n        break;\r\n      case 'CancelConsult'://\r\n        break;\r\n      default: //    \r\n        this.completeSimulate();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * \r\n   * \r\n   */\r\n  submit(): Observable<SubmitResult> {\r\n    switch (this.actionEntity.code) {\r\n      case 'AssignUser': //  \r\n        this.assignSubmit();\r\n        break;\r\n      case 'Claim': // \r\n        this.claimSubmit();\r\n        break;\r\n      case 'Unclaim': // \r\n        this.unClaimSubmit();\r\n        break;\r\n      case 'Retrieve': // \r\n        this.retrieveSubmit();\r\n        break;\r\n      case 'Transfer': //  \r\n        this.transferSubmit();\r\n        break;\r\n      case 'AddSign': // \r\n        this.addSignSubmit();\r\n        break;\r\n      case 'AddSignFront': // \r\n        this.addSignFrontSubmit();\r\n        break;\r\n      case 'Comment': // \r\n        this.commentSubmit();\r\n        break;\r\n      case 'Notify': //\r\n        this.notifySubmit();\r\n        break;\r\n      case 'ReadTask': // \r\n        this.readSubmit();\r\n        break;\r\n      case 'UrgeHandle'://\r\n        this.urgeHandleSubmit();\r\n        break;\r\n      case 'CancelConsult'://\r\n        this.cancelConsultSubmit();\r\n        break;\r\n      default: //      \r\n        this.beforeCompleteSubmit();\r\n    }\r\n    return this.subject.asObservable();\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param tasks \r\n   */\r\n  batchSubmit(tasks: TaskEntity[]): Observable<SubmitResult> {\r\n    let filterNum = 0;\r\n    const subject = new BehaviorSubject<SubmitResult>(null);\r\n    const successSubmit: SubmitResult = { result: true, isClose: true };\r\n    if ((this.actionEntity.code === 'Back' || this.actionEntity.code === 'Refuse') && !this.comment) {// \r\n      this.notify.warning(this.i18nService.getValue('cueWords.inputOpinion'));\r\n      subject.next({ result: false, isClose: false });\r\n    } else if (this.comment.length > 300) {\r\n      this.notify.warning(this.i18nService.getValue('task.commentTooLong'));\r\n      subject.next({ result: false, isClose: false });\r\n    } else {\r\n      const noActionTasks = tasks.filter(t => t.actions.findIndex(a => a.code === this.actionEntity.code) === -1);\r\n      if (noActionTasks && noActionTasks.length > 0) {\r\n        for (const a of noActionTasks) {\r\n          filterNum++;\r\n          if (filterNum === tasks.length) {\r\n            subject.next(successSubmit);\r\n            this.showBatchSubmitInfo(0, filterNum, 0, 0);\r\n          }\r\n        }\r\n      }\r\n      let actTasks = tasks.filter(t => t.actions.some(a => a.code === this.actionEntity.code));\r\n      if (actTasks && actTasks.length > 0) {\r\n        this.executeBatchEvent([...this.actionEntity.preEvents.filter(e => e.batch)], actTasks, this.actionEntity, (re: TaskEventResult) => {\r\n          if (re && re.result) {\r\n            if (re.passTasks) {\r\n              const backTasks = actTasks.filter(t => re.passTasks.findIndex(id => id === t.id) === -1);\r\n              if (backTasks && backTasks.length > 0) {\r\n                for (const t of backTasks) {\r\n                  filterNum++;\r\n                  if (filterNum === tasks.length) {\r\n                    subject.next(successSubmit);\r\n                    this.showBatchSubmitInfo(0, filterNum, 0, 0);\r\n                  }\r\n                }\r\n              }\r\n              actTasks = actTasks.filter(t => re.passTasks.findIndex(id => id === t.id) > -1);\r\n            }\r\n            if (actTasks.length > 0) {\r\n              const batchVerifySignedcontext = new BatchVerifySignedContext();\r\n              this.batchverifySubmit(actTasks, filterNum, batchVerifySignedcontext).subscribe((r: any) => {\r\n                if (r && r.successSubmit && r.successSubmit.result) {\r\n                  this.executeBatchEvent([...this.actionEntity.postEvents.filter(e => e.batch)], r.successHandleTasks, this.actionEntity, () => {\r\n                    subject.next(r.successSubmit);\r\n                  }, { result: true, passTasks: r.successHandleTasks.map(t => t.id) });\r\n                }\r\n              });\r\n            }\r\n          } else {\r\n            subject.next({ result: false, isClose: false });\r\n          }\r\n        }, { result: true, passTasks: actTasks.map(t => t.id) });\r\n      }\r\n    }\r\n    return subject.asObservable();\r\n  }\r\n\r\n\r\n  private batchverifySubmit(tasks: TaskEntity[], filterNum: number = 0, batchVerifySignedcontext: BatchVerifySignedContext): Observable<any> {\r\n    const subject = new Subject();\r\n    const verifyTasks = tasks.filter(t => {\r\n      const action = t.actions.find(a => a.code === this.actionEntity.code);\r\n      if (!action) {\r\n        return false;\r\n      } else {\r\n        if (action.parameters.some(p => p.code === 'CertificationNecessary' && p.value === 'true')) {\r\n          return true;\r\n        } else {\r\n          return false;\r\n        }\r\n      }\r\n    });\r\n    const verifyTasksNum = verifyTasks.length;\r\n    if (verifyTasks.length > 0) {\r\n      const that = this;\r\n      if (\r\n        (window as any).gspframeworkService &&\r\n        (window as any).gspframeworkService.rtf\r\n      ) {\r\n        (window as any).gspframeworkService.rtf.caEvent.on(\r\n          (window as any).gspframeworkService.rtf.caEvent.signedMsgOverToken(),\r\n          'signedMsgOver',\r\n          function signMsgOver(signedData) {\r\n            if (signedData && signedData[0] === 'true' && signedData.length > 0) {\r\n              // \r\n              const cert = gspCA.getCurCert();\r\n              // \r\n              that.verifySigned = {\r\n                // base64(certkey)\r\n                certBase64Info: gspCA.getCertBase64(cert),\r\n                // \r\n                msg: ['BatchDigitalSignature'],\r\n                // \r\n                signedmsg: signedData[1][0],\r\n                // \r\n                useCase: null,\r\n              };\r\n              batchVerifySignedcontext.verifySigned = that.verifySigned;\r\n              that.taskService.batchVerifySigned(batchVerifySignedcontext).subscribe(() => {\r\n                const verifyTasksNum = 0;\r\n                that.batchComplete(tasks, filterNum, verifyTasksNum).subscribe(re => {\r\n                  subject.next(re);\r\n                });\r\n              }, (error) => {\r\n                const otherTasks = tasks.filter(t => verifyTasks.findIndex(task => task.id === t.id) === -1);\r\n                that.batchComplete(otherTasks, filterNum, verifyTasksNum).subscribe(re => {\r\n                  subject.next(re);\r\n                });\r\n              });\r\n            } else {\r\n              that.notify.error(signedData[1]);\r\n              subject.next({ successSubmit: { result: false, isClose: false }, successHandleTasks: new Array() });\r\n            }\r\n          }\r\n        );\r\n      }\r\n      const msg = ['BatchDigitalSignature'];\r\n      gspCA.getSignedMsg(msg);\r\n    } else {\r\n      this.batchComplete(tasks, filterNum, verifyTasksNum).subscribe(re => {\r\n        subject.next(re);\r\n      });\r\n    }\r\n    return subject.asObservable();\r\n  }\r\n\r\n  private batchComplete(tasks: TaskEntity[], filterNum: number = 0, verifyTasksNum: number): Observable<any> {\r\n    const subject = new Subject<any>();\r\n    let successNum = 0;\r\n    let failedNum = 0;\r\n    let errorNum = 0;\r\n    const successSubmit: SubmitResult = { result: true, isClose: true };\r\n    const successHandleTasks = new Array();\r\n\r\n    const load = this.loadingService.show();\r\n    for (const task of tasks) {\r\n      const context = new CompleteContext();\r\n      context.workItemId = task.sourceId;\r\n      context.conclusionValue = this.actionEntity.code;\r\n      context.comment = this.comment;\r\n      context.addendum = this.addendum;\r\n      this.taskService.completeSimulate(context).subscribe((response: SimulateResponse) => {\r\n        if (response && response.needInteraction === true) {// \r\n          failedNum++;\r\n          if (successNum + failedNum + errorNum === tasks.length) {\r\n            load.close();\r\n            subject.next({ successSubmit, successHandleTasks });\r\n            this.showBatchSubmitInfo(successNum, failedNum + filterNum, errorNum, verifyTasksNum);\r\n          }\r\n        } else {// \r\n          this.taskService.complete(context).subscribe(() => {// \r\n            successNum++;\r\n            successHandleTasks.push(task);\r\n            if (successNum + failedNum + errorNum === tasks.length) {\r\n              load.close();\r\n              subject.next({ successSubmit, successHandleTasks });\r\n              this.showBatchSubmitInfo(successNum, failedNum + filterNum, errorNum, verifyTasksNum);\r\n            }\r\n          }, () => {// \r\n            errorNum++;\r\n            if (successNum + failedNum + errorNum === tasks.length) {\r\n              load.close();\r\n              subject.next({ successSubmit, successHandleTasks });\r\n              this.showBatchSubmitInfo(successNum, failedNum + filterNum, errorNum, verifyTasksNum);\r\n            }\r\n          });\r\n        }\r\n      }, () => {// \r\n        errorNum++;\r\n        if (successNum + failedNum + errorNum === tasks.length) {\r\n          load.close();\r\n          subject.next({ successSubmit, successHandleTasks });\r\n          this.showBatchSubmitInfo(successNum, failedNum + filterNum, errorNum, verifyTasksNum);\r\n        }\r\n      });\r\n    }\r\n    return subject.asObservable();\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param successNum \r\n   * @param failedNum \r\n   * @param errorNum \r\n   * @param verifyTasksNum \r\n   */\r\n  private showBatchSubmitInfo(successNum: number, failedNum: number, errorNum: number, verifyTasksNum: number) {\r\n    let message = '';\r\n    if (successNum && !failedNum && !errorNum && !verifyTasksNum) {// \r\n      this.notify.success(this.i18nService.getValue('cueWords.success'));\r\n    } else {// \r\n      successNum && (message += this.i18nService.getValue('batchSubmit.success') + `${successNum}` + this.i18nService.getValue('batchSubmit.row'));\r\n      errorNum && (message += this.i18nService.getValue('batchSubmit.error') + `${errorNum}` + this.i18nService.getValue('batchSubmit.row'));\r\n      failedNum && (message += this.i18nService.getValue('batchSubmit.failed') + `${failedNum}` + this.i18nService.getValue('batchSubmit.row'));\r\n      verifyTasksNum && (message += this.i18nService.getValue('batchSubmit.validationFailed') + `${verifyTasksNum}` + this.i18nService.getValue('batchSubmit.row'));\r\n      message += this.i18nService.getValue('batchSubmit.single');\r\n      this.message.show('warning', message, { safeHtml: false });\r\n    }\r\n  }\r\n\r\n  private executeBatchEvent(events: ActionEvent[], entities: Array<TaskEntity>, action: TaskAction, handler: any, result?: TaskEventResult) {\r\n    if (this.injector) {\r\n      if (events && events.length > 0 && entities && entities.length > 0) {\r\n        const event = events.shift();\r\n        const url = event.eventImpl.split('#')[0];\r\n        const func = event.eventImpl.split('#')[1];\r\n        System.import(url + '?v=' + new Date().getTime().toString())\r\n          .then((moduleFactories: any) => {\r\n            const moduleFactory: any = Object.values(moduleFactories)[0];\r\n            const moduleRef = moduleFactory.create(this.injector);\r\n            const context: TaskEventContext = {\r\n              action,\r\n              taskList: entities,\r\n              origin: 'TaskCenter',\r\n              preEventResult: result\r\n            };\r\n            moduleRef.instance[func].apply(moduleRef.instance, [context]).subscribe((re: TaskEventResult) => {\r\n              if (re && re.result) {\r\n                this.executeBatchEvent(events, entities, action, handler, re);\r\n              } else {\r\n                handler(re);\r\n              }\r\n            });\r\n          });\r\n      } else {\r\n        handler(result);\r\n      }\r\n    } else {\r\n      handler(result);\r\n    }\r\n  }\r\n\r\n\r\n  private assignSimulate() {\r\n    this.showAttachment = false;\r\n    this.ifAssignUser = true;\r\n    this.dialogHeight += this.dialogHeightBase;\r\n    this.taskService.getAssigneeInfo(this.workItemId).subscribe((info: FlowNodeInfo) => {\r\n      this.assignInfos = [{\r\n        selectedAssignees: info.selectedAssignees,\r\n        assigneeInfo: info.assigneeInfo,\r\n        assignees: info.selectedAssignees.map(user => { return { id: user.id, name: user.name }; }),\r\n        activityName: info.activityDefinitionName,\r\n        dependency: info.dependency,\r\n        anonymous: info.anonymous,\r\n        anonymousText: info.anonymousText,\r\n        resolved: info.resolved,\r\n      }];\r\n    }, (error) => {\r\n      this.taskService.error(error);\r\n    });\r\n  }\r\n\r\n  private transferSimulate() {// \r\n    this.ifSelectUser = true;\r\n    this.selectUserText = this.actionEntity.name + this.i18nService.getValue('task.person');\r\n    this.singleSelect = true;\r\n    this.dialogHeight += this.dialogHeightBase;\r\n    this.getOrganizationScope();\r\n\r\n  }\r\n\r\n  private addSignFrontSimulate() {// \r\n    this.ifSelectUser = true;\r\n    this.selectUserText = this.actionEntity.name + this.i18nService.getValue('task.person');\r\n    this.dialogHeight += this.dialogHeightBase;\r\n    this.getOrganizationScope();\r\n\r\n  }\r\n\r\n  private addSignSimulate() {// \r\n    this.ifSelectUser = true;\r\n    this.selectUserText = this.actionEntity.name + this.i18nService.getValue('task.person');\r\n    this.dialogHeight += this.dialogHeightBase * 2;\r\n    const load = this.loadingService.show();\r\n    this.taskService.getAdhocConfig(this.workItemId).subscribe((response: AddSignSimulateResponse) => {\r\n      load.close();\r\n      this.addSign.showSignToSign = response.showSignToSign;\r\n      this.addSign.originMultiInstType = response.multiInstanceType;\r\n      if (response.organization) {\r\n        this.filter.orgId = response.organization.id;\r\n        this.filter.withAllOrg = response.organization.includeChildren;\r\n      }\r\n    }, error => {\r\n      load.close();\r\n      this.taskService.error(error);\r\n    })\r\n  }\r\n\r\n  private notifySimulate() {//\r\n    this.ifSelectUser = true;\r\n    this.selectUserText = this.actionEntity.name + this.i18nService.getValue('task.person');\r\n    this.dialogHeight += this.dialogHeightBase;\r\n    this.singleSelect = false;\r\n    this.getOrganizationScope();\r\n  }\r\n\r\n  private getOrganizationScope() {\r\n    const load = this.loadingService.show();\r\n    this.taskService.getOrganizationScope(this.workItemId, this.actionEntity.code).subscribe((orgList: OrganizationScope[]) => {\r\n      load.close();\r\n      if (orgList.length) {// \r\n        this.filter.orgId = orgList[0].id;\r\n        this.filter.withAllOrg = orgList[0].includeChildren;\r\n      }\r\n    }, error => {\r\n      load.close();\r\n      this.taskService.error(error);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private urgeHandleSimulate() {\r\n    this.ifSelectNode = false;\r\n    this.ifSelectUser = false;\r\n    this.ifAssignUser = false;\r\n    this.ifUrgeType = true;\r\n    this.commentPlaceHolder = this.i18nService.getValue('task.urgeComment');\r\n    this.showCommonComment = false;\r\n    this.showAttachment = false;\r\n    this.showUrgeMessageSubject = true;\r\n    this.showSign = false;\r\n    this.dialogHeight += this.dialogHeightBase * 2;\r\n    const load = this.loadingService.show();\r\n    let context = new UrgeHandleSimulateContext();\r\n    context.procInstId = this.processInstanceId;\r\n    this.taskService.urgeHandleSimulate(context).subscribe((re: UrgeHandleResponse) => {\r\n      load.close();\r\n      this.urgeHandleResponse = re;\r\n      if (re && re.urgeUsers && re.urgeUsers.length) {\r\n        this.urgeMessageSubject = re.urgeUsers[0].urgeInfos[0].urgeMessageSubject;\r\n        this.urgeMessageContent = re.urgeUsers[0].urgeInfos[0].urgeMessageContent;\r\n        this.subjectEditable = re.urgeUsers[0].urgeInfos[0].subjectEditable;\r\n        this.contentEditable = re.urgeUsers[0].urgeInfos[0].contentEditable;\r\n        this.addReminder = re.urgeUsers[0].urgeInfos[0].addReminder;\r\n        let urgeUsers = re.urgeUsers;\r\n        let assignInfo = new AssigneeInfo();\r\n        urgeUsers.forEach(user => {\r\n          if (user.anonymousText) {\r\n            user.name = user.anonymousText;\r\n            user.code = '';\r\n            user.orgName = '';\r\n          }\r\n        })\r\n        assignInfo.assigneeUsers = urgeUsers;\r\n        assignInfo.selectAssignee = urgeUsers.length > 1 ? true : false;\r\n        assignInfo.multiSelect = true;\r\n        this.assignInfos[0].assigneeInfo = assignInfo;\r\n        this.assignInfos[0].assignees = urgeUsers.length == 1 ? urgeUsers : [];\r\n      } else {\r\n        this.notify.warning(this.i18nService.getValue('task.noUrgeUsers'));\r\n      }\r\n    }, error => {\r\n      load.close();\r\n      this.taskService.error(error);\r\n    })\r\n\r\n  }\r\n\r\n  /**\r\n   * \r\n   * \r\n   */\r\n  private completeSimulate(): Observable<any> {\r\n    const subject = new Subject();\r\n    this.ifSelectNode = true;\r\n    this.ifAssignUser = true;\r\n    this.dialogHeight += this.dialogHeightBase * 2;\r\n\r\n    if (this.actionEntity.parameters && this.actionEntity.parameters.length) {// \r\n      this.actionEntity.parameters.forEach((p) => {\r\n        if (p.code === 'AddSignBehindAble' && p.value === 'true') {\r\n          this.ifSelectUser = true;\r\n          this.selectUserText = this.i18nService.getValue('task.addSign') + this.i18nService.getValue('task.person');\r\n          this.dialogHeight += this.dialogHeightBase;\r\n          const load = this.loadingService.show();\r\n          //\r\n          this.taskService.getOrganizationScope(this.workItemId, 'AddSignBehind').subscribe((orgList: OrganizationScope[]) => {\r\n            load.close();\r\n            if (orgList.length) {// \r\n              this.filter.orgId = orgList[0].id;\r\n              this.filter.withAllOrg = orgList[0].includeChildren;\r\n            }\r\n          }, error => {\r\n            this.taskService.error(error);\r\n          });\r\n        }\r\n      });\r\n    }\r\n    if (this.actionEntity.code === 'Back') {\r\n      this.selectNodeText = this.i18nService.getValue('task.backNodeText');\r\n    }\r\n\r\n    const context = new CompleteContext();\r\n    context.workItemId = this.workItemId;\r\n    context.conclusionValue = this.actionEntity.code;\r\n\r\n    const load = this.loadingService.show();\r\n    this.taskService.completeSimulate(context).subscribe((response: SimulateResponse) => {\r\n      load.close();\r\n      this.clearSimulateResult();\r\n      this.response = response;\r\n      this.showBackWardConfig.dynamicBackWardRuleAble = response.dynamicBackWardRuleAble;\r\n      if (!response.simulationPaths.length) {// \r\n        this.ifSelectNode = false;\r\n        this.ifAssignUser = false;\r\n      } else {// \r\n        this.destNodes = response.simulationPaths && response.simulationPaths.map(path => ({\r\n          id: path.nodeInfoList.map(node => node.activityDefinitionId).join(''),\r\n          name: path.nodeInfoList.map(node => node.activityDefinitionName).join('')\r\n        }));\r\n        // -1\r\n        const defaultIndex = response.simulationPaths.findIndex(a => a.default);\r\n        if (defaultIndex > -1) {\r\n          this.selectedNodeId = this.destNodes[defaultIndex].id;\r\n          this.nodePlaceholder = this.destNodes[defaultIndex].name.indexOf('') > -1 ? response.simulationPaths[defaultIndex].name : this.destNodes[defaultIndex].name;\r\n          this.setAssignInfo(response.simulationPaths[defaultIndex].nodeInfoList);\r\n        } else {\r\n          this.nodePlaceholder = this.i18nService.getValue('task.selectPlaceholder');\r\n        }\r\n      }\r\n      subject.next(true);\r\n    }, error => {\r\n      load.close();\r\n      subject.next(false);\r\n      this.taskService.error(error);\r\n    });\r\n    return subject.asObservable();\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private clearSimulateResult() {\r\n    this.assignInfos = [{// \r\n      selectedAssignees: [],\r\n      assigneeInfo: null,\r\n      assignees: [],\r\n      activityName: '',\r\n      dependency: '',\r\n      anonymous: false,\r\n      anonymousText: '',\r\n      resolved: false,\r\n    }];\r\n    this.destNodes = []; // \r\n    this.nodePlaceholder = '';\r\n    this.selectedNodeId = '';\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  private setAssignInfo(nodeInfoList: FlowNodeInfo[]) {\r\n    this.assignInfos = [];\r\n    this.selectedNodeId.split('').forEach(nodeId => {\r\n      const node = nodeInfoList.find(node => node.activityDefinitionId === nodeId);\r\n      if (node) {\r\n        this.assignInfos.push({\r\n          selectedAssignees: node.selectedAssignees,\r\n          assigneeInfo: node.assigneeInfo,\r\n          assignees: node.selectedAssignees.map(user => { return { id: user.id, name: user.name }; }),\r\n          activityName: node.activityDefinitionName,\r\n          dependency: node.dependency,\r\n          anonymous: node.anonymous,\r\n          anonymousText: node.anonymousText,\r\n          resolved: node.resolved,\r\n        });\r\n      } else {\r\n        this.assignInfos.push({\r\n          selectedAssignees: [],\r\n          assigneeInfo: null,\r\n          assignees: [],\r\n          activityName: '',\r\n          dependency: '',\r\n          anonymous: false,\r\n          anonymousText: '',\r\n          resolved: false,\r\n        });\r\n      }\r\n    });\r\n    this.cd.detectChanges();\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private assignSubmit() {\r\n    if (this.comment.length > 300) {\r\n      this.notify.warning(this.i18nService.getValue('task.commentTooLong'));\r\n      this.subject.next({ result: false, isClose: false });\r\n    } else if (!this.assignInfos[0].assignees.length) {\r\n      this.notify.warning(this.i18nService.getValue('static.assignee.noAssignee'));\r\n      this.subject.next({ result: false, isClose: false });\r\n    } else {\r\n      const context: AssignParameter = {\r\n        workItemId: this.workItemId,\r\n        assigneeIds: this.assignInfos[0].assignees.map(user => user.id),\r\n        comment: this.comment,\r\n        addendum: this.addendum\r\n      };\r\n      this.taskService.assignNextUsersByWorkItemId(context).subscribe(() => {\r\n        this.notify.success(this.i18nService.getValue('static.assignee.successAssign'));\r\n        this.subject.next(this.submitResult);\r\n      }, (error) => {\r\n        this.subject.next({ result: false, isClose: false });\r\n        this.taskService.error(error);\r\n      });\r\n    }\r\n  }\r\n\r\n  private claimSubmit() {\r\n    if (this.comment.length > 300) {\r\n      this.notify.warning(this.i18nService.getValue('task.commentTooLong'));\r\n      this.subject.next({ result: false, isClose: false });\r\n    } else {\r\n      this.taskService.claim(this.workItemId, this.comment).subscribe(() => {\r\n        this.notify.success(this.i18nService.getValue('cueWords.successClaim')),\r\n          this.submitResult.isClose = false;\r\n        this.subject.next(this.submitResult);\r\n      }, (error) => {\r\n        this.subject.next({ result: false, isClose: false });\r\n        this.taskService.error(error);\r\n      });\r\n    }\r\n  }\r\n\r\n  private unClaimSubmit() {\r\n    if (this.comment.length > 300) {\r\n      this.notify.warning(this.i18nService.getValue('task.commentTooLong'));\r\n      this.subject.next({ result: false, isClose: false });\r\n    } else {\r\n      this.taskService.unClaim(this.workItemId, this.comment).subscribe(() => {\r\n        this.notify.success(this.i18nService.getValue('cueWords.successUnClaim')),\r\n          this.subject.next(this.submitResult);\r\n      }, (error) => {\r\n        this.subject.next({ result: false, isClose: false });\r\n        this.taskService.error(error);\r\n      });\r\n    }\r\n  }\r\n\r\n  private retrieveSubmit() {\r\n    if (this.comment.length > 300) {\r\n      this.notify.warning(this.i18nService.getValue('task.commentTooLong'));\r\n      this.subject.next({ result: false, isClose: false });\r\n    } else {\r\n      const retrieveContext = {\r\n        workItemId: this.workItemId,\r\n        comment: this.comment\r\n      };\r\n      this.taskService.retrieve(retrieveContext).subscribe(() => {\r\n        this.notify.success(this.i18nService.getValue('cueWords.successRetrieve'));\r\n        this.subject.next(this.submitResult);\r\n      }, (error) => {\r\n        this.subject.next({ result: false, isClose: false });\r\n        this.taskService.error(error);\r\n      });\r\n    }\r\n  }\r\n\r\n  private transferSubmit() {\r\n    if (this.comment.length > 300) {\r\n      this.notify.warning(this.i18nService.getValue('task.commentTooLong'));\r\n      this.subject.next({ result: false, isClose: false });\r\n    } else if (this.selectedUsers.length === 0) {\r\n      this.notify.warning(this.i18nService.getValue('task.selectPlaceholder') + this.selectUserText);\r\n      this.subject.next({ result: false, isClose: false });\r\n    } else {\r\n      const context = {\r\n        workItemId: this.workItemId,\r\n        assignee: this.selectedUsers[0],\r\n        comment: this.comment,\r\n        addendum: this.addendum\r\n      };\r\n      this.submitDisable = true; // \r\n      this.taskService.transfer(context).subscribe(() => {\r\n        this.notify.success(this.i18nService.getValue('static.transfer.successTransfer'));\r\n        this.subject.next(this.submitResult);\r\n      }, (error) => {\r\n        this.subject.next({ result: false, isClose: false });\r\n        this.taskService.error(error);\r\n      });\r\n    }\r\n  }\r\n\r\n  private commentSubmit() { // \r\n    if (!this.comment || this.comment.length === 0) {\r\n      this.notify.warning(this.i18nService.getValue('cueWords.inputOpinion'));\r\n      this.subject.next({ result: false, isClose: false });\r\n    } else if (this.comment.length > 300) {\r\n      this.notify.warning(this.i18nService.getValue('task.commentTooLong'));\r\n      this.subject.next({ result: false, isClose: false });\r\n    } else {\r\n      const context = {\r\n        workItemId: this.workItemId,\r\n        comment: this.comment,\r\n        addendum: this.addendum\r\n      };\r\n      this.taskService.comment(context).subscribe(() => {\r\n        this.notify.success(this.i18nService.getValue('static.comment.successComment'));\r\n        this.submitResult.isClose = false;\r\n        this.subject.next(this.submitResult);\r\n      }, (error) => {\r\n        this.subject.next({ result: false, isClose: false });\r\n        this.taskService.error(error);\r\n      });\r\n      this.comment = '';\r\n    }\r\n  }\r\n\r\n  private addSignFrontSubmit() {\r\n    if (this.comment.length > 300) {\r\n      this.notify.warning(this.i18nService.getValue('task.commentTooLong'));\r\n      this.subject.next({ result: false, isClose: false });\r\n    } else if (this.selectedUsers.length === 0) {\r\n      this.notify.warning(this.i18nService.getValue('task.selectPlaceholder') + this.selectUserText);\r\n      this.subject.next({ result: false, isClose: false });\r\n    } else {\r\n      const context = {\r\n        workItemId: this.workItemId,\r\n        action: this.actionEntity.code,\r\n        assignees: this.selectedUsers,\r\n        comment: this.comment,\r\n        addendum: this.addendum\r\n      };\r\n      this.submitDisable = true; // \r\n      this.taskService.addSign(context).subscribe(() => {\r\n        this.notify.success(this.i18nService.getValue('cueWords.success'));\r\n        this.subject.next(this.submitResult);\r\n      }, (error) => {\r\n        this.subject.next({ result: false, isClose: false });\r\n        this.taskService.error(error);\r\n      });\r\n    }\r\n  }\r\n\r\n  private addSignSubmit() {// \r\n    if (this.comment.length > 300) {\r\n      this.notify.warning(this.i18nService.getValue('task.commentTooLong'));\r\n      this.subject.next({ result: false, isClose: false });\r\n    } else if (this.selectedUsers.length === 0) {\r\n      this.notify.warning(this.i18nService.getValue('task.selectPlaceholder') + this.selectUserText);\r\n      this.subject.next({ result: false, isClose: false });\r\n    } else {\r\n      let payload: AddSignPayload = {\r\n        workItemId: this.workItemId,\r\n        comment: this.comment,\r\n        conclusionValue: \"Pass\",\r\n        signAssignees: this.selectedUsers,\r\n        actionCode: \"AddSignBehind\",\r\n        multiInstanceType: this.addSign.showMultiInstanceType ? this.addSign.curMultiInstType : this.addSign.originMultiInstType,\r\n        counterSignRule: 'allPass',\r\n        completedRule: 'all',\r\n        allowSignToSign: this.addSign.allowSignToSIgn,\r\n        activityName: '',\r\n        addendum: this.addendum\r\n      };\r\n\r\n      const load = this.loadingService.show();\r\n      this.taskService.adhocAssignee(payload).subscribe(re => {\r\n        this.notify.success(this.i18nService.getValue('cueWords.success'));\r\n        this.subject.next({ result: true, isClose: true });\r\n        load.close();\r\n      }, error => {\r\n        load.close();\r\n        this.subject.next({ result: false, isClose: false });\r\n        this.taskService.error(error);\r\n      })\r\n\r\n    }\r\n\r\n  }\r\n\r\n  private readSubmit() {//\r\n    if (this.comment.length > 300) {\r\n      this.notify.warning(this.i18nService.getValue('task.commentTooLong'));\r\n      this.subject.next({ result: false, isClose: false });\r\n    } else {\r\n      const context: WorkItemExecuteParam = {\r\n        workItemId: this.workItemId,\r\n        comment: this.comment,\r\n        addendum: this.addendum,\r\n        hideComment: this.hideComment\r\n      }\r\n      this.taskService.readTask(context).subscribe(() => {\r\n        this.notify.success(this.i18nService.getValue('cueWords.success'));\r\n        this.subject.next({ result: true, isClose: true });\r\n      }, error => {\r\n        this.taskService.error(error);\r\n        this.subject.next({ result: false, isClose: false });\r\n      })\r\n    }\r\n\r\n  }\r\n\r\n  private notifySubmit() {//\r\n    if (this.comment.length > 300) {\r\n      this.notify.warning(this.i18nService.getValue('task.commentTooLong'));\r\n      this.subject.next({ result: false, isClose: false });\r\n    } else if (this.selectedUsers.length === 0) {\r\n      this.notify.warning(this.i18nService.getValue('task.selectPlaceholder') + this.selectUserText);\r\n      this.subject.next({ result: false, isClose: false });\r\n    } else {\r\n      const context: CounterSignParam = {\r\n        workItemId: this.workItemId,\r\n        comment: this.comment,\r\n        addendum: this.addendum,\r\n        action: this.actionEntity.code,\r\n        assignees: this.selectedUsers,\r\n      };\r\n      this.taskService.addSign(context).subscribe(() => {\r\n        this.notify.success(this.i18nService.getValue('cueWords.success'));\r\n        this.subject.next({ result: true, isClose: false });\r\n      }, (error) => {\r\n        this.subject.next({ result: false, isClose: false });\r\n        this.taskService.error(error);\r\n      });\r\n    }\r\n\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private urgeHandleSubmit() {\r\n    if (this.comment.length > 300) {\r\n      this.notify.warning(this.i18nService.getValue('task.commentTooLong'));\r\n      this.subject.next({ result: false, isClose: false });\r\n    } else if (!this.urgeHandleResponse.urgeUsers || !this.urgeHandleResponse.urgeUsers.length) {//\r\n      this.notify.warning(this.i18nService.getValue('task.noUrgeUsers'));\r\n      this.subject.next({ result: false, isClose: false });\r\n    } else if (!this.assignInfos[0].assignees.length) {//\r\n      this.notify.warning(this.i18nService.getValue('task.selectPlaceholder') + this.i18nService.getValue('task.receiver'));\r\n      this.subject.next({ result: false, isClose: false });\r\n    } else if (!this.urgeHandleComponent.urgeMessageSubject) {\r\n      this.notify.warning(this.i18nService.getValue('task.noUrgeSubject'));\r\n      this.subject.next({ result: false, isClose: false });\r\n    } else if (!this.urgeHandleComponent.urgeMessageContent) {\r\n      this.notify.warning(this.i18nService.getValue('task.noUrgeContent'));\r\n      this.subject.next({ result: false, isClose: false });\r\n    } else {\r\n      let context = new UrgeHandleContext();\r\n      context.procInstId = this.processInstanceId;\r\n      context.urgeUsers = this.urgeHandleResponse.urgeUsers.filter(a => this.assignInfos[0].assignees.some(b => b.id == a.id));\r\n      context.urgeMessageSubject = this.urgeHandleComponent.urgeMessageSubject;\r\n      context.urgeMessageContent = this.urgeHandleComponent.urgeMessageContent;\r\n      context.addReminder = this.addReminder;\r\n      const load = this.loadingService.show();\r\n      this.taskService.urgeHandle(context).subscribe(re => {\r\n        this.notify.success(this.i18nService.getValue('cueWords.success'));\r\n        this.subject.next({ result: true, isClose: false });\r\n        load.close();\r\n      }, error => {\r\n        load.close();\r\n        this.subject.next({ result: false, isClose: false });\r\n        this.taskService.error(error);\r\n      })\r\n    }\r\n\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private cancelConsultSubmit() {\r\n    let context = new WorkItemExecuteParam();\r\n    context.workItemId = this.workItemId;\r\n    context.comment = this.comment;\r\n    context.addendum = this.addendum;\r\n    const load = this.loadingService.show();\r\n    this.taskService.cancelConsult(context).subscribe(() => {\r\n      load.close();\r\n      this.notify.success(this.i18nService.getValue('cueWords.success'));\r\n      this.subject.next({ result: true, isClose: false });\r\n    }, error => {\r\n      load.close();\r\n      this.subject.next({ result: false, isClose: false });\r\n      this.taskService.error(error);\r\n    })\r\n\r\n  }\r\n\r\n  private completeSubmit() {// \r\n    const context: CompleteContext = {\r\n      workItemId: this.workItemId,\r\n      conclusionValue: this.actionEntity.code,\r\n      comment: this.comment,\r\n      signAssignees: this.selectedUsers,\r\n      nextFlowNodes: [],\r\n      addendum: this.addendum,\r\n      //\r\n      dynamicBackWardRule: this.showBackWardConfig.dynamicBackWardRuleAble ? (this.showBackWardConfig.enable ? 'backToThisNode' : 'sequence') : ''\r\n    };\r\n\r\n    if (context.signAssignees.length || !this.response || !this.response.simulationPaths.length) {//  or \r\n      this.completeTask(context);\r\n    } else {\r\n      if (this.selectedNodeId) {// destNodeIdundefined\r\n        const nextFlowNodes: FlowNodeInfo[] = [];\r\n        const nodes: string[] = this.selectedNodeId.split('');\r\n        for (let i = 0; i < nodes.length; i++) {\r\n          const nextFlowNode: FlowNodeInfo = {\r\n            activityDefinitionId: nodes[i],\r\n            activityDefinitionName: this.assignInfos[i].activityName,\r\n            dependency: this.assignInfos[i].dependency,\r\n            selectedAssignees: this.assignInfos[i].assigneeInfo ? this.assignInfos[i].assignees : [],\r\n            assigneeInfo: null,\r\n            resolved: false,\r\n            anonymous: this.assignInfos[i].anonymous,\r\n            anonymousText: this.assignInfos[i].anonymousText\r\n          };\r\n          //\r\n          if (this.response && this.response.simulationPaths.length && !this.response.simulationPaths[0].id.startsWith('ParallelGateway')) {\r\n            if (nodes.length == 1 && nodes[i].startsWith('UserActivity') && this.assignInfos[i].resolved && !this.assignInfos[i].assigneeInfo && !this.assignInfos[i].selectedAssignees.length) {\r\n              const str = this.assignInfos[i].activityName + this.i18nService.getValue('startProcess.node') + this.i18nService.getValue('startProcess.noUser');\r\n              this.notify.warning(str);\r\n              this.subject.next({ result: false, isClose: false });\r\n              return;\r\n            }\r\n          }\r\n          nextFlowNodes.push(nextFlowNode);\r\n        }\r\n        context.nextFlowNodes = nextFlowNodes;\r\n      }\r\n\r\n      if (this.destNodes.length > 1 && context.nextFlowNodes.length <= 0) {// \r\n        this.notify.warning(this.i18nService.getValue('cueWords.selectNode'));\r\n        this.subject.next({ result: false, isClose: false });\r\n      } else if (this.assignInfos.filter(info => info.assigneeInfo && info.assigneeInfo.selectAssignee && !info.assignees.length).length) {\r\n        this.notify.warning(this.i18nService.getValue('task.selectProcessor'));\r\n        this.subject.next({ result: false, isClose: false });\r\n      } else {\r\n        this.completeTask(context);\r\n      }\r\n    }\r\n  }\r\n\r\n  private completeTask(completeContext: CompleteContext) {\r\n    const attachmentNecessary = this.actionEntity.parameters.find(entity => entity.code === 'AttachmentNecessary');\r\n    const certificationNecessary = this.actionEntity.parameters.find(entity => entity.code === 'CertificationNecessary');\r\n    const commentNecessary = this.actionEntity.parameters.find(entity => entity.code === 'CommentNecessary');\r\n    if (attachmentNecessary && attachmentNecessary.value === 'true' && (!completeContext.addendum.attachment || completeContext.addendum.attachment === '[]')) {\r\n      this.notify.warning(this.i18nService.getValue('cueWords.attachmentsRequired'));\r\n      this.subject.next({ result: false, isClose: false });\r\n    } else if (commentNecessary && commentNecessary.value === 'true' && !completeContext.comment) {\r\n      this.notify.warning(this.i18nService.getValue('cueWords.inputOpinion'));\r\n      this.subject.next({ result: false, isClose: false });\r\n    } else if (this.comment.length > 300) {\r\n      this.notify.warning(this.i18nService.getValue('task.commentTooLong'));\r\n      this.subject.next({ result: false, isClose: false });\r\n    } else {\r\n      if (certificationNecessary && certificationNecessary.value === 'true') {\r\n        this.verifySignature(() => {\r\n          completeContext.verifySigned = this.verifySigned;\r\n          this.taskComplete(completeContext);\r\n        });\r\n        const msg = [this.workItemId];\r\n        gspCA.getSignedMsg(msg);\r\n      } else {\r\n        this.taskComplete(completeContext);\r\n      }\r\n    }\r\n  }\r\n\r\n  private executeFormActionsAfterCompleteTask(hander: any) {\r\n    const postActions = this.billMethodConfigs.filter(action => action.action === this.actionEntity.code && action.executionTime === 'Post').sort((x, y) => x.sortOrder - y.sortOrder);\r\n    // \r\n    if (this.ifRegistered && this.formObject && postActions.length) {\r\n      this.executePostFormActions(postActions, hander);\r\n    } else {\r\n      hander();\r\n    }\r\n  }\r\n\r\n  private executePostFormActions(formActions: BillMethodConfig[], hander: any) {\r\n    if (formActions.length > 0) {\r\n      this.messageSubject = new Subject<any>();\r\n      this.messageSubject.subscribe((re: any) => {\r\n        console.log(re.data);\r\n        const data = re.data.data;\r\n        if (data.result === true) {\r\n          this.executePostFormActions(formActions, hander);\r\n        } else {\r\n          this.subject.next({ result: false, isClose: false }); // \r\n          throw new Error('');\r\n        }\r\n      });\r\n      // \r\n      const formAction = formActions.shift();\r\n      this.sendMessage(this.workItemId, formAction);\r\n    } else {\r\n      hander();\r\n    }\r\n  }\r\n\r\n  //\r\n  afterConfirmForTransfer(data: Assignee[]) {\r\n    if (data && data.length) {\r\n      this.selectedUsers = data.map(user => user.id);\r\n      this.selectedUserNgModule = data.map(user => user.name).join();\r\n    } else {\r\n      this.selectedUsers = [];\r\n    }\r\n    if (this.actionEntity.code == 'AddSign' && this.addSign.originMultiInstType == MultiInstanceType.Preempt.toString() && this.selectedUsers.length > 1) {\r\n      this.addSign.showMultiInstanceType = true;\r\n    } else {\r\n      this.addSign.showMultiInstanceType = false;\r\n    }\r\n  }\r\n\r\n  cancel(): Observable<SubmitResult> {\r\n    this.submitResult.isClose = false;\r\n    this.subject.next(this.submitResult);\r\n    return this.subject.asObservable();\r\n  }\r\n\r\n  getSubject() {\r\n    return this.subject.asObservable();\r\n  }\r\n\r\n  // \r\n  selectNodeChange(data: any) {\r\n    this.selectedNodeId = data && data.data && data.data.id;\r\n    if (this.response.simulationPaths[data.index].nodeInfoList.every(node => node.resolved === true)) {// \r\n      this.setAssignInfo(this.response.simulationPaths[data.index].nodeInfoList);\r\n    } else {\r\n      const nodeIds = this.selectedNodeId.split('').map(node => `\"${node}\"`).join(); // \r\n      const load = this.loadingService.show();\r\n      this.taskService.getSimulationAssigneeInfo(this.workItemId, nodeIds).subscribe((nodeInfoList: FlowNodeInfo[]) => {\r\n        load.close();\r\n        this.setAssignInfo(nodeInfoList);\r\n      }, error => {\r\n        load.close();\r\n        this.taskService.error(error);\r\n      });\r\n    }\r\n  }\r\n\r\n  // \r\n  selectNodeClear() {\r\n    this.selectedNodeId = null;\r\n    this.assignInfos = [{\r\n      selectedAssignees: [],\r\n      assigneeInfo: null,\r\n      assignees: [],\r\n      activityName: '',\r\n      dependency: '',\r\n      anonymous: false,\r\n      anonymousText: '',\r\n      resolved: false,\r\n    }];\r\n  }\r\n\r\n  afterConfirmForAssign(data: Assignee[], index: number) {\r\n    this.assignInfos[index].assignees = data;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  addAttachment(data: any) {\r\n    this.addendum.attachment = JSON.stringify(data);\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  addSignature(data: any) {\r\n    if (data) {\r\n      const signInfo = {\r\n        id: data,\r\n        waterMarking: null\r\n      };\r\n      this.addendum.signature = JSON.stringify(signInfo);\r\n    } else {\r\n      this.addendum.signature = '';\r\n    }\r\n  }\r\n\r\n  // padding\r\n  addPadding() {\r\n    this.cls = 'f-utils-fill-flex-column h-100 px-4 py-2';\r\n  }\r\n\r\n\r\n  private sendMessage(workItemId: string, action: BillMethodConfig) {\r\n    if (this.iframe) {\r\n      const iframeWindow = this.iframe.nativeElement.contentWindow;\r\n      const message = {\r\n        target: workItemId,\r\n        data: {\r\n          command: action.method,\r\n          arguments: action.methodParameters\r\n        }\r\n      };\r\n      iframeWindow.postMessage(message, this.POST_MESSAGE_TARGET);\r\n    } else {\r\n      throw new Error('!');\r\n    }\r\n  }\r\n\r\n  // \r\n  verifySignature(handler: any) {\r\n    const that = this;\r\n    if (\r\n      (window as any).gspframeworkService &&\r\n      (window as any).gspframeworkService.rtf\r\n    ) {\r\n      (window as any).gspframeworkService.rtf.caEvent.on(\r\n        (window as any).gspframeworkService.rtf.caEvent.signedMsgOverToken(),\r\n        'signedMsgOver',\r\n        function signMsgOver(signedData) {\r\n          if (signedData && signedData[0] === 'true' && signedData.length > 0) {\r\n            // \r\n            const cert = gspCA.getCurCert();\r\n            // \r\n            that.verifySigned = {\r\n              // base64(certkey)\r\n              certBase64Info: gspCA.getCertBase64(cert),\r\n              // \r\n              msg: [that.workItemId],\r\n              // \r\n              signedmsg: signedData[1][0],\r\n              // \r\n              useCase: null,\r\n            };\r\n            handler();\r\n          } else {\r\n            that.loadingService.close();\r\n            that.subject.next({ result: false, isClose: false });\r\n            that.notify.error(signedData[1]);\r\n            throw new Error(signedData[1]);\r\n          }\r\n        }\r\n      );\r\n    }\r\n  }\r\n\r\n  // \r\n  taskComplete(completeContext: CompleteContext) {\r\n    this.taskService.complete(completeContext).subscribe((cr: CompleteResponse) => {\r\n      this.executeFormActionsAfterCompleteTask(() => {\r\n        if (cr.needInteraction) {// \r\n          if (this.origin == ActionOrigin.TaskCenter) {\r\n            this.subject.next({ result: true, isClose: false });\r\n          } else {\r\n            this.subject.next({ result: false, isClose: false });//loading\r\n          }\r\n          this.notify.info(this.i18nService.getValue('cueWords.select')\r\n            + '' + cr.nextFlowNodes[0].activityDefinitionName + ''\r\n            + this.i18nService.getValue('cueWords.processor'));\r\n          let task = new TaskEntity();\r\n          let action = new TaskAction();\r\n          task.sourceId = cr.nextFlowNodes[0].assigneeInfo.workItemId;\r\n          action.code = 'AssignUser';\r\n          action.name = this.i18nService.getValue('cueWords.assignUser');\r\n          this.handlerService.execute(task, action).subscribe(re => {\r\n            if (re) {\r\n              this.subject.next({ result: true, isClose: true });\r\n            }\r\n          });\r\n        } else {\r\n          if (completeContext.conclusionValue === 'Pass') {\r\n            this.notify.success(this.i18nService.getValue('cueWords.successPass'));\r\n          } else if (completeContext.conclusionValue === 'Back') {\r\n            this.notify.success(this.i18nService.getValue('cueWords.successBack'));\r\n          } else {\r\n            this.notify.success(this.i18nService.getValue('cueWords.success'));\r\n          }\r\n          this.subject.next({ result: true, isClose: true });\r\n        }\r\n      });\r\n    }, (error) => {\r\n      this.subject.next({ result: false, isClose: false });\r\n      this.taskService.error(error);\r\n    }\r\n    );\r\n  }\r\n\r\n}\r\n","import { AssigneeInfo } from './complete-response';\r\nimport { User } from './user';\r\n\r\n/**\r\n * \r\n */\r\nexport class StartProcessPayload {\r\n\r\n    /**\r\n     * ID \r\n     */\r\n    id: string;\r\n\r\n    /**\r\n     * ID\r\n     */\r\n    processDefinitionId: string;\r\n\r\n    /**\r\n     * Key\r\n     */\r\n    processDefinitionKey: string;\r\n\r\n    /**\r\n     * ID\r\n     */\r\n    bizDefKey: string;\r\n\r\n    /**\r\n     * IDBEID\r\n     */\r\n    dataModelId: string;\r\n\r\n    /**\r\n     * \r\n     */\r\n    dataId: string;\r\n\r\n    /**\r\n     * \r\n     */\r\n    name: string;\r\n\r\n    /**\r\n     * \r\n     */\r\n    startUserId: string;\r\n\r\n    /**\r\n     * \r\n     */\r\n    nextFlowNodes: FlowNodeInfo[];\r\n\r\n    /**\r\n     * \r\n     */\r\n    variables: any;\r\n\r\n    /**\r\n     * \r\n     */\r\n    withResponse: boolean;\r\n\r\n}\r\n\r\nexport class FlowNodeInfo {\r\n\r\n    activityDefinitionId: string;\r\n\r\n    activityDefinitionName: string;\r\n\r\n    dependency: string;//\r\n\r\n    selectedAssignees: User[];\r\n\r\n    assigneeInfo: AssigneeInfo;\r\n\r\n    resolved: boolean;//\r\n\r\n    anonymous: boolean;\r\n\r\n    anonymousText: string;\r\n\r\n}\r\n\r\nexport class Assignee {\r\n\r\n    id: string;\r\n\r\n    name: string;\r\n\r\n}\r\n\r\nexport class CancelSubmitPayload {\r\n\r\n    procInstId: string;//ID\r\n\r\n    dataId: string;//dataId+bizDefKey\r\n\r\n    bizDefKey: string;\r\n}\r\n","/**\r\n * iframe\r\n */\r\nexport enum MessageType {\r\n\r\n    SubmitSuccess = 'SubmitSuccess',//iframe\r\n\r\n    SubmitFailed = 'SubmitFailed',//\r\n\r\n    InfoSelectProcess = 'InfoSelectProcess',//\r\n\r\n    InfoSelectNode = 'InfoSelectNode',//\r\n\r\n    InfoSelectParticipant = 'InfoSelectParticipant',//\r\n\r\n    Cancel = 'Cancel',//iframe\r\n}\r\n\r\n/**\r\n * iframe\r\n */\r\nexport class PostMessage {\r\n\r\n    type: MessageType;\r\n\r\n    message: any;\r\n}","/**\r\n * \r\n */\r\nexport class StartProcessCache {\r\n\r\n    selectedProcessList: SelectedProcessItem[];\r\n\r\n}\r\n\r\n/**\r\n * \r\n */\r\nexport class SelectedProcessItem {\r\n\r\n    /**\r\n     * id\r\n     */\r\n    processCategory: string;\r\n\r\n    /**\r\n     * id\r\n     */\r\n    processDefinitionId: string;\r\n\r\n    /**\r\n     * \r\n     */\r\n    processDefinitionName: string;\r\n\r\n    /**\r\n     * \r\n     */\r\n    logTime: Date = new Date();\r\n\r\n    constructor(processCategoryId: string, processDefinitionId: string, processDefinitionName: string) {\r\n        this.processCategory = processCategoryId;\r\n        this.processDefinitionId = processDefinitionId;\r\n        this.processDefinitionName = processDefinitionName;\r\n        this.logTime = new Date();\r\n\r\n    }\r\n\r\n}","import { Component, OnInit, ViewChild, TemplateRef, Input, Injector } from '@angular/core';\r\nimport { TaskService } from '../../service/task.service';\r\nimport { StartProcessPayload, FlowNodeInfo, Assignee } from '../../entity/start-process-payload';\r\nimport { ExecutionResponse } from '../../entity/execution-response';\r\nimport { LoadingService } from '@farris/ui-loading'\r\nimport { Observable, Subject } from 'rxjs';\r\nimport { NotifyService } from '@farris/ui-notify';\r\nimport { I18nService } from '../../service/i18n/i18n.service';\r\nimport { ComboListComponent } from '@farris/ui-combo-list';\r\nimport { MessageType } from '../../entity/postMessage';\r\nimport { MessagerService } from '@farris/ui-messager'\r\nimport { SimulateResponse, SimulationPath } from '../../entity/simulate-response';\r\nimport { AssignInfoHelpEntity } from '../../entity/assignInfoHelp';\r\nimport { WfTaskHandlerService } from '../../wf-task-handler.service';\r\nimport { ConfigCode } from '../../entity/task-center-config';\r\nimport { WfContext } from '../../entity/wfContext';\r\nimport { TaskEntity } from '../../entity/task-entity';\r\nimport { TaskAction } from '../../entity/task-action';\r\nimport { SelectedProcessItem, StartProcessCache } from '../../entity/process-cache';\r\n\r\n@Component({\r\n  selector: 'lib-process-selector',\r\n  templateUrl: './process-selector.component.html',\r\n  styleUrls: ['../../components/task-execute/task-execute.component.css'],\r\n})\r\nexport class ProcessSelectorComponent implements OnInit {\r\n\r\n  // task center-uistart-process-menu\r\n  constructor(\r\n    private taskService: TaskService,\r\n    private loadingService: LoadingService,\r\n    private notify: NotifyService,\r\n    private i18nService: I18nService,\r\n    private messager: MessagerService,\r\n    private injector: Injector,\r\n    private handlerService: WfTaskHandlerService\r\n  ) {\r\n  }\r\n\r\n  ngOnInit() {\r\n  }\r\n\r\n  destProcesses: { id: string, name: string }[] = [];//\r\n  destNodes: { id: string, name: string }[] = [];//\r\n  response: SimulateResponse;//\r\n  assignInfos: AssignInfoHelpEntity[] =\r\n    [{\r\n      selectedAssignees: [],\r\n      assigneeInfo: null,\r\n      assignees: [],\r\n      activityName: '',\r\n      dependency: '',\r\n      anonymous: false,\r\n      anonymousText: null,\r\n      resolved: false,\r\n    }];//\r\n\r\n  selectedProcessId: string;//ID\r\n  selectedNodeId: string; //IDid\r\n  payload = new StartProcessPayload;//payload\r\n  subject = new Subject();//bool\r\n  subjectWithResponse = new Subject<any>();//\r\n  subjectCancel = new Subject();//subject\r\n  submitDisable: boolean = false;//\r\n  _dataId: string;\r\n  _bizDefKey: string;\r\n  showButtons: boolean = false;\r\n  curLanguage: string = localStorage.getItem('languageCode') || 'zh-CHS';//\r\n  nodePlaceholder: string;//placeholder\r\n  processPlaceholder: string;//placeholder\r\n  wfContext = new WfContext();//\r\n\r\n  @ViewChild('nodeCombo') nodeCombo: ComboListComponent\r\n  @ViewChild('buttons') buttons: TemplateRef<any>;//\r\n  @Input() openFromIframe: boolean = false;//iframeIDP\r\n\r\n  @Input()\r\n  set dataId(dataId: string) {\r\n    if (!dataId) {\r\n      throw new Error(\"dataId\");\r\n    }\r\n    this._dataId = dataId;\r\n  }\r\n\r\n  @Input()\r\n  set bizDefKey(bizDefKey: string) {\r\n    if (!bizDefKey) {\r\n      throw new Error(\"id\");\r\n    }\r\n    this.showButtons = true;\r\n    this._bizDefKey = bizDefKey;\r\n    var payload = new StartProcessPayload();\r\n    payload.dataId = this._dataId;\r\n    payload.bizDefKey = this._bizDefKey;\r\n    this.setParam(payload);\r\n  }\r\n\r\n  setParam(param: StartProcessPayload): Observable<any> {\r\n    let subject = new Subject<any>();\r\n    if (!param) { return; }\r\n    this.payload.id = param.id;\r\n    this.payload.processDefinitionId = param.processDefinitionId;\r\n    this.payload.processDefinitionKey = param.processDefinitionKey;\r\n    this.payload.bizDefKey = param.bizDefKey;\r\n    this.payload.dataModelId = param.dataModelId;\r\n    this.payload.dataId = param.dataId;\r\n    this.payload.name = param.name;\r\n    this.payload.startUserId = param.startUserId;\r\n    this.payload.nextFlowNodes = [];\r\n    this.wfContext.processCategoryId = param.bizDefKey;\r\n    this.startProcessSimulate(this.payload, subject);\r\n    return subject.asObservable();\r\n  }\r\n\r\n  startProcessSimulate(payload: StartProcessPayload, subject: Subject<any>) {\r\n    const load = this.loadingService.show();\r\n    this.taskService.startProcessSimulate(payload).subscribe((response: SimulateResponse) => {\r\n      load.close();\r\n      subject.next(true);\r\n      this.response = response;\r\n      this.destProcesses = response.procDefs.map(process => ({ id: process.procDefId, name: process.procDefName + `(v${process.version}.0)` }));//\r\n      if (this.destProcesses.length === 1) {//\r\n        this.selectedProcessId = this.destProcesses[0].id;\r\n        this.setNextNode(response);\r\n        this.processPlaceholder = this.destProcesses[0].name;\r\n      } else {//\r\n        const selectedProcessId = this.getSelectedProcessCache(this.payload.bizDefKey);\r\n        if (selectedProcessId && this.destProcesses.findIndex(p => p.id === selectedProcessId.processDefinitionId) > -1) {\r\n          this.getDestNodes(selectedProcessId.processDefinitionId);\r\n          this.processPlaceholder = selectedProcessId.processDefinitionName;\r\n        } else {\r\n          this.processPlaceholder = this.i18nService.getValue('task.selectPlaceholder');\r\n        }\r\n      }\r\n    }, error => {\r\n      load.close();\r\n      subject.error(error);\r\n      this.taskService.error(error);\r\n    })\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param data\r\n   */\r\n  selectProcessChange(data: any) {\r\n    this.nodeCombo.onClear();\r\n    this.getDestNodes(data.data.id);\r\n  }\r\n\r\n  /**\r\n   * id\r\n   * @param selectedProcessId \r\n   */\r\n  private getDestNodes(selectedProcessId: string) {\r\n    this.selectedProcessId = selectedProcessId;\r\n    this.destNodes = [];\r\n    this.nodePlaceholder = '';\r\n    this.clearAssignInfos();\r\n\r\n    var payload = new StartProcessPayload();\r\n    payload.processDefinitionId = this.selectedProcessId;\r\n    payload.dataId = this.payload.dataId;\r\n\r\n    const load = this.loadingService.show();\r\n    this.taskService.startProcessSimulate(payload).subscribe((response: SimulateResponse) => {\r\n      load.close();\r\n      this.response = response;\r\n      this.setNextNode(response);\r\n    }, error => {\r\n      load.close();\r\n      this.taskService.error(error);\r\n    })\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  selectNodeChange(data: any) {\r\n    this.clearAssignInfos();\r\n    this.selectedNodeId = data.data.id;\r\n    const nodeNames = data.data.name.split('');\r\n\r\n    if (this.response.simulationPaths[data.index].nodeInfoList.every(node => node.resolved === true)) {//\r\n      this.setAssignInfo(this.response.simulationPaths[data.index]);\r\n    } else {//\r\n      let payload = new StartProcessPayload();\r\n      payload.processDefinitionId = this.selectedProcessId;\r\n      payload.dataId = this.payload.dataId;\r\n      payload.nextFlowNodes = [];\r\n\r\n      this.selectedNodeId.split('').forEach((nodeId, index) => {\r\n        let nextFlowNode = new FlowNodeInfo();\r\n        nextFlowNode.activityDefinitionId = nodeId;\r\n        nextFlowNode.activityDefinitionName = nodeNames[index];\r\n        payload.nextFlowNodes.push(nextFlowNode);\r\n      });\r\n\r\n      const load = this.loadingService.show();\r\n      this.taskService.startProcessSimulate(payload).subscribe((response: SimulateResponse) => {\r\n        load.close();\r\n        this.setAssignInfo(response.simulationPaths[0]);//simulationPaths[0]\r\n      }, error => {\r\n        load.close();\r\n        this.taskService.error(error);\r\n      })\r\n    }\r\n  }\r\n\r\n  /**\r\n * \r\n */\r\n  startProcessSubmit() {\r\n    if (!this.selectedProcessId) {\r\n      this.openFromIframe ? this.messager.warning(this.i18nService.getValue('startProcess.selectProcess')) :\r\n        this.notify.warning(this.i18nService.getValue('startProcess.selectProcess'));\r\n      return;\r\n    }\r\n    if (!this.selectedNodeId) {\r\n      this.openFromIframe ? this.messager.warning(this.i18nService.getValue('startProcess.selectNode')) :\r\n        this.notify.warning(this.i18nService.getValue('startProcess.selectNode'));\r\n      return;\r\n    }\r\n    if (this.assignInfos.filter(info => (info.assigneeInfo || info.selectedAssignees.length) && !info.assignees.length).length) {//\r\n      this.openFromIframe ? this.messager.warning(this.i18nService.getValue('task.selectProcessor')) :\r\n        this.notify.warning(this.i18nService.getValue('task.selectProcessor'));\r\n      return;\r\n    }\r\n\r\n    const nodes: string[] = this.selectedNodeId.split('');\r\n    for (let i = 0; i < nodes.length; i++) {\r\n      let nextFlowNode: FlowNodeInfo = {\r\n        activityDefinitionId: nodes[i],\r\n        activityDefinitionName: this.assignInfos[i].activityName,\r\n        dependency: this.assignInfos[i].dependency,\r\n        selectedAssignees: this.assignInfos[i].assigneeInfo ? this.assignInfos[i].assignees : [],\r\n        assigneeInfo: null,\r\n        resolved: false,\r\n        anonymous: false,\r\n        anonymousText: ''\r\n      }\r\n      //\r\n      if (this.response && this.response.simulationPaths.length && !this.response.simulationPaths[0].id.startsWith('ParallelGateway')) {\r\n        if (nodes.length == 1 && nodes[i].startsWith('UserActivity') && this.assignInfos[i].resolved && !this.assignInfos[i].assigneeInfo && !this.assignInfos[i].selectedAssignees.length) {\r\n          const str = this.assignInfos[i].activityName + this.i18nService.getValue('startProcess.node') + this.i18nService.getValue('startProcess.noUser');\r\n          this.openFromIframe ? this.messager.warning(str) : this.notify.warning(str);\r\n          return;\r\n        }\r\n      }\r\n      this.payload.nextFlowNodes.push(nextFlowNode);\r\n    }\r\n    this.payload.processDefinitionId = this.selectedProcessId;\r\n    this.submitDisable = true;\r\n    const load = this.loadingService.show();\r\n    this.taskService.startProcess(this.payload).subscribe((response: ExecutionResponse) => {\r\n      load.close();\r\n      this.submitDisable = false;\r\n      this.subject.next(true);\r\n      this.subjectWithResponse.next(response);\r\n      let messageAfterSubmit = this.i18nService.getValue('startProcess.submitSuccess');\r\n      if (this.openFromIframe) {\r\n        (window.parent as any).gspWfService.eventHandler({ data: { type: MessageType.SubmitSuccess, message: messageAfterSubmit } });\r\n      } else {\r\n        this.handlerService.handleSubmitMessage(ConfigCode.Info_After_Submit, this.payload.bizDefKey);\r\n      }\r\n      if (!this.openFromIframe && response.needInteraction) {//\r\n        this.notify.info(this.i18nService.getValue('cueWords.select')\r\n          + response.nextFlowNodes[0].activityDefinitionName\r\n          + this.i18nService.getValue('cueWords.processor'));\r\n        let task = new TaskEntity();\r\n        let action = new TaskAction();\r\n        task.sourceId = response.nextFlowNodes[0].assigneeInfo.workItemId;\r\n        action.code = 'AssignUser';\r\n        action.name = this.i18nService.getValue('cueWords.assignUser');\r\n        this.handlerService.execute(task, action).subscribe(re => { });\r\n      }\r\n      this.setSelectedProcessCache();\r\n    }, (error) => {\r\n      load.close();\r\n      this.payload.nextFlowNodes = [];\r\n      this.submitDisable = false;\r\n      this.subject.next(false);//subjectfalse by fangpengfei@20210324\r\n      this.taskService.error(error);\r\n    })\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  selectProcessClear() {\r\n    this.selectedProcessId = '';\r\n    this.destNodes = [];\r\n    this.nodePlaceholder = '';\r\n    this.selectedNodeId = '';\r\n    this.clearAssignInfos();\r\n    this.response = null;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  selectNodeClear() {\r\n    this.selectedNodeId = '';\r\n    this.clearAssignInfos();\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  afterConfirm(data: Assignee[], index: number) {\r\n    this.assignInfos[index].assignees = data;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  cancel() {\r\n    if (this.openFromIframe) {\r\n      (window.parent as any).gspWfService.eventHandler({ data: { type: MessageType.Cancel, message: '' } });\r\n    } else {\r\n      this.subjectCancel.next(false);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * bool\r\n   */\r\n  getSubject() {\r\n    return this.subject.asObservable();\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  getSubjectWithResponse() {\r\n    return this.subjectWithResponse.asObservable();\r\n  }\r\n  /**\r\n   * subject\r\n   * @returns\r\n   */\r\n  getSubjectCancel() {\r\n    return this.subjectCancel.asObservable();\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private setNextNode(response: SimulateResponse) {\r\n    this.destNodes = response.simulationPaths && response.simulationPaths.map(path => ({\r\n      id: path.nodeInfoList.map(node => node.activityDefinitionId).join(''),\r\n      name: path.nodeInfoList.map(node => node.activityDefinitionName).join('')\r\n    }));\r\n    //-1\r\n    const defaultIndex = response.simulationPaths.findIndex(a => a.default);\r\n    if (defaultIndex > -1) {\r\n      this.selectedNodeId = this.destNodes[defaultIndex].id;\r\n      this.nodePlaceholder = this.destNodes[defaultIndex].name.indexOf('') > -1 ? response.simulationPaths[defaultIndex].name : this.destNodes[defaultIndex].name;\r\n      this.setAssignInfo(response.simulationPaths[defaultIndex]);\r\n    } else {\r\n      this.nodePlaceholder = this.i18nService.getValue('task.selectPlaceholder');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private setAssignInfo(simulationPaths: SimulationPath) {\r\n    this.assignInfos = [];\r\n    this.selectedNodeId.split('').forEach(nodeId => {\r\n      const node = simulationPaths.nodeInfoList.find(node => node.activityDefinitionId === nodeId);\r\n      if (node) {\r\n        this.assignInfos.push({\r\n          selectedAssignees: node.selectedAssignees,\r\n          assigneeInfo: node.assigneeInfo,\r\n          assignees: node.selectedAssignees.map(user => { return { id: user.id, name: user.name } }),\r\n          activityName: node.activityDefinitionName,\r\n          dependency: node.dependency,\r\n          anonymous: node.anonymous,\r\n          anonymousText: node.anonymousText,\r\n          resolved: node.resolved\r\n        })\r\n      } else {\r\n        this.assignInfos.push({\r\n          selectedAssignees: [],\r\n          assigneeInfo: null,\r\n          assignees: [],\r\n          activityName: '',\r\n          dependency: '',\r\n          anonymous: false,\r\n          anonymousText: '',\r\n          resolved: false,\r\n        })\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private clearAssignInfos() {\r\n    this.assignInfos = [{\r\n      selectedAssignees: [],\r\n      assigneeInfo: null,\r\n      assignees: [],\r\n      activityName: '',\r\n      dependency: '',\r\n      anonymous: false,\r\n      anonymousText: '',\r\n      resolved: false,\r\n    }];\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private getSelectedProcessCache(processCategoryId: string) {\r\n    let browserCache = JSON.parse(localStorage.getItem(\"gspWfStartProcess\")) as StartProcessCache;\r\n    if (browserCache && browserCache.selectedProcessList) {\r\n      return browserCache.selectedProcessList.find(a => a.processCategory == processCategoryId);\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private setSelectedProcessCache() {\r\n    const processCategoryId = this.payload.bizDefKey;\r\n    const processDefinitionId = this.payload.processDefinitionId;\r\n    let process = this.destProcesses.find(a => a.id == processDefinitionId);\r\n    const processDefinitionName = process && process.name;\r\n\r\n    let browserCache = JSON.parse(localStorage.getItem(\"gspWfStartProcess\")) as StartProcessCache;\r\n    if (browserCache && browserCache.selectedProcessList) {\r\n      let selectedProcessList = browserCache.selectedProcessList;\r\n      if (selectedProcessList.findIndex(a => a.processCategory == processCategoryId) > -1) {\r\n        selectedProcessList.map(item => {\r\n          if (item.processCategory == processCategoryId) {\r\n            item.processDefinitionId = processDefinitionId;\r\n            item.processDefinitionName = processDefinitionName;\r\n            item.logTime = new Date();\r\n          }\r\n        });\r\n        browserCache.selectedProcessList = selectedProcessList;\r\n        localStorage.setItem(\"gspWfStartProcess\", JSON.stringify(browserCache));\r\n      } else {\r\n        let item = new SelectedProcessItem(processCategoryId, processDefinitionId, processDefinitionName);\r\n        selectedProcessList.push(item);\r\n        browserCache.selectedProcessList = selectedProcessList;\r\n        localStorage.setItem(\"gspWfStartProcess\", JSON.stringify(browserCache));\r\n      }\r\n    } else {\r\n      let browserCache = new StartProcessCache();\r\n      let selectedProcessList = [];\r\n      let item = new SelectedProcessItem(processCategoryId, processDefinitionId, processDefinitionName);\r\n      selectedProcessList.push(item);\r\n      browserCache.selectedProcessList = selectedProcessList;\r\n      localStorage.setItem(\"gspWfStartProcess\", JSON.stringify(browserCache));\r\n\r\n    }\r\n\r\n  }\r\n\r\n}\r\n","import { Injectable, Injector, ComponentFactoryResolver, ApplicationRef } from '@angular/core';\r\nimport { WfApprovalLogsService } from '@gsp-wf/wf-approval-logs'\r\nimport { ForecastProcessPayload, WFFlowchartService } from '@gsp-wf/ui-flowchart';\r\nimport { BsModalService, ModalOptions } from '@farris/ui-modal';\r\nimport { Observable, Subject, of } from 'rxjs';\r\nimport { TaskService } from './service/task.service';\r\nimport { TaskAction } from './entity/task-action';\r\nimport { AssigneeInfo } from './entity/complete-response';\r\nimport { NotifyService } from '@farris/ui-notify';\r\nimport { I18nService } from './service/i18n/i18n.service';\r\nimport { FrameworkService, AppOptions } from '@gsp-sys/rtf-common';\r\nimport { BizFormResult, FormParameter } from './entity/bizform';\r\nimport { TaskEntity } from './entity/task-entity';\r\nimport { TaskExecuteComponent } from './components/task-execute/task-execute.component';\r\nimport { switchMap } from 'rxjs/operators';\r\nimport { StartProcessPayload, CancelSubmitPayload } from './entity/start-process-payload';\r\nimport { ProcessSelectorComponent } from './submit/process-selector/process-selector.component';\r\nimport { ExecutionResponse } from './entity/execution-response';\r\nimport { LoadingService } from '@farris/ui-loading';\r\nimport { MessagerService } from '@farris/ui-messager';\r\nimport { BatchCancelNumber, BatchSubmitNumber } from './entity/batchNumber';\r\nimport { SimulateResponse } from './entity/simulate-response';\r\nimport { ConfigCode, OwnerType } from './entity/task-center-config';\r\n\r\n@Injectable()\r\nexport class WfTaskHandlerService {\r\n\r\n  subject = new Subject<any>();\r\n  private loading: LoadingService;\r\n  private message: MessagerService;\r\n  private curLanguage: string = localStorage.getItem('languageCode') || 'zh-CHS';//\r\n  private batchSubmitNum: BatchSubmitNumber = {//\r\n    successNum: 0,\r\n    failedNum: 0,\r\n    errorNum: 0,\r\n  };\r\n  private batchCancelNum: BatchCancelNumber = {//\r\n    successNum: 0,\r\n    errorNum: 0\r\n  }\r\n\r\n  constructor(\r\n    private logService: WfApprovalLogsService,\r\n    private flowchartService: WFFlowchartService,\r\n    private injector: Injector,\r\n    private resolver: ComponentFactoryResolver,\r\n    private modalService: BsModalService,\r\n    private taskService: TaskService,\r\n    private notify: NotifyService,\r\n    private i18nService: I18nService,\r\n    private frameworkService: FrameworkService,\r\n    private appRef: ApplicationRef,\r\n  ) {\r\n    this.loading = this.injector.get(LoadingService);\r\n    this.message = this.injector.get(MessagerService);\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param entity \r\n   * @param action \r\n   */\r\n  execute(task: TaskEntity, action: TaskAction): Observable<any> {\r\n    switch (action.code) {\r\n      case 'ViewBizLog'://\r\n        this.logService.showByDataId(task.refBizId);\r\n        break;\r\n      case 'ViewFlowChart'://\r\n        this.flowchartService.viewFlowChart(task.processInstanceId);\r\n        break;\r\n      case 'ViewExecuteForm':// \r\n        this.openApp(task, action);\r\n        break;\r\n      default: //\r\n        this.complete(task, action);\r\n    }\r\n    return this.subject.asObservable();\r\n  }\r\n\r\n  assignByInfo(assigneeInfo: AssigneeInfo, openFromIframe: boolean): Observable<any> {\r\n    const assignSubject = new Subject<any>();\r\n    return assignSubject.asObservable();\r\n  }\r\n\r\n  private complete(task: TaskEntity, action: TaskAction) {\r\n    const compFactory = this.resolver.resolveComponentFactory(TaskExecuteComponent);\r\n    const compRef = compFactory.create(this.injector);\r\n    compRef.instance.setTask(task);\r\n    compRef.instance.setAction(action);\r\n    compRef.instance.addPadding();\r\n    const modalConfig: ModalOptions = {\r\n      title: action.name ? action.name : this.i18nService.getValue('task.title'),\r\n      width: 550,\r\n      height: compRef.instance.dialogHeight,\r\n      showButtons: true,\r\n      buttons: compRef.instance.buttons\r\n    };\r\n    const dialog = this.modalService.show(compRef, modalConfig);\r\n    compRef.instance.getSubject().subscribe(re => {\r\n      re && re.result && this.subject.next(true);\r\n      re && re.result && dialog.close();\r\n    })\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param entity \r\n   * @param action \r\n   */\r\n  openApp(entity: TaskEntity, action: TaskAction) {\r\n    const taskId = entity.sourceId;\r\n    const getFormInfoLoading = this.loading.show();\r\n    this.taskService.getAppInfo(taskId).subscribe((formInfo: BizFormResult) => {\r\n      getFormInfoLoading.close();\r\n\r\n      if (!formInfo) {\r\n        this.notify.info(this.i18nService.getValue('task.notFoundBill'));\r\n        return;\r\n      }\r\n      const options: AppOptions = {\r\n        appType: 'menu',\r\n        funcId: '',\r\n        appId: '',\r\n        appEntrance: '',\r\n        tabId: taskId,\r\n        isNewTab: true\r\n      };\r\n      // \r\n      const parameters = new Map<string, any>();\r\n      // \r\n      if (formInfo.appId) {\r\n        // \r\n        if (formInfo.formType === '1') {//\r\n          parameters.set('workItemId', taskId);\r\n          parameters.set('procInstId', action.parameters[0].value);\r\n          parameters.set('taskState', entity.state);\r\n          parameters.set('isAssign', entity.actions.some(action => action.code === 'AssignUser'));\r\n          formInfo.parameters.forEach((item: FormParameter) =>\r\n            parameters.set(item.code, item.value)\r\n          );\r\n          options.funcId = formInfo.appId;\r\n        } else {//\r\n          options.funcId = 'WF0120';\r\n          parameters.set('taskId', entity.id);\r\n          parameters.set('taskState', entity.state);\r\n        }\r\n      } else if (formInfo.url) {//\r\n        options.funcId = 'WF0120';\r\n        parameters.set('taskId', entity.id);\r\n        parameters.set('taskState', entity.state);\r\n      } else {\r\n        this.notify.info(this.i18nService.getValue('task.notFoundBill'));\r\n        return;\r\n      }\r\n      options.entityParams = parameters;\r\n      options.queryStringParams = parameters;//IDP\r\n      const openMenuLoading = this.loading.show();\r\n      this.frameworkService.openMenu$(options).subscribe(() => {\r\n        openMenuLoading.close();\r\n      });\r\n    }, error => {\r\n      getFormInfoLoading.close();\r\n      this.taskService.error(error);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param workItemId \r\n   */\r\n  refreshActions(workItemId: string): Observable<any> {\r\n    return this.taskService.getWorkItemActions(workItemId).pipe(\r\n      switchMap((actionList: any[]) => {\r\n        return of(actionList.filter(action =>\r\n          action.code !== 'ViewBizLog' &&\r\n          action.code !== 'ViewFlowChart' &&\r\n          action.code !== 'ViewExecuteForm'\r\n        ));\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * IDCode by fangpengfei@2020.06.22\r\n   * @param procInstId ID\r\n   * @param state \r\n   * @param actionCode Code\r\n   */\r\n  executeByProcInstId(procInstId: string, state: number, actionCode: string): Observable<any> {\r\n    var action = new TaskAction();\r\n    action.code = actionCode;\r\n    const subject = new Subject();\r\n    this.taskService.getTaskByProcInstId(procInstId, state).subscribe((task: TaskEntity) => {\r\n      if (task) {\r\n        this.execute(task, action).subscribe(re => {\r\n          subject.next(re);\r\n        })\r\n      } else {\r\n        this.notify.info(this.i18nService.getValue('task.noTask'));\r\n      }\r\n    })\r\n    return subject.asObservable();\r\n  }\r\n\r\n  /**\r\n   * workItemId \r\n   * @param workItemId ID\r\n   * @param action \r\n   */\r\n  executeByWorkItemId(workItemId: string, action: TaskAction): Observable<any> {\r\n    let task = new TaskEntity();\r\n    task.sourceId = workItemId;\r\n    return this.execute(task, action);\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param payload \r\n   * @returns subject truefalse \r\n   */\r\n  startProcess(payload: StartProcessPayload): Observable<any> {\r\n    const subject = new Subject();\r\n    const configLoad = this.loading.show();\r\n    this.taskService.getTaskCenterConfigByCode(ConfigCode.If_Show_Submit_Dialog, OwnerType.BizDefKey, payload.bizDefKey).subscribe(re => {\r\n      configLoad.close();\r\n      if (re && re.currentValue === 'false') {//\r\n        const simulateLoad = this.loading.show();\r\n        this.taskService.startProcessSimulate(payload).subscribe((response: SimulateResponse) => {//\r\n          simulateLoad.close();\r\n          if (!response || response.needInteraction === false) {//\r\n            const executeLoad = this.loading.show();\r\n            this.taskService.startProcess(payload).subscribe((response: ExecutionResponse) => {//\r\n              executeLoad.close();\r\n              subject.next(response);\r\n              this.handleSubmitMessage(ConfigCode.Info_After_Submit, payload.bizDefKey);\r\n            }, error => {//\r\n              executeLoad.close();\r\n              subject.next(null);\r\n              this.taskService.error(error);\r\n            });\r\n          } else {//\r\n            this.showStartProcessDialog(payload).subscribe(re => {\r\n              subject.next(re);\r\n            });\r\n          }\r\n        }, error => {//\r\n          simulateLoad.close();\r\n          subject.next(null);\r\n          this.taskService.error(error);\r\n        })\r\n      } else {//\r\n        this.showStartProcessDialog(payload).subscribe(re => {\r\n          subject.next(re);\r\n        });\r\n      }\r\n    }, error => {//\r\n      configLoad.close();\r\n      this.taskService.error(error);\r\n    })\r\n    return subject.asObservable();\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param payload \r\n   * @param withResponse \r\n   */\r\n  private showStartProcessDialog(payload: StartProcessPayload): Observable<any> {\r\n    const subject = new Subject();\r\n    const compFactory = this.resolver.resolveComponentFactory(ProcessSelectorComponent);\r\n    const compRef = compFactory.create(this.injector);\r\n    compRef.instance.setParam(payload).subscribe(() => {\r\n      const modalConfig: ModalOptions = {\r\n        title: this.i18nService.getValue('startProcess.title'),\r\n        width: 520,\r\n        height: 338,\r\n        showButtons: true,\r\n        buttons: compRef.instance.buttons\r\n      };\r\n      const dialog = this.modalService.show(compRef, modalConfig);\r\n      if (payload.withResponse === true) {//\r\n        compRef.instance.getSubjectWithResponse().subscribe(re => {\r\n          subject.next(re);\r\n          dialog.close();\r\n        });\r\n        compRef.instance.getSubjectCancel().subscribe(() => {\r\n          dialog.close();\r\n        });\r\n      } else {//\r\n        compRef.instance.getSubject().subscribe(re => {\r\n          subject.next(re);\r\n          dialog.close();\r\n        });\r\n        compRef.instance.getSubjectCancel().subscribe(re => {\r\n          subject.next(re);\r\n          dialog.close();\r\n        });\r\n      }\r\n    });\r\n    return subject.asObservable();\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @payload payload \r\n   */\r\n  cancelSubmit(payload: CancelSubmitPayload): Observable<any> {\r\n    const subject = new Subject();\r\n    const load = this.loading.show();\r\n    this.taskService.cancelSubmit(payload).subscribe(() => {\r\n      load.close();\r\n      subject.next(true);\r\n      this.handleSubmitMessage(ConfigCode.Info_After_Cancel_Submit, payload.bizDefKey);\r\n    }, error => {\r\n      load.close();\r\n      subject.error(false);\r\n      this.taskService.error(error);\r\n    })\r\n    return subject.asObservable();\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param dataId id\r\n   * @param bizDefKey id\r\n   * @param options \r\n   */\r\n  submitWithBizDefKey(dataId: string, bizDefKey: string): Observable<any> {\r\n    if (!dataId) {\r\n      this.notify.warning(this.i18nService.getValue('startProcess.dataIdIsNull'));\r\n      return;\r\n    }\r\n    if (!bizDefKey) {\r\n      this.message.error(this.i18nService.getValue('startProcess.bizDefKeyIsNull'));\r\n      return;\r\n    }\r\n\r\n    var payload = new StartProcessPayload();\r\n    payload.dataId = dataId;\r\n    payload.bizDefKey = bizDefKey;\r\n    payload.withResponse = true;\r\n\r\n    return this.startProcess(payload);\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param dataId id\r\n   * @param bizDefKey id\r\n   * @param options \r\n   */\r\n  cancelSubmitWithDataId(dataId: string, bizDefKey: string): Observable<any> {\r\n    if (!dataId) {\r\n      this.notify.warning(this.i18nService.getValue('startProcess.dataIdIsNull'));\r\n      return;\r\n    }\r\n    if (!bizDefKey) {\r\n      this.message.error(this.i18nService.getValue('startProcess.bizDefKeyIsNull'));\r\n      return;\r\n    }\r\n    var cancelSubmitPayload = new CancelSubmitPayload();\r\n    cancelSubmitPayload.dataId = dataId;\r\n    cancelSubmitPayload.bizDefKey = bizDefKey;\r\n    return this.cancelSubmit(cancelSubmitPayload);\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param dataIds ID\r\n   * @param bizDefKey id\r\n   */\r\n  batchSubmitWithBizDefKey(dataIds: string[], bizDefKey: string): Observable<any> {\r\n    if (!dataIds || !dataIds.length) {\r\n      this.notify.warning(this.i18nService.getValue('startProcess.dataIdIsEmpty'));\r\n      return;\r\n    }\r\n    if (!bizDefKey) {\r\n      this.message.error(this.i18nService.getValue('startProcess.bizDefKeyIsNull'));\r\n      return;\r\n    }\r\n    if (dataIds.length === 1) {\r\n      var startPayload = new StartProcessPayload()\r\n      startPayload.bizDefKey = bizDefKey;\r\n      startPayload.dataId = dataIds[0];\r\n      return this.startProcess(startPayload);\r\n    }\r\n\r\n    const subject = new Subject();\r\n    const load = this.loading.show();\r\n    this.batchSubmitNum.successNum = 0;\r\n    this.batchSubmitNum.failedNum = 0;\r\n    this.batchSubmitNum.errorNum = 0;\r\n    this.batchSubmitHelpFunction([...dataIds], bizDefKey, () => {\r\n      load.close();\r\n      subject.next(true);\r\n    });\r\n    return subject.asObservable();\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private batchSubmitHelpFunction(dataIds: string[], bizDefKey: string, handler: Function) {\r\n    if (dataIds && dataIds.length > 0) {\r\n      const dataId = dataIds.shift();//\r\n      let startPayload = new StartProcessPayload()\r\n      startPayload.bizDefKey = bizDefKey;\r\n      startPayload.dataId = dataId;\r\n      startPayload.variables = { simulate: true };\r\n      this.taskService.startProcess(startPayload).subscribe((response: ExecutionResponse) => {\r\n        if (response.needInteraction) {//\r\n          this.batchSubmitNum.failedNum++;\r\n          this.batchSubmitHelpFunction(dataIds, bizDefKey, handler);\r\n        } else {//\r\n          startPayload.variables = { simulate: false };\r\n          this.taskService.startProcess(startPayload).subscribe((response: ExecutionResponse) => {\r\n            this.batchSubmitNum.successNum++;\r\n            this.batchSubmitHelpFunction(dataIds, bizDefKey, handler);\r\n          }, () => {//\r\n            this.batchSubmitNum.errorNum++;\r\n            this.batchSubmitHelpFunction(dataIds, bizDefKey, handler);\r\n          })\r\n        }\r\n      }, () => {//\r\n        this.batchSubmitNum.errorNum++;\r\n        this.batchSubmitHelpFunction(dataIds, bizDefKey, handler);\r\n      })\r\n    } else {//\r\n      this.showBatchSubmitInfo(this.batchSubmitNum, bizDefKey);\r\n      handler();//\r\n    }\r\n\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param dataIds ID\r\n   * @param bizDefKey id\r\n   */\r\n  batchCancelSubmitWithDataId(dataIds: string[], bizDefKey: string): Observable<any> {\r\n    if (!dataIds || !dataIds.length) {\r\n      this.notify.warning(this.i18nService.getValue('startProcess.dataIdIsEmpty'));\r\n      return;\r\n    }\r\n    if (!bizDefKey) {\r\n      this.message.error(this.i18nService.getValue('startProcess.bizDefKeyIsNull'));\r\n      return;\r\n    }\r\n    if (dataIds.length === 1) {\r\n      return this.cancelSubmitWithDataId(dataIds[0], bizDefKey);\r\n    }\r\n    const subject = new Subject();\r\n    const load = this.loading.show();\r\n    this.batchCancelNum.successNum = 0;\r\n    this.batchCancelNum.errorNum = 0;\r\n    this.batchCancelHelpFunction([...dataIds], bizDefKey, () => {\r\n      load.close();\r\n      subject.next(true);\r\n    });\r\n    return subject.asObservable();\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private batchCancelHelpFunction(dataIds: string[], bizDefKey: string, handler: Function) {\r\n    if (dataIds && dataIds.length) {\r\n      const dataId = dataIds.shift();//\r\n      let cancelPayload = new CancelSubmitPayload();\r\n      cancelPayload.dataId = dataId;\r\n      cancelPayload.bizDefKey = bizDefKey;\r\n      this.taskService.cancelSubmit(cancelPayload).subscribe(() => {//\r\n        this.batchCancelNum.successNum++;\r\n        this.batchCancelHelpFunction(dataIds, bizDefKey, handler);\r\n      }, () => {//\r\n        this.batchCancelNum.errorNum++;\r\n        this.batchCancelHelpFunction(dataIds, bizDefKey, handler);\r\n      })\r\n    } else {\r\n      this.showBatchCancelSubmitInfo(this.batchCancelNum, bizDefKey);\r\n      handler();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param parentDataId id\r\n   * @param childDataId id\r\n   * @param bizDefKey id\r\n   */\r\n  childSubmit(parentDataId: string, childDataId: string, bizDefKey: string): Observable<any> {\r\n    if (!parentDataId || !childDataId) {\r\n      this.notify.warning(this.i18nService.getValue('startProcess.dataIdIsNull'));\r\n      return;\r\n    }\r\n    if (!bizDefKey) {\r\n      this.message.error(this.i18nService.getValue('startProcess.bizDefKeyIsNull'));\r\n      return;\r\n    }\r\n    var startProcessPayload = new StartProcessPayload();\r\n    startProcessPayload.dataId = `${parentDataId},${childDataId}`;\r\n    startProcessPayload.bizDefKey = bizDefKey;\r\n    return this.startProcess(startProcessPayload);\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param parentDataId id\r\n   * @param childDataId id\r\n   * @param bizDefKey id\r\n   */\r\n  childCancelSubmit(parentDataId: string, childDataId: string, bizDefKey: string): Observable<any> {\r\n    if (!parentDataId || !childDataId) {\r\n      this.notify.warning(this.i18nService.getValue('startProcess.dataIdIsNull'));\r\n      return;\r\n    }\r\n    if (!bizDefKey) {\r\n      this.message.error(this.i18nService.getValue('startProcess.bizDefKeyIsNull'));\r\n      return;\r\n    }\r\n    var cancelSubmitPayload = new CancelSubmitPayload();\r\n    cancelSubmitPayload.dataId = `${parentDataId},${childDataId}`;\r\n    cancelSubmitPayload.bizDefKey = bizDefKey;\r\n    return this.cancelSubmit(cancelSubmitPayload);\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param parentDataId id\r\n   * @param childDataIds id\r\n   * @param bizDefKey id\r\n   */\r\n  childBatchSubmit(parentDataId: string, childDataIds: string[], bizDefKey: string): Observable<any> {\r\n    if (!parentDataId || !childDataIds) {\r\n      this.notify.warning(this.i18nService.getValue('startProcess.dataIdIsNull'));\r\n      return;\r\n    }\r\n    if (!bizDefKey) {\r\n      this.message.error(this.i18nService.getValue('startProcess.bizDefKeyIsNull'));\r\n      return;\r\n    }\r\n    const dataIds = childDataIds.map(childDataId => `${parentDataId},${childDataId}`);\r\n    return this.batchSubmitWithBizDefKey(dataIds, bizDefKey);\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param parentDataId id\r\n   * @param childDataIds id\r\n   * @param bizDefKey id\r\n   */\r\n  childBatchCancelSubmit(parentDataId: string, childDataIds: string[], bizDefKey: string): Observable<any> {\r\n    if (!parentDataId || !childDataIds) {\r\n      this.notify.warning(this.i18nService.getValue('startProcess.dataIdIsNull'));\r\n      return;\r\n    }\r\n    if (!bizDefKey) {\r\n      this.message.error(this.i18nService.getValue('startProcess.bizDefKeyIsNull'));\r\n      return;\r\n    }\r\n    const dataIds = childDataIds.map(childDataId => `${parentDataId},${childDataId}`);\r\n    return this.batchCancelSubmitWithDataId(dataIds, bizDefKey);\r\n  }\r\n\r\n  /**\r\n * \r\n * @param successNum \r\n * @param failedNum \r\n * @param errorNum \r\n */\r\n  private showBatchSubmitInfo(num: BatchSubmitNumber, bizDefKey: string) {\r\n    if (num.successNum && !num.failedNum && !num.errorNum) {//\r\n      this.taskService.getTaskCenterConfigByCode(ConfigCode.Info_After_Submit, OwnerType.BizDefKey, bizDefKey).subscribe((config: any) => {\r\n        if (this.curLanguage === 'en') {\r\n          this.notify.success(JSON.parse(config.currentValue).en);\r\n        }\r\n        if (this.curLanguage === 'zh-CHS') {\r\n          this.notify.success(JSON.parse(config.currentValue).zh_CHS);\r\n        }\r\n      })\r\n    } else {//\r\n      let message = '';\r\n      num.successNum && (message += this.i18nService.getValue('batchStartProcess.success') + `${num.successNum}` + this.i18nService.getValue('batchStartProcess.row'));\r\n      num.errorNum && (message += this.i18nService.getValue('batchStartProcess.error') + `${num.errorNum}` + this.i18nService.getValue('batchStartProcess.row'));\r\n      num.failedNum && (message += this.i18nService.getValue('batchStartProcess.failed') + `${num.failedNum}` + this.i18nService.getValue('batchStartProcess.row'));\r\n      message += this.i18nService.getValue('batchStartProcess.single');\r\n      this.message.show('warning', message, { safeHtml: false });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private showBatchCancelSubmitInfo(num: BatchCancelNumber, bizDefKey: string) {\r\n    if (num.successNum && !num.errorNum) {//\r\n      this.taskService.getTaskCenterConfigByCode(ConfigCode.Info_After_Cancel_Submit, OwnerType.BizDefKey, bizDefKey).subscribe((config: any) => {\r\n        if (this.curLanguage === 'en') {\r\n          this.notify.success(JSON.parse(config.currentValue).en);\r\n        }\r\n        if (this.curLanguage === 'zh-CHS') {\r\n          this.notify.success(JSON.parse(config.currentValue).zh_CHS);\r\n        }\r\n      })\r\n    } else {\r\n      let message = '';\r\n      num.successNum && (message += this.i18nService.getValue('startProcess.success') + `${num.successNum}` + this.i18nService.getValue('startProcess.row'));\r\n      num.errorNum && (message += this.i18nService.getValue('startProcess.failed') + `${num.errorNum}` + this.i18nService.getValue('startProcess.row'));\r\n      this.message.show('warning', message, { safeHtml: false });\r\n    }\r\n  }\r\n\r\n  handleSubmitMessage(code: string, ownerId: string) {\r\n    const load = this.loading.show();\r\n    this.taskService.getTaskCenterConfigByCode(code, OwnerType.BizDefKey, ownerId).subscribe(re => {\r\n      load.close();\r\n      if (re && re.currentValue) {\r\n        let message = '';\r\n        const currentValue = JSON.parse(re.currentValue);\r\n        this.curLanguage === 'zh-CHS' && (message = currentValue.zh_CHS);\r\n        this.curLanguage === 'en' && (message = currentValue.en);\r\n        this.curLanguage === 'zh-CHT' && (message = currentValue.zh_CHT);\r\n        this.notify.success(message);\r\n      } else {\r\n        code === ConfigCode.Info_After_Submit && this.notify.success(this.i18nService.getValue('startProcess.submitSuccess'));\r\n        code === ConfigCode.Info_After_Cancel_Submit && this.notify.success(this.i18nService.getValue('startProcess.cancelSubmitSuccess'));\r\n      }\r\n    }, error => {\r\n      load.close();\r\n      this.taskService.error(error);\r\n    })\r\n  }\r\n\r\n  /**\r\n   * \r\n   * \r\n   */\r\n  processSimulate(): Observable<any> {\r\n    const subject = new Subject();\r\n    const gspWfEventService = (window as any).parent.gspWfEventService;\r\n    gspWfEventService.simulate(() => {\r\n      subject.next(true);\r\n    });\r\n    return subject.asObservable();\r\n  }\r\n\r\n  /**\r\n   * id\r\n   * \r\n   */\r\n  viewFlowChartByDataId(dataId: string) {\r\n    if (dataId) {\r\n      this.flowchartService.viewFlowChartByDataId(dataId);\r\n    } else {\r\n      console.error(\"id\");\r\n    }\r\n  }\r\n\r\n  /**\r\n   * \r\n   * \r\n   * @param bizDefKey id\r\n   * @param dataId id\r\n   */\r\n  viewFlowChartWithForecast(bizDefKey: string, dataId: string) {\r\n    let payload = new ForecastProcessPayload();\r\n    payload.bizDefKey = bizDefKey;\r\n    payload.dataId = dataId;\r\n    this.flowchartService.viewProcess(payload);\r\n  }\r\n\r\n\r\n\r\n}\r\n","import { Pipe, PipeTransform, Optional } from '@angular/core';\r\nimport { I18nService } from './i18n.service';\r\n\r\n@Pipe({ name: 'translate' })\r\nexport class TranslatePipe implements PipeTransform {\r\n    constructor(@Optional() public i18nService: I18nService) { }\r\n    transform(name: any, defaultVal = ''): any {\r\n        if (this.i18nService) {\r\n            const r = this.i18nService.getValue(name);\r\n            return r ? r : defaultVal;\r\n        } else {\r\n            return defaultVal;\r\n        }\r\n    }\r\n}\r\n","import { Component, OnInit } from '@angular/core';\r\n\r\n@Component({\r\n  selector: 'lib-task-assigninfo',\r\n  templateUrl: './task-assigninfo.component.html',\r\n  styleUrls: ['./task-assigninfo.component.css']\r\n})\r\n\r\n/**\r\n * \r\n */\r\nexport class TaskAssigninfoComponent implements OnInit {\r\n\r\n  ngOnInit() {\r\n  }\r\n\r\n}\r\n","import { Component, OnInit, Input, Output, ViewChild, TemplateRef, EventEmitter, ElementRef, AfterViewInit, ChangeDetectorRef, Injector } from '@angular/core';\r\nimport { AssigneeInfo } from '../../entity/complete-response';\r\nimport { I18nService } from '../../service/i18n/i18n.service';\r\nimport { DialogComponent } from '@farris/ui-dialog';\r\nimport { DataTableComponent } from '@farris/ui-datatable';\r\nimport { SysFarrisLookupComponent } from '@gsp-sys/sysmgr-ui';\r\nimport { NotifyService } from '@farris/ui-notify';\r\nimport { User } from '../../entity/user';\r\nimport { Assignee } from '../../entity/start-process-payload';\r\nimport { TaskService } from '../../service/task.service';\r\nimport { WfContext } from '../../entity/wfContext';\r\n\r\ndeclare let System: any;\r\n\r\n@Component({\r\n  selector: 'lib-assignee-info',\r\n  templateUrl: './assignee-info.component.html',\r\n  styleUrls: ['../task-execute/task-execute.component.css'],\r\n})\r\nexport class AssigneeInfoComponent implements OnInit, AfterViewInit {\r\n\r\n  bindingData: { id?: string, name?: string } = {};//\r\n  myHelpBindingData: { id?: string, name?: string } = {};//\r\n  assignUserNgModule: string;\r\n  _assigneeInfo: AssigneeInfo;\r\n  _selectedAssignees: User[];//\r\n  assignees: Assignee[] = [];//ID\r\n  searchAssignUserList = [];//\r\n  anonymous = false; // \r\n  anonymousText = ''; // \r\n\r\n  @Input() disabled: boolean = false;//\r\n  @Input() placeholder: string;\r\n  @Input() singleSelect: boolean;\r\n  @Input() filter = { notGetCurrentUser: false, notGetStopUser: true, orderField: \"order\", withAllOrg: true, orgId: '' }\r\n  @Input() ifShowBlank: boolean = true;//\r\n  @Input() openFromIframe: boolean = false;//iframeIDP\r\n  @Input() activityName: string;//\r\n  @Input() allowGlobalAssign: boolean;//\r\n  @Input() wfContext: WfContext;//\r\n\r\n  @ViewChild('allUserDialog') myUserHelp: DialogComponent;\r\n  @ViewChild('taskExecuteButtons') buttons: TemplateRef<any>;//\r\n  @ViewChild('allUserTable') myUserHelpTable: DataTableComponent;\r\n  @ViewChild('allUserTable', { read: ElementRef }) dataTableEle: ElementRef;//datatable\r\n\r\n  @ViewChild(SysFarrisLookupComponent) sysUserHelp: SysFarrisLookupComponent;//\r\n  @ViewChild('sysUserHelp', { read: ElementRef }) sysUserHelpEle: ElementRef; //DOM\r\n  @ViewChild('allUserDialog', { read: ElementRef }) myUserHelpEle: ElementRef;//DOM\r\n\r\n  @Output() afterConfirm = new EventEmitter<Assignee[]>();\r\n  groupIcon = '<i class=\"f-icon f-icon-plus-circle\" style=\"color: #2B87FF\"></i>';\r\n  extendUserHelp: boolean = false;//\r\n  extendUserHelpUrl: string;//url\r\n\r\n  columns = [\r\n    { title: this.i18nService.getValue('static.columnName.code'), field: 'Code', width: 80 },\r\n    { title: this.i18nService.getValue('static.columnName.name'), field: 'Name', width: 90 },\r\n    { title: this.i18nService.getValue('static.columnName.department'), field: 'OrgName', width: 180 }\r\n  ];\r\n\r\n  originAssignUserList: {//\r\n    ID: string,\r\n    Code: string,\r\n    Name: string,\r\n    OrgId: string,\r\n    OrgName: string\r\n  }[];\r\n\r\n  constructor(\r\n    private i18nService: I18nService,\r\n    private notify: NotifyService,\r\n    private cd: ChangeDetectorRef,\r\n    private taskService: TaskService,\r\n    private injector: Injector\r\n  ) {\r\n    //farris\r\n    this.taskService.getWfUserHelpConfig().subscribe((re: any) => {\r\n      if (re && re.userHelpConfig && re.userHelpConfig.isExtend == 'true') {\r\n        this.extendUserHelp = true;\r\n        this.extendUserHelpUrl = re.userHelpConfig.url + '?v=' + new Date().getTime().toString();\r\n      }\r\n    }, error => {\r\n      console.error(error);\r\n    })\r\n  }\r\n\r\n  ngAfterViewInit(): void {\r\n    // data table\r\n    let ele = this.dataTableEle.nativeElement as HTMLElement;\r\n    let body = ele && ele.querySelector('div.farris-datatable-container > div > div.farris-table-scorllable-body') as HTMLElement;\r\n    body && (body.style.height = '290px');\r\n  }\r\n\r\n  ngOnInit() {\r\n  }\r\n\r\n  @Input()\r\n  set assigneeInfo(info: AssigneeInfo) {\r\n    this.disabled = false;\r\n    this.placeholder = null;//\r\n    this.assignUserNgModule = null;//\r\n    this._assigneeInfo = info;//null\r\n    if (!this._assigneeInfo) {\r\n      this.disabled = true;\r\n    } else {\r\n      if (this._assigneeInfo.selectAssignee) {\r\n        this.disabled = false;\r\n        this.placeholder = this.i18nService.getValue('task.selectPlaceholder');//\r\n      } else {\r\n        this.disabled = true;\r\n        if (this._assigneeInfo.assigneeUsers && this._assigneeInfo.assigneeUsers.length) {\r\n          this.placeholder = this.anonymous ? this.anonymousText : this._assigneeInfo.assigneeUsers.map(user => user.name).join();//\r\n        } else {\r\n          this.placeholder = this.i18nService.getValue('task.noUser');//\r\n        }\r\n      }\r\n      this.singleSelect = !this._assigneeInfo.multiSelect;\r\n      this.allowGlobalAssign = this._assigneeInfo.allowGlobalAssign;\r\n      if (this._assigneeInfo.organizationScope && this._assigneeInfo.organizationScope.length) {\r\n        const orgList = this._assigneeInfo.organizationScope[0];\r\n        this.filter.orgId = orgList.id;\r\n        this.filter.withAllOrg = orgList.includeChildren;\r\n      }\r\n    }\r\n  }\r\n\r\n  @Input()\r\n  set setAnonymous(anonymous: boolean) {\r\n    this.anonymous = anonymous;\r\n  }\r\n\r\n  @Input()\r\n  set setAnonymousText(anonymousText: string) {\r\n    this.anonymousText = anonymousText;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  @Input()\r\n  set selectedAssignees(selectedAssignees: User[]) {\r\n    !this._assigneeInfo && (this.placeholder = null);\r\n    this._selectedAssignees = selectedAssignees;\r\n    selectedAssignees.length && (this.placeholder = this.anonymous ? this.anonymousText : selectedAssignees.map(user => user.name).join());\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  clickAssignUser() {\r\n    if (this.extendUserHelp && !this.openFromIframe) {\r\n      this.showExtendUserHelp();\r\n    } else {\r\n      this.showSysUserHelp();\r\n    }\r\n  }\r\n\r\n\r\n  /**\r\n   * \r\n   */\r\n  private showExtendUserHelp() {\r\n    System.import(this.extendUserHelpUrl).then((moduleFactories: any) => {\r\n      const moduleFactory: any = Object.values(moduleFactories)[0];\r\n      const moduleRef = moduleFactory.create(this.injector);\r\n      let context = {\r\n        singleSelect: this.singleSelect,\r\n        allowGlobalAssign: this.allowGlobalAssign,\r\n        assigneeUsers: this._assigneeInfo && this._assigneeInfo.assigneeUsers && this._assigneeInfo.assigneeUsers.length ? this._assigneeInfo.assigneeUsers : [],\r\n        filter: this.filter,\r\n        selectedUsers: this.assignees,\r\n        wfContext: this.wfContext\r\n      }\r\n      moduleRef.instance.showHelp(context).subscribe(re => {\r\n        let userList = re.userList;\r\n        if (userList && userList.length) {\r\n          this.assignees = userList.map(user => { return { id: user.id, name: user.name } });\r\n          this.assignUserNgModule = this.assignees.map(user => user.name).join();\r\n        } else {\r\n          this.assignees = [];\r\n          this.assignUserNgModule = '';\r\n        }\r\n        this.afterConfirm.emit(this.assignees);\r\n        this.cd.detectChanges();\r\n      }, error => {\r\n        console.error(error);\r\n      });\r\n    }, error => {\r\n      console.error(error);\r\n    });\r\n  }\r\n\r\n  showSysUserHelp() {\r\n    if (this._assigneeInfo && this._assigneeInfo.assigneeUsers && this._assigneeInfo.assigneeUsers.length) {\r\n      this.getAssignUsersByIds();\r\n      this.myUserHelp.show();\r\n      setTimeout(() => {\r\n        this.cd.detectChanges();//\r\n        this.openFromIframe && this.openMyUserHelpOutIframe();\r\n      }, 100);\r\n    } else if (this.allowGlobalAssign) {\r\n      //\r\n      this.bindingData = { id: this.assignees.map(a => a.id).join(), name: this.assignees.map(a => a.name).join() };\r\n      this.sysUserHelp.showHelp();\r\n      setTimeout(() => {\r\n        this.cd.detectChanges();//\r\n        this.openFromIframe && this.beforeOpenSysUserHelpOutIframe();\r\n      }, 100);\r\n    }\r\n\r\n  }\r\n\r\n  //iframe\r\n  private openMyUserHelpOutIframe() {\r\n    var myUserHelpDialog = this.myUserHelpEle.nativeElement as HTMLElement;\r\n    top.document.body.append(myUserHelpDialog);//windowfarris\r\n\r\n    //\r\n    var backdrop = window.document.querySelector(\"body > bs-modal-backdrop\");\r\n    backdrop.remove();\r\n\r\n    var secondDiv = (myUserHelpDialog.firstChild as HTMLElement).firstChild as HTMLElement;//farris-dialogdiv\r\n    secondDiv.style.width = '850px';\r\n    secondDiv.style.height = '520px';\r\n    secondDiv.style.marginLeft = '-425px';\r\n    secondDiv.style.marginTop = '-260px';\r\n  }\r\n\r\n  private beforeOpenSysUserHelpOutIframe() {\r\n    this.sysUserHelp.farrisLookUp.dialog.reSize({ width: 850, height: 520 });\r\n    const sysUserHelpDialog = this.sysUserHelp.farrisLookUp.dialog.el.nativeElement as HTMLElement;\r\n    sysUserHelpDialog.parentElement.removeChild(sysUserHelpDialog);\r\n    this.sysUserHelp.farrisLookUp.draggable = false;\r\n    this.sysUserHelp.farrisLookUp.resizable = false;\r\n    this.sysUserHelp.farrisLookUp.showMaxButton = false;\r\n    this.sysUserHelp.farrisLookUp.dialogOpened.subscribe(() => {\r\n      setTimeout(() => {//querySelector\r\n        this.openSysUserHelpOutIframe();\r\n      }, 200)\r\n    });\r\n  }\r\n\r\n  //iframe\r\n  private openSysUserHelpOutIframe() {\r\n    var sysUserHelpDialog = this.sysUserHelp.farrisLookUp.dialog.el.nativeElement as HTMLElement;\r\n    this.sysUserHelp.farrisLookUp.dialog.reSize({ width: 850, height: 520 });\r\n    top.document.body.append(sysUserHelpDialog);\r\n  }\r\n\r\n  //\r\n  afterUsersSelect(data: any) {\r\n    if (data) {\r\n      data = this.singleSelect ? [data] : data;\r\n      this.assignees = data.map(user => { return { id: user.id, name: user.name } });\r\n      this.assignUserNgModule = data.map(user => user.name).join();\r\n      this.afterConfirm.emit(this.assignees);\r\n      this.cd.detectChanges();\r\n    }\r\n  }\r\n\r\n  //assigneeInfo.assigneeIdscodename\r\n  getAssignUsersByIds() {\r\n    this.originAssignUserList = this._assigneeInfo.assigneeUsers.map(user => {\r\n      return {\r\n        ID: user.id,\r\n        Name: user.name,\r\n        Code: user.code,\r\n        OrgId: user.orgId,\r\n        OrgName: user.orgNamePath\r\n      };\r\n    }),\r\n      this.searchAssignUserList = this.originAssignUserList;\r\n  }\r\n\r\n  //\r\n  myUserHelpSearch(event) {\r\n    if (event.value) {\r\n      const value = event.value;\r\n      this.searchAssignUserList = this.originAssignUserList.filter(user =>\r\n        (user.Name) && user.Name.includes(value) ||\r\n        (user.Code) && user.Code.includes(value)\r\n      );\r\n    } else {\r\n      this.getAssignUsersByIds();\r\n    }\r\n  }\r\n\r\n  //\r\n  myUserHelpAfterSelect() {\r\n    if (this.myUserHelpTable.selections === undefined) {\r\n      this.notify.warning(this.i18nService.getValue('static.assignee.noAssignee'));\r\n      return;\r\n    }\r\n    const selectedUsers = this.singleSelect ? [this.myUserHelpTable.selections] : this.myUserHelpTable.selections;\r\n    this.assignUserNgModule = selectedUsers.map(user => user.Name).join();\r\n    this.assignees = selectedUsers.map(user => { return { id: user.ID, name: user.Name } });\r\n    this.afterConfirm.emit(this.assignees);\r\n    this.cd.detectChanges();\r\n    this.myUserHelp.close();\r\n  }\r\n\r\n  //\r\n  myUserHelpCancel() {\r\n    this.myUserHelp.close();\r\n  }\r\n\r\n  //\r\n  assignUserClear() {\r\n    this.assignees = [];\r\n    this.assignUserNgModule = null;\r\n    this.afterConfirm.emit([]);\r\n    this.bindingData = {};\r\n  }\r\n\r\n}\r\n","import { Directive, EventEmitter, HostListener, OnInit, Output, OnDestroy } from '@angular/core';\r\nimport { Subject, Subscription } from 'rxjs';\r\nimport { throttleTime } from 'rxjs/operators';\r\n/**\r\n * \r\n */\r\n@Directive({\r\n  selector: '[directive-throttle]'\r\n})\r\nexport class ThrottleClickDirective implements OnInit, OnDestroy {\r\n  // \r\n  private THROTTLE_TIME: number = 2000;\r\n  private subject = new Subject<MouseEvent>();\r\n  private click: Subscription;\r\n  // \r\n  @Output() throttleClick = new EventEmitter();\r\n\r\n  constructor() { }\r\n\r\n  ngOnInit(): void {\r\n    const result = this.subject.pipe(\r\n      throttleTime(this.THROTTLE_TIME)\r\n    );\r\n    this.click = result.subscribe(e => {\r\n      this.throttleClick.emit(e)\r\n    })\r\n\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.click.unsubscribe();\r\n  }\r\n\r\n  @HostListener('click', ['$event'])\r\n  onClick(evt: MouseEvent) {\r\n    this.subject.next(evt);\r\n  }\r\n}","\r\n/**\r\n * \r\n */\r\nexport class FileUploadEntity {\r\n\r\n    rootId: string;\r\n\r\n    metadataIdList: string[];\r\n}\r\n\r\n/**\r\n * \r\n */\r\nexport class FileDeleteEntity {\r\n\r\n    rootId: String;\r\n\r\n    metadataId: String;\r\n\r\n    mode: String;\r\n}\r\n\r\nexport class GspDocUploadEntity {\r\n\r\n    filePath: string;\r\n\r\n    metadata: GspDocMetadata;\r\n\r\n    fileContent: string;\r\n\r\n    mode: string;\r\n}\r\n\r\nexport class GspDocMetadata {\r\n\r\n    id: string;\r\n\r\n    fileName: string;\r\n\r\n    rootId: string;\r\n\r\n    docType: string;\r\n}","import { TaskService } from \"../service/task.service\";\r\n\r\nexport class CommonComment {\r\n    id: string;\r\n    userId?: string;\r\n    message: string;\r\n    sortOrder?: number;\r\n    static newEntity(): CommonComment {\r\n        return {\r\n            id: TaskService.newId(),\r\n            message: ''\r\n        };\r\n    }\r\n}\r\n","import { Component, OnInit, Input, ViewChild, forwardRef, Output, EventEmitter, TemplateRef } from '@angular/core';\r\nimport { DialogComponent } from '@farris/ui-dialog';\r\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\r\nimport { FDropdownDirective } from '@farris/ui-dropdown';\r\nimport { UploadDialogService } from '@gsp-svc/formdoc-upload';\r\nimport { MessagerService } from '@farris/ui-messager';\r\nimport { FileDeleteEntity, FileUploadEntity, GspDocMetadata, GspDocUploadEntity } from '../../entity/attachment';\r\nimport { SignHereComponent } from '@gsp-wf/wf-sign';\r\nimport { AvatarComponent } from '@farris/ui-avatar';\r\nimport { DownloadService } from '@gsp-svc/file-load';\r\nimport { TaskService } from '../../service/task.service';\r\nimport { CommonComment } from '../../entity/comment';\r\nimport { forkJoin, Observable, of } from 'rxjs';\r\nimport { HttpService } from '@ecp-caf/caf-common';\r\nimport { DataColumn, DatagridComponent } from '@farris/ui-datagrid';\r\nimport { I18nService } from '../../service/i18n/i18n.service';\r\nimport { EditorTypes } from '@farris/ui-datagrid-editors';\r\nimport { LoadingService } from '@farris/ui-loading';\r\nimport { ConfigCode, TaskCenterConfig } from '../../entity/task-center-config';\r\nimport { NotifyService } from '@farris/ui-notify';\r\n\r\n@Component({\r\n  selector: 'wf-comment',\r\n  templateUrl: './task-comment.component.html',\r\n  styleUrls: ['./task-comment.component.scss'],\r\n  providers: [{\r\n    provide: NG_VALUE_ACCESSOR,\r\n    useExisting: forwardRef(() => TaskCommentComponent),\r\n    multi: true\r\n  },]\r\n})\r\nexport class TaskCommentComponent implements OnInit, ControlValueAccessor {\r\n\r\n  @Input() showAttachment: boolean = true;//\r\n  @Input() showSign: boolean = true;//\r\n  @Input() showCommonComment = true;//\r\n  @Input() comment: string;\r\n  @Input() placeholder = '';\r\n  @Input() processInstanceId: string;\r\n  @Input() textAreaHeight: number = 120;//\r\n\r\n  @Input()\r\n  set TaskCenterConfig(configList: TaskCenterConfig[]) {\r\n    const attachment = configList.find(a => a.configCode == ConfigCode.If_Show_Attachment);\r\n    const sign = configList.find(a => a.configCode == ConfigCode.If_Show_Signature);\r\n    const enableSign = configList.find(a => a.configCode == ConfigCode.If_Use_Sign_By_Default);\r\n    const editSign = configList.find(a => a.configCode === ConfigCode.If_Can_Edit_Signature);\r\n    if ((window as any).gspframeworkService.common) {\r\n      this.curUserId = (window as any).gspframeworkService.common.userInfos.get().userId;\r\n    } else {\r\n      this.curUserId = (window as any).parent.gspframeworkService.common.userInfos.get().userId;\r\n    }\r\n    attachment && attachment.currentValue === 'true' && (this.ifShowAttachment = true);\r\n    sign && sign.currentValue === 'true' && (this.ifShowSign = true);\r\n    enableSign && enableSign.currentValue === 'false' && (this.ifEnableSign = false);\r\n    editSign && editSign.currentValue === 'false' && (this.ifCanEditSign = false);\r\n    if (this.ifShowSign && this.ifEnableSign) {\r\n      this.getUserSign(this.curUserId);\r\n    }\r\n  }\r\n\r\n  @Output() attachment = new EventEmitter();//\r\n  @Output() signature = new EventEmitter();//id\r\n  @ViewChild('commentDialog') commentDialog: DialogComponent;//\r\n  @ViewChild('signDialog') signDialog: DialogComponent;//\r\n  @ViewChild('dropdownEl') dropDownEl: FDropdownDirective;//\r\n  @ViewChild('wfSignHere') signaturePad: SignHereComponent;//\r\n  @ViewChild('farrisAvatar') farrisAvatar: AvatarComponent;//\r\n  @ViewChild('dataGrid') dataGrid: DatagridComponent;\r\n  @ViewChild('commentTypeCell') commentTypeCell: TemplateRef<any>;//\r\n  @ViewChild('commentOperateCell') commentOperateCell: TemplateRef<any>;//\r\n\r\n  private _value = '';\r\n  attachmentList: any[] = [];\r\n  ifShowAttachment: boolean = false;//\r\n  ifShowSign: boolean = false;//\r\n  curUserId: string;//id\r\n  signatureImage: string;//base64\r\n  tmpSignatureImage: string;//\r\n  downloadService = new DownloadService();\r\n  ifUseSign: boolean = false;//\r\n  ifUseImg: boolean = true;//\r\n  ifEnableSign: boolean = true;//\r\n  ifUploadImg: boolean = false;//\r\n  ifCanEditSign: boolean = true;//\r\n  originSignId: string;//id\r\n\r\n  commentList: CommonComment[] = [];\r\n  originCommentList: CommonComment[] = [];\r\n\r\n  commentColumns: DataColumn[] = [];\r\n\r\n  set value(v) {\r\n    if (this._value !== v) {\r\n      this._value = v;\r\n      this.onModelChange(v);\r\n    }\r\n\r\n  }\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  onModelChange = (obj: any) => { };\r\n  onModelTouched = (obj: any) => { };\r\n\r\n  constructor(\r\n    private taskService: TaskService,\r\n    private httpSvc: HttpService,\r\n    private uploadDialog: UploadDialogService,\r\n    private messageService: MessagerService,\r\n    private i18nService: I18nService,\r\n    private loadingService: LoadingService,\r\n    private notify: NotifyService,\r\n  ) {\r\n\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.commentColumns = [{\r\n      field: 'message',\r\n      width: 100,\r\n      title: this.i18nService.getValue('comment.static.content'),\r\n      editor: { type: EditorTypes.TEXTBOX, options: {} },\r\n    }, {\r\n      field: 'userId',\r\n      width: 20,\r\n      title: this.i18nService.getValue('comment.static.type'),\r\n      template: this.commentTypeCell\r\n    }, {\r\n      field: 'operate',\r\n      width: 20,\r\n      title: this.i18nService.getValue('comment.static.operate'),\r\n      template: this.commentOperateCell\r\n    }];\r\n    // \r\n    this.loadComments();\r\n  }\r\n\r\n  onEditComment() {\r\n    this.dropDownEl.close();\r\n    this.commentDialog.show();\r\n  }\r\n\r\n  loadComments() {\r\n    this.taskService.getCommentList().subscribe((data: any[]) => {\r\n      this.commentList = data;\r\n      this.originCommentList = [...data];\r\n    });\r\n  }\r\n\r\n  /**\r\n   * ControlValueAccessor\r\n   */\r\n  writeValue(value: string) {\r\n    if (value !== this.value) {\r\n      this.value = value;\r\n    }\r\n  }\r\n\r\n  registerOnChange(fn) {\r\n    this.onModelChange = fn;\r\n  }\r\n\r\n  registerOnTouched(fn) {\r\n    this.onModelTouched = fn;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  buttonClick(data: any) {\r\n    this.dropDownEl.close();\r\n    this.value = data;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  uploadAttachment() {\r\n    let isRepeat = false;\r\n    this.uploadDialog.uploadFile(this.processInstanceId, 'wf_attachment').then(re => {\r\n      for (let i of (re as any[])) {\r\n        isRepeat = false;\r\n        for (let attach of this.attachmentList) {\r\n          if (attach.fileName === i.fileName) {\r\n            this.messageService.info('' + i.fileName);\r\n            isRepeat = true;\r\n            break;\r\n          }\r\n        }\r\n        if (!isRepeat) {\r\n          this.attachmentList.push(i);\r\n        }\r\n      }\r\n      this.attachment.emit(this.attachmentList);\r\n      //\r\n      let files = new FileUploadEntity();\r\n      files.rootId = \"wf_attachment\";\r\n      files.metadataIdList = [];\r\n      this.attachmentList.forEach(a => {\r\n        files.metadataIdList.push(a.metadataId);\r\n      })\r\n      files.metadataIdList.length && this.taskService.uploadAttachment(files).subscribe(() => { });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  attachmentDelete(attachment) {\r\n    var gspDocDeleteEntity: FileDeleteEntity = {\r\n      rootId: \"wf_attachment\",\r\n      metadataId: attachment.metadataId,\r\n      mode: \"Formal\"\r\n    }\r\n    let index = this.attachmentList.indexOf(attachment);\r\n    if (index > -1) {\r\n      this.attachmentList.splice(index, 1);\r\n    }\r\n    this.attachment.emit(this.attachmentList);\r\n    this.taskService.deleteAttachment(gspDocDeleteEntity).subscribe(() => { });\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  imageUrl(attachmentInfo) {\r\n    const url = '/platform/runtime/wf/webapp/mobiletaskcenter/assets/accessory/';\r\n    return url + this.taskService.createItem(attachmentInfo) + '.svg';\r\n  }\r\n\r\n  /**\r\n   * dialog\r\n   */\r\n  showSignDialog() {\r\n    this.signDialog.show();\r\n    if (!this.ifEnableSign) {\r\n      this.getUserSign(this.curUserId);\r\n    }\r\n  }\r\n\r\n  /**\r\n * \r\n */\r\n  clickToDeleteImage() {\r\n    this.signatureImage = '';\r\n    this.signature.emit(null);\r\n    const load = this.loadingService.show();\r\n    this.taskService.addTaskCenterConfig(ConfigCode.If_Use_Sign_By_Default, 'false').subscribe(re => {\r\n      load.close();\r\n    }, () => {\r\n      load.close();\r\n    })\r\n  }\r\n\r\n  clickToUseSign() {\r\n    this.ifUseImg = false;\r\n    this.ifUseSign = true;\r\n    const canvas: any = this.signaturePad.canvasDiv.nativeElement.querySelector('canvas');\r\n    canvas.height = 252;\r\n    canvas.width = 665;\r\n  }\r\n\r\n  clickToUploadImg() {\r\n    this.farrisAvatar.onClick();\r\n  }\r\n\r\n  clickToConfirm() {\r\n    let image: any;\r\n    if (this.signaturePad && this.signaturePad.isDraw) {//\r\n      image = this.signaturePad.confirm();\r\n    } else if (this.ifUploadImg) {//\r\n      image = this.tmpSignatureImage;\r\n    }\r\n    if (image) {\r\n      this.uploadSignatureImg(image);\r\n    } else {\r\n      if (this.tmpSignatureImage) {\r\n        this.signatureImage = this.tmpSignatureImage;\r\n        this.signature.emit(this.originSignId);\r\n        if (!this.ifEnableSign) {\r\n          const load = this.loadingService.show();\r\n          this.taskService.addTaskCenterConfig(ConfigCode.If_Use_Sign_By_Default, 'true').subscribe(re => {\r\n            load.close();\r\n          }, () => {\r\n            load.close();\r\n          })\r\n        }\r\n      }\r\n      this.signDialog.close();\r\n    }\r\n  }\r\n\r\n  clickToReset() {\r\n    this.ifUseSign = false;\r\n    this.ifUseImg = true;\r\n    this.signatureImage = '';\r\n    this.tmpSignatureImage = '';\r\n    this.signature.emit('');\r\n  }\r\n\r\n  clickToCancel() {\r\n    this.signDialog.close();\r\n  }\r\n\r\n  /**\r\n   * \r\n   * event.base64 ,event.nameevent.typeimage/jpeg\r\n   */\r\n  imgChange(event: any) {\r\n    this.ifUseImg = true;\r\n    this.ifUseSign = false;\r\n    this.ifUploadImg = true;\r\n    const image = event.base64;\r\n    this.tmpSignatureImage = image;\r\n    this.signatureImage = image;\r\n  }\r\n\r\n  private uploadSignatureImg(image: any) {\r\n    var uploadSignature = new GspDocUploadEntity();\r\n    uploadSignature.fileContent = image.split(',')[1];\r\n    uploadSignature.filePath = this.curUserId;\r\n    uploadSignature.mode = \"Formal\";\r\n    uploadSignature.metadata = new GspDocMetadata();\r\n    uploadSignature.metadata.id = this.taskService.createNM();\r\n    uploadSignature.metadata.fileName = this.taskService.createNM() + \".png\";\r\n    uploadSignature.metadata.rootId = \"taskcentersignature\";\r\n    uploadSignature.metadata.docType = \"png\";\r\n    const load = this.loadingService.show();\r\n    this.taskService.uploadSignature(uploadSignature).subscribe(signId => {\r\n      load.close();\r\n      this.originSignId = signId;\r\n      this.signature.emit(signId);\r\n      this.signatureImage = image;\r\n      this.signDialog.close();\r\n    }, error => {\r\n      load.close();\r\n      this.messageService.error('');\r\n    });\r\n  }\r\n\r\n\r\n\r\n  /**\r\n   * \r\n   */\r\n  private getUserSign(userId: string) {\r\n    const load = this.loadingService.show();\r\n    this.taskService.getUserSign(userId).subscribe(result => {\r\n      load.close();\r\n      if (result && result.length) {\r\n        var sign;\r\n        if (result.length == 1) {\r\n          sign = result[0];\r\n        } else {\r\n          const list = result.filter(a => a && a.lastModifiedTime);\r\n          sign = list.reduce(function (a, b) {\r\n            return a.lastModifiedTime > b.lastModifiedTime ? a : b;\r\n          })\r\n        }\r\n        this.signature.emit(sign.id);\r\n        this.signatureImage = this.downloadService.getDownloadUrl(sign.id, 'taskcentersignature');\r\n        this.tmpSignatureImage = this.signatureImage;\r\n      }\r\n    }, error => {\r\n      console.error(error);\r\n      load.close();\r\n    })\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  add() {\r\n    const newEntity = CommonComment.newEntity();\r\n    newEntity.sortOrder = this.commentList.length + 1;\r\n    this.commentList = this.commentList.concat(newEntity);\r\n  }\r\n\r\n  /**\r\n   *  data.rowData\r\n   */\r\n  clickToDeleteComment(data: any) {\r\n    if (data.rowData.userId !== '*') {\r\n      this.commentList = this.commentList.filter(c => c.id != data.rowData.id)\r\n      this.dataGrid.loadData(this.commentList);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  save() {\r\n    this.dataGrid.endCellEdit();\r\n    this.httpSave().subscribe(r => {\r\n      this.loadComments();\r\n      this.commentDialog.close();\r\n    });\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private httpSave(): Observable<any> {\r\n    const url = `/api/runtime/wf/v1.0/commonComments`;\r\n    const originCommentIds = this.originCommentList.filter(o => o.userId !== '*').map(d => d.id);\r\n    //\r\n    const deleteIds = originCommentIds.filter(id => this.commentList.findIndex(c => c.id === id) < 0);\r\n\r\n    return forkJoin(deleteIds.map(id => this.httpSvc.delete(url + `/${id}`, null))\r\n      .concat(this.commentList.map(add => this.httpSvc.post(url, add))));\r\n  }\r\n\r\n  /**\r\n * web\r\n */\r\n  attachmentPreview(metadataId) {\r\n    const options = {\r\n      appType: \"app\",\r\n      funcId: \"\",\r\n      tabName: \"\",\r\n      appId: \"6ccb476b-f2ba-df8f-6f47-d37d100c56e2\",\r\n      appEntrance: \"docviewertab\",\r\n      tabId: new Date().getTime(),\r\n      entityParams: {\r\n        metadataIdList: [metadataId],\r\n        rootId: \"wf_attachment\",\r\n        metadataId: null,\r\n        viewOptions: {\r\n          showHeader: true,\r\n          showPaging: true,\r\n          showThumbnails: true,\r\n          showDownload: true,\r\n          showSearch: true,\r\n          showZoom: true,\r\n          showPrint: true,\r\n          showSecondaryToolBar: true,\r\n        },\r\n      },\r\n    };\r\n    (window as any).gspframeworkService.rtf.func.openMenu(options);\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param data data.rowData\r\n   * @returns\r\n   */\r\n  beforeEdit = (data: any) => {\r\n    if (data.rowData.userId == '*') {\r\n      return of(false);\r\n    }\r\n    return of(true);\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\n\r\nimport { DataTableModule } from '@farris/ui-datatable';\r\nimport { FarrisDialogModule } from '@farris/ui-dialog';\r\nimport { PaginationModule } from '@farris/ui-pagination';\r\nimport { NotifyModule } from '@farris/ui-notify';\r\nimport { ComboListModule } from '@farris/ui-combo-list';\r\nimport { MessagerModule } from '@farris/ui-messager';\r\nimport { LoadingModule } from '@farris/ui-loading';\r\nimport { InputGroupModule } from '@farris/ui-input-group';\r\nimport { DatagridModule } from '@farris/ui-datagrid';\r\nimport { DatagridEditorsModule, EditorProviders } from '@farris/ui-datagrid-editors';\r\nimport { FarrisFormsModule } from '@farris/ui-forms';\r\nimport { SwitchModule } from '@farris/ui-switch';\r\n\r\nimport { WfApprovalLogsModule } from '@gsp-wf/wf-approval-logs';\r\nimport { UiFlowchartModule } from '@gsp-wf/ui-flowchart'\r\nimport { TaskImplApiModule } from '@gsp-wf/task-impl-api';\r\nimport { AvatarModule } from '@farris/ui-avatar';\r\nimport { FDropdownDirectiveTypeModule } from '@farris/ui-dropdown';\r\nimport { WfSignModule } from '@gsp-wf/wf-sign';\r\n\r\nimport { SysManagerUIModule } from '@gsp-sys/sysmgr-ui';\r\nimport { CommonSharedModule } from '@gsp-sys/rtf-common';\r\nimport { SessionService, HttpService, CacheService } from '@ecp-caf/caf-common';\r\nimport { FrameworkService, FrmEventBus, FuncsService } from '@gsp-sys/rtf-common';\r\n\r\nimport { TaskService } from './service/task.service';\r\nimport { TranslatePipe } from './service/i18n/translate.pipe';\r\nimport { I18nService } from './service/i18n/i18n.service';\r\nimport { WfTaskHandlerService } from './wf-task-handler.service';\r\nimport { TaskExecuteComponent } from './components/task-execute/task-execute.component'\r\nimport { TaskAssigninfoComponent } from './components/task-assigninfo/task-assigninfo.component';\r\nimport { ProcessSelectorComponent } from './submit/process-selector/process-selector.component';\r\nimport { AssigneeInfoComponent } from './components/assignee-info/assignee-info.component';\r\nimport { ThrottleClickDirective } from './throttleTime/throttleClickDirective';\r\nimport { TaskCommentComponent } from './components/task-comment/task-comment.component';\r\nimport { UrgeHandleComponent } from './components/urge-handle/urge-handle.component';\r\n\r\n@NgModule({\r\n  declarations: [\r\n    TranslatePipe,\r\n    TaskExecuteComponent,\r\n    TaskAssigninfoComponent,\r\n    ProcessSelectorComponent,\r\n    AssigneeInfoComponent,\r\n    ThrottleClickDirective,\r\n    TaskCommentComponent,\r\n    UrgeHandleComponent,\r\n  ],\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    DataTableModule,\r\n    FarrisDialogModule,\r\n    PaginationModule,\r\n    NotifyModule,\r\n    ComboListModule,\r\n    SysManagerUIModule,//\r\n    WfApprovalLogsModule,\r\n    UiFlowchartModule,\r\n    CommonSharedModule,\r\n    LoadingModule,\r\n    TaskImplApiModule,\r\n    MessagerModule,\r\n    InputGroupModule,\r\n    WfSignModule,//\r\n    AvatarModule,//\r\n    FDropdownDirectiveTypeModule,//\r\n    DatagridModule,//farris\r\n    DatagridEditorsModule,\r\n    DatagridModule.forRoot([\r\n      ...EditorProviders\r\n    ]),\r\n    FarrisFormsModule,\r\n    SwitchModule\r\n  ],\r\n  providers: [\r\n    TaskService,\r\n    I18nService,\r\n    WfTaskHandlerService,\r\n    FrameworkService,//module\r\n    SessionService,\r\n    HttpService,\r\n    CacheService,\r\n    FrmEventBus,\r\n    FuncsService,\r\n  ],\r\n  exports: [\r\n    TaskExecuteComponent,\r\n    TaskAssigninfoComponent,\r\n    ProcessSelectorComponent\r\n  ],\r\n  entryComponents: [\r\n    TaskExecuteComponent,\r\n    TaskAssigninfoComponent,\r\n    ProcessSelectorComponent,\r\n  ]\r\n})\r\nexport class WfTaskHandlerModule { }\r\n"]}