/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, Injector, ViewChild, TemplateRef, Input, Output, EventEmitter } from '@angular/core';
import { SendMessage } from '../time-limit-control.entity';
import { MessagerService } from '@farris/ui-messager';
import { ProcessDesignerUIState } from '../../../app/process-designer.uistate';
var SendMessageOperationComponent = /** @class */ (function () {
    function SendMessageOperationComponent(injector, message, uistate) {
        this.injector = injector;
        this.message = message;
        this.uistate = uistate;
        // operation: ExpireOperation = new ExpireOperation();
        this.operation = new SendMessage('activity');
        this.closeEmitter = new EventEmitter();
        this.submitEmitter = new EventEmitter();
        this.typeGroup = this.uistate.messageChannels.map((/**
         * @param {?} m
         * @return {?}
         */
        function (m) { return ({ value: m.code, name: m.name }); }));
        this.receiverVariables = [
            { value: 'procInstCreator', name: '流程发起人' }
        ];
        this.activityReceiverVariables = [
            { value: 'workItemParticipant', name: '当前节点办理人' },
            { value: 'procInstCreator', name: '流程发起人' },
            { value: 'preActExecutors', name: '上一节点办理人' }
        ];
        this.placeholder = '';
        this.placeholder2 = '';
        this.parser = (/**
         * @param {?} val
         * @return {?}
         */
        function (val) {
            // console.log(val);
            return Number(val);
        });
        this.timeUnitCollection = [
            { value: 'day', text: '天' },
            { value: 'hour', text: '时' },
            { value: 'minute', text: '分' }
        ];
        this.location = 'activity';
        this.activityReceiverVar = '';
        this.bindingData = {};
    }
    Object.defineProperty(SendMessageOperationComponent.prototype, "value", {
        get: /**
         * @return {?}
         */
        function () {
            return this.operation;
        },
        set: /**
         * @param {?} info
         * @return {?}
         */
        function (info) {
            var e_1, _a, e_2, _b;
            this.operation = Object.assign({}, info);
            if (this.operation.sendType === undefined) {
                /** @type {?} */
                var sendMessage = new SendMessage(this.location);
                this.operation.cycleEnable = sendMessage.cycleEnable;
                this.operation.cycleTimeUnit = sendMessage.cycleTimeUnit;
                this.operation.receiver = sendMessage.receiver;
                this.operation.subject = sendMessage.subject;
                this.operation.message = sendMessage.message;
            }
            if (this.operation.receiver && this.operation.receiver.length > 0) {
                /** @type {?} */
                var array = this.operation.receiver.split(',');
                if (array.indexOf('workItemParticipant') > -1) {
                    this.receiverVari = 'workItemParticipant';
                    this.activityReceiverVar += 'workItemParticipant,';
                }
                if (array.indexOf('procInstCreator') > -1) {
                    this.receiverVari = 'procInstCreator';
                    this.activityReceiverVar += 'procInstCreator,';
                }
                if (array.indexOf('preActExecutors') > -1) {
                    this.activityReceiverVar += 'preActExecutors,';
                }
                if (this.activityReceiverVar.length > 0) {
                    this.activityReceiverVar = this.activityReceiverVar.substring(0, this.activityReceiverVar.length - 1);
                }
                if (array.length > 0) {
                    array = array.filter((/**
                     * @param {?} a
                     * @return {?}
                     */
                    function (a) { return a !== 'procInstCreator'; }));
                    this.bindingData.id = '';
                    try {
                        for (var array_1 = tslib_1.__values(array), array_1_1 = array_1.next(); !array_1_1.done; array_1_1 = array_1.next()) {
                            var r = array_1_1.value;
                            this.bindingData.id += r + ',';
                        }
                    }
                    catch (e_1_1) { e_1 = { error: e_1_1 }; }
                    finally {
                        try {
                            if (array_1_1 && !array_1_1.done && (_a = array_1.return)) _a.call(array_1);
                        }
                        finally { if (e_1) throw e_1.error; }
                    }
                    if (this.bindingData.id) {
                        this.bindingData.id = this.bindingData.id.substring(0, this.bindingData.id.length - 1);
                    }
                }
            }
            if (this.operation.receiverText && this.operation.receiverText.length > 0) {
                /** @type {?} */
                var array = this.operation.receiverText.split(',');
                if (array.length > 0) {
                    array = array.filter((/**
                     * @param {?} a
                     * @return {?}
                     */
                    function (a) { return a !== '流程发起人'; }));
                    this.bindingData.name = '';
                    try {
                        for (var array_2 = tslib_1.__values(array), array_2_1 = array_2.next(); !array_2_1.done; array_2_1 = array_2.next()) {
                            var r = array_2_1.value;
                            this.bindingData.name += r + ',';
                        }
                    }
                    catch (e_2_1) { e_2 = { error: e_2_1 }; }
                    finally {
                        try {
                            if (array_2_1 && !array_2_1.done && (_b = array_2.return)) _b.call(array_2);
                        }
                        finally { if (e_2) throw e_2.error; }
                    }
                    if (this.bindingData.name) {
                        this.bindingData.name = this.bindingData.name.substring(0, this.bindingData.name.length - 1);
                    }
                }
            }
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    SendMessageOperationComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @return {?}
     */
    SendMessageOperationComponent.prototype.clickOK = /**
     * @return {?}
     */
    function () {
        this.operation.cycleTime += '';
        if (this.location === 'process') {
            this.setReceiver();
        }
        if (this.location === 'activity') {
            this.setActivityReceiver();
        }
        if (this.validator()) {
            this.submitEmitter.emit(this.operation);
        }
    };
    /**
     * @return {?}
     */
    SendMessageOperationComponent.prototype.clickCancel = /**
     * @return {?}
     */
    function () {
        this.closeEmitter.emit();
    };
    /**
     * @return {?}
     */
    SendMessageOperationComponent.prototype.clear = /**
     * @return {?}
     */
    function () {
        this.bindingData = {};
    };
    /**
     * @private
     * @return {?}
     */
    SendMessageOperationComponent.prototype.setReceiver = /**
     * @private
     * @return {?}
     */
    function () {
        var e_3, _a;
        /** @type {?} */
        var receiver = '';
        /** @type {?} */
        var receiverText = '';
        if (this.receiverVari) {
            receiver += this.receiverVari + ',';
            /** @type {?} */
            var array = this.receiverVari.split(',');
            if (array.length > 0) {
                var _loop_1 = function (a) {
                    /** @type {?} */
                    var t = this_1.receiverVariables.find((/**
                     * @param {?} v
                     * @return {?}
                     */
                    function (v) { return v.value === a; })).name;
                    receiverText += t + ',';
                };
                var this_1 = this;
                try {
                    for (var array_3 = tslib_1.__values(array), array_3_1 = array_3.next(); !array_3_1.done; array_3_1 = array_3.next()) {
                        var a = array_3_1.value;
                        _loop_1(a);
                    }
                }
                catch (e_3_1) { e_3 = { error: e_3_1 }; }
                finally {
                    try {
                        if (array_3_1 && !array_3_1.done && (_a = array_3.return)) _a.call(array_3);
                    }
                    finally { if (e_3) throw e_3.error; }
                }
            }
        }
        if (this.bindingData.id) {
            receiver += this.bindingData.id + ',';
            receiverText += this.bindingData.name + ',';
        }
        if (receiver) {
            receiver = receiver.substring(0, receiver.length - 1);
        }
        if (receiverText) {
            receiverText = receiverText.substring(0, receiverText.length - 1);
        }
        this.operation.receiver = receiver;
        this.operation.receiverText = receiverText;
    };
    /**
     * @return {?}
     */
    SendMessageOperationComponent.prototype.setActivityReceiver = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var receiver = '';
        if (this.activityReceiverVar) {
            receiver += this.activityReceiverVar + ',';
        }
        if (receiver) {
            receiver = receiver.substring(0, receiver.length - 1);
        }
        this.operation.receiver = receiver;
    };
    /**
     * @private
     * @return {?}
     */
    SendMessageOperationComponent.prototype.validator = /**
     * @private
     * @return {?}
     */
    function () {
        if (!this.operation.sendType) {
            this.message.info('发送方式不允许为空！');
            return false;
        }
        if (!this.operation.subject) {
            this.message.info('消息主题不允许为空！');
            return false;
        }
        if (!this.operation.message) {
            this.message.info('消息内容不允许为空！');
            return false;
        }
        if (!this.operation.receiver) {
            this.message.info('接收人不允许为空！');
            return false;
        }
        return true;
    };
    SendMessageOperationComponent.decorators = [
        { type: Component, args: [{
                    selector: 'lib-send-message-operation',
                    template: "<div class=\"f-page\">\r\n  <div class=\"f-utils-fill-flex-column farris-split-section m-2 h-100\">\r\n    <section class=\"f-utils-fill-flex-column h-100\">\r\n      <div class=\"f-section-header pt-2 mx-2\">\r\n        <div class=\"f-title\">\r\n          <h4 class=\"f-title-text\">\u9884\u8B66\u6D88\u606F\u8BBE\u7F6E</h4>\r\n        </div>\r\n      </div>\r\n      <div class=\"f-utils-fill-flex-column h-100\">\r\n        <perfect-scrollbar [config]=\"{}\">\r\n          <form class=\"h-100\">\r\n            <div class=\"farris-form form-inline farris-form-inline\">\r\n              <div class=\"farris-form-controls-inline\">\r\n                <div class=\"farris-group-wrap\">\r\n                  <div class=\"form-group\">\r\n                    <label class=\"col-form-label pl-1 mr-3\">\r\n                      <span class=\"farris-label-text\">\u542F\u7528\u5FAA\u73AF\u9884\u8B66</span>\r\n                    </label>\r\n                    <div class=\"farris-input-wrap mr-5\">\r\n                      <farris-switch [(ngModel)]=\"operation.cycleEnable\" name=\"cycleEnable\"></farris-switch>\r\n                      <div class=\"farris-feedback valid-feedback\"></div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div class=\"farris-form-controls-inline\">\r\n                <div class=\"farris-group-wrap\">\r\n                  <div class=\"form-group\" style=\"width: 100%;\">\r\n                    <label class=\"col-form-label pl-1 mr-3\">\r\n                      <span class=\"farris-label-text\">\u5FAA\u73AF\u65F6\u95F4\u95F4\u9694</span>\r\n                    </label>\r\n                    <div class=\"farris-input-wrap mr-1\" style=\"width: 35%;\">\r\n                      <farris-number-spinner [(ngModel)]=\"operation.cycleTime\" name=\"cycleTime\"\r\n                                             [editable]=\"true\" [precision]=\"0\" [parser]=\"parser\"\r\n                                             [min]=\"0\"></farris-number-spinner>\r\n                      <div class=\"farris-feedback valid-feedback\"></div>\r\n                    </div>\r\n                    <div class=\"farris-input-wrap mr-5\" style=\"width: 30%;\">\r\n                      <farris-combo-list [(ngModel)]=\"operation.cycleTimeUnit\" name=\"cycleTimeUnit\" [idField]=\"'value'\" [textField]=\"'text'\"\r\n                                         [valueField]=\"'value'\" [data]=\"timeUnitCollection\" [panelHeight]=\"'auto'\"\r\n                                         [editable]=\"false\" [enableClear]=\"false\">\r\n                      </farris-combo-list>\r\n                      <div class=\"farris-feedback valid-feedback\"></div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div class=\"farris-group-wrap\">\r\n                <div class=\"form-group farris-form-group\">\r\n                  <label class=\"col-form-label\">\r\n                    <span class=\"farris-label-info text-danger\">*</span>\r\n                    <span class=\"farris-label-text\">\u53D1\u9001\u65B9\u5F0F</span>\r\n                  </label>\r\n                  <div class=\"farris-input-wrap ml-1\">\r\n                    <farris-checkboxgroup #checkboxGroup [(ngModel)]=\"operation.sendType\" name=\"sendType\" [horizontal]=\"true\"\r\n                      [data]=\"typeGroup\">\r\n                    </farris-checkboxgroup>\r\n                    <div class=\"farris-feedback valid-feedback\"></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div class=\"farris-group-wrap my-3\">\r\n                <div class=\"form-group farris-form-group\">\r\n                  <label class=\"col-form-label\">\r\n                    <span class=\"farris-label-info text-danger\">*</span>\r\n                    <span class=\"farris-label-text\">\u6D88\u606F\u4E3B\u9898</span>\r\n                  </label>\r\n                  <div class=\"farris-input-wrap ml-1\">\r\n                    <input class=\"form-control\" type=\"text\" value=\"subject\" [(ngModel)]=\"operation.subject\" name=\"subject\"\r\n                      [placeholder]=\"placeholder\" />\r\n                    <div class=\"farris-feedback valid-feedback\"></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div class=\"farris-group-wrap my-3\">\r\n                <div class=\"form-group farris-form-group\">\r\n                  <label class=\"col-form-label\">\r\n                    <span class=\"farris-label-info text-danger\">*</span>\r\n                    <span class=\"farris-label-text\">\u6D88\u606F\u5185\u5BB9</span>\r\n                  </label>\r\n                  <div class=\"farris-input-wrap ml-1\">\r\n                    <textarea class=\"form-control\" type=\"text\" value=\"message\" [(ngModel)]=\"operation.message\" name=\"message\"\r\n                      [placeholder]=\"placeholder2\" style=\"height: 100px;\"></textarea>\r\n                    <div class=\"farris-feedback valid-feedback\"></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div *ngIf=\"location==='process'\" class=\"farris-group-wrap\">\r\n                <div class=\"form-group farris-form-group\">\r\n                  <label class=\"col-form-label\">\r\n                    <span class=\"farris-label-info text-danger\">*</span>\r\n                    <span class=\"farris-label-text\">\u63A5\u6536\u4EBA</span>\r\n                  </label>\r\n                  <div class=\"farris-input-wrap ml-1\">\r\n                    <div class=\"pb-2\">\r\n                      <farris-checkboxgroup #receiverVariable [(ngModel)]=\"receiverVari\" name=\"receiverVariable\"\r\n                        [horizontal]=\"true\" [data]=\"receiverVariables\">\r\n                      </farris-checkboxgroup>\r\n                    </div>\r\n                    <div>\r\n                      <sys-farris-grid-lookup #userHelp [singleSelect]=\"false\" [displayTxt]=\"bindingData.name\" [pagination]=\"true\"\r\n                        [pageSize]=\"20\" [title]=\"'\u7CFB\u7EDF\u7528\u6237'\" [sourceType]=\"'user'\" [bindingData]=\"bindingData\"\r\n                        [filter]=\"{notGetCurrentUser:false, notGetStopUser:true}\" [typeMode]=\"1\" (clear)=\"clear()\">\r\n                      </sys-farris-grid-lookup>\r\n                    </div>\r\n                    <div class=\"farris-feedback valid-feedback\"></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div *ngIf=\"location==='activity'\" class=\"farris-group-wrap\">\r\n                <div class=\"form-group farris-form-group\">\r\n                  <label class=\"col-form-label\">\r\n                    <span class=\"farris-label-info text-danger\">*</span>\r\n                    <span class=\"farris-label-text\">\u63A5\u6536\u4EBA</span>\r\n                  </label>\r\n                  <div class=\"farris-input-wrap ml-1\">\r\n                    <div class=\"pb-2\">\r\n                      <farris-checkboxgroup #receiverVariable1 [(ngModel)]=\"activityReceiverVar\" name=\"ActivityReceiverVariable\"\r\n                                            [horizontal]=\"true\" [data]=\"activityReceiverVariables\">\r\n                      </farris-checkboxgroup>\r\n                    </div>\r\n                    <div class=\"farris-feedback valid-feedback\"></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </form>\r\n        </perfect-scrollbar>\r\n\r\n      </div>\r\n    </section>\r\n  </div>\r\n</div>\r\n\r\n<ng-template #footer>\r\n  <button type=\"button\" class=\"btn btn-primary btn-sm mx-2\" (click)=\"clickOK()\">\u786E\u5B9A</button>\r\n  <button type=\"button\" class=\"btn btn-secondary btn-sm mx-2\" (click)=\"clickCancel()\">\u53D6\u6D88</button>\r\n</ng-template>\r\n",
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    SendMessageOperationComponent.ctorParameters = function () { return [
        { type: Injector },
        { type: MessagerService },
        { type: ProcessDesignerUIState }
    ]; };
    SendMessageOperationComponent.propDecorators = {
        footer: [{ type: ViewChild, args: ['footer',] }],
        value: [{ type: Input }],
        closeEmitter: [{ type: Output }],
        submitEmitter: [{ type: Output }]
    };
    return SendMessageOperationComponent;
}());
export { SendMessageOperationComponent };
if (false) {
    /** @type {?} */
    SendMessageOperationComponent.prototype.footer;
    /** @type {?} */
    SendMessageOperationComponent.prototype.operation;
    /** @type {?} */
    SendMessageOperationComponent.prototype.closeEmitter;
    /** @type {?} */
    SendMessageOperationComponent.prototype.submitEmitter;
    /** @type {?} */
    SendMessageOperationComponent.prototype.typeGroup;
    /** @type {?} */
    SendMessageOperationComponent.prototype.receiverVariables;
    /** @type {?} */
    SendMessageOperationComponent.prototype.activityReceiverVariables;
    /** @type {?} */
    SendMessageOperationComponent.prototype.placeholder;
    /** @type {?} */
    SendMessageOperationComponent.prototype.placeholder2;
    /** @type {?} */
    SendMessageOperationComponent.prototype.parser;
    /** @type {?} */
    SendMessageOperationComponent.prototype.timeUnitCollection;
    /** @type {?} */
    SendMessageOperationComponent.prototype.location;
    /** @type {?} */
    SendMessageOperationComponent.prototype.receiverVari;
    /** @type {?} */
    SendMessageOperationComponent.prototype.activityReceiverVar;
    /** @type {?} */
    SendMessageOperationComponent.prototype.bindingData;
    /**
     * @type {?}
     * @private
     */
    SendMessageOperationComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    SendMessageOperationComponent.prototype.message;
    /**
     * @type {?}
     * @private
     */
    SendMessageOperationComponent.prototype.uistate;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VuZC1tZXNzYWdlLW9wZXJhdGlvbi5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLXdmL3dmLXByb2Nlc3MtZWRpdG9yLyIsInNvdXJjZXMiOlsibGliL3ZpZXdzL3RpbWUtbGltaXQtY29udHJvbC9zZW5kLW1lc3NhZ2Utb3BlcmF0aW9uL3NlbmQtbWVzc2FnZS1vcGVyYXRpb24uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBVSxRQUFRLEVBQUUsU0FBUyxFQUFFLFdBQVcsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNqSCxPQUFPLEVBQWtCLFdBQVcsRUFBQyxNQUFNLDhCQUE4QixDQUFDO0FBQzFFLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN0RCxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSx1Q0FBdUMsQ0FBQztBQUUvRTtJQXVHRSx1Q0FDVSxRQUFrQixFQUNsQixPQUF3QixFQUN4QixPQUErQjtRQUYvQixhQUFRLEdBQVIsUUFBUSxDQUFVO1FBQ2xCLFlBQU8sR0FBUCxPQUFPLENBQWlCO1FBQ3hCLFlBQU8sR0FBUCxPQUFPLENBQXdCOztRQXhDekMsY0FBUyxHQUFnQixJQUFJLFdBQVcsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUMzQyxpQkFBWSxHQUFHLElBQUksWUFBWSxFQUFPLENBQUM7UUFDdkMsa0JBQWEsR0FBRyxJQUFJLFlBQVksRUFBbUIsQ0FBQztRQUU5RCxjQUFTLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxlQUFlLENBQUMsR0FBRzs7OztRQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUMsRUFBakMsQ0FBaUMsRUFBQyxDQUFDO1FBRXJG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QUFDO1NBQ2Q7UUFDRCxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLEVBQUU7WUFDNUIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7WUFDL0IsT0FBTyxLQUFLLENBQUM7U0FDZDtRQUNELE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQzs7Z0JBNUxGLFNBQVMsU0FBQztvQkFDVCxRQUFRLEVBQUUsNEJBQTRCO29CQUN0QyxpNlBBQXNEOztpQkFFdkQ7Ozs7Z0JBVDJCLFFBQVE7Z0JBRTNCLGVBQWU7Z0JBQ2Ysc0JBQXNCOzs7eUJBUzVCLFNBQVMsU0FBQyxRQUFRO3dCQUNsQixLQUFLOytCQTJETCxNQUFNO2dDQUNOLE1BQU07O0lBeUhULG9DQUFDO0NBQUEsQUE3TEQsSUE2TEM7U0F4TFksNkJBQTZCOzs7SUFFeEMsK0NBQThDOztJQTJEOUMsa0RBQXFEOztJQUNyRCxxREFBaUQ7O0lBQ2pELHNEQUE4RDs7SUFFOUQsa0RBQXFGOztJQUVyRiwwREFFRTs7SUFDRixrRUFJRTs7SUFFRixvREFBaUI7O0lBQ2pCLHFEQUFrQjs7SUFFbEIsK0NBR0M7O0lBRUQsMkRBSUU7O0lBRUYsaURBQThDOztJQUU5QyxxREFBcUI7O0lBRXJCLDREQUFpQzs7SUFFakMsb0RBQWdDOzs7OztJQUc5QixpREFBMEI7Ozs7O0lBQzFCLGdEQUFnQzs7Ozs7SUFDaEMsZ0RBQXVDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIEluamVjdG9yLCBWaWV3Q2hpbGQsIFRlbXBsYXRlUmVmLCBJbnB1dCwgT3V0cHV0LCBFdmVudEVtaXR0ZXIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHtFeHBpcmVPcGVyYXRpb24sIFNlbmRNZXNzYWdlfSBmcm9tICcuLi90aW1lLWxpbWl0LWNvbnRyb2wuZW50aXR5JztcclxuaW1wb3J0IHsgTWVzc2FnZXJTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1tZXNzYWdlcic7XHJcbmltcG9ydCB7IFByb2Nlc3NEZXNpZ25lclVJU3RhdGUgfSBmcm9tICcuLi8uLi8uLi9hcHAvcHJvY2Vzcy1kZXNpZ25lci51aXN0YXRlJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnbGliLXNlbmQtbWVzc2FnZS1vcGVyYXRpb24nLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9zZW5kLW1lc3NhZ2Utb3BlcmF0aW9uLmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi9zZW5kLW1lc3NhZ2Utb3BlcmF0aW9uLmNvbXBvbmVudC5zY3NzJ11cclxufSlcclxuZXhwb3J0IGNsYXNzIFNlbmRNZXNzYWdlT3BlcmF0aW9uQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuXHJcbiAgQFZpZXdDaGlsZCgnZm9vdGVyJykgZm9vdGVyOiBUZW1wbGF0ZVJlZjxhbnk+O1xyXG4gIEBJbnB1dCgpXHJcbiAgc2V0IHZhbHVlKGluZm86IFNlbmRNZXNzYWdlKSB7XHJcbiAgICB0aGlzLm9wZXJhdGlvbiA9IE9iamVjdC5hc3NpZ24oe30sIGluZm8pO1xyXG4gICAgaWYgKHRoaXMub3BlcmF0aW9uLnNlbmRUeXBlID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgY29uc3Qgc2VuZE1lc3NhZ2UgPSBuZXcgU2VuZE1lc3NhZ2UodGhpcy5sb2NhdGlvbik7XHJcbiAgICAgIHRoaXMub3BlcmF0aW9uLmN5Y2xlRW5hYmxlID0gc2VuZE1lc3NhZ2UuY3ljbGVFbmFibGU7XHJcbiAgICAgIHRoaXMub3BlcmF0aW9uLmN5Y2xlVGltZVVuaXQgPSBzZW5kTWVzc2FnZS5jeWNsZVRpbWVVbml0O1xyXG4gICAgICB0aGlzLm9wZXJhdGlvbi5yZWNlaXZlciA9IHNlbmRNZXNzYWdlLnJlY2VpdmVyO1xyXG4gICAgICB0aGlzLm9wZXJhdGlvbi5zdWJqZWN0ID0gc2VuZE1lc3NhZ2Uuc3ViamVjdDtcclxuICAgICAgdGhpcy5vcGVyYXRpb24ubWVzc2FnZSA9IHNlbmRNZXNzYWdlLm1lc3NhZ2U7XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5vcGVyYXRpb24ucmVjZWl2ZXIgJiYgdGhpcy5vcGVyYXRpb24ucmVjZWl2ZXIubGVuZ3RoID4gMCkge1xyXG4gICAgICBsZXQgYXJyYXkgPSB0aGlzLm9wZXJhdGlvbi5yZWNlaXZlci5zcGxpdCgnLCcpO1xyXG4gICAgICBpZiAoYXJyYXkuaW5kZXhPZignd29ya0l0ZW1QYXJ0aWNpcGFudCcpID4gLTEpIHtcclxuICAgICAgICB0aGlzLnJlY2VpdmVyVmFyaSA9ICd3b3JrSXRlbVBhcnRpY2lwYW50JztcclxuICAgICAgICB0aGlzLmFjdGl2aXR5UmVjZWl2ZXJWYXIgKz0gJ3dvcmtJdGVtUGFydGljaXBhbnQsJztcclxuICAgICAgfVxyXG4gICAgICBpZiAoYXJyYXkuaW5kZXhPZigncHJvY0luc3RDcmVhdG9yJykgPiAtMSkge1xyXG4gICAgICAgIHRoaXMucmVjZWl2ZXJWYXJpID0gJ3Byb2NJbnN0Q3JlYXRvcic7XHJcbiAgICAgICAgdGhpcy5hY3Rpdml0eVJlY2VpdmVyVmFyICs9ICdwcm9jSW5zdENyZWF0b3IsJztcclxuICAgICAgfVxyXG4gICAgICBpZiAoYXJyYXkuaW5kZXhPZigncHJlQWN0RXhlY3V0b3JzJykgPiAtMSl7XHJcbiAgICAgICAgdGhpcy5hY3Rpdml0eVJlY2VpdmVyVmFyICs9ICdwcmVBY3RFeGVjdXRvcnMsJztcclxuICAgICAgfVxyXG4gICAgICBpZih0aGlzLmFjdGl2aXR5UmVjZWl2ZXJWYXIubGVuZ3RoID4gMCl7XHJcbiAgICAgICAgdGhpcy5hY3Rpdml0eVJlY2VpdmVyVmFyID0gdGhpcy5hY3Rpdml0eVJlY2VpdmVyVmFyLnN1YnN0cmluZygwLHRoaXMuYWN0aXZpdHlSZWNlaXZlclZhci5sZW5ndGgtMSk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKGFycmF5Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICBhcnJheSA9IGFycmF5LmZpbHRlcihhID0+IGEgIT09ICdwcm9jSW5zdENyZWF0b3InKTtcclxuICAgICAgICB0aGlzLmJpbmRpbmdEYXRhLmlkID0gJyc7XHJcbiAgICAgICAgZm9yIChjb25zdCByIG9mIGFycmF5KSB7XHJcbiAgICAgICAgICB0aGlzLmJpbmRpbmdEYXRhLmlkICs9IHIgKyAnLCc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmJpbmRpbmdEYXRhLmlkKSB7XHJcbiAgICAgICAgICB0aGlzLmJpbmRpbmdEYXRhLmlkID0gdGhpcy5iaW5kaW5nRGF0YS5pZC5zdWJzdHJpbmcoMCwgdGhpcy5iaW5kaW5nRGF0YS5pZC5sZW5ndGggLSAxKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGlmICh0aGlzLm9wZXJhdGlvbi5yZWNlaXZlclRleHQgJiYgdGhpcy5vcGVyYXRpb24ucmVjZWl2ZXJUZXh0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgbGV0IGFycmF5ID0gdGhpcy5vcGVyYXRpb24ucmVjZWl2ZXJUZXh0LnNwbGl0KCcsJyk7XHJcbiAgICAgIGlmIChhcnJheS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgYXJyYXkgPSBhcnJheS5maWx0ZXIoYSA9PiBhICE9PSAn5rWB56iL5Y+R6LW35Lq6Jyk7XHJcbiAgICAgICAgdGhpcy5iaW5kaW5nRGF0YS5uYW1lID0gJyc7XHJcbiAgICAgICAgZm9yIChjb25zdCByIG9mIGFycmF5KSB7XHJcbiAgICAgICAgICB0aGlzLmJpbmRpbmdEYXRhLm5hbWUgKz0gciArICcsJztcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuYmluZGluZ0RhdGEubmFtZSkge1xyXG4gICAgICAgICAgdGhpcy5iaW5kaW5nRGF0YS5uYW1lID0gdGhpcy5iaW5kaW5nRGF0YS5uYW1lLnN1YnN0cmluZygwLCB0aGlzLmJpbmRpbmdEYXRhLm5hbWUubGVuZ3RoIC0gMSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBnZXQgdmFsdWUoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5vcGVyYXRpb247XHJcbiAgfVxyXG5cclxuICAvLyBvcGVyYXRpb246IEV4cGlyZU9wZXJhdGlvbiA9IG5ldyBFeHBpcmVPcGVyYXRpb24oKTtcclxuICBvcGVyYXRpb246IFNlbmRNZXNzYWdlID0gbmV3IFNlbmRNZXNzYWdlKCdhY3Rpdml0eScpO1xyXG4gIEBPdXRwdXQoKSBjbG9zZUVtaXR0ZXIgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuICBAT3V0cHV0KCkgc3VibWl0RW1pdHRlciA9IG5ldyBFdmVudEVtaXR0ZXI8RXhwaXJlT3BlcmF0aW9uPigpO1xyXG5cclxuICB0eXBlR3JvdXAgPSB0aGlzLnVpc3RhdGUubWVzc2FnZUNoYW5uZWxzLm1hcChtID0+ICh7IHZhbHVlOiBtLmNvZGUsIG5hbWU6IG0ubmFtZSB9KSk7XHJcblxyXG4gIHJlY2VpdmVyVmFyaWFibGVzID0gW1xyXG4gICAgeyB2YWx1ZTogJ3Byb2NJbnN0Q3JlYXRvcicsIG5hbWU6ICfmtYHnqIvlj5HotbfkuronIH1cclxuICBdO1xyXG4gIGFjdGl2aXR5UmVjZWl2ZXJWYXJpYWJsZXMgPSBbXHJcbiAgICB7IHZhbHVlOiAnd29ya0l0ZW1QYXJ0aWNpcGFudCcsIG5hbWU6ICflvZPliY3oioLngrnlip7nkIbkuronIH0sXHJcbiAgICB7IHZhbHVlOiAncHJvY0luc3RDcmVhdG9yJywgbmFtZTogJ+a1geeoi+WPkei1t+S6uicgfSxcclxuICAgIHsgdmFsdWU6ICdwcmVBY3RFeGVjdXRvcnMnLCBuYW1lOiAn5LiK5LiA6IqC54K55Yqe55CG5Lq6JyB9XHJcbiAgXTtcclxuXHJcbiAgcGxhY2Vob2xkZXIgPSAnJztcclxuICBwbGFjZWhvbGRlcjIgPSAnJztcclxuXHJcbiAgcGFyc2VyID0gKHZhbDogc3RyaW5nIHwgbnVtYmVyKSA9PiB7XHJcbiAgICAvLyBjb25zb2xlLmxvZyh2YWwpO1xyXG4gICAgcmV0dXJuIE51bWJlcih2YWwpO1xyXG4gIH1cclxuXHJcbiAgdGltZVVuaXRDb2xsZWN0aW9uID0gW1xyXG4gICAgeyB2YWx1ZTogJ2RheScsIHRleHQ6ICflpKknIH0sXHJcbiAgICB7IHZhbHVlOiAnaG91cicsIHRleHQ6ICfml7YnIH0sXHJcbiAgICB7IHZhbHVlOiAnbWludXRlJywgdGV4dDogJ+WIhicgfVxyXG4gIF07XHJcblxyXG4gIGxvY2F0aW9uOiAnYWN0aXZpdHknIHwgJ3Byb2Nlc3MnID0gJ2FjdGl2aXR5JztcclxuXHJcbiAgcmVjZWl2ZXJWYXJpOiBzdHJpbmc7XHJcblxyXG4gIGFjdGl2aXR5UmVjZWl2ZXJWYXI6IHN0cmluZyA9ICcnO1xyXG5cclxuICBiaW5kaW5nRGF0YTogeyBpZD8sIG5hbWU/fSA9IHt9O1xyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yLFxyXG4gICAgcHJpdmF0ZSBtZXNzYWdlOiBNZXNzYWdlclNlcnZpY2UsXHJcbiAgICBwcml2YXRlIHVpc3RhdGU6IFByb2Nlc3NEZXNpZ25lclVJU3RhdGVcclxuICApIHsgfVxyXG5cclxuICBuZ09uSW5pdCgpIHtcclxuICB9XHJcblxyXG4gIGNsaWNrT0soKSB7XHJcbiAgICB0aGlzLm9wZXJhdGlvbi5jeWNsZVRpbWUgKz0gJyc7XHJcbiAgICBpZiAodGhpcy5sb2NhdGlvbiA9PT0gJ3Byb2Nlc3MnKSB7XHJcbiAgICAgIHRoaXMuc2V0UmVjZWl2ZXIoKTtcclxuICAgIH1cclxuICAgIGlmKHRoaXMubG9jYXRpb24gPT09ICdhY3Rpdml0eScpIHtcclxuICAgICAgdGhpcy5zZXRBY3Rpdml0eVJlY2VpdmVyKClcclxuICAgIH1cclxuICAgIGlmICh0aGlzLnZhbGlkYXRvcigpKSB7XHJcbiAgICAgIHRoaXMuc3VibWl0RW1pdHRlci5lbWl0KHRoaXMub3BlcmF0aW9uKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGNsaWNrQ2FuY2VsKCkge1xyXG4gICAgdGhpcy5jbG9zZUVtaXR0ZXIuZW1pdCgpO1xyXG4gIH1cclxuXHJcbiAgY2xlYXIoKSB7XHJcbiAgICB0aGlzLmJpbmRpbmdEYXRhID0ge307XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHNldFJlY2VpdmVyKCkge1xyXG4gICAgbGV0IHJlY2VpdmVyID0gJyc7XHJcbiAgICBsZXQgcmVjZWl2ZXJUZXh0ID0gJyc7XHJcbiAgICBpZiAodGhpcy5yZWNlaXZlclZhcmkpIHtcclxuICAgICAgcmVjZWl2ZXIgKz0gdGhpcy5yZWNlaXZlclZhcmkgKyAnLCc7XHJcbiAgICAgIGNvbnN0IGFycmF5ID0gdGhpcy5yZWNlaXZlclZhcmkuc3BsaXQoJywnKTtcclxuICAgICAgaWYgKGFycmF5Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICBmb3IgKGNvbnN0IGEgb2YgYXJyYXkpIHtcclxuICAgICAgICAgIGNvbnN0IHQgPSB0aGlzLnJlY2VpdmVyVmFyaWFibGVzLmZpbmQodiA9PiB2LnZhbHVlID09PSBhKS5uYW1lO1xyXG4gICAgICAgICAgcmVjZWl2ZXJUZXh0ICs9IHQgKyAnLCc7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5iaW5kaW5nRGF0YS5pZCkge1xyXG4gICAgICByZWNlaXZlciArPSB0aGlzLmJpbmRpbmdEYXRhLmlkICsgJywnO1xyXG4gICAgICByZWNlaXZlclRleHQgKz0gdGhpcy5iaW5kaW5nRGF0YS5uYW1lICsgJywnO1xyXG4gICAgfVxyXG4gICAgaWYgKHJlY2VpdmVyKSB7XHJcbiAgICAgIHJlY2VpdmVyID0gcmVjZWl2ZXIuc3Vic3RyaW5nKDAsIHJlY2VpdmVyLmxlbmd0aCAtIDEpO1xyXG4gICAgfVxyXG4gICAgaWYgKHJlY2VpdmVyVGV4dCkge1xyXG4gICAgICByZWNlaXZlclRleHQgPSByZWNlaXZlclRleHQuc3Vic3RyaW5nKDAsIHJlY2VpdmVyVGV4dC5sZW5ndGggLSAxKTtcclxuICAgIH1cclxuICAgIHRoaXMub3BlcmF0aW9uLnJlY2VpdmVyID0gcmVjZWl2ZXI7XHJcbiAgICB0aGlzLm9wZXJhdGlvbi5yZWNlaXZlclRleHQgPSByZWNlaXZlclRleHQ7XHJcbiAgfVxyXG5cclxuICBzZXRBY3Rpdml0eVJlY2VpdmVyKCl7XHJcbiAgICBsZXQgcmVjZWl2ZXIgPSAnJztcclxuICAgIGlmICh0aGlzLmFjdGl2aXR5UmVjZWl2ZXJWYXIpIHtcclxuICAgICAgcmVjZWl2ZXIgKz0gdGhpcy5hY3Rpdml0eVJlY2VpdmVyVmFyICsgJywnO1xyXG4gICAgfVxyXG4gICAgaWYgKHJlY2VpdmVyKSB7XHJcbiAgICAgIHJlY2VpdmVyID0gcmVjZWl2ZXIuc3Vic3RyaW5nKDAsIHJlY2VpdmVyLmxlbmd0aCAtIDEpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5vcGVyYXRpb24ucmVjZWl2ZXIgPSByZWNlaXZlcjtcclxuICB9XHJcbiAgcHJpdmF0ZSB2YWxpZGF0b3IoKTogYm9vbGVhbiB7XHJcbiAgICBpZiAoIXRoaXMub3BlcmF0aW9uLnNlbmRUeXBlKSB7XHJcbiAgICAgIHRoaXMubWVzc2FnZS5pbmZvKCflj5HpgIHmlrnlvI/kuI3lhYHorrjkuLrnqbrvvIEnKTtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgaWYgKCF0aGlzLm9wZXJhdGlvbi5zdWJqZWN0KSB7XHJcbiAgICAgIHRoaXMubWVzc2FnZS5pbmZvKCfmtojmga/kuLvpopjkuI3lhYHorrjkuLrnqbrvvIEnKTtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgaWYgKCF0aGlzLm9wZXJhdGlvbi5tZXNzYWdlKSB7XHJcbiAgICAgIHRoaXMubWVzc2FnZS5pbmZvKCfmtojmga/lhoXlrrnkuI3lhYHorrjkuLrnqbrvvIEnKTtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgaWYgKCF0aGlzLm9wZXJhdGlvbi5yZWNlaXZlcikge1xyXG4gICAgICB0aGlzLm1lc3NhZ2UuaW5mbygn5o6l5pS25Lq65LiN5YWB6K645Li656m677yBJyk7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICAgIHJldHVybiB0cnVlO1xyXG4gIH1cclxufVxyXG4iXX0=