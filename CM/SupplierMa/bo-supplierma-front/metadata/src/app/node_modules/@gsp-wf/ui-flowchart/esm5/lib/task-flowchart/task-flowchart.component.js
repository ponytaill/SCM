/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ViewChild, ElementRef, Input, Output, EventEmitter, HostBinding, ChangeDetectorRef, Optional, Injector } from '@angular/core';
import { DomSanitizer } from '@angular/platform-browser';
import { forkJoin } from 'rxjs';
import { UiFlowchartService } from '../services/ui-flowchart.service';
import { WFFlowchartService } from '../wf-flowchart.service';
import { MessagerService } from '@farris/ui-messager';
import { FrameworkService } from '@gsp-sys/rtf-common';
var UIFlowchartComponent = /** @class */ (function () {
    function UIFlowchartComponent(sanitizer, service, changeDetector, injector, chartService) {
        var _this = this;
        this.sanitizer = sanitizer;
        this.service = service;
        this.changeDetector = changeDetector;
        this.injector = injector;
        this.chartService = chartService;
        // 消息监听处理方法
        this.cls = 'd-flex flex-fill h-100';
        this.modalHide = new EventEmitter();
        this.fcHtml = window.document.location.origin + '/platform/runtime/wf/web/designer/flowchart.html';
        this.theme = 'viewFlowChart';
        this._mode = 'complete';
        this.modeButton = this.service.getI18nValue('static.flowchart.simulation');
        this.typeList = [{
                value: 'complete', text: this.service.getI18nValue('static.flowchart.complete')
            },
            {
                value: 'simulation', text: this.service.getI18nValue('static.flowchart.simulation')
            }];
        // 监听事件处理
        this.eventHandler = function (event) {
            /** @type {?} */
            var origin = event.origin;
            /** @type {?} */
            var message = event.data;
            if (_this.fcHtml.search(origin) > -1) {
                switch (message.action) {
                    case 'load':
                        _this.viewFlowChart();
                        break;
                    case 'viewLogs':
                        _this.viewLogs(message.data);
                        break;
                    case 'viewParent':
                        _this.viewParent(message.data.superProcInstId);
                        break;
                    case 'viewChild':
                        _this.viewChild(message.data.superActInstId, message.data.superProcInstId);
                        break;
                    case 'viewForm':
                        _this.viewForm(message.data.procInstId, message.data.actInstId, message.data.bizInstId);
                        break;
                    case 'retryAifCreation':
                        _this.retryAifCreation(message.data.procInstId, message.data.actInstId, message.data.bizInstId);
                        break;
                    default:
                        break;
                }
            }
        };
        this.message = this.injector.get(MessagerService);
        this.frameworkSvc = this.injector.get(FrameworkService);
        this.srcUrl = this.sanitizer.bypassSecurityTrustResourceUrl(this.fcHtml);
        if (UIFlowchartComponent.func) {
            window.removeEventListener('message', UIFlowchartComponent.func, false);
        }
        this.addMessageListener();
    }
    Object.defineProperty(UIFlowchartComponent.prototype, "mode", {
        get: /**
         * @return {?}
         */
        function () {
            return this._mode;
        },
        set: /**
         * @param {?} v
         * @return {?}
         */
        function (v) {
            this._mode = v;
            if (this._mode === 'simulation') {
                this.ifForecast = 'true';
                this.modeButton = this.service.getI18nValue('static.flowchart.complete');
            }
            else if (this._mode === 'complete') {
                this.modeButton = this.service.getI18nValue('static.flowchart.simulation');
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(UIFlowchartComponent.prototype, "ProcInstId", {
        set: /**
         * @param {?} procInstId
         * @return {?}
         */
        function (procInstId) {
            if (procInstId) {
                this.procInstId = procInstId;
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(UIFlowchartComponent.prototype, "DataId", {
        set: /**
         * @param {?} dataId
         * @return {?}
         */
        function (dataId) {
            if (dataId) {
                this.dataId = dataId;
            }
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    UIFlowchartComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @private
     * @return {?}
     */
    UIFlowchartComponent.prototype.addMessageListener = /**
     * @private
     * @return {?}
     */
    function () {
        window.addEventListener('message', this.eventHandler, false);
        UIFlowchartComponent.func = this.eventHandler;
    };
    /**
     * @private
     * @return {?}
     */
    UIFlowchartComponent.prototype.viewFlowChart = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.theme === 'viewFlowChart') {
            this.viewFlowChartByProcInstId();
        }
        else {
            this.processForecast();
        }
    };
    /**
     * @private
     * @param {?} superProcInstId
     * @return {?}
     */
    UIFlowchartComponent.prototype.viewParent = /**
     * @private
     * @param {?} superProcInstId
     * @return {?}
     */
    function (superProcInstId) {
        // this.procInstId = superProcInstId;
        // this.viewFlowChartByProcInstId();
    };
    /**
     * @private
     * @param {?} superActInstId
     * @param {?} superProcInstId
     * @return {?}
     */
    UIFlowchartComponent.prototype.viewChild = /**
     * @private
     * @param {?} superActInstId
     * @param {?} superProcInstId
     * @return {?}
     */
    function (superActInstId, superProcInstId) {
        var _this = this;
        this.service.getSubProcessInstance(superActInstId, superProcInstId)
            .subscribe(function (re) {
            if (_this.chartService) {
                _this.chartService.viewFlowChartByDialog(re.id, _this.mode);
            }
            else {
                throw Error('请升级查看流程公共包实现联查子流程图功能');
            }
        });
    };
    /**
     * @return {?}
     */
    UIFlowchartComponent.prototype.modeSwitch = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.mode === 'complete') {
            this.mode = 'simulation';
            this.ifForecast = 'true';
            this.modeButton = this.service.getI18nValue('static.flowchart.complete');
            this.service.getForecastProcessByProcInstId(this.procInstId).subscribe(function (r) {
                _this.actInstList = r.activityInstanceSlims;
                _this.transInsList = r.transitionInstanceSlims;
                _this.postMessage('modeSwitch', {
                    mode: 'simulation',
                    actiInstList: r.activityInstanceSlims,
                    transInsList: r.transitionInstanceSlims
                });
            });
        }
        else {
            this.mode = 'complete';
            this.ifForecast = 'false';
            this.modeButton = this.service.getI18nValue('static.flowchart.simulation');
            this.service.getCompleteProcessInfoByProcInstId(this.procInstId).subscribe(function (r) {
                _this.actInstList = r.activityInstanceSlims;
                _this.transInsList = r.transitionInstanceSlims;
                _this.postMessage('modeSwitch', {
                    mode: 'complete',
                    actiInstList: r.activityInstanceSlims,
                    transInsList: r.transitionInstanceSlims
                });
            });
        }
    };
    /**
     * @private
     * @param {?} data
     * @return {?}
     */
    UIFlowchartComponent.prototype.viewLogs = /**
     * @private
     * @param {?} data
     * @return {?}
     */
    function (data) {
        this.type = data.type;
        this.actDefId = data.actiDefId;
    };
    /**
     * @private
     * @return {?}
     */
    UIFlowchartComponent.prototype.viewFlowChartByProcInstId = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        this.content = '';
        if (this.procInstId) {
            if (this.mode === 'complete') {
                forkJoin(this.service.getProcInstanceById(this.procInstId), this.service.getBpmnModelbyProcInstId(this.procInstId), this.service.getCompleteProcessInfoByProcInstId(this.procInstId))
                    .subscribe(function (data) {
                    _this.processInstance = data[0];
                    _this.content = JSON.stringify(data[1]);
                    _this.actInstList = data[2].activityInstanceSlims;
                    _this.transInsList = data[2].transitionInstanceSlims;
                    _this.loadFlowChart();
                });
            }
            else {
                forkJoin(this.service.getProcInstanceById(this.procInstId), this.service.getBpmnModelbyProcInstId(this.procInstId), this.service.getForecastProcessByProcInstId(this.procInstId))
                    .subscribe(function (data) {
                    _this.processInstance = data[0];
                    _this.content = JSON.stringify(data[1]);
                    _this.actInstList = data[2].activityInstanceSlims;
                    _this.transInsList = data[2].transitionInstanceSlims;
                    _this.loadFlowChart();
                });
            }
        }
    };
    /**
     * @private
     * @return {?}
     */
    UIFlowchartComponent.prototype.processForecast = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        this.content = '';
        this.mode = 'simulation';
        // this.ifForecast = true;
        if (this.processForecastPayload.processDefinitionId && this.processForecastPayload.dataId) {
            forkJoin(this.service.getBpmnModelbyProcDefId(this.processForecastPayload.processDefinitionId), this.service.getForecastProcessByPayload(this.processForecastPayload))
                .subscribe(function (data) {
                _this.content = JSON.stringify(data[0]);
                _this.actInstList = data[1].activityInstanceSlims;
                _this.transInsList = data[1].transitionInstanceSlims;
                _this.loadFlowChart();
            });
        }
    };
    /**
     * @private
     * @param {?} procInstId
     * @param {?} actInstId
     * @param {?} bizInstId
     * @return {?}
     */
    UIFlowchartComponent.prototype.viewForm = /**
     * @private
     * @param {?} procInstId
     * @param {?} actInstId
     * @param {?} bizInstId
     * @return {?}
     */
    function (procInstId, actInstId, bizInstId) {
        var _this = this;
        if (procInstId) {
            this.service.getFormInfoByActInstId(procInstId, actInstId).subscribe(function (re) {
                /** @type {?} */
                var formInfo = re;
                if (!formInfo || !formInfo.appId) {
                    if (_this.message) {
                        _this.message.info('找不到单据，请联系管理员查看原因！');
                    }
                    return;
                }
                /** @type {?} */
                var options = {
                    appType: 'menu',
                    funcId: formInfo.appId,
                    appId: '',
                    appEntrance: '',
                    tabId: bizInstId,
                    isNewTab: true
                };
                // 传工作流上下文参数
                /** @type {?} */
                var parameters = new Map();
                parameters.set('procInstId', procInstId);
                parameters.set('actInstId', actInstId);
                formInfo.parameters.forEach(function (item) {
                    return parameters.set(item.code, item.value);
                });
                options.queryStringParams = parameters;
                if (_this.frameworkSvc) {
                    _this.frameworkSvc.openMenu(options);
                }
                else {
                    throw Error('框架服务不存在！无法联查！');
                }
            });
        }
    };
    /**
     * @private
     * @param {?} procInstId
     * @param {?} actInstId
     * @param {?} bizInstId
     * @return {?}
     */
    UIFlowchartComponent.prototype.retryAifCreation = /**
     * @private
     * @param {?} procInstId
     * @param {?} actInstId
     * @param {?} bizInstId
     * @return {?}
     */
    function (procInstId, actInstId, bizInstId) {
        var _this = this;
        if (procInstId) {
            this.service.retryAifCreation(procInstId, actInstId, bizInstId).subscribe(function (re) {
                _this.viewFlowChart();
            }, function (err) {
                setTimeout(function () {
                    //todo 确定异常结构, 目前采用兼容取值方式
                    _this.message.error(err.error == null ? err.message : (err.error.Message || err.error.message || err.message));
                }, 300);
                throw err;
            });
        }
    };
    /**
     * @return {?}
     */
    UIFlowchartComponent.prototype.loadFlowChart = /**
     * @return {?}
     */
    function () {
        if (this.content) {
            this.postMessage('load', {
                processInstance: this.processInstance,
                content: this.content,
                actiInstList: this.actInstList,
                transInsList: this.transInsList,
                mode: this.mode
            });
        }
    };
    /**
     * @param {?} action
     * @param {?} data
     * @return {?}
     */
    UIFlowchartComponent.prototype.postMessage = /**
     * @param {?} action
     * @param {?} data
     * @return {?}
     */
    function (action, data) {
        /** @type {?} */
        var message = { action: action, data: data };
        this.iframe.nativeElement.contentWindow.postMessage(message, this.fcHtml);
    };
    /**
     * @return {?}
     */
    UIFlowchartComponent.prototype.fill = /**
     * @return {?}
     */
    function () {
        this.cls = 'd-flex flex-fill h-100 f-utils-absolute-all';
    };
    UIFlowchartComponent.func = null; // 消息监听处理方法
    UIFlowchartComponent.decorators = [
        { type: Component, args: [{
                    selector: 'wf-flowchart',
                    template: "<layout [direction]=\"'h'\" [fill]=\"true\">\r\n    <layout-panel region=\"west\" [showBorder]=\"false\" [minWidth]=\"400\" style=\"width: 70%;\">\r\n        <farris-section [mainTitle]=\"'static.flowchart.flowChart' | translate\" [enableMaximize]=\"false\"\r\n            [enableAccordion]=\"false\" [fill]=\"true\" style=\"height: 100%;\" class=\"px-0 pb-0\">\r\n            <ng-template farrisSectionToolbar>   \r\n                <button *ngIf=\"theme==='viewFlowChart'\" class=\"btn btn-secondary mr-2\" (click)=\"modeSwitch()\">{{modeButton}}</button>\r\n                <div class=\"btn-group\" fDropdown>\r\n                    <button class=\"btn btn-secondary dropdown-toggle\" fDropdownToggle type=\"button\">\r\n                        {{'static.flowchart.sequenceColor' | translate}}\r\n                    </button>\r\n                    <div class=\"dropdown-menu\" fDropdownMenu>\r\n                        <table class=\"mx-2\">\r\n                            <tbody>\r\n                                <tr>\r\n                                    <td style=\"width:25px;\"><span\r\n                                            style=\"background:#595959;color:#fff;border-radius:0;display: block;width:15px;height:15px;\"></span>\r\n                                    </td>\r\n                        \r\n                                    <td style=\"width:60px;\">{{'static.flowchart.completed' | translate}}</td>\r\n                                </tr>\r\n                                <tr>\r\n                                    <td style=\"width:25px;\"><span\r\n                                            style=\"background:#f59c24;color:#fff;border-radius:0;display: block;width:15px;height:15px;\"></span>\r\n                                    </td>\r\n                                    <td style=\"width:60px;\">{{'static.flowchart.calculate' | translate}}</td>\r\n                                </tr>\r\n                                <tr>\r\n                                    <td style=\"width:25px;\"><span\r\n                                            style=\"background:#59A1FF;color:#fff;border-radius:0;display: block;width:15px;height:15px;\"></span>\r\n                                    </td>\r\n                                    <td style=\"width:60px;\">{{'static.flowchart.default' | translate}}</td>\r\n                                </tr>\r\n                                <tr>\r\n                                    <td style=\"width:25px;\"><span\r\n                                            style=\"background:#FF4040;color:#fff;border-radius:0;display: block;width:15px;height:15px;\"></span>\r\n                                    </td>\r\n                                    <td style=\"width:60px;\">{{'static.flowchart.suspend' | translate}}</td>\r\n                                </tr>\r\n                            </tbody>\r\n                        </table>\r\n                    </div>\r\n                </div>\r\n\r\n            </ng-template>\r\n            <div *ngIf=\"dataId || procInstId || processForecastPayload\" style=\"height: 100%;\">\r\n                <iframe #iframe class=\"flowChart\" [src]=\"srcUrl\" frameborder=\"0\">\r\n                </iframe>\r\n            </div>\r\n        </farris-section>\r\n    </layout-panel>\r\n    <layout-panel region=\"center\" [showBorder]=\"false\" [minWidth]=\"300\" style=\"overflow: auto; width: 30%;\">\r\n        <farris-section [enableMaximize]=\"false\" [enableAccordion]=\"false\" [showHeader]=\"false\" class=\"px-0\">\r\n            <wf-approval-logs\r\n                [ProcInstId]=\"procInstId\"\r\n                [DataId]=\"dataId\" \r\n                [IfForecast]=\"ifForecast\"\r\n                [ActivityDefinitionId]=\"actDefId\" \r\n                [Type]=\"type\"\r\n                [processForecastPayload] = \"processForecastPayload\"\r\n                [ShowHeader]=\"true\"\r\n                [ShowViewProcess]=\"false\"\r\n            >\r\n            </wf-approval-logs>\r\n        </farris-section>\r\n    </layout-panel>\r\n</layout>\r\n\r\n",
                    styles: ["::ng-deep .chartModal .ant-modal{height:100%}::ng-deep .chartModal .ant-modal-content{height:100%}::ng-deep .chartModal .ant-modal-body{height:90%}.flowChart{height:100%;min-height:400px;width:100%}"]
                }] }
    ];
    /** @nocollapse */
    UIFlowchartComponent.ctorParameters = function () { return [
        { type: DomSanitizer },
        { type: UiFlowchartService },
        { type: ChangeDetectorRef },
        { type: Injector },
        { type: WFFlowchartService, decorators: [{ type: Optional }] }
    ]; };
    UIFlowchartComponent.propDecorators = {
        cls: [{ type: HostBinding, args: ['class',] }],
        iframe: [{ type: ViewChild, args: ['iframe',] }],
        modalHide: [{ type: Output }],
        theme: [{ type: Input }],
        processForecastPayload: [{ type: Input }],
        mode: [{ type: Input }],
        ProcInstId: [{ type: Input }],
        DataId: [{ type: Input }]
    };
    return UIFlowchartComponent;
}());
export { UIFlowchartComponent };
if (false) {
    /** @type {?} */
    UIFlowchartComponent.func;
    /** @type {?} */
    UIFlowchartComponent.prototype.cls;
    /** @type {?} */
    UIFlowchartComponent.prototype.iframe;
    /** @type {?} */
    UIFlowchartComponent.prototype.modalHide;
    /** @type {?} */
    UIFlowchartComponent.prototype.procInstId;
    /** @type {?} */
    UIFlowchartComponent.prototype.dataId;
    /** @type {?} */
    UIFlowchartComponent.prototype.actDefId;
    /** @type {?} */
    UIFlowchartComponent.prototype.ifForecast;
    /** @type {?} */
    UIFlowchartComponent.prototype.type;
    /** @type {?} */
    UIFlowchartComponent.prototype.srcUrl;
    /** @type {?} */
    UIFlowchartComponent.prototype.content;
    /** @type {?} */
    UIFlowchartComponent.prototype.actInstList;
    /** @type {?} */
    UIFlowchartComponent.prototype.transInsList;
    /** @type {?} */
    UIFlowchartComponent.prototype.processInstance;
    /** @type {?} */
    UIFlowchartComponent.prototype.fcHtml;
    /** @type {?} */
    UIFlowchartComponent.prototype.theme;
    /** @type {?} */
    UIFlowchartComponent.prototype.processForecastPayload;
    /**
     * @type {?}
     * @private
     */
    UIFlowchartComponent.prototype._mode;
    /** @type {?} */
    UIFlowchartComponent.prototype.modeButton;
    /** @type {?} */
    UIFlowchartComponent.prototype.typeList;
    /**
     * @type {?}
     * @private
     */
    UIFlowchartComponent.prototype.message;
    /**
     * @type {?}
     * @private
     */
    UIFlowchartComponent.prototype.frameworkSvc;
    /** @type {?} */
    UIFlowchartComponent.prototype.eventHandler;
    /**
     * @type {?}
     * @private
     */
    UIFlowchartComponent.prototype.sanitizer;
    /**
     * @type {?}
     * @private
     */
    UIFlowchartComponent.prototype.service;
    /**
     * @type {?}
     * @private
     */
    UIFlowchartComponent.prototype.changeDetector;
    /**
     * @type {?}
     * @private
     */
    UIFlowchartComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    UIFlowchartComponent.prototype.chartService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFzay1mbG93Y2hhcnQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdzcC13Zi91aS1mbG93Y2hhcnQvIiwic291cmNlcyI6WyJsaWIvdGFzay1mbG93Y2hhcnQvdGFzay1mbG93Y2hhcnQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUFVLFNBQVMsRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFDdkQsWUFBWSxFQUFFLFdBQVcsRUFBRSxpQkFBaUIsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUNqRSxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDekQsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNoQyxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUN0RSxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUM3RCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDdEQsT0FBTyxFQUFjLGdCQUFnQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFFbkU7SUFzRUUsOEJBQ1UsU0FBdUIsRUFDdkIsT0FBMkIsRUFDM0IsY0FBaUMsRUFDakMsUUFBa0IsRUFDTixZQUFnQztRQUx0RCxpQkFlQztRQWRTLGNBQVMsR0FBVCxTQUFTLENBQWM7UUFDdkIsWUFBTyxHQUFQLE9BQU8sQ0FBb0I7UUFDM0IsbUJBQWMsR0FBZCxjQUFjLENBQW1CO1FBQ2pDLGFBQVEsR0FBUixRQUFRLENBQVU7UUFDTixpQkFBWSxHQUFaLFlBQVksQ0FBb0I7O1FBbEVoQyxRQUFHLEdBQUcsd0JBQXdCLENBQUM7UUFFM0MsY0FBUyxHQUFHLElBQUksWUFBWSxFQUFXLENBQUM7UUFXbEQsV0FBTSxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUMsUUFBUSxD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b0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xyXG4gIENvbXBvbmVudCwgT25Jbml0LCBWaWV3Q2hpbGQsIEVsZW1lbnRSZWYsIElucHV0LCBPdXRwdXQsXHJcbiAgRXZlbnRFbWl0dGVyLCBIb3N0QmluZGluZywgQ2hhbmdlRGV0ZWN0b3JSZWYsIE9wdGlvbmFsLCBJbmplY3RvclxyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBEb21TYW5pdGl6ZXIgfSBmcm9tICdAYW5ndWxhci9wbGF0Zm9ybS1icm93c2VyJztcclxuaW1wb3J0IHsgZm9ya0pvaW4gfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgVWlGbG93Y2hhcnRTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvdWktZmxvd2NoYXJ0LnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBXRkZsb3djaGFydFNlcnZpY2UgfSBmcm9tICcuLi93Zi1mbG93Y2hhcnQuc2VydmljZSc7XHJcbmltcG9ydCB7IE1lc3NhZ2VyU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbWVzc2FnZXInO1xyXG5pbXBvcnQgeyBBcHBPcHRpb25zLCBGcmFtZXdvcmtTZXJ2aWNlIH0gZnJvbSAnQGdzcC1zeXMvcnRmLWNvbW1vbic7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ3dmLWZsb3djaGFydCcsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL3Rhc2stZmxvd2NoYXJ0LmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi90YXNrLWZsb3djaGFydC5jb21wb25lbnQuY3NzJ11cclxufSlcclxuXHJcbmV4cG9ydCBjbGFzcyBVSUZsb3djaGFydENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XHJcblxyXG4gIHN0YXRpYyBmdW5jOiBhbnkgPSBudWxsOyAvLyDmtojmga/nm5HlkKzlpITnkIbmlrnms5VcclxuICBASG9zdEJpbmRpbmcoJ2NsYXNzJykgY2xzID0gJ2QtZmxleCBmbGV4LWZpbGwgaC0xMDAnO1xyXG4gIEBWaWV3Q2hpbGQoJ2lmcmFtZScpIGlmcmFtZTogRWxlbWVudFJlZjtcclxuICBAT3V0cHV0KCkgbW9kYWxIaWRlID0gbmV3IEV2ZW50RW1pdHRlcjxib29sZWFuPigpO1xyXG4gIHByb2NJbnN0SWQ6IHN0cmluZzsvL+a1geeoi+WunuS+i2lkXHJcbiAgZGF0YUlkOiBzdHJpbmc7Ly/ooajljZVpZFxyXG4gIGFjdERlZklkOiBzdHJpbmc7Ly/oioLngrnlrprkuYlpZFxyXG4gIGlmRm9yZWNhc3Q6IHN0cmluZzsvL+aYr+WQpumihOa1i1xyXG4gIHR5cGU6IGFueTsgLy90eXBlID0gJ3Byb2Nlc3Mn5p+l55yL5rWB56iL5pel5b+X77ybdHlwZSA9ICdhY3Rpdml0eSfvvIzmn6XnnIvoioLngrnml6Xlv5dcclxuICBzcmNVcmw6IGFueTtcclxuICBjb250ZW50OiBzdHJpbmc7IC8vIGJwbW5Nb2RlbFxyXG4gIGFjdEluc3RMaXN0OiBhbnlbXTsgLy8g5rS75Yqo5a6e5L6LTGlzdFxyXG4gIHRyYW5zSW5zTGlzdDogYW55W107ICAvLyDmtYHovazlrp7kvotcclxuICBwcm9jZXNzSW5zdGFuY2U6IGFueTtcclxuICBmY0h0bWwgPSB3aW5kb3cuZG9jdW1lbnQubG9jYXRpb24ub3JpZ2luICsgJy9wbGF0Zm9ybS9ydW50aW1lL3dmL3dlYi9kZXNpZ25lci9mbG93Y2hhcnQuaHRtbCc7XHJcblxyXG4gIEBJbnB1dCgpXHJcbiAgdGhlbWUgPSAndmlld0Zsb3dDaGFydCc7XHJcblxyXG4gIEBJbnB1dCgpXHJcbiAgcHJvY2Vzc0ZvcmVjYXN0UGF5bG9hZDogYW55O1xyXG5cclxuICBwcml2YXRlIF9tb2RlID0gJ2NvbXBsZXRlJztcclxuXHJcbiAgQElucHV0KClcclxuICBzZXQgbW9kZSh2OiBzdHJpbmcpIHtcclxuICAgIHRoaXMuX21vZGUgPSB2O1xyXG4gICAgaWYgKHRoaXMuX21vZGUgPT09ICdzaW11bGF0aW9uJykge1xyXG4gICAgICB0aGlzLmlmRm9yZWNhc3QgPSAndHJ1ZSc7XHJcbiAgICAgIHRoaXMubW9kZUJ1dHRvbiA9IHRoaXMuc2VydmljZS5nZXRJMThuVmFsdWUoJ3N0YXRpYy5mbG93Y2hhcnQuY29tcGxldGUnKTtcclxuICAgIH0gZWxzZSBpZiAodGhpcy5fbW9kZSA9PT0gJ2NvbXBsZXRlJykge1xyXG4gICAgICB0aGlzLm1vZGVCdXR0b24gPSB0aGlzLnNlcnZpY2UuZ2V0STE4blZhbHVlKCdzdGF0aWMuZmxvd2NoYXJ0LnNpbXVsYXRpb24nKTtcclxuICAgIH1cclxuICB9XHJcbiAgZ2V0IG1vZGUoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fbW9kZTtcclxuICB9XHJcblxyXG4gIG1vZGVCdXR0b24gPSB0aGlzLnNlcnZpY2UuZ2V0STE4blZhbHVlKCdzdGF0aWMuZmxvd2NoYXJ0LnNpbXVsYXRpb24nKTtcclxuICB0eXBlTGlzdCA9IFt7XHJcbiAgICB2YWx1ZTogJ2NvbXBsZXRlJywgdGV4dDogdGhpcy5zZXJ2aWNlLmdldEkxOG5WYWx1ZSgnc3RhdGljLmZsb3djaGFydC5jb21wbGV0ZScpXHJcbiAgfSxcclxuICB7XHJcbiAgICB2YWx1ZTogJ3NpbXVsYXRpb24nLCB0ZXh0OiB0aGlzLnNlcnZpY2UuZ2V0STE4blZhbHVlKCdzdGF0aWMuZmxvd2NoYXJ0LnNpbXVsYXRpb24nKVxyXG4gIH1dO1xyXG4gIHByaXZhdGUgbWVzc2FnZTogTWVzc2FnZXJTZXJ2aWNlO1xyXG4gIHByaXZhdGUgZnJhbWV3b3JrU3ZjOiBGcmFtZXdvcmtTZXJ2aWNlO1xyXG5cclxuICBASW5wdXQoKVxyXG4gIHNldCBQcm9jSW5zdElkKHByb2NJbnN0SWQ6IHN0cmluZykge1xyXG4gICAgaWYgKHByb2NJbnN0SWQpIHtcclxuICAgICAgdGhpcy5wcm9jSW5zdElkID0gcHJvY0luc3RJZDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIEBJbnB1dCgpXHJcbiAgc2V0IERhdGFJZChkYXRhSWQ6IHN0cmluZykge1xyXG4gICAgaWYgKGRhdGFJZCkge1xyXG4gICAgICB0aGlzLmRhdGFJZCA9IGRhdGFJZDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJpdmF0ZSBzYW5pdGl6ZXI6IERvbVNhbml0aXplcixcclxuICAgIHByaXZhdGUgc2VydmljZTogVWlGbG93Y2hhcnRTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBjaGFuZ2VEZXRlY3RvcjogQ2hhbmdlRGV0ZWN0b3JSZWYsXHJcbiAgICBwcml2YXRlIGluamVjdG9yOiBJbmplY3RvcixcclxuICAgIEBPcHRpb25hbCgpIHByaXZhdGUgY2hhcnRTZXJ2aWNlOiBXRkZsb3djaGFydFNlcnZpY2UsXHJcbiAgKSB7XHJcbiAgICB0aGlzLm1lc3NhZ2UgPSB0aGlzLmluamVjdG9yLmdldChNZXNzYWdlclNlcnZpY2UpO1xyXG4gICAgdGhpcy5mcmFtZXdvcmtTdmMgPSB0aGlzLmluamVjdG9yLmdldChGcmFtZXdvcmtTZXJ2aWNlKTtcclxuICAgIHRoaXMuc3JjVXJsID0gdGhpcy5zYW5pdGl6ZXIuYnlwYXNzU2VjdXJpdHlUcnVzdFJlc291cmNlVXJsKHRoaXMuZmNIdG1sKTtcclxuICAgIGlmIChVSUZsb3djaGFydENvbXBvbmVudC5mdW5jKSB7XHJcbiAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgVUlGbG93Y2hhcnRDb21wb25lbnQuZnVuYywgZmFsc2UpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5hZGRNZXNzYWdlTGlzdGVuZXIoKTtcclxuXHJcbiAgfVxyXG5cclxuICBuZ09uSW5pdCgpIHtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgYWRkTWVzc2FnZUxpc3RlbmVyKCkge1xyXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCB0aGlzLmV2ZW50SGFuZGxlciwgZmFsc2UpO1xyXG4gICAgVUlGbG93Y2hhcnRDb21wb25lbnQuZnVuYyA9IHRoaXMuZXZlbnRIYW5kbGVyO1xyXG4gIH1cclxuXHJcbiAgLy8g55uR5ZCs5LqL5Lu25aSE55CGXHJcbiAgZXZlbnRIYW5kbGVyID0gKGV2ZW50KSA9PiB7XHJcbiAgICBjb25zdCBvcmlnaW4gPSBldmVudC5vcmlnaW47XHJcbiAgICBjb25zdCBtZXNzYWdlID0gZXZlbnQuZGF0YTtcclxuICAgIGlmICh0aGlzLmZjSHRtbC5zZWFyY2gob3JpZ2luKSA+IC0xKSB7XHJcbiAgICAgIHN3aXRjaCAobWVzc2FnZS5hY3Rpb24pIHtcclxuICAgICAgICBjYXNlICdsb2FkJzpcclxuICAgICAgICAgIHRoaXMudmlld0Zsb3dDaGFydCgpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAndmlld0xvZ3MnOlxyXG4gICAgICAgICAgdGhpcy52aWV3TG9ncyhtZXNzYWdlLmRhdGEpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAndmlld1BhcmVudCc6XHJcbiAgICAgICAgICB0aGlzLnZpZXdQYXJlbnQobWVzc2FnZS5kYXRhLnN1cGVyUHJvY0luc3RJZCk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICd2aWV3Q2hpbGQnOlxyXG4gICAgICAgICAgdGhpcy52aWV3Q2hpbGQobWVzc2FnZS5kYXRhLnN1cGVyQWN0SW5zdElkLCBtZXNzYWdlLmRhdGEuc3VwZXJQcm9jSW5zdElkKTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ3ZpZXdGb3JtJzpcclxuICAgICAgICAgIHRoaXMudmlld0Zvcm0obWVzc2FnZS5kYXRhLnByb2NJbnN0SWQsIG1lc3NhZ2UuZGF0YS5hY3RJbnN0SWQsIG1lc3NhZ2UuZGF0YS5iaXpJbnN0SWQpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAncmV0cnlBaWZDcmVhdGlvbic6XHJcbiAgICAgICAgICB0aGlzLnJldHJ5QWlmQ3JlYXRpb24obWVzc2FnZS5kYXRhLnByb2NJbnN0SWQsIG1lc3NhZ2UuZGF0YS5hY3RJbnN0SWQsIG1lc3NhZ2UuZGF0YS5iaXpJbnN0SWQpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHZpZXdGbG93Q2hhcnQoKSB7XHJcbiAgICBpZiAodGhpcy50aGVtZSA9PT0gJ3ZpZXdGbG93Q2hhcnQnKSB7XHJcbiAgICAgIHRoaXMudmlld0Zsb3dDaGFydEJ5UHJvY0luc3RJZCgpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5wcm9jZXNzRm9yZWNhc3QoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgdmlld1BhcmVudChzdXBlclByb2NJbnN0SWQ6IHN0cmluZykge1xyXG4gICAgLy8gdGhpcy5wcm9jSW5zdElkID0gc3VwZXJQcm9jSW5zdElkO1xyXG4gICAgLy8gdGhpcy52aWV3Rmxvd0NoYXJ0QnlQcm9jSW5zdElkKCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHZpZXdDaGlsZChzdXBlckFjdEluc3RJZDogc3RyaW5nLCBzdXBlclByb2NJbnN0SWQ6IHN0cmluZykge1xyXG4gICAgdGhpcy5zZXJ2aWNlLmdldFN1YlByb2Nlc3NJbnN0YW5jZShzdXBlckFjdEluc3RJZCwgc3VwZXJQcm9jSW5zdElkKVxyXG4gICAgICAuc3Vic2NyaWJlKHJlID0+IHtcclxuICAgICAgICBpZiAodGhpcy5jaGFydFNlcnZpY2UpIHtcclxuICAgICAgICAgIHRoaXMuY2hhcnRTZXJ2aWNlLnZpZXdGbG93Q2hhcnRCeURpYWxvZyhyZS5pZCwgdGhpcy5tb2RlKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgdGhyb3cgRXJyb3IoJ+ivt+WNh+e6p+afpeeci+a1geeoi+WFrOWFseWMheWunueOsOiBlOafpeWtkOa1geeoi+WbvuWKn+iDvScpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgfVxyXG5cclxuICBtb2RlU3dpdGNoKCkge1xyXG4gICAgaWYgKHRoaXMubW9kZSA9PT0gJ2NvbXBsZXRlJykge1xyXG4gICAgICB0aGlzLm1vZGUgPSAnc2ltdWxhdGlvbic7XHJcbiAgICAgIHRoaXMuaWZGb3JlY2FzdCA9ICd0cnVlJztcclxuICAgICAgdGhpcy5tb2RlQnV0dG9uID0gdGhpcy5zZXJ2aWNlLmdldEkxOG5WYWx1ZSgnc3RhdGljLmZsb3djaGFydC5jb21wbGV0ZScpO1xyXG4gICAgICB0aGlzLnNlcnZpY2UuZ2V0Rm9yZWNhc3RQcm9jZXNzQnlQcm9jSW5zdElkKHRoaXMucHJvY0luc3RJZCkuc3Vic2NyaWJlKHIgPT4ge1xyXG4gICAgICAgIHRoaXMuYWN0SW5zdExpc3QgPSByLmFjdGl2aXR5SW5zdGFuY2VTbGltcztcclxuICAgICAgICB0aGlzLnRyYW5zSW5zTGlzdCA9IHIudHJhbnNpdGlvbkluc3RhbmNlU2xpbXM7XHJcbiAgICAgICAgdGhpcy5wb3N0TWVzc2FnZSgnbW9kZVN3aXRjaCcsIHtcclxuICAgICAgICAgIG1vZGU6ICdzaW11bGF0aW9uJyxcclxuICAgICAgICAgIGFjdGlJbnN0TGlzdDogci5hY3Rpdml0eUluc3RhbmNlU2xpbXMsXHJcbiAgICAgICAgICB0cmFuc0luc0xpc3Q6IHIudHJhbnNpdGlvbkluc3RhbmNlU2xpbXNcclxuICAgICAgICB9KTtcclxuICAgICAgfSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLm1vZGUgPSAnY29tcGxldGUnO1xyXG4gICAgICB0aGlzLmlmRm9yZWNhc3QgPSAnZmFsc2UnO1xyXG4gICAgICB0aGlzLm1vZGVCdXR0b24gPSB0aGlzLnNlcnZpY2UuZ2V0STE4blZhbHVlKCdzdGF0aWMuZmxvd2NoYXJ0LnNpbXVsYXRpb24nKTtcclxuICAgICAgdGhpcy5zZXJ2aWNlLmdldENvbXBsZXRlUHJvY2Vzc0luZm9CeVByb2NJbnN0SWQodGhpcy5wcm9jSW5zdElkKS5zdWJzY3JpYmUociA9PiB7XHJcbiAgICAgICAgdGhpcy5hY3RJbnN0TGlzdCA9IHIuYWN0aXZpdHlJbnN0YW5jZVNsaW1zO1xyXG4gICAgICAgIHRoaXMudHJhbnNJbnNMaXN0ID0gci50cmFuc2l0aW9uSW5zdGFuY2VTbGltcztcclxuICAgICAgICB0aGlzLnBvc3RNZXNzYWdlKCdtb2RlU3dpdGNoJywge1xyXG4gICAgICAgICAgbW9kZTogJ2NvbXBsZXRlJyxcclxuICAgICAgICAgIGFjdGlJbnN0TGlzdDogci5hY3Rpdml0eUluc3RhbmNlU2xpbXMsXHJcbiAgICAgICAgICB0cmFuc0luc0xpc3Q6IHIudHJhbnNpdGlvbkluc3RhbmNlU2xpbXNcclxuICAgICAgICB9KTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHZpZXdMb2dzKGRhdGE6IGFueSkge1xyXG4gICAgdGhpcy50eXBlID0gZGF0YS50eXBlO1xyXG4gICAgdGhpcy5hY3REZWZJZCA9IGRhdGEuYWN0aURlZklkO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSB2aWV3Rmxvd0NoYXJ0QnlQcm9jSW5zdElkKCkge1xyXG4gICAgdGhpcy5jb250ZW50ID0gJyc7XHJcbiAgICBpZiAodGhpcy5wcm9jSW5zdElkKSB7XHJcbiAgICAgIGlmICh0aGlzLm1vZGUgPT09ICdjb21wbGV0ZScpIHtcclxuICAgICAgICBmb3JrSm9pbihcclxuICAgICAgICAgIHRoaXMuc2VydmljZS5nZXRQcm9jSW5zdGFuY2VCeUlkKHRoaXMucHJvY0luc3RJZCksXHJcbiAgICAgICAgICB0aGlzLnNlcnZpY2UuZ2V0QnBtbk1vZGVsYnlQcm9jSW5zdElkKHRoaXMucHJvY0luc3RJZCksXHJcbiAgICAgICAgICB0aGlzLnNlcnZpY2UuZ2V0Q29tcGxldGVQcm9jZXNzSW5mb0J5UHJvY0luc3RJZCh0aGlzLnByb2NJbnN0SWQpKVxyXG4gICAgICAgICAgLnN1YnNjcmliZSgoZGF0YTogYW55W10pID0+IHtcclxuICAgICAgICAgICAgdGhpcy5wcm9jZXNzSW5zdGFuY2UgPSBkYXRhWzBdO1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRlbnQgPSBKU09OLnN0cmluZ2lmeShkYXRhWzFdKTtcclxuICAgICAgICAgICAgdGhpcy5hY3RJbnN0TGlzdCA9IGRhdGFbMl0uYWN0aXZpdHlJbnN0YW5jZVNsaW1zO1xyXG4gICAgICAgICAgICB0aGlzLnRyYW5zSW5zTGlzdCA9IGRhdGFbMl0udHJhbnNpdGlvbkluc3RhbmNlU2xpbXM7XHJcbiAgICAgICAgICAgIHRoaXMubG9hZEZsb3dDaGFydCgpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgZm9ya0pvaW4oXHJcbiAgICAgICAgICB0aGlzLnNlcnZpY2UuZ2V0UHJvY0luc3RhbmNlQnlJZCh0aGlzLnByb2NJbnN0SWQpLFxyXG4gICAgICAgICAgdGhpcy5zZXJ2aWNlLmdldEJwbW5Nb2RlbGJ5UHJvY0luc3RJZCh0aGlzLnByb2NJbnN0SWQpLFxyXG4gICAgICAgICAgdGhpcy5zZXJ2aWNlLmdldEZvcmVjYXN0UHJvY2Vzc0J5UHJvY0luc3RJZCh0aGlzLnByb2NJbnN0SWQpKVxyXG4gICAgICAgICAgLnN1YnNjcmliZSgoZGF0YTogYW55W10pID0+IHtcclxuICAgICAgICAgICAgdGhpcy5wcm9jZXNzSW5zdGFuY2UgPSBkYXRhWzBdO1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRlbnQgPSBKU09OLnN0cmluZ2lmeShkYXRhWzFdKTtcclxuICAgICAgICAgICAgdGhpcy5hY3RJbnN0TGlzdCA9IGRhdGFbMl0uYWN0aXZpdHlJbnN0YW5jZVNsaW1zO1xyXG4gICAgICAgICAgICB0aGlzLnRyYW5zSW5zTGlzdCA9IGRhdGFbMl0udHJhbnNpdGlvbkluc3RhbmNlU2xpbXM7XHJcbiAgICAgICAgICAgIHRoaXMubG9hZEZsb3dDaGFydCgpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgcHJvY2Vzc0ZvcmVjYXN0KCkge1xyXG4gICAgdGhpcy5jb250ZW50ID0gJyc7XHJcbiAgICB0aGlzLm1vZGUgPSAnc2ltdWxhdGlvbic7XHJcbiAgICAvLyB0aGlzLmlmRm9yZWNhc3QgPSB0cnVlO1xyXG4gICAgaWYgKHRoaXMucHJvY2Vzc0ZvcmVjYXN0UGF5bG9hZC5wcm9jZXNzRGVmaW5pdGlvbklkICYmIHRoaXMucHJvY2Vzc0ZvcmVjYXN0UGF5bG9hZC5kYXRhSWQpIHtcclxuICAgICAgZm9ya0pvaW4oXHJcbiAgICAgICAgdGhpcy5zZXJ2aWNlLmdldEJwbW5Nb2RlbGJ5UHJvY0RlZklkKHRoaXMucHJvY2Vzc0ZvcmVjYXN0UGF5bG9hZC5wcm9jZXNzRGVmaW5pdGlvbklkKSxcclxuICAgICAgICB0aGlzLnNlcnZpY2UuZ2V0Rm9yZWNhc3RQcm9jZXNzQnlQYXlsb2FkKHRoaXMucHJvY2Vzc0ZvcmVjYXN0UGF5bG9hZCkpXHJcbiAgICAgICAgLnN1YnNjcmliZSgoZGF0YTogYW55W10pID0+IHtcclxuICAgICAgICAgIHRoaXMuY29udGVudCA9IEpTT04uc3RyaW5naWZ5KGRhdGFbMF0pO1xyXG4gICAgICAgICAgdGhpcy5hY3RJbnN0TGlzdCA9IGRhdGFbMV0uYWN0aXZpdHlJbnN0YW5jZVNsaW1zO1xyXG4gICAgICAgICAgdGhpcy50cmFuc0luc0xpc3QgPSBkYXRhWzFdLnRyYW5zaXRpb25JbnN0YW5jZVNsaW1zO1xyXG4gICAgICAgICAgdGhpcy5sb2FkRmxvd0NoYXJ0KCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHZpZXdGb3JtKHByb2NJbnN0SWQ6IHN0cmluZywgYWN0SW5zdElkOiBzdHJpbmcsIGJpekluc3RJZDogc3RyaW5nKSB7XHJcbiAgICBpZiAocHJvY0luc3RJZCkge1xyXG4gICAgICB0aGlzLnNlcnZpY2UuZ2V0Rm9ybUluZm9CeUFjdEluc3RJZChwcm9jSW5zdElkLCBhY3RJbnN0SWQpLnN1YnNjcmliZSgocmU6IGFueSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGZvcm1JbmZvID0gcmU7XHJcbiAgICAgICAgaWYgKCFmb3JtSW5mbyB8fCAhZm9ybUluZm8uYXBwSWQpIHtcclxuICAgICAgICAgIGlmICh0aGlzLm1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgdGhpcy5tZXNzYWdlLmluZm8oJ+aJvuS4jeWIsOWNleaNru+8jOivt+iBlOezu+euoeeQhuWRmOafpeeci+WOn+WboO+8gScpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBvcHRpb25zOiBBcHBPcHRpb25zID0ge1xyXG4gICAgICAgICAgYXBwVHlwZTogJ21lbnUnLFxyXG4gICAgICAgICAgZnVuY0lkOiBmb3JtSW5mby5hcHBJZCxcclxuICAgICAgICAgIGFwcElkOiAnJyxcclxuICAgICAgICAgIGFwcEVudHJhbmNlOiAnJyxcclxuICAgICAgICAgIHRhYklkOiBiaXpJbnN0SWQsXHJcbiAgICAgICAgICBpc05ld1RhYjogdHJ1ZVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgLy8g5Lyg5bel5L2c5rWB5LiK5LiL5paH5Y+C5pWwXHJcbiAgICAgICAgY29uc3QgcGFyYW1ldGVycyA9IG5ldyBNYXA8c3RyaW5nLCBhbnk+KCk7XHJcbiAgICAgICAgcGFyYW1ldGVycy5zZXQoJ3Byb2NJbnN0SWQnLCBwcm9jSW5zdElkKTtcclxuICAgICAgICBwYXJhbWV0ZXJzLnNldCgnYWN0SW5zdElkJywgYWN0SW5zdElkKTtcclxuICAgICAgICBmb3JtSW5mby5wYXJhbWV0ZXJzLmZvckVhY2goKGl0ZW06IGFueSkgPT5cclxuICAgICAgICAgIHBhcmFtZXRlcnMuc2V0KGl0ZW0uY29kZSwgaXRlbS52YWx1ZSlcclxuICAgICAgICApO1xyXG4gICAgICAgIG9wdGlvbnMucXVlcnlTdHJpbmdQYXJhbXMgPSBwYXJhbWV0ZXJzO1xyXG4gICAgICAgIGlmICh0aGlzLmZyYW1ld29ya1N2Yykge1xyXG4gICAgICAgICAgdGhpcy5mcmFtZXdvcmtTdmMub3Blbk1lbnUob3B0aW9ucyk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRocm93IEVycm9yKCfmoYbmnrbmnI3liqHkuI3lrZjlnKjvvIHml6Dms5XogZTmn6XvvIEnKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSByZXRyeUFpZkNyZWF0aW9uKHByb2NJbnN0SWQ6IHN0cmluZywgYWN0SW5zdElkOiBzdHJpbmcsIGJpekluc3RJZDogc3RyaW5nKSB7XHJcbiAgICBpZiAocHJvY0luc3RJZCkge1xyXG4gICAgICB0aGlzLnNlcnZpY2UucmV0cnlBaWZDcmVhdGlvbihwcm9jSW5zdElkLCBhY3RJbnN0SWQsIGJpekluc3RJZCkuc3Vic2NyaWJlKFxyXG4gICAgICAgIChyZTogYW55KSA9PiB7XHJcbiAgICAgICAgICB0aGlzLnZpZXdGbG93Q2hhcnQoKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIChlcnIpID0+IHtcclxuICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAvL3RvZG8g56Gu5a6a5byC5bi457uT5p6ELCDnm67liY3ph4fnlKjlhbzlrrnlj5blgLzmlrnlvI9cclxuICAgICAgICAgICAgdGhpcy5tZXNzYWdlLmVycm9yKGVyci5lcnJvciA9PSBudWxsID8gZXJyLm1lc3NhZ2UgOiAoZXJyLmVycm9yLk1lc3NhZ2UgfHwgZXJyLmVycm9yLm1lc3NhZ2UgfHwgZXJyLm1lc3NhZ2UpKTtcclxuICAgICAgICAgIH0sIDMwMCk7XHJcbiAgICAgICAgICB0aHJvdyBlcnI7XHJcbiAgICAgICAgfVxyXG4gICAgICApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIGxvYWRGbG93Q2hhcnQoKSB7XHJcbiAgICBpZiAodGhpcy5jb250ZW50KSB7XHJcbiAgICAgIHRoaXMucG9zdE1lc3NhZ2UoJ2xvYWQnLCB7XHJcbiAgICAgICAgcHJvY2Vzc0luc3RhbmNlOiB0aGlzLnByb2Nlc3NJbnN0YW5jZSxcclxuICAgICAgICBjb250ZW50OiB0aGlzLmNvbnRlbnQsXHJcbiAgICAgICAgYWN0aUluc3RMaXN0OiB0aGlzLmFjdEluc3RMaXN0LFxyXG4gICAgICAgIHRyYW5zSW5zTGlzdDogdGhpcy50cmFuc0luc0xpc3QsXHJcbiAgICAgICAgbW9kZTogdGhpcy5tb2RlXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcG9zdE1lc3NhZ2UoYWN0aW9uOiBzdHJpbmcsIGRhdGE6IGFueSkge1xyXG4gICAgY29uc3QgbWVzc2FnZSA9IHsgYWN0aW9uLCBkYXRhIH07XHJcbiAgICB0aGlzLmlmcmFtZS5uYXRpdmVFbGVtZW50LmNvbnRlbnRXaW5kb3cucG9zdE1lc3NhZ2UobWVzc2FnZSwgdGhpcy5mY0h0bWwpO1xyXG4gIH1cclxuXHJcbiAgZmlsbCgpIHtcclxuICAgIHRoaXMuY2xzID0gJ2QtZmxleCBmbGV4LWZpbGwgaC0xMDAgZi11dGlscy1hYnNvbHV0ZS1hbGwnO1xyXG4gIH1cclxuXHJcbn1cclxuIl19