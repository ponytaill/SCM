/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/services/bill-tracker-data-info.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from "@angular/core";
import { BpmnModelJsonHelper, DataType } from "@edp-aif/common-api";
import { BillTrackingDataShownMode, BillTrackingSettings, fullPathPrefix } from "@edp-bif/common-api";
export class BillTrackerDataInfoService {
    /**
     * 判断BillTrackingSettings是旧版还是新版
     * @param {?} bts
     * @return {?}
     */
    isNewBTS(bts) {
        if (typeof bts == "string") {
            /** @type {?} */
            const temp = new BillTrackingSettings();
            temp.LoadFromJson(bts);
            bts = temp;
        }
        return bts != null && bts.version === "1.0";
    }
    /**
     * @param {?} rows
     * @param {?} shownFields
     * @param {?} wholeFields
     * @param {?} idField
     * @return {?}
     */
    extractDataRows(rows, shownFields, wholeFields, idField) {
        /** @type {?} */
        let frows = [];
        for (let row of rows) {
            /** @type {?} */
            let obj = {};
            obj[idField] = row.dataId;
            // 先解析其他类型字段
            /** @type {?} */
            const decimalFFs = [];
            shownFields.forEach((/**
             * @param {?} f
             * @return {?}
             */
            f => {
                if (f.dataType == DataType.Decimal) {
                    decimalFFs.push(f);
                }
                else {
                    obj[f.fieldPath] = this.getFieldValue(f, row.GetFieldMap(), wholeFields);
                }
            }));
            // 再解析浮点型字段
            decimalFFs.forEach((/**
             * @param {?} f
             * @return {?}
             */
            f => {
                obj[f.fieldPath] = this.getFieldValue(f, row.GetFieldMap(), wholeFields);
            }));
            frows.push(obj);
        }
        return frows;
    }
    /**
     * @param {?} field
     * @return {?}
     */
    extractCaptionPath(field) {
        /** @type {?} */
        let s = field.caption;
        /** @type {?} */
        let tmp = (/** @type {?} */ (field));
        while (tmp.attachedField != null) {
            s = tmp.attachedField.caption + "." + s;
            tmp = (/** @type {?} */ (tmp.attachedField));
        }
        return s;
    }
    /**
     * @param {?} field
     * @return {?}
     */
    extractFieldPath(field) {
        /** @type {?} */
        let s = field.fieldName;
        /** @type {?} */
        let tmp = (/** @type {?} */ (field));
        while (tmp.attachedField != null) {
            s = tmp.attachedField.fieldName + "." + s;
            tmp = (/** @type {?} */ (tmp.attachedField));
        }
        return s;
    }
    /**
     *
     * @param {?} fields 子字段列表
     * @param {?} selectedFields 用户自定义展示字段列表
     * @param {?} showCustomFields 是否按用户自定义字段显示
     * @return {?}
     */
    extractFFields(fields, selectedFields, showCustomFields) {
        /** @type {?} */
        let ffields = [];
        fields.forEach((/**
         * @param {?} f
         * @return {?}
         */
        f => {
            f.show = true;
            //枚举或者枚举型单值UDT时默认取Name
            if (f.fieldType == "Enum" || f.fieldType == "EnumSingleUdt") {
                /** @type {?} */
                const tempFPath = this.extractFieldPath(f);
                /** @type {?} */
                let sf = null;
                if (showCustomFields) {
                    // 如果字段不在已配置字段列表中则跳过
                    sf = selectedFields.find((/**
                     * @param {?} sfield
                     * @return {?}
                     */
                    (sfield) => sfield.fieldPath == tempFPath));
                    if (sf == null) {
                        f.show = false;
                    }
                }
                f = (/** @type {?} */ (this.setExtendProps(f, sf, tempFPath + ".Name")));
                ffields.push(f);
            }
            else if (f.GetSubFieldList() != null && f.GetSubFieldList().length > 0) {
                ffields.push(...this.extractFFields(f.GetSubFieldList(), selectedFields, showCustomFields));
            }
            else {
                /** @type {?} */
                const tempFPath = this.extractFieldPath(f);
                /** @type {?} */
                let sf = null;
                if (showCustomFields) {
                    // 如果字段不在已配置字段列表中则跳过
                    sf = selectedFields.find((/**
                     * @param {?} sfield
                     * @return {?}
                     */
                    (sfield) => sfield.fieldPath == tempFPath));
                    if (sf == null) {
                        f.show = false;
                    }
                }
                f = (/** @type {?} */ (this.setExtendProps(f, sf, tempFPath)));
                ffields.push(f);
            }
        }));
        return ffields;
    }
    /**
     * 判定有子数据的条件为：子表可显示，且子表有数据
     * @param {?} row
     * @param {?} billInfo
     * @return {?}
     */
    hasChildData(row, billInfo) {
        /** @type {?} */
        let hasChildData = false;
        /** @type {?} */
        const schema = this.getBillTrackerSchema(billInfo);
        /** @type {?} */
        let children = row.GetChildTableList();
        for (let c of children) {
            /** @type {?} */
            let tableShow = false;
            /** @type {?} */
            let hasRows = false;
            /** @type {?} */
            let table = schema && schema[c.tableName];
            if (table != null && table.show != null) {
                tableShow = table.show;
            }
            else {
                // 兼容无show属性情形
                tableShow = true;
            }
            if (c.GetRowList() && c.GetRowList().length > 0) {
                hasRows = true;
            }
            hasChildData = tableShow && hasRows;
            if (hasChildData == true) {
                break;
            }
        }
        return hasChildData;
    }
    /**
     * @param {?} f
     * @param {?} rdfm
     * @param {?=} wholeFields
     * @return {?}
     */
    getFieldValue(f, rdfm, wholeFields) {
        /** @type {?} */
        let fields = f.fieldPath ? f.fieldPath.split(".") : [f.fieldName];
        /** @type {?} */
        let bdf = fields && rdfm[fields[0]];
        for (let i = 1; bdf != null && i < fields.length; i++) {
            /** @type {?} */
            const temp = bdf.GetSubFieldMap();
            if (temp == null) {
                break;
            }
            bdf = temp[fields[i]];
        }
        /** @type {?} */
        const textValue = bdf ? bdf.GetTextValue() : "";
        if (textValue == null) {
            return null;
        }
        if (f.dataType == DataType.String) {
            if (f.formatInfo != null) {
                /** @type {?} */
                const stringMapFormatter = f.formatInfo.stringMapFormatter;
                if (stringMapFormatter != null) {
                    /** @type {?} */
                    const v = stringMapFormatter[textValue] || textValue;
                    f.fieldValue = v;
                    return v;
                }
                else {
                    f.fieldValue = textValue;
                    return textValue || "";
                }
            }
            else {
                f.fieldValue = textValue;
                return textValue || "";
            }
        }
        else if (f.dataType == DataType.Decimal) {
            /** @type {?} */
            let scale = f.scale;
            if (f.formatInfo != null) {
                if (f.formatInfo.scale != null) {
                    scale = f.formatInfo.scale;
                }
                if (f.formatInfo.enableScaleExpression) {
                    if (f.formatInfo.scaleExpression != null) {
                        /** @type {?} */
                        const scaleField = this.getFieldInFields(wholeFields, f.formatInfo.scaleExpression);
                        /** @type {?} */
                        const tmp = scaleField && parseInt(String(this.getFieldValue(scaleField, rdfm)));
                        // const tmp = parseInt(this.getFieldValueInFieldsWithValue(extactedFields, f.formatInfo.scaleExpression));
                        if (tmp != null && !isNaN(tmp)) {
                            scale = tmp;
                        }
                    }
                }
            }
            f.fieldValue = parseFloat(String(textValue));
            /** @type {?} */
            let dec = parseFloat(String(textValue)).toFixed(scale).toString();
            return dec || "";
        }
        else if (f.dataType == DataType.Boolean) {
            if (textValue == "") {
                f.fieldValue = null;
                return textValue;
            }
            f.fieldValue = (/** @type {?} */ (JSON.parse(textValue)));
            return (/** @type {?} */ (JSON.parse(textValue)));
        }
        else if (f.dataType == DataType.DateTime) {
            /** @type {?} */
            let date = BpmnModelJsonHelper.DateTimeFromString(textValue);
            /** @type {?} */
            let formatter = "yyyy-MM-dd";
            if (f.fieldType == "DateTime") {
                formatter = f.formatInfo && f.formatInfo.dateFormatter || "yyyy-MM-dd HH:mm:ss.SSS";
            }
            else if (f.fieldType == "Date") {
                formatter = f.formatInfo && f.formatInfo.dateFormatter || "yyyy-MM-dd";
            }
            else {
                formatter = f.formatInfo && f.formatInfo.dateFormatter || "yyyy-MM-dd";
            }
            f.fieldValue = date;
            return this.dateFormat(date, formatter);
        }
        else {
            f.fieldValue = textValue;
            return textValue || "";
        }
    }
    /**
     * @param {?} fields
     * @param {?} fullPath
     * @return {?}
     */
    getFieldInFields(fields, fullPath) {
        /** @type {?} */
        let v = null;
        for (let fv of fields) {
            while (fv.attachedField) {
                fv = fv.attachedField;
            }
            /** @type {?} */
            const rootFv = (/** @type {?} */ (fv));
            rootFv.fullPath = fullPathPrefix + rootFv.attachedTable.tableName + "." + rootFv.fieldPath;
            if (fullPath == rootFv.fullPath) {
                v = rootFv;
                break;
            }
        }
        return v;
    }
    /**
     * @param {?} fieldsWithValue
     * @param {?} fullPath
     * @return {?}
     */
    getFieldValueInFieldsWithValue(fieldsWithValue, fullPath) {
        /** @type {?} */
        let v = null;
        for (let fv of fieldsWithValue) {
            while (fv.attachedField) {
                fv = fv.attachedField;
            }
            /** @type {?} */
            const rootFv = (/** @type {?} */ (fv));
            rootFv.fullPath = fullPathPrefix + rootFv.attachedTable.tableName + "." + rootFv.fieldPath;
            if (fullPath == rootFv.fullPath) {
                v = rootFv.fieldValue;
                break;
            }
        }
        return v;
    }
    /**
     * @param {?} billInfo
     * @param {?} schemaTable
     * @param {?} dataTable
     * @param {?=} filterFields
     * @return {?}
     */
    getBasicInfoFieldsWithValue(billInfo, schemaTable, dataTable, filterFields = true) {
        /** @type {?} */
        const fieldsWithValue = [];
        // 单据追踪配置
        /** @type {?} */
        let bts = new BillTrackingSettings();
        if (billInfo && billInfo.billTrackingSettings) {
            bts.LoadFromJson(billInfo.billTrackingSettings);
        }
        /** @type {?} */
        const schema = this.getBillTrackerSchema(billInfo);
        /** @type {?} */
        let selectedFields = schema && schema[schemaTable.tableName] && schema[schemaTable.tableName].fields;
        selectedFields = selectedFields ? selectedFields : [];
        /** @type {?} */
        let showCustomFields = bts.billTrackingDataShownMode === BillTrackingDataShownMode.CUSTOMFIELD;
        // 所有字段
        /** @type {?} */
        const fs = schemaTable.getFieldList();
        /** @type {?} */
        const r = dataTable.GetRowList()[0];
        // 主表字段
        /** @type {?} */
        const rdfm = r.GetFieldMap();
        // 提取展示字段
        /** @type {?} */
        const ffs = this.extractFFields(fs, selectedFields, showCustomFields);
        // 获取字段值
        // 先解析其他类型字段
        /** @type {?} */
        const decimalFfs = [];
        ffs.forEach((/**
         * @param {?} ff
         * @return {?}
         */
        ff => {
            if (ff.dataType == DataType.Decimal) {
                decimalFfs.push(ff);
            }
            else {
                ff.fieldValue = this.getFieldValue(ff, rdfm);
            }
        }));
        // 再解析浮点数字段
        decimalFfs.forEach((/**
         * @param {?} ff
         * @return {?}
         */
        ff => {
            ff.fieldValue = this.getFieldValue(ff, rdfm, fs);
        }));
        fieldsWithValue.push(...ffs);
        return fieldsWithValue;
    }
    /**
     * @param {?} f
     * @param {?} sf
     * @param {?} fieldPath
     * @param {?=} rdfm
     * @return {?}
     */
    setExtendProps(f, sf, fieldPath, rdfm) {
        f.captionPath = this.extractCaptionPath(f);
        f.fieldPath = fieldPath;
        if (sf) {
            f.displayName = sf.displayName;
            f.i18nCols = sf.i18nCols;
            f.formatInfo = sf.formatInfo;
            f.order = sf.order;
        }
        if (rdfm) {
            f.fieldValue = this.getFieldValue(f, rdfm);
        }
        return f;
    }
    /**
     * 字段列表按order属性排序
     * @param {?} fieldsWithValue
     * @return {?}
     */
    sortFieldsByOrder(fieldsWithValue) {
        return fieldsWithValue.sort((/**
         * @param {?} a
         * @param {?} b
         * @return {?}
         */
        (a, b) => {
            if (a.order != null && b.order != null) {
                return a.order - b.order;
            }
            else if (a.order != null && b.order == null) {
                return -1;
            }
            else if (a.order == null && b.order != null) {
                return 1;
            }
            else {
                return 0;
            }
        }));
    }
    /**
     * @param {?} date
     * @param {?} fmt
     * @return {?}
     */
    dateFormat(date, fmt) {
        /** @type {?} */
        let ret;
        /** @type {?} */
        const opt = {
            "y+": date.getUTCFullYear().toString(),
            // 年
            "M+": (date.getUTCMonth() + 1).toString(),
            // 月
            "d+": date.getUTCDate().toString(),
            // 日
            "H+": date.getUTCHours().toString(),
            // 时
            "m+": date.getUTCMinutes().toString(),
            // 分
            "s+": date.getUTCSeconds().toString(),
            // 秒
            "S+": date.getUTCMilliseconds().toString(),
        };
        for (let k in opt) {
            ret = new RegExp("(" + k + ")").exec(fmt);
            if (ret) {
                if (!String.prototype.padStart) {
                    fmt = fmt.replace(ret[1], (ret[1].length == 1) ? (opt[k]) : (this.myPadStart(opt[k], ret[1].length, "0")));
                }
                else {
                    fmt = fmt.replace(ret[1], (ret[1].length == 1) ? (opt[k]) : (opt[k].padStart(ret[1].length, "0")));
                }
            }
        }
        return fmt;
    }
    /**
     * @param {?} src
     * @param {?} targetLength
     * @param {?} padString
     * @return {?}
     */
    myPadStart(src, targetLength, padString) {
        targetLength = targetLength >> 0; //floor if number or convert non-number to 0;
        padString = String(typeof padString !== 'undefined' ? padString : ' ');
        if (src.length > targetLength) {
            return String(src);
        }
        else {
            targetLength = targetLength - src.length;
            if (targetLength > padString.length) {
                padString += padString.repeat(targetLength / padString.length); //append to original to ensure we are longer than needed
            }
            return padString.slice(0, targetLength) + String(src);
        }
    }
    /**
     * 解析字段名称
     * @param {?} f
     * @param {?=} langCode
     * @return {?}
     */
    getFieldLabel(f, langCode) {
        return (langCode && f.i18nCols && f.i18nCols.colI18nValues.displayName &&
            f.i18nCols.colI18nValues.displayName[langCode]) || f.displayName || f.captionPath || f.caption;
    }
    /**
     * 解析表名称
     * @param {?} billInfo
     * @param {?} schemaTable
     * @param {?=} langCode
     * @return {?}
     */
    getTableLabel(billInfo, schemaTable, langCode) {
        /** @type {?} */
        const schema = this.getBillTrackerSchema(billInfo);
        /** @type {?} */
        let table = schema && schema[schemaTable.tableName];
        if (table != null) {
            /** @type {?} */
            const i18nCols = table.i18nCols;
            /** @type {?} */
            const tmp = (langCode && i18nCols && i18nCols.colI18nValues.displayName && i18nCols.colI18nValues.displayName[langCode]) || table.displayName || table.caption || table.code;
            return tmp;
        }
        else {
            return schemaTable.caption;
        }
    }
    /**
     * 获取解析可展示子表
     * @param {?} billInfo
     * @param {?} schemaTable
     * @return {?}
     */
    getChildTables(billInfo, schemaTable) {
        /** @type {?} */
        let result = [];
        /** @type {?} */
        const schema = this.getBillTrackerSchema(billInfo);
        /** @type {?} */
        const children = schemaTable.GetChildTableList();
        children && children.forEach((/**
         * @param {?} child
         * @return {?}
         */
        (child) => {
            /** @type {?} */
            let trackerTable = schema && schema[child.tableName];
            if (trackerTable != null && trackerTable.show != null) {
                if (trackerTable.show == true) {
                    child.order = trackerTable.order;
                    result.push(child);
                }
            }
            else {
                // 兼容无show属性情形
                result.push(child);
            }
        }));
        result = this.sortTablesByOrder(result);
        return result;
    }
    /**
     * 表按sort字段排序
     * @param {?} schemaTables
     * @return {?}
     */
    sortTablesByOrder(schemaTables) {
        return schemaTables.sort((/**
         * @param {?} a
         * @param {?} b
         * @return {?}
         */
        (a, b) => {
            if (a.order != null && b.order != null) {
                return a.order - b.order;
            }
            else if (a.order != null && b.order == null) {
                return -1;
            }
            else if (a.order == null && b.order != null) {
                return 1;
            }
            else {
                return 0;
            }
        }));
    }
    /**
     * 解析billTrackerSchema
     * @param {?} billInfo
     * @return {?}
     */
    getBillTrackerSchema(billInfo) {
        /** @type {?} */
        let bts = new BillTrackingSettings();
        if (billInfo && billInfo.billTrackingSettings) {
            bts.LoadFromJson(billInfo.billTrackingSettings);
        }
        /** @type {?} */
        let fieldContent = bts.customFieldContent;
        /** @type {?} */
        let fieldConfig = fieldContent && (typeof fieldContent == "object" ? fieldContent : JSON.parse(fieldContent));
        /** @type {?} */
        let schema = fieldConfig && fieldConfig.schema;
        return schema;
    }
}
BillTrackerDataInfoService.decorators = [
    { type: Injectable }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmlsbC10cmFja2VyLWRhdGEtaW5mby5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGVkcC1iaWYvcnVudGltZS1hcGkvIiwic291cmNlcyI6WyJsaWIvYmlsbC10cmFja2VyL3NlcnZpY2VzL2JpbGwtdHJhY2tlci1kYXRhLWluZm8uc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUEwSSxtQkFBbUIsRUFBRSxRQUFRLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUM1TSxPQUFPLEVBQW9ELHlCQUF5QixFQUFFLG9CQUFvQixFQUFFLGNBQWMsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBSXhKLE1BQU0sT0FBTywwQkFBMEI7Ozs7OztJQU01QixRQUFRLENBQUMsR0FBa0M7UUFDOUMsSUFBSSxPQUFPLEdBQUcsSUFBSSxRQUFRLEVBQUU7O2tCQUNsQixJQUFJLEdBQUcsSUFBSSxvQkFBb0IsRUFBRTtZQUN2QyxJQUFJLENBQUMsWUFBWSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ3ZCLEdBQUcsR0FBRyxJQUFJLENBQUM7U0FDZDtRQUVELE9BQU8sR0FBRyxJQUFJLElBQUksSUFBSSxHQUFHLENBQUMsT0FBTyxLQUFLLEtBQUssQ0FBQztJQUNoRCxDQUFDOzs7Ozs7OztJQUVNLGVBQWUsQ0FBQyxJQUFtQixFQUFFLFdBQWtDLEVBQUUsV0FBa0MsRUFBRSxPQUFlOztZQUMzSCxLQUFLLEdBQUcsRUFBRTtRQUNkLEtBQUssSUFBSSxHQUFHLElBQUksSUFBSSxFQUFFOztnQkFDZCxHQUFHLEdBQUcsRUFBRTtZQUNaLEdBQUcsQ0FBQyxPQUFPLENBQUMsR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDOzs7a0JBRXBCLFVBQVUsR0FBRyxFQUFFO1lBQ3JCLFdBQVcsQ0FBQyxPQUFPOzs7O1lBQUMsQ0FBQyxDQUFDLEVBQUU7Z0JBQ3BCLElBQUksQ0FB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SUFDTixDQUFDOzs7Ozs7SUFLTSxvQkFBb0IsQ0FBQyxRQUFrQjs7WUFDdEMsR0FBRyxHQUF5QixJQUFJLG9CQUFvQixFQUFFO1FBQzFELElBQUksUUFBUSxJQUFJLFFBQVEsQ0FBQyxvQkFBb0IsRUFBRTtZQUMzQyxHQUFHLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO1NBQ25EOztZQUVHLFlBQVksR0FBRyxHQUFHLENBQUMsa0JBQWtCOztZQUNyQyxXQUFXLEdBQWtDLFlBQVksSUFBSSxDQUFDLE9BQU8sWUFBWSxJQUFJLFFBQVEsQ0FBQyxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFlBQVksQ0FBQyxDQUFDOztZQUN4SSxNQUFNLEdBQUcsV0FBVyxJQUFJLFdBQVcsQ0FBQyxNQUFNO1FBRTlDLE9BQU8sTUFBTSxDQUFDO0lBQ2xCLENBQUM7OztZQWhjSixVQUFVIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XHJcbmltcG9ydCB7IEJpbGxEYXRhRmllbGQsIEJpbGxEYXRhUm93LCBCaWxsRGF0YVN1YkZpZWxkLCBCaWxsRGF0YVRhYmxlLCBCaWxsU2NoZW1hRmllbGQsIEJpbGxTY2hlbWFGaWVsZEJhc2UsIEJpbGxTY2hlbWFTdWJGaWVsZCwgQmlsbFNjaGVtYVRhYmxlLCBCcG1uTW9kZWxKc29uSGVscGVyLCBEYXRhVHlwZSB9IGZyb20gXCJAZWRwLWFpZi9jb21tb24tYXBpXCI7XHJcbmltcG9ydCB7IEJpbGxUcmFja2VyU2NoZW1hLCBCaWxsVHJhY2tlclNjaGVtYUZpZWxkQ29udGVudCwgQmlsbFRyYWNraW5nRGF0YVNob3duTW9kZSwgQmlsbFRyYWNraW5nU2V0dGluZ3MsIGZ1bGxQYXRoUHJlZml4IH0gZnJvbSBcIkBlZHAtYmlmL2NvbW1vbi1hcGlcIjtcclxuaW1wb3J0IHsgQmlsbEluZm8gfSBmcm9tIFwiLi4vLi4vZW50aXR5L3RyYWNraW5nL0JpbGxJbmZvXCI7XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBCaWxsVHJhY2tlckRhdGFJbmZvU2VydmljZSB7XHJcbiAgICAvKipcclxuICAgICAqIOWIpOaWrUJpbGxUcmFja2luZ1NldHRpbmdz5piv5pen54mI6L+Y5piv5paw54mIXHJcbiAgICAgKiBAcGFyYW0gYnRzIFxyXG4gICAgICogQHJldHVybnMgXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBpc05ld0JUUyhidHM6IHN0cmluZyB8IEJpbGxUcmFja2luZ1NldHRpbmdzKTogYm9vbGVhbiB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBidHMgPT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgICAgICBjb25zdCB0ZW1wID0gbmV3IEJpbGxUcmFja2luZ1NldHRpbmdzKCk7XHJcbiAgICAgICAgICAgIHRlbXAuTG9hZEZyb21Kc29uKGJ0cyk7XHJcbiAgICAgICAgICAgIGJ0cyA9IHRlbXA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gYnRzICE9IG51bGwgJiYgYnRzLnZlcnNpb24gPT09IFwiMS4wXCI7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGV4dHJhY3REYXRhUm93cyhyb3dzOiBCaWxsRGF0YVJvd1tdLCBzaG93bkZpZWxkczogQmlsbFNjaGVtYUZpZWxkQmFzZVtdLCB3aG9sZUZpZWxkczogQmlsbFNjaGVtYUZpZWxkQmFzZVtdLCBpZEZpZWxkOiBzdHJpbmcpIHtcclxuICAgICAgICBsZXQgZnJvd3MgPSBbXTtcclxuICAgICAgICBmb3IgKGxldCByb3cgb2Ygcm93cykge1xyXG4gICAgICAgICAgICBsZXQgb2JqID0ge307XHJcbiAgICAgICAgICAgIG9ialtpZEZpZWxkXSA9IHJvdy5kYXRhSWQ7XHJcbiAgICAgICAgICAgIC8vIOWFiOino+aekOWFtuS7luexu+Wei+Wtl+autVxyXG4gICAgICAgICAgICBjb25zdCBkZWNpbWFsRkZzID0gW107XHJcbiAgICAgICAgICAgIHNob3duRmllbGRzLmZvckVhY2goZiA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZi5kYXRhVHlwZSA9PSBEYXRhVHlwZS5EZWNpbWFsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVjaW1hbEZGcy5wdXNoKGYpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmpbZi5maWVsZFBhdGhdID0gdGhpcy5nZXRGaWVsZFZhbHVlKGYsIHJvdy5HZXRGaWVsZE1hcCgpLCB3aG9sZUZpZWxkcyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAvLyDlho3op6PmnpDmta7ngrnlnovlrZfmrrVcclxuICAgICAgICAgICAgZGVjaW1hbEZGcy5mb3JFYWNoKGYgPT4ge1xyXG4gICAgICAgICAgICAgICAgb2JqW2YuZmllbGRQYXRoXSA9IHRoaXMuZ2V0RmllbGRWYWx1ZShmLCByb3cuR2V0RmllbGRNYXAoKSwgd2hvbGVGaWVsZHMpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGZyb3dzLnB1c2gob2JqKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBmcm93cztcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZXh0cmFjdENhcHRpb25QYXRoKGZpZWxkOiBCaWxsU2NoZW1hRmllbGQgfCBCaWxsU2NoZW1hU3ViRmllbGQpIHtcclxuICAgICAgICBsZXQgcyA9IGZpZWxkLmNhcHRpb247XHJcbiAgICAgICAgbGV0IHRtcCA9IGZpZWxkIGFzIEJpbGxTY2hlbWFTdWJGaWVsZDtcclxuICAgICAgICB3aGlsZSAodG1wLmF0dGFjaGVkRmllbGQgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICBzID0gdG1wLmF0dGFjaGVkRmllbGQuY2FwdGlvbiArIFwiLlwiICsgcztcclxuICAgICAgICAgICAgdG1wID0gdG1wLmF0dGFjaGVkRmllbGQgYXMgQmlsbFNjaGVtYVN1YkZpZWxkO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcztcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZXh0cmFjdEZpZWxkUGF0aChmaWVsZDogQmlsbFNjaGVtYUZpZWxkIHwgQmlsbFNjaGVtYVN1YkZpZWxkKSB7XHJcbiAgICAgICAgbGV0IHMgPSBmaWVsZC5maWVsZE5hbWU7XHJcbiAgICAgICAgbGV0IHRtcCA9IGZpZWxkIGFzIEJpbGxTY2hlbWFTdWJGaWVsZDtcclxuICAgICAgICB3aGlsZSAodG1wLmF0dGFjaGVkRmllbGQgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICBzID0gdG1wLmF0dGFjaGVkRmllbGQuZmllbGROYW1lICsgXCIuXCIgKyBzO1xyXG4gICAgICAgICAgICB0bXAgPSB0bXAuYXR0YWNoZWRGaWVsZCBhcyBCaWxsU2NoZW1hU3ViRmllbGQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBzO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogXHJcbiAgICAgKiBAcGFyYW0gZmllbGRzIOWtkOWtl+auteWIl+ihqFxyXG4gICAgICogQHBhcmFtIHNlbGVjdGVkRmllbGRzIOeUqOaIt+iHquWumuS5ieWxleekuuWtl+auteWIl+ihqFxyXG4gICAgICogQHBhcmFtIHNob3dDdXN0b21GaWVsZHMg5piv5ZCm5oyJ55So5oi36Ieq5a6a5LmJ5a2X5q615pi+56S6XHJcbiAgICAgKiBAcmV0dXJucyBcclxuICAgICAqL1xyXG4gICAgcHVibGljIGV4dHJhY3RGRmllbGRzKGZpZWxkczogKEJpbGxTY2hlbWFGaWVsZCB8IEJpbGxTY2hlbWFTdWJGaWVsZClbXSwgc2VsZWN0ZWRGaWVsZHM6IEJpbGxTY2hlbWFGaWVsZEJhc2VbXSwgc2hvd0N1c3RvbUZpZWxkczogYm9vbGVhbik6IChCaWxsU2NoZW1hRmllbGQgfCBCaWxsU2NoZW1hU3ViRmllbGQpW10ge1xyXG4gICAgICAgIGxldCBmZmllbGRzOiAoQmlsbFNjaGVtYUZpZWxkIHwgQmlsbFNjaGVtYVN1YkZpZWxkKVtdID0gW107XHJcbiAgICAgICAgZmllbGRzLmZvckVhY2goZiA9PiB7XHJcbiAgICAgICAgICAgIGYuc2hvdyA9IHRydWU7XHJcbiAgICAgICAgICAgIC8v5p6a5Li+5oiW6ICF5p6a5Li+5Z6L5Y2V5YC8VURU5pe26buY6K6k5Y+WTmFtZVxyXG4gICAgICAgICAgICBpZiAoZi5maWVsZFR5cGUgPT0gXCJFbnVtXCIgfHwgZi5maWVsZFR5cGUgPT0gXCJFbnVtU2luZ2xlVWR0XCIpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHRlbXBGUGF0aCA9IHRoaXMuZXh0cmFjdEZpZWxkUGF0aChmKTtcclxuXHJcbiAgICAgICAgICAgICAgICBsZXQgc2YgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgaWYgKHNob3dDdXN0b21GaWVsZHMpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyDlpoLmnpzlrZfmrrXkuI3lnKjlt7LphY3nva7lrZfmrrXliJfooajkuK3liJnot7Pov4dcclxuICAgICAgICAgICAgICAgICAgICBzZiA9IHNlbGVjdGVkRmllbGRzLmZpbmQoKHNmaWVsZCkgPT4gc2ZpZWxkLmZpZWxkUGF0aCA9PSB0ZW1wRlBhdGgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzZiA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGYuc2hvdyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBmID0gdGhpcy5zZXRFeHRlbmRQcm9wcyhmLCBzZiwgdGVtcEZQYXRoICsgXCIuTmFtZVwiKSBhcyBCaWxsU2NoZW1hU3ViRmllbGQ7XHJcblxyXG4gICAgICAgICAgICAgICAgZmZpZWxkcy5wdXNoKGYpO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGYuR2V0U3ViRmllbGRMaXN0KCkgIT0gbnVsbCAmJiBmLkdldFN1YkZpZWxkTGlzdCgpLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIGZmaWVsZHMucHVzaCguLi50aGlzLmV4dHJhY3RGRmllbGRzKGYuR2V0U3ViRmllbGRMaXN0KCksIHNlbGVjdGVkRmllbGRzLCBzaG93Q3VzdG9tRmllbGRzKSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB0ZW1wRlBhdGggPSB0aGlzLmV4dHJhY3RGaWVsZFBhdGgoZik7XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IHNmID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIGlmIChzaG93Q3VzdG9tRmllbGRzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8g5aaC5p6c5a2X5q615LiN5Zyo5bey6YWN572u5a2X5q615YiX6KGo5Lit5YiZ6Lez6L+HXHJcbiAgICAgICAgICAgICAgICAgICAgc2YgPSBzZWxlY3RlZEZpZWxkcy5maW5kKChzZmllbGQpID0+IHNmaWVsZC5maWVsZFBhdGggPT0gdGVtcEZQYXRoKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2YgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmLnNob3cgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgZiA9IHRoaXMuc2V0RXh0ZW5kUHJvcHMoZiwgc2YsIHRlbXBGUGF0aCkgYXMgQmlsbFNjaGVtYVN1YkZpZWxkO1xyXG5cclxuICAgICAgICAgICAgICAgIGZmaWVsZHMucHVzaChmKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gZmZpZWxkcztcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOWIpOWumuacieWtkOaVsOaNrueahOadoeS7tuS4uu+8muWtkOihqOWPr+aYvuekuu+8jOS4lOWtkOihqOacieaVsOaNrlxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgaGFzQ2hpbGREYXRhKHJvdzogQmlsbERhdGFSb3csIGJpbGxJbmZvOiBCaWxsSW5mbykge1xyXG4gICAgICAgIGxldCBoYXNDaGlsZERhdGEgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgY29uc3Qgc2NoZW1hID0gdGhpcy5nZXRCaWxsVHJhY2tlclNjaGVtYShiaWxsSW5mbyk7XHJcbiAgICAgICAgbGV0IGNoaWxkcmVuID0gcm93LkdldENoaWxkVGFibGVMaXN0KCk7XHJcbiAgICAgICAgZm9yIChsZXQgYyBvZiBjaGlsZHJlbikge1xyXG4gICAgICAgICAgICBsZXQgdGFibGVTaG93ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGxldCBoYXNSb3dzID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGxldCB0YWJsZSA9IHNjaGVtYSAmJiBzY2hlbWFbYy50YWJsZU5hbWVdO1xyXG4gICAgICAgICAgICBpZiAodGFibGUgIT0gbnVsbCAmJiB0YWJsZS5zaG93ICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHRhYmxlU2hvdyA9IHRhYmxlLnNob3c7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyDlhbzlrrnml6BzaG935bGe5oCn5oOF5b2iXHJcbiAgICAgICAgICAgICAgICB0YWJsZVNob3cgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChjLkdldFJvd0xpc3QoKSAmJiBjLkdldFJvd0xpc3QoKS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBoYXNSb3dzID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBoYXNDaGlsZERhdGEgPSB0YWJsZVNob3cgJiYgaGFzUm93cztcclxuICAgICAgICAgICAgaWYgKGhhc0NoaWxkRGF0YSA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gaGFzQ2hpbGREYXRhO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXRGaWVsZFZhbHVlKGY6IEJpbGxTY2hlbWFGaWVsZEJhc2UsIHJkZm06IHsgW2tleTogc3RyaW5nXTogQmlsbERhdGFGaWVsZDsgfSwgd2hvbGVGaWVsZHM/OiBCaWxsU2NoZW1hRmllbGRCYXNlW10pIHtcclxuICAgICAgICBsZXQgZmllbGRzID0gZi5maWVsZFBhdGggPyBmLmZpZWxkUGF0aC5zcGxpdChcIi5cIikgOiBbZi5maWVsZE5hbWVdO1xyXG5cclxuICAgICAgICBsZXQgYmRmOiBCaWxsRGF0YUZpZWxkIHwgQmlsbERhdGFTdWJGaWVsZCA9IGZpZWxkcyAmJiByZGZtW2ZpZWxkc1swXV07XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGJkZiAhPSBudWxsICYmIGkgPCBmaWVsZHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgY29uc3QgdGVtcCA9IGJkZi5HZXRTdWJGaWVsZE1hcCgpO1xyXG4gICAgICAgICAgICBpZiAodGVtcCA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBiZGYgPSB0ZW1wW2ZpZWxkc1tpXV07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCB0ZXh0VmFsdWUgPSBiZGYgPyBiZGYuR2V0VGV4dFZhbHVlKCkgOiBcIlwiO1xyXG4gICAgICAgIGlmICh0ZXh0VmFsdWUgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGYuZGF0YVR5cGUgPT0gRGF0YVR5cGUuU3RyaW5nKSB7XHJcbiAgICAgICAgICAgIGlmIChmLmZvcm1hdEluZm8gIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgc3RyaW5nTWFwRm9ybWF0dGVyID0gZi5mb3JtYXRJbmZvLnN0cmluZ01hcEZvcm1hdHRlcjtcclxuICAgICAgICAgICAgICAgIGlmIChzdHJpbmdNYXBGb3JtYXR0ZXIgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHYgPSBzdHJpbmdNYXBGb3JtYXR0ZXJbdGV4dFZhbHVlXSB8fCB0ZXh0VmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgZi5maWVsZFZhbHVlID0gdjtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdjtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZi5maWVsZFZhbHVlID0gdGV4dFZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0ZXh0VmFsdWUgfHwgXCJcIjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGYuZmllbGRWYWx1ZSA9IHRleHRWYWx1ZTtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0ZXh0VmFsdWUgfHwgXCJcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSBpZiAoZi5kYXRhVHlwZSA9PSBEYXRhVHlwZS5EZWNpbWFsKSB7XHJcbiAgICAgICAgICAgIGxldCBzY2FsZSA9IGYuc2NhbGU7XHJcbiAgICAgICAgICAgIGlmIChmLmZvcm1hdEluZm8gIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGYuZm9ybWF0SW5mby5zY2FsZSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NhbGUgPSBmLmZvcm1hdEluZm8uc2NhbGU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoZi5mb3JtYXRJbmZvLmVuYWJsZVNjYWxlRXhwcmVzc2lvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChmLmZvcm1hdEluZm8uc2NhbGVFeHByZXNzaW9uICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2NhbGVGaWVsZCA9IHRoaXMuZ2V0RmllbGRJbkZpZWxkcyh3aG9sZUZpZWxkcywgZi5mb3JtYXRJbmZvLnNjYWxlRXhwcmVzc2lvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRtcCA9IHNjYWxlRmllbGQgJiYgcGFyc2VJbnQoU3RyaW5nKHRoaXMuZ2V0RmllbGRWYWx1ZShzY2FsZUZpZWxkLCByZGZtKSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBjb25zdCB0bXAgPSBwYXJzZUludCh0aGlzLmdldEZpZWxkVmFsdWVJbkZpZWxkc1dpdGhWYWx1ZShleHRhY3RlZEZpZWxkcywgZi5mb3JtYXRJbmZvLnNjYWxlRXhwcmVzc2lvbikpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodG1wICE9IG51bGwgJiYgIWlzTmFOKHRtcCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjYWxlID0gdG1wO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGYuZmllbGRWYWx1ZSA9IHBhcnNlRmxvYXQoU3RyaW5nKHRleHRWYWx1ZSkpO1xyXG4gICAgICAgICAgICBsZXQgZGVjID0gcGFyc2VGbG9hdChTdHJpbmcodGV4dFZhbHVlKSkudG9GaXhlZChzY2FsZSkudG9TdHJpbmcoKTtcclxuICAgICAgICAgICAgcmV0dXJuIGRlYyB8fCBcIlwiO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoZi5kYXRhVHlwZSA9PSBEYXRhVHlwZS5Cb29sZWFuKSB7XHJcbiAgICAgICAgICAgIGlmICh0ZXh0VmFsdWUgPT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgZi5maWVsZFZhbHVlID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0ZXh0VmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZi5maWVsZFZhbHVlID0gSlNPTi5wYXJzZSh0ZXh0VmFsdWUpIGFzIGJvb2xlYW47XHJcbiAgICAgICAgICAgIHJldHVybiBKU09OLnBhcnNlKHRleHRWYWx1ZSkgYXMgYm9vbGVhbjtcclxuICAgICAgICB9IGVsc2UgaWYgKGYuZGF0YVR5cGUgPT0gRGF0YVR5cGUuRGF0ZVRpbWUpIHtcclxuICAgICAgICAgICAgbGV0IGRhdGUgPSBCcG1uTW9kZWxKc29uSGVscGVyLkRhdGVUaW1lRnJvbVN0cmluZyh0ZXh0VmFsdWUpO1xyXG4gICAgICAgICAgICBsZXQgZm9ybWF0dGVyID0gXCJ5eXl5LU1NLWRkXCI7XHJcbiAgICAgICAgICAgIGlmIChmLmZpZWxkVHlwZSA9PSBcIkRhdGVUaW1lXCIpIHtcclxuICAgICAgICAgICAgICAgIGZvcm1hdHRlciA9IGYuZm9ybWF0SW5mbyAmJiBmLmZvcm1hdEluZm8uZGF0ZUZvcm1hdHRlciB8fCBcInl5eXktTU0tZGQgSEg6bW06c3MuU1NTXCI7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZi5maWVsZFR5cGUgPT0gXCJEYXRlXCIpIHtcclxuICAgICAgICAgICAgICAgIGZvcm1hdHRlciA9IGYuZm9ybWF0SW5mbyAmJiBmLmZvcm1hdEluZm8uZGF0ZUZvcm1hdHRlciB8fCBcInl5eXktTU0tZGRcIjtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGZvcm1hdHRlciA9IGYuZm9ybWF0SW5mbyAmJiBmLmZvcm1hdEluZm8uZGF0ZUZvcm1hdHRlciB8fCBcInl5eXktTU0tZGRcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBmLmZpZWxkVmFsdWUgPSBkYXRlO1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5kYXRlRm9ybWF0KGRhdGUsIGZvcm1hdHRlcik7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgZi5maWVsZFZhbHVlID0gdGV4dFZhbHVlO1xyXG4gICAgICAgICAgICByZXR1cm4gdGV4dFZhbHVlIHx8IFwiXCI7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXRGaWVsZEluRmllbGRzKGZpZWxkczogQmlsbFNjaGVtYUZpZWxkQmFzZVtdLCBmdWxsUGF0aDogc3RyaW5nKSB7XHJcbiAgICAgICAgbGV0IHYgPSBudWxsO1xyXG4gICAgICAgIGZvciAobGV0IGZ2IG9mIGZpZWxkcykge1xyXG4gICAgICAgICAgICB3aGlsZSAoZnYuYXR0YWNoZWRGaWVsZCkge1xyXG4gICAgICAgICAgICAgICAgZnYgPSBmdi5hdHRhY2hlZEZpZWxkO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IHJvb3RGdiA9IGZ2IGFzIEJpbGxTY2hlbWFGaWVsZDtcclxuICAgICAgICAgICAgcm9vdEZ2LmZ1bGxQYXRoID0gZnVsbFBhdGhQcmVmaXggKyByb290RnYuYXR0YWNoZWRUYWJsZS50YWJsZU5hbWUgKyBcIi5cIiArIHJvb3RGdi5maWVsZFBhdGg7XHJcbiAgICAgICAgICAgIGlmIChmdWxsUGF0aCA9PSByb290RnYuZnVsbFBhdGgpIHtcclxuICAgICAgICAgICAgICAgIHYgPSByb290RnY7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdjtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2V0RmllbGRWYWx1ZUluRmllbGRzV2l0aFZhbHVlKGZpZWxkc1dpdGhWYWx1ZTogQmlsbFNjaGVtYUZpZWxkQmFzZVtdLCBmdWxsUGF0aDogc3RyaW5nKSB7XHJcbiAgICAgICAgbGV0IHYgPSBudWxsO1xyXG4gICAgICAgIGZvciAobGV0IGZ2IG9mIGZpZWxkc1dpdGhWYWx1ZSkge1xyXG4gICAgICAgICAgICB3aGlsZSAoZnYuYXR0YWNoZWRGaWVsZCkge1xyXG4gICAgICAgICAgICAgICAgZnYgPSBmdi5hdHRhY2hlZEZpZWxkO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IHJvb3RGdiA9IGZ2IGFzIEJpbGxTY2hlbWFGaWVsZDtcclxuICAgICAgICAgICAgcm9vdEZ2LmZ1bGxQYXRoID0gZnVsbFBhdGhQcmVmaXggKyByb290RnYuYXR0YWNoZWRUYWJsZS50YWJsZU5hbWUgKyBcIi5cIiArIHJvb3RGdi5maWVsZFBhdGg7XHJcbiAgICAgICAgICAgIGlmIChmdWxsUGF0aCA9PSByb290RnYuZnVsbFBhdGgpIHtcclxuICAgICAgICAgICAgICAgIHYgPSByb290RnYuZmllbGRWYWx1ZTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB2O1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXRCYXNpY0luZm9GaWVsZHNXaXRoVmFsdWUoYmlsbEluZm86IEJpbGxJbmZvLCBzY2hlbWFUYWJsZTogQmlsbFNjaGVtYVRhYmxlLCBkYXRhVGFibGU6IEJpbGxEYXRhVGFibGUsIGZpbHRlckZpZWxkczogYm9vbGVhbiA9IHRydWUpOiAoQmlsbFNjaGVtYUZpZWxkIHwgQmlsbFNjaGVtYVN1YkZpZWxkKVtdIHtcclxuICAgICAgICBjb25zdCBmaWVsZHNXaXRoVmFsdWU6IChCaWxsU2NoZW1hRmllbGQgfCBCaWxsU2NoZW1hU3ViRmllbGQpW10gPSBbXTtcclxuICAgICAgICAvLyDljZXmja7ov73ouKrphY3nva5cclxuICAgICAgICBsZXQgYnRzOiBCaWxsVHJhY2tpbmdTZXR0aW5ncyA9IG5ldyBCaWxsVHJhY2tpbmdTZXR0aW5ncygpO1xyXG4gICAgICAgIGlmIChiaWxsSW5mbyAmJiBiaWxsSW5mby5iaWxsVHJhY2tpbmdTZXR0aW5ncykge1xyXG4gICAgICAgICAgICBidHMuTG9hZEZyb21Kc29uKGJpbGxJbmZvLmJpbGxUcmFja2luZ1NldHRpbmdzKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHNjaGVtYSA9IHRoaXMuZ2V0QmlsbFRyYWNrZXJTY2hlbWEoYmlsbEluZm8pO1xyXG4gICAgICAgIGxldCBzZWxlY3RlZEZpZWxkcyA9IHNjaGVtYSAmJiBzY2hlbWFbc2NoZW1hVGFibGUudGFibGVOYW1lXSAmJiBzY2hlbWFbc2NoZW1hVGFibGUudGFibGVOYW1lXS5maWVsZHM7XHJcbiAgICAgICAgc2VsZWN0ZWRGaWVsZHMgPSBzZWxlY3RlZEZpZWxkcyA/IHNlbGVjdGVkRmllbGRzIDogW107XHJcbiAgICAgICAgbGV0IHNob3dDdXN0b21GaWVsZHMgPSBidHMuYmlsbFRyYWNraW5nRGF0YVNob3duTW9kZSA9PT0gQmlsbFRyYWNraW5nRGF0YVNob3duTW9kZS5DVVNUT01GSUVMRDtcclxuXHJcbiAgICAgICAgLy8g5omA5pyJ5a2X5q61XHJcbiAgICAgICAgY29uc3QgZnMgPSBzY2hlbWFUYWJsZS5nZXRGaWVsZExpc3QoKTtcclxuICAgICAgICBjb25zdCByID0gZGF0YVRhYmxlLkdldFJvd0xpc3QoKVswXTtcclxuICAgICAgICAvLyDkuLvooajlrZfmrrVcclxuICAgICAgICBjb25zdCByZGZtID0gci5HZXRGaWVsZE1hcCgpO1xyXG5cclxuICAgICAgICAvLyDmj5Dlj5blsZXnpLrlrZfmrrVcclxuICAgICAgICBjb25zdCBmZnMgPSB0aGlzLmV4dHJhY3RGRmllbGRzKGZzLCBzZWxlY3RlZEZpZWxkcywgc2hvd0N1c3RvbUZpZWxkcyk7XHJcbiAgICAgICAgLy8g6I635Y+W5a2X5q615YC8XHJcbiAgICAgICAgLy8g5YWI6Kej5p6Q5YW25LuW57G75Z6L5a2X5q61XHJcbiAgICAgICAgY29uc3QgZGVjaW1hbEZmcyA9IFtdO1xyXG4gICAgICAgIGZmcy5mb3JFYWNoKGZmID0+IHtcclxuICAgICAgICAgICAgaWYgKGZmLmRhdGFUeXBlID09IERhdGFUeXBlLkRlY2ltYWwpIHtcclxuICAgICAgICAgICAgICAgIGRlY2ltYWxGZnMucHVzaChmZik7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBmZi5maWVsZFZhbHVlID0gdGhpcy5nZXRGaWVsZFZhbHVlKGZmLCByZGZtKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIC8vIOWGjeino+aekOa1rueCueaVsOWtl+autVxyXG4gICAgICAgIGRlY2ltYWxGZnMuZm9yRWFjaChmZiA9PiB7XHJcbiAgICAgICAgICAgIGZmLmZpZWxkVmFsdWUgPSB0aGlzLmdldEZpZWxkVmFsdWUoZmYsIHJkZm0sIGZzKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBmaWVsZHNXaXRoVmFsdWUucHVzaCguLi5mZnMpO1xyXG5cclxuICAgICAgICByZXR1cm4gZmllbGRzV2l0aFZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzZXRFeHRlbmRQcm9wcyhmOiBCaWxsU2NoZW1hRmllbGQgfCBCaWxsU2NoZW1hU3ViRmllbGQsIHNmOiBCaWxsU2NoZW1hRmllbGQgfCBCaWxsU2NoZW1hU3ViRmllbGQsIGZpZWxkUGF0aDogc3RyaW5nLCByZGZtPzogeyBba2V5OiBzdHJpbmddOiBCaWxsRGF0YUZpZWxkOyB9KSB7XHJcbiAgICAgICAgZi5jYXB0aW9uUGF0aCA9IHRoaXMuZXh0cmFjdENhcHRpb25QYXRoKGYpO1xyXG4gICAgICAgIGYuZmllbGRQYXRoID0gZmllbGRQYXRoO1xyXG4gICAgICAgIGlmIChzZikge1xyXG4gICAgICAgICAgICBmLmRpc3BsYXlOYW1lID0gc2YuZGlzcGxheU5hbWU7XHJcbiAgICAgICAgICAgIGYuaTE4bkNvbHMgPSBzZi5pMThuQ29scztcclxuICAgICAgICAgICAgZi5mb3JtYXRJbmZvID0gc2YuZm9ybWF0SW5mbztcclxuICAgICAgICAgICAgZi5vcmRlciA9IHNmLm9yZGVyO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAocmRmbSkge1xyXG4gICAgICAgICAgICBmLmZpZWxkVmFsdWUgPSB0aGlzLmdldEZpZWxkVmFsdWUoZiwgcmRmbSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gZjtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOWtl+auteWIl+ihqOaMiW9yZGVy5bGe5oCn5o6S5bqPXHJcbiAgICAgKiBAcGFyYW0gZmllbGRzV2l0aFZhbHVlIFxyXG4gICAgICogQHJldHVybnMgXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzb3J0RmllbGRzQnlPcmRlcihmaWVsZHNXaXRoVmFsdWU6IChCaWxsU2NoZW1hRmllbGQgfCBCaWxsU2NoZW1hU3ViRmllbGQpW10pOiAoQmlsbFNjaGVtYUZpZWxkIHwgQmlsbFNjaGVtYVN1YkZpZWxkKVtdIHtcclxuICAgICAgICByZXR1cm4gZmllbGRzV2l0aFZhbHVlLnNvcnQoKGEsIGIpID0+IHtcclxuICAgICAgICAgICAgaWYgKGEub3JkZXIgIT0gbnVsbCAmJiBiLm9yZGVyICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBhLm9yZGVyIC0gYi5vcmRlcjtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChhLm9yZGVyICE9IG51bGwgJiYgYi5vcmRlciA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gLTE7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoYS5vcmRlciA9PSBudWxsICYmIGIub3JkZXIgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIDE7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGRhdGVGb3JtYXQoZGF0ZTogRGF0ZSwgZm10OiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgICAgIGxldCByZXQ7XHJcbiAgICAgICAgY29uc3Qgb3B0ID0ge1xyXG4gICAgICAgICAgICBcInkrXCI6IGRhdGUuZ2V0VVRDRnVsbFllYXIoKS50b1N0cmluZygpLCAgICAgICAgLy8g5bm0XHJcbiAgICAgICAgICAgIFwiTStcIjogKGRhdGUuZ2V0VVRDTW9udGgoKSArIDEpLnRvU3RyaW5nKCksICAgICAvLyDmnIhcclxuICAgICAgICAgICAgXCJkK1wiOiBkYXRlLmdldFVUQ0RhdGUoKS50b1N0cmluZygpLCAgICAgICAgICAgIC8vIOaXpVxyXG4gICAgICAgICAgICBcIkgrXCI6IGRhdGUuZ2V0VVRDSG91cnMoKS50b1N0cmluZygpLCAgICAgICAgICAgLy8g5pe2XHJcbiAgICAgICAgICAgIFwibStcIjogZGF0ZS5nZXRVVENNaW51dGVzKCkudG9TdHJpbmcoKSwgICAgICAgICAvLyDliIZcclxuICAgICAgICAgICAgXCJzK1wiOiBkYXRlLmdldFVUQ1NlY29uZHMoKS50b1N0cmluZygpLCAgICAgICAgIC8vIOenklxyXG4gICAgICAgICAgICBcIlMrXCI6IGRhdGUuZ2V0VVRDTWlsbGlzZWNvbmRzKCkudG9TdHJpbmcoKSwgICAgLy8g56eSXHJcbiAgICAgICAgICAgIC8vIOacieWFtuS7luagvOW8j+WMluWtl+espumcgOaxguWPr+S7pee7p+e7rea3u+WKoO+8jOW/hemhu+i9rOWMluaIkOWtl+espuS4slxyXG4gICAgICAgIH07XHJcbiAgICAgICAgZm9yIChsZXQgayBpbiBvcHQpIHtcclxuICAgICAgICAgICAgcmV0ID0gbmV3IFJlZ0V4cChcIihcIiArIGsgKyBcIilcIikuZXhlYyhmbXQpO1xyXG4gICAgICAgICAgICBpZiAocmV0KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIVN0cmluZy5wcm90b3R5cGUucGFkU3RhcnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBmbXQgPSBmbXQucmVwbGFjZShyZXRbMV0sIChyZXRbMV0ubGVuZ3RoID09IDEpID8gKG9wdFtrXSkgOiAodGhpcy5teVBhZFN0YXJ0KG9wdFtrXSwgcmV0WzFdLmxlbmd0aCwgXCIwXCIpKSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGZtdCA9IGZtdC5yZXBsYWNlKHJldFsxXSwgKHJldFsxXS5sZW5ndGggPT0gMSkgPyAob3B0W2tdKSA6IChvcHRba10ucGFkU3RhcnQocmV0WzFdLmxlbmd0aCwgXCIwXCIpKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZtdDtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgbXlQYWRTdGFydChzcmM6IHN0cmluZywgdGFyZ2V0TGVuZ3RoOiBudW1iZXIsIHBhZFN0cmluZzogc3RyaW5nKSB7XHJcbiAgICAgICAgdGFyZ2V0TGVuZ3RoID0gdGFyZ2V0TGVuZ3RoID4+IDA7IC8vZmxvb3IgaWYgbnVtYmVyIG9yIGNvbnZlcnQgbm9uLW51bWJlciB0byAwO1xyXG4gICAgICAgIHBhZFN0cmluZyA9IFN0cmluZyh0eXBlb2YgcGFkU3RyaW5nICE9PSAndW5kZWZpbmVkJyA/IHBhZFN0cmluZyA6ICcgJyk7XHJcbiAgICAgICAgaWYgKHNyYy5sZW5ndGggPiB0YXJnZXRMZW5ndGgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFN0cmluZyhzcmMpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRhcmdldExlbmd0aCA9IHRhcmdldExlbmd0aCAtIHNyYy5sZW5ndGg7XHJcbiAgICAgICAgICAgIGlmICh0YXJnZXRMZW5ndGggPiBwYWRTdHJpbmcubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICBwYWRTdHJpbmcgKz0gcGFkU3RyaW5nLnJlcGVhdCh0YXJnZXRMZW5ndGggLyBwYWRTdHJpbmcubGVuZ3RoKTsgLy9hcHBlbmQgdG8gb3JpZ2luYWwgdG8gZW5zdXJlIHdlIGFyZSBsb25nZXIgdGhhbiBuZWVkZWRcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gcGFkU3RyaW5nLnNsaWNlKDAsIHRhcmdldExlbmd0aCkgKyBTdHJpbmcoc3JjKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDop6PmnpDlrZfmrrXlkI3np7BcclxuICAgICAqIEBwYXJhbSBmIFxyXG4gICAgICogQHBhcmFtIGxhbmdDb2RlIFxyXG4gICAgICogQHJldHVybnMgXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBnZXRGaWVsZExhYmVsKGY6IEJpbGxTY2hlbWFGaWVsZCB8IEJpbGxTY2hlbWFTdWJGaWVsZCwgbGFuZ0NvZGU/OiBzdHJpbmcpIHtcclxuICAgICAgICByZXR1cm4gKGxhbmdDb2RlICYmIGYuaTE4bkNvbHMgJiYgZi5pMThuQ29scy5jb2xJMThuVmFsdWVzLmRpc3BsYXlOYW1lICYmXHJcbiAgICAgICAgICAgIGYuaTE4bkNvbHMuY29sSTE4blZhbHVlcy5kaXNwbGF5TmFtZVtsYW5nQ29kZV0pIHx8IGYuZGlzcGxheU5hbWUgfHwgZi5jYXB0aW9uUGF0aCB8fCBmLmNhcHRpb25cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOino+aekOihqOWQjeensFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgZ2V0VGFibGVMYWJlbChiaWxsSW5mbzogQmlsbEluZm8sIHNjaGVtYVRhYmxlOiBCaWxsU2NoZW1hVGFibGUsIGxhbmdDb2RlPzogc3RyaW5nKSB7XHJcbiAgICAgICAgY29uc3Qgc2NoZW1hID0gdGhpcy5nZXRCaWxsVHJhY2tlclNjaGVtYShiaWxsSW5mbyk7XHJcbiAgICAgICAgbGV0IHRhYmxlID0gc2NoZW1hICYmIHNjaGVtYVtzY2hlbWFUYWJsZS50YWJsZU5hbWVdO1xyXG4gICAgICAgIGlmICh0YWJsZSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGkxOG5Db2xzID0gdGFibGUuaTE4bkNvbHM7XHJcbiAgICAgICAgICAgIGNvbnN0IHRtcCA9IChsYW5nQ29kZSAmJiBpMThuQ29scyAmJiBpMThuQ29scy5jb2xJMThuVmFsdWVzLmRpc3BsYXlOYW1lICYmIGkxOG5Db2xzLmNvbEkxOG5WYWx1ZXMuZGlzcGxheU5hbWVbbGFuZ0NvZGVdKSB8fCB0YWJsZS5kaXNwbGF5TmFtZSB8fCB0YWJsZS5jYXB0aW9uIHx8IHRhYmxlLmNvZGU7XHJcbiAgICAgICAgICAgIHJldHVybiB0bXA7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHNjaGVtYVRhYmxlLmNhcHRpb247XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6I635Y+W6Kej5p6Q5Y+v5bGV56S65a2Q6KGoXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBnZXRDaGlsZFRhYmxlcyhiaWxsSW5mbzogQmlsbEluZm8sIHNjaGVtYVRhYmxlOiBCaWxsU2NoZW1hVGFibGUpIHtcclxuICAgICAgICBsZXQgcmVzdWx0OiBCaWxsU2NoZW1hVGFibGVbXSA9IFtdO1xyXG5cclxuICAgICAgICBjb25zdCBzY2hlbWEgPSB0aGlzLmdldEJpbGxUcmFja2VyU2NoZW1hKGJpbGxJbmZvKTtcclxuICAgICAgICBjb25zdCBjaGlsZHJlbiA9IHNjaGVtYVRhYmxlLkdldENoaWxkVGFibGVMaXN0KCk7XHJcbiAgICAgICAgY2hpbGRyZW4gJiYgY2hpbGRyZW4uZm9yRWFjaCgoY2hpbGQpID0+IHtcclxuICAgICAgICAgICAgbGV0IHRyYWNrZXJUYWJsZSA9IHNjaGVtYSAmJiBzY2hlbWFbY2hpbGQudGFibGVOYW1lXTtcclxuICAgICAgICAgICAgaWYgKHRyYWNrZXJUYWJsZSAhPSBudWxsICYmIHRyYWNrZXJUYWJsZS5zaG93ICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0cmFja2VyVGFibGUuc2hvdyA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2hpbGQub3JkZXIgPSB0cmFja2VyVGFibGUub3JkZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goY2hpbGQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8g5YW85a655pegc2hvd+WxnuaAp+aDheW9olxyXG4gICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goY2hpbGQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJlc3VsdCA9IHRoaXMuc29ydFRhYmxlc0J5T3JkZXIocmVzdWx0KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOihqOaMiXNvcnTlrZfmrrXmjpLluo9cclxuICAgICAqIEBwYXJhbSBzY2hlbWFUYWJsZXMgXHJcbiAgICAgKiBAcmV0dXJucyBcclxuICAgICAqL1xyXG4gICAgcHVibGljIHNvcnRUYWJsZXNCeU9yZGVyKHNjaGVtYVRhYmxlczogQmlsbFNjaGVtYVRhYmxlW10pOiBCaWxsU2NoZW1hVGFibGVbXSB7XHJcbiAgICAgICAgcmV0dXJuIHNjaGVtYVRhYmxlcy5zb3J0KChhLCBiKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChhLm9yZGVyICE9IG51bGwgJiYgYi5vcmRlciAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYS5vcmRlciAtIGIub3JkZXI7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoYS5vcmRlciAhPSBudWxsICYmIGIub3JkZXIgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIC0xO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGEub3JkZXIgPT0gbnVsbCAmJiBiLm9yZGVyICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAxO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDop6PmnpBiaWxsVHJhY2tlclNjaGVtYVxyXG4gICAgICogQHBhcmFtIGJpbGxJbmZvIFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgZ2V0QmlsbFRyYWNrZXJTY2hlbWEoYmlsbEluZm86IEJpbGxJbmZvKTogQmlsbFRyYWNrZXJTY2hlbWEge1xyXG4gICAgICAgIGxldCBidHM6IEJpbGxUcmFja2luZ1NldHRpbmdzID0gbmV3IEJpbGxUcmFja2luZ1NldHRpbmdzKCk7XHJcbiAgICAgICAgaWYgKGJpbGxJbmZvICYmIGJpbGxJbmZvLmJpbGxUcmFja2luZ1NldHRpbmdzKSB7XHJcbiAgICAgICAgICAgIGJ0cy5Mb2FkRnJvbUpzb24oYmlsbEluZm8uYmlsbFRyYWNraW5nU2V0dGluZ3MpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IGZpZWxkQ29udGVudCA9IGJ0cy5jdXN0b21GaWVsZENvbnRlbnQ7XHJcbiAgICAgICAgbGV0IGZpZWxkQ29uZmlnOiBCaWxsVHJhY2tlclNjaGVtYUZpZWxkQ29udGVudCA9IGZpZWxkQ29udGVudCAmJiAodHlwZW9mIGZpZWxkQ29udGVudCA9PSBcIm9iamVjdFwiID8gZmllbGRDb250ZW50IDogSlNPTi5wYXJzZShmaWVsZENvbnRlbnQpKTtcclxuICAgICAgICBsZXQgc2NoZW1hID0gZmllbGRDb25maWcgJiYgZmllbGRDb25maWcuc2NoZW1hO1xyXG5cclxuICAgICAgICByZXR1cm4gc2NoZW1hO1xyXG4gICAgfVxyXG59Il19