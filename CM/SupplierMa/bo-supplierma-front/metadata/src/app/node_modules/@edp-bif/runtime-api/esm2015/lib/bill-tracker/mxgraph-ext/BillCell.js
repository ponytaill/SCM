/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/mxgraph-ext/BillCell.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { mxCell, mxEvent, mxEventObject } from "../../ref/mxgraph";
import { BpmnModelJsonHelper } from "@edp-aif/common-api";
import { BillTrackingSettings, JointQueryMode } from '@edp-bif/common-api';
import { FieldNameAndValue } from "../../entity/tracking/FieldNameAndValue";
import { Events } from "./Events";
export class BillCell extends mxCell {
    /**
     * @param {?} billDataInfo
     * @param {?} billInfo
     * @param {?} entry
     * @param {?=} geometry
     * @param {?=} style
     */
    constructor(billDataInfo, billInfo, entry, geometry, style) {
        super(null, geometry, style);
        this.THUMB_SCALE = 0.6;
        this.billDataInfo = billDataInfo;
        this.billInfo = billInfo;
        /** @type {?} */
        let bts = new BillTrackingSettings();
        if (billInfo && billInfo.billTrackingSettings) {
            bts.LoadFromJson(billInfo.billTrackingSettings);
        }
        this.entry = entry;
        // this.value = this.billDataInfo.caption || bts.billNodeName || this.billInfo.voName || this.billDataInfo.dataId || this.billDataInfo.summary;
    }
    /**
     * @return {?}
     */
    getCaption() {
        /** @type {?} */
        let label = null;
        /** @type {?} */
        let bts = new BillTrackingSettings();
        if (this.billInfo && this.billInfo.billTrackingSettings) {
            bts.LoadFromJson(this.billInfo.billTrackingSettings);
        }
        label = this.billDataInfo.caption || bts.billNodeName || this.billInfo.voName || this.billDataInfo.dataId || this.billDataInfo.summary;
        return label;
    }
    /**
     * @return {?}
     */
    buildHtmlTooltip() {
        /** @type {?} */
        const tooltipHtml = `\
            <span>${this.billDataInfo.dataId}</span>\
        `;
        return tooltipHtml;
    }
    /**
     * 样式类在graph组件中定义
     * @param {?} graph
     * @return {?}
     */
    buildHtmlLabel(graph) {
        return this.buildHtmlLabelByDOM(graph);
    }
    /**
     * 通过操纵dom元素方式创建html
     * @private
     * @param {?} graph
     * @return {?}
     */
    buildHtmlLabelByDOM(graph) {
        /** @type {?} */
        const scale = graph.view.scale;
        /** @type {?} */
        const state = graph.view.getState(this);
        /** @type {?} */
        const width = this.geometry.width;
        /** @type {?} */
        const height = this.geometry.height;
        /** @type {?} */
        let bts = new BillTrackingSettings();
        if (this.billInfo && this.billInfo.billTrackingSettings) {
            bts.LoadFromJson(this.billInfo.billTrackingSettings);
        }
        /** @type {?} */
        const title = this.billDataInfo.caption || bts.billNodeName || this.billInfo.voName || this.billDataInfo.dataId || this.billDataInfo.summary;
        /** @type {?} */
        const isEntry = this.entry;
        // 节点框架
        /** @type {?} */
        const divNodeRoot = document.createElement("div");
        divNodeRoot.classList.add("bif-cell-node");
        divNodeRoot.style.width = width + "px";
        divNodeRoot.style.height = height + "px";
        if (isEntry) {
            // 当前节点标识
            /** @type {?} */
            const divNodeCurrent = document.createElement("div");
            divNodeRoot.appendChild(divNodeCurrent);
            divNodeCurrent.classList.add("bif-cell-node-current");
            /** @type {?} */
            const spanCurrent = document.createElement("span");
            divNodeCurrent.appendChild(spanCurrent);
            spanCurrent.classList.add("bif-cell-node-current-text");
            spanCurrent.innerHTML = graph && graph.localePipe && graph.localePipe.transform("currentNode") || "当前";
        }
        // 当比例小到指定值后仅显示单据名
        if (scale < this.THUMB_SCALE) {
            // // 使用图片+标题
            // const divNodeThumb = document.createElement("div");
            // divNodeRoot.appendChild(divNodeThumb);
            // divNodeThumb.classList.add("bif-cell-node-thumb");
            // const divNodeThumbImg = document.createElement("div");
            // divNodeThumb.appendChild(divNodeThumbImg);
            // divNodeThumbImg.classList.add("bif-cell-node-thumb-img-container");
            // const img = document.createElement("img");
            // divNodeThumbImg.appendChild(img);
            // img.classList.add("bif-cell-node-thumb-img");
            // img.src = "/platform/runtime/common/web/@edp-bif/runtime-api/images/non-entry-bill.png";
            // const divNodeThumbTitle = document.createElement("div");
            // divNodeThumb.appendChild(divNodeThumbTitle);
            // divNodeThumbTitle.classList.add("bif-cell-node-thumb-title");
            // const divNodeThumbTitleText = document.createElement("div");
            // divNodeThumbTitle.appendChild(divNodeThumbTitleText);
            // divNodeThumbTitleText.classList.add("bif-cell-node-thumb-title-text");
            // divNodeThumbTitleText.innerHTML = title;
            // // 判断是否需添加点击事件
            // const jqm = this.billInfo.jointQueryMode;
            // const jqp: JointQueryParameters = JSON.parse(this.billInfo.jointQueryParameters);
            // if ((jqm == JointQueryMode.APP && jqp.funcId) || (jqm == JointQueryMode.URL && jqp.url)) {
            //     divNodeThumbTitleText.classList.add("bif-cell-node-title-link");
            //     mxEvent.addListener(divNodeThumbTitleText, "click", () => {
            //         graph.fireEvent(new mxEventObject(Events.CLICK_FIRST_SUMMARY, "cell", this));
            //         event.stopPropagation();
            //         return false;
            //     });
            // }
            // 使用标题
            // 节点标题
            /** @type {?} */
            const divNodeTitleOnly = document.createElement("div");
            divNodeRoot.appendChild(divNodeTitleOnly);
            divNodeTitleOnly.classList.add("bif-cell-node-title-only");
            /** @type {?} */
            const divNodeTitleOnlyText = document.createElement("div");
            divNodeTitleOnly.appendChild(divNodeTitleOnlyText);
            divNodeTitleOnlyText.classList.add("bif-cell-node-title-only-text");
            divNodeTitleOnlyText.innerHTML = title;
            // 判断是否需添加点击事件
            /** @type {?} */
            const jqm = this.billInfo.jointQueryMode;
            /** @type {?} */
            const jqp = JSON.parse(this.billInfo.jointQueryParameters);
            if ((jqm == JointQueryMode.APP && jqp.funcId) || (jqm == JointQueryMode.URL && jqp.url)) {
                divNodeTitleOnlyText.classList.add("bif-cell-node-title-link");
                mxEvent.addListener(divNodeTitleOnlyText, "click", (/**
                 * @return {?}
                 */
                () => {
                    graph.fireEvent(new mxEventObject(Events.CLICK_FIRST_SUMMARY, "cell", this));
                    event.stopPropagation();
                    return false;
                }));
            }
        }
        else {
            // 节点主内容
            /** @type {?} */
            const divNodeMain = document.createElement("div");
            divNodeRoot.appendChild(divNodeMain);
            divNodeMain.classList.add("bif-cell-node-main");
            // 节点标题
            /** @type {?} */
            const divNodeTitle = document.createElement("div");
            divNodeMain.appendChild(divNodeTitle);
            divNodeTitle.classList.add("bif-cell-node-title");
            /** @type {?} */
            const divNodeTitleText = document.createElement("div");
            divNodeTitle.appendChild(divNodeTitleText);
            divNodeTitleText.classList.add("bif-cell-node-title-text");
            divNodeTitleText.innerHTML = title;
            // 节点摘要
            /** @type {?} */
            const divNodeSummaryList = document.createElement("div");
            divNodeMain.appendChild(divNodeSummaryList);
            divNodeSummaryList.classList.add("bif-cell-node-summary-list");
            // 46是标题栏高度
            divNodeSummaryList.style.minHeight = (height - 46) + "px";
            try {
                /** @type {?} */
                const fieldNameAndValues = BpmnModelJsonHelper.FromJson(this.billDataInfo.summary, FieldNameAndValue);
                fieldNameAndValues && fieldNameAndValues.forEach((/**
                 * @param {?} fv
                 * @param {?} idx
                 * @return {?}
                 */
                (fv, idx) => {
                    /** @type {?} */
                    const divNodeSummary = document.createElement("div");
                    divNodeSummaryList.appendChild(divNodeSummary);
                    divNodeSummary.classList.add("bif-cell-node-summary");
                    /** @type {?} */
                    const divNodeSummaryCaption = document.createElement("div");
                    divNodeSummary.appendChild(divNodeSummaryCaption);
                    divNodeSummaryCaption.classList.add("bif-cell-node-summary-caption");
                    /** @type {?} */
                    const divNodeSummaryCaptionText = document.createElement("div");
                    divNodeSummaryCaption.appendChild(divNodeSummaryCaptionText);
                    divNodeSummaryCaptionText.classList.add("bif-cell-node-summary-caption-text");
                    divNodeSummaryCaptionText.title = fv.name;
                    divNodeSummaryCaptionText.innerHTML = fv.name;
                    /** @type {?} */
                    const divNodeSummaryValue = document.createElement("div");
                    divNodeSummary.appendChild(divNodeSummaryValue);
                    divNodeSummaryValue.classList.add("bif-cell-node-summary-value");
                    /** @type {?} */
                    const divNodeSummaryValueText = document.createElement("div");
                    divNodeSummaryValue.appendChild(divNodeSummaryValueText);
                    divNodeSummaryValueText.classList.add("bif-cell-node-summary-value-text");
                    divNodeSummaryValueText.title = fv.value;
                    divNodeSummaryValueText.innerText = fv.value;
                    if (idx == 0) {
                        // 判断是否需添加点击事件
                        /** @type {?} */
                        const jqm = this.billInfo.jointQueryMode;
                        /** @type {?} */
                        const jqp = JSON.parse(this.billInfo.jointQueryParameters);
                        if ((jqm == JointQueryMode.APP && jqp.funcId) || (jqm == JointQueryMode.URL && jqp.url)) {
                            divNodeSummaryValueText.classList.add("bif-cell-node-title-link", "bif-cell-node-title-link-color");
                            mxEvent.addListener(divNodeSummaryValueText, "click", (/**
                             * @return {?}
                             */
                            () => {
                                graph.fireEvent(new mxEventObject(Events.CLICK_FIRST_SUMMARY, "cell", this));
                                event.stopPropagation();
                                return false;
                            }));
                        }
                    }
                }));
            }
            catch (e) {
                console.error(e);
            }
        }
        return divNodeRoot;
    }
    /**
     * 通过模板字符串方式创建html
     * @private
     * @param {?} graph
     * @return {?}
     */
    buildHtmlLabelByTemplateText(graph) {
        /** @type {?} */
        const state = graph.view.getState(this);
        /** @type {?} */
        const width = state && state.width ? state.width : this.geometry.width;
        /** @type {?} */
        const height = state && state.height ? state.height : this.geometry.height;
        /** @type {?} */
        let bts = new BillTrackingSettings();
        if (this.billInfo && this.billInfo.billTrackingSettings) {
            bts.LoadFromJson(this.billInfo.billTrackingSettings);
        }
        /** @type {?} */
        const title = this.billDataInfo.caption || bts.billNodeName || this.billInfo.voName || this.billDataInfo.dataId || this.billDataInfo.summary;
        /** @type {?} */
        const titleBackground = this.entry ? "rgba(86,160,255,0.08)" : "#FFFFFF";
        /** @type {?} */
        let summaryHtml = "";
        try {
            /** @type {?} */
            const fieldNameAndValues = BpmnModelJsonHelper.FromJson(this.billDataInfo.summary, FieldNameAndValue);
            fieldNameAndValues && fieldNameAndValues.forEach((/**
             * @param {?} fv
             * @param {?} idx
             * @return {?}
             */
            (fv, idx) => {
                /** @type {?} */
                let valueText = idx == 0 ? `<a href='javascript:void(0);'>${fv.value}</a>` : fv.value;
                summaryHtml += `\
                        <div class="bif-cell-node-summary">\
                            <div class="bif-cell-node-summary-caption">\
                                <div class="bif-cell-node-summary-caption-text" title="${fv.name}">${fv.name}</div>\
                            </div>\
                            <div class="bif-cell-node-summary-value">\
                                <div class="bif-cell-node-summary-value-text" title="${fv.value}">${valueText}</div>\
                            </div>\
                        </div>\
                    `;
            }));
        }
        catch (e) {
            console.error(e);
        }
        /** @type {?} */
        const html = `\
            <div class="bif-cell-node" style="width:${width}px;">\
                <div class="bif-cell-node-main" style="background: ${titleBackground};">\
                    <div class="bif-cell-node-title">\
                        <div class="bif-cell-node-title-text">${title}</div>\
                    </div>\
                    <div class="bif-cell-node-summary-list" style="min-height: ${height - 30}px;">\
                        ${summaryHtml}\
                    </div>\
                </div>\
            </div>\
        `;
        return html;
    }
}
if (false) {
    /** @type {?} */
    BillCell.prototype.THUMB_SCALE;
    /** @type {?} */
    BillCell.prototype.entry;
    /** @type {?} */
    BillCell.prototype.data;
    /** @type {?} */
    BillCell.prototype.billDataInfo;
    /** @type {?} */
    BillCell.prototype.billInfo;
    /** @type {?} */
    BillCell.prototype.downCellOverlay;
    /** @type {?} */
    BillCell.prototype.upCellOverlay;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQmlsbENlbGwuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZWRwLWJpZi9ydW50aW1lLWFwaS8iLCJzb3VyY2VzIjpbImxpYi9iaWxsLXRyYWNrZXIvbXhncmFwaC1leHQvQmlsbENlbGwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxhQUFhLEVBQWEsTUFBTSxtQkFBbUIsQ0FBQztBQUs5RSxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUMxRCxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsY0FBYyxFQUF3QixNQUFNLHFCQUFxQixDQUFDO0FBRWpHLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHlDQUF5QyxDQUFDO0FBRTVFLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFFbEMsTUFBTSxPQUFPLFFBQVMsU0FBUSxNQUFNOzs7Ozs7OztJQVNoQyxZQUFZLFlBQTBCLEVBQUUsUUFBK0MsRUFBRSxLQUFjLEVBQUUsUUFBUyxFQUFFLEtBQU07UUFDdEgsS0FBSyxDQUFDLElBQUksRUFBRSxRQUFRLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFUeEIsZ0JBQVcsR0FBVyxHQUFHLENBQUM7UUFXL0IsSUFBSSxDQUFDLFlBQVksR0FBRyxZQUFZLENBQUM7UUFDakMsSUFBSSxDQUFDLFFBQVEsR0FBRyxRQUFRLENBQUM7O1lBQ3JCLEdBQUcsR0FBeUIsSUFBSSxvQkFBb0IsRUFBRTtRQUMxRCxJQUFJLFFBQVEsSUFBSSxRQUFRLENBQUMsb0JBQW9CLEVBQUU7WUFDM0MsR0FBRyxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUMsb0JBQW9CLENBQUMsQ0FBQztTQUNuRDtRQUNELElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO1FBQ25CLCtJQUErSTtJQUNuSixDQUFDOzs7O0lBRUQsVUFBVTs7WUFDRixLQUFLLEdBQVcsSUFBSTs7WUFDcEIsR0FBRyxHQUF5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LENBQUMsS0FBSyxLQUFLLFNBQVM7OztxQkFHeEYsQ0FBQztZQUNOLENBQUMsRUFDSixDQUFDO1NBQ0w7UUFBQyxPQUFPLENBQUMsRUFBRTtZQUNSLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDcEI7O2NBQ0ssSUFBSSxHQUFHO3NEQUNpQyxLQUFLO3FFQUNVLGVBQWU7O2dFQUVwQixLQUFLOztpRkFFWSxNQUFNLEdBQUcsRUFBRTswQkFDbEUsV0FBVzs7OztTQUk1QjtRQUNELE9BQU8sSUFBSSxDQUFDO0lBQ2hCLENBQUM7Q0FDSjs7O0lBelFHLCtCQUFtQzs7SUFFbkMseUJBQWU7O0lBQ2Ysd0JBQWU7O0lBQ2YsZ0NBQTJCOztJQUMzQiw0QkFBZ0Q7O0lBQ2hELG1DQUE2Qjs7SUFDN0IsaUNBQTJCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgbXhDZWxsLCBteEV2ZW50LCBteEV2ZW50T2JqZWN0LCBNeEdyYXBoTlMgfSBmcm9tIFwiLi4vLi4vcmVmL214Z3JhcGhcIjtcclxuaW1wb3J0IHsgQmlsbERhdGFJbmZvIH0gZnJvbSAnLi4vLi4vZW50aXR5L3RyYWNraW5nL0JpbGxEYXRhSW5mbyc7XHJcbmltcG9ydCB7IERvd25CaWxsSW5mb1Jlc3VsdCB9IGZyb20gJy4uL2FyZ3MvRG93bkJpbGxJbmZvUmVzdWx0JztcclxuaW1wb3J0IHsgVXBCaWxsSW5mb1Jlc3VsdCB9IGZyb20gJy4uL2FyZ3MvVXBCaWxsSW5mb1Jlc3VsdCc7XHJcbmltcG9ydCB7IENlbGxEYXRhIH0gZnJvbSAnLi4vLi4vZW50aXR5L3RyYWNraW5nL2NlbGwtZGF0YS9DZWxsRGF0YSc7XHJcbmltcG9ydCB7IEJwbW5Nb2RlbEpzb25IZWxwZXIgfSBmcm9tIFwiQGVkcC1haWYvY29tbW9uLWFwaVwiO1xyXG5pbXBvcnQgeyBCaWxsVHJhY2tpbmdTZXR0aW5ncywgSm9pbnRRdWVyeU1vZGUsIEpvaW50UXVlcnlQYXJhbWV0ZXJzIH0gZnJvbSAnQGVkcC1iaWYvY29tbW9uLWFwaSc7XHJcbmltcG9ydCB7IEdyYXBoIH0gZnJvbSBcIi4vR3JhcGhcIjtcclxuaW1wb3J0IHsgRmllbGROYW1lQW5kVmFsdWUgfSBmcm9tIFwiLi4vLi4vZW50aXR5L3RyYWNraW5nL0ZpZWxkTmFtZUFuZFZhbHVlXCI7XHJcbmltcG9ydCB7IENlbGxPdmVybGF5IH0gZnJvbSBcIi4vQ2VsbE92ZXJsYXlcIjtcclxuaW1wb3J0IHsgRXZlbnRzIH0gZnJvbSBcIi4vRXZlbnRzXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgQmlsbENlbGwgZXh0ZW5kcyBteENlbGwge1xyXG4gICAgcmVhZG9ubHkgVEhVTUJfU0NBTEU6IG51bWJlciA9IDAuNjtcclxuXHJcbiAgICBlbnRyeTogYm9vbGVhbjtcclxuICAgIGRhdGE6IENlbGxEYXRhO1xyXG4gICAgYmlsbERhdGFJbmZvOiBCaWxsRGF0YUluZm87XHJcbiAgICBiaWxsSW5mbzogRG93bkJpbGxJbmZvUmVzdWx0IHwgVXBCaWxsSW5mb1Jlc3VsdDtcclxuICAgIGRvd25DZWxsT3ZlcmxheTogQ2VsbE92ZXJsYXk7XHJcbiAgICB1cENlbGxPdmVybGF5OiBDZWxsT3ZlcmxheTtcclxuICAgIGNvbnN0cnVjdG9yKGJpbGxEYXRhSW5mbzogQmlsbERhdGFJbmZvLCBiaWxsSW5mbzogRG93bkJpbGxJbmZvUmVzdWx0IHwgVXBCaWxsSW5mb1Jlc3VsdCwgZW50cnk6IGJvb2xlYW4sIGdlb21ldHJ5Pywgc3R5bGU/KSB7XHJcbiAgICAgICAgc3VwZXIobnVsbCwgZ2VvbWV0cnksIHN0eWxlKTtcclxuXHJcbiAgICAgICAgdGhpcy5iaWxsRGF0YUluZm8gPSBiaWxsRGF0YUluZm87XHJcbiAgICAgICAgdGhpcy5iaWxsSW5mbyA9IGJpbGxJbmZvO1xyXG4gICAgICAgIGxldCBidHM6IEJpbGxUcmFja2luZ1NldHRpbmdzID0gbmV3IEJpbGxUcmFja2luZ1NldHRpbmdzKCk7XHJcbiAgICAgICAgaWYgKGJpbGxJbmZvICYmIGJpbGxJbmZvLmJpbGxUcmFja2luZ1NldHRpbmdzKSB7XHJcbiAgICAgICAgICAgIGJ0cy5Mb2FkRnJvbUpzb24oYmlsbEluZm8uYmlsbFRyYWNraW5nU2V0dGluZ3MpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmVudHJ5ID0gZW50cnk7XHJcbiAgICAgICAgLy8gdGhpcy52YWx1ZSA9IHRoaXMuYmlsbERhdGFJbmZvLmNhcHRpb24gfHwgYnRzLmJpbGxOb2RlTmFtZSB8fCB0aGlzLmJpbGxJbmZvLnZvTmFtZSB8fCB0aGlzLmJpbGxEYXRhSW5mby5kYXRhSWQgfHwgdGhpcy5iaWxsRGF0YUluZm8uc3VtbWFyeTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRDYXB0aW9uKCkge1xyXG4gICAgICAgIGxldCBsYWJlbDogc3RyaW5nID0gbnVsbDtcclxuICAgICAgICBsZXQgYnRzOiBCaWxsVHJhY2tpbmdTZXR0aW5ncyA9IG5ldyBCaWxsVHJhY2tpbmdTZXR0aW5ncygpO1xyXG4gICAgICAgIGlmICh0aGlzLmJpbGxJbmZvICYmIHRoaXMuYmlsbEluZm8uYmlsbFRyYWNraW5nU2V0dGluZ3MpIHtcclxuICAgICAgICAgICAgYnRzLkxvYWRGcm9tSnNvbih0aGlzLmJpbGxJbmZvLmJpbGxUcmFja2luZ1NldHRpbmdzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbGFiZWwgPSB0aGlzLmJpbGxEYXRhSW5mby5jYXB0aW9uIHx8IGJ0cy5iaWxsTm9kZU5hbWUgfHwgdGhpcy5iaWxsSW5mby52b05hbWUgfHwgdGhpcy5iaWxsRGF0YUluZm8uZGF0YUlkIHx8IHRoaXMuYmlsbERhdGFJbmZvLnN1bW1hcnk7XHJcbiAgICAgICAgcmV0dXJuIGxhYmVsO1xyXG4gICAgfVxyXG5cclxuICAgIGJ1aWxkSHRtbFRvb2x0aXAoKTogc3RyaW5nIHtcclxuICAgICAgICBjb25zdCB0b29sdGlwSHRtbCA9IGBcXFxyXG4gICAgICAgICAgICA8c3Bhbj4ke3RoaXMuYmlsbERhdGFJbmZvLmRhdGFJZH08L3NwYW4+XFxcclxuICAgICAgICBgO1xyXG4gICAgICAgIHJldHVybiB0b29sdGlwSHRtbDtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOagt+W8j+exu+WcqGdyYXBo57uE5Lu25Lit5a6a5LmJXHJcbiAgICAgKiBAcGFyYW0gZ3JhcGggXHJcbiAgICAgKiBAcmV0dXJucyBcclxuICAgICAqL1xyXG4gICAgYnVpbGRIdG1sTGFiZWwoZ3JhcGg6IEdyYXBoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuYnVpbGRIdG1sTGFiZWxCeURPTShncmFwaCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDpgJrov4fmk43nurVkb23lhYPntKDmlrnlvI/liJvlu7podG1sXHJcbiAgICAgKiBAcGFyYW0gZ3JhcGggXHJcbiAgICAgKiBAcmV0dXJucyBcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBidWlsZEh0bWxMYWJlbEJ5RE9NKGdyYXBoOiBHcmFwaCkge1xyXG4gICAgICAgIGNvbnN0IHNjYWxlID0gZ3JhcGgudmlldy5zY2FsZTtcclxuICAgICAgICBjb25zdCBzdGF0ZSA9IGdyYXBoLnZpZXcuZ2V0U3RhdGUodGhpcyk7XHJcbiAgICAgICAgY29uc3Qgd2lkdGggPSB0aGlzLmdlb21ldHJ5LndpZHRoO1xyXG4gICAgICAgIGNvbnN0IGhlaWdodCA9IHRoaXMuZ2VvbWV0cnkuaGVpZ2h0O1xyXG4gICAgICAgIGxldCBidHM6IEJpbGxUcmFja2luZ1NldHRpbmdzID0gbmV3IEJpbGxUcmFja2luZ1NldHRpbmdzKCk7XHJcbiAgICAgICAgaWYgKHRoaXMuYmlsbEluZm8gJiYgdGhpcy5iaWxsSW5mby5iaWxsVHJhY2tpbmdTZXR0aW5ncykge1xyXG4gICAgICAgICAgICBidHMuTG9hZEZyb21Kc29uKHRoaXMuYmlsbEluZm8uYmlsbFRyYWNraW5nU2V0dGluZ3MpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCB0aXRsZSA9IHRoaXMuYmlsbERhdGFJbmZvLmNhcHRpb24gfHwgYnRzLmJpbGxOb2RlTmFtZSB8fCB0aGlzLmJpbGxJbmZvLnZvTmFtZSB8fCB0aGlzLmJpbGxEYXRhSW5mby5kYXRhSWQgfHwgdGhpcy5iaWxsRGF0YUluZm8uc3VtbWFyeTtcclxuICAgICAgICBjb25zdCBpc0VudHJ5ID0gdGhpcy5lbnRyeTtcclxuXHJcbiAgICAgICAgLy8g6IqC54K55qGG5p62XHJcbiAgICAgICAgY29uc3QgZGl2Tm9kZVJvb3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgIGRpdk5vZGVSb290LmNsYXNzTGlzdC5hZGQoXCJiaWYtY2VsbC1ub2RlXCIpO1xyXG4gICAgICAgIGRpdk5vZGVSb290LnN0eWxlLndpZHRoID0gd2lkdGggKyBcInB4XCI7XHJcbiAgICAgICAgZGl2Tm9kZVJvb3Quc3R5bGUuaGVpZ2h0ID0gaGVpZ2h0ICsgXCJweFwiO1xyXG5cclxuICAgICAgICBpZiAoaXNFbnRyeSkge1xyXG4gICAgICAgICAgICAvLyDlvZPliY3oioLngrnmoIfor4ZcclxuICAgICAgICAgICAgY29uc3QgZGl2Tm9kZUN1cnJlbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgICAgICBkaXZOb2RlUm9vdC5hcHBlbmRDaGlsZChkaXZOb2RlQ3VycmVudCk7XHJcbiAgICAgICAgICAgIGRpdk5vZGVDdXJyZW50LmNsYXNzTGlzdC5hZGQoXCJiaWYtY2VsbC1ub2RlLWN1cnJlbnRcIik7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBzcGFuQ3VycmVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xyXG4gICAgICAgICAgICBkaXZOb2RlQ3VycmVudC5hcHBlbmRDaGlsZChzcGFuQ3VycmVudCk7XHJcbiAgICAgICAgICAgIHNwYW5DdXJyZW50LmNsYXNzTGlzdC5hZGQoXCJiaWYtY2VsbC1ub2RlLWN1cnJlbnQtdGV4dFwiKTtcclxuICAgICAgICAgICAgc3BhbkN1cnJlbnQuaW5uZXJIVE1MID0gZ3JhcGggJiYgZ3JhcGgubG9jYWxlUGlwZSAmJiBncmFwaC5sb2NhbGVQaXBlLnRyYW5zZm9ybShcImN1cnJlbnROb2RlXCIpIHx8IFwi5b2T5YmNXCI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyDlvZPmr5TkvovlsI/liLDmjIflrprlgLzlkI7ku4XmmL7npLrljZXmja7lkI1cclxuICAgICAgICBpZiAoc2NhbGUgPCB0aGlzLlRIVU1CX1NDQUxFKSB7XHJcbiAgICAgICAgICAgIC8vIC8vIOS9v+eUqOWbvueJhyvmoIfpophcclxuICAgICAgICAgICAgLy8gY29uc3QgZGl2Tm9kZVRodW1iID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICAgICAgLy8gZGl2Tm9kZVJvb3QuYXBwZW5kQ2hpbGQoZGl2Tm9kZVRodW1iKTtcclxuICAgICAgICAgICAgLy8gZGl2Tm9kZVRodW1iLmNsYXNzTGlzdC5hZGQoXCJiaWYtY2VsbC1ub2RlLXRodW1iXCIpO1xyXG5cclxuICAgICAgICAgICAgLy8gY29uc3QgZGl2Tm9kZVRodW1iSW1nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICAgICAgLy8gZGl2Tm9kZVRodW1iLmFwcGVuZENoaWxkKGRpdk5vZGVUaHVtYkltZyk7XHJcbiAgICAgICAgICAgIC8vIGRpdk5vZGVUaHVtYkltZy5jbGFzc0xpc3QuYWRkKFwiYmlmLWNlbGwtbm9kZS10aHVtYi1pbWctY29udGFpbmVyXCIpO1xyXG5cclxuICAgICAgICAgICAgLy8gY29uc3QgaW1nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImltZ1wiKTtcclxuICAgICAgICAgICAgLy8gZGl2Tm9kZVRodW1iSW1nLmFwcGVuZENoaWxkKGltZyk7XHJcbiAgICAgICAgICAgIC8vIGltZy5jbGFzc0xpc3QuYWRkKFwiYmlmLWNlbGwtbm9kZS10aHVtYi1pbWdcIik7XHJcbiAgICAgICAgICAgIC8vIGltZy5zcmMgPSBcIi9wbGF0Zm9ybS9ydW50aW1lL2NvbW1vbi93ZWIvQGVkcC1iaWYvcnVudGltZS1hcGkvaW1hZ2VzL25vbi1lbnRyeS1iaWxsLnBuZ1wiO1xyXG5cclxuICAgICAgICAgICAgLy8gY29uc3QgZGl2Tm9kZVRodW1iVGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgICAgICAvLyBkaXZOb2RlVGh1bWIuYXBwZW5kQ2hpbGQoZGl2Tm9kZVRodW1iVGl0bGUpO1xyXG4gICAgICAgICAgICAvLyBkaXZOb2RlVGh1bWJUaXRsZS5jbGFzc0xpc3QuYWRkKFwiYmlmLWNlbGwtbm9kZS10aHVtYi10aXRsZVwiKTtcclxuXHJcbiAgICAgICAgICAgIC8vIGNvbnN0IGRpdk5vZGVUaHVtYlRpdGxlVGV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgICAgIC8vIGRpdk5vZGVUaHVtYlRpdGxlLmFwcGVuZENoaWxkKGRpdk5vZGVUaHVtYlRpdGxlVGV4dCk7XHJcbiAgICAgICAgICAgIC8vIGRpdk5vZGVUaHVtYlRpdGxlVGV4dC5jbGFzc0xpc3QuYWRkKFwiYmlmLWNlbGwtbm9kZS10aHVtYi10aXRsZS10ZXh0XCIpO1xyXG4gICAgICAgICAgICAvLyBkaXZOb2RlVGh1bWJUaXRsZVRleHQuaW5uZXJIVE1MID0gdGl0bGU7XHJcblxyXG4gICAgICAgICAgICAvLyAvLyDliKTmlq3mmK/lkKbpnIDmt7vliqDngrnlh7vkuovku7ZcclxuICAgICAgICAgICAgLy8gY29uc3QganFtID0gdGhpcy5iaWxsSW5mby5qb2ludFF1ZXJ5TW9kZTtcclxuICAgICAgICAgICAgLy8gY29uc3QganFwOiBKb2ludFF1ZXJ5UGFyYW1ldGVycyA9IEpTT04ucGFyc2UodGhpcy5iaWxsSW5mby5qb2ludFF1ZXJ5UGFyYW1ldGVycyk7XHJcbiAgICAgICAgICAgIC8vIGlmICgoanFtID09IEpvaW50UXVlcnlNb2RlLkFQUCAmJiBqcXAuZnVuY0lkKSB8fCAoanFtID09IEpvaW50UXVlcnlNb2RlLlVSTCAmJiBqcXAudXJsKSkge1xyXG4gICAgICAgICAgICAvLyAgICAgZGl2Tm9kZVRodW1iVGl0bGVUZXh0LmNsYXNzTGlzdC5hZGQoXCJiaWYtY2VsbC1ub2RlLXRpdGxlLWxpbmtcIik7XHJcbiAgICAgICAgICAgIC8vICAgICBteEV2ZW50LmFkZExpc3RlbmVyKGRpdk5vZGVUaHVtYlRpdGxlVGV4dCwgXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIC8vICAgICAgICAgZ3JhcGguZmlyZUV2ZW50KG5ldyBteEV2ZW50T2JqZWN0KEV2ZW50cy5DTElDS19GSVJTVF9TVU1NQVJZLCBcImNlbGxcIiwgdGhpcykpO1xyXG4gICAgICAgICAgICAvLyAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgICAgICAvLyAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgLy8gICAgIH0pO1xyXG4gICAgICAgICAgICAvLyB9XHJcblxyXG4gICAgICAgICAgICAvLyDkvb/nlKjmoIfpophcclxuICAgICAgICAgICAgLy8g6IqC54K55qCH6aKYXHJcbiAgICAgICAgICAgIGNvbnN0IGRpdk5vZGVUaXRsZU9ubHkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgICAgICBkaXZOb2RlUm9vdC5hcHBlbmRDaGlsZChkaXZOb2RlVGl0bGVPbmx5KTtcclxuICAgICAgICAgICAgZGl2Tm9kZVRpdGxlT25seS5jbGFzc0xpc3QuYWRkKFwiYmlmLWNlbGwtbm9kZS10aXRsZS1vbmx5XCIpO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgZGl2Tm9kZVRpdGxlT25seVRleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgICAgICBkaXZOb2RlVGl0bGVPbmx5LmFwcGVuZENoaWxkKGRpdk5vZGVUaXRsZU9ubHlUZXh0KTtcclxuICAgICAgICAgICAgZGl2Tm9kZVRpdGxlT25seVRleHQuY2xhc3NMaXN0LmFkZChcImJpZi1jZWxsLW5vZGUtdGl0bGUtb25seS10ZXh0XCIpO1xyXG4gICAgICAgICAgICBkaXZOb2RlVGl0bGVPbmx5VGV4dC5pbm5lckhUTUwgPSB0aXRsZTtcclxuXHJcbiAgICAgICAgICAgIC8vIOWIpOaWreaYr+WQpumcgOa3u+WKoOeCueWHu+S6i+S7tlxyXG4gICAgICAgICAgICBjb25zdCBqcW0gPSB0aGlzLmJpbGxJbmZvLmpvaW50UXVlcnlNb2RlO1xyXG4gICAgICAgICAgICBjb25zdCBqcXA6IEpvaW50UXVlcnlQYXJhbWV0ZXJzID0gSlNPTi5wYXJzZSh0aGlzLmJpbGxJbmZvLmpvaW50UXVlcnlQYXJhbWV0ZXJzKTtcclxuICAgICAgICAgICAgaWYgKChqcW0gPT0gSm9pbnRRdWVyeU1vZGUuQVBQICYmIGpxcC5mdW5jSWQpIHx8IChqcW0gPT0gSm9pbnRRdWVyeU1vZGUuVVJMICYmIGpxcC51cmwpKSB7XHJcbiAgICAgICAgICAgICAgICBkaXZOb2RlVGl0bGVPbmx5VGV4dC5jbGFzc0xpc3QuYWRkKFwiYmlmLWNlbGwtbm9kZS10aXRsZS1saW5rXCIpO1xyXG4gICAgICAgICAgICAgICAgbXhFdmVudC5hZGRMaXN0ZW5lcihkaXZOb2RlVGl0bGVPbmx5VGV4dCwgXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZ3JhcGguZmlyZUV2ZW50KG5ldyBteEV2ZW50T2JqZWN0KEV2ZW50cy5DTElDS19GSVJTVF9TVU1NQVJZLCBcImNlbGxcIiwgdGhpcykpO1xyXG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8g6IqC54K55Li75YaF5a65XHJcbiAgICAgICAgICAgIGNvbnN0IGRpdk5vZGVNYWluID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICAgICAgZGl2Tm9kZVJvb3QuYXBwZW5kQ2hpbGQoZGl2Tm9kZU1haW4pO1xyXG4gICAgICAgICAgICBkaXZOb2RlTWFpbi5jbGFzc0xpc3QuYWRkKFwiYmlmLWNlbGwtbm9kZS1tYWluXCIpO1xyXG5cclxuICAgICAgICAgICAgLy8g6IqC54K55qCH6aKYXHJcbiAgICAgICAgICAgIGNvbnN0IGRpdk5vZGVUaXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgICAgIGRpdk5vZGVNYWluLmFwcGVuZENoaWxkKGRpdk5vZGVUaXRsZSk7XHJcbiAgICAgICAgICAgIGRpdk5vZGVUaXRsZS5jbGFzc0xpc3QuYWRkKFwiYmlmLWNlbGwtbm9kZS10aXRsZVwiKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGRpdk5vZGVUaXRsZVRleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgICAgICBkaXZOb2RlVGl0bGUuYXBwZW5kQ2hpbGQoZGl2Tm9kZVRpdGxlVGV4dCk7XHJcbiAgICAgICAgICAgIGRpdk5vZGVUaXRsZVRleHQuY2xhc3NMaXN0LmFkZChcImJpZi1jZWxsLW5vZGUtdGl0bGUtdGV4dFwiKTtcclxuICAgICAgICAgICAgZGl2Tm9kZVRpdGxlVGV4dC5pbm5lckhUTUwgPSB0aXRsZTtcclxuXHJcbiAgICAgICAgICAgIC8vIOiKgueCueaRmOimgVxyXG4gICAgICAgICAgICBjb25zdCBkaXZOb2RlU3VtbWFyeUxpc3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgICAgICBkaXZOb2RlTWFpbi5hcHBlbmRDaGlsZChkaXZOb2RlU3VtbWFyeUxpc3QpO1xyXG4gICAgICAgICAgICBkaXZOb2RlU3VtbWFyeUxpc3QuY2xhc3NMaXN0LmFkZChcImJpZi1jZWxsLW5vZGUtc3VtbWFyeS1saXN0XCIpO1xyXG4gICAgICAgICAgICAvLyA0NuaYr+agh+mimOagj+mrmOW6plxyXG4gICAgICAgICAgICBkaXZOb2RlU3VtbWFyeUxpc3Quc3R5bGUubWluSGVpZ2h0ID0gKGhlaWdodCAtIDQ2KSArIFwicHhcIjtcclxuXHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBmaWVsZE5hbWVBbmRWYWx1ZXM6IEZpZWxkTmFtZUFuZFZhbHVlW10gPSBCcG1uTW9kZWxKc29uSGVscGVyLkZyb21Kc29uKHRoaXMuYmlsbERhdGFJbmZvLnN1bW1hcnksIEZpZWxkTmFtZUFuZFZhbHVlKTtcclxuICAgICAgICAgICAgICAgIGZpZWxkTmFtZUFuZFZhbHVlcyAmJiBmaWVsZE5hbWVBbmRWYWx1ZXMuZm9yRWFjaChcclxuICAgICAgICAgICAgICAgICAgICAoZnYsIGlkeCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkaXZOb2RlU3VtbWFyeSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpdk5vZGVTdW1tYXJ5TGlzdC5hcHBlbmRDaGlsZChkaXZOb2RlU3VtbWFyeSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpdk5vZGVTdW1tYXJ5LmNsYXNzTGlzdC5hZGQoXCJiaWYtY2VsbC1ub2RlLXN1bW1hcnlcIik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkaXZOb2RlU3VtbWFyeUNhcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXZOb2RlU3VtbWFyeS5hcHBlbmRDaGlsZChkaXZOb2RlU3VtbWFyeUNhcHRpb24pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXZOb2RlU3VtbWFyeUNhcHRpb24uY2xhc3NMaXN0LmFkZChcImJpZi1jZWxsLW5vZGUtc3VtbWFyeS1jYXB0aW9uXCIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGl2Tm9kZVN1bW1hcnlDYXB0aW9uVGV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpdk5vZGVTdW1tYXJ5Q2FwdGlvbi5hcHBlbmRDaGlsZChkaXZOb2RlU3VtbWFyeUNhcHRpb25UZXh0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGl2Tm9kZVN1bW1hcnlDYXB0aW9uVGV4dC5jbGFzc0xpc3QuYWRkKFwiYmlmLWNlbGwtbm9kZS1zdW1tYXJ5LWNhcHRpb24tdGV4dFwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGl2Tm9kZVN1bW1hcnlDYXB0aW9uVGV4dC50aXRsZSA9IGZ2Lm5hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpdk5vZGVTdW1tYXJ5Q2FwdGlvblRleHQuaW5uZXJIVE1MID0gZnYubmFtZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRpdk5vZGVTdW1tYXJ5VmFsdWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXZOb2RlU3VtbWFyeS5hcHBlbmRDaGlsZChkaXZOb2RlU3VtbWFyeVZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGl2Tm9kZVN1bW1hcnlWYWx1ZS5jbGFzc0xpc3QuYWRkKFwiYmlmLWNlbGwtbm9kZS1zdW1tYXJ5LXZhbHVlXCIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGl2Tm9kZVN1bW1hcnlWYWx1ZVRleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXZOb2RlU3VtbWFyeVZhbHVlLmFwcGVuZENoaWxkKGRpdk5vZGVTdW1tYXJ5VmFsdWVUZXh0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGl2Tm9kZVN1bW1hcnlWYWx1ZVRleHQuY2xhc3NMaXN0LmFkZChcImJpZi1jZWxsLW5vZGUtc3VtbWFyeS12YWx1ZS10ZXh0XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXZOb2RlU3VtbWFyeVZhbHVlVGV4dC50aXRsZSA9IGZ2LnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXZOb2RlU3VtbWFyeVZhbHVlVGV4dC5pbm5lclRleHQgPSBmdi52YWx1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpZHggPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g5Yik5pat5piv5ZCm6ZyA5re75Yqg54K55Ye75LqL5Lu2XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBqcW0gPSB0aGlzLmJpbGxJbmZvLmpvaW50UXVlcnlNb2RlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QganFwOiBKb2ludFF1ZXJ5UGFyYW1ldGVycyA9IEpTT04ucGFyc2UodGhpcy5iaWxsSW5mby5qb2ludFF1ZXJ5UGFyYW1ldGVycyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKGpxbSA9PSBKb2ludFF1ZXJ5TW9kZS5BUFAgJiYganFwLmZ1bmNJZCkgfHwgKGpxbSA9PSBKb2ludFF1ZXJ5TW9kZS5VUkwgJiYganFwLnVybCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXZOb2RlU3VtbWFyeVZhbHVlVGV4dC5jbGFzc0xpc3QuYWRkKFwiYmlmLWNlbGwtbm9kZS10aXRsZS1saW5rXCIsIFwiYmlmLWNlbGwtbm9kZS10aXRsZS1saW5rLWNvbG9yXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG14RXZlbnQuYWRkTGlzdGVuZXIoZGl2Tm9kZVN1bW1hcnlWYWx1ZVRleHQsIFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncmFwaC5maXJlRXZlbnQobmV3IG14RXZlbnRPYmplY3QoRXZlbnRzLkNMSUNLX0ZJUlNUX1NVTU1BUlksIFwiY2VsbFwiLCB0aGlzKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBkaXZOb2RlUm9vdDtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOmAmui/h+aooeadv+Wtl+espuS4suaWueW8j+WIm+W7umh0bWxcclxuICAgICAqIEBwYXJhbSBncmFwaCBcclxuICAgICAqIEByZXR1cm5zIFxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGJ1aWxkSHRtbExhYmVsQnlUZW1wbGF0ZVRleHQoZ3JhcGg6IEdyYXBoKSB7XHJcbiAgICAgICAgY29uc3Qgc3RhdGUgPSBncmFwaC52aWV3LmdldFN0YXRlKHRoaXMpO1xyXG4gICAgICAgIGNvbnN0IHdpZHRoID0gc3RhdGUgJiYgc3RhdGUud2lkdGggPyBzdGF0ZS53aWR0aCA6IHRoaXMuZ2VvbWV0cnkud2lkdGg7XHJcbiAgICAgICAgY29uc3QgaGVpZ2h0ID0gc3RhdGUgJiYgc3RhdGUuaGVpZ2h0ID8gc3RhdGUuaGVpZ2h0IDogdGhpcy5nZW9tZXRyeS5oZWlnaHQ7XHJcbiAgICAgICAgbGV0IGJ0czogQmlsbFRyYWNraW5nU2V0dGluZ3MgPSBuZXcgQmlsbFRyYWNraW5nU2V0dGluZ3MoKTtcclxuICAgICAgICBpZiAodGhpcy5iaWxsSW5mbyAmJiB0aGlzLmJpbGxJbmZvLmJpbGxUcmFja2luZ1NldHRpbmdzKSB7XHJcbiAgICAgICAgICAgIGJ0cy5Mb2FkRnJvbUpzb24odGhpcy5iaWxsSW5mby5iaWxsVHJhY2tpbmdTZXR0aW5ncyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHRpdGxlID0gdGhpcy5iaWxsRGF0YUluZm8uY2FwdGlvbiB8fCBidHMuYmlsbE5vZGVOYW1lIHx8IHRoaXMuYmlsbEluZm8udm9OYW1lIHx8IHRoaXMuYmlsbERhdGFJbmZvLmRhdGFJZCB8fCB0aGlzLmJpbGxEYXRhSW5mby5zdW1tYXJ5O1xyXG4gICAgICAgIGNvbnN0IHRpdGxlQmFja2dyb3VuZCA9IHRoaXMuZW50cnkgPyBcInJnYmEoODYsMTYwLDI1NSwwLjA4KVwiIDogXCIjRkZGRkZGXCI7XHJcblxyXG4gICAgICAgIGxldCBzdW1tYXJ5SHRtbCA9IFwiXCI7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgY29uc3QgZmllbGROYW1lQW5kVmFsdWVzOiBGaWVsZE5hbWVBbmRWYWx1ZVtdID0gQnBtbk1vZGVsSnNvbkhlbHBlci5Gcm9tSnNvbih0aGlzLmJpbGxEYXRhSW5mby5zdW1tYXJ5LCBGaWVsZE5hbWVBbmRWYWx1ZSk7XHJcbiAgICAgICAgICAgIGZpZWxkTmFtZUFuZFZhbHVlcyAmJiBmaWVsZE5hbWVBbmRWYWx1ZXMuZm9yRWFjaChcclxuICAgICAgICAgICAgICAgIChmdiwgaWR4KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHZhbHVlVGV4dCA9IGlkeCA9PSAwID8gYDxhIGhyZWY9J2phdmFzY3JpcHQ6dm9pZCgwKTsnPiR7ZnYudmFsdWV9PC9hPmAgOiBmdi52YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICBzdW1tYXJ5SHRtbCArPSBgXFxcclxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImJpZi1jZWxsLW5vZGUtc3VtbWFyeVwiPlxcXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiYmlmLWNlbGwtbm9kZS1zdW1tYXJ5LWNhcHRpb25cIj5cXFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJiaWYtY2VsbC1ub2RlLXN1bW1hcnktY2FwdGlvbi10ZXh0XCIgdGl0bGU9XCIke2Z2Lm5hbWV9XCI+JHtmdi5uYW1lfTwvZGl2PlxcXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cXFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImJpZi1jZWxsLW5vZGUtc3VtbWFyeS12YWx1ZVwiPlxcXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImJpZi1jZWxsLW5vZGUtc3VtbWFyeS12YWx1ZS10ZXh0XCIgdGl0bGU9XCIke2Z2LnZhbHVlfVwiPiR7dmFsdWVUZXh0fTwvZGl2PlxcXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cXFxyXG4gICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cXFxyXG4gICAgICAgICAgICAgICAgICAgIGA7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBodG1sID0gYFxcXHJcbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJiaWYtY2VsbC1ub2RlXCIgc3R5bGU9XCJ3aWR0aDoke3dpZHRofXB4O1wiPlxcXHJcbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiYmlmLWNlbGwtbm9kZS1tYWluXCIgc3R5bGU9XCJiYWNrZ3JvdW5kOiAke3RpdGxlQmFja2dyb3VuZH07XCI+XFxcclxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiYmlmLWNlbGwtbm9kZS10aXRsZVwiPlxcXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJiaWYtY2VsbC1ub2RlLXRpdGxlLXRleHRcIj4ke3RpdGxlfTwvZGl2PlxcXHJcbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XFxcclxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiYmlmLWNlbGwtbm9kZS1zdW1tYXJ5LWxpc3RcIiBzdHlsZT1cIm1pbi1oZWlnaHQ6ICR7aGVpZ2h0IC0gMzB9cHg7XCI+XFxcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHtzdW1tYXJ5SHRtbH1cXFxyXG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxcXHJcbiAgICAgICAgICAgICAgICA8L2Rpdj5cXFxyXG4gICAgICAgICAgICA8L2Rpdj5cXFxyXG4gICAgICAgIGA7XHJcbiAgICAgICAgcmV0dXJuIGh0bWw7XHJcbiAgICB9XHJcbn1cclxuIl19