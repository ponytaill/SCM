/**
 * @fileoverview added by tsickle
 * Generated from: lib/bif-manual-creation/service/bif-target-ui.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Injectable, Injector, ComponentFactoryResolver, NgModuleFactoryLoader, Inject, LOCALE_ID, ComponentRef, Optional } from '@angular/core';
import { Observable, from, of } from 'rxjs';
import { switchMap, catchError } from 'rxjs/operators';
import { FrameContext } from '@farris/devkit';
import { BsModalService } from '@farris/ui-modal';
import { BIF_UISTATE_KEY_CREATION_RESULT } from '../config/bif-form-constants';
import { AbstractUiService } from './abstract-ui-service';
import { BifDataService } from './bif-data.service';
import { PullSelectorComponent } from '../components/pull-selector/pull-selector.component';
import { FormGetBillCreationProcessEntityExArgs } from '../../entity/form-rest/FormGetBillCreationProcessEntityExArgs';
import { ManualCreationMode } from '../../entity/form-rest/ManualCreationMode';
import { FormBillCreationProcessExecutorResult } from '@edp-aif/runtime-api';
import { MessagerService } from '@farris/ui-messager';
import { RuntimeFrameworkService } from '@farris/command-services';
import { judgeBrowserType } from '../../utils/BrowserUtil';
import { TranslateService } from "@ngx-translate/core";
import { AbstractBifDataSelectorService } from './bif-data-selector.service';
import { canJSONParse } from '../../utils/ObjectUtils';
var BifTargetUiService = /** @class */ (function (_super) {
    tslib_1.__extends(BifTargetUiService, _super);
    function BifTargetUiService(dataService, frameContext, modalService, messager, injector, cfr, loader, localeId, runtimeFrameworkService) {
        var _this = _super.call(this, frameContext, modalService, messager, injector, cfr, loader, localeId, runtimeFrameworkService) || this;
        _this.dataService = dataService;
        _this.frameContext = frameContext;
        _this.modalService = modalService;
        _this.messager = messager;
        _this.injector = injector;
        _this.cfr = cfr;
        _this.loader = loader;
        _this.localeId = localeId;
        _this.uiStateKeyCreationResult = BIF_UISTATE_KEY_CREATION_RESULT;
        return _this;
    }
    /**
     * 参照时打开生单规则选择器
     */
    /**
     * 参照时打开生单规则选择器
     * @param {?} downVoId
     * @param {?=} bizFlowchartId
     * @param {?=} modalOptions
     * @param {?=} customSelectorModuleUrl
     * @param {?=} extParams
     * @return {?}
     */
    BifTargetUiService.prototype.openBillCreationProcessSelector4Pull = /**
     * 参照时打开生单规则选择器
     * @param {?} downVoId
     * @param {?=} bizFlowchartId
     * @param {?=} modalOptions
     * @param {?=} customSelectorModuleUrl
     * @param {?=} extParams
     * @return {?}
     */
    function (downVoId, bizFlowchartId, modalOptions, customSelectorModuleUrl, extParams) {
        /** @type {?} */
        var args = new FormGetBillCreationProcessEntityExArgs();
        args.downBillVoId = downVoId;
        args.manualCreationMode = ManualCreationMode.Pull;
        // args.bizFlowchartId = bizFlowchartId;
        return this.openBillCreationProcessSelector(args, PullSelectorComponent, modalOptions, customSelectorModuleUrl, extParams);
    };
    /**
     * 特定参照时打开生单规则选择器
     */
    /**
     * 特定参照时打开生单规则选择器
     * @param {?} upBillVoId
     * @param {?} downVoId
     * @param {?=} bizFlowchartId
     * @param {?=} modalOptions
     * @param {?=} customSelectorModuleUrl
     * @param {?=} extParams
     * @return {?}
     */
    BifTargetUiService.prototype.openBillCreationProcessSelector4SpecificPull = /**
     * 特定参照时打开生单规则选择器
     * @param {?} upBillVoId
     * @param {?} downVoId
     * @param {?=} bizFlowchartId
     * @param {?=} modalOptions
     * @param {?=} customSelectorModuleUrl
     * @param {?=} extParams
     * @return {?}
     */
    function (upBillVoId, downVoId, bizFlowchartId, modalOptions, customSelectorModuleUrl, extParams) {
        /** @type {?} */
        var args = new FormGetBillCreationProcessEntityExArgs();
        args.upBillVoId = upBillVoId;
        args.downBillVoId = downVoId;
        args.manualCreationMode = ManualCreationMode.SpecificPull;
        // args.bizFlowchartId = bizFlowchartId;
        return this.openBillCreationProcessSelector(args, PullSelectorComponent, modalOptions, customSelectorModuleUrl, extParams);
    };
    /**
     * 打开来源单据选择器
     * @param formSettings
     * @param modalOptions
     */
    /**
     * 打开来源单据选择器
     * @param {?=} formSettings
     * @param {?=} modalOptions
     * @param {?=} extParams
     * @return {?}
     */
    BifTargetUiService.prototype.openSourceDataSelector4Pull = /**
     * 打开来源单据选择器
     * @param {?=} formSettings
     * @param {?=} modalOptions
     * @param {?=} extParams
     * @return {?}
     */
    function (formSettings, modalOptions, extParams) {
        var _this = this;
        modalOptions = modalOptions == null ? this.defaultModalOptions : modalOptions;
        modalOptions.title = modalOptions.title == null ? this.localePipe.transform("sourceDataSelector") : modalOptions.title;
        /** @type {?} */
        var cmpR = null;
        if (formSettings == null || formSettings.sourceDataSelectorModuleUrl == null) // 没有配置时加载默认通用单据选择器
         {
            throw "暂无默认实现，请使用自定义来源单据选择器";
            // let cmpF: ComponentFactory<SourceDataSelectorComponent> = this.cfr.resolveComponentFactory(SourceDataSelectorComponent);
            // let inj: Injector = Injector.create([
            // ], this.injector);
            // cmpR = cmpF.create(inj);
            // this.configModalButtons(modalOptions, cmpR);
            // cmpR.instance.bsModalRef4AifSelector = this.modalService.show(cmpR, modalOptions);
            // return cmpR.instance.subject4EntityDatas.asObservable();
        }
        else //加载自定义来源单据选择器 
         {
            // return from(System.import(formSettings.sourceDataSelectorModuleUrl.substring(0, formSettings.sourceDataSelectorModuleUrl.indexOf("#")) + ".js")).pipe(
            /** @type {?} */
            var moduleF$ = null;
            if (formSettings.sourceDataSelectorAppId != null) //配置appId时
             {
                moduleF$ = from(System.import(formSettings.sourceDataSelectorModuleUrl.toLowerCase()).then((/**
                 * @param {?} m
                 * @return {?}
                 */
                function (m) { return m; }))).pipe(switchMap((/**
                 * @param {?} m
                 * @return {?}
                 */
                function (m) {
                    for (var key in m) {
                        return of(m[key]);
                    }
                    return of(null);
                })));
            }
            else //只配置url时 
             {
                moduleF$ = from(this.loader.load(formSettings.sourceDataSelectorModuleUrl));
            }
            return moduleF$.pipe(switchMap((/**
             * @param {?} moduleFactory
             * @return {?}
             */
            function (moduleFactory) {
                /** @type {?} */
                var moduleRef = moduleFactory.create(_this.frameContext.root.injector);
                if (moduleRef.instance.createSourceDataSelector && moduleRef.instance.createSourceDataSelector instanceof Function) //module上定义createSourceDataSelector方法
                 {
                    /** @type {?} */
                    var cmpR$ = moduleRef.instance.createSourceDataSelector(_this.frameContext.root.injector, null, extParams);
                    if (cmpR$ instanceof Observable) {
                        return cmpR$.pipe(switchMap((/**
                         * @param {?} componentRef
                         * @return {?}
                         */
                        function (componentRef) {
                            cmpR = componentRef;
                            _this.configModalButtons(modalOptions, cmpR);
                            cmpR.instance.bsModalRef4BifSelector = _this.modalService.show(cmpR, modalOptions);
                            return cmpR.instance.subject4EntityDatas.asObservable();
                        })));
                    }
                    else if (cmpR$ instanceof ComponentRef) {
                        cmpR = cmpR$;
                        _this.configModalButtons(modalOptions, cmpR);
                        cmpR.instance.bsModalRef4BifSelector = _this.modalService.show(cmpR, modalOptions);
                        return cmpR.instance.subject4EntityDatas.asObservable();
                    }
                }
                else //module上未定义时尝试寻找RootComponent类
                 {
                    /** @type {?} */
                    var translate_1 = moduleRef.injector.get(TranslateService);
                    return translate_1.getTranslation(_this.localeId).pipe(switchMap((/**
                     * @param {?} data
                     * @return {?}
                     */
                    function (data) {
                        translate_1.setTranslation(_this.localeId, data);
                        translate_1.defaultLang = _this.localeId;
                        translate_1.currentLang = _this.localeId;
                        return _this.getEntityData(moduleRef, formSettings, modalOptions, extParams);
                    })), catchError((/**
                     * @param {?} err
                     * @return {?}
                     */
                    function (err) {
                        console.error(err);
                        return _this.getEntityData(moduleRef, formSettings, modalOptions, extParams);
                    })));
                }
            })));
        }
    };
    /**
     * @Deprecated 已弃用，请使用{@link getCreationResult}
     * 获取传到根组件UIState上的生单规则执行器结果
     */
    /**
     * \@Deprecated 已弃用，请使用{\@link getCreationResult}
     * 获取传到根组件UIState上的生单规则执行器结果
     * @return {?}
     */
    BifTargetUiService.prototype.getFormBillCreationProcessExecutorResult = /**
     * \@Deprecated 已弃用，请使用{\@link getCreationResult}
     * 获取传到根组件UIState上的生单规则执行器结果
     * @return {?}
     */
    function () {
        //取得tabId为[AppId]_[AppEntrance]_[tabId]
        /** @type {?} */
        var tabId = this.runtimeFrameworkService.tabId;
        /** @type {?} */
        var dataId = tabId.substr(tabId.length - 36)
        // console.log(tabId);
        // console.log(dataId);
        ;
        // console.log(tabId);
        // console.log(dataId);
        /** @type {?} */
        var browser = judgeBrowserType();
        //IE11浏览器从localStorage取值后并删除, 并存入UIState
        if (browser.type == "IE" && browser.IEVersion == "IE11") {
            /** @type {?} */
            var tmp = window.top.localStorage.getItem(dataId);
            window.top.localStorage.removeItem(dataId);
            this.frameContext.root.uiState.setPropertyValue(this.uiStateKeyCreationResult, tmp);
        }
        /** @type {?} */
        var resTemp = this.frameContext.root.uiState[this.uiStateKeyCreationResult];
        if (resTemp == null) {
            throw "FormBillCreationProcessExecutorResult is null";
        }
        /** @type {?} */
        var result = new FormBillCreationProcessExecutorResult();
        if (typeof resTemp == "string") {
            result.LoadFromJson(resTemp);
        }
        else if (typeof resTemp == "object") {
            result.LoadFromJsonObject(resTemp);
        }
        else {
            throw "不合法的类型";
        }
        return result;
    };
    /**
     * 获取传到根组件UIState上的生单规则执行器结果
     */
    /**
     * 获取传到根组件UIState上的生单规则执行器结果
     * @return {?}
     */
    BifTargetUiService.prototype.getCreationResult = /**
     * 获取传到根组件UIState上的生单规则执行器结果
     * @return {?}
     */
    function () {
        //取得tabId为[AppId]_[AppEntrance]_[tabId]
        /** @type {?} */
        var tabId = this.runtimeFrameworkService.tabId;
        /** @type {?} */
        var dataId = tabId.substr(tabId.length - 36)
        // console.log(tabId);
        // console.log(dataId);
        ;
        // console.log(tabId);
        // console.log(dataId);
        /** @type {?} */
        var browser = judgeBrowserType();
        //IE11浏览器从localStorage取值后并删除, 并存入UIState
        if (browser.type == "IE" && browser.IEVersion == "IE11") {
            /** @type {?} */
            var tmp = window.top.localStorage.getItem(dataId);
            window.top.localStorage.removeItem(dataId);
            this.frameContext.root.uiState.setPropertyValue(this.uiStateKeyCreationResult, tmp);
        }
        /** @type {?} */
        var resTemp = this.frameContext.root.uiState[this.uiStateKeyCreationResult];
        if (resTemp == null) {
            throw "FormBillCreationProcessExecutorResult is null";
        }
        /** @type {?} */
        var result = new FormBillCreationProcessExecutorResult();
        if (typeof resTemp == "string") {
            // 兼容原直接传递生单数据场景
            if (canJSONParse(resTemp)) {
                result.LoadFromJson(resTemp);
                return of(result);
            }
            else {
                /** @type {?} */
                var resultTextId = resTemp;
                return this.dataService.getCreationResultById(resultTextId);
            }
        }
        else if (typeof resTemp == "object") {
            result.LoadFromJsonObject(resTemp);
            return of(result);
        }
        else {
            throw "不合法的类型";
        }
    };
    /**
     * 配置模态框按钮事件
     * @param modalOptions
     * @param cmpR
     */
    /**
     * 配置模态框按钮事件
     * @protected
     * @param {?} modalOptions
     * @param {?} service
     * @return {?}
     */
    BifTargetUiService.prototype.configModalButtonsByService = /**
     * 配置模态框按钮事件
     * @protected
     * @param {?} modalOptions
     * @param {?} service
     * @return {?}
     */
    function (modalOptions, service) {
        modalOptions.buttons = [
            {
                text: this.localePipe.transform("confirm"),
                cls: "btn btn-primary",
                handle: service.clickOk4BifSelector,
            },
            {
                text: this.localePipe.transform("cancel"),
                cls: "btn btn-secondary",
                handle: service.clickClose4BifSelector,
            }
        ];
        modalOptions.showButtons = true;
    };
    /**
     * @protected
     * @param {?} moduleRef
     * @param {?=} formSettings
     * @param {?=} modalOptions
     * @param {?=} extParams
     * @return {?}
     */
    BifTargetUiService.prototype.getEntityData = /**
     * @protected
     * @param {?} moduleRef
     * @param {?=} formSettings
     * @param {?=} modalOptions
     * @param {?=} extParams
     * @return {?}
     */
    function (moduleRef, formSettings, modalOptions, extParams) {
        /** @type {?} */
        var cmpF = null;
        /** @type {?} */
        var cmpR = null;
        /** @type {?} */
        var bootstrapComponentSelector = "app-rootcomponent";
        /** @type {?} */
        var bootstrapComponent = null;
        /** @type {?} */
        var facMap = moduleRef.componentFactoryResolver['_factories'];
        /** @type {?} */
        var subject4EntityDatas = null;
        if (extParams && extParams.bootstrapComponentSelector) //指定了根组件selector
         {
            bootstrapComponentSelector = extParams.bootstrapComponentSelector;
            facMap.forEach((/**
             * @param {?} value
             * @param {?} key
             * @param {?} map
             * @return {?}
             */
            function (value, key, map) {
                /** @type {?} */
                var selector = value.selector;
                if (bootstrapComponentSelector == selector) {
                    cmpF = moduleRef.componentFactoryResolver.resolveComponentFactory((/** @type {?} */ (key)));
                    cmpR = cmpF.create(moduleRef.injector);
                }
            }));
        }
        else //未指定根组件selector 
         {
            bootstrapComponent = moduleRef['_bootstrapComponents'][0];
            if (bootstrapComponent) //先找bootstrapComponent数组有无组件
             {
                cmpF = moduleRef.componentFactoryResolver.resolveComponentFactory(bootstrapComponent);
                cmpR = (/** @type {?} */ (cmpF.create(moduleRef.injector)));
            }
            else //没有则从facMap中查找默认的app-rootcomponent
             {
                facMap.forEach((/**
                 * @param {?} value
                 * @param {?} key
                 * @param {?} map
                 * @return {?}
                 */
                function (value, key, map) {
                    /** @type {?} */
                    var selector = value.selector;
                    if (bootstrapComponentSelector == selector) {
                        cmpF = moduleRef.componentFactoryResolver.resolveComponentFactory((/** @type {?} */ (key)));
                        cmpR = cmpF.create(moduleRef.injector);
                    }
                }));
            }
        }
        if (cmpR && cmpR.instance && cmpR.instance.viewModel && cmpR.instance.viewModel.uiState) {
            cmpR.instance.viewModel.uiState.setPropertyValue("action", "Load1");
            cmpR.instance.viewModel.uiState.setPropertyValue('DEVKIT_DIALOG', true);
        }
        /** @type {?} */
        var dataSelectorService = cmpR.injector.get(AbstractBifDataSelectorService, null);
        if (dataSelectorService != null) // 有AbstractBifDataSelectorService的provider时
         {
            this.configModalButtonsByService(modalOptions, dataSelectorService);
            dataSelectorService.bsModalRef4BifSelector = this.modalService.show(cmpR, modalOptions);
            subject4EntityDatas = dataSelectorService.subject4EntityDatas.asObservable();
        }
        else //没有则从组件上寻找相应属性
         {
            this.configModalButtons(modalOptions, cmpR);
            cmpR.instance.bsModalRef4BifSelector = this.modalService.show(cmpR, modalOptions);
            subject4EntityDatas = cmpR.instance.subject4EntityDatas.asObservable();
        }
        // 此处用于解决任务中心直接打开来源单据帮助时不执行初始化加载命令的问题
        if (cmpR && cmpR.instance && cmpR.instance.viewModel) {
            if (extParams && extParams.loadCommand) {
                /** @type {?} */
                var loadCommand = extParams.loadCommand;
                /** @type {?} */
                var cmdFunc = cmpR.instance.viewModel[loadCommand];
                if (cmdFunc) {
                    /** @type {?} */
                    var args = undefined;
                    if (extParams && extParams.loadParams) {
                        if (Array.isArray(extParams.loadParams)) {
                            args = extParams.loadParams;
                        }
                        else {
                            args = [extParams.loadParams];
                        }
                    }
                    cmdFunc.apply(cmpR.instance.viewModel, args);
                }
            }
        }
        return subject4EntityDatas;
    };
    BifTargetUiService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    BifTargetUiService.ctorParameters = function () { return [
        { type: BifDataService },
        { type: FrameContext },
        { type: BsModalService },
        { type: MessagerService },
        { type: Injector },
        { type: ComponentFactoryResolver },
        { type: NgModuleFactoryLoader },
        { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] },
        { type: RuntimeFrameworkService, decorators: [{ type: Optional }] }
    ]; };
    return BifTargetUiService;
}(AbstractUiService));
export { BifTargetUiService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    BifTargetUiService.prototype.uiStateKeyCreationResult;
    /**
     * @type {?}
     * @protected
     */
    BifTargetUiService.prototype.dataService;
    /**
     * @type {?}
     * @protected
     */
    BifTargetUiService.prototype.frameContext;
    /**
     * @type {?}
     * @protected
     */
    BifTargetUiService.prototype.modalService;
    /**
     * @type {?}
     * @protected
     */
    BifTargetUiService.prototype.messager;
    /**
     * @type {?}
     * @protected
     */
    BifTargetUiService.prototype.injector;
    /**
     * @type {?}
     * @protected
     */
    BifTargetUiService.prototype.cfr;
    /**
     * @type {?}
     * @protected
     */
    BifTargetUiService.prototype.loader;
    /** @type {?} */
    BifTargetUiService.prototype.localeId;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmlmLXRhcmdldC11aS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGVkcC1iaWYvcnVudGltZS1hcGkvIiwic291cmNlcyI6WyJsaWIvYmlmLW1hbnVhbC1jcmVhdGlvbi9zZXJ2aWNlL2JpZi10YXJnZXQtdWkuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSx3QkFBd0IsRUFBRSxxQkFBcUIsRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBbUIsUUFBUSxFQUFpQyxNQUFNLGVBQWUsQ0FBQztBQUNqTSxPQUFPLEVBQUUsVUFBVSxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDNUMsT0FBTyxFQUFFLFNBQVMsRUFBZSxVQUFVLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUVwRSxPQUFPLEVBQUUsWUFBWSxFQUEwQixNQUFNLGdCQUFnQixDQUFDO0FBQ3RFLE9BQU8sRUFBRSxjQUFjLEVBQWdCLE1BQU0sa0JBQWtCLENBQUM7QUFLaEUsT0FBTyxFQUFFLCtCQUErQixFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFDL0UsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDMUQsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQ3BELE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLHFEQUFxRCxDQUFDO0FBRzVGLE9BQU8sRUFBRSxzQ0FBc0MsRUFBRSxNQUFNLCtEQUErRCxDQUFDO0FBQ3ZILE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLDJDQUEyQyxDQUFDO0FBQy9FLE9BQU8sRUFBRSxxQ0FBcUMsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQzdFLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN0RCxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSwwQkFB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LFVBQVUsQ0FBQzt5QkFDL0I7NkJBQU07NEJBQ0gsSUFBSSxHQUFHLENBQUMsU0FBUyxDQUFDLFVBQVUsQ0FBQyxDQUFDO3lCQUNqQztxQkFDSjtvQkFDRCxPQUFPLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxDQUFDO2lCQUNoRDthQUNKO1NBQ0o7UUFDRCxPQUFPLG1CQUFtQixDQUFDO0lBQy9CLENBQUM7O2dCQXJUSixVQUFVOzs7O2dCQWpCRixjQUFjO2dCQVJkLFlBQVk7Z0JBQ1osY0FBYztnQkFjZCxlQUFlO2dCQW5CSCxRQUFRO2dCQUFFLHdCQUF3QjtnQkFBRSxxQkFBcUI7NkNBeUNyRSxNQUFNLFNBQUMsU0FBUztnQkFyQmhCLHVCQUF1Qix1QkFzQnZCLFFBQVE7O0lBeVNqQix5QkFBQztDQUFBLEFBdFRELENBQ3dDLGlCQUFpQixHQXFUeEQ7U0FyVFksa0JBQWtCOzs7Ozs7SUFDM0Isc0RBQW9GOzs7OztJQUdoRix5Q0FBcUM7Ozs7O0lBQ3JDLDBDQUFvQzs7Ozs7SUFDcEMsMENBQXNDOzs7OztJQUN0QyxzQ0FBbUM7Ozs7O0lBQ25DLHNDQUE0Qjs7Ozs7SUFDNUIsaUNBQXVDOzs7OztJQUN2QyxvQ0FBdUM7O0lBQ3ZDLHNDQUEwQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIEluamVjdG9yLCBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsIE5nTW9kdWxlRmFjdG9yeUxvYWRlciwgSW5qZWN0LCBMT0NBTEVfSUQsIENvbXBvbmVudFJlZiwgTmdNb2R1bGVGYWN0b3J5LCBPcHRpb25hbCwgTmdNb2R1bGVSZWYsIENvbXBvbmVudEZhY3RvcnkgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgZnJvbSwgb2YgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgc3dpdGNoTWFwLCBzd2l0Y2hNYXBUbywgY2F0Y2hFcnJvciB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuXHJcbmltcG9ydCB7IEZyYW1lQ29udGV4dCwgRW50aXR5LCBGcmFtZUNvbXBvbmVudCB9IGZyb20gJ0BmYXJyaXMvZGV2a2l0JztcclxuaW1wb3J0IHsgQnNNb2RhbFNlcnZpY2UsIE1vZGFsT3B0aW9ucyB9IGZyb20gJ0BmYXJyaXMvdWktbW9kYWwnO1xyXG5cclxuaW1wb3J0IHsgRm9ybVNldHRpbmdzIH0gZnJvbSAnQGVkcC1haWYvY29tbW9uLWFwaSc7XHJcbmltcG9ydCB7IElSdFNsaW1CaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXggfSBmcm9tIFwiQGVkcC1iaWYvY29tbW9uLWFwaVwiO1xyXG5cclxuaW1wb3J0IHsgQklGX1VJU1RBVEVfS0VZX0NSRUFUSU9OX1JFU1VMVCB9IGZyb20gJy4uL2NvbmZpZy9iaWYtZm9ybS1jb25zdGFudHMnO1xyXG5pbXBvcnQgeyBBYnN0cmFjdFVpU2VydmljZSB9IGZyb20gJy4vYWJzdHJhY3QtdWktc2VydmljZSc7XHJcbmltcG9ydCB7IEJpZkRhdGFTZXJ2aWNlIH0gZnJvbSAnLi9iaWYtZGF0YS5zZXJ2aWNlJztcclxuaW1wb3J0IHsgUHVsbFNlbGVjdG9yQ29tcG9uZW50IH0gZnJvbSAnLi4vY29tcG9uZW50cy9wdWxsLXNlbGVjdG9yL3B1bGwtc2VsZWN0b3IuY29tcG9uZW50JztcclxuaW1wb3J0IHsgSUJpZkRhdGFTZWxlY3RvckNvbXBvbmVudCB9IGZyb20gJy4uL2Jhc2UvSUJpZkRhdGFTZWxlY3RvckNvbXBvbmVudCc7XHJcbmltcG9ydCB7IElCaWZEYXRhU2VsZWN0b3JNb2R1bGUgfSBmcm9tICcuLi9iYXNlL0lCaWZEYXRhU2VsZWN0b3JNb2R1bGUnO1xyXG5pbXBvcnQgeyBGb3JtR2V0QmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4QXJncyB9IGZyb20gJy4uLy4uL2VudGl0eS9mb3JtLXJlc3QvRm9ybUdldEJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeEFyZ3MnO1xyXG5pbXBvcnQgeyBNYW51YWxDcmVhdGlvbk1vZGUgfSBmcm9tICcuLi8uLi9lbnRpdHkvZm9ybS1yZXN0L01hbnVhbENyZWF0aW9uTW9kZSc7XHJcbmltcG9ydCB7IEZvcm1CaWxsQ3JlYXRpb25Qcm9jZXNzRXhlY3V0b3JSZXN1bHQgfSBmcm9tICdAZWRwLWFpZi9ydW50aW1lLWFwaSc7XHJcbmltcG9ydCB7IE1lc3NhZ2VyU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbWVzc2FnZXInO1xyXG5pbXBvcnQgeyBSdW50aW1lRnJhbWV3b3JrU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvY29tbWFuZC1zZXJ2aWNlcyc7XHJcbmltcG9ydCB7IGp1ZGdlQnJvd3NlclR5cGUgfSBmcm9tICcuLi8uLi91dGlscy9Ccm93c2VyVXRpbCc7XHJcbmltcG9ydCB7IFRyYW5zbGF0ZUxvYWRlciwgVHJhbnNsYXRlU2VydmljZSB9IGZyb20gXCJAbmd4LXRyYW5zbGF0ZS9jb3JlXCI7XHJcbmltcG9ydCB7IEFic3RyYWN0QmlmRGF0YVNlbGVjdG9yU2VydmljZSB9IGZyb20gJy4vYmlmLWRhdGEtc2VsZWN0b3Iuc2VydmljZSc7XHJcbmltcG9ydCB7IGNhbkpTT05QYXJzZSB9IGZyb20gJy4uLy4uL3V0aWxzL09iamVjdFV0aWxzJztcclxuXHJcblxyXG5kZWNsYXJlIHZhciBTeXN0ZW06IGFueTtcclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIEJpZlRhcmdldFVpU2VydmljZSBleHRlbmRzIEFic3RyYWN0VWlTZXJ2aWNlIHtcclxuICAgIHByaXZhdGUgcmVhZG9ubHkgdWlTdGF0ZUtleUNyZWF0aW9uUmVzdWx0OiBzdHJpbmcgPSBCSUZfVUlTVEFURV9LRVlfQ1JFQVRJT05fUkVTVUxUO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIHByb3RlY3RlZCBkYXRhU2VydmljZTogQmlmRGF0YVNlcnZpY2UsXHJcbiAgICAgICAgcHJvdGVjdGVkIGZyYW1lQ29udGV4dDogRnJhbWVDb250ZXh0LFxyXG4gICAgICAgIHByb3RlY3RlZCBtb2RhbFNlcnZpY2U6IEJzTW9kYWxTZXJ2aWNlLFxyXG4gICAgICAgIHByb3RlY3RlZCBtZXNzYWdlcjogTWVzc2FnZXJTZXJ2aWNlLFxyXG4gICAgICAgIHByb3RlY3RlZCBpbmplY3RvcjogSW5qZWN0b3IsXHJcbiAgICAgICAgcHJvdGVjdGVkIGNmcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxyXG4gICAgICAgIHByb3RlY3RlZCBsb2FkZXI6IE5nTW9kdWxlRmFjdG9yeUxvYWRlcixcclxuICAgICAgICBASW5qZWN0KExPQ0FMRV9JRCkgcHVibGljIGxvY2FsZUlkOiBzdHJpbmcsXHJcbiAgICAgICAgQE9wdGlvbmFsKCkgcnVudGltZUZyYW1ld29ya1NlcnZpY2U6IFJ1bnRpbWVGcmFtZXdvcmtTZXJ2aWNlLFxyXG4gICAgKSB7XHJcbiAgICAgICAgc3VwZXIoZnJhbWVDb250ZXh0LCBtb2RhbFNlcnZpY2UsIG1lc3NhZ2VyLCBpbmplY3RvciwgY2ZyLCBsb2FkZXIsIGxvY2FsZUlkLCBydW50aW1lRnJhbWV3b3JrU2VydmljZSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDlj4Lnhafml7bmiZPlvIDnlJ/ljZXop4TliJnpgInmi6nlmahcclxuICAgICAqL1xyXG4gICAgcHVibGljIG9wZW5CaWxsQ3JlYXRpb25Qcm9jZXNzU2VsZWN0b3I0UHVsbChkb3duVm9JZDogc3RyaW5nLCBiaXpGbG93Y2hhcnRJZD86IHN0cmluZywgbW9kYWxPcHRpb25zPzogTW9kYWxPcHRpb25zLCBjdXN0b21TZWxlY3Rvck1vZHVsZVVybD86IHN0cmluZywgZXh0UGFyYW1zPzoge30pOiBPYnNlcnZhYmxlPElSdFNsaW1CaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXg+IHtcclxuICAgICAgICBjb25zdCBhcmdzID0gbmV3IEZvcm1HZXRCaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXhBcmdzKCk7XHJcbiAgICAgICAgYXJncy5kb3duQmlsbFZvSWQgPSBkb3duVm9JZDtcclxuICAgICAgICBhcmdzLm1hbnVhbENyZWF0aW9uTW9kZSA9IE1hbnVhbENyZWF0aW9uTW9kZS5QdWxsO1xyXG4gICAgICAgIC8vIGFyZ3MuYml6Rmxvd2NoYXJ0SWQgPSBiaXpGbG93Y2hhcnRJZDtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMub3BlbkJpbGxDcmVhdGlvblByb2Nlc3NTZWxlY3RvcihhcmdzLCBQdWxsU2VsZWN0b3JDb21wb25lbnQsIG1vZGFsT3B0aW9ucywgY3VzdG9tU2VsZWN0b3JNb2R1bGVVcmwsIGV4dFBhcmFtcyk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDnibnlrprlj4Lnhafml7bmiZPlvIDnlJ/ljZXop4TliJnpgInmi6nlmahcclxuICAgICAqL1xyXG4gICAgcHVibGljIG9wZW5CaWxsQ3JlYXRpb25Qcm9jZXNzU2VsZWN0b3I0U3BlY2lmaWNQdWxsKHVwQmlsbFZvSWQ6IHN0cmluZywgZG93blZvSWQ6IHN0cmluZywgYml6Rmxvd2NoYXJ0SWQ/OiBzdHJpbmcsIG1vZGFsT3B0aW9ucz86IE1vZGFsT3B0aW9ucywgY3VzdG9tU2VsZWN0b3JNb2R1bGVVcmw/OiBzdHJpbmcsIGV4dFBhcmFtcz86IHt9KTogT2JzZXJ2YWJsZTxJUnRTbGltQmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4PiB7XHJcbiAgICAgICAgY29uc3QgYXJncyA9IG5ldyBGb3JtR2V0QmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4QXJncygpO1xyXG4gICAgICAgIGFyZ3MudXBCaWxsVm9JZCA9IHVwQmlsbFZvSWQ7XHJcbiAgICAgICAgYXJncy5kb3duQmlsbFZvSWQgPSBkb3duVm9JZDtcclxuICAgICAgICBhcmdzLm1hbnVhbENyZWF0aW9uTW9kZSA9IE1hbnVhbENyZWF0aW9uTW9kZS5TcGVjaWZpY1B1bGw7XHJcbiAgICAgICAgLy8gYXJncy5iaXpGbG93Y2hhcnRJZCA9IGJpekZsb3djaGFydElkO1xyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5vcGVuQmlsbENyZWF0aW9uUHJvY2Vzc1NlbGVjdG9yKGFyZ3MsIFB1bGxTZWxlY3RvckNvbXBvbmVudCwgbW9kYWxPcHRpb25zLCBjdXN0b21TZWxlY3Rvck1vZHVsZVVybCwgZXh0UGFyYW1zKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOaJk+W8gOadpea6kOWNleaNrumAieaLqeWZqFxyXG4gICAgICogQHBhcmFtIGZvcm1TZXR0aW5ncyBcclxuICAgICAqIEBwYXJhbSBtb2RhbE9wdGlvbnMgXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBvcGVuU291cmNlRGF0YVNlbGVjdG9yNFB1bGwoZm9ybVNldHRpbmdzPzogRm9ybVNldHRpbmdzLCBtb2RhbE9wdGlvbnM/OiBNb2RhbE9wdGlvbnMsIGV4dFBhcmFtcz86IHsgYm9vdHN0cmFwQ29tcG9uZW50U2VsZWN0b3I/OiBzdHJpbmcsIFtrZXk6IHN0cmluZ106IGFueSB9KTogT2JzZXJ2YWJsZTxFbnRpdHlbXT4ge1xyXG4gICAgICAgIG1vZGFsT3B0aW9ucyA9IG1vZGFsT3B0aW9ucyA9PSBudWxsID8gdGhpcy5kZWZhdWx0TW9kYWxPcHRpb25zIDogbW9kYWxPcHRpb25zO1xyXG4gICAgICAgIG1vZGFsT3B0aW9ucy50aXRsZSA9IG1vZGFsT3B0aW9ucy50aXRsZSA9PSBudWxsID8gdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybShcInNvdXJjZURhdGFTZWxlY3RvclwiKSA6IG1vZGFsT3B0aW9ucy50aXRsZTtcclxuXHJcbiAgICAgICAgbGV0IGNtcFI6IENvbXBvbmVudFJlZjxJQmlmRGF0YVNlbGVjdG9yQ29tcG9uZW50PiA9IG51bGw7XHJcbiAgICAgICAgaWYgKGZvcm1TZXR0aW5ncyA9PSBudWxsIHx8IGZvcm1TZXR0aW5ncy5zb3VyY2VEYXRhU2VsZWN0b3JNb2R1bGVVcmwgPT0gbnVsbCkgLy8g5rKh5pyJ6YWN572u5pe25Yqg6L296buY6K6k6YCa55So5Y2V5o2u6YCJ5oup5ZmoXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aHJvdyBcIuaaguaXoOm7mOiupOWunueOsO+8jOivt+S9v+eUqOiHquWumuS5ieadpea6kOWNleaNrumAieaLqeWZqFwiO1xyXG4gICAgICAgICAgICAvLyBsZXQgY21wRjogQ29tcG9uZW50RmFjdG9yeTxTb3VyY2VEYXRhU2VsZWN0b3JDb21wb25lbnQ+ID0gdGhpcy5jZnIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoU291cmNlRGF0YVNlbGVjdG9yQ29tcG9uZW50KTtcclxuICAgICAgICAgICAgLy8gbGV0IGluajogSW5qZWN0b3IgPSBJbmplY3Rvci5jcmVhdGUoW1xyXG4gICAgICAgICAgICAvLyBdLCB0aGlzLmluamVjdG9yKTtcclxuICAgICAgICAgICAgLy8gY21wUiA9IGNtcEYuY3JlYXRlKGluaik7XHJcbiAgICAgICAgICAgIC8vIHRoaXMuY29uZmlnTW9kYWxCdXR0b25zKG1vZGFsT3B0aW9ucywgY21wUik7XHJcblxyXG4gICAgICAgICAgICAvLyBjbXBSLmluc3RhbmNlLmJzTW9kYWxSZWY0QWlmU2VsZWN0b3IgPSB0aGlzLm1vZGFsU2VydmljZS5zaG93KGNtcFIsIG1vZGFsT3B0aW9ucyk7XHJcbiAgICAgICAgICAgIC8vIHJldHVybiBjbXBSLmluc3RhbmNlLnN1YmplY3Q0RW50aXR5RGF0YXMuYXNPYnNlcnZhYmxlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgLy/liqDovb3oh6rlrprkuYnmnaXmupDljZXmja7pgInmi6nlmaggXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAvLyByZXR1cm4gZnJvbShTeXN0ZW0uaW1wb3J0KGZvcm1TZXR0aW5ncy5zb3VyY2VEYXRhU2VsZWN0b3JNb2R1bGVVcmwuc3Vic3RyaW5nKDAsIGZvcm1TZXR0aW5ncy5zb3VyY2VEYXRhU2VsZWN0b3JNb2R1bGVVcmwuaW5kZXhPZihcIiNcIikpICsgXCIuanNcIikpLnBpcGUoXHJcbiAgICAgICAgICAgIGxldCBtb2R1bGVGJCA9IG51bGw7XHJcbiAgICAgICAgICAgIGlmIChmb3JtU2V0dGluZ3Muc291cmNlRGF0YVNlbGVjdG9yQXBwSWQgIT0gbnVsbCkgLy/phY3nva5hcHBJZOaXtlxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBtb2R1bGVGJCA9IGZyb20oU3lzdGVtLmltcG9ydChmb3JtU2V0dGluZ3Muc291cmNlRGF0YVNlbGVjdG9yTW9kdWxlVXJsLnRvTG93ZXJDYXNlKCkpLnRoZW4obSA9PiBtKSkucGlwZShcclxuICAgICAgICAgICAgICAgICAgICBzd2l0Y2hNYXAoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIChtOiB7IFtrZXk6IHN0cmluZ106IE5nTW9kdWxlRmFjdG9yeTxJQmlmRGF0YVNlbGVjdG9yTW9kdWxlPiB9KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBrZXkgaW4gbSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvZihtW2tleV0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9mKG51bGwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIC8v5Y+q6YWN572udXJs5pe2IFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBtb2R1bGVGJCA9IGZyb20odGhpcy5sb2FkZXIubG9hZChmb3JtU2V0dGluZ3Muc291cmNlRGF0YVNlbGVjdG9yTW9kdWxlVXJsKSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBtb2R1bGVGJC5waXBlKFxyXG4gICAgICAgICAgICAgICAgc3dpdGNoTWFwKFxyXG4gICAgICAgICAgICAgICAgICAgIChtb2R1bGVGYWN0b3J5OiBOZ01vZHVsZUZhY3Rvcnk8SUJpZkRhdGFTZWxlY3Rvck1vZHVsZT4pID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbW9kdWxlUmVmID0gbW9kdWxlRmFjdG9yeS5jcmVhdGUodGhpcy5mcmFtZUNvbnRleHQucm9vdC5pbmplY3Rvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtb2R1bGVSZWYuaW5zdGFuY2UuY3JlYXRlU291cmNlRGF0YVNlbGVjdG9yICYmIG1vZHVsZVJlZi5pbnN0YW5jZS5jcmVhdGVTb3VyY2VEYXRhU2VsZWN0b3IgaW5zdGFuY2VvZiBGdW5jdGlvbikvL21vZHVsZeS4iuWumuS5iWNyZWF0ZVNvdXJjZURhdGFTZWxlY3RvcuaWueazlVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjbXBSJCA9IG1vZHVsZVJlZi5pbnN0YW5jZS5jcmVhdGVTb3VyY2VEYXRhU2VsZWN0b3IodGhpcy5mcmFtZUNvbnRleHQucm9vdC5pbmplY3RvciwgbnVsbCwgZXh0UGFyYW1zKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjbXBSJCBpbnN0YW5jZW9mIE9ic2VydmFibGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY21wUiQucGlwZShcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoTWFwKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNvbXBvbmVudFJlZikgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNtcFIgPSBjb21wb25lbnRSZWY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25maWdNb2RhbEJ1dHRvbnMobW9kYWxPcHRpb25zLCBjbXBSKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbXBSLmluc3RhbmNlLmJzTW9kYWxSZWY0QmlmU2VsZWN0b3IgPSB0aGlzLm1vZGFsU2VydmljZS5zaG93KGNtcFIsIG1vZGFsT3B0aW9ucyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNtcFIuaW5zdGFuY2Uuc3ViamVjdDRFbnRpdHlEYXRhcy5hc09ic2VydmFibGUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNtcFIkIGluc3RhbmNlb2YgQ29tcG9uZW50UmVmKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY21wUiA9IGNtcFIkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29uZmlnTW9kYWxCdXR0b25zKG1vZGFsT3B0aW9ucywgY21wUik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY21wUi5pbnN0YW5jZS5ic01vZGFsUmVmNEJpZlNlbGVjdG9yID0gdGhpcy5tb2RhbFNlcnZpY2Uuc2hvdyhjbXBSLCBtb2RhbE9wdGlvbnMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjbXBSLmluc3RhbmNlLnN1YmplY3Q0RW50aXR5RGF0YXMuYXNPYnNlcnZhYmxlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSAvL21vZHVsZeS4iuacquWumuS5ieaXtuWwneivleWvu+aJvlJvb3RDb21wb25lbnTnsbtcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdHJhbnNsYXRlOiBUcmFuc2xhdGVTZXJ2aWNlID0gbW9kdWxlUmVmLmluamVjdG9yLmdldChUcmFuc2xhdGVTZXJ2aWNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cmFuc2xhdGUuZ2V0VHJhbnNsYXRpb24odGhpcy5sb2NhbGVJZCkucGlwZShcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2hNYXAoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChkYXRhKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2xhdGUuc2V0VHJhbnNsYXRpb24odGhpcy5sb2NhbGVJZCwgZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2xhdGUuZGVmYXVsdExhbmcgPSB0aGlzLmxvY2FsZUlkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNsYXRlLmN1cnJlbnRMYW5nID0gdGhpcy5sb2NhbGVJZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldEVudGl0eURhdGEobW9kdWxlUmVmLCBmb3JtU2V0dGluZ3MsIG1vZGFsT3B0aW9ucywgZXh0UGFyYW1zKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2hFcnJvcihcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGVycikgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0RW50aXR5RGF0YShtb2R1bGVSZWYsIGZvcm1TZXR0aW5ncywgbW9kYWxPcHRpb25zLCBleHRQYXJhbXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICApXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQERlcHJlY2F0ZWQg5bey5byD55So77yM6K+35L2/55Soe0BsaW5rIGdldENyZWF0aW9uUmVzdWx0fVxyXG4gICAgICog6I635Y+W5Lyg5Yiw5qC557uE5Lu2VUlTdGF0ZeS4iueahOeUn+WNleinhOWImeaJp+ihjOWZqOe7k+aenFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgZ2V0Rm9ybUJpbGxDcmVhdGlvblByb2Nlc3NFeGVjdXRvclJlc3VsdCgpOiBGb3JtQmlsbENyZWF0aW9uUHJvY2Vzc0V4ZWN1dG9yUmVzdWx0IHtcclxuICAgICAgICAvL+WPluW+l3RhYklk5Li6W0FwcElkXV9bQXBwRW50cmFuY2VdX1t0YWJJZF1cclxuICAgICAgICBsZXQgdGFiSWQ6IHN0cmluZyA9IHRoaXMucnVudGltZUZyYW1ld29ya1NlcnZpY2UudGFiSWQ7XHJcbiAgICAgICAgbGV0IGRhdGFJZCA9IHRhYklkLnN1YnN0cih0YWJJZC5sZW5ndGggLSAzNilcclxuICAgICAgICAvLyBjb25zb2xlLmxvZyh0YWJJZCk7XHJcbiAgICAgICAgLy8gY29uc29sZS5sb2coZGF0YUlkKTtcclxuICAgICAgICBjb25zdCBicm93c2VyID0ganVkZ2VCcm93c2VyVHlwZSgpO1xyXG5cclxuICAgICAgICAvL0lFMTHmtY/op4jlmajku45sb2NhbFN0b3JhZ2Xlj5blgLzlkI7lubbliKDpmaQsIOW5tuWtmOWFpVVJU3RhdGVcclxuICAgICAgICBpZiAoYnJvd3Nlci50eXBlID09IFwiSUVcIiAmJiBicm93c2VyLklFVmVyc2lvbiA9PSBcIklFMTFcIikge1xyXG4gICAgICAgICAgICBjb25zdCB0bXAgPSB3aW5kb3cudG9wLmxvY2FsU3RvcmFnZS5nZXRJdGVtKGRhdGFJZCk7XHJcbiAgICAgICAgICAgIHdpbmRvdy50b3AubG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oZGF0YUlkKTtcclxuICAgICAgICAgICAgdGhpcy5mcmFtZUNvbnRleHQucm9vdC51aVN0YXRlLnNldFByb3BlcnR5VmFsdWUodGhpcy51aVN0YXRlS2V5Q3JlYXRpb25SZXN1bHQsIHRtcCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgcmVzVGVtcCA9IHRoaXMuZnJhbWVDb250ZXh0LnJvb3QudWlTdGF0ZVt0aGlzLnVpU3RhdGVLZXlDcmVhdGlvblJlc3VsdF07XHJcbiAgICAgICAgaWYgKHJlc1RlbXAgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aHJvdyBcIkZvcm1CaWxsQ3JlYXRpb25Qcm9jZXNzRXhlY3V0b3JSZXN1bHQgaXMgbnVsbFwiO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCByZXN1bHQgPSBuZXcgRm9ybUJpbGxDcmVhdGlvblByb2Nlc3NFeGVjdXRvclJlc3VsdCgpO1xyXG4gICAgICAgIGlmICh0eXBlb2YgcmVzVGVtcCA9PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgICAgICAgIHJlc3VsdC5Mb2FkRnJvbUpzb24ocmVzVGVtcCk7XHJcbiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgcmVzVGVtcCA9PSBcIm9iamVjdFwiKSB7XHJcbiAgICAgICAgICAgIHJlc3VsdC5Mb2FkRnJvbUpzb25PYmplY3QocmVzVGVtcCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhyb3cgXCLkuI3lkIjms5XnmoTnsbvlnotcIjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOiOt+WPluS8oOWIsOaguee7hOS7tlVJU3RhdGXkuIrnmoTnlJ/ljZXop4TliJnmiafooYzlmajnu5PmnpxcclxuICAgICAqL1xyXG4gICAgcHVibGljIGdldENyZWF0aW9uUmVzdWx0KCk6IE9ic2VydmFibGU8Rm9ybUJpbGxDcmVhdGlvblByb2Nlc3NFeGVjdXRvclJlc3VsdD4ge1xyXG4gICAgICAgIC8v5Y+W5b6XdGFiSWTkuLpbQXBwSWRdX1tBcHBFbnRyYW5jZV1fW3RhYklkXVxyXG4gICAgICAgIGxldCB0YWJJZDogc3RyaW5nID0gdGhpcy5ydW50aW1lRnJhbWV3b3JrU2VydmljZS50YWJJZDtcclxuICAgICAgICBsZXQgZGF0YUlkID0gdGFiSWQuc3Vic3RyKHRhYklkLmxlbmd0aCAtIDM2KVxyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKHRhYklkKTtcclxuICAgICAgICAvLyBjb25zb2xlLmxvZyhkYXRhSWQpO1xyXG4gICAgICAgIGNvbnN0IGJyb3dzZXIgPSBqdWRnZUJyb3dzZXJUeXBlKCk7XHJcblxyXG4gICAgICAgIC8vSUUxMea1j+iniOWZqOS7jmxvY2FsU3RvcmFnZeWPluWAvOWQjuW5tuWIoOmZpCwg5bm25a2Y5YWlVUlTdGF0ZVxyXG4gICAgICAgIGlmIChicm93c2VyLnR5cGUgPT0gXCJJRVwiICYmIGJyb3dzZXIuSUVWZXJzaW9uID09IFwiSUUxMVwiKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRtcCA9IHdpbmRvdy50b3AubG9jYWxTdG9yYWdlLmdldEl0ZW0oZGF0YUlkKTtcclxuICAgICAgICAgICAgd2luZG93LnRvcC5sb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShkYXRhSWQpO1xyXG4gICAgICAgICAgICB0aGlzLmZyYW1lQ29udGV4dC5yb290LnVpU3RhdGUuc2V0UHJvcGVydHlWYWx1ZSh0aGlzLnVpU3RhdGVLZXlDcmVhdGlvblJlc3VsdCwgdG1wKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCByZXNUZW1wID0gdGhpcy5mcmFtZUNvbnRleHQucm9vdC51aVN0YXRlW3RoaXMudWlTdGF0ZUtleUNyZWF0aW9uUmVzdWx0XTtcclxuICAgICAgICBpZiAocmVzVGVtcCA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHRocm93IFwiRm9ybUJpbGxDcmVhdGlvblByb2Nlc3NFeGVjdXRvclJlc3VsdCBpcyBudWxsXCI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IG5ldyBGb3JtQmlsbENyZWF0aW9uUHJvY2Vzc0V4ZWN1dG9yUmVzdWx0KCk7XHJcbiAgICAgICAgaWYgKHR5cGVvZiByZXNUZW1wID09IFwic3RyaW5nXCIpIHtcclxuICAgICAgICAgICAgLy8g5YW85a655Y6f55u05o6l5Lyg6YCS55Sf5Y2V5pWw5o2u5Zy65pmvXHJcbiAgICAgICAgICAgIGlmIChjYW5KU09OUGFyc2UocmVzVGVtcCkpIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdC5Mb2FkRnJvbUpzb24ocmVzVGVtcCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gb2YocmVzdWx0KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdFRleHRJZCA9IHJlc1RlbXA7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5kYXRhU2VydmljZS5nZXRDcmVhdGlvblJlc3VsdEJ5SWQocmVzdWx0VGV4dElkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHJlc1RlbXAgPT0gXCJvYmplY3RcIikge1xyXG4gICAgICAgICAgICByZXN1bHQuTG9hZEZyb21Kc29uT2JqZWN0KHJlc1RlbXApO1xyXG4gICAgICAgICAgICByZXR1cm4gb2YocmVzdWx0KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aHJvdyBcIuS4jeWQiOazleeahOexu+Wei1wiO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOmFjee9ruaooeaAgeahhuaMiemSruS6i+S7tlxyXG4gICAgICogQHBhcmFtIG1vZGFsT3B0aW9ucyBcclxuICAgICAqIEBwYXJhbSBjbXBSIFxyXG4gICAgICovXHJcbiAgICBwcm90ZWN0ZWQgY29uZmlnTW9kYWxCdXR0b25zQnlTZXJ2aWNlKG1vZGFsT3B0aW9uczogTW9kYWxPcHRpb25zLCBzZXJ2aWNlOiBBYnN0cmFjdEJpZkRhdGFTZWxlY3RvclNlcnZpY2UpIHtcclxuICAgICAgICBtb2RhbE9wdGlvbnMuYnV0dG9ucyA9IFtcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdGV4dDogdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybShcImNvbmZpcm1cIiksXHJcbiAgICAgICAgICAgICAgICBjbHM6IFwiYnRuIGJ0bi1wcmltYXJ5XCIsXHJcbiAgICAgICAgICAgICAgICBoYW5kbGU6IHNlcnZpY2UuY2xpY2tPazRCaWZTZWxlY3RvcixcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdGV4dDogdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybShcImNhbmNlbFwiKSxcclxuICAgICAgICAgICAgICAgIGNsczogXCJidG4gYnRuLXNlY29uZGFyeVwiLFxyXG4gICAgICAgICAgICAgICAgaGFuZGxlOiBzZXJ2aWNlLmNsaWNrQ2xvc2U0QmlmU2VsZWN0b3IsXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICBdO1xyXG4gICAgICAgIG1vZGFsT3B0aW9ucy5zaG93QnV0dG9ucyA9IHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgcHJvdGVjdGVkIGdldEVudGl0eURhdGEobW9kdWxlUmVmOiBOZ01vZHVsZVJlZjxhbnk+LCBmb3JtU2V0dGluZ3M/OiBGb3JtU2V0dGluZ3MsIG1vZGFsT3B0aW9ucz86IE1vZGFsT3B0aW9ucywgZXh0UGFyYW1zPzogeyBib290c3RyYXBDb21wb25lbnRTZWxlY3Rvcj86IHN0cmluZywgbG9hZENvbW1hbmQ/OiBzdHJpbmcsIGxvYWRQYXJhbXM/OiBhbnksIFtrZXk6IHN0cmluZ106IGFueSB9KTogT2JzZXJ2YWJsZTxFbnRpdHlbXT4ge1xyXG4gICAgICAgIGxldCBjbXBGOiBDb21wb25lbnRGYWN0b3J5PElCaWZEYXRhU2VsZWN0b3JDb21wb25lbnQgJiBGcmFtZUNvbXBvbmVudD4gPSBudWxsO1xyXG4gICAgICAgIGxldCBjbXBSOiBDb21wb25lbnRSZWY8SUJpZkRhdGFTZWxlY3RvckNvbXBvbmVudCAmIEZyYW1lQ29tcG9uZW50PiA9IG51bGw7XHJcbiAgICAgICAgbGV0IGJvb3RzdHJhcENvbXBvbmVudFNlbGVjdG9yID0gXCJhcHAtcm9vdGNvbXBvbmVudFwiO1xyXG4gICAgICAgIGxldCBib290c3RyYXBDb21wb25lbnQgPSBudWxsO1xyXG4gICAgICAgIGxldCBmYWNNYXA6IE1hcDxhbnksIGFueT4gPSBtb2R1bGVSZWYuY29tcG9uZW50RmFjdG9yeVJlc29sdmVyWydfZmFjdG9yaWVzJ107XHJcbiAgICAgICAgbGV0IHN1YmplY3Q0RW50aXR5RGF0YXM6IE9ic2VydmFibGU8RW50aXR5W10+ID0gbnVsbDtcclxuICAgICAgICBpZiAoZXh0UGFyYW1zICYmIGV4dFBhcmFtcy5ib290c3RyYXBDb21wb25lbnRTZWxlY3RvcikvL+aMh+WumuS6huaguee7hOS7tnNlbGVjdG9yXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBib290c3RyYXBDb21wb25lbnRTZWxlY3RvciA9IGV4dFBhcmFtcy5ib290c3RyYXBDb21wb25lbnRTZWxlY3RvcjtcclxuXHJcbiAgICAgICAgICAgIGZhY01hcC5mb3JFYWNoKCh2YWx1ZTogYW55LCBrZXk6IEZ1bmN0aW9uLCBtYXA6IE1hcDxhbnksIGFueT4pID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdG9yID0gdmFsdWUuc2VsZWN0b3I7XHJcbiAgICAgICAgICAgICAgICBpZiAoYm9vdHN0cmFwQ29tcG9uZW50U2VsZWN0b3IgPT0gc2VsZWN0b3IpIHtcclxuICAgICAgICAgICAgICAgICAgICBjbXBGID0gbW9kdWxlUmVmLmNvbXBvbmVudEZhY3RvcnlSZXNvbHZlci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShrZXkgYXMgYW55KTtcclxuICAgICAgICAgICAgICAgICAgICBjbXBSID0gY21wRi5jcmVhdGUobW9kdWxlUmVmLmluamVjdG9yKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgLy/mnKrmjIflrprmoLnnu4Tku7ZzZWxlY3RvciBcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGJvb3RzdHJhcENvbXBvbmVudCA9IG1vZHVsZVJlZlsnX2Jvb3RzdHJhcENvbXBvbmVudHMnXVswXTtcclxuXHJcbiAgICAgICAgICAgIGlmIChib290c3RyYXBDb21wb25lbnQpLy/lhYjmib5ib290c3RyYXBDb21wb25lbnTmlbDnu4TmnInml6Dnu4Tku7ZcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgY21wRiA9IG1vZHVsZVJlZi5jb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoYm9vdHN0cmFwQ29tcG9uZW50KTtcclxuICAgICAgICAgICAgICAgIGNtcFIgPSBjbXBGLmNyZWF0ZShtb2R1bGVSZWYuaW5qZWN0b3IpIGFzIGFueTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlLy/msqHmnInliJnku45mYWNNYXDkuK3mn6Xmib7pu5jorqTnmoRhcHAtcm9vdGNvbXBvbmVudFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBmYWNNYXAuZm9yRWFjaCgodmFsdWU6IGFueSwga2V5OiBGdW5jdGlvbiwgbWFwOiBNYXA8YW55LCBhbnk+KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0b3IgPSB2YWx1ZS5zZWxlY3RvcjtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYm9vdHN0cmFwQ29tcG9uZW50U2VsZWN0b3IgPT0gc2VsZWN0b3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY21wRiA9IG1vZHVsZVJlZi5jb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIucmVzb2x2ZUNvbXBvbmVudEZhY3Rvcnkoa2V5IGFzIGFueSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNtcFIgPSBjbXBGLmNyZWF0ZShtb2R1bGVSZWYuaW5qZWN0b3IpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChjbXBSICYmIGNtcFIuaW5zdGFuY2UgJiYgY21wUi5pbnN0YW5jZS52aWV3TW9kZWwgJiYgY21wUi5pbnN0YW5jZS52aWV3TW9kZWwudWlTdGF0ZSkge1xyXG4gICAgICAgICAgICBjbXBSLmluc3RhbmNlLnZpZXdNb2RlbC51aVN0YXRlLnNldFByb3BlcnR5VmFsdWUoXCJhY3Rpb25cIiwgXCJMb2FkMVwiKTtcclxuICAgICAgICAgICAgY21wUi5pbnN0YW5jZS52aWV3TW9kZWwudWlTdGF0ZS5zZXRQcm9wZXJ0eVZhbHVlKCdERVZLSVRfRElBTE9HJywgdHJ1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGRhdGFTZWxlY3RvclNlcnZpY2U6IEFic3RyYWN0QmlmRGF0YVNlbGVjdG9yU2VydmljZSA9IGNtcFIuaW5qZWN0b3IuZ2V0KEFic3RyYWN0QmlmRGF0YVNlbGVjdG9yU2VydmljZSwgbnVsbCk7XHJcbiAgICAgICAgaWYgKGRhdGFTZWxlY3RvclNlcnZpY2UgIT0gbnVsbCkgLy8g5pyJQWJzdHJhY3RCaWZEYXRhU2VsZWN0b3JTZXJ2aWNl55qEcHJvdmlkZXLml7ZcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuY29uZmlnTW9kYWxCdXR0b25zQnlTZXJ2aWNlKG1vZGFsT3B0aW9ucywgZGF0YVNlbGVjdG9yU2VydmljZSk7XHJcbiAgICAgICAgICAgIGRhdGFTZWxlY3RvclNlcnZpY2UuYnNNb2RhbFJlZjRCaWZTZWxlY3RvciA9IHRoaXMubW9kYWxTZXJ2aWNlLnNob3coY21wUiwgbW9kYWxPcHRpb25zKTtcclxuICAgICAgICAgICAgc3ViamVjdDRFbnRpdHlEYXRhcyA9IGRhdGFTZWxlY3RvclNlcnZpY2Uuc3ViamVjdDRFbnRpdHlEYXRhcy5hc09ic2VydmFibGUoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSAvL+ayoeacieWImeS7jue7hOS7tuS4iuWvu+aJvuebuOW6lOWxnuaAp1xyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5jb25maWdNb2RhbEJ1dHRvbnMobW9kYWxPcHRpb25zLCBjbXBSKTtcclxuICAgICAgICAgICAgY21wUi5pbnN0YW5jZS5ic01vZGFsUmVmNEJpZlNlbGVjdG9yID0gdGhpcy5tb2RhbFNlcnZpY2Uuc2hvdyhjbXBSLCBtb2RhbE9wdGlvbnMpO1xyXG4gICAgICAgICAgICBzdWJqZWN0NEVudGl0eURhdGFzID0gY21wUi5pbnN0YW5jZS5zdWJqZWN0NEVudGl0eURhdGFzLmFzT2JzZXJ2YWJsZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyDmraTlpITnlKjkuo7op6PlhrPku7vliqHkuK3lv4Pnm7TmjqXmiZPlvIDmnaXmupDljZXmja7luK7liqnml7bkuI3miafooYzliJ3lp4vljJbliqDovb3lkb3ku6TnmoTpl67pophcclxuICAgICAgICBpZiAoY21wUiAmJiBjbXBSLmluc3RhbmNlICYmIGNtcFIuaW5zdGFuY2Uudmlld01vZGVsKSB7XHJcbiAgICAgICAgICAgIGlmIChleHRQYXJhbXMgJiYgZXh0UGFyYW1zLmxvYWRDb21tYW5kKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBsb2FkQ29tbWFuZCA9IGV4dFBhcmFtcy5sb2FkQ29tbWFuZDtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNtZEZ1bmM6IEZ1bmN0aW9uID0gY21wUi5pbnN0YW5jZS52aWV3TW9kZWxbbG9hZENvbW1hbmRdO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNtZEZ1bmMpIHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgYXJncyA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZXh0UGFyYW1zICYmIGV4dFBhcmFtcy5sb2FkUGFyYW1zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGV4dFBhcmFtcy5sb2FkUGFyYW1zKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJncyA9IGV4dFBhcmFtcy5sb2FkUGFyYW1zO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJncyA9IFtleHRQYXJhbXMubG9hZFBhcmFtc107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgY21kRnVuYy5hcHBseShjbXBSLmluc3RhbmNlLnZpZXdNb2RlbCwgYXJncyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHN1YmplY3Q0RW50aXR5RGF0YXM7XHJcbiAgICB9XHJcbn0iXX0=