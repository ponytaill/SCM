/**
 * @fileoverview added by tsickle
 * Generated from: lib/webcmp/bif-manual-creation-data.webcmp.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable, Optional } from '@angular/core';
import { throwError } from 'rxjs';
import { MessagerService } from "@farris/ui-messager";
import { BindingData, ViewModel, FrameContext } from "@farris/devkit";
import { FormBillCreationProcessExecutorArgs } from '../entity/form-rest/FormBillCreationProcessExecutorArgs';
import { FormBillCreationProcessExecutorResult } from '@edp-aif/runtime-api';
import { BifDataService } from '../bif-manual-creation/service/bif-data.service';
import { FormCreateArgs, FormUpdateArgs } from '../ref';
import { PushTaskArgs } from '../bif-manual-creation/args/PushTaskArgs';
import { PushCreationMode } from '@edp-aif/common-api';
import { GetEntityDatasArgs } from '../bif-manual-creation/args/GetEntityDatasArgs';
/**
 * 手工生单数据服务类
 */
var BifManualCreationDataWebCmpService = /** @class */ (function () {
    function BifManualCreationDataWebCmpService(dataService, bindingData, messagerService, viewModel, frameContext) {
        this.dataService = dataService;
        this.bindingData = bindingData;
        this.messagerService = messagerService;
        this.viewModel = viewModel;
        this.frameContext = frameContext;
    }
    /**
     * 根据生单流程Id查找指定的生单流程
     * @param processId 单据流生单流程 Id
     * @returns creationProcess 生单流程 @type { Observable<IRtSlimBillCreationProcessEntityEx> }
     */
    /**
     * 根据生单流程Id查找指定的生单流程
     * @param {?} processId 单据流生单流程 Id
     * @return {?} creationProcess 生单流程 \@type { Observable<IRtSlimBillCreationProcessEntityEx> }
     */
    BifManualCreationDataWebCmpService.prototype.getSlimBillCreationProcessEntityExById = /**
     * 根据生单流程Id查找指定的生单流程
     * @param {?} processId 单据流生单流程 Id
     * @return {?} creationProcess 生单流程 \@type { Observable<IRtSlimBillCreationProcessEntityEx> }
     */
    function (processId) {
        return this.dataService.getSlimBillCreationProcessEntityExById(processId);
    };
    /**
     * 查询表单配置
     * @param formSettingsId 表单配置Id
     * @returns formSettings 表单配置 @type { Observable<FormSettings> }
     */
    /**
     * 查询表单配置
     * @param {?} formSettingsId 表单配置Id
     * @return {?} formSettings 表单配置 \@type { Observable<FormSettings> }
     */
    BifManualCreationDataWebCmpService.prototype.getFormSettingsById = /**
     * 查询表单配置
     * @param {?} formSettingsId 表单配置Id
     * @return {?} formSettings 表单配置 \@type { Observable<FormSettings> }
     */
    function (formSettingsId) {
        return this.dataService.getFormSettingsById(formSettingsId);
    };
    /**
     * 执行生单流程
     * @param entities 参与生单的来源单据列表
     * @param creationProcessId 单据流生单流程 Id
     * @param creationRuleId 生单规则Id（生单流程实体中记录）
     * @returns creationResult 生单结果 @type { Observable<FormBillCreationProcessExecutorResult> }
     */
    /**
     * 执行生单流程
     * @param {?} entities 参与生单的来源单据列表
     * @param {?} creationProcessId 单据流生单流程 Id
     * @param {?} creationRuleId 生单规则Id（生单流程实体中记录）
     * @param {?} targetDataIds
     * @param {?} manualCreationMode
     * @return {?} creationResult 生单结果 \@type { Observable<FormBillCreationProcessExecutorResult> }
     */
    BifManualCreationDataWebCmpService.prototype.executeBillCreationProcess = /**
     * 执行生单流程
     * @param {?} entities 参与生单的来源单据列表
     * @param {?} creationProcessId 单据流生单流程 Id
     * @param {?} creationRuleId 生单规则Id（生单流程实体中记录）
     * @param {?} targetDataIds
     * @param {?} manualCreationMode
     * @return {?} creationResult 生单结果 \@type { Observable<FormBillCreationProcessExecutorResult> }
     */
    function (entities, creationProcessId, creationRuleId, targetDataIds, manualCreationMode) {
        if (entities == null) {
            throw "entities is null.";
        }
        if (entities instanceof Map) {
            entities = Array.from(entities.values());
        }
        entities = Array.isArray(entities) ? entities : [entities];
        //创建执行生单流程参数对象
        /** @type {?} */
        var args = new FormBillCreationProcessExecutorArgs();
        args.billCreationProcessId = creationProcessId;
        args.creationRuleId = creationRuleId;
        //FormCreationRuleExecutorArgs的sourceVoEntityDatas属性为前端实体序列化后的字符串列表
        //sourceVoEntityDatas列表中的每个字符串，在结构上应与单据流定义中所选中的上游视图对象一致。
        args.sourceVoEntityDatas = entities.map((/**
         * @param {?} item
         * @return {?}
         */
        function (item) { return JSON.stringify(item.toJSON(false, true)); }));
        //下推过程中不存在目标主表单据Id，所以targetVoDataIds为空列表。
        args.targetVoDataIds = targetDataIds;
        args.manualCreationMode = manualCreationMode;
        return this.dataService.executeBillCreationProcess(args);
    };
    /**
     * 创建实体数据（RetrieveDefault至缓存）
     * @param formVoId 表单绑定VO Id
     * @param res 生单流程执行结果
     * @returns formCreateResult 创建实体数据返回结果 @type { Observable<FormCreateResult> }
     */
    /**
     * 创建实体数据（RetrieveDefault至缓存）
     * @param {?} formVoId 表单绑定VO Id
     * @param {?} res 生单流程执行结果
     * @return {?} formCreateResult 创建实体数据返回结果 \@type { Observable<FormCreateResult> }
     */
    BifManualCreationDataWebCmpService.prototype.createEntityDatas = /**
     * 创建实体数据（RetrieveDefault至缓存）
     * @param {?} formVoId 表单绑定VO Id
     * @param {?} res 生单流程执行结果
     * @return {?} formCreateResult 创建实体数据返回结果 \@type { Observable<FormCreateResult> }
     */
    function (formVoId, res) {
        /** @type {?} */
        var args = new FormCreateArgs();
        args.formVoId = formVoId;
        //获取生单流程执行结果
        args.rpcCreationRuleExecutorResult = res.creationRuleExecutorResult.ConvertToJson();
        //创建实体数据
        return this.dataService.createEntityDatas(args);
    };
    /**
     * 更新实体数据
     * @param res 生单流程执行结果
     * @returns formUpdateResult 更新实体数据返回结果 @type { Observable<FormUpdateResult> }
     */
    /**
     * 更新实体数据
     * @param {?} res 生单流程执行结果
     * @return {?} formUpdateResult 更新实体数据返回结果 \@type { Observable<FormUpdateResult> }
     */
    BifManualCreationDataWebCmpService.prototype.updateEntityDatas = /**
     * 更新实体数据
     * @param {?} res 生单流程执行结果
     * @return {?} formUpdateResult 更新实体数据返回结果 \@type { Observable<FormUpdateResult> }
     */
    function (res) {
        /** @type {?} */
        var args = new FormUpdateArgs();
        //Mapping执行条件判断结果为true时才会执行生单流程得到生单结果
        if (res.conditionResult.conditionExecutionResult == true) {
            //生单结果不为空
            if (res.creationRuleExecutorResult && res.creationRuleExecutorResult.mappingResults && res.creationRuleExecutorResult.mappingResults.length > 0) {
                args.rpcCreationRuleExecutorResult = res.creationRuleExecutorResult.ConvertToJson();
                return this.dataService.updateEntityDatas(args);
            }
            else {
                return throwError("creationRuleExecutorResult is empty!");
            }
        }
        else {
            return throwError("conditionExecutionResult is false!");
        }
    };
    /**
     * 推送任务中心
     * @param res 生单流程执行结果
     * @returns formUpdateResult 更新实体数据返回结果 @type { Observable<FormUpdateResult> }
     */
    /**
     * 推送任务中心
     * @param {?} res 生单流程执行结果
     * @return {?} formUpdateResult 更新实体数据返回结果 \@type { Observable<FormUpdateResult> }
     */
    BifManualCreationDataWebCmpService.prototype.pushTaskCenter = /**
     * 推送任务中心
     * @param {?} res 生单流程执行结果
     * @return {?} formUpdateResult 更新实体数据返回结果 \@type { Observable<FormUpdateResult> }
     */
    function (res) {
        /** @type {?} */
        var args = new PushTaskArgs();
        //Mapping执行条件判断结果为true时才会执行生单流程得到生单结果
        if (res.conditionResult.conditionExecutionResult == true) {
            //生单结果不为空
            if (res.creationRuleExecutorResult && res.creationRuleExecutorResult.mappingResults && res.creationRuleExecutorResult.mappingResults.length > 0) {
                if (res.pushCreationMode == PushCreationMode.TASKCENTER) {
                    args.suCode = res.downBillSuCode;
                    args.creationRuleExecutorResult = res.creationRuleExecutorResult;
                    return this.dataService.pushTaskCenter(args);
                }
                else {
                    return throwError("creationRuleExecutorResult can't be pushed to task center!");
                }
            }
            else {
                return throwError("creationRuleExecutorResult is empty!");
            }
        }
        else {
            return throwError("conditionExecutionResult is false!");
        }
    };
    /**
     * 查询生单结果
     * @param creationResultId 生单结果id
     */
    /**
     * 查询生单结果
     * @param {?} creationResultId 生单结果id
     * @return {?}
     */
    BifManualCreationDataWebCmpService.prototype.getCreationResultById = /**
     * 查询生单结果
     * @param {?} creationResultId 生单结果id
     * @return {?}
     */
    function (creationResultId) {
        return this.dataService.getCreationResultById(creationResultId);
    };
    /**
     * 暂存生单结果
     */
    /**
     * 暂存生单结果
     * @param {?} creationResult
     * @return {?}
     */
    BifManualCreationDataWebCmpService.prototype.addFormBillCreationProcessExecutorResult = /**
     * 暂存生单结果
     * @param {?} creationResult
     * @return {?}
     */
    function (creationResult) {
        if (creationResult == null) {
            throw "参数creationResult不可为空";
        }
        if (typeof creationResult == "string") {
            if (creationResult == "") {
                throw "参数creationResult不可为空";
            }
            /** @type {?} */
            var temp = new FormBillCreationProcessExecutorResult();
            temp.LoadFromJson(creationResult);
            creationResult = temp;
        }
        if ((creationResult instanceof FormBillCreationProcessExecutorResult) == false) {
            /** @type {?} */
            var res = new FormBillCreationProcessExecutorResult();
            res.LoadFromJsonObject(creationResult);
            creationResult = res;
        }
        return this.dataService.addFormBillCreationProcessExecutorResult(creationResult);
    };
    /**
     * 获取VO序列化数据
     */
    /**
     * 获取VO序列化数据
     * @param args
     * @returns
     */
    /**
         * 获取VO序列化数据
         */
    /**
     * 获取VO序列化数据
     * @param {?} dataId
     * @param {?} voId
     * @param {?} suCode
     * @return {?}
     */
    BifManualCreationDataWebCmpService.prototype.getEntityDatas = /**
         * 获取VO序列化数据
         */
    /**
     * 获取VO序列化数据
     * @param {?} dataId
     * @param {?} voId
     * @param {?} suCode
     * @return {?}
     */
    function (dataId, voId, suCode) {
        if (dataId == null) {
            throw "参数dataId不可为空";
        }
        if (voId == null) {
            throw "参数voId不可为空";
        }
        if (suCode == null) {
            throw "参数suCode不可为空";
        }
        /** @type {?} */
        var args = new GetEntityDatasArgs();
        args.dataId = dataId;
        args.suCode = suCode;
        args.voId = voId;
        return this.dataService.getEntityDatas(args);
    };
    BifManualCreationDataWebCmpService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    BifManualCreationDataWebCmpService.ctorParameters = function () { return [
        { type: BifDataService },
        { type: BindingData },
        { type: MessagerService },
        { type: ViewModel, decorators: [{ type: Optional }] },
        { type: FrameContext, decorators: [{ type: Optional }] }
    ]; };
    return BifManualCreationDataWebCmpService;
}());
export { BifManualCreationDataWebCmpService };
if (false) {
    /** @type {?} */
    BifManualCreationDataWebCmpService.prototype.dataService;
    /** @type {?} */
    BifManualCreationDataWebCmpService.prototype.bindingData;
    /** @type {?} */
    BifManualCreationDataWebCmpService.prototype.messagerService;
    /** @type {?} */
    BifManualCreationDataWebCmpService.prototype.viewModel;
    /** @type {?} */
    BifManualCreationDataWebCmpService.prototype.frameContext;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmlmLW1hbnVhbC1jcmVhdGlvbi1kYXRhLndlYmNtcC5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGVkcC1iaWYvcnVudGltZS1hcGkvIiwic291cmNlcyI6WyJsaWIvd2ViY21wL2JpZi1tYW51YWwtY3JlYXRpb24tZGF0YS53ZWJjbXAuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3JELE9BQU8sRUFBYyxVQUFVLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFFOUMsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBR3RELE9BQU8sRUFBVSxXQUFXLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRzlFLE9BQU8sRUFBRSxtQ0FBbUMsRUFBRSxNQUFNLHlEQUF5RCxDQUFDO0FBQzlHLE9BQU8sRUFBRSxxQ0FBcUMsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQzdFLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxpREFBaUQsQ0FBQztBQUNqRixPQUFPLEVBQUUsY0FBYyxFQUFzQyxjQUFjLEVBQUUsTUFBTSxRQUFRLENBQUM7QUFDNUYsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLDBDQUEwQyxDQUFDO0FBQ3hFLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBRXZELE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLGdEQUFnRCxDQUFDOzs7O0FBTXBGO0lBRUksNENBQ1csV0FBMkIsRUFDM0IsV0FBd0IsRUFDeEIsZUFBZ0MsRUFDcEIsU0FBb0IsRUFDcEIsWUFBMEI7UUFKdEMsZ0JBQVcsR0FBWCxXQUFXLENBQWdCO1FBQzNCLGdCQUFXLEdBQVgsV0FBVyxDQUFhO1FBQ3hCLG9CQUFlLEdBQWYsZUFBZSxDQUFpQjtRQUNwQixjQUFTLEdBQVQsU0FBUyxDQUFX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QUFNLENBQUM7UUFDckIsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFFakIsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNqRCxDQUFDOztnQkEvS0osVUFBVTs7OztnQkFYRixjQUFjO2dCQUxOLFdBQVc7Z0JBSG5CLGVBQWU7Z0JBR00sU0FBUyx1QkFzQjlCLFFBQVE7Z0JBdEJ3QixZQUFZLHVCQXVCNUMsUUFBUTs7SUF5S2pCLHlDQUFDO0NBQUEsQUFoTEQsSUFnTEM7U0EvS1ksa0NBQWtDOzs7SUFFdkMseURBQWtDOztJQUNsQyx5REFBK0I7O0lBQy9CLDZEQUF1Qzs7SUFDdkMsdURBQXVDOztJQUN2QywwREFBNkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlLCBPcHRpb25hbCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlLCB0aHJvd0Vycm9yIH0gZnJvbSAncnhqcyc7XHJcblxyXG5pbXBvcnQgeyBNZXNzYWdlclNlcnZpY2UgfSBmcm9tIFwiQGZhcnJpcy91aS1tZXNzYWdlclwiO1xyXG5pbXBvcnQgeyBNb2RhbE9wdGlvbnMgfSBmcm9tICdAZmFycmlzL3VpLW1vZGFsJztcclxuXHJcbmltcG9ydCB7IEVudGl0eSwgQmluZGluZ0RhdGEsIFZpZXdNb2RlbCwgRnJhbWVDb250ZXh0IH0gZnJvbSBcIkBmYXJyaXMvZGV2a2l0XCI7XHJcblxyXG5pbXBvcnQgeyBJUnRTbGltQmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4LCBGb3JtU2V0dGluZ3MgfSBmcm9tIFwiQGVkcC1iaWYvY29tbW9uLWFwaVwiO1xyXG5pbXBvcnQgeyBGb3JtQmlsbENyZWF0aW9uUHJvY2Vzc0V4ZWN1dG9yQXJncyB9IGZyb20gJy4uL2VudGl0eS9mb3JtLXJlc3QvRm9ybUJpbGxDcmVhdGlvblByb2Nlc3NFeGVjdXRvckFyZ3MnO1xyXG5pbXBvcnQgeyBGb3JtQmlsbENyZWF0aW9uUHJvY2Vzc0V4ZWN1dG9yUmVzdWx0IH0gZnJvbSAnQGVkcC1haWYvcnVudGltZS1hcGknO1xyXG5pbXBvcnQgeyBCaWZEYXRhU2VydmljZSB9IGZyb20gJy4uL2JpZi1tYW51YWwtY3JlYXRpb24vc2VydmljZS9iaWYtZGF0YS5zZXJ2aWNlJztcclxuaW1wb3J0IHsgRm9ybUNyZWF0ZUFyZ3MsIEZvcm1DcmVhdGVSZXN1bHQsIEZvcm1VcGRhdGVSZXN1bHQsIEZvcm1VcGRhdGVBcmdzIH0gZnJvbSAnLi4vcmVmJztcclxuaW1wb3J0IHsgUHVzaFRhc2tBcmdzIH0gZnJvbSAnLi4vYmlmLW1hbnVhbC1jcmVhdGlvbi9hcmdzL1B1c2hUYXNrQXJncyc7XHJcbmltcG9ydCB7IFB1c2hDcmVhdGlvbk1vZGUgfSBmcm9tICdAZWRwLWFpZi9jb21tb24tYXBpJztcclxuaW1wb3J0IHsgR2VuZXJhbFRleHRJZFdpdGhEYXRhSWQgfSBmcm9tICcuLi9lbnRpdHkvZm9ybS1yZXN0L0dlbmVyYWxUZXh0SWRXaXRoRGF0YUlkJztcclxuaW1wb3J0IHsgR2V0RW50aXR5RGF0YXNBcmdzIH0gZnJvbSAnLi4vYmlmLW1hbnVhbC1jcmVhdGlvbi9hcmdzL0dldEVudGl0eURhdGFzQXJncyc7XHJcbmltcG9ydCB7IE1hbnVhbENyZWF0aW9uTW9kZSB9IGZyb20gJy4uL2VudGl0eS9mb3JtLXJlc3QvTWFudWFsQ3JlYXRpb25Nb2RlJztcclxuXHJcbi8qKlxyXG4gKiDmiYvlt6XnlJ/ljZXmlbDmja7mnI3liqHnsbtcclxuICovXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIEJpZk1hbnVhbENyZWF0aW9uRGF0YVdlYkNtcFNlcnZpY2Uge1xyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgcHVibGljIGRhdGFTZXJ2aWNlOiBCaWZEYXRhU2VydmljZSxcclxuICAgICAgICBwdWJsaWMgYmluZGluZ0RhdGE6IEJpbmRpbmdEYXRhLFxyXG4gICAgICAgIHB1YmxpYyBtZXNzYWdlclNlcnZpY2U6IE1lc3NhZ2VyU2VydmljZSxcclxuICAgICAgICBAT3B0aW9uYWwoKSBwdWJsaWMgdmlld01vZGVsOiBWaWV3TW9kZWwsXHJcbiAgICAgICAgQE9wdGlvbmFsKCkgcHVibGljIGZyYW1lQ29udGV4dDogRnJhbWVDb250ZXh0LFxyXG4gICAgKSB7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5qC55o2u55Sf5Y2V5rWB56iLSWTmn6Xmib7mjIflrprnmoTnlJ/ljZXmtYHnqItcclxuICAgICAqIEBwYXJhbSBwcm9jZXNzSWQg5Y2V5o2u5rWB55Sf5Y2V5rWB56iLIElkXHJcbiAgICAgKiBAcmV0dXJucyBjcmVhdGlvblByb2Nlc3Mg55Sf5Y2V5rWB56iLIEB0eXBlIHsgT2JzZXJ2YWJsZTxJUnRTbGltQmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4PiB9XHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBnZXRTbGltQmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4QnlJZChwcm9jZXNzSWQ6IHN0cmluZyk6IE9ic2VydmFibGU8SVJ0U2xpbUJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeD4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmRhdGFTZXJ2aWNlLmdldFNsaW1CaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXhCeUlkKHByb2Nlc3NJZCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmn6Xor6LooajljZXphY3nva5cclxuICAgICAqIEBwYXJhbSBmb3JtU2V0dGluZ3NJZCDooajljZXphY3nva5JZFxyXG4gICAgICogQHJldHVybnMgZm9ybVNldHRpbmdzIOihqOWNlemFjee9riBAdHlwZSB7IE9ic2VydmFibGU8Rm9ybVNldHRpbmdzPiB9XHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBnZXRGb3JtU2V0dGluZ3NCeUlkKGZvcm1TZXR0aW5nc0lkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPEZvcm1TZXR0aW5ncz4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmRhdGFTZXJ2aWNlLmdldEZvcm1TZXR0aW5nc0J5SWQoZm9ybVNldHRpbmdzSWQpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5omn6KGM55Sf5Y2V5rWB56iLXHJcbiAgICAgKiBAcGFyYW0gZW50aXRpZXMg5Y+C5LiO55Sf5Y2V55qE5p2l5rqQ5Y2V5o2u5YiX6KGoXHJcbiAgICAgKiBAcGFyYW0gY3JlYXRpb25Qcm9jZXNzSWQg5Y2V5o2u5rWB55Sf5Y2V5rWB56iLIElkXHJcbiAgICAgKiBAcGFyYW0gY3JlYXRpb25SdWxlSWQg55Sf5Y2V6KeE5YiZSWTvvIjnlJ/ljZXmtYHnqIvlrp7kvZPkuK3orrDlvZXvvIlcclxuICAgICAqIEByZXR1cm5zIGNyZWF0aW9uUmVzdWx0IOeUn+WNlee7k+aenCBAdHlwZSB7IE9ic2VydmFibGU8Rm9ybUJpbGxDcmVhdGlvblByb2Nlc3NFeGVjdXRvclJlc3VsdD4gfVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgZXhlY3V0ZUJpbGxDcmVhdGlvblByb2Nlc3MoZW50aXRpZXM6IEVudGl0eVtdLCBjcmVhdGlvblByb2Nlc3NJZDogc3RyaW5nLCBjcmVhdGlvblJ1bGVJZDogc3RyaW5nLCB0YXJnZXREYXRhSWRzOiBzdHJpbmdbXSwgbWFudWFsQ3JlYXRpb25Nb2RlOiBNYW51YWxDcmVhdGlvbk1vZGUpOiBPYnNlcnZhYmxlPEZvcm1CaWxsQ3JlYXRpb25Qcm9jZXNzRXhlY3V0b3JSZXN1bHQ+IHtcclxuICAgICAgICBpZiAoZW50aXRpZXMgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aHJvdyBcImVudGl0aWVzIGlzIG51bGwuXCI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChlbnRpdGllcyBpbnN0YW5jZW9mIE1hcCkge1xyXG4gICAgICAgICAgICBlbnRpdGllcyA9IEFycmF5LmZyb20oZW50aXRpZXMudmFsdWVzKCkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbnRpdGllcyA9IEFycmF5LmlzQXJyYXkoZW50aXRpZXMpID8gZW50aXRpZXMgOiBbZW50aXRpZXNdO1xyXG4gICAgICAgIC8v5Yib5bu65omn6KGM55Sf5Y2V5rWB56iL5Y+C5pWw5a+56LGhXHJcbiAgICAgICAgY29uc3QgYXJncyA9IG5ldyBGb3JtQmlsbENyZWF0aW9uUHJvY2Vzc0V4ZWN1dG9yQXJncygpO1xyXG4gICAgICAgIGFyZ3MuYmlsbENyZWF0aW9uUHJvY2Vzc0lkID0gY3JlYXRpb25Qcm9jZXNzSWQ7XHJcbiAgICAgICAgYXJncy5jcmVhdGlvblJ1bGVJZCA9IGNyZWF0aW9uUnVsZUlkO1xyXG4gICAgICAgIC8vRm9ybUNyZWF0aW9uUnVsZUV4ZWN1dG9yQXJnc+eahHNvdXJjZVZvRW50aXR5RGF0YXPlsZ7mgKfkuLrliY3nq6/lrp7kvZPluo/liJfljJblkI7nmoTlrZfnrKbkuLLliJfooahcclxuICAgICAgICAvL3NvdXJjZVZvRW50aXR5RGF0YXPliJfooajkuK3nmoTmr4/kuKrlrZfnrKbkuLLvvIzlnKjnu5PmnoTkuIrlupTkuI7ljZXmja7mtYHlrprkuYnkuK3miYDpgInkuK3nmoTkuIrmuLjop4blm77lr7nosaHkuIDoh7TjgIJcclxuICAgICAgICBhcmdzLnNvdXJjZVZvRW50aXR5RGF0YXMgPSBlbnRpdGllcy5tYXAoaXRlbSA9PiBKU09OLnN0cmluZ2lmeShpdGVtLnRvSlNPTihmYWxzZSwgdHJ1ZSkpKTtcclxuICAgICAgICAvL+S4i+aOqOi/h+eoi+S4reS4jeWtmOWcqOebruagh+S4u+ihqOWNleaNrklk77yM5omA5LuldGFyZ2V0Vm9EYXRhSWRz5Li656m65YiX6KGo44CCXHJcbiAgICAgICAgYXJncy50YXJnZXRWb0RhdGFJZHMgPSB0YXJnZXREYXRhSWRzO1xyXG4gICAgICAgIGFyZ3MubWFudWFsQ3JlYXRpb25Nb2RlID0gbWFudWFsQ3JlYXRpb25Nb2RlO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmRhdGFTZXJ2aWNlLmV4ZWN1dGVCaWxsQ3JlYXRpb25Qcm9jZXNzKGFyZ3MpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5Yib5bu65a6e5L2T5pWw5o2u77yIUmV0cmlldmVEZWZhdWx06Iez57yT5a2Y77yJXHJcbiAgICAgKiBAcGFyYW0gZm9ybVZvSWQg6KGo5Y2V57uR5a6aVk8gSWRcclxuICAgICAqIEBwYXJhbSByZXMg55Sf5Y2V5rWB56iL5omn6KGM57uT5p6cXHJcbiAgICAgKiBAcmV0dXJucyBmb3JtQ3JlYXRlUmVzdWx0IOWIm+W7uuWunuS9k+aVsOaNrui/lOWbnue7k+aenCBAdHlwZSB7IE9ic2VydmFibGU8Rm9ybUNyZWF0ZVJlc3VsdD4gfVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgY3JlYXRlRW50aXR5RGF0YXMoZm9ybVZvSWQ6IHN0cmluZywgcmVzOiBGb3JtQmlsbENyZWF0aW9uUHJvY2Vzc0V4ZWN1dG9yUmVzdWx0KTogT2JzZXJ2YWJsZTxGb3JtQ3JlYXRlUmVzdWx0PiB7XHJcbiAgICAgICAgY29uc3QgYXJncyA9IG5ldyBGb3JtQ3JlYXRlQXJncygpO1xyXG4gICAgICAgIGFyZ3MuZm9ybVZvSWQgPSBmb3JtVm9JZDtcclxuICAgICAgICAvL+iOt+WPlueUn+WNlea1geeoi+aJp+ihjOe7k+aenFxyXG4gICAgICAgIGFyZ3MucnBjQ3JlYXRpb25SdWxlRXhlY3V0b3JSZXN1bHQgPSByZXMuY3JlYXRpb25SdWxlRXhlY3V0b3JSZXN1bHQuQ29udmVydFRvSnNvbigpO1xyXG4gICAgICAgIC8v5Yib5bu65a6e5L2T5pWw5o2uXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZGF0YVNlcnZpY2UuY3JlYXRlRW50aXR5RGF0YXMoYXJncyk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmm7TmlrDlrp7kvZPmlbDmja5cclxuICAgICAqIEBwYXJhbSByZXMg55Sf5Y2V5rWB56iL5omn6KGM57uT5p6cXHJcbiAgICAgKiBAcmV0dXJucyBmb3JtVXBkYXRlUmVzdWx0IOabtOaWsOWunuS9k+aVsOaNrui/lOWbnue7k+aenCBAdHlwZSB7IE9ic2VydmFibGU8Rm9ybVVwZGF0ZVJlc3VsdD4gfVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgdXBkYXRlRW50aXR5RGF0YXMocmVzOiBGb3JtQmlsbENyZWF0aW9uUHJvY2Vzc0V4ZWN1dG9yUmVzdWx0KTogT2JzZXJ2YWJsZTxGb3JtVXBkYXRlUmVzdWx0PiB7XHJcbiAgICAgICAgY29uc3QgYXJncyA9IG5ldyBGb3JtVXBkYXRlQXJncygpO1xyXG4gICAgICAgIC8vTWFwcGluZ+aJp+ihjOadoeS7tuWIpOaWree7k+aenOS4unRydWXml7bmiY3kvJrmiafooYznlJ/ljZXmtYHnqIvlvpfliLDnlJ/ljZXnu5PmnpxcclxuICAgICAgICBpZiAocmVzLmNvbmRpdGlvblJlc3VsdC5jb25kaXRpb25FeGVjdXRpb25SZXN1bHQgPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAvL+eUn+WNlee7k+aenOS4jeS4uuepulxyXG4gICAgICAgICAgICBpZiAocmVzLmNyZWF0aW9uUnVsZUV4ZWN1dG9yUmVzdWx0ICYmIHJlcy5jcmVhdGlvblJ1bGVFeGVjdXRvclJlc3VsdC5tYXBwaW5nUmVzdWx0cyAmJiByZXMuY3JlYXRpb25SdWxlRXhlY3V0b3JSZXN1bHQubWFwcGluZ1Jlc3VsdHMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgYXJncy5ycGNDcmVhdGlvblJ1bGVFeGVjdXRvclJlc3VsdCA9IHJlcy5jcmVhdGlvblJ1bGVFeGVjdXRvclJlc3VsdC5Db252ZXJ0VG9Kc29uKCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5kYXRhU2VydmljZS51cGRhdGVFbnRpdHlEYXRhcyhhcmdzKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aHJvd0Vycm9yKFwiY3JlYXRpb25SdWxlRXhlY3V0b3JSZXN1bHQgaXMgZW1wdHkhXCIpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhyb3dFcnJvcihcImNvbmRpdGlvbkV4ZWN1dGlvblJlc3VsdCBpcyBmYWxzZSFcIilcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmjqjpgIHku7vliqHkuK3lv4NcclxuICAgICAqIEBwYXJhbSByZXMg55Sf5Y2V5rWB56iL5omn6KGM57uT5p6cXHJcbiAgICAgKiBAcmV0dXJucyBmb3JtVXBkYXRlUmVzdWx0IOabtOaWsOWunuS9k+aVsOaNrui/lOWbnue7k+aenCBAdHlwZSB7IE9ic2VydmFibGU8Rm9ybVVwZGF0ZVJlc3VsdD4gfVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgcHVzaFRhc2tDZW50ZXIocmVzOiBGb3JtQmlsbENyZWF0aW9uUHJvY2Vzc0V4ZWN1dG9yUmVzdWx0KTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgICAgICBjb25zdCBhcmdzID0gbmV3IFB1c2hUYXNrQXJncygpO1xyXG4gICAgICAgIC8vTWFwcGluZ+aJp+ihjOadoeS7tuWIpOaWree7k+aenOS4unRydWXml7bmiY3kvJrmiafooYznlJ/ljZXmtYHnqIvlvpfliLDnlJ/ljZXnu5PmnpxcclxuICAgICAgICBpZiAocmVzLmNvbmRpdGlvblJlc3VsdC5jb25kaXRpb25FeGVjdXRpb25SZXN1bHQgPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAvL+eUn+WNlee7k+aenOS4jeS4uuepulxyXG4gICAgICAgICAgICBpZiAocmVzLmNyZWF0aW9uUnVsZUV4ZWN1dG9yUmVzdWx0ICYmIHJlcy5jcmVhdGlvblJ1bGVFeGVjdXRvclJlc3VsdC5tYXBwaW5nUmVzdWx0cyAmJiByZXMuY3JlYXRpb25SdWxlRXhlY3V0b3JSZXN1bHQubWFwcGluZ1Jlc3VsdHMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlcy5wdXNoQ3JlYXRpb25Nb2RlID09IFB1c2hDcmVhdGlvbk1vZGUuVEFTS0NFTlRFUikge1xyXG4gICAgICAgICAgICAgICAgICAgIGFyZ3Muc3VDb2RlID0gcmVzLmRvd25CaWxsU3VDb2RlO1xyXG4gICAgICAgICAgICAgICAgICAgIGFyZ3MuY3JlYXRpb25SdWxlRXhlY3V0b3JSZXN1bHQgPSByZXMuY3JlYXRpb25SdWxlRXhlY3V0b3JSZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGF0YVNlcnZpY2UucHVzaFRhc2tDZW50ZXIoYXJncyk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aHJvd0Vycm9yKFwiY3JlYXRpb25SdWxlRXhlY3V0b3JSZXN1bHQgY2FuJ3QgYmUgcHVzaGVkIHRvIHRhc2sgY2VudGVyIVwiKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRocm93RXJyb3IoXCJjcmVhdGlvblJ1bGVFeGVjdXRvclJlc3VsdCBpcyBlbXB0eSFcIilcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aHJvd0Vycm9yKFwiY29uZGl0aW9uRXhlY3V0aW9uUmVzdWx0IGlzIGZhbHNlIVwiKVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOafpeivoueUn+WNlee7k+aenFxyXG4gICAgICogQHBhcmFtIGNyZWF0aW9uUmVzdWx0SWQg55Sf5Y2V57uT5p6caWRcclxuICAgICAqL1xyXG4gICAgcHVibGljIGdldENyZWF0aW9uUmVzdWx0QnlJZChjcmVhdGlvblJlc3VsdElkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPEZvcm1CaWxsQ3JlYXRpb25Qcm9jZXNzRXhlY3V0b3JSZXN1bHQ+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5kYXRhU2VydmljZS5nZXRDcmVhdGlvblJlc3VsdEJ5SWQoY3JlYXRpb25SZXN1bHRJZCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmmoLlrZjnlJ/ljZXnu5PmnpxcclxuICAgICAqL1xyXG4gICAgcHVibGljIGFkZEZvcm1CaWxsQ3JlYXRpb25Qcm9jZXNzRXhlY3V0b3JSZXN1bHQoY3JlYXRpb25SZXN1bHQ6IEZvcm1CaWxsQ3JlYXRpb25Qcm9jZXNzRXhlY3V0b3JSZXN1bHQpOiBPYnNlcnZhYmxlPEdlbmVyYWxUZXh0SWRXaXRoRGF0YUlkW10+IHtcclxuICAgICAgICBpZiAoY3JlYXRpb25SZXN1bHQgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aHJvdyBcIuWPguaVsGNyZWF0aW9uUmVzdWx05LiN5Y+v5Li656m6XCI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0eXBlb2YgY3JlYXRpb25SZXN1bHQgPT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgICAgICBpZiAoY3JlYXRpb25SZXN1bHQgPT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgXCLlj4LmlbBjcmVhdGlvblJlc3VsdOS4jeWPr+S4uuepulwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IHRlbXAgPSBuZXcgRm9ybUJpbGxDcmVhdGlvblByb2Nlc3NFeGVjdXRvclJlc3VsdCgpO1xyXG4gICAgICAgICAgICB0ZW1wLkxvYWRGcm9tSnNvbihjcmVhdGlvblJlc3VsdCk7XHJcbiAgICAgICAgICAgIGNyZWF0aW9uUmVzdWx0ID0gdGVtcDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKChjcmVhdGlvblJlc3VsdCBpbnN0YW5jZW9mIEZvcm1CaWxsQ3JlYXRpb25Qcm9jZXNzRXhlY3V0b3JSZXN1bHQpID09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlcyA9IG5ldyBGb3JtQmlsbENyZWF0aW9uUHJvY2Vzc0V4ZWN1dG9yUmVzdWx0KCk7XHJcbiAgICAgICAgICAgIHJlcy5Mb2FkRnJvbUpzb25PYmplY3QoY3JlYXRpb25SZXN1bHQpO1xyXG4gICAgICAgICAgICBjcmVhdGlvblJlc3VsdCA9IHJlcztcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZGF0YVNlcnZpY2UuYWRkRm9ybUJpbGxDcmVhdGlvblByb2Nlc3NFeGVjdXRvclJlc3VsdChjcmVhdGlvblJlc3VsdCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDojrflj5ZWT+W6j+WIl+WMluaVsOaNrlxyXG4gICAgICovXHJcbiAgICAvKipcclxuICAgICAqIOiOt+WPllZP5bqP5YiX5YyW5pWw5o2uXHJcbiAgICAgKiBAcGFyYW0gYXJncyBcclxuICAgICAqIEByZXR1cm5zIFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgZ2V0RW50aXR5RGF0YXMoZGF0YUlkOiBzdHJpbmcsIHZvSWQ6IHN0cmluZywgc3VDb2RlOiBzdHJpbmcpOiBPYnNlcnZhYmxlPHN0cmluZz4ge1xyXG4gICAgICAgIGlmIChkYXRhSWQgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aHJvdyBcIuWPguaVsGRhdGFJZOS4jeWPr+S4uuepulwiO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodm9JZCA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHRocm93IFwi5Y+C5pWwdm9JZOS4jeWPr+S4uuepulwiO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoc3VDb2RlID09IG51bGwpIHtcclxuICAgICAgICAgICAgdGhyb3cgXCLlj4LmlbBzdUNvZGXkuI3lj6/kuLrnqbpcIjtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgYXJncyA9IG5ldyBHZXRFbnRpdHlEYXRhc0FyZ3MoKTtcclxuICAgICAgICBhcmdzLmRhdGFJZCA9IGRhdGFJZDtcclxuICAgICAgICBhcmdzLnN1Q29kZSA9IHN1Q29kZTtcclxuICAgICAgICBhcmdzLnZvSWQgPSB2b0lkO1xyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5kYXRhU2VydmljZS5nZXRFbnRpdHlEYXRhcyhhcmdzKTtcclxuICAgIH1cclxufSJdfQ==