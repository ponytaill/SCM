!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/common"),require("rxjs/Observable"),require("@farris/ui-modal"),require("rxjs"),require("@angular/platform-browser"),require("@farris/ui-common"),require("lodash-es"),require("@angular/forms"),require("@farris/ui-dialog"),require("@farris/ui-lookup"),require("@farris/ui-multi-select"),require("@farris/ui-field-group"),require("@farris/ui-input-group"),require("@farris/ui-dropdown"),require("@farris/ui-notify"),require("@farris/ui-loading"),require("@angular/common/http"),require("@farris/ui-datagrid"),require("@farris/ui-tooltip"),require("@farris/component-querycondition"),require("@farris/ui-common/date"),require("@farris/ui-common/number"),require("@farris/ui-locale"),require("@angular/core"),require("resize-observer-polyfill")):"function"==typeof define&&define.amd?define("@gsp-cmp/querysolution",["exports","@angular/common","rxjs/Observable","@farris/ui-modal","rxjs","@angular/platform-browser","@farris/ui-common","lodash-es","@angular/forms","@farris/ui-dialog","@farris/ui-lookup","@farris/ui-multi-select","@farris/ui-field-group","@farris/ui-input-group","@farris/ui-dropdown","@farris/ui-notify","@farris/ui-loading","@angular/common/http","@farris/ui-datagrid","@farris/ui-tooltip","@farris/component-querycondition","@farris/ui-common/date","@farris/ui-common/number","@farris/ui-locale","@angular/core","resize-observer-polyfill"],t):t((e["gsp-cmp"]=e["gsp-cmp"]||{},e["gsp-cmp"].querysolution={}),e.ng.common,e.rxjs.Observable,e.uiModal,e.rxjs,e.ng.platformBrowser,e.uiCommon,e.lodashEs,e.ng.forms,e.uiDialog,e.uiLookup,e.uiMultiSelect,e.uiFieldGroup,e.uiInputGroup,e.uiDropdown,e.uiNotify,e.uiLoading,e.ng.common.http,e.uiDatagrid,e.uiTooltip,e.componentQuerycondition,e.date,e.number,e.uiLocale,e.ng.core,e.ResizeObserver)}(this,function(e,t,s,o,i,c,d,h,n,r,l,a,u,p,y,f,m,g,S,v,C,b,w,q,D,V){"use strict";function F(i,n){var r,s,l,e,a={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]};return e={next:t(0),"throw":t(1),"return":t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function o(e){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,s&&(l=2&e[0]?s["return"]:e[0]?s["throw"]||((l=s["return"])&&l.call(s),0):s.next)&&!(l=l.call(s,e[1])).done)return l;switch(s=0,l&&(e=[2&e[0],l.value]),e[0]){case 0:case 1:l=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,s=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(l=0<(l=a.trys).length&&l[l.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!l||e[1]>l[0]&&e[1]<l[3])){a.label=e[1];break}if(6===e[0]&&a.label<l[1]){a.label=l[1],l=e;break}if(l&&a.label<l[2]){a.label=l[2],a.ops.push(e);break}l[2]&&a.ops.pop(),a.trys.pop();continue}e=n.call(i,a)}catch(t){e=[6,t],s=0}finally{r=l=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([t,e])}}}V=V&&V.hasOwnProperty("default")?V["default"]:V;var I=(Q.prototype.create=function(e,t){var o={headers:new g.HttpHeaders({"Content-Type":"application/json",sessionid:t}),sessionid:t},i=(new C.QuerySolutionVoConvertor).convertJObject(e);return this.http.post(this.url,i,o)},Q.prototype.query=function(e,t){var o={headers:new g.HttpHeaders({"Content-Type":"application/json",sessionid:t})},i=e,n=this.url+"/belongId/"+i;return this.http.get(n,o)},Q.prototype.update=function(e,t){var o={headers:new g.HttpHeaders({"Content-Type":"application/json",sessionid:t})},i=(new C.QuerySolutionVoConvertor).convertJObject(e);return this.http.put(this.url,i,o)},Q.prototype.batchUpdate=function(e,t){var o={headers:new g.HttpHeaders({"Content-Type":"application/json",sessionid:t}),sessionid:t},i=this.url+"/batch";return this.http.put(i,e,o)},Q.prototype.supportLS=function(){return!!window.hasOwnProperty("localStorage")},Q.prototype.setLS=function(e,t){var o="[]";if(t)if("string"==typeof t)o=t;else{var i=new C.QuerySolutionVoConvertor;o=JSON.stringify(i.formatConvertJObject(t))}e&&this.supportLS&&localStorage.setItem(e,o)},Q.prototype.getLS=function(e){var t=new Array;if(e&&this.supportLS){var o=localStorage.getItem(e);o==undefined&&null===o||(t=JSON.parse(o))}return 0<t.length?(new C.QuerySolutionVoConvertor).formatFromJobject(t):t},Q.prototype.saveHistroy=function(e,t){var o={headers:new g.HttpHeaders({"Content-Type":"application/json",sessionid:t})},i=(new C.QuerySolutionVoConvertor).convertJObject(e);return this.http.put(this.histroyUrl,i,o)},Q.decorators=[{type:D.Injectable}],Q.ctorParameters=function(){return[{type:g.HttpClient}]},Q);function Q(e){this.http=e,this.histroyUrl="/api/runtime/sys/v1.0/querysolution/previousQuery",this.url="/api/runtime/sys/v1.0/querysolution"}var k=(x.decorators=[{type:D.Injectable}],x);function x(){}var T=new D.InjectionToken("gsp-cmp/I_QUERYSOLUTION_HANDLER"),H=(E.clearSolutionCache=function(){E.solutionListCache={}},E.removeSolutionCache=function(e){delete E.solutionListCache[e]},E.setSolutionCache=function(e,t){E.solutionListCache[e]=t},E.getSolutionCache=function(e){return E.solutionListCache[e]},E.getSolutionAllCache=function(){return E.solutionListCache},E.setCurrentSolution=function(e,t){E.currentSolution[e]=t},E.getCurrentSolution=function(e){return E.currentSolution[e]},E.removeCurrentSolution=function(e){delete E.currentSolution[e]},E.clearCurrentSolution=function(){E.currentSolution={}},E.solutionListChanged=new i.Subject,E.solutionListCache={},E.currentSolution={},E);function E(){}var O=(Object.defineProperty(M.prototype,"fieldConfigs",{get:function(){return this._fieldConfigs},set:function(e){this._fieldConfigs=this.solutionService.convertToQueryConditions(e)},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"resetFieldConfigs",{get:function(){return this._resetFieldConfigs},set:function(e){var o=this;if(e&&0!=e.length){var t=e.map(function(t){var e=o.presetFieldConfigs.find(function(e){return e.fieldCode==t.labelCode});if(e)return t.control.controltype=e.control.getControlType(),t});this._resetFieldConfigs=this.solutionService.convertToSimpleQueryConditions(t),this.solutionService.updateControl(this._presetFieldConfigs,this._resetFieldConfigs),this.sysQuerySolutionVo&&this.solutionService.updateControl(this.sysQuerySolutionVo.queryConditions,this._resetFieldConfigs),this.historyRefer.foundSchme&&this.solutionService.updateControl(this.historyRefer.foundSchme.queryConditions,this._resetFieldConfigs),this.selectedSolution&&this.solutionService.updateControl(this.selectedSolution.queryConditions,this._resetFieldConfigs)}},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"presetFieldConfigs",{get:function(){return this._presetFieldConfigs},set:function(e){this._presetFieldConfigs=this.solutionService.convertToQueryConditions(e)},enumerable:!0,configurable:!0}),M.prototype.ngOnDestroy=function(){this._self.nativeElement.removeEventListener("keydown",this.handleKeyDown)},M.prototype.ngOnChanges=function(e){e.defaultConfigs&&(this.isSetDefaultValue=!0,e.defaultConfigs.currentValue&&!e.defaultConfigs.firstChange&&(this.setQueryConditionValues(e.defaultConfigs.currentValue,this.selectedSolution),this.initAutoQuery(this.selectedSolution))),e.enableInitQuery&&e.enableInitQuery.firstChange&&e.enableInitQuery.currentValue&&(this.doneInitQuery=!1)},M.prototype.ngOnInit=function(){this.initSysQuerySolution(),this.isDisabled?this.loadSysQuerySolution():(this.sessionId=this.solutionHandler.getUserSessionId(),this.initAutoQueryByLS(),this.loadQuerySolutions(),this.listenKeyBoard())},M.prototype.initSysQuerySolution=function(){this.presetQuerySolutionName&&""!=this.presetQuerySolutionName&&(this.sysQuerySolutionVo=new C.QuerySolutionVo,this.sysQuerySolutionVo.id=this.solutionService.getGuid(),this.sysQuerySolutionVo.code=this.presetQuerySolutionName!=this.localeService.getValue("querySolution.container.sysPresetName")?this.presetQuerySolutionName:this.localeService.getValue("querySolution.container.defaultName"),this.sysQuerySolutionVo.queryConditions=h.cloneDeep(this.presetFieldConfigs),this.sysQuerySolutionVo.belongId=this.formId,this.sysQuerySolutionVo.isSystem=!0)},M.prototype.loadSysQuerySolution=function(){this.querySolutionVos.push(this.sysQuerySolutionVo),this.selectedSolution=h.cloneDeep(this.sysQuerySolutionVo),this.loadQueryConditions()},M.prototype.formatQuerySolutionVO=function(e,t,o){var i,n,r=this;void 0===o&&(o=!1);var s,l=[];return i=o?e.initFromJobject(t):t,this.fieldConfigs.forEach(function(e){l.push(e.fieldCode)}),i&&i.queryConditions&&0<i.queryConditions.length&&(s=i.queryConditions.filter(function(e){return-1<l.indexOf(e.fieldCode)}),i.queryConditions=s,i.queryConditions.forEach(function(t){n=r.fieldConfigs.find(function(e){return e.fieldCode==t.fieldCode}),t.fieldName=n.fieldName,t.placeHolder=n.placeHolder,t.beginPlaceHolder=n.hasOwnProperty("beginPlaceHolder")?n.beginPlaceHolder:"",t.endPlaceHolder=n.hasOwnProperty("endPlaceHolder")?n.endPlaceHolder:"",n.control.preEventCmd&&(t.control.preEventCmd=n.control.preEventCmd),n.control.postEventCmd&&(t.control.postEventCmd=n.control.postEventCmd),n.control.clear&&(t.control.clear=n.control.clear),n.control.click&&(t.control.click=n.control.click),n.control.enumValues&&0<n.control.enumValues.length&&(t.control.enumValues=n.control.enumValues,t.control.enumValues=n.control.enumValues),n.control.data&&0<n.control.data.length&&(t.control.data=n.control.data)})),i},M.prototype.loadQuerySolutions=function(){return function e(t,s,l,a){return new(l=l||Promise)(function(e,o){function i(e){try{r(a.next(e))}catch(t){o(t)}}function n(e){try{r(a["throw"](e))}catch(t){o(t)}}function r(t){t.done?e(t.value):new l(function(e){e(t.value)}).then(i,n)}r((a=a.apply(t,s||[])).next())})}(this,void 0,void 0,function(){var i,n=this;return F(this,function(e){return(i=this).httpService.query(this.formId,this.sessionId).subscribe(function(e){var t,o=new C.QuerySolutionVoConvertor;e&&0<e.length&&(e.forEach(function(e){t=n.formatQuerySolutionVO(o,e,!0),n.enableHistory&&"pre"==t.type?(t.code=n.localeService.getValue("querySolution.container.histroyName"),n.historyRefer.schemeKey=t.id,n.historyRefer.foundSchme=h.cloneDeep(t),n.historyRefer.initCondition=!0):"pre"!=t.type&&(n.querySolutionVos.push(t),t.isDefault&&(n.defaultQuerySolution=h.cloneDeep(t)))}),i.setSolutionCache(n.querySolutionVos)),n.enableHistory&&!n.historyRefer.initCondition&&n.formatInitQuerySolution(),n.enableHistory&&n.historyRefer.initCondition?(n.selectedSolution=h.cloneDeep(n.historyRefer.foundSchme),n.querySolutionVos.splice(0,0,n.historyRefer.foundSchme),1==n.querySolutionVos.length&&n.querySolutionVos.push(n.sysQuerySolutionVo),i.setSolutionCache(n.querySolutionVos),n.loadQueryConditions()):n.defaultQuerySolution||n.querySolutionVos.length?(n.defaultQuerySolution&&""!=n.defaultQuerySolution.id?n.selectedSolution=h.cloneDeep(n.defaultQuerySolution):n.selectedSolution=h.cloneDeep(n.querySolutionVos[0]),n.loadQueryConditions()):n.loadSysQuerySolution(),n.isSetDefaultValue&&!n.historyRefer.initCondition&&n.setQueryConditionValues(n.defaultConfigs,n.selectedSolution),n.initAutoQuery(n.selectedSolution)}),[2]})})},M.prototype.setSolutionCache=function(e){if(!this.isDisabled&&gspframeworkService&&e&&e.length){var t=gspframeworkService.rtf.session.getCommonVariable();H.setSolutionCache(t.tabId,e),H.solutionListChanged.next(!0)}},M.prototype.setCurrentSolutionCache=function(e){if(!this.isDisabled&&gspframeworkService&&e){var t=gspframeworkService.rtf.session.getCommonVariable();t&&t.tabId&&H.setCurrentSolution(t.tabId,e)}},M.prototype.loadQueryConditions=function(){this.selectedFieldConditions=new Array,this.selectedSolution&&this.selectedSolution.queryConditions&&0<this.selectedSolution.queryConditions.length&&(this.selectedFieldConditions=this.selectedSolution.queryConditions),this.whenFoldSetSummaryConditions(),this.showSaveButton=!this.selectedSolution.isSystem,this.isDisabled||this.solutionHandler.setCurrentQueryConditions(h.cloneDeep(this.selectedFieldConditions)),this.setCurrentSolutionCache(this.selectedSolution)},M.prototype.saveAs=function(){this.openSaveAsDialog(this.localeService.getValue("querySolution.saveAsDialog.title"))},M.prototype.getDefaultLabel=function(e){return this.defaultQuerySolution?e.id!=this.defaultQuerySolution.id?{visibility:"hidden"}:void 0:{visibility:"hidden"}},M.prototype.select=function(e){this.selectedSolution=Object.assign(new C.QuerySolutionVo,e),e.queryConditions&&0<e.queryConditions.length?this.selectedFieldConditions=this.selectedSolution.queryConditions:this.selectedFieldConditions=new Array,this.showSaveButton=!this.selectedSolution.isSystem,this.isDisabled||this.solutionHandler.setCurrentQueryConditions(h.cloneDeep(this.selectedFieldConditions)),this.setCurrentSolutionCache(this.selectedSolution),this.whenFoldSetSummaryConditions()},M.prototype.selectAndQuery=function(e){if(this.defaultConfigs&&this.defaultConfigs.isCurrent||e.isSystem&&"pre"!==e.type)this.setQueryConditionValues(this.defaultConfigs,e);else{if(this.enableHistory&&"pre"==e.type){var t=h.cloneDeep(this.historyRefer.foundSchme.queryConditions);0<t.length&&(e.queryConditions=t)}this.select(e)}this.query()},M.prototype.openFieldConfigDialog=function(){this.farrisQueryCondition.openFieldConfigDialog()},M.prototype.fieldConditionsChangeHander=function(e){var t=e;this.selectedFieldConditions=t,this.isDisabled||(this.solutionHandler.setCurrentQueryConditions(h.cloneDeep(this.selectedFieldConditions)),this.solutionHandler.setFilterConditions(this.selectedFieldConditions),this.setCurrentSolutionCache(this.selectedSolution)),this.markAsChanged(!0,this.selectedSolution.id)},M.prototype.save=function(){var t=this;this.formId?this.selectedSolution.id?(this.selectedSolution.queryConditions=this.selectedFieldConditions,this.httpService.update(this.selectedSolution,this.sessionId).subscribe(function(){var e=t.querySolutionVos.findIndex(function(e){return e.id==t.selectedSolution.id});t.querySolutionVos.splice(e,1,t.selectedSolution),t.markAsChanged(!1,t.selectedSolution.id),t.solutionService.showInfo(t.localeService.getValue("querySolution.container.saveSuccess"),"success","",1500)},function(e){throw t.solutionService.showInfo(t.localeService.getValue("querySolution.container.saveFail"),"error","",1500),e})):this.openSaveAsDialog(this.localeService.getValue("querySolution.container.save")):this.solutionService.showInfo(this.localeService.getValue("querySolution.container.pleaseInput"),"error","",1500)},M.prototype.openSaveAsDialog=function(e){this.formId?(this.saveAsDialog.title=e,this.saveAsDialog.querySolution=this.newSaveAsSolutionVo(),this.saveAsDialog.show()):this.solutionService.showInfo(this.localeService.getValue("querySolution.container.pleaseInput"),"error","",1500)},M.prototype.saveAsConfrimHandler=function(e){var t=this,o=e.querySolution;o.queryConditions&&o.queryConditions.length&&o.queryConditions.forEach(function(e){e.readonly&&(e.readonly=!1)}),this.httpService.create(o,this.sessionId).subscribe(function(){if(o.isDefault&&(t.defaultQuerySolution=o,t.querySolutionVos=t.querySolutionVos.map(function(e){return e.isDefault=!1,e})),1===t.querySolutionVos.length&&t.querySolutionVos[0].isSystem)t.querySolutionVos=new Array;else if(2===t.querySolutionVos.length&&t.enableHistory){var e=new Array;e=t.querySolutionVos.filter(function(e){return"pre"==e.type||!e.isSystem}),t.querySolutionVos=e}t.querySolutionVos.push(o),t.selectedSolution=o,t.showSaveButton=!t.selectedSolution.isSystem,t.selectedFieldConditions=t.selectedSolution.queryConditions,t.solutionService.showInfo(t.localeService.getValue("querySolution.container.saveSuccess"),"success","",1500)},function(e){throw t.solutionService.showInfo(t.localeService.getValue("querySolution.container.saveFail"),"error","",1500),e})},M.prototype.openManangerDialog=function(){this.manageDialog.show(h.cloneDeep(this.querySolutionVos))},M.prototype.managerConfirmHandler=function(e){var t=this,o=e;if(1==o.validator){var i=o.newDefaultQuerySolution?o.newDefaultQuerySolution.id:"",n=this.formId,r=o.deletedQuerySolutionIds;this.httpService.batchUpdate({defaultId:i,belongId:n,deletedIds:r},this.sessionId).subscribe(function(){t.querySolutionVos=o.updatedQuerySolutionVos,o.currentDefaultQuerySolutionId||(t.defaultQuerySolution=null),i?(t.select(o.newDefaultQuerySolution),t.defaultQuerySolution=o.newDefaultQuerySolution):r.includes(t.selectedSolution.id)&&(0<t.querySolutionVos.length?t.enableHistory&&1==t.querySolutionVos.length&&"pre"==t.querySolutionVos[0].type?(t.select(t.sysQuerySolutionVo),t.querySolutionVos.push(t.sysQuerySolutionVo)):t.select(t.querySolutionVos[0]):(t.select(t.sysQuerySolutionVo),t.querySolutionVos.push(t.sysQuerySolutionVo))),t.solutionService.showInfo(t.localeService.getValue("querySolution.container.saveSuccess"),"success","",1500)},function(e){return t.solutionService.showInfo(t.localeService.getValue("querySolution.container.saveFail"),"error","",1500),s.Observable["throw"](e)})}},M.prototype.query=function(){if(!this.isDisabled){var e=this.solutionService.isValid(this.selectedFieldConditions);if(e&&e.length){var t=e.map(function(e){return e.field});this.solutionService.showInfo(this.localeService.getValue("querySolution.container.require").replace("{fields}",t.join(", ")),"warning","",2500)}else{var o=h.cloneDeep(this.selectedFieldConditions);this.solutionHandler.setFilterConditions(o),this.queryEmitter.emit(o),this.changeQueryHistroy()}}},M.prototype.clear=function(){if(this.selectedFieldConditions.some(function(e){return 0==e.value.isEmpty()})){var e=h.cloneDeep(this.farrisQueryCondition.resetSelectedConditionValues(!0));this.selectedFieldConditions=e,this.selectedSolution.queryConditions=e,this.solutionHandler.setCurrentQueryConditions(h.cloneDeep(e)),this.solutionHandler.setFilterConditions(e),this.markAsChanged(!0,this.selectedSolution.id),this.query()}},M.prototype.foldClearHandler=function(){this.isFold?(this.isFold=!1,0<this.summaryConditions.length&&(this.summaryConditions=[],this.clear())):this.clear()},M.prototype.arrowClick=function(){this.isFold=!this.isFold,this.whenFoldSetSummaryConditions(),this.isFold||(this.summaryConditions=[])},M.prototype.whenFoldSetSummaryConditions=function(){if(this.isFold){var e=this.selectedFieldConditions.some(function(e){return 0==e.value.isEmpty()});this.summaryConditions=e?this.selectedFieldConditions.filter(function(e){return 0==e.value.isEmpty()}):[]}},M.prototype.setQueryConditionValues=function(e,t){var o,i;e&&e.fieldConfigs&&e.fieldConfigs.length&&(t.hasOwnProperty("type")&&"pre"==t.type?(o=null,this.select(t)):o=e.isCurrent?t:t.isSystem?t:null,o&&o.queryConditions&&o.queryConditions.length?(i=h.cloneDeep(this.solutionService.setValues(o,e.fieldConfigs,!!e.readonly)),this.doneSetDefaultValue=!0,this.select(i)):(this.doneSetDefaultValue=!0,this.solutionHandler.setCurrentQueryConditions(this.selectedSolution.queryConditions)))},M.prototype.initAutoQuery=function(e){if(!(this.enableInitQuery&&this.doneInitQuery&&this.enableHistory)){var t=!0;e&&e.queryConditions&&e.queryConditions.length?this.isSetDefaultValue&&!this.doneSetDefaultValue&&(t=!1):t=!1,t&&this.enableInitQuery&&(this.query(),this.doneInitQuery=!0)}},M.prototype.markAsChanged=function(t,o){this.querySolutionVos.forEach(function(e){e.id==o&&(e.isChanged=t)}),this.selectedSolution.isChanged=t,this.cdf.detectChanges()},M.prototype.listenKeyBoard=function(){this._self.nativeElement.addEventListener("keydown",this.handleKeyDown)},M.prototype.initAutoQueryByLS=function(){if(this.enableHistory&&!this.isDisabled&&(this.setLSKey(),this.initQuerySolution(),this.enableInitQuery&&(this.formatInitQuerySolution(),0<this.historyRefer.foundSchme.queryConditions.length))){var e=h.cloneDeep(this.historyRefer.foundSchme.queryConditions);this.selectedFieldConditions=e,this.solutionHandler.setFilterConditions(e),this.queryEmitter.emit(e),this.doneInitQuery=!0}},M.prototype.initQuerySolution=function(){var e=new C.QuerySolutionVo;e.id=this.solutionService.getGuid(),e.code=this.localeService.getValue("querySolution.container.histroyName"),e.queryConditions=[],e.belongId=this.formId,e.isSystem=!0,e.type="pre",this.historyRefer.foundSchme=e},M.prototype.formatInitQuerySolution=function(){var e=this.httpService.getLS(this.historyRefer.schemeKeyLS);if(0<e.length){var t=new C.QuerySolutionVoConvertor;this.historyRefer.foundSchme.queryConditions=e,this.historyRefer.foundSchme=this.formatQuerySolutionVO(t,this.historyRefer.foundSchme),this.solutionService.updateControl(this.historyRefer.foundSchme,this.resetFieldConfigs),this.historyRefer.initCondition=!0}},M.prototype.changeQueryHistroy=function(e){if(void 0===e&&(e=!0),this.enableHistory){if("pre"==this.selectedSolution.type)this.selectedSolution.isChanged=!1;else{var t=this.querySolutionVos.findIndex(function(e){return"pre"==e.type});-1<t&&(this.querySolutionVos[t].isChanged=!1)}var o=h.cloneDeep(this.selectedFieldConditions);this.historyRefer.foundSchme.queryConditions=o,this.httpService.setLS(this.historyRefer.schemeKeyLS,this.historyRefer.foundSchme.queryConditions),e&&this.httpService.saveHistroy(this.historyRefer.foundSchme,this.sessionId).subscribe(function(){})}},M.prototype.getTopWindow=function(){var e=window.self;try{for(;e.location.origin===e.parent.location.origin&&e!==e.parent&&!e.isRTFTopWin;)e=e.parent}catch(t){}return e},M.prototype.setLSKey=function(){var e=this.getTopWindow(),t="";e.gspframeworkService&&e.gspframeworkService.hasOwnProperty("common")&&(t=e.gspframeworkService.common.userInfos.get().code),this.historyRefer.schemeKeyLS=t?"Scheme"+this._idSer.encrypt(t+this.formId):""},M.decorators=[{type:D.Component,args:[{selector:"farris-querysolution",template:'<div #querysolution class="farris-panel position-relative" tabindex="1" style="outline: none;">\r\n    <div class="solution-header">\r\n        <div class="btn-group mr-3" fDropdown>\r\n            <div class="solution-header-title" fDropdownToggle>               \r\n                <span style="max-width: 288px;overflow: hidden;text-overflow: ellipsis;white-space: nowrap"\r\n                    title="{{selectedSolution.code}}">{{selectedSolution.code}}</span>\r\n                <b class="header-title--change" *ngIf="selectedSolution.isChanged">*</b>\r\n                <span class="f-icon f-accordion-expand"></span>\r\n            </div>\r\n            <div class="dropdown-menu solution-header-title-menu" fDropdownMenu>\r\n                <div class="solution-header-title-menu-inner">\r\n                    <div class="solution-header-title-menu-arrow"></div>\r\n                    <li class="dropdown-item solution-header-dropdown-item"\r\n                        [ngClass]="{\'solution-header-dropdown-item-active\': solution.id === selectedSolution.id }"\r\n                        (click)="selectAndQuery(solution)" *ngFor="let solution of querySolutionVos">\r\n                        <b *ngIf="solution.isChanged"  class="menu-item--change" >*</b>\r\n                        <span class="solution-header-dropdown-item-title" [title]="solution.code">{{solution.code}}</span>\r\n                        <span class="solution-header-dropdown-item-tip"\r\n                            [ngStyle]="getDefaultLabel(solution)">{{\'querySolution.container.default\' | locale}}</span>\r\n                    </li>\r\n                    <li class="solution-header-dropdown-item-btns">\r\n                        <span class="dropdown-item-btn" *ngIf="showSaveButton"\r\n                            (click)="save()">{{\'queryCondition.container.save\' | locale}}</span>\r\n                        <span class="dropdown-item-btn"\r\n                            (click)="saveAs()">{{\'queryCondition.container.saveAs\' | locale}}</span>\r\n                        <span class="dropdown-item-btn"\r\n                            (click)="openManangerDialog()">{{\'querySolution.container.manage\' | locale}}</span>\r\n                    </li>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class="summary-condition" *ngIf="isFold&&summaryConditions.length>0">\r\n            <lib-summary-list [conditions]="summaryConditions"></lib-summary-list>\r\n        </div>\r\n        <div class="solution-action">\r\n            <div class="btn-group" *ngIf="!isFold">\r\n                <button *ngIf="isFold==false" (click)="query()" type="button"\r\n                    class="btn btn-primary ">{{\'queryCondition.container.query\' | locale}}</button>\r\n            </div>\r\n            <div class="icon-group">\r\n                \x3c!--清空按钮--\x3e\r\n                <span *ngIf="!isFold||summaryConditions.length>0" class="icon-group-remove" (click)="foldClearHandler()"\r\n                    title="{{\'querySolution.container.clear\' | locale}}">\r\n                    <span class="f-icon f-icon-remove"></span>\r\n                </span>                \r\n                <ng-container *ngIf="!isFold">\r\n                    <span class="divide"></span>\r\n                    \x3c!--配置按钮--\x3e\r\n                    <span class="icon-group-setup" (click)="openFieldConfigDialog()"\r\n                        title="{{\'queryCondition.container.config\' | locale}}">\r\n                        <span class="f-icon f-icon-home-setup"></span>\r\n                    </span>\r\n                    \x3c!--展开收起--\x3e\r\n                    <span class="icon-group-packup" (click)="arrowClick()"\r\n                        title="{{\'querySolution.container.arrowUp\' | locale}}">\r\n                        <span class="f-icon f-icon-packup"></span>\r\n                    </span>\r\n                </ng-container>\r\n                \x3c!--展开收起--\x3e\r\n                <span *ngIf="isFold" class="icon-group-packup" (click)="arrowClick()"\r\n                    title="{{\'querySolution.container.arrowDown\' | locale}}">\r\n                    <span class="f-icon f-icon-packup" style="transform: rotate(180deg);"></span>\r\n                </span>\r\n\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div>\r\n        <farris-querycondition [ngClass]="{\'d-none\':isFold}" #farrisQueryCondition\r\n            [(selectedFieldConditions)]="selectedFieldConditions" [fieldConfigs]="fieldConfigs"\r\n            (fieldConditionsChange)="fieldConditionsChangeHander($event)" [isControlInline]="isControlInline"\r\n            [showCompleteLabel]="showCompleteLabel" [isDisabled]="isDisabled" [resetFieldConfigs]="resetFieldConfigs">\r\n        </farris-querycondition>\r\n    </div>\r\n\r\n    <app-solutionmanager #manageDialog (confirmEmitter)="managerConfirmHandler($event)"></app-solutionmanager>\r\n    <app-saveasdialog #saveAsDialog (confirmEmitter)="saveAsConfrimHandler($event)"></app-saveasdialog>\r\n    <div *ngIf="isDisabled" style="position:absolute;top:0;bottom:0;left:0;right:0;z-index: 99;"></div>\r\n</div>',encapsulation:D.ViewEncapsulation.None,providers:[I,C.ConvertorService,k],styles:[".solution-action{float:right}.solution-action span{vertical-align:middle;margin:0 3px}.solution-action .divide{font-size:12px;padding:3px 0}.solution-header{height:30px;margin-bottom:5px;-webkit-box-pack:start;justify-content:flex-start}.solution-action .f-icon{cursor:pointer}.solution-action .icon-group{display:inline-block}.solution-header-title-text{overflow:initial!important}"]}]}],M.ctorParameters=function(){return[{type:f.NotifyService},{type:D.ComponentFactoryResolver},{type:D.Injector},{type:o.BsModalService},{type:C.ConvertorService},{type:C.SolutionService},{type:I},{type:k},{type:q.LocaleService}]},M.propDecorators={defaultConfigs:[{type:D.Input}],fieldConfigs:[{type:D.Input}],presetQuerySolutionName:[{type:D.Input}],resetFieldConfigs:[{type:D.Input}],presetFieldConfigs:[{type:D.Input}],isDisabled:[{type:D.Input}],formId:[{type:D.Input}],queryEmitter:[{type:D.Output}],cls:[{type:D.HostBinding,args:["class"]}],isFold:[{type:D.Input}],isControlInline:[{type:D.Input}],showCompleteLabel:[{type:D.Input}],enableInitQuery:[{type:D.Input}],enableHistory:[{type:D.Input}],farrisQueryCondition:[{type:D.ViewChild,args:["farrisQueryCondition"]}],manageDialog:[{type:D.ViewChild,args:["manageDialog"]}],saveAsDialog:[{type:D.ViewChild,args:["saveAsDialog"]}]},M);function M(e,t,o,i,n,r,s,l,a){var u=this;this.notify=e,this.resolver=t,this.injector=o,this.modalService=i,this.convertService=n,this.solutionService=r,this.httpService=s,this.fieldConfigService=l,this.localeService=a,this._fieldConfigs=[],this._presetFieldConfigs=[],this._resetFieldConfigs=[],this.isDisabled=!1,this.queryEmitter=new D.EventEmitter,this.cls="query-solution",this.querySolutionVos=new Array,this.selectedSolution=new C.QuerySolutionVo,this.isFold=!1,this.isControlInline=!0,this.showCompleteLabel=!1,this.enableInitQuery=!1,this.selectedFieldConditions=new Array,this.isSetDefaultValue=!1,this.doneSetDefaultValue=!1,this.doneInitQuery=!0,this.summaryConditions=[],this.enableHistory=!1,this.historyRefer={schemeKey:"",foundSchme:null,schemeKeyLS:"",initCondition:!1},this.newSaveAsSolutionVo=function(){var e=h.cloneDeep(u.selectedSolution);return e.code="",e.isSystem=!1,e.belongId=u.formId,e.id=u.solutionService.getGuid(),e.isDefault=!1,e.queryConditions=u.selectedFieldConditions,e.type="",e.isChanged=!1,e},this.handleKeyDown=function(e){"Enter"==e.key&&u.query()},this._idSer=new d.IdService,this.solutionHandler=this.injector.get(T,null,D.InjectFlags.Optional),this._self=this.injector.get(D.ElementRef),this.cdf=this.injector.get(D.ChangeDetectorRef),this.eventManager=this.injector.get(c.EventManager)}var R=(j.prototype.update=function(e){var t;this.isNew(e)?(t=this.createdItems.indexOf(e),this.createdItems.splice(t,1,e)):-1!==(t=function(e,t){for(var o=0;o<t.length;o++)if(t[o].id===e.id)return o;return-1}(e,this.updatedItems))?this.updatedItems.splice(t,1,e):this.updatedItems.push(e)},j.prototype.isNew=function(e){return!e.id},j.prototype.assignValues=function(e,t){Object.assign(e,t)},j.decorators=[{type:D.Injectable}],j);function j(){this.createdItems=[],this.updatedItems=[]}var L=(_.prototype.ngOnInit=function(){this.columns=[{field:"code",width:272,title:this.localeService.getValue("querySolution.manageDialog.name")},{field:"isSystem",width:110,title:this.localeService.getValue("querySolution.manageDialog.property"),formatter:this.getSolutionProperty.bind(this),halign:"center",align:"center"},{field:"isDefault",width:70,title:this.localeService.getValue("querySolution.manageDialog.default"),template:this.checkCell,halign:"center",align:"center"},{width:70,title:this.localeService.getValue("querySolution.manageDialog.operation"),template:this.optCell,halign:"center",align:"center"}],this.title=this.localeService.getValue("querySolution.container.manage")},_.prototype.show=function(e){e&&(this.listData=this.findSolutionsWithoutSys(e),this.querySolutions=e),this.checkedSolution=this.querySolutions.find(function(e){return e.isDefault}),this.deletedQuerySolutionIds=[],this.dialog.show()},_.prototype.getSolutionProperty=function(e){return e?this.localeService.getValue("querySolution.manageDialog.system"):this.localeService.getValue("querySolution.manageDialog.personal")},_.prototype.findSolutionsWithoutSys=function(e){var t=[];return e.forEach(function(e){e.isSystem||t.push(e)}),t},_.prototype.delelteSolution=function(e){this.deletedQuerySolutionIds.push(e.id),this.checkedSolution&&e.id==this.checkedSolution.id&&(this.checkedSolution=null);for(var t=0;t<this.querySolutions.length;t++)if(e.id==this.querySolutions[t].id){this.querySolutions.splice(t,1);break}this.listData=this.findSolutionsWithoutSys(this.querySolutions)},_.prototype.setDefault=function(e,t){e?(this.checkedSolution=t,this.querySolutions=this.querySolutions.map(function(e){return e.id==t.id?e.isDefault=!0:e.isDefault=!1,e})):t.id==this.checkedSolution.id&&(this.checkedSolution=null,this.querySolutions=this.querySolutions.map(function(e){return e.id==t.id&&(e.isDefault=!1),e})),this.listData=this.findSolutionsWithoutSys(this.querySolutions),this.list.refresh()},_.prototype.cancel=function(){this.dialog.close()},_.prototype.confirm=function(){var e=new Object;e.deletedQuerySolutionIds=this.deletedQuerySolutionIds,e.newDefaultQuerySolution=h.cloneDeep(this.checkedSolution),e.updatedQuerySolutionVos=h.cloneDeep(this.querySolutions),0<this.deletedQuerySolutionIds.length||this.checkedSolution&&this.checkedSolution.id?e.validator=!0:e.validator=!1,this.confirmEmitter.emit(e),this.dialog.close()},_.decorators=[{type:D.Component,args:[{selector:"app-solutionmanager",template:'<farris-dialog #dialog [buttons]="manangerbuttonRef" [width]="550" [height]="570" [title]="title">\r\n    <div class="solutionmanager-inner">\r\n        <farris-datagrid #list [columns]="columns" [data]="listData" [pagination]="false" [fit]="true"></farris-datagrid>\r\n    </div>\r\n    <ng-template #optCell let-ctx>\r\n        <span class="f-icon f-icon-yxs_delete solutionmanager-grid-delete" (click)="delelteSolution(ctx.rowData)"></span>\r\n     </ng-template>\r\n     <ng-template #checkCell let-ctx>\r\n        <div class="custom-control custom-radio f-checkradio-single" style="padding-top: 3px;">\r\n            <input class="custom-control-input" id="radio-{{ctx.rowData.id}}" type="radio" (click)="setDefault($event.target.checked, ctx.rowData)" [checked]="ctx.rowData.isDefault"/>\r\n            <label class="custom-control-label" for="radio-{{ctx.rowData.id}}"></label>\r\n        </div>\r\n     </ng-template>\r\n</farris-dialog>\r\n<ng-template #manangerbuttonRef>\r\n    <button class="btn btn-primary" (click)="confirm()">{{\'querySolution.manageDialog.confirm\' | locale}}</button>\r\n    <button class="btn btn-secondary" (click)="cancel()">{{\'querySolution.manageDialog.cancel\' | locale}}</button>\r\n</ng-template>',providers:[R],styles:[""]}]}],_.ctorParameters=function(){return[{type:n.FormBuilder},{type:R},{type:f.NotifyService},{type:q.LocaleService}]},_.propDecorators={cancelEmitter:[{type:D.Output}],confirmEmitter:[{type:D.Output}],dialog:[{type:D.ViewChild,args:["dialog"]}],optCell:[{type:D.ViewChild,args:["optCell"]}],checkCell:[{type:D.ViewChild,args:["checkCell"]}],list:[{type:D.ViewChild,args:["list"]}]},_);function _(e,t,o,i){this.formBuilder=e,this.editService=t,this.notify=o,this.localeService=i,this.cancelEmitter=new D.EventEmitter,this.confirmEmitter=new D.EventEmitter,this.querySolutions=new Array,this.deletedQuerySolutionIds=new Array}var A=(N.prototype.ngOnInit=function(){},N.prototype.show=function(){this.dialog.show()},N.prototype.cancel=function(){this.dialog.close()},N.prototype.confirm=function(){if(this.querySolution.code){var e=new Object;e.querySolution=h.cloneDeep(this.querySolution),this.confirmEmitter.emit(e),this.dialog.close()}else this.solutionService.showInfo(this.localeService.getValue("querySolution.saveAsDialog.pleaseInput"),"info","",1500)},N.prototype.setDefault=function(e){this.querySolution.isDefault=e},N.decorators=[{type:D.Component,args:[{selector:"app-saveasdialog",template:'<farris-dialog #dialog [buttons]="saveasbuttonRef" [width]="550" [height]="310" [title]="title">\r\n    <div class="qs-save-as-input">\r\n        <div class="farris-input-wrap">\r\n            <input class="form-control" placeholder="{{\'querySolution.saveAsDialog.placeholder\' | locale}}" [(ngModel)]="querySolution.code"/>\r\n        </div>\r\n        <div class="custom-control custom-checkbox qs-save-as-check">\r\n            <input class="custom-control-input" type="checkbox" (change)="setDefault($event.target.checked)" [(ngModel)]="querySolution.isDefault"/>\r\n            <label class="custom-control-label" (click)="setDefault(!querySolution.isDefault)">{{\'querySolution.saveAsDialog.setAsDefault\' | locale}}</label>\r\n        </div>\r\n    </div>\r\n</farris-dialog>\r\n<ng-template #saveasbuttonRef>\r\n    <div class="qs-save-as-btn">\r\n        <button class="btn btn-primary" (click)="confirm()">{{\'querySolution.saveAsDialog.confirm\' | locale}}</button>        \r\n        <button class="btn btn-secondary" (click)="cancel()">{{\'querySolution.saveAsDialog.cancel\' | locale}}</button>\r\n    </div>\r\n</ng-template>',encapsulation:D.ViewEncapsulation.None,styles:[".qs-save-as-btn .btn{float:right;margin-left:10px;font-size:14px;line-height:26px}.qs-save-as-btn .btn-secondary{min-width:70px}.qs-save-as-input{width:100%;line-height:20px;font-size:14px;padding:20px 10px}.qs-save-as-check{margin:10px auto}"]}]}],N.ctorParameters=function(){return[{type:f.NotifyService},{type:C.SolutionService},{type:q.LocaleService}]},N.propDecorators={cls:[{type:D.HostBinding,args:["class"]}],cancelEmitter:[{type:D.Output}],confirmEmitter:[{type:D.Output}],dialog:[{type:D.ViewChild,args:["dialog"]}]},N);function N(e,t,o){this.notify=e,this.solutionService=t,this.localeService=o,this.cls="saveasdialog",this.cancelEmitter=new D.EventEmitter,this.confirmEmitter=new D.EventEmitter,this.querySolution=new C.QuerySolutionVo}var P=(Object.defineProperty(B.prototype,"condition",{get:function(){return this._condition},set:function(e){this._condition=e,this.formatCondition()},enumerable:!0,configurable:!0}),B.prototype.ngOnInit=function(){},B.prototype.formatCondition=function(){var e=this.condition;if(e){this._conditionType=e.control.getControlType();var t=void 0,o=e.value.getOriginalValue();switch(this._conditionType){case C.ControlType.Text:o=(t=e.value).value&&t.value.trim();break;case C.ControlType.SingleNumber:this.numberOptions={precision:e.control.precision,type:"number"};break;case C.ControlType.NumberRange:this._isRange=!0,this._spliter="~",this.numberOptions={precision:e.control.precision,type:"number"},o=[e.value.startValue?e.value.startValue:"",e.value.endValue?e.value.endValue:""].join(this._spliter);break;case C.ControlType.SingleDate:this.returnFormat=e.control&&e.control.returnFormat?e.control.returnFormat:"yyyy-MM-dd",this.format=e.control&&e.control.format?e.control.format:"yyyy-MM-dd";break;case C.ControlType.DateRange:this._isRange=!0,this._spliter="~",this.returnFormat=e.control&&e.control.returnFormat?e.control.returnFormat:"yyyy-MM-dd",this.format=e.control&&e.control.format?e.control.format:"yyyy-MM-dd",o=[e.value.startTime?e.value.startTime:"",e.value.endTime?e.value.endTime:""].join(this._spliter);break;case C.ControlType.SingleYear:this.returnFormat=e.control&&e.control.returnFormat?e.control.returnFormat:"yyyy",this.format=e.control&&e.control.format?e.control.format:"yyyy";break;case C.ControlType.SingleMonth:this.returnFormat=e.control&&e.control.returnFormat?e.control.returnFormat:"yyyy-MM",this.format=e.control&&e.control.format?e.control.format:"yyyy-MM";break;case C.ControlType.MonthRange:this._isRange=!0,this._spliter="~",this.returnFormat=e.control&&e.control.returnFormat?e.control.returnFormat:"yyyy-MM",this.format=e.control&&e.control.format?e.control.format:"yyyy-MM",e.value.startTime&&e.value.startTime,e.value.endTime&&e.value.endTime;break;case C.ControlType.SingleDateTime:this.showTime=!0,this.returnFormat=e.control.returnFormat?e.control.returnFormat:this.returnFormat,this.format="yyyy-MM-dd HH:mm:ss",e.control&&(e.control.enableCustomFormat?this.format=e.control.format?e.control.format:this.returnFormat:this.format=e.control&&e.control.format?e.control.format+" HH:mm:ss":this.returnFormat);break;case C.ControlType.DateTimeRange:this.showTime=!0,this._isRange=!0,this._spliter="~",this.returnFormat=e.control.returnFormat?e.control.returnFormat:this.returnFormat,this.format="yyyy-MM-dd HH:mm:ss",e.control&&(e.control.enableCustomFormat?this.format=e.control.format?e.control.format:this.returnFormat:this.format=e.control&&e.control.format?e.control.format+" HH:mm:ss":this.returnFormat),e.value.startTime&&e.value.startTime,e.value.endTime&&e.value.endTime;break;case C.ControlType.BoolCheck:var i=e.value.value;o=0<i.length?i[0]:null;break;case C.ControlType.DropDownList:case C.ControlType.Radio:this._spliter=",";break;case C.ControlType.InputGroup:case C.ControlType.SmartHelp:o=(t=e.value).textValue&&t.textValue.trim();break;default:o=e.value.getOriginalValue()}this.text=this.formatValue(o)}else this.text=""},B.prototype.formatLang=function(e){return e&&e[this.currentLanguage]?e[this.currentLanguage]:""},B.prototype.getFormatNumberValue=function(e){if(!this.format&&!this.numberOptions)return e.toString();if(!this.numberOptions||!this.numberOptions.type||"number"!=this.numberOptions.type)return e.toString();if(this.numberOptions.formatter)return this.numberOptions.formatter(e);if(this.numberOptions.useThousands)this.numberOptions.precision!=undefined?this.format="n"+this.numberOptions.precision:this.format="n";else{if(this.numberOptions.precision==undefined)return e.toString();this.format="f"+this.numberOptions.precision}var t,o=this.currencyToUpperCase(this.format.substring(0,1)),i=Number(this.format.substring(1)),n={};if(/C|D|F|N|P/g.test(o)){switch(this.thousand&&Object.assign(n,{thousand:this.thousand}),this.decimal&&Object.assign(n,{decimal:this.decimal}),this.expression&&Object.assign(n,{format:this.expression}),o){case"C":Object.assign(n,{prefix:this.currencySymbol,precision:i}),t=this.numberHelper.formatMoney(e,n);break;case"D":t=this.toDecimal(e,i);break;case"F":Object.assign(n,{prefix:"",thousand:"",precision:i}),t=this.numberHelper.formatMoney(e,n);break;case"N":Object.assign(n,{prefix:"",precision:i}),t=this.numberHelper.formatMoney(e,n);break;case"P":t=this.toPercent(e,i)}return t}console.warn("不支持format为 "+this.format+" 类型的数字格式化")},B.prototype.toDecimal=function(e,t){if(!(-1<e.toString().indexOf(".")))return(Array(t).join(this.filledSymbol)+e).slice(-t);console.warn("十进制转换仅限整型类型")},B.prototype.toPercent=function(e,t){return Number(100*e).toFixed(Number(t))+"%"},B.prototype.currencyToUpperCase=function(e){return e.replace(/[a-z]+/g,function(e){return e.toUpperCase()})},B.prototype.dateToUpperCase=function(e){var t;return t=!0===/Y/g.test(e)?e.replace(/Y/g,"y"):e,!0===/D/g.test(t)&&(t=t.replace(/D/g,"d")),t},B.prototype.getFormatEnumValue=function(e){var o=this;if(e==undefined||null===e||""===e)return"";if(this.dataSource&&this.dataSource.length){for(var i=(""+e).split(this._spliter),n=[],t=function(t){var e=r.dataSource.find(function(e){return e[o.valueField]==i[t]});e?n.push(e[r.textField]):n.push(i[t])},r=this,s=0;s<i.length;s++)t(s);return 0<n.length?n.join(this._spliter):""}return e},B.prototype.getFormatCheckBoxValue=function(e){return!0===e?this.localeService.getValue("text.yes"):!1===e||null==e||void 0===e?this.localeService.getValue("text.no"):e},B.prototype.dateformat=function(e){return this.format||(this.format="YYYY-MM-dd"),this.returnFormat&&"string"==typeof e&&(e=this.getDateFromFormatedString(e,this.returnFormat)),"hh:mm:ss"===this.format||"HH:mm:ss"===this.format?e:this.dtHelper.formatTo(e,this.dateToUpperCase(this.format))},B.prototype.getDateFromFormatedString=function(n,e){var r={year:0,month:0,day:0,hour:0,minite:0,second:0};return n&&e.replace(/y{4}|Y{4}|M+|d+|D+|h+|H+|m+|s+/g,function(t,e,o,i){n.substring(e).replace(/\d+/,function(e){e&&(i=parseInt(e.substr(0,t.length),10))}),/y+/i.test(t)&&!r.year&&(r.year=i),/M+/.test(t)&&!r.month&&(r.month=i),/d+/i.test(t)&&!r.day&&(r.day=i),/h+/i.test(t)&&!r.hour&&(r.hour=i),/m+/.test(t)&&!r.minite&&(r.minite=i),/s+/.test(t)&&!r.second&&(r.second=i)}),r.day=r.day?r.day:1,r.month=r.month?r.month:1,new Date(r.year+"/"+r.month+"/"+r.day+" "+r.hour+":"+r.minite+":"+r.second)},B.prototype["function"]=function(e,t){var o={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};for(var i in/(y+)/.test(t=t||"yyyy-MM-dd hh:mm:ss")&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length))),o)new RegExp("("+i+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?o[i]:("00"+o[i]).substr((""+o[i]).length)));return t},B.prototype.formatValue=function(e){var t,o=this;if(this.currentLanguage)return this.formatLang(e);if(this._conditionType!==C.ControlType.BoolCheck&&(null==e||void 0===e))return"";switch(this._conditionType){case C.ControlType.Text:t=e;break;case C.ControlType.DateRange:case C.ControlType.MonthRange:case C.ControlType.DateTimeRange:var i=e.split(this._spliter),n=[];i&&i.length&&i.forEach(function(e){var t=o.dateformat(e);n.push(t)}),t=n.join(this._spliter);break;case C.ControlType.SingleDate:case C.ControlType.SingleDateTime:case C.ControlType.SingleMonth:case C.ControlType.SingleYear:t=this.dateformat(e);break;case C.ControlType.SingleNumber:t=this.getFormatNumberValue(e);break;case C.ControlType.NumberRange:var r=e.split(this._spliter),s=[];r&&r.length&&r.forEach(function(e){var t=o.getFormatNumberValue(e);s.push(t)}),t=s.join(this._spliter);break;case C.ControlType.Radio:case C.ControlType.DropDownList:this.dataSource=this.condition.control.enumValues,t=this.getFormatEnumValue(e);break;case C.ControlType.BoolCheck:t=this.getFormatCheckBoxValue(e);break;default:t=e}return t},B.decorators=[{type:D.Component,args:[{selector:"lib-summary-condition",template:'<span class="summary-condition--label">{{condition.fieldName}}</span>:<span class="summary-condition--text">{{text}}</span>',styles:[""]}]}],B.ctorParameters=function(){return[{type:b.DateTimeHelperService},{type:w.NumberHelperService},{type:D.Injector}]},B.propDecorators={condition:[{type:D.Input}],filledSymbol:[{type:D.Input}]},B);function B(e,t,o){this.dtHelper=e,this.numberHelper=t,this.injector=o,this._spliter="",this._isRange=!1,this.showTime=!1,this.textField="name",this.valueField="value",this.returnFormat="",this.text="",this.thousand=",",this.decimal=".",this.expression="%s%v",this.currencySymbol="￥",this.filledSymbol="0",this.localeService=this.injector.get(q.LocaleService)}var U=(K.prototype.ngOnDestroy=function(){this.ro&&(this.ro.unobserve(this.wrapperEl.nativeElement),this.ro=null)},K.prototype.ngOnInit=function(){this.observerElement()},K.prototype.observerElement=function(){var i=this;this.ngZone.runOutsideAngular(function(){i.ro=new V(function(e,t){var o=e[0].contentRect.width;15<Math.abs(o-i.widthFlag)&&(i.widthFlag=o,i.changeTipsState())}),i.ro.observe(i.wrapperEl.nativeElement)})},K.prototype.changeTipsState=function(){var e=this.enableTips;(e=this.wrapperEl.nativeElement.clientWidth+2<this.wrapperEl.nativeElement.scrollWidth)!==this.enableTips&&(this.enableTips=e,this.cd.markForCheck(),this.cd.detectChanges())},K.decorators=[{type:D.Component,args:[{selector:"lib-summary-list",template:'<div class="summary-condition-wrapper" #wrapper [farrisTooltip]="enableTips" [placement]="\'bottom\'" [content]="tpTemplate" [tipCls]="\'summary-list--tips\'" [tipWidth]="widthFlag+\'px\'">\r\n    <ng-container *ngFor="let currentItem of conditions;let i = index;let lastIndex=last;">\r\n        <lib-summary-condition class="summary-condition--item" [condition]="currentItem"></lib-summary-condition>\r\n        <span class="summary-condition--spliter" [ngClass]="{\'last-spliter\':i==lastIndex}"></span>\r\n    </ng-container>\r\n</div>\r\n<ng-template #tpTemplate>\r\n    <div class="summary-condition--tips" *ngIf="enableTips">\r\n        <ng-container *ngFor="let currentItem of conditions;let i = index;let lastIndex=last;">\r\n            <lib-summary-condition class="summary-condition--item" [condition]="currentItem"></lib-summary-condition>\r\n            <span class="summary-condition--gutter">;</span>\r\n        </ng-container>\r\n    </div>\r\n</ng-template>',styles:[""]}]}],K.ctorParameters=function(){return[{type:D.NgZone},{type:D.ChangeDetectorRef}]},K.propDecorators={cls:[{type:D.HostBinding,args:["class.summary-list"]}],conditions:[{type:D.Input}],enableTips:[{type:D.Input}],wrapperEl:[{type:D.ViewChild,args:["wrapper",{read:D.ElementRef}]}]},K);function K(e,t){this.ngZone=e,this.cd=t,this.cls=!0,this.conditions=new Array,this.enableTips=!1,this.ro=null,this.widthFlag=0}var Y=(W.decorators=[{type:D.NgModule,args:[{imports:[t.CommonModule,n.FormsModule,r.FarrisDialogModule,l.LookupModule,a.MultiSelectModule,u.FieldGroupModule,p.InputGroupModule,y.FDropdownDirectiveTypeModule,f.NotifyModule.forRoot(),m.LoadingModule.forRoot(),C.QueryConditionModule,g.HttpClientModule,q.LocaleModule,S.DatagridModule,w.NumberHelperModule,b.DateHelperModule,v.FarrisTooltipModule],declarations:[O,L,A,P,U],entryComponents:[L,A],providers:[C.SolutionService],exports:[O,L,A]}]}],W);function W(){}e.QuerySolutionModule=Y,e.QuerySolutionComponent=O,e.ɵe=A,e.ɵc=L,e.SummaryConditionComponent=P,e.SummaryListComponent=U,e.QUERYSOLUTION_HANDLER_TOKEN=T,e.SolutionCacheService=H,e.ɵd=R,e.ɵb=k,e.ɵa=I,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=gsp-cmp-querysolution.umd.min.js.map