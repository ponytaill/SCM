/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable, Injector, ComponentFactoryResolver } from '@angular/core';
import { FileUploadComponent } from './upload/file-upload/file-upload.component';
import { BsModalService } from '@farris/ui-modal';
import { of } from 'rxjs';
export class UploadDialogService {
    /**
     * @param {?} modalService
     * @param {?} componentFactoryResolver
     * @param {?} injector
     */
    constructor(modalService, componentFactoryResolver, injector) {
        this.modalService = modalService;
        this.componentFactoryResolver = componentFactoryResolver;
        this.injector = injector;
        this.fileInfoList = [];
    }
    /**
     * @param {?} formId
     * @param {?} rootId
     * @return {?}
     */
    showDialog(formId, rootId) {
        /** @type {?} */
        let flag = 0;
        return new Promise((/**
         * @param {?} resolve
         * @return {?}
         */
        resolve => {
            /** @type {?} */
            var viewerFactory = this.componentFactoryResolver.resolveComponentFactory(FileUploadComponent);
            /** @type {?} */
            var viewerRef = viewerFactory.create(this.injector);
            viewerRef.instance.rootId = rootId;
            viewerRef.instance.formId = formId;
            this.dlg = this.modalService.show(viewerRef, {
                title: '上传文件',
                width: 950, height: 570,
                buttons: [
                    {
                        text: '保存', cls: 'k-button k-button-icontext k-primary', handle: (/**
                         * @return {?}
                         */
                        () => {
                            this.dlg.content.upload().subscribe((/**
                             * @param {?} res
                             * @return {?}
                             */
                            res => {
                                if (res) {
                                    resolve(res);
                                    flag = 1;
                                    this.dlg.close();
                                }
                            }));
                        })
                    },
                    {
                        text: '关闭', cls: 'k-button k-button-icontext', handle: (/**
                         * @return {?}
                         */
                        () => {
                            this.dlg.close();
                        })
                    }
                ],
                showButtons: true,
                showMaxButton: false,
                beforeClose: (/**
                 * @return {?}
                 */
                () => {
                    if (flag == 0)
                        this.dlg.content.cancel();
                    return of(true);
                })
            });
        }));
    }
    /**
     * @param {?} formId
     * @param {?} rootId
     * @param {?=} oldIdList
     * @return {?}
     */
    uploadFile(formId, rootId, oldIdList = []) {
        return this.uploadFileWithLimit(formId, rootId, null, oldIdList);
    }
    /**
     * @param {?} formId
     * @param {?} rootId
     * @param {?} limit
     * @param {?=} oldIdList
     * @return {?}
     */
    uploadFileWithLimit(formId, rootId, limit, oldIdList = []) {
        /** @type {?} */
        let flag = 0;
        return new Promise((/**
         * @param {?} resolve
         * @return {?}
         */
        resolve => {
            /** @type {?} */
            var uploadFactory = this.componentFactoryResolver.resolveComponentFactory(FileUploadComponent);
            /** @type {?} */
            var uploadRef = uploadFactory.create(this.injector);
            if (limit != null) {
                uploadRef.instance.fileCount = limit.fileCount;
                if (limit.fileType != null && limit.fileType != "")
                    uploadRef.instance.fileType = limit.fileType;
            }
            uploadRef.instance.rootId = rootId;
            uploadRef.instance.formId = formId;
            uploadRef.instance.oldIdList = oldIdList;
            this.dlg = this.modalService.show(uploadRef, {
                title: '上传文件',
                width: 950, height: 570,
                buttons: [
                    {
                        text: '保存', cls: 'k-button k-button-icontext k-primary', handle: (/**
                         * @return {?}
                         */
                        () => {
                            this.dlg.content.upload().subscribe((/**
                             * @param {?} res
                             * @return {?}
                             */
                            res => {
                                if (res) {
                                    resolve(res);
                                    flag = 1;
                                    this.dlg.close();
                                }
                            }));
                        })
                    },
                    {
                        text: '关闭', cls: 'k-button k-button-icontext', handle: (/**
                         * @return {?}
                         */
                        () => {
                            this.dlg.close();
                        })
                    }
                ],
                showButtons: true,
                showMaxButton: false,
                beforeClose: (/**
                 * @return {?}
                 */
                () => {
                    if (flag == 0)
                        this.dlg.content.cancel();
                    return of(true);
                })
            });
        }));
    }
}
UploadDialogService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
UploadDialogService.ctorParameters = () => [
    { type: BsModalService },
    { type: ComponentFactoryResolver },
    { type: Injector }
];
if (false) {
    /** @type {?} */
    UploadDialogService.prototype.dlg;
    /** @type {?} */
    UploadDialogService.prototype.fileInfoList;
    /**
     * @type {?}
     * @private
     */
    UploadDialogService.prototype.modalService;
    /**
     * @type {?}
     * @private
     */
    UploadDialogService.prototype.componentFactoryResolver;
    /**
     * @type {?}
     * @private
     */
    UploadDialogService.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXBsb2FkZGlhbG9nLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLXN2Yy9mb3JtZG9jLXVwbG9hZC8iLCJzb3VyY2VzIjpbImxpYi91cGxvYWRkaWFsb2cuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDL0UsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sNENBQTRDLENBQUM7QUFDakYsT0FBTyxFQUFFLGNBQWMsRUFBYyxNQUFNLGtCQUFrQixDQUFDO0FBRTlELE9BQU8sRUFBYyxFQUFFLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFLdEMsTUFBTSxPQUFPLG1CQUFtQjs7Ozs7O0lBQzVCLFlBQW9CLFlBQTRCLEVBQVUsd0JBQWtELEVBQVUsUUFBa0I7UUFBcEgsaUJBQVksR0FBWixZQUFZLENBQWdCO1FBQVUsNkJBQXdCLEdBQXhCLHdCQUF3QixDQUEwQjtRQUFVLGFBQVEsR0FBUixRQUFRLENBQVU7UUFJeEksaUJBQVksR0FBcUIsRUFBRSxDQUFDO0lBSndHLENBQUM7Ozs7OztJQU03SSxVQUFVLENBQUMsTUFBYyxFQUFFLE1BQWM7O1lBQ2pDLElBQUksR0FBRyxDQUFDO1FBQ1osT0FBTyxJQUFJLE9BQU87Ozs7UUFBQyxPQUFPLENBQUMsRUFBRTs7Z0JBQ3JCLGFBQWEsR0FBRyxJQUFJLENBQUMsd0JBQXdCLENBQUMsdUJBQXVCLENBQUMsbUJBQW1CLENBQUM7O2dCQUMxRixTQUFTLEdBQUcsYUFBYSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDO1lBRW5ELFNBQVMsQ0FBQyxRQUFRLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztZQUNuQyxTQUFTLENBQUMsUUFBUSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7WUFFbkMsSUFBSSxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsWUFBWSxD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RTs0QkFDbEUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFLENBQUMsU0FBUzs7Ozs0QkFDL0IsR0FBRyxDQUFDLEVBQUU7Z0NBQ0YsSUFBSSxHQUFHLEVBQUU7b0NBQ0wsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO29DQUNiLElBQUksR0FBRyxDQUFDLENBQUM7b0NBQ1QsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsQ0FBQztpQ0FDcEI7NEJBQ0wsQ0FBQyxFQUNKLENBQUM7d0JBQ04sQ0FBQyxDQUFBO3FCQUNKO29CQUNEO3dCQUNJLElBQUksRUFBRSxJQUFJLEVBQUUsR0FBRyxFQUFFLDRCQUE0QixFQUFFLE1BQU07Ozt3QkFBRSxHQUFHLEVBQUU7NEJBQ3hELElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxFQUFFLENBQUM7d0JBQ3JCLENBQUMsQ0FBQTtxQkFDSjtpQkFDSjtnQkFFRCxXQUFXLEVBQUUsSUFBSTtnQkFDakIsYUFBYSxFQUFFLEtBQUs7Z0JBQ3BCLFdBQVc7OztnQkFBRSxHQUF3QixFQUFFO29CQUNuQyxJQUFJLElBQUksSUFBSSxDQUFDO3dCQUNULElBQUksQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLE1BQU0sRUFBRSxDQUFDO29CQUM5QixPQUFPLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDcEIsQ0FBQyxDQUFBO2FBQ0osQ0FBQyxDQUFDO1FBQ1AsQ0FBQyxFQUFDLENBQUE7SUFDTixDQUFDOzs7WUExR0osVUFBVTs7OztZQU5GLGNBQWM7WUFGUSx3QkFBd0I7WUFBbEMsUUFBUTs7OztJQVl6QixrQ0FBZ0I7O0lBRWhCLDJDQUFvQzs7Ozs7SUFKeEIsMkNBQW9DOzs7OztJQUFFLHVEQUEwRDs7Ozs7SUFBRSx1Q0FBMEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlLCBJbmplY3RvciwgQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEZpbGVVcGxvYWRDb21wb25lbnQgfSBmcm9tICcuL3VwbG9hZC9maWxlLXVwbG9hZC9maWxlLXVwbG9hZC5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBCc01vZGFsU2VydmljZSwgQnNNb2RhbFJlZiB9IGZyb20gJ0BmYXJyaXMvdWktbW9kYWwnO1xyXG5pbXBvcnQgeyBVcGxvYWRGaWxlSW5mbyB9IGZyb20gJy4vdXBsb2FkL2VudGl0eS91cGxvYWRmaWxlaW5mbyc7XHJcbmltcG9ydCB7IE9ic2VydmFibGUsIG9mIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IFVwbG9hZExpbWl0IH0gZnJvbSAnLi91cGxvYWQvZW50aXR5L3VwbG9hZGxpbWl0JztcclxuXHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBVcGxvYWREaWFsb2dTZXJ2aWNlIHtcclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgbW9kYWxTZXJ2aWNlOiBCc01vZGFsU2VydmljZSwgcHJpdmF0ZSBjb21wb25lbnRGYWN0b3J5UmVzb2x2ZXI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciwgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IpIHsgfVxyXG5cclxuICAgIGRsZzogQnNNb2RhbFJlZjtcclxuXHJcbiAgICBmaWxlSW5mb0xpc3Q6IFVwbG9hZEZpbGVJbmZvW10gPSBbXTtcclxuXHJcbiAgICBzaG93RGlhbG9nKGZvcm1JZDogc3RyaW5nLCByb290SWQ6IHN0cmluZykge1xyXG4gICAgICAgIGxldCBmbGFnID0gMDtcclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XHJcbiAgICAgICAgICAgIHZhciB2aWV3ZXJGYWN0b3J5ID0gdGhpcy5jb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoRmlsZVVwbG9hZENvbXBvbmVudCk7XHJcbiAgICAgICAgICAgIHZhciB2aWV3ZXJSZWYgPSB2aWV3ZXJGYWN0b3J5LmNyZWF0ZSh0aGlzLmluamVjdG9yKTtcclxuXHJcbiAgICAgICAgICAgIHZpZXdlclJlZi5pbnN0YW5jZS5yb290SWQgPSByb290SWQ7XHJcbiAgICAgICAgICAgIHZpZXdlclJlZi5pbnN0YW5jZS5mb3JtSWQgPSBmb3JtSWQ7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmRsZyA9IHRoaXMubW9kYWxTZXJ2aWNlLnNob3codmlld2VyUmVmLCB7XHJcbiAgICAgICAgICAgICAgICB0aXRsZTogJ+S4iuS8oOaWh+S7ticsXHJcbiAgICAgICAgICAgICAgICB3aWR0aDogOTUwLCBoZWlnaHQ6IDU3MCxcclxuICAgICAgICAgICAgICAgIGJ1dHRvbnM6IFtcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICfkv53lrZgnLCBjbHM6ICdrLWJ1dHRvbiBrLWJ1dHRvbi1pY29udGV4dCBrLXByaW1hcnknLCBoYW5kbGU6ICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGxnLmNvbnRlbnQudXBsb2FkKCkuc3Vic2NyaWJlKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcyA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZsYWcgPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kbGcuY2xvc2UoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogJ+WFs+mXrScsIGNsczogJ2stYnV0dG9uIGstYnV0dG9uLWljb250ZXh0JywgaGFuZGxlOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRsZy5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgXSxcclxuXHJcbiAgICAgICAgICAgICAgICBzaG93QnV0dG9uczogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIHNob3dNYXhCdXR0b246IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgYmVmb3JlQ2xvc2U6ICgpOiBPYnNlcnZhYmxlPGJvb2xlYW4+ID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZmxhZyA9PSAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRsZy5jb250ZW50LmNhbmNlbCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvZih0cnVlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSlcclxuICAgIH1cclxuXHJcbiAgICB1cGxvYWRGaWxlKGZvcm1JZDogc3RyaW5nLCByb290SWQ6IHN0cmluZyxvbGRJZExpc3Q6IHN0cmluZ1tdPVtdKSB7IFxyXG4gICAgICAgIHJldHVybiB0aGlzLnVwbG9hZEZpbGVXaXRoTGltaXQoZm9ybUlkLCByb290SWQsIG51bGwsIG9sZElkTGlzdCk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHVwbG9hZEZpbGVXaXRoTGltaXQoZm9ybUlkOiBzdHJpbmcsIHJvb3RJZDogc3RyaW5nLCBsaW1pdDogVXBsb2FkTGltaXQsIG9sZElkTGlzdDogc3RyaW5nW109W10pIHtcclxuICAgICAgICBsZXQgZmxhZyA9IDA7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xyXG4gICAgICAgICAgICB2YXIgdXBsb2FkRmFjdG9yeSA9IHRoaXMuY29tcG9uZW50RmFjdG9yeVJlc29sdmVyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KEZpbGVVcGxvYWRDb21wb25lbnQpO1xyXG4gICAgICAgICAgICB2YXIgdXBsb2FkUmVmID0gdXBsb2FkRmFjdG9yeS5jcmVhdGUodGhpcy5pbmplY3Rvcik7XHJcbiAgICAgICAgICAgIGlmIChsaW1pdCAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICB1cGxvYWRSZWYuaW5zdGFuY2UuZmlsZUNvdW50ID0gbGltaXQuZmlsZUNvdW50O1xyXG4gICAgICAgICAgICAgICAgaWYgKGxpbWl0LmZpbGVUeXBlICE9IG51bGwgJiYgbGltaXQuZmlsZVR5cGUgIT0gXCJcIilcclxuICAgICAgICAgICAgICAgICAgICB1cGxvYWRSZWYuaW5zdGFuY2UuZmlsZVR5cGUgPSBsaW1pdC5maWxlVHlwZVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB1cGxvYWRSZWYuaW5zdGFuY2Uucm9vdElkID0gcm9vdElkO1xyXG4gICAgICAgICAgICB1cGxvYWRSZWYuaW5zdGFuY2UuZm9ybUlkID0gZm9ybUlkO1xyXG4gICAgICAgICAgICB1cGxvYWRSZWYuaW5zdGFuY2Uub2xkSWRMaXN0PW9sZElkTGlzdDtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuZGxnID0gdGhpcy5tb2RhbFNlcnZpY2Uuc2hvdyh1cGxvYWRSZWYsIHtcclxuICAgICAgICAgICAgICAgIHRpdGxlOiAn5LiK5Lyg5paH5Lu2JyxcclxuICAgICAgICAgICAgICAgIHdpZHRoOiA5NTAsIGhlaWdodDogNTcwLFxyXG4gICAgICAgICAgICAgICAgYnV0dG9uczogW1xyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICfkv53lrZgnLCBjbHM6ICdrLWJ1dHRvbiBrLWJ1dHRvbi1pY29udGV4dCBrLXByaW1hcnknLCBoYW5kbGU6ICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGxnLmNvbnRlbnQudXBsb2FkKCkuc3Vic2NyaWJlKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcyA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZsYWcgPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kbGcuY2xvc2UoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogJ+WFs+mXrScsIGNsczogJ2stYnV0dG9uIGstYnV0dG9uLWljb250ZXh0JywgaGFuZGxlOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRsZy5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgXSxcclxuXHJcbiAgICAgICAgICAgICAgICBzaG93QnV0dG9uczogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIHNob3dNYXhCdXR0b246IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgYmVmb3JlQ2xvc2U6ICgpOiBPYnNlcnZhYmxlPGJvb2xlYW4+ID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZmxhZyA9PSAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRsZy5jb250ZW50LmNhbmNlbCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvZih0cnVlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSlcclxuICAgIH1cclxufSJdfQ==