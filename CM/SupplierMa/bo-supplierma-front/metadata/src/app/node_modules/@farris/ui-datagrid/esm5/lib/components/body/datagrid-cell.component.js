/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*
 * @Author: 疯狂秀才(Lucas Huang)
 * @Date: 2019-08-06 07:43:53
 * @LastEditors: 疯狂秀才(Lucas Huang)
 * @LastEditTime: 2019-10-31 09:11:02
 * @QQ: 1055818239
 * @Version: v0.0.1
 */
import { Component, Input, Output, EventEmitter, ViewChild, ElementRef, ChangeDetectionStrategy, ChangeDetectorRef, ViewContainerRef, Injector, Inject, forwardRef, Renderer2 } from '@angular/core';
import { DomSanitizer } from '@angular/platform-browser';
import { ColumnFormatService } from '@farris/ui-common/column';
import { Utils } from '../../utils/utils';
import { DatagridFacadeService } from '../../services/datagrid-facade.service';
import { DatagridComponent } from '../../datagrid.component';
import { DatagridRowDirective } from './datagrid-row.directive';
import { GridCellEditorDirective } from '../editors/cell-editor.directive';
import { DatagridService } from '../../services/datagrid.service';
import { SafePipe } from './../../utils/safe.pipe';
import { TR_PREFIX } from '../../types/constant';
// <ng-container *ngIf="!isEditing && !column.template">
//     <ng-container *ngIf="column.formatter">
//         <span *ngIf="cellFormatterIsFn" [innerHtml]=" column | formatCellData: rowData | safe: 'html'"></span>
//         <span *ngIf="!cellFormatterIsFn">{{  column | formatCellData: rowData }}</span>
//     </ng-container>
//     <span *ngIf="!column.formatter" [class.grid-cell-nowrap]="dg.nowrap" [class.grid-cell-wrap]="!dg.nowrap">{{  column | formatCellData: rowData }}</span>
// </ng-container>
// <span *ngIf="!isEditing && !column.template" cell-content [class.grid-cell-nowrap]="dg.nowrap" [class.grid-cell-wrap]="!dg.nowrap"
//     [rowData]="rowData" [column]="column" [nowrap]="dg.nowrap"></span>
var DatagridCellComponent = /** @class */ (function () {
    function DatagridCellComponent(dg, dr, el, cd, injector, colFormatSer, domSanitizer) {
        var _this = this;
        this.dg = dg;
        this.dr = dr;
        this.el = el;
        this.cd = cd;
        this.injector = injector;
        this.colFormatSer = colFormatSer;
        this.domSanitizer = domSanitizer;
        this.cls = '';
        this.lastColumn = false;
        // @ViewChild('celltip') celltip: DatagridCellTooltipDirective;
        this._isEditing = false;
        this.controlHeight = 'auto';
        this.isSelected = false;
        this._cellEditorTemplate = null;
        this.cellClick = new EventEmitter();
        this.cellDblClick = new EventEmitter();
        this.cellContext = {};
        this.cellStyler = {};
        this.safePipe = null;
        this.ro = null;
        this.canEdit = (/**
         * @return {?}
         */
        function () { return _this.dg.editable && _this.dg.editMode === 'cell' && _this.column.editor; });
        this.dfs = this.injector.get(DatagridFacadeService);
        this.dgs = this.injector.get(DatagridService);
        this.safePipe = new SafePipe(this.domSanitizer);
        this.render = this.injector.get(Renderer2);
        // this.cellSubscription = this.dfs.currentCell$.pipe(
        //     filter((cell: CellInfo) => {
        //         return cell && this.column.editor && cell.rowIndex === this.rowIndex && cell.field === this.column.field;
        //     })
        // ).subscribe((cell: CellInfo) => {
        //     if (cell && this.column.editor) {
        //         this.isEditing = cell.isEditing;
        //         cell.cellRef = this;
        //         cell.column = this.column;
        //         if (!this.cd['destroyed']) {
        //             this.cd.detectChanges();
        //         }
        //     }
        // });
    }
    Object.defineProperty(DatagridCellComponent.prototype, "isEditing", {
        get: /**
         * @return {?}
         */
        function () {
            return this._isEditing;
        },
        set: /**
         * @param {?} v
         * @return {?}
         */
        function (v) {
            var _this = this;
            if (this._isEditing === v) {
                return;
            }
            this._isEditing = v;
            if (v) {
                if (!this.dr.form || !Object.keys(this.dr.form.controls).length) {
                    this.dr.initFormControl();
                }
                if (this.column.editorTemplate && this.column.editorTemplate.elementRef) {
                    this.cellContext.formGroup = this.dr.form;
                    setTimeout((/**
                     * @return {?}
                     */
                    function () {
                        if (_this.el) {
                            /** @type {?} */
                            var input = _this.el.nativeElement.querySelector('input,textarea');
                            if (input) {
                                input.focus();
                            }
                        }
                    }), 10);
                }
            }
            if (this.column.editor && this.column.editor.type === 'textarea') {
                if (!this.dg.nowrap) {
                    this.controlHeight = this.dr.el.nativeElement.offsetHeight;
                }
            }
            if (!this.cd['destroyed']) {
                this.cd.detectChanges();
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DatagridCellComponent.prototype, "cellEditorTemplate", {
        get: /**
         * @return {?}
         */
        function () {
            return this._cellEditorTemplate;
        },
        set: /**
         * @param {?} v
         * @return {?}
         */
        function (v) {
            this._cellEditorTemplate = v;
            if (v) {
                this.dg.dgs.cellEditorCreated.emit({ editorRef: null, column: this.column, cellEditorRef: null, templateRef: v });
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DatagridCellComponent.prototype, "value", {
        get: /**
         * @return {?}
         */
        function () {
            if (this.rowData && this.column && this.column.field) {
                return Utils.getValue(this.column.field, this.rowData);
            }
            return '';
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DatagridCellComponent.prototype, "formControl", {
        get: /**
         * @return {?}
         */
        function () {
            if (this.cellEditor) {
                return this.cellEditor.componentRef.instance.formControl;
            }
            else if (this.column.editorTemplate) {
                return this.dr.form.get(this.column.field);
            }
            return null;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DatagridCellComponent.prototype, "cellFormatterIsFn", {
        // get verticalAlign() {
        //     let va = 'center';
        //     switch (this.column.valign) {
        //         case 'top':
        //             va = 'flex-start';
        //             break;
        //         case 'bottom':
        //             va = 'flex-end';
        //             break;
        //         default:
        //             va = 'center';
        //             break;
        //     }
        //     return va;
        // }
        // get horizontalAlign() {
        //     let ha = 'flex-start';
        //     if (this.column.align === 'right') {
        //         ha = 'flex-end';
        //     } else if (this.column.align === 'center') {
        //         ha = 'center';
        //     }
        //     return ha;
        // }
        // get cellStyle() {
        //     // const w = this.lastColumn ? (this.column.width - 6) + 'px' : '100%';
        //     // const style = {
        //     //     width: w
        //     // };
        //     if (!this.isEditing) {
        //         return Object.assign({}, {
        //             'align-items': this.verticalAlign,
        //             'justify-content': this.horizontalAlign
        //         });
        //     } else {
        //         return Object.assign({}, {
        //             'justify-content': this.horizontalAlign
        //         });
        //     }
        // }
        get: 
        // get verticalAlign() {
        //     let va = 'center';
        //     switch (this.column.valign) {
        //         case 'top':
        //             va = 'flex-start';
        //             break;
        //         case 'bottom':
        //             va = 'flex-end';
        //             break;
        //         default:
        //             va = 'center';
        //             break;
        //     }
        //     return va;
        // }
        // get horizontalAlign() {
        //     let ha = 'flex-start';
        //     if (this.column.align === 'right') {
        //         ha = 'flex-end';
        //     } else if (this.column.align === 'center') {
        //         ha = 'center';
        //     }
        //     return ha;
        // }
        // get cellStyle() {
        //     // const w = this.lastColumn ? (this.column.width - 6) + 'px' : '100%';
        //     // const style = {
        //     //     width: w
        //     // };
        //     if (!this.isEditing) {
        //         return Object.assign({}, {
        //             'align-items': this.verticalAlign,
        //             'justify-content': this.horizontalAlign
        //         });
        //     } else {
        //         return Object.assign({}, {
        //             'justify-content': this.horizontalAlign
        //         });
        //     }
        // }
        /**
         * @return {?}
         */
        function () {
            return typeof this.column.formatter === 'function' || this.column.formatter.type === 'boolean';
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    DatagridCellComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.initCellTemplateContext();
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    DatagridCellComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        if (changes.rowData && !changes.rowData.isFirstChange()) {
            this.initCellTemplateContext();
            this.buildCustomCellStyle();
            if (this.formControl) {
                /** @type {?} */
                var val = Utils.getValue(this.column.field, this.rowData);
                this.formControl.setValue(val);
            }
        }
    };
    /**
     * @private
     * @return {?}
     */
    DatagridCellComponent.prototype.initCellTemplateContext = /**
     * @private
     * @return {?}
     */
    function () {
        this.cellContext = {
            field: this.column.field,
            rowIndex: this.rowIndex,
            rowData: this.rowData,
            column: this.column,
            instance: this,
            formGroup: this.dr.form,
            tools: {
                utils: this.dg.commonUtils,
                format: this.dg.colFormatSer,
                number: this.dg.colFormatSer['numberhelper'],
                date: this.dg.colFormatSer['datehelper']
            },
        };
    };
    /**
     * @return {?}
     */
    DatagridCellComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        this.buildCustomCellStyle();
    };
    /**
     * @return {?}
     */
    DatagridCellComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        if (this.cellSubscription) {
            this.cellSubscription.unsubscribe();
            this.cellSubscription = null;
        }
        if (this.rowUpdateSubscription) {
            this.rowUpdateSubscription.unsubscribe();
            this.rowUpdateSubscription = null;
        }
        this.cellContext = null;
    };
    /**
     * @private
     * @param {?=} rowData
     * @return {?}
     */
    DatagridCellComponent.prototype.buildCustomCellStyle = /**
     * @private
     * @param {?=} rowData
     * @return {?}
     */
    function (rowData) {
        if (rowData === void 0) { rowData = null; }
        /** @type {?} */
        var td = this.el.nativeElement.parentNode;
        if (!td.id) {
            td.id = TR_PREFIX + this.dr.rowId + '_' + this.rowIndex + '-' + this.column.field;
        }
        td.id = td.id.replace(/\./g, '_');
        if (this.column.styler) {
            /** @type {?} */
            var _rd = rowData || this.rowData;
            /** @type {?} */
            var cs = this.column.styler(_rd[this.column.field], _rd, this.rowIndex);
            if (cs && Object.keys(cs).length) {
                this.dg.renderCustomStyle(cs, td);
            }
        }
        else {
            this.dg.dgs.removeCssRule('#' + td.id);
        }
    };
    /**
     * @param {?=} val
     * @return {?}
     */
    DatagridCellComponent.prototype.updateValue = /**
     * @param {?=} val
     * @return {?}
     */
    function (val) {
        var _this = this;
        var _a;
        if (this.dr.form) {
            // this.rowData = Object.assign(this.rowData, this.dr.form.value);
            Utils.setValue(this.column.field, val, this.rowData);
            // this.rowData = {...this.rowData};
            /** @type {?} */
            var rowid_1 = this.rowData[this.dg.idField];
            /** @type {?} */
            var item = this.dg.data.find((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n[_this.dg.idField] === rowid_1; }));
            if (item) {
                Utils.setValue(this.column.field, val, item);
            }
            this.dfs.updateCheckedData(rowid_1, (_a = {}, _a[this.column.field] = val, _a));
            if (!this.cd['destroyed']) {
                this.cd.detectChanges();
            }
        }
    };
    DatagridCellComponent.decorators = [
        { type: Component, args: [{
                    selector: 'grid-body-cell',
                    template: "\n    <div\n     [attr.cell-tooltip]=\"column.showTips && !isEditing\" [attr.tipMode]=\" column.tipMode || 'auto'\"\n     [attr.message]=\"column | tipmsg: rowData\"  [attr.position]=\" column?.tipOptions?.position || 'top-left'\"\n     [attr.tipWidth]=\"column?.tipOptions?.width\" [attr.tipHeight]=\"column?.tipOptions?.height\"\n     class=\"f-datagrid-cell-content cell-text-align__{{column.field}}\" #cellContainer\n    >\n        <ng-container *ngIf=\"!isEditing && !column.template\">\n            <ng-container *ngIf=\"column.formatter\">\n                <span class=\"cell-text-box\" *ngIf=\"cellFormatterIsFn\" [innerHtml]=\" column | formatCellData: rowData | safe: 'html'\"></span>\n                <span class=\"cell-text-box\" *ngIf=\"!cellFormatterIsFn\">{{  column | formatCellData: rowData }}</span>\n            </ng-container>\n            <span *ngIf=\"!column.formatter\" class=\"cell-text-box\" [class.grid-cell-nowrap]=\"dg.nowrap\" [class.grid-cell-wrap]=\"!dg.nowrap\">{{  column | formatCellData: rowData }}</span>\n        </ng-container>\n\n        <ng-container #cellTemplate *ngIf=\"!isEditing && column.template\" [ngTemplateOutlet]=\"column.template\" [ngTemplateOutletContext]=\"{$implicit: cellContext}\"></ng-container>\n        <ng-container #cellEditorTemplate *ngIf=\"isEditing && column.editorTemplate\" [ngTemplateOutlet]=\"column.editorTemplate\" [ngTemplateOutletContext]=\"{$implicit: cellContext}\"></ng-container>\n        <ng-container #editorTemplate *ngIf=\"isEditing && !column.editorTemplate\" cell-editor [height]=\"controlHeight\" [rowData]=\"rowData\" [value]=\"value\" [column]=\"column\" [group]=\"dr.form\"></ng-container>\n    </div>\n    ",
                    changeDetection: ChangeDetectionStrategy.Default
                }] }
    ];
    /** @nocollapse */
    DatagridCellComponent.ctorParameters = function () { return [
        { type: DatagridComponent, decorators: [{ type: Inject, args: [forwardRef((/**
                         * @return {?}
                         */
                        function () { return DatagridComponent; })),] }] },
        { type: DatagridRowDirective, decorators: [{ type: Inject, args: [forwardRef((/**
                         * @return {?}
                         */
                        function () { return DatagridRowDirective; })),] }] },
        { type: ElementRef },
        { type: ChangeDetectorRef },
        { type: Injector },
        { type: ColumnFormatService },
        { type: DomSanitizer }
    ]; };
    DatagridCellComponent.propDecorators = {
        width: [{ type: Input }],
        height: [{ type: Input }],
        cls: [{ type: Input }],
        column: [{ type: Input }],
        rowData: [{ type: Input }],
        rowIndex: [{ type: Input }],
        lastColumn: [{ type: Input }],
        isEditing: [{ type: Input }],
        isSelected: [{ type: Input }],
        cellContainer: [{ type: ViewChild, args: ['cellContainer',] }],
        cellTemplateVcr: [{ type: ViewChild, args: ['cellTemplate', { read: ViewContainerRef },] }],
        cellEditorTemplate: [{ type: ViewChild, args: ['cellEditorTemplate', { read: ViewContainerRef },] }],
        cellEditor: [{ type: ViewChild, args: [GridCellEditorDirective,] }],
        cellClick: [{ type: Output }],
        cellDblClick: [{ type: Output }]
    };
    return DatagridCellComponent;
}());
export { DatagridCellComponent };
if (false) {
    /** @type {?} */
    DatagridCellComponent.prototype.width;
    /** @type {?} */
    DatagridCellComponent.prototype.height;
    /** @type {?} */
    DatagridCellComponent.prototype.cls;
    /** @type {?} */
    DatagridCellComponent.prototype.column;
    /** @type {?} */
    DatagridCellComponent.prototype.rowData;
    /** @type {?} */
    DatagridCellComponent.prototype.rowIndex;
    /** @type {?} */
    DatagridCellComponent.prototype.lastColumn;
    /**
     * @type {?}
     * @private
     */
    DatagridCellComponent.prototype._isEditing;
    /** @type {?} */
    DatagridCellComponent.prototype.controlHeight;
    /** @type {?} */
    DatagridCellComponent.prototype.isSelected;
    /** @type {?} */
    DatagridCellComponent.prototype.cellContainer;
    /** @type {?} */
    DatagridCellComponent.prototype.cellTemplateVcr;
    /**
     * @type {?}
     * @private
     */
    DatagridCellComponent.prototype._cellEditorTemplate;
    /** @type {?} */
    DatagridCellComponent.prototype.cellEditor;
    /** @type {?} */
    DatagridCellComponent.prototype.cellClick;
    /** @type {?} */
    DatagridCellComponent.prototype.cellDblClick;
    /** @type {?} */
    DatagridCellComponent.prototype.cellContext;
    /** @type {?} */
    DatagridCellComponent.prototype.cellStyler;
    /**
     * @type {?}
     * @private
     */
    DatagridCellComponent.prototype.dfs;
    /**
     * @type {?}
     * @private
     */
    DatagridCellComponent.prototype.dgs;
    /**
     * @type {?}
     * @private
     */
    DatagridCellComponent.prototype.cellSubscription;
    /**
     * @type {?}
     * @private
     */
    DatagridCellComponent.prototype.rowUpdateSubscription;
    /**
     * @type {?}
     * @private
     */
    DatagridCellComponent.prototype.safePipe;
    /**
     * @type {?}
     * @private
     */
    DatagridCellComponent.prototype.render;
    /**
     * @type {?}
     * @private
     */
    DatagridCellComponent.prototype.ro;
    /** @type {?} */
    DatagridCellComponent.prototype.canEdit;
    /** @type {?} */
    DatagridCellComponent.prototype.dg;
    /** @type {?} */
    DatagridCellComponent.prototype.dr;
    /** @type {?} */
    DatagridCellComponent.prototype.el;
    /** @type {?} */
    DatagridCellComponent.prototype.cd;
    /**
     * @type {?}
     * @private
     */
    DatagridCellComponent.prototype.injector;
    /** @type {?} */
    DatagridCellComponent.prototype.colFormatSer;
    /**
     * @type {?}
     * @private
     */
    DatagridCellComponent.prototype.domSanitizer;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YWdyaWQtY2VsbC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWRhdGFncmlkLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvYm9keS9kYXRhZ3JpZC1jZWxsLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFVQSxPQUFPLEVBQUUsU0FBUyxFQUFVLEtBQUssRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUNuRCxTQUFTLEVBQUUsVUFBVSxFQUFFLHVCQUF1QixFQUFFLGlCQUFpQixFQUFFLGdCQUFnQixFQUN4RSxRQUFRLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBZ0MsU0FBUyxFQUFDLE1BQU0sZUFBZSxDQUFDO0FBQzNHLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUd6RCxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUUvRCxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDMUMsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sd0NBQXdDLENBQUM7QUFDL0UsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDN0QsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFFaEUsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sa0NBQWtDLENBQUM7QUFDM0UsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLGlDQUFpQyxDQUFDO0FBQ2xFLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUNuRCxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sc0JBQXNCLENBQUM7Ozs7Ozs7Ozs7QUFXakQ7SUE2S0ksK0JBQ3dELEVBQXFCLEVBQ2xCLEVBQXdCLEVBQ3hFLEVBQWMsRUFBUyxFQUFxQixFQUFVLFFBQWtCLEVBQ3hFLFlBQWlDLEVBQ2hDLFlBQTBCO1FB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LHVCQUF1Qjs0QkFHakMsTUFBTTsrQkFDTixNQUFNOztJQW1NWCw0QkFBQztDQUFBLEFBblNELElBbVNDO1NBM1FZLHFCQUFxQjs7O0lBQzlCLHNDQUF1Qjs7SUFDdkIsdUNBQXdCOztJQUN4QixvQ0FBa0I7O0lBQ2xCLHVDQUE0Qjs7SUFDNUIsd0NBQXNCOztJQUN0Qix5Q0FBMEI7O0lBQzFCLDJDQUE0Qjs7Ozs7SUFHNUIsMkNBQTJCOztJQUMzQiw4Q0FBdUI7O0lBdUN2QiwyQ0FBNEI7O0lBRTVCLDhDQUFzRDs7SUFDdEQsZ0RBQXdGOzs7OztJQUd4RixvREFBbUM7O0lBWW5DLDJDQUErQzs7SUFHL0MsMENBQXlDOztJQUN6Qyw2Q0FBNEM7O0lBRTVDLDRDQUFzQjs7SUFpRXRCLDJDQUFxQjs7Ozs7SUFFckIsb0NBQW1DOzs7OztJQUNuQyxvQ0FBNkI7Ozs7O0lBQzdCLGlEQUF1Qzs7Ozs7SUFDdkMsc0RBQTRDOzs7OztJQUM1Qyx5Q0FBa0M7Ozs7O0lBQ2xDLHVDQUEwQjs7Ozs7SUFDMUIsbUNBQWtDOztJQUNsQyx3Q0FBc0Y7O0lBRWxGLG1DQUF5RTs7SUFDekUsbUNBQStFOztJQUMvRSxtQ0FBcUI7O0lBQUUsbUNBQTRCOzs7OztJQUFFLHlDQUEwQjs7SUFDL0UsNkNBQXdDOzs7OztJQUN4Qyw2Q0FBa0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBGb3JtR3JvdXAgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XHJcblxyXG4vKlxyXG4gKiBAQXV0aG9yOiDnlq/ni4Lnp4DmiY0oTHVjYXMgSHVhbmcpXHJcbiAqIEBEYXRlOiAyMDE5LTA4LTA2IDA3OjQzOjUzXHJcbiAqIEBMYXN0RWRpdG9yczog55av54uC56eA5omNKEx1Y2FzIEh1YW5nKVxyXG4gKiBATGFzdEVkaXRUaW1lOiAyMDE5LTEwLTMxIDA5OjExOjAyXHJcbiAqIEBRUTogMTA1NTgxODIzOVxyXG4gKiBAVmVyc2lvbjogdjAuMC4xXHJcbiAqL1xyXG5pbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgSW5wdXQsIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBPbkNoYW5nZXMsXHJcbiAgICBWaWV3Q2hpbGQsIEVsZW1lbnRSZWYsIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LCBDaGFuZ2VEZXRlY3RvclJlZiwgVmlld0NvbnRhaW5lclJlZixcclxuICAgIE9uRGVzdHJveSwgSW5qZWN0b3IsIEluamVjdCwgZm9yd2FyZFJlZiwgQWZ0ZXJWaWV3SW5pdCwgU2ltcGxlQ2hhbmdlcywgUmVuZGVyZXIyfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgRG9tU2FuaXRpemVyIH0gZnJvbSAnQGFuZ3VsYXIvcGxhdGZvcm0tYnJvd3Nlcic7XHJcbmltcG9ydCB7IFN1YmplY3QsIFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBmaWx0ZXIgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7IENvbHVtbkZvcm1hdFNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWNvbW1vbi9jb2x1bW4nO1xyXG5pbXBvcnQgeyBEYXRhQ29sdW1uIH0gZnJvbSAnLi4vLi4vdHlwZXMvZGF0YS1jb2x1bW4nO1xyXG5pbXBvcnQgeyBVdGlscyB9IGZyb20gJy4uLy4uL3V0aWxzL3V0aWxzJztcclxuaW1wb3J0IHsgRGF0YWdyaWRGYWNhZGVTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvZGF0YWdyaWQtZmFjYWRlLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZENvbXBvbmVudCB9IGZyb20gJy4uLy4uL2RhdGFncmlkLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IERhdGFncmlkUm93RGlyZWN0aXZlIH0gZnJvbSAnLi9kYXRhZ3JpZC1yb3cuZGlyZWN0aXZlJztcclxuaW1wb3J0IHsgQ2VsbEluZm8gfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9zdGF0ZSc7XHJcbmltcG9ydCB7IEdyaWRDZWxsRWRpdG9yRGlyZWN0aXZlIH0gZnJvbSAnLi4vZWRpdG9ycy9jZWxsLWVkaXRvci5kaXJlY3RpdmUnO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZFNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9kYXRhZ3JpZC5zZXJ2aWNlJztcclxuaW1wb3J0IHsgU2FmZVBpcGUgfSBmcm9tICcuLy4uLy4uL3V0aWxzL3NhZmUucGlwZSc7XHJcbmltcG9ydCB7IFRSX1BSRUZJWCB9IGZyb20gJy4uLy4uL3R5cGVzL2NvbnN0YW50JztcclxuXHJcbiAgICAgLy8gPG5nLWNvbnRhaW5lciAqbmdJZj1cIiFpc0VkaXRpbmcgJiYgIWNvbHVtbi50ZW1wbGF0ZVwiPlxyXG4gICAgICAgIC8vICAgICA8bmctY29udGFpbmVyICpuZ0lmPVwiY29sdW1uLmZvcm1hdHRlclwiPlxyXG4gICAgICAgIC8vICAgICAgICAgPHNwYW4gKm5nSWY9XCJjZWxsRm9ybWF0dGVySXNGblwiIFtpbm5lckh0bWxdPVwiIGNvbHVtbiB8IGZvcm1hdENlbGxEYXRhOiByb3dEYXRhIHwgc2FmZTogJ2h0bWwnXCI+PC9zcGFuPlxyXG4gICAgICAgIC8vICAgICAgICAgPHNwYW4gKm5nSWY9XCIhY2VsbEZvcm1hdHRlcklzRm5cIj57eyAgY29sdW1uIHwgZm9ybWF0Q2VsbERhdGE6IHJvd0RhdGEgfX08L3NwYW4+XHJcbiAgICAgICAgLy8gICAgIDwvbmctY29udGFpbmVyPlxyXG4gICAgICAgIC8vICAgICA8c3BhbiAqbmdJZj1cIiFjb2x1bW4uZm9ybWF0dGVyXCIgW2NsYXNzLmdyaWQtY2VsbC1ub3dyYXBdPVwiZGcubm93cmFwXCIgW2NsYXNzLmdyaWQtY2VsbC13cmFwXT1cIiFkZy5ub3dyYXBcIj57eyAgY29sdW1uIHwgZm9ybWF0Q2VsbERhdGE6IHJvd0RhdGEgfX08L3NwYW4+XHJcbiAgICAgICAgLy8gPC9uZy1jb250YWluZXI+XHJcbiAgICAgICAgLy8gPHNwYW4gKm5nSWY9XCIhaXNFZGl0aW5nICYmICFjb2x1bW4udGVtcGxhdGVcIiBjZWxsLWNvbnRlbnQgW2NsYXNzLmdyaWQtY2VsbC1ub3dyYXBdPVwiZGcubm93cmFwXCIgW2NsYXNzLmdyaWQtY2VsbC13cmFwXT1cIiFkZy5ub3dyYXBcIlxyXG4gICAgICAgIC8vICAgICBbcm93RGF0YV09XCJyb3dEYXRhXCIgW2NvbHVtbl09XCJjb2x1bW5cIiBbbm93cmFwXT1cImRnLm5vd3JhcFwiPjwvc3Bhbj5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ2dyaWQtYm9keS1jZWxsJyxcclxuICAgIHRlbXBsYXRlOiBgXHJcbiAgICA8ZGl2XHJcbiAgICAgW2F0dHIuY2VsbC10b29sdGlwXT1cImNvbHVtbi5zaG93VGlwcyAmJiAhaXNFZGl0aW5nXCIgW2F0dHIudGlwTW9kZV09XCIgY29sdW1uLnRpcE1vZGUgfHwgJ2F1dG8nXCJcclxuICAgICBbYXR0ci5tZXNzYWdlXT1cImNvbHVtbiB8IHRpcG1zZzogcm93RGF0YVwiICBbYXR0ci5wb3NpdGlvbl09XCIgY29sdW1uPy50aXBPcHRpb25zPy5wb3NpdGlvbiB8fCAndG9wLWxlZnQnXCJcclxuICAgICBbYXR0ci50aXBXaWR0aF09XCJjb2x1bW4/LnRpcE9wdGlvbnM/LndpZHRoXCIgW2F0dHIudGlwSGVpZ2h0XT1cImNvbHVtbj8udGlwT3B0aW9ucz8uaGVpZ2h0XCJcclxuICAgICBjbGFzcz1cImYtZGF0YWdyaWQtY2VsbC1jb250ZW50IGNlbGwtdGV4dC1hbGlnbl9fe3tjb2x1bW4uZmllbGR9fVwiICNjZWxsQ29udGFpbmVyXHJcbiAgICA+XHJcbiAgICAgICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cIiFpc0VkaXRpbmcgJiYgIWNvbHVtbi50ZW1wbGF0ZVwiPlxyXG4gICAgICAgICAgICA8bmctY29udGFpbmVyICpuZ0lmPVwiY29sdW1uLmZvcm1hdHRlclwiPlxyXG4gICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJjZWxsLXRleHQtYm94XCIgKm5nSWY9XCJjZWxsRm9ybWF0dGVySXNGblwiIFtpbm5lckh0bWxdPVwiIGNvbHVtbiB8IGZvcm1hdENlbGxEYXRhOiByb3dEYXRhIHwgc2FmZTogJ2h0bWwnXCI+PC9zcGFuPlxyXG4gICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJjZWxsLXRleHQtYm94XCIgKm5nSWY9XCIhY2VsbEZvcm1hdHRlcklzRm5cIj57eyAgY29sdW1uIHwgZm9ybWF0Q2VsbERhdGE6IHJvd0RhdGEgfX08L3NwYW4+XHJcbiAgICAgICAgICAgIDwvbmctY29udGFpbmVyPlxyXG4gICAgICAgICAgICA8c3BhbiAqbmdJZj1cIiFjb2x1bW4uZm9ybWF0dGVyXCIgY2xhc3M9XCJjZWxsLXRleHQtYm94XCIgW2NsYXNzLmdyaWQtY2VsbC1ub3dyYXBdPVwiZGcubm93cmFwXCIgW2NsYXNzLmdyaWQtY2VsbC13cmFwXT1cIiFkZy5ub3dyYXBcIj57eyAgY29sdW1uIHwgZm9ybWF0Q2VsbERhdGE6IHJvd0RhdGEgfX08L3NwYW4+XHJcbiAgICAgICAgPC9uZy1jb250YWluZXI+XHJcblxyXG4gICAgICAgIDxuZy1jb250YWluZXIgI2NlbGxUZW1wbGF0ZSAqbmdJZj1cIiFpc0VkaXRpbmcgJiYgY29sdW1uLnRlbXBsYXRlXCIgW25nVGVtcGxhdGVPdXRsZXRdPVwiY29sdW1uLnRlbXBsYXRlXCIgW25nVGVtcGxhdGVPdXRsZXRDb250ZXh0XT1cInskaW1wbGljaXQ6IGNlbGxDb250ZXh0fVwiPjwvbmctY29udGFpbmVyPlxyXG4gICAgICAgIDxuZy1jb250YWluZXIgI2NlbGxFZGl0b3JUZW1wbGF0ZSAqbmdJZj1cImlzRWRpdGluZyAmJiBjb2x1bW4uZWRpdG9yVGVtcGxhdGVcIiBbbmdUZW1wbGF0ZU91dGxldF09XCJjb2x1bW4uZWRpdG9yVGVtcGxhdGVcIiBbbmdUZW1wbGF0ZU91dGxldENvbnRleHRdPVwieyRpbXBsaWNpdDogY2VsbENvbnRleHR9XCI+PC9uZy1jb250YWluZXI+XHJcbiAgICAgICAgPG5nLWNvbnRhaW5lciAjZWRpdG9yVGVtcGxhdGUgKm5nSWY9XCJpc0VkaXRpbmcgJiYgIWNvbHVtbi5lZGl0b3JUZW1wbGF0ZVwiIGNlbGwtZWRpdG9yIFtoZWlnaHRdPVwiY29udHJvbEhlaWdodFwiIFtyb3dEYXRhXT1cInJvd0RhdGFcIiBbdmFsdWVdPVwidmFsdWVcIiBbY29sdW1uXT1cImNvbHVtblwiIFtncm91cF09XCJkci5mb3JtXCI+PC9uZy1jb250YWluZXI+XHJcbiAgICA8L2Rpdj5cclxuICAgIGAsXHJcbiAgICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5LkRlZmF1bHRcclxufSlcclxuZXhwb3J0IGNsYXNzIERhdGFncmlkQ2VsbENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95LCBBZnRlclZpZXdJbml0LCBPbkNoYW5nZXMge1xyXG4gICAgQElucHV0KCkgd2lkdGg6IG51bWJlcjtcclxuICAgIEBJbnB1dCgpIGhlaWdodDogbnVtYmVyO1xyXG4gICAgQElucHV0KCkgY2xzID0gJyc7XHJcbiAgICBASW5wdXQoKSBjb2x1bW46IERhdGFDb2x1bW47XHJcbiAgICBASW5wdXQoKSByb3dEYXRhOiBhbnk7XHJcbiAgICBASW5wdXQoKSByb3dJbmRleDogbnVtYmVyO1xyXG4gICAgQElucHV0KCkgbGFzdENvbHVtbiA9IGZhbHNlO1xyXG4gICAgLy8gQFZpZXdDaGlsZCgnY2VsbHRpcCcpIGNlbGx0aXA6IERhdGFncmlkQ2VsbFRvb2x0aXBEaXJlY3RpdmU7XHJcblxyXG4gICAgcHJpdmF0ZSBfaXNFZGl0aW5nID0gZmFsc2U7XHJcbiAgICBjb250cm9sSGVpZ2h0ID0gJ2F1dG8nO1xyXG4gICAgZ2V0IGlzRWRpdGluZygpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5faXNFZGl0aW5nO1xyXG4gICAgfVxyXG4gICAgQElucHV0KCkgc2V0IGlzRWRpdGluZyh2KSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX2lzRWRpdGluZyA9PT0gdikge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuX2lzRWRpdGluZyA9IHY7XHJcblxyXG4gICAgICAgIGlmICh2KSB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5kci5mb3JtIHx8ICFPYmplY3Qua2V5cyh0aGlzLmRyLmZvcm0uY29udHJvbHMpLmxlbmd0aCApIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZHIuaW5pdEZvcm1Db250cm9sKCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbHVtbi5lZGl0b3JUZW1wbGF0ZSAmJiB0aGlzLmNvbHVtbi5lZGl0b3JUZW1wbGF0ZS5lbGVtZW50UmVmKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNlbGxDb250ZXh0LmZvcm1Hcm91cCA9IHRoaXMuZHIuZm9ybTtcclxuXHJcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZWwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5wdXQgPSB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcignaW5wdXQsdGV4dGFyZWEnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlucHV0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnB1dC5mb2N1cygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSwgMTApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmNvbHVtbi5lZGl0b3IgJiYgdGhpcy5jb2x1bW4uZWRpdG9yLnR5cGUgPT09ICd0ZXh0YXJlYScpIHtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLmRnLm5vd3JhcCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jb250cm9sSGVpZ2h0ID0gdGhpcy5kci5lbC5uYXRpdmVFbGVtZW50Lm9mZnNldEhlaWdodDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIXRoaXMuY2RbJ2Rlc3Ryb3llZCddKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBASW5wdXQoKSBpc1NlbGVjdGVkID0gZmFsc2U7XHJcblxyXG4gICAgQFZpZXdDaGlsZCgnY2VsbENvbnRhaW5lcicpIGNlbGxDb250YWluZXI6IEVsZW1lbnRSZWY7XHJcbiAgICBAVmlld0NoaWxkKCdjZWxsVGVtcGxhdGUnLCB7cmVhZDogVmlld0NvbnRhaW5lclJlZiB9KSBjZWxsVGVtcGxhdGVWY3I6IFZpZXdDb250YWluZXJSZWY7XHJcblxyXG5cclxuICAgIHByaXZhdGUgX2NlbGxFZGl0b3JUZW1wbGF0ZSA9IG51bGw7XHJcbiAgICBAVmlld0NoaWxkKCdjZWxsRWRpdG9yVGVtcGxhdGUnLCB7cmVhZDogVmlld0NvbnRhaW5lclJlZiB9KVxyXG4gICAgZ2V0IGNlbGxFZGl0b3JUZW1wbGF0ZSgpOiBWaWV3Q29udGFpbmVyUmVmIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fY2VsbEVkaXRvclRlbXBsYXRlO1xyXG4gICAgfVxyXG4gICAgc2V0IGNlbGxFZGl0b3JUZW1wbGF0ZSh2KSB7XHJcbiAgICAgICAgdGhpcy5fY2VsbEVkaXRvclRlbXBsYXRlID0gdjtcclxuICAgICAgICBpZiAodikge1xyXG4gICAgICAgICAgICB0aGlzLmRnLmRncy5jZWxsRWRpdG9yQ3JlYXRlZC5lbWl0KHsgZWRpdG9yUmVmOiBudWxsLCBjb2x1bW46IHRoaXMuY29sdW1uLCBjZWxsRWRpdG9yUmVmOiBudWxsLCB0ZW1wbGF0ZVJlZjogdn0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBAVmlld0NoaWxkKEdyaWRDZWxsRWRpdG9yRGlyZWN0aXZlKSBjZWxsRWRpdG9yO1xyXG5cclxuXHJcbiAgICBAT3V0cHV0KCkgY2VsbENsaWNrID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gICAgQE91dHB1dCgpIGNlbGxEYmxDbGljayA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuXHJcbiAgICBjZWxsQ29udGV4dDogYW55ID0ge307XHJcbiAgICBnZXQgdmFsdWUoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMucm93RGF0YSAmJiB0aGlzLmNvbHVtbiAmJiB0aGlzLmNvbHVtbi5maWVsZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gVXRpbHMuZ2V0VmFsdWUodGhpcy5jb2x1bW4uZmllbGQsIHRoaXMucm93RGF0YSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiAnJztcclxuICAgIH1cclxuXHJcbiAgICBnZXQgZm9ybUNvbnRyb2woKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuY2VsbEVkaXRvcikge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jZWxsRWRpdG9yLmNvbXBvbmVudFJlZi5pbnN0YW5jZS5mb3JtQ29udHJvbDtcclxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuY29sdW1uLmVkaXRvclRlbXBsYXRlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmRyLmZvcm0uZ2V0KHRoaXMuY29sdW1uLmZpZWxkKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gZ2V0IHZlcnRpY2FsQWxpZ24oKSB7XHJcbiAgICAvLyAgICAgbGV0IHZhID0gJ2NlbnRlcic7XHJcbiAgICAvLyAgICAgc3dpdGNoICh0aGlzLmNvbHVtbi52YWxpZ24pIHtcclxuICAgIC8vICAgICAgICAgY2FzZSAndG9wJzpcclxuICAgIC8vICAgICAgICAgICAgIHZhID0gJ2ZsZXgtc3RhcnQnO1xyXG4gICAgLy8gICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAvLyAgICAgICAgIGNhc2UgJ2JvdHRvbSc6XHJcbiAgICAvLyAgICAgICAgICAgICB2YSA9ICdmbGV4LWVuZCc7XHJcbiAgICAvLyAgICAgICAgICAgICBicmVhaztcclxuICAgIC8vICAgICAgICAgZGVmYXVsdDpcclxuICAgIC8vICAgICAgICAgICAgIHZhID0gJ2NlbnRlcic7XHJcbiAgICAvLyAgICAgICAgICAgICBicmVhaztcclxuICAgIC8vICAgICB9XHJcblxyXG4gICAgLy8gICAgIHJldHVybiB2YTtcclxuICAgIC8vIH1cclxuXHJcbiAgICAvLyBnZXQgaG9yaXpvbnRhbEFsaWduKCkge1xyXG4gICAgLy8gICAgIGxldCBoYSA9ICdmbGV4LXN0YXJ0JztcclxuICAgIC8vICAgICBpZiAodGhpcy5jb2x1bW4uYWxpZ24gPT09ICdyaWdodCcpIHtcclxuICAgIC8vICAgICAgICAgaGEgPSAnZmxleC1lbmQnO1xyXG4gICAgLy8gICAgIH0gZWxzZSBpZiAodGhpcy5jb2x1bW4uYWxpZ24gPT09ICdjZW50ZXInKSB7XHJcbiAgICAvLyAgICAgICAgIGhhID0gJ2NlbnRlcic7XHJcbiAgICAvLyAgICAgfVxyXG4gICAgLy8gICAgIHJldHVybiBoYTtcclxuICAgIC8vIH1cclxuXHJcbiAgICAvLyBnZXQgY2VsbFN0eWxlKCkge1xyXG4gICAgLy8gICAgIC8vIGNvbnN0IHcgPSB0aGlzLmxhc3RDb2x1bW4gPyAodGhpcy5jb2x1bW4ud2lkdGggLSA2KSArICdweCcgOiAnMTAwJSc7XHJcbiAgICAvLyAgICAgLy8gY29uc3Qgc3R5bGUgPSB7XHJcbiAgICAvLyAgICAgLy8gICAgIHdpZHRoOiB3XHJcbiAgICAvLyAgICAgLy8gfTtcclxuICAgIC8vICAgICBpZiAoIXRoaXMuaXNFZGl0aW5nKSB7XHJcbiAgICAvLyAgICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKHt9LCB7XHJcbiAgICAvLyAgICAgICAgICAgICAnYWxpZ24taXRlbXMnOiB0aGlzLnZlcnRpY2FsQWxpZ24sXHJcbiAgICAvLyAgICAgICAgICAgICAnanVzdGlmeS1jb250ZW50JzogdGhpcy5ob3Jpem9udGFsQWxpZ25cclxuICAgIC8vICAgICAgICAgfSk7XHJcbiAgICAvLyAgICAgfSBlbHNlIHtcclxuICAgIC8vICAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oe30sIHtcclxuICAgIC8vICAgICAgICAgICAgICdqdXN0aWZ5LWNvbnRlbnQnOiB0aGlzLmhvcml6b250YWxBbGlnblxyXG4gICAgLy8gICAgICAgICB9KTtcclxuICAgIC8vICAgICB9XHJcbiAgICAvLyB9XHJcblxyXG4gICAgZ2V0IGNlbGxGb3JtYXR0ZXJJc0ZuKCkge1xyXG4gICAgICAgIHJldHVybiB0eXBlb2YgdGhpcy5jb2x1bW4uZm9ybWF0dGVyID09PSAnZnVuY3Rpb24nIHx8IHRoaXMuY29sdW1uLmZvcm1hdHRlci50eXBlID09PSAnYm9vbGVhbic7XHJcbiAgICB9XHJcblxyXG4gICAgY2VsbFN0eWxlcjogYW55ID0ge307XHJcblxyXG4gICAgcHJpdmF0ZSBkZnM6IERhdGFncmlkRmFjYWRlU2VydmljZTtcclxuICAgIHByaXZhdGUgZGdzOiBEYXRhZ3JpZFNlcnZpY2U7XHJcbiAgICBwcml2YXRlIGNlbGxTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcclxuICAgIHByaXZhdGUgcm93VXBkYXRlU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XHJcbiAgICBwcml2YXRlIHNhZmVQaXBlOiBTYWZlUGlwZSA9IG51bGw7XHJcbiAgICBwcml2YXRlIHJlbmRlcjogUmVuZGVyZXIyO1xyXG4gICAgcHJpdmF0ZSBybzogUmVzaXplT2JzZXJ2ZXIgPSBudWxsO1xyXG4gICAgY2FuRWRpdCA9ICgpID0+IHRoaXMuZGcuZWRpdGFibGUgJiYgdGhpcy5kZy5lZGl0TW9kZSA9PT0gJ2NlbGwnICYmIHRoaXMuY29sdW1uLmVkaXRvcjtcclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIEBJbmplY3QoZm9yd2FyZFJlZigoKSA9PiBEYXRhZ3JpZENvbXBvbmVudCkpIHB1YmxpYyBkZzogRGF0YWdyaWRDb21wb25lbnQsXHJcbiAgICAgICAgQEluamVjdChmb3J3YXJkUmVmKCgpID0+IERhdGFncmlkUm93RGlyZWN0aXZlKSkgcHVibGljIGRyOiBEYXRhZ3JpZFJvd0RpcmVjdGl2ZSxcclxuICAgICAgICBwdWJsaWMgZWw6IEVsZW1lbnRSZWYsIHB1YmxpYyBjZDogQ2hhbmdlRGV0ZWN0b3JSZWYsIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yLFxyXG4gICAgICAgIHB1YmxpYyBjb2xGb3JtYXRTZXI6IENvbHVtbkZvcm1hdFNlcnZpY2UsXHJcbiAgICAgICAgcHJpdmF0ZSBkb21TYW5pdGl6ZXI6IERvbVNhbml0aXplclxyXG4gICAgKSB7XHJcbiAgICAgICAgdGhpcy5kZnMgPSB0aGlzLmluamVjdG9yLmdldChEYXRhZ3JpZEZhY2FkZVNlcnZpY2UpO1xyXG4gICAgICAgIHRoaXMuZGdzID0gdGhpcy5pbmplY3Rvci5nZXQoRGF0YWdyaWRTZXJ2aWNlKTtcclxuICAgICAgICB0aGlzLnNhZmVQaXBlID0gbmV3IFNhZmVQaXBlKHRoaXMuZG9tU2FuaXRpemVyKTtcclxuICAgICAgICB0aGlzLnJlbmRlciA9IHRoaXMuaW5qZWN0b3IuZ2V0KFJlbmRlcmVyMik7XHJcbiAgICAgICAgLy8gdGhpcy5jZWxsU3Vic2NyaXB0aW9uID0gdGhpcy5kZnMuY3VycmVudENlbGwkLnBpcGUoXHJcbiAgICAgICAgLy8gICAgIGZpbHRlcigoY2VsbDogQ2VsbEluZm8pID0+IHtcclxuICAgICAgICAvLyAgICAgICAgIHJldHVybiBjZWxsICYmIHRoaXMuY29sdW1uLmVkaXRvciAmJiBjZWxsLnJvd0luZGV4ID09PSB0aGlzLnJvd0luZGV4ICYmIGNlbGwuZmllbGQgPT09IHRoaXMuY29sdW1uLmZpZWxkO1xyXG4gICAgICAgIC8vICAgICB9KVxyXG4gICAgICAgIC8vICkuc3Vic2NyaWJlKChjZWxsOiBDZWxsSW5mbykgPT4ge1xyXG4gICAgICAgIC8vICAgICBpZiAoY2VsbCAmJiB0aGlzLmNvbHVtbi5lZGl0b3IpIHtcclxuICAgICAgICAvLyAgICAgICAgIHRoaXMuaXNFZGl0aW5nID0gY2VsbC5pc0VkaXRpbmc7XHJcbiAgICAgICAgLy8gICAgICAgICBjZWxsLmNlbGxSZWYgPSB0aGlzO1xyXG4gICAgICAgIC8vICAgICAgICAgY2VsbC5jb2x1bW4gPSB0aGlzLmNvbHVtbjtcclxuXHJcbiAgICAgICAgLy8gICAgICAgICBpZiAoIXRoaXMuY2RbJ2Rlc3Ryb3llZCddKSB7XHJcbiAgICAgICAgLy8gICAgICAgICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgLy8gICAgICAgICB9XHJcbiAgICAgICAgLy8gICAgIH1cclxuICAgICAgICAvLyB9KTtcclxuICAgIH1cclxuXHJcbiAgICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmluaXRDZWxsVGVtcGxhdGVDb250ZXh0KCk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcclxuICAgICAgICBpZiAoY2hhbmdlcy5yb3dEYXRhICYmICFjaGFuZ2VzLnJvd0RhdGEuaXNGaXJzdENoYW5nZSgpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5pdENlbGxUZW1wbGF0ZUNvbnRleHQoKTtcclxuICAgICAgICAgICAgdGhpcy5idWlsZEN1c3RvbUNlbGxTdHlsZSgpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuZm9ybUNvbnRyb2wpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHZhbCA9IFV0aWxzLmdldFZhbHVlKHRoaXMuY29sdW1uLmZpZWxkLCB0aGlzLnJvd0RhdGEpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5mb3JtQ29udHJvbC5zZXRWYWx1ZSh2YWwpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgaW5pdENlbGxUZW1wbGF0ZUNvbnRleHQoKSB7XHJcbiAgICAgICAgdGhpcy5jZWxsQ29udGV4dCA9IHtcclxuICAgICAgICAgICAgZmllbGQ6IHRoaXMuY29sdW1uLmZpZWxkLFxyXG4gICAgICAgICAgICByb3dJbmRleDogdGhpcy5yb3dJbmRleCxcclxuICAgICAgICAgICAgcm93RGF0YTogdGhpcy5yb3dEYXRhLFxyXG4gICAgICAgICAgICBjb2x1bW46IHRoaXMuY29sdW1uLFxyXG4gICAgICAgICAgICBpbnN0YW5jZTogdGhpcyxcclxuICAgICAgICAgICAgZm9ybUdyb3VwOiB0aGlzLmRyLmZvcm0sXHJcbiAgICAgICAgICAgIHRvb2xzOiB7XHJcbiAgICAgICAgICAgICAgICB1dGlsczogdGhpcy5kZy5jb21tb25VdGlscyxcclxuICAgICAgICAgICAgICAgIGZvcm1hdDogdGhpcy5kZy5jb2xGb3JtYXRTZXIsXHJcbiAgICAgICAgICAgICAgICBudW1iZXI6IHRoaXMuZGcuY29sRm9ybWF0U2VyWydudW1iZXJoZWxwZXInXSxcclxuICAgICAgICAgICAgICAgIGRhdGU6IHRoaXMuZGcuY29sRm9ybWF0U2VyWydkYXRlaGVscGVyJ11cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmJ1aWxkQ3VzdG9tQ2VsbFN0eWxlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkRlc3Ryb3koKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuY2VsbFN1YnNjcmlwdGlvbikge1xyXG4gICAgICAgICAgICB0aGlzLmNlbGxTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgdGhpcy5jZWxsU3Vic2NyaXB0aW9uID0gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLnJvd1VwZGF0ZVN1YnNjcmlwdGlvbikge1xyXG4gICAgICAgICAgICB0aGlzLnJvd1VwZGF0ZVN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICB0aGlzLnJvd1VwZGF0ZVN1YnNjcmlwdGlvbiA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgdGhpcy5jZWxsQ29udGV4dCA9IG51bGw7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHByaXZhdGUgYnVpbGRDdXN0b21DZWxsU3R5bGUocm93RGF0YSA9IG51bGwpIHtcclxuICAgICAgICBjb25zdCB0ZCA9IHRoaXMuZWwubmF0aXZlRWxlbWVudC5wYXJlbnROb2RlO1xyXG4gICAgICAgIGlmICghdGQuaWQpIHtcclxuICAgICAgICAgICAgdGQuaWQgPSBUUl9QUkVGSVggKyB0aGlzLmRyLnJvd0lkICsgJ18nICsgdGhpcy5yb3dJbmRleCArICctJyArIHRoaXMuY29sdW1uLmZpZWxkO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0ZC5pZCA9IHRkLmlkLnJlcGxhY2UoL1xcLi9nLCAnXycpO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5jb2x1bW4uc3R5bGVyKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IF9yZCA9IHJvd0RhdGEgfHwgdGhpcy5yb3dEYXRhO1xyXG4gICAgICAgICAgICBjb25zdCBjcyA9IHRoaXMuY29sdW1uLnN0eWxlcihfcmRbdGhpcy5jb2x1bW4uZmllbGRdLCBfcmQsIHRoaXMucm93SW5kZXgpO1xyXG4gICAgICAgICAgICBpZiAoY3MgJiYgT2JqZWN0LmtleXMoY3MpLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kZy5yZW5kZXJDdXN0b21TdHlsZShjcywgdGQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5kZy5kZ3MucmVtb3ZlQ3NzUnVsZSgnIycgKyB0ZC5pZCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZVZhbHVlKHZhbD86IGFueSkge1xyXG4gICAgICAgIGlmICh0aGlzLmRyLmZvcm0pIHtcclxuICAgICAgICAgICAgLy8gdGhpcy5yb3dEYXRhID0gT2JqZWN0LmFzc2lnbih0aGlzLnJvd0RhdGEsIHRoaXMuZHIuZm9ybS52YWx1ZSk7XHJcbiAgICAgICAgICAgIFV0aWxzLnNldFZhbHVlKHRoaXMuY29sdW1uLmZpZWxkLCB2YWwsIHRoaXMucm93RGF0YSk7XHJcbiAgICAgICAgICAgIC8vIHRoaXMucm93RGF0YSA9IHsuLi50aGlzLnJvd0RhdGF9O1xyXG4gICAgICAgICAgICBjb25zdCByb3dpZCA9IHRoaXMucm93RGF0YVt0aGlzLmRnLmlkRmllbGRdO1xyXG4gICAgICAgICAgICBjb25zdCBpdGVtID0gdGhpcy5kZy5kYXRhLmZpbmQobiA9PiBuW3RoaXMuZGcuaWRGaWVsZF0gPT09IHJvd2lkKTtcclxuICAgICAgICAgICAgaWYgKGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgIFV0aWxzLnNldFZhbHVlKHRoaXMuY29sdW1uLmZpZWxkLCB2YWwsIGl0ZW0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLmRmcy51cGRhdGVDaGVja2VkRGF0YShyb3dpZCwgeyBbdGhpcy5jb2x1bW4uZmllbGRdOiB2YWwgfSk7XHJcblxyXG4gICAgICAgICAgICBpZiAoIXRoaXMuY2RbJ2Rlc3Ryb3llZCddKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iXX0=