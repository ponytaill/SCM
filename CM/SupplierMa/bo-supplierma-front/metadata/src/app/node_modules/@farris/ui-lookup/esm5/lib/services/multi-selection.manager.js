/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { FavoriteIcon, FAVORITE_FIELD_NAME } from '../lookup-displaytype';
import { cloneDeep } from 'lodash-es';
var MultiSelectionManager = /** @class */ (function () {
    function MultiSelectionManager(ins) {
        this.ins = ins;
    }
    /**
     * @param {?} e
     * @return {?}
     */
    MultiSelectionManager.prototype.onSelectedTableCellClick = /**
     * @param {?} e
     * @return {?}
     */
    function (e) {
        if (e.col.field === FAVORITE_FIELD_NAME) {
            e.event.stopPropagation();
            /** @type {?} */
            var classList = e.event.target['classList'];
            if (classList.contains('f-lookup-unfavorite')) {
                /** @type {?} */
                var rid = e.row[this.ins.idField];
                this.ins.lookupSelectionSer.unSelect(rid);
                // 取消选中 主列表 收藏列表 中的数据
                if (this.ins.isTree()) {
                    /** @type {?} */
                    var tt = (/** @type {?} */ (this.ins.lookupCmpMgr.getComponentInstance('treetable')));
                    tt.unCheckedNode(rid);
                    tt.unSelectNode(rid);
                    if (this.ins.useFavorite) {
                        /** @type {?} */
                        var _tt = (/** @type {?} */ (this.ins.lookupCmpMgr.getComponentInstance('fav')));
                        if (_tt.data && _tt.data.length && _tt.findRowNode(rid)) {
                            _tt.unCheckedNode(rid);
                            _tt.unSelectNode(rid);
                        }
                    }
                }
                else {
                    /** @type {?} */
                    var dt = (/** @type {?} */ (this.ins.lookupCmpMgr.getComponentInstance()));
                    dt.unCheckRow(rid);
                    if (this.ins.useFavorite) {
                        /** @type {?} */
                        var _dt = (/** @type {?} */ (this.ins.lookupCmpMgr.getComponentInstance('fav')));
                        if (_dt.data && _dt.data.length) {
                            _dt.unCheckRow(rid);
                        }
                    }
                }
            }
        }
    };
    // 初始化已选数据列信息
    // 初始化已选数据列信息
    /**
     * @return {?}
     */
    MultiSelectionManager.prototype.initSelectedColumns = 
    // 初始化已选数据列信息
    /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var selectedColumns = [];
        if (this.ins.showSelected && !this.ins.singleSelect) {
            selectedColumns = cloneDeep(this.ins.gridOptions.columns);
            /** @type {?} */
            var favcol = selectedColumns.find((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n.field === FAVORITE_FIELD_NAME; }));
            if (favcol) {
                favcol.formatter = (/**
                 * @return {?}
                 */
                function () {
                    return FavoriteIcon.remove;
                });
            }
            else {
                selectedColumns = selectedColumns.concat([
                    { field: FAVORITE_FIELD_NAME, width: 80, formatter: (/**
                         * @return {?}
                         */
                        function () {
                            return FavoriteIcon.remove;
                        })
                    }
                ]);
            }
        }
        return selectedColumns;
    };
    /**
     * @param {?} data
     * @return {?}
     */
    MultiSelectionManager.prototype.updateSelections = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        if (Array.isArray(data)) {
            this.ins.lookupSelectionSer.updateSelections(data, true);
        }
        else {
            this.ins.lookupSelectionSer.select(data);
        }
    };
    /**
     * @param {?} id
     * @return {?}
     */
    MultiSelectionManager.prototype.remove = /**
     * @param {?} id
     * @return {?}
     */
    function (id) {
        if (id) {
            this.ins.lookupSelectionSer.unSelect(id);
        }
    };
    /**
     * @return {?}
     */
    MultiSelectionManager.prototype.clear = /**
     * @return {?}
     */
    function () {
        this.ins.lookupSelectionSer.clearSelections();
    };
    /**
     * @param {?} rows
     * @return {?}
     */
    MultiSelectionManager.prototype.save = /**
     * @param {?} rows
     * @return {?}
     */
    function (rows) {
        if (this.ins.showSelected) {
            this.ins.personalConf.selections = rows;
            this.ins.personalConfigService.savePersonalConfig(this.ins.personalConf);
        }
    };
    /**
     * @return {?}
     */
    MultiSelectionManager.prototype.loadData = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var items = this.ins.personalConf ? (this.ins.personalConf.selections || []) : [];
        if (!items.length) {
            items = this.ins.lookupSelectionSer.getSelections();
        }
        this.ins.lookupSelectionSer.loadSelections(items);
    };
    return MultiSelectionManager;
}());
export { MultiSelectionManager };
if (false) {
    /**
     * @type {?}
     * @private
     */
    MultiSelectionManager.prototype.ins;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibXVsdGktc2VsZWN0aW9uLm1hbmFnZXIuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWxvb2t1cC8iLCJzb3VyY2VzIjpbImxpYi9zZXJ2aWNlcy9tdWx0aS1zZWxlY3Rpb24ubWFuYWdlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQ0EsT0FBTyxFQUFFLFlBQVksRUFBRSxtQkFBbUIsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBRTFFLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFHdEM7SUFDSSwrQkFBb0IsR0FBd0I7UUFBeEIsUUFBRyxHQUFILEdBQUcsQ0FBcUI7SUFBRyxDQUFDOzs7OztJQUVoRCx3REFBd0I7Ozs7SUFBeEIsVUFBeUIsQ0FBTTtRQUMzQixJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsS0FBSyxLQUFLLG1CQUFtQixFQUFFO1lBQ3JDLENBQUMsQ0FBQyxLQUFLLENBQUMsZUFBZSxFQUFFLENBQUM7O2dCQUNwQixTQUFTLEdBQUcsQ0FBQyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDO1lBQzdDLElBQUksU0FBUyxDQUFDLFFBQVEsQ0FBQyxxQkFBcUIsQ0FBQyxFQUFFOztvQkFDckMsR0FBRyxHQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUM7Z0JBQ3BDLElBQUksQ0FBQyxHQUFHLENBQUMsa0JBQWtCLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUMxQyxxQkFBcUI7Z0JBQ3JCLElBQUksSUFBSSxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsRUFBRTs7d0JBQ2IsRUFBRSxHQUFHLG1CQUFBLElBQUksQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDLG9CQUFvQixDQUFDLFdBQVcsQ0FBQyxFQUFzQjtvQkFDeEYsRUFBRSxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsQ0FBQztvQkFDdEIsRUFBRSxDQUFDLFlBQVks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QUMsZUFBZSxFQUFFLENBQUM7SUFDbEQsQ0FBQzs7Ozs7SUFFRCxvQ0FBSTs7OztJQUFKLFVBQUssSUFBUztRQUNWLElBQUksSUFBSSxDQUFDLEdBQUcsQ0FBQyxZQUFZLEVBQUU7WUFDdkIsSUFBSSxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQztZQUN4QyxJQUFJLENBQUMsR0FBRyxDQUFDLHFCQUFxQixDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDLENBQUM7U0FDNUU7SUFDTCxDQUFDOzs7O0lBRUQsd0NBQVE7OztJQUFSOztZQUNRLEtBQUssR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxVQUFVLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUU7UUFDakYsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLEVBQUU7WUFDZixLQUFLLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxrQkFBa0IsQ0FBQyxhQUFhLEVBQUUsQ0FBQztTQUN2RDtRQUNELElBQUksQ0FBQyxHQUFHLENBQUMsa0JBQWtCLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3RELENBQUM7SUFDTCw0QkFBQztBQUFELENBQUMsQUFoR0QsSUFnR0M7Ozs7Ozs7SUEvRmUsb0NBQWdDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVHJlZVRhYmxlQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS10cmVldGFibGUnO1xyXG5pbXBvcnQgeyBGYXZvcml0ZUljb24sIEZBVk9SSVRFX0ZJRUxEX05BTUUgfSBmcm9tICcuLi9sb29rdXAtZGlzcGxheXR5cGUnO1xyXG5pbXBvcnQgeyBMb29rdXBHcmlkQ29tcG9uZW50IH0gZnJvbSAnLi4vbG9va3VwLWdyaWQuY29tcG9uZW50JztcclxuaW1wb3J0IHsgY2xvbmVEZWVwIH0gZnJvbSAnbG9kYXNoLWVzJztcclxuaW1wb3J0IHsgRGF0YVRhYmxlQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1kYXRhdGFibGUnO1xyXG5cclxuZXhwb3J0IGNsYXNzIE11bHRpU2VsZWN0aW9uTWFuYWdlciB7XHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGluczogTG9va3VwR3JpZENvbXBvbmVudCkge31cclxuXHJcbiAgICBvblNlbGVjdGVkVGFibGVDZWxsQ2xpY2soZTogYW55KSB7XHJcbiAgICAgICAgaWYgKGUuY29sLmZpZWxkID09PSBGQVZPUklURV9GSUVMRF9OQU1FKSB7XHJcbiAgICAgICAgICAgIGUuZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGNsYXNzTGlzdCA9IGUuZXZlbnQudGFyZ2V0WydjbGFzc0xpc3QnXTtcclxuICAgICAgICAgICAgaWYgKGNsYXNzTGlzdC5jb250YWlucygnZi1sb29rdXAtdW5mYXZvcml0ZScpKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCByaWQgPSAgZS5yb3dbdGhpcy5pbnMuaWRGaWVsZF07XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlucy5sb29rdXBTZWxlY3Rpb25TZXIudW5TZWxlY3QocmlkKTtcclxuICAgICAgICAgICAgICAgIC8vIOWPlua2iOmAieS4rSDkuLvliJfooagg5pS26JeP5YiX6KGoIOS4reeahOaVsOaNrlxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaW5zLmlzVHJlZSgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdHQgPSB0aGlzLmlucy5sb29rdXBDbXBNZ3IuZ2V0Q29tcG9uZW50SW5zdGFuY2UoJ3RyZWV0YWJsZScpIGFzIFRyZWVUYWJsZUNvbXBvbmVudDtcclxuICAgICAgICAgICAgICAgICAgICB0dC51bkNoZWNrZWROb2RlKHJpZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdHQudW5TZWxlY3ROb2RlKHJpZCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmlucy51c2VGYXZvcml0ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBfdHQgPSB0aGlzLmlucy5sb29rdXBDbXBNZ3IuZ2V0Q29tcG9uZW50SW5zdGFuY2UoJ2ZhdicpIGFzIFRyZWVUYWJsZUNvbXBvbmVudDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF90dC5kYXRhICYmIF90dC5kYXRhLmxlbmd0aCAmJiBfdHQuZmluZFJvd05vZGUocmlkKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3R0LnVuQ2hlY2tlZE5vZGUocmlkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90dC51blNlbGVjdE5vZGUocmlkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGR0ID0gdGhpcy5pbnMubG9va3VwQ21wTWdyLmdldENvbXBvbmVudEluc3RhbmNlKCkgYXMgRGF0YVRhYmxlQ29tcG9uZW50O1xyXG4gICAgICAgICAgICAgICAgICAgIGR0LnVuQ2hlY2tSb3cocmlkKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pbnMudXNlRmF2b3JpdGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgX2R0ID0gdGhpcy5pbnMubG9va3VwQ21wTWdyLmdldENvbXBvbmVudEluc3RhbmNlKCdmYXYnKSBhcyBEYXRhVGFibGVDb21wb25lbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfZHQuZGF0YSAmJiBfZHQuZGF0YS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9kdC51bkNoZWNrUm93KHJpZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyDliJ3lp4vljJblt7LpgInmlbDmja7liJfkv6Hmga9cclxuICAgIGluaXRTZWxlY3RlZENvbHVtbnMoKSB7XHJcbiAgICAgICAgbGV0IHNlbGVjdGVkQ29sdW1ucyA9IFtdO1xyXG4gICAgICAgIGlmICh0aGlzLmlucy5zaG93U2VsZWN0ZWQgJiYgIXRoaXMuaW5zLnNpbmdsZVNlbGVjdCkge1xyXG4gICAgICAgICAgICBzZWxlY3RlZENvbHVtbnMgPSBjbG9uZURlZXAodGhpcy5pbnMuZ3JpZE9wdGlvbnMuY29sdW1ucyk7XHJcbiAgICAgICAgICAgIGNvbnN0IGZhdmNvbCA9IHNlbGVjdGVkQ29sdW1ucy5maW5kKG4gPT4gbi5maWVsZCA9PT0gRkFWT1JJVEVfRklFTERfTkFNRSk7XHJcbiAgICAgICAgICAgIGlmIChmYXZjb2wpIHtcclxuICAgICAgICAgICAgICAgIGZhdmNvbC5mb3JtYXR0ZXIgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhdm9yaXRlSWNvbi5yZW1vdmU7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRDb2x1bW5zID0gc2VsZWN0ZWRDb2x1bW5zLmNvbmNhdChbXHJcbiAgICAgICAgICAgICAgICAgICAgeyBmaWVsZDogRkFWT1JJVEVfRklFTERfTkFNRSwgd2lkdGg6IDgwLCBmb3JtYXR0ZXI6ICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBGYXZvcml0ZUljb24ucmVtb3ZlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBzZWxlY3RlZENvbHVtbnM7XHJcbiAgICB9XHJcblxyXG4gICAgdXBkYXRlU2VsZWN0aW9ucyhkYXRhKSB7XHJcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoZGF0YSkpIHtcclxuICAgICAgICAgICAgdGhpcy5pbnMubG9va3VwU2VsZWN0aW9uU2VyLnVwZGF0ZVNlbGVjdGlvbnMoZGF0YSwgdHJ1ZSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5pbnMubG9va3VwU2VsZWN0aW9uU2VyLnNlbGVjdChkYXRhKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmVtb3ZlKGlkOiBhbnkpIHtcclxuICAgICAgICBpZiAoaWQpIHtcclxuICAgICAgICAgICAgdGhpcy5pbnMubG9va3VwU2VsZWN0aW9uU2VyLnVuU2VsZWN0KGlkKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGNsZWFyKCkge1xyXG4gICAgICAgIHRoaXMuaW5zLmxvb2t1cFNlbGVjdGlvblNlci5jbGVhclNlbGVjdGlvbnMoKTtcclxuICAgIH1cclxuXHJcbiAgICBzYXZlKHJvd3M6IGFueSkge1xyXG4gICAgICAgIGlmICh0aGlzLmlucy5zaG93U2VsZWN0ZWQpIHtcclxuICAgICAgICAgICAgdGhpcy5pbnMucGVyc29uYWxDb25mLnNlbGVjdGlvbnMgPSByb3dzO1xyXG4gICAgICAgICAgICB0aGlzLmlucy5wZXJzb25hbENvbmZpZ1NlcnZpY2Uuc2F2ZVBlcnNvbmFsQ29uZmlnKHRoaXMuaW5zLnBlcnNvbmFsQ29uZik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGxvYWREYXRhKCkge1xyXG4gICAgICAgIGxldCBpdGVtcyA9IHRoaXMuaW5zLnBlcnNvbmFsQ29uZiA/ICh0aGlzLmlucy5wZXJzb25hbENvbmYuc2VsZWN0aW9ucyB8fCBbXSkgOiBbXTtcclxuICAgICAgICBpZiAoIWl0ZW1zLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBpdGVtcyA9IHRoaXMuaW5zLmxvb2t1cFNlbGVjdGlvblNlci5nZXRTZWxlY3Rpb25zKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaW5zLmxvb2t1cFNlbGVjdGlvblNlci5sb2FkU2VsZWN0aW9ucyhpdGVtcyk7XHJcbiAgICB9XHJcbn1cclxuIl19