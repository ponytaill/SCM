System.register(["rxjs","rxjs/operators","axios","reflect-metadata","date-fns","dayjs"],(function(t){"use strict";var e,n,i,r,o,a,s,u,p,c,h,f,l,y,d,g,v,m,P,b,C;return{setters:[function(t){e=t.of,n=t.from,i=t.Observable,r=t.EMPTY,o=t.Subject,a=t.BehaviorSubject},function(t){s=t.switchMap,u=t.map,p=t.concatMap,c=t.tap,h=t.every,f=t.take,l=t.throwIfEmpty,y=t.takeLast},function(t){d=t.default},function(){},function(t){g=t.format,v=t.parseISO,m=t.isDate,P=t.isEqual,b=t.compareAsc},function(t){C=t.default}],execute:function(){t({BindingPropertyType:void 0,BindingType:void 0,ChangeType:void 0,CommandHandlerExtenderMeta:function(t){return vt(ve,(function(t){return t}))(t)},CommandHandlerMeta:function(t){return vt(ge,(function(t){return t}))(t)},DataChangeType:void 0,DataPathNodeType:void 0,DataPropGroup:void 0,EntityFactory:ae,INJECTOR_IMPL__PRE_R3__:ht,InjectFlags:void 0,ModifyType:void 0,RepositoryMeta:function(t){return vt(ce,(function(t){return t}))(t)},ViewChangeType:void 0,createEntities:oe,createEntity:re,createInjectionToken:W,createInjector:lt,isType:function(t){return"function"==typeof t},makeDecorator:vt,makeParamDecorator:function(t,e,n){var i=mt(e);function r(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(this instanceof r)return i.apply(this,e),this;var o=new((t=r).bind.apply(t,S([void 0],e)));return a.annotation=o,a;function a(t,e,n){for(var i=t.hasOwnProperty(dt)?t[dt]:Object.defineProperty(t,dt,{value:[]})[dt];i.length<=n;)i.push(null);return(i[n]=i[n]||[]).push(o),t}}n&&(r.prototype=Object.create(n.prototype));return r.prototype.ngMetadataName=t,r.annotationCls=r,r},makePropDecorator:Pt,setCurrentInjector:rt,"ɵa":U});var E=function(t,e){return(E=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function M(t,e){function n(){this.constructor=t}E(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var I=function(){return(I=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function w(t,e){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function x(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function O(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,r,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(t){r={error:t}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a}function S(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(O(arguments[e]));return t}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function D(t){var e={exports:{}};return t(e,e.exports),e.exports}var j=D((function(t,e){t.exports=function(t,e,n){e.prototype.isBetween=function(t,e,i,r){var o=n(t),a=n(e),s="("===(r=r||"()")[0],u=")"===r[1];return(s?this.isAfter(o,i):!this.isBefore(o,i))&&(u?this.isBefore(a,i):!this.isAfter(a,i))||(s?this.isBefore(o,i):!this.isAfter(o,i))&&(u?this.isAfter(a,i):!this.isBefore(a,i))}}})),T=D((function(t,e){t.exports=function(t,e,n){t=t||{};var i=e.prototype,r={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function o(t,e,n,r){return i.fromToBase(t,e,n,r)}n.en.relativeTime=r,i.fromToBase=function(e,i,o,a,s){for(var u,p,c,h=o.$locale().relativeTime||r,f=t.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],l=f.length,y=0;y<l;y+=1){var d=f[y];d.d&&(u=a?n(e).diff(o,d.d,!0):o.diff(e,d.d,!0));var g=(t.rounding||Math.round)(Math.abs(u));if(c=u>0,g<=d.r||!d.r){g<=1&&y>0&&(d=f[y-1]);var v=h[d.l];s&&(g=s(""+g)),p="string"==typeof v?v.replace("%d",g):v(g,i,d.l,c);break}}if(i)return p;var m=c?h.future:h.past;return"function"==typeof m?m(p):m.replace("%s",p)},i.to=function(t,e){return o(t,e,this,!0)},i.from=function(t,e){return o(t,e,this)};var a=function(t){return t.$u?n.utc():n()};i.toNow=function(t){return this.to(a(this),t)},i.fromNow=function(t){return this.from(a(this),t)}}})),N=D((function(t,e){t.exports=function(t,e,n){var i="h:mm A",r={lastDay:"[Yesterday at] "+i,sameDay:"[Today at] "+i,nextDay:"[Tomorrow at] "+i,nextWeek:"dddd [at] "+i,lastWeek:"[Last] dddd [at] "+i,sameElse:"MM/DD/YYYY"};e.prototype.calendar=function(t,e){var i=e||this.$locale().calendar||r,o=n(t||void 0).startOf("d"),a=this.diff(o,"d",!0),s=a<-6?"sameElse":a<-1?"lastWeek":a<0?"lastDay":a<1?"sameDay":a<2?"nextDay":a<7?"nextWeek":"sameElse",u=i[s]||r[s];return"function"==typeof u?u.call(this,n()):this.format(u)}}}));D((function(t,e){t.exports=function(t){t=t&&t.hasOwnProperty("default")?t.default:t;var e={name:"zh-cn",weekdays:"星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"),weekdaysShort:"周日_周一_周二_周三_周四_周五_周六".split("_"),weekdaysMin:"日_一_二_三_四_五_六".split("_"),months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),ordinal:function(t,e){switch(e){case"W":return t+"周";default:return t+"日"}},weekStart:1,yearStart:4,formats:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYY年M月D日",LLL:"YYYY年M月D日Ah点mm分",LLLL:"YYYY年M月D日ddddAh点mm分",l:"YYYY/M/D",ll:"YYYY年M月D日",lll:"YYYY年M月D日 HH:mm",llll:"YYYY年M月D日dddd HH:mm"},relativeTime:{future:"%s内",past:"%s前",s:"几秒",m:"1 分钟",mm:"%d 分钟",h:"1 小时",hh:"%d 小时",d:"1 天",dd:"%d 天",M:"1 个月",MM:"%d 个月",y:"1 年",yy:"%d 年"},meridiem:function(t,e){var n=100*t+e;return n<600?"凌晨":n<900?"早上":n<1100?"上午":n<1300?"中午":n<1800?"下午":"晚上"}};return t.locale(e,null,!0),e}(C)}));var A,B;t("Type",Function);!function(t){t[t.Add=0]="Add",t[t.Delete=1]="Delete"}(A||(A=t("DataChangeType",{}))),function(t){t[t.Default=0]="Default",t[t.Self=1]="Self",t[t.SkipSelf=2]="SkipSelf",t[t.Optional=4]="Optional"}(B||(B=t("InjectFlags",{})));var V=[],_=function(t){return t},L=_,F=function(){return Array.prototype.slice.call(arguments)},k=/\n/gm,R={};function K(t){if("string"==typeof t)return t;if(Array.isArray(t))return"["+t.map(K).join(", ")+"]";if(null==t)return""+t;if(t.overriddenName)return""+t.overriddenName;if(t.name)return""+t.name;var e=t.toString();if(null==e)return""+e;var n=e.indexOf("\n");return-1===n?e:e.substring(0,n)}function U(t){for(var e in t)if(t[e]===U)return e;throw Error("Could not find renamed property on target object.")}function H(t,e){return new Error(function(t,e,n,i){void 0===i&&(i=null),t=t&&"\n"===t.charAt(0)&&"ɵ"==t.charAt(1)?t.substr(2):t;var r=K(e);if(Array.isArray(e))r=e.map(K).join(" -> ");else if("object"==typeof e){var o=[];for(var a in e)if(e.hasOwnProperty(a)){var s=e[a];o.push(a+":"+("string"==typeof s?JSON.stringify(s):K(s)))}r="{"+o.join(", ")+"}"}return n+(i?"("+i+")":"")+"["+r+"]: "+t.replace(k,"\n  ")}(t,e,"StaticInjectorError"))}var Y=U({"ɵprov":U});U({"ɵinj":U});var z=U({ngInjectableDef:U});function J(t,e){return e&&e.token===t?e:null}var G=t("InjectionToken",function(){function t(t,e){var n;this._desc=t,this.ngMetadataName="InjectionToken",this.ɵprov=void 0,"number"==typeof e?this.__NG_ELEMENT_ID__=e:void 0!==e&&(this.ɵprov={token:(n={token:this,providedIn:e.providedIn||"root",factory:e.factory}).token,providedIn:n.providedIn||null,factory:n.factory,value:void 0})}return t.prototype.toString=function(){return"InjectionToken "+this._desc},t}());function W(t){return new G(t)}var q=t("Injector",(function(){})),$=new(function(){function t(){}return t.prototype.get=function(t,e){if(void 0===e&&(e=R),e===R){var n=new Error("NullInjectorError: No provider for "+K(t)+"!");throw n.name="NullInjectorError",n}return e},t}()),Q=U({__forward_ref__:U});function X(t){return"function"==typeof(e=t)&&e.hasOwnProperty(Q)&&e.__forward_ref__===Z?t():t;var e}function Z(t){return t.__forward_ref__=Z,t.toString=function(){return K(this())},t}var tt=t("INJECTOR",new G("INJECTOR",-1)),et=t("ɵ0",U),nt=t("USE_VALUE",U({provide:String,useValue:et})),it=void 0;function rt(t){var e=it;return it=t,e}var ot=t("StaticInjector",function(){function t(t,e,n){void 0===e&&(e=$),void 0===n&&(n=null),e=e||$,this.parent=e,this.source=n;var i=this._records=new Map;i.set(q,{token:q,fn:_,deps:V,value:this,useNew:!1}),i.set(tt,{token:tt,fn:_,deps:V,value:this,useNew:!1}),this.scope=ut(i,t)}return t.prototype.get=function(t,e,n){void 0===n&&(n=B.Default);var i,r=this._records,o=r.get(t);if(void 0===o){var a=J(i=t,i[Y])||J(i,i[z]);if(a){var s=a&&a.providedIn;("any"===s||null!=s&&s===this.scope)&&r.set(t,o=pt({provide:t,useFactory:a.factory,deps:V}))}void 0===o&&r.set(t,null)}var u=rt(this);try{return ct(t,o,r,this.parent,e,n)}catch(t){throw t}finally{rt(u)}},t.prototype.toString=function(){var t=[];return this._records.forEach((function(e,n){return t.push(K(n))})),"StaticInjector["+t.join(", ")+"]"},t}());function at(t){return H("Cannot mix multi providers and regular providers",t)}var st=t("INJECTOR_SCOPE",new G("Set Injector scope."));function ut(t,e){var n=null;if(e)if(e=X(e),Array.isArray(e))for(var i=0;i<e.length;i++)n=ut(t,e[i])||n;else{if("function"==typeof e)throw H("Function/Class not supported",e);if(!e||"object"!=typeof e||!e.provide)throw H("Unexpected provider",e);var r=X(e.provide),o=pt(e);if(!0===e.multi){var a=t.get(r);if(a){if(a.fn!==F)throw at(r)}else t.set(r,a={token:e.provide,deps:[],useNew:!1,fn:F,value:V});r=e,a.deps.push({token:r,options:6})}var s=t.get(r);if(s&&s.fn===F)throw at(r);r===st&&(n=o.value),t.set(r,o)}return n}function pt(t){var e=function(t){var e=V,n=t.deps;if(n&&n.length){e=[];for(var i=0;i<n.length;i++){var r=6,o=X(n[i]);e.push({token:o,options:r})}}else if(t.useExisting){e=[{token:o=X(t.useExisting),options:6}]}else if(!n&&!(nt in t))throw H("'deps' required",t);return e}(t),n=_,i=V,r=!1,o=X(t.provide);if(nt in t)i=t.useValue;else if(t.useFactory)n=t.useFactory;else if(t.useExisting);else if(t.useClass)r=!0,n=X(t.useClass);else{if("function"!=typeof o)throw H("StaticProvider does not have [useValue|useFactory|useExisting|useClass] or [provide] is not newable",t);r=!0,n=o}return{deps:e,fn:n,useNew:r,value:i}}function ct(t,e,n,i,r,o){try{return function(t,e,n,i,r,o){var a,s;if(!e||o&B.SkipSelf)s=o&B.Self?o&B.Optional?$.get(t,void 0!==r?r:null):$.get(t,r):i.get(t,r,B.Default);else{if((s=e.value)===L)throw Error("ɵCircular dependency");if(s===V){e.value=L;var u=e.useNew,p=e.fn,c=e.deps,h=V;if(c.length){h=[];for(var f=0;f<c.length;f++){var l=c[f],y=l.options,d=2&y?n.get(l.token):void 0;h.push(ct(l.token,d,n,d||4&y?i:$,1&y?null:R,B.Default))}}e.value=s=u?new((a=p).bind.apply(a,S([void 0],h))):p.apply(void 0,h)}}return s}(t,e,n,i,r,o)}catch(n){throw n instanceof Error||(n=new Error(n)),(n.ngTempTokenPath=n.ngTempTokenPath||[]).unshift(t),e&&e.value===L&&(e.value=V),n}}function ht(t,e,n){return new ot(t,e,n)}var ft=t("INJECTOR_IMPL",ht);function lt(t,e){return Array.isArray(t)?ft(t,e,""):ft(t.providers,t.parent,t.name||"")}var yt=t("ANNOTATIONS","__annotations__"),dt=t("PARAMETERS","__parameters__"),gt=t("PROP_METADATA","__prop__metadata__");function vt(t,e,n,i,r){var o=mt(e);function a(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(this instanceof a)return o.call.apply(o,S([this],e)),this;var s=new((t=a).bind.apply(t,S([void 0],e))),u=function(t){return r&&r.apply(void 0,S([t],e)),(t.hasOwnProperty(yt)?t[yt]:Object.defineProperty(t,yt,{value:[]})[yt]).push(s),t};return i&&i(u),u}return n&&(a.prototype=Object.create(n.prototype)),a.prototype.ngMetadataName=t,a.annotationCls=a,a}function mt(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(t){var i=t.apply(void 0,S(e));for(var r in i)this[r]=i[r]}}}function Pt(t,e,n){var i=mt(e);function r(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(this instanceof r)return i.apply(this,e),this;var o=new((t=r).bind.apply(t,S([void 0],e)));return function(t,e){var n=t.constructor,i=n.hasOwnProperty(gt)?n[gt]:Object.defineProperty(n,gt,{value:{}})[gt];i[e]=i.hasOwnProperty(e)&&i[e]||[],i[e].unshift(o)}}return n&&(r.prototype=Object.create(n.prototype)),r.prototype.ngMetadataName=t,r.annotationCls=r,r}var bt,Ct=t("MetadataUtil",function(){function t(){}return t.getClassMetadatas=function(t){return t[yt]},t.getClassMetadataByName=function(t,e){return this.getClassMetadataByNameWithTranslate(t,e,null,null)},t.getClassMetadataByNameWithTranslate=function(t,e,n,i){var r=this.getClassMetadatas(t);if(!r)return null;var o=r.find((function(t){return t.ngMetadataName===e}));return o&&n&&i&&i.forEach((function(t){var e=o[t];if(e&&e.startsWith("{{")&&e.endsWith("}}")){var i=e.replace("{{","").replace("}}","").trim();o[t]=n.transform(i,null)}})),o},t.getPropsMetadatas=function(t){return t[gt]},t.getPropsMetadatasByName=function(t,e){return this.getPropsMetadatasByNameWithTranslate(t,e)},t.getPropsMetadatasByNameWithTranslate=function(t,e,n,i){var r={},o=this.getPropsMetadatas(t);return o?(Object.keys(o).forEach((function(t){var a=o[t].find((function(t){return t.ngMetadataName===e}));n&&i&&i.forEach((function(t){var e=a[t];if(e&&e.startsWith("{{")&&e.endsWith("}}")){var i=e.replace("{{","").replace("}}","").trim();a[t]=n.transform(i,null)}})),a&&(r[t]=a)})),r):r},t.getPropMetadatasByName=function(t,e){return null},t.getPropMetadataByName=function(t,e,n){return null},t}()),Et=(t("HttpMethods",function(){function t(){}return t.GET="GET",t.DELETE="DELETE",t.HEAD="HEAD",t.OPTIONS="OPTIONS",t.POST="POST",t.PUT="PUT",t.PATCH="PATCH",t.LINK="LINK",t.UNLINK="UNLINK",t}()),t("HttpUtil",function(){function t(){}return t.appendHeader=function(t,e,n){var i;return t=Object.assign({},t,((i={})[e]=n,i))},t.appendBodyToRequestConfig=function(t,e){return e||(e={}),e=Object.assign({},e,{body:t})},t.buildAxiosRequestConfig=function(t,e,n){return{url:e,method:t,params:(n=n||{}).params||null,headers:n.headers||null,responseType:n.responseType||"json",data:n.body||null}},t.buildHttpResponse=function(t){return{body:t.data,headers:t.headers,status:t.status,statusText:t.statusText}},t}())),Mt=t("HttpClient",function(){function t(){this.axiosInstance=d.create()}return t.prototype.get=function(t,e){return this.request("GET",t,e)},t.prototype.post=function(t,e,n){return n=Et.appendBodyToRequestConfig(e,n),this.request("POST",t,n)},t.prototype.put=function(t,e,n){return n=Et.appendBodyToRequestConfig(e,n),this.request("PUT",t,n)},t.prototype.patch=function(t,e,n){return n=Et.appendBodyToRequestConfig(e,n),this.request("PATCH",t,n)},t.prototype.delete=function(t,e){return this.request("DELETE",t,e)},t.prototype.request=function(t,i,r){var o=this;return e(!0).pipe(s((function(){var e=Et.buildAxiosRequestConfig(t,i,r);return n(o.axiosInstance.request(e))}))).pipe(u((function(t){var e=Et.buildHttpResponse(t);return"response"===r.observe?e:t.data})))},t}()),It=t("HTTP_PROVIDERS",[{provide:Mt,useClass:Mt,deps:[]}]),wt=t("Modification",(function(t,e,n,i){this.type=e,this.value=t,this.preValue=i,this.path=n}));function xt(t,e){return JSON.stringify(t)===JSON.stringify(e)}!function(t){t.Add="ADD",t.Remove="REMOVE",t.ValueChange="VALUE_CHANGE",t.Load="LOAD",t.UnChanged="UNCHANGED",t.PaginationInfoChange="PAGINATION_INFO_CHANGE"}(bt||(bt=t("ModifyType",{})));var Ot,St=t("ChangeSet",function(){function t(){this.modifications=[]}return Object.defineProperty(t.prototype,"changes",{get:function(){return this.modifications},enumerable:!0,configurable:!0}),t.prototype.append=function(t){switch(t.type){case bt.ValueChange:this.appendValueChangeModification(t);break;case bt.Add:this.appendAddModification(t);break;case bt.Remove:this.appendRemoveModification(t);break;case bt.Load:break;default:throw new Error("不支持此类型的变更")}},t.prototype.appendValueChangeModification=function(t){var e=t.value,n=this.findModifyItemsPath(t.path);if(n)n.value=e;else{var i=this.findNewAddItemsPath(t.path);i?i.value=Object.assign({},i.value,e):this.modifications.push(t)}},t.prototype.appendAddModification=function(t){var e=t.value,n=this.findNewAddItemsPath(t.path);n?n.value=n.value.concat(e):this.modifications.push(t)},t.prototype.appendRemoveModification=function(t){var e=t.path,n=Object.keys(t.value)[0],i=t.value[n];this.modifications.forEach((function(t){t.type===bt.Add&&!1!==xt(t.path,e)&&(t.value=t.value.filter((function(t){return t[n]!==i})))}));var r=e.concat(n+":"+i);this.modifications=this.modifications.filter((function(t){if(t.type!==bt.ValueChange)return!0;var e=Array.from(t.path);return e.pop(),!xt(e,r)})),this.removeDescendantRemoveModifications(t),this.modifications.push(t)},t.prototype.clear=function(){this.modifications=[]},t.prototype.findNewAddItemsPath=function(t){return this.modifications.find((function(e,n){return xt(t,e.path)&&e.type===bt.Add}))},t.prototype.findModifyItemsPath=function(t){return this.modifications.find((function(e,n){return xt(t,e.path)&&e.type===bt.ValueChange}))},t.prototype.removeDescendantRemoveModifications=function(t){var e=this,n=this.createRemovePathWithId(t);this.modifications=this.modifications.filter((function(t){if(t.type!==bt.Remove)return!0;var i=e.createRemovePathWithId(t);return!e.isDescendantPath(n,i)}))},t.prototype.createRemovePathWithId=function(t){var e=t.path,n=Object.keys(t.value)[0],i=t.value[n];return e.concat([n+":"+i])},t.prototype.isDescendantPath=function(t,e){if(t.length>e.length)return!1;var n=!0;return t.forEach((function(t,i){t===e[i]||(n=!1)})),n},t}());!function(t){t.DataId="DataId",t.PropName="PropName"}(Ot||(Ot=t("DataPathNodeType",{})));var Dt,jt=t("DataPathNode",(function(t,e){this.type=t,this.value=e,this.prev=null,this.next=null})),Tt=t("DataPath",function(){function t(){this.head=new jt(null,null),this.length=0}return t.prototype.unshift=function(t,e){var n=new jt(t,e);n.next=this.head.next,n.prev=this.head,this.head.next=n,n.next&&(n.next.prev=n),this.length++},t.prototype.push=function(t,e){var n=this.getTail(),i=new jt(t,e);n.next=i,this.length++},t.prototype.getTail=function(){for(var t=this.head;t.next;)t=t.next;return t},t.prototype.toArray=function(){for(var t=[],e=this.head.next;e;)t.push(e.type+":"+e.value),e=e.next;return t},t.prototype.toString=function(){return"["+this.toArray().join(", ")+"]"},t.prototype.clone=function(){for(var e=new t,n=this.head.next;n;)e.push(n.type,n.value),n=n.next;return e},t}());!function(t){t.Primitive="Primitive",t.Object="Object",t.Dynamic="Dynamic",t.List="List"}(Dt||(Dt=t("DataPropGroup",{})));t("DataPropInfo",(function(){}));var Nt=t("PRIMITIVE_PROP_META","PrimitivePropMeta");t("PrimitivePropMeta",Pt(Nt,(function(t){var e={primary:!1,foreign:!1};if(t)switch(typeof t){case"boolean":e.primary=Boolean(t);break;case"string":e.dataField=String(t);break;case"object":e=Object.assign(e,t)}return e}))),t("StringUtil",function(){function t(){}return t.format=function(t,e){return t.toString()},t}()),t("NumberUtil",function(){function t(){}return t.format=function(t,e){var n,i=e.precision||0===e.precision?e.precision:2,r=e.decimal||".",o=e.thousand||"",a=e.prefix||"",s=e.suffix||"";"dynamic"==e.prefixType&&e.prefix&&(a=new Function("return "+e.prefix)()(e.sourceData));t=(t+"").replace(/[^0-9+-Ee.]/g,"");var u,p,c;if(n=(i||0===i?(u=t,p=i,c=Math.pow(10,p),""+parseFloat(Math.round(parseFloat((u*c).toFixed(2*p))).toFixed(2*p))/c):""+Math.round(t)).split("."),o){for(var h=/(-?\d+)(\d{3})/;h.test(n[0]);)n[0]=n[0].replace(h,"$1"+o+"$2");(n[1]||"").length<i&&(n[1]=n[1]||"",n[1]+=new Array(i-n[1].length+1).join("0"))}var f=n.join(r);return f=""+a+f+s},t}()),t("BoolUtil",function(){function t(){}return t.format=function(t,e){return!0===t?"是":"否"},t}()),t("EnumUtil",function(){function t(){}return t.format=function(t,e){var n=e.enumData.find((function(e){return e.value===t}));return n?n.name:(console.error("找不到"+t+"对应的枚举选项"),t)},t}());C.locale("zh-cn");var At,Bt,Vt,_t=t("DateUtil",function(){function t(){}return t.formatISO=function(t){if(!0===this.isEmptyDateOrDateString(t))return this.emptyISODateTimeString;var e=this.parse(t);return g(e,this.defaultISOFormat)},t.format=function(t,e){if(!0===this.isEmptyDateOrDateString(t))return this.emptyISODateTimeString;var n=this.parse(t);return e=e||this.defaultDisplayFormat,g(n,e)},t.dateShow=function(t,e){return!0===this.isEmptyDateOrDateString(t)?this.emptyISODateTimeString:e&&""!==e?this[e]&&this[e](t):void 0},t.dateOperation=function(t,e){if(!0===this.isEmptyDateOrDateString(t))return this.emptyISODateTimeString;var n=e.type,i=void 0===n?"":n,r=e.option;return i&&""!==i?"isSame"===i||"isBefore"===i||"isAfter"===i?this[i]&&this[i](t,e.targetDate,e.granularity):"isBetween"===i?this[i]&&this[i](t,e.targetDate,e.targetDate2,e.granularity,e.contains):r?this[i]&&this[i](t,r):this[i]&&this[i](t):void 0},t.relativeTime=function(t,e){C.extend(T);var n=C(t);return e?C(n).fromNow(e):C(n).fromNow()},t.isToday=function(t){var e=new Date,n=C(t);return this.isSame(n,e,"date")},t.calendar=function(t,e){var n=C(t);return C.extend(N),e?C().calendar(n,I({},e)):C().calendar(n,{sameDay:"[今天] HH:mm",nextDay:"[明天] HH:mm",lastDay:"[昨天] HH:mm",sameElse:"YYYY-MM-DD"})},t.parse=function(t){return!0===this.isEmptyDateOrDateString(t)?null:!0===this.isDate(t)?t:v(t)},t.isDate=function(t){return m(t)},t.isEmptyDateOrDateString=function(t){return!0===this.isDate(t)?this.isEmptyDate(t):this.isEmptyDateString(t)},t.isEmptyDate=function(t){return!t},t.isEmptyDateString=function(t){return!t||!0===t.startsWith("0001-01-01")},t.isEqual=function(t,e){var n=this.parse(t),i=this.parse(e);return n===i||P(n,i)},t.compare=function(t,e){var n=this.parse(t),i=this.parse(e);return!0===this.isEqual(n,i)?0:n||!0!==this.isDate(i)?i||!0!==this.isDate(n)?b(n,i):1:-1},t.isSame=function(t,e,n){return n?C(t).isSame(C(e),n):C(t).isSame(C(e))},t.isBefore=function(t,e,n){return n?C(t).isBefore(C(e),n):C(t).isBefore(C(e))},t.isAfter=function(t,e,n){return n?C(t).isAfter(C(e),n):C(t).isAfter(C(e))},t.isBetween=function(t,e,n,i,r){return C.extend(j),i?C(t).isBetween(C(e),C(n),i,r):C(t).isBetween(C(e),C(n),null,r)},t.emptyDateTimeString=null,t.emptyISODateTimeString=null,t.defaultISOFormat="yyyy-MM-dd'T'HH:mm:ssxxx",t.defaultDisplayFormat="yyyy-MM-dd HH:mm:ss",t.defaultDateFormat="yyyy-MM-dd",t.defaultTimeFormat="HH:mm:ss",t}()),Lt=t("ArrayUtil",function(){function t(){}return t.remove=function(t,e){var n=t.findIndex((function(t){return t===e}));this.removeByIndex(t,n)},t.removeByIndex=function(t,e){!t||t[e],t.splice(e,1)},t}()),Ft=t("ObjectUtil",function(){function t(){}return t.isPlainObject=function(t){if("object"!=typeof t||null===t||"[object Object]"!==Object.prototype.toString.call({}))return!1;if(null===Object.getPrototypeOf(t))return!0;for(var e=t;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},t}()),kt=t("BindingPathConverter",function(){function t(){}return t.toBindingPathArray=function(t){return"string"==typeof t?t.split("/").filter((function(t){return""!==t})):t.concat([])},t.toBindingPathString=function(t){return"/"+t.join("/")},t}());t("BindingPathComparer",function(){function t(){}return t.isEqual=function(t,e){var n=kt.toBindingPathArray(t),i=kt.toBindingPathArray(e);return n.every((function(t,e){return t===i[e]}))},t.isParent=function(t,e){var n=kt.toBindingPathArray(t),i=kt.toBindingPathArray(e);if(n.length===i.length+1)return this.isAncestor(t,e)},t.isAncestor=function(t,e){var n=kt.toBindingPathArray(t),i=kt.toBindingPathArray(e);return!(t.length<=i.length)&&i.every((function(t,e){return t===n[e]}))},t}()),t("BindingPathTraverser",function(){function t(){}return t.getLeafPathString=function(t){return kt.toBindingPathArray(t).pop()},t.getParentPathString=function(t){var e=kt.toBindingPathArray(t);return e.pop(),"/"+e.join("/")},t}());!function(t){t.Load="Load",t.Append="Append",t.Remove="Remove",t.SelectionChanged="SelectionChanged",t.ValueChanged="ValueChanged",t.UpdateErrors="UpdateErrors",t.GlobalSelectionChanged="GlobalSelectionChanged",t.PaginationInfoChange="PaginationInfoChange"}(At||(At=t("ChangeType",{}))),function(t){t[t.ValueChanged=0]="ValueChanged"}(Bt||(Bt=t("ViewChangeType",{}))),function(t){t.Plain="Plain",t.Object="Object",t.List="List",t.Dynamic="Dynamic"}(Vt||(Vt=t("BindingPropertyType",{})));var Rt=t("PropertyUtil",function(){function t(){}return t.getProperties=function(t){var e=[],n=Xt.getNgFields(t);Object.keys(n).forEach((function(t){var i=n[t];e.push({name:t,type:Vt.Plain,isPrimaryKey:i.primary,isForeignKey:i.foreign,enableMultiLangInput:i.enableMultiLangInput})}));var i=Xt.getNgObjects(t);Object.keys(i).forEach((function(t){var n=i[t];e.push({name:t,type:Vt.Object,entityType:n.type})}));var r=Xt.getNgList(t);Object.keys(r).forEach((function(t){var n=r[t];e.push({name:t,type:Vt.List,entityType:n.type})}));var o=Xt.getNgDynamic(t);return Object.keys(o).forEach((function(t){var n=o[t];e.push({name:t,type:Vt.Dynamic,entityType:n.type})})),e},t.getDynamicProperties=function(t){var e=[];return Object.keys(t).forEach((function(n){t.hasOwnProperty(n)&&(t[n]instanceof Object?e.push({name:n,type:Vt.Dynamic,entityType:null}):e.push({name:n,type:Vt.Plain,isPrimaryKey:!1,isForeignKey:!1}))})),e},t.getPropertyByName=function(t,e){return t.find((function(t){return t.name===e}))},t.getPrimaryKey=function(t){var e=t.find((function(t){return!0===t.isPrimaryKey}));return e?e.name:""},t}()),Kt=t("BindingObject",function(){function t(t){this.isShowValidationMsg=!1,this.controlMap={},this.properties=t,this.primaryKey=Rt.getPrimaryKey(t),this.innerValues=new Map,this.changes=new o,this.viewChanges=new o}return Object.defineProperty(t.prototype,"primaryKeyValue",{get:function(){return this.primaryKey?this.getValue(this.primaryKey):""},enumerable:!0,configurable:!0}),t.prototype.setShowValidationMsg=function(t){this.isShowValidationMsg=t},t.prototype.getValue=function(t){return this.innerValues.get(t)},t.prototype.setValue=function(t,n,i,r,o,a){var s=this;void 0===i&&(i=!1),void 0===r&&(r=!1);var u=this.getValue(t);u!==n&&(a&&u!==n||(a=function(t,n,i){return e(!0)}),!0===r?a(u,n,!1).subscribe((function(e){if(e){s.innerValues=s.innerValues.set(t,n);var r={type:Bt.ValueChanged,path:[t],value:n,errors:o};s.viewChanges.next(r),!0===i&&s.changes.next({type:At.ValueChanged,path:[t],value:n,id:s.primaryKeyValue,errors:o}),a(u,n,!0).subscribe()}else s.changes.next({type:At.ValueChanged,path:[t],value:u,id:s.primaryKeyValue,errors:o})})):(this.innerValues=this.innerValues.set(t,n),!0===i&&this.changes.next({type:At.ValueChanged,path:[t],value:n,id:this.primaryKeyValue,errors:o}),a(u,n,!0).subscribe()))},t.prototype.toJSON=function(t){var e=this,n=window.localStorage.getItem("languageCode")||"zh-CHS",i={};return this.properties.forEach((function(r){var o=r.name;if(r.type===Vt.List){var a=e[o];i[o]=a.toJSON(t)}else if(r.type===Vt.Object){var s=e[o];i[o]=s.toJSON(t)}else if(r.type===Vt.Dynamic){s=e[o];i[o]=s.toJSON(t)}else if(t&&!0===t.ignoreMultiLangInput&&!0===r.enableMultiLangInput){var u=e.getValue(o);i[o]=u?u[n]:u}else i[o]=e.getValue(o)})),i},t}()),Ut=t("BindingListFactory",function(){function t(){}return t.create=function(t){var e=new Yt(t);return this.extendProperties(e,t),e},t.extendProperties=function(t,e){e.forEach((function(e){var n=e.name;Object.defineProperty(t,n,{get:function(){return t.currentItem[n]}})}))},t}()),Ht=t("BindingObjectFactory",function(){function t(){}return t.create=function(t){var e=new Kt(t);return this.extendProperties(e,t),e},t.createDynamicBindingObject=function(t){var e=Rt.getDynamicProperties(t),n=new Kt(e);return this.extendProperties(n,e),n},t.extendProperties=function(t,e){var n=this;e.forEach((function(e){e.type===Vt.List?n.extendListProperty(t,e):e.type===Vt.Object?n.extendObjectProperty(t,e):e.type===Vt.Dynamic?n.extendDynamicObjectProperty(t,e):n.extendPlainProperty(t,e)}))},t.extendListProperty=function(t,e){var n=e.name,i=Rt.getProperties(e.entityType),r=Ut.create(i);r.parent=t,r.changes.subscribe((function(e){e.path.unshift(n),t.changes.next(e)})),Object.defineProperty(t,n,{value:r})},t.extendObjectProperty=function(t,e){var n=e.name,i=Rt.getProperties(e.entityType),r=this.create(i);r.parent=t,r.changes.subscribe((function(e){e.path.unshift(n),t.changes.next(e)})),Object.defineProperty(t,n,{value:r})},t.extendDynamicObjectProperty=function(t,e){t[e.name]=null},t.attachDynamicObjectProperty=function(t,e,n){n.parent=t,n.changes.subscribe((function(n){n.path.unshift(e),t.changes.next(n)})),Object.defineProperty(t,e,{value:n})},t.extendPlainProperty=function(t,e){var n=e.name;Object.defineProperty(t,n,{get:function(){return t.getValue(n)},set:function(e){e!==t.getValue(n)&&t.setValue(n,e,!0,!0)}})},t}()),Yt=t("BindingList",function(){function t(t){this._paginationInfo=null,this.properties=t,this.primaryKey=Rt.getPrimaryKey(t),this.changes=new o,this.innerList=[],this.currentId=null}return Object.defineProperty(t.prototype,"paginationInfo",{get:function(){return this._paginationInfo},set:function(t){this._paginationInfo=t,this._paginationInfo!==t&&this.changes.next({type:At.PaginationInfoChange,path:[],value:this._paginationInfo})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pageIndex",{get:function(){return this.paginationInfo&&this.paginationInfo.hasOwnProperty("pageIndex")?this.paginationInfo.pageIndex:1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pageSize",{get:function(){return this.paginationInfo&&this.paginationInfo.hasOwnProperty("pageSize")?this.paginationInfo.pageSize:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"total",{get:function(){return this.paginationInfo?this.paginationInfo.total||this.paginationInfo.totalCount:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skip",{get:function(){return(this.pageIndex-1)*this.pageSize},enumerable:!0,configurable:!0}),t.prototype.setPaginationInfo=function(t,e){this.paginationInfo=Object.assign({},this.paginationInfo,{pageSize:e,pageIndex:t/e+1})},Object.defineProperty(t.prototype,"currentItem",{get:function(){var t=this.findById(this.currentId);return t||(this.emptyCurrentItem||(this.emptyCurrentItem=Ht.create(this.properties)),this.emptyCurrentItem)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return this.innerList.length},enumerable:!0,configurable:!0}),t.prototype[Symbol.iterator]=function(){var t=this,e=-1,n=this.innerList.length;return{next:function(){return++e<n?{done:!1,value:t.innerList[e]}:{done:!0,value:void 0}}}},t.prototype.load=function(t){var e=this;if(this.innerList=[],0!==t.length){if(t.forEach((function(t){e.add(t)})),!this.findById(this.currentId)){var n=t[0][this.primaryKey];this.setCurrentId(n,!1,!1)}}else this.currentId=null;this.changes.next({type:At.Load,path:[],value:t})},t.prototype.append=function(t){var e=this;if(0!==t.length){t.forEach((function(t){e.add(t)}));var n=t[t.length-1][this.primaryKey];this.setCurrentId(n,!0,!0),this.changes.next({type:At.Append,path:[],value:t})}},t.prototype.add=function(t){var e=this;this.innerList.push(t),t.parent=this,t.changes.subscribe((function(t){e.changes.next(t)}))},t.prototype.removeByIds=function(t){var e=this;if(t&&0!==t.length){var n=this.currentId;t.forEach((function(t){t===n&&(n=e.getCurrentIdBeforeDeleting());var i=e.getIndexById(t);-1!==i&&Lt.removeByIndex(e.innerList,i)})),0===this.innerList.length?this.currentId=null:this.setCurrentId(n,!1,!1),this.changes.next({type:At.Remove,path:[],value:t})}},t.prototype.clear=function(){this.innerList=[],this.currentId=null,this.changes.next({type:At.Remove,path:[],value:[]})},t.prototype.getCurrentIdBeforeDeleting=function(){var t=-1,e=this.getIndexById(this.currentId);return t=e===this.length-1?e-1:e+1,this.getIdByIndex(t)},t.prototype.findById=function(t){var e,n=this;return void 0===(e=this.innerList.find((function(e){return e.getValue(n.primaryKey)===t})))?null:e},t.prototype.setCurrentId=function(t,e,n){(void 0===e&&(e=!0),void 0===n&&(n=!0),this.currentId!==t)&&(this.findById(t)&&(this.currentId=t,!0===e&&this.changes.next({type:At.SelectionChanged,path:[],value:this.currentItem}),!0===n&&this.changes.next({type:At.GlobalSelectionChanged,path:[],value:this.currentItem})))},t.prototype.getIndexById=function(t){var e=this;return this.innerList.findIndex((function(n){return n[e.primaryKey]===t}))},t.prototype.getIdByIndex=function(t){if(t<0||t>this.length)return null;var e=this.innerList[t];return e?e[this.primaryKey]:null},t.prototype.toArray=function(){return this.innerList.concat([])},t.prototype.toJSON=function(t){var e=[];return this.innerList.forEach((function(n){e.push(n.toJSON(t))})),e},t.prototype.getPaginationConfigByPath=function(t,e){if(!t||"/"===t)return this.paginationInfo;if("string"!=typeof t)throw new Error("路径必须为字符串！");var n=(t=t.substring(1)).split("/").filter((function(t){return!!t&&t.trim().length>0})).map((function(t){return t.trim()})),i=this.paginationInfo;return n.forEach((function(t){i=i&&i.hasOwnProperty(t)?i[t]:null})),i||(void 0!==e?e:void 0)},t.prototype.sortBy=function(t,e,n){if(!t||t.length<1||!e||e.length<1)throw new Error("sortBy:argument error");var i="string"==typeof t?t.split(","):t||[],r="string"==typeof e?e.split(","):e||[];if(i.length!==r.length||i.length<1)throw new Error("sortBy:fields and directions not match");var o,a;this.innerList=this.innerList.sort((o=i,a=r,function(t,e){var n,i;try{for(var r=x(o),s=r.next();!s.done;s=r.next()){var u=s.value,p=["asc"].includes(a[o.indexOf(u)])?1:-1;if(t.getValue(u)>e.getValue(u))return 1*p;if(t.getValue(u)<e.getValue(u))return-1*p}}catch(t){n={error:t}}finally{try{s&&!s.done&&(i=r.return)&&i.call(r)}finally{if(n)throw n.error}}return 0}))},t}()),zt=t("EntityUtil",function(){function t(){}return t.loadEntity=function(t,e){var n=this;e.properties.forEach((function(i){var r=i.name;if(i.type===Vt.List)n.loadEntityList(t[r]||t[ie],e[r]);else if(i.type===Vt.Object)t&&t[r]&&n.loadEntity(t[r],e[r]);else if(i.type===Vt.Dynamic){if(t&&t[r]){var o=Ht.createDynamicBindingObject(t[r].data);Ht.attachDynamicObjectProperty(e,r,o),n.loadEntity(t[r],e[r])}}else e.setValue(r,t[r],!1,!1)})),this.setUpEntityPipeline(t,e)},t.setUpEntityPipeline=function(t,e){t.onValueChanged.subscribe((function(t){if(t.type===bt.ValueChange&&0!==t.path.length){var n=t.path[t.path.length-1],i=t.path[t.path.length-2];if(e.primaryKey&&"id"===e.primaryKey){var r=e.primaryKey;if(i!==r+":"+e.getValue(r))return}e.getValue(n)!==t.value&&e.setValue(n,t.value,!0,!1,t.errors)}})),e.viewChanges.subscribe((function(n){var i,r=n.value,o=n.path[0],a=t.getPaths(),s=a.path;if(e.id,a.isUdt){"",(i=function(t){t&&t&&t.id?t.id:t.parent&&i(t.parent)})(e),a.isGrid&&s.shift(),s.length&&s.join(".")}if(e.primaryKey){var u=e.primaryKey;if(o!==u&&(!t[u]||t[u]!==e[u]))return}t[o]!==r&&(t[o]=r)}))},t.loadEntityList=function(t,e){this.loadEntities(t.items,e),this.setUpEntityListPipeline(t,e)},t.setUpEntityListPipeline=function(t,e){var n=this;t.onListChanged.subscribe((function(t){switch(t.type){case bt.Add:if(0===t.value.length)return;var i=t.path,r=i[i.length-2],o=e.parent.primaryKeyValue;if(-1===r.indexOf(o))return;n.appendEntities(t.value,e);break;case bt.Remove:var a=t.value[e.primaryKey];e.removeByIds([a]);break;case bt.Load:var s=t.value;n.loadEntities(s,e)}}))},t.loadRepository=function(t,e){var n=this,i=Array.from(t.entityCollection.toArray());this.loadEntities(i,e),t.entityCollectionChange.subscribe((function(t){switch(t.type){case bt.Load:n.loadEntities(t.value,e);break;case bt.Add:n.appendEntities(t.value,e);break;case bt.Remove:n.removeEntities(t.value,e);break;case bt.PaginationInfoChange:e.paginationInfo=t.value}})),e.changes.subscribe((function(e){if(e.type===At.PaginationInfoChange){var n=t.entityCollection;n.paginationInfo=Object.assign({},n.paginationInfo,e.value)}}))},t.loadEntities=function(t,e){var n=this.createBindingObjects(t,e);e.load(n)},t.appendEntities=function(t,e){var n=this.createBindingObjects(t,e);e.append(n)},t.removeEntities=function(t,e){if(null!==t&&0!==t.length){var n=e.primaryKey,i=[];t.forEach((function(t){i.push(t[n])})),e.removeByIds(i)}},t.createBindingObjects=function(t,e){var n=this;if(null===t||0===t.length)return[];var i=[];return t.forEach((function(t){var r=Ht.create(e.properties);n.loadEntity(t,r),i.push(r)})),i},t.watchReposiroty=function(t,e){t.entityCollectionChange.subscribe((function(t){switch(t.type){case bt.PaginationInfoChange:e.pagingInfo=t.value}}))},t.getPropInfo=function(t,e){var n,i,r=Xt.getNgFields(t);Object.keys(r).forEach((function(t){t===e&&(n="NgField",i=null)}));var o=Xt.getNgObjects(t);Object.keys(o).forEach((function(t){t===e&&(n="NgObject",i=o[t].type)}));var a=Xt.getNgList(t);Object.keys(a).forEach((function(t){t===e&&(n="NgList",i=a[t].type)}));var s=Xt.getNgDynamic(t);return Object.keys(s).forEach((function(t){t===e&&(n="NgDynamic",i=s[t].type)})),{propType:n,propEntityType:i}},t.getPrimaryKey=function(t){var e=Xt.getPrimaryFieldMetadata(t);return e?e.dataField:""},t.isObjectProp=function(t,e){var n=!1,i=Xt.getNgObjects(t);return Object.keys(i).forEach((function(t){t===e&&(n=!0)})),n},t.isDynamicProp=function(t,e){var n=!1,i=Xt.getNgDynamic(t);return Object.keys(i).forEach((function(t){t===e&&(n=!0)})),n},t.appendInitialData=function(t,e){var n=Object.assign({},e);delete n.id,delete n.parentID,t.initialData=n},t}()),Jt=t("BindingData",function(){function t(){this.paginationInfo=null}return Object.defineProperty(t.prototype,"bindingPath",{get:function(){return this.viewModelContext&&this.viewModelContext.viewModel.bindingPath?this.viewModelContext.viewModel.bindingPath:"/"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pagingInfo",{get:function(){return this.paginationInfo},set:function(t){this.paginationInfo=t,this.firePagingChangeEvent()},enumerable:!0,configurable:!0}),t.prototype.setPagingInfo=function(t,e,n){if(n.length<1||"/"===n)this.paginationInfo=Object.assign(this.paginationInfo,{pageSize:e,pageIndex:t/e+1});else{var i=this.paginationInfo||{};n.substr(1).split("/").filter((function(t){return!!t&&t.length>0})).map((function(t){return t.substring(0,t.length-1)})).forEach((function(t){i.hasOwnProperty(t)||(i[t]={}),i=i[t]})),i.pageIndex=(t/e||0)+1,i.pageSize=e||0}this.firePagingChangeEvent()},t.prototype.firePagingChangeEvent=function(){this.list.changes.next({type:At.PaginationInfoChange,path:[],value:this.paginationInfo})},Object.defineProperty(t.prototype,"changes",{get:function(){return this.list.changes},enumerable:!0,configurable:!0}),t.prototype.setValueChangeInvokerFactory=function(t){this.valueChangeInvokerFactory=t},t.prototype.init=function(t,e){this.initByRepository(t,null)},t.prototype.initByRepository=function(t,e){this.viewModelContext=e,this.properties=Rt.getProperties(t.entityType),this.list=Ut.create(this.properties),this.pagingInfo=t.entityCollection.paginationInfo,zt.loadRepository(t,this.list),this.dataTypeInfo=t.entityTypeInfo,this.extendProperties(this.properties)},t.prototype.initByBindingList=function(t,e){this.list=t,this.viewModelContext=e,this.extendProperties(this.list.properties)},t.prototype.getValue=function(t){var e=this.list;return t.forEach((function(t){e&&(e=e[t])})),e},t.prototype.setValue=function(e,n,i,r){if(void 0===i&&(i=!1),void 0===r&&(r=!0),!e||0===e.length)throw Error("路径不能为空");var o=e.slice(0,e.length-1),a=e[e.length-1],s=this.getValue(o);if(!s)throw Error("找不到要设置的对象");s instanceof t?s=s.list.currentItem:s instanceof Yt&&(s=s.currentItem),this.valueChangeInvokerFactory?s.setValue(a,n,i,r,null,this.valueChangeInvokerFactory(e)):s.setValue(a,n,i,r)},t.prototype.clearValue=function(t,e,n){var i;void 0===e&&(e=!1),void 0===n&&(n=!0);var r=this.dataTypeInfo.getPropInfoByPath(t);r&&r.metadataInfo&&void 0!==r.metadataInfo.initValue?i=r.metadataInfo.initValue:i="number"==typeof this.getValue(t)?0:"";this.setValue(t,i,e,n)},t.prototype.getList=function(){if(!this.bindingPath||"/"===this.bindingPath)return this.list;var t=this.bindingPath.substr(1).split("/").filter((function(t){return""!==t}));return this.getValue(t)},t.prototype.getObject=function(){return this.getList().currentItem},t.prototype.extendProperties=function(t){var e=this;t.forEach((function(t){var n=t.name;Object.defineProperty(e,n,{get:function(){return e.list.currentItem[n]},set:function(t){e.list.currentItem[n]=t}})}))},t}()),Gt=t("BindingDataFactory",function(){function t(){}return t.createFromRepository=function(t,e){var n=new Jt,i=Rt.getProperties(t.entityType),r=Ut.create(i);return n.initByBindingList(r,null),zt.loadRepository(t,r),n.pagingInfo=t.entityCollection.paginationInfo,n},t.createFromEntityManager=function(t,e){var n=new Jt,i=Rt.getProperties(t.entityType),r=Ut.create(i);n.initByBindingList(r,null);var o=t.getEntitiesByPath([]);return zt.loadEntities(o,r),n},t.createFromExistingBindingData=function(t,e){var n=new Jt;return n.initByBindingList(t.list,null),n},t}()),Wt=(t("EntityPathConverter",function(){function t(){}return t.toEntityPathArray=function(t,e){var n=this,i=kt.toBindingPathArray(t),r=[];if(0===i.length)return r;var o=e.list.currentItem;return r.push(this.createPrimaryKeyPath(o.primaryKey,o.primaryKeyValue)),i.forEach((function(t){switch(Rt.getPropertyByName(o.properties,t).type){case Vt.Plain:r.push(t);break;case Vt.Object:o=o[t],r.push(t),r.push(n.createPrimaryKeyPath(o.primaryKey,o.primaryKeyValue));break;case Vt.List:var e=o[t];o=e.currentItem,r.push(t),r.push(n.createPrimaryKeyPath(o.primaryKey,o.primaryKeyValue))}})),r},t.createPrimaryKeyPath=function(t,e){return t+":"+e},t}()),t("EntityPathComparer",(function(){})),t("FormPathConverter",function(){function t(){}return t.toBindingPathArray=function(t){return t.split(".").filter((function(t){return""!==t}))},t}()),t("DataPathUtil",function(){function t(){}return t.convertToBindingPathArray=function(t){return t.split("/").filter((function(t){return""!==t}))},t.convertToEntityPathArray=function(t,e){var n=this,i=this.convertToBindingPathArray(t),r=[];if(0===i.length)return r;var o=e.list.currentItem;return r.push(this.createPrimaryKeyPath(o.primaryKey,o.primaryKeyValue)),i.forEach((function(t){switch(Rt.getPropertyByName(o.properties,t).type){case Vt.Plain:r.push(t);break;case Vt.Object:o=o[t],r.push(t),r.push(n.createPrimaryKeyPath(o.primaryKey,o.primaryKeyValue));break;case Vt.List:var e=o[t];o=e.currentItem,r.push(t),r.push(n.createPrimaryKeyPath(o.primaryKey,o.primaryKeyValue))}})),r},t.convertToRestUrl=function(t,e){var n=this.convertToBindingPathArray(t),i=[],r=e.list.currentItem;return i.push(r.primaryKeyValue),n.forEach((function(t){var e=Rt.getPropertyByName(r.properties,t);if(e.type!==Vt.List)throw new Error(e.name+"不是子表对应的属性");var n=r[t];r=n.currentItem,i.push(t),i.push(r.primaryKeyValue)})),i.pop(),"/"+i.join("/")},t.getLeafPath=function(e){return t.convertToBindingPathArray(e).pop()},t.getParentPath=function(e){var n=t.convertToBindingPathArray(e);return n.pop(),"/"+n.join("/")},t.createPrimaryKeyPath=function(t,e){return t+":"+e},t}()),t("Guid",function(){function t(e){if(!e)throw new TypeError("Invalid argument; `value` has no value.");this.value=t.EMPTY,e&&t.isGuid(e)&&(this.value=e)}return t.isGuid=function(e){var n=e.toString();return e&&(e instanceof t||t.validator.test(n))},t.create=function(){return new t([t.gen(2),t.gen(1),t.gen(1),t.gen(1),t.gen(3)].join("-"))},t.createEmpty=function(){return new t("emptyguid")},t.parse=function(e){return new t(e)},t.raw=function(){return[t.gen(2),t.gen(1),t.gen(1),t.gen(1),t.gen(3)].join("-")},t.gen=function(t){for(var e="",n=0;n<t;n++)e+=(65536*(1+Math.random())|0).toString(16).substring(1);return e},t.prototype.equals=function(e){return t.isGuid(e)&&this.value===e.toString()},t.prototype.isEmpty=function(){return this.value===t.EMPTY},t.prototype.toString=function(){return this.value},t.prototype.toJSON=function(){return{value:this.value}},t.validator=new RegExp("^[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}$","i"),t.EMPTY="00000000-0000-0000-0000-000000000000",t}()),t("isObservable",(function(t){return!!t&&(!(!t[Symbol.observable]||t!==t[Symbol.observable]())||(!(!t["@@observable"]||t!==t["@@observable"]())||t instanceof i))}))),qt=t("OBJECT_PROP_META","ObjectPropMeta");t("ObjectPropMeta",Pt(qt,(function(t){if(Ft.isPlainObject(t))return t;var e=typeof t;return"string"===e?{dataField:t}:"function"===e?{type:t}:void 0})));var $t=t("DYNAMIC_PROP_META","DynamicPropMeta");t("DynamicPropMeta",Pt($t,(function(t){if(Ft.isPlainObject(t))return t;var e=typeof t;return"string"===e?{dataField:t}:"function"===e?{type:t}:void 0})));var Qt=t("LIST_PROP_META","ListPropMeta");t("ListPropMeta",Pt(Qt,(function(t){if(Ft.isPlainObject(t))return t;var e=typeof t;return"string"===e?{dataField:t}:"function"===e?{type:t}:void 0})));var Xt=t("FieldMetadataUtil",function(){function t(){}return t.getNgFields=function(t){return Ct.getPropsMetadatasByName(t,Nt)},t.getNgField=function(t,e){return this.getNgFields(t)[e]},t.getDataField=function(t,e){return this.getNgField(t,e).dataField||e},t.getNgObjects=function(t){return Ct.getPropsMetadatasByName(t,qt)},t.getNgDynamic=function(t){return Ct.getPropsMetadatasByName(t,$t)},t.getNgList=function(t){return Ct.getPropsMetadatasByName(t,Qt)},t.getPrimaryFieldMetadata=function(e){var n=t.getNgFields(e),i=Object.keys(n).find((function(t){return n[t].primary}));if(i){var r=n[i];return r.property=i,r.dataField||(r.dataField=i),r}},t.getPrimaryKey=function(t){var e=this.getPrimaryFieldMetadata(t);return e?e.property:""},t}()),Zt=t("EntityMetadataUtil",function(){function t(){}return t.getAllNgProperties=function(t){var e=this.getNgFieldProperties(t),n=this.getNgObjectProperties(t),i=this.getNgDynamicProperties(t),r=this.getNgObjectProperties(t);return Object.assign({},e,n,i,r)},t.getNgFieldProperties=function(t){return Ct.getPropsMetadatasByName(t,Nt)},t.getNgObjectProperties=function(t){return Ct.getPropsMetadatasByName(t,qt)},t.getNgDynamicProperties=function(t){return Ct.getPropsMetadatasByName(t,$t)},t.getNgListProperties=function(t){return Ct.getPropsMetadatasByName(t,Qt)},t.getPrimaryKeyProperty=function(e){var n,i=t.getNgFieldProperties(e);return Object.keys(i).forEach((function(t){var e=i[t];!0===e.primary&&(n=e)})),n},t}()),te=t("DataTypeInfo",function(){function t(t){this.type=t,this.primaryKey="",this.foreignKey="",this.propInfoMap=new Map,this.collectPropInfos()}return Object.defineProperty(t.prototype,"isValueObject",{get:function(){return!this.primaryKey},enumerable:!0,configurable:!0}),t.prototype.getPropInfos=function(){return Array.from(this.propInfoMap.values())},t.prototype.getPropNames=function(){var t=[];return this.getPropInfos().forEach((function(e){t.push(e.name)})),t},t.prototype.getPropInfosByGroup=function(t){return Array.from(this.propInfoMap.values()).filter((function(e){return e.group===t}))},t.prototype.getPropNamesByGroup=function(t){var e=[];return this.getPropInfosByGroup(t).forEach((function(t){e.push(t.name)})),e},t.prototype.getPropInfoByName=function(t){return this.propInfoMap.has(t)?this.propInfoMap.get(t):null},t.prototype.getPropInfoByPath=function(t){var e=t.concat([]);if(0===e.length)throw Error("属性路径不能为空");for(var n=this,i=null;n&&e.length>0;){var r=e.shift();if(!(i=n.getPropInfoByName(r)))throw Error("路径"+t+"中存在不正确的节点"+r+"，请检查");n=i.typeInfo,i.group===Dt.Dynamic&&e.length>0&&(i=null,n=null)}return i},t.prototype.getTypeInfoByPath=function(t){if(0===t.length)return this;var e=this.getPropInfoByPath(t);if(!e.typeInfo)throw Error("路径"+t+"无法定位到一个EntityTypeInfo，请检查");return e.typeInfo},t.prototype.getPrimaryKeyPropInfo=function(){return this.getPropInfoByName(this.primaryKey)},t.prototype.getPropMappingByName=function(t){var e=this.getPropInfoByName(t);return e?e.mapping:""},t.prototype.getPropMappingByPath=function(t){var e=this.getPropInfoByPath(t);return e?e.mapping:""},t.prototype.checkPropGroup=function(t,e){var n=this.getPropInfoByName(t);return!(!n||n.group!==e)},t.prototype.collectPropInfos=function(){var t=this,e=Zt.getNgFieldProperties(this.type);Object.keys(e).forEach((function(n){var i=e[n];!0===i.primary&&(t.primaryKey=n),!0===i.foreign&&(t.foreignKey=n),t.addPropInfo(Dt.Primitive,n,i.dataField,null,i)}));var n=Zt.getNgObjectProperties(this.type);Object.keys(n).forEach((function(e){var i=n[e];t.addPropInfo(Dt.Object,e,i.dataField,i.type,i)}));var i=Zt.getNgDynamicProperties(this.type);Object.keys(i).forEach((function(e){var n=i[e];t.addPropInfo(Dt.Dynamic,e,n.dataField,null,n)}));var r=Zt.getNgListProperties(this.type);Object.keys(r).forEach((function(e){var n=r[e];t.addPropInfo(Dt.List,e,n.dataField,n.type,n)}))},t.prototype.addPropInfo=function(e,n,i,r,o){i=i||n;var a=null;r&&(a=new t(r));var s={group:e,name:n,mapping:i,typeInfo:a,metadataInfo:o};this.propInfoMap.set(n,s)},t}()),ee=t("DataPathCreator",function(){function t(){}return t.createByLongPathFromRoot=function(t,e){var n=new Tt,i=t;if(!i||0===i.length)return n;for(var r={nodeValue:i.shift(),nodeType:Ot.DataId,entityTypeInfo:new te(e.entityType)};r;){n.push(r.nodeType,r.nodeValue);var o=i.shift();if(!o||!r.entityTypeInfo)break;r=this.getNextPathNodeInfo(r,o)}return n},t.getNextPathNodeInfo=function(t,e){var n=t.nodeValue,i=t.nodeType,r=t.entityTypeInfo;if(!e||!r)return null;var o={nodeValue:e,nodeType:null,entityTypeInfo:null};if(i===Ot.DataId)o.nodeType=Ot.PropName,o.entityTypeInfo=r;else{var a=r.getPropInfoByName(n);a.group===Dt.List?(o.nodeType=Ot.DataId,o.entityTypeInfo=a.typeInfo):(o.nodeType=Ot.PropName,o.entityTypeInfo=a.group===Dt.Object?a.typeInfo:null)}return o},t.createByShortPathFromRoot=function(t,e,n){var i=new Tt,r=t,o=n.list.currentItem,a=new te(e.entityType);return i.push(Ot.DataId,o.primaryKeyValue),r.forEach((function(t){var e=a.getPropInfoByName(t);switch(e.group){case Dt.Primitive:i.push(Ot.PropName,t);break;case Dt.Object:o=o[t],a=e.typeInfo,i.push(Ot.PropName,t);break;case Dt.List:var n=o[t];o=n.currentItem,a=e.typeInfo,i.push(Ot.PropName,t),i.push(Ot.DataId,o.primaryKeyValue)}})),i},t}()),ne=t("PARENT_PATH","__PARENT_PATH__"),ie=t("PARENT_CLASS","__PARENT__");function re(t,e){return new t(e)}function oe(t,e){var n=[];return e.forEach((function(e){var i=re(t,e);n.push(i)})),n}function ae(t,e){return new t(e)}var se=t("EntityList",function(){function t(t,e){var n=this;this.listChanged=new o,this.changeSet=new St,this.onListChanged=this.listChanged.asObservable(),this.clear(),t&&t.forEach((function(t){n.initEntity(ae(e,t))}))}return Object.defineProperty(t.prototype,"items",{get:function(){return this.rawData},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"changes",{get:function(){return this.changeSet.changes},enumerable:!0,configurable:!0}),t.prototype[Symbol.iterator]=function(){return w(this,(function(t){switch(t.label){case 0:return[5,x(this.items)];case 1:return t.sent(),[2]}}))},t.prototype.loadEntities=function(t){var e=this;this.clear(),t.forEach((function(t){e.initEntity(t)}));var n={path:[],value:t,preValue:void 0,type:bt.Load};this.setChanges(n)},t.prototype.clear=function(){this.rawData=[]},t.prototype.appendNew=function(t){var e=this.initEntity(t),n={path:[],value:[e],preValue:void 0,type:bt.Add};return this.setChanges(n),e},t.prototype.appendEntity=function(t){var e={path:[],value:[this.initEntity(t)],preValue:void 0,type:bt.Add};this.setChanges(e)},t.prototype.appendEntities=function(t){var e=this,n={path:[],value:t.map((function(t){return e.initEntity(t)})),preValue:void 0,type:bt.Add};this.setChanges(n)},t.prototype.remove=function(t){var e,n=this.count(),i=this.rawData.findIndex((function(e){return e.primaryValue===t}));if(-1===i)return!1;var r=this.rawData[i];this.rawData.splice(i,1);var o={path:[],value:(e={},e[r.primaryProperty.dataField]=t,e),preValue:void 0,type:bt.Remove};return this.updateIndex(n),this.setChanges(o),!0},t.prototype.get=function(t){return this.items.find((function(e){return e.primaryValue===t}))},t.prototype.setChanges=function(t){this.listChanged.next(t);var e=Object.assign({},t);t.type===bt.Add&&t.value[0]instanceof pe&&(e.value=[t.value[0].data]),this.changeSet.append(e)},t.prototype.count=function(){return this.items.length},t.prototype.indexOf=function(t){return this.items.indexOf(t)},t.prototype.sum=function(t){return 0===this.count()?0:this.items.reduce((function(e,n){return e+n[t]}),0)},t.prototype.toJson=function(){return this.rawData},t.prototype.toJSON=function(){var t=[];return this.items.forEach((function(e){t.push(e.toJSON())})),t},t.prototype.toArray=function(){return this.items},t.prototype.initEntity=function(t){var e=this;return t[ie]=this,t[ne]=this[ne],t.onValueChanged.subscribe((function(t){var n={path:t.path,value:t.value,preValue:t.preValue,type:t.type};e.setChanges(n)})),this[this.rawData.push(t)-1]=t,t},t.prototype.updateIndex=function(t){for(var e=this,n=0;n<t;n++)delete this[n];this.rawData.forEach((function(t,n){e[n]=t}))},t.prototype.getPropertyName=function(){var t=this[ne];if(t&&t.length)return t[t.length-1]},t}());function ue(t,e){return new t(e)}var pe=t("Entity",function(){function t(t){this.validErrors={},this.changeSet=new St,this.isValidating=!1,this.newData=void 0,this.valueChanged=new o,this.onValueChanged=this.valueChanged.asObservable(),this.newData=Object.assign({},t),this.onValueChanged=this.valueChanged,this.initialize()}return Object.defineProperty(t.prototype,"data",{get:function(){return this.newData},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"errors",{get:function(){return this.validErrors},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"changes",{get:function(){return this.changeSet.changes},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"primaryProperty",{get:function(){return Xt.getPrimaryFieldMetadata(this.constructor)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"primaryKey",{get:function(){return this.primaryProperty?this.primaryProperty.property:""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"primaryValue",{get:function(){if(this.primaryKey){var t=this[this.primaryProperty.property];return t||""}return""},enumerable:!0,configurable:!0}),t.prototype.setChanges=function(t){t.path[t.path.length-1],this.valueChanged.next(t),this.changeSet.append(t)},t.prototype.getPaths=function(){var t={path:[],isUdt:!1,isGrid:!1},e=function(n){var i=n[ne];if(i){var r=i[i.length-1];Object.keys(Xt.getNgObjects(n[ie].constructor)).indexOf(r)>-1&&(t.isUdt=!0),n[ie]&&n instanceof se==!0&&(t.isGrid=!0),t.path.push(r)}n[ie]&&n instanceof se==!0&&e(n[ie])};return e(this),t.path=t.path.reverse(),t},t.prototype.load=function(t){t||(t={}),this.loadFields(t),this.loadLists(t),this.loadObjects(t),this.loadDynamicObjects(t),this.newData=Object.assign({},t)},t.prototype.toJSON=function(){var t=this,e={},n=Xt.getNgFields(this.constructor);Object.keys(n).forEach((function(i){var r=n[i].dataField||i;e[r]=t[i]}));var i=Xt.getNgObjects(this.constructor);Object.keys(i).forEach((function(n){var r=i[n].dataField||n;e[r]=t[n]?t[n].toJSON():{}}));var r=Xt.getNgDynamic(this.constructor);Object.keys(r).forEach((function(n){var i=r[n].dataField||n;e[i]=t[n]?t[n].toJSON():{}}));var o=Xt.getNgList(this.constructor);return Object.keys(o).forEach((function(n){var i=o[n].dataField||n;e[i]=t[n]?t[n].toJSON():{}})),e},t.prototype.initialize=function(){var t=this.constructor,e=Xt.getNgFields(t),n=Xt.getNgObjects(t),i=Xt.getNgList(t),r=Xt.getNgDynamic(t);this.initializeNormalField(e),this.initializeList(i),this.initializeObject(n),this.initializeDynamic(r)},t.prototype.createPath=function(t){var e=this.primaryProperty;return e?[e.dataField+":"+this.primaryValue,t]:[":",t]},t.prototype.initializeNormalField=function(t){var e=this;Object.keys(t).forEach((function(n){var i=t[n];i.dataField,delete e[n]&&Object.defineProperty(e,n,{get:function(){return this.getPropValue(n,i)},set:function(t){if((!this.primaryKey||this.primaryKey!==n||t)&&(!this.primaryKey||this.primaryKey===n||this.primaryValue)){var e=this.getPropValue(n,i);!1!==this.isPropValueChanged(n,i,t,e)&&(this.setPropValue(n,i,t),this.emitValueChange(n,i,t,e))}},configurable:!0})}))},t.prototype.initializeList=function(t){var e=this;Object.keys(t).forEach((function(n){var i=t[n],r=e.createPath(n),o=i.dataField||n,a=e.data[o],s=new se;if(s[ie]=e,s[ne]=r,a){var u=a.map((function(t){return ue(i.type,t)}));s.loadEntities(u)}s.onListChanged.subscribe((function(t){t&&(s[ne][0]!==t.path[0]&&(t.path=s[ne].concat(t.path)),e.setChanges(t))})),e[n]=s}))},t.prototype.initializeObject=function(t){var e=this;Object.keys(t).forEach((function(n){var i=t[n],r=e.createPath(n),o=i.dataField||n,a=e.data[o]||{},s=function(t){var n;return(n=t instanceof i.type?t:ue(i.type,t))[ie]=e,n[ne]=r,n.onValueChanged.subscribe((function(t){t&&(t.path=(e[ne]||[]).concat(t.path),e.setChanges(t))})),n},u=s(a);delete e[n]&&Object.defineProperty(e,n,{get:function(){return u},set:function(t){var e={path:u[ne],value:t.data,preValue:this[n].data,type:bt.ValueChange};u=s(t),this.setChanges(e)},configurable:!0})}))},t.prototype.initializeDynamic=function(t){var e=this;Object.keys(t).forEach((function(n){var i=t[n],r=e.createPath(n),o=i.dataField||n,a=e.data[o]||{},s=function(t){var n;return(n=t instanceof i.type?t:ue(i.type,t))[ie]=e,n[ne]=r,n.onValueChanged.subscribe((function(t){t&&(t.path=(e[ne]||[]).concat(t.path),e.setChanges(t))})),n},u=s(a);delete e[n]&&Object.defineProperty(e,n,{get:function(){return u},set:function(t){var e={path:u[ne],value:t.data,preValue:this[n].data,type:bt.ValueChange};u=s(t),this.setChanges(e)},configurable:!0})}))},t.prototype.loadFields=function(t){var e=this,n=Xt.getNgFields(this.constructor);Object.keys(n).forEach((function(i){var r=n[i].dataField||i;e[i]=t[r]}))},t.prototype.loadLists=function(t){var e=this,n=Xt.getNgList(this.constructor);Object.keys(n).forEach((function(i){var r=n[i],o=r.dataField||i,a=r.type,s=t[o];if(s){var u=s.map((function(t){return ue(a,t)}));e[i].loadEntities(u)}else e[i].loadEntities([])}))},t.prototype.loadObjects=function(t){var e=this,n=Xt.getNgObjects(this.constructor);Object.keys(n).forEach((function(i){var r=n[i].dataField||i,o=t[r],a=e[i];a&&o&&a.load(o)}))},t.prototype.loadDynamicObjects=function(t){var e=this,n=Xt.getNgDynamic(this.constructor);Object.keys(n).forEach((function(i){var r=n[i].dataField||i,o=t[r]||{},a=e[i];a&&a.loadDynamicData(o)}))},t.prototype.emitValueChange=function(t,e,n,i){var r={path:this.createPath(t),value:n,preValue:i,type:bt.ValueChange};this[ne]&&(r.path=this[ne].concat(r.path)),this.setChanges(r)},t.prototype.getPropValue=function(t,e){var n,i=e.dataField||t,r=this.data[i];if(!0===e.enableMultiLangInput&&!r){var o=window.localStorage.getItem("languageCode")||"zh-CHS",a=i.replace("_MULTILANGUAGE","");return(n={})[o]=this.data[a],n}return r},t.prototype.setPropValue=function(t,e,n){var i=e.dataField||t;this.data[i]=n},t.prototype.isPropValueChanged=function(t,e,n,i){return!0===e.enableMultiLangInput?(!0!==this.isEmptyMultiLangPropValue(n)||!0!==this.isEmptyMultiLangPropValue(i))&&JSON.stringify(n)!==JSON.stringify(i):n!==i},t.prototype.isEmptyMultiLangPropValue=function(t){return!t||0===Object.keys(t).length},t}()),ce=(t("DynamicEntity",function(t){function e(e){var n=t.call(this,e)||this;return n.loadDynamicData(e),n}return M(e,t),Object.defineProperty(e.prototype,"IsNested",{get:function(){return this[ie]instanceof e},enumerable:!0,configurable:!0}),e.prototype.loadDynamicData=function(t){this.initializeDynamicField(t)},e.prototype.initializeDynamicField=function(t){var e=this;Object.keys(t).forEach((function(n){e[n]&&delete e[n];var i=n;if(t[n]instanceof Object){var r=e.createPath(n),o=e.createDynamicEntityFromJsonData(t[n],r);Object.defineProperty(e,n,{get:function(){return o},set:function(t){var e={path:o[ne],value:t.data,preValue:this[n].data,type:bt.ValueChange};o=this.createDynamicEntityFromJsonData(t,r),this.setChanges(e)},configurable:!0})}else Object.defineProperty(e,n,{get:function(){return this.data[i]},set:function(t){var e=this.data[i];if(e!==t){this.data[i]=t;var r={type:bt.ValueChange,path:this.createPath(n),value:t,preValue:e};this[ne]&&(r.path=this[ne].concat(r.path)),this.setChanges(r)}},configurable:!0})}))},e.prototype.createDynamicEntityFromJsonData=function(t,n){var i,r=this;return(i=t instanceof e?t:new e(t))[ie]=this,i[ne]=n,i.onValueChanged.subscribe((function(t){t&&(t.path=(r[ne]||[]).concat(t.path),r.setChanges(t))})),i},e.prototype.setChanges=function(t){var e,n=t.path[t.path.length-1],i=Object.assign({},this.data);this.newData=Object.assign(this.newData,((e={})[n]=t.value,e));var r=t.path;t.path.length>2&&(r=t.path.slice(0,t.path.length-2));var o={path:r,value:this.data,preValue:i,type:t.type};this.valueChanged.next(o),this.changeSet.append(t)},e.prototype.toJSON=function(){return this.data},e}(pe)),t("REPOSITORY_META","RepositoryMeta"));var he=t("EntityCollection",function(){function t(t){this.innerEntitySet=new Set,this.innerEntityMap=new Map,this.collectionChanged=new o,this.entityType=t,this.primaryKey=Xt.getPrimaryKey(this.entityType)}return t.prototype.count=function(){return this.innerEntitySet.size},Object.defineProperty(t.prototype,"entityTypeName",{get:function(){return this.entityType.name},enumerable:!0,configurable:!0}),t.prototype.has=function(t){return this.innerEntityMap.has(t)},t.prototype.clear=function(){this.innerEntityMap.clear(),this.innerEntitySet.clear(),this.notifyCollectionChanged(new wt([],bt.Load))},t.prototype.toArray=function(){return Array.from(this.innerEntitySet)},t.prototype.toJSON=function(){var t=[];return this.toArray().forEach((function(e){t.push(e.toJSON())})),t},t.prototype.loadEntities=function(t){var e=this;this.innerEntityMap.clear(),this.innerEntitySet.clear(),t.forEach((function(t){e.innerEntitySet.add(t),e.innerEntityMap.set(t[e.primaryKey],t)})),this.notifyCollectionChanged(new wt(t,bt.Load))},t.prototype.addEntity=function(t){this.verifyEntityToAdd(t),this.innerEntitySet.add(t),this.innerEntityMap.set(t[this.primaryKey],t),this.notifyCollectionChanged(new wt([t],bt.Add))},t.prototype.addEntities=function(t){var e=this;if(t){var n=[];t.forEach((function(t){e.verifyEntityToAdd(t),n.push(t)})),n.forEach((function(t){e.innerEntitySet.add(t),e.innerEntityMap.set(t[e.primaryKey],t)})),this.notifyCollectionChanged(new wt(n,bt.Add))}},t.prototype.getEntityById=function(t){return!1===this.innerEntityMap.has(t)?null:this.innerEntityMap.get(t)},t.prototype.getEntityByPath=function(t){for(var e=t[0].split(":")[1],n=this.getEntityById(e),i=1;i<t.length&&n;i+=1){var r=t[i];n instanceof pe?-1===r.indexOf(":")&&(n=n[t[i]]):n=n.get(t[i].split(":")[1])}return n},t.prototype.getEntities=function(t){return Array.from(this.innerEntitySet).filter(t)},t.prototype.getAllEntities=function(){return Array.from(this.innerEntitySet)},t.prototype.removeEntityById=function(t){this.verifyEntityToRemove(t);var e=this.innerEntityMap.get(t);return this.innerEntityMap.delete(t),this.innerEntitySet.delete(e),this.notifyCollectionChanged(new wt([e],bt.Remove)),e},t.prototype.removeEntitiesByIds=function(t){},t.prototype.removeEntities=function(t){var e=this,n=Array.from(this.innerEntitySet).filter(t);return n.forEach((function(t){e.innerEntityMap.delete(t[e.primaryKey]),e.innerEntitySet.delete(t)})),this.notifyCollectionChanged(new wt(n,bt.Remove)),n},t.prototype.resetEntities=function(t,e){var n,i;if(-1===t[0].indexOf(":"))throw new Error("路径格式错误");var r=O(t[0].split(":"),2),o=r[0],a=r[1],s=null;try{for(var u=x(this.innerEntitySet),p=u.next();!p.done;p=u.next()){var c=p.value;if(c[o]===a){s=c;break}}}catch(t){n={error:t}}finally{try{p&&!p.done&&(i=u.return)&&i.call(u)}finally{if(n)throw n.error}}if(!s)throw new Error("找不到"+o+"为"+a+"的实体");var h=s;t.slice(1).forEach((function(t){h=h[t]}));var f=h;f.clear(),f.loadEntities(e)},t.prototype.verifyEntityToAdd=function(t){return this.has(t[this.primaryKey])&&(this.innerEntitySet.delete(this.innerEntityMap.get(t[this.primaryKey])),this.innerEntityMap.delete(t[this.primaryKey])),!0},t.prototype.verifyEntityToRemove=function(t){if(!this.has(t))throw new Error("The entity with identity of '"+t+" dose not exsit.'");return!0},t.prototype.notifyCollectionChanged=function(t){this.collectionChanged.next(t)},Object.defineProperty(t.prototype,"pageSize",{get:function(){return this.paginationInfo&&this.paginationInfo.pageSize||0},set:function(t){if("number"!=typeof t||t<0)throw new Error("Invalid parameter:pageSize");var e=this.paginationInfo;this.paginationInfo=Object.assign({},e,{pageSize:t}),this.notifyCollectionChanged(new wt(this.paginationInfo,bt.PaginationInfoChange))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalCount",{get:function(){return this.paginationInfo&&this.paginationInfo.total||0},set:function(t){if("number"!=typeof t||t<0)throw new Error("Invalid parameter:total");var e=this.paginationInfo;this.paginationInfo=Object.assign({},e,{total:t}),this.notifyCollectionChanged(new wt(this.paginationInfo,bt.PaginationInfoChange))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pageIndex",{get:function(){return this.paginationInfo&&this.paginationInfo.pageIndex||1},set:function(t){if("number"!=typeof t||t<0)throw new Error("Invalid parameter:pageIndex");var e=this.paginationInfo;this.paginationInfo=Object.assign({},e,{pageIndex:t}),this.notifyCollectionChanged(new wt(this.paginationInfo,bt.PaginationInfoChange))},enumerable:!0,configurable:!0}),t.prototype.updatePaginationInfoByPath=function(t,e){var n=this.paginationInfo,i=e.pageIndex,r=e.pageSize,o=e.totalCount,a=Object.assign({},n,{pageIndex:i,pageSize:r,total:o});this.setPaginationConfigByPath(t,a)},t.prototype.getPaginationConfigByPath=function(t,e){if(!t||"/"===t)return this.paginationInfo;if("string"!=typeof t)throw new Error("路径必须为字符串！");var n=(t=t.substring(1)).split("/").filter((function(t){return!!t&&t.trim().length>0})).map((function(t){return t.trim()})),i=this.paginationInfo;return n.forEach((function(t){i=i&&i.hasOwnProperty(t)?i[t]:null})),i||(void 0!==e?e:void 0)},t.prototype.setPaginationConfigByPath=function(t,e){var n=JSON.stringify(this.paginationInfo);return t&&"/"!==t?(Array.isArray(t)||(t=t.toString().match(/[^/[\]]+/g)||[]),t.slice(0,-1).reduce((function(e,n,i){return Object(e[n])===e[n]?e[n]:e[n]=Math.abs(t[i+1])>>0==+t[i+1]?[]:{}}),this.paginationInfo)[t[t.length-1]]=e):this.paginationInfo=e,JSON.stringify(this.paginationInfo)!==n&&this.notifyCollectionChanged(new wt(this.paginationInfo,bt.PaginationInfoChange)),this.paginationInfo},t}()),fe=t("EntityManager",function(){function t(t){this.entityCollection=t,this.entityType=t.entityType}return t.prototype.createEntity=function(t){return re(this.entityType,t)},t.prototype.createEntities=function(t,e){return oe(this.entityType,t)},t.prototype.getEntityByPath=function(t){return this.getEntityNodeByPath(t)},t.prototype.getEntitiesByPath=function(t){var e=this.getEntityNodeByPath(t);return e.toArray()},t.prototype.getEntityNodeByPath=function(t){for(var e=ee.createByLongPathFromRoot(t,this),n=this.entityCollection,i=e.head.next;i;){if(!(n=i.type===Ot.DataId?n instanceof he==!0?n.getEntityById(i.value):n.get(i.value):n[i.value]))throw new Error("找不到"+i.value+"对应的数据节点");i=i.next}return n},t.prototype.getPropValueByPath=function(t){var e=t.pop();return this.getEntityByPath(t)[e]},t.prototype.setPropValueByPath=function(t,e){var n=t.pop();this.getEntityByPath(t)[n]=e},t.prototype.insertEntityBeforeByPath=function(t){throw new Error("Not Implemented")},t.prototype.insertEntitiesBeforeByPath=function(){throw new Error("Not Implemented")},t.prototype.insertEntityAfterByPath=function(){throw new Error("Not Implemented")},t.prototype.insertEntitiesAfterByPath=function(){throw new Error("Not Implemented")},t.prototype.appendEntityByPath=function(t,e,n){var i,r,o,a=t.split("/");if(a.length<3)throw Error("根据path删除实体数据出错了。传入的path["+t+"]格式不对");for(var s=2;s<a.length;s+=2){var u=a[s-1];o=a[s];var p=i?i.get(u):this.entityCollection.getEntityById(u);i=p[o];var c=r?r.propEntityType:this.entityType;if(r=zt.getPropInfo(c,o),!i)throw Error("fpath参数错误，无法找到"+o+"对应的子表。fpath为："+t)}var h=re(r.propEntityType,e);return n&&zt.appendInitialData(h,n),i.appendNew(h),h},t.prototype.appendEntitiesByPath=function(t,e){var n=this.getEntityNodeByPath(t);n instanceof he==!0?n.addEntities(e):n.appendEntities(e)},t.prototype.removeEntityByPath=function(t,e){var n,i=t.split("/");if(i.length<3)throw Error("根据path删除实体数据出错了。传入的path["+t+"]格式不对");for(var r=2;r<i.length;r+=2){var o=i[r-1],a=i[r],s=n?n.get(o):this.entityCollection.getEntityById(o);if(!(n=s[a]))throw Error("fpath参数错误，无法找到"+a+"对应的子表。fpath为："+t)}n.remove(e)},t.prototype.removeEntitiesByPath=function(t,e){throw new Error("Not Implemented")},t.prototype.clearAllEntityChanges=function(){this.entityCollection.toArray().forEach((function(t){t.changes.splice(0,t.changes.length)}))},t.prototype.clearEntityChangesById=function(t){var e=this.entityCollection.getEntityById(t);e&&e.changes.splice(0,e.changes.length)},t.prototype.clearEntityChangesByIds=function(t){var e=this;!t||t.length<0||t.forEach((function(t){e.clearEntityChangesById(t)}))},t.prototype.checkAllEntityChanges=function(){return this.entityCollection.toArray().some((function(t){return t.changes.length>0}))},t.prototype.checkEntityChangesById=function(t){var e=this.entityCollection.getEntityById(t);return!!e&&e.changes.length>0},t.prototype.clearEntityChangesByArray=function(t){this.clearEntityChangesByIds(t)},t}()),le=function(){function t(t,e){this.entityType=t,this.paginationConfig=e,null!==this.paginationConfig&&void 0!==this.paginationConfig||(this.paginationConfig=this.getNgListProperties()),this.expandMainEntityConfig(),this.deleteMainEntityConfig()}return t.prototype.expandMainEntityConfig=function(){var t=this.entityType.name;if(this.paginationConfig.hasOwnProperty(t)){var e=this.paginationConfig[t];this.paginationConfig=Object.assign(this.paginationConfig,e)}},t.prototype.deleteMainEntityConfig=function(){delete this.paginationConfig[this.entityType.name]},Object.defineProperty(t.prototype,"pagination",{get:function(){return this.paginationConfig},enumerable:!0,configurable:!0}),t.prototype.getPaginationConfigByPath=function(t,e){if(!t||"/"===t)return this.paginationConfig;if("string"!=typeof t)throw new Error("路径必须为字符串！");var n=(t=t.substring(1)).split("/").filter((function(t){return!!t&&t.trim().length>0})),i=this.paginationConfig;return n.forEach((function(t){i=i&&i.hasOwnProperty(t)?i[t]:null})),i||(void 0!==e?e:void 0)},t.prototype.setPaginationConfigByPath=function(t,e){return Array.isArray(t)||(t=t.toString().match(/[^/[\]]+/g)||[]),t.slice(0,-1).reduce((function(e,n,i){return Object(e[n])===e[n]?e[n]:e[n]=Math.abs(t[i+1])>>0==+t[i+1]?[]:{}}),this.paginationConfig)[t[t.length-1]]=e,this.paginationConfig},t.prototype.getNgListProperties=function(t){void 0===t&&(t=0);var e=function(n){var i=Xt.getNgList(n),r={};return Object.keys(i).length<1||Object.keys(i).forEach((function(n){var o=i[n].dataField;o.endsWith("s")&&(o=o.substring(0,o.length-1)),r[o]={pageSize:t};var a=e(i[n].type);null!==a&&Object.keys(a).length>0&&(r=Object.assign({},r,a))})),r},n=e(this.entityType);return Object.assign({},{pageSize:t},n)},t}(),ye=function(){function t(){this.history=[]}return t.prototype.addChange=function(t){this["on"+A[t.changeType]+"Data"](t)},t.prototype.addChanges=function(t){var e=this;t.forEach((function(t){return e.addChange(t)}))},t.prototype.clear=function(){this.history.splice(0,this.history.length)},t.prototype.clearByIds=function(t){this.history=this.history.filter((function(e){var n,i;if(!e.fpath||"/"===e.fpath||!e.fpath.includes("/"))return!t.includes(e.dataId);try{for(var r=x(t),o=r.next();!o.done;o=r.next()){var a=o.value;return!e.fpath.split("/").includes(a)}}catch(t){n={error:t}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(n)throw n.error}}}))},t.prototype.isChanged=function(){return this.history.length>0},t.prototype.onAddData=function(t){this.history.push(t)},t.prototype.onDeleteData=function(t){var e=this.history.findIndex((function(e){return e.dataId===t.dataId&&e.changeType===A.Add}));e>=0?this.history.splice(e,1):this.history.push(t)},t}(),de=t("Repository",function(){function t(){this.paginationInfo=null}return t.prototype.init=function(){this.entityTypeInfo=new te(this.entityType),this.entityCollection=new he(this.entityType),this.dataChangeHistory=new ye},Object.defineProperty(t.prototype,"primaryKey",{get:function(){return this.entityCollection.primaryKey},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"entityCollectionChange",{get:function(){return this.entityCollection.collectionChanged},enumerable:!0,configurable:!0}),t.prototype.reset=function(){this.entityCollection.clear()},t.prototype.buildEntity=function(t){return re(this.entityType,t)},t.prototype.buildEntities=function(t){return oe(this.entityType,t)},t.prototype.setPaginationConfig=function(t){this.paginationManager=new le(this.entityType,t);var e=(this.paginationManager.getPaginationConfigByPath("/")||{}).pageSize,n=void 0===e?0:e;this.entityCollection.paginationInfo=Object.assign({pageSize:n},this.entityCollection.paginationInfo,this.paginationManager.pagination)},t.prototype.setPaginationInfo=function(t){this.paginationInfo=I({},this.paginationInfo,t)},t}()),ge=(t("DefaultRepository",function(t){function e(){var e=t.call(this)||this;return e.entityManager=new fe(e.entityCollection),e}return M(e,t),e}(de)),t("COMMAND_HANDLER_META","CommandHandlerMeta"));var ve=t("COMMAND_HANDLER_EXTENDER_META","CommandHandlerExtenderMeta");var me,Pe=t("TaskNode",function(){function t(t,e){this.name=t,this.func=e}return t.prototype.execute=function(t){var n=this.func(t);return Wt(n)?n:e(n)},t}()),be=t("VARIABLE_PARSERS",W("@farris/devkit VARIABLE_PARSERS")),Ce=(t("AppOptions",(function(){})),t("BindingDataManager",function(){function t(){this.bindingDataMap=new Map}return t.prototype.getBindingDataMap=function(){return this.bindingDataMap},t.prototype.getBindingDataByName=function(t){return this.bindingDataMap.get(t)},t.prototype.regBindingData=function(t,e){this.bindingDataMap.set(t,e)},t.prototype.ifBindingDataExits=function(t){return!!this.getBindingDataByName(t)},t}())),Ee=t("RepositoryManager",function(){function t(){this.repositoryMap=new Map}return t.prototype.regRepository=function(t,e){this.repositoryMap.set(t,e)},t.prototype.getRepositoryMap=function(){return this.repositoryMap},t.prototype.getRepositories=function(){return Array.from(this.repositoryMap.values())},t.prototype.getRepositoryByName=function(t){return this.repositoryMap.get(t)},t.prototype.ifRepositoryExits=function(t){return!!this.getRepositoryByName(t)},t}()),Me=t("ViewModelContextManager",function(){function t(){this.contextMap=new Map,this.contextSet=new Set}return t.prototype.regContext=function(t){var e=t.id;!0===this.contextMap.has(e)&&this.unregContext(t),this.contextMap.set(e,t),this.contextSet.add(t)},t.prototype.unregContext=function(t){var e=t.id;this.contextMap.delete(e),this.contextSet.delete(t)},t.prototype.getContextMap=function(){return this.contextMap},t.prototype.getContexts=function(){return Array.from(this.contextSet)},t.prototype.getContextById=function(t){return this.contextMap.get(t)},t.prototype.getRootContext=function(){return this.getContexts().find((function(t){return null===t.parent}))},t.prototype.getRootContextAndPosterityById=function(t){var e=this.getContextById(t),n=this.getContexts(),i=[],r=this.getContextsGroupRoot(e);return n.map((function(t){t.parent&&t.parent.id===r&&i.push(t)})),i.push(this.getContextById(r)),i},t.prototype.getContextsGroupRoot=function(t){return t.parent?this.getContextsGroupRoot(t.parent):t.id},t}()),Ie=t("Context",function(){function t(){this.params=new Map}return t.prototype.getParam=function(t){return this.params.get(t)},t.prototype.setParam=function(t,e){this.params.set(t,e)},t}()),we=t("AppContext",function(t){function e(e,n,i,r,o){var a=t.call(this)||this;return a.injector=e,a.eventBus=n,a.repositoryManager=i,a.bindingDataManager=r,a.viewModelContextManager=o,a}return M(e,t),e.prototype.regViewModelContext=function(t){var e=t.repository,n=e.name;if(!1===this.repositoryManager.ifRepositoryExits(n)&&this.repositoryManager.regRepository(n,e),!1===this.bindingDataManager.ifBindingDataExits(n)){var i=Gt.createFromRepository(e,"/");this.bindingDataManager.regBindingData(n,i)}this.viewModelContextManager.regContext(t)},e}(Ie)),xe=t("ViewModelContext",function(){function t(){}return t.prototype.init=function(t){this.innerViewModel=t,this.id=this.innerViewModel.id,this.appContext=t.injector.get(we),this.regToTree(),this.regToAppContext()},t.prototype.regToTree=function(){var e=this.innerViewModel.injector.get(q,null,B.SkipSelf);e?(this.parent=e.get(t,null),this.root=this.parent?this.parent.root:this):(this.parent=null,this.root=this)},t.prototype.regToAppContext=function(){this.appContext.regViewModelContext(this)},Object.defineProperty(t.prototype,"viewModel",{get:function(){return this.innerViewModel},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"injector",{get:function(){return this.innerViewModel.injector},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"repository",{get:function(){return this.innerViewModel.repository},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bindingData",{get:function(){return this.innerViewModel.bindingData},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"uiState",{get:function(){return this.innerViewModel.uiState},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stateMachine",{get:function(){return this.innerViewModel.stateMachine},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"form",{get:function(){return this.innerViewModel.form},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"commandBus",{get:function(){return this.innerViewModel.commandBus},enumerable:!0,configurable:!0}),t}()),Oe=t("UISTATE_PROP_META","UIStatePropMeta"),Se=(t("UIStatePropMeta",Pt(Oe,(function(t){return t}))),t("UIStateMetadataUtil",function(){function t(){}return t.getUIFields=function(t){return Ct.getPropsMetadatasByName(t,Oe)},t}())),De=t("UIState",function(){function t(){this.changes=new o,this.innerData=Object.assign({}),this._init()}return t.prototype._init=function(){var t=this.constructor,e=Se.getUIFields(t);this.initializeUIField(e)},t.prototype.initializeUIField=function(t){var e=this;Object.keys(t).forEach((function(n){var i=t[n].stateName||n;delete e[n]&&e.defineProperty(n,i)}))},t.prototype.isExistProperty=function(t){return!(!this.innerData.hasOwnProperty(t)&&!this.hasOwnProperty(t))},t.prototype.defineProperty=function(t,e){void 0===e&&(e=null),Object.defineProperty(this,t,{get:function(){return null!==e?this.innerData[e]:this.innerData[t]},set:function(n){(null!==e?this.innerData[e]:this.innerData[t])!==n&&(null!==e?this.innerData[e]=n:this.innerData[t]=n,this.changes.next({field:t,value:n}))}})},t.prototype.setPropertyValue=function(t,e){""!==t&&void 0!==t&&(this.isExistProperty(t)||this.defineProperty(t),this[t]=e)},t}()),je=t("State",(function(t){this.name=t})),Te=t("initialUIState",!1),Ne=t("STATE_PROP_META","StatePropMeta"),Ae=(t("StatePropMeta",Pt(Ne,(function(t){return t}))),t("RENDER_STATE_PROP_META","RenderStatePropMeta")),Be=(t("RenderStatePropMeta",Pt(Ae,(function(t){return t}))),t("ACTION_METHOD_META","ActionMethodMeta")),Ve=(t("ActionMethodMeta",Pt(Be,(function(t){return t}))),t("StateMachineContext",function(){function t(t,e){this.stateMachine=t,this.state=e.name}return t.prototype.init=function(t){this.viewModelContext=t,this.parser=this.viewModelContext.injector.get(tn),this.stateMachineWatcher=this.stateMachine.stateMachineWatcher},t.prototype.transitTo=function(t){var e=this.stateMachine.states[t];e&&(this.state=e.name,this.stateMachine.render())},t.prototype.getUIState=function(t){if(t){var e=this.stateMachineWatcher.getViewModelContext(t);if(e){if(this.stateMachineWatcher.subscribeUIStateChange(e,t),this.parser){var n=this.parser.parse(t,e);return null===n||"object"==typeof n&&0===Object.keys(n).length?null:n}throw new Error("未初始化变量解析器。")}}},t.prototype.getData=function(t){if(t){var e=this.stateMachineWatcher.getViewModelContext(t);if(e){if(this.stateMachineWatcher.subscribeEntityChange(e,t),this.parser){var n=this.parser.parse(t,e);return null===n||"object"==typeof n&&0===Object.keys(n).length?null:n}throw new Error("未初始化变量解析器。")}}},t}())),_e=function(){function t(t){this.stateMachine=t,this.uiStatePathList=[],this.dataStatePathList=[],this.viewModelContextAndUIStatePathsMap=new Map,this.viewModelContextAndDataStatePathsMap=new Map}return t.prototype.init=function(t){this.viewModelContext=t},t.prototype.getViewModelContext=function(t){var e=this.extractPaths(t).split("/")[1];return this.viewModelContext.appContext.viewModelContextManager.getContextById(e)},t.prototype.subscribeUIStateChange=function(t,e){var n=this,i=this.getStatePath(e);!1===this.viewModelContextAndUIStatePathsMap.has(t)&&(this.viewModelContextAndUIStatePathsMap.set(t,this.uiStatePathList),t.uiState.changes.subscribe((function(e){var i=n.viewModelContextAndUIStatePathsMap.get(t);e.field&&i.indexOf(e.field)>-1&&n.stateMachine.render()}))),-1===this.viewModelContextAndUIStatePathsMap.get(t).indexOf(i)&&this.uiStatePathList.push(i)},t.prototype.subscribeEntityChange=function(t,e){var n=this;!1===this.viewModelContextAndDataStatePathsMap.has(t)&&(this.viewModelContextAndDataStatePathsMap.set(t,this.dataStatePathList),t.bindingData.changes.subscribe((function(e){"Load"!==e.type&&"SelectionChanged"!==e.type||n.stateMachine.render();var i=n.viewModelContextAndDataStatePathsMap.get(t);e.path.join()&&n.isAccordingPath(i,e.path.join("/"))&&n.stateMachine.render()}))),-1===this.viewModelContextAndDataStatePathsMap.get(t).indexOf(e)&&this.dataStatePathList.push(e)},t.prototype.getStatePath=function(t){return this.extractPaths(t).split("/")[2]},t.prototype.isAccordingPath=function(t,e){return void 0!==t.find((function(t){return t.indexOf(e)>-1}))},t.prototype.extractPaths=function(t){var e,n=t.match(/\{UISTATE~(\S+?)\}/g),i=t.match(/\{DATA~(\S+?)\}/g);if(null!==n){var r=/\{UISTATE~(\S+?)\}/;n.forEach((function(t){var n=t.match(r);null!=n&&2===n.length&&(e=n[1])}))}if(null!==i){var o=/\{DATA~(\S+?)\}/;i.forEach((function(t){var n=t.match(o);null!=n&&2===n.length&&(e=n[1])}))}return e},t}(),Le=t("StateMachine",function(){function t(){this.renderStates={},this.handlePropMetadatas(),this.stateChange=new a(!1),this.context=new Ve(this,this.initialState),this.stateMachineWatcher=new _e(this)}return t.prototype.init=function(t){this.viewModelContext=t,this.context.init(this.viewModelContext),this.stateMachineWatcher.init(this.viewModelContext),this.render()},t.prototype.handlePropMetadatas=function(){var t=this,e=Ct.getPropsMetadatas(this.constructor);if(e&&Object.keys(e).forEach((function(n){e[n].forEach((function(e){t.handlePropMetadata(n,e)}))})),!this.initialState)throw new Error("请在StatePropMeta注解中指定状态机的初始状态。")},t.prototype.handlePropMetadata=function(t,e){switch(e.ngMetadataName){case Ne:this.buildState(t,e);break;case Ae:this.buildRenderState(t,e);break;case Be:this.buildAction(t,e)}},t.prototype.buildState=function(t,e){this.states=this.states||{},this[t]=new je(t),this.states[t]=this[t],e.initialState&&(this.initialState=this[t])},t.prototype.buildRenderState=function(t,e){this.renderStates=this.renderStates||{},this[t]=Te,this.renderStates[t]=this[t],this.renders=this.renders||{},this.renders[t]=e.render},t.prototype.buildAction=function(t,e){var n=this;this[t]=function(){var t=e.transitTo,i=n.states[t];n.context.transitTo(i.name),n.render()}},t.prototype.render=function(){for(var t in this.renderStates)if(!1!==this.renderStates.hasOwnProperty(t)){var e=this.renders[t];e&&(this.renderStates[t]=e(this.context),this[t]=this.renderStates[t])}this.stateChange.next(this.context.state)},t}());!function(t){t.EntityState="EntityState",t.UIState="UIState"}(me||(me=t("BindingType",{})));t("DateStringValueConverter",function(){function t(){}return t.prototype.convertFrom=function(t){return _t.formatISO(t)},t.prototype.convertTo=function(t){return _t.parse(t)},t}()),t("ArrayStringValueConverter",function(){function t(){}return t.prototype.convertFrom=function(t){return t.join(",")},t.prototype.convertTo=function(t){return t.split(",")},t}());var Fe=t("EntityBindingValueAccessor",function(){function t(t,e,n){this.bindingData=t,this.bindingPathSegments=this.getBindingPathSegments(e),this.valueConverter=n}return t.prototype.getValue=function(){var t=this.bindingData.getValue(this.bindingPathSegments);return this.valueConverter?this.valueConverter.convertTo(t):t},t.prototype.setValue=function(t){var e=this.bindingData.getValue(this.bindingPathSegments),n=this.valueConverter?this.valueConverter.convertFrom(t):t;!0===this.isDateConverter(this.valueConverter)&&!0===_t.isEqual(e,n)||this.bindingData.setValue(this.bindingPathSegments,n,!0,!0)},t.prototype.getBindingPathSegments=function(t){var e=kt.toBindingPathArray(this.bindingData.bindingPath);t=t.replace(/\./g,"/");var n=kt.toBindingPathArray(t);return e.concat(n)},t.prototype.isDateConverter=function(t){var e=!1;return t&&!0===t.hasOwnProperty("format")&&(e=!0),e},t}()),ke=t("UIStateBindingValueAccessor",function(){function t(t,e,n){this.uiState=t,this.bindingPathSegments=this.getUiStateBindingPath(e)}return t.prototype.getValue=function(){var t,e=this.uiState;return this.bindingPathSegments.forEach((function(n){t=e[n],e=t})),t},t.prototype.setValue=function(t){var e,n=this.bindingPathSegments.length;if(1===n)this.uiState.setPropertyValue(this.bindingPathSegments,t);else{for(var i=void 0,r=n-1;r>0;r--)(e={})[this.bindingPathSegments[r]]=t,t=i=e;this.uiState.setPropertyValue(this.bindingPathSegments[0],i)}},t.prototype.getUiStateBindingPath=function(t){return-1!==t.search("/")?t.split("/"):[t]},t}()),Re=t("BindingValueAccessorFactory",function(){function t(){}return t.create=function(t,e,n,i){switch(t){case me.EntityState:var r=i.bindingData;return new Fe(r,e,n);case me.UIState:var o=i.uiState;return new ke(o,e,n);default:throw new Error("Not Supported")}},t}()),Ke=t("FORM_CONTROL_PROP_META","FormControlPropMeta"),Ue=(t("FormControlPropMeta",Pt(Ke,(function(t){return t}))),function(){function t(){}return t.create=function(t){var e=this,n=[];return Array.isArray(t)&&t.length>1?t.forEach((function(t){n.push(e.initValidRuleFn(t))})):Array.isArray(t)&&1===t.length?n.push(this.initValidRuleFn(t[0])):n.push(this.initValidRuleFn(t)),n},t.initValidRuleFn=function(t){var e=t.type,n=t.constraints,i=t.message;switch(e){case"required":return function(t){if(!0===n[0])return null==t||""===t?{passing:!1,message:i||"必填"}:{passing:!0,message:""}};case"NumberMaxValue":return function(t){if("number"==typeof t)return n[0]||0==n[0]?t<=parseFloat(n[0])?{passing:!0,message:""}:{passing:!1,message:i||"输入值不能大于"+n[0]}:void 0};case"NumberMinValue":return function(t){if("number"==typeof t)return n[0]||0==n[0]?t>=parseFloat(n[0])?{passing:!0,message:""}:{passing:!1,message:i||"输入值不能小于"+n[0]}:void 0};case"DateMaxValue":return function(t){if(n[0])return _t.isBefore(t,n[0])||_t.isSame(t,n[0])?{passing:!0,message:""}:{passing:!1,message:i||"输入日期不能大于"+n[0]}};case"DateMinValue":return function(t){if(n[0])return _t.isAfter(t,n[0])||_t.isSame(t,n[0])?{passing:!0,message:""}:{passing:!1,message:i||"输入日期不能小于"+n[0]}};case"StringMaxLength":return function(t){if(n[0])return t.length<=n[0]?{passing:!0,message:""}:{passing:!1,message:i||"输入值长度不能大于"+n[0]}};case"StringMinLength":return function(t){if(n[0])return t.length>=n[0]?{passing:!0,message:""}:{passing:!1,message:i||"输入值长度不能小于"+n[0]}};case"regex":return function(t){var e=[];"string"==typeof n[0]&&(e=n[0].split(","));for(var r=0;r<e.length;r++){if(""===e[r])return;return new RegExp(e[r]).test(t)?{passing:!1,message:i||"存在不可输入项"+n[0]}:{passing:!0,message:""}}};case"customFunction":return function(t){if("function"==typeof n[0]){var e=n[0](t);return e?{passing:!1,message:e}:{passing:!0,message:""}}};default:return function(){return{passing:!0,message:""}}}},t.executeValidator=function(t,e){for(var n=0;n<t.length;n++){var i=t[n](e);if(!1===i.passing)return i}return{passing:!0,message:""}},t}()),He=t("FormControl",function(){function t(t,e){this.valueAccessor=Re.create(t.bindingType,t.bindingPath,t.valueConverter,e),this.validatorFn=t.validRules&&Ue.create(t.validRules)}return Object.defineProperty(t.prototype,"value",{get:function(){return this.valueAccessor.getValue()},set:function(t){this.valueAccessor.setValue(t)},enumerable:!0,configurable:!0}),t}()),Ye=t("Form",function(){function t(t){this.viewModelContext=t,this.formControlConfigs=[],this.validateformControls=[],this.validateformControlPathMap=new Map,this.changes=new o}return t.prototype.init=function(){this.collectMetadatas(),this.createFormControls()},t.prototype.validateFields=function(){var t=this,e=[];return 0===this.validateformControls.length||(this.validateformControls.forEach((function(n){t[n].validationResult=Ue.executeValidator(t[n].validatorFn,t[n].value),!t[n].validationResult.passing&&e.push(t[n])})),this.changes.next({type:"validateFieldsFinished"})),e},t.prototype.getFieldError=function(t){if(0===this.validateformControls.length)return{};if(-1===this.validateformControls.findIndex((function(e){return e===t})))return{};var e=Ue.executeValidator(this[t].validatorFn,this[t].value);return this[t].validationResult=e,this.changes.next({type:"validateFieldsFinished",value:t}),e},t.prototype.getFieldErrorByPath=function(t){if(0===this.validateformControls.length)return{};var e=t[0];if(t&&t.length>=2&&(e=t.join(".")),this.validateformControlPathMap.has(e)){var n=Ue.executeValidator(this[this.validateformControlPathMap.get(e)].validatorFn,this[this.validateformControlPathMap.get(e)].value);return this[this.validateformControlPathMap.get(e)].validationResult=n,this.changes.next({type:"validateFieldsFinished",value:this.validateformControlPathMap.get(e)}),n}return{}},t.prototype.resetFieldsValidate=function(t){var e=this;if(0===this.validateformControls.length)return!0;if(t&&t.length>0){new Set(this.validateformControls);var n=new Set(t);this.validateformControls.filter((function(t){return n.has(t)})).forEach((function(t){e[t].validationResult={}}))}else this.validateformControls.forEach((function(t){e[t].validationResult={}}));this.changes.next({type:"validateFieldsFinished"})},t.prototype.createFormControls=function(){var t=this;this.formControlConfigs.forEach((function(e){var n=e.name,i=new He(e,t.viewModelContext);t[n]=i}))},t.prototype.collectMetadatas=function(){var t=this,e=Ct.getPropsMetadatasByName(this.constructor,Ke);Object.keys(e).forEach((function(n){var i=e[n];i.validRules&&(t.validateformControls.push(n),t.validateformControlPathMap.set(i.bindingPath,n));var r={name:n,bindingType:i.bindingType,bindingPath:i.bindingPath,valueConverter:i.valueConverter,valueChanging:i.valueChanging,valueChanged:i.valueChanged,validRules:i.validRules};t.formControlConfigs.push(r)}))},t.prototype.getEntityValueChangingListeners=function(){var t={};return this.formControlConfigs.forEach((function(e){e.valueChanging&&(t[e.bindingPath]=e.valueChanging)})),t},t.prototype.getEntityValueChangedListeners=function(){var t={};return this.formControlConfigs.forEach((function(e){e.valueChanged&&(t[e.bindingPath]=e.valueChanged)})),t},t}()),ze=t("COMMAND_METHOD_META","CommandMethodMeta"),Je=(t("CommandMethodMeta",Pt(ze,(function(t){return t}))),t("ViewModel",function(){function t(t,e){this.injector=t,this.id=e}return t.prototype.init=function(){this.initRepository(),this.initContext(),this.initBindingData(),this.initUIState(),this.intiStateMachine(),this.initForm(),this.initCommandBus(),this.registerWithParent(),this.initListeners(),this.closeOldBeSession()},t.prototype.initRepository=function(){this.repository=this.injector.get(de)},t.prototype.initContext=function(){this.context=this.injector.get(xe),this.context.init(this)},t.prototype.initBindingData=function(){var t=this;this.bindingData=this.context.injector.get(Jt),this.entityValueChangingListeners=new Map,this.entityValueChangedListeners=new Map,this.bindingData&&this.bindingData.setValueChangeInvokerFactory((function(i){return function(o,a,s,u){var f,l="/"+i.join("/");if(f=!1===s?t.entityValueChangingListeners[l]:t.entityValueChangedListeners[l]){var y={paths:i,preValue:o,value:a,changed:s},d=f.split(";").filter((function(t){return t})),g=!0;return n(d).pipe(p((function(e){return g?t[e](y).pipe(c((function(t){g=t}))):r})),h((function(t){return t})))}return e(!0)}}));var i=this.repository.name,o=this.context.appContext.bindingDataManager.getBindingDataByName(i);this.bindingData.initByBindingList(o.list,this.context)},t.prototype.initUIState=function(){this.uiState=this.injector.get(De)},t.prototype.intiStateMachine=function(){this.stateMachine=this.injector.get(Le,null),this.stateMachine&&this.stateMachine.init(this.context)},t.prototype.initForm=function(){this.form=this.injector.get(Ye,null),this.form.init()},t.prototype.initCommandBus=function(){this.commandBus=this.injector.get(hn),this.extendCommandMethods()},t.prototype.extendCommandMethods=function(){var t=this;this.ngCommands=Ct.getPropsMetadatasByName(this.constructor,ze),this.keybindingMap=new Map,Object.keys(this.ngCommands).forEach((function(e){var n=t.ngCommands[e];Object.defineProperty(t,e,{value:function(e){var i={name:n.name,params:n.params,paramDescriptions:n.paramDescriptions,eventParam:e||null};return t.commandBus.dispatch(i)}}),n.keyBinding&&t.keybindingMap.set(e,n.keyBinding)}))},t.prototype.registerWithParent=function(){var t=this.context.parent;if(t&&t.viewModel&&t.viewModel.childViewModels){var e=t.viewModel,n=this.constructor.name;e[e.childViewModels[n]]=this}},t.prototype.closeOldBeSession=function(){var t=this.context.appContext.viewModelContextManager.getContexts();1===t.length&&t[0]===this.context&&this.context.repository.reset()},t.prototype.initListeners=function(){var t=this,e=function(t,e){return"/"+t.split("/").concat(e.split(".")).filter((function(t){return t.length>0})).join("/")};if(this.form){var n=this.form.getEntityValueChangingListeners();Object.keys(n).forEach((function(i){var r=e(t.bindingPath,i);t.entityValueChangingListeners[r]=n[i]}));var i=this.form.getEntityValueChangedListeners();Object.keys(i).forEach((function(n){var r=e(t.bindingPath,n);t.entityValueChangedListeners[r]=i[n]}))}},t}())),Ge=(t("ViewModelOptions",(function(){})),t("ɵb",function(){function t(){this.eventBus=new o,this.subscriptionsMap=new Map}return t.prototype.triggerEvent=function(t){this.eventBus.next(t)},t.prototype.subscribe=function(t,e,n){if(!1===this.subscriptionsMap.has(t)){var i=this.eventBus.subscribe((function(t){return e(t)}),(function(t){return n(t)}));this.subscriptionsMap.set(t,i)}},t.prototype.unsubscribe=function(t){!0===this.subscriptionsMap.has(t)&&(this.subscriptionsMap.get(t).unsubscribe(),this.subscriptionsMap.delete(t))},t}())),We=[{provide:Ge,useClass:Ge,deps:[]},{provide:Ce,useClass:Ce,deps:[]},{provide:Ee,useClass:Ee,deps:[]},{provide:Me,useClass:Me,deps:[]},{provide:we,useClass:we,deps:[q,Ge,Ee,Ce,Me]}],qe=(t("App",function(){function t(t){t.providers=t.providers||[];var e=lt(S(We,en,It,t.providers));this.context=e.get(we)}return t.prototype.createViewModel=function(t){var e=t.providers||[],n=t.parent||null,i=lt(S([{provide:xe,useClass:xe,deps:[]}],fn,e),n?n.injector:this.context.injector).get(Je);return i.init(),i},t}()),function(){function t(){}return t.getAppContext=function(t){if(t instanceof on)return t.viewModelContext.appContext;if(t instanceof xe)return t.appContext;if(t instanceof we)return t;throw new Error("上下文中找不到AppContext，请检查！")},t.getFrameContext=function(t){if(t instanceof on)return t.viewModelContext;if(t instanceof xe)return t;throw new Error("上下文中找不到FrameContext，请检查！")},t.getRootFrameContext=function(t){return this.getFrameContext(t).root},t.getFrameContextById=function(t,e){return this.getAppContext(t).viewModelContextManager.getContextById(e)},t}()),$e=t("DataVariableParser",function(){function t(){}return t.prototype.parse=function(t,e){var n=this,i=qe.getAppContext(e),r=this.extractPaths(t);return 1===r.length&&t==="{DATA~"+r[0]+"}"?this.getValue(r[0],i):(r.forEach((function(e){var r="{DATA~"+e+"}",o=n.getValue(e,i);t=t.replace(r,o)})),t)},t.prototype.extractPaths=function(t){var e=[],n=t.match(/\{DATA~(\S+?)\}/g);if(null===n)return[];var i=/\{DATA~(\S+?)\}/;return n.forEach((function(t){var n=t.match(i);null!=n&&2===n.length&&e.push(n[1])})),e},t.prototype.getValue=function(t,e){var n=t.split("/").filter((function(t){return""!==t})),i=e.viewModelContextManager.getContextById(n[0]);if(!i)throw new Error(t+"不正确，请检查！");var r=i.bindingData;if(!r)throw new Error(t+"不正确，请检查！");return r.getValue(n.slice(1))},t}()),Qe=t("UIStateVariableParser",function(){function t(){}return t.prototype.parse=function(t,e){var n=this,i=qe.getAppContext(e),r=this.extractPaths(t);return 1===r.length&&t==="{UISTATE~"+r[0]+"}"?this.getUIState(r[0],i):(r.forEach((function(e){var r="{UISTATE~"+e+"}",o=n.getUIState(e,i);t=t.replace(r,o)})),t)},t.prototype.extractPaths=function(t){var e=[],n=t.match(/\{UISTATE~(\S+?)\}/g);if(null===n)return[];var i=/\{UISTATE~(\S+?)\}/;return n.forEach((function(t){var n=t.match(i);null!=n&&2===n.length&&e.push(n[1])})),e},t.prototype.getUIState=function(t,e){var n=t.split("/").filter((function(t){return""!==t})),i=O(n,2),r=i[0],o=i[1],a=e.viewModelContextManager.getContextById(r).uiState[o];if(a&&a.constructor.toString().startsWith("function Date()"))return this.formatDate(a);for(var s=2;s<n.length;s++)if(!(a=a[n[s]]))return a;return a},t.prototype.formatDate=function(t){if(!t)return"";var e=t.getFullYear(),n=(t.getMonth()+1).toString();n=1===n.length?"0"+n:n;var i=t.getDate().toString();return e+"-"+n+"-"+(i=1===i.length?"0"+i:i)},t}()),Xe=t("StateMachineVariableParser",function(){function t(){}return t.prototype.parse=function(t,e){var n=this,i=this.extractPaths(t);return 1===i.length&&t==="{STATEMACHINE~"+i[0]+"}"?this.getValue(i[0],e):(i.forEach((function(i){var r="{STATEMACHINE~"+i+"}",o=n.getValue(i,e);t=t.replace(r,o)})),t)},t.prototype.extractPaths=function(t){var e=[],n=t.match(/\{STATEMACHINE~(\S+?)\}/g);if(null===n)return[];var i=/\{STATEMACHINE~(\S+?)\}/;return n.forEach((function(t){var n=t.match(i);null!=n&&2===n.length&&e.push(n[1])})),e},t.prototype.getValue=function(t,e){var n=this.getPathObj(t),i=this.getTargetStateMachine(n.frameId,e);if("currentState"===n.type)return i.context.state;if("renderStates"===n.type)return i[n.name];throw new Error("不支类型为"+n.type+"的状态机变量")},t.prototype.getTargetStateMachine=function(t,e){var n;if(!(n=t?qe.getFrameContextById(e,t):qe.getRootFrameContext(e))||!n.stateMachine)throw new Error("找不到对应的状态机实例，请检查！");return n.stateMachine},t.prototype.getPathObj=function(t){var e=this.splitPath(t);return"currentState"===e[0]||"renderStates"===e[0]?{frameId:"",type:e[0],name:e[1]}:{frameId:e[0],type:e[1],name:e[2]}},t.prototype.splitPath=function(t){return t.split("/").filter((function(t){return""!==t}))},t}()),Ze=t("CommandVariableParser",function(){function t(){}return t.prototype.parse=function(t,e){var n=this,i=this.extractPaths(t);return 1===i.length&&t==="{COMMAND~"+i[0]+"}"?this.getValue(i[0],e):(i.forEach((function(i){var r="{COMMAND~"+i+"}",o=n.getValue(i,e);t=t.replace(r,o)})),t)},t.prototype.extractPaths=function(t){var e=[],n=t.match(/\{COMMAND~(\S+?)\}/g);if(null===n)return[];var i=/\{COMMAND~(\S+?)\}/;return n.forEach((function(t){var n=t.match(i);null!=n&&2===n.length&&e.push(n[1])})),e},t.prototype.getValue=function(t,e){if(e instanceof on==!1)throw new Error("当前上下文不支持COMMAND变量，请检查！");var n=O(t.split("/").filter((function(t){return""!==t})),2),i=n[0],r=n[1];return"params"===i?e.command.params[r]:"results"===i?e.results[r]:void 0},t}()),tn=t("VariableParseService",function(){function t(t){this.parsers=t}return t.prototype.parse=function(t,e){var n=this;if("string"==typeof t&&t.length>0)return this.parseExpression(t,e);if(Array.isArray(t))t.forEach((function(i,r){t[r]="string"==typeof i?n.parseExpression(i,e):n.parse(i,e)}));else if("object"==typeof t&&null!==t){Object.keys(t).forEach((function(i){"string"==typeof t[i]?t[i]=n.parseExpression(t[i],e):t[i]=n.parse(t[i],e)}))}return t},t.prototype.evaluate=function(t,e){var n=this.parse(t,e);return new Function("return "+n)()},t.prototype.parseExpression=function(t,e){return""===t?"":(this.parsers.forEach((function(n){"string"==typeof t&&(t=n.parse(t,e))})),t)},t}()),en=t("APP_VARIABLE_PROVIDERS",[{provide:be,useClass:$e,multi:!0,deps:[]},{provide:be,useClass:Qe,multi:!0,deps:[]},{provide:be,useClass:Xe,multi:!0,deps:[]},{provide:be,useClass:Ze,multi:!0,deps:[]},{provide:tn,useClass:tn,deps:[be]}]),nn=t("TaskLink",function(){function t(t,e,n){this.from=t,this.to=e,this.condition=n}return t.prototype.canLink=function(t){var e;switch(typeof this.condition){case"boolean":e=this.condition;break;case"function":e=this.condition(t);break;case"string":e=t.viewModelContext.injector.get(tn).evaluate(this.condition,t);break;default:e=!1}return e},t}()),rn=t("TaskFlow",function(){function t(){this.nodes=[],this.links=[]}return t.prototype.addNode=function(t,e){var n=new Pe(t,e);this.nodes.push(n)},t.prototype.addNodes=function(t){this.nodes=this.nodes.concat(t)},t.prototype.insertNode=function(t,e,n){var i=this.findNodeIndex(t),r=this.createNode(e,n);this.nodes.splice(i,0,r)},t.prototype.appendNode=function(t,e,n){var i=this.findNodeIndex(t)+1,r=this.createNode(e,n);this.nodes.splice(i,0,r)},t.prototype.findNodeIndex=function(t){return this.nodes.findIndex((function(e){return e.name===t}))},t.prototype.createNode=function(t,e){return new Pe(t,e)},t.prototype.addLink=function(t,e,n){var i=this.createLink(t,e,n);this.links.push(i)},t.prototype.addLinks=function(t){this.links=this.links.concat(t)},t.prototype.createLink=function(t,e,n){return new nn(t,e,n)},t.prototype.getNext=function(t,e){if(!t)return this.nodes.shift();var n=this.links.find((function(n){return n.from===t&&n.canLink(e)}));return n?this.nodes.find((function(t){return t.name===n.to})):void 0},t.prototype.clone=function(){var e=new t;return e.addNodes(this.nodes),e.addLinks(this.links),e},t}()),on=t("CommandContext",(function(t,e){this.results={},this.command=t,this.viewModelContext=e})),an=(t("CommandHandler",function(){function t(){}return t.prototype.init=function(t){this.viewModelContext=t,this.parseService=t.injector.get(tn),this.taskFlow=new rn,this.schedule()},t.prototype.execute=function(t){var e=this,n=new o,i=this.taskFlow.clone();return setTimeout((function(){var r=I({},t).eventParam,o=void 0===r?null:r;delete t.eventParam;var s=JSON.parse(JSON.stringify(t));s.params=e.parseService.parse(s.params,e.viewModelContext),t.eventParam=o,s.eventParam=o;var c=new on(s,e.viewModelContext);c.eventParams=t.eventParam||null;var h=new a(c),d=i.getNext("",c);h.pipe(p((function(t){return d.execute(t).pipe(f(1),u((function(e){return t.results[d.name]=e,t.latestResult=e,(d=i.getNext(d.name,t))?h.next(t):h.complete(),t})),l((function(){h.complete()})))}))).pipe(y(1)).subscribe({next:function(t){n.next(t.latestResult)},error:function(t){e.displayError(t),n.error(t)},complete:function(){n.complete()}})}),0),n},t.prototype.displayError=function(t){t&&console&&console.error&&console.error(t)},t.prototype.addTask=function(t,e){this.taskFlow.addNode(t,e)},t.prototype.addLink=function(t,e,n){this.taskFlow.addLink(t,e,n)},t.prototype.insertTask=function(t,e,n){throw new Error("Not Implemented")},t.prototype.afterTask=function(t,e,n){throw new Error("Not Implemented")},t.prototype.replaceTask=function(t,e){throw new Error("Not Implement")},t.prototype.invoke=function(t,e,n,i){this.setContextToServiceInstance(t,i);var r=this.parseService.parse(n,i);return t[e].apply(t,S(r))},t.prototype.setContextToServiceInstance=function(t,e){var n=t.context;n&&n instanceof on==!1||(t.context=e)},t}()),t("COMMAND_HANDLERS_TOKEN",W("@Farris/devkit COMMAND_HANDLERS_TOKEN"))),sn=t("CommandHandlerRegistry",function(){function t(t){var e=this;this.injector=t;var n=this.injector.get(an,null,B.Optional);this.handlerMap=new Map,n&&n.forEach((function(t){e.regist(t)}))}return t.prototype.set=function(t,e){if(this.handlerMap.has(t))throw new Error(t+"对应的CommandHandler已经存在");this.handlerMap.set(t,e)},t.prototype.get=function(t){if(!1===this.handlerMap.has(t))throw new Error("找不到"+t+"对应的CommandHandler");return this.handlerMap.get(t)},t.prototype.regist=function(t){var e=Ct.getClassMetadataByName(t.constructor,ge);if(!e)throw new Error("CommandHandler必须指定要处理的命令名称");var n=e.commandName;this.set(n,t)},t}()),un=(t("CommandHandlerExtender",(function(){})),t("COMMAND_HANDLER_EXTENDERS_TOKEN",W("@farris/devkit COMMAND_HANDLER_EXTENDERS_TOKEN"))),pn=t("CommandHandlerExtenderRegistry",function(){function t(t){var e=this;this.injector=t;var n=this.injector.get(un,null,B.Optional);this.extendersMap=new Map,n&&n.forEach((function(t){e.regist(t)}))}return t.prototype.get=function(t){return!1===this.extendersMap.has(t)?[]:this.extendersMap.get(t)},t.prototype.set=function(t,e){this.extendersMap.has(t)?this.extendersMap.get(t).push(e):this.extendersMap.set(t,[e])},t.prototype.regist=function(t){var e=Ct.getClassMetadataByName(t.constructor,ve);if(!e)throw new Error("CommandHandlerExtender必须指定要扩展的命令名称");var n=e.commandName;this.set(n,t)},t}()),cn=t("CommandHandlerFactory",function(){function t(t,e,n){this.handlerRegistry=t,this.extenderRegistry=e,this.viewModelContext=n}return t.prototype.create=function(t){var e=this.handlerRegistry.get(t);return e.init(this.viewModelContext),this.extenderRegistry.get(t).reduce((function(t,e){return e.extend(t)}),e)},t}()),hn=t("CommandBus",function(){function t(t){this.handlerFactory=t,this.executingCommands=[],this.executingCommandCount$=new a(this.executingCommands.length)}return t.prototype.dispatch=function(t){var e=this,n=new o;return this.executeCommand(t).subscribe({next:function(t){n.next(t),n.complete()},complete:function(){n.complete(),e.removeCommandFromExecutingQueue(t)},error:function(i){n.error(i),e.removeCommandFromExecutingQueue(t)}}),n},t.prototype.executeCommand=function(t){this.addCommandToExecutingQueue(t);var e=t.name;return this.handlerFactory.create(e).execute(t)},t.prototype.addCommandToExecutingQueue=function(t){this.executingCommands.push(t),this.executingCommandCount$.next(this.executingCommands.length)},t.prototype.removeCommandFromExecutingQueue=function(t){this.executingCommands=this.executingCommands.filter((function(e){return e!==t})),this.executingCommandCount$.next(this.executingCommands.length)},t}()),fn=t("VIEW_MODEL_COMMAND_PROVIDERS",[{provide:sn,useClass:sn,deps:[q]},{provide:pn,useClass:pn,deps:[q]},{provide:cn,useClass:cn,deps:[sn,pn,xe]},{provide:hn,useClass:hn,deps:[cn]}]);t("EXCEPTION_HANDLER","@farris/devkit ExceptionHandler")}}}));
