/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
/*
 * @Author: 疯狂秀才(Lucas Huang)
 * @Date: 2019-08-06 07:43:53
 * @LastEditors: 疯狂秀才(Lucas Huang)
 * @LastEditTime: 2019-11-20 07:39:45
 * @QQ: 1055818239
 * @Version: v0.0.1
 */
import { Injectable, EventEmitter } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { BehaviorSubject, of, Subject } from 'rxjs';
import { map, distinctUntilChanged, filter, switchMap } from 'rxjs/operators';
import { CalculationType } from '../types';
import { initDataGridState, ROW_INDEX_FIELD, IS_GROUP_ROW_FIELD, GROUP_ROW_FIELD, IS_GROUP_FOOTER_ROW_FIELD, GROUP_VISIBLE_FIELD, GROUP_LEVEL_FIELD } from './state';
import { cloneDeep, groupBy, isPlainObject, flatten } from 'lodash-es';
import { Utils } from '../utils/utils';
import { DatagridColumnsHelper } from './datagrid-columns.helper';
import { BigNumber } from 'bignumber.js';
var DatagridFacadeService = /** @class */ (function () {
    function DatagridFacadeService(http) {
        this.http = http;
        this.localId = 'zh-CHS';
        // public virtualizedService: VirtualizedLoaderService;
        this.store = new BehaviorSubject(null);
        this.virtualRowSubject = new BehaviorSubject(null);
        this.gridSizeSubject = new Subject();
        this.errorSubject = new Subject();
        this.selectRowSubject = new Subject();
        this.unSelectRowSubject = new Subject();
        this.columnResizeSubject = new Subject();
        this.clearSelectionSubject = new Subject();
        this.checkRowSubject = new Subject();
        this.unCheckRowSubject = new Subject();
        this.clearCheckedsSubject = new Subject();
        this.clearAllSubject = new Subject();
        this.checkAllSubject = new Subject();
        this.unCheckAllSubject = new Subject();
        this.selectAllSubject = new Subject();
        this.selectCellSubject = new Subject();
        this.error$ = this.errorSubject.asObservable();
        this.selectRow$ = this.selectRowSubject.asObservable();
        this.unSelectRow$ = this.unSelectRowSubject.asObservable();
        this.columnResize$ = this.columnResizeSubject.asObservable();
        this.clearSelections$ = this.clearSelectionSubject.asObservable();
        this.checkRow$ = this.checkRowSubject.asObservable();
        this.unCheckRow$ = this.unCheckRowSubject.asObservable();
        this.clearCheckeds$ = this.clearCheckedsSubject.asObservable();
        this.clearAll$ = this.clearAllSubject.asObservable();
        this.checkAll$ = this.checkAllSubject.asObservable();
        this.unCheckAll$ = this.unCheckAllSubject.asObservable();
        this.selectAll$ = this.selectAllSubject.asObservable();
        this.currentCell$ = this.selectCellSubject.asObservable();
        this.editCell$ = new EventEmitter();
        this.clientSort$ = new EventEmitter();
        this.rowAppend$ = new EventEmitter();
        this.rowUpdate$ = new EventEmitter();
        this.rowDelete$ = new EventEmitter();
        this.updateCheckboxState$ = new EventEmitter();
        this.state$ = this.store.asObservable().pipe(filter((/**
         * @param {?} state
         * @return {?}
         */
        function (state) { return state; })));
        this.columnGroup$ = this.gridSizeSubject.asObservable().pipe(filter((/**
         * @param {?} state
         * @return {?}
         */
        function (state) { return state; })), map((/**
         * @param {?} state
         * @return {?}
         */
        function (state) { return state.columnsGroup; })), switchMap((/**
         * @param {?} colgroup
         * @return {?}
         */
        function (colgroup) {
            return of(colgroup);
        })), distinctUntilChanged());
        this.gridSize$ = this.gridSizeSubject.asObservable().pipe(filter((/**
         * @param {?} state
         * @return {?}
         */
        function (state) { return state; })), map((/**
         * @param {?} state
         * @return {?}
         */
        function (state) {
            var _a = tslib_1.__assign({}, state), headerHeight = _a.headerHeight, pagerHeight = _a.pagerHeight, width = _a.width, columnsGroup = _a.columnsGroup, height = _a.height, rowHeight = _a.rowHeight;
            return { headerHeight: headerHeight, pagerHeight: pagerHeight, width: width, columnsGroup: columnsGroup, height: height, rowHeight: rowHeight };
        })), distinctUntilChanged());
        this.data$ = this.virtualRowSubject.pipe(filter((/**
         * @param {?} vs
         * @return {?}
         */
        function (vs) { return vs; })), switchMap((/**
         * @param {?} vs
         * @return {?}
         */
        function (vs) {
            return of({
                index: vs.startIndex || 0,
                rows: vs.virtualRows || [],
                top: vs.topHideHeight,
                bottom: vs.bottomHideHeight,
                scrolling: vs.isScrollChange
            });
        })), distinctUntilChanged());
        this.difference = (/**
         * @param {?} first
         * @param {?} second
         * @return {?}
         */
        function (first, second) { return first.filter((/**
         * @param {?} item
         * @return {?}
         */
        function (item) { return !second.includes(item); })); });
        this.differenceBy = (/**
         * @param {?} a
         * @param {?} b
         * @param {?} fn
         * @return {?}
         */
        function (a, b, fn) {
            /** @type {?} */
            var s = new Set(b.map(fn));
            return a.map(fn).filter((/**
             * @param {?} el
             * @return {?}
             */
            function (el) { return !s.has(el); }));
        });
        this._state = cloneDeep(initDataGridState);
    }
    /**
     * @param {?} scrolltop
     * @param {?=} isScrollChange
     * @return {?}
     */
    DatagridFacadeService.prototype.updateVirthualRows = /**
     * @param {?} scrolltop
     * @param {?=} isScrollChange
     * @return {?}
     */
    function (scrolltop, isScrollChange) {
        if (isScrollChange === void 0) { isScrollChange = false; }
        /** @type {?} */
        var virtual = this.getVirthualRows(scrolltop);
        virtual.isScrollChange = isScrollChange;
        this.updateState({ virtual: virtual }, false);
        this.virtualRowSubject.next(virtual);
    };
    /**
     * @param {?} scrolltop
     * @return {?}
     */
    DatagridFacadeService.prototype.getVirthualRows = /**
     * @param {?} scrolltop
     * @return {?}
     */
    function (scrolltop) {
        if (scrolltop === undefined) {
            scrolltop = 0;
        }
        /** @type {?} */
        var data = this._state.data || [];
        /** @type {?} */
        var virtual = { rowIndex: 0, virtualRows: data, topHideHeight: 0, bottomHideHeight: 0 };
        if (data.length === 0 || (this._state.autoHeight && !this._state.groupRows)) {
            virtual.virtualRows = data;
            return virtual;
        }
        if (this._state.flatColumns && this._state.flatColumns.length) {
            // data = this._state.data;
            // if (!this._state.groupRows) {
            //     if (this._state.virtual && this._state.virtualized) {
            //         this.virtualizedService.state = this._state;
            //         const rows = this.virtualizedService.getRows(scrolltop);
            //         virtual = { ...this._state.virtual, ...rows };
            //     } else {
            //         virtual.virtualRows = data;
            //     }
            // } else {
            //     // 行分组数据处理
            //     const groupRows = this.groupRows2(cloneDeep(data));
            //     virtual.virtualRows = groupRows;
            // }
            if (this._state.groupRows) {
                // 行分组数据处理
                /** @type {?} */
                var groupRows = this.groupRows2(cloneDeep(data));
                virtual.virtualRows = groupRows;
            }
        }
        if (this._state.mergeCell && this._state.enableClientSortForMergeCell) {
            virtual.virtualRows = this.sort(virtual.virtualRows);
        }
        return virtual;
    };
    // getDeltaTopHeight(scrolTop, firstIndex) {
    //     const {rowsLength: viewRowsCount, top, bottom} = this.virtualizedService.getRowsCount(scrolTop, this._state.pageSize, firstIndex);
    //     const gridContainerRowsCount = this.virtualizedService.displayRowsCount();
    //     let deltaTopHeight = 0;
    //     if (viewRowsCount < gridContainerRowsCount) {
    //         deltaTopHeight = (gridContainerRowsCount - viewRowsCount) * this._state.rowHeight - this._state.headerHeight;
    //     }
    //     return deltaTopHeight;
    // }
    // getDeltaTopHeight(scrolTop, firstIndex) {
    //     const {rowsLength: viewRowsCount, top, bottom} = this.virtualizedService.getRowsCount(scrolTop, this._state.pageSize, firstIndex);
    //     const gridContainerRowsCount = this.virtualizedService.displayRowsCount();
    //     let deltaTopHeight = 0;
    //     if (viewRowsCount < gridContainerRowsCount) {
    //         deltaTopHeight = (gridContainerRowsCount - viewRowsCount) * this._state.rowHeight - this._state.headerHeight;
    //     }
    //     return deltaTopHeight;
    // }
    /**
     * @param {?=} original
     * @return {?}
     */
    DatagridFacadeService.prototype.getData = 
    // getDeltaTopHeight(scrolTop, firstIndex) {
    //     const {rowsLength: viewRowsCount, top, bottom} = this.virtualizedService.getRowsCount(scrolTop, this._state.pageSize, firstIndex);
    //     const gridContainerRowsCount = this.virtualizedService.displayRowsCount();
    //     let deltaTopHeight = 0;
    //     if (viewRowsCount < gridContainerRowsCount) {
    //         deltaTopHeight = (gridContainerRowsCount - viewRowsCount) * this._state.rowHeight - this._state.headerHeight;
    //     }
    //     return deltaTopHeight;
    // }
    /**
     * @param {?=} original
     * @return {?}
     */
    function (original) {
        if (original === void 0) { original = false; }
        if (original) {
            return this._state.originalData || [];
        }
        return this._state.data || [];
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.getState = /**
     * @return {?}
     */
    function () {
        return this._state;
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.getVirtualState = /**
     * @return {?}
     */
    function () {
        return this._state.virtual;
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.getPageInfo = /**
     * @return {?}
     */
    function () {
        var _a = tslib_1.__assign({}, this._state), pageIndex = _a.pageIndex, pageSize = _a.pageSize;
        return { pageIndex: pageIndex, pageSize: pageSize };
    };
    /**
     * @param {?} state
     * @return {?}
     */
    DatagridFacadeService.prototype.initState = /**
     * @param {?} state
     * @return {?}
     */
    function (state) {
        this.updateState(state, false);
        this._state.originalData = cloneDeep(this._state.data);
        this.initColumns();
        this.gridSizeSubject.next(this._state);
        this.updateVirthualRows(0);
    };
    /** 加载数据
     * @param data: 数据列表
     * @param updateOriginalData 是否更新原始数据, 默认为 true
     */
    /**
     * 加载数据
     * @param {?} data
     * @param {?=} updateOriginalData 是否更新原始数据, 默认为 true
     * @param {?=} sortable
     * @return {?}
     */
    DatagridFacadeService.prototype.loadData = /**
     * 加载数据
     * @param {?} data
     * @param {?=} updateOriginalData 是否更新原始数据, 默认为 true
     * @param {?=} sortable
     * @return {?}
     */
    function (data, updateOriginalData, sortable) {
        if (updateOriginalData === void 0) { updateOriginalData = true; }
        if (sortable === void 0) { sortable = false; }
        data = data || [];
        this.updateState({ data: data }, false);
        if (updateOriginalData) {
            this._state.originalData = cloneDeep(this._state.data);
        }
        if (sortable && this._state.sortName) {
            /** @type {?} */
            var sortedData = this.sort(this._state.data);
            this.updateState({ data: sortedData }, false);
        }
        else {
            // this.updateState({ data: this._state.originalData }, false);
        }
        this.updateVirthualRows(this._state.virtual.scrollTop || 0);
    };
    /** 复原指定行的数据 */
    /**
     * 复原指定行的数据
     * @param {?} rowId
     * @return {?}
     */
    DatagridFacadeService.prototype.resetRow = /**
     * 复原指定行的数据
     * @param {?} rowId
     * @return {?}
     */
    function (rowId) {
        var _this = this;
        /** @type {?} */
        var origData = this._state.originalData;
        if (origData) {
            /** @type {?} */
            var origRowData = origData.find((/**
             * @param {?} r
             * @return {?}
             */
            function (r) { return _this.primaryId(r) === rowId; }));
            this.getCurrentRow().data = cloneDeep(origRowData);
            this.updateRow(rowId, origRowData);
        }
    };
    // loadDataForVirtual(data: any) {
    //     this.updateState({ data }, false);
    //     // this.virtualizedService.state = this._state;
    //     const virtual = { ...this._state.virtual, ...this.virtualizedService.reload() };
    //     this.virtualRowSubject.next(virtual);
    //     this.updateState({virtual});
    // }
    // loadDataForVirtual(data: any) {
    //     this.updateState({ data }, false);
    //     // this.virtualizedService.state = this._state;
    //     const virtual = { ...this._state.virtual, ...this.virtualizedService.reload() };
    //     this.virtualRowSubject.next(virtual);
    //     this.updateState({virtual});
    // }
    /**
     * @param {?} url
     * @return {?}
     */
    DatagridFacadeService.prototype.fetchData = 
    // loadDataForVirtual(data: any) {
    //     this.updateState({ data }, false);
    //     // this.virtualizedService.state = this._state;
    //     const virtual = { ...this._state.virtual, ...this.virtualizedService.reload() };
    //     this.virtualRowSubject.next(virtual);
    //     this.updateState({virtual});
    // }
    /**
     * @param {?} url
     * @return {?}
     */
    function (url) {
        return this.http.get(url).pipe(map((/**
         * @param {?} r
         * @return {?}
         */
        function (r) { return (/** @type {?} */ (r)); })));
    };
    /**
     * @param {?} total
     * @return {?}
     */
    DatagridFacadeService.prototype.setTotal = /**
     * @param {?} total
     * @return {?}
     */
    function (total) {
        this.updateState({ total: total }, false);
    };
    /**
     * @param {?} property
     * @param {?} value
     * @return {?}
     */
    DatagridFacadeService.prototype.updateProperty = /**
     * @param {?} property
     * @param {?} value
     * @return {?}
     */
    function (property, value) {
        var _a;
        this.updateState((_a = {}, _a[property] = value, _a), false);
    };
    /**
     * @param {?} pageIndex
     * @param {?} pageSize
     * @param {?} total
     * @return {?}
     */
    DatagridFacadeService.prototype.setPagination = /**
     * @param {?} pageIndex
     * @param {?} pageSize
     * @param {?} total
     * @return {?}
     */
    function (pageIndex, pageSize, total) {
        this.updateState({ pageIndex: pageIndex, pageSize: pageSize, total: total }, false);
    };
    /**
     * @param {?} scrollTop
     * @return {?}
     */
    DatagridFacadeService.prototype.setScrollTop = /**
     * @param {?} scrollTop
     * @return {?}
     */
    function (scrollTop) {
        /** @type {?} */
        var virtual = tslib_1.__assign({}, this._state.virtual, { scrollTop: scrollTop });
        this.updateState({ virtual: virtual }, false);
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.isMultiSelect = /**
     * @return {?}
     */
    function () {
        return this._state.multiSelect;
    };
    /**
     * @private
     * @param {?} id
     * @return {?}
     */
    DatagridFacadeService.prototype._isRowSelected = /**
     * @private
     * @param {?} id
     * @return {?}
     */
    function (id) {
        if (!id || !this._state.currentRow) {
            return false;
        }
        else {
            return this._state.currentRow.id.toString() === id.toString();
        }
    };
    /**
     * @param {?} id
     * @param {?=} selections
     * @return {?}
     */
    DatagridFacadeService.prototype.isRowSelected = /**
     * @param {?} id
     * @param {?=} selections
     * @return {?}
     */
    function (id, selections) {
        if (selections === void 0) { selections = null; }
        /** @type {?} */
        var flag = this._isRowSelected(id);
        if (!this.isMultiSelect() || this._state.onlySelectSelf) {
            return flag;
        }
        else {
            if (!selections) {
                selections = this._state.selections;
            }
            if (this._canCancelSelectWhenMulti()) {
                return flag;
            }
            if (!selections || selections.length === 0) {
                return false;
            }
            else {
                return selections.findIndex((/**
                 * @param {?} sr
                 * @return {?}
                 */
                function (sr) { return sr.id == id; })) > -1;
            }
        }
    };
    /**
     * @param {?} id
     * @param {?=} checkeds
     * @return {?}
     */
    DatagridFacadeService.prototype.isRowChecked = /**
     * @param {?} id
     * @param {?=} checkeds
     * @return {?}
     */
    function (id, checkeds) {
        if (checkeds === void 0) { checkeds = null; }
        if (!checkeds) {
            checkeds = this.getCheckeds();
        }
        if (!id || !checkeds.length) {
            return false;
        }
        return checkeds.findIndex((/**
         * @param {?} sr
         * @return {?}
         */
        function (sr) { return sr.id.toString() === id.toString(); })) > -1;
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.isCheckAll = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var allRows = this.getAllRowsForLive().map((/**
         * @param {?} r
         * @return {?}
         */
        function (r) { return _this.primaryId(r); }));
        /** @type {?} */
        var checkIds = this._state.checkedRows.map((/**
         * @param {?} r
         * @return {?}
         */
        function (r) { return r.id; }));
        if (this.difference(allRows, checkIds).length) {
            return false; // this._state.checkedRows.length === allRows.length;
        }
        else {
            return true;
        }
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.getCurrentPageCheckeds = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var allRows = this.getAllRowsForLive().map((/**
         * @param {?} r
         * @return {?}
         */
        function (r) { return _this.primaryId(r); }));
        return this._state.checkedRows.filter((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return allRows.indexOf(n.id) > -1; }));
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.getCurrentRow = /**
     * @return {?}
     */
    function () {
        return this._state.currentRow || undefined;
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.getSelections = /**
     * @return {?}
     */
    function () {
        var _this = this;
        // 如果数据源变了，需要重新计算
        /** @type {?} */
        var data = this._state.data;
        if (this._state.selections && this._state.selections.length) {
            if (!data || !data.length) {
                this._state.selections = [];
            }
            else {
                /** @type {?} */
                var temp_1 = data.map((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return _this.primaryId(n); }));
                this._state.selections = this._state.selections.filter((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) {
                    return temp_1.includes(n.id);
                }));
            }
        }
        return this._state.selections || [];
    };
    /**
     * @private
     * @return {?}
     */
    DatagridFacadeService.prototype.getCheckedRowsFromSource = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        return (this._state.checkedRows || []).map((/**
         * @param {?} n
         * @return {?}
         */
        function (n) {
            /** @type {?} */
            var d = _this.findRow(n.id);
            if (d && d.data) {
                n.data = d.data;
            }
            return n;
        }));
    };
    /**
     * @param {?=} fromDataSource
     * @return {?}
     */
    DatagridFacadeService.prototype.getCheckeds = /**
     * @param {?=} fromDataSource
     * @return {?}
     */
    function (fromDataSource) {
        if (fromDataSource === void 0) { fromDataSource = false; }
        if (fromDataSource) {
            this._state.checkedRows = this.getCheckedRowsFromSource();
        }
        return this._state.checkedRows || [];
    };
    /**
     * @param {?} rowid
     * @param {?} rowData
     * @return {?}
     */
    DatagridFacadeService.prototype.updateCheckedData = /**
     * @param {?} rowid
     * @param {?} rowData
     * @return {?}
     */
    function (rowid, rowData) {
        var _this = this;
        /** @type {?} */
        var checkeds = this.getCheckeds();
        if (checkeds.length) {
            /** @type {?} */
            var item_1 = checkeds.find((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return _this.primaryId(n) == rowid; }));
            if (item_1) {
                Object.keys(rowData).forEach((/**
                 * @param {?} k
                 * @return {?}
                 */
                function (k) {
                    Utils.setValue(k, rowData[k], item_1.data);
                }));
            }
        }
    };
    /**
     * @param {?} ids
     * @param {?=} checked
     * @return {?}
     */
    DatagridFacadeService.prototype.setCheckedRows = /**
     * @param {?} ids
     * @param {?=} checked
     * @return {?}
     */
    function (ids, checked) {
        var _this = this;
        if (checked === void 0) { checked = true; }
        if (ids && ids.length) {
            /** @type {?} */
            var checkeds_1 = this._state.checkedRows || [];
            ids.forEach((/**
             * @param {?} id
             * @return {?}
             */
            function (id) {
                /** @type {?} */
                var row = _this.findRow(id);
                if (checked && row) {
                    if (!_this.isRowChecked(id, checkeds_1)) {
                        /** @type {?} */
                        var srow = { id: _this.primaryId(row.data), data: row.data, index: row.index };
                        checkeds_1.push(srow);
                    }
                }
                else {
                    if (!_this._state.enableMorePageSelect || !checked) {
                        checkeds_1 = checkeds_1.filter((/**
                         * @param {?} sr
                         * @return {?}
                         */
                        function (sr) { return sr.id !== id; }));
                    }
                }
            }));
            this._state.checkedRows = checkeds_1;
        }
        else {
            this._clearCheckeds();
        }
    };
    /**
     * @param {?} id
     * @param {?=} checked
     * @return {?}
     */
    DatagridFacadeService.prototype.checkRecord = /**
     * @param {?} id
     * @param {?=} checked
     * @return {?}
     */
    function (id, checked) {
        if (checked === void 0) { checked = true; }
        if (id) {
            /** @type {?} */
            var row = this.findRow(id);
            if (row) {
                var _a = tslib_1.__assign({}, row), rowIndex = _a.index, rowData = _a.data;
                if (checked) {
                    this.checkRow(rowIndex, rowData);
                }
                else {
                    this.unCheckRow(rowIndex, rowData);
                }
            }
            else {
                this.errorSubject.next("\u672A\u627E\u5230ID\u4E3A" + id + "\u7684\u6570\u636E\u3002");
            }
        }
        else {
            this.errorSubject.next("\u53C2\u6570id \u4E0D\u80FD\u4E3A\u7A7A\u3002");
        }
    };
    /**
     * @param {?} rowIndex
     * @param {?} rowData
     * @param {?=} grid
     * @return {?}
     */
    DatagridFacadeService.prototype.checkRow = /**
     * @param {?} rowIndex
     * @param {?} rowData
     * @param {?=} grid
     * @return {?}
     */
    function (rowIndex, rowData, grid) {
        var _this = this;
        if (grid === void 0) { grid = null; }
        if (!this._state.multiSelect) {
            this._clearCheckeds();
        }
        /** @type {?} */
        var id = this.primaryId(rowData);
        /** @type {?} */
        var checkeds = this._state.checkedRows || [];
        /** @type {?} */
        var srow = { id: id, data: rowData, index: rowIndex };
        if (id && !this.isRowChecked(id, checkeds)) {
            checkeds.push(srow);
            this._state.checkedRows = checkeds;
            if (this._state.selectOnCheck) {
                if (grid && grid.instance && grid.instance.beforeSelect) {
                    grid.instance.beforeSelect({ rowIndex: rowIndex, rowData: rowData, gridInstance: grid.instance }).subscribe((/**
                     * @param {?} e
                     * @return {?}
                     */
                    function (e) {
                        if (e) {
                            _this.selectRow(rowIndex, rowData);
                        }
                    }));
                }
                else {
                    this.selectRow(rowIndex, rowData);
                }
            }
            this.checkRowSubject.next(srow);
        }
        this.updateCheckboxState$.emit(tslib_1.__assign({}, srow, { checked: true }));
    };
    /**
     * @param {?} rowIndex
     * @param {?} rowData
     * @param {?=} grid
     * @return {?}
     */
    DatagridFacadeService.prototype.unCheckRow = /**
     * @param {?} rowIndex
     * @param {?} rowData
     * @param {?=} grid
     * @return {?}
     */
    function (rowIndex, rowData, grid) {
        var _this = this;
        if (grid === void 0) { grid = null; }
        /** @type {?} */
        var id = this.primaryId(rowData);
        /** @type {?} */
        var checkeds = this._state.checkedRows || [];
        /** @type {?} */
        var srow = { id: id, data: rowData, index: rowIndex };
        if (this.isRowChecked(id, checkeds)) {
            checkeds = checkeds.filter((/**
             * @param {?} sr
             * @return {?}
             */
            function (sr) { return '' + sr.id !== '' + id; }));
            this._state.checkedRows = checkeds;
            if (this._state.selectOnCheck) {
                if (grid && grid.instance && grid.instance.beforeUnselect) {
                    grid.instance.beforeUnselect({ rowIndex: rowIndex, rowData: rowData, gridInstance: grid.instance }).subscribe((/**
                     * @param {?} e
                     * @return {?}
                     */
                    function (e) {
                        if (e) {
                            _this.unSelectRow(rowIndex, rowData);
                        }
                    }));
                }
                else {
                    this.unSelectRow(rowIndex, rowData);
                }
            }
            this.unCheckRowSubject.next(srow);
        }
        this.updateCheckboxState$.emit(tslib_1.__assign({}, srow, { checked: false }));
    };
    /**
     * @param {?} data
     * @return {?}
     */
    DatagridFacadeService.prototype.setCurrentPageData = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        this._state.currentPageData = data;
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.getCurrentPageData = /**
     * @return {?}
     */
    function () {
        return this._state.currentPageData || [];
    };
    /** 获取所有可以操作的行 */
    /**
     * 获取所有可以操作的行
     * @private
     * @return {?}
     */
    DatagridFacadeService.prototype.getAllRowsForLive = /**
     * 获取所有可以操作的行
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var allData = this._state.data || [];
        if (this._state.pagination && !this._state.pagerOnServer) {
            // 获取当前页数据
            allData = this.getCurrentPageData();
        }
        // 排除掉禁用的行
        if (this._state.disableRow) {
            allData = allData.filter((/**
             * @param {?} n
             * @param {?} i
             * @return {?}
             */
            function (n, i) { return !_this._state.disableRow(n, i); }));
        }
        return allData;
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.checkAll = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this._state.checkedRows = this._state.checkedRows || [];
        /** @type {?} */
        var allData = this.getAllRowsForLive();
        /** @type {?} */
        var allCheckeds = allData.map((/**
         * @param {?} r
         * @param {?} i
         * @return {?}
         */
        function (r, i) {
            return {
                id: _this.primaryId(r),
                index: i,
                data: r
            };
        }));
        if (!this._state.checkedRows.length) {
            this._state.checkedRows = allCheckeds;
        }
        else {
            /** @type {?} */
            var _checkeds_1 = [];
            allCheckeds.forEach((/**
             * @param {?} element
             * @return {?}
             */
            function (element) {
                if (!_this._state.checkedRows.find((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return n.id == element.id; }))) {
                    _checkeds_1.push(element);
                }
            }));
            this._state.checkedRows = this._state.checkedRows.concat(_checkeds_1);
        }
        if (this._state.selectOnCheck && !this._state.onlySelectSelf) {
            this._state.selections = [];
            this._state.selections = allData.map((/**
             * @param {?} r
             * @param {?} i
             * @return {?}
             */
            function (r, i) {
                return {
                    id: _this.primaryId(r),
                    index: i,
                    data: r
                };
            }));
        }
        this.checkAllSubject.next(this._state.checkedRows);
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.selectAll = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this._state.selections = [];
        /** @type {?} */
        var allData = this.getAllRowsForLive();
        this._state.selections = allData.map((/**
         * @param {?} r
         * @param {?} i
         * @return {?}
         */
        function (r, i) {
            return {
                id: _this.primaryId(r),
                index: i,
                data: r
            };
        }));
        if (this._state.checkOnSelect) {
            this._state.checkedRows = [];
            this._state.checkedRows = allData.map((/**
             * @param {?} r
             * @param {?} i
             * @return {?}
             */
            function (r, i) {
                return {
                    id: _this.primaryId(r),
                    index: i,
                    data: r
                };
            }));
        }
        this.selectAllSubject.next(this._state.selections);
    };
    /**
     * @param {?} id
     * @return {?}
     */
    DatagridFacadeService.prototype.findRow = /**
     * @param {?} id
     * @return {?}
     */
    function (id) {
        var _this = this;
        if (this._state.data && this._state.data.length) {
            /** @type {?} */
            var index_1 = -1;
            /** @type {?} */
            var data = this._state.data.find((/**
             * @param {?} n
             * @param {?} i
             * @return {?}
             */
            function (n, i) {
                /** @type {?} */
                var r = _this.primaryId(n) == id;
                if (r) {
                    index_1 = i;
                }
                return r;
            }));
            if (index_1 === -1) {
                return null;
            }
            return { index: index_1, data: data };
        }
        return null;
    };
    /**
     * @param {?} id
     * @return {?}
     */
    DatagridFacadeService.prototype.findRowIndex = /**
     * @param {?} id
     * @return {?}
     */
    function (id) {
        var _this = this;
        if (this._state.data && this._state.data.length) {
            return this._state.data.findIndex((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return _this.primaryId(n) === id; }));
        }
        return -1;
    };
    /**
     * 设置选中行，不触发grid 选中事件，取消选中事件
     */
    /**
     * 设置选中行，不触发grid 选中事件，取消选中事件
     * @param {?} id
     * @param {?=} select
     * @return {?}
     */
    DatagridFacadeService.prototype.setSelectRow = /**
     * 设置选中行，不触发grid 选中事件，取消选中事件
     * @param {?} id
     * @param {?=} select
     * @return {?}
     */
    function (id, select) {
        if (select === void 0) { select = true; }
        /** @type {?} */
        var row = this.findRow(id);
        var _a = tslib_1.__assign({}, row), rowIndex = _a.index, rowData = _a.data;
        /** @type {?} */
        var srow = { id: id, data: rowData, index: rowIndex };
        if (this.isMultiSelect()) {
            if (select) {
                this.selectRowForMulti(srow, false);
            }
            else {
                this.unSelectRowForMulti(srow, false);
            }
        }
        /** @type {?} */
        var _sr = select ? srow : null;
        this.updateState({ currentRow: _sr }, false);
    };
    /**
     * @param {?} id
     * @param {?=} select
     * @return {?}
     */
    DatagridFacadeService.prototype.selectRecord = /**
     * @param {?} id
     * @param {?=} select
     * @return {?}
     */
    function (id, select) {
        if (select === void 0) { select = true; }
        if (id) {
            /** @type {?} */
            var row = this.findRow(id);
            if (row) {
                var _a = tslib_1.__assign({}, row), rowIndex = _a.index, rowData = _a.data;
                if (select) {
                    this.selectRow(rowIndex, rowData);
                }
                else {
                    this.unSelectRow(rowIndex, rowData);
                }
            }
            else {
                this.errorSubject.next("\u672A\u627E\u5230ID\u4E3A" + id + "\u7684\u6570\u636E\u3002");
            }
        }
        else {
            this.errorSubject.next("\u53C2\u6570id \u4E0D\u80FD\u4E3A\u7A7A\u3002");
        }
    };
    /**
     * @param {?} rowIndex
     * @param {?} rowData
     * @param {?=} gridOpts
     * @return {?}
     */
    DatagridFacadeService.prototype.selectRow = /**
     * @param {?} rowIndex
     * @param {?} rowData
     * @param {?=} gridOpts
     * @return {?}
     */
    function (rowIndex, rowData, gridOpts) {
        var _this = this;
        if (gridOpts === void 0) { gridOpts = null; }
        /** @type {?} */
        var isMultiSelect = this.isMultiSelect();
        /** @type {?} */
        var id = this.primaryId(rowData);
        /** @type {?} */
        var srow = { id: id, data: rowData, index: rowIndex };
        if (!this.isRowSelected(id) || !this._state.currentRow) {
            if (!isMultiSelect) {
                this.updateState({ currentRow: srow }, false);
                this.selectRowSubject.next(this._state.currentRow);
                if (this._state.showCheckbox && this._state.checkOnSelect) {
                    this._state.checkedRows = [srow];
                    if (gridOpts && gridOpts.instance && gridOpts.instance.beforeCheck) {
                        gridOpts.instance.beforeCheck({ rowIndex: rowIndex, rowData: rowData, gridInstance: gridOpts.instance }).subscribe((/**
                         * @return {?}
                         */
                        function () {
                            _this.checkRowSubject.next(srow);
                        }));
                    }
                    else {
                        this.checkRowSubject.next(srow);
                    }
                }
            }
            else {
                this.selectRowForMulti(srow, true, gridOpts);
            }
        }
    };
    /**
     * @private
     * @param {?} srow
     * @param {?=} emit
     * @param {?=} gridOpts
     * @return {?}
     */
    DatagridFacadeService.prototype.selectRowForMulti = /**
     * @private
     * @param {?} srow
     * @param {?=} emit
     * @param {?=} gridOpts
     * @return {?}
     */
    function (srow, emit, gridOpts) {
        if (emit === void 0) { emit = true; }
        if (gridOpts === void 0) { gridOpts = null; }
        if (this._state.onlySelectSelf) {
            this._clearSelections();
            this.updateState({ currentRow: srow, selections: [srow] }, false);
        }
        else {
            this._state.selections = this._state.selections || [];
            this._state.selections = this._state.selections.filter((/**
             * @param {?} sr
             * @return {?}
             */
            function (sr) { return sr.id !== srow.id; }));
            this._state.selections.push(srow);
        }
        if (emit) {
            this.selectRowSubject.next(srow);
        }
        if (this._state.checkOnSelect) {
            this.checkRow(srow.index, srow.data, gridOpts);
        }
    };
    /**
     * @private
     * @param {?} srow
     * @param {?=} emit
     * @param {?=} gridOpts
     * @return {?}
     */
    DatagridFacadeService.prototype.unSelectRowForMulti = /**
     * @private
     * @param {?} srow
     * @param {?=} emit
     * @param {?=} gridOpts
     * @return {?}
     */
    function (srow, emit, gridOpts) {
        if (emit === void 0) { emit = true; }
        if (gridOpts === void 0) { gridOpts = null; }
        this._state.selections = this._state.selections.filter((/**
         * @param {?} sr
         * @return {?}
         */
        function (sr) { return sr.id !== srow.id; }));
        if (this._canCancelSelectWhenMulti() || (this._state.currentRow && this._state.currentRow.id === srow.id)) {
            this.updateState({ currentRow: null });
        }
        if (this._state.checkOnSelect) {
            this.unCheckRow(srow.index, srow.data, gridOpts);
        }
        if (emit) {
            this.unSelectRowSubject.next(srow);
        }
    };
    /**
     * @param {?} rowIndex
     * @param {?} rowData
     * @param {?=} gridOpts
     * @return {?}
     */
    DatagridFacadeService.prototype.unSelectRow = /**
     * @param {?} rowIndex
     * @param {?} rowData
     * @param {?=} gridOpts
     * @return {?}
     */
    function (rowIndex, rowData, gridOpts) {
        if (gridOpts === void 0) { gridOpts = null; }
        /** @type {?} */
        var id = this.primaryId(rowData);
        /** @type {?} */
        var isMultiSelect = this.isMultiSelect();
        /** @type {?} */
        var srow = { id: id, index: rowIndex, data: rowData };
        if (!isMultiSelect) {
            if (this._state.currentRow) {
                this.updateState({ currentRow: null });
                this.unSelectRowSubject.next(srow);
                if (this._state.showCheckbox) {
                    this.unCheckRow(srow.index, srow.data, gridOpts);
                }
            }
        }
        else {
            this.unSelectRowForMulti(srow, true, gridOpts);
        }
    };
    /**
     * @private
     * @return {?}
     */
    DatagridFacadeService.prototype._canCancelSelectWhenMulti = /**
     * @private
     * @return {?}
     */
    function () {
        return !this._state.keepSelect && this._state.onlySelectSelf;
    };
    /**
     * @private
     * @param {?=} excludeIds
     * @return {?}
     */
    DatagridFacadeService.prototype._clearSelections = /**
     * @private
     * @param {?=} excludeIds
     * @return {?}
     */
    function (excludeIds) {
        this._state.currentRow = null;
        if (!excludeIds || !excludeIds.length) {
            this._state.selections = [];
        }
        else {
            this._state.selections = this._state.selections.filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) {
                return excludeIds.findIndex((/**
                 * @param {?} i
                 * @return {?}
                 */
                function (i) { return i == n.id; })) > -1;
            }));
        }
    };
    /**
     * @private
     * @param {?=} rows
     * @return {?}
     */
    DatagridFacadeService.prototype._clearCheckeds = /**
     * @private
     * @param {?=} rows
     * @return {?}
     */
    function (rows) {
        var _this = this;
        if (rows === void 0) { rows = []; }
        if (!rows.length) {
            this._state.checkedRows = [];
        }
        else {
            this._state.checkedRows = this._state.checkedRows.filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return rows.findIndex((/**
             * @param {?} r
             * @return {?}
             */
            function (r) { return _this.primaryId(r) === n.id; })) == -1; }));
        }
    };
    /**
     * @param {?=} excludeIds
     * @return {?}
     */
    DatagridFacadeService.prototype.clearSelections = /**
     * @param {?=} excludeIds
     * @return {?}
     */
    function (excludeIds) {
        /** @type {?} */
        var rows = this._state.selections;
        excludeIds = excludeIds || [];
        this._clearSelections(excludeIds);
        /** @type {?} */
        var unCheckRows = rows.filter((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return excludeIds.findIndex((/**
         * @param {?} i
         * @return {?}
         */
        function (i) { return i == n.id; })) == -1; }));
        if (this._state.checkOnSelect || (!this._state.multiSelect && this._state.showCheckbox)) {
            // this._state.checkedRows = [];
            // this.clearCheckedsSubject.next(rows);
            this._state.checkedRows = this._state.checkedRows.filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) {
                return !rows.find((/**
                 * @param {?} t1
                 * @return {?}
                 */
                function (t1) { return t1.id == n.id && excludeIds.findIndex((/**
                 * @param {?} i
                 * @return {?}
                 */
                function (i) { return i == n.id; })) == -1; }));
            }));
            this.clearCheckedsSubject.next(unCheckRows);
        }
        this.clearSelectionSubject.next(unCheckRows);
    };
    /**
     * @param {?=} clearAll
     * @return {?}
     */
    DatagridFacadeService.prototype.clearCheckeds = /**
     * @param {?=} clearAll
     * @return {?}
     */
    function (clearAll) {
        if (clearAll === void 0) { clearAll = true; }
        /** @type {?} */
        var rows = this.getAllRowsForLive();
        /** @type {?} */
        var _rows = clearAll ? [] : rows;
        this._clearCheckeds(_rows);
        if (this._state.selectOnCheck) {
            this._clearSelections();
        }
        this.clearCheckedsSubject.next(rows);
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.clearAll = /**
     * @return {?}
     */
    function () {
        this._clearCheckeds();
        this._clearSelections();
        this.clearAllSubject.next();
    };
    /**
     * @param {?} flag
     * @return {?}
     */
    DatagridFacadeService.prototype.setMultiSelect = /**
     * @param {?} flag
     * @return {?}
     */
    function (flag) {
        this._state.multiSelect = flag;
    };
    /**
     * @param {?} flag
     * @return {?}
     */
    DatagridFacadeService.prototype.setCheckOnSelect = /**
     * @param {?} flag
     * @return {?}
     */
    function (flag) {
        this._state.checkOnSelect = flag;
    };
    /**
     * @param {?} flag
     * @return {?}
     */
    DatagridFacadeService.prototype.setSelectOnCheck = /**
     * @param {?} flag
     * @return {?}
     */
    function (flag) {
        this._state.selectOnCheck = flag;
    };
    /**
     * @param {?} dr
     * @param {?} field
     * @param {?=} cellElement
     * @param {?=} cellRef
     * @return {?}
     */
    DatagridFacadeService.prototype.setCurrentCell = /**
     * @param {?} dr
     * @param {?} field
     * @param {?=} cellElement
     * @param {?=} cellRef
     * @return {?}
     */
    function (dr, field, cellElement, cellRef) {
        var _a = tslib_1.__assign({}, dr), rowIndex = _a.rowIndex, rowData = _a.rowData;
        /** @type {?} */
        var currentCell = tslib_1.__assign({}, this._state.currentCell, { rowIndex: rowIndex, rowData: rowData, field: field, rowId: this.primaryId(rowData), cellElement: cellElement });
        if (field !== this._state.ControlPanelFeild) {
            if (cellRef) {
                currentCell.cellRef = cellRef;
            }
            if (field) {
                currentCell.column = this.getColumn(field);
            }
            /** @type {?} */
            var isLastRow = rowIndex === this.getData().length - 1;
            currentCell['lastRow'] = isLastRow;
        }
        else {
            currentCell = null;
        }
        this._state.currentCell = null;
        this.updateState({ currentCell: currentCell }, false);
        this.selectRow(rowIndex, rowData);
        if (this._state.currentRow) {
            this._state.currentRow.dr = dr;
        }
        this.selectCellSubject.next(currentCell);
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.cancelSelectCell = /**
     * @return {?}
     */
    function () {
        if (this._state.currentCell) {
            this._state.currentCell = null;
            this.updateState({ currentCell: null }, false);
            this.selectCellSubject.next(null);
        }
    };
    /**
     * @param {?} rowData
     * @return {?}
     */
    DatagridFacadeService.prototype.primaryId = /**
     * @param {?} rowData
     * @return {?}
     */
    function (rowData) {
        return rowData[this._state.idField];
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.getCurrentCell = /**
     * @return {?}
     */
    function () {
        return this._state.currentCell;
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.editCell = /**
     * @return {?}
     */
    function () {
        if (this._state.currentCell) {
            if (!this._state.currentCell.isEditing) {
                /** @type {?} */
                var cei = tslib_1.__assign({}, this._state.currentCell, { isEditing: true });
                this.updateState({ currentCell: cei }, false);
                this.selectCellSubject.next(cei);
                // this.editCell$.next(cei);
            }
        }
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.endEditCell = /**
     * @return {?}
     */
    function () {
        if (this._state.currentCell && this._state.currentCell.isEditing) {
            /** @type {?} */
            var cei = tslib_1.__assign({}, this._state.currentCell, { isEditing: false });
            this.updateState({ currentCell: cei }, false);
            this.selectCellSubject.next(cei);
            // this.editCell$.next(cei);
        }
    };
    /**
     * @param {?} rowData
     * @return {?}
     */
    DatagridFacadeService.prototype.appendRow = /**
     * @param {?} rowData
     * @return {?}
     */
    function (rowData) {
        if (rowData && this.primaryId(rowData)) {
            /** @type {?} */
            var pid = this.primaryId(rowData);
            if (this.findRowIndex(pid) === -1) {
                this._state.data.push(rowData);
                /** @type {?} */
                var newData = tslib_1.__spread(this._state.data);
                this.updateState({ data: newData }, false);
                this._state.originalData = cloneDeep(this._state.data);
                this.refresh();
                this.rowAppend$.emit(rowData);
            }
            else {
                throw new Error("\u4E3B\u952EID \u5DF2\u5B58\u5728\uFF01ID: " + pid);
            }
        }
        else {
            throw new Error("\u4E3B\u952E\u6807\u8BC6\u5B57\u6BB5\u4E0D\u80FD\u4E3A\u7A7A\u3002");
        }
    };
    /**
     * @param {?} rowid
     * @param {?} rowData
     * @return {?}
     */
    DatagridFacadeService.prototype.updateRow = /**
     * @param {?} rowid
     * @param {?} rowData
     * @return {?}
     */
    function (rowid, rowData) {
        /** @type {?} */
        var row = this.findRow(rowid);
        if (row && row.data) {
            if (rowData) {
                /** @type {?} */
                var keys = Object.keys(rowData);
                keys.forEach((/**
                 * @param {?} field
                 * @return {?}
                 */
                function (field) {
                    Utils.setValue(field, rowData[field], row.data);
                }));
                // 更新已勾选的数据
                this.updateCheckedData(rowid, rowData);
                this.rowUpdate$.emit(row);
            }
        }
    };
    /**
     * @param {?} rowid
     * @return {?}
     */
    DatagridFacadeService.prototype.deleteRow = /**
     * @param {?} rowid
     * @return {?}
     */
    function (rowid) {
        /** @type {?} */
        var row = this.findRow(rowid);
        if (row) {
            /** @type {?} */
            var newData = this.removeRow(this._state.data, rowid);
            this.updateState({ data: newData }, false);
            this._state.originalData = cloneDeep(this._state.data);
            this.refresh();
            this.rowDelete$.emit(rowid);
            return row;
        }
    };
    /**
     * 从数组中删除指定的ID
     * @param data 数组
     * @param rowId 要删除的ID
     */
    /**
     * 从数组中删除指定的ID
     * @param {?} data 数组
     * @param {?} rowId 要删除的ID
     * @return {?}
     */
    DatagridFacadeService.prototype.removeRow = /**
     * 从数组中删除指定的ID
     * @param {?} data 数组
     * @param {?} rowId 要删除的ID
     * @return {?}
     */
    function (data, rowId) {
        var _this = this;
        /** @type {?} */
        var newData = data.filter((/**
         * @param {?} n
         * @return {?}
         */
        function (n) {
            /** @type {?} */
            var id = _this.primaryId(n);
            return rowId !== id;
        }));
        return newData;
    };
    /**
     * @param {?} cellInfo
     * @return {?}
     */
    DatagridFacadeService.prototype.isCellSelected = /**
     * @param {?} cellInfo
     * @return {?}
     */
    function (cellInfo) {
        /** @type {?} */
        var cc = this.getCurrentCell();
        if (!cc) {
            return false;
        }
        else {
            if (this._state.currentRow.index === cc.rowIndex) {
                return cc.field === cellInfo.field;
            }
            return false;
        }
    };
    /**
     * @protected
     * @param {?} state
     * @param {?=} emit
     * @return {?}
     */
    DatagridFacadeService.prototype.updateState = /**
     * @protected
     * @param {?} state
     * @param {?=} emit
     * @return {?}
     */
    function (state, emit) {
        if (emit === void 0) { emit = true; }
        /** @type {?} */
        var newState = tslib_1.__assign({}, this._state, state);
        this._state = newState;
        if (emit) {
            this.store.next(this._state);
        }
    };
    /**
     * @param {?=} newSize
     * @return {?}
     */
    DatagridFacadeService.prototype.resize = /**
     * @param {?=} newSize
     * @return {?}
     */
    function (newSize) {
        if (newSize) {
            this.updateState(newSize, false);
        }
        this.resetColumnsSize();
        if (!this._state.groupRows) {
            this.updateVirthualRows(this._state.virtual.scrollTop);
        }
    };
    /**
     * @param {?} fit
     * @return {?}
     */
    DatagridFacadeService.prototype.fitColumns = /**
     * @param {?} fit
     * @return {?}
     */
    function (fit) {
        this.updateState({ fitColumns: fit }, false);
        // const r = this.useUserSetColumnSize();
        // this.setFitColumnsWidth(this._state.columnsGroup, true, r);
        // this.gridSizeSubject.next(this._state);
        this.resetColumnsSize();
    };
    /**
     * @private
     * @return {?}
     */
    DatagridFacadeService.prototype.useUserSetColumnSize = /**
     * @private
     * @return {?}
     */
    function () {
        if (this._state.autoFitColumns) {
            /** @type {?} */
            var gridWidth = this._state.width;
            /** @type {?} */
            var userSetColumnWidth = this._state.columnsGroup.originalTotalWidth;
            return userSetColumnWidth > gridWidth;
        }
        return false;
    };
    /**
     * @private
     * @return {?}
     */
    DatagridFacadeService.prototype.resetColumnsSize = /**
     * @private
     * @return {?}
     */
    function () {
        if (this._state.fitColumns) {
            // 20200421
            /** @type {?} */
            var r = this.useUserSetColumnSize();
            this.setFitColumnsWidth(this._state.columnsGroup, r, r);
        }
        this.gridSizeSubject.next(this._state);
    };
    /**
     * 更新列设置
     * @param columns 新的列集合
     * @param restitute 是否还原初始宽度 默认为 false
     */
    /**
     * 更新列设置
     * @param {?} columns 新的列集合
     * @param {?=} restitute 是否还原初始宽度 默认为 false
     * @param {?=} emit
     * @return {?}
     */
    DatagridFacadeService.prototype.updateColumns = /**
     * 更新列设置
     * @param {?} columns 新的列集合
     * @param {?=} restitute 是否还原初始宽度 默认为 false
     * @param {?=} emit
     * @return {?}
     */
    function (columns, restitute, emit) {
        if (restitute === void 0) { restitute = false; }
        if (emit === void 0) { emit = false; }
        this._state.columns = columns;
        this.initColumns(emit, restitute);
        this.resizeColumns(restitute);
    };
    /**
     * @param {?} columns
     * @return {?}
     */
    DatagridFacadeService.prototype.getGroupColumns = /**
     * @param {?} columns
     * @return {?}
     */
    function (columns) {
        var _this = this;
        /** @type {?} */
        var arr = [];
        /** @type {?} */
        var allCols = this.getAllFlatColumns();
        columns.forEach((/**
         * @param {?} c
         * @return {?}
         */
        function (c) {
            if (!c.colspan || c.colspan == 1) {
                if (!arr.find((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return n.field === c.field; }))) {
                    arr.push(c);
                }
            }
            else {
                arr = arr.concat(_this.getGroupColumns(allCols.filter((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return n.parentId == c.id; }))));
            }
        }));
        return arr;
    };
    /**
     * @param {?=} emit
     * @param {?=} restColumnWidth
     * @return {?}
     */
    DatagridFacadeService.prototype.initColumns = /**
     * @param {?=} emit
     * @param {?=} restColumnWidth
     * @return {?}
     */
    function (emit, restColumnWidth) {
        if (emit === void 0) { emit = false; }
        if (restColumnWidth === void 0) { restColumnWidth = false; }
        /** @type {?} */
        var columns = this._state.flatColumns;
        /** @type {?} */
        var colgroup = {
            leftFixed: [],
            rightFixed: [],
            normalColumns: [],
            columns: []
        };
        if (columns && columns.length) {
            /** @type {?} */
            var leftFixedCols = this.getFixedCols('left');
            /** @type {?} */
            var rightFixedCols = this.getFixedCols('right');
            /** @type {?} */
            var normalCols = this.getFixedCols();
            columns.forEach((/**
             * @param {?} c
             * @return {?}
             */
            function (c) {
                if (!c.originalWidth) {
                    c.originalWidth = c.width;
                }
            }));
            colgroup = {
                leftFixed: leftFixedCols,
                rightFixed: rightFixedCols,
                normalColumns: normalCols,
                columns: leftFixedCols.concat(normalCols).concat(rightFixedCols)
            };
            this.initColumnsWidth(colgroup, restColumnWidth);
            if (this._state.fitColumns) {
                this.setFitColumnsWidth(colgroup, true);
            }
            this.updateState({ columnsGroup: colgroup }, emit);
        }
        else {
            colgroup.leftFixedWidth = 0;
            colgroup.rightFixedWidth = 0;
            colgroup.normalWidth = 0;
            colgroup.totalWidth = 0;
            this.updateState({ columnsGroup: colgroup }, emit);
        }
    };
    /**
     * @param {?} field
     * @param {?=} fixed
     * @return {?}
     */
    DatagridFacadeService.prototype.getColumnIndex = /**
     * @param {?} field
     * @param {?=} fixed
     * @return {?}
     */
    function (field, fixed) {
        if (fixed === void 0) { fixed = ''; }
        /** @type {?} */
        var colgroup = this._state.columnsGroup;
        if (!fixed || this._state.fast) {
            return colgroup.normalColumns.findIndex((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n.field === field; }));
        }
        else {
            if (fixed === 'left') {
                return colgroup.leftFixed.findIndex((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return n.field === field; }));
            }
            else if (fixed === 'right') {
                return colgroup.rightFixed.findIndex((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return n.field === field; }));
            }
        }
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.columnResizeEnd = /**
     * @return {?}
     */
    function () {
        // const colgroup = this._state.columnsGroup;
        // this.initColumnsWidth(colgroup, false);
        // this.updateState({ columnsGroup:  {...colgroup} }, false);
        // this.gridSizeSubject.next(this._state);
        this.resizeColumns();
    };
    /**
     * @param {?=} restitute
     * @return {?}
     */
    DatagridFacadeService.prototype.resizeColumns = /**
     * @param {?=} restitute
     * @return {?}
     */
    function (restitute) {
        if (restitute === void 0) { restitute = false; }
        /** @type {?} */
        var colgroup = this._state.columnsGroup;
        this.initColumnsWidth(colgroup, restitute);
        if (this._state.fitColumns) {
            /** @type {?} */
            var r = this.useUserSetColumnSize();
            if (r) {
                this.setFitColumnsWidth(colgroup, restitute, r);
            }
            else {
                this.setFitColumnsWidth(colgroup, restitute);
            }
        }
        this.updateState({ columnsGroup: tslib_1.__assign({}, colgroup) }, false);
        this.gridSizeSubject.next(this._state);
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.getAllFlatColumns = /**
     * @return {?}
     */
    function () {
        return flatten(this._state.columns);
    };
    /**
     * @param {?} fieldName
     * @return {?}
     */
    DatagridFacadeService.prototype.getColumn = /**
     * @param {?} fieldName
     * @return {?}
     */
    function (fieldName) {
        return this.getAllFlatColumns().find((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n.field === fieldName; }));
    };
    /**
     * @param {?} colgroup
     * @param {?=} restitute
     * @param {?=} useUserSetColumnSize
     * @return {?}
     */
    DatagridFacadeService.prototype.setFitColumnsWidth = /**
     * @param {?} colgroup
     * @param {?=} restitute
     * @param {?=} useUserSetColumnSize
     * @return {?}
     */
    function (colgroup, restitute, useUserSetColumnSize) {
        if (restitute === void 0) { restitute = false; }
        if (useUserSetColumnSize === void 0) { useUserSetColumnSize = false; }
        if (!colgroup) {
            return;
        }
        colgroup.normalWidth = this._state.width - colgroup.leftFixedWidth - colgroup.rightFixedWidth;
        if (!colgroup.normalWidth || colgroup.normalWidth < 0) {
            return;
        }
        if (useUserSetColumnSize) {
            colgroup.totalWidth = colgroup.originalTotalWidth;
            if (restitute) {
                colgroup.normalColumns.forEach((/**
                 * @param {?} col
                 * @return {?}
                 */
                function (col) {
                    col.width = col.originalWidth;
                }));
            }
            // 更新 normalColumns width
            colgroup.normalWidth = colgroup.normalColumns.reduce((/**
             * @param {?} totalWidth
             * @param {?} col
             * @return {?}
             */
            function (totalWidth, col) {
                if (!restitute && col.width) {
                    return totalWidth += col.width;
                }
                else {
                    return totalWidth += col.originalWidth;
                }
            }), 0);
            colgroup.totalWidth = colgroup.leftFixedWidth + colgroup.rightFixedWidth + colgroup.normalWidth;
        }
        else {
            /** @type {?} */
            var minWidth_1 = colgroup.normalColumns.reduce((/**
             * @param {?} totalWidth
             * @param {?} col
             * @return {?}
             */
            function (totalWidth, col) {
                if (!restitute) {
                    return totalWidth += col.width;
                }
                else {
                    return totalWidth += col.originalWidth;
                }
            }), 0);
            colgroup.normalWidth = colgroup.normalWidth - 2;
            colgroup.normalColumns.forEach((/**
             * @param {?} col
             * @return {?}
             */
            function (col) {
                if (!restitute) {
                    // col.width = Math.floor( col.width / minWidth * colgroup.normalWidth );
                    col.width = Number((col.width / minWidth_1 * colgroup.normalWidth).toFixed(2));
                }
                else {
                    // col.width = Math.floor( col.originalWidth / minWidth * colgroup.normalWidth );
                    col.width = Number((col.originalWidth / minWidth_1 * colgroup.normalWidth).toFixed(2));
                }
            }));
            colgroup.totalWidth = colgroup.leftFixedWidth + colgroup.rightFixedWidth + colgroup.normalWidth;
        }
    };
    /**
     * @private
     * @param {?=} direction
     * @return {?}
     */
    DatagridFacadeService.prototype.getFixedCols = /**
     * @private
     * @param {?=} direction
     * @return {?}
     */
    function (direction) {
        if (direction === void 0) { direction = ''; }
        /** @type {?} */
        var cols = [];
        if (!direction) {
            cols = this._state.flatColumns.filter((/**
             * @param {?} col
             * @return {?}
             */
            function (col) { return !col.fixed; }));
        }
        else {
            cols = this._state.flatColumns.filter((/**
             * @param {?} col
             * @return {?}
             */
            function (col) { return col.fixed === direction; }));
        }
        // 多表头，重新计算列的顺序
        if (this._state.columns.length > 1 && cols.length) {
            /** @type {?} */
            var fields = DatagridColumnsHelper.getFields(this._state.columns);
            /** @type {?} */
            var newcols_1 = [];
            fields.forEach((/**
             * @param {?} f
             * @return {?}
             */
            function (f) {
                /** @type {?} */
                var c = cols.find((/**
                 * @param {?} col
                 * @return {?}
                 */
                function (col) { return (col.field || '') === f; }));
                if (c) {
                    newcols_1.push(c);
                }
            }));
            return newcols_1;
        }
        return cols;
    };
    // restitute: 还原初始宽度，默认 false
    // restitute: 还原初始宽度，默认 false
    /**
     * @private
     * @param {?} colgroup
     * @param {?=} restitute
     * @return {?}
     */
    DatagridFacadeService.prototype.initColumnsWidth = 
    // restitute: 还原初始宽度，默认 false
    /**
     * @private
     * @param {?} colgroup
     * @param {?=} restitute
     * @return {?}
     */
    function (colgroup, restitute) {
        if (restitute === void 0) { restitute = false; }
        /** @type {?} */
        var offset = 0;
        offset = this._state.showLineNumber ? offset + this._state.lineNumberWidth : offset;
        offset = this._state.showCheckbox ? offset + this._state.checkboxColumnWidth : offset;
        /** @type {?} */
        var getColsWidth = (/**
         * @param {?} cols
         * @param {?} val
         * @param {?} reset
         * @return {?}
         */
        function (cols, val, reset) {
            return cols.reduce((/**
             * @param {?} r
             * @param {?} c
             * @return {?}
             */
            function (r, c) {
                c.left = r;
                if (!reset) {
                    return r + c.width;
                }
                else {
                    return r + c.originalWidth;
                }
            }), val);
        });
        colgroup.leftFixedWidth = offset;
        if (colgroup.leftFixed && colgroup.leftFixed.length) {
            colgroup.leftFixedWidth = getColsWidth(colgroup.leftFixed, offset, restitute);
        }
        colgroup.rightFixedWidth = 0;
        if (colgroup.rightFixed && colgroup.rightFixed.length) {
            colgroup.rightFixedWidth = getColsWidth(colgroup.rightFixed, 0, restitute);
        }
        colgroup.normalWidth = 0;
        if (this._state.columns && this._state.columns.length) {
            colgroup.normalWidth = getColsWidth(colgroup.normalColumns, 0, restitute);
            colgroup.originalTotalWidth = getColsWidth(colgroup.normalColumns, 0, true);
        }
        colgroup.totalWidth = colgroup.leftFixedWidth + colgroup.rightFixedWidth + colgroup.normalWidth;
    };
    /**
     * @param {?=} isShow
     * @return {?}
     */
    DatagridFacadeService.prototype.showCheckbox = /**
     * @param {?=} isShow
     * @return {?}
     */
    function (isShow) {
        if (isShow === void 0) { isShow = true; }
        /** @type {?} */
        var colgroup = this._state.columnsGroup;
        this.updateState({ showCheckbox: isShow }, false);
        if (isShow) {
            colgroup.leftFixedWidth = colgroup.leftFixedWidth + this._state.checkboxColumnWidth;
        }
        else {
            colgroup.leftFixedWidth = colgroup.leftFixedWidth - this._state.checkboxColumnWidth;
        }
        this.columnResizeSubject.next(colgroup);
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.hideCheckbox = /**
     * @return {?}
     */
    function () {
        this.showCheckbox(false);
    };
    /**
     * @param {?=} isShow
     * @return {?}
     */
    DatagridFacadeService.prototype.showLineNumber = /**
     * @param {?=} isShow
     * @return {?}
     */
    function (isShow) {
        if (isShow === void 0) { isShow = true; }
        /** @type {?} */
        var colgroup = this._state.columnsGroup;
        this.updateState({ showLineNumber: isShow }, false);
        if (isShow) {
            colgroup.leftFixedWidth = colgroup.leftFixedWidth + this._state.lineNumberWidth;
        }
        else {
            colgroup.leftFixedWidth = colgroup.leftFixedWidth - this._state.lineNumberWidth;
        }
        this.columnResizeSubject.next(colgroup);
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.hideLineNumber = /**
     * @return {?}
     */
    function () {
        this.showLineNumber(false);
    };
    /**
     * @param {?} sortName
     * @param {?} sortOrder
     * @return {?}
     */
    DatagridFacadeService.prototype.setSortInfo = /**
     * @param {?} sortName
     * @param {?} sortOrder
     * @return {?}
     */
    function (sortName, sortOrder) {
        sortName = sortName || '';
        sortOrder = sortOrder || '';
        /** @type {?} */
        var fields = sortName.split(',');
        /** @type {?} */
        var orders = sortOrder.split(',');
        // if (!this._state.multiSort) {
        /** @type {?} */
        var colgroup = this._state.columnsGroup;
        /** @type {?} */
        var updateFieldOrder = (/**
         * @param {?} cols
         * @return {?}
         */
        function (cols) {
            if (!cols || !cols.length) {
                return;
            }
            cols.forEach((/**
             * @param {?} col
             * @return {?}
             */
            function (col) {
                col.order = undefined;
                /** @type {?} */
                var i = fields.findIndex((/**
                 * @param {?} f
                 * @return {?}
                 */
                function (f) { return f === col.field; }));
                if (i > -1) {
                    col.order = orders[i];
                }
            }));
        });
        updateFieldOrder(colgroup.normalColumns);
        updateFieldOrder(colgroup.leftFixed);
        updateFieldOrder(colgroup.rightFixed);
        // }
        this.updateState({ sortName: sortName, sortOrder: sortOrder }, false);
    };
    /**
     * @param {?} arr
     * @param {?} props
     * @param {?} orders
     * @return {?}
     */
    DatagridFacadeService.prototype.orderBy = /**
     * @param {?} arr
     * @param {?} props
     * @param {?} orders
     * @return {?}
     */
    function (arr, props, orders) {
        var _this = this;
        /** @type {?} */
        var colObj = props.reduce((/**
         * @param {?} c
         * @param {?} n
         * @return {?}
         */
        function (c, n) {
            c[n] = _this.getColumn(n);
            return c;
        }), {});
        return tslib_1.__spread(arr).sort((/**
         * @param {?} a
         * @param {?} b
         * @return {?}
         */
        function (a, b) {
            return props.reduce((/**
             * @param {?} acc
             * @param {?} prop
             * @param {?} i
             * @return {?}
             */
            function (acc, prop, i) {
                if (acc === 0) {
                    /** @type {?} */
                    var valA = Utils.getValue(prop, a);
                    /** @type {?} */
                    var valB = Utils.getValue(prop, b);
                    if (colObj[prop] && colObj[prop]['isMultilingualField']) {
                        valA = Utils.getMultilingualValue(valA, _this.localId);
                        valB = Utils.getMultilingualValue(valB, _this.localId);
                    }
                    if (valA === undefined || valA === null) {
                        valA = '';
                    }
                    if (valB === undefined || valB === null) {
                        valB = '';
                    }
                    var _a = tslib_1.__read(orders && orders[i] === 'desc' ? [valB, valA] : [valA, valB], 2), p1 = _a[0], p2 = _a[1];
                    if (typeof p1 === 'string') {
                        acc = p1.localeCompare(p2);
                    }
                    else {
                        acc = p1 > p2 ? 1 : p1 < p2 ? -1 : 0;
                    }
                }
                return acc;
            }), 0);
        }));
    };
    /**
     * @param {?} data
     * @return {?}
     */
    DatagridFacadeService.prototype.sort = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        /** @type {?} */
        var orders = this._state.sortOrder.split(',');
        /** @type {?} */
        var fields = this._state.sortName.split(',');
        if (this._state.mergeCell && this._state.mergeFields && this._state.mergeFields.length) {
            /** @type {?} */
            var newOrders_1 = [];
            /** @type {?} */
            var newFields_1 = tslib_1.__spread(this._state.mergeFields);
            fields.forEach((/**
             * @param {?} f
             * @param {?} i
             * @return {?}
             */
            function (f, i) {
                /** @type {?} */
                var k = newFields_1.indexOf(f);
                if (k == -1) {
                    newFields_1.push(f);
                    k = newFields_1.length - 1;
                }
                newOrders_1[k] = orders[i];
            }));
            return this.orderBy(data, newFields_1, newOrders_1);
        }
        return this.orderBy(data, fields, orders);
    };
    /**
     * @param {?=} data
     * @return {?}
     */
    DatagridFacadeService.prototype.clientSort = /**
     * @param {?=} data
     * @return {?}
     */
    function (data) {
        if (this._state.sortName) {
            if (data) {
                this.updateState({ data: data }, false);
            }
            /** @type {?} */
            var sortedData = this.sort(this._state.data);
            this.loadData(sortedData, false);
        }
        else {
            this.clearSort();
        }
        this.clientSort$.emit({ sortName: this._state.sortName, sortOrder: this._state.sortOrder });
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.clearSort = /**
     * @return {?}
     */
    function () {
        this.loadData(this._state.originalData, false);
    };
    /**
     * @param {?} filterData
     * @return {?}
     */
    DatagridFacadeService.prototype.loadFilterData = /**
     * @param {?} filterData
     * @return {?}
     */
    function (filterData) {
        this.loadData(filterData, false);
    };
    //#region 变更集
    //#region 变更集
    /**
     * @private
     * @param {?} rowid
     * @return {?}
     */
    DatagridFacadeService.prototype.hasRowChanges = 
    //#region 变更集
    /**
     * @private
     * @param {?} rowid
     * @return {?}
     */
    function (rowid) {
        /** @type {?} */
        var _changes = this._state.changes;
        if (!_changes) {
            return false;
        }
        return _changes[rowid];
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    DatagridFacadeService.prototype.appendChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        if (!changes) {
            return;
        }
        /** @type {?} */
        var id = changes[this._state.idField];
        if (!id) {
            return;
        }
        /** @type {?} */
        var _id = '' + id;
        if (!this.hasRowChanges(_id)) {
            this._state.changes = this._state.changes || {};
            this._state.changes[_id] = changes;
        }
        else {
            this._state.changes[_id] = Object.assign(this._state.changes[_id], changes);
        }
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.acceptChanges = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var changes = this._state.changes;
        if (changes) {
            /** @type {?} */
            var keys = Object.keys(changes);
            keys.forEach((/**
             * @param {?} id
             * @return {?}
             */
            function (id) {
                _this.updateRow(id, changes[id]);
            }));
            this._state.originalData = cloneDeep(this._state.data);
        }
    };
    /**
     * @param {?=} rowid
     * @return {?}
     */
    DatagridFacadeService.prototype.rejectChanges = /**
     * @param {?=} rowid
     * @return {?}
     */
    function (rowid) {
        var _this = this;
        if (rowid === void 0) { rowid = null; }
        /** @type {?} */
        var changes = this._state.changes;
        if (changes) {
            if (!rowid) {
                this._state.data = cloneDeep(this._state.originalData);
                this._state.changes = null;
            }
            else {
                /** @type {?} */
                var rowChanges = this._state.changes['' + rowid];
                if (rowChanges) {
                    /** @type {?} */
                    var orgiRow_1 = this._state.originalData.find((/**
                     * @param {?} r
                     * @return {?}
                     */
                    function (r) { return _this.primaryId(r) === rowid; }));
                    this._state.data.forEach((/**
                     * @param {?} r
                     * @return {?}
                     */
                    function (r) {
                        if (_this.primaryId(r) === rowid) {
                            r = cloneDeep(orgiRow_1);
                        }
                    }));
                }
            }
            this.refresh();
        }
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.getChanges = /**
     * @return {?}
     */
    function () {
        return this._state.changes;
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.refresh = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var data = cloneDeep(this._state.data);
        this.loadData(data);
    };
    //#endregion
    /**
     * 构造合计行
     * @param data 数据集合
     */
    //#endregion
    /**
     * 构造合计行
     * @param {?} data 数据集合
     * @return {?}
     */
    DatagridFacadeService.prototype.getFooterData = 
    //#endregion
    /**
     * 构造合计行
     * @param {?} data 数据集合
     * @return {?}
     */
    function (data) {
        var _this = this;
        if (!data || !data.length) {
            return [];
        }
        // const columns = this._state.flatColumns;
        /** @type {?} */
        var columns = flatten(this._state.columns).filter((/**
         * @param {?} col
         * @return {?}
         */
        function (col) { return !col.colspan; }));
        /** @type {?} */
        var footerRow = {};
        columns.forEach((/**
         * @param {?} col
         * @return {?}
         */
        function (col) {
            if (col.footer && col.footer.options) {
                /** @type {?} */
                var options = col.footer.options;
                /** @type {?} */
                var text = options.text;
                /** @type {?} */
                var typ = (/** @type {?} */ (options.calculationType));
                if (typ !== undefined && typ != -1) {
                    /** @type {?} */
                    var val = _this.calculation(data, typ, col);
                    footerRow[col.field] = val;
                }
                else {
                    footerRow[col.field] = text || '';
                }
            }
            else {
                footerRow[col.field] = '';
            }
        }));
        return [footerRow];
    };
    /**
     * @private
     * @param {?} items
     * @param {?} fields
     * @return {?}
     */
    DatagridFacadeService.prototype.arrToGroup = /**
     * @private
     * @param {?} items
     * @param {?} fields
     * @return {?}
     */
    function (items, fields) {
        if (fields.length) {
            /** @type {?} */
            var first_1 = fields.shift();
            /** @type {?} */
            var g1 = groupBy(items, (/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return Utils.getValue(first_1, n); }));
            this.toGroup(g1, fields);
            return g1;
        }
    };
    /**
     * @private
     * @param {?} g1
     * @param {?} fieldArr
     * @return {?}
     */
    DatagridFacadeService.prototype.toGroup = /**
     * @private
     * @param {?} g1
     * @param {?} fieldArr
     * @return {?}
     */
    function (g1, fieldArr) {
        var _this = this;
        if (fieldArr.length) {
            Object.keys(g1).forEach((/**
             * @param {?} k
             * @return {?}
             */
            function (k) {
                /** @type {?} */
                var items = g1[k];
                /** @type {?} */
                var _nextFields = fieldArr.map((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return n; }));
                /** @type {?} */
                var _f = _nextFields.shift();
                g1[k] = groupBy(items, (/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return Utils.getValue(_f, n); }));
                if (_nextFields.length) {
                    _this.toGroup(g1[k], _nextFields);
                }
            }));
        }
    };
    /**
     * @private
     * @param {?} groupRows
     * @param {?} initLevel
     * @param {?} parent
     * @return {?}
     */
    DatagridFacadeService.prototype.groupRows2Flat = /**
     * @private
     * @param {?} groupRows
     * @param {?} initLevel
     * @param {?} parent
     * @return {?}
     */
    function (groupRows, initLevel, parent) {
        var _this = this;
        /** @type {?} */
        var results = [];
        if (initLevel === undefined) {
            initLevel = 0;
        }
        /** @type {?} */
        var idfield = this._state.idField;
        /** @type {?} */
        var columns = this._state.flatColumns;
        /** @type {?} */
        var data = this._state.data;
        /** @type {?} */
        var groupFieldArr = this._state.groupField.split(',');
        /** @type {?} */
        var pid = parent ? parent[idfield] : null;
        /** @type {?} */
        var colspan = this._state.columnsGroup.normalColumns.length;
        /** @type {?} */
        var expandGroupRows = this._state.expandGroupRows;
        Object.keys(groupRows).forEach((/**
         * @param {?} k
         * @param {?} m
         * @return {?}
         */
        function (k, m) {
            var _a, _b;
            /** @type {?} */
            var groupItem = (_a = {}, _a[idfield] = Utils.uuid(), _a[IS_GROUP_ROW_FIELD] = true, _a[GROUP_LEVEL_FIELD] = initLevel, _a.data = {}, _a.value = k, _a[GROUP_VISIBLE_FIELD] = true, _a.expanded = expandGroupRows, _a.field = groupFieldArr[initLevel], _a.colspan = colspan, _a.total = 0, _a.rows = [], _a[GROUP_ROW_FIELD] = pid, _a);
            // TFS: 356955
            if (parent) {
                groupItem.rows = parent.rows.filter((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return !n[IS_GROUP_ROW_FIELD] &&
                    !n[IS_GROUP_FOOTER_ROW_FIELD] && Utils.getValue(groupFieldArr[initLevel], n) === k; }));
            }
            else {
                groupItem.rows = data.filter((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return '' + Utils.getValue(groupFieldArr[initLevel], n) === k; }));
            }
            if (parent) {
                parent.rows.push(groupItem);
            }
            groupItem.total = groupItem.rows.filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return !n[IS_GROUP_ROW_FIELD] && !n[IS_GROUP_FOOTER_ROW_FIELD]; })).length;
            results.push(groupItem);
            /** @type {?} */
            var items = groupRows[k];
            if (isPlainObject(items)) {
                /** @type {?} */
                var level = initLevel + 1;
                results = results.concat(_this.groupRows2Flat(items, level, groupItem));
            }
            else {
                groupItem.total = items.length;
                items.map((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) {
                    n[GROUP_ROW_FIELD] = groupItem[idfield];
                    n[GROUP_VISIBLE_FIELD] = expandGroupRows;
                    n[GROUP_LEVEL_FIELD] = groupItem[GROUP_LEVEL_FIELD] + 1;
                    return n;
                }));
                groupItem.rows = items;
                results = results.concat(items);
            }
            if (_this._state.groupFooter) {
                /** @type {?} */
                var footerItem = (_b = {},
                    _b[IS_GROUP_FOOTER_ROW_FIELD] = true,
                    _b[GROUP_ROW_FIELD] = groupItem[idfield],
                    _b[GROUP_VISIBLE_FIELD] = expandGroupRows,
                    _b[GROUP_LEVEL_FIELD] = initLevel,
                    _b.data = {},
                    _b);
                groupItem.rows.push(footerItem);
                results.push(footerItem);
            }
        }));
        return results;
    };
    /** 更新分组合计行数据 */
    /**
     * 更新分组合计行数据
     * @private
     * @param {?} groupFooterRow
     * @param {?} columns
     * @param {?} groupRows
     * @return {?}
     */
    DatagridFacadeService.prototype.updateGroupFooterData = /**
     * 更新分组合计行数据
     * @private
     * @param {?} groupFooterRow
     * @param {?} columns
     * @param {?} groupRows
     * @return {?}
     */
    function (groupFooterRow, columns, groupRows) {
        var _this = this;
        columns.forEach((/**
         * @param {?} col
         * @return {?}
         */
        function (col) {
            if (col.groupFooter && col.groupFooter.options) {
                /** @type {?} */
                var options = col.groupFooter.options;
                /** @type {?} */
                var text = options.text;
                /** @type {?} */
                var typ = (/** @type {?} */ (options.calculationType));
                if (typ !== undefined && typ != -1) {
                    /** @type {?} */
                    var val = _this.calculation(groupRows, typ, col);
                    groupFooterRow.data[col.field] = val;
                }
                else {
                    groupFooterRow.data[col.field] = text || '';
                }
            }
            else {
                groupFooterRow.data[col.field] = '';
            }
        }));
    };
    /** 多字段分组
     * groupField 以逗号分隔，从左到右依次进行分组
     */
    /**
     * 多字段分组
     * groupField 以逗号分隔，从左到右依次进行分组
     * @private
     * @param {?} data
     * @return {?}
     */
    DatagridFacadeService.prototype.groupRows2 = /**
     * 多字段分组
     * groupField 以逗号分隔，从左到右依次进行分组
     * @private
     * @param {?} data
     * @return {?}
     */
    function (data) {
        var _this = this;
        if (data && data.length) {
            /** @type {?} */
            var columns_1 = this._state.flatColumns;
            /** @type {?} */
            var groupField = this._state.groupField || '';
            if (!groupField) {
                return data;
            }
            /** @type {?} */
            var groupData = this.arrToGroup(data, groupField.split(','));
            /** @type {?} */
            var result_1 = this.groupRows2Flat(groupData, 0, null);
            /** @type {?} */
            var k_1 = 0;
            /** @type {?} */
            var prow_1 = (/**
             * @param {?} pid
             * @return {?}
             */
            function (pid) { return result_1.find((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n[_this._state.idField] === pid; })); });
            result_1.map((/**
             * @param {?} n
             * @param {?} i
             * @return {?}
             */
            function (n, i) {
                if (!n[IS_GROUP_ROW_FIELD] && !n[IS_GROUP_FOOTER_ROW_FIELD]) {
                    n[ROW_INDEX_FIELD] = k_1;
                    k_1++;
                }
                // 更新合计行数据
                if (n[IS_GROUP_FOOTER_ROW_FIELD]) {
                    /** @type {?} */
                    var rows = prow_1(n[GROUP_ROW_FIELD]).rows.filter((/**
                     * @param {?} r
                     * @return {?}
                     */
                    function (r) { return !r[IS_GROUP_ROW_FIELD] && !r[IS_GROUP_FOOTER_ROW_FIELD]; }));
                    _this.updateGroupFooterData(n, columns_1, rows);
                }
                return n;
            }));
            return result_1;
        }
        return [];
    };
    /**
     * @param {?} groupFooter
     * @return {?}
     */
    DatagridFacadeService.prototype.showGroupFooter = /**
     * @param {?} groupFooter
     * @return {?}
     */
    function (groupFooter) {
        this.updateState({ groupFooter: groupFooter }, false);
        this.updateVirthualRows(0);
    };
    /**
     * @param {?} groupRowId
     * @return {?}
     */
    DatagridFacadeService.prototype.updateGroupFooter = /**
     * @param {?} groupRowId
     * @return {?}
     */
    function (groupRowId) {
        var _this = this;
        /** @type {?} */
        var groupRow = this._state.virtual.virtualRows.find((/**
         * @param {?} n
         * @return {?}
         */
        function (n) {
            return n['id'] === groupRowId;
        }));
        if (groupRow) {
            /** @type {?} */
            var groupRows = groupRow.rows;
            /** @type {?} */
            var groupFooterRows = groupRows.filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n['__group_footer__']; }));
            /** @type {?} */
            var columns_2 = this._state.flatColumns;
            /** @type {?} */
            var rows_1 = groupRows.filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return !n['__group_footer__']; }));
            groupFooterRows.forEach((/**
             * @param {?} n
             * @return {?}
             */
            function (n) {
                _this.updateGroupFooterData(n, columns_2, rows_1);
            }));
        }
    };
    /**
     * @private
     * @param {?} data
     * @param {?} typ
     * @param {?} col
     * @return {?}
     */
    DatagridFacadeService.prototype.calculation = /**
     * @private
     * @param {?} data
     * @param {?} typ
     * @param {?} col
     * @return {?}
     */
    function (data, typ, col) {
        /** @type {?} */
        var val = '';
        // TFS: 357000
        // http://10.24.1.11:8080/tfs/GSP/GSPCloud/web/_queries?id=357000&triage=true&fullScreen=false&_a=edit
        if (!data || !data.length) {
            return '';
        }
        /** @type {?} */
        var field = col.field;
        /** @type {?} */
        var arr = data.map((/**
         * @param {?} o
         * @return {?}
         */
        function (o) { return Utils.getValue(field, o) || 0; }));
        switch (typ) {
            case CalculationType.sum:
                // val = sumBy(data, (o) => Utils.getValue(field, o));
                val = BigNumber.sum.apply(null, arr).toFixed();
                break;
            case CalculationType.max:
                // const maxObj = maxBy(data, (o) => Utils.getValue(field, o));
                // val = Utils.getValue(field, maxObj);
                val = BigNumber.max.apply(null, arr).toFixed();
                break;
            case CalculationType.min:
                // const minObj = minBy(data, (o) => Utils.getValue(field, o));
                // val = Utils.getValue(field, minObj);
                val = BigNumber.min.apply(null, arr).toFixed();
                break;
            case CalculationType.average:
                // val = meanBy(data, (o) => Utils.getValue(field, o));
                val = BigNumber.sum.apply(null, arr).div(arr.length).toFixed();
                break;
            case CalculationType.count:
                val = data.length;
                break;
        }
        return val;
    };
    //#region 组件初始属性
    //#region 组件初始属性
    /**
     * @param {?} opts
     * @return {?}
     */
    DatagridFacadeService.prototype.setinitialOptions = 
    //#region 组件初始属性
    /**
     * @param {?} opts
     * @return {?}
     */
    function (opts) {
        this._state.initialOptions = {};
        // 分组
        this._state.initialOptions['groupField'] = opts.groupField;
        // 排序
        this._state.initialOptions['sort'] = {
            sortName: opts.sortName,
            sortOrder: opts.sortOrder
        };
        // 列显示隐藏、对齐方式
        if (opts.columns && opts.columns[0]) {
            this._state.initialOptions['columnFields'] = ((/** @type {?} */ (opts.columns[0]))).map((/**
             * @param {?} n
             * @return {?}
             */
            function (n) {
                return {
                    width: n.width || 100,
                    field: n.field,
                    halign: n.halign,
                    align: n.align,
                    visible: n.visible,
                    footer: cloneDeep(n.footer || {}),
                    groupFooter: cloneDeep(n.groupFooter || {})
                };
            }));
        }
    };
    DatagridFacadeService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    DatagridFacadeService.ctorParameters = function () { return [
        { type: HttpClient }
    ]; };
    return DatagridFacadeService;
}());
export { DatagridFacadeService };
if (false) {
    /** @type {?} */
    DatagridFacadeService.prototype.localId;
    /**
     * @type {?}
     * @protected
     */
    DatagridFacadeService.prototype._state;
    /** @type {?} */
    DatagridFacadeService.prototype.store;
    /** @type {?} */
    DatagridFacadeService.prototype.virtualRowSubject;
    /** @type {?} */
    DatagridFacadeService.prototype.gridSizeSubject;
    /** @type {?} */
    DatagridFacadeService.prototype.errorSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.selectRowSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.unSelectRowSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.columnResizeSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.clearSelectionSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.checkRowSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.unCheckRowSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.clearCheckedsSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.clearAllSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.checkAllSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.unCheckAllSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.selectAllSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.selectCellSubject;
    /** @type {?} */
    DatagridFacadeService.prototype.error$;
    /** @type {?} */
    DatagridFacadeService.prototype.selectRow$;
    /** @type {?} */
    DatagridFacadeService.prototype.unSelectRow$;
    /** @type {?} */
    DatagridFacadeService.prototype.columnResize$;
    /** @type {?} */
    DatagridFacadeService.prototype.clearSelections$;
    /** @type {?} */
    DatagridFacadeService.prototype.checkRow$;
    /** @type {?} */
    DatagridFacadeService.prototype.unCheckRow$;
    /** @type {?} */
    DatagridFacadeService.prototype.clearCheckeds$;
    /** @type {?} */
    DatagridFacadeService.prototype.clearAll$;
    /** @type {?} */
    DatagridFacadeService.prototype.checkAll$;
    /** @type {?} */
    DatagridFacadeService.prototype.unCheckAll$;
    /** @type {?} */
    DatagridFacadeService.prototype.selectAll$;
    /** @type {?} */
    DatagridFacadeService.prototype.currentCell$;
    /** @type {?} */
    DatagridFacadeService.prototype.editCell$;
    /** @type {?} */
    DatagridFacadeService.prototype.clientSort$;
    /** @type {?} */
    DatagridFacadeService.prototype.rowAppend$;
    /** @type {?} */
    DatagridFacadeService.prototype.rowUpdate$;
    /** @type {?} */
    DatagridFacadeService.prototype.rowDelete$;
    /** @type {?} */
    DatagridFacadeService.prototype.updateCheckboxState$;
    /** @type {?} */
    DatagridFacadeService.prototype.state$;
    /** @type {?} */
    DatagridFacadeService.prototype.columnGroup$;
    /** @type {?} */
    DatagridFacadeService.prototype.gridSize$;
    /** @type {?} */
    DatagridFacadeService.prototype.data$;
    /** @type {?} */
    DatagridFacadeService.prototype.difference;
    /** @type {?} */
    DatagridFacadeService.prototype.differenceBy;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.http;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YWdyaWQtZmFjYWRlLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWRhdGFncmlkLyIsInNvdXJjZXMiOlsibGliL3NlcnZpY2VzL2RhdGFncmlkLWZhY2FkZS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFTQSxPQUFPLEVBQUUsVUFBVSxFQUFFLFlBQVksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN6RCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDbEQsT0FBTyxFQUFFLGVBQWUsRUFBYyxFQUFFLEVBQVMsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ3ZFLE9BQU8sRUFBRSxHQUFHLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBcUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUNqSCxPQUFPLEVBQTJCLGVBQWUsRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUNwRSxPQUFPLEVBQXVCLGlCQUFpQixFQUN2QixlQUFlLEVBQUUsa0JBQWtCLEVBQUUsZUFBZSxFQUFFLHlCQUF5QixFQUFFLG1CQUFtQixFQUFFLGlCQUFpQixFQUFFLE1BQU0sU0FBUyxDQUFDO0FBR2pLLE9BQU8sRUFBRSxTQUFTLEVBQUUsT0FBTyxFQUErQixhQUFhLEVBQUUsT0FBTyxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBQ3BHLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUN2QyxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUNsRSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sY0FBYyxDQUFDO0FBQ3pDO0lBeUZJLCtCQUFvQixJQUFnQjtRQUFoQixTQUFJLEdBQUosSUFBSSxDQUFZO1FBdEZwQyxZQUFPLEdBQUcsUUFBUSxDQUFDOztRQUtuQixVQUFLLEdBQUcsSUFBSSxlQUFlLENBQXNCLElBQUksQ0FBQyxDQUFDO1FBRXZELHNC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SUFDbEQsNkNBQXFEOztJQUNyRCwwQ0FBK0I7O0lBQy9CLDRDQUFpQzs7SUFDakMsMkNBQWdDOztJQUNoQywyQ0FBZ0M7O0lBQ2hDLDJDQUFnQzs7SUFFaEMscURBQTBDOztJQUUxQyx1Q0FFRTs7SUFFRiw2Q0FPRTs7SUFFRiwwQ0FPRTs7SUFFRixzQ0FZRTs7SUFFRiwyQ0FBMkY7O0lBQzNGLDZDQUdDOzs7OztJQUVXLHFDQUF3QiIsInNvdXJjZXNDb250ZW50IjpbIi8qXHJcbiAqIEBBdXRob3I6IOeWr+eLguengOaJjShMdWNhcyBIdWFuZylcclxuICogQERhdGU6IDIwMTktMDgtMDYgMDc6NDM6NTNcclxuICogQExhc3RFZGl0b3JzOiDnlq/ni4Lnp4DmiY0oTHVjYXMgSHVhbmcpXHJcbiAqIEBMYXN0RWRpdFRpbWU6IDIwMTktMTEtMjAgMDc6Mzk6NDVcclxuICogQFFROiAxMDU1ODE4MjM5XHJcbiAqIEBWZXJzaW9uOiB2MC4wLjFcclxuICovXHJcblxyXG5pbXBvcnQgeyBJbmplY3RhYmxlLCBFdmVudEVtaXR0ZXIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgSHR0cENsaWVudCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcclxuaW1wb3J0IHsgQmVoYXZpb3JTdWJqZWN0LCBPYnNlcnZhYmxlLCBvZiwgbWVyZ2UsIFN1YmplY3QgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgbWFwLCBkaXN0aW5jdFVudGlsQ2hhbmdlZCwgZmlsdGVyLCBzd2l0Y2hNYXAsIGF1ZGl0VGltZSwgZGVib3VuY2VUaW1lLCBkZWJvdW5jZSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgRGF0YUNvbHVtbiwgQ29sdW1uR3JvdXAsIENhbGN1bGF0aW9uVHlwZSB9IGZyb20gJy4uL3R5cGVzJztcclxuaW1wb3J0IHsgRmFycmlzRGF0YWdyaWRTdGF0ZSwgaW5pdERhdGFHcmlkU3RhdGUsIERhdGFSZXN1bHQsIENlbGxJbmZvLCBWaXJ0dWFsaXplZFN0YXRlLCBTZWxlY3RlZFJvdyxcclxuICAgICAgICBSb3dEYXRhQ2hhbmdlcywgUk9XX0lOREVYX0ZJRUxELCBJU19HUk9VUF9ST1dfRklFTEQsIEdST1VQX1JPV19GSUVMRCwgSVNfR1JPVVBfRk9PVEVSX1JPV19GSUVMRCwgR1JPVVBfVklTSUJMRV9GSUVMRCwgR1JPVVBfTEVWRUxfRklFTEQgfSBmcm9tICcuL3N0YXRlJztcclxuaW1wb3J0IHsgVmlydHVhbGl6ZWRMb2FkZXJTZXJ2aWNlIH0gZnJvbSAnLi92aXJ0dWFsaXplZC1sb2FkZXIuc2VydmljZSc7XHJcbmltcG9ydCB7IERhdGFncmlkUm93IH0gZnJvbSAnLi4vdHlwZXMvZGF0YWdyaWQtcm93JztcclxuaW1wb3J0IHsgY2xvbmVEZWVwLCBncm91cEJ5LCBzdW1CeSwgbWF4QnksIG1pbkJ5LCBtZWFuQnksIGlzUGxhaW5PYmplY3QsIGZsYXR0ZW4gfSBmcm9tICdsb2Rhc2gtZXMnO1xyXG5pbXBvcnQgeyBVdGlscyB9IGZyb20gJy4uL3V0aWxzL3V0aWxzJztcclxuaW1wb3J0IHsgRGF0YWdyaWRDb2x1bW5zSGVscGVyIH0gZnJvbSAnLi9kYXRhZ3JpZC1jb2x1bW5zLmhlbHBlcic7XHJcbmltcG9ydCB7IEJpZ051bWJlciB9IGZyb20gJ2JpZ251bWJlci5qcyc7XHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIERhdGFncmlkRmFjYWRlU2VydmljZSB7XHJcblxyXG4gICAgbG9jYWxJZCA9ICd6aC1DSFMnO1xyXG5cclxuICAgIHByb3RlY3RlZCBfc3RhdGU6IEZhcnJpc0RhdGFncmlkU3RhdGU7XHJcbiAgICAvLyBwdWJsaWMgdmlydHVhbGl6ZWRTZXJ2aWNlOiBWaXJ0dWFsaXplZExvYWRlclNlcnZpY2U7XHJcblxyXG4gICAgc3RvcmUgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PEZhcnJpc0RhdGFncmlkU3RhdGU+KG51bGwpO1xyXG5cclxuICAgIHZpcnR1YWxSb3dTdWJqZWN0ID0gbmV3IEJlaGF2aW9yU3ViamVjdDxhbnk+KG51bGwpO1xyXG4gICAgZ3JpZFNpemVTdWJqZWN0ID0gbmV3IFN1YmplY3Q8YW55PigpO1xyXG4gICAgZXJyb3JTdWJqZWN0ID0gbmV3IFN1YmplY3QoKTtcclxuICAgIHByaXZhdGUgc2VsZWN0Um93U3ViamVjdCA9IG5ldyBTdWJqZWN0PGFueT4oKTtcclxuICAgIHByaXZhdGUgdW5TZWxlY3RSb3dTdWJqZWN0ID0gbmV3IFN1YmplY3Q8YW55PigpO1xyXG4gICAgcHJpdmF0ZSBjb2x1bW5SZXNpemVTdWJqZWN0ID0gbmV3IFN1YmplY3Q8YW55PigpO1xyXG4gICAgcHJpdmF0ZSBjbGVhclNlbGVjdGlvblN1YmplY3QgPSBuZXcgU3ViamVjdCgpO1xyXG4gICAgcHJpdmF0ZSBjaGVja1Jvd1N1YmplY3QgPSBuZXcgU3ViamVjdDxhbnk+KCk7XHJcbiAgICBwcml2YXRlIHVuQ2hlY2tSb3dTdWJqZWN0ID0gbmV3IFN1YmplY3Q8YW55PigpO1xyXG4gICAgcHJpdmF0ZSBjbGVhckNoZWNrZWRzU3ViamVjdCA9IG5ldyBTdWJqZWN0PGFueT4oKTtcclxuICAgIHByaXZhdGUgY2xlYXJBbGxTdWJqZWN0ID0gbmV3IFN1YmplY3Q8YW55PigpO1xyXG4gICAgcHJpdmF0ZSBjaGVja0FsbFN1YmplY3QgPSBuZXcgU3ViamVjdCgpO1xyXG4gICAgcHJpdmF0ZSB1bkNoZWNrQWxsU3ViamVjdCA9ICBuZXcgU3ViamVjdCgpO1xyXG4gICAgcHJpdmF0ZSBzZWxlY3RBbGxTdWJqZWN0ID0gbmV3IFN1YmplY3QoKTtcclxuICAgIHByaXZhdGUgc2VsZWN0Q2VsbFN1YmplY3QgPSBuZXcgU3ViamVjdCgpO1xyXG5cclxuICAgIGVycm9yJCA9IHRoaXMuZXJyb3JTdWJqZWN0LmFzT2JzZXJ2YWJsZSgpO1xyXG4gICAgc2VsZWN0Um93JCA9IHRoaXMuc2VsZWN0Um93U3ViamVjdC5hc09ic2VydmFibGUoKTtcclxuICAgIHVuU2VsZWN0Um93JCA9ICB0aGlzLnVuU2VsZWN0Um93U3ViamVjdC5hc09ic2VydmFibGUoKTtcclxuICAgIGNvbHVtblJlc2l6ZSQgPSB0aGlzLmNvbHVtblJlc2l6ZVN1YmplY3QuYXNPYnNlcnZhYmxlKCk7XHJcbiAgICBjbGVhclNlbGVjdGlvbnMkID0gdGhpcy5jbGVhclNlbGVjdGlvblN1YmplY3QuYXNPYnNlcnZhYmxlKCk7XHJcbiAgICBjaGVja1JvdyQgPSB0aGlzLmNoZWNrUm93U3ViamVjdC5hc09ic2VydmFibGUoKTtcclxuICAgIHVuQ2hlY2tSb3ckID0gdGhpcy51bkNoZWNrUm93U3ViamVjdC5hc09ic2VydmFibGUoKTtcclxuICAgIGNsZWFyQ2hlY2tlZHMkID0gdGhpcy5jbGVhckNoZWNrZWRzU3ViamVjdC5hc09ic2VydmFibGUoKTtcclxuICAgIGNsZWFyQWxsJCA9IHRoaXMuY2xlYXJBbGxTdWJqZWN0LmFzT2JzZXJ2YWJsZSgpO1xyXG4gICAgY2hlY2tBbGwkID0gdGhpcy5jaGVja0FsbFN1YmplY3QuYXNPYnNlcnZhYmxlKCk7XHJcbiAgICB1bkNoZWNrQWxsJCA9IHRoaXMudW5DaGVja0FsbFN1YmplY3QuYXNPYnNlcnZhYmxlKCk7XHJcbiAgICBzZWxlY3RBbGwkID0gdGhpcy5zZWxlY3RBbGxTdWJqZWN0LmFzT2JzZXJ2YWJsZSgpO1xyXG4gICAgY3VycmVudENlbGwkID0gdGhpcy5zZWxlY3RDZWxsU3ViamVjdC5hc09ic2VydmFibGUoKTtcclxuICAgIGVkaXRDZWxsJCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIGNsaWVudFNvcnQkID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gICAgcm93QXBwZW5kJCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIHJvd1VwZGF0ZSQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgICByb3dEZWxldGUkID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG5cclxuICAgIHVwZGF0ZUNoZWNrYm94U3RhdGUkID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG5cclxuICAgIHJlYWRvbmx5IHN0YXRlJCA9IHRoaXMuc3RvcmUuYXNPYnNlcnZhYmxlKCkucGlwZShcclxuICAgICAgICBmaWx0ZXIoIChzdGF0ZTogYW55KSA9PiBzdGF0ZSlcclxuICAgICk7XHJcblxyXG4gICAgcmVhZG9ubHkgY29sdW1uR3JvdXAkID0gdGhpcy5ncmlkU2l6ZVN1YmplY3QuYXNPYnNlcnZhYmxlKCkucGlwZShcclxuICAgICAgICBmaWx0ZXIoIChzdGF0ZTogYW55KSA9PiBzdGF0ZSksXHJcbiAgICAgICAgbWFwKChzdGF0ZTogRmFycmlzRGF0YWdyaWRTdGF0ZSkgPT4gc3RhdGUuY29sdW1uc0dyb3VwKSxcclxuICAgICAgICBzd2l0Y2hNYXAoKGNvbGdyb3VwOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIG9mKCBjb2xncm91cCk7XHJcbiAgICAgICAgfSksXHJcbiAgICAgICAgZGlzdGluY3RVbnRpbENoYW5nZWQoKVxyXG4gICAgKTtcclxuXHJcbiAgICBncmlkU2l6ZSQgPSB0aGlzLmdyaWRTaXplU3ViamVjdC5hc09ic2VydmFibGUoKS5waXBlKFxyXG4gICAgICAgIGZpbHRlciggKHN0YXRlOiBhbnkpID0+IHN0YXRlKSxcclxuICAgICAgICBtYXAoKHN0YXRlOiBGYXJyaXNEYXRhZ3JpZFN0YXRlKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHsgaGVhZGVySGVpZ2h0LCBwYWdlckhlaWdodCwgd2lkdGgsIGNvbHVtbnNHcm91cCwgaGVpZ2h0LCByb3dIZWlnaHQgfSA9IHsuLi5zdGF0ZX07XHJcbiAgICAgICAgICAgIHJldHVybiB7IGhlYWRlckhlaWdodCwgcGFnZXJIZWlnaHQsIHdpZHRoLCBjb2x1bW5zR3JvdXAsIGhlaWdodCwgcm93SGVpZ2h0IH07XHJcbiAgICAgICAgfSksXHJcbiAgICAgICAgZGlzdGluY3RVbnRpbENoYW5nZWQoKVxyXG4gICAgKTtcclxuXHJcbiAgICByZWFkb25seSBkYXRhJCA9IHRoaXMudmlydHVhbFJvd1N1YmplY3QucGlwZShcclxuICAgICAgICBmaWx0ZXIodnMgPT4gdnMpLFxyXG4gICAgICAgIHN3aXRjaE1hcCgodnM6IFZpcnR1YWxpemVkU3RhdGUpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIG9mKHtcclxuICAgICAgICAgICAgICAgIGluZGV4OiB2cy5zdGFydEluZGV4IHx8IDAsXHJcbiAgICAgICAgICAgICAgICByb3dzOiB2cy52aXJ0dWFsUm93cyB8fCBbXSxcclxuICAgICAgICAgICAgICAgIHRvcDogdnMudG9wSGlkZUhlaWdodCxcclxuICAgICAgICAgICAgICAgIGJvdHRvbTogdnMuYm90dG9tSGlkZUhlaWdodCxcclxuICAgICAgICAgICAgICAgIHNjcm9sbGluZzogdnMuaXNTY3JvbGxDaGFuZ2VcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSksXHJcbiAgICAgICAgZGlzdGluY3RVbnRpbENoYW5nZWQoKVxyXG4gICAgKTtcclxuXHJcbiAgICBkaWZmZXJlbmNlID0gKGZpcnN0OiBhbnlbXSwgc2Vjb25kOiBhbnlbXSkgPT4gZmlyc3QuZmlsdGVyKGl0ZW0gPT4gIXNlY29uZC5pbmNsdWRlcyhpdGVtKSk7XHJcbiAgICBkaWZmZXJlbmNlQnkgPSAoYSwgYiwgZm4pID0+IHtcclxuICAgICAgICBjb25zdCBzID0gbmV3IFNldChiLm1hcChmbikpO1xyXG4gICAgICAgIHJldHVybiBhLm1hcChmbikuZmlsdGVyKGVsID0+ICFzLmhhcyhlbCkpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgaHR0cDogSHR0cENsaWVudCkge1xyXG4gICAgICAgIHRoaXMuX3N0YXRlID0gIGNsb25lRGVlcChpbml0RGF0YUdyaWRTdGF0ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgdXBkYXRlVmlydGh1YWxSb3dzKHNjcm9sbHRvcDogbnVtYmVyLCBpc1Njcm9sbENoYW5nZSA9IGZhbHNlKSB7XHJcbiAgICAgICAgY29uc3QgdmlydHVhbCA9IHRoaXMuZ2V0VmlydGh1YWxSb3dzKHNjcm9sbHRvcCk7XHJcbiAgICAgICAgdmlydHVhbC5pc1Njcm9sbENoYW5nZSA9IGlzU2Nyb2xsQ2hhbmdlO1xyXG4gICAgICAgIHRoaXMudXBkYXRlU3RhdGUoe3ZpcnR1YWx9LCBmYWxzZSk7XHJcbiAgICAgICAgdGhpcy52aXJ0dWFsUm93U3ViamVjdC5uZXh0KHZpcnR1YWwpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldFZpcnRodWFsUm93cyhzY3JvbGx0b3ApOiBWaXJ0dWFsaXplZFN0YXRlIHtcclxuICAgICAgICBpZiAoc2Nyb2xsdG9wID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgc2Nyb2xsdG9wID0gMDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGRhdGEgPSAgdGhpcy5fc3RhdGUuZGF0YSB8fCBbXTtcclxuICAgICAgICBjb25zdCB2aXJ0dWFsID0ge3Jvd0luZGV4OiAwLCB2aXJ0dWFsUm93czogZGF0YSwgdG9wSGlkZUhlaWdodDogMCwgYm90dG9tSGlkZUhlaWdodDogMCB9O1xyXG5cclxuICAgICAgICBpZiAoZGF0YS5sZW5ndGggPT09IDAgfHwgKHRoaXMuX3N0YXRlLmF1dG9IZWlnaHQgJiYgIXRoaXMuX3N0YXRlLmdyb3VwUm93cykpIHtcclxuICAgICAgICAgICAgdmlydHVhbC52aXJ0dWFsUm93cyA9IGRhdGE7XHJcbiAgICAgICAgICAgIHJldHVybiB2aXJ0dWFsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuX3N0YXRlLmZsYXRDb2x1bW5zICYmIHRoaXMuX3N0YXRlLmZsYXRDb2x1bW5zLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAvLyBkYXRhID0gdGhpcy5fc3RhdGUuZGF0YTtcclxuXHJcbiAgICAgICAgICAgIC8vIGlmICghdGhpcy5fc3RhdGUuZ3JvdXBSb3dzKSB7XHJcbiAgICAgICAgICAgIC8vICAgICBpZiAodGhpcy5fc3RhdGUudmlydHVhbCAmJiB0aGlzLl9zdGF0ZS52aXJ0dWFsaXplZCkge1xyXG4gICAgICAgICAgICAvLyAgICAgICAgIHRoaXMudmlydHVhbGl6ZWRTZXJ2aWNlLnN0YXRlID0gdGhpcy5fc3RhdGU7XHJcbiAgICAgICAgICAgIC8vICAgICAgICAgY29uc3Qgcm93cyA9IHRoaXMudmlydHVhbGl6ZWRTZXJ2aWNlLmdldFJvd3Moc2Nyb2xsdG9wKTtcclxuICAgICAgICAgICAgLy8gICAgICAgICB2aXJ0dWFsID0geyAuLi50aGlzLl9zdGF0ZS52aXJ0dWFsLCAuLi5yb3dzIH07XHJcbiAgICAgICAgICAgIC8vICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyAgICAgICAgIHZpcnR1YWwudmlydHVhbFJvd3MgPSBkYXRhO1xyXG4gICAgICAgICAgICAvLyAgICAgfVxyXG4gICAgICAgICAgICAvLyB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyAgICAgLy8g6KGM5YiG57uE5pWw5o2u5aSE55CGXHJcbiAgICAgICAgICAgIC8vICAgICBjb25zdCBncm91cFJvd3MgPSB0aGlzLmdyb3VwUm93czIoY2xvbmVEZWVwKGRhdGEpKTtcclxuICAgICAgICAgICAgLy8gICAgIHZpcnR1YWwudmlydHVhbFJvd3MgPSBncm91cFJvd3M7XHJcbiAgICAgICAgICAgIC8vIH1cclxuICAgICAgICAgICAgaWYgKHRoaXMuX3N0YXRlLmdyb3VwUm93cykge1xyXG4gICAgICAgICAgICAgICAgLy8g6KGM5YiG57uE5pWw5o2u5aSE55CGXHJcbiAgICAgICAgICAgICAgICBjb25zdCBncm91cFJvd3MgPSB0aGlzLmdyb3VwUm93czIoY2xvbmVEZWVwKGRhdGEpKTtcclxuICAgICAgICAgICAgICAgIHZpcnR1YWwudmlydHVhbFJvd3MgPSBncm91cFJvd3M7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLl9zdGF0ZS5tZXJnZUNlbGwgJiYgdGhpcy5fc3RhdGUuZW5hYmxlQ2xpZW50U29ydEZvck1lcmdlQ2VsbCkge1xyXG4gICAgICAgICAgICB2aXJ0dWFsLnZpcnR1YWxSb3dzID0gdGhpcy5zb3J0KHZpcnR1YWwudmlydHVhbFJvd3MpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHZpcnR1YWw7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gZ2V0RGVsdGFUb3BIZWlnaHQoc2Nyb2xUb3AsIGZpcnN0SW5kZXgpIHtcclxuICAgIC8vICAgICBjb25zdCB7cm93c0xlbmd0aDogdmlld1Jvd3NDb3VudCwgdG9wLCBib3R0b219ID0gdGhpcy52aXJ0dWFsaXplZFNlcnZpY2UuZ2V0Um93c0NvdW50KHNjcm9sVG9wLCB0aGlzLl9zdGF0ZS5wYWdlU2l6ZSwgZmlyc3RJbmRleCk7XHJcbiAgICAvLyAgICAgY29uc3QgZ3JpZENvbnRhaW5lclJvd3NDb3VudCA9IHRoaXMudmlydHVhbGl6ZWRTZXJ2aWNlLmRpc3BsYXlSb3dzQ291bnQoKTtcclxuICAgIC8vICAgICBsZXQgZGVsdGFUb3BIZWlnaHQgPSAwO1xyXG4gICAgLy8gICAgIGlmICh2aWV3Um93c0NvdW50IDwgZ3JpZENvbnRhaW5lclJvd3NDb3VudCkge1xyXG4gICAgLy8gICAgICAgICBkZWx0YVRvcEhlaWdodCA9IChncmlkQ29udGFpbmVyUm93c0NvdW50IC0gdmlld1Jvd3NDb3VudCkgKiB0aGlzLl9zdGF0ZS5yb3dIZWlnaHQgLSB0aGlzLl9zdGF0ZS5oZWFkZXJIZWlnaHQ7XHJcbiAgICAvLyAgICAgfVxyXG5cclxuICAgIC8vICAgICByZXR1cm4gZGVsdGFUb3BIZWlnaHQ7XHJcbiAgICAvLyB9XHJcblxyXG4gICAgZ2V0RGF0YShvcmlnaW5hbCA9IGZhbHNlKSB7XHJcbiAgICAgICAgaWYgKG9yaWdpbmFsKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zdGF0ZS5vcmlnaW5hbERhdGEgfHwgW107XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLl9zdGF0ZS5kYXRhIHx8IFtdO1xyXG4gICAgfVxyXG5cclxuICAgIGdldFN0YXRlKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9zdGF0ZTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRWaXJ0dWFsU3RhdGUoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3N0YXRlLnZpcnR1YWw7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0UGFnZUluZm8oKSB7XHJcbiAgICAgICAgY29uc3QgeyBwYWdlSW5kZXgsIHBhZ2VTaXplIH0gPSB7Li4udGhpcy5fc3RhdGV9O1xyXG4gICAgICAgIHJldHVybiB7IHBhZ2VJbmRleCwgcGFnZVNpemUgfTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgaW5pdFN0YXRlKHN0YXRlOiBQYXJ0aWFsPEZhcnJpc0RhdGFncmlkU3RhdGU+KSB7XHJcbiAgICAgICAgdGhpcy51cGRhdGVTdGF0ZShzdGF0ZSwgZmFsc2UpO1xyXG4gICAgICAgIHRoaXMuX3N0YXRlLm9yaWdpbmFsRGF0YSA9IGNsb25lRGVlcCh0aGlzLl9zdGF0ZS5kYXRhKTtcclxuICAgICAgICB0aGlzLmluaXRDb2x1bW5zKCk7XHJcblxyXG4gICAgICAgIHRoaXMuZ3JpZFNpemVTdWJqZWN0Lm5leHQodGhpcy5fc3RhdGUpO1xyXG4gICAgICAgIHRoaXMudXBkYXRlVmlydGh1YWxSb3dzKDApO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICAvKiog5Yqg6L295pWw5o2uXHJcbiAgICAgKiBAcGFyYW0gZGF0YTog5pWw5o2u5YiX6KGoXHJcbiAgICAgKiBAcGFyYW0gdXBkYXRlT3JpZ2luYWxEYXRhIOaYr+WQpuabtOaWsOWOn+Wni+aVsOaNriwg6buY6K6k5Li6IHRydWVcclxuICAgICAqL1xyXG4gICAgbG9hZERhdGEoZGF0YTogYW55LCB1cGRhdGVPcmlnaW5hbERhdGEgPSB0cnVlLCBzb3J0YWJsZSA9IGZhbHNlKSB7XHJcbiAgICAgICAgZGF0YSA9IGRhdGEgfHwgW107XHJcbiAgICAgICAgdGhpcy51cGRhdGVTdGF0ZSh7IGRhdGEgfSwgZmFsc2UpO1xyXG5cclxuICAgICAgICBpZiAodXBkYXRlT3JpZ2luYWxEYXRhKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3N0YXRlLm9yaWdpbmFsRGF0YSA9IGNsb25lRGVlcCh0aGlzLl9zdGF0ZS5kYXRhKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHNvcnRhYmxlICYmIHRoaXMuX3N0YXRlLnNvcnROYW1lKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHNvcnRlZERhdGEgPSB0aGlzLnNvcnQodGhpcy5fc3RhdGUuZGF0YSk7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlU3RhdGUoeyBkYXRhOiBzb3J0ZWREYXRhIH0sIGZhbHNlKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyB0aGlzLnVwZGF0ZVN0YXRlKHsgZGF0YTogdGhpcy5fc3RhdGUub3JpZ2luYWxEYXRhIH0sIGZhbHNlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMudXBkYXRlVmlydGh1YWxSb3dzKHRoaXMuX3N0YXRlLnZpcnR1YWwuc2Nyb2xsVG9wIHx8IDApO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKiDlpI3ljp/mjIflrprooYznmoTmlbDmja4gKi9cclxuICAgIHJlc2V0Um93KHJvd0lkOiBhbnkpIHtcclxuICAgICAgICBjb25zdCBvcmlnRGF0YSA9IHRoaXMuX3N0YXRlLm9yaWdpbmFsRGF0YTtcclxuICAgICAgICBpZiAob3JpZ0RhdGEpIHtcclxuICAgICAgICAgICAgY29uc3Qgb3JpZ1Jvd0RhdGEgPSBvcmlnRGF0YS5maW5kKHIgPT4gdGhpcy5wcmltYXJ5SWQocikgPT09IHJvd0lkKTtcclxuICAgICAgICAgICAgdGhpcy5nZXRDdXJyZW50Um93KCkuZGF0YSA9IGNsb25lRGVlcChvcmlnUm93RGF0YSk7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlUm93KHJvd0lkLCBvcmlnUm93RGF0YSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIGxvYWREYXRhRm9yVmlydHVhbChkYXRhOiBhbnkpIHtcclxuICAgIC8vICAgICB0aGlzLnVwZGF0ZVN0YXRlKHsgZGF0YSB9LCBmYWxzZSk7XHJcbiAgICAvLyAgICAgLy8gdGhpcy52aXJ0dWFsaXplZFNlcnZpY2Uuc3RhdGUgPSB0aGlzLl9zdGF0ZTtcclxuICAgIC8vICAgICBjb25zdCB2aXJ0dWFsID0geyAuLi50aGlzLl9zdGF0ZS52aXJ0dWFsLCAuLi50aGlzLnZpcnR1YWxpemVkU2VydmljZS5yZWxvYWQoKSB9O1xyXG4gICAgLy8gICAgIHRoaXMudmlydHVhbFJvd1N1YmplY3QubmV4dCh2aXJ0dWFsKTtcclxuICAgIC8vICAgICB0aGlzLnVwZGF0ZVN0YXRlKHt2aXJ0dWFsfSk7XHJcbiAgICAvLyB9XHJcblxyXG4gICAgZmV0Y2hEYXRhKHVybDogc3RyaW5nKTogT2JzZXJ2YWJsZTxEYXRhUmVzdWx0PiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQodXJsKS5waXBlKFxyXG4gICAgICAgICAgICBtYXAoIHIgPT4gciBhcyBEYXRhUmVzdWx0IClcclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIHNldFRvdGFsKHRvdGFsOiBudW1iZXIpIHtcclxuICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlKCB7dG90YWx9LCBmYWxzZSApO1xyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZVByb3BlcnR5KHByb3BlcnR5OiBzdHJpbmcsIHZhbHVlOiBhbnkpIHtcclxuICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlKHsgW3Byb3BlcnR5XTogdmFsdWUgfSwgZmFsc2UpO1xyXG4gICAgfVxyXG5cclxuICAgIHNldFBhZ2luYXRpb24ocGFnZUluZGV4OiBudW1iZXIsIHBhZ2VTaXplOiBudW1iZXIsIHRvdGFsOiBudW1iZXIpIHtcclxuICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlKCB7IHBhZ2VJbmRleCwgcGFnZVNpemUsIHRvdGFsIH0sIGZhbHNlKTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRTY3JvbGxUb3Aoc2Nyb2xsVG9wOiBudW1iZXIpIHtcclxuICAgICAgICBjb25zdCB2aXJ0dWFsID0geyAuLi50aGlzLl9zdGF0ZS52aXJ0dWFsLCBzY3JvbGxUb3B9O1xyXG4gICAgICAgIHRoaXMudXBkYXRlU3RhdGUoe3ZpcnR1YWx9LCBmYWxzZSk7XHJcbiAgICB9XHJcblxyXG4gICAgaXNNdWx0aVNlbGVjdCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fc3RhdGUubXVsdGlTZWxlY3Q7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfaXNSb3dTZWxlY3RlZChpZDogYW55KSB7XHJcbiAgICAgICAgaWYgKCFpZCB8fCAhdGhpcy5fc3RhdGUuY3VycmVudFJvdykge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3N0YXRlLmN1cnJlbnRSb3cuaWQudG9TdHJpbmcoKSA9PT0gaWQudG9TdHJpbmcoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaXNSb3dTZWxlY3RlZChpZDogYW55LCBzZWxlY3Rpb25zID0gbnVsbCkge1xyXG4gICAgICAgIGNvbnN0IGZsYWcgPSB0aGlzLl9pc1Jvd1NlbGVjdGVkKGlkKTtcclxuICAgICAgICBpZiAoIXRoaXMuaXNNdWx0aVNlbGVjdCgpIHx8IHRoaXMuX3N0YXRlLm9ubHlTZWxlY3RTZWxmKSB7XHJcbiAgICAgICAgICAgcmV0dXJuIGZsYWc7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKCFzZWxlY3Rpb25zKSB7XHJcbiAgICAgICAgICAgICAgICBzZWxlY3Rpb25zID0gdGhpcy5fc3RhdGUuc2VsZWN0aW9ucztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuX2NhbkNhbmNlbFNlbGVjdFdoZW5NdWx0aSgpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmxhZztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKCFzZWxlY3Rpb25zIHx8IHNlbGVjdGlvbnMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZWN0aW9ucy5maW5kSW5kZXgoc3IgPT4gc3IuaWQgPT0gaWQpID4gLTE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaXNSb3dDaGVja2VkKGlkOiBhbnksIGNoZWNrZWRzID0gbnVsbCkge1xyXG4gICAgICAgIGlmICghY2hlY2tlZHMpIHtcclxuICAgICAgICAgICAgY2hlY2tlZHMgPSB0aGlzLmdldENoZWNrZWRzKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghaWQgfHwgIWNoZWNrZWRzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gY2hlY2tlZHMuZmluZEluZGV4KHNyID0+IHNyLmlkLnRvU3RyaW5nKCkgPT09IGlkLnRvU3RyaW5nKCkpID4gLTE7XHJcbiAgICB9XHJcblxyXG4gICAgaXNDaGVja0FsbCgpIHtcclxuICAgICAgICBjb25zdCBhbGxSb3dzID0gdGhpcy5nZXRBbGxSb3dzRm9yTGl2ZSgpLm1hcChyID0+IHRoaXMucHJpbWFyeUlkKHIpKTtcclxuICAgICAgICBjb25zdCBjaGVja0lkcyA9IHRoaXMuX3N0YXRlLmNoZWNrZWRSb3dzLm1hcChyID0+IHIuaWQpO1xyXG4gICAgICAgIGlmICh0aGlzLmRpZmZlcmVuY2UoYWxsUm93cywgY2hlY2tJZHMpLmxlbmd0aCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7IC8vIHRoaXMuX3N0YXRlLmNoZWNrZWRSb3dzLmxlbmd0aCA9PT0gYWxsUm93cy5sZW5ndGg7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldEN1cnJlbnRQYWdlQ2hlY2tlZHMoKSB7XHJcbiAgICAgICAgY29uc3QgYWxsUm93cyA9IHRoaXMuZ2V0QWxsUm93c0ZvckxpdmUoKS5tYXAociA9PiB0aGlzLnByaW1hcnlJZChyKSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3N0YXRlLmNoZWNrZWRSb3dzLmZpbHRlcihuID0+IGFsbFJvd3MuaW5kZXhPZihuLmlkKSA+IC0xKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRDdXJyZW50Um93KCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9zdGF0ZS5jdXJyZW50Um93IHx8IHVuZGVmaW5lZDtcclxuICAgIH1cclxuXHJcbiAgICBnZXRTZWxlY3Rpb25zKCkge1xyXG4gICAgICAgIC8vIOWmguaenOaVsOaNrua6kOWPmOS6hu+8jOmcgOimgemHjeaWsOiuoeeul1xyXG4gICAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLl9zdGF0ZS5kYXRhO1xyXG4gICAgICAgIGlmICh0aGlzLl9zdGF0ZS5zZWxlY3Rpb25zICYmIHRoaXMuX3N0YXRlLnNlbGVjdGlvbnMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGlmICghZGF0YSB8fCAhZGF0YS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3N0YXRlLnNlbGVjdGlvbnMgPSBbXTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHRlbXA6IGFueVtdID0gZGF0YS5tYXAobiA9PiB0aGlzLnByaW1hcnlJZChuKSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9zdGF0ZS5zZWxlY3Rpb25zID0gdGhpcy5fc3RhdGUuc2VsZWN0aW9ucy5maWx0ZXIobiA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRlbXAuaW5jbHVkZXMobi5pZCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5fc3RhdGUuc2VsZWN0aW9ucyB8fCBbXTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldENoZWNrZWRSb3dzRnJvbVNvdXJjZSgpIHtcclxuICAgICAgICByZXR1cm4gKHRoaXMuX3N0YXRlLmNoZWNrZWRSb3dzIHx8IFtdKS5tYXAobiA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGQgPSB0aGlzLmZpbmRSb3cobi5pZCk7XHJcbiAgICAgICAgICAgIGlmIChkICYmIGQuZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgbi5kYXRhID0gZC5kYXRhO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBuO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGdldENoZWNrZWRzKGZyb21EYXRhU291cmNlID0gZmFsc2UpIHtcclxuICAgICAgICBpZiAoZnJvbURhdGFTb3VyY2UpIHtcclxuICAgICAgICAgICAgdGhpcy5fc3RhdGUuY2hlY2tlZFJvd3MgPSB0aGlzLmdldENoZWNrZWRSb3dzRnJvbVNvdXJjZSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3N0YXRlLmNoZWNrZWRSb3dzIHx8IFtdO1xyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZUNoZWNrZWREYXRhKHJvd2lkOiBhbnksIHJvd0RhdGE6IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0pIHtcclxuICAgICAgICBjb25zdCBjaGVja2VkcyA9IHRoaXMuZ2V0Q2hlY2tlZHMoKTtcclxuICAgICAgICBpZiAoY2hlY2tlZHMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSBjaGVja2Vkcy5maW5kKG4gPT4gdGhpcy5wcmltYXJ5SWQobikgPT0gcm93aWQpO1xyXG4gICAgICAgICAgICBpZiAoaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgT2JqZWN0LmtleXMocm93RGF0YSkuZm9yRWFjaChrID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBVdGlscy5zZXRWYWx1ZShrLCByb3dEYXRhW2tdLCBpdGVtLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc2V0Q2hlY2tlZFJvd3MoaWRzOiBzdHJpbmdbXSwgY2hlY2tlZCA9IHRydWUpIHtcclxuICAgICAgICBpZiAoaWRzICYmIGlkcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgbGV0IGNoZWNrZWRzID0gdGhpcy5fc3RhdGUuY2hlY2tlZFJvd3MgfHwgW107XHJcblxyXG4gICAgICAgICAgICBpZHMuZm9yRWFjaChpZCA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCByb3cgPSB0aGlzLmZpbmRSb3coaWQpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNoZWNrZWQgJiYgcm93KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCAhdGhpcy5pc1Jvd0NoZWNrZWQoaWQsIGNoZWNrZWRzKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzcm93ID0geyBpZDogdGhpcy5wcmltYXJ5SWQocm93LmRhdGEpLCBkYXRhOiByb3cuZGF0YSwgaW5kZXg6IHJvdy5pbmRleCB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGVja2Vkcy5wdXNoKHNyb3cpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9zdGF0ZS5lbmFibGVNb3JlUGFnZVNlbGVjdCB8fCAhY2hlY2tlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGVja2VkcyA9IGNoZWNrZWRzLmZpbHRlcihzciA9PiBzci5pZCAhPT0gaWQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHRoaXMuX3N0YXRlLmNoZWNrZWRSb3dzID0gY2hlY2tlZHM7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5fY2xlYXJDaGVja2VkcygpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjaGVja1JlY29yZChpZDogYW55LCBjaGVja2VkID0gdHJ1ZSkge1xyXG4gICAgICAgIGlmIChpZCkge1xyXG4gICAgICAgICAgICBjb25zdCByb3cgPSB0aGlzLmZpbmRSb3coaWQpO1xyXG4gICAgICAgICAgICBpZiAocm93KSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB7aW5kZXg6IHJvd0luZGV4LCBkYXRhOiByb3dEYXRhfSA9IHsuLi5yb3d9O1xyXG4gICAgICAgICAgICAgICAgaWYgKGNoZWNrZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNoZWNrUm93KHJvd0luZGV4LCByb3dEYXRhKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51bkNoZWNrUm93KHJvd0luZGV4LCByb3dEYXRhKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZXJyb3JTdWJqZWN0Lm5leHQoYOacquaJvuWIsElE5Li6JHtpZH3nmoTmlbDmja7jgIJgKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuZXJyb3JTdWJqZWN0Lm5leHQoYOWPguaVsGlkIOS4jeiDveS4uuepuuOAgmApO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjaGVja1Jvdyhyb3dJbmRleDogbnVtYmVyLCByb3dEYXRhOiBhbnksIGdyaWQ6IGFueSA9IG51bGwpIHtcclxuICAgICAgICBpZiAoIXRoaXMuX3N0YXRlLm11bHRpU2VsZWN0KSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2NsZWFyQ2hlY2tlZHMoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGlkID0gdGhpcy5wcmltYXJ5SWQocm93RGF0YSk7XHJcbiAgICAgICAgY29uc3QgY2hlY2tlZHMgPSB0aGlzLl9zdGF0ZS5jaGVja2VkUm93cyB8fCBbXTtcclxuXHJcbiAgICAgICAgY29uc3Qgc3JvdyA9IHsgaWQsIGRhdGE6IHJvd0RhdGEsIGluZGV4OiByb3dJbmRleCB9O1xyXG4gICAgICAgIGlmIChpZCAmJiAhdGhpcy5pc1Jvd0NoZWNrZWQoaWQsIGNoZWNrZWRzKSkge1xyXG4gICAgICAgICAgICBjaGVja2Vkcy5wdXNoKHNyb3cpO1xyXG4gICAgICAgICAgICB0aGlzLl9zdGF0ZS5jaGVja2VkUm93cyA9IGNoZWNrZWRzO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuX3N0YXRlLnNlbGVjdE9uQ2hlY2spIHtcclxuICAgICAgICAgICAgICAgIGlmIChncmlkICYmIGdyaWQuaW5zdGFuY2UgJiYgZ3JpZC5pbnN0YW5jZS5iZWZvcmVTZWxlY3QpIHtcclxuICAgICAgICAgICAgICAgICAgICBncmlkLmluc3RhbmNlLmJlZm9yZVNlbGVjdCh7IHJvd0luZGV4LCByb3dEYXRhLCBncmlkSW5zdGFuY2U6IGdyaWQuaW5zdGFuY2UgfSkuc3Vic2NyaWJlKChlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdFJvdyhyb3dJbmRleCwgcm93RGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RSb3cocm93SW5kZXgsIHJvd0RhdGEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLmNoZWNrUm93U3ViamVjdC5uZXh0KHNyb3cpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy51cGRhdGVDaGVja2JveFN0YXRlJC5lbWl0KHsuLi5zcm93LCBjaGVja2VkOiB0cnVlfSk7XHJcbiAgICB9XHJcblxyXG4gICAgdW5DaGVja1Jvdyhyb3dJbmRleDogbnVtYmVyLCByb3dEYXRhOiBhbnksIGdyaWQ6IGFueSA9IG51bGwpIHtcclxuICAgICAgICBjb25zdCBpZCA9IHRoaXMucHJpbWFyeUlkKHJvd0RhdGEpO1xyXG4gICAgICAgIGxldCBjaGVja2VkcyA9IHRoaXMuX3N0YXRlLmNoZWNrZWRSb3dzIHx8IFtdO1xyXG4gICAgICAgIGNvbnN0IHNyb3cgPSB7IGlkLCBkYXRhOiByb3dEYXRhLCBpbmRleDogcm93SW5kZXggfTtcclxuICAgICAgICBpZiAodGhpcy5pc1Jvd0NoZWNrZWQoaWQsIGNoZWNrZWRzKSkge1xyXG4gICAgICAgICAgICBjaGVja2VkcyA9IGNoZWNrZWRzLmZpbHRlcihzciA9PiAnJyArIHNyLmlkICE9PSAnJyArIGlkKTtcclxuICAgICAgICAgICAgdGhpcy5fc3RhdGUuY2hlY2tlZFJvd3MgPSBjaGVja2VkcztcclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLl9zdGF0ZS5zZWxlY3RPbkNoZWNrKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZ3JpZCAmJiBncmlkLmluc3RhbmNlICYmIGdyaWQuaW5zdGFuY2UuYmVmb3JlVW5zZWxlY3QpIHtcclxuICAgICAgICAgICAgICAgICAgICBncmlkLmluc3RhbmNlLmJlZm9yZVVuc2VsZWN0KHsgcm93SW5kZXgsIHJvd0RhdGEsIGdyaWRJbnN0YW5jZTogZ3JpZC5pbnN0YW5jZSB9KS5zdWJzY3JpYmUoKGUpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudW5TZWxlY3RSb3cocm93SW5kZXgsIHJvd0RhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnVuU2VsZWN0Um93KHJvd0luZGV4LCByb3dEYXRhKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy51bkNoZWNrUm93U3ViamVjdC5uZXh0KHNyb3cpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy51cGRhdGVDaGVja2JveFN0YXRlJC5lbWl0KHsuLi5zcm93LCBjaGVja2VkOiBmYWxzZX0pO1xyXG4gICAgfVxyXG5cclxuICAgIHNldEN1cnJlbnRQYWdlRGF0YShkYXRhOiBhbnkpIHtcclxuICAgICAgICB0aGlzLl9zdGF0ZS5jdXJyZW50UGFnZURhdGEgPSBkYXRhO1xyXG4gICAgfVxyXG5cclxuICAgIGdldEN1cnJlbnRQYWdlRGF0YSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fc3RhdGUuY3VycmVudFBhZ2VEYXRhIHx8IFtdO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICAvKiog6I635Y+W5omA5pyJ5Y+v5Lul5pON5L2c55qE6KGMICovXHJcbiAgICBwcml2YXRlIGdldEFsbFJvd3NGb3JMaXZlKCkge1xyXG4gICAgICAgIGxldCBhbGxEYXRhID0gdGhpcy5fc3RhdGUuZGF0YSB8fCBbXTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuX3N0YXRlLnBhZ2luYXRpb24gJiYgIXRoaXMuX3N0YXRlLnBhZ2VyT25TZXJ2ZXIpIHtcclxuICAgICAgICAgICAgLy8g6I635Y+W5b2T5YmN6aG15pWw5o2uXHJcbiAgICAgICAgICAgIGFsbERhdGEgPSB0aGlzLmdldEN1cnJlbnRQYWdlRGF0YSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8g5o6S6Zmk5o6J56aB55So55qE6KGMXHJcbiAgICAgICAgaWYgKHRoaXMuX3N0YXRlLmRpc2FibGVSb3cpIHtcclxuICAgICAgICAgICAgYWxsRGF0YSA9IGFsbERhdGEuZmlsdGVyKChuLCBpKSA9PiAhdGhpcy5fc3RhdGUuZGlzYWJsZVJvdyhuLCBpKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBhbGxEYXRhO1xyXG4gICAgfVxyXG5cclxuICAgIGNoZWNrQWxsKCkge1xyXG4gICAgICAgIHRoaXMuX3N0YXRlLmNoZWNrZWRSb3dzID0gdGhpcy5fc3RhdGUuY2hlY2tlZFJvd3MgfHwgW107XHJcbiAgICAgICAgY29uc3QgYWxsRGF0YSA9IHRoaXMuZ2V0QWxsUm93c0ZvckxpdmUoKTtcclxuICAgICAgICBjb25zdCBhbGxDaGVja2VkcyA9IGFsbERhdGEubWFwKCAociwgaSkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgaWQ6IHRoaXMucHJpbWFyeUlkKHIpLFxyXG4gICAgICAgICAgICAgICAgaW5kZXg6IGksXHJcbiAgICAgICAgICAgICAgICBkYXRhOiByXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGlmICghdGhpcy5fc3RhdGUuY2hlY2tlZFJvd3MubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3N0YXRlLmNoZWNrZWRSb3dzID0gYWxsQ2hlY2tlZHM7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY29uc3QgX2NoZWNrZWRzID0gW107XHJcbiAgICAgICAgICAgIGFsbENoZWNrZWRzLmZvckVhY2goZWxlbWVudCA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX3N0YXRlLmNoZWNrZWRSb3dzLmZpbmQobiA9PiBuLmlkID09IGVsZW1lbnQuaWQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgX2NoZWNrZWRzLnB1c2goZWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5fc3RhdGUuY2hlY2tlZFJvd3MgPSB0aGlzLl9zdGF0ZS5jaGVja2VkUm93cy5jb25jYXQoX2NoZWNrZWRzKTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBpZiAodGhpcy5fc3RhdGUuc2VsZWN0T25DaGVjayAmJiAhdGhpcy5fc3RhdGUub25seVNlbGVjdFNlbGYpIHtcclxuICAgICAgICAgICAgdGhpcy5fc3RhdGUuc2VsZWN0aW9ucyA9IFtdO1xyXG4gICAgICAgICAgICB0aGlzLl9zdGF0ZS5zZWxlY3Rpb25zID0gYWxsRGF0YS5tYXAoIChyLCBpKSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlkOiB0aGlzLnByaW1hcnlJZChyKSxcclxuICAgICAgICAgICAgICAgICAgICBpbmRleDogaSxcclxuICAgICAgICAgICAgICAgICAgICBkYXRhOiByXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuY2hlY2tBbGxTdWJqZWN0Lm5leHQodGhpcy5fc3RhdGUuY2hlY2tlZFJvd3MpO1xyXG4gICAgfVxyXG5cclxuICAgIHNlbGVjdEFsbCgpIHtcclxuICAgICAgICB0aGlzLl9zdGF0ZS5zZWxlY3Rpb25zID0gW107XHJcblxyXG4gICAgICAgIGNvbnN0IGFsbERhdGEgPSB0aGlzLmdldEFsbFJvd3NGb3JMaXZlKCk7XHJcblxyXG4gICAgICAgIHRoaXMuX3N0YXRlLnNlbGVjdGlvbnMgPSBhbGxEYXRhLm1hcCggKHIsIGkpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIGlkOiB0aGlzLnByaW1hcnlJZChyKSxcclxuICAgICAgICAgICAgICAgIGluZGV4OiBpLFxyXG4gICAgICAgICAgICAgICAgZGF0YTogclxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5fc3RhdGUuY2hlY2tPblNlbGVjdCkge1xyXG4gICAgICAgICAgICB0aGlzLl9zdGF0ZS5jaGVja2VkUm93cyA9IFtdO1xyXG4gICAgICAgICAgICB0aGlzLl9zdGF0ZS5jaGVja2VkUm93cyA9IGFsbERhdGEubWFwKCAociwgaSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICBpZDogdGhpcy5wcmltYXJ5SWQociksXHJcbiAgICAgICAgICAgICAgICAgICAgaW5kZXg6IGksXHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogclxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnNlbGVjdEFsbFN1YmplY3QubmV4dCh0aGlzLl9zdGF0ZS5zZWxlY3Rpb25zKTtcclxuICAgIH1cclxuXHJcbiAgICBmaW5kUm93KGlkKToge2luZGV4OiBudW1iZXIsIGRhdGE6IGFueX0ge1xyXG4gICAgICAgIGlmICh0aGlzLl9zdGF0ZS5kYXRhICYmIHRoaXMuX3N0YXRlLmRhdGEubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGxldCBpbmRleCA9IC0xO1xyXG4gICAgICAgICAgICBjb25zdCBkYXRhID0gdGhpcy5fc3RhdGUuZGF0YS5maW5kKCAobiwgaSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgciA9IHRoaXMucHJpbWFyeUlkKG4pID09IGlkO1xyXG4gICAgICAgICAgICAgICAgaWYgKHIpIHtcclxuICAgICAgICAgICAgICAgICAgICBpbmRleCA9IGk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcjtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGlmIChpbmRleCA9PT0gLTEpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB7aW5kZXgsIGRhdGF9O1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBmaW5kUm93SW5kZXgoaWQpIHtcclxuICAgICAgICBpZiAodGhpcy5fc3RhdGUuZGF0YSAmJiB0aGlzLl9zdGF0ZS5kYXRhLmxlbmd0aCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fc3RhdGUuZGF0YS5maW5kSW5kZXgobiA9PiB0aGlzLnByaW1hcnlJZChuKSA9PT0gaWQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gLTE7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOiuvue9rumAieS4reihjO+8jOS4jeinpuWPkWdyaWQg6YCJ5Lit5LqL5Lu277yM5Y+W5raI6YCJ5Lit5LqL5Lu2XHJcbiAgICAgKi9cclxuICAgIHNldFNlbGVjdFJvdyhpZDogc3RyaW5nLCBzZWxlY3QgPSB0cnVlKSB7XHJcbiAgICAgICAgY29uc3Qgcm93ID0gdGhpcy5maW5kUm93KGlkKTtcclxuICAgICAgICBjb25zdCB7aW5kZXg6IHJvd0luZGV4LCBkYXRhOiByb3dEYXRhfSA9IHsuLi5yb3d9O1xyXG4gICAgICAgIGNvbnN0IHNyb3cgPSB7IGlkLCBkYXRhOiByb3dEYXRhLCBpbmRleDogcm93SW5kZXggfTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuaXNNdWx0aVNlbGVjdCgpKSB7XHJcbiAgICAgICAgICAgIGlmIChzZWxlY3QpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0Um93Rm9yTXVsdGkoc3JvdywgZmFsc2UpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy51blNlbGVjdFJvd0Zvck11bHRpKHNyb3csIGZhbHNlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgX3NyID0gc2VsZWN0ID8gc3JvdyA6IG51bGw7XHJcbiAgICAgICAgdGhpcy51cGRhdGVTdGF0ZSh7IGN1cnJlbnRSb3c6IF9zcn0sIGZhbHNlKTtcclxuICAgIH1cclxuXHJcbiAgICBzZWxlY3RSZWNvcmQoaWQ6IGFueSwgc2VsZWN0ID0gdHJ1ZSkge1xyXG4gICAgICAgIGlmIChpZCkge1xyXG4gICAgICAgICAgICBjb25zdCByb3cgPSB0aGlzLmZpbmRSb3coaWQpO1xyXG4gICAgICAgICAgICBpZiAocm93KSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB7aW5kZXg6IHJvd0luZGV4LCBkYXRhOiByb3dEYXRhfSA9IHsuLi5yb3d9O1xyXG4gICAgICAgICAgICAgICAgaWYgKHNlbGVjdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0Um93KHJvd0luZGV4LCByb3dEYXRhKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51blNlbGVjdFJvdyhyb3dJbmRleCwgcm93RGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmVycm9yU3ViamVjdC5uZXh0KGDmnKrmib7liLBJROS4uiR7aWR955qE5pWw5o2u44CCYCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmVycm9yU3ViamVjdC5uZXh0KGDlj4LmlbBpZCDkuI3og73kuLrnqbrjgIJgKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc2VsZWN0Um93KHJvd0luZGV4OiBudW1iZXIsIHJvd0RhdGE6IGFueSwgZ3JpZE9wdHMgPSBudWxsKSB7XHJcbiAgICAgICAgY29uc3QgaXNNdWx0aVNlbGVjdCA9IHRoaXMuaXNNdWx0aVNlbGVjdCgpO1xyXG4gICAgICAgIGNvbnN0IGlkID0gdGhpcy5wcmltYXJ5SWQocm93RGF0YSk7XHJcbiAgICAgICAgY29uc3Qgc3JvdyA9IHsgaWQsIGRhdGE6IHJvd0RhdGEsIGluZGV4OiByb3dJbmRleCB9O1xyXG5cclxuICAgICAgICBpZiAoIXRoaXMuaXNSb3dTZWxlY3RlZChpZCkgfHwgIXRoaXMuX3N0YXRlLmN1cnJlbnRSb3cpIHtcclxuICAgICAgICAgICAgaWYgKCFpc011bHRpU2VsZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlKHsgY3VycmVudFJvdzogc3JvdyB9LCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdFJvd1N1YmplY3QubmV4dCh0aGlzLl9zdGF0ZS5jdXJyZW50Um93KTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fc3RhdGUuc2hvd0NoZWNrYm94ICYmIHRoaXMuX3N0YXRlLmNoZWNrT25TZWxlY3QpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9zdGF0ZS5jaGVja2VkUm93cyA9IFsgc3JvdyBdO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoZ3JpZE9wdHMgJiYgZ3JpZE9wdHMuaW5zdGFuY2UgJiYgZ3JpZE9wdHMuaW5zdGFuY2UuYmVmb3JlQ2hlY2spIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ3JpZE9wdHMuaW5zdGFuY2UuYmVmb3JlQ2hlY2soeyByb3dJbmRleCwgcm93RGF0YSwgZ3JpZEluc3RhbmNlOiBncmlkT3B0cy5pbnN0YW5jZSB9KS5zdWJzY3JpYmUoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jaGVja1Jvd1N1YmplY3QubmV4dChzcm93KTsgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tSb3dTdWJqZWN0Lm5leHQoc3Jvdyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RSb3dGb3JNdWx0aShzcm93LCB0cnVlLCBncmlkT3B0cyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzZWxlY3RSb3dGb3JNdWx0aShzcm93OiB7IGlkOiBhbnksIGRhdGE6IGFueSwgaW5kZXg6IGFueSB9LCBlbWl0ID0gdHJ1ZSwgZ3JpZE9wdHMgPSBudWxsKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX3N0YXRlLm9ubHlTZWxlY3RTZWxmKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2NsZWFyU2VsZWN0aW9ucygpO1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlKHsgY3VycmVudFJvdzogc3Jvdywgc2VsZWN0aW9uczogW3Nyb3ddIH0sIGZhbHNlKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLl9zdGF0ZS5zZWxlY3Rpb25zID0gdGhpcy5fc3RhdGUuc2VsZWN0aW9ucyB8fCBbXTtcclxuICAgICAgICAgICAgdGhpcy5fc3RhdGUuc2VsZWN0aW9ucyA9IHRoaXMuX3N0YXRlLnNlbGVjdGlvbnMuZmlsdGVyKHNyID0+IHNyLmlkICE9PSBzcm93LmlkKTtcclxuICAgICAgICAgICAgdGhpcy5fc3RhdGUuc2VsZWN0aW9ucy5wdXNoKHNyb3cpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoZW1pdCkge1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdFJvd1N1YmplY3QubmV4dChzcm93KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLl9zdGF0ZS5jaGVja09uU2VsZWN0KSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2hlY2tSb3coc3Jvdy5pbmRleCwgc3Jvdy5kYXRhLCBncmlkT3B0cyk7ICAgICAgICBcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSB1blNlbGVjdFJvd0Zvck11bHRpKHNyb3c6IHsgaWQ6IGFueSwgZGF0YTogYW55LCBpbmRleDogYW55IH0sIGVtaXQgPSB0cnVlLCBncmlkT3B0cyA9IG51bGwpIHtcclxuICAgICAgICB0aGlzLl9zdGF0ZS5zZWxlY3Rpb25zID0gdGhpcy5fc3RhdGUuc2VsZWN0aW9ucy5maWx0ZXIoc3IgPT4gc3IuaWQgIT09IHNyb3cuaWQpO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5fY2FuQ2FuY2VsU2VsZWN0V2hlbk11bHRpKCkgfHwgKHRoaXMuX3N0YXRlLmN1cnJlbnRSb3cgJiYgdGhpcy5fc3RhdGUuY3VycmVudFJvdy5pZCA9PT0gc3Jvdy5pZCkpIHtcclxuICAgICAgICAgICAgdGhpcy51cGRhdGVTdGF0ZSh7IGN1cnJlbnRSb3c6IG51bGwgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5fc3RhdGUuY2hlY2tPblNlbGVjdCkge1xyXG4gICAgICAgICAgICB0aGlzLnVuQ2hlY2tSb3coc3Jvdy5pbmRleCwgc3Jvdy5kYXRhLCBncmlkT3B0cyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoZW1pdCkge1xyXG4gICAgICAgICAgICB0aGlzLnVuU2VsZWN0Um93U3ViamVjdC5uZXh0KHNyb3cpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcblxyXG4gICAgdW5TZWxlY3RSb3cocm93SW5kZXg6IG51bWJlciwgcm93RGF0YTogYW55LCBncmlkT3B0cyA9IG51bGwpIHtcclxuICAgICAgICBjb25zdCBpZCA9IHRoaXMucHJpbWFyeUlkKHJvd0RhdGEpO1xyXG4gICAgICAgIGNvbnN0IGlzTXVsdGlTZWxlY3QgPSB0aGlzLmlzTXVsdGlTZWxlY3QoKTtcclxuICAgICAgICBjb25zdCBzcm93ID0ge2lkLCBpbmRleDogcm93SW5kZXgsIGRhdGE6IHJvd0RhdGF9O1xyXG4gICAgICAgIGlmICghaXNNdWx0aVNlbGVjdCkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5fc3RhdGUuY3VycmVudFJvdykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVTdGF0ZSh7IGN1cnJlbnRSb3c6IG51bGwgfSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnVuU2VsZWN0Um93U3ViamVjdC5uZXh0KHNyb3cpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX3N0YXRlLnNob3dDaGVja2JveCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudW5DaGVja1Jvdyhzcm93LmluZGV4LCBzcm93LmRhdGEsIGdyaWRPcHRzKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMudW5TZWxlY3RSb3dGb3JNdWx0aShzcm93LCB0cnVlLCBncmlkT3B0cyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgX2NhbkNhbmNlbFNlbGVjdFdoZW5NdWx0aSgpIHtcclxuICAgICAgICByZXR1cm4gIXRoaXMuX3N0YXRlLmtlZXBTZWxlY3QgJiYgdGhpcy5fc3RhdGUub25seVNlbGVjdFNlbGY7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfY2xlYXJTZWxlY3Rpb25zKGV4Y2x1ZGVJZHM/OiBzdHJpbmdbXSkge1xyXG4gICAgICAgIHRoaXMuX3N0YXRlLmN1cnJlbnRSb3cgPSBudWxsO1xyXG5cclxuICAgICAgICBpZiAoIWV4Y2x1ZGVJZHMgfHwgIWV4Y2x1ZGVJZHMubGVuZ3RoICkge1xyXG4gICAgICAgICAgICB0aGlzLl9zdGF0ZS5zZWxlY3Rpb25zID0gW107XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5fc3RhdGUuc2VsZWN0aW9ucyA9IHRoaXMuX3N0YXRlLnNlbGVjdGlvbnMuZmlsdGVyKG4gPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGV4Y2x1ZGVJZHMuZmluZEluZGV4KGkgPT4gaSA9PSBuLmlkKSA+IC0xO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfY2xlYXJDaGVja2Vkcyhyb3dzID0gW10pIHtcclxuICAgICAgICBpZiAoIXJvd3MubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3N0YXRlLmNoZWNrZWRSb3dzID0gW107XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5fc3RhdGUuY2hlY2tlZFJvd3MgPSB0aGlzLl9zdGF0ZS5jaGVja2VkUm93cy5maWx0ZXIobiA9PiByb3dzLmZpbmRJbmRleChyID0+IHRoaXMucHJpbWFyeUlkKHIpID09PSBuLmlkKSA9PSAtMSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNsZWFyU2VsZWN0aW9ucyhleGNsdWRlSWRzPzogc3RyaW5nW10pIHtcclxuICAgICAgICBjb25zdCByb3dzID0gdGhpcy5fc3RhdGUuc2VsZWN0aW9ucztcclxuICAgICAgICBleGNsdWRlSWRzID0gZXhjbHVkZUlkcyB8fCBbXTtcclxuICAgICAgICB0aGlzLl9jbGVhclNlbGVjdGlvbnMoZXhjbHVkZUlkcyk7XHJcbiAgICAgICAgY29uc3QgdW5DaGVja1Jvd3MgPSByb3dzLmZpbHRlcihuID0+IGV4Y2x1ZGVJZHMuZmluZEluZGV4KGkgPT4gaSA9PSBuLmlkKSA9PSAtMSk7XHJcbiAgICAgICAgaWYgKHRoaXMuX3N0YXRlLmNoZWNrT25TZWxlY3QgfHwgKCF0aGlzLl9zdGF0ZS5tdWx0aVNlbGVjdCAmJiB0aGlzLl9zdGF0ZS5zaG93Q2hlY2tib3gpKSB7XHJcbiAgICAgICAgICAgIC8vIHRoaXMuX3N0YXRlLmNoZWNrZWRSb3dzID0gW107XHJcbiAgICAgICAgICAgIC8vIHRoaXMuY2xlYXJDaGVja2Vkc1N1YmplY3QubmV4dChyb3dzKTtcclxuICAgICAgICAgICAgdGhpcy5fc3RhdGUuY2hlY2tlZFJvd3MgPSB0aGlzLl9zdGF0ZS5jaGVja2VkUm93cy5maWx0ZXIobiA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gIXJvd3MuZmluZCh0MSA9PiB0MS5pZCA9PSBuLmlkICYmIGV4Y2x1ZGVJZHMuZmluZEluZGV4KGkgPT4gaSA9PSBuLmlkKSA9PSAtMSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB0aGlzLmNsZWFyQ2hlY2tlZHNTdWJqZWN0Lm5leHQodW5DaGVja1Jvd3MpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmNsZWFyU2VsZWN0aW9uU3ViamVjdC5uZXh0KHVuQ2hlY2tSb3dzKTtcclxuICAgIH1cclxuXHJcbiAgICBjbGVhckNoZWNrZWRzKGNsZWFyQWxsID0gdHJ1ZSkge1xyXG4gICAgICAgIGNvbnN0IHJvd3MgPSB0aGlzLmdldEFsbFJvd3NGb3JMaXZlKCk7XHJcbiAgICAgICAgY29uc3QgX3Jvd3MgPSBjbGVhckFsbCA/IFtdIDogcm93cztcclxuICAgICAgICB0aGlzLl9jbGVhckNoZWNrZWRzKF9yb3dzKTtcclxuICAgICAgICBpZiAodGhpcy5fc3RhdGUuc2VsZWN0T25DaGVjaykge1xyXG4gICAgICAgICAgIHRoaXMuX2NsZWFyU2VsZWN0aW9ucygpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmNsZWFyQ2hlY2tlZHNTdWJqZWN0Lm5leHQocm93cyk7XHJcbiAgICB9XHJcblxyXG4gICAgY2xlYXJBbGwoKSB7XHJcbiAgICAgICAgdGhpcy5fY2xlYXJDaGVja2VkcygpO1xyXG4gICAgICAgIHRoaXMuX2NsZWFyU2VsZWN0aW9ucygpO1xyXG4gICAgICAgIHRoaXMuY2xlYXJBbGxTdWJqZWN0Lm5leHQoKTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRNdWx0aVNlbGVjdChmbGFnOiBib29sZWFuKSB7XHJcbiAgICAgICAgdGhpcy5fc3RhdGUubXVsdGlTZWxlY3QgPSBmbGFnO1xyXG4gICAgfVxyXG5cclxuICAgIHNldENoZWNrT25TZWxlY3QoZmxhZzogYm9vbGVhbikge1xyXG4gICAgICAgIHRoaXMuX3N0YXRlLmNoZWNrT25TZWxlY3QgPSBmbGFnO1xyXG4gICAgfVxyXG5cclxuICAgIHNldFNlbGVjdE9uQ2hlY2soZmxhZzogYm9vbGVhbikge1xyXG4gICAgICAgIHRoaXMuX3N0YXRlLnNlbGVjdE9uQ2hlY2sgPSBmbGFnO1xyXG4gICAgfVxyXG5cclxuICAgIHNldEN1cnJlbnRDZWxsKGRyOiBEYXRhZ3JpZFJvdywgZmllbGQ6IHN0cmluZywgY2VsbEVsZW1lbnQ/OiBhbnksIGNlbGxSZWY/OiBhbnkgKSB7XHJcbiAgICAgICAgY29uc3QgeyByb3dJbmRleCwgcm93RGF0YSB9ID0gey4uLmRyfTtcclxuICAgICAgICBsZXQgY3VycmVudENlbGwgPSB7Li4udGhpcy5fc3RhdGUuY3VycmVudENlbGwsIHJvd0luZGV4LCByb3dEYXRhLCBmaWVsZCwgcm93SWQ6IHRoaXMucHJpbWFyeUlkKHJvd0RhdGEpLCBjZWxsRWxlbWVudCB9O1xyXG5cclxuICAgICAgICBpZiAoZmllbGQgIT09IHRoaXMuX3N0YXRlLkNvbnRyb2xQYW5lbEZlaWxkKSB7XHJcbiAgICAgICAgICAgIGlmIChjZWxsUmVmKSB7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50Q2VsbC5jZWxsUmVmID0gY2VsbFJlZjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGZpZWxkKSB7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50Q2VsbC5jb2x1bW4gPSB0aGlzLmdldENvbHVtbihmaWVsZCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGlzTGFzdFJvdyA9IHJvd0luZGV4ID09PSB0aGlzLmdldERhdGEoKS5sZW5ndGggLSAxO1xyXG4gICAgICAgICAgICBjdXJyZW50Q2VsbFsnbGFzdFJvdyddID0gaXNMYXN0Um93O1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGN1cnJlbnRDZWxsID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5fc3RhdGUuY3VycmVudENlbGwgPSBudWxsO1xyXG4gICAgICAgIHRoaXMudXBkYXRlU3RhdGUoe2N1cnJlbnRDZWxsfSwgZmFsc2UpO1xyXG4gICAgICAgIHRoaXMuc2VsZWN0Um93KHJvd0luZGV4LCByb3dEYXRhKTtcclxuICAgICAgICBpZiAodGhpcy5fc3RhdGUuY3VycmVudFJvdykge1xyXG4gICAgICAgICAgICB0aGlzLl9zdGF0ZS5jdXJyZW50Um93LmRyID0gZHI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuc2VsZWN0Q2VsbFN1YmplY3QubmV4dChjdXJyZW50Q2VsbCk7XHJcbiAgICB9XHJcblxyXG4gICAgY2FuY2VsU2VsZWN0Q2VsbCgpIHtcclxuICAgICAgICBpZiAodGhpcy5fc3RhdGUuY3VycmVudENlbGwpIHtcclxuICAgICAgICAgICAgdGhpcy5fc3RhdGUuY3VycmVudENlbGwgPSBudWxsO1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlKHtjdXJyZW50Q2VsbDogbnVsbH0sIGZhbHNlKTtcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RDZWxsU3ViamVjdC5uZXh0KG51bGwpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcmltYXJ5SWQocm93RGF0YTogYW55KSB7XHJcbiAgICAgICAgcmV0dXJuIHJvd0RhdGFbdGhpcy5fc3RhdGUuaWRGaWVsZF07XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0Q3VycmVudENlbGwoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3N0YXRlLmN1cnJlbnRDZWxsO1xyXG4gICAgfVxyXG5cclxuICAgIGVkaXRDZWxsKCkge1xyXG4gICAgICAgIGlmICh0aGlzLl9zdGF0ZS5jdXJyZW50Q2VsbCkge1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuX3N0YXRlLmN1cnJlbnRDZWxsLmlzRWRpdGluZykge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgY2VpID0geyAuLi50aGlzLl9zdGF0ZS5jdXJyZW50Q2VsbCwgaXNFZGl0aW5nOiB0cnVlIH07XHJcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlKHsgY3VycmVudENlbGw6IGNlaSB9LCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdENlbGxTdWJqZWN0Lm5leHQoY2VpKTtcclxuICAgICAgICAgICAgICAgIC8vIHRoaXMuZWRpdENlbGwkLm5leHQoY2VpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBlbmRFZGl0Q2VsbCgpIHtcclxuICAgICAgICBpZiAodGhpcy5fc3RhdGUuY3VycmVudENlbGwgJiYgdGhpcy5fc3RhdGUuY3VycmVudENlbGwuaXNFZGl0aW5nKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNlaSA9IHsgLi4udGhpcy5fc3RhdGUuY3VycmVudENlbGwsIGlzRWRpdGluZzogZmFsc2UgfTtcclxuICAgICAgICAgICAgdGhpcy51cGRhdGVTdGF0ZSh7IGN1cnJlbnRDZWxsOiBjZWkgfSwgZmFsc2UpO1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdENlbGxTdWJqZWN0Lm5leHQoY2VpKTtcclxuICAgICAgICAgICAgLy8gdGhpcy5lZGl0Q2VsbCQubmV4dChjZWkpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBhcHBlbmRSb3cocm93RGF0YTogYW55KSB7XHJcbiAgICAgICAgaWYgKHJvd0RhdGEgJiYgdGhpcy5wcmltYXJ5SWQocm93RGF0YSkpIHtcclxuICAgICAgICAgICAgY29uc3QgcGlkID0gdGhpcy5wcmltYXJ5SWQocm93RGF0YSk7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmZpbmRSb3dJbmRleChwaWQpID09PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fc3RhdGUuZGF0YS5wdXNoKHJvd0RhdGEpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbmV3RGF0YSA9IFsuLi50aGlzLl9zdGF0ZS5kYXRhXTtcclxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlU3RhdGUoe2RhdGE6IG5ld0RhdGF9LCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9zdGF0ZS5vcmlnaW5hbERhdGEgPSBjbG9uZURlZXAodGhpcy5fc3RhdGUuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlZnJlc2goKTtcclxuICAgICAgICAgICAgICAgIHRoaXMucm93QXBwZW5kJC5lbWl0KHJvd0RhdGEpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGDkuLvplK5JRCDlt7LlrZjlnKjvvIFJRDogJHtwaWR9YCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYOS4u+mUruagh+ivhuWtl+auteS4jeiDveS4uuepuuOAgmApO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB1cGRhdGVSb3cocm93aWQ6IGFueSwgcm93RGF0YTogYW55KSB7XHJcbiAgICAgICAgY29uc3Qgcm93ID0gdGhpcy5maW5kUm93KHJvd2lkKTtcclxuICAgICAgICBpZiAocm93ICYmIHJvdy5kYXRhKSB7XHJcbiAgICAgICAgICAgIGlmIChyb3dEYXRhKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMocm93RGF0YSk7XHJcbiAgICAgICAgICAgICAgICBrZXlzLmZvckVhY2goZmllbGQgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIFV0aWxzLnNldFZhbHVlKGZpZWxkLCByb3dEYXRhW2ZpZWxkXSwgcm93LmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAvLyDmm7TmlrDlt7Lli77pgInnmoTmlbDmja5cclxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlQ2hlY2tlZERhdGEocm93aWQsIHJvd0RhdGEpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yb3dVcGRhdGUkLmVtaXQocm93KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBkZWxldGVSb3cocm93aWQpIHtcclxuICAgICAgICBjb25zdCByb3cgPSB0aGlzLmZpbmRSb3cocm93aWQpO1xyXG4gICAgICAgIGlmIChyb3cpIHtcclxuICAgICAgICAgICAgY29uc3QgbmV3RGF0YSA9IHRoaXMucmVtb3ZlUm93KHRoaXMuX3N0YXRlLmRhdGEsIHJvd2lkKTtcclxuICAgICAgICAgICAgdGhpcy51cGRhdGVTdGF0ZSh7ZGF0YTogbmV3RGF0YX0sIGZhbHNlKTtcclxuICAgICAgICAgICAgdGhpcy5fc3RhdGUub3JpZ2luYWxEYXRhID0gY2xvbmVEZWVwKHRoaXMuX3N0YXRlLmRhdGEpO1xyXG4gICAgICAgICAgICB0aGlzLnJlZnJlc2goKTtcclxuICAgICAgICAgICAgdGhpcy5yb3dEZWxldGUkLmVtaXQocm93aWQpO1xyXG4gICAgICAgICAgICByZXR1cm4gcm93O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog5LuO5pWw57uE5Lit5Yig6Zmk5oyH5a6a55qESURcclxuICAgICAqIEBwYXJhbSBkYXRhIOaVsOe7hFxyXG4gICAgICogQHBhcmFtIHJvd0lkIOimgeWIoOmZpOeahElEXHJcbiAgICAgKi9cclxuICAgIHJlbW92ZVJvdyhkYXRhLCByb3dJZCkge1xyXG4gICAgICAgIGNvbnN0IG5ld0RhdGEgPSBkYXRhLmZpbHRlcihuID0+IHtcclxuICAgICAgICAgICAgY29uc3QgaWQgPSB0aGlzLnByaW1hcnlJZChuKTtcclxuICAgICAgICAgICAgcmV0dXJuIHJvd0lkICE9PSBpZDtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIG5ld0RhdGE7XHJcbiAgICB9XHJcblxyXG4gICAgaXNDZWxsU2VsZWN0ZWQoY2VsbEluZm86IENlbGxJbmZvKSB7XHJcbiAgICAgICAgY29uc3QgY2MgPSB0aGlzLmdldEN1cnJlbnRDZWxsKCk7XHJcbiAgICAgICAgaWYgKCFjYykge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKCB0aGlzLl9zdGF0ZS5jdXJyZW50Um93LmluZGV4ID09PSBjYy5yb3dJbmRleCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNjLmZpZWxkID09PSBjZWxsSW5mby5maWVsZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCB1cGRhdGVTdGF0ZShzdGF0ZTogUGFydGlhbDxGYXJyaXNEYXRhZ3JpZFN0YXRlPiwgZW1pdCA9IHRydWUpIHtcclxuICAgICAgICBjb25zdCBuZXdTdGF0ZSA9IHsgLi4udGhpcy5fc3RhdGUsIC4uLnN0YXRlIH07XHJcbiAgICAgICAgdGhpcy5fc3RhdGUgPSBuZXdTdGF0ZTtcclxuICAgICAgICBpZiAoZW1pdCkge1xyXG4gICAgICAgICAgICB0aGlzLnN0b3JlLm5leHQodGhpcy5fc3RhdGUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXNpemUobmV3U2l6ZT86IHt3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlciwgW2tleTogc3RyaW5nXTogYW55fSkge1xyXG4gICAgICAgIGlmIChuZXdTaXplKSB7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlU3RhdGUobmV3U2l6ZSwgZmFsc2UpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnJlc2V0Q29sdW1uc1NpemUoKTtcclxuICAgICAgICBpZiAoIXRoaXMuX3N0YXRlLmdyb3VwUm93cykge1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVZpcnRodWFsUm93cyh0aGlzLl9zdGF0ZS52aXJ0dWFsLnNjcm9sbFRvcCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGZpdENvbHVtbnMoZml0KSB7XHJcbiAgICAgICAgdGhpcy51cGRhdGVTdGF0ZSh7Zml0Q29sdW1uczogZml0fSwgZmFsc2UpO1xyXG4gICAgICAgIC8vIGNvbnN0IHIgPSB0aGlzLnVzZVVzZXJTZXRDb2x1bW5TaXplKCk7XHJcbiAgICAgICAgLy8gdGhpcy5zZXRGaXRDb2x1bW5zV2lkdGgodGhpcy5fc3RhdGUuY29sdW1uc0dyb3VwLCB0cnVlLCByKTtcclxuICAgICAgICAvLyB0aGlzLmdyaWRTaXplU3ViamVjdC5uZXh0KHRoaXMuX3N0YXRlKTtcclxuICAgICAgICB0aGlzLnJlc2V0Q29sdW1uc1NpemUoKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHVzZVVzZXJTZXRDb2x1bW5TaXplKCkge1xyXG4gICAgICAgIGlmICh0aGlzLl9zdGF0ZS5hdXRvRml0Q29sdW1ucykge1xyXG4gICAgICAgICAgICBjb25zdCBncmlkV2lkdGggPSB0aGlzLl9zdGF0ZS53aWR0aDtcclxuICAgICAgICAgICAgY29uc3QgdXNlclNldENvbHVtbldpZHRoID0gdGhpcy5fc3RhdGUuY29sdW1uc0dyb3VwLm9yaWdpbmFsVG90YWxXaWR0aDtcclxuICAgICAgICAgICAgcmV0dXJuIHVzZXJTZXRDb2x1bW5XaWR0aCA+IGdyaWRXaWR0aDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgcmVzZXRDb2x1bW5zU2l6ZSgpIHtcclxuICAgICAgICBpZiAodGhpcy5fc3RhdGUuZml0Q29sdW1ucykge1xyXG4gICAgICAgICAgICAvLyAyMDIwMDQyMVxyXG4gICAgICAgICAgICBjb25zdCByID0gdGhpcy51c2VVc2VyU2V0Q29sdW1uU2l6ZSgpO1xyXG4gICAgICAgICAgICB0aGlzLnNldEZpdENvbHVtbnNXaWR0aCh0aGlzLl9zdGF0ZS5jb2x1bW5zR3JvdXAsIHIsIHIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmdyaWRTaXplU3ViamVjdC5uZXh0KHRoaXMuX3N0YXRlKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOabtOaWsOWIl+iuvue9rlxyXG4gICAgICogQHBhcmFtIGNvbHVtbnMg5paw55qE5YiX6ZuG5ZCIXHJcbiAgICAgKiBAcGFyYW0gcmVzdGl0dXRlIOaYr+WQpui/mOWOn+WIneWni+WuveW6piDpu5jorqTkuLogZmFsc2VcclxuICAgICAqL1xyXG4gICAgdXBkYXRlQ29sdW1ucyhjb2x1bW5zLCByZXN0aXR1dGUgPSBmYWxzZSwgZW1pdCA9IGZhbHNlKSB7XHJcbiAgICAgICAgdGhpcy5fc3RhdGUuY29sdW1ucyA9IGNvbHVtbnM7XHJcbiAgICAgICAgdGhpcy5pbml0Q29sdW1ucyhlbWl0LCByZXN0aXR1dGUpO1xyXG4gICAgICAgIHRoaXMucmVzaXplQ29sdW1ucyhyZXN0aXR1dGUpO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBnZXRHcm91cENvbHVtbnMoY29sdW1ucykge1xyXG4gICAgICAgIGxldCBhcnIgPSBbXTtcclxuICAgICAgICBjb25zdCBhbGxDb2xzID0gdGhpcy5nZXRBbGxGbGF0Q29sdW1ucygpO1xyXG4gICAgICAgIGNvbHVtbnMuZm9yRWFjaChjID0+IHtcclxuICAgICAgICAgICAgaWYgKCFjLmNvbHNwYW4gfHwgYy5jb2xzcGFuID09IDEpICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFhcnIuZmluZChuID0+IG4uZmllbGQgPT09IGMuZmllbGQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYXJyLnB1c2goYyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgYXJyID0gYXJyLmNvbmNhdCh0aGlzLmdldEdyb3VwQ29sdW1ucyhhbGxDb2xzLmZpbHRlcihuID0+IG4ucGFyZW50SWQgPT0gYy5pZFx0KSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIGFycjtcclxuICAgIH1cclxuXHJcblxyXG5cclxuICAgIGluaXRDb2x1bW5zKGVtaXQgPSBmYWxzZSwgcmVzdENvbHVtbldpZHRoID0gZmFsc2UpIHtcclxuICAgICAgICBjb25zdCBjb2x1bW5zID0gdGhpcy5fc3RhdGUuZmxhdENvbHVtbnM7XHJcbiAgICAgICAgbGV0IGNvbGdyb3VwOiBhbnkgPSB7XHJcbiAgICAgICAgICAgIGxlZnRGaXhlZDogW10sXHJcbiAgICAgICAgICAgIHJpZ2h0Rml4ZWQ6IFtdLFxyXG4gICAgICAgICAgICBub3JtYWxDb2x1bW5zOiBbXSxcclxuICAgICAgICAgICAgY29sdW1uczogW11cclxuICAgICAgICB9O1xyXG4gICAgICAgIGlmIChjb2x1bW5zICYmIGNvbHVtbnMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGxlZnRGaXhlZENvbHMgPSB0aGlzLmdldEZpeGVkQ29scygnbGVmdCcpO1xyXG4gICAgICAgICAgICBjb25zdCByaWdodEZpeGVkQ29scyA9IHRoaXMuZ2V0Rml4ZWRDb2xzKCdyaWdodCcpO1xyXG4gICAgICAgICAgICBjb25zdCBub3JtYWxDb2xzID0gdGhpcy5nZXRGaXhlZENvbHMoKTtcclxuXHJcbiAgICAgICAgICAgIGNvbHVtbnMuZm9yRWFjaChjID0+IHtcclxuICAgICAgICAgICAgICAgIGlmICghYy5vcmlnaW5hbFdpZHRoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYy5vcmlnaW5hbFdpZHRoID0gYy53aWR0aDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBjb2xncm91cCA9IHtcclxuICAgICAgICAgICAgICAgIGxlZnRGaXhlZDogbGVmdEZpeGVkQ29scyxcclxuICAgICAgICAgICAgICAgIHJpZ2h0Rml4ZWQ6IHJpZ2h0Rml4ZWRDb2xzLFxyXG4gICAgICAgICAgICAgICAgbm9ybWFsQ29sdW1uczogbm9ybWFsQ29scyxcclxuICAgICAgICAgICAgICAgIGNvbHVtbnM6IGxlZnRGaXhlZENvbHMuY29uY2F0KG5vcm1hbENvbHMpLmNvbmNhdChyaWdodEZpeGVkQ29scylcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuaW5pdENvbHVtbnNXaWR0aChjb2xncm91cCwgcmVzdENvbHVtbldpZHRoKTtcclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLl9zdGF0ZS5maXRDb2x1bW5zKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldEZpdENvbHVtbnNXaWR0aChjb2xncm91cCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlU3RhdGUoeyBjb2x1bW5zR3JvdXA6IGNvbGdyb3VwIH0sIGVtaXQpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbGdyb3VwLmxlZnRGaXhlZFdpZHRoID0gMDtcclxuICAgICAgICAgICAgY29sZ3JvdXAucmlnaHRGaXhlZFdpZHRoID0gMDtcclxuICAgICAgICAgICAgY29sZ3JvdXAubm9ybWFsV2lkdGggPSAwO1xyXG4gICAgICAgICAgICBjb2xncm91cC50b3RhbFdpZHRoID0gMDtcclxuICAgICAgICAgICAgdGhpcy51cGRhdGVTdGF0ZSh7IGNvbHVtbnNHcm91cDogY29sZ3JvdXAgfSwgZW1pdCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldENvbHVtbkluZGV4KGZpZWxkOiBzdHJpbmcsIGZpeGVkOiAncmlnaHQnfCAnJyB8ICdsZWZ0JyB8ICdjZW50ZXInID0gJycpIHtcclxuICAgICAgICBjb25zdCBjb2xncm91cCA9IHRoaXMuX3N0YXRlLmNvbHVtbnNHcm91cDtcclxuICAgICAgICBpZiAoIWZpeGVkIHx8IHRoaXMuX3N0YXRlLmZhc3QpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGNvbGdyb3VwLm5vcm1hbENvbHVtbnMuZmluZEluZGV4KG4gPT4gbi5maWVsZCA9PT0gZmllbGQpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlmIChmaXhlZCA9PT0gJ2xlZnQnKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY29sZ3JvdXAubGVmdEZpeGVkLmZpbmRJbmRleChuID0+IG4uZmllbGQgPT09IGZpZWxkKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChmaXhlZCA9PT0gJ3JpZ2h0Jykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbGdyb3VwLnJpZ2h0Rml4ZWQuZmluZEluZGV4KG4gPT4gbi5maWVsZCA9PT0gZmllbGQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbHVtblJlc2l6ZUVuZCgpIHtcclxuICAgICAgICAvLyBjb25zdCBjb2xncm91cCA9IHRoaXMuX3N0YXRlLmNvbHVtbnNHcm91cDtcclxuICAgICAgICAvLyB0aGlzLmluaXRDb2x1bW5zV2lkdGgoY29sZ3JvdXAsIGZhbHNlKTtcclxuICAgICAgICAvLyB0aGlzLnVwZGF0ZVN0YXRlKHsgY29sdW1uc0dyb3VwOiAgey4uLmNvbGdyb3VwfSB9LCBmYWxzZSk7XHJcbiAgICAgICAgLy8gdGhpcy5ncmlkU2l6ZVN1YmplY3QubmV4dCh0aGlzLl9zdGF0ZSk7XHJcbiAgICAgICAgdGhpcy5yZXNpemVDb2x1bW5zKCk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHJlc2l6ZUNvbHVtbnMocmVzdGl0dXRlID0gZmFsc2UpIHtcclxuICAgICAgICBjb25zdCBjb2xncm91cCA9IHRoaXMuX3N0YXRlLmNvbHVtbnNHcm91cDtcclxuICAgICAgICB0aGlzLmluaXRDb2x1bW5zV2lkdGgoY29sZ3JvdXAsIHJlc3RpdHV0ZSk7XHJcbiAgICAgICAgaWYgKHRoaXMuX3N0YXRlLmZpdENvbHVtbnMpIHtcclxuICAgICAgICAgICAgY29uc3QgciA9IHRoaXMudXNlVXNlclNldENvbHVtblNpemUoKTtcclxuICAgICAgICAgICAgaWYgKHIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2V0Rml0Q29sdW1uc1dpZHRoKGNvbGdyb3VwLCByZXN0aXR1dGUsIHIpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRGaXRDb2x1bW5zV2lkdGgoY29sZ3JvdXAsIHJlc3RpdHV0ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy51cGRhdGVTdGF0ZSh7IGNvbHVtbnNHcm91cDogIHsuLi5jb2xncm91cH0gfSwgZmFsc2UpO1xyXG4gICAgICAgIHRoaXMuZ3JpZFNpemVTdWJqZWN0Lm5leHQodGhpcy5fc3RhdGUpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldEFsbEZsYXRDb2x1bW5zKCkge1xyXG4gICAgICAgIHJldHVybiBmbGF0dGVuPERhdGFDb2x1bW4+KHRoaXMuX3N0YXRlLmNvbHVtbnMpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldENvbHVtbihmaWVsZE5hbWU6IHN0cmluZykge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldEFsbEZsYXRDb2x1bW5zKCkuZmluZChuID0+IG4uZmllbGQgPT09IGZpZWxkTmFtZSk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0Rml0Q29sdW1uc1dpZHRoKGNvbGdyb3VwOiBDb2x1bW5Hcm91cCwgcmVzdGl0dXRlID0gZmFsc2UsIHVzZVVzZXJTZXRDb2x1bW5TaXplID0gZmFsc2UpIHtcclxuICAgICAgICBpZiAoIWNvbGdyb3VwKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29sZ3JvdXAubm9ybWFsV2lkdGggPSB0aGlzLl9zdGF0ZS53aWR0aCAtIGNvbGdyb3VwLmxlZnRGaXhlZFdpZHRoIC0gY29sZ3JvdXAucmlnaHRGaXhlZFdpZHRoO1xyXG5cclxuICAgICAgICBpZiAoIWNvbGdyb3VwLm5vcm1hbFdpZHRoIHx8IGNvbGdyb3VwLm5vcm1hbFdpZHRoIDwgMCApIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGlmICh1c2VVc2VyU2V0Q29sdW1uU2l6ZSkge1xyXG4gICAgICAgICAgICBjb2xncm91cC50b3RhbFdpZHRoID0gY29sZ3JvdXAub3JpZ2luYWxUb3RhbFdpZHRoO1xyXG4gICAgICAgICAgICBpZiAocmVzdGl0dXRlKSB7XHJcbiAgICAgICAgICAgICAgICBjb2xncm91cC5ub3JtYWxDb2x1bW5zLmZvckVhY2goIGNvbCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29sLndpZHRoID0gY29sLm9yaWdpbmFsV2lkdGg7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyDmm7TmlrAgbm9ybWFsQ29sdW1ucyB3aWR0aFxyXG4gICAgICAgICAgICBjb2xncm91cC5ub3JtYWxXaWR0aCA9IGNvbGdyb3VwLm5vcm1hbENvbHVtbnMucmVkdWNlKCh0b3RhbFdpZHRoLCBjb2wpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmICghcmVzdGl0dXRlICYmIGNvbC53aWR0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0b3RhbFdpZHRoICs9IGNvbC53aWR0aDtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRvdGFsV2lkdGggKz0gY29sLm9yaWdpbmFsV2lkdGg7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIDApO1xyXG5cclxuICAgICAgICAgICAgY29sZ3JvdXAudG90YWxXaWR0aCA9IGNvbGdyb3VwLmxlZnRGaXhlZFdpZHRoICsgY29sZ3JvdXAucmlnaHRGaXhlZFdpZHRoICsgY29sZ3JvdXAubm9ybWFsV2lkdGg7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY29uc3QgbWluV2lkdGggPSBjb2xncm91cC5ub3JtYWxDb2x1bW5zLnJlZHVjZSgodG90YWxXaWR0aCwgY29sKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXJlc3RpdHV0ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0b3RhbFdpZHRoICs9IGNvbC53aWR0aDtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRvdGFsV2lkdGggKz0gY29sLm9yaWdpbmFsV2lkdGg7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIDApO1xyXG5cclxuICAgICAgICAgICAgY29sZ3JvdXAubm9ybWFsV2lkdGggPSBjb2xncm91cC5ub3JtYWxXaWR0aCAtIDI7XHJcblxyXG4gICAgICAgICAgICBjb2xncm91cC5ub3JtYWxDb2x1bW5zLmZvckVhY2goIGNvbCA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXJlc3RpdHV0ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGNvbC53aWR0aCA9IE1hdGguZmxvb3IoIGNvbC53aWR0aCAvIG1pbldpZHRoICogY29sZ3JvdXAubm9ybWFsV2lkdGggKTtcclxuICAgICAgICAgICAgICAgICAgICBjb2wud2lkdGggPSBOdW1iZXIoKGNvbC53aWR0aCAvIG1pbldpZHRoICogY29sZ3JvdXAubm9ybWFsV2lkdGggKS50b0ZpeGVkKDIpKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gY29sLndpZHRoID0gTWF0aC5mbG9vciggY29sLm9yaWdpbmFsV2lkdGggLyBtaW5XaWR0aCAqIGNvbGdyb3VwLm5vcm1hbFdpZHRoICk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29sLndpZHRoID0gIE51bWJlcigoIGNvbC5vcmlnaW5hbFdpZHRoIC8gbWluV2lkdGggKiBjb2xncm91cC5ub3JtYWxXaWR0aCApLnRvRml4ZWQoMikpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgY29sZ3JvdXAudG90YWxXaWR0aCA9IGNvbGdyb3VwLmxlZnRGaXhlZFdpZHRoICsgY29sZ3JvdXAucmlnaHRGaXhlZFdpZHRoICsgY29sZ3JvdXAubm9ybWFsV2lkdGg7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldEZpeGVkQ29scyhkaXJlY3Rpb246ICdsZWZ0JyB8ICdyaWdodCcgfCAnJyA9ICcnKSB7XHJcbiAgICAgICAgbGV0IGNvbHMgPSBbXTtcclxuICAgICAgICBpZiAoIWRpcmVjdGlvbikge1xyXG4gICAgICAgICAgICBjb2xzID0gdGhpcy5fc3RhdGUuZmxhdENvbHVtbnMuZmlsdGVyKGNvbCA9PiAhY29sLmZpeGVkKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb2xzID0gdGhpcy5fc3RhdGUuZmxhdENvbHVtbnMuZmlsdGVyKGNvbCA9PiBjb2wuZml4ZWQgPT09IGRpcmVjdGlvbik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyDlpJrooajlpLTvvIzph43mlrDorqHnrpfliJfnmoTpobrluo9cclxuICAgICAgICBpZiAodGhpcy5fc3RhdGUuY29sdW1ucy5sZW5ndGggPiAxICYmIGNvbHMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGZpZWxkcyA9IERhdGFncmlkQ29sdW1uc0hlbHBlci5nZXRGaWVsZHModGhpcy5fc3RhdGUuY29sdW1ucyk7XHJcbiAgICAgICAgICAgIGNvbnN0IG5ld2NvbHMgPSBbXTtcclxuICAgICAgICAgICAgZmllbGRzLmZvckVhY2goZiA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBjID0gIGNvbHMuZmluZChjb2wgPT4gKGNvbC5maWVsZCB8fCAnJyApID09PSBmKTtcclxuICAgICAgICAgICAgICAgIGlmIChjKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV3Y29scy5wdXNoKGMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIG5ld2NvbHM7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gY29scztcclxuICAgIH1cclxuXHJcbiAgICAvLyByZXN0aXR1dGU6IOi/mOWOn+WIneWni+WuveW6pu+8jOm7mOiupCBmYWxzZVxyXG4gICAgcHJpdmF0ZSBpbml0Q29sdW1uc1dpZHRoKGNvbGdyb3VwOiBDb2x1bW5Hcm91cCwgIHJlc3RpdHV0ZSA9IGZhbHNlKSB7XHJcbiAgICAgICAgbGV0IG9mZnNldCA9IDA7XHJcbiAgICAgICAgb2Zmc2V0ID0gdGhpcy5fc3RhdGUuc2hvd0xpbmVOdW1iZXIgPyBvZmZzZXQgKyB0aGlzLl9zdGF0ZS5saW5lTnVtYmVyV2lkdGggOiBvZmZzZXQ7XHJcbiAgICAgICAgb2Zmc2V0ID0gdGhpcy5fc3RhdGUuc2hvd0NoZWNrYm94ID8gb2Zmc2V0ICsgdGhpcy5fc3RhdGUuY2hlY2tib3hDb2x1bW5XaWR0aCA6IG9mZnNldDtcclxuXHJcbiAgICAgICAgY29uc3QgZ2V0Q29sc1dpZHRoID0gKGNvbHMsIHZhbCwgcmVzZXQpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIGNvbHMucmVkdWNlKChyLCBjKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjLmxlZnQgPSByO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFyZXNldCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByICsgYy53aWR0aDtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHIgKyBjLm9yaWdpbmFsV2lkdGg7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIHZhbCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgY29sZ3JvdXAubGVmdEZpeGVkV2lkdGggPSBvZmZzZXQ7XHJcbiAgICAgICAgaWYgKGNvbGdyb3VwLmxlZnRGaXhlZCAmJiBjb2xncm91cC5sZWZ0Rml4ZWQubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGNvbGdyb3VwLmxlZnRGaXhlZFdpZHRoID0gZ2V0Q29sc1dpZHRoKGNvbGdyb3VwLmxlZnRGaXhlZCwgb2Zmc2V0LCByZXN0aXR1dGUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29sZ3JvdXAucmlnaHRGaXhlZFdpZHRoID0gMDtcclxuICAgICAgICBpZiAoY29sZ3JvdXAucmlnaHRGaXhlZCAmJiBjb2xncm91cC5yaWdodEZpeGVkLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBjb2xncm91cC5yaWdodEZpeGVkV2lkdGggPSBnZXRDb2xzV2lkdGgoY29sZ3JvdXAucmlnaHRGaXhlZCwgMCwgcmVzdGl0dXRlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbGdyb3VwLm5vcm1hbFdpZHRoID0gMDtcclxuICAgICAgICBpZiAodGhpcy5fc3RhdGUuY29sdW1ucyAmJiB0aGlzLl9zdGF0ZS5jb2x1bW5zLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBjb2xncm91cC5ub3JtYWxXaWR0aCA9IGdldENvbHNXaWR0aChjb2xncm91cC5ub3JtYWxDb2x1bW5zLCAwLCByZXN0aXR1dGUpO1xyXG4gICAgICAgICAgICBjb2xncm91cC5vcmlnaW5hbFRvdGFsV2lkdGggPSBnZXRDb2xzV2lkdGgoY29sZ3JvdXAubm9ybWFsQ29sdW1ucywgMCwgdHJ1ZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb2xncm91cC50b3RhbFdpZHRoID0gY29sZ3JvdXAubGVmdEZpeGVkV2lkdGggKyBjb2xncm91cC5yaWdodEZpeGVkV2lkdGggKyBjb2xncm91cC5ub3JtYWxXaWR0aDtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgc2hvd0NoZWNrYm94KGlzU2hvdyA9IHRydWUpIHtcclxuICAgICAgICBjb25zdCBjb2xncm91cCA9IHRoaXMuX3N0YXRlLmNvbHVtbnNHcm91cDtcclxuICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlKHtzaG93Q2hlY2tib3g6IGlzU2hvd30sIGZhbHNlKTtcclxuICAgICAgICBpZiAoaXNTaG93KSB7XHJcbiAgICAgICAgICAgIGNvbGdyb3VwLmxlZnRGaXhlZFdpZHRoID0gY29sZ3JvdXAubGVmdEZpeGVkV2lkdGggKyB0aGlzLl9zdGF0ZS5jaGVja2JveENvbHVtbldpZHRoO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbGdyb3VwLmxlZnRGaXhlZFdpZHRoID0gY29sZ3JvdXAubGVmdEZpeGVkV2lkdGggLSB0aGlzLl9zdGF0ZS5jaGVja2JveENvbHVtbldpZHRoO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5jb2x1bW5SZXNpemVTdWJqZWN0Lm5leHQoY29sZ3JvdXApO1xyXG4gICAgfVxyXG5cclxuICAgIGhpZGVDaGVja2JveCgpIHtcclxuICAgICAgICB0aGlzLnNob3dDaGVja2JveChmYWxzZSk7XHJcbiAgICB9XHJcblxyXG4gICAgc2hvd0xpbmVOdW1iZXIoaXNTaG93ID0gdHJ1ZSkge1xyXG4gICAgICAgIGNvbnN0IGNvbGdyb3VwID0gdGhpcy5fc3RhdGUuY29sdW1uc0dyb3VwO1xyXG4gICAgICAgIHRoaXMudXBkYXRlU3RhdGUoe3Nob3dMaW5lTnVtYmVyOiBpc1Nob3d9LCBmYWxzZSk7XHJcbiAgICAgICAgaWYgKGlzU2hvdykge1xyXG4gICAgICAgICAgICBjb2xncm91cC5sZWZ0Rml4ZWRXaWR0aCA9IGNvbGdyb3VwLmxlZnRGaXhlZFdpZHRoICsgdGhpcy5fc3RhdGUubGluZU51bWJlcldpZHRoO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbGdyb3VwLmxlZnRGaXhlZFdpZHRoID0gY29sZ3JvdXAubGVmdEZpeGVkV2lkdGggLSB0aGlzLl9zdGF0ZS5saW5lTnVtYmVyV2lkdGg7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmNvbHVtblJlc2l6ZVN1YmplY3QubmV4dChjb2xncm91cCk7XHJcbiAgICB9XHJcblxyXG4gICAgaGlkZUxpbmVOdW1iZXIoKSB7XHJcbiAgICAgICAgdGhpcy5zaG93TGluZU51bWJlcihmYWxzZSk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0U29ydEluZm8oc29ydE5hbWUsIHNvcnRPcmRlcikge1xyXG4gICAgICAgIHNvcnROYW1lID0gc29ydE5hbWUgfHwgJyc7XHJcbiAgICAgICAgc29ydE9yZGVyID0gc29ydE9yZGVyIHx8ICcnO1xyXG4gICAgICAgIGNvbnN0IGZpZWxkcyA9IHNvcnROYW1lLnNwbGl0KCcsJyk7XHJcbiAgICAgICAgY29uc3Qgb3JkZXJzID0gc29ydE9yZGVyLnNwbGl0KCcsJyk7XHJcbiAgICAgICAgLy8gaWYgKCF0aGlzLl9zdGF0ZS5tdWx0aVNvcnQpIHtcclxuICAgICAgICBjb25zdCBjb2xncm91cCA9IHRoaXMuX3N0YXRlLmNvbHVtbnNHcm91cDtcclxuXHJcbiAgICAgICAgY29uc3QgdXBkYXRlRmllbGRPcmRlciA9IChjb2xzOiBEYXRhQ29sdW1uW10pID0+IHtcclxuICAgICAgICAgICAgaWYgKCFjb2xzIHx8ICFjb2xzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbHMuZm9yRWFjaCggY29sID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbC5vcmRlciA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGkgPSBmaWVsZHMuZmluZEluZGV4KGYgPT4gZiA9PT0gY29sLmZpZWxkKTtcclxuICAgICAgICAgICAgICAgIGlmIChpID4gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb2wub3JkZXIgPSBvcmRlcnNbaV07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHVwZGF0ZUZpZWxkT3JkZXIoY29sZ3JvdXAubm9ybWFsQ29sdW1ucyk7XHJcbiAgICAgICAgdXBkYXRlRmllbGRPcmRlcihjb2xncm91cC5sZWZ0Rml4ZWQpO1xyXG4gICAgICAgIHVwZGF0ZUZpZWxkT3JkZXIoY29sZ3JvdXAucmlnaHRGaXhlZCk7XHJcbiAgICAgICAgLy8gfVxyXG5cclxuICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlKHtzb3J0TmFtZSwgc29ydE9yZGVyfSwgZmFsc2UpO1xyXG4gICAgfVxyXG5cclxuICAgIG9yZGVyQnkoYXJyLCBwcm9wczogYW55W10sIG9yZGVyczogYW55W10pIHtcclxuICAgICAgICBjb25zdCBjb2xPYmogPSBwcm9wcy5yZWR1Y2UoKGMsIG4pID0+IHtcclxuICAgICAgICAgICAgY1tuXSA9IHRoaXMuZ2V0Q29sdW1uKG4pO1xyXG4gICAgICAgICAgICByZXR1cm4gYztcclxuICAgICAgICB9LCB7fSk7XHJcblxyXG4gICAgICAgIHJldHVybiBbLi4uYXJyXS5zb3J0KChhLCBiKSA9PlxyXG4gICAgICAgICAgICBwcm9wcy5yZWR1Y2UoKGFjYywgcHJvcCwgaSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKGFjYyA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCB2YWxBID0gVXRpbHMuZ2V0VmFsdWUocHJvcCwgYSk7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHZhbEIgPSBVdGlscy5nZXRWYWx1ZShwcm9wLCBiKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbE9ialtwcm9wXSAmJiBjb2xPYmpbcHJvcF1bJ2lzTXVsdGlsaW5ndWFsRmllbGQnXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWxBID0gVXRpbHMuZ2V0TXVsdGlsaW5ndWFsVmFsdWUodmFsQSwgdGhpcy5sb2NhbElkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsQiA9IFV0aWxzLmdldE11bHRpbGluZ3VhbFZhbHVlKHZhbEIsIHRoaXMubG9jYWxJZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAodmFsQSA9PT0gdW5kZWZpbmVkIHx8IHZhbEEgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsQSA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAodmFsQiA9PT0gdW5kZWZpbmVkIHx8IHZhbEIgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsQiA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgW3AxLCBwMl0gPSBvcmRlcnMgJiYgb3JkZXJzW2ldID09PSAnZGVzYycgPyBbdmFsQiwgdmFsQV0gOiBbdmFsQSwgdmFsQl07XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBwMSA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWNjID0gcDEubG9jYWxlQ29tcGFyZShwMik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWNjID0gcDEgPiBwMiA/IDEgOiBwMSA8IHAyID8gLTEgOiAwO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiBhY2M7XHJcbiAgICAgICAgICAgIH0sIDApXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBzb3J0KGRhdGE6IGFueSkge1xyXG4gICAgICAgIGNvbnN0IG9yZGVycyA9IHRoaXMuX3N0YXRlLnNvcnRPcmRlci5zcGxpdCgnLCcpO1xyXG4gICAgICAgIGNvbnN0IGZpZWxkcyA9IHRoaXMuX3N0YXRlLnNvcnROYW1lLnNwbGl0KCcsJyk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLl9zdGF0ZS5tZXJnZUNlbGwgJiYgdGhpcy5fc3RhdGUubWVyZ2VGaWVsZHMgJiYgdGhpcy5fc3RhdGUubWVyZ2VGaWVsZHMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG5ld09yZGVycyA9IFtdO1xyXG4gICAgICAgICAgICBjb25zdCBuZXdGaWVsZHMgPSBbLi4udGhpcy5fc3RhdGUubWVyZ2VGaWVsZHNdO1xyXG4gICAgICAgICAgICBmaWVsZHMuZm9yRWFjaCgoZiwgaSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgbGV0IGsgPSBuZXdGaWVsZHMuaW5kZXhPZihmKTtcclxuICAgICAgICAgICAgICAgIGlmIChrID09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV3RmllbGRzLnB1c2goZik7XHJcbiAgICAgICAgICAgICAgICAgICAgayA9IG5ld0ZpZWxkcy5sZW5ndGggLSAxO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgbmV3T3JkZXJzW2tdID0gb3JkZXJzW2ldO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLm9yZGVyQnkoZGF0YSwgbmV3RmllbGRzLCBuZXdPcmRlcnMpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMub3JkZXJCeShkYXRhLCBmaWVsZHMsIG9yZGVycyk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGNsaWVudFNvcnQoZGF0YT86IGFueSkge1xyXG4gICAgICAgIGlmICh0aGlzLl9zdGF0ZS5zb3J0TmFtZSkge1xyXG4gICAgICAgICAgICBpZiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVTdGF0ZSh7IGRhdGEgfSwgZmFsc2UpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IHNvcnRlZERhdGEgPSB0aGlzLnNvcnQodGhpcy5fc3RhdGUuZGF0YSk7XHJcbiAgICAgICAgICAgIHRoaXMubG9hZERhdGEoc29ydGVkRGF0YSwgZmFsc2UpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2xlYXJTb3J0KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmNsaWVudFNvcnQkLmVtaXQoe3NvcnROYW1lOiB0aGlzLl9zdGF0ZS5zb3J0TmFtZSwgc29ydE9yZGVyOiB0aGlzLl9zdGF0ZS5zb3J0T3JkZXJ9KTtcclxuICAgIH1cclxuXHJcbiAgICBjbGVhclNvcnQoKSB7XHJcbiAgICAgICAgdGhpcy5sb2FkRGF0YSh0aGlzLl9zdGF0ZS5vcmlnaW5hbERhdGEsIGZhbHNlKTtcclxuICAgIH1cclxuXHJcbiAgICBsb2FkRmlsdGVyRGF0YShmaWx0ZXJEYXRhOiBhbnlbXSkge1xyXG4gICAgICAgIHRoaXMubG9hZERhdGEoZmlsdGVyRGF0YSwgZmFsc2UpO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICAvLyNyZWdpb24g5Y+Y5pu06ZuGXHJcblxyXG4gICAgcHJpdmF0ZSBoYXNSb3dDaGFuZ2VzKHJvd2lkOiBhbnkpIHtcclxuICAgICAgICBjb25zdCBfY2hhbmdlcyA9IHRoaXMuX3N0YXRlLmNoYW5nZXM7XHJcbiAgICAgICAgaWYgKCFfY2hhbmdlcykge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBfY2hhbmdlc1tyb3dpZF07XHJcbiAgICB9XHJcblxyXG4gICAgYXBwZW5kQ2hhbmdlcyhjaGFuZ2VzOiBSb3dEYXRhQ2hhbmdlcykge1xyXG4gICAgICAgIGlmICghY2hhbmdlcykge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGlkID0gY2hhbmdlc1t0aGlzLl9zdGF0ZS5pZEZpZWxkXTtcclxuICAgICAgICBpZiAoIWlkKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgX2lkID0gJycgKyBpZDtcclxuICAgICAgICBpZiAoIXRoaXMuaGFzUm93Q2hhbmdlcyhfaWQpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3N0YXRlLmNoYW5nZXMgPSB0aGlzLl9zdGF0ZS5jaGFuZ2VzIHx8IHt9O1xyXG4gICAgICAgICAgICB0aGlzLl9zdGF0ZS5jaGFuZ2VzW19pZF0gPSBjaGFuZ2VzO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3N0YXRlLmNoYW5nZXNbX2lkXSA9IE9iamVjdC5hc3NpZ24odGhpcy5fc3RhdGUuY2hhbmdlc1tfaWRdLCBjaGFuZ2VzKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgYWNjZXB0Q2hhbmdlcygpIHtcclxuICAgICAgICBjb25zdCBjaGFuZ2VzID0gdGhpcy5fc3RhdGUuY2hhbmdlcztcclxuICAgICAgICBpZiAoY2hhbmdlcykge1xyXG4gICAgICAgICAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMoY2hhbmdlcyk7XHJcbiAgICAgICAgICAgIGtleXMuZm9yRWFjaChpZCA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVJvdyhpZCwgY2hhbmdlc1tpZF0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdGhpcy5fc3RhdGUub3JpZ2luYWxEYXRhID0gY2xvbmVEZWVwKHRoaXMuX3N0YXRlLmRhdGEpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJlamVjdENoYW5nZXMocm93aWQgPSBudWxsKSB7XHJcbiAgICAgICAgY29uc3QgY2hhbmdlcyA9IHRoaXMuX3N0YXRlLmNoYW5nZXM7XHJcbiAgICAgICAgaWYgKGNoYW5nZXMpIHtcclxuICAgICAgICAgICAgaWYgKCFyb3dpZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fc3RhdGUuZGF0YSA9IGNsb25lRGVlcCh0aGlzLl9zdGF0ZS5vcmlnaW5hbERhdGEpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fc3RhdGUuY2hhbmdlcyA9IG51bGw7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCByb3dDaGFuZ2VzID0gIHRoaXMuX3N0YXRlLmNoYW5nZXNbJycgKyByb3dpZF07XHJcbiAgICAgICAgICAgICAgICBpZiAocm93Q2hhbmdlcykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG9yZ2lSb3cgPSB0aGlzLl9zdGF0ZS5vcmlnaW5hbERhdGEuZmluZChyID0+IHRoaXMucHJpbWFyeUlkKHIpID09PSByb3dpZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc3RhdGUuZGF0YS5mb3JFYWNoKHIgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5wcmltYXJ5SWQocikgPT09IHJvd2lkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByID0gY2xvbmVEZWVwKG9yZ2lSb3cpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMucmVmcmVzaCgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBnZXRDaGFuZ2VzKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9zdGF0ZS5jaGFuZ2VzO1xyXG4gICAgfVxyXG5cclxuICAgIHJlZnJlc2goKSB7XHJcbiAgICAgICAgY29uc3QgZGF0YSA9IGNsb25lRGVlcCh0aGlzLl9zdGF0ZS5kYXRhKTtcclxuICAgICAgICB0aGlzLmxvYWREYXRhKGRhdGEpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vI2VuZHJlZ2lvblxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5p6E6YCg5ZCI6K6h6KGMXHJcbiAgICAgKiBAcGFyYW0gZGF0YSDmlbDmja7pm4blkIhcclxuICAgICAqL1xyXG4gICAgZ2V0Rm9vdGVyRGF0YShkYXRhKSB7XHJcbiAgICAgICAgaWYgKCFkYXRhIHx8ICFkYXRhLmxlbmd0aCkge1xyXG4gICAgICAgICAgICByZXR1cm4gW107XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBjb25zdCBjb2x1bW5zID0gdGhpcy5fc3RhdGUuZmxhdENvbHVtbnM7XHJcbiAgICAgICAgY29uc3QgY29sdW1ucyA9IGZsYXR0ZW48RGF0YUNvbHVtbj4odGhpcy5fc3RhdGUuY29sdW1ucykuZmlsdGVyKChjb2w6IERhdGFDb2x1bW4pID0+ICFjb2wuY29sc3Bhbik7XHJcbiAgICAgICAgY29uc3QgZm9vdGVyUm93ID0ge307XHJcblxyXG4gICAgICAgIGNvbHVtbnMuZm9yRWFjaChjb2wgPT4ge1xyXG4gICAgICAgICAgICBpZiAoY29sLmZvb3RlciAmJiBjb2wuZm9vdGVyLm9wdGlvbnMpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG9wdGlvbnMgPSBjb2wuZm9vdGVyLm9wdGlvbnM7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB0ZXh0ID0gb3B0aW9ucy50ZXh0O1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdHlwID0gb3B0aW9ucy5jYWxjdWxhdGlvblR5cGUgYXMgQ2FsY3VsYXRpb25UeXBlO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0eXAgIT09IHVuZGVmaW5lZCAmJiB0eXAgIT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWwgPSB0aGlzLmNhbGN1bGF0aW9uKGRhdGEsIHR5cCwgY29sKTtcclxuICAgICAgICAgICAgICAgICAgICBmb290ZXJSb3dbY29sLmZpZWxkXSA9IHZhbDtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9vdGVyUm93W2NvbC5maWVsZF0gPSB0ZXh0IHx8ICcnO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgZm9vdGVyUm93W2NvbC5maWVsZF0gPSAnJztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gW2Zvb3RlclJvd107XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBhcnJUb0dyb3VwKGl0ZW1zLCBmaWVsZHM6IHN0cmluZ1tdKSB7XHJcbiAgICAgICAgaWYgKGZpZWxkcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgY29uc3QgZmlyc3QgPSBmaWVsZHMuc2hpZnQoKTtcclxuICAgICAgICAgICAgY29uc3QgZzEgPSBncm91cEJ5KGl0ZW1zLCAobikgPT4gVXRpbHMuZ2V0VmFsdWUoZmlyc3QsIG4pKTtcclxuICAgICAgICAgICAgdGhpcy50b0dyb3VwKGcxLCBmaWVsZHMpO1xyXG4gICAgICAgICAgICByZXR1cm4gZzE7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgdG9Hcm91cChnMSwgZmllbGRBcnIpIHtcclxuICAgICAgICBpZiAoZmllbGRBcnIubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIE9iamVjdC5rZXlzKGcxKS5mb3JFYWNoKChrKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBpdGVtcyA9IGcxW2tdO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgX25leHRGaWVsZHMgPSBmaWVsZEFyci5tYXAoKG4pID0+IG4pO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgX2YgPSBfbmV4dEZpZWxkcy5zaGlmdCgpO1xyXG4gICAgICAgICAgICAgICAgZzFba10gPSBncm91cEJ5KGl0ZW1zLCAobikgPT4gVXRpbHMuZ2V0VmFsdWUoX2YsIG4pKTtcclxuICAgICAgICAgICAgICAgIGlmIChfbmV4dEZpZWxkcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnRvR3JvdXAoZzFba10sIF9uZXh0RmllbGRzKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ3JvdXBSb3dzMkZsYXQoZ3JvdXBSb3dzLCBpbml0TGV2ZWwsIHBhcmVudCkge1xyXG4gICAgICAgIGxldCByZXN1bHRzID0gW107XHJcbiAgICAgICAgaWYgKGluaXRMZXZlbCA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIGluaXRMZXZlbCA9IDA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGlkZmllbGQgPSB0aGlzLl9zdGF0ZS5pZEZpZWxkO1xyXG4gICAgICAgIGNvbnN0IGNvbHVtbnMgPSB0aGlzLl9zdGF0ZS5mbGF0Q29sdW1ucztcclxuICAgICAgICBjb25zdCBkYXRhID0gdGhpcy5fc3RhdGUuZGF0YTtcclxuICAgICAgICBjb25zdCBncm91cEZpZWxkQXJyID0gdGhpcy5fc3RhdGUuZ3JvdXBGaWVsZC5zcGxpdCgnLCcpO1xyXG4gICAgICAgIGNvbnN0IHBpZCA9IHBhcmVudCA/IHBhcmVudFtpZGZpZWxkXSA6IG51bGw7XHJcbiAgICAgICAgY29uc3QgY29sc3BhbiA9IHRoaXMuX3N0YXRlLmNvbHVtbnNHcm91cC5ub3JtYWxDb2x1bW5zLmxlbmd0aDtcclxuXHJcbiAgICAgICAgY29uc3QgZXhwYW5kR3JvdXBSb3dzID0gdGhpcy5fc3RhdGUuZXhwYW5kR3JvdXBSb3dzO1xyXG5cclxuICAgICAgICBPYmplY3Qua2V5cyhncm91cFJvd3MpLmZvckVhY2goKGssIG0pID0+IHtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGdyb3VwSXRlbSA9IHsgW2lkZmllbGRdOiBVdGlscy51dWlkKCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW0lTX0dST1VQX1JPV19GSUVMRF06IHRydWUsIFtHUk9VUF9MRVZFTF9GSUVMRF06IGluaXRMZXZlbCwgZGF0YTogeyB9LCB2YWx1ZTogayxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbR1JPVVBfVklTSUJMRV9GSUVMRF06IHRydWUsIGV4cGFuZGVkOiBleHBhbmRHcm91cFJvd3MsIGZpZWxkOiBncm91cEZpZWxkQXJyW2luaXRMZXZlbF0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sc3BhbiwgdG90YWw6IDAsIHJvd3M6IFtdLCBbR1JPVVBfUk9XX0ZJRUxEXTogcGlkfTtcclxuXHJcbiAgICAgICAgICAgIC8vIFRGUzogMzU2OTU1XHJcbiAgICAgICAgICAgIGlmIChwYXJlbnQpIHtcclxuICAgICAgICAgICAgICAgIGdyb3VwSXRlbS5yb3dzID0gcGFyZW50LnJvd3MuZmlsdGVyKG4gPT4gIW5bSVNfR1JPVVBfUk9XX0ZJRUxEXSAmJlxyXG4gICAgICAgICAgICAgICAgICAgICFuW0lTX0dST1VQX0ZPT1RFUl9ST1dfRklFTERdICYmICBVdGlscy5nZXRWYWx1ZShncm91cEZpZWxkQXJyW2luaXRMZXZlbF0sIG4pID09PSBrKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGdyb3VwSXRlbS5yb3dzID0gZGF0YS5maWx0ZXIobiA9PiAnJyArIFV0aWxzLmdldFZhbHVlKGdyb3VwRmllbGRBcnJbaW5pdExldmVsXSwgbikgPT09IGspO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAocGFyZW50KSB7XHJcbiAgICAgICAgICAgICAgICBwYXJlbnQucm93cy5wdXNoKGdyb3VwSXRlbSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGdyb3VwSXRlbS50b3RhbCA9IGdyb3VwSXRlbS5yb3dzLmZpbHRlcihuID0+ICFuW0lTX0dST1VQX1JPV19GSUVMRF0gJiYgIW5bSVNfR1JPVVBfRk9PVEVSX1JPV19GSUVMRF0pLmxlbmd0aDtcclxuXHJcbiAgICAgICAgICAgIHJlc3VsdHMucHVzaChncm91cEl0ZW0pO1xyXG4gICAgICAgICAgICBjb25zdCBpdGVtcyA9IGdyb3VwUm93c1trXTtcclxuICAgICAgICAgICAgaWYgKGlzUGxhaW5PYmplY3QoaXRlbXMpKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBsZXZlbCA9IGluaXRMZXZlbCArIDE7XHJcbiAgICAgICAgICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5jb25jYXQodGhpcy5ncm91cFJvd3MyRmxhdChpdGVtcywgbGV2ZWwsIGdyb3VwSXRlbSkpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgZ3JvdXBJdGVtLnRvdGFsID0gaXRlbXMubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgaXRlbXMubWFwKG4gPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIG5bR1JPVVBfUk9XX0ZJRUxEXSA9IGdyb3VwSXRlbVtpZGZpZWxkXTtcclxuICAgICAgICAgICAgICAgICAgICBuW0dST1VQX1ZJU0lCTEVfRklFTERdID0gZXhwYW5kR3JvdXBSb3dzO1xyXG4gICAgICAgICAgICAgICAgICAgIG5bR1JPVVBfTEVWRUxfRklFTERdID0gZ3JvdXBJdGVtW0dST1VQX0xFVkVMX0ZJRUxEXSArIDE7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG47XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIGdyb3VwSXRlbS5yb3dzID0gaXRlbXM7XHJcbiAgICAgICAgICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5jb25jYXQoaXRlbXMpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5fc3RhdGUuZ3JvdXBGb290ZXIpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGZvb3Rlckl0ZW0gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgW0lTX0dST1VQX0ZPT1RFUl9ST1dfRklFTERdOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIFtHUk9VUF9ST1dfRklFTERdOiBncm91cEl0ZW1baWRmaWVsZF0sXHJcbiAgICAgICAgICAgICAgICAgICAgW0dST1VQX1ZJU0lCTEVfRklFTERdOiBleHBhbmRHcm91cFJvd3MsXHJcbiAgICAgICAgICAgICAgICAgICAgW0dST1VQX0xFVkVMX0ZJRUxEXTogaW5pdExldmVsLFxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IHt9XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgZ3JvdXBJdGVtLnJvd3MucHVzaChmb290ZXJJdGVtKTtcclxuICAgICAgICAgICAgICAgIHJlc3VsdHMucHVzaChmb290ZXJJdGVtKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiByZXN1bHRzO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKiDmm7TmlrDliIbnu4TlkIjorqHooYzmlbDmja4gKi9cclxuICAgIHByaXZhdGUgdXBkYXRlR3JvdXBGb290ZXJEYXRhKGdyb3VwRm9vdGVyUm93OiBhbnksIGNvbHVtbnM6IGFueSwgZ3JvdXBSb3dzOiBhbnkpIHtcclxuICAgICAgICBjb2x1bW5zLmZvckVhY2goY29sID0+IHtcclxuICAgICAgICAgICAgaWYgKGNvbC5ncm91cEZvb3RlciAmJiBjb2wuZ3JvdXBGb290ZXIub3B0aW9ucykge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgb3B0aW9ucyA9IGNvbC5ncm91cEZvb3Rlci5vcHRpb25zO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdGV4dCA9IG9wdGlvbnMudGV4dDtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHR5cCA9IG9wdGlvbnMuY2FsY3VsYXRpb25UeXBlIGFzIENhbGN1bGF0aW9uVHlwZTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodHlwICE9PSB1bmRlZmluZWQgJiYgdHlwICE9IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsID0gdGhpcy5jYWxjdWxhdGlvbihncm91cFJvd3MsIHR5cCwgY29sKTtcclxuICAgICAgICAgICAgICAgICAgICBncm91cEZvb3RlclJvdy5kYXRhW2NvbC5maWVsZF0gPSB2YWw7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGdyb3VwRm9vdGVyUm93LmRhdGFbY29sLmZpZWxkXSA9IHRleHQgfHwgJyc7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBncm91cEZvb3RlclJvdy5kYXRhW2NvbC5maWVsZF0gPSAnJztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKiDlpJrlrZfmrrXliIbnu4RcclxuICAgICAqIGdyb3VwRmllbGQg5Lul6YCX5Y+35YiG6ZqU77yM5LuO5bem5Yiw5Y+z5L6d5qyh6L+b6KGM5YiG57uEXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgZ3JvdXBSb3dzMihkYXRhOiBhbnlbXSkge1xyXG4gICAgICAgIGlmIChkYXRhICYmIGRhdGEubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbHVtbnMgPSB0aGlzLl9zdGF0ZS5mbGF0Q29sdW1ucztcclxuICAgICAgICAgICAgY29uc3QgZ3JvdXBGaWVsZCA9IHRoaXMuX3N0YXRlLmdyb3VwRmllbGQgfHwgJyc7XHJcblxyXG4gICAgICAgICAgICBpZiAoIWdyb3VwRmllbGQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjb25zdCBncm91cERhdGEgPSB0aGlzLmFyclRvR3JvdXAoZGF0YSwgZ3JvdXBGaWVsZC5zcGxpdCgnLCcpKTtcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5ncm91cFJvd3MyRmxhdChncm91cERhdGEsIDAsIG51bGwpO1xyXG5cclxuICAgICAgICAgICAgbGV0IGsgPSAwO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgcHJvdyA9IChwaWQpID0+IHJlc3VsdC5maW5kKG4gPT4gblt0aGlzLl9zdGF0ZS5pZEZpZWxkXSA9PT0gcGlkKTtcclxuXHJcbiAgICAgICAgICAgIHJlc3VsdC5tYXAoKG4sIGkpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmICghbltJU19HUk9VUF9ST1dfRklFTERdICYmICFuW0lTX0dST1VQX0ZPT1RFUl9ST1dfRklFTERdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbltST1dfSU5ERVhfRklFTERdID0gaztcclxuICAgICAgICAgICAgICAgICAgICBrKys7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8g5pu05paw5ZCI6K6h6KGM5pWw5o2uXHJcbiAgICAgICAgICAgICAgICBpZiAobltJU19HUk9VUF9GT09URVJfUk9XX0ZJRUxEXSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJvd3MgPSBwcm93KG5bR1JPVVBfUk9XX0ZJRUxEXSkucm93cy5maWx0ZXIoKHI6IGFueSkgPT4gIXJbSVNfR1JPVVBfUk9XX0ZJRUxEXSAmJiAhcltJU19HUk9VUF9GT09URVJfUk9XX0ZJRUxEXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVHcm91cEZvb3RlckRhdGEobiwgY29sdW1ucywgcm93cyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG47XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIFtdO1xyXG4gICAgfVxyXG5cclxuICAgIHNob3dHcm91cEZvb3Rlcihncm91cEZvb3Rlcikge1xyXG4gICAgICAgIHRoaXMudXBkYXRlU3RhdGUoe2dyb3VwRm9vdGVyfSwgZmFsc2UpO1xyXG4gICAgICAgIHRoaXMudXBkYXRlVmlydGh1YWxSb3dzKDApO1xyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZUdyb3VwRm9vdGVyKGdyb3VwUm93SWQ6IHN0cmluZykge1xyXG4gICAgICAgIGNvbnN0IGdyb3VwUm93ID0gdGhpcy5fc3RhdGUudmlydHVhbC52aXJ0dWFsUm93cy5maW5kKChuOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIG5bJ2lkJ10gPT09IGdyb3VwUm93SWQ7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGlmIChncm91cFJvdykge1xyXG4gICAgICAgICAgICBjb25zdCBncm91cFJvd3MgPSBncm91cFJvdy5yb3dzO1xyXG4gICAgICAgICAgICBjb25zdCBncm91cEZvb3RlclJvd3MgPSBncm91cFJvd3MuZmlsdGVyKChuOiBhbnkpID0+IG5bJ19fZ3JvdXBfZm9vdGVyX18nXSk7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbHVtbnMgPSB0aGlzLl9zdGF0ZS5mbGF0Q29sdW1ucztcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHJvd3MgPSBncm91cFJvd3MuZmlsdGVyKChuOiBhbnkpID0+ICFuWydfX2dyb3VwX2Zvb3Rlcl9fJ10pO1xyXG5cclxuICAgICAgICAgICAgZ3JvdXBGb290ZXJSb3dzLmZvckVhY2goKG46IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVHcm91cEZvb3RlckRhdGEobiwgY29sdW1ucywgcm93cyk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNhbGN1bGF0aW9uKGRhdGE6IGFueSwgdHlwOiBDYWxjdWxhdGlvblR5cGUsIGNvbDogYW55KSB7XHJcbiAgICAgICAgbGV0IHZhbDogYW55ID0gJyc7XHJcbiAgICAgICAgLy8gVEZTOiAzNTcwMDBcclxuICAgICAgICAvLyBodHRwOi8vMTAuMjQuMS4xMTo4MDgwL3Rmcy9HU1AvR1NQQ2xvdWQvd2ViL19xdWVyaWVzP2lkPTM1NzAwMCZ0cmlhZ2U9dHJ1ZSZmdWxsU2NyZWVuPWZhbHNlJl9hPWVkaXRcclxuICAgICAgICBpZiAoIWRhdGEgfHwgIWRhdGEubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAnJztcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgZmllbGQgPSBjb2wuZmllbGQ7XHJcbiAgICAgICAgY29uc3QgYXJyID0gZGF0YS5tYXAoKG8pID0+IFV0aWxzLmdldFZhbHVlKGZpZWxkLCBvKSB8fCAwKTtcclxuICAgICAgICBzd2l0Y2ggKHR5cCkge1xyXG4gICAgICAgICAgICBjYXNlIENhbGN1bGF0aW9uVHlwZS5zdW06XHJcbiAgICAgICAgICAgICAgICAvLyB2YWwgPSBzdW1CeShkYXRhLCAobykgPT4gVXRpbHMuZ2V0VmFsdWUoZmllbGQsIG8pKTtcclxuICAgICAgICAgICAgICAgIHZhbCA9IEJpZ051bWJlci5zdW0uYXBwbHkobnVsbCwgYXJyKS50b0ZpeGVkKCk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBDYWxjdWxhdGlvblR5cGUubWF4OlxyXG4gICAgICAgICAgICAgICAgLy8gY29uc3QgbWF4T2JqID0gbWF4QnkoZGF0YSwgKG8pID0+IFV0aWxzLmdldFZhbHVlKGZpZWxkLCBvKSk7XHJcbiAgICAgICAgICAgICAgICAvLyB2YWwgPSBVdGlscy5nZXRWYWx1ZShmaWVsZCwgbWF4T2JqKTtcclxuICAgICAgICAgICAgICAgIHZhbCA9IEJpZ051bWJlci5tYXguYXBwbHkobnVsbCwgYXJyKS50b0ZpeGVkKCk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBDYWxjdWxhdGlvblR5cGUubWluOlxyXG4gICAgICAgICAgICAgICAgLy8gY29uc3QgbWluT2JqID0gbWluQnkoZGF0YSwgKG8pID0+IFV0aWxzLmdldFZhbHVlKGZpZWxkLCBvKSk7XHJcbiAgICAgICAgICAgICAgICAvLyB2YWwgPSBVdGlscy5nZXRWYWx1ZShmaWVsZCwgbWluT2JqKTtcclxuICAgICAgICAgICAgICAgIHZhbCA9IEJpZ051bWJlci5taW4uYXBwbHkobnVsbCwgYXJyKS50b0ZpeGVkKCk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBDYWxjdWxhdGlvblR5cGUuYXZlcmFnZTpcclxuICAgICAgICAgICAgICAgIC8vIHZhbCA9IG1lYW5CeShkYXRhLCAobykgPT4gVXRpbHMuZ2V0VmFsdWUoZmllbGQsIG8pKTtcclxuICAgICAgICAgICAgICAgIHZhbCA9IEJpZ051bWJlci5zdW0uYXBwbHkobnVsbCwgYXJyKS5kaXYoYXJyLmxlbmd0aCkudG9GaXhlZCgpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgQ2FsY3VsYXRpb25UeXBlLmNvdW50OlxyXG4gICAgICAgICAgICAgICAgdmFsID0gZGF0YS5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHZhbDtcclxuICAgIH1cclxuXHJcbiAgICAvLyNyZWdpb24g57uE5Lu25Yid5aeL5bGe5oCnXHJcblxyXG4gICAgc2V0aW5pdGlhbE9wdGlvbnMob3B0czoge1trZXk6IHN0cmluZ106IGFueX0pIHtcclxuICAgICAgICB0aGlzLl9zdGF0ZS5pbml0aWFsT3B0aW9ucyA9IHt9O1xyXG4gICAgICAgIC8vIOWIhue7hFxyXG4gICAgICAgIHRoaXMuX3N0YXRlLmluaXRpYWxPcHRpb25zWydncm91cEZpZWxkJ10gPSBvcHRzLmdyb3VwRmllbGQ7XHJcblxyXG4gICAgICAgIC8vIOaOkuW6j1xyXG4gICAgICAgIHRoaXMuX3N0YXRlLmluaXRpYWxPcHRpb25zWydzb3J0J10gPSB7XHJcbiAgICAgICAgICAgIHNvcnROYW1lOiBvcHRzLnNvcnROYW1lLFxyXG4gICAgICAgICAgICBzb3J0T3JkZXI6IG9wdHMuc29ydE9yZGVyXHJcbiAgICAgICAgfTtcclxuICAgICAgICAvLyDliJfmmL7npLrpmpDol4/jgIHlr7npvZDmlrnlvI9cclxuICAgICAgICBpZiAob3B0cy5jb2x1bW5zICYmIG9wdHMuY29sdW1uc1swXSkge1xyXG4gICAgICAgICAgICB0aGlzLl9zdGF0ZS5pbml0aWFsT3B0aW9uc1snY29sdW1uRmllbGRzJ10gPSAob3B0cy5jb2x1bW5zWzBdIGFzIGFueSkubWFwKG4gPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICB3aWR0aDogbi53aWR0aCB8fCAxMDAsXHJcbiAgICAgICAgICAgICAgICAgICAgZmllbGQ6IG4uZmllbGQsXHJcbiAgICAgICAgICAgICAgICAgICAgaGFsaWduOiBuLmhhbGlnbixcclxuICAgICAgICAgICAgICAgICAgICBhbGlnbjogbi5hbGlnbixcclxuICAgICAgICAgICAgICAgICAgICB2aXNpYmxlOiBuLnZpc2libGUsXHJcbiAgICAgICAgICAgICAgICAgICAgZm9vdGVyOiBjbG9uZURlZXAobi5mb290ZXIgfHwge30pLFxyXG4gICAgICAgICAgICAgICAgICAgIGdyb3VwRm9vdGVyOiBjbG9uZURlZXAobi5ncm91cEZvb3RlciB8fCB7fSlcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyNlbmRyZWdpb25cclxufVxyXG4iXX0=