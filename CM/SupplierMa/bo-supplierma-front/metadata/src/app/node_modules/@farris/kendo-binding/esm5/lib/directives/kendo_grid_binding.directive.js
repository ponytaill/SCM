import * as tslib_1 from "tslib";
import { Directive, Input, HostListener, Optional, EventEmitter, Output, ContentChildren, QueryList, NgZone } from '@angular/core';
import { of } from 'rxjs';
import { GridComponent, DataBindingDirective, SelectionDirective, } from '@progress/kendo-angular-grid';
import { BindingData, ChangeType, FrameEventBus, UIState, Form, ViewModel } from '@farris/devkit';
import { DialogService } from '@farris/ui-dialog';
import { RuntimeStateService } from '@farris/ui-common';
import { DateTimeHelperService } from '@farris/ui-common/date';
import { FarrisKendoGridFormatService } from '../format/index';
import { GridColumnAggregateDirective } from './grid-summary.directive';
import { MultiSelectGridUtility } from '../util/multi_select_grid_utility';
import { SelectedRowContext } from '../entity/index';
/*
 * Kendo Grid 数据绑定指令
 *
 * TODO:
 * 1、整体刷存在性能问题；
 * 2、选中和当前行没有区分开；
 */
var KendoGridBindingDirective = /** @class */ (function (_super) {
    tslib_1.__extends(KendoGridBindingDirective, _super);
    /**
     * 构造函数
     * @param  grid 宿主Grid
     */
    function KendoGridBindingDirective(bindingData, uiState, eventBus, viewModel, grid, selectionDir, dialogSer, dateService, kendogridFormatSer, rts, ngZone) {
        var _this = _super.call(this, grid) || this;
        _this.bindingData = bindingData;
        _this.uiState = uiState;
        _this.eventBus = eventBus;
        _this.viewModel = viewModel;
        _this.grid = grid;
        _this.selectionDir = selectionDir;
        _this.dialogSer = dialogSer;
        _this.dateService = dateService;
        _this.kendogridFormatSer = kendogridFormatSer;
        _this.rts = rts;
        _this.ngZone = ngZone;
        /* 行样式事件 */
        // @Input()
        // rowClassName: (context: any) => any;
        // tslint:disable-next-line:no-output-rename
        _this.appendRow = new EventEmitter();
        /* 绑定排序事件 */
        _this.sortChangeEvent = new EventEmitter();
        /* 行样式事件 */
        _this.rowClass = new EventEmitter();
        _this.hiddenColLen = 0;
        /**
         * TODO: 从实体获取其默认值
         * 当前行索引值，默认第一个
         */
        _this.rowIndex = 0;
        _this.columnIndex = 0;
        _this.currentSkip = 0;
        /**
         * 是否启用多选，默认未启用
         */
        _this.isMultipleSelectionMode = false;
        /**
         * 上一个选中行，默认不存在
         */
        _this.lastRowIndex = -1;
        /**
         * 选中行切换事件
         */
        _this.selectedRowChange = new EventEmitter();
        /**
         * checkbox选择事件
         */
        _this.selectedCheckboxChange = new EventEmitter();
        _this.selectionDir.selectedKeys = [];
        _this.viewModel.uiState.setPropertyValue('ids', _this.selectionDir.selectedKeys);
        var appContext = _this.viewModel.frameContext.getFormAppContext();
        if (appContext && appContext.hasOwnProperty('messagePipe')) {
            appContext.messagePipe.subscribe(function (message) {
                _this.grid.closeCell();
            });
        }
        return _this;
    }
    Object.defineProperty(KendoGridBindingDirective.prototype, "gridOption", {
        get: function () {
            return this.grid['gridOption'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(KendoGridBindingDirective.prototype, "len", {
        get: function () {
            return this.grid.columns.length;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(KendoGridBindingDirective.prototype, "IsMultipleSelectionMode", {
        get: function () {
            if (!this.grid) {
                return this.isMultipleSelectionMode;
            }
            if (this.grid.selectable) { // 优先尝试从this.grid.selectable获取
                // tslint:disable-next-line: no-string-literal
                if (this.grid.selectable['mode'] === 'multiple') {
                    this.isMultipleSelectionMode = true;
                }
                else {
                    this.isMultipleSelectionMode = false;
                }
            }
            else {
                if (this.grid.selectableSettings && this.grid.selectableSettings.mode === 'multiple') {
                    this.isMultipleSelectionMode = true;
                }
            }
            return this.isMultipleSelectionMode;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(KendoGridBindingDirective.prototype, "bindingList", {
        /**
         * 绑定列表(Grid对应数据源)
         */
        get: function () {
            // 根实体
            if (this.viewModel.bindingPath === '/' || !this.viewModel.bindingPath) {
                return this.bindingData.list;
            }
            // 子实体
            var bindingPath = this.viewModel.bindingPath.substr(1);
            bindingPath = bindingPath[0].toLowerCase() + bindingPath.substring(1, bindingPath.length);
            var paths = bindingPath.split('/');
            var filteredPaths = paths.filter(function (part) {
                return part !== '';
            });
            return this.bindingData.getValue(filteredPaths);
        },
        enumerable: true,
        configurable: true
    });
    /**
     * 获取分页信息
     */
    KendoGridBindingDirective.prototype.getPagingInfo = function () {
        var bindingPath = this.viewModel.bindingPath;
        var bindingData = this.viewModel.bindingData;
        var pagingInfo = bindingData.pagingInfo;
        if (bindingPath === '/') {
            return pagingInfo;
        }
        else {
            var bindingPaths = bindingPath.substr(1).split('/').filter(function (item) { return !!item && item.length > 0; }).map(function (item) {
                return item.substring(0, item.length - 1);
            });
            bindingPaths.forEach(function (path) {
                pagingInfo = pagingInfo && pagingInfo[path] || {};
            });
            return pagingInfo;
        }
    };
    /**
     * 指令初始化后
     */
    KendoGridBindingDirective.prototype.ngOnInit = function () {
        var _this = this;
        _super.prototype.ngOnInit.call(this);
        // 初始化state，分组使用。
        this.initDataState();
        this.refreshView();
        // 数据变化
        this.bindingChangeSubscription = this.bindingData.changes.subscribe(function (change) {
            _this.refreshView(change);
            if (change.type === ChangeType.Load) {
                // load时，在多选模式下，需清空选中集合
                if (_this.isMultipleSelectionMode) {
                    var isMatch_1 = _this.checkIfChangeMatchBindingPath(change);
                    if (isMatch_1) {
                        // 清空多选集合
                        _this.selectionDir.selectedKeys = [];
                        _this.viewModel.uiState.setPropertyValue('ids', _this.selectionDir.selectedKeys);
                        _this.ngZone.runOutsideAngular(function () {
                            // 渲染初始选中行
                            setTimeout(function () {
                                var rowSelectedContext = new SelectedRowContext();
                                var isPageable = MultiSelectGridUtility.checkIfEnablePaging(_this.grid);
                                if (isPageable) {
                                    _this.rowIndex = _this.grid.skip;
                                }
                                else {
                                    _this.rowIndex = 0;
                                }
                                rowSelectedContext.currentRowIndex = _this.rowIndex;
                                rowSelectedContext.lastRowIndex = _this.lastRowIndex;
                                _this.handleSelectedRowChange(rowSelectedContext);
                            }, 300);
                        });
                    }
                }
            }
            // TODO: 使用策略模式重构
            // bindingData 同步 SelectedKeys
            if (change.type === ChangeType.Remove) {
                _this.syncDeletedKeys(change.value);
            }
            var isMatch = _this.checkIfChangeMatchBindingPath(change);
            if (isMatch) {
                _this.handleSelectedKeyChange(_this.bindingList.currentId);
            }
            // 渲染当前行
            if (isMatch && _this.checkCurrentRowIdExists() && change.type === ChangeType.SelectionChanged && !_this.dataId) {
                _this.renderCurrentRow(_this.bindingList.currentId);
            }
            // tslint:disable-next-line: max-line-length
            // FIXME:需要有重置页码的时机
            /*if ((change.type === ChangeType.SelectionChanged || change.type === ChangeType.GlobalSelectionChanged) && this.currentRowId !== this.bindingList.currentId) {
                this.resetPageInfo();
            }*/
            // 触发变更检测
            if (change.type === ChangeType.Load || change.type === ChangeType.SelectionChanged
                || change.type === ChangeType.Append || change.type === ChangeType.Remove) {
                // 触发变更检测
                if (_this.grid && _this.grid['changeDetectorRef'] && _this.grid['changeDetectorRef']['detectChanges']) {
                    _this.grid['changeDetectorRef']['detectChanges']();
                }
            }
        });
        if (this.editable === true && this.form === null) {
            throw Error('启用编辑时，必须指定form');
        }
        if (!this.grid || !this.farrisBindingGridOption || !this.farrisBindingGridOption['fields']) {
            return;
        }
        var gridColumns = this.farrisBindingGridOption['fields'];
        var gridOption = this.farrisBindingGridOption;
        // 判断列中是否存在固定列
        gridOption.lockable = function (columns) {
            return columns.some(function (ele) {
                return ele.frozen;
            });
        };
        this.rowClass.emit(this.grid);
        // 添加列属性或者方法
        gridColumns.forEach(function (element) {
            // 自定义超链
            if (element.linkedLabelEnabled && !element.linkEvent) {
                element.linkEvent = function () {
                    return;
                };
            }
            // 若没有自定义格式化方法  每个列对象绑定格式化方法
            if (!element.getColumnFormat) {
                element.getColumnFormat = function (dataItem, column) {
                    return _this.kendogridFormatSer.getColumnFormat(dataItem, column);
                };
            }
            // 如果没有自定义类样式 每个列绑定 格式化方法
            if (!element.getClassName) {
                element.getClassName = function (dataItem, column) { return ''; };
            }
            // 自定义帮助前后事件
            if (element.editor && element.editor.type === 'LookupEdit') {
                // 帮助前事件
                if (!element.dictPicking) {
                    element.dictPicking = function (param) {
                        return of(true);
                    };
                }
                // 帮助后事件
                if (!element.dictPicked) {
                    element.dictPicked = function (param) {
                        // 重新进入编辑
                        _this.cellClickHandler(_this.cellClickParam);
                        return of(true);
                    };
                }
            }
        });
        // 绑定gridOption
        this.bindingGridOption();
        // 多选模式下，设置初始选中行
        if (this.IsMultipleSelectionMode) {
            // TODO: 移除 setTimeout
            var self_1 = this;
            this.ngZone.runOutsideAngular(function () {
                setTimeout(function () {
                    var rowSelectedContext = new SelectedRowContext();
                    rowSelectedContext.currentRowIndex = self_1.rowIndex;
                    rowSelectedContext.lastRowIndex = self_1.lastRowIndex;
                    self_1.handleSelectedRowChange(rowSelectedContext);
                }, 300);
            });
        }
    };
    KendoGridBindingDirective.prototype.ngAfterViewInit = function () {
        // this.gridElement = document.querySelector('.k-grid');
        // // 绑定grid keydown对象的方法
        // this.ngZone.runOutsideAngular(() => {
        //   this.gridKeydownEvent = this.enterCell.bind(this);
        //   this.gridCellClickEvent = this.cellClickHandler.bind(this);
        //   this.gridCellCloseEvent = this.cellCloseHandler.bind(this);
        //   this.gridElement.addEventListener('keydown', this.gridKeydownEvent);
        //   this.gridElement.addEventListener('cellClick', this.gridCellClickEvent);
        //   this.gridElement.addEventListener('cellClose', this.gridCellCloseEvent);
        // });
    };
    /**
     * 检测change的路径和BindingPath是否匹配
     */
    KendoGridBindingDirective.prototype.checkIfChangeMatchBindingPath = function (change) {
        var isMatch = false;
        if (!change || !change.path) {
            return isMatch;
        }
        var changePathArray = change.path;
        if (!changePathArray) {
            return isMatch;
        }
        if (!(this.bindingData) && !(this.bindingData.bindingPath)) {
            return isMatch;
        }
        var bingdingPathArray = this.bindingData.bindingPath.split('/');
        if (bingdingPathArray.length <= 0) {
            return isMatch;
        }
        if (changePathArray.length === 0) { // 主表
            if (this.bindingData.bindingPath === '/') {
                isMatch = true;
            }
        }
        else if (change.path.length === 1) { // 主从表
            if (bingdingPathArray.length === 2 && bingdingPathArray[1] === change.path[0]) {
                isMatch = true;
            }
        }
        else if (change.path.length === 2) { // 主从从表
            if (bingdingPathArray.length === 3 && bingdingPathArray[1] === change.path[0] && bingdingPathArray[2] === change.path[1]) {
                isMatch = true;
            }
        }
        return isMatch;
    };
    /**
     * 处理选中主键变更
     */
    KendoGridBindingDirective.prototype.handleSelectedKeyChange = function (currentId) {
        var selectedKeys = this.selectionDir.selectedKeys;
        if (!currentId) {
            // 如果当前行时null，但selectedKeys里有值，清空并发送一次行切换
            if (selectedKeys.length > 0) {
                var removedSelectedKeys = selectedKeys.splice(0, selectedKeys.length);
                if (removedSelectedKeys.indexOf(null) === -1) {
                    this.emitSelectedRowChange({ currentRowId: null });
                }
            }
            return;
        }
        var oldCurrentRowId = null;
        if (this.IsMultipleSelectionMode) {
            oldCurrentRowId = this.currentRowId;
        }
        else {
            oldCurrentRowId = this.selectionDir.selectedKeys.length === 0
                ? null : this.selectionDir.selectedKeys[0];
        }
        // TODO:if (this.currentRowId !== currentId) {
        if (oldCurrentRowId !== currentId) {
            var selectedRowContext = {};
            selectedRowContext.currentRowId = currentId;
            this.currentRowId = currentId;
            this.emitSelectedRowChange(selectedRowContext);
        }
    };
    /**
     * 发射选中行切换事件
     * @description 统一单选模式和多选模式下的行切换事件
     */
    KendoGridBindingDirective.prototype.emitSelectedRowChange = function (selectedRowContext) {
        if (!this.IsMultipleSelectionMode) { // 向后兼容
            var currentId = selectedRowContext.currentRowId;
            this.selectionDir.selectedKeys = [currentId];
            this.selectionDir.selectedKeysChange.emit(this.selectionDir.selectedKeys);
        }
        this.selectedRowChange.emit(selectedRowContext);
    };
    KendoGridBindingDirective.prototype.checkCurrentRowIdExists = function () {
        var isExist = false;
        if (this.bindingList && this.bindingList.currentId && this.bindingList.currentId.length > 0) {
            isExist = true;
        }
        return isExist;
    };
    /**
     * 同步已删除键到选中集合
     */
    KendoGridBindingDirective.prototype.syncDeletedKeys = function (deletedValueCollection) {
        var _this = this;
        if (!deletedValueCollection) {
            return;
        }
        deletedValueCollection.forEach(function (id) {
            var index = _this.selectionDir.selectedKeys.indexOf(id);
            if (index > -1) {
                _this.selectionDir.selectedKeys.splice(index, 1);
                // selectedKeys被清空的时候，触发一次行变更
                if (_this.selectionDir.selectedKeys.length === 0) {
                    _this.emitSelectedRowChange({ currentRowId: null });
                }
            }
        });
    };
    KendoGridBindingDirective.prototype.renderCurrentRow = function (currentId) {
        if (!currentId || currentId === '') { // 不存在当前行
            return;
        }
        // TODO:使用策略模式重构
        if (this.IsMultipleSelectionMode) {
            return;
        }
        this.renderSelectionRow(this.bindingList.currentId, this.selectionDir.selectedKeys);
    };
    /**
     * 指令输入变更处理
     */
    KendoGridBindingDirective.prototype.ngOnChanges = function (changes) {
        _super.prototype.ngOnChanges.call(this, changes);
        this.refreshView();
    };
    /**
     * 指令销毁，注销订阅
     */
    KendoGridBindingDirective.prototype.ngOnDestroy = function () {
        if (this.bindingChangeSubscription) {
            this.bindingChangeSubscription.unsubscribe();
        }
    };
    KendoGridBindingDirective.prototype.refreshView = function (change) {
        // this.bindData();
        this.refreshData(change);
        // 刷新页脚合计信息。客户端合计，暂时放这里，服务端合计时最好从这里移走。by justin
        this.refreshSummary();
    };
    /**
     * 绑定data到宿主grid上
     * @deprecated
     */
    KendoGridBindingDirective.prototype.bindData = function () {
        /*const data = this.bindingList.toJSON();
        let skip = 0;
        if (this.bindingList.pageIndex > 0) {
          skip = (this.bindingList.pageIndex - 1) * this.bindingList.pageSize;
        }
        this.updatePager(this.bindingList.pageSize, skip);
        const processed = process(data, Object.assign({}, this.state, { skip: 0 }));
        processed.total = this.bindingList.total;
        this.grid.data = processed;*/
    };
    KendoGridBindingDirective.prototype.refreshData = function (change) {
        var skip = 0;
        var _a = this.getPagingInfo() || {}, _b = _a.pageIndex, pageIndex = _b === void 0 ? 1 : _b, _c = _a.pageSize, pageSize = _c === void 0 ? 0 : _c;
        if (pageIndex > 0) {
            skip = (pageIndex - 1) * pageSize;
        }
        this.updatePager(pageSize, skip);
        this.endCellEdit(change);
        this.data = this.bindingList.toJSON({ ignoreMultiLangInput: true });
    };
    /**
     * 退出编辑状态
     * @param change 变更
     */
    KendoGridBindingDirective.prototype.endCellEdit = function (change) {
        var isEditing = this.grid.isEditing;
        if (change && change.type === ChangeType.Load && isEditing) {
            this.grid.cancelCell();
        }
    };
    KendoGridBindingDirective.prototype.refreshSummary = function () {
        var _this = this;
        if (this.aggrColumns) {
            this.aggrColumns.forEach(function (aggrCol) {
                if (aggrCol.aggregate) {
                    aggrCol.recalculateSummary(_this.bindingList);
                }
            });
        }
    };
    KendoGridBindingDirective.prototype.onPageChange = function (event) {
        var _a = event || {}, _b = _a.skip, skip = _b === void 0 ? 0 : _b, _c = _a.take, take = _c === void 0 ? 0 : _c;
        // this.bindingList.setPaginationInfo(skip, take);
        this.bindingData.setPagingInfo(skip, take, this.viewModel.bindingPath);
        // 移除选中行样式
        MultiSelectGridUtility.removeRowSelectedStyle(this.grid, this.rowIndex);
    };
    /**
     * 重置grid分页信息
     */
    KendoGridBindingDirective.prototype.resetPageInfo = function () {
        var _a = (this.getPagingInfo() || {}).pageSize, pageSize = _a === void 0 ? 0 : _a;
        this.bindingData.setPagingInfo(0, pageSize, this.viewModel.bindingPath);
    };
    KendoGridBindingDirective.prototype.initDataState = function () {
        // const groups: GroupDescriptor[] = [];
        // if (this.groupField) {
        //   groups.push({field: this.groupField, aggregates: this.aggregates||[]});
        //   this.grid.group = groups;
        // }
        // this.state = Object.assign(this.state, {group: groups});
        var e_1, _a;
        var aggregatesDes = [];
        if (this.groupAggrFields) {
            try {
                for (var _b = tslib_1.__values(this.groupAggrFields), _c = _b.next(); !_c.done; _c = _b.next()) {
                    var groupAggrField = _c.value;
                    aggregatesDes.push({ field: groupAggrField, aggregate: 'sum' });
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                }
                finally { if (e_1) throw e_1.error; }
            }
        }
        var group = [];
        if (this.groupField) {
            group.push({ field: this.groupField, aggregates: aggregatesDes });
        }
        this.group = group;
    };
    /*
     * @override
     * @param state State
     */
    KendoGridBindingDirective.prototype.onStateChange = function (state) {
        // 说明：pager根据skip计算当前页码。kendo grid内部会在filter state变化时把skip变为0（重置到第一页）。
        // 因此需要重写onStateChange方法，修正skip
        if (state.skip !== this.currentSkip) {
            state.skip = this.currentSkip;
        }
        // 使用kendo默认的处理state的逻辑
        this.applyState(state);
        this.rebind();
    };
    // protected applyState({skip, take, sort, group, filter}: State): void {
    //   this.skip = skip;
    //   this.pageSize = take;
    //   this.sort = sort;
    //   this.group = group;
    //   this.filter = filter;
    // }
    /*
     * @override 服务器端分页取数。process使用的state中skip应为0，否则不显示数据
     * @param state State
     */
    KendoGridBindingDirective.prototype.process = function (state) {
        // if (this.editing) {
        //   state.sort = null;
        // } else {
        //   state.sort = this.originalSort;
        // }
        state.skip = 0;
        var _a = this.getPagingInfo() || {}, _b = _a.pageSize, pageSize = _b === void 0 ? 0 : _b, _c = _a.total, totalCount = _c === void 0 ? 0 : _c;
        // fix：不启用分页时，take=0导致process不返回数据
        if (state.take === 0) {
            state.take = this.bindingList.length;
        }
        else {
            state.take = pageSize;
        }
        // 编辑模式的判断依据为pageSize小于绑定数据的数量且启用分页
        var isEditMode = state.take < this.bindingList.length;
        if (isEditMode) {
            state.take = this.bindingList.length;
        }
        var processed = _super.prototype.process.call(this, state);
        // fix:数据从无到有时分页不启用
        processed.total = Math.max(totalCount, this.bindingList.length);
        // 分页编辑模式下数据总记录数不能等于真实的数据数据，否则分页工具条就会自动增加分页页签
        if (isEditMode) {
            processed.total = totalCount || 1;
        }
        return processed;
    };
    /*
     * 选中行主键变化处理
     * @param event { SelectionEvent} 选中行变化处理
     */
    KendoGridBindingDirective.prototype.selectedKeysChangeHandler = function (selectedKeys) {
        if (!(this.IsMultipleSelectionMode)) { // 单选模式下
            // 设置BindingData中的当前行
            this.setSelectionIdToBindingData(selectedKeys[selectedKeys.length - 1]);
        }
        this.viewModel.uiState.setPropertyValue('ids', this.selectionDir.selectedKeys); // 更新集合
    };
    /*
     * 处理Grid行切换事件
     * @param event { SelectionEvent} 行切换事件对象
     */
    KendoGridBindingDirective.prototype.selectionChangeHandler = function (event) {
        if (this.IsMultipleSelectionMode) {
            this.handleSelectedCheckboxChange(this.grid.wrapper, event);
        }
    };
    /**
     * 处理checkbox选中事件
     */
    KendoGridBindingDirective.prototype.handleSelectedCheckboxChange = function (elementRef, event) {
        MultiSelectGridUtility.renderSelectedChangeCheckbox(elementRef, event);
        this.selectedCheckboxChange.emit(event);
    };
    /*
     * 单元格点击处理
     * @param event { CellClickEvent } 单元格单击事件对象
     */
    KendoGridBindingDirective.prototype.cellClickHandler = function (event) {
        this.cellClickParam = event;
        this.cellClickEvent = event;
        this.rowIndex = event.rowIndex;
        this.columnIndex = event.columnIndex;
        this.sender = event.sender;
        // 多选模式下，且不分组的情况下，检测行切换
        if (this.IsMultipleSelectionMode && !this.gridOption.groupable) {
            var currentRowIndex = event.rowIndex;
            if (currentRowIndex !== this.lastRowIndex) {
                var rowSelectedContext = new SelectedRowContext();
                rowSelectedContext.currentRowIndex = currentRowIndex;
                rowSelectedContext.lastRowIndex = this.lastRowIndex;
                this.handleSelectedRowChange(rowSelectedContext);
            }
        }
        // 设置实体的当前行
        this.dataId = this.getSelectedIdFromGrid(event.dataItem);
        this.setSelectionIdToBindingData(this.dataId);
        // 若状态机不是可编辑状态 不可编辑
        if (!this.isEditable()) {
            return;
        }
        // 列模板不存在  不可编辑
        if (!event.column.editTemplate) {
            return;
        }
        if (event.type === 'click' && !event.isEdited) {
            // 如果存在显隐状况  确定正确的columnIndex
            var originColums = this.getColumns(this.gridOption.fields);
            var columns = this.getColumns(originColums);
            var currentColumnIndex = columns.findIndex(function (col) { return col.dataField === event.column.field; });
            var hiddenColLen = columns.slice(0, currentColumnIndex + 1).filter(function (col) { return !col.visible; }).length;
            // 赋值全局行索引  列索引
            this.rowIndex = event.rowIndex;
            this.columnIndex = event.columnIndex + hiddenColLen;
            this.hiddenColLen = hiddenColLen;
            this.sender = event.sender;
            this.setEditable(this.rowIndex, this.columnIndex);
        }
    };
    /**
     * 处理选中行切换事件
     */
    KendoGridBindingDirective.prototype.handleSelectedRowChange = function (rowSelectedContext) {
        MultiSelectGridUtility.renderClickChangedRow(this.grid, rowSelectedContext);
        this.rowIndex = rowSelectedContext.currentRowIndex;
        this.lastRowIndex = rowSelectedContext.currentRowIndex;
        // 更新当前行
        var id = this.getPrimary(this.rowIndex);
        this.setSelectionIdToBindingData(id);
    };
    /**
     * 获取指定行的主键
     * @param row 行号
     */
    KendoGridBindingDirective.prototype.getPrimary = function (row) {
        var data = this.grid.data;
        if (data && !Array.isArray(data) && data.hasOwnProperty('data')) {
            data = data.data;
        }
        var _a = this.getPagingInfo() || {}, _b = _a.pageIndex, pageIndex = _b === void 0 ? 1 : _b, _c = _a.pageSize, pageSize = _c === void 0 ? 0 : _c;
        var skip = this.bindingList.skip;
        // 不分页或者第一页时取不需要修改行号
        var rowNumber = pageSize === 0 || pageIndex === 1 ? row : row - skip;
        if (data.length > rowNumber) {
            return data[rowNumber][this.bindingList.primaryKey];
        }
        return null;
    };
    /*
     * 单元格结束编辑处理
     * @param event 单元格结束编辑事件对象
     */
    KendoGridBindingDirective.prototype.cellCloseHandler = function (event) {
        if (this.dialogSer.hasDialogOpened()) {
            event.preventDefault();
            return;
        }
        if (this.rts) {
            // 帮助组件文本变化后去查询
            if (this.rts.getFormState('lookup.pending')) {
                event.preventDefault();
                return;
            }
            // 点击帮助确定可取消按钮后不结束当前单元格编辑
            if (event.originalEvent) {
                if (this.rts.eventPath(event.originalEvent).find(function (n) { return n.tagName === 'FARRIS-DIALOG'; })) {
                    event.preventDefault();
                    return;
                }
            }
        }
        var formGroup = event.formGroup, column = event.column, dataItem = event.dataItem, rowIndex = event.rowIndex;
        var columns = this.getColumns(this.gridOption.fields);
        var currentCol = columns.find(function (element) {
            return element.dataField === column.field;
        });
        var formControlValue = formGroup[currentCol.editor.binding.path].value;
        if (currentCol.getDynamicData) {
            // 若此列是动态单元格列
            currentCol = currentCol.getDynamicData(dataItem, currentCol);
        }
        this.setValue(formControlValue, currentCol);
    };
    /*
       * 回车  切换单元格
       * @param event 键盘按下事件
       */
    KendoGridBindingDirective.prototype.enterCell = function (e) {
        var _this = this;
        // 回车键
        if (!e.shiftKey && e.keyCode === 13) {
            // textarea enter 屏蔽换行操作
            e.preventDefault();
            if (!this.sender) {
                return;
            }
            // 由于keydown 事件会先执行，所以这里先要执行blur 事件；
            e.target.blur();
            this.ngZone.runOutsideAngular(function () {
                setTimeout(function () {
                    if (_this.rts && _this.rts.getFormState('lookup.pending')) {
                        e.preventDefault();
                        return;
                    }
                    _this.enterNextCell();
                }, 201);
            });
        }
    };
    /*
       * 绑定grid option
       * @param dataItem 行数据
       */
    KendoGridBindingDirective.prototype.bindingGridOption = function () {
        if (!this.farrisBindingGridOption) {
            return;
        }
        Object.defineProperty(this.grid, 'gridOption', { value: this.farrisBindingGridOption });
    };
    /*
     * 更新Grid分页状态
     * @param take
     * @param skip
     */
    KendoGridBindingDirective.prototype.updatePager = function (take, skip) {
        if (take === 0) {
            this.currentSkip = 0;
            this.pageSize = 0;
            this.skip = 0;
            this.grid.pageable = false;
        }
        else {
            this.currentSkip = skip;
            this.skip = skip;
            this.pageSize = take;
            this.grid.pageable = {
                buttonCount: 10,
                info: true,
                type: 'numeric',
                pageSizes: false,
                previousNext: true
            };
        }
    };
    /*
     * 设置单元格可编辑性
     * @param dataItem 行数据
     * @param column 列对象
     * @param rowIndex 行索引
     * @param columnIndex 列索引
     * @param sender grid实例
     */
    KendoGridBindingDirective.prototype.setEditable = function (rowNumber, columnNumber) {
        var data = this.grid.data['data'];
        var _a = this.getPagingInfo() || {}, _b = _a.pageIndex, pageIndex = _b === void 0 ? 1 : _b, _c = _a.pageSize, pageSize = _c === void 0 ? 0 : _c;
        var skip = this.bindingList.skip;
        // 不分页或者第一页时取不需要修改行号
        var dataRowNumber = pageSize === 0 || pageIndex === 1 ? rowNumber : rowNumber - skip;
        var item = data[dataRowNumber];
        if (this.gridOption.groupable) {
            item = this.getGroupItem(data, dataRowNumber);
        }
        var originColums = this.getColumns(this.gridOption.fields);
        var columns = this.getColumns(originColums);
        /* 假如列的顺序改变 比如存在固定列  那么应该获取真正的列对象 */
        // let col = columns[columnNumber];
        var tempIndex = columnNumber;
        // 当前列索引不为0
        if (this.grid['gridOption'].showLineNumber) {
            tempIndex = tempIndex - 1;
        }
        if (this.grid.selectable && this.grid.selectable['mode'] === 'multiple') {
            tempIndex = tempIndex - 1;
        }
        var col = columns[tempIndex];
        var params = {
            dataItem: item,
            column: col,
            rowIndex: rowNumber,
            columnIndex: tempIndex,
        };
        // 控制单元格的可编辑性
        if (col && !col.editable) {
            col.editable = function (param) { return true; };
        }
        if (col && this.notReadOnly(col, params)) {
            // 设置当前行
            this.dataId = this.getSelectedIdFromGrid(item);
            this.setSelectionIdToBindingData(this.dataId);
            // const value = this.getValue(item, col.dataField);
            // this.setValue(value, col);
            this.sender.editCell(rowNumber, columnNumber - this.hiddenColLen, this.viewModel.form);
        }
    };
    /*
    获取更新 rowIndex columnIndex
     */
    KendoGridBindingDirective.prototype.updateIndex = function (rowNumber, columnIndex) {
        var newColumnIndex = (columnIndex + 1) % this.len;
        if (!newColumnIndex) {
            var dataLen = this.bindingList.toJSON().length;
            var newRowIndex = (rowNumber + 1) % dataLen;
            return { rowIndex: newRowIndex, columnIndex: newColumnIndex };
        }
        return {
            rowIndex: rowNumber,
            columnIndex: newColumnIndex
        };
    };
    /* 是否只读 */
    KendoGridBindingDirective.prototype.notReadOnly = function (column, param) {
        if (!column) {
            return false;
        }
        return column.editable(param) && !column.editor.readonly;
    };
    /*
       * 给列表赋值 或给formcontrol赋值
        */
    KendoGridBindingDirective.prototype.setValue = function (value, column) {
        var currentColumnType = column.dataType;
        // 同时判断gridOption的列对象
        var bindingData = this.viewModel.bindingData;
        var fieldPaths = this.getFieldPaths(bindingData.bindingPath, column.dataField);
        // 存在行编辑器
        if (currentColumnType === 'date') {
            var dateStr = this.dateService.formatTo(value, 'yyyy-MM-dd HH:mm:ss');
            if (!dateStr) {
                dateStr = '';
            }
            this.viewModel.bindingData.setValue(fieldPaths, dateStr, true, true);
        }
        else {
            this.viewModel.bindingData.setValue(fieldPaths, value, true, true);
        }
    };
    /* 分组时 获取点击行数据 */
    KendoGridBindingDirective.prototype.getGroupItem = function (data, rowNumber) {
        var index = rowNumber;
        for (var i in data) {
            if (index < data[i].items.length) {
                return data[i].items[index];
            }
            else {
                index = index - data[i].items.length;
            }
        }
    };
    /*
     * 获取 单元格值  主从表支持
     * @param dataItem 行数据
     * @param field 字段
     */
    KendoGridBindingDirective.prototype.getValue = function (dataItem, field) {
        var index = field.indexOf('.');
        if (index < 0) {
            return dataItem[field];
        }
        var fields = field.split('.');
        // field字符串组合
        return fields.reduce(function (result, next) {
            return result[next];
        }, dataItem);
    };
    /*
    * 获取 bindingData 路径
    * @param bindingPath 当前绑定的字段路径
    * @param fieldName 字段
    */
    KendoGridBindingDirective.prototype.getFieldPaths = function (bindingPath, field) {
        var fieldPath = '';
        if (bindingPath.length > 1) {
            fieldPath = bindingPath.substr(1).replace(/\//g, '.') + '.' + field;
        }
        else {
            fieldPath = field;
        }
        return fieldPath.split('.');
    };
    /**
     * 回车进入下一个单元格
     */
    KendoGridBindingDirective.prototype.enterNextCell = function () {
        var _this = this;
        var index = this.updateIndex(this.rowIndex, this.columnIndex);
        if (!index.columnIndex && !index.rowIndex) {
            var len_1 = this.bindingList.toJSON().length;
            // 如果存在添加数据的API
            this.appendRow.emit();
            if (this.appendRow.observers && this.appendRow.observers.length) {
                this.interVal = setInterval(function () {
                    if (_this.bindingList.toJSON().length - 1 === len_1) {
                        _this.setEditable(_this.bindingList.toJSON().length - 1, 0);
                        _this.rowIndex = _this.bindingList.toJSON().length - 1;
                        _this.columnIndex = 0;
                        clearInterval(_this.interVal);
                    }
                }, 0);
                return;
            }
        }
        this.setEditable(index.rowIndex, index.columnIndex);
        this.rowIndex = index.rowIndex;
        this.columnIndex = index.columnIndex;
    };
    /* 获取真正的列对象 */
    KendoGridBindingDirective.prototype.getColumns = function (columns) {
        // 判断是否存在固定列
        var hasLocked = columns.some(function (ele) {
            return ele.frozen;
        });
        if (hasLocked) {
            var lockedColumns = columns.filter(function (ele) {
                return ele.frozen;
            });
            var notLockedColumns = columns.filter(function (ele) {
                return !ele.frozen;
            });
            return tslib_1.__spread(lockedColumns, notLockedColumns);
        }
        return columns;
    };
    /*
     * 渲染指定行为选中行：将指定行的key添加到选中行集合中
     */
    KendoGridBindingDirective.prototype.renderSelectionRow = function (key, selectedKeys) {
        if (!key || key === '') {
            return;
        }
        // TODO:使用策略模式重构
        if (this.IsMultipleSelectionMode) {
            var index = selectedKeys.indexOf(key);
            if (index >= 0) {
                return;
            }
            selectedKeys.push(key);
        }
        else {
            if (selectedKeys.length === 1 && selectedKeys[0] === key) {
                return;
            }
            selectedKeys.splice(0, selectedKeys.length);
            selectedKeys.push(key);
        }
        this.selectionDir.selectedKeysChange.emit(selectedKeys); // 手动触发selectedKeysChange事件
    };
    /*
     * 获取Grid上的当前行内码
     * @param dataItem 行数据
     */
    KendoGridBindingDirective.prototype.getSelectedIdFromGrid = function (dataItem) {
        var primaryKey = this.bindingList.primaryKey;
        return dataItem[primaryKey];
    };
    /*
     * 设置BindingList的当前行
     * @param id 当前行内码
     */
    KendoGridBindingDirective.prototype.setSelectionIdToBindingData = function (id) {
        this.bindingList.setCurrentId(id, true);
    };
    /*
    *列表整体是否可编辑
     */
    KendoGridBindingDirective.prototype.isEditable = function () {
        if (this.editable === undefined) {
            if (!this.viewModel.stateMachine) {
                // 状态机不存在的时候
                return false;
            }
            // 状态机存在的时候
            return this.viewModel.stateMachine['editable'];
        }
        // 自定义赋值
        return this.editable;
    };
    /*  */
    KendoGridBindingDirective.prototype.isDataChanged = function () {
        var e_2, _a;
        var hasUnsavedData = false;
        var entityArray = this.viewModel.frameContext.repository.entityCollection.toArray();
        try {
            for (var entityArray_1 = tslib_1.__values(entityArray), entityArray_1_1 = entityArray_1.next(); !entityArray_1_1.done; entityArray_1_1 = entityArray_1.next()) {
                var entity = entityArray_1_1.value;
                if (entity.changes.length > 0) {
                    hasUnsavedData = true;
                    break;
                }
            }
        }
        catch (e_2_1) { e_2 = { error: e_2_1 }; }
        finally {
            try {
                if (entityArray_1_1 && !entityArray_1_1.done && (_a = entityArray_1.return)) _a.call(entityArray_1);
            }
            finally { if (e_2) throw e_2.error; }
        }
        return hasUnsavedData;
    };
    KendoGridBindingDirective.decorators = [
        { type: Directive, args: [{
                    selector: '[farrisBindingPath]'
                },] }
    ];
    /** @nocollapse */
    KendoGridBindingDirective.ctorParameters = function () { return [
        { type: BindingData },
        { type: UIState, decorators: [{ type: Optional }] },
        { type: FrameEventBus, decorators: [{ type: Optional }] },
        { type: ViewModel, decorators: [{ type: Optional }] },
        { type: GridComponent },
        { type: SelectionDirective },
        { type: DialogService },
        { type: DateTimeHelperService },
        { type: FarrisKendoGridFormatService },
        { type: RuntimeStateService },
        { type: NgZone }
    ]; };
    KendoGridBindingDirective.propDecorators = {
        editable: [{ type: Input, args: ['farrisEditable',] }],
        form: [{ type: Input, args: ['farrisForm',] }],
        groupField: [{ type: Input, args: ['groupField',] }],
        groupAggrFields: [{ type: Input, args: ['groupAggrFields',] }],
        farrisBindingGridOption: [{ type: Input }],
        rowClassName: [{ type: Input }],
        appendRow: [{ type: Output, args: ['append-row',] }],
        sortChangeEvent: [{ type: Output }],
        rowClass: [{ type: Output }],
        selectedRowChange: [{ type: Output }],
        selectedCheckboxChange: [{ type: Output }],
        aggrColumns: [{ type: ContentChildren, args: [GridColumnAggregateDirective,] }],
        onPageChange: [{ type: HostListener, args: ['pageChange', ['$event'],] }],
        selectedKeysChangeHandler: [{ type: HostListener, args: ['selectedKeysChange', ['$event'],] }],
        selectionChangeHandler: [{ type: HostListener, args: ['selectionChange', ['$event'],] }],
        cellClickHandler: [{ type: HostListener, args: ['cellClick', ['$event'],] }],
        cellCloseHandler: [{ type: HostListener, args: ['cellClose', ['$event'],] }],
        enterCell: [{ type: HostListener, args: ['keydown', ['$event'],] }]
    };
    return KendoGridBindingDirective;
}(DataBindingDirective));
export { KendoGridBindingDirective };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoia2VuZG9fZ3JpZF9iaW5kaW5nLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMva2VuZG8tYmluZGluZy8iLCJzb3VyY2VzIjpbImxpYi9kaXJlY3RpdmVzL2tlbmRvX2dyaWRfYmluZGluZy5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQStDLEtBQUssRUFBRSxZQUFZLEVBQUUsUUFBUSxFQUNyRixZQUFZLEVBQUUsTUFBTSxFQUFjLGVBQWUsRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUNyRSxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsRUFBRSxFQUFnQixNQUFNLE1BQU0sQ0FBQztBQUN4QyxPQUFPLEVBQ0wsYUFBYSxFQUFFLG9CQUFvQixFQUNuQyxrQkFBa0IsR0FHbkIsTUFBTSw4QkFBOEIsQ0FBQztBQUV0QyxPQUFPLEVBQ0wsV0FBVyxFQUF1QixVQUFVLEVBQzVDLGFBQWEsRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLFNBQVMsRUFDeEMsTUFBTSxnQkFBZ0IsQ0FBQztBQUN4QixPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDbEQsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDeEQsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDL0QsT0FBTyxFQUFFLDRCQUE0QixFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDL0QsT0FBTyxFQUFFLDRCQUE0QixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDeEUsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sbUNBQW1DLENBQUM7QUFDM0UsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFFckQ7Ozs7OztHQU1HO0FBRUg7SUFHK0MscURBQW9CO0lBbUtqRTs7O09BR0c7SUFDSCxtQ0FDUyxXQUF3QixFQUNaLE9BQWdC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Q0F5RU4sTUFBTTt5Q0FLTixNQUFNOzhCQXdDTixlQUFlLFNBQUMsNEJBQTRCOytCQTBZNUMsWUFBWSxTQUFDLFlBQVksRUFBRSxDQUFDLFFBQVEsQ0FBQzs0Q0FvR3JDLFlBQVksU0FBQyxvQkFBb0IsRUFBRSxDQUFDLFFBQVEsQ0FBQzt5Q0FjN0MsWUFBWSxTQUFDLGlCQUFpQixFQUFFLENBQUMsUUFBUSxDQUFDO21DQW1CMUMsWUFBWSxTQUFDLFdBQVcsRUFBRSxDQUFDLFFBQVEsQ0FBQzttQ0F5RnBDLFlBQVksU0FBQyxXQUFXLEVBQUUsQ0FBQyxRQUFRLENBQUM7NEJBMENwQyxZQUFZLFNBQUMsU0FBUyxFQUFFLENBQUMsUUFBUSxDQUFDOztJQThUckMsZ0NBQUM7Q0FBQSxBQW5uQ0QsQ0FHK0Msb0JBQW9CLEdBZ25DbEU7U0FobkNZLHlCQUF5QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgRGlyZWN0aXZlLCBPbkluaXQsIE9uQ2hhbmdlcywgT25EZXN0cm95LCBTaW1wbGVDaGFuZ2VzLCBJbnB1dCwgSG9zdExpc3RlbmVyLCBPcHRpb25hbCxcclxuICBFdmVudEVtaXR0ZXIsIE91dHB1dCwgRWxlbWVudFJlZiwgQ29udGVudENoaWxkcmVuLCBRdWVyeUxpc3QsIE5nWm9uZSwgQWZ0ZXJWaWV3SW5pdFxyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBvZiwgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7XHJcbiAgR3JpZENvbXBvbmVudCwgRGF0YUJpbmRpbmdEaXJlY3RpdmUsXHJcbiAgU2VsZWN0aW9uRGlyZWN0aXZlLFxyXG4gIENlbGxDbGlja0V2ZW50LFxyXG4gIERhdGFTdGF0ZUNoYW5nZUV2ZW50LCBHcmlkRGF0YVJlc3VsdCwgUGFnZUNoYW5nZUV2ZW50LCBTb3J0U2V0dGluZ3MsXHJcbn0gZnJvbSAnQHByb2dyZXNzL2tlbmRvLWFuZ3VsYXItZ3JpZCc7XHJcbmltcG9ydCB7IHByb2Nlc3MsIEdyb3VwRGVzY3JpcHRvciwgQWdncmVnYXRlRGVzY3JpcHRvciwgU3RhdGUsIEZpbHRlckRlc2NyaXB0b3IsIFNvcnREZXNjcmlwdG9yIH0gZnJvbSAnQHByb2dyZXNzL2tlbmRvLWRhdGEtcXVlcnknO1xyXG5pbXBvcnQge1xyXG4gIEJpbmRpbmdEYXRhLCBCaW5kaW5nTGlzdCwgQ2hhbmdlLCBDaGFuZ2VUeXBlLFxyXG4gIEZyYW1lRXZlbnRCdXMsIFVJU3RhdGUsIEZvcm0sIFZpZXdNb2RlbFxyXG59IGZyb20gJ0BmYXJyaXMvZGV2a2l0JztcclxuaW1wb3J0IHsgRGlhbG9nU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktZGlhbG9nJztcclxuaW1wb3J0IHsgUnVudGltZVN0YXRlU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktY29tbW9uJztcclxuaW1wb3J0IHsgRGF0ZVRpbWVIZWxwZXJTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1jb21tb24vZGF0ZSc7XHJcbmltcG9ydCB7IEZhcnJpc0tlbmRvR3JpZEZvcm1hdFNlcnZpY2UgfSBmcm9tICcuLi9mb3JtYXQvaW5kZXgnO1xyXG5pbXBvcnQgeyBHcmlkQ29sdW1uQWdncmVnYXRlRGlyZWN0aXZlIH0gZnJvbSAnLi9ncmlkLXN1bW1hcnkuZGlyZWN0aXZlJztcclxuaW1wb3J0IHsgTXVsdGlTZWxlY3RHcmlkVXRpbGl0eSB9IGZyb20gJy4uL3V0aWwvbXVsdGlfc2VsZWN0X2dyaWRfdXRpbGl0eSc7XHJcbmltcG9ydCB7IFNlbGVjdGVkUm93Q29udGV4dCB9IGZyb20gJy4uL2VudGl0eS9pbmRleCc7XHJcblxyXG4vKlxyXG4gKiBLZW5kbyBHcmlkIOaVsOaNrue7keWumuaMh+S7pFxyXG4gKlxyXG4gKiBUT0RPOlxyXG4gKiAx44CB5pW05L2T5Yi35a2Y5Zyo5oCn6IO96Zeu6aKY77ybXHJcbiAqIDLjgIHpgInkuK3lkozlvZPliY3ooYzmsqHmnInljLrliIblvIDvvJtcclxuICovXHJcblxyXG5ARGlyZWN0aXZlKHtcclxuICBzZWxlY3RvcjogJ1tmYXJyaXNCaW5kaW5nUGF0aF0nXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBLZW5kb0dyaWRCaW5kaW5nRGlyZWN0aXZlIGV4dGVuZHMgRGF0YUJpbmRpbmdEaXJlY3RpdmUgaW1wbGVtZW50cyBPbkluaXQsIEFmdGVyVmlld0luaXQsIE9uQ2hhbmdlcywgT25EZXN0cm95IHtcclxuXHJcbiAgLyoqXHJcbiAgICog5piv5ZCm5YWB6K6457yW6L6RXHJcbiAgICog6buY6K6k5Y+v57yW6L6RICDlm6DkuLrmnInmibnph4/nvJbovpHliJfooahcclxuICAgKi9cclxuICBASW5wdXQoJ2ZhcnJpc0VkaXRhYmxlJylcclxuICBwdWJsaWMgZWRpdGFibGU6IGJvb2xlYW47XHJcblxyXG4gIC8qKlxyXG4gICAqIOe8lui+keaXtue7keWumueahOihqOWNlVxyXG4gICAqL1xyXG4gIEBJbnB1dCgnZmFycmlzRm9ybScpXHJcbiAgcHVibGljIGZvcm06IEZvcm07XHJcblxyXG4gIC8qKlxyXG4gICAqIOWIhue7hOWIl1xyXG4gICAqL1xyXG4gIEBJbnB1dCgnZ3JvdXBGaWVsZCcpXHJcbiAgcHVibGljIGdyb3VwRmllbGQ6IHN0cmluZztcclxuXHJcbiAgQElucHV0KCdncm91cEFnZ3JGaWVsZHMnKVxyXG4gIHB1YmxpYyBncm91cEFnZ3JGaWVsZHM6IHN0cmluZ1tdO1xyXG5cclxuICAvKiDnu5HlrppncmlkIG9wdGlvbiAqL1xyXG4gIEBJbnB1dCgpXHJcbiAgcHVibGljIGZhcnJpc0JpbmRpbmdHcmlkT3B0aW9uOiBhbnk7XHJcblxyXG4gIC8qIOWFvOWuuXJvd0NsYXNzIOi/mOayoeWIoOmZpCAqL1xyXG4gIEBJbnB1dCgpXHJcbiAgcm93Q2xhc3NOYW1lOiBhbnk7XHJcbiAgLyog6KGM5qC35byP5LqL5Lu2ICovXHJcbiAgLy8gQElucHV0KClcclxuICAvLyByb3dDbGFzc05hbWU6IChjb250ZXh0OiBhbnkpID0+IGFueTtcclxuXHJcbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLW91dHB1dC1yZW5hbWVcclxuICBAT3V0cHV0KCdhcHBlbmQtcm93JykgYXBwZW5kUm93ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcblxyXG4gIC8qIOe7keWumuaOkuW6j+S6i+S7tiAqL1xyXG4gIEBPdXRwdXQoKSBzb3J0Q2hhbmdlRXZlbnQ6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcblxyXG4gIC8qIOihjOagt+W8j+S6i+S7tiAqL1xyXG4gIEBPdXRwdXQoKVxyXG4gIHJvd0NsYXNzOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG5cclxuXHJcbiAgZ2V0IGdyaWRPcHRpb24oKSB7XHJcbiAgICByZXR1cm4gdGhpcy5ncmlkWydncmlkT3B0aW9uJ107XHJcbiAgfVxyXG4gIGdldCBsZW4oKSB7XHJcbiAgICByZXR1cm4gdGhpcy5ncmlkLmNvbHVtbnMubGVuZ3RoO1xyXG4gIH1cclxuXHJcbiAgZGF0YUl0ZW06IGFueTtcclxuXHJcbiAgLyoga2V5ZG93bue7keWumuS6i+S7tuWvueixoSAqL1xyXG4gIGdyaWRFbGVtZW50OiBhbnk7XHJcbiAgZ3JpZEtleWRvd25FdmVudDogYW55O1xyXG5cclxuICAvKiBjZWxsY2xpY2vkuovku7blr7nosaEgKi9cclxuICBncmlkQ2VsbENsaWNrRXZlbnQ6IGFueTtcclxuXHJcbiAgLyogY2VsbENsb3Nl5LqL5Lu25a+56LGhICovXHJcbiAgZ3JpZENlbGxDbG9zZUV2ZW50OiBhbnk7XHJcblxyXG5cclxuICBjZWxsQ2xpY2tFdmVudDogQ2VsbENsaWNrRXZlbnQ7XHJcblxyXG4gIGhpZGRlbkNvbExlbiA9IDA7XHJcbiAgLyoqXHJcbiAgICogVE9ETzog5LuO5a6e5L2T6I635Y+W5YW26buY6K6k5YC8XHJcbiAgICog5b2T5YmN6KGM57Si5byV5YC877yM6buY6K6k56ys5LiA5LiqXHJcbiAgICovXHJcbiAgcm93SW5kZXggPSAwO1xyXG4gIGNvbHVtbkluZGV4ID0gMDtcclxuICBzZW5kZXI6IGFueTtcclxuICBpbnRlclZhbDogYW55O1xyXG4gIGRhdGFJZDogYW55O1xyXG4gIGN1cnJlbnRTa2lwID0gMDtcclxuICBwcml2YXRlIGN1cnJlbnRSb3dJZDogc3RyaW5nO1xyXG5cclxuICBjZWxsQ2xpY2tQYXJhbTogQ2VsbENsaWNrRXZlbnQ7XHJcbiAgLyoqXHJcbiAgICog5piv5ZCm5ZCv55So5aSa6YCJ77yM6buY6K6k5pyq5ZCv55SoXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBpc011bHRpcGxlU2VsZWN0aW9uTW9kZSA9IGZhbHNlO1xyXG4gIHB1YmxpYyBnZXQgSXNNdWx0aXBsZVNlbGVjdGlvbk1vZGUoKSB7XHJcbiAgICBpZiAoIXRoaXMuZ3JpZCkge1xyXG4gICAgICByZXR1cm4gdGhpcy5pc011bHRpcGxlU2VsZWN0aW9uTW9kZTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodGhpcy5ncmlkLnNlbGVjdGFibGUpIHsgLy8g5LyY5YWI5bCd6K+V5LuOdGhpcy5ncmlkLnNlbGVjdGFibGXojrflj5ZcclxuICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBuby1zdHJpbmctbGl0ZXJhbFxyXG4gICAgICBpZiAodGhpcy5ncmlkLnNlbGVjdGFibGVbJ21vZGUnXSA9PT0gJ211bHRpcGxlJykge1xyXG4gICAgICAgIHRoaXMuaXNNdWx0aXBsZVNlbGVjdGlvbk1vZGUgPSB0cnVlO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMuaXNNdWx0aXBsZVNlbGVjdGlvbk1vZGUgPSBmYWxzZTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgaWYgKHRoaXMuZ3JpZC5zZWxlY3RhYmxlU2V0dGluZ3MgJiYgdGhpcy5ncmlkLnNlbGVjdGFibGVTZXR0aW5ncy5tb2RlID09PSAnbXVsdGlwbGUnKSB7XHJcbiAgICAgICAgdGhpcy5pc011bHRpcGxlU2VsZWN0aW9uTW9kZSA9IHRydWU7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdGhpcy5pc011bHRpcGxlU2VsZWN0aW9uTW9kZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOS4iuS4gOS4qumAieS4reihjO+8jOm7mOiupOS4jeWtmOWcqFxyXG4gICAqL1xyXG4gIHB1YmxpYyBsYXN0Um93SW5kZXggPSAtMTtcclxuXHJcbiAgLyoqXHJcbiAgICog6YCJ5Lit6KGM5YiH5o2i5LqL5Lu2XHJcbiAgICovXHJcbiAgQE91dHB1dCgpIHNlbGVjdGVkUm93Q2hhbmdlOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG5cclxuICAvKipcclxuICAgKiBjaGVja2JveOmAieaLqeS6i+S7tlxyXG4gICAqL1xyXG4gIEBPdXRwdXQoKSBzZWxlY3RlZENoZWNrYm94Q2hhbmdlOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG5cclxuICAvKipcclxuICAgKiDnu5HlrprliJfooagoR3JpZOWvueW6lOaVsOaNrua6kClcclxuICAgKi9cclxuICBwcml2YXRlIGdldCBiaW5kaW5nTGlzdCgpOiBCaW5kaW5nTGlzdCB7XHJcbiAgICAvLyDmoLnlrp7kvZNcclxuICAgIGlmICh0aGlzLnZpZXdNb2RlbC5iaW5kaW5nUGF0aCA9PT0gJy8nIHx8ICF0aGlzLnZpZXdNb2RlbC5iaW5kaW5nUGF0aCkge1xyXG4gICAgICByZXR1cm4gdGhpcy5iaW5kaW5nRGF0YS5saXN0O1xyXG4gICAgfVxyXG4gICAgLy8g5a2Q5a6e5L2TXHJcbiAgICBsZXQgYmluZGluZ1BhdGggPSB0aGlzLnZpZXdNb2RlbC5iaW5kaW5nUGF0aC5zdWJzdHIoMSk7XHJcbiAgICBiaW5kaW5nUGF0aCA9IGJpbmRpbmdQYXRoWzBdLnRvTG93ZXJDYXNlKCkgKyBiaW5kaW5nUGF0aC5zdWJzdHJpbmcoMSwgYmluZGluZ1BhdGgubGVuZ3RoKTtcclxuICAgIGNvbnN0IHBhdGhzID0gYmluZGluZ1BhdGguc3BsaXQoJy8nKTtcclxuXHJcbiAgICBjb25zdCBmaWx0ZXJlZFBhdGhzID0gcGF0aHMuZmlsdGVyKChwYXJ0OiBzdHJpbmcpID0+IHtcclxuICAgICAgcmV0dXJuIHBhcnQgIT09ICcnO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gdGhpcy5iaW5kaW5nRGF0YS5nZXRWYWx1ZShmaWx0ZXJlZFBhdGhzKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6I635Y+W5YiG6aG15L+h5oGvXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXRQYWdpbmdJbmZvKCkge1xyXG4gICAgY29uc3QgYmluZGluZ1BhdGggPSB0aGlzLnZpZXdNb2RlbC5iaW5kaW5nUGF0aDtcclxuICAgIGNvbnN0IGJpbmRpbmdEYXRhID0gdGhpcy52aWV3TW9kZWwuYmluZGluZ0RhdGE7XHJcbiAgICBsZXQgcGFnaW5nSW5mbyA9IGJpbmRpbmdEYXRhLnBhZ2luZ0luZm87XHJcbiAgICBpZiAoYmluZGluZ1BhdGggPT09ICcvJykge1xyXG4gICAgICByZXR1cm4gcGFnaW5nSW5mbztcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnN0IGJpbmRpbmdQYXRocyA9IGJpbmRpbmdQYXRoLnN1YnN0cigxKS5zcGxpdCgnLycpLmZpbHRlcihpdGVtID0+ICEhaXRlbSAmJiBpdGVtLmxlbmd0aCA+IDApLm1hcChpdGVtID0+IHtcclxuICAgICAgICByZXR1cm4gaXRlbS5zdWJzdHJpbmcoMCwgaXRlbS5sZW5ndGggLSAxKTtcclxuICAgICAgfSk7XHJcbiAgICAgIGJpbmRpbmdQYXRocy5mb3JFYWNoKHBhdGggPT4ge1xyXG4gICAgICAgIHBhZ2luZ0luZm8gPSBwYWdpbmdJbmZvICYmIHBhZ2luZ0luZm9bcGF0aF0gfHwge307XHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm4gcGFnaW5nSW5mbztcclxuICAgIH1cclxuICB9XHJcblxyXG4gIEBDb250ZW50Q2hpbGRyZW4oR3JpZENvbHVtbkFnZ3JlZ2F0ZURpcmVjdGl2ZSkgcHJpdmF0ZSBhZ2dyQ29sdW1uczogUXVlcnlMaXN0PEdyaWRDb2x1bW5BZ2dyZWdhdGVEaXJlY3RpdmU+O1xyXG4gIHByaXZhdGUgYmluZGluZ0NoYW5nZVN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xyXG5cclxuICAvKipcclxuICAgKiDmnoTpgKDlh73mlbBcclxuICAgKiBAcGFyYW0gIGdyaWQg5a6/5Li7R3JpZFxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHVibGljIGJpbmRpbmdEYXRhOiBCaW5kaW5nRGF0YSxcclxuICAgIEBPcHRpb25hbCgpIHB1YmxpYyB1aVN0YXRlOiBVSVN0YXRlLFxyXG4gICAgQE9wdGlvbmFsKCkgcHVibGljIGV2ZW50QnVzOiBGcmFtZUV2ZW50QnVzLFxyXG4gICAgQE9wdGlvbmFsKCkgcHVibGljIHZpZXdNb2RlbDogVmlld01vZGVsLFxyXG4gICAgcHVibGljIGdyaWQ6IEdyaWRDb21wb25lbnQsXHJcbiAgICBwdWJsaWMgc2VsZWN0aW9uRGlyOiBTZWxlY3Rpb25EaXJlY3RpdmUsXHJcbiAgICBwdWJsaWMgZGlhbG9nU2VyOiBEaWFsb2dTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBkYXRlU2VydmljZTogRGF0ZVRpbWVIZWxwZXJTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBrZW5kb2dyaWRGb3JtYXRTZXI6IEZhcnJpc0tlbmRvR3JpZEZvcm1hdFNlcnZpY2UsXHJcbiAgICBwcml2YXRlIHJ0czogUnVudGltZVN0YXRlU2VydmljZSxcclxuICAgIHB1YmxpYyBuZ1pvbmU6IE5nWm9uZVxyXG4gICkge1xyXG4gICAgc3VwZXIoZ3JpZCk7XHJcblxyXG4gICAgdGhpcy5zZWxlY3Rpb25EaXIuc2VsZWN0ZWRLZXlzID0gW107XHJcbiAgICB0aGlzLnZpZXdNb2RlbC51aVN0YXRlLnNldFByb3BlcnR5VmFsdWUoJ2lkcycsIHRoaXMuc2VsZWN0aW9uRGlyLnNlbGVjdGVkS2V5cyk7XHJcbiAgICBjb25zdCBhcHBDb250ZXh0ID0gdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LmdldEZvcm1BcHBDb250ZXh0KCk7XHJcbiAgICBpZiAoYXBwQ29udGV4dCAmJiBhcHBDb250ZXh0Lmhhc093blByb3BlcnR5KCdtZXNzYWdlUGlwZScpKSB7XHJcbiAgICAgIGFwcENvbnRleHQubWVzc2FnZVBpcGUuc3Vic2NyaWJlKChtZXNzYWdlOiBhbnkpID0+IHtcclxuICAgICAgICB0aGlzLmdyaWQuY2xvc2VDZWxsKCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5oyH5Luk5Yid5aeL5YyW5ZCOXHJcbiAgICovXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICBzdXBlci5uZ09uSW5pdCgpO1xyXG5cclxuICAgIC8vIOWIneWni+WMlnN0YXRl77yM5YiG57uE5L2/55So44CCXHJcbiAgICB0aGlzLmluaXREYXRhU3RhdGUoKTtcclxuXHJcbiAgICB0aGlzLnJlZnJlc2hWaWV3KCk7XHJcblxyXG4gICAgLy8g5pWw5o2u5Y+Y5YyWXHJcbiAgICB0aGlzLmJpbmRpbmdDaGFuZ2VTdWJzY3JpcHRpb24gPSB0aGlzLmJpbmRpbmdEYXRhLmNoYW5nZXMuc3Vic2NyaWJlKChjaGFuZ2U6IENoYW5nZSkgPT4ge1xyXG4gICAgICB0aGlzLnJlZnJlc2hWaWV3KGNoYW5nZSk7XHJcblxyXG4gICAgICBpZiAoY2hhbmdlLnR5cGUgPT09IENoYW5nZVR5cGUuTG9hZCkge1xyXG4gICAgICAgIC8vIGxvYWTml7bvvIzlnKjlpJrpgInmqKHlvI/kuIvvvIzpnIDmuIXnqbrpgInkuK3pm4blkIhcclxuICAgICAgICBpZiAodGhpcy5pc011bHRpcGxlU2VsZWN0aW9uTW9kZSkge1xyXG4gICAgICAgICAgY29uc3QgaXNNYXRjaCA9IHRoaXMuY2hlY2tJZkNoYW5nZU1hdGNoQmluZGluZ1BhdGgoY2hhbmdlKTtcclxuICAgICAgICAgIGlmIChpc01hdGNoKSB7XHJcbiAgICAgICAgICAgIC8vIOa4heepuuWkmumAiembhuWQiFxyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGlvbkRpci5zZWxlY3RlZEtleXMgPSBbXTtcclxuICAgICAgICAgICAgdGhpcy52aWV3TW9kZWwudWlTdGF0ZS5zZXRQcm9wZXJ0eVZhbHVlKCdpZHMnLCB0aGlzLnNlbGVjdGlvbkRpci5zZWxlY3RlZEtleXMpO1xyXG4gICAgICAgICAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XHJcbiAgICAgICAgICAgICAgLy8g5riy5p+T5Yid5aeL6YCJ5Lit6KGMXHJcbiAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCByb3dTZWxlY3RlZENvbnRleHQ6IFNlbGVjdGVkUm93Q29udGV4dCA9IG5ldyBTZWxlY3RlZFJvd0NvbnRleHQoKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGlzUGFnZWFibGUgPSBNdWx0aVNlbGVjdEdyaWRVdGlsaXR5LmNoZWNrSWZFbmFibGVQYWdpbmcodGhpcy5ncmlkKTtcclxuICAgICAgICAgICAgICAgIGlmIChpc1BhZ2VhYmxlKSB7XHJcbiAgICAgICAgICAgICAgICAgIHRoaXMucm93SW5kZXggPSB0aGlzLmdyaWQuc2tpcDtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgIHRoaXMucm93SW5kZXggPSAwO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcm93U2VsZWN0ZWRDb250ZXh0LmN1cnJlbnRSb3dJbmRleCA9IHRoaXMucm93SW5kZXg7XHJcbiAgICAgICAgICAgICAgICByb3dTZWxlY3RlZENvbnRleHQubGFzdFJvd0luZGV4ID0gdGhpcy5sYXN0Um93SW5kZXg7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZVNlbGVjdGVkUm93Q2hhbmdlKHJvd1NlbGVjdGVkQ29udGV4dCk7XHJcbiAgICAgICAgICAgICAgfSwgMzAwKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBUT0RPOiDkvb/nlKjnrZbnlaXmqKHlvI/ph43mnoRcclxuICAgICAgLy8gYmluZGluZ0RhdGEg5ZCM5q2lIFNlbGVjdGVkS2V5c1xyXG4gICAgICBpZiAoY2hhbmdlLnR5cGUgPT09IENoYW5nZVR5cGUuUmVtb3ZlKSB7XHJcbiAgICAgICAgdGhpcy5zeW5jRGVsZXRlZEtleXMoY2hhbmdlLnZhbHVlKTtcclxuICAgICAgfVxyXG4gICAgICBjb25zdCBpc01hdGNoID0gdGhpcy5jaGVja0lmQ2hhbmdlTWF0Y2hCaW5kaW5nUGF0aChjaGFuZ2UpO1xyXG4gICAgICBpZiAoaXNNYXRjaCkge1xyXG4gICAgICAgIHRoaXMuaGFuZGxlU2VsZWN0ZWRLZXlDaGFuZ2UodGhpcy5iaW5kaW5nTGlzdC5jdXJyZW50SWQpO1xyXG4gICAgICB9XHJcbiAgICAgIC8vIOa4suafk+W9k+WJjeihjFxyXG4gICAgICBpZiAoaXNNYXRjaCAmJiB0aGlzLmNoZWNrQ3VycmVudFJvd0lkRXhpc3RzKCkgJiYgY2hhbmdlLnR5cGUgPT09IENoYW5nZVR5cGUuU2VsZWN0aW9uQ2hhbmdlZCAmJiAhdGhpcy5kYXRhSWQpIHtcclxuICAgICAgICB0aGlzLnJlbmRlckN1cnJlbnRSb3codGhpcy5iaW5kaW5nTGlzdC5jdXJyZW50SWQpO1xyXG4gICAgICB9XHJcbiAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogbWF4LWxpbmUtbGVuZ3RoXHJcbiAgICAgIC8vIEZJWE1FOumcgOimgeaciemHjee9rumhteeggeeahOaXtuaculxyXG4gICAgICAvKmlmICgoY2hhbmdlLnR5cGUgPT09IENoYW5nZVR5cGUuU2VsZWN0aW9uQ2hhbmdlZCB8fCBjaGFuZ2UudHlwZSA9PT0gQ2hhbmdlVHlwZS5HbG9iYWxTZWxlY3Rpb25DaGFuZ2VkKSAmJiB0aGlzLmN1cnJlbnRSb3dJZCAhPT0gdGhpcy5iaW5kaW5nTGlzdC5jdXJyZW50SWQpIHtcclxuICAgICAgICAgIHRoaXMucmVzZXRQYWdlSW5mbygpO1xyXG4gICAgICB9Ki9cclxuICAgICAgLy8g6Kem5Y+R5Y+Y5pu05qOA5rWLXHJcbiAgICAgIGlmIChjaGFuZ2UudHlwZSA9PT0gQ2hhbmdlVHlwZS5Mb2FkIHx8IGNoYW5nZS50eXBlID09PSBDaGFuZ2VUeXBlLlNlbGVjdGlvbkNoYW5nZWRcclxuICAgICAgICB8fCBjaGFuZ2UudHlwZSA9PT0gQ2hhbmdlVHlwZS5BcHBlbmQgfHwgY2hhbmdlLnR5cGUgPT09IENoYW5nZVR5cGUuUmVtb3ZlKSB7XHJcblxyXG4gICAgICAgIC8vIOinpuWPkeWPmOabtOajgOa1i1xyXG4gICAgICAgIGlmICh0aGlzLmdyaWQgJiYgdGhpcy5ncmlkWydjaGFuZ2VEZXRlY3RvclJlZiddICYmIHRoaXMuZ3JpZFsnY2hhbmdlRGV0ZWN0b3JSZWYnXVsnZGV0ZWN0Q2hhbmdlcyddKSB7XHJcbiAgICAgICAgICB0aGlzLmdyaWRbJ2NoYW5nZURldGVjdG9yUmVmJ11bJ2RldGVjdENoYW5nZXMnXSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgIH0pO1xyXG5cclxuICAgIGlmICh0aGlzLmVkaXRhYmxlID09PSB0cnVlICYmIHRoaXMuZm9ybSA9PT0gbnVsbCkge1xyXG4gICAgICB0aHJvdyBFcnJvcign5ZCv55So57yW6L6R5pe277yM5b+F6aG75oyH5a6aZm9ybScpO1xyXG4gICAgfVxyXG4gICAgaWYgKCF0aGlzLmdyaWQgfHwgIXRoaXMuZmFycmlzQmluZGluZ0dyaWRPcHRpb24gfHwgIXRoaXMuZmFycmlzQmluZGluZ0dyaWRPcHRpb25bJ2ZpZWxkcyddKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBncmlkQ29sdW1ucyA9IHRoaXMuZmFycmlzQmluZGluZ0dyaWRPcHRpb25bJ2ZpZWxkcyddO1xyXG4gICAgY29uc3QgZ3JpZE9wdGlvbiA9IHRoaXMuZmFycmlzQmluZGluZ0dyaWRPcHRpb247XHJcblxyXG4gICAgLy8g5Yik5pat5YiX5Lit5piv5ZCm5a2Y5Zyo5Zu65a6a5YiXXHJcbiAgICBncmlkT3B0aW9uLmxvY2thYmxlID0gKGNvbHVtbnM6IGFueVtdKSA9PiB7XHJcbiAgICAgIHJldHVybiBjb2x1bW5zLnNvbWUoZWxlID0+IHtcclxuICAgICAgICByZXR1cm4gZWxlLmZyb3plbjtcclxuICAgICAgfSk7XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMucm93Q2xhc3MuZW1pdCh0aGlzLmdyaWQpO1xyXG4gICAgLy8g5re75Yqg5YiX5bGe5oCn5oiW6ICF5pa55rOVXHJcbiAgICBncmlkQ29sdW1ucy5mb3JFYWNoKChlbGVtZW50OiBhbnkpID0+IHtcclxuICAgICAgLy8g6Ieq5a6a5LmJ6LaF6ZO+XHJcbiAgICAgIGlmIChlbGVtZW50LmxpbmtlZExhYmVsRW5hYmxlZCAmJiAhZWxlbWVudC5saW5rRXZlbnQpIHtcclxuICAgICAgICBlbGVtZW50LmxpbmtFdmVudCA9ICgpID0+IHtcclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9O1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyDoi6XmsqHmnInoh6rlrprkuYnmoLzlvI/ljJbmlrnms5UgIOavj+S4quWIl+Wvueixoee7keWumuagvOW8j+WMluaWueazlVxyXG4gICAgICBpZiAoIWVsZW1lbnQuZ2V0Q29sdW1uRm9ybWF0KSB7XHJcbiAgICAgICAgZWxlbWVudC5nZXRDb2x1bW5Gb3JtYXQgPSAoZGF0YUl0ZW06IGFueSwgY29sdW1uOiBhbnkpID0+IHtcclxuICAgICAgICAgIHJldHVybiB0aGlzLmtlbmRvZ3JpZEZvcm1hdFNlci5nZXRDb2x1bW5Gb3JtYXQoZGF0YUl0ZW0sIGNvbHVtbik7XHJcbiAgICAgICAgfTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8g5aaC5p6c5rKh5pyJ6Ieq5a6a5LmJ57G75qC35byPIOavj+S4quWIl+e7keWumiDmoLzlvI/ljJbmlrnms5VcclxuICAgICAgaWYgKCFlbGVtZW50LmdldENsYXNzTmFtZSkge1xyXG4gICAgICAgIGVsZW1lbnQuZ2V0Q2xhc3NOYW1lID0gKGRhdGFJdGVtOiBhbnksIGNvbHVtbjogYW55KSA9PiAnJztcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8g6Ieq5a6a5LmJ5biu5Yqp5YmN5ZCO5LqL5Lu2XHJcbiAgICAgIGlmIChlbGVtZW50LmVkaXRvciAmJiBlbGVtZW50LmVkaXRvci50eXBlID09PSAnTG9va3VwRWRpdCcpIHtcclxuXHJcbiAgICAgICAgLy8g5biu5Yqp5YmN5LqL5Lu2XHJcbiAgICAgICAgaWYgKCFlbGVtZW50LmRpY3RQaWNraW5nKSB7XHJcbiAgICAgICAgICBlbGVtZW50LmRpY3RQaWNraW5nID0gKHBhcmFtOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gICAgICAgICAgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8g5biu5Yqp5ZCO5LqL5Lu2XHJcbiAgICAgICAgaWYgKCFlbGVtZW50LmRpY3RQaWNrZWQpIHtcclxuICAgICAgICAgIGVsZW1lbnQuZGljdFBpY2tlZCA9IChwYXJhbTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIC8vIOmHjeaWsOi/m+WFpee8lui+kVxyXG4gICAgICAgICAgICB0aGlzLmNlbGxDbGlja0hhbmRsZXIodGhpcy5jZWxsQ2xpY2tQYXJhbSk7XHJcbiAgICAgICAgICAgIHJldHVybiBvZih0cnVlKTtcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIC8vIOe7keWummdyaWRPcHRpb25cclxuICAgIHRoaXMuYmluZGluZ0dyaWRPcHRpb24oKTtcclxuXHJcbiAgICAvLyDlpJrpgInmqKHlvI/kuIvvvIzorr7nva7liJ3lp4vpgInkuK3ooYxcclxuICAgIGlmICh0aGlzLklzTXVsdGlwbGVTZWxlY3Rpb25Nb2RlKSB7XHJcbiAgICAgIC8vIFRPRE86IOenu+mZpCBzZXRUaW1lb3V0XHJcbiAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG4gICAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICBjb25zdCByb3dTZWxlY3RlZENvbnRleHQ6IFNlbGVjdGVkUm93Q29udGV4dCA9IG5ldyBTZWxlY3RlZFJvd0NvbnRleHQoKTtcclxuICAgICAgICAgIHJvd1NlbGVjdGVkQ29udGV4dC5jdXJyZW50Um93SW5kZXggPSBzZWxmLnJvd0luZGV4O1xyXG4gICAgICAgICAgcm93U2VsZWN0ZWRDb250ZXh0Lmxhc3RSb3dJbmRleCA9IHNlbGYubGFzdFJvd0luZGV4O1xyXG4gICAgICAgICAgc2VsZi5oYW5kbGVTZWxlY3RlZFJvd0NoYW5nZShyb3dTZWxlY3RlZENvbnRleHQpO1xyXG4gICAgICAgIH0sIDMwMCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcblxyXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcclxuICAgIC8vIHRoaXMuZ3JpZEVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuay1ncmlkJyk7XHJcbiAgICAvLyAvLyDnu5HlrppncmlkIGtleWRvd27lr7nosaHnmoTmlrnms5VcclxuICAgIC8vIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcclxuICAgIC8vICAgdGhpcy5ncmlkS2V5ZG93bkV2ZW50ID0gdGhpcy5lbnRlckNlbGwuYmluZCh0aGlzKTtcclxuICAgIC8vICAgdGhpcy5ncmlkQ2VsbENsaWNrRXZlbnQgPSB0aGlzLmNlbGxDbGlja0hhbmRsZXIuYmluZCh0aGlzKTtcclxuICAgIC8vICAgdGhpcy5ncmlkQ2VsbENsb3NlRXZlbnQgPSB0aGlzLmNlbGxDbG9zZUhhbmRsZXIuYmluZCh0aGlzKTtcclxuICAgIC8vICAgdGhpcy5ncmlkRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgdGhpcy5ncmlkS2V5ZG93bkV2ZW50KTtcclxuICAgIC8vICAgdGhpcy5ncmlkRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdjZWxsQ2xpY2snLCB0aGlzLmdyaWRDZWxsQ2xpY2tFdmVudCk7XHJcbiAgICAvLyAgIHRoaXMuZ3JpZEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2VsbENsb3NlJywgdGhpcy5ncmlkQ2VsbENsb3NlRXZlbnQpO1xyXG4gICAgLy8gfSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOajgOa1i2NoYW5nZeeahOi3r+W+hOWSjEJpbmRpbmdQYXRo5piv5ZCm5Yy56YWNXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBjaGVja0lmQ2hhbmdlTWF0Y2hCaW5kaW5nUGF0aChjaGFuZ2U6IENoYW5nZSk6IGJvb2xlYW4ge1xyXG4gICAgbGV0IGlzTWF0Y2ggPSBmYWxzZTtcclxuICAgIGlmICghY2hhbmdlIHx8ICFjaGFuZ2UucGF0aCkge1xyXG4gICAgICByZXR1cm4gaXNNYXRjaDtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBjaGFuZ2VQYXRoQXJyYXkgPSBjaGFuZ2UucGF0aDtcclxuICAgIGlmICghY2hhbmdlUGF0aEFycmF5KSB7XHJcbiAgICAgIHJldHVybiBpc01hdGNoO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICghKHRoaXMuYmluZGluZ0RhdGEpICYmICEodGhpcy5iaW5kaW5nRGF0YS5iaW5kaW5nUGF0aCkpIHtcclxuICAgICAgcmV0dXJuIGlzTWF0Y2g7XHJcbiAgICB9XHJcbiAgICBjb25zdCBiaW5nZGluZ1BhdGhBcnJheSA9IHRoaXMuYmluZGluZ0RhdGEuYmluZGluZ1BhdGguc3BsaXQoJy8nKTtcclxuICAgIGlmIChiaW5nZGluZ1BhdGhBcnJheS5sZW5ndGggPD0gMCkge1xyXG4gICAgICByZXR1cm4gaXNNYXRjaDtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoY2hhbmdlUGF0aEFycmF5Lmxlbmd0aCA9PT0gMCkgeyAvLyDkuLvooahcclxuICAgICAgaWYgKHRoaXMuYmluZGluZ0RhdGEuYmluZGluZ1BhdGggPT09ICcvJykge1xyXG4gICAgICAgIGlzTWF0Y2ggPSB0cnVlO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2UgaWYgKGNoYW5nZS5wYXRoLmxlbmd0aCA9PT0gMSkgey8vIOS4u+S7juihqFxyXG4gICAgICBpZiAoYmluZ2RpbmdQYXRoQXJyYXkubGVuZ3RoID09PSAyICYmIGJpbmdkaW5nUGF0aEFycmF5WzFdID09PSBjaGFuZ2UucGF0aFswXSkge1xyXG4gICAgICAgIGlzTWF0Y2ggPSB0cnVlO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2UgaWYgKGNoYW5nZS5wYXRoLmxlbmd0aCA9PT0gMikgeyAvLyDkuLvku47ku47ooahcclxuICAgICAgaWYgKGJpbmdkaW5nUGF0aEFycmF5Lmxlbmd0aCA9PT0gMyAmJiBiaW5nZGluZ1BhdGhBcnJheVsxXSA9PT0gY2hhbmdlLnBhdGhbMF0gJiYgYmluZ2RpbmdQYXRoQXJyYXlbMl0gPT09IGNoYW5nZS5wYXRoWzFdKSB7XHJcbiAgICAgICAgaXNNYXRjaCA9IHRydWU7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gaXNNYXRjaDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWkhOeQhumAieS4reS4u+mUruWPmOabtFxyXG4gICAqL1xyXG4gIHByaXZhdGUgaGFuZGxlU2VsZWN0ZWRLZXlDaGFuZ2UoY3VycmVudElkOiBhbnkpIHtcclxuICAgIGNvbnN0IHNlbGVjdGVkS2V5cyA9IHRoaXMuc2VsZWN0aW9uRGlyLnNlbGVjdGVkS2V5cztcclxuICAgIGlmICghY3VycmVudElkKSB7XHJcblxyXG4gICAgICAvLyDlpoLmnpzlvZPliY3ooYzml7ZudWxs77yM5L2Gc2VsZWN0ZWRLZXlz6YeM5pyJ5YC877yM5riF56m65bm25Y+R6YCB5LiA5qyh6KGM5YiH5o2iXHJcbiAgICAgIGlmIChzZWxlY3RlZEtleXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIGNvbnN0IHJlbW92ZWRTZWxlY3RlZEtleXMgPSBzZWxlY3RlZEtleXMuc3BsaWNlKDAsIHNlbGVjdGVkS2V5cy5sZW5ndGgpO1xyXG4gICAgICAgIGlmIChyZW1vdmVkU2VsZWN0ZWRLZXlzLmluZGV4T2YobnVsbCkgPT09IC0xKSB7XHJcbiAgICAgICAgICB0aGlzLmVtaXRTZWxlY3RlZFJvd0NoYW5nZSh7IGN1cnJlbnRSb3dJZDogbnVsbCB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgbGV0IG9sZEN1cnJlbnRSb3dJZCA9IG51bGw7XHJcbiAgICBpZiAodGhpcy5Jc011bHRpcGxlU2VsZWN0aW9uTW9kZSkge1xyXG4gICAgICBvbGRDdXJyZW50Um93SWQgPSB0aGlzLmN1cnJlbnRSb3dJZDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIG9sZEN1cnJlbnRSb3dJZCA9IHRoaXMuc2VsZWN0aW9uRGlyLnNlbGVjdGVkS2V5cy5sZW5ndGggPT09IDBcclxuICAgICAgICA/IG51bGwgOiB0aGlzLnNlbGVjdGlvbkRpci5zZWxlY3RlZEtleXNbMF07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVE9ETzppZiAodGhpcy5jdXJyZW50Um93SWQgIT09IGN1cnJlbnRJZCkge1xyXG4gICAgaWYgKG9sZEN1cnJlbnRSb3dJZCAhPT0gY3VycmVudElkKSB7XHJcbiAgICAgIGNvbnN0IHNlbGVjdGVkUm93Q29udGV4dDogYW55ID0ge307XHJcbiAgICAgIHNlbGVjdGVkUm93Q29udGV4dC5jdXJyZW50Um93SWQgPSBjdXJyZW50SWQ7XHJcbiAgICAgIHRoaXMuY3VycmVudFJvd0lkID0gY3VycmVudElkO1xyXG4gICAgICB0aGlzLmVtaXRTZWxlY3RlZFJvd0NoYW5nZShzZWxlY3RlZFJvd0NvbnRleHQpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Y+R5bCE6YCJ5Lit6KGM5YiH5o2i5LqL5Lu2XHJcbiAgICogQGRlc2NyaXB0aW9uIOe7n+S4gOWNlemAieaooeW8j+WSjOWkmumAieaooeW8j+S4i+eahOihjOWIh+aNouS6i+S7tlxyXG4gICAqL1xyXG4gIHByaXZhdGUgZW1pdFNlbGVjdGVkUm93Q2hhbmdlKHNlbGVjdGVkUm93Q29udGV4dDogYW55KSB7XHJcbiAgICBpZiAoIXRoaXMuSXNNdWx0aXBsZVNlbGVjdGlvbk1vZGUpIHsgLy8g5ZCR5ZCO5YW85a65XHJcbiAgICAgIGNvbnN0IGN1cnJlbnRJZCA9IHNlbGVjdGVkUm93Q29udGV4dC5jdXJyZW50Um93SWQ7XHJcbiAgICAgIHRoaXMuc2VsZWN0aW9uRGlyLnNlbGVjdGVkS2V5cyA9IFtjdXJyZW50SWRdO1xyXG4gICAgICB0aGlzLnNlbGVjdGlvbkRpci5zZWxlY3RlZEtleXNDaGFuZ2UuZW1pdCh0aGlzLnNlbGVjdGlvbkRpci5zZWxlY3RlZEtleXMpO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuc2VsZWN0ZWRSb3dDaGFuZ2UuZW1pdChzZWxlY3RlZFJvd0NvbnRleHQpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBjaGVja0N1cnJlbnRSb3dJZEV4aXN0cygpOiBib29sZWFuIHtcclxuICAgIGxldCBpc0V4aXN0ID0gZmFsc2U7XHJcblxyXG4gICAgaWYgKHRoaXMuYmluZGluZ0xpc3QgJiYgdGhpcy5iaW5kaW5nTGlzdC5jdXJyZW50SWQgJiYgdGhpcy5iaW5kaW5nTGlzdC5jdXJyZW50SWQubGVuZ3RoID4gMCkge1xyXG4gICAgICBpc0V4aXN0ID0gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gaXNFeGlzdDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWQjOatpeW3suWIoOmZpOmUruWIsOmAieS4rembhuWQiFxyXG4gICAqL1xyXG4gIHByaXZhdGUgc3luY0RlbGV0ZWRLZXlzKGRlbGV0ZWRWYWx1ZUNvbGxlY3Rpb246IGFueVtdKSB7XHJcbiAgICBpZiAoIWRlbGV0ZWRWYWx1ZUNvbGxlY3Rpb24pIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGRlbGV0ZWRWYWx1ZUNvbGxlY3Rpb24uZm9yRWFjaCgoaWQ6IHN0cmluZykgPT4ge1xyXG4gICAgICBjb25zdCBpbmRleCA9IHRoaXMuc2VsZWN0aW9uRGlyLnNlbGVjdGVkS2V5cy5pbmRleE9mKGlkKTtcclxuICAgICAgaWYgKGluZGV4ID4gLTEpIHtcclxuICAgICAgICB0aGlzLnNlbGVjdGlvbkRpci5zZWxlY3RlZEtleXMuc3BsaWNlKGluZGV4LCAxKTtcclxuXHJcbiAgICAgICAgLy8gc2VsZWN0ZWRLZXlz6KKr5riF56m655qE5pe25YCZ77yM6Kem5Y+R5LiA5qyh6KGM5Y+Y5pu0XHJcbiAgICAgICAgaWYgKHRoaXMuc2VsZWN0aW9uRGlyLnNlbGVjdGVkS2V5cy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgIHRoaXMuZW1pdFNlbGVjdGVkUm93Q2hhbmdlKHsgY3VycmVudFJvd0lkOiBudWxsIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHJlbmRlckN1cnJlbnRSb3coY3VycmVudElkOiBzdHJpbmcpIHtcclxuICAgIGlmICghY3VycmVudElkIHx8IGN1cnJlbnRJZCA9PT0gJycpIHsvLyDkuI3lrZjlnKjlvZPliY3ooYxcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFRPRE865L2/55So562W55Wl5qih5byP6YeN5p6EXHJcbiAgICBpZiAodGhpcy5Jc011bHRpcGxlU2VsZWN0aW9uTW9kZSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5yZW5kZXJTZWxlY3Rpb25Sb3codGhpcy5iaW5kaW5nTGlzdC5jdXJyZW50SWQsIHRoaXMuc2VsZWN0aW9uRGlyLnNlbGVjdGVkS2V5cyk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmjIfku6TovpPlhaXlj5jmm7TlpITnkIZcclxuICAgKi9cclxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XHJcbiAgICBzdXBlci5uZ09uQ2hhbmdlcyhjaGFuZ2VzKTtcclxuICAgIHRoaXMucmVmcmVzaFZpZXcoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaMh+S7pOmUgOavge+8jOazqOmUgOiuoumYhVxyXG4gICAqL1xyXG4gIG5nT25EZXN0cm95KCkge1xyXG4gICAgaWYgKHRoaXMuYmluZGluZ0NoYW5nZVN1YnNjcmlwdGlvbikge1xyXG4gICAgICB0aGlzLmJpbmRpbmdDaGFuZ2VTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgcmVmcmVzaFZpZXcoY2hhbmdlPzogQ2hhbmdlKSB7XHJcbiAgICAvLyB0aGlzLmJpbmREYXRhKCk7XHJcbiAgICB0aGlzLnJlZnJlc2hEYXRhKGNoYW5nZSk7XHJcblxyXG4gICAgLy8g5Yi35paw6aG16ISa5ZCI6K6h5L+h5oGv44CC5a6i5oi356uv5ZCI6K6h77yM5pqC5pe25pS+6L+Z6YeM77yM5pyN5Yqh56uv5ZCI6K6h5pe25pyA5aW95LuO6L+Z6YeM56e76LWw44CCYnkganVzdGluXHJcbiAgICB0aGlzLnJlZnJlc2hTdW1tYXJ5KCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDnu5HlrppkYXRh5Yiw5a6/5Li7Z3JpZOS4ilxyXG4gICAqIEBkZXByZWNhdGVkXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBiaW5kRGF0YSgpIHtcclxuICAgIC8qY29uc3QgZGF0YSA9IHRoaXMuYmluZGluZ0xpc3QudG9KU09OKCk7XHJcbiAgICBsZXQgc2tpcCA9IDA7XHJcbiAgICBpZiAodGhpcy5iaW5kaW5nTGlzdC5wYWdlSW5kZXggPiAwKSB7XHJcbiAgICAgIHNraXAgPSAodGhpcy5iaW5kaW5nTGlzdC5wYWdlSW5kZXggLSAxKSAqIHRoaXMuYmluZGluZ0xpc3QucGFnZVNpemU7XHJcbiAgICB9XHJcbiAgICB0aGlzLnVwZGF0ZVBhZ2VyKHRoaXMuYmluZGluZ0xpc3QucGFnZVNpemUsIHNraXApO1xyXG4gICAgY29uc3QgcHJvY2Vzc2VkID0gcHJvY2VzcyhkYXRhLCBPYmplY3QuYXNzaWduKHt9LCB0aGlzLnN0YXRlLCB7IHNraXA6IDAgfSkpO1xyXG4gICAgcHJvY2Vzc2VkLnRvdGFsID0gdGhpcy5iaW5kaW5nTGlzdC50b3RhbDtcclxuICAgIHRoaXMuZ3JpZC5kYXRhID0gcHJvY2Vzc2VkOyovXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHJlZnJlc2hEYXRhKGNoYW5nZT86IENoYW5nZSkge1xyXG4gICAgbGV0IHNraXAgPSAwO1xyXG4gICAgY29uc3QgeyBwYWdlSW5kZXggPSAxLCBwYWdlU2l6ZSA9IDAgfSA9IHRoaXMuZ2V0UGFnaW5nSW5mbygpIHx8IHt9O1xyXG4gICAgaWYgKHBhZ2VJbmRleCA+IDApIHtcclxuICAgICAgc2tpcCA9IChwYWdlSW5kZXggLSAxKSAqIHBhZ2VTaXplO1xyXG4gICAgfVxyXG4gICAgdGhpcy51cGRhdGVQYWdlcihwYWdlU2l6ZSwgc2tpcCk7XHJcbiAgICB0aGlzLmVuZENlbGxFZGl0KGNoYW5nZSk7XHJcbiAgICB0aGlzLmRhdGEgPSB0aGlzLmJpbmRpbmdMaXN0LnRvSlNPTih7aWdub3JlTXVsdGlMYW5nSW5wdXQ6IHRydWV9KTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6YCA5Ye657yW6L6R54q25oCBXHJcbiAgICogQHBhcmFtIGNoYW5nZSDlj5jmm7RcclxuICAgKi9cclxuICBwcml2YXRlIGVuZENlbGxFZGl0KGNoYW5nZT86IENoYW5nZSkge1xyXG4gICAgY29uc3QgaXNFZGl0aW5nID0gdGhpcy5ncmlkLmlzRWRpdGluZztcclxuICAgIGlmIChjaGFuZ2UgJiYgY2hhbmdlLnR5cGUgPT09IENoYW5nZVR5cGUuTG9hZCAmJiBpc0VkaXRpbmcpIHtcclxuICAgICAgdGhpcy5ncmlkLmNhbmNlbENlbGwoKTtcclxuICAgIH1cclxuICB9XHJcbiAgcHJpdmF0ZSByZWZyZXNoU3VtbWFyeSgpIHtcclxuICAgIGlmICh0aGlzLmFnZ3JDb2x1bW5zKSB7XHJcbiAgICAgIHRoaXMuYWdnckNvbHVtbnMuZm9yRWFjaChhZ2dyQ29sID0+IHtcclxuICAgICAgICBpZiAoYWdnckNvbC5hZ2dyZWdhdGUpIHtcclxuICAgICAgICAgIGFnZ3JDb2wucmVjYWxjdWxhdGVTdW1tYXJ5KHRoaXMuYmluZGluZ0xpc3QpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBASG9zdExpc3RlbmVyKCdwYWdlQ2hhbmdlJywgWyckZXZlbnQnXSlcclxuICBwdWJsaWMgb25QYWdlQ2hhbmdlKGV2ZW50OiBQYWdlQ2hhbmdlRXZlbnQpIHtcclxuICAgIGNvbnN0IHsgc2tpcCA9IDAsIHRha2UgPSAwIH0gPSBldmVudCB8fCB7fTtcclxuICAgIC8vIHRoaXMuYmluZGluZ0xpc3Quc2V0UGFnaW5hdGlvbkluZm8oc2tpcCwgdGFrZSk7XHJcbiAgICB0aGlzLmJpbmRpbmdEYXRhLnNldFBhZ2luZ0luZm8oc2tpcCwgdGFrZSwgdGhpcy52aWV3TW9kZWwuYmluZGluZ1BhdGgpO1xyXG4gICAgLy8g56e76Zmk6YCJ5Lit6KGM5qC35byPXHJcbiAgICBNdWx0aVNlbGVjdEdyaWRVdGlsaXR5LnJlbW92ZVJvd1NlbGVjdGVkU3R5bGUodGhpcy5ncmlkLCB0aGlzLnJvd0luZGV4KTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6YeN572uZ3JpZOWIhumhteS/oeaBr1xyXG4gICAqL1xyXG4gIHByaXZhdGUgcmVzZXRQYWdlSW5mbygpIHtcclxuICAgIGNvbnN0IHsgcGFnZVNpemUgPSAwIH0gPSB0aGlzLmdldFBhZ2luZ0luZm8oKSB8fCB7fTtcclxuICAgIHRoaXMuYmluZGluZ0RhdGEuc2V0UGFnaW5nSW5mbygwLCBwYWdlU2l6ZSwgdGhpcy52aWV3TW9kZWwuYmluZGluZ1BhdGgpO1xyXG4gIH1cclxuICBwcml2YXRlIGluaXREYXRhU3RhdGUoKSB7XHJcbiAgICAvLyBjb25zdCBncm91cHM6IEdyb3VwRGVzY3JpcHRvcltdID0gW107XHJcbiAgICAvLyBpZiAodGhpcy5ncm91cEZpZWxkKSB7XHJcbiAgICAvLyAgIGdyb3Vwcy5wdXNoKHtmaWVsZDogdGhpcy5ncm91cEZpZWxkLCBhZ2dyZWdhdGVzOiB0aGlzLmFnZ3JlZ2F0ZXN8fFtdfSk7XHJcbiAgICAvLyAgIHRoaXMuZ3JpZC5ncm91cCA9IGdyb3VwcztcclxuICAgIC8vIH1cclxuICAgIC8vIHRoaXMuc3RhdGUgPSBPYmplY3QuYXNzaWduKHRoaXMuc3RhdGUsIHtncm91cDogZ3JvdXBzfSk7XHJcblxyXG4gICAgY29uc3QgYWdncmVnYXRlc0RlczogQWdncmVnYXRlRGVzY3JpcHRvcltdID0gW107XHJcbiAgICBpZiAodGhpcy5ncm91cEFnZ3JGaWVsZHMpIHtcclxuICAgICAgZm9yIChjb25zdCBncm91cEFnZ3JGaWVsZCBvZiB0aGlzLmdyb3VwQWdnckZpZWxkcykge1xyXG4gICAgICAgIGFnZ3JlZ2F0ZXNEZXMucHVzaCh7IGZpZWxkOiBncm91cEFnZ3JGaWVsZCwgYWdncmVnYXRlOiAnc3VtJyB9KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGdyb3VwOiBHcm91cERlc2NyaXB0b3JbXSA9IFtdO1xyXG4gICAgaWYgKHRoaXMuZ3JvdXBGaWVsZCkge1xyXG4gICAgICBncm91cC5wdXNoKHsgZmllbGQ6IHRoaXMuZ3JvdXBGaWVsZCwgYWdncmVnYXRlczogYWdncmVnYXRlc0RlcyB9KTtcclxuICAgIH1cclxuICAgIHRoaXMuZ3JvdXAgPSBncm91cDtcclxuXHJcbiAgfVxyXG5cclxuICAvKlxyXG4gICAqIEBvdmVycmlkZVxyXG4gICAqIEBwYXJhbSBzdGF0ZSBTdGF0ZVxyXG4gICAqL1xyXG4gIG9uU3RhdGVDaGFuZ2Uoc3RhdGU6IERhdGFTdGF0ZUNoYW5nZUV2ZW50KSB7XHJcbiAgICAvLyDor7TmmI7vvJpwYWdlcuagueaNrnNraXDorqHnrpflvZPliY3pobXnoIHjgIJrZW5kbyBncmlk5YaF6YOo5Lya5ZyoZmlsdGVyIHN0YXRl5Y+Y5YyW5pe25oqKc2tpcOWPmOS4ujDvvIjph43nva7liLDnrKzkuIDpobXvvInjgIJcclxuICAgIC8vIOWboOatpOmcgOimgemHjeWGmW9uU3RhdGVDaGFuZ2Xmlrnms5XvvIzkv67mraNza2lwXHJcbiAgICBpZiAoc3RhdGUuc2tpcCAhPT0gdGhpcy5jdXJyZW50U2tpcCkge1xyXG4gICAgICBzdGF0ZS5za2lwID0gdGhpcy5jdXJyZW50U2tpcDtcclxuICAgIH1cclxuICAgIC8vIOS9v+eUqGtlbmRv6buY6K6k55qE5aSE55CGc3RhdGXnmoTpgLvovpFcclxuICAgIHRoaXMuYXBwbHlTdGF0ZShzdGF0ZSk7XHJcblxyXG4gICAgdGhpcy5yZWJpbmQoKTtcclxuICB9XHJcblxyXG4gIC8vIHByb3RlY3RlZCBhcHBseVN0YXRlKHtza2lwLCB0YWtlLCBzb3J0LCBncm91cCwgZmlsdGVyfTogU3RhdGUpOiB2b2lkIHtcclxuICAvLyAgIHRoaXMuc2tpcCA9IHNraXA7XHJcbiAgLy8gICB0aGlzLnBhZ2VTaXplID0gdGFrZTtcclxuICAvLyAgIHRoaXMuc29ydCA9IHNvcnQ7XHJcbiAgLy8gICB0aGlzLmdyb3VwID0gZ3JvdXA7XHJcbiAgLy8gICB0aGlzLmZpbHRlciA9IGZpbHRlcjtcclxuICAvLyB9XHJcblxyXG4gIC8qXHJcbiAgICogQG92ZXJyaWRlIOacjeWKoeWZqOerr+WIhumhteWPluaVsOOAgnByb2Nlc3Pkvb/nlKjnmoRzdGF0ZeS4rXNraXDlupTkuLow77yM5ZCm5YiZ5LiN5pi+56S65pWw5o2uXHJcbiAgICogQHBhcmFtIHN0YXRlIFN0YXRlXHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIHByb2Nlc3Moc3RhdGU6IFN0YXRlKTogR3JpZERhdGFSZXN1bHQge1xyXG4gICAgLy8gaWYgKHRoaXMuZWRpdGluZykge1xyXG4gICAgLy8gICBzdGF0ZS5zb3J0ID0gbnVsbDtcclxuICAgIC8vIH0gZWxzZSB7XHJcbiAgICAvLyAgIHN0YXRlLnNvcnQgPSB0aGlzLm9yaWdpbmFsU29ydDtcclxuICAgIC8vIH1cclxuICAgIHN0YXRlLnNraXAgPSAwO1xyXG4gICAgY29uc3QgeyBwYWdlU2l6ZSA9IDAsIHRvdGFsOiB0b3RhbENvdW50ID0gMCB9ID0gdGhpcy5nZXRQYWdpbmdJbmZvKCkgfHwge307XHJcbiAgICAvLyBmaXjvvJrkuI3lkK/nlKjliIbpobXml7bvvIx0YWtlPTDlr7zoh7Rwcm9jZXNz5LiN6L+U5Zue5pWw5o2uXHJcbiAgICBpZiAoc3RhdGUudGFrZSA9PT0gMCkge1xyXG4gICAgICBzdGF0ZS50YWtlID0gdGhpcy5iaW5kaW5nTGlzdC5sZW5ndGg7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBzdGF0ZS50YWtlID0gcGFnZVNpemU7XHJcbiAgICB9XHJcbiAgICAvLyDnvJbovpHmqKHlvI/nmoTliKTmlq3kvp3mja7kuLpwYWdlU2l6ZeWwj+S6jue7keWumuaVsOaNrueahOaVsOmHj+S4lOWQr+eUqOWIhumhtVxyXG4gICAgY29uc3QgaXNFZGl0TW9kZSA9IHN0YXRlLnRha2UgPCB0aGlzLmJpbmRpbmdMaXN0Lmxlbmd0aDtcclxuICAgIGlmIChpc0VkaXRNb2RlKSB7XHJcbiAgICAgIHN0YXRlLnRha2UgPSB0aGlzLmJpbmRpbmdMaXN0Lmxlbmd0aDtcclxuICAgIH1cclxuICAgIGNvbnN0IHByb2Nlc3NlZCA9IHN1cGVyLnByb2Nlc3Moc3RhdGUpO1xyXG4gICAgLy8gZml4OuaVsOaNruS7juaXoOWIsOacieaXtuWIhumhteS4jeWQr+eUqFxyXG4gICAgcHJvY2Vzc2VkLnRvdGFsID0gTWF0aC5tYXgodG90YWxDb3VudCwgdGhpcy5iaW5kaW5nTGlzdC5sZW5ndGgpO1xyXG4gICAgLy8g5YiG6aG157yW6L6R5qih5byP5LiL5pWw5o2u5oC76K6w5b2V5pWw5LiN6IO9562J5LqO55yf5a6e55qE5pWw5o2u5pWw5o2u77yM5ZCm5YiZ5YiG6aG15bel5YW35p2h5bCx5Lya6Ieq5Yqo5aKe5Yqg5YiG6aG16aG1562+XHJcbiAgICBpZiAoaXNFZGl0TW9kZSkge1xyXG4gICAgICBwcm9jZXNzZWQudG90YWwgPSB0b3RhbENvdW50IHx8IDE7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHByb2Nlc3NlZDtcclxuICB9XHJcblxyXG4gIC8qXHJcbiAgICog6YCJ5Lit6KGM5Li76ZSu5Y+Y5YyW5aSE55CGXHJcbiAgICogQHBhcmFtIGV2ZW50IHsgU2VsZWN0aW9uRXZlbnR9IOmAieS4reihjOWPmOWMluWkhOeQhlxyXG4gICAqL1xyXG4gIEBIb3N0TGlzdGVuZXIoJ3NlbGVjdGVkS2V5c0NoYW5nZScsIFsnJGV2ZW50J10pXHJcbiAgcHVibGljIHNlbGVjdGVkS2V5c0NoYW5nZUhhbmRsZXIoc2VsZWN0ZWRLZXlzOiBzdHJpbmdbXSkge1xyXG4gICAgaWYgKCEodGhpcy5Jc011bHRpcGxlU2VsZWN0aW9uTW9kZSkpIHsvLyDljZXpgInmqKHlvI/kuItcclxuICAgICAgLy8g6K6+572uQmluZGluZ0RhdGHkuK3nmoTlvZPliY3ooYxcclxuICAgICAgdGhpcy5zZXRTZWxlY3Rpb25JZFRvQmluZGluZ0RhdGEoc2VsZWN0ZWRLZXlzW3NlbGVjdGVkS2V5cy5sZW5ndGggLSAxXSk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy52aWV3TW9kZWwudWlTdGF0ZS5zZXRQcm9wZXJ0eVZhbHVlKCdpZHMnLCB0aGlzLnNlbGVjdGlvbkRpci5zZWxlY3RlZEtleXMpOyAvLyDmm7TmlrDpm4blkIhcclxuICB9XHJcblxyXG4gIC8qXHJcbiAgICog5aSE55CGR3JpZOihjOWIh+aNouS6i+S7tlxyXG4gICAqIEBwYXJhbSBldmVudCB7IFNlbGVjdGlvbkV2ZW50fSDooYzliIfmjaLkuovku7blr7nosaFcclxuICAgKi9cclxuICBASG9zdExpc3RlbmVyKCdzZWxlY3Rpb25DaGFuZ2UnLCBbJyRldmVudCddKVxyXG4gIHB1YmxpYyBzZWxlY3Rpb25DaGFuZ2VIYW5kbGVyKGV2ZW50OiBhbnkpIHtcclxuICAgIGlmICh0aGlzLklzTXVsdGlwbGVTZWxlY3Rpb25Nb2RlKSB7XHJcbiAgICAgIHRoaXMuaGFuZGxlU2VsZWN0ZWRDaGVja2JveENoYW5nZSh0aGlzLmdyaWQud3JhcHBlciwgZXZlbnQpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5aSE55CGY2hlY2tib3jpgInkuK3kuovku7ZcclxuICAgKi9cclxuICBwcml2YXRlIGhhbmRsZVNlbGVjdGVkQ2hlY2tib3hDaGFuZ2UoZWxlbWVudFJlZjogRWxlbWVudFJlZiwgZXZlbnQ6IGFueSkge1xyXG4gICAgTXVsdGlTZWxlY3RHcmlkVXRpbGl0eS5yZW5kZXJTZWxlY3RlZENoYW5nZUNoZWNrYm94KGVsZW1lbnRSZWYsIGV2ZW50KTtcclxuICAgIHRoaXMuc2VsZWN0ZWRDaGVja2JveENoYW5nZS5lbWl0KGV2ZW50KTtcclxuICB9XHJcblxyXG4gIC8qXHJcbiAgICog5Y2V5YWD5qC854K55Ye75aSE55CGXHJcbiAgICogQHBhcmFtIGV2ZW50IHsgQ2VsbENsaWNrRXZlbnQgfSDljZXlhYPmoLzljZXlh7vkuovku7blr7nosaFcclxuICAgKi9cclxuICBASG9zdExpc3RlbmVyKCdjZWxsQ2xpY2snLCBbJyRldmVudCddKVxyXG4gIHB1YmxpYyBjZWxsQ2xpY2tIYW5kbGVyKGV2ZW50OiBDZWxsQ2xpY2tFdmVudCkge1xyXG4gICAgdGhpcy5jZWxsQ2xpY2tQYXJhbSA9IGV2ZW50O1xyXG4gICAgdGhpcy5jZWxsQ2xpY2tFdmVudCA9IGV2ZW50O1xyXG4gICAgdGhpcy5yb3dJbmRleCA9IGV2ZW50LnJvd0luZGV4O1xyXG4gICAgdGhpcy5jb2x1bW5JbmRleCA9IGV2ZW50LmNvbHVtbkluZGV4O1xyXG4gICAgdGhpcy5zZW5kZXIgPSBldmVudC5zZW5kZXI7XHJcblxyXG4gICAgLy8g5aSa6YCJ5qih5byP5LiL77yM5LiU5LiN5YiG57uE55qE5oOF5Ya15LiL77yM5qOA5rWL6KGM5YiH5o2iXHJcbiAgICBpZiAodGhpcy5Jc011bHRpcGxlU2VsZWN0aW9uTW9kZSAmJiAhdGhpcy5ncmlkT3B0aW9uLmdyb3VwYWJsZSkge1xyXG4gICAgICBjb25zdCBjdXJyZW50Um93SW5kZXggPSBldmVudC5yb3dJbmRleDtcclxuICAgICAgaWYgKGN1cnJlbnRSb3dJbmRleCAhPT0gdGhpcy5sYXN0Um93SW5kZXgpIHtcclxuICAgICAgICBjb25zdCByb3dTZWxlY3RlZENvbnRleHQ6IFNlbGVjdGVkUm93Q29udGV4dCA9IG5ldyBTZWxlY3RlZFJvd0NvbnRleHQoKTtcclxuICAgICAgICByb3dTZWxlY3RlZENvbnRleHQuY3VycmVudFJvd0luZGV4ID0gY3VycmVudFJvd0luZGV4O1xyXG4gICAgICAgIHJvd1NlbGVjdGVkQ29udGV4dC5sYXN0Um93SW5kZXggPSB0aGlzLmxhc3RSb3dJbmRleDtcclxuXHJcbiAgICAgICAgdGhpcy5oYW5kbGVTZWxlY3RlZFJvd0NoYW5nZShyb3dTZWxlY3RlZENvbnRleHQpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8g6K6+572u5a6e5L2T55qE5b2T5YmN6KGMXHJcbiAgICB0aGlzLmRhdGFJZCA9IHRoaXMuZ2V0U2VsZWN0ZWRJZEZyb21HcmlkKGV2ZW50LmRhdGFJdGVtKTtcclxuICAgIHRoaXMuc2V0U2VsZWN0aW9uSWRUb0JpbmRpbmdEYXRhKHRoaXMuZGF0YUlkKTtcclxuXHJcbiAgICAvLyDoi6XnirbmgIHmnLrkuI3mmK/lj6/nvJbovpHnirbmgIEg5LiN5Y+v57yW6L6RXHJcbiAgICBpZiAoIXRoaXMuaXNFZGl0YWJsZSgpKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcblxyXG5cclxuICAgIC8vIOWIl+aooeadv+S4jeWtmOWcqCAg5LiN5Y+v57yW6L6RXHJcbiAgICBpZiAoIWV2ZW50LmNvbHVtbi5lZGl0VGVtcGxhdGUpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKGV2ZW50LnR5cGUgPT09ICdjbGljaycgJiYgIWV2ZW50LmlzRWRpdGVkKSB7XHJcblxyXG5cclxuICAgICAgLy8g5aaC5p6c5a2Y5Zyo5pi+6ZqQ54q25Ya1ICDnoa7lrprmraPnoa7nmoRjb2x1bW5JbmRleFxyXG4gICAgICBjb25zdCBvcmlnaW5Db2x1bXMgPSB0aGlzLmdldENvbHVtbnModGhpcy5ncmlkT3B0aW9uLmZpZWxkcyk7XHJcbiAgICAgIGNvbnN0IGNvbHVtbnM6IGFueVtdID0gdGhpcy5nZXRDb2x1bW5zKG9yaWdpbkNvbHVtcyk7XHJcbiAgICAgIGNvbnN0IGN1cnJlbnRDb2x1bW5JbmRleCA9IGNvbHVtbnMuZmluZEluZGV4KChjb2w6IGFueSkgPT4gY29sLmRhdGFGaWVsZCA9PT0gZXZlbnQuY29sdW1uLmZpZWxkKTtcclxuICAgICAgY29uc3QgaGlkZGVuQ29sTGVuID0gY29sdW1ucy5zbGljZSgwLCBjdXJyZW50Q29sdW1uSW5kZXggKyAxKS5maWx0ZXIoY29sID0+ICFjb2wudmlzaWJsZSkubGVuZ3RoO1xyXG5cclxuICAgICAgLy8g6LWL5YC85YWo5bGA6KGM57Si5byVICDliJfntKLlvJVcclxuICAgICAgdGhpcy5yb3dJbmRleCA9IGV2ZW50LnJvd0luZGV4O1xyXG4gICAgICB0aGlzLmNvbHVtbkluZGV4ID0gZXZlbnQuY29sdW1uSW5kZXggKyBoaWRkZW5Db2xMZW47XHJcbiAgICAgIHRoaXMuaGlkZGVuQ29sTGVuID0gaGlkZGVuQ29sTGVuO1xyXG4gICAgICB0aGlzLnNlbmRlciA9IGV2ZW50LnNlbmRlcjtcclxuXHJcbiAgICAgIHRoaXMuc2V0RWRpdGFibGUodGhpcy5yb3dJbmRleCwgdGhpcy5jb2x1bW5JbmRleCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlpITnkIbpgInkuK3ooYzliIfmjaLkuovku7ZcclxuICAgKi9cclxuICBwcml2YXRlIGhhbmRsZVNlbGVjdGVkUm93Q2hhbmdlKHJvd1NlbGVjdGVkQ29udGV4dDogU2VsZWN0ZWRSb3dDb250ZXh0KSB7XHJcbiAgICBNdWx0aVNlbGVjdEdyaWRVdGlsaXR5LnJlbmRlckNsaWNrQ2hhbmdlZFJvdyh0aGlzLmdyaWQsIHJvd1NlbGVjdGVkQ29udGV4dCk7XHJcblxyXG4gICAgdGhpcy5yb3dJbmRleCA9IHJvd1NlbGVjdGVkQ29udGV4dC5jdXJyZW50Um93SW5kZXg7XHJcbiAgICB0aGlzLmxhc3RSb3dJbmRleCA9IHJvd1NlbGVjdGVkQ29udGV4dC5jdXJyZW50Um93SW5kZXg7XHJcbiAgICAvLyDmm7TmlrDlvZPliY3ooYxcclxuICAgIGNvbnN0IGlkID0gdGhpcy5nZXRQcmltYXJ5KHRoaXMucm93SW5kZXgpO1xyXG4gICAgdGhpcy5zZXRTZWxlY3Rpb25JZFRvQmluZGluZ0RhdGEoaWQpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDojrflj5bmjIflrprooYznmoTkuLvplK5cclxuICAgKiBAcGFyYW0gcm93IOihjOWPt1xyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0UHJpbWFyeShyb3c6IG51bWJlcikge1xyXG4gICAgbGV0IGRhdGE6IGFueSA9IHRoaXMuZ3JpZC5kYXRhO1xyXG4gICAgaWYgKGRhdGEgJiYgIUFycmF5LmlzQXJyYXkoZGF0YSkgJiYgZGF0YS5oYXNPd25Qcm9wZXJ0eSgnZGF0YScpKSB7XHJcbiAgICAgIGRhdGEgPSBkYXRhLmRhdGE7XHJcbiAgICB9XHJcbiAgICBjb25zdCB7IHBhZ2VJbmRleCA9IDEsIHBhZ2VTaXplID0gMCB9ID0gdGhpcy5nZXRQYWdpbmdJbmZvKCkgfHwge307XHJcbiAgICBjb25zdCBza2lwID0gdGhpcy5iaW5kaW5nTGlzdC5za2lwO1xyXG4gICAgLy8g5LiN5YiG6aG15oiW6ICF56ys5LiA6aG15pe25Y+W5LiN6ZyA6KaB5L+u5pS56KGM5Y+3XHJcbiAgICBjb25zdCByb3dOdW1iZXIgPSBwYWdlU2l6ZSA9PT0gMCB8fCBwYWdlSW5kZXggPT09IDEgPyByb3cgOiByb3cgLSBza2lwO1xyXG4gICAgaWYgKGRhdGEubGVuZ3RoID4gcm93TnVtYmVyKSB7XHJcbiAgICAgIHJldHVybiBkYXRhW3Jvd051bWJlcl1bdGhpcy5iaW5kaW5nTGlzdC5wcmltYXJ5S2V5XTtcclxuICAgIH1cclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxuXHJcbiAgLypcclxuICAgKiDljZXlhYPmoLznu5PmnZ/nvJbovpHlpITnkIZcclxuICAgKiBAcGFyYW0gZXZlbnQg5Y2V5YWD5qC857uT5p2f57yW6L6R5LqL5Lu25a+56LGhXHJcbiAgICovXHJcbiAgQEhvc3RMaXN0ZW5lcignY2VsbENsb3NlJywgWyckZXZlbnQnXSlcclxuICBwdWJsaWMgY2VsbENsb3NlSGFuZGxlcihldmVudDogYW55KTogYW55IHtcclxuXHJcbiAgICBpZiAodGhpcy5kaWFsb2dTZXIuaGFzRGlhbG9nT3BlbmVkKCkpIHtcclxuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0aGlzLnJ0cykge1xyXG4gICAgICAvLyDluK7liqnnu4Tku7bmlofmnKzlj5jljJblkI7ljrvmn6Xor6JcclxuICAgICAgaWYgKHRoaXMucnRzLmdldEZvcm1TdGF0ZSgnbG9va3VwLnBlbmRpbmcnKSkge1xyXG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyDngrnlh7vluK7liqnnoa7lrprlj6/lj5bmtojmjInpkq7lkI7kuI3nu5PmnZ/lvZPliY3ljZXlhYPmoLznvJbovpFcclxuICAgICAgaWYgKGV2ZW50Lm9yaWdpbmFsRXZlbnQpIHtcclxuICAgICAgICBpZiAodGhpcy5ydHMuZXZlbnRQYXRoKGV2ZW50Lm9yaWdpbmFsRXZlbnQpLmZpbmQobiA9PiBuLnRhZ05hbWUgPT09ICdGQVJSSVMtRElBTE9HJykpIHtcclxuICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGNvbnN0IHsgZm9ybUdyb3VwLCBjb2x1bW4sIGRhdGFJdGVtLCByb3dJbmRleCB9ID0gZXZlbnQ7XHJcbiAgICBjb25zdCBjb2x1bW5zID0gdGhpcy5nZXRDb2x1bW5zKHRoaXMuZ3JpZE9wdGlvbi5maWVsZHMpO1xyXG4gICAgbGV0IGN1cnJlbnRDb2wgPSBjb2x1bW5zLmZpbmQoKGVsZW1lbnQ6IGFueSkgPT4ge1xyXG4gICAgICByZXR1cm4gZWxlbWVudC5kYXRhRmllbGQgPT09IGNvbHVtbi5maWVsZDtcclxuICAgIH0pO1xyXG4gICAgY29uc3QgZm9ybUNvbnRyb2xWYWx1ZSA9IGZvcm1Hcm91cFtjdXJyZW50Q29sLmVkaXRvci5iaW5kaW5nLnBhdGhdLnZhbHVlO1xyXG4gICAgaWYgKGN1cnJlbnRDb2wuZ2V0RHluYW1pY0RhdGEpIHtcclxuICAgICAgLy8g6Iul5q2k5YiX5piv5Yqo5oCB5Y2V5YWD5qC85YiXXHJcbiAgICAgIGN1cnJlbnRDb2wgPSBjdXJyZW50Q29sLmdldER5bmFtaWNEYXRhKGRhdGFJdGVtLCBjdXJyZW50Q29sKTtcclxuICAgIH1cclxuICAgIHRoaXMuc2V0VmFsdWUoZm9ybUNvbnRyb2xWYWx1ZSwgY3VycmVudENvbCk7XHJcbiAgfVxyXG5cclxuICAvKlxyXG4gICAgICog5Zue6L2mICDliIfmjaLljZXlhYPmoLxcclxuICAgICAqIEBwYXJhbSBldmVudCDplK7nm5jmjInkuIvkuovku7ZcclxuICAgICAqL1xyXG4gIEBIb3N0TGlzdGVuZXIoJ2tleWRvd24nLCBbJyRldmVudCddKVxyXG4gIGVudGVyQ2VsbChlOiBhbnkpIHtcclxuICAgIC8vIOWbnui9pumUrlxyXG4gICAgaWYgKCFlLnNoaWZ0S2V5ICYmIGUua2V5Q29kZSA9PT0gMTMpIHtcclxuICAgICAgLy8gdGV4dGFyZWEgZW50ZXIg5bGP6JS95o2i6KGM5pON5L2cXHJcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgaWYgKCF0aGlzLnNlbmRlcikge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICAvLyDnlLHkuo5rZXlkb3duIOS6i+S7tuS8muWFiOaJp+ihjO+8jOaJgOS7pei/memHjOWFiOimgeaJp+ihjGJsdXIg5LqL5Lu277ybXHJcbiAgICAgIGUudGFyZ2V0LmJsdXIoKTtcclxuICAgICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgaWYgKHRoaXMucnRzICYmIHRoaXMucnRzLmdldEZvcm1TdGF0ZSgnbG9va3VwLnBlbmRpbmcnKSkge1xyXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHRoaXMuZW50ZXJOZXh0Q2VsbCgpO1xyXG4gICAgICAgIH0sIDIwMSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLypcclxuICAgICAqIOe7keWummdyaWQgb3B0aW9uXHJcbiAgICAgKiBAcGFyYW0gZGF0YUl0ZW0g6KGM5pWw5o2uXHJcbiAgICAgKi9cclxuICBwcml2YXRlIGJpbmRpbmdHcmlkT3B0aW9uKCkge1xyXG4gICAgaWYgKCF0aGlzLmZhcnJpc0JpbmRpbmdHcmlkT3B0aW9uKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLmdyaWQsICdncmlkT3B0aW9uJywgeyB2YWx1ZTogdGhpcy5mYXJyaXNCaW5kaW5nR3JpZE9wdGlvbiB9KTtcclxuICB9XHJcblxyXG4gIC8qXHJcbiAgICog5pu05pawR3JpZOWIhumhteeKtuaAgVxyXG4gICAqIEBwYXJhbSB0YWtlXHJcbiAgICogQHBhcmFtIHNraXBcclxuICAgKi9cclxuICBwcml2YXRlIHVwZGF0ZVBhZ2VyKHRha2U6IG51bWJlciwgc2tpcDogbnVtYmVyKSB7XHJcbiAgICBpZiAodGFrZSA9PT0gMCkge1xyXG4gICAgICB0aGlzLmN1cnJlbnRTa2lwID0gMDtcclxuICAgICAgdGhpcy5wYWdlU2l6ZSA9IDA7XHJcbiAgICAgIHRoaXMuc2tpcCA9IDA7XHJcbiAgICAgIHRoaXMuZ3JpZC5wYWdlYWJsZSA9IGZhbHNlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5jdXJyZW50U2tpcCA9IHNraXA7XHJcbiAgICAgIHRoaXMuc2tpcCA9IHNraXA7XHJcbiAgICAgIHRoaXMucGFnZVNpemUgPSB0YWtlO1xyXG4gICAgICB0aGlzLmdyaWQucGFnZWFibGUgPSB7XHJcbiAgICAgICAgYnV0dG9uQ291bnQ6IDEwLFxyXG4gICAgICAgIGluZm86IHRydWUsXHJcbiAgICAgICAgdHlwZTogJ251bWVyaWMnLFxyXG4gICAgICAgIHBhZ2VTaXplczogZmFsc2UsXHJcbiAgICAgICAgcHJldmlvdXNOZXh0OiB0cnVlXHJcbiAgICAgIH07XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKlxyXG4gICAqIOiuvue9ruWNleWFg+agvOWPr+e8lui+keaAp1xyXG4gICAqIEBwYXJhbSBkYXRhSXRlbSDooYzmlbDmja5cclxuICAgKiBAcGFyYW0gY29sdW1uIOWIl+WvueixoVxyXG4gICAqIEBwYXJhbSByb3dJbmRleCDooYzntKLlvJVcclxuICAgKiBAcGFyYW0gY29sdW1uSW5kZXgg5YiX57Si5byVXHJcbiAgICogQHBhcmFtIHNlbmRlciBncmlk5a6e5L6LXHJcbiAgICovXHJcbiAgc2V0RWRpdGFibGUocm93TnVtYmVyOiBudW1iZXIsIGNvbHVtbk51bWJlcjogbnVtYmVyKSB7XHJcbiAgICBjb25zdCBkYXRhID0gdGhpcy5ncmlkLmRhdGFbJ2RhdGEnXTtcclxuICAgIGNvbnN0IHsgcGFnZUluZGV4ID0gMSwgcGFnZVNpemUgPSAwIH0gPSB0aGlzLmdldFBhZ2luZ0luZm8oKSB8fCB7fTtcclxuICAgIGNvbnN0IHNraXAgPSB0aGlzLmJpbmRpbmdMaXN0LnNraXA7XHJcbiAgICAvLyDkuI3liIbpobXmiJbogIXnrKzkuIDpobXml7blj5bkuI3pnIDopoHkv67mlLnooYzlj7dcclxuICAgIGNvbnN0IGRhdGFSb3dOdW1iZXIgPSBwYWdlU2l6ZSA9PT0gMCB8fCBwYWdlSW5kZXggPT09IDEgPyByb3dOdW1iZXIgOiByb3dOdW1iZXIgLSBza2lwO1xyXG4gICAgbGV0IGl0ZW0gPSBkYXRhW2RhdGFSb3dOdW1iZXJdO1xyXG4gICAgaWYgKHRoaXMuZ3JpZE9wdGlvbi5ncm91cGFibGUpIHtcclxuICAgICAgaXRlbSA9IHRoaXMuZ2V0R3JvdXBJdGVtKGRhdGEsIGRhdGFSb3dOdW1iZXIpO1xyXG4gICAgfVxyXG4gICAgY29uc3Qgb3JpZ2luQ29sdW1zID0gdGhpcy5nZXRDb2x1bW5zKHRoaXMuZ3JpZE9wdGlvbi5maWVsZHMpO1xyXG4gICAgY29uc3QgY29sdW1ucyA9IHRoaXMuZ2V0Q29sdW1ucyhvcmlnaW5Db2x1bXMpO1xyXG4gICAgLyog5YGH5aaC5YiX55qE6aG65bqP5pS55Y+YIOavlOWmguWtmOWcqOWbuuWumuWIlyAg6YKj5LmI5bqU6K+l6I635Y+W55yf5q2j55qE5YiX5a+56LGhICovXHJcbiAgICAvLyBsZXQgY29sID0gY29sdW1uc1tjb2x1bW5OdW1iZXJdO1xyXG5cclxuICAgIGxldCB0ZW1wSW5kZXggPSBjb2x1bW5OdW1iZXI7XHJcbiAgICAvLyDlvZPliY3liJfntKLlvJXkuI3kuLowXHJcbiAgICBpZiAodGhpcy5ncmlkWydncmlkT3B0aW9uJ10uc2hvd0xpbmVOdW1iZXIpIHtcclxuICAgICAgdGVtcEluZGV4ID0gdGVtcEluZGV4IC0gMTtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLmdyaWQuc2VsZWN0YWJsZSAmJiB0aGlzLmdyaWQuc2VsZWN0YWJsZVsnbW9kZSddID09PSAnbXVsdGlwbGUnKSB7XHJcbiAgICAgIHRlbXBJbmRleCA9IHRlbXBJbmRleCAtIDE7XHJcbiAgICB9XHJcbiAgICBjb25zdCBjb2wgPSBjb2x1bW5zW3RlbXBJbmRleF07XHJcblxyXG4gICAgY29uc3QgcGFyYW1zID0ge1xyXG4gICAgICBkYXRhSXRlbTogaXRlbSxcclxuICAgICAgY29sdW1uOiBjb2wsXHJcbiAgICAgIHJvd0luZGV4OiByb3dOdW1iZXIsXHJcbiAgICAgIGNvbHVtbkluZGV4OiB0ZW1wSW5kZXgsXHJcbiAgICB9O1xyXG5cclxuICAgIC8vIOaOp+WItuWNleWFg+agvOeahOWPr+e8lui+keaAp1xyXG4gICAgaWYgKGNvbCAmJiAhY29sLmVkaXRhYmxlKSB7XHJcbiAgICAgIGNvbC5lZGl0YWJsZSA9IChwYXJhbTogb2JqZWN0KSA9PiB0cnVlO1xyXG4gICAgfVxyXG4gICAgaWYgKGNvbCAmJiB0aGlzLm5vdFJlYWRPbmx5KGNvbCwgcGFyYW1zKSkge1xyXG4gICAgICAvLyDorr7nva7lvZPliY3ooYxcclxuICAgICAgdGhpcy5kYXRhSWQgPSB0aGlzLmdldFNlbGVjdGVkSWRGcm9tR3JpZChpdGVtKTtcclxuICAgICAgdGhpcy5zZXRTZWxlY3Rpb25JZFRvQmluZGluZ0RhdGEodGhpcy5kYXRhSWQpO1xyXG4gICAgICAvLyBjb25zdCB2YWx1ZSA9IHRoaXMuZ2V0VmFsdWUoaXRlbSwgY29sLmRhdGFGaWVsZCk7XHJcbiAgICAgIC8vIHRoaXMuc2V0VmFsdWUodmFsdWUsIGNvbCk7XHJcbiAgICAgIHRoaXMuc2VuZGVyLmVkaXRDZWxsKHJvd051bWJlciwgY29sdW1uTnVtYmVyIC0gdGhpcy5oaWRkZW5Db2xMZW4sIHRoaXMudmlld01vZGVsLmZvcm0pO1xyXG4gICAgfVxyXG5cclxuICB9XHJcbiAgLypcclxuICDojrflj5bmm7TmlrAgcm93SW5kZXggY29sdW1uSW5kZXhcclxuICAgKi9cclxuICB1cGRhdGVJbmRleChyb3dOdW1iZXI6IG51bWJlciwgY29sdW1uSW5kZXg6IG51bWJlcikge1xyXG4gICAgY29uc3QgbmV3Q29sdW1uSW5kZXggPSAoY29sdW1uSW5kZXggKyAxKSAlIHRoaXMubGVuO1xyXG4gICAgaWYgKCFuZXdDb2x1bW5JbmRleCkge1xyXG4gICAgICBjb25zdCBkYXRhTGVuID0gdGhpcy5iaW5kaW5nTGlzdC50b0pTT04oKS5sZW5ndGg7XHJcbiAgICAgIGNvbnN0IG5ld1Jvd0luZGV4ID0gKHJvd051bWJlciArIDEpICUgZGF0YUxlbjtcclxuICAgICAgcmV0dXJuIHsgcm93SW5kZXg6IG5ld1Jvd0luZGV4LCBjb2x1bW5JbmRleDogbmV3Q29sdW1uSW5kZXggfTtcclxuICAgIH1cclxuICAgIHJldHVybiB7XHJcbiAgICAgIHJvd0luZGV4OiByb3dOdW1iZXIsXHJcbiAgICAgIGNvbHVtbkluZGV4OiBuZXdDb2x1bW5JbmRleFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8qIOaYr+WQpuWPquivuyAqL1xyXG4gIG5vdFJlYWRPbmx5KGNvbHVtbjogYW55LCBwYXJhbTogYW55KSB7XHJcbiAgICBpZiAoIWNvbHVtbikge1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gY29sdW1uLmVkaXRhYmxlKHBhcmFtKSAmJiAhY29sdW1uLmVkaXRvci5yZWFkb25seTtcclxuICB9XHJcblxyXG4gIC8qXHJcbiAgICAgKiDnu5nliJfooajotYvlgLwg5oiW57uZZm9ybWNvbnRyb2zotYvlgLxcclxuICAgICAgKi9cclxuICBzZXRWYWx1ZSh2YWx1ZTogYW55LCBjb2x1bW46IGFueSkge1xyXG4gICAgY29uc3QgY3VycmVudENvbHVtblR5cGUgPSBjb2x1bW4uZGF0YVR5cGU7XHJcbiAgICAvLyDlkIzml7bliKTmlq1ncmlkT3B0aW9u55qE5YiX5a+56LGhXHJcbiAgICBjb25zdCBiaW5kaW5nRGF0YSA9IHRoaXMudmlld01vZGVsLmJpbmRpbmdEYXRhO1xyXG4gICAgY29uc3QgZmllbGRQYXRocyA9IHRoaXMuZ2V0RmllbGRQYXRocyhiaW5kaW5nRGF0YS5iaW5kaW5nUGF0aCwgY29sdW1uLmRhdGFGaWVsZCk7XHJcbiAgICAvLyDlrZjlnKjooYznvJbovpHlmahcclxuICAgIGlmIChjdXJyZW50Q29sdW1uVHlwZSA9PT0gJ2RhdGUnKSB7XHJcbiAgICAgIGxldCBkYXRlU3RyID0gdGhpcy5kYXRlU2VydmljZS5mb3JtYXRUbyh2YWx1ZSwgJ3l5eXktTU0tZGQgSEg6bW06c3MnKTtcclxuICAgICAgaWYgKCFkYXRlU3RyKSB7XHJcbiAgICAgICAgZGF0ZVN0ciA9ICcnO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMudmlld01vZGVsLmJpbmRpbmdEYXRhLnNldFZhbHVlKGZpZWxkUGF0aHMsIGRhdGVTdHIsIHRydWUsIHRydWUpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy52aWV3TW9kZWwuYmluZGluZ0RhdGEuc2V0VmFsdWUoZmllbGRQYXRocywgdmFsdWUsIHRydWUsIHRydWUpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyog5YiG57uE5pe2IOiOt+WPlueCueWHu+ihjOaVsOaNriAqL1xyXG4gIGdldEdyb3VwSXRlbShkYXRhOiBhbnlbXSwgcm93TnVtYmVyOiBudW1iZXIpIHtcclxuICAgIGxldCBpbmRleCA9IHJvd051bWJlcjtcclxuICAgIGZvciAoY29uc3QgaSBpbiBkYXRhKSB7XHJcbiAgICAgIGlmIChpbmRleCA8IGRhdGFbaV0uaXRlbXMubGVuZ3RoKSB7XHJcbiAgICAgICAgcmV0dXJuIGRhdGFbaV0uaXRlbXNbaW5kZXhdO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGluZGV4ID0gaW5kZXggLSBkYXRhW2ldLml0ZW1zLmxlbmd0aDtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLypcclxuICAgKiDojrflj5Yg5Y2V5YWD5qC85YC8ICDkuLvku47ooajmlK/mjIFcclxuICAgKiBAcGFyYW0gZGF0YUl0ZW0g6KGM5pWw5o2uXHJcbiAgICogQHBhcmFtIGZpZWxkIOWtl+autVxyXG4gICAqL1xyXG4gIGdldFZhbHVlKGRhdGFJdGVtOiBhbnksIGZpZWxkOiBzdHJpbmcpIHtcclxuICAgIGNvbnN0IGluZGV4ID0gZmllbGQuaW5kZXhPZignLicpO1xyXG4gICAgaWYgKGluZGV4IDwgMCkge1xyXG4gICAgICByZXR1cm4gZGF0YUl0ZW1bZmllbGRdO1xyXG4gICAgfVxyXG4gICAgY29uc3QgZmllbGRzID0gZmllbGQuc3BsaXQoJy4nKTtcclxuICAgIC8vIGZpZWxk5a2X56ym5Liy57uE5ZCIXHJcbiAgICByZXR1cm4gZmllbGRzLnJlZHVjZSgocmVzdWx0OiBhbnksIG5leHQ6IGFueSkgPT4ge1xyXG4gICAgICByZXR1cm4gcmVzdWx0W25leHRdO1xyXG4gICAgfSwgZGF0YUl0ZW0pO1xyXG4gIH1cclxuXHJcbiAgLypcclxuICAqIOiOt+WPliBiaW5kaW5nRGF0YSDot6/lvoRcclxuICAqIEBwYXJhbSBiaW5kaW5nUGF0aCDlvZPliY3nu5HlrprnmoTlrZfmrrXot6/lvoRcclxuICAqIEBwYXJhbSBmaWVsZE5hbWUg5a2X5q61XHJcbiAgKi9cclxuICBwcml2YXRlIGdldEZpZWxkUGF0aHMoYmluZGluZ1BhdGg6IHN0cmluZywgZmllbGQ6IHN0cmluZyk6IHN0cmluZ1tdIHtcclxuICAgIGxldCBmaWVsZFBhdGggPSAnJztcclxuICAgIGlmIChiaW5kaW5nUGF0aC5sZW5ndGggPiAxKSB7XHJcbiAgICAgIGZpZWxkUGF0aCA9IGJpbmRpbmdQYXRoLnN1YnN0cigxKS5yZXBsYWNlKC9cXC8vZywgJy4nKSArICcuJyArIGZpZWxkO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgZmllbGRQYXRoID0gZmllbGQ7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZmllbGRQYXRoLnNwbGl0KCcuJyk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlm57ovabov5vlhaXkuIvkuIDkuKrljZXlhYPmoLxcclxuICAgKi9cclxuICBlbnRlck5leHRDZWxsKCkge1xyXG4gICAgY29uc3QgaW5kZXggPSB0aGlzLnVwZGF0ZUluZGV4KHRoaXMucm93SW5kZXgsIHRoaXMuY29sdW1uSW5kZXgpO1xyXG4gICAgaWYgKCFpbmRleC5jb2x1bW5JbmRleCAmJiAhaW5kZXgucm93SW5kZXgpIHtcclxuICAgICAgY29uc3QgbGVuID0gdGhpcy5iaW5kaW5nTGlzdC50b0pTT04oKS5sZW5ndGg7XHJcbiAgICAgIC8vIOWmguaenOWtmOWcqOa3u+WKoOaVsOaNrueahEFQSVxyXG4gICAgICB0aGlzLmFwcGVuZFJvdy5lbWl0KCk7XHJcbiAgICAgIGlmICh0aGlzLmFwcGVuZFJvdy5vYnNlcnZlcnMgJiYgdGhpcy5hcHBlbmRSb3cub2JzZXJ2ZXJzLmxlbmd0aCkge1xyXG4gICAgICAgIHRoaXMuaW50ZXJWYWwgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XHJcbiAgICAgICAgICBpZiAodGhpcy5iaW5kaW5nTGlzdC50b0pTT04oKS5sZW5ndGggLSAxID09PSBsZW4pIHtcclxuICAgICAgICAgICAgdGhpcy5zZXRFZGl0YWJsZSh0aGlzLmJpbmRpbmdMaXN0LnRvSlNPTigpLmxlbmd0aCAtIDEsIDApO1xyXG4gICAgICAgICAgICB0aGlzLnJvd0luZGV4ID0gdGhpcy5iaW5kaW5nTGlzdC50b0pTT04oKS5sZW5ndGggLSAxO1xyXG4gICAgICAgICAgICB0aGlzLmNvbHVtbkluZGV4ID0gMDtcclxuICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmludGVyVmFsKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9LCAwKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB0aGlzLnNldEVkaXRhYmxlKGluZGV4LnJvd0luZGV4LCBpbmRleC5jb2x1bW5JbmRleCk7XHJcbiAgICB0aGlzLnJvd0luZGV4ID0gaW5kZXgucm93SW5kZXg7XHJcbiAgICB0aGlzLmNvbHVtbkluZGV4ID0gaW5kZXguY29sdW1uSW5kZXg7XHJcbiAgfVxyXG5cclxuICAvKiDojrflj5bnnJ/mraPnmoTliJflr7nosaEgKi9cclxuICBnZXRDb2x1bW5zKGNvbHVtbnM6IGFueSkge1xyXG4gICAgLy8g5Yik5pat5piv5ZCm5a2Y5Zyo5Zu65a6a5YiXXHJcbiAgICBjb25zdCBoYXNMb2NrZWQgPSBjb2x1bW5zLnNvbWUoKGVsZTogYW55KSA9PiB7XHJcbiAgICAgIHJldHVybiBlbGUuZnJvemVuO1xyXG4gICAgfSk7XHJcbiAgICBpZiAoaGFzTG9ja2VkKSB7XHJcbiAgICAgIGNvbnN0IGxvY2tlZENvbHVtbnMgPSBjb2x1bW5zLmZpbHRlcigoZWxlOiBhbnkpID0+IHtcclxuICAgICAgICByZXR1cm4gZWxlLmZyb3plbjtcclxuICAgICAgfSk7XHJcbiAgICAgIGNvbnN0IG5vdExvY2tlZENvbHVtbnMgPSBjb2x1bW5zLmZpbHRlcigoZWxlOiBhbnkpID0+IHtcclxuICAgICAgICByZXR1cm4gIWVsZS5mcm96ZW47XHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm4gWy4uLmxvY2tlZENvbHVtbnMsIC4uLm5vdExvY2tlZENvbHVtbnNdO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGNvbHVtbnM7XHJcbiAgfVxyXG5cclxuICAvKlxyXG4gICAqIOa4suafk+aMh+WumuihjOS4uumAieS4reihjO+8muWwhuaMh+WumuihjOeahGtleea3u+WKoOWIsOmAieS4reihjOmbhuWQiOS4rVxyXG4gICAqL1xyXG4gIHByaXZhdGUgcmVuZGVyU2VsZWN0aW9uUm93KGtleTogc3RyaW5nLCBzZWxlY3RlZEtleXM6IGFueVtdKSB7XHJcbiAgICBpZiAoIWtleSB8fCBrZXkgPT09ICcnKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICAvLyBUT0RPOuS9v+eUqOetlueVpeaooeW8j+mHjeaehFxyXG4gICAgaWYgKHRoaXMuSXNNdWx0aXBsZVNlbGVjdGlvbk1vZGUpIHtcclxuICAgICAgY29uc3QgaW5kZXggPSBzZWxlY3RlZEtleXMuaW5kZXhPZihrZXkpO1xyXG4gICAgICBpZiAoaW5kZXggPj0gMCkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG5cclxuICAgICAgc2VsZWN0ZWRLZXlzLnB1c2goa2V5KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGlmIChzZWxlY3RlZEtleXMubGVuZ3RoID09PSAxICYmIHNlbGVjdGVkS2V5c1swXSA9PT0ga2V5KSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBzZWxlY3RlZEtleXMuc3BsaWNlKDAsIHNlbGVjdGVkS2V5cy5sZW5ndGgpO1xyXG4gICAgICBzZWxlY3RlZEtleXMucHVzaChrZXkpO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuc2VsZWN0aW9uRGlyLnNlbGVjdGVkS2V5c0NoYW5nZS5lbWl0KHNlbGVjdGVkS2V5cyk7IC8vIOaJi+WKqOinpuWPkXNlbGVjdGVkS2V5c0NoYW5nZeS6i+S7tlxyXG4gIH1cclxuXHJcbiAgLypcclxuICAgKiDojrflj5ZHcmlk5LiK55qE5b2T5YmN6KGM5YaF56CBXHJcbiAgICogQHBhcmFtIGRhdGFJdGVtIOihjOaVsOaNrlxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0U2VsZWN0ZWRJZEZyb21HcmlkKGRhdGFJdGVtOiBhbnkpIHtcclxuICAgIGNvbnN0IHByaW1hcnlLZXkgPSB0aGlzLmJpbmRpbmdMaXN0LnByaW1hcnlLZXk7XHJcbiAgICByZXR1cm4gZGF0YUl0ZW1bcHJpbWFyeUtleV07XHJcbiAgfVxyXG5cclxuICAvKlxyXG4gICAqIOiuvue9rkJpbmRpbmdMaXN055qE5b2T5YmN6KGMXHJcbiAgICogQHBhcmFtIGlkIOW9k+WJjeihjOWGheeggVxyXG4gICAqL1xyXG4gIHByaXZhdGUgc2V0U2VsZWN0aW9uSWRUb0JpbmRpbmdEYXRhKGlkOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgIHRoaXMuYmluZGluZ0xpc3Quc2V0Q3VycmVudElkKGlkLCB0cnVlKTtcclxuICB9XHJcblxyXG4gIC8qXHJcbiAgKuWIl+ihqOaVtOS9k+aYr+WQpuWPr+e8lui+kVxyXG4gICAqL1xyXG4gIGlzRWRpdGFibGUoKSB7XHJcbiAgICBpZiAodGhpcy5lZGl0YWJsZSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIGlmICghdGhpcy52aWV3TW9kZWwuc3RhdGVNYWNoaW5lKSB7XHJcbiAgICAgICAgLy8g54q25oCB5py65LiN5a2Y5Zyo55qE5pe25YCZXHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICAgIC8vIOeKtuaAgeacuuWtmOWcqOeahOaXtuWAmVxyXG4gICAgICByZXR1cm4gdGhpcy52aWV3TW9kZWwuc3RhdGVNYWNoaW5lWydlZGl0YWJsZSddO1xyXG4gICAgfVxyXG4gICAgLy8g6Ieq5a6a5LmJ6LWL5YC8XHJcbiAgICByZXR1cm4gdGhpcy5lZGl0YWJsZTtcclxuICB9XHJcbiAgLyogICovXHJcbiAgaXNEYXRhQ2hhbmdlZCgpIHtcclxuICAgIGxldCBoYXNVbnNhdmVkRGF0YSA9IGZhbHNlO1xyXG4gICAgY29uc3QgZW50aXR5QXJyYXkgPSB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLnRvQXJyYXkoKTtcclxuICAgIGZvciAoY29uc3QgZW50aXR5IG9mIGVudGl0eUFycmF5KSB7XHJcbiAgICAgIGlmIChlbnRpdHkuY2hhbmdlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgaGFzVW5zYXZlZERhdGEgPSB0cnVlO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gaGFzVW5zYXZlZERhdGE7XHJcbiAgfVxyXG59XHJcbiJdfQ==