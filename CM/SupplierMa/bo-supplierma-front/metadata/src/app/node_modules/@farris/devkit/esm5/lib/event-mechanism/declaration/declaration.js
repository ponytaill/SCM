import { Injectable } from '@angular/core';
import { MetadataUtil } from '../../metadata/index';
import { NG_DECLARATION } from './declaration_decorator';
import { VariableParseService } from '../../variable/index';
import { EventTypeEnum } from './event-type';
var Declaration = /** @class */ (function () {
    function Declaration() {
    }
    /**
     * 初始化
     */
    Declaration.prototype.init = function (frameComponent) {
        if (!frameComponent) {
            return;
        }
        this.bindDeclaration(frameComponent, null);
    };
    /**
     *  依据定义列表进行初始化
     * @param frameComponent 表单component实例
     * @param ngDeclarations 事件定义列表信息
     */
    Declaration.prototype.initWithDeclarations = function (frameComponent, ngDeclarations) {
        if (!frameComponent) {
            return;
        }
        this.bindDeclaration(frameComponent, null);
    };
    /**
     * 基于事件元数据构建事件
     * @param context 框架上下文
     */
    Declaration.prototype.bindDeclaration = function (frameComponent, ngDeclarations) {
        var _this = this;
        var context = frameComponent.context;
        if (!context) {
            return;
        }
        var ngPublicEventProps = ngDeclarations ? ngDeclarations : this.getNgPublicEvent();
        if (!ngPublicEventProps) {
            return;
        }
        Object.keys(ngPublicEventProps).forEach(function (propertyName) {
            var ngExportEvent = ngPublicEventProps[propertyName];
            Object.defineProperty(_this, propertyName, {
                value: function () {
                    // 获取命令处理上下文
                    var targetContext = context;
                    // todo: 给ngExportEvent添加frameId（保证框架之间的事件隔离）
                    // if (ngExportEvent.frameId) {
                    //   targetContext = context.appContext.getFrameContext(ngExportEvent.frameId);
                    // }
                    var emitter = ngExportEvent.token;
                    var tokenValue = ngExportEvent.token;
                    var eventName = ngExportEvent.name;
                    var eventArgs = JSON.parse(JSON.stringify(ngExportEvent.params));
                    var eventType = ngExportEvent.type;
                    if (!targetContext.eventBus) {
                        return;
                    }
                    var injector = targetContext.injector;
                    var variableParseService = injector.get(VariableParseService);
                    // 执行参数解析
                    setTimeout(function () {
                        eventArgs = variableParseService.parse(eventArgs, targetContext);
                        var eventSender = targetContext.frameComponent;
                        var currentContext = targetContext;
                        var eventId = new Date().valueOf();
                        if (eventType && eventType === EventTypeEnum.ROUTE) {
                            // 事件依次向上冒泡
                            while (currentContext) {
                                currentContext.eventBus.post(emitter, tokenValue, eventName, eventArgs, eventSender, eventType, eventId);
                                // currentContext = currentContext.parent;
                                currentContext = _this.getParentContext(currentContext);
                            }
                        }
                        else {
                            currentContext.eventBus.post(emitter, tokenValue, eventName, eventArgs, eventSender);
                        }
                    }, 0);
                }
            });
        });
    };
    /**
     * 获取事件定义列表
     * @returns  事件定义
     */
    Declaration.prototype.getNgPublicEvent = function () {
        return MetadataUtil.getPropsMetadatasByName(this.constructor, NG_DECLARATION);
    };
    /**
     * 获取父Context
     * @param context 当前上下文
     */
    Declaration.prototype.getParentContext = function (context) {
        // 首先查找直接上级FrameContext
        if (context.parent) {
            return context.parent;
        }
        // 到了AppContext边界，返回上级AppContext的根FrameContext
        var parentAppContext = context.appContext.parent;
        if (parentAppContext) {
            return parentAppContext.frameContextManager.getRootFrameContext();
        }
        return null;
    };
    Declaration.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    Declaration.ctorParameters = function () { return []; };
    return Declaration;
}());
export { Declaration };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVjbGFyYXRpb24uanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2RldmtpdC8iLCJzb3VyY2VzIjpbImxpYi9ldmVudC1tZWNoYW5pc20vZGVjbGFyYXRpb24vZGVjbGFyYXRpb24udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFVBQVUsRUFBWSxNQUFNLGVBQWUsQ0FBQztBQUNyRCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFFcEQsT0FBTyxFQUFFLGNBQWMsRUFBaUIsTUFBTSx5QkFBeUIsQ0FBQztBQUN4RSxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUM1RCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sY0FBYyxDQUFDO0FBRTdDO0lBR0U7SUFFQSxDQUFDO0lBRUQ7O09BRUc7SUFDSSwwQkFBSSxHQUFYLFVBQVksY0FBOEI7UUFDeEMsSUFBSSxDQUFDLGNBQWMsRUFBRTtZQUNuQixPQUFPO1NBQ1I7UUFFRCxJQUFJLENBQUMsZUFBZSxDQUFDLGNBQWMsRUFBRSxJQUFJLENBQUMsQ0FBQztJQUM3QyxDQUFDO0lBRUQ7Ozs7T0FJRztJQUNJLDBDQUFvQixHQUEzQixVQUE0QixjQUE4QixFQUFFLGNBRTNEO1FBQ0MsSUFBSSxDQUFDLGNBQWMsRUFBRTtZQUNuQixPQUFPO1NBQ1I7UUFFRCxJQUFJLENBQUMsZUFBZSxDQUFDLGNBQWMsRUFBRSxJQUFJLENBQUMsQ0FBQztJQUM3QyxDQUFDO0lBRUQ7OztPQUdHO0lBQ0sscUNBQWUsR0FBdkIsVUFBd0IsY0FBOEIsRUFBRSxjQUV2RDtRQUZELGlCQTJEQztRQXhEQyxJQUFNLE9BQU8sR0FBRyxjQUFjLENBQUMsT0FBTyxDQUFDO1FBQ3ZDLElBQUksQ0FBQyxPQUFPLEVBQUU7WUFDWixPQUFPO1NBQ1I7UUFFRCxJQUFNLGtCQUFrQixHQUFHLGNBQWMsQ0FBQyxDQUFDLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztRQUNyRixJQUFJLENBQUMsa0JBQWtCLEVBQUU7WUFDdkIsT0FBTztTQUNSO1FBRUQsTUFBTSxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxVQUFDLFlBQW9CO1lBQzNELElBQU0sYUFBYSxHQUFrQixrQkFBa0IsQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUN0RSxNQUFNLENBQUMsY0FBYyxDQUFDLEtBQUksRUFBRSxZQUFZLEVBQUU7Z0JBQ3hDLEtBQUssRUFBRTtvQkFFTCxZQUFZO29CQUNaLElBQU0sYUFBYSxHQUFpQixPQUFPLENBQUM7b0JBRTVDLDZDQUE2QztvQkFDN0MsK0JBQStCO29CQUMvQiwrRUFBK0U7b0JBQy9FLElBQUk7b0JBRUosSUFBTSxPQUFPLEdBQUcsYUFBYSxDQUFDLEtBQUssQ0FBQztvQkFDcEMsSUFBTSxVQUFVLEdBQUcsYUFBYSxDQUFDLEtBQUssQ0FBQztvQkFDdkMsSUFBTSxTQUFTLEdBQUcsYUFBYSxDQUFDLElBQUksQ0FBQztvQkFDckMsSUFBSSxTQUFTLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO29CQUNqRSxJQUFNLFNBQVMsR0FBRyxhQUFhLENBQUMsSUFBSSxDQUFDO29CQUVyQyxJQUFJLENBQUMsYUFBYSxDQUFDLFFBQVEsRUFBRTt3QkFDM0IsT0FBTztxQkFDUjtvQkFDRCxJQUFNLFFBQVEsR0FBRyxhQUFhLENBQUMsUUFBUSxDQUFDO29CQUN4QyxJQUFNLG9CQUFvQixHQUFHLFFBQVEsQ0FBQyxHQUFHLENBQXVCLG9CQUFvQixDQUFDLENBQUM7b0JBRXRGLFNBQVM7b0JBQ1QsVUFBVSxDQUFDO3dCQUNULFNBQVMsR0FBRyxvQkFBb0IsQ0FBQyxLQUFLLENBQUMsU0FBUyxFQUFFLGFBQWEsQ0FBQyxDQUFDO3dCQUNqRSxJQUFNLFdBQVcsR0FBRyxhQUFhLENBQUMsY0FBYyxDQUFDO3dCQUNqRCxJQUFJLGNBQWMsR0FBRyxhQUFhLENBQUM7d0JBQ25DLElBQU0sT0FBTyxHQUFHLElBQUksSUFBSSxFQUFFLENBQUMsT0FBTyxFQUFFLENBQUM7d0JBQ3JDLElBQUksU0FBUyxJQUFJLFNBQVMsS0FBSyxhQUFhLENBQUMsS0FBSyxFQUFFOzRCQUNsRCxXQUFXOzRCQUNYLE9BQU8sY0FBYyxFQUFFO2dDQUNyQixjQUFjLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsVUFBVSxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsV0FBVyxFQUFFLFNBQVMsRUFBRSxPQUFPLENBQUMsQ0FBQztnQ0FDekcsMENBQTBDO2dDQUMxQyxjQUFjLEdBQUcsS0FBSSxDQUFDLGdCQUFnQixDQUFDLGNBQWMsQ0FBQyxDQUFDOzZCQUN4RDt5QkFDRjs2QkFBTTs0QkFDTCxjQUFjLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsVUFBVSxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsV0FBVyxDQUFDLENBQUM7eUJBQ3RGO29CQUNILENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztnQkFDUixDQUFDO2FBQ0YsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFTCxDQUFDO0lBRUQ7OztPQUdHO0lBQ0ksc0NBQWdCLEdBQXZCO1FBQ0UsT0FBTyxZQUFZLENBQUMsdUJBQXVCLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxjQUFjLENBQUMsQ0FBQztJQUNoRixDQUFDO0lBRUQ7OztPQUdHO0lBQ0ssc0NBQWdCLEdBQXhCLFVBQXlCLE9BQXFCO1FBRTVDLHVCQUF1QjtRQUN2QixJQUFJLE9BQU8sQ0FBQyxNQUFNLEVBQUU7WUFDbEIsT0FBTyxPQUFPLENBQUMsTUFBTSxDQUFDO1NBQ3ZCO1FBRUQsOENBQThDO1FBQzlDLElBQU0sZ0JBQWdCLEdBQUcsT0FBTyxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUM7UUFDbkQsSUFBSSxnQkFBZ0IsRUFBRTtZQUNwQixPQUFPLGdCQUFnQixDQUFDLG1CQUFtQixDQUFDLG1CQUFtQixFQUFFLENBQUM7U0FDbkU7UUFFRCxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7O2dCQTVIRixVQUFVOzs7O0lBNkhYLGtCQUFDO0NBQUEsQUE3SEQsSUE2SEM7QUFFRCxPQUFPLEVBQUUsV0FBVyxFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlLCBJbmplY3RvciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBNZXRhZGF0YVV0aWwgfSBmcm9tICcuLi8uLi9tZXRhZGF0YS9pbmRleCc7XHJcbmltcG9ydCB7IEZyYW1lQ29udGV4dCwgRnJhbWVDb21wb25lbnQgfSBmcm9tICcuLi8uLi9mcmFtZSc7XHJcbmltcG9ydCB7IE5HX0RFQ0xBUkFUSU9OLCBOZ0RlY2xhcmF0aW9uIH0gZnJvbSAnLi9kZWNsYXJhdGlvbl9kZWNvcmF0b3InO1xyXG5pbXBvcnQgeyBWYXJpYWJsZVBhcnNlU2VydmljZSB9IGZyb20gJy4uLy4uL3ZhcmlhYmxlL2luZGV4JztcclxuaW1wb3J0IHsgRXZlbnRUeXBlRW51bSB9IGZyb20gJy4vZXZlbnQtdHlwZSc7XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmNsYXNzIERlY2xhcmF0aW9uIHtcclxuXHJcbiAgY29uc3RydWN0b3IoKSB7XHJcblxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Yid5aeL5YyWXHJcbiAgICovXHJcbiAgcHVibGljIGluaXQoZnJhbWVDb21wb25lbnQ6IEZyYW1lQ29tcG9uZW50KSB7XHJcbiAgICBpZiAoIWZyYW1lQ29tcG9uZW50KSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmJpbmREZWNsYXJhdGlvbihmcmFtZUNvbXBvbmVudCwgbnVsbCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiAg5L6d5o2u5a6a5LmJ5YiX6KGo6L+b6KGM5Yid5aeL5YyWXHJcbiAgICogQHBhcmFtIGZyYW1lQ29tcG9uZW50IOihqOWNlWNvbXBvbmVudOWunuS+i1xyXG4gICAqIEBwYXJhbSBuZ0RlY2xhcmF0aW9ucyDkuovku7blrprkuYnliJfooajkv6Hmga9cclxuICAgKi9cclxuICBwdWJsaWMgaW5pdFdpdGhEZWNsYXJhdGlvbnMoZnJhbWVDb21wb25lbnQ6IEZyYW1lQ29tcG9uZW50LCBuZ0RlY2xhcmF0aW9uczoge1xyXG4gICAgW3Byb3BOYW1lOiBzdHJpbmddOiBhbnk7XHJcbiAgfSk6IHZvaWQge1xyXG4gICAgaWYgKCFmcmFtZUNvbXBvbmVudCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5iaW5kRGVjbGFyYXRpb24oZnJhbWVDb21wb25lbnQsIG51bGwpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Z+65LqO5LqL5Lu25YWD5pWw5o2u5p6E5bu65LqL5Lu2XHJcbiAgICogQHBhcmFtIGNvbnRleHQg5qGG5p625LiK5LiL5paHXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBiaW5kRGVjbGFyYXRpb24oZnJhbWVDb21wb25lbnQ6IEZyYW1lQ29tcG9uZW50LCBuZ0RlY2xhcmF0aW9uczoge1xyXG4gICAgW3Byb3BOYW1lOiBzdHJpbmddOiBhbnk7XHJcbiAgfSkge1xyXG4gICAgY29uc3QgY29udGV4dCA9IGZyYW1lQ29tcG9uZW50LmNvbnRleHQ7XHJcbiAgICBpZiAoIWNvbnRleHQpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IG5nUHVibGljRXZlbnRQcm9wcyA9IG5nRGVjbGFyYXRpb25zID8gbmdEZWNsYXJhdGlvbnMgOiB0aGlzLmdldE5nUHVibGljRXZlbnQoKTtcclxuICAgIGlmICghbmdQdWJsaWNFdmVudFByb3BzKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBPYmplY3Qua2V5cyhuZ1B1YmxpY0V2ZW50UHJvcHMpLmZvckVhY2goKHByb3BlcnR5TmFtZTogc3RyaW5nKSA9PiB7XHJcbiAgICAgIGNvbnN0IG5nRXhwb3J0RXZlbnQ6IE5nRGVjbGFyYXRpb24gPSBuZ1B1YmxpY0V2ZW50UHJvcHNbcHJvcGVydHlOYW1lXTtcclxuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIHByb3BlcnR5TmFtZSwge1xyXG4gICAgICAgIHZhbHVlOiAoKSA9PiB7XHJcblxyXG4gICAgICAgICAgLy8g6I635Y+W5ZG95Luk5aSE55CG5LiK5LiL5paHXHJcbiAgICAgICAgICBjb25zdCB0YXJnZXRDb250ZXh0OiBGcmFtZUNvbnRleHQgPSBjb250ZXh0O1xyXG5cclxuICAgICAgICAgIC8vIHRvZG86IOe7mW5nRXhwb3J0RXZlbnTmt7vliqBmcmFtZUlk77yI5L+d6K+B5qGG5p625LmL6Ze055qE5LqL5Lu26ZqU56a777yJXHJcbiAgICAgICAgICAvLyBpZiAobmdFeHBvcnRFdmVudC5mcmFtZUlkKSB7XHJcbiAgICAgICAgICAvLyAgIHRhcmdldENvbnRleHQgPSBjb250ZXh0LmFwcENvbnRleHQuZ2V0RnJhbWVDb250ZXh0KG5nRXhwb3J0RXZlbnQuZnJhbWVJZCk7XHJcbiAgICAgICAgICAvLyB9XHJcblxyXG4gICAgICAgICAgY29uc3QgZW1pdHRlciA9IG5nRXhwb3J0RXZlbnQudG9rZW47XHJcbiAgICAgICAgICBjb25zdCB0b2tlblZhbHVlID0gbmdFeHBvcnRFdmVudC50b2tlbjtcclxuICAgICAgICAgIGNvbnN0IGV2ZW50TmFtZSA9IG5nRXhwb3J0RXZlbnQubmFtZTtcclxuICAgICAgICAgIGxldCBldmVudEFyZ3MgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KG5nRXhwb3J0RXZlbnQucGFyYW1zKSk7XHJcbiAgICAgICAgICBjb25zdCBldmVudFR5cGUgPSBuZ0V4cG9ydEV2ZW50LnR5cGU7XHJcblxyXG4gICAgICAgICAgaWYgKCF0YXJnZXRDb250ZXh0LmV2ZW50QnVzKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGNvbnN0IGluamVjdG9yID0gdGFyZ2V0Q29udGV4dC5pbmplY3RvcjtcclxuICAgICAgICAgIGNvbnN0IHZhcmlhYmxlUGFyc2VTZXJ2aWNlID0gaW5qZWN0b3IuZ2V0PFZhcmlhYmxlUGFyc2VTZXJ2aWNlPihWYXJpYWJsZVBhcnNlU2VydmljZSk7XHJcblxyXG4gICAgICAgICAgLy8g5omn6KGM5Y+C5pWw6Kej5p6QXHJcbiAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgZXZlbnRBcmdzID0gdmFyaWFibGVQYXJzZVNlcnZpY2UucGFyc2UoZXZlbnRBcmdzLCB0YXJnZXRDb250ZXh0KTtcclxuICAgICAgICAgICAgY29uc3QgZXZlbnRTZW5kZXIgPSB0YXJnZXRDb250ZXh0LmZyYW1lQ29tcG9uZW50O1xyXG4gICAgICAgICAgICBsZXQgY3VycmVudENvbnRleHQgPSB0YXJnZXRDb250ZXh0O1xyXG4gICAgICAgICAgICBjb25zdCBldmVudElkID0gbmV3IERhdGUoKS52YWx1ZU9mKCk7XHJcbiAgICAgICAgICAgIGlmIChldmVudFR5cGUgJiYgZXZlbnRUeXBlID09PSBFdmVudFR5cGVFbnVtLlJPVVRFKSB7XHJcbiAgICAgICAgICAgICAgLy8g5LqL5Lu25L6d5qyh5ZCR5LiK5YaS5rOhXHJcbiAgICAgICAgICAgICAgd2hpbGUgKGN1cnJlbnRDb250ZXh0KSB7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50Q29udGV4dC5ldmVudEJ1cy5wb3N0KGVtaXR0ZXIsIHRva2VuVmFsdWUsIGV2ZW50TmFtZSwgZXZlbnRBcmdzLCBldmVudFNlbmRlciwgZXZlbnRUeXBlLCBldmVudElkKTtcclxuICAgICAgICAgICAgICAgIC8vIGN1cnJlbnRDb250ZXh0ID0gY3VycmVudENvbnRleHQucGFyZW50O1xyXG4gICAgICAgICAgICAgICAgY3VycmVudENvbnRleHQgPSB0aGlzLmdldFBhcmVudENvbnRleHQoY3VycmVudENvbnRleHQpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICBjdXJyZW50Q29udGV4dC5ldmVudEJ1cy5wb3N0KGVtaXR0ZXIsIHRva2VuVmFsdWUsIGV2ZW50TmFtZSwgZXZlbnRBcmdzLCBldmVudFNlbmRlcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0sIDApO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDojrflj5bkuovku7blrprkuYnliJfooahcclxuICAgKiBAcmV0dXJucyAg5LqL5Lu25a6a5LmJXHJcbiAgICovXHJcbiAgcHVibGljIGdldE5nUHVibGljRXZlbnQoKSB7XHJcbiAgICByZXR1cm4gTWV0YWRhdGFVdGlsLmdldFByb3BzTWV0YWRhdGFzQnlOYW1lKHRoaXMuY29uc3RydWN0b3IsIE5HX0RFQ0xBUkFUSU9OKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiOt+WPlueItkNvbnRleHRcclxuICAgKiBAcGFyYW0gY29udGV4dCDlvZPliY3kuIrkuIvmlodcclxuICAgKi9cclxuICBwcml2YXRlIGdldFBhcmVudENvbnRleHQoY29udGV4dDogRnJhbWVDb250ZXh0KTogRnJhbWVDb250ZXh0IHtcclxuXHJcbiAgICAvLyDpppblhYjmn6Xmib7nm7TmjqXkuIrnuqdGcmFtZUNvbnRleHRcclxuICAgIGlmIChjb250ZXh0LnBhcmVudCkge1xyXG4gICAgICByZXR1cm4gY29udGV4dC5wYXJlbnQ7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5Yiw5LqGQXBwQ29udGV4dOi+ueeVjO+8jOi/lOWbnuS4iue6p0FwcENvbnRleHTnmoTmoLlGcmFtZUNvbnRleHRcclxuICAgIGNvbnN0IHBhcmVudEFwcENvbnRleHQgPSBjb250ZXh0LmFwcENvbnRleHQucGFyZW50O1xyXG4gICAgaWYgKHBhcmVudEFwcENvbnRleHQpIHtcclxuICAgICAgcmV0dXJuIHBhcmVudEFwcENvbnRleHQuZnJhbWVDb250ZXh0TWFuYWdlci5nZXRSb290RnJhbWVDb250ZXh0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgeyBEZWNsYXJhdGlvbiB9O1xyXG4iXX0=