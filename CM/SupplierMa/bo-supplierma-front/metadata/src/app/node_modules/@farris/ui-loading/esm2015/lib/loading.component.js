/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Subject, BehaviorSubject } from 'rxjs';
/*
 * @Author: 疯狂秀才(Lucas Huang)
 * @LastEditors: 疯狂秀才(Lucas Huang)
 * @Company: Inspur
 * @Version: v0.1.8
 * @Date: 2018-09-18 16:04:05
 * @LastEditTime: 2019-10-17 13:42:45
 */
import { Component, ElementRef, ViewChild, Renderer2, Output, EventEmitter, Input } from '@angular/core';
import { LOADING_STYLES } from './loading.styles';
import { delay, filter, takeUntil } from 'rxjs/operators';
export class LoadingComponent {
    /**
     * @param {?} render
     * @param {?} el
     */
    constructor(render, el) {
        this.render = render;
        this.el = el;
        this.showMessage = true;
        this.loadingStyleDom = LOADING_STYLES;
        this._isActive = false;
        this.activeSubject = new BehaviorSubject(false);
        this.message = '';
        this.width = 30;
        /**
         * loading 样式
         */
        this.type = 0;
        this.delay = 300;
        this.closed = new EventEmitter();
        this.activedSubscrition = null;
        this.destroy$ = new Subject();
    }
    /**
     * @return {?}
     */
    get isActive() {
        return this._isActive;
    }
    /**
     * @param {?} val
     * @return {?}
     */
    set isActive(val) {
        this._isActive = val;
        if (this.activeSubject) {
            this.activeSubject.next(val);
        }
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.activedSubscrition = this.activeSubject.pipe(takeUntil(this.destroy$)).pipe(filter((/**
         * @param {?} n
         * @return {?}
         */
        (n) => {
            return n;
        })), delay(this.delay)).subscribe((/**
         * @param {?} v
         * @return {?}
         */
        v => {
            if (v && this.isActive) {
                // this.animate('f-component-loading fadeIn animated');
                this.render.setStyle(this.loadingContainerEl.nativeElement, 'display', 'block');
                this.render.setStyle(this.loadingBackdrop.nativeElement, 'display', 'block');
                this.setPosition();
            }
        }));
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.destroy$.next();
        this.destroy$.complete();
        // this.activeSubject.complete();
        // this.activeSubject = null;
        // this.activedSubscrition.unsubscribe();
    }
    /**
     * @return {?}
     */
    close() {
        // if (this.loadingBackdrop.nativeElement.parentElement) {
        //     this.render.removeChild(this.el.nativeElement, this.loadingBackdrop.nativeElement);
        // }
        // const waitEle = document.body.querySelector('.farris-loading-backdrop');
        if (this.loadingBackdrop) {
            this.loadingBackdrop.nativeElement.remove();
        }
        this.isActive = false;
        this.render.removeAttribute(this.el.nativeElement, 'class');
        // this.animate('f-component-loading fadeOut animated animated-0.5');
        this.closed.emit(this.isActive);
    }
    /**
     * @private
     * @return {?}
     */
    setPosition() {
        /** @type {?} */
        const containerWidth = this.loadingContainerEl.nativeElement.clientWidth;
        /** @type {?} */
        const containerHeight = this.loadingContainerEl.nativeElement.clientHeight;
        this.render.setStyle(this.loadingContainerEl.nativeElement, 'marginTop', -containerHeight / 2 + 'px');
        this.render.setStyle(this.loadingContainerEl.nativeElement, 'marginLeft', -containerWidth / 2 + 'px');
    }
    /**
     * @private
     * @param {?} animateCls
     * @return {?}
     */
    animate(animateCls) {
        this.addAnimationEndEvent('webkitAnimationEnd', 'mozAnimationEnd', 'MSAnimationEnd', 'oanimationend', 'animationend');
        this.render.setAttribute(this.el.nativeElement, 'class', animateCls);
    }
    /**
     * @private
     * @param {...?} events
     * @return {?}
     */
    addAnimationEndEvent(...events) {
        /** @type {?} */
        const _this = this;
        events.forEach((/**
         * @param {?} e
         * @return {?}
         */
        e => {
            _this.el.nativeElement.addEventListener(e, (/**
             * @return {?}
             */
            function handler() {
                _this.el.nativeElement.removeEventListener(e, handler);
                // _this.render.removeAttribute(_this.el.nativeElement, 'class');
                ['fadeIn', 'fadeOut', 'animated', 'animated-0.5'].forEach((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => {
                    _this.render.removeClass(_this.el.nativeElement, n);
                }));
                _this.closed.emit(_this.isActive);
            }));
        }));
    }
}
LoadingComponent.decorators = [
    { type: Component, args: [{
                selector: 'farris-loading',
                template: `
        <div #loadingBackdrop class="farris-loading-backdrop loading-wait" style="display: none"></div>
        <div #loadingContainerEl class="farris-loading" style="display: none">
            <div class="ng-busy-default-wrapper">
                <div class="ng-busy-default-sign" >
                    <div [style.width]="width+ 'px'" [style.height]="width+'px'" style="display: inline-block;margin:4px;"
                                [innerHTML]="loadingStyleDom[type] | safe: 'html'"></div>
                    <div class="ng-busy-default-text" style="margin-left:0;"
                                 *ngIf="showMessage" [innerHTML]="'loading.message' | locale: '' :message | safe: 'html'"></div>
                </div>
            </div>
        </div>
    `,
                styles: [`.loading-wait {
            cursor: wait
        }
        .animated-0.5 {
            -webkit-animation-duration: 0s;
            animation-duration: 0s;
        }
        `]
            }] }
];
/** @nocollapse */
LoadingComponent.ctorParameters = () => [
    { type: Renderer2 },
    { type: ElementRef }
];
LoadingComponent.propDecorators = {
    showMessage: [{ type: Input }],
    loadingContainerEl: [{ type: ViewChild, args: ['loadingContainerEl',] }],
    loadingBackdrop: [{ type: ViewChild, args: ['loadingBackdrop',] }],
    closed: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    LoadingComponent.prototype.showMessage;
    /** @type {?} */
    LoadingComponent.prototype.loadingStyleDom;
    /** @type {?} */
    LoadingComponent.prototype.id;
    /**
     * @type {?}
     * @private
     */
    LoadingComponent.prototype._isActive;
    /**
     * @type {?}
     * @private
     */
    LoadingComponent.prototype.activeSubject;
    /** @type {?} */
    LoadingComponent.prototype.message;
    /** @type {?} */
    LoadingComponent.prototype.width;
    /**
     * loading 样式
     * @type {?}
     */
    LoadingComponent.prototype.type;
    /** @type {?} */
    LoadingComponent.prototype.delay;
    /** @type {?} */
    LoadingComponent.prototype.loadingContainerEl;
    /** @type {?} */
    LoadingComponent.prototype.loadingBackdrop;
    /** @type {?} */
    LoadingComponent.prototype.closed;
    /** @type {?} */
    LoadingComponent.prototype.activedSubscrition;
    /**
     * @type {?}
     * @private
     */
    LoadingComponent.prototype.destroy$;
    /**
     * @type {?}
     * @private
     */
    LoadingComponent.prototype.render;
    /**
     * @type {?}
     * @private
     */
    LoadingComponent.prototype.el;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9hZGluZy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWxvYWRpbmcvIiwic291cmNlcyI6WyJsaWIvbG9hZGluZy5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBYyxPQUFPLEVBQWdCLGVBQWUsRUFBRSxNQUFNLE1BQU0sQ0FBQzs7Ozs7Ozs7O0FBVTFFLE9BQU8sRUFBRSxTQUFTLEVBQVUsVUFBVSxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQWlCLE1BQU0sRUFBRSxZQUFZLEVBQWEsS0FBSyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNJLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUNsRCxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBMkIsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUE2Qm5GLE1BQU0sT0FBTyxnQkFBZ0I7Ozs7O0lBK0J6QixZQUFvQixNQUFpQixFQUFVLEVBQWM7UUFBekMsV0FBTSxHQUFOLE1BQU0sQ0FBVztRQUFVLE9BQUUsR0FBRixFQUFFLENBQVk7UUE5QnBELGdCQUFXLEdBQUcsSUFBSSxDQUFDO1FBQzVCLG9CQUFlLEdBQUcsY0FBYyxDQUFDO1FBRXpCLGNBQVMsR0FBRyxLQUFLLENBQUM7UUFDbEIsa0JBQWEsR0FBRyxJQUFJLGVBQWUsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNuRCxZQUFPLEdBQUcsRUFBRSxDQUFDO1FBQ2IsVUFBSyxHQUFHLEVBQUUsQ0FBQzs7OztRQUVYLFNBQUksR0FBRyxDQUFDLENBQUM7UUFFVCxVQUFLLEdBQUcsR0FBRyxDQUFDO1FBZUYsV0FBTSxHQUFHLElBQUksWUFBWSxFQUFPLENBQUM7UUFDM0MsdUJBQWtCLEdBQWlCLElBQUksQ0FBQztRQUVoQyxhQUFRLEdBQUcsSUFBSSxPQUFPLEVBQUUsQ0FBQztJQUdqQyxDQUFDOzs7O0lBbkJELElBQUksUUFBUTtRQUNSLE9BQU8sSUFB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Q25ELG1DQUFhOztJQUNiLGlDQUFXOzs7OztJQUVYLGdDQUFTOztJQUVULGlDQUFZOztJQWFaLDhDQUFnRTs7SUFDaEUsMkNBQTBEOztJQUMxRCxrQ0FBMkM7O0lBQzNDLDhDQUF3Qzs7Ozs7SUFFeEMsb0NBQWlDOzs7OztJQUVyQixrQ0FBeUI7Ozs7O0lBQUUsOEJBQXNCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgT2JzZXJ2YWJsZSwgU3ViamVjdCwgU3Vic2NyaXB0aW9uLCBCZWhhdmlvclN1YmplY3QgfSBmcm9tICdyeGpzJztcclxuLypcclxuICogQEF1dGhvcjog55av54uC56eA5omNKEx1Y2FzIEh1YW5nKVxyXG4gKiBATGFzdEVkaXRvcnM6IOeWr+eLguengOaJjShMdWNhcyBIdWFuZylcclxuICogQENvbXBhbnk6IEluc3B1clxyXG4gKiBAVmVyc2lvbjogdjAuMS44XHJcbiAqIEBEYXRlOiAyMDE4LTA5LTE4IDE2OjA0OjA1XHJcbiAqIEBMYXN0RWRpdFRpbWU6IDIwMTktMTAtMTcgMTM6NDI6NDVcclxuICovXHJcblxyXG5pbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgRWxlbWVudFJlZiwgVmlld0NoaWxkLCBSZW5kZXJlcjIsIEFmdGVyVmlld0luaXQsIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBPbkRlc3Ryb3ksIElucHV0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IExPQURJTkdfU1RZTEVTIH0gZnJvbSAnLi9sb2FkaW5nLnN0eWxlcyc7XHJcbmltcG9ydCB7IGRlbGF5LCBmaWx0ZXIsIGRlYm91bmNlVGltZSwgc3dpdGNoTWFwLCB0YWtlVW50aWwgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7IG9mIH0gZnJvbSAncnhqcyc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAnZmFycmlzLWxvYWRpbmcnLFxyXG4gICAgdGVtcGxhdGU6IGBcclxuICAgICAgICA8ZGl2ICNsb2FkaW5nQmFja2Ryb3AgY2xhc3M9XCJmYXJyaXMtbG9hZGluZy1iYWNrZHJvcCBsb2FkaW5nLXdhaXRcIiBzdHlsZT1cImRpc3BsYXk6IG5vbmVcIj48L2Rpdj5cclxuICAgICAgICA8ZGl2ICNsb2FkaW5nQ29udGFpbmVyRWwgY2xhc3M9XCJmYXJyaXMtbG9hZGluZ1wiIHN0eWxlPVwiZGlzcGxheTogbm9uZVwiPlxyXG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwibmctYnVzeS1kZWZhdWx0LXdyYXBwZXJcIj5cclxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJuZy1idXN5LWRlZmF1bHQtc2lnblwiID5cclxuICAgICAgICAgICAgICAgICAgICA8ZGl2IFtzdHlsZS53aWR0aF09XCJ3aWR0aCsgJ3B4J1wiIFtzdHlsZS5oZWlnaHRdPVwid2lkdGgrJ3B4J1wiIHN0eWxlPVwiZGlzcGxheTogaW5saW5lLWJsb2NrO21hcmdpbjo0cHg7XCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbaW5uZXJIVE1MXT1cImxvYWRpbmdTdHlsZURvbVt0eXBlXSB8IHNhZmU6ICdodG1sJ1wiPjwvZGl2PlxyXG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJuZy1idXN5LWRlZmF1bHQtdGV4dFwiIHN0eWxlPVwibWFyZ2luLWxlZnQ6MDtcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqbmdJZj1cInNob3dNZXNzYWdlXCIgW2lubmVySFRNTF09XCInbG9hZGluZy5tZXNzYWdlJyB8IGxvY2FsZTogJycgOm1lc3NhZ2UgfCBzYWZlOiAnaHRtbCdcIj48L2Rpdj5cclxuICAgICAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICA8L2Rpdj5cclxuICAgIGAsXHJcbiAgICBzdHlsZXM6IFtcclxuICAgICAgICBgLmxvYWRpbmctd2FpdCB7XHJcbiAgICAgICAgICAgIGN1cnNvcjogd2FpdFxyXG4gICAgICAgIH1cclxuICAgICAgICAuYW5pbWF0ZWQtMC41IHtcclxuICAgICAgICAgICAgLXdlYmtpdC1hbmltYXRpb24tZHVyYXRpb246IDBzO1xyXG4gICAgICAgICAgICBhbmltYXRpb24tZHVyYXRpb246IDBzO1xyXG4gICAgICAgIH1cclxuICAgICAgICBgXHJcbiAgICBdXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBMb2FkaW5nQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3kge1xyXG4gICAgQElucHV0KCkgc2hvd01lc3NhZ2UgPSB0cnVlO1xyXG4gICAgbG9hZGluZ1N0eWxlRG9tID0gTE9BRElOR19TVFlMRVM7XHJcbiAgICBpZDogbnVtYmVyO1xyXG4gICAgcHJpdmF0ZSBfaXNBY3RpdmUgPSBmYWxzZTtcclxuICAgIHByaXZhdGUgYWN0aXZlU3ViamVjdCA9IG5ldyBCZWhhdmlvclN1YmplY3QoZmFsc2UpO1xyXG4gICAgbWVzc2FnZSA9ICcnO1xyXG4gICAgd2lkdGggPSAzMDtcclxuICAgIC8qKiBsb2FkaW5nIOagt+W8jyAqL1xyXG4gICAgdHlwZSA9IDA7XHJcblxyXG4gICAgZGVsYXkgPSAzMDA7XHJcblxyXG4gICAgZ2V0IGlzQWN0aXZlKCk6IGJvb2xlYW4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9pc0FjdGl2ZTtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgaXNBY3RpdmUodmFsOiBib29sZWFuKSB7XHJcbiAgICAgICAgdGhpcy5faXNBY3RpdmUgPSB2YWw7XHJcbiAgICAgICAgaWYgKHRoaXMuYWN0aXZlU3ViamVjdCkge1xyXG4gICAgICAgICAgICB0aGlzLmFjdGl2ZVN1YmplY3QubmV4dCh2YWwpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBAVmlld0NoaWxkKCdsb2FkaW5nQ29udGFpbmVyRWwnKSBsb2FkaW5nQ29udGFpbmVyRWw6IEVsZW1lbnRSZWY7XHJcbiAgICBAVmlld0NoaWxkKCdsb2FkaW5nQmFja2Ryb3AnKSBsb2FkaW5nQmFja2Ryb3A6IEVsZW1lbnRSZWY7XHJcbiAgICBAT3V0cHV0KCkgY2xvc2VkID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcbiAgICBhY3RpdmVkU3Vic2NyaXRpb246IFN1YnNjcmlwdGlvbiA9IG51bGw7XHJcblxyXG4gICAgcHJpdmF0ZSBkZXN0cm95JCA9IG5ldyBTdWJqZWN0KCk7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSByZW5kZXI6IFJlbmRlcmVyMiwgcHJpdmF0ZSBlbDogRWxlbWVudFJlZikge1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCkge1xyXG4gICAgICAgIHRoaXMuYWN0aXZlZFN1YnNjcml0aW9uID0gdGhpcy5hY3RpdmVTdWJqZWN0LnBpcGUoXHJcbiAgICAgICAgICAgIHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKVxyXG4gICAgICAgICkucGlwZShcclxuICAgICAgICAgICAgZmlsdGVyKChuOiBib29sZWFuKSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbjtcclxuICAgICAgICAgICAgfSksXHJcbiAgICAgICAgICAgIGRlbGF5KHRoaXMuZGVsYXkpXHJcbiAgICAgICAgKS5zdWJzY3JpYmUodiA9PiB7XHJcbiAgICAgICAgICAgIGlmICh2ICYmIHRoaXMuaXNBY3RpdmUpIHtcclxuICAgICAgICAgICAgICAgIC8vIHRoaXMuYW5pbWF0ZSgnZi1jb21wb25lbnQtbG9hZGluZyBmYWRlSW4gYW5pbWF0ZWQnKTtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyLnNldFN0eWxlKHRoaXMubG9hZGluZ0NvbnRhaW5lckVsLm5hdGl2ZUVsZW1lbnQsICdkaXNwbGF5JywgJ2Jsb2NrJyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5zZXRTdHlsZSh0aGlzLmxvYWRpbmdCYWNrZHJvcC5uYXRpdmVFbGVtZW50LCAnZGlzcGxheScsICdibG9jaycpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRQb3NpdGlvbigpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdBZnRlclZpZXdJbml0KCkge1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBuZ09uRGVzdHJveSgpIHtcclxuICAgICAgICB0aGlzLmRlc3Ryb3kkLm5leHQoKTtcclxuICAgICAgICB0aGlzLmRlc3Ryb3kkLmNvbXBsZXRlKCk7XHJcbiAgICAgICAgLy8gdGhpcy5hY3RpdmVTdWJqZWN0LmNvbXBsZXRlKCk7XHJcbiAgICAgICAgLy8gdGhpcy5hY3RpdmVTdWJqZWN0ID0gbnVsbDtcclxuICAgICAgICAvLyB0aGlzLmFjdGl2ZWRTdWJzY3JpdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIGNsb3NlKCkge1xyXG4gICAgICAgIC8vIGlmICh0aGlzLmxvYWRpbmdCYWNrZHJvcC5uYXRpdmVFbGVtZW50LnBhcmVudEVsZW1lbnQpIHtcclxuICAgICAgICAvLyAgICAgdGhpcy5yZW5kZXIucmVtb3ZlQ2hpbGQodGhpcy5lbC5uYXRpdmVFbGVtZW50LCB0aGlzLmxvYWRpbmdCYWNrZHJvcC5uYXRpdmVFbGVtZW50KTtcclxuICAgICAgICAvLyB9XHJcbiAgICAgICAgLy8gY29uc3Qgd2FpdEVsZSA9IGRvY3VtZW50LmJvZHkucXVlcnlTZWxlY3RvcignLmZhcnJpcy1sb2FkaW5nLWJhY2tkcm9wJyk7XHJcbiAgICAgICAgaWYgKHRoaXMubG9hZGluZ0JhY2tkcm9wKSB7XHJcbiAgICAgICAgICAgIHRoaXMubG9hZGluZ0JhY2tkcm9wLm5hdGl2ZUVsZW1lbnQucmVtb3ZlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaXNBY3RpdmUgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLnJlbmRlci5yZW1vdmVBdHRyaWJ1dGUodGhpcy5lbC5uYXRpdmVFbGVtZW50LCAnY2xhc3MnKTtcclxuICAgICAgICAvLyB0aGlzLmFuaW1hdGUoJ2YtY29tcG9uZW50LWxvYWRpbmcgZmFkZU91dCBhbmltYXRlZCBhbmltYXRlZC0wLjUnKTtcclxuICAgICAgICB0aGlzLmNsb3NlZC5lbWl0KHRoaXMuaXNBY3RpdmUpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2V0UG9zaXRpb24oKSB7XHJcbiAgICAgICAgY29uc3QgY29udGFpbmVyV2lkdGggPSB0aGlzLmxvYWRpbmdDb250YWluZXJFbC5uYXRpdmVFbGVtZW50LmNsaWVudFdpZHRoO1xyXG4gICAgICAgIGNvbnN0IGNvbnRhaW5lckhlaWdodCA9IHRoaXMubG9hZGluZ0NvbnRhaW5lckVsLm5hdGl2ZUVsZW1lbnQuY2xpZW50SGVpZ2h0O1xyXG5cclxuICAgICAgICB0aGlzLnJlbmRlci5zZXRTdHlsZSh0aGlzLmxvYWRpbmdDb250YWluZXJFbC5uYXRpdmVFbGVtZW50LCAnbWFyZ2luVG9wJywgLWNvbnRhaW5lckhlaWdodCAvIDIgKyAncHgnKTtcclxuICAgICAgICB0aGlzLnJlbmRlci5zZXRTdHlsZSh0aGlzLmxvYWRpbmdDb250YWluZXJFbC5uYXRpdmVFbGVtZW50LCAnbWFyZ2luTGVmdCcsIC1jb250YWluZXJXaWR0aCAvIDIgKyAncHgnKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGFuaW1hdGUoYW5pbWF0ZUNsczogc3RyaW5nKSB7XHJcbiAgICAgICAgdGhpcy5hZGRBbmltYXRpb25FbmRFdmVudCgnd2Via2l0QW5pbWF0aW9uRW5kJywgJ21vekFuaW1hdGlvbkVuZCcsICdNU0FuaW1hdGlvbkVuZCcsICdvYW5pbWF0aW9uZW5kJywgJ2FuaW1hdGlvbmVuZCcpO1xyXG4gICAgICAgIHRoaXMucmVuZGVyLnNldEF0dHJpYnV0ZSh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsICdjbGFzcycsIGFuaW1hdGVDbHMpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgYWRkQW5pbWF0aW9uRW5kRXZlbnQoLi4uZXZlbnRzOiBzdHJpbmdbXSkge1xyXG4gICAgICAgIGNvbnN0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICAgICAgZXZlbnRzLmZvckVhY2goZSA9PiB7XHJcbiAgICAgICAgICAgIF90aGlzLmVsLm5hdGl2ZUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihlLCBmdW5jdGlvbiBoYW5kbGVyKCkge1xyXG4gICAgICAgICAgICAgICAgX3RoaXMuZWwubmF0aXZlRWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKGUsIGhhbmRsZXIpO1xyXG4gICAgICAgICAgICAgICAgLy8gX3RoaXMucmVuZGVyLnJlbW92ZUF0dHJpYnV0ZShfdGhpcy5lbC5uYXRpdmVFbGVtZW50LCAnY2xhc3MnKTtcclxuICAgICAgICAgICAgICAgIFsnZmFkZUluJywgJ2ZhZGVPdXQnLCAnYW5pbWF0ZWQnLCAnYW5pbWF0ZWQtMC41J10uZm9yRWFjaChuID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBfdGhpcy5yZW5kZXIucmVtb3ZlQ2xhc3MoX3RoaXMuZWwubmF0aXZlRWxlbWVudCwgbik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIF90aGlzLmNsb3NlZC5lbWl0KF90aGlzLmlzQWN0aXZlKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn1cclxuIl19