/*
 * @Author: aalizzwell
 * @Date: 2019-08-02 15:31:34
 * @Last Modified by: aalizzwell
 * @Last Modified time: 2020-03-03 09:33:43
 */
import { Injectable, Optional, Injector, ComponentFactoryResolver, ReflectiveInjector } from '@angular/core';
import { Router, ActivatedRoute } from '@angular/router';
import { RuntimeFrameworkService } from './rtf-service';
import { AppType } from '@gsp-sys/rtf-common';
import { MenuStateService } from './menu-state.service';
import { NavigationEventService } from './navigation-event.service';
import { QuerystringService } from './querystring';
import { FrameContext, TranslateToken } from '@farris/devkit';
import { FEPageModalService } from '@farris/extend-page-modal';
import lodash from 'lodash-es';
import { FarrisFormService } from './farris-form.service';
import { LanguageService } from './languag.service';
import { map, switchMap } from 'rxjs/operators';
import { EMPTY, of } from 'rxjs';
import { FormNotifyService } from './form-notify.service';
// tslint:disable: no-string-literal max-line-length
const APP_CONTEXT_MANAGER = 'DEVKIT_APP_CONTEXT_MANAGER';
/**
 * 导航服务
 * @scope FormModule
 */
export class NavigationService {
    constructor(runtimeFrameworkService, menuStateService, navigationEventService, querystringService, frameContext, injector, languageService
    // @Optional() private pageModalService: FEPageModalService,
    // @Optional() private farrisFormService: FarrisFormService,
    // @Optional() private languageService: LanguageService
    ) {
        this.runtimeFrameworkService = runtimeFrameworkService;
        this.menuStateService = menuStateService;
        this.navigationEventService = navigationEventService;
        this.querystringService = querystringService;
        this.frameContext = frameContext;
        this.injector = injector;
        this.languageService = languageService;
        // appId不同于tabId，每次表单实例化时都会重新生成
        const appId = this.formAppContext && this.formAppContext.ApplicationId;
        let tabId = this.querystrings.tabId || this.querystrings.funcId || this.querystrings.appId;
        // 已经编译的表单，使用appId记录hash
        if (appId) {
            const appContextManager = window[APP_CONTEXT_MANAGER] || new Map();
            if (appContextManager && !appContextManager.has(appId)) {
                appContextManager.set(appId, { hash: window.location.hash });
                window[APP_CONTEXT_MANAGER] = appContextManager;
            }
        }
        if (tabId) {
            const formEventServices = window['formEventServices'] || new Map();
            // tabId、appId都存在时，使用appId替换tabId
            if (appId) {
                tabId = appId;
            }
            if (formEventServices && formEventServices.has(tabId)) {
                this.navigationEventService = formEventServices.get(tabId);
            }
            else {
                this.navigationEventService.registerEvent();
                formEventServices.set(tabId, this.navigationEventService);
                this.navigationEventService.frameContext = this.frameContext;
                window['formEventServices'] = formEventServices;
            }
            this.registerDestroyEvent(tabId);
        }
        if (!languageService) {
            this.languageService = new LanguageService();
        }
    }
    set context(context) {
        this.navigationEventService['context'] = context;
        this['commandContext'] = context;
    }
    /**
     * 获取整个表单的appcontext（除module上的appcontext）
     */
    get formAppContext() {
        if (this.frameContext) {
            let appContext = this.frameContext.appContext;
            // tslint:disable-next-line: max-line-length
            while (appContext && appContext.parent && appContext.parent.injector && appContext.parent.injector.get(FrameContext, null) !== null) {
                appContext = appContext.parent;
            }
            return appContext;
        }
        return null;
    }
    get querystrings() {
        let hash = window.location.hash;
        const appId = this.formAppContext && this.formAppContext.ApplicationId;
        if (appId) {
            const appContextManager = window[APP_CONTEXT_MANAGER];
            const appContext = appContextManager && appContextManager.get(appId);
            hash = appContext && appContext.hash || hash;
        }
        const params = this.querystringService.parse(hash);
        if (params) {
            params.formToken = this.runtimeFrameworkService.formToken;
        }
        return params;
    }
    /**
     * 提示服务
     */
    get formNotifyService() {
        return this.injector && this.injector.get(FormNotifyService, null);
    }
    /**
     * 注册销毁事件
     * @param tabId
     */
    registerDestroyEvent(tabId) {
        if (this.frameContext && this.frameContext.destorySignal) {
            this.frameContext.destorySignal.subscribe(() => {
                this.navigationEventService = null;
            });
        }
        if (this.frameContext && this.frameContext.appContext && this.frameContext.appContext.destorySignal) {
            this.frameContext.appContext.destorySignal.subscribe(() => {
                const formEventServices = window['formEventServices'];
                if (formEventServices) {
                    formEventServices.delete(tabId);
                }
                const appContextManager = window[APP_CONTEXT_MANAGER];
                if (appContextManager) {
                    appContextManager.delete(tabId);
                }
            });
        }
    }
    // #region 接口
    /**
     * 打开菜单
     * @param tabId 根据TabId决定打开新标签页或定位之前打开的标签页
     * @param funcId 菜单Id
     * @param params 参数
     * @param reload 是否重新刷新
     * @param enableRefresh 启用数据刷新
     * @param tabName tab标题
     * @param destructuring 是否解构参数
     */
    openMenu(tabId, funcId, params, reload, enableRefresh, tabName, destructuring) {
        if (!funcId && this.formNotifyService) {
            this.formNotifyService.warning(this.languageService.appOrFuncIdRequired, { hideTitle: true });
            return EMPTY;
        }
        if (tabName) {
            tabName = this.translate(tabName);
        }
        let queryStringParams = this.buildParamMap(params);
        destructuring = this.convertToBoolean(destructuring, false);
        if (destructuring === true) {
            queryStringParams = this.buildParam(params);
        }
        const paramsMap = this.buildParamMap(params);
        const currentTabId = this.querystrings.tabId || this.querystrings.funcId || this.querystrings.appId;
        const options = {
            tabId,
            funcId,
            appType: AppType.Menu,
            queryStringParams: queryStringParams,
            entityParams: paramsMap,
            appId: undefined,
            appEntrance: undefined,
            isReload: reload,
            tabName: tabName || null
        };
        // 启用数据刷新参数为true或者没有定义，则按刷新处理
        // 没有传递该参数或该参数为空，则认为按照之前的逻辑处理，默认刷新
        // null false "false" "true" undefined
        enableRefresh = this.convertToBoolean(enableRefresh, true);
        if (enableRefresh === true) {
            this.menuStateService.addMenuState(currentTabId, tabId);
        }
        this.runtimeFrameworkService.openMenu(options);
    }
    /**
     * 打开菜单（流）
     * @param tabId 根据TabId决定打开新标签页或定位之前打开的标签页
     * @param funcId 菜单Id
     * @param params 参数
     * @param reload 是否重新刷新
     * @param enableRefresh 启用数据刷新
     * @param destructuring 解构参数
     */
    openMenu$(tabId, funcId, params, reload, enableRefresh, tabName, destructuring) {
        if (!funcId && this.formNotifyService) {
            this.formNotifyService.warning(this.languageService.appOrFuncIdRequired, { hideTitle: true });
            return EMPTY;
        }
        if (tabName) {
            tabName = this.translate(tabName);
        }
        let queryStringParams = this.buildParamMap(params);
        destructuring = this.convertToBoolean(destructuring, false);
        if (destructuring === true) {
            queryStringParams = this.buildParam(params);
        }
        const paramsMap = this.buildParamMap(params);
        const currentTabId = this.querystrings.tabId || this.querystrings.funcId || this.querystrings.appId;
        const options = {
            tabId,
            funcId,
            appType: AppType.Menu,
            queryStringParams: queryStringParams,
            entityParams: paramsMap,
            appId: undefined,
            appEntrance: undefined,
            isReload: reload,
            tabName: tabName || null
        };
        // 启用数据刷新参数为true或者没有定义，则按刷新处理
        enableRefresh = this.convertToBoolean(enableRefresh, true);
        if (enableRefresh === true) {
            this.menuStateService.addMenuState(currentTabId, tabId);
        }
        return this.runtimeFrameworkService.openMenu$(options);
    }
    /**
     * 打开菜单(带维度)
     * @param tabId 根据TabId决定打开新标签页或定位之前打开的标签页
     * @param funcId 菜单Id
     * @param params 参数
     * @param reload 是否重新刷新
     * @param enableRefresh 启用数据刷新
     * @param dim1 dim1
     * @param dim2 dim2
     * @param destructuring 解构参数
     */
    openMenuWithDimension(tabId, funcId, params, enableRefresh, dim1, dim2, tabName, metadataId, destructuring) {
        if (!funcId && this.formNotifyService) {
            this.formNotifyService.warning(this.languageService.appOrFuncIdRequired, { hideTitle: true });
            return EMPTY;
        }
        if (tabName) {
            tabName = this.translate(tabName);
        }
        if (metadataId === undefined || metadataId === null) {
            metadataId = '';
        }
        let queryStringParams = this.buildParamMap(params);
        destructuring = this.convertToBoolean(destructuring, false);
        if (destructuring === true) {
            queryStringParams = this.buildParam(params);
        }
        const paramsMap = this.buildParamMap(params);
        queryStringParams.set('dim1', dim1 ? dim1 : 'public');
        queryStringParams.set('dim2', dim2 ? dim2 : 'public');
        queryStringParams.set('metadataId', metadataId);
        queryStringParams.set('isRtc', '1');
        queryStringParams.set('isRootMetadata', 'true');
        const currentTabId = this.querystrings.tabId || this.querystrings.funcId || this.querystrings.appId;
        const options = {
            tabId,
            funcId,
            appType: AppType.Menu,
            queryStringParams: queryStringParams,
            entityParams: paramsMap,
            appId: undefined,
            appEntrance: undefined,
            isReload: false,
            tabName: tabName || null
        };
        // 启用数据刷新参数为true或者没有定义，则按刷新处理
        // 没有传递该参数或该参数为空，则认为按照之前的逻辑处理，默认刷新
        // null false "false" "true" undefined
        enableRefresh = this.convertToBoolean(enableRefresh, true);
        if (enableRefresh === true) {
            this.menuStateService.addMenuState(currentTabId, tabId);
        }
        this.runtimeFrameworkService.openMenu(options);
    }
    /**
     * 打开应用
     * @param tabId tabId 根据TabId决定打开新标签页或定位之前打开的标签页
     * @param appId 应用Id
     * @param appEntrance 应用入口
     * @param params 参数
     * @param reload 是否重新刷新
     * @param tabName tab标题
     * @param enableRefresh 启用数据刷新
     * @param destructuring 解构参数
     */
    openApp(tabId, appId, appEntrance, params, reload, tabName, enableRefresh, destructuring) {
        if (!appId && this.formNotifyService) {
            this.formNotifyService.warning(this.languageService.appOrFuncIdRequired, { hideTitle: true });
            return EMPTY;
        }
        if (tabName) {
            tabName = this.translate(tabName);
        }
        let queryStringParams = this.buildParamMap(params);
        destructuring = this.convertToBoolean(destructuring, false);
        if (destructuring === true) {
            queryStringParams = this.buildParam(params);
        }
        const paramsMap = this.buildParamMap(params);
        const currentTabId = this.querystrings.tabId || this.querystrings.funcId || this.querystrings.appId;
        const options = {
            tabId,
            appId,
            appEntrance,
            funcId: undefined,
            appType: AppType.App,
            queryStringParams: queryStringParams,
            entityParams: paramsMap,
            isReload: reload,
            tabName: tabName || null
        };
        enableRefresh = this.convertToBoolean(enableRefresh, true);
        if (enableRefresh === true) {
            this.menuStateService.addMenuState(currentTabId, tabId);
        }
        this.runtimeFrameworkService.openMenu(options);
    }
    /**
     * 打开应用(流式)
     * @param tabId tabId 根据TabId决定打开新标签页或定位之前打开的标签页
     * @param appId 应用Id
     * @param appEntrance 应用入口
     * @param params 参数
     * @param reload 是否重新刷新
     * @param tabName tab标题
     * @param enableRefresh 启用数据刷新
     * @param destructuring 解构参数
     */
    openApp$(tabId, appId, appEntrance, params, reload, tabName, enableRefresh, destructuring) {
        if (!appId && this.formNotifyService) {
            this.formNotifyService.warning(this.languageService.appOrFuncIdRequired, { hideTitle: true });
            return EMPTY;
        }
        if (tabName) {
            tabName = this.translate(tabName);
        }
        let queryStringParams = this.buildParamMap(params);
        destructuring = this.convertToBoolean(destructuring, false);
        if (destructuring === true) {
            queryStringParams = this.buildParam(params);
        }
        const paramsMap = this.buildParamMap(params);
        const currentTabId = this.querystrings.tabId || this.querystrings.funcId || this.querystrings.appId;
        const options = {
            tabId,
            appId,
            appEntrance,
            funcId: undefined,
            appType: AppType.App,
            queryStringParams: queryStringParams,
            entityParams: paramsMap,
            isReload: reload,
            tabName: tabName || null
        };
        enableRefresh = this.convertToBoolean(enableRefresh, true);
        if (enableRefresh === true) {
            this.menuStateService.addMenuState(currentTabId, tabId);
        }
        return this.runtimeFrameworkService.openMenu$(options);
    }
    /**
     * 关闭
     * @param onCloseing 关闭前事件处理器
     */
    close() {
        const options = this.querystrings;
        const { isDialogComponent: isInDialog, rootComponent } = this.findDialog();
        if (isInDialog) {
            const modalRef = this.get(rootComponent, 'dialogRef');
            modalRef['close']();
            return;
        }
        options.token = options.formToken;
        this.runtimeFrameworkService.beforeCloseMenu(options);
    }
    /**
     * 强制关闭
     */
    destory() {
        const options = this.querystrings;
        options.token = options.formToken;
        this.runtimeFrameworkService.closeMenu(options);
    }
    /**
     *
     * @param params params
     * @deprecated 待废弃，与buildParamMap重复
     */
    parseParams(params) {
        if (typeof params === 'undefined' || params === null || (typeof params === 'string' && params.length < 1)) {
            params = {};
        }
        const paramMap = new Map();
        if (typeof params === 'object') {
            params = JSON.stringify(params);
        }
        params = window['encodeURIComponent'](params);
        paramMap.set('WEB_FORM_ROUTE_PARAMS', params);
        return paramMap;
    }
    /**
     * 注册事件监听器
     * @param eventType 事件类型 onTabClosed
     * @param handler 处理器
     * @returns string 返回事件标识
     */
    addEventListener(eventType, handler) {
        return this.navigationEventService.addEventListener(eventType, handler);
    }
    /**
     * 移除事件监听器
     * @param eventType 事件类型 onTabClosed | onTabCloseing
     * @param key 事件标识
     */
    removeEventListener(eventType, key) {
        return this.navigationEventService.removeEventListener(eventType, key);
    }
    /**
     * 清空事件监听器
     * @param eventType 事件类型
     */
    clearEventListener(eventType) {
        this.navigationEventService.clearEventListener(eventType);
    }
    /**
     * 以弹框、侧边栏或新标签页方式打开表单
     * @param mode 打开方式，支持`modal`弹窗、`sidebar`侧边栏、`tab`新标签页
     * @param modalId 弹窗id，如果mode=`modal`且没有url，
     * @param configs 弹窗配置
     * @param url 远端表单url
     * @param tabId 标签页id，modal=tab时必填
     * @param tabType 标签页类型，`menu` 或`app`
     * @param funcOrAppId 菜单或应用id
     * @param appEntrance 应用入口
     * @param params 参数
     * @param tabName 新标签页名称
     * @param enableRefresh 启用启动刷新
     * @param destructuring 是否解构
     */
    open(mode, modalId, url, configs, tabId, tabType, funcOrAppId, appEntrance, params, tabName, enableRefresh, destructuring) {
        const pageModalService = this.injector.get(FEPageModalService, null);
        if (!pageModalService) {
            throw new Error('get FEPageModalService failed.');
        }
        // 校验参数是否合法
        if (!mode) {
            throw new Error('[NavigationService]->open,mode参数不能为空！');
        }
        if (mode === 'modal' || mode === 'sidebar') {
            if (!modalId && !url) {
                throw new Error('弹窗及侧边栏模式时弹窗容器id和表单路径不能同时为空！');
            }
            if (modalId && url) {
                throw new Error('弹窗及侧边栏模式时弹窗容器id和表单路径不能同时存在！');
            }
            const uiStateConfig = this.getObjectTypeConfig(params);
            const modalConfig = this.buildConfigs(configs);
            if (mode === 'sidebar') {
                modalConfig.dialogType = mode;
            }
            let pageModalRef = null;
            if (modalId) {
                const farrisFormService = this.injector.get(FarrisFormService, null);
                if (!farrisFormService) {
                    return;
                }
                let componentType = farrisFormService.getControls(modalId);
                const componentRef = this.createComponentRef(componentType, uiStateConfig);
                pageModalRef = pageModalService.show(componentRef, modalConfig);
            }
            else if (url) {
                pageModalRef = pageModalService.showByUrl(url, modalConfig);
            }
            if (pageModalRef && !!pageModalRef.content) {
                pageModalRef.content.isDialogRootComponent = true;
                pageModalRef.content.dialogRef = pageModalRef;
                const header = pageModalRef.dialog && pageModalRef.dialog.instance && pageModalRef.dialog.instance.el && pageModalRef.dialog.instance.el.nativeElement && pageModalRef.dialog.instance.el.nativeElement.querySelector(".f-page-header");
                if (header && pageModalRef.dialog.instance.draggbar) {
                    pageModalRef.dialog.instance.draggbar.handle = header;
                    header.style.cursor = 'move';
                }
            }
        }
        else if (mode === 'tab') {
            if (!tabId || !tabType || !funcOrAppId) {
                if (this.formNotifyService) {
                    this.formNotifyService.warning(this.languageService.appOrFuncIdRequired, { hideTitle: true });
                }
                throw new Error('新标签模式时标签页id、标签类型、菜单或应用id均不能为空！');
            }
            if (tabType === 'app' && !appEntrance) {
                throw new Error('以应用方式打开时入口应用不能为空！');
            }
            if (tabType == 'app') {
                this.openApp(tabId, funcOrAppId, appEntrance, params, false, tabName, enableRefresh, destructuring);
            }
            else if (tabType === 'menu') {
                this.openMenu(tabId, funcOrAppId, params, false, enableRefresh, tabName, destructuring);
            }
        }
        else {
            throw new Error('不支持的模式！');
        }
        // this.pageModalService.
    }
    /**
     * in app navigate
     * @param commands commands
     */
    // public navigate(commands: any[]);
    /**
     * in app navigate
     * @param commands commands
     * @param options options
     * @description options:{ relativeTo: this.activatedRoute, queryParams:{a:1,b:2},etc:...}
     */
    navigate(commands, options) {
        const router = this.injector && this.injector.get(Router, null);
        const activatedRoute = this.injector && this.injector.get(ActivatedRoute, null);
        const queryParams = lodash.merge({}, this.querystrings, options && options.queryParams || {});
        if (options && options.hasOwnProperty('queryParams')) {
            delete options.queryParams;
        }
        const extras = lodash.merge({ skipLocationChange: false, relativeTo: activatedRoute, queryParams }, options || {});
        if (router) {
            return router.navigate(commands, extras);
        }
        else {
            return null;
        }
    }
    // #endregion
    // #region 私有方法
    /**
     * 封装路由参数
     * @param params 参数
     * @param options 配置参数
     */
    buildParamMap(params, options) {
        if (typeof params === 'undefined' || params === null || (typeof params === 'string' && params.length < 1)) {
            params = {};
        }
        const paramMap = new Map();
        if (options && Object.keys(options).length > 0) {
            if (typeof params !== 'object') {
                params = JSON.parse(params);
            }
            params = lodash.merge(params, options);
        }
        if (typeof params === 'object') {
            params = JSON.stringify(params);
        }
        const currentTabId = this.querystrings.tabId || this.querystrings.funcId || this.querystrings.appId;
        params = window['encodeURIComponent'](params);
        paramMap.set('WEB_FORM_ROUTE_PARAMS', params);
        paramMap.set('WEB_FORM_ROUTER_PARENT_ID', currentTabId);
        return paramMap;
    }
    buildParam(params, options) {
        if (typeof params === 'undefined' || params === null || (typeof params === 'string' && params.length < 1)) {
            params = {};
        }
        const paramMap = new Map();
        if (options && Object.keys(options).length > 0) {
            if (typeof params !== 'object') {
                params = JSON.parse(params);
            }
            params = lodash.merge(params, options);
        }
        if (typeof params !== 'object') {
            params = JSON.parse(params);
        }
        Object.keys(params).forEach(key => {
            paramMap.set(key, params[key]);
        });
        const currentTabId = this.querystrings.tabId || this.querystrings.funcId || this.querystrings.appId;
        params = window['encodeURIComponent'](params);
        paramMap.set('WEB_FORM_ROUTE_PARAMS', params);
        paramMap.set('WEB_FORM_ROUTER_PARENT_ID', currentTabId);
        return paramMap;
    }
    /**
     * 查找弹窗组件
     */
    findDialog() {
        let frameContext = this.get(this, 'commandContext.frameContext');
        let isDialogComponent = this.get(frameContext, 'frameComponent.isDialogRootComponent', false);
        let parentFrameContext = this.get(frameContext, 'parent');
        while (parentFrameContext != null && !isDialogComponent) {
            frameContext = this.get(frameContext, 'parent');
            parentFrameContext = this.get(parentFrameContext, 'parent');
            isDialogComponent = this.get(frameContext, 'frameComponent.isDialogRootComponent', false);
        }
        const rootComponent = this.get(frameContext, 'frameComponent');
        return { isDialogComponent, rootComponent };
    }
    /**
     * loadsh get
     * @param object 对象
     * @param path 路径
     * @param defaultVal 默认值
     */
    get(object, path, defaultVal = null) {
        const PATH = Array.isArray(path)
            ? path
            : path.split('.').filter(i => i.length);
        if (!PATH.length) {
            return object === undefined ? defaultVal : object;
        }
        if (object === null || object === undefined || typeof (object[PATH[0]]) === 'undefined') {
            return defaultVal;
        }
        return this.get(object[PATH.shift()], PATH, defaultVal);
    }
    convertToBoolean(value, defaultVal = false) {
        if (typeof value === 'undefined' || value === null) {
            value = defaultVal;
        }
        if (typeof value === 'string') {
            value = value || String(defaultVal);
            value = value === 'true' ? true : false;
        }
        return value;
    }
    /**
     * 翻译资源项
     * @param key 资源项key
     */
    translate(key) {
        const translateService = this.injector && this.injector.get(TranslateToken, null) || null;
        if (translateService && key && key.startsWith('{{') && key.endsWith('}}')) {
            key = key.replace('{{', '').replace('}}', '').trim();
            return translateService.transform(key, null);
        }
        return key;
    }
    // #endregion
    //#region 弹窗相关方法
    buildConfigs(config) {
        let languageService = this.injector.get(LanguageService, null);
        if (!languageService) {
            languageService = LanguageService.getInstance();
        }
        const defaultConfigs = {
            title: languageService && languageService.defaultDialogTitle || '',
            width: 800,
            height: 500,
            showButtons: false
        };
        const objectTypeConfig = this.getObjectTypeConfig(config);
        const configs = Object.assign(defaultConfigs, objectTypeConfig);
        const onClosingHandler = configs.beforeClose;
        const refresh = configs['refresh'] || {};
        const refreshCommandName = refresh && refresh.commandName || null;
        const refreshFrameId = refresh && refresh.frameId || null;
        // tslint:disable: no-string-literal
        const cancelChanges = configs['cancelChanges'] || false;
        configs.beforeClose = (ref) => {
            if (!!onClosingHandler && typeof onClosingHandler === 'function') {
                return onClosingHandler(ref).pipe(switchMap(result => {
                    if (result) {
                        if (cancelChanges) {
                            return this.cancelChanges(ref).pipe(switchMap(() => this.refreshForm(refreshCommandName, refreshFrameId)));
                        }
                    }
                    return of(result);
                }));
            }
            else {
                if (cancelChanges) {
                    return this.cancelChanges(ref).pipe(switchMap(() => this.refreshForm(refreshCommandName, refreshFrameId)));
                }
                else {
                    return of(true);
                }
            }
        };
        return configs;
    }
    getObjectTypeConfig(config) {
        let objectTypeConfig;
        if (typeof config === 'undefined') {
            config = {};
        }
        if (typeof config === 'string') {
            if (config.length) {
                try {
                    objectTypeConfig = JSON.parse(config);
                }
                catch (_a) {
                    throw new Error(config + '不是合法的json字符串');
                }
            }
            else {
                objectTypeConfig = {};
            }
        }
        else if (typeof config === 'object') {
            objectTypeConfig = Object.assign({}, config);
        }
        else {
            throw new Error('填写对象格式或json字符串');
        }
        return objectTypeConfig;
    }
    /**
     * 取消服务器变更集
     */
    cancelChanges(ref) {
        if (ref && ref.modalRef && ref.modalRef.content) {
            const component = ref.modalRef.content;
            if (component && component.context) {
                const repository = component.context.repository || null;
                if (repository) {
                    return repository.cancelChanges().pipe(switchMap(() => of(true)));
                }
            }
        }
        return of(true);
    }
    refreshForm(refreshCommandName, refreshFrameId) {
        if (refreshCommandName && refreshFrameId) {
            const frameContext = this.frameContext.appContext.frameContextManager.getFrameContextById(refreshFrameId);
            if (frameContext) {
                const viewModel = frameContext.viewModel;
                return viewModel[refreshCommandName]().pipe(map(() => true));
            }
        }
        return of(true);
    }
    createComponentRef(componentType, uiStateObject) {
        let componentRef;
        const frameContext = this.getFrameContext();
        const componentFactoryResolver = this.getComponentFactoryResolver();
        if (frameContext && componentFactoryResolver) {
            const contentCmptFactory = componentFactoryResolver.resolveComponentFactory(componentType);
            const modalContentInjector = ReflectiveInjector.resolveAndCreate([], frameContext.injector);
            componentRef = contentCmptFactory.create(modalContentInjector);
            if (componentRef && componentRef.instance && componentRef.instance.viewModel && componentRef.instance.viewModel.uiState) {
                if (typeof uiStateObject === 'object' && Object.keys(uiStateObject).length) {
                    Object.keys(uiStateObject).forEach(item => {
                        componentRef.instance.viewModel.uiState.setPropertyValue(item, uiStateObject[item]);
                    });
                }
                // 附加isDialog参数
                componentRef.instance.viewModel.uiState.setPropertyValue('DEVKIT_DIALOG', true);
            }
        }
        return componentRef;
    }
    /**
     * 兼容旧弹窗，获取frameContext
     */
    getFrameContext() {
        if (this.frameContext) {
            return this.frameContext;
        }
        if (this['context'] && this['context']['frameContext']) {
            return this['context']['frameContext'];
        }
        return null;
    }
    /**
     * 兼容旧弹窗，获取ComponentFactoryResolver
     */
    getComponentFactoryResolver() {
        const frameContext = this.getFrameContext();
        let componentFactoryResolver;
        if (frameContext) {
            componentFactoryResolver = frameContext.injector.get(ComponentFactoryResolver);
        }
        return componentFactoryResolver;
    }
}
NavigationService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
NavigationService.ctorParameters = () => [
    { type: RuntimeFrameworkService },
    { type: MenuStateService },
    { type: NavigationEventService },
    { type: QuerystringService },
    { type: FrameContext, decorators: [{ type: Optional }] },
    { type: Injector, decorators: [{ type: Optional }] },
    { type: LanguageService, decorators: [{ type: Optional }] }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmF2aWdhdGlvbi5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9jb21tYW5kLXNlcnZpY2VzLyIsInNvdXJjZXMiOlsibGliL25hdmlnYXRpb24uc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7R0FLRztBQUNILE9BQU8sRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSx3QkFBd0IsRUFBRSxrQkFBa0IsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUM3RyxPQUFPLEVBQUUsTUFBTSxFQUFFLGNBQWMsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ3pELE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN4RCxPQUFPLEVBQWMsT0FBTyxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDMUQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDeEQsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDcEUsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ25ELE9BQU8sRUFBRSxZQUFZLEVBQUUsY0FBYyxFQUE2QixNQUFNLGdCQUFnQixDQUFDO0FBQ3pGLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQy9ELE9BQU8sTUFBTSxNQUFNLFdBQVcsQ0FBQztBQUMvQixPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUMxRCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDcEQsT0FBTyxFQUFFLEdBQUcsRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNoRCxPQUFPLEVBQUUsS0FBSyxFQUFjLEVBQUUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUM3QyxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUUxRCxvREFB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SSxDQUFDLGVBQWUsRUFBRSxDQUFDO1FBQzVDLElBQUksd0JBQTZCLENBQUM7UUFDbEMsSUFBSSxZQUFZLEVBQUU7WUFDaEIsd0JBQXdCLEdBQUcsWUFBWSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsd0JBQXdCLENBQUMsQ0FBQztTQUNoRjtRQUNELE9BQU8sd0JBQXdCLENBQUM7SUFDbEMsQ0FBQzs7O1lBcHZCRixVQUFVOzs7O1lBcEJGLHVCQUF1QjtZQUV2QixnQkFBZ0I7WUFDaEIsc0JBQXNCO1lBQ3RCLGtCQUFrQjtZQUNsQixZQUFZLHVCQXNCaEIsUUFBUTtZQTdCa0IsUUFBUSx1QkE4QmxDLFFBQVE7WUFuQkosZUFBZSx1QkFvQm5CLFFBQVEiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogQEF1dGhvcjogYWFsaXp6d2VsbFxuICogQERhdGU6IDIwMTktMDgtMDIgMTU6MzE6MzRcbiAqIEBMYXN0IE1vZGlmaWVkIGJ5OiBhYWxpenp3ZWxsXG4gKiBATGFzdCBNb2RpZmllZCB0aW1lOiAyMDIwLTAzLTAzIDA5OjMzOjQzXG4gKi9cbmltcG9ydCB7IEluamVjdGFibGUsIE9wdGlvbmFsLCBJbmplY3RvciwgQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLCBSZWZsZWN0aXZlSW5qZWN0b3IgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFJvdXRlciwgQWN0aXZhdGVkUm91dGUgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xuaW1wb3J0IHsgUnVudGltZUZyYW1ld29ya1NlcnZpY2UgfSBmcm9tICcuL3J0Zi1zZXJ2aWNlJztcbmltcG9ydCB7IEFwcE9wdGlvbnMsIEFwcFR5cGUgfSBmcm9tICdAZ3NwLXN5cy9ydGYtY29tbW9uJztcbmltcG9ydCB7IE1lbnVTdGF0ZVNlcnZpY2UgfSBmcm9tICcuL21lbnUtc3RhdGUuc2VydmljZSc7XG5pbXBvcnQgeyBOYXZpZ2F0aW9uRXZlbnRTZXJ2aWNlIH0gZnJvbSAnLi9uYXZpZ2F0aW9uLWV2ZW50LnNlcnZpY2UnO1xuaW1wb3J0IHsgUXVlcnlzdHJpbmdTZXJ2aWNlIH0gZnJvbSAnLi9xdWVyeXN0cmluZyc7XG5pbXBvcnQgeyBGcmFtZUNvbnRleHQsIFRyYW5zbGF0ZVRva2VuLCBUcmFuc2xhdGUsIEZyYW1lQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy9kZXZraXQnO1xuaW1wb3J0IHsgRkVQYWdlTW9kYWxTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy9leHRlbmQtcGFnZS1tb2RhbCc7XG5pbXBvcnQgbG9kYXNoIGZyb20gJ2xvZGFzaC1lcyc7XG5pbXBvcnQgeyBGYXJyaXNGb3JtU2VydmljZSB9IGZyb20gJy4vZmFycmlzLWZvcm0uc2VydmljZSc7XG5pbXBvcnQgeyBMYW5ndWFnZVNlcnZpY2UgfSBmcm9tICcuL2xhbmd1YWcuc2VydmljZSc7XG5pbXBvcnQgeyBtYXAsIHN3aXRjaE1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IEVNUFRZLCBPYnNlcnZhYmxlLCBvZiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgRm9ybU5vdGlmeVNlcnZpY2UgfSBmcm9tICcuL2Zvcm0tbm90aWZ5LnNlcnZpY2UnO1xuZGVjbGFyZSBjb25zdCBTeXN0ZW06IGFueTtcbi8vIHRzbGludDpkaXNhYmxlOiBuby1zdHJpbmctbGl0ZXJhbCBtYXgtbGluZS1sZW5ndGhcbmNvbnN0IEFQUF9DT05URVhUX01BTkFHRVIgPSAnREVWS0lUX0FQUF9DT05URVhUX01BTkFHRVInO1xuLyoqXG4gKiDlr7zoiKrmnI3liqFcbiAqIEBzY29wZSBGb3JtTW9kdWxlXG4gKi9cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBOYXZpZ2F0aW9uU2VydmljZSB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgcnVudGltZUZyYW1ld29ya1NlcnZpY2U6IFJ1bnRpbWVGcmFtZXdvcmtTZXJ2aWNlLFxuICAgIHByaXZhdGUgbWVudVN0YXRlU2VydmljZTogTWVudVN0YXRlU2VydmljZSxcbiAgICBwcml2YXRlIG5hdmlnYXRpb25FdmVudFNlcnZpY2U6IE5hdmlnYXRpb25FdmVudFNlcnZpY2UsXG4gICAgcHJpdmF0ZSBxdWVyeXN0cmluZ1NlcnZpY2U6IFF1ZXJ5c3RyaW5nU2VydmljZSxcbiAgICBAT3B0aW9uYWwoKSBwcml2YXRlIGZyYW1lQ29udGV4dDogRnJhbWVDb250ZXh0LFxuICAgIEBPcHRpb25hbCgpIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yLFxuICAgIEBPcHRpb25hbCgpIHByaXZhdGUgbGFuZ3VhZ2VTZXJ2aWNlOiBMYW5ndWFnZVNlcnZpY2VcbiAgICAvLyBAT3B0aW9uYWwoKSBwcml2YXRlIHBhZ2VNb2RhbFNlcnZpY2U6IEZFUGFnZU1vZGFsU2VydmljZSxcbiAgICAvLyBAT3B0aW9uYWwoKSBwcml2YXRlIGZhcnJpc0Zvcm1TZXJ2aWNlOiBGYXJyaXNGb3JtU2VydmljZSxcbiAgICAvLyBAT3B0aW9uYWwoKSBwcml2YXRlIGxhbmd1YWdlU2VydmljZTogTGFuZ3VhZ2VTZXJ2aWNlXG4gICkge1xuICAgIC8vIGFwcElk5LiN5ZCM5LqOdGFiSWTvvIzmr4/mrKHooajljZXlrp7kvovljJbml7bpg73kvJrph43mlrDnlJ/miJBcbiAgICBjb25zdCBhcHBJZCA9IHRoaXMuZm9ybUFwcENvbnRleHQgJiYgdGhpcy5mb3JtQXBwQ29udGV4dC5BcHBsaWNhdGlvbklkO1xuICAgIGxldCB0YWJJZCA9IHRoaXMucXVlcnlzdHJpbmdzLnRhYklkIHx8IHRoaXMucXVlcnlzdHJpbmdzLmZ1bmNJZCB8fCB0aGlzLnF1ZXJ5c3RyaW5ncy5hcHBJZDtcbiAgICAvLyDlt7Lnu4/nvJbor5HnmoTooajljZXvvIzkvb/nlKhhcHBJZOiusOW9lWhhc2hcbiAgICBpZiAoYXBwSWQpIHtcbiAgICAgIGNvbnN0IGFwcENvbnRleHRNYW5hZ2VyID0gd2luZG93W0FQUF9DT05URVhUX01BTkFHRVJdIHx8IG5ldyBNYXA8c3RyaW5nLCBhbnk+KCk7XG4gICAgICBpZiAoYXBwQ29udGV4dE1hbmFnZXIgJiYgIWFwcENvbnRleHRNYW5hZ2VyLmhhcyhhcHBJZCkpIHtcbiAgICAgICAgYXBwQ29udGV4dE1hbmFnZXIuc2V0KGFwcElkLCB7IGhhc2g6IHdpbmRvdy5sb2NhdGlvbi5oYXNoIH0pO1xuICAgICAgICB3aW5kb3dbQVBQX0NPTlRFWFRfTUFOQUdFUl0gPSBhcHBDb250ZXh0TWFuYWdlcjtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHRhYklkKSB7XG4gICAgICBjb25zdCBmb3JtRXZlbnRTZXJ2aWNlczogTWFwPHN0cmluZywgYW55PiA9IHdpbmRvd1snZm9ybUV2ZW50U2VydmljZXMnXSB8fCBuZXcgTWFwPHN0cmluZywgYW55PigpO1xuICAgICAgLy8gdGFiSWTjgIFhcHBJZOmDveWtmOWcqOaXtu+8jOS9v+eUqGFwcElk5pu/5o2idGFiSWRcbiAgICAgIGlmIChhcHBJZCkge1xuICAgICAgICB0YWJJZCA9IGFwcElkO1xuICAgICAgfVxuICAgICAgaWYgKGZvcm1FdmVudFNlcnZpY2VzICYmIGZvcm1FdmVudFNlcnZpY2VzLmhhcyh0YWJJZCkpIHtcbiAgICAgICAgdGhpcy5uYXZpZ2F0aW9uRXZlbnRTZXJ2aWNlID0gZm9ybUV2ZW50U2VydmljZXMuZ2V0KHRhYklkKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMubmF2aWdhdGlvbkV2ZW50U2VydmljZS5yZWdpc3RlckV2ZW50KCk7XG4gICAgICAgIGZvcm1FdmVudFNlcnZpY2VzLnNldCh0YWJJZCwgdGhpcy5uYXZpZ2F0aW9uRXZlbnRTZXJ2aWNlKTtcbiAgICAgICAgdGhpcy5uYXZpZ2F0aW9uRXZlbnRTZXJ2aWNlLmZyYW1lQ29udGV4dCA9IHRoaXMuZnJhbWVDb250ZXh0O1xuICAgICAgICB3aW5kb3dbJ2Zvcm1FdmVudFNlcnZpY2VzJ10gPSBmb3JtRXZlbnRTZXJ2aWNlcztcbiAgICAgIH1cbiAgICAgIHRoaXMucmVnaXN0ZXJEZXN0cm95RXZlbnQodGFiSWQpO1xuICAgIH1cbiAgICBpZiAoIWxhbmd1YWdlU2VydmljZSkge1xuICAgICAgdGhpcy5sYW5ndWFnZVNlcnZpY2UgPSBuZXcgTGFuZ3VhZ2VTZXJ2aWNlKCk7XG4gICAgfVxuICB9XG4gIHB1YmxpYyBzZXQgY29udGV4dChjb250ZXh0KSB7XG4gICAgdGhpcy5uYXZpZ2F0aW9uRXZlbnRTZXJ2aWNlWydjb250ZXh0J10gPSBjb250ZXh0O1xuICAgIHRoaXNbJ2NvbW1hbmRDb250ZXh0J10gPSBjb250ZXh0O1xuICB9XG4gIC8qKlxuICAgKiDojrflj5bmlbTkuKrooajljZXnmoRhcHBjb250ZXh077yI6ZmkbW9kdWxl5LiK55qEYXBwY29udGV4dO+8iVxuICAgKi9cbiAgcHJpdmF0ZSBnZXQgZm9ybUFwcENvbnRleHQoKSB7XG4gICAgaWYgKHRoaXMuZnJhbWVDb250ZXh0KSB7XG4gICAgICBsZXQgYXBwQ29udGV4dCA9IHRoaXMuZnJhbWVDb250ZXh0LmFwcENvbnRleHQ7XG4gICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IG1heC1saW5lLWxlbmd0aFxuICAgICAgd2hpbGUgKGFwcENvbnRleHQgJiYgYXBwQ29udGV4dC5wYXJlbnQgJiYgYXBwQ29udGV4dC5wYXJlbnQuaW5qZWN0b3IgJiYgYXBwQ29udGV4dC5wYXJlbnQuaW5qZWN0b3IuZ2V0KEZyYW1lQ29udGV4dCwgbnVsbCkgIT09IG51bGwpIHtcbiAgICAgICAgYXBwQ29udGV4dCA9IGFwcENvbnRleHQucGFyZW50O1xuICAgICAgfVxuICAgICAgcmV0dXJuIGFwcENvbnRleHQ7XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG4gIHByaXZhdGUgZ2V0IHF1ZXJ5c3RyaW5ncygpIHtcbiAgICBsZXQgaGFzaCA9IHdpbmRvdy5sb2NhdGlvbi5oYXNoO1xuICAgIGNvbnN0IGFwcElkID0gdGhpcy5mb3JtQXBwQ29udGV4dCAmJiB0aGlzLmZvcm1BcHBDb250ZXh0LkFwcGxpY2F0aW9uSWQ7XG4gICAgaWYgKGFwcElkKSB7XG4gICAgICBjb25zdCBhcHBDb250ZXh0TWFuYWdlciA9IHdpbmRvd1tBUFBfQ09OVEVYVF9NQU5BR0VSXTtcbiAgICAgIGNvbnN0IGFwcENvbnRleHQgPSBhcHBDb250ZXh0TWFuYWdlciAmJiBhcHBDb250ZXh0TWFuYWdlci5nZXQoYXBwSWQpO1xuICAgICAgaGFzaCA9IGFwcENvbnRleHQgJiYgYXBwQ29udGV4dC5oYXNoIHx8IGhhc2g7XG4gICAgfVxuICAgIGNvbnN0IHBhcmFtcyA9IHRoaXMucXVlcnlzdHJpbmdTZXJ2aWNlLnBhcnNlKGhhc2gpO1xuICAgIGlmIChwYXJhbXMpIHtcbiAgICAgIHBhcmFtcy5mb3JtVG9rZW4gPSB0aGlzLnJ1bnRpbWVGcmFtZXdvcmtTZXJ2aWNlLmZvcm1Ub2tlbjtcbiAgICB9XG4gICAgcmV0dXJuIHBhcmFtcztcbiAgfVxuICAvKipcbiAgICog5o+Q56S65pyN5YqhXG4gICAqL1xuICBwcml2YXRlIGdldCBmb3JtTm90aWZ5U2VydmljZSgpIHtcbiAgICByZXR1cm4gdGhpcy5pbmplY3RvciAmJiB0aGlzLmluamVjdG9yLmdldDxGb3JtTm90aWZ5U2VydmljZT4oRm9ybU5vdGlmeVNlcnZpY2UsIG51bGwpO1xuICB9XG4gIC8qKlxuICAgKiDms6jlhozplIDmr4Hkuovku7ZcbiAgICogQHBhcmFtIHRhYklkIFxuICAgKi9cbiAgcHJpdmF0ZSByZWdpc3RlckRlc3Ryb3lFdmVudCh0YWJJZDogc3RyaW5nKSB7XG4gICAgaWYgKHRoaXMuZnJhbWVDb250ZXh0ICYmIHRoaXMuZnJhbWVDb250ZXh0LmRlc3RvcnlTaWduYWwpIHtcbiAgICAgIHRoaXMuZnJhbWVDb250ZXh0LmRlc3RvcnlTaWduYWwuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgdGhpcy5uYXZpZ2F0aW9uRXZlbnRTZXJ2aWNlID0gbnVsbDtcbiAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAodGhpcy5mcmFtZUNvbnRleHQgJiYgdGhpcy5mcmFtZUNvbnRleHQuYXBwQ29udGV4dCAmJiB0aGlzLmZyYW1lQ29udGV4dC5hcHBDb250ZXh0LmRlc3RvcnlTaWduYWwpIHtcbiAgICAgIHRoaXMuZnJhbWVDb250ZXh0LmFwcENvbnRleHQuZGVzdG9yeVNpZ25hbC5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICBjb25zdCBmb3JtRXZlbnRTZXJ2aWNlcyA9IHdpbmRvd1snZm9ybUV2ZW50U2VydmljZXMnXSBhcyBNYXA8c3RyaW5nLCBhbnk+O1xuICAgICAgICBpZiAoZm9ybUV2ZW50U2VydmljZXMpIHtcbiAgICAgICAgICBmb3JtRXZlbnRTZXJ2aWNlcy5kZWxldGUodGFiSWQpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGFwcENvbnRleHRNYW5hZ2VyID0gd2luZG93W0FQUF9DT05URVhUX01BTkFHRVJdIGFzIE1hcDxzdHJpbmcsIGFueT47XG4gICAgICAgIGlmIChhcHBDb250ZXh0TWFuYWdlcikge1xuICAgICAgICAgIGFwcENvbnRleHRNYW5hZ2VyLmRlbGV0ZSh0YWJJZCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuICAvLyAjcmVnaW9uIOaOpeWPo1xuXG4gIC8qKlxuICAgKiDmiZPlvIDoj5zljZVcbiAgICogQHBhcmFtIHRhYklkIOagueaNrlRhYklk5Yaz5a6a5omT5byA5paw5qCH562+6aG15oiW5a6a5L2N5LmL5YmN5omT5byA55qE5qCH562+6aG1XG4gICAqIEBwYXJhbSBmdW5jSWQg6I+c5Y2VSWRcbiAgICogQHBhcmFtIHBhcmFtcyDlj4LmlbBcbiAgICogQHBhcmFtIHJlbG9hZCDmmK/lkKbph43mlrDliLfmlrBcbiAgICogQHBhcmFtIGVuYWJsZVJlZnJlc2gg5ZCv55So5pWw5o2u5Yi35pawXG4gICAqIEBwYXJhbSB0YWJOYW1lIHRhYuagh+mimFxuICAgKiBAcGFyYW0gZGVzdHJ1Y3R1cmluZyDmmK/lkKbop6PmnoTlj4LmlbBcbiAgICovXG4gIHB1YmxpYyBvcGVuTWVudSh0YWJJZDogc3RyaW5nLCBmdW5jSWQ6IHN0cmluZywgcGFyYW1zOiBhbnksIHJlbG9hZD86IGJvb2xlYW4sIGVuYWJsZVJlZnJlc2g/OiBhbnksIHRhYk5hbWU/OiBzdHJpbmcsIGRlc3RydWN0dXJpbmc/OiBhbnkpIHtcbiAgICBpZiAoIWZ1bmNJZCAmJiB0aGlzLmZvcm1Ob3RpZnlTZXJ2aWNlKSB7XG4gICAgICB0aGlzLmZvcm1Ob3RpZnlTZXJ2aWNlLndhcm5pbmcodGhpcy5sYW5ndWFnZVNlcnZpY2UuYXBwT3JGdW5jSWRSZXF1aXJlZCwgeyBoaWRlVGl0bGU6IHRydWUgfSk7XG4gICAgICByZXR1cm4gRU1QVFk7XG4gICAgfVxuICAgIGlmICh0YWJOYW1lKSB7XG4gICAgICB0YWJOYW1lID0gdGhpcy50cmFuc2xhdGUodGFiTmFtZSk7XG4gICAgfVxuXG4gICAgbGV0IHF1ZXJ5U3RyaW5nUGFyYW1zID0gdGhpcy5idWlsZFBhcmFtTWFwKHBhcmFtcyk7XG4gICAgZGVzdHJ1Y3R1cmluZyA9IHRoaXMuY29udmVydFRvQm9vbGVhbihkZXN0cnVjdHVyaW5nLCBmYWxzZSk7XG4gICAgaWYgKGRlc3RydWN0dXJpbmcgPT09IHRydWUpIHtcbiAgICAgIHF1ZXJ5U3RyaW5nUGFyYW1zID0gdGhpcy5idWlsZFBhcmFtKHBhcmFtcyk7XG4gICAgfVxuICAgIGNvbnN0IHBhcmFtc01hcCA9IHRoaXMuYnVpbGRQYXJhbU1hcChwYXJhbXMpO1xuICAgIGNvbnN0IGN1cnJlbnRUYWJJZCA9IHRoaXMucXVlcnlzdHJpbmdzLnRhYklkIHx8IHRoaXMucXVlcnlzdHJpbmdzLmZ1bmNJZCB8fCB0aGlzLnF1ZXJ5c3RyaW5ncy5hcHBJZDtcbiAgICBjb25zdCBvcHRpb25zOiBBcHBPcHRpb25zID0ge1xuICAgICAgdGFiSWQsXG4gICAgICBmdW5jSWQsXG4gICAgICBhcHBUeXBlOiBBcHBUeXBlLk1lbnUsXG4gICAgICBxdWVyeVN0cmluZ1BhcmFtczogcXVlcnlTdHJpbmdQYXJhbXMsXG4gICAgICBlbnRpdHlQYXJhbXM6IHBhcmFtc01hcCxcbiAgICAgIGFwcElkOiB1bmRlZmluZWQsXG4gICAgICBhcHBFbnRyYW5jZTogdW5kZWZpbmVkLFxuICAgICAgaXNSZWxvYWQ6IHJlbG9hZCxcbiAgICAgIHRhYk5hbWU6IHRhYk5hbWUgfHwgbnVsbFxuICAgIH07XG4gICAgLy8g5ZCv55So5pWw5o2u5Yi35paw5Y+C5pWw5Li6dHJ1ZeaIluiAheayoeacieWumuS5ie+8jOWImeaMieWIt+aWsOWkhOeQhlxuICAgIC8vIOayoeacieS8oOmAkuivpeWPguaVsOaIluivpeWPguaVsOS4uuepuu+8jOWImeiupOS4uuaMieeFp+S5i+WJjeeahOmAu+i+keWkhOeQhu+8jOm7mOiupOWIt+aWsFxuICAgIC8vIG51bGwgZmFsc2UgXCJmYWxzZVwiIFwidHJ1ZVwiIHVuZGVmaW5lZFxuICAgIGVuYWJsZVJlZnJlc2ggPSB0aGlzLmNvbnZlcnRUb0Jvb2xlYW4oZW5hYmxlUmVmcmVzaCwgdHJ1ZSk7XG4gICAgaWYgKGVuYWJsZVJlZnJlc2ggPT09IHRydWUpIHtcbiAgICAgIHRoaXMubWVudVN0YXRlU2VydmljZS5hZGRNZW51U3RhdGUoY3VycmVudFRhYklkLCB0YWJJZCk7XG4gICAgfVxuICAgIHRoaXMucnVudGltZUZyYW1ld29ya1NlcnZpY2Uub3Blbk1lbnUob3B0aW9ucyk7XG4gIH1cbiAgLyoqXG4gICAqIOaJk+W8gOiPnOWNle+8iOa1ge+8iVxuICAgKiBAcGFyYW0gdGFiSWQg5qC55o2uVGFiSWTlhrPlrprmiZPlvIDmlrDmoIfnrb7pobXmiJblrprkvY3kuYvliY3miZPlvIDnmoTmoIfnrb7pobVcbiAgICogQHBhcmFtIGZ1bmNJZCDoj5zljZVJZFxuICAgKiBAcGFyYW0gcGFyYW1zIOWPguaVsFxuICAgKiBAcGFyYW0gcmVsb2FkIOaYr+WQpumHjeaWsOWIt+aWsFxuICAgKiBAcGFyYW0gZW5hYmxlUmVmcmVzaCDlkK/nlKjmlbDmja7liLfmlrBcbiAgICogQHBhcmFtIGRlc3RydWN0dXJpbmcg6Kej5p6E5Y+C5pWwXG4gICAqL1xuICBwdWJsaWMgb3Blbk1lbnUkKHRhYklkOiBzdHJpbmcsIGZ1bmNJZDogc3RyaW5nLCBwYXJhbXM6IGFueSwgcmVsb2FkPzogYm9vbGVhbiwgZW5hYmxlUmVmcmVzaD86IGFueSwgdGFiTmFtZT86IHN0cmluZywgZGVzdHJ1Y3R1cmluZz86IGFueSkge1xuICAgIGlmICghZnVuY0lkICYmIHRoaXMuZm9ybU5vdGlmeVNlcnZpY2UpIHtcbiAgICAgIHRoaXMuZm9ybU5vdGlmeVNlcnZpY2Uud2FybmluZyh0aGlzLmxhbmd1YWdlU2VydmljZS5hcHBPckZ1bmNJZFJlcXVpcmVkLCB7IGhpZGVUaXRsZTogdHJ1ZSB9KTtcbiAgICAgIHJldHVybiBFTVBUWTtcbiAgICB9XG4gICAgaWYgKHRhYk5hbWUpIHtcbiAgICAgIHRhYk5hbWUgPSB0aGlzLnRyYW5zbGF0ZSh0YWJOYW1lKTtcbiAgICB9XG4gICAgbGV0IHF1ZXJ5U3RyaW5nUGFyYW1zID0gdGhpcy5idWlsZFBhcmFtTWFwKHBhcmFtcyk7XG4gICAgZGVzdHJ1Y3R1cmluZyA9IHRoaXMuY29udmVydFRvQm9vbGVhbihkZXN0cnVjdHVyaW5nLCBmYWxzZSk7XG4gICAgaWYgKGRlc3RydWN0dXJpbmcgPT09IHRydWUpIHtcbiAgICAgIHF1ZXJ5U3RyaW5nUGFyYW1zID0gdGhpcy5idWlsZFBhcmFtKHBhcmFtcyk7XG4gICAgfVxuICAgIGNvbnN0IHBhcmFtc01hcCA9IHRoaXMuYnVpbGRQYXJhbU1hcChwYXJhbXMpO1xuICAgIGNvbnN0IGN1cnJlbnRUYWJJZCA9IHRoaXMucXVlcnlzdHJpbmdzLnRhYklkIHx8IHRoaXMucXVlcnlzdHJpbmdzLmZ1bmNJZCB8fCB0aGlzLnF1ZXJ5c3RyaW5ncy5hcHBJZDtcbiAgICBjb25zdCBvcHRpb25zOiBBcHBPcHRpb25zID0ge1xuICAgICAgdGFiSWQsXG4gICAgICBmdW5jSWQsXG4gICAgICBhcHBUeXBlOiBBcHBUeXBlLk1lbnUsXG4gICAgICBxdWVyeVN0cmluZ1BhcmFtczogcXVlcnlTdHJpbmdQYXJhbXMsXG4gICAgICBlbnRpdHlQYXJhbXM6IHBhcmFtc01hcCxcbiAgICAgIGFwcElkOiB1bmRlZmluZWQsXG4gICAgICBhcHBFbnRyYW5jZTogdW5kZWZpbmVkLFxuICAgICAgaXNSZWxvYWQ6IHJlbG9hZCxcbiAgICAgIHRhYk5hbWU6IHRhYk5hbWUgfHwgbnVsbFxuICAgIH07XG4gICAgLy8g5ZCv55So5pWw5o2u5Yi35paw5Y+C5pWw5Li6dHJ1ZeaIluiAheayoeacieWumuS5ie+8jOWImeaMieWIt+aWsOWkhOeQhlxuICAgIGVuYWJsZVJlZnJlc2ggPSB0aGlzLmNvbnZlcnRUb0Jvb2xlYW4oZW5hYmxlUmVmcmVzaCwgdHJ1ZSk7XG4gICAgaWYgKGVuYWJsZVJlZnJlc2ggPT09IHRydWUpIHtcbiAgICAgIHRoaXMubWVudVN0YXRlU2VydmljZS5hZGRNZW51U3RhdGUoY3VycmVudFRhYklkLCB0YWJJZCk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLnJ1bnRpbWVGcmFtZXdvcmtTZXJ2aWNlLm9wZW5NZW51JChvcHRpb25zKTtcbiAgfVxuICAvKipcbiAgICog5omT5byA6I+c5Y2VKOW4pue7tOW6pilcbiAgICogQHBhcmFtIHRhYklkIOagueaNrlRhYklk5Yaz5a6a5omT5byA5paw5qCH562+6aG15oiW5a6a5L2N5LmL5YmN5omT5byA55qE5qCH562+6aG1XG4gICAqIEBwYXJhbSBmdW5jSWQg6I+c5Y2VSWRcbiAgICogQHBhcmFtIHBhcmFtcyDlj4LmlbBcbiAgICogQHBhcmFtIHJlbG9hZCDmmK/lkKbph43mlrDliLfmlrBcbiAgICogQHBhcmFtIGVuYWJsZVJlZnJlc2gg5ZCv55So5pWw5o2u5Yi35pawXG4gICAqIEBwYXJhbSBkaW0xIGRpbTFcbiAgICogQHBhcmFtIGRpbTIgZGltMlxuICAgKiBAcGFyYW0gZGVzdHJ1Y3R1cmluZyDop6PmnoTlj4LmlbBcbiAgICovXG4gIHB1YmxpYyBvcGVuTWVudVdpdGhEaW1lbnNpb24odGFiSWQ6IHN0cmluZywgZnVuY0lkOiBzdHJpbmcsIHBhcmFtczogYW55LCBlbmFibGVSZWZyZXNoPzogYW55LCBkaW0xPzogYW55LCBkaW0yPzogYW55LCB0YWJOYW1lPzogc3RyaW5nLCBtZXRhZGF0YUlkPzogc3RyaW5nLCBkZXN0cnVjdHVyaW5nPzogYW55KSB7XG4gICAgaWYgKCFmdW5jSWQgJiYgdGhpcy5mb3JtTm90aWZ5U2VydmljZSkge1xuICAgICAgdGhpcy5mb3JtTm90aWZ5U2VydmljZS53YXJuaW5nKHRoaXMubGFuZ3VhZ2VTZXJ2aWNlLmFwcE9yRnVuY0lkUmVxdWlyZWQsIHsgaGlkZVRpdGxlOiB0cnVlIH0pO1xuICAgICAgcmV0dXJuIEVNUFRZO1xuICAgIH1cbiAgICBpZiAodGFiTmFtZSkge1xuICAgICAgdGFiTmFtZSA9IHRoaXMudHJhbnNsYXRlKHRhYk5hbWUpO1xuICAgIH1cbiAgICBpZiAobWV0YWRhdGFJZCA9PT0gdW5kZWZpbmVkIHx8IG1ldGFkYXRhSWQgPT09IG51bGwpIHtcbiAgICAgIG1ldGFkYXRhSWQgPSAnJztcbiAgICB9XG4gICAgbGV0IHF1ZXJ5U3RyaW5nUGFyYW1zID0gdGhpcy5idWlsZFBhcmFtTWFwKHBhcmFtcyk7XG4gICAgZGVzdHJ1Y3R1cmluZyA9IHRoaXMuY29udmVydFRvQm9vbGVhbihkZXN0cnVjdHVyaW5nLCBmYWxzZSk7XG4gICAgaWYgKGRlc3RydWN0dXJpbmcgPT09IHRydWUpIHtcbiAgICAgIHF1ZXJ5U3RyaW5nUGFyYW1zID0gdGhpcy5idWlsZFBhcmFtKHBhcmFtcyk7XG4gICAgfVxuXG4gICAgY29uc3QgcGFyYW1zTWFwID0gdGhpcy5idWlsZFBhcmFtTWFwKHBhcmFtcyk7XG4gICAgcXVlcnlTdHJpbmdQYXJhbXMuc2V0KCdkaW0xJywgZGltMSA/IGRpbTEgOiAncHVibGljJyk7XG4gICAgcXVlcnlTdHJpbmdQYXJhbXMuc2V0KCdkaW0yJywgZGltMiA/IGRpbTIgOiAncHVibGljJyk7XG4gICAgcXVlcnlTdHJpbmdQYXJhbXMuc2V0KCdtZXRhZGF0YUlkJywgbWV0YWRhdGFJZCk7XG4gICAgcXVlcnlTdHJpbmdQYXJhbXMuc2V0KCdpc1J0YycsICcxJyk7XG4gICAgcXVlcnlTdHJpbmdQYXJhbXMuc2V0KCdpc1Jvb3RNZXRhZGF0YScsICd0cnVlJyk7XG4gICAgY29uc3QgY3VycmVudFRhYklkID0gdGhpcy5xdWVyeXN0cmluZ3MudGFiSWQgfHwgdGhpcy5xdWVyeXN0cmluZ3MuZnVuY0lkIHx8IHRoaXMucXVlcnlzdHJpbmdzLmFwcElkO1xuICAgIGNvbnN0IG9wdGlvbnM6IEFwcE9wdGlvbnMgPSB7XG4gICAgICB0YWJJZCxcbiAgICAgIGZ1bmNJZCxcbiAgICAgIGFwcFR5cGU6IEFwcFR5cGUuTWVudSxcbiAgICAgIHF1ZXJ5U3RyaW5nUGFyYW1zOiBxdWVyeVN0cmluZ1BhcmFtcyxcbiAgICAgIGVudGl0eVBhcmFtczogcGFyYW1zTWFwLFxuICAgICAgYXBwSWQ6IHVuZGVmaW5lZCxcbiAgICAgIGFwcEVudHJhbmNlOiB1bmRlZmluZWQsXG4gICAgICBpc1JlbG9hZDogZmFsc2UsXG4gICAgICB0YWJOYW1lOiB0YWJOYW1lIHx8IG51bGxcbiAgICB9O1xuICAgIC8vIOWQr+eUqOaVsOaNruWIt+aWsOWPguaVsOS4unRydWXmiJbogIXmsqHmnInlrprkuYnvvIzliJnmjInliLfmlrDlpITnkIZcbiAgICAvLyDmsqHmnInkvKDpgJLor6Xlj4LmlbDmiJbor6Xlj4LmlbDkuLrnqbrvvIzliJnorqTkuLrmjInnhafkuYvliY3nmoTpgLvovpHlpITnkIbvvIzpu5jorqTliLfmlrBcbiAgICAvLyBudWxsIGZhbHNlIFwiZmFsc2VcIiBcInRydWVcIiB1bmRlZmluZWRcbiAgICBlbmFibGVSZWZyZXNoID0gdGhpcy5jb252ZXJ0VG9Cb29sZWFuKGVuYWJsZVJlZnJlc2gsIHRydWUpO1xuICAgIGlmIChlbmFibGVSZWZyZXNoID09PSB0cnVlKSB7XG4gICAgICB0aGlzLm1lbnVTdGF0ZVNlcnZpY2UuYWRkTWVudVN0YXRlKGN1cnJlbnRUYWJJZCwgdGFiSWQpO1xuICAgIH1cbiAgICB0aGlzLnJ1bnRpbWVGcmFtZXdvcmtTZXJ2aWNlLm9wZW5NZW51KG9wdGlvbnMpO1xuICB9XG4gIC8qKlxuICAgKiDmiZPlvIDlupTnlKhcbiAgICogQHBhcmFtIHRhYklkIHRhYklkIOagueaNrlRhYklk5Yaz5a6a5omT5byA5paw5qCH562+6aG15oiW5a6a5L2N5LmL5YmN5omT5byA55qE5qCH562+6aG1XG4gICAqIEBwYXJhbSBhcHBJZCDlupTnlKhJZFxuICAgKiBAcGFyYW0gYXBwRW50cmFuY2Ug5bqU55So5YWl5Y+jXG4gICAqIEBwYXJhbSBwYXJhbXMg5Y+C5pWwXG4gICAqIEBwYXJhbSByZWxvYWQg5piv5ZCm6YeN5paw5Yi35pawXG4gICAqIEBwYXJhbSB0YWJOYW1lIHRhYuagh+mimFxuICAgKiBAcGFyYW0gZW5hYmxlUmVmcmVzaCDlkK/nlKjmlbDmja7liLfmlrBcbiAgICogQHBhcmFtIGRlc3RydWN0dXJpbmcg6Kej5p6E5Y+C5pWwXG4gICAqL1xuXG4gIHB1YmxpYyBvcGVuQXBwKHRhYklkOiBzdHJpbmcsIGFwcElkOiBzdHJpbmcsIGFwcEVudHJhbmNlOiBzdHJpbmcsIHBhcmFtczogYW55LCByZWxvYWQ/OiBib29sZWFuLCB0YWJOYW1lPzogc3RyaW5nLCBlbmFibGVSZWZyZXNoPzogYW55LCBkZXN0cnVjdHVyaW5nPzogYW55KSB7XG4gICAgaWYgKCFhcHBJZCAmJiB0aGlzLmZvcm1Ob3RpZnlTZXJ2aWNlKSB7XG4gICAgICB0aGlzLmZvcm1Ob3RpZnlTZXJ2aWNlLndhcm5pbmcodGhpcy5sYW5ndWFnZVNlcnZpY2UuYXBwT3JGdW5jSWRSZXF1aXJlZCwgeyBoaWRlVGl0bGU6IHRydWUgfSk7XG4gICAgICByZXR1cm4gRU1QVFk7XG4gICAgfVxuICAgIGlmICh0YWJOYW1lKSB7XG4gICAgICB0YWJOYW1lID0gdGhpcy50cmFuc2xhdGUodGFiTmFtZSk7XG4gICAgfVxuICAgIGxldCBxdWVyeVN0cmluZ1BhcmFtcyA9IHRoaXMuYnVpbGRQYXJhbU1hcChwYXJhbXMpO1xuICAgIGRlc3RydWN0dXJpbmcgPSB0aGlzLmNvbnZlcnRUb0Jvb2xlYW4oZGVzdHJ1Y3R1cmluZywgZmFsc2UpO1xuICAgIGlmIChkZXN0cnVjdHVyaW5nID09PSB0cnVlKSB7XG4gICAgICBxdWVyeVN0cmluZ1BhcmFtcyA9IHRoaXMuYnVpbGRQYXJhbShwYXJhbXMpO1xuICAgIH1cbiAgICBjb25zdCBwYXJhbXNNYXAgPSB0aGlzLmJ1aWxkUGFyYW1NYXAocGFyYW1zKTtcbiAgICBjb25zdCBjdXJyZW50VGFiSWQgPSB0aGlzLnF1ZXJ5c3RyaW5ncy50YWJJZCB8fCB0aGlzLnF1ZXJ5c3RyaW5ncy5mdW5jSWQgfHwgdGhpcy5xdWVyeXN0cmluZ3MuYXBwSWQ7XG4gICAgY29uc3Qgb3B0aW9uczogQXBwT3B0aW9ucyA9IHtcbiAgICAgIHRhYklkLFxuICAgICAgYXBwSWQsXG4gICAgICBhcHBFbnRyYW5jZSxcbiAgICAgIGZ1bmNJZDogdW5kZWZpbmVkLFxuICAgICAgYXBwVHlwZTogQXBwVHlwZS5BcHAsXG4gICAgICBxdWVyeVN0cmluZ1BhcmFtczogcXVlcnlTdHJpbmdQYXJhbXMsXG4gICAgICBlbnRpdHlQYXJhbXM6IHBhcmFtc01hcCxcbiAgICAgIGlzUmVsb2FkOiByZWxvYWQsXG4gICAgICB0YWJOYW1lOiB0YWJOYW1lIHx8IG51bGxcbiAgICB9O1xuICAgIGVuYWJsZVJlZnJlc2ggPSB0aGlzLmNvbnZlcnRUb0Jvb2xlYW4oZW5hYmxlUmVmcmVzaCwgdHJ1ZSk7XG4gICAgaWYgKGVuYWJsZVJlZnJlc2ggPT09IHRydWUpIHtcbiAgICAgIHRoaXMubWVudVN0YXRlU2VydmljZS5hZGRNZW51U3RhdGUoY3VycmVudFRhYklkLCB0YWJJZCk7XG4gICAgfVxuICAgIHRoaXMucnVudGltZUZyYW1ld29ya1NlcnZpY2Uub3Blbk1lbnUob3B0aW9ucyk7XG4gIH1cbiAgLyoqXG4gICAqIOaJk+W8gOW6lOeUqCjmtYHlvI8pXG4gICAqIEBwYXJhbSB0YWJJZCB0YWJJZCDmoLnmja5UYWJJZOWGs+WumuaJk+W8gOaWsOagh+etvumhteaIluWumuS9jeS5i+WJjeaJk+W8gOeahOagh+etvumhtVxuICAgKiBAcGFyYW0gYXBwSWQg5bqU55SoSWRcbiAgICogQHBhcmFtIGFwcEVudHJhbmNlIOW6lOeUqOWFpeWPo1xuICAgKiBAcGFyYW0gcGFyYW1zIOWPguaVsFxuICAgKiBAcGFyYW0gcmVsb2FkIOaYr+WQpumHjeaWsOWIt+aWsFxuICAgKiBAcGFyYW0gdGFiTmFtZSB0YWLmoIfpophcbiAgICogQHBhcmFtIGVuYWJsZVJlZnJlc2gg5ZCv55So5pWw5o2u5Yi35pawXG4gICAqIEBwYXJhbSBkZXN0cnVjdHVyaW5nIOino+aehOWPguaVsFxuICAgKi9cbiAgcHVibGljIG9wZW5BcHAkKHRhYklkOiBzdHJpbmcsIGFwcElkOiBzdHJpbmcsIGFwcEVudHJhbmNlOiBzdHJpbmcsIHBhcmFtczogYW55LCByZWxvYWQ/OiBib29sZWFuLCB0YWJOYW1lPzogc3RyaW5nLCBlbmFibGVSZWZyZXNoPzogYW55LCBkZXN0cnVjdHVyaW5nPzogYW55KSB7XG4gICAgaWYgKCFhcHBJZCAmJiB0aGlzLmZvcm1Ob3RpZnlTZXJ2aWNlKSB7XG4gICAgICB0aGlzLmZvcm1Ob3RpZnlTZXJ2aWNlLndhcm5pbmcodGhpcy5sYW5ndWFnZVNlcnZpY2UuYXBwT3JGdW5jSWRSZXF1aXJlZCwgeyBoaWRlVGl0bGU6IHRydWUgfSk7XG4gICAgICByZXR1cm4gRU1QVFk7XG4gICAgfVxuICAgIGlmICh0YWJOYW1lKSB7XG4gICAgICB0YWJOYW1lID0gdGhpcy50cmFuc2xhdGUodGFiTmFtZSk7XG4gICAgfVxuICAgIGxldCBxdWVyeVN0cmluZ1BhcmFtcyA9IHRoaXMuYnVpbGRQYXJhbU1hcChwYXJhbXMpO1xuICAgIGRlc3RydWN0dXJpbmcgPSB0aGlzLmNvbnZlcnRUb0Jvb2xlYW4oZGVzdHJ1Y3R1cmluZywgZmFsc2UpO1xuICAgIGlmIChkZXN0cnVjdHVyaW5nID09PSB0cnVlKSB7XG4gICAgICBxdWVyeVN0cmluZ1BhcmFtcyA9IHRoaXMuYnVpbGRQYXJhbShwYXJhbXMpO1xuICAgIH1cbiAgICBjb25zdCBwYXJhbXNNYXAgPSB0aGlzLmJ1aWxkUGFyYW1NYXAocGFyYW1zKTtcbiAgICBjb25zdCBjdXJyZW50VGFiSWQgPSB0aGlzLnF1ZXJ5c3RyaW5ncy50YWJJZCB8fCB0aGlzLnF1ZXJ5c3RyaW5ncy5mdW5jSWQgfHwgdGhpcy5xdWVyeXN0cmluZ3MuYXBwSWQ7XG4gICAgY29uc3Qgb3B0aW9uczogQXBwT3B0aW9ucyA9IHtcbiAgICAgIHRhYklkLFxuICAgICAgYXBwSWQsXG4gICAgICBhcHBFbnRyYW5jZSxcbiAgICAgIGZ1bmNJZDogdW5kZWZpbmVkLFxuICAgICAgYXBwVHlwZTogQXBwVHlwZS5BcHAsXG4gICAgICBxdWVyeVN0cmluZ1BhcmFtczogcXVlcnlTdHJpbmdQYXJhbXMsXG4gICAgICBlbnRpdHlQYXJhbXM6IHBhcmFtc01hcCxcbiAgICAgIGlzUmVsb2FkOiByZWxvYWQsXG4gICAgICB0YWJOYW1lOiB0YWJOYW1lIHx8IG51bGxcbiAgICB9O1xuICAgIGVuYWJsZVJlZnJlc2ggPSB0aGlzLmNvbnZlcnRUb0Jvb2xlYW4oZW5hYmxlUmVmcmVzaCwgdHJ1ZSk7XG4gICAgaWYgKGVuYWJsZVJlZnJlc2ggPT09IHRydWUpIHtcbiAgICAgIHRoaXMubWVudVN0YXRlU2VydmljZS5hZGRNZW51U3RhdGUoY3VycmVudFRhYklkLCB0YWJJZCk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLnJ1bnRpbWVGcmFtZXdvcmtTZXJ2aWNlLm9wZW5NZW51JChvcHRpb25zKTtcbiAgfVxuICAvKipcbiAgICog5YWz6ZetXG4gICAqIEBwYXJhbSBvbkNsb3NlaW5nIOWFs+mXreWJjeS6i+S7tuWkhOeQhuWZqFxuICAgKi9cbiAgcHVibGljIGNsb3NlKCkge1xuICAgIGNvbnN0IG9wdGlvbnMgPSB0aGlzLnF1ZXJ5c3RyaW5ncztcbiAgICBjb25zdCB7IGlzRGlhbG9nQ29tcG9uZW50OiBpc0luRGlhbG9nLCByb290Q29tcG9uZW50IH0gPSB0aGlzLmZpbmREaWFsb2coKTtcbiAgICBpZiAoaXNJbkRpYWxvZykge1xuICAgICAgY29uc3QgbW9kYWxSZWYgPSB0aGlzLmdldChyb290Q29tcG9uZW50LCAnZGlhbG9nUmVmJyk7XG4gICAgICBtb2RhbFJlZlsnY2xvc2UnXSgpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBvcHRpb25zLnRva2VuID0gb3B0aW9ucy5mb3JtVG9rZW47XG4gICAgdGhpcy5ydW50aW1lRnJhbWV3b3JrU2VydmljZS5iZWZvcmVDbG9zZU1lbnUob3B0aW9ucyk7XG4gIH1cbiAgLyoqXG4gICAqIOW8uuWItuWFs+mXrVxuICAgKi9cbiAgcHVibGljIGRlc3RvcnkoKSB7XG4gICAgY29uc3Qgb3B0aW9ucyA9IHRoaXMucXVlcnlzdHJpbmdzO1xuICAgIG9wdGlvbnMudG9rZW4gPSBvcHRpb25zLmZvcm1Ub2tlbjtcbiAgICB0aGlzLnJ1bnRpbWVGcmFtZXdvcmtTZXJ2aWNlLmNsb3NlTWVudShvcHRpb25zKTtcbiAgfVxuICAvKipcbiAgICogXG4gICAqIEBwYXJhbSBwYXJhbXMgcGFyYW1zXG4gICAqIEBkZXByZWNhdGVkIOW+heW6n+W8g++8jOS4jmJ1aWxkUGFyYW1NYXDph43lpI1cbiAgICovXG4gIHByaXZhdGUgcGFyc2VQYXJhbXMocGFyYW1zOiBhbnkpIHtcbiAgICBpZiAodHlwZW9mIHBhcmFtcyA9PT0gJ3VuZGVmaW5lZCcgfHwgcGFyYW1zID09PSBudWxsIHx8ICh0eXBlb2YgcGFyYW1zID09PSAnc3RyaW5nJyAmJiBwYXJhbXMubGVuZ3RoIDwgMSkpIHtcbiAgICAgIHBhcmFtcyA9IHt9O1xuICAgIH1cbiAgICBjb25zdCBwYXJhbU1hcCA9IG5ldyBNYXA8c3RyaW5nLCBhbnk+KCk7XG4gICAgaWYgKHR5cGVvZiBwYXJhbXMgPT09ICdvYmplY3QnKSB7XG4gICAgICBwYXJhbXMgPSBKU09OLnN0cmluZ2lmeShwYXJhbXMpO1xuICAgIH1cbiAgICBwYXJhbXMgPSB3aW5kb3dbJ2VuY29kZVVSSUNvbXBvbmVudCddKHBhcmFtcyk7XG4gICAgcGFyYW1NYXAuc2V0KCdXRUJfRk9STV9ST1VURV9QQVJBTVMnLCBwYXJhbXMpO1xuICAgIHJldHVybiBwYXJhbU1hcDtcbiAgfVxuICAvKipcbiAgICog5rOo5YaM5LqL5Lu255uR5ZCs5ZmoXG4gICAqIEBwYXJhbSBldmVudFR5cGUg5LqL5Lu257G75Z6LIG9uVGFiQ2xvc2VkXG4gICAqIEBwYXJhbSBoYW5kbGVyIOWkhOeQhuWZqFxuICAgKiBAcmV0dXJucyBzdHJpbmcg6L+U5Zue5LqL5Lu25qCH6K+GXG4gICAqL1xuICBwdWJsaWMgYWRkRXZlbnRMaXN0ZW5lcihldmVudFR5cGU6IHN0cmluZywgaGFuZGxlcjogKG9wdGlvbnM6IEFwcE9wdGlvbnMpID0+IGFueSk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMubmF2aWdhdGlvbkV2ZW50U2VydmljZS5hZGRFdmVudExpc3RlbmVyKGV2ZW50VHlwZSwgaGFuZGxlcik7XG4gIH1cbiAgLyoqXG4gICAqIOenu+mZpOS6i+S7tuebkeWQrOWZqFxuICAgKiBAcGFyYW0gZXZlbnRUeXBlIOS6i+S7tuexu+WeiyBvblRhYkNsb3NlZCB8IG9uVGFiQ2xvc2VpbmdcbiAgICogQHBhcmFtIGtleSDkuovku7bmoIfor4ZcbiAgICovXG4gIHB1YmxpYyByZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50VHlwZTogc3RyaW5nLCBrZXk6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLm5hdmlnYXRpb25FdmVudFNlcnZpY2UucmVtb3ZlRXZlbnRMaXN0ZW5lcihldmVudFR5cGUsIGtleSk7XG4gIH1cbiAgLyoqXG4gICAqIOa4heepuuS6i+S7tuebkeWQrOWZqFxuICAgKiBAcGFyYW0gZXZlbnRUeXBlIOS6i+S7tuexu+Wei1xuICAgKi9cbiAgcHVibGljIGNsZWFyRXZlbnRMaXN0ZW5lcihldmVudFR5cGU6IHN0cmluZyk6IHZvaWQge1xuICAgIHRoaXMubmF2aWdhdGlvbkV2ZW50U2VydmljZS5jbGVhckV2ZW50TGlzdGVuZXIoZXZlbnRUeXBlKTtcbiAgfVxuICAvKipcbiAgICog5Lul5by55qGG44CB5L6n6L655qCP5oiW5paw5qCH562+6aG15pa55byP5omT5byA6KGo5Y2VXG4gICAqIEBwYXJhbSBtb2RlIOaJk+W8gOaWueW8j++8jOaUr+aMgWBtb2RhbGDlvLnnqpfjgIFgc2lkZWJhcmDkvqfovrnmoI/jgIFgdGFiYOaWsOagh+etvumhtVxuICAgKiBAcGFyYW0gbW9kYWxJZCDlvLnnqpdpZO+8jOWmguaenG1vZGU9YG1vZGFsYOS4lOayoeaciXVybO+8jFxuICAgKiBAcGFyYW0gY29uZmlncyDlvLnnqpfphY3nva5cbiAgICogQHBhcmFtIHVybCDov5znq6/ooajljZV1cmxcbiAgICogQHBhcmFtIHRhYklkIOagh+etvumhtWlk77yMbW9kYWw9dGFi5pe25b+F5aGrXG4gICAqIEBwYXJhbSB0YWJUeXBlIOagh+etvumhteexu+Wei++8jGBtZW51YCDmiJZgYXBwYFxuICAgKiBAcGFyYW0gZnVuY09yQXBwSWQg6I+c5Y2V5oiW5bqU55SoaWRcbiAgICogQHBhcmFtIGFwcEVudHJhbmNlIOW6lOeUqOWFpeWPo1xuICAgKiBAcGFyYW0gcGFyYW1zIOWPguaVsFxuICAgKiBAcGFyYW0gdGFiTmFtZSDmlrDmoIfnrb7pobXlkI3np7BcbiAgICogQHBhcmFtIGVuYWJsZVJlZnJlc2gg5ZCv55So5ZCv5Yqo5Yi35pawXG4gICAqIEBwYXJhbSBkZXN0cnVjdHVyaW5nIOaYr+WQpuino+aehFxuICAgKi9cbiAgcHVibGljIG9wZW4obW9kZTogJ21vZGFsJyB8ICdzaWRlYmFyJyB8ICd0YWInLCBtb2RhbElkPzogc3RyaW5nLCB1cmw/OiBzdHJpbmcsIGNvbmZpZ3M/OiBhbnksIHRhYklkPzogc3RyaW5nLCB0YWJUeXBlPzogJ21lbnUnIHwgJ2FwcCcsIGZ1bmNPckFwcElkPzogc3RyaW5nLCBhcHBFbnRyYW5jZT86IHN0cmluZywgcGFyYW1zPzogYW55LCB0YWJOYW1lPzogc3RyaW5nLCBlbmFibGVSZWZyZXNoPzogYW55LCBkZXN0cnVjdHVyaW5nPzogYW55KSB7XG4gICAgY29uc3QgcGFnZU1vZGFsU2VydmljZSA9IHRoaXMuaW5qZWN0b3IuZ2V0PEZFUGFnZU1vZGFsU2VydmljZT4oRkVQYWdlTW9kYWxTZXJ2aWNlLCBudWxsKTtcbiAgICBpZiAoIXBhZ2VNb2RhbFNlcnZpY2UpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignZ2V0IEZFUGFnZU1vZGFsU2VydmljZSBmYWlsZWQuJyk7XG4gICAgfVxuICAgIC8vIOagoemqjOWPguaVsOaYr+WQpuWQiOazlVxuICAgIGlmICghbW9kZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdbTmF2aWdhdGlvblNlcnZpY2VdLT5vcGVuLG1vZGXlj4LmlbDkuI3og73kuLrnqbrvvIEnKTtcbiAgICB9XG4gICAgaWYgKG1vZGUgPT09ICdtb2RhbCcgfHwgbW9kZSA9PT0gJ3NpZGViYXInKSB7XG4gICAgICBpZiAoIW1vZGFsSWQgJiYgIXVybCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ+W8ueeql+WPiuS+p+i+ueagj+aooeW8j+aXtuW8ueeql+WuueWZqGlk5ZKM6KGo5Y2V6Lev5b6E5LiN6IO95ZCM5pe25Li656m677yBJyk7XG4gICAgICB9XG4gICAgICBpZiAobW9kYWxJZCAmJiB1cmwpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCflvLnnqpflj4rkvqfovrnmoI/mqKHlvI/ml7blvLnnqpflrrnlmahpZOWSjOihqOWNlei3r+W+hOS4jeiDveWQjOaXtuWtmOWcqO+8gScpO1xuICAgICAgfVxuICAgICAgY29uc3QgdWlTdGF0ZUNvbmZpZyA9IHRoaXMuZ2V0T2JqZWN0VHlwZUNvbmZpZyhwYXJhbXMpO1xuICAgICAgY29uc3QgbW9kYWxDb25maWcgPSB0aGlzLmJ1aWxkQ29uZmlncyhjb25maWdzKTtcbiAgICAgIGlmIChtb2RlID09PSAnc2lkZWJhcicpIHtcbiAgICAgICAgbW9kYWxDb25maWcuZGlhbG9nVHlwZSA9IG1vZGU7XG4gICAgICB9XG4gICAgICBsZXQgcGFnZU1vZGFsUmVmID0gbnVsbDtcbiAgICAgIGlmIChtb2RhbElkKSB7XG4gICAgICAgIGNvbnN0IGZhcnJpc0Zvcm1TZXJ2aWNlID0gdGhpcy5pbmplY3Rvci5nZXQ8RmFycmlzRm9ybVNlcnZpY2U+KEZhcnJpc0Zvcm1TZXJ2aWNlLCBudWxsKTtcbiAgICAgICAgaWYgKCFmYXJyaXNGb3JtU2VydmljZSkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBsZXQgY29tcG9uZW50VHlwZSA9IGZhcnJpc0Zvcm1TZXJ2aWNlLmdldENvbnRyb2xzKG1vZGFsSWQpO1xuICAgICAgICBjb25zdCBjb21wb25lbnRSZWYgPSB0aGlzLmNyZWF0ZUNvbXBvbmVudFJlZihjb21wb25lbnRUeXBlLCB1aVN0YXRlQ29uZmlnKTtcbiAgICAgICAgcGFnZU1vZGFsUmVmID0gcGFnZU1vZGFsU2VydmljZS5zaG93KGNvbXBvbmVudFJlZiwgbW9kYWxDb25maWcpO1xuICAgICAgfSBlbHNlIGlmICh1cmwpIHtcbiAgICAgICAgcGFnZU1vZGFsUmVmID0gcGFnZU1vZGFsU2VydmljZS5zaG93QnlVcmwodXJsLCBtb2RhbENvbmZpZyk7XG4gICAgICB9XG4gICAgICBpZiAocGFnZU1vZGFsUmVmICYmICEhcGFnZU1vZGFsUmVmLmNvbnRlbnQpIHtcbiAgICAgICAgcGFnZU1vZGFsUmVmLmNvbnRlbnQuaXNEaWFsb2dSb290Q29tcG9uZW50ID0gdHJ1ZTtcbiAgICAgICAgcGFnZU1vZGFsUmVmLmNvbnRlbnQuZGlhbG9nUmVmID0gcGFnZU1vZGFsUmVmO1xuICAgICAgICBjb25zdCBoZWFkZXIgPSBwYWdlTW9kYWxSZWYuZGlhbG9nICYmIHBhZ2VNb2RhbFJlZi5kaWFsb2cuaW5zdGFuY2UgJiYgcGFnZU1vZGFsUmVmLmRpYWxvZy5pbnN0YW5jZS5lbCAmJiBwYWdlTW9kYWxSZWYuZGlhbG9nLmluc3RhbmNlLmVsLm5hdGl2ZUVsZW1lbnQgJiYgcGFnZU1vZGFsUmVmLmRpYWxvZy5pbnN0YW5jZS5lbC5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZi1wYWdlLWhlYWRlclwiKTtcbiAgICAgICAgaWYgKGhlYWRlciAmJiBwYWdlTW9kYWxSZWYuZGlhbG9nLmluc3RhbmNlLmRyYWdnYmFyKSB7XG4gICAgICAgICAgcGFnZU1vZGFsUmVmLmRpYWxvZy5pbnN0YW5jZS5kcmFnZ2Jhci5oYW5kbGUgPSBoZWFkZXI7XG4gICAgICAgICAgaGVhZGVyLnN0eWxlLmN1cnNvciA9ICdtb3ZlJztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSBpZiAobW9kZSA9PT0gJ3RhYicpIHtcbiAgICAgIGlmICghdGFiSWQgfHwgIXRhYlR5cGUgfHwgIWZ1bmNPckFwcElkKSB7XG4gICAgICAgIGlmICh0aGlzLmZvcm1Ob3RpZnlTZXJ2aWNlKSB7XG4gICAgICAgICAgdGhpcy5mb3JtTm90aWZ5U2VydmljZS53YXJuaW5nKHRoaXMubGFuZ3VhZ2VTZXJ2aWNlLmFwcE9yRnVuY0lkUmVxdWlyZWQsIHsgaGlkZVRpdGxlOiB0cnVlIH0pO1xuICAgICAgICB9XG4gICAgICAgIHRocm93IG5ldyBFcnJvcign5paw5qCH562+5qih5byP5pe25qCH562+6aG1aWTjgIHmoIfnrb7nsbvlnovjgIHoj5zljZXmiJblupTnlKhpZOWdh+S4jeiDveS4uuepuu+8gScpO1xuICAgICAgfVxuICAgICAgaWYgKHRhYlR5cGUgPT09ICdhcHAnICYmICFhcHBFbnRyYW5jZSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ+S7peW6lOeUqOaWueW8j+aJk+W8gOaXtuWFpeWPo+W6lOeUqOS4jeiDveS4uuepuu+8gScpO1xuICAgICAgfVxuICAgICAgaWYgKHRhYlR5cGUgPT0gJ2FwcCcpIHtcbiAgICAgICAgdGhpcy5vcGVuQXBwKHRhYklkLCBmdW5jT3JBcHBJZCwgYXBwRW50cmFuY2UsIHBhcmFtcywgZmFsc2UsIHRhYk5hbWUsIGVuYWJsZVJlZnJlc2gsIGRlc3RydWN0dXJpbmcpO1xuICAgICAgfSBlbHNlIGlmICh0YWJUeXBlID09PSAnbWVudScpIHtcbiAgICAgICAgdGhpcy5vcGVuTWVudSh0YWJJZCwgZnVuY09yQXBwSWQsIHBhcmFtcywgZmFsc2UsIGVuYWJsZVJlZnJlc2gsIHRhYk5hbWUsIGRlc3RydWN0dXJpbmcpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ+S4jeaUr+aMgeeahOaooeW8j++8gScpO1xuICAgIH1cbiAgICAvLyB0aGlzLnBhZ2VNb2RhbFNlcnZpY2UuXG4gIH1cbiAgLyoqXG4gICAqIGluIGFwcCBuYXZpZ2F0ZVxuICAgKiBAcGFyYW0gY29tbWFuZHMgY29tbWFuZHNcbiAgICovXG4gIC8vIHB1YmxpYyBuYXZpZ2F0ZShjb21tYW5kczogYW55W10pO1xuICAvKipcbiAgICogaW4gYXBwIG5hdmlnYXRlXG4gICAqIEBwYXJhbSBjb21tYW5kcyBjb21tYW5kc1xuICAgKiBAcGFyYW0gb3B0aW9ucyBvcHRpb25zXG4gICAqIEBkZXNjcmlwdGlvbiBvcHRpb25zOnsgcmVsYXRpdmVUbzogdGhpcy5hY3RpdmF0ZWRSb3V0ZSwgcXVlcnlQYXJhbXM6e2E6MSxiOjJ9LGV0YzouLi59XG4gICAqL1xuICBwdWJsaWMgbmF2aWdhdGUoY29tbWFuZHM6IGFueVtdLCBvcHRpb25zPzogYW55KTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgY29uc3Qgcm91dGVyID0gdGhpcy5pbmplY3RvciAmJiB0aGlzLmluamVjdG9yLmdldDxSb3V0ZXI+KFJvdXRlciwgbnVsbCk7XG4gICAgY29uc3QgYWN0aXZhdGVkUm91dGUgPSB0aGlzLmluamVjdG9yICYmIHRoaXMuaW5qZWN0b3IuZ2V0PEFjdGl2YXRlZFJvdXRlPihBY3RpdmF0ZWRSb3V0ZSwgbnVsbCk7XG4gICAgY29uc3QgcXVlcnlQYXJhbXMgPSBsb2Rhc2gubWVyZ2Uoe30sIHRoaXMucXVlcnlzdHJpbmdzLCBvcHRpb25zICYmIG9wdGlvbnMucXVlcnlQYXJhbXMgfHwge30pO1xuICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMuaGFzT3duUHJvcGVydHkoJ3F1ZXJ5UGFyYW1zJykpIHtcbiAgICAgIGRlbGV0ZSBvcHRpb25zLnF1ZXJ5UGFyYW1zO1xuICAgIH1cbiAgICBjb25zdCBleHRyYXMgPSBsb2Rhc2gubWVyZ2UoeyBza2lwTG9jYXRpb25DaGFuZ2U6IGZhbHNlLCByZWxhdGl2ZVRvOiBhY3RpdmF0ZWRSb3V0ZSwgcXVlcnlQYXJhbXMgfSwgb3B0aW9ucyB8fCB7fSk7XG4gICAgaWYgKHJvdXRlcikge1xuICAgICAgcmV0dXJuIHJvdXRlci5uYXZpZ2F0ZShjb21tYW5kcywgZXh0cmFzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG4gIC8vICNlbmRyZWdpb25cblxuICAvLyAjcmVnaW9uIOengeacieaWueazlVxuXG4gIC8qKlxuICAgKiDlsIHoo4Xot6/nlLHlj4LmlbBcbiAgICogQHBhcmFtIHBhcmFtcyDlj4LmlbBcbiAgICogQHBhcmFtIG9wdGlvbnMg6YWN572u5Y+C5pWwXG4gICAqL1xuICBwcml2YXRlIGJ1aWxkUGFyYW1NYXAocGFyYW1zOiBhbnksIG9wdGlvbnM/OiBhbnkpOiBNYXA8c3RyaW5nLCBzdHJpbmc+IHtcbiAgICBpZiAodHlwZW9mIHBhcmFtcyA9PT0gJ3VuZGVmaW5lZCcgfHwgcGFyYW1zID09PSBudWxsIHx8ICh0eXBlb2YgcGFyYW1zID09PSAnc3RyaW5nJyAmJiBwYXJhbXMubGVuZ3RoIDwgMSkpIHtcbiAgICAgIHBhcmFtcyA9IHt9O1xuICAgIH1cbiAgICBjb25zdCBwYXJhbU1hcCA9IG5ldyBNYXA8c3RyaW5nLCBhbnk+KCk7XG4gICAgaWYgKG9wdGlvbnMgJiYgT2JqZWN0LmtleXMob3B0aW9ucykubGVuZ3RoID4gMCkge1xuICAgICAgaWYgKHR5cGVvZiBwYXJhbXMgIT09ICdvYmplY3QnKSB7XG4gICAgICAgIHBhcmFtcyA9IEpTT04ucGFyc2UocGFyYW1zKTtcbiAgICAgIH1cbiAgICAgIHBhcmFtcyA9IGxvZGFzaC5tZXJnZShwYXJhbXMsIG9wdGlvbnMpO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIHBhcmFtcyA9PT0gJ29iamVjdCcpIHtcbiAgICAgIHBhcmFtcyA9IEpTT04uc3RyaW5naWZ5KHBhcmFtcyk7XG4gICAgfVxuICAgIGNvbnN0IGN1cnJlbnRUYWJJZCA9IHRoaXMucXVlcnlzdHJpbmdzLnRhYklkIHx8IHRoaXMucXVlcnlzdHJpbmdzLmZ1bmNJZCB8fCB0aGlzLnF1ZXJ5c3RyaW5ncy5hcHBJZDtcbiAgICBwYXJhbXMgPSB3aW5kb3dbJ2VuY29kZVVSSUNvbXBvbmVudCddKHBhcmFtcyk7XG4gICAgcGFyYW1NYXAuc2V0KCdXRUJfRk9STV9ST1VURV9QQVJBTVMnLCBwYXJhbXMpO1xuICAgIHBhcmFtTWFwLnNldCgnV0VCX0ZPUk1fUk9VVEVSX1BBUkVOVF9JRCcsIGN1cnJlbnRUYWJJZCk7XG4gICAgcmV0dXJuIHBhcmFtTWFwO1xuICB9XG4gIHByaXZhdGUgYnVpbGRQYXJhbShwYXJhbXMsIG9wdGlvbnM/OiBhbnkpOiBNYXA8c3RyaW5nLCBzdHJpbmc+IHtcbiAgICBpZiAodHlwZW9mIHBhcmFtcyA9PT0gJ3VuZGVmaW5lZCcgfHwgcGFyYW1zID09PSBudWxsIHx8ICh0eXBlb2YgcGFyYW1zID09PSAnc3RyaW5nJyAmJiBwYXJhbXMubGVuZ3RoIDwgMSkpIHtcbiAgICAgIHBhcmFtcyA9IHt9O1xuICAgIH1cbiAgICBjb25zdCBwYXJhbU1hcCA9IG5ldyBNYXA8c3RyaW5nLCBhbnk+KCk7XG4gICAgaWYgKG9wdGlvbnMgJiYgT2JqZWN0LmtleXMob3B0aW9ucykubGVuZ3RoID4gMCkge1xuICAgICAgaWYgKHR5cGVvZiBwYXJhbXMgIT09ICdvYmplY3QnKSB7XG4gICAgICAgIHBhcmFtcyA9IEpTT04ucGFyc2UocGFyYW1zKTtcbiAgICAgIH1cbiAgICAgIHBhcmFtcyA9IGxvZGFzaC5tZXJnZShwYXJhbXMsIG9wdGlvbnMpO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIHBhcmFtcyAhPT0gJ29iamVjdCcpIHtcbiAgICAgIHBhcmFtcyA9IEpTT04ucGFyc2UocGFyYW1zKTtcbiAgICB9XG4gICAgT2JqZWN0LmtleXMocGFyYW1zKS5mb3JFYWNoKGtleSA9PiB7XG4gICAgICBwYXJhbU1hcC5zZXQoa2V5LCBwYXJhbXNba2V5XSk7XG4gICAgfSk7XG4gICAgY29uc3QgY3VycmVudFRhYklkID0gdGhpcy5xdWVyeXN0cmluZ3MudGFiSWQgfHwgdGhpcy5xdWVyeXN0cmluZ3MuZnVuY0lkIHx8IHRoaXMucXVlcnlzdHJpbmdzLmFwcElkO1xuICAgIHBhcmFtcyA9IHdpbmRvd1snZW5jb2RlVVJJQ29tcG9uZW50J10ocGFyYW1zKTtcbiAgICBwYXJhbU1hcC5zZXQoJ1dFQl9GT1JNX1JPVVRFX1BBUkFNUycsIHBhcmFtcyk7XG4gICAgcGFyYW1NYXAuc2V0KCdXRUJfRk9STV9ST1VURVJfUEFSRU5UX0lEJywgY3VycmVudFRhYklkKTtcbiAgICByZXR1cm4gcGFyYW1NYXA7XG4gIH1cbiAgLyoqXG4gICAqIOafpeaJvuW8ueeql+e7hOS7tlxuICAgKi9cbiAgcHJpdmF0ZSBmaW5kRGlhbG9nKCkge1xuICAgIGxldCBmcmFtZUNvbnRleHQgPSB0aGlzLmdldCh0aGlzLCAnY29tbWFuZENvbnRleHQuZnJhbWVDb250ZXh0Jyk7XG4gICAgbGV0IGlzRGlhbG9nQ29tcG9uZW50ID0gdGhpcy5nZXQoZnJhbWVDb250ZXh0LCAnZnJhbWVDb21wb25lbnQuaXNEaWFsb2dSb290Q29tcG9uZW50JywgZmFsc2UpO1xuXG4gICAgbGV0IHBhcmVudEZyYW1lQ29udGV4dCA9IHRoaXMuZ2V0KGZyYW1lQ29udGV4dCwgJ3BhcmVudCcpO1xuICAgIHdoaWxlIChwYXJlbnRGcmFtZUNvbnRleHQgIT0gbnVsbCAmJiAhaXNEaWFsb2dDb21wb25lbnQpIHtcbiAgICAgIGZyYW1lQ29udGV4dCA9IHRoaXMuZ2V0KGZyYW1lQ29udGV4dCwgJ3BhcmVudCcpO1xuICAgICAgcGFyZW50RnJhbWVDb250ZXh0ID0gdGhpcy5nZXQocGFyZW50RnJhbWVDb250ZXh0LCAncGFyZW50Jyk7XG4gICAgICBpc0RpYWxvZ0NvbXBvbmVudCA9IHRoaXMuZ2V0KGZyYW1lQ29udGV4dCwgJ2ZyYW1lQ29tcG9uZW50LmlzRGlhbG9nUm9vdENvbXBvbmVudCcsIGZhbHNlKTtcbiAgICB9XG4gICAgY29uc3Qgcm9vdENvbXBvbmVudCA9IHRoaXMuZ2V0KGZyYW1lQ29udGV4dCwgJ2ZyYW1lQ29tcG9uZW50Jyk7XG4gICAgcmV0dXJuIHsgaXNEaWFsb2dDb21wb25lbnQsIHJvb3RDb21wb25lbnQgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBsb2Fkc2ggZ2V0XG4gICAqIEBwYXJhbSBvYmplY3Qg5a+56LGhXG4gICAqIEBwYXJhbSBwYXRoIOi3r+W+hFxuICAgKiBAcGFyYW0gZGVmYXVsdFZhbCDpu5jorqTlgLxcbiAgICovXG4gIHByaXZhdGUgZ2V0KG9iamVjdDogYW55LCBwYXRoOiBBcnJheTxzdHJpbmc+IHwgc3RyaW5nLCBkZWZhdWx0VmFsOiBhbnkgPSBudWxsKSB7XG4gICAgY29uc3QgUEFUSCA9IEFycmF5LmlzQXJyYXkocGF0aClcbiAgICAgID8gcGF0aFxuICAgICAgOiBwYXRoLnNwbGl0KCcuJykuZmlsdGVyKGkgPT4gaS5sZW5ndGgpO1xuICAgIGlmICghUEFUSC5sZW5ndGgpIHtcbiAgICAgIHJldHVybiBvYmplY3QgPT09IHVuZGVmaW5lZCA/IGRlZmF1bHRWYWwgOiBvYmplY3Q7XG4gICAgfVxuXG4gICAgaWYgKG9iamVjdCA9PT0gbnVsbCB8fCBvYmplY3QgPT09IHVuZGVmaW5lZCB8fCB0eXBlb2YgKG9iamVjdFtQQVRIWzBdXSkgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICByZXR1cm4gZGVmYXVsdFZhbDtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5nZXQob2JqZWN0W1BBVEguc2hpZnQoKV0sIFBBVEgsIGRlZmF1bHRWYWwpO1xuICB9XG4gIHByaXZhdGUgY29udmVydFRvQm9vbGVhbih2YWx1ZTogYW55LCBkZWZhdWx0VmFsOiBib29sZWFuID0gZmFsc2UpIHtcbiAgICBpZiAodHlwZW9mIHZhbHVlID09PSAndW5kZWZpbmVkJyB8fCB2YWx1ZSA9PT0gbnVsbCkge1xuICAgICAgdmFsdWUgPSBkZWZhdWx0VmFsO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgdmFsdWUgPSB2YWx1ZSB8fCBTdHJpbmcoZGVmYXVsdFZhbCk7XG4gICAgICB2YWx1ZSA9IHZhbHVlID09PSAndHJ1ZScgPyB0cnVlIDogZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiB2YWx1ZTtcbiAgfVxuICAvKipcbiAgICog57+76K+R6LWE5rqQ6aG5XG4gICAqIEBwYXJhbSBrZXkg6LWE5rqQ6aG5a2V5XG4gICAqL1xuICBwcml2YXRlIHRyYW5zbGF0ZShrZXk6IHN0cmluZykge1xuICAgIGNvbnN0IHRyYW5zbGF0ZVNlcnZpY2UgPSB0aGlzLmluamVjdG9yICYmIHRoaXMuaW5qZWN0b3IuZ2V0PFRyYW5zbGF0ZT4oVHJhbnNsYXRlVG9rZW4sIG51bGwpIHx8IG51bGw7XG4gICAgaWYgKHRyYW5zbGF0ZVNlcnZpY2UgJiYga2V5ICYmIGtleS5zdGFydHNXaXRoKCd7eycpICYmIGtleS5lbmRzV2l0aCgnfX0nKSkge1xuICAgICAga2V5ID0ga2V5LnJlcGxhY2UoJ3t7JywgJycpLnJlcGxhY2UoJ319JywgJycpLnRyaW0oKTtcbiAgICAgIHJldHVybiB0cmFuc2xhdGVTZXJ2aWNlLnRyYW5zZm9ybShrZXksIG51bGwpO1xuICAgIH1cbiAgICByZXR1cm4ga2V5O1xuICB9XG4gIC8vICNlbmRyZWdpb25cblxuICAvLyNyZWdpb24g5by556qX55u45YWz5pa55rOVXG4gIHByaXZhdGUgYnVpbGRDb25maWdzKGNvbmZpZzogYW55KTogeyBbcHJvcDogc3RyaW5nXTogYW55IH0ge1xuICAgIGxldCBsYW5ndWFnZVNlcnZpY2UgPSB0aGlzLmluamVjdG9yLmdldDxMYW5ndWFnZVNlcnZpY2U+KExhbmd1YWdlU2VydmljZSwgbnVsbCk7XG4gICAgaWYgKCFsYW5ndWFnZVNlcnZpY2UpIHtcbiAgICAgIGxhbmd1YWdlU2VydmljZSA9IExhbmd1YWdlU2VydmljZS5nZXRJbnN0YW5jZSgpO1xuICAgIH1cblxuICAgIGNvbnN0IGRlZmF1bHRDb25maWdzOiBhbnkgPSB7XG4gICAgICB0aXRsZTogbGFuZ3VhZ2VTZXJ2aWNlICYmIGxhbmd1YWdlU2VydmljZS5kZWZhdWx0RGlhbG9nVGl0bGUgfHwgJycsXG4gICAgICB3aWR0aDogODAwLFxuICAgICAgaGVpZ2h0OiA1MDAsXG4gICAgICBzaG93QnV0dG9uczogZmFsc2VcbiAgICB9O1xuICAgIGNvbnN0IG9iamVjdFR5cGVDb25maWcgPSB0aGlzLmdldE9iamVjdFR5cGVDb25maWcoY29uZmlnKTtcbiAgICBjb25zdCBjb25maWdzID0gT2JqZWN0LmFzc2lnbihkZWZhdWx0Q29uZmlncywgb2JqZWN0VHlwZUNvbmZpZyk7XG4gICAgY29uc3Qgb25DbG9zaW5nSGFuZGxlciA9IGNvbmZpZ3MuYmVmb3JlQ2xvc2U7XG4gICAgY29uc3QgcmVmcmVzaCA9IGNvbmZpZ3NbJ3JlZnJlc2gnXSB8fCB7fTtcbiAgICBjb25zdCByZWZyZXNoQ29tbWFuZE5hbWUgPSByZWZyZXNoICYmIHJlZnJlc2guY29tbWFuZE5hbWUgfHwgbnVsbDtcbiAgICBjb25zdCByZWZyZXNoRnJhbWVJZCA9IHJlZnJlc2ggJiYgcmVmcmVzaC5mcmFtZUlkIHx8IG51bGw7XG4gICAgLy8gdHNsaW50OmRpc2FibGU6IG5vLXN0cmluZy1saXRlcmFsXG4gICAgY29uc3QgY2FuY2VsQ2hhbmdlcyA9IGNvbmZpZ3NbJ2NhbmNlbENoYW5nZXMnXSB8fCBmYWxzZTtcbiAgICBjb25maWdzLmJlZm9yZUNsb3NlID0gKHJlZikgPT4ge1xuICAgICAgaWYgKCEhb25DbG9zaW5nSGFuZGxlciAmJiB0eXBlb2Ygb25DbG9zaW5nSGFuZGxlciA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICByZXR1cm4gb25DbG9zaW5nSGFuZGxlcihyZWYpLnBpcGUoXG4gICAgICAgICAgc3dpdGNoTWFwKHJlc3VsdCA9PiB7XG4gICAgICAgICAgICBpZiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgIGlmIChjYW5jZWxDaGFuZ2VzKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2FuY2VsQ2hhbmdlcyhyZWYpLnBpcGUoXG4gICAgICAgICAgICAgICAgICBzd2l0Y2hNYXAoKCkgPT4gdGhpcy5yZWZyZXNoRm9ybShyZWZyZXNoQ29tbWFuZE5hbWUsIHJlZnJlc2hGcmFtZUlkKSlcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gb2YocmVzdWx0KTtcbiAgICAgICAgICB9KVxuICAgICAgICApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKGNhbmNlbENoYW5nZXMpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5jYW5jZWxDaGFuZ2VzKHJlZikucGlwZShcbiAgICAgICAgICAgIHN3aXRjaE1hcCgoKSA9PiB0aGlzLnJlZnJlc2hGb3JtKHJlZnJlc2hDb21tYW5kTmFtZSwgcmVmcmVzaEZyYW1lSWQpKVxuICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIG9mKHRydWUpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICB9O1xuICAgIHJldHVybiBjb25maWdzO1xuICB9XG4gIHByaXZhdGUgZ2V0T2JqZWN0VHlwZUNvbmZpZyhjb25maWc6IGFueSkge1xuICAgIGxldCBvYmplY3RUeXBlQ29uZmlnOiBhbnlcbiAgICBpZiAodHlwZW9mIGNvbmZpZyA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIGNvbmZpZyA9IHt9O1xuICAgIH1cbiAgICBpZiAodHlwZW9mIGNvbmZpZyA9PT0gJ3N0cmluZycpIHtcbiAgICAgIGlmIChjb25maWcubGVuZ3RoKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgb2JqZWN0VHlwZUNvbmZpZyA9IEpTT04ucGFyc2UoY29uZmlnKTtcbiAgICAgICAgfSBjYXRjaCB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGNvbmZpZyArICfkuI3mmK/lkIjms5XnmoRqc29u5a2X56ym5LiyJyk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG9iamVjdFR5cGVDb25maWcgPSB7fTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBjb25maWcgPT09ICdvYmplY3QnKSB7XG4gICAgICBvYmplY3RUeXBlQ29uZmlnID0gT2JqZWN0LmFzc2lnbih7fSwgY29uZmlnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCfloavlhpnlr7nosaHmoLzlvI/miJZqc29u5a2X56ym5LiyJyk7XG4gICAgfVxuICAgIHJldHVybiBvYmplY3RUeXBlQ29uZmlnO1xuICB9XG4gIC8qKlxuICAgKiDlj5bmtojmnI3liqHlmajlj5jmm7Tpm4ZcbiAgICovXG4gIHByaXZhdGUgY2FuY2VsQ2hhbmdlcyhyZWY6IGFueSk6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xuICAgIGlmIChyZWYgJiYgcmVmLm1vZGFsUmVmICYmIHJlZi5tb2RhbFJlZi5jb250ZW50KSB7XG4gICAgICBjb25zdCBjb21wb25lbnQ6IEZyYW1lQ29tcG9uZW50ID0gcmVmLm1vZGFsUmVmLmNvbnRlbnQgYXMgRnJhbWVDb21wb25lbnQ7XG4gICAgICBpZiAoY29tcG9uZW50ICYmIGNvbXBvbmVudC5jb250ZXh0KSB7XG4gICAgICAgIGNvbnN0IHJlcG9zaXRvcnkgPSBjb21wb25lbnQuY29udGV4dC5yZXBvc2l0b3J5IHx8IG51bGw7XG4gICAgICAgIGlmIChyZXBvc2l0b3J5KSB7XG4gICAgICAgICAgcmV0dXJuIHJlcG9zaXRvcnkuY2FuY2VsQ2hhbmdlcygpLnBpcGUoc3dpdGNoTWFwKCgpID0+IG9mKHRydWUpKSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG9mKHRydWUpO1xuICB9XG4gIHByaXZhdGUgcmVmcmVzaEZvcm0ocmVmcmVzaENvbW1hbmROYW1lOiBzdHJpbmcsIHJlZnJlc2hGcmFtZUlkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgIGlmIChyZWZyZXNoQ29tbWFuZE5hbWUgJiYgcmVmcmVzaEZyYW1lSWQpIHtcbiAgICAgIGNvbnN0IGZyYW1lQ29udGV4dCA9IHRoaXMuZnJhbWVDb250ZXh0LmFwcENvbnRleHQuZnJhbWVDb250ZXh0TWFuYWdlci5nZXRGcmFtZUNvbnRleHRCeUlkKHJlZnJlc2hGcmFtZUlkKTtcbiAgICAgIGlmIChmcmFtZUNvbnRleHQpIHtcbiAgICAgICAgY29uc3Qgdmlld01vZGVsID0gZnJhbWVDb250ZXh0LnZpZXdNb2RlbDtcbiAgICAgICAgcmV0dXJuIHZpZXdNb2RlbFtyZWZyZXNoQ29tbWFuZE5hbWVdKCkucGlwZShcbiAgICAgICAgICBtYXAoKCkgPT4gdHJ1ZSlcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG9mKHRydWUpO1xuICB9XG4gIHByaXZhdGUgY3JlYXRlQ29tcG9uZW50UmVmKGNvbXBvbmVudFR5cGU6IGFueSwgdWlTdGF0ZU9iamVjdDogYW55KSB7XG4gICAgbGV0IGNvbXBvbmVudFJlZjogYW55O1xuICAgIGNvbnN0IGZyYW1lQ29udGV4dCA9IHRoaXMuZ2V0RnJhbWVDb250ZXh0KCk7XG4gICAgY29uc3QgY29tcG9uZW50RmFjdG9yeVJlc29sdmVyID0gdGhpcy5nZXRDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIoKTtcbiAgICBpZiAoZnJhbWVDb250ZXh0ICYmIGNvbXBvbmVudEZhY3RvcnlSZXNvbHZlcikge1xuICAgICAgY29uc3QgY29udGVudENtcHRGYWN0b3J5ID0gY29tcG9uZW50RmFjdG9yeVJlc29sdmVyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KGNvbXBvbmVudFR5cGUpO1xuICAgICAgY29uc3QgbW9kYWxDb250ZW50SW5qZWN0b3IgPSBSZWZsZWN0aXZlSW5qZWN0b3IucmVzb2x2ZUFuZENyZWF0ZShbXSwgZnJhbWVDb250ZXh0LmluamVjdG9yKTtcbiAgICAgIGNvbXBvbmVudFJlZiA9IGNvbnRlbnRDbXB0RmFjdG9yeS5jcmVhdGUobW9kYWxDb250ZW50SW5qZWN0b3IpO1xuICAgICAgaWYgKGNvbXBvbmVudFJlZiAmJiBjb21wb25lbnRSZWYuaW5zdGFuY2UgJiYgY29tcG9uZW50UmVmLmluc3RhbmNlLnZpZXdNb2RlbCAmJiBjb21wb25lbnRSZWYuaW5zdGFuY2Uudmlld01vZGVsLnVpU3RhdGUpIHtcbiAgICAgICAgaWYgKHR5cGVvZiB1aVN0YXRlT2JqZWN0ID09PSAnb2JqZWN0JyAmJiBPYmplY3Qua2V5cyh1aVN0YXRlT2JqZWN0KS5sZW5ndGgpIHtcbiAgICAgICAgICBPYmplY3Qua2V5cyh1aVN0YXRlT2JqZWN0KS5mb3JFYWNoKGl0ZW0gPT4ge1xuICAgICAgICAgICAgY29tcG9uZW50UmVmLmluc3RhbmNlLnZpZXdNb2RlbC51aVN0YXRlLnNldFByb3BlcnR5VmFsdWUoaXRlbSwgdWlTdGF0ZU9iamVjdFtpdGVtXSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8g6ZmE5YqgaXNEaWFsb2flj4LmlbBcbiAgICAgICAgY29tcG9uZW50UmVmLmluc3RhbmNlLnZpZXdNb2RlbC51aVN0YXRlLnNldFByb3BlcnR5VmFsdWUoJ0RFVktJVF9ESUFMT0cnLCB0cnVlKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGNvbXBvbmVudFJlZjtcbiAgfVxuICAvKipcbiAgICog5YW85a655pen5by556qX77yM6I635Y+WZnJhbWVDb250ZXh0XG4gICAqL1xuICBwcml2YXRlIGdldEZyYW1lQ29udGV4dCgpIHtcbiAgICBpZiAodGhpcy5mcmFtZUNvbnRleHQpIHtcbiAgICAgIHJldHVybiB0aGlzLmZyYW1lQ29udGV4dFxuICAgIH1cbiAgICBpZiAodGhpc1snY29udGV4dCddICYmIHRoaXNbJ2NvbnRleHQnXVsnZnJhbWVDb250ZXh0J10pIHtcbiAgICAgIHJldHVybiB0aGlzWydjb250ZXh0J11bJ2ZyYW1lQ29udGV4dCddO1xuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuICAvKipcbiAgICog5YW85a655pen5by556qX77yM6I635Y+WQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyXG4gICAqL1xuICBwcml2YXRlIGdldENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcigpIHtcbiAgICBjb25zdCBmcmFtZUNvbnRleHQgPSB0aGlzLmdldEZyYW1lQ29udGV4dCgpO1xuICAgIGxldCBjb21wb25lbnRGYWN0b3J5UmVzb2x2ZXI6IGFueTtcbiAgICBpZiAoZnJhbWVDb250ZXh0KSB7XG4gICAgICBjb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIgPSBmcmFtZUNvbnRleHQuaW5qZWN0b3IuZ2V0KENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcik7XG4gICAgfVxuICAgIHJldHVybiBjb21wb25lbnRGYWN0b3J5UmVzb2x2ZXI7XG4gIH1cbiAgLy8jZW5kcmVnaW9uXG59XG4iXX0=