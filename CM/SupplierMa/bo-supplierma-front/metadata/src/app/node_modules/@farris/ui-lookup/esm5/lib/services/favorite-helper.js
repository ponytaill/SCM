/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { TreeTableComponent } from '@farris/ui-treetable';
import { FavoriteAction, FavoriteIcon, FAVORITE_FIELD_NAME, LookupGridDisplayType } from '../lookup-displaytype';
var FavoriteHelper = /** @class */ (function () {
    function FavoriteHelper(instance) {
        var _this_1 = this;
        this.instance = instance;
        this.favoriteColumnFormatter = (/**
         * @param {?} v
         * @param {?} data
         * @return {?}
         */
        function (v, data) {
            /** @type {?} */
            var f = v ? FavoriteIcon.yes : FavoriteIcon.no;
            if (_this_1.instance.isTree()) {
                /** @type {?} */
                var id = data[_this_1.instance.idField];
                if (id) {
                    /** @type {?} */
                    var tt = (/** @type {?} */ (_this_1.instance.componentRef.instance));
                    /** @type {?} */
                    var rn = tt.findRowNode(id);
                    if (rn) {
                        if (rn.node.selectable) {
                            return f;
                        }
                        else {
                            return '';
                        }
                    }
                }
            }
            return f;
        });
        this.lookupSelectionSer = this.instance.lookupSelectionSer;
    }
    /**
     * @return {?}
     */
    FavoriteHelper.prototype.getFavoriteColumns = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var columns = this.instance.gridOptions.columns.map((/**
         * @param {?} item
         * @return {?}
         */
        function (item) {
            /** @type {?} */
            var rtn = Object.assign({}, item);
            if (item.field === FAVORITE_FIELD_NAME) {
                rtn.formatter = (/**
                 * @return {?}
                 */
                function () { return FavoriteIcon.delete; });
            }
            return rtn;
        }));
        return columns;
    };
    /**
     * @return {?}
     */
    FavoriteHelper.prototype.initPersonalInfo = /**
     * @return {?}
     */
    function () {
        if (this.instance.personalConfigService) {
            /** @type {?} */
            var controlID = this.instance.el.nativeElement.id || this.instance.controlId;
            if (!controlID) {
                this.instance.writeConsole('LookupGrid - 未设置组件id, 收藏功能将不能正常，请设置组件id.');
            }
            /** @type {?} */
            var pcstr = this.getPersonalConfigKey(controlID);
            this.instance.personalConfigService.controlID = controlID;
            this.instance.personalConfigService.personalConfigKey = pcstr;
            /** @type {?} */
            var conf = {
                displayType: this.instance.displayType,
                singleSelect: this.instance.singleSelect,
                idField: this.instance.idField,
                textField: this.instance.textField,
                mapFields: Object.assign({}, this.instance.mapFields || {})
            };
            this.instance.personalConfigService.initPersonalConf(conf);
            // 个性化配置的订阅事件处理
            this.listenPersonalConfigHandler();
        }
    };
    /**
     * @private
     * @param {?} controlID
     * @return {?}
     */
    FavoriteHelper.prototype.getPersonalConfigKey = /**
     * @private
     * @param {?} controlID
     * @return {?}
     */
    function (controlID) {
        // return this.instance.ngControl && this.instance.ngControl.name ? this.instance.ngControl.name : this.instance.mapFields
        //     ? this.instance.mapFields[this.instance.textField]
        //     : '';
        var _this_1 = this;
        if (this.instance.ngControl) {
            if (this.instance.ngControl.name) {
                return this.instance.ngControl.name;
            }
            else {
                if (this.instance.mapFields && this.instance.mapFields.length) {
                    return Object.keys(this.instance.mapFields).map((/**
                     * @param {?} k
                     * @return {?}
                     */
                    function (k) {
                        return _this_1.instance.mapFields[k];
                    })).join('_');
                }
                else {
                    return this.instance.textField;
                }
            }
        }
        else {
            return '';
        }
    };
    /**
     * 监听收藏TAB页中相关事件；
     * 数据选中，取消选中，移除收藏，双击事件
     */
    /**
     * 监听收藏TAB页中相关事件；
     * 数据选中，取消选中，移除收藏，双击事件
     * @param {?} cmpRef
     * @return {?}
     */
    FavoriteHelper.prototype.initFavoriteComponentEvent = /**
     * 监听收藏TAB页中相关事件；
     * 数据选中，取消选中，移除收藏，双击事件
     * @param {?} cmpRef
     * @return {?}
     */
    function (cmpRef) {
        var _this_1 = this;
        switch (this.instance.displayType) {
            case LookupGridDisplayType.NavList:
            case LookupGridDisplayType.NavTreeList:
            case LookupGridDisplayType.List: {
                /** @type {?} */
                var fdt_1 = (/** @type {?} */ (cmpRef.instance));
                fdt_1.remoteSort = false;
                fdt_1.selectedRow.subscribe((/**
                 * @param {?} e
                 * @return {?}
                 */
                function (e) {
                    if (_this_1.instance.singleSelect) {
                        _this_1.lookupSelectionSer.clearSelections();
                    }
                    _this_1.lookupSelectionSer.updateSelections(e.data);
                }));
                fdt_1.unSelectRow.subscribe((/**
                 * @param {?} e
                 * @return {?}
                 */
                function (e) {
                    _this_1.lookupSelectionSer.unSelect(e.data[_this_1.instance.idField]);
                }));
                if (!fdt_1.singleSelect) {
                    fdt_1.checkAll.subscribe((/**
                     * @param {?} e
                     * @return {?}
                     */
                    function (e) {
                        _this_1.lookupSelectionSer.updateSelections(fdt_1.data, e);
                    }));
                }
                fdt_1.cellClick.subscribe((/**
                 * @param {?} e
                 * @return {?}
                 */
                function (e) {
                    if (e.col.field === FAVORITE_FIELD_NAME) {
                        e.event.stopPropagation();
                        // tslint:disable-next-line: no-string-literal
                        /** @type {?} */
                        var classList = e.event.target['classList'];
                        if (classList.contains('f-lookup-unfavorite')) {
                            if (_this_1.instance.items) {
                                _this_1.instance.items.forEach((/**
                                 * @param {?} item
                                 * @return {?}
                                 */
                                function (item) {
                                    if (item[_this_1.instance.idField] === e.row[_this_1.instance.idField]) {
                                        item[FAVORITE_FIELD_NAME] = false;
                                    }
                                }));
                                /** @type {?} */
                                var dt = (/** @type {?} */ (_this_1.instance.componentRef.instance));
                                if (dt) {
                                    dt.loadData({
                                        pageSize: _this_1.instance.gridOptions.pageSize,
                                        pageIndex: _this_1.instance.gridOptions.pageIndex,
                                        total: _this_1.instance.gridOptions.total,
                                        data: _this_1.instance.gridOptions.items
                                    });
                                }
                            }
                            _this_1.instance.favoriteItems =
                                _this_1.instance.favoriteItems.filter((/**
                                 * @param {?} n
                                 * @return {?}
                                 */
                                function (n) { return n[_this_1.instance.idField] !== e.row[_this_1.instance.idField]; }));
                            _this_1.lookupSelectionSer.updateFavoriteData(e.row, FavoriteAction.delete);
                        }
                    }
                }));
                // 双击事件
                fdt_1.rowDblClick.subscribe((/**
                 * @param {?} rowData
                 * @return {?}
                 */
                function (rowData) {
                    if (_this_1.instance.gridOptions.singleSelect) {
                        _this_1.instance.selectItem(rowData);
                    }
                }));
                break;
            }
            case LookupGridDisplayType.TreeList: {
                if (cmpRef) {
                    /** @type {?} */
                    var ftt = (/** @type {?} */ (cmpRef.instance));
                    ftt.remoteSort = false;
                    ftt.nodeSelected.subscribe((/**
                     * @param {?} e
                     * @return {?}
                     */
                    function (e) {
                        if (_this_1.instance.singleSelect) {
                            _this_1.lookupSelectionSer.clearSelections();
                        }
                        _this_1.lookupSelectionSer.updateSelections(e.node.data);
                    }));
                    ftt.nodeUnChecked.subscribe((/**
                     * @param {?} e
                     * @return {?}
                     */
                    function (e) {
                        if (e.nodes && e.nodes.length) {
                            _this_1.instance.multiSelMgr.remove(e.nodes.map((/**
                             * @param {?} n
                             * @return {?}
                             */
                            function (n) { return n.id; })));
                        }
                        else if (e && e.node && e.node.data && e.node.data.id) {
                            // const tt = this.instance.componentRef.instance as TreeTableComponent;
                            // tt.unSelectNode(e.node.data.id);
                            _this_1.lookupSelectionSer.unSelect(e.node.data.id);
                        }
                    }));
                    ftt.nodeChecked.subscribe((/**
                     * @param {?} e
                     * @return {?}
                     */
                    function (e) {
                        if (!_this_1.instance.singleSelect) {
                            if (e.nodes && e.nodes.length) {
                                _this_1.instance.multiSelMgr.updateSelections(e.nodes.map((/**
                                 * @param {?} n
                                 * @return {?}
                                 */
                                function (n) { return n.data; })));
                            }
                            else {
                                if (Array.isArray(e.node)) {
                                    _this_1.instance.multiSelMgr.updateSelections(e.node.map((/**
                                     * @param {?} n
                                     * @return {?}
                                     */
                                    function (n) { return n.data; })));
                                }
                                else {
                                    _this_1.instance.multiSelMgr.updateSelections([e.node.data]);
                                }
                            }
                        }
                    }));
                    ftt.cellClick.subscribe((/**
                     * @param {?} row
                     * @return {?}
                     */
                    function (row) {
                        if (row.col.field === FAVORITE_FIELD_NAME) {
                            row.event.stopPropagation();
                            /** @type {?} */
                            var classList = row.event.target['classList'];
                            if (classList.contains('f-lookup-unfavorite')) {
                                /** @type {?} */
                                var _this_2 = _this_1.instance;
                                ((/**
                                 * @param {?} items
                                 * @return {?}
                                 */
                                function every(items) {
                                    if (!items) {
                                        return;
                                    }
                                    /** @type {?} */
                                    var hasFinish = false;
                                    items.forEach((/**
                                     * @param {?} item
                                     * @return {?}
                                     */
                                    function (item) {
                                        if (hasFinish) {
                                            return;
                                        }
                                        if (item.data[_this_2.idField] === row.node[_this_2.idField]) {
                                            item.data[FAVORITE_FIELD_NAME] = false;
                                            hasFinish = true;
                                        }
                                        else if (item.children && item.children.length > 0) {
                                            every(item.children);
                                        }
                                    }));
                                }))(_this_1.instance.items);
                                /** @type {?} */
                                var tt = (/** @type {?} */ (_this_1.instance.componentRef.instance));
                                tt.loadData(_this_1.instance.items);
                                _this_1.lookupSelectionSer.updateFavoriteData(row.node.data, FavoriteAction.delete);
                            }
                        }
                    }));
                    ftt.dblClick.subscribe((/**
                     * @param {?} treeNode
                     * @return {?}
                     */
                    function (treeNode) {
                        if (_this_1.instance.gridOptions.singleSelect && treeNode.selectable) {
                            if (_this_1.instance.okButton) {
                                _this_1.instance.okButton.nativeElement.click();
                            }
                        }
                    }));
                    ftt.checkAll.subscribe((/**
                     * @param {?} e
                     * @return {?}
                     */
                    function (e) {
                        /** @type {?} */
                        var data = e.instance.checkeds.map((/**
                         * @param {?} n
                         * @return {?}
                         */
                        function (n) { return n.data; }));
                        _this_1.instance.multiSelMgr.updateSelections(data);
                        _this_1.instance.checkedChange.emit({ data: data, isCheck: true });
                    }));
                    ftt.unCheckAll.subscribe((/**
                     * @return {?}
                     */
                    function () {
                        _this_1.instance.multiSelMgr.clear();
                        _this_1.instance.checkedChange.emit({ data: [], isCheck: false });
                    }));
                }
            }
        }
    };
    /**
     * @private
     * @return {?}
     */
    FavoriteHelper.prototype.getFavoritData = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.instance.personalConf) {
            /** @type {?} */
            var favData = this.instance.personalConf.favorite;
            /** @type {?} */
            var _data = (favData && favData[this.instance.localService.localeId]) ? favData[this.instance.localService.localeId] : [];
            return _data;
        }
        return [];
    };
    /**
     * @return {?}
     */
    FavoriteHelper.prototype.getFavoritIds = /**
     * @return {?}
     */
    function () {
        return this.getFavoritData();
    };
    /**
     * @param {?=} data
     * @return {?}
     */
    FavoriteHelper.prototype._loadFavoriteData = /**
     * @param {?=} data
     * @return {?}
     */
    function (data) {
        if (data === void 0) { data = null; }
        /** @type {?} */
        var fdt = (/** @type {?} */ (this.instance.favoritesComponentRef.instance));
        this.loadFavoriteDatatable(fdt, data);
        fdt.cd.markForCheck();
        this.instance.closeLoading();
    };
    // 加载收藏grid数据
    // 加载收藏grid数据
    /**
     * @param {?=} res
     * @return {?}
     */
    FavoriteHelper.prototype.loadFavoritesData = 
    // 加载收藏grid数据
    /**
     * @param {?=} res
     * @return {?}
     */
    function (res) {
        if (res === void 0) { res = null; }
        /** @type {?} */
        var favIds = this.getFavoritIds();
        switch (this.instance.displayType) {
            case LookupGridDisplayType.NavList:
            case LookupGridDisplayType.NavTreeList:
            case LookupGridDisplayType.List: {
                /** @type {?} */
                var fdt = (/** @type {?} */ (this.instance.favoritesComponentRef.instance));
                if (this.instance.favoriteDataFrom === 'locale') {
                    if (res) {
                        this._loadFavoriteData(res.items);
                    }
                    else {
                        // this.instance.httpMgr.getFavoriteData(favIds).subscribe(resData => {
                        //     if (resData) {
                        //         this._loadFavoriteData(resData.items);
                        //     }
                        //     this.instance.closeLoading();
                        // });
                    }
                }
                else {
                    /** @type {?} */
                    var favData = this.getFavoritData();
                    this.loadFavoriteDatatable(fdt, res ? res.items : favData);
                }
                break;
            }
            case LookupGridDisplayType.TreeList: {
                if (this.instance.favoritesComponentRef && this.instance.favoritesComponentRef.instance instanceof TreeTableComponent) {
                    /** @type {?} */
                    var ftt = (/** @type {?} */ (this.instance.favoritesComponentRef.instance));
                    this.bindFavTreetable(ftt);
                    if (this.instance.favoriteDataFrom === 'locale') {
                        if (res) {
                            this.loadFavoriteForTreeTable(res.items || [], ftt);
                        }
                        else {
                            // this.instance.httpMgr.getFavoriteData(favIds).subscribe(resData => {
                            //     if (resData) {
                            //         const items = resData.items;
                            //         this.loadFavoriteForTreeTable(items, ftt);
                            //     }
                            //     this.instance.closeLoading();
                            // });
                        }
                    }
                    else {
                        if (res) {
                            this.loadFavoriteForTreeTable(res.items, ftt);
                        }
                    }
                }
            }
        }
    };
    /**
     * @private
     * @param {?} fdt
     * @param {?=} data
     * @return {?}
     */
    FavoriteHelper.prototype.loadFavoriteDatatable = /**
     * @private
     * @param {?} fdt
     * @param {?=} data
     * @return {?}
     */
    function (fdt, data) {
        if (data !== undefined) {
            this.instance.favoriteItems = data;
        }
        if (fdt.columns && !fdt.columns.length) {
            fdt.columns = this.instance.favoriteColumns;
        }
        fdt.loadData({
            total: 0,
            pageSize: 20,
            pageIndex: 1,
            data: this.instance.favoriteItems
        });
        this.instance.selectionMgr.selectCurrentValue();
        fdt.cd.detectChanges();
    };
    /**
     * @private
     * @param {?} ftt
     * @return {?}
     */
    FavoriteHelper.prototype.bindFavTreetable = /**
     * @private
     * @param {?} ftt
     * @return {?}
     */
    function (ftt) {
        var _this_1 = this;
        ftt.allColumnsTitle = this.instance.allColumnsTitle;
        ftt.idField = this.instance.idField;
        /** @type {?} */
        var columns = this.instance.gridOptions.columns.map((/**
         * @param {?} item
         * @return {?}
         */
        function (item) {
            /** @type {?} */
            var rtn = tslib_1.__assign({}, item);
            if (item.field === FAVORITE_FIELD_NAME) {
                rtn.formatter = (/**
                 * @param {?} v
                 * @param {?} data
                 * @return {?}
                 */
                function (v, data) {
                    /** @type {?} */
                    var favids = _this_1.getFavoritIds();
                    if (favids && favids.length) {
                        /** @type {?} */
                        var index = favids.findIndex((/**
                         * @param {?} el
                         * @return {?}
                         */
                        function (el) { return el === data[_this_1.instance.idField]; }));
                        if (index >= 0) {
                            return FavoriteIcon.delete;
                        }
                    }
                    return '';
                });
            }
            return rtn;
        }));
        this.instance.favoriteColumns = columns;
        ftt.columns = columns;
        if (this.instance.gridOptions.treeInfo) {
            ftt.onlySelectLeaf = this.instance.gridOptions.treeInfo.onlySelectLeaf;
        }
        if (!ftt.singleSelect) {
            ftt.checkOnSelect = true;
            ftt.selectOnCheck = true;
            ftt.showCheckbox = true;
            // 启用多选后，同时启用级联选择
            // 启用多选后，同时启用级联选择
            if (this.instance.enableCascade) {
                this.instance.ttEventMgr.cascadeValueChanged(this.instance.cascadeStatus);
            }
            else {
                ftt.cascadeCheck = false;
                ftt.cascadeDown = false;
                ftt.cascadeUp = false;
            }
        }
    };
    /**
     * @private
     * @param {?} nodes
     * @return {?}
     */
    FavoriteHelper.prototype.checkNodeIsLeaf = /**
     * @private
     * @param {?} nodes
     * @return {?}
     */
    function (nodes) {
        var _this_1 = this;
        if (nodes && nodes.length) {
            return nodes.map((/**
             * @param {?} node
             * @return {?}
             */
            function (node) {
                if (node.hasOwnProperty("addtional")) {
                    node.selectable = !node["addtional"];
                }
                if (node.children && node.children.length) {
                    _this_1.checkNodeIsLeaf(node.children);
                }
                else {
                    node.leaf = true;
                }
                return node;
            }));
        }
        return nodes;
    };
    /**
     * @param {?} items
     * @return {?}
     */
    FavoriteHelper.prototype.initFavoriteTreeData = /**
     * @param {?} items
     * @return {?}
     */
    function (items) {
        /** @type {?} */
        var treeInfo = this.instance.gridOptions.treeInfo;
        if (treeInfo && !treeInfo['treeDataIsInit']) {
            if (treeInfo.layerType.toLowerCase() === 'pathcode') {
                items = this.instance.lookupUtils.makeTree(items, treeInfo);
            }
            else {
                items = this.instance.lookupUtils.makeTreeWithParentID(items, '', treeInfo.dataField + "." + treeInfo.parentField, this.instance.idField);
            }
        }
        // return this.instance.checkNodeCanBeSelect(items, true);
        return this.checkNodeIsLeaf(items);
    };
    /**
     * @param {?} items
     * @param {?} ftt
     * @return {?}
     */
    FavoriteHelper.prototype.loadFavoriteForTreeTable = /**
     * @param {?} items
     * @param {?} ftt
     * @return {?}
     */
    function (items, ftt) {
        items = this.initFavoriteTreeData(items);
        this.instance.favoriteItems = items;
        ftt.loadData(items);
        ftt.expandAll();
        this.instance.selectionMgr.selectCurrentValue();
        return items;
    };
    // 更新列表中的收藏数据标识
    // 更新列表中的收藏数据标识
    /**
     * @param {?} data
     * @return {?}
     */
    FavoriteHelper.prototype.updateFavoritesStatus = 
    // 更新列表中的收藏数据标识
    /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        var _this_1 = this;
        if (!data || !this.instance.useFavorite) {
            return;
        }
        /** @type {?} */
        var favIds = this.getFavoritIds();
        if (favIds && favIds.length) {
            // 处理数据列表中的收藏数据标识
            if (this.instance.displayType !== LookupGridDisplayType.TreeList) {
                data.map((/**
                 * @param {?} item
                 * @return {?}
                 */
                function (item) {
                    if (favIds && favIds.length && favIds.find((/**
                     * @param {?} v
                     * @return {?}
                     */
                    function (v) { return v === item[_this_1.instance.idField]; }))) {
                        item[FAVORITE_FIELD_NAME] = true;
                    }
                }));
            }
            else {
                /** @type {?} */
                var _this_3 = this.instance;
                ((/**
                 * @param {?} _data
                 * @return {?}
                 */
                function each(_data) {
                    _data.forEach((/**
                     * @param {?} item
                     * @return {?}
                     */
                    function (item) {
                        if (favIds && favIds.length && favIds.find((/**
                         * @param {?} v
                         * @return {?}
                         */
                        function (v) { return v === item.data[_this_3.idField]; }))) {
                            item.data[FAVORITE_FIELD_NAME] = true;
                        }
                        if (item.children && item.children.length > 0) {
                            each(item.children);
                        }
                    }));
                }))(data);
            }
        }
    };
    /**
     * @private
     * @param {?} value
     * @param {?} action
     * @return {?}
     */
    FavoriteHelper.prototype._updateFavorites = /**
     * @private
     * @param {?} value
     * @param {?} action
     * @return {?}
     */
    function (value, action) {
        var _this_1 = this;
        /** @type {?} */
        var localeID = this.instance.localService.localeId;
        this.instance.personalConf.favorite = this.instance.personalConf.favorite || {};
        /** @type {?} */
        var items = value.filter((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return !n['_addtional_']; }));
        /** @type {?} */
        var newVal = items.map((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n[_this_1.instance.idField]; })).filter((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n !== null && n !== undefined; }));
        // const favIds = this.instance.personalConf.favorite[localeID] || [];
        this.instance.personalConf.favorite[localeID] = newVal;
        return newVal;
    };
    // 收藏数据管理
    // 收藏数据管理
    /**
     * @private
     * @return {?}
     */
    FavoriteHelper.prototype.listenPersonalConfigHandler = 
    // 收藏数据管理
    /**
     * @private
     * @return {?}
     */
    function () {
        var _this_1 = this;
        this.lookupSelectionSer.favoriteItems$.subscribe((/**
         * @param {?} n
         * @return {?}
         */
        function (n) {
            if (!_this_1.instance.favoritesComponentRef) {
                return;
            }
            var items = n.items, action = n.action;
            /** @type {?} */
            var favids = _this_1._updateFavorites(items, action);
            _this_1.instance.httpMgr.submitFavoriteData(action);
            if (_this_1.instance.displayType === LookupGridDisplayType.List || _this_1.instance.displayType.includes('NAV')) {
                /** @type {?} */
                var dt = (/** @type {?} */ (_this_1.instance.favoritesComponentRef.instance));
                _this_1.loadFavoriteDatatable(dt, items);
            }
            else if (_this_1.instance.displayType === LookupGridDisplayType.TreeList) {
                /** @type {?} */
                var ftt_1 = (/** @type {?} */ (_this_1.instance.favoritesComponentRef.instance));
                // const favids = items.map(d => d.id);
                _this_1.instance.showLoading();
                _this_1.instance.httpMgr.getData({ favoriteIds: favids }, 'fav').subscribe((/**
                 * @param {?} resData
                 * @return {?}
                 */
                function (resData) {
                    if (resData) {
                        /** @type {?} */
                        var _items = resData.items;
                        _this_1.loadFavoriteForTreeTable(_items, ftt_1);
                    }
                    else {
                        _this_1.instance.favoriteItems = [];
                        ftt_1.loadData([]);
                    }
                    _this_1.instance.closeLoading();
                }));
            }
        }));
    };
    return FavoriteHelper;
}());
export { FavoriteHelper };
if (false) {
    /**
     * @type {?}
     * @private
     */
    FavoriteHelper.prototype.lookupSelectionSer;
    /** @type {?} */
    FavoriteHelper.prototype.favoriteColumnFormatter;
    /**
     * @type {?}
     * @private
     */
    FavoriteHelper.prototype.instance;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmF2b3JpdGUtaGVscGVyLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1sb29rdXAvIiwic291cmNlcyI6WyJsaWIvc2VydmljZXMvZmF2b3JpdGUtaGVscGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBRUEsT0FBTyxFQUFZLGtCQUFrQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFFcEUsT0FBTyxFQUFFLGNBQWMsRUFBRSxZQUFZLEVBQUUsbUJBQW1CLEVBQUUscUJBQXFCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUtqSDtJQUlJLHdCQUFvQixRQUE2QjtRQUFqRCxtQkFFQztRQUZtQixhQUFRLEdBQVIsUUFBUSxDQUFxQjtRQWVqRCw0QkFBdUI7Ozs7O1FBQUcsVUFBQyxDQUFNLEVBQUUsSUFBUzs7Z0JBQ2xDLENBQUMsR0FBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxFQUFFO1lBQ2pELElBQUksT0FBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEVBQUUsRUFBRTs7b0JBQ2xCLEVBQUUsR0FBRyxJQUFJLENBQUMsT0FBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUM7Z0JBQ3RDLElBQUksRUFBRSxFQUFFOzt3QkFDRSxFQUFFLEdBQUcsbUJBQUEsT0FBSSxDQUFDLFFBQVEsQ0FBQyxZQUFZLENBQUMsUUFBUSxFQUFzQjs7d0JBQzlELEVBQUUsR0FBRyxFQUFFLENBQUMsV0FBVyxDQUFDLEVBQUUsQ0FBQztvQkFDN0IsSUFBSSxFQUFFLEVBQUU7d0JBQ0osSUFBSSxFQUFFLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRTs0QkFDcEIsT0FBTyxDQUFDLENBQUM7eUJBQ1o7NkJBQU07NEJBQ0gsT0FBTyxFQUFFLENBQUM7eUJBQ2I7cUJBQ0o7aUJBQ0o7YUFDSjtZQUNELE9BQU8sQ0FBQyxDQUFDO1FBQ2IsQ0FBQyxFQUFBO1FBL0JHLElBQUksQ0FBQyxrQkFBa0Is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QUMvRCxLQUFHLEdBQUcsbUJBQUEsT0FBSSxDQUFDLFFBQVEsQ0FBQyxxQkFBcUIsQ0FBQyxRQUFRLEVBQXNCO2dCQUM5RSx1Q0FBdUM7Z0JBQ3ZDLE9BQUksQ0FBQyxRQUFRLENBQUMsV0FBVyxFQUFFLENBQUM7Z0JBQzVCLE9BQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxFQUFFLFdBQVcsRUFBRSxNQUFNLEVBQUUsRUFBRSxLQUFLLENBQUMsQ0FBQyxTQUFTOzs7O2dCQUFDLFVBQUEsT0FBTztvQkFDM0UsSUFBSSxPQUFPLEVBQUU7OzRCQUNILE1BQU0sR0FBRyxPQUFPLENBQUMsS0FBSzt3QkFDNUIsT0FBSSxDQUFDLHdCQUF3QixDQUFDLE1BQU0sRUFBRSxLQUFHLENBQUMsQ0FBQztxQkFDOUM7eUJBQU07d0JBQ0gsT0FBSSxDQUFDLFFBQVEsQ0FBQyxhQUFhLEdBQUcsRUFBRSxDQUFDO3dCQUNqQyxLQUFHLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO3FCQUNwQjtvQkFDRCxPQUFJLENBQUMsUUFBUSxDQUFDLFlBQVksRUFBRSxDQUFDO2dCQUNqQyxDQUFDLEVBQUMsQ0FBQzthQUNOO1FBQ0wsQ0FBQyxFQUFDLENBQUM7SUFDUCxDQUFDO0lBRUwscUJBQUM7QUFBRCxDQUFDLEFBemZELElBeWZDOzs7Ozs7O0lBdmZHLDRDQUFtRDs7SUFpQm5ELGlEQWlCQzs7Ozs7SUFoQ1csa0NBQXFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50UmVmIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IERhdGFUYWJsZUNvbXBvbmVudCB9IGZyb20gJ0BmYXJyaXMvdWktZGF0YXRhYmxlJztcclxuaW1wb3J0IHsgVHJlZU5vZGUsIFRyZWVUYWJsZUNvbXBvbmVudCB9IGZyb20gJ0BmYXJyaXMvdWktdHJlZXRhYmxlJztcclxuaW1wb3J0IHsgVXNlckZhdm9yaXRlRGF0YSB9IGZyb20gJy4uL2h0dHAvUmVtb3RlUGFyYW1zJztcclxuaW1wb3J0IHsgRmF2b3JpdGVBY3Rpb24sIEZhdm9yaXRlSWNvbiwgRkFWT1JJVEVfRklFTERfTkFNRSwgTG9va3VwR3JpZERpc3BsYXlUeXBlIH0gZnJvbSAnLi4vbG9va3VwLWRpc3BsYXl0eXBlJztcclxuaW1wb3J0IHsgTG9va3VwR3JpZFJlc3VsdCB9IGZyb20gJy4uL2xvb2t1cC1ncmlkLW9wdGlvbnMnO1xyXG5pbXBvcnQgeyBMb29rdXBHcmlkQ29tcG9uZW50IH0gZnJvbSAnLi4vbG9va3VwLWdyaWQuY29tcG9uZW50JztcclxuaW1wb3J0IHsgTG9va3VwU2VsZWN0aW9uU2VydmljZSB9IGZyb20gJy4vbG9va3VwLXNlbGVjdGlvbi5zZXJ2aWNlJztcclxuXHJcbmV4cG9ydCBjbGFzcyBGYXZvcml0ZUhlbHBlciB7XHJcblxyXG4gICAgcHJpdmF0ZSBsb29rdXBTZWxlY3Rpb25TZXI6IExvb2t1cFNlbGVjdGlvblNlcnZpY2U7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBpbnN0YW5jZTogTG9va3VwR3JpZENvbXBvbmVudCkge1xyXG4gICAgICAgIHRoaXMubG9va3VwU2VsZWN0aW9uU2VyID0gdGhpcy5pbnN0YW5jZS5sb29rdXBTZWxlY3Rpb25TZXI7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0RmF2b3JpdGVDb2x1bW5zKCk6IGFueVtdIHtcclxuICAgICAgICBjb25zdCBjb2x1bW5zID0gdGhpcy5pbnN0YW5jZS5ncmlkT3B0aW9ucy5jb2x1bW5zLm1hcChpdGVtID0+IHtcclxuICAgICAgICAgICAgY29uc3QgcnRuID0gT2JqZWN0LmFzc2lnbih7fSwgaXRlbSk7XHJcbiAgICAgICAgICAgIGlmIChpdGVtLmZpZWxkID09PSBGQVZPUklURV9GSUVMRF9OQU1FKSB7XHJcbiAgICAgICAgICAgICAgICBydG4uZm9ybWF0dGVyID0gKCkgPT4gRmF2b3JpdGVJY29uLmRlbGV0ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gcnRuO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBjb2x1bW5zO1xyXG4gICAgfVxyXG5cclxuICAgIGZhdm9yaXRlQ29sdW1uRm9ybWF0dGVyID0gKHY6IGFueSwgZGF0YTogYW55ICApID0+IHtcclxuICAgICAgICBjb25zdCBmID0gIHYgPyBGYXZvcml0ZUljb24ueWVzIDogRmF2b3JpdGVJY29uLm5vO1xyXG4gICAgICAgIGlmICh0aGlzLmluc3RhbmNlLmlzVHJlZSgpKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGlkID0gZGF0YVt0aGlzLmluc3RhbmNlLmlkRmllbGRdO1xyXG4gICAgICAgICAgICBpZiAoaWQpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHR0ID0gdGhpcy5pbnN0YW5jZS5jb21wb25lbnRSZWYuaW5zdGFuY2UgYXMgVHJlZVRhYmxlQ29tcG9uZW50O1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgcm4gPSB0dC5maW5kUm93Tm9kZShpZCk7XHJcbiAgICAgICAgICAgICAgICBpZiAocm4pIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocm4ubm9kZS5zZWxlY3RhYmxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnJztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGY7XHJcbiAgICB9XHJcblxyXG4gICAgaW5pdFBlcnNvbmFsSW5mbygpIHtcclxuICAgICAgICBpZiAodGhpcy5pbnN0YW5jZS5wZXJzb25hbENvbmZpZ1NlcnZpY2UpIHtcclxuICAgICAgICAgICAgY29uc3QgY29udHJvbElEID0gdGhpcy5pbnN0YW5jZS5lbC5uYXRpdmVFbGVtZW50LmlkIHx8IHRoaXMuaW5zdGFuY2UuY29udHJvbElkO1xyXG4gICAgICAgICAgICBpZiAoIWNvbnRyb2xJRCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnN0YW5jZS53cml0ZUNvbnNvbGUoJ0xvb2t1cEdyaWQgLSDmnKrorr7nva7nu4Tku7ZpZCwg5pS26JeP5Yqf6IO95bCG5LiN6IO95q2j5bi477yM6K+36K6+572u57uE5Lu2aWQuJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29uc3QgcGNzdHIgPSB0aGlzLmdldFBlcnNvbmFsQ29uZmlnS2V5KGNvbnRyb2xJRCk7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zdGFuY2UucGVyc29uYWxDb25maWdTZXJ2aWNlLmNvbnRyb2xJRCA9IGNvbnRyb2xJRDtcclxuICAgICAgICAgICAgdGhpcy5pbnN0YW5jZS5wZXJzb25hbENvbmZpZ1NlcnZpY2UucGVyc29uYWxDb25maWdLZXkgPSBwY3N0cjtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGNvbmYgPSB7XHJcbiAgICAgICAgICAgICAgICBkaXNwbGF5VHlwZTogdGhpcy5pbnN0YW5jZS5kaXNwbGF5VHlwZSxcclxuICAgICAgICAgICAgICAgIHNpbmdsZVNlbGVjdDogdGhpcy5pbnN0YW5jZS5zaW5nbGVTZWxlY3QsXHJcbiAgICAgICAgICAgICAgICBpZEZpZWxkOiB0aGlzLmluc3RhbmNlLmlkRmllbGQsXHJcbiAgICAgICAgICAgICAgICB0ZXh0RmllbGQ6IHRoaXMuaW5zdGFuY2UudGV4dEZpZWxkLFxyXG4gICAgICAgICAgICAgICAgbWFwRmllbGRzOiBPYmplY3QuYXNzaWduKHt9LCB0aGlzLmluc3RhbmNlLm1hcEZpZWxkcyB8fCB7fSlcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuaW5zdGFuY2UucGVyc29uYWxDb25maWdTZXJ2aWNlLmluaXRQZXJzb25hbENvbmYoY29uZik7XHJcblxyXG4gICAgICAgICAgICAvLyDkuKrmgKfljJbphY3nva7nmoTorqLpmIXkuovku7blpITnkIZcclxuICAgICAgICAgICAgdGhpcy5saXN0ZW5QZXJzb25hbENvbmZpZ0hhbmRsZXIoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRQZXJzb25hbENvbmZpZ0tleShjb250cm9sSUQpIHtcclxuICAgICAgICAvLyByZXR1cm4gdGhpcy5pbnN0YW5jZS5uZ0NvbnRyb2wgJiYgdGhpcy5pbnN0YW5jZS5uZ0NvbnRyb2wubmFtZSA/IHRoaXMuaW5zdGFuY2UubmdDb250cm9sLm5hbWUgOiB0aGlzLmluc3RhbmNlLm1hcEZpZWxkc1xyXG4gICAgICAgIC8vICAgICA/IHRoaXMuaW5zdGFuY2UubWFwRmllbGRzW3RoaXMuaW5zdGFuY2UudGV4dEZpZWxkXVxyXG4gICAgICAgIC8vICAgICA6ICcnO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5pbnN0YW5jZS5uZ0NvbnRyb2wpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuaW5zdGFuY2UubmdDb250cm9sLm5hbWUpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmluc3RhbmNlLm5nQ29udHJvbC5uYW1lO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaW5zdGFuY2UubWFwRmllbGRzICYmIHRoaXMuaW5zdGFuY2UubWFwRmllbGRzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBPYmplY3Qua2V5cyh0aGlzLmluc3RhbmNlLm1hcEZpZWxkcykubWFwKGsgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pbnN0YW5jZS5tYXBGaWVsZHNba107XHJcbiAgICAgICAgICAgICAgICAgICAgfSkuam9pbignXycpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pbnN0YW5jZS50ZXh0RmllbGQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gJyc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOebkeWQrOaUtuiXj1RBQumhteS4reebuOWFs+S6i+S7tu+8m1xyXG4gICAgICog5pWw5o2u6YCJ5Lit77yM5Y+W5raI6YCJ5Lit77yM56e76Zmk5pS26JeP77yM5Y+M5Ye75LqL5Lu2XHJcbiAgICAgKi9cclxuICAgIGluaXRGYXZvcml0ZUNvbXBvbmVudEV2ZW50KGNtcFJlZjogQ29tcG9uZW50UmVmPGFueT4pIHtcclxuICAgICAgICBzd2l0Y2ggKHRoaXMuaW5zdGFuY2UuZGlzcGxheVR5cGUpIHtcclxuICAgICAgICAgICAgY2FzZSBMb29rdXBHcmlkRGlzcGxheVR5cGUuTmF2TGlzdDpcclxuICAgICAgICAgICAgY2FzZSBMb29rdXBHcmlkRGlzcGxheVR5cGUuTmF2VHJlZUxpc3Q6XHJcbiAgICAgICAgICAgIGNhc2UgTG9va3VwR3JpZERpc3BsYXlUeXBlLkxpc3Q6IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGZkdCA9IGNtcFJlZi5pbnN0YW5jZSBhcyBEYXRhVGFibGVDb21wb25lbnQ7XHJcbiAgICAgICAgICAgICAgICBmZHQucmVtb3RlU29ydCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgZmR0LnNlbGVjdGVkUm93LnN1YnNjcmliZShlID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pbnN0YW5jZS5zaW5nbGVTZWxlY3QpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb29rdXBTZWxlY3Rpb25TZXIuY2xlYXJTZWxlY3Rpb25zKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9va3VwU2VsZWN0aW9uU2VyLnVwZGF0ZVNlbGVjdGlvbnMoZS5kYXRhKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgZmR0LnVuU2VsZWN0Um93LnN1YnNjcmliZShlID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvb2t1cFNlbGVjdGlvblNlci51blNlbGVjdChlLmRhdGFbdGhpcy5pbnN0YW5jZS5pZEZpZWxkXSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoIWZkdC5zaW5nbGVTZWxlY3QpIHtcclxuICAgICAgICAgICAgICAgICAgICBmZHQuY2hlY2tBbGwuc3Vic2NyaWJlKGUgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvb2t1cFNlbGVjdGlvblNlci51cGRhdGVTZWxlY3Rpb25zKGZkdC5kYXRhLCBlKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBmZHQuY2VsbENsaWNrLnN1YnNjcmliZSgoZTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGUuY29sLmZpZWxkID09PSBGQVZPUklURV9GSUVMRF9OQU1FKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGUuZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogbm8tc3RyaW5nLWxpdGVyYWxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2xhc3NMaXN0ID0gZS5ldmVudC50YXJnZXRbJ2NsYXNzTGlzdCddO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2xhc3NMaXN0LmNvbnRhaW5zKCdmLWxvb2t1cC11bmZhdm9yaXRlJykpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmluc3RhbmNlLml0ZW1zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnN0YW5jZS5pdGVtcy5mb3JFYWNoKGl0ZW0gPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbVt0aGlzLmluc3RhbmNlLmlkRmllbGRdID09PSBlLnJvd1t0aGlzLmluc3RhbmNlLmlkRmllbGRdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtW0ZBVk9SSVRFX0ZJRUxEX05BTUVdID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZHQgPSB0aGlzLmluc3RhbmNlLmNvbXBvbmVudFJlZi5pbnN0YW5jZSBhcyBEYXRhVGFibGVDb21wb25lbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGR0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGR0LmxvYWREYXRhKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2VTaXplOiB0aGlzLmluc3RhbmNlLmdyaWRPcHRpb25zLnBhZ2VTaXplLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFnZUluZGV4OiB0aGlzLmluc3RhbmNlLmdyaWRPcHRpb25zLnBhZ2VJbmRleCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsOiB0aGlzLmluc3RhbmNlLmdyaWRPcHRpb25zLnRvdGFsLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogdGhpcy5pbnN0YW5jZS5ncmlkT3B0aW9ucy5pdGVtc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnN0YW5jZS5mYXZvcml0ZUl0ZW1zID1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmluc3RhbmNlLmZhdm9yaXRlSXRlbXMuZmlsdGVyKG4gPT4gblt0aGlzLmluc3RhbmNlLmlkRmllbGRdICE9PSBlLnJvd1t0aGlzLmluc3RhbmNlLmlkRmllbGRdKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvb2t1cFNlbGVjdGlvblNlci51cGRhdGVGYXZvcml0ZURhdGEoZS5yb3csIEZhdm9yaXRlQWN0aW9uLmRlbGV0ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyDlj4zlh7vkuovku7ZcclxuICAgICAgICAgICAgICAgIGZkdC5yb3dEYmxDbGljay5zdWJzY3JpYmUoKHJvd0RhdGE6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmluc3RhbmNlLmdyaWRPcHRpb25zLnNpbmdsZVNlbGVjdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmluc3RhbmNlLnNlbGVjdEl0ZW0ocm93RGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXNlIExvb2t1cEdyaWREaXNwbGF5VHlwZS5UcmVlTGlzdDoge1xyXG4gICAgICAgICAgICAgICAgaWYgKGNtcFJlZikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGZ0dCA9IGNtcFJlZi5pbnN0YW5jZSBhcyBUcmVlVGFibGVDb21wb25lbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgZnR0LnJlbW90ZVNvcnQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICBmdHQubm9kZVNlbGVjdGVkLnN1YnNjcmliZShlID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaW5zdGFuY2Uuc2luZ2xlU2VsZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvb2t1cFNlbGVjdGlvblNlci5jbGVhclNlbGVjdGlvbnMoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvb2t1cFNlbGVjdGlvblNlci51cGRhdGVTZWxlY3Rpb25zKGUubm9kZS5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICBmdHQubm9kZVVuQ2hlY2tlZC5zdWJzY3JpYmUoZSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLm5vZGVzICYmIGUubm9kZXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmluc3RhbmNlLm11bHRpU2VsTWdyLnJlbW92ZShlLm5vZGVzLm1hcChuID0+IG4uaWQpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlICYmIGUubm9kZSAmJiBlLm5vZGUuZGF0YSAmJiBlLm5vZGUuZGF0YS5pZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29uc3QgdHQgPSB0aGlzLmluc3RhbmNlLmNvbXBvbmVudFJlZi5pbnN0YW5jZSBhcyBUcmVlVGFibGVDb21wb25lbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0dC51blNlbGVjdE5vZGUoZS5ub2RlLmRhdGEuaWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb29rdXBTZWxlY3Rpb25TZXIudW5TZWxlY3QoZS5ub2RlLmRhdGEuaWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGZ0dC5ub2RlQ2hlY2tlZC5zdWJzY3JpYmUoIGUgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuaW5zdGFuY2Uuc2luZ2xlU2VsZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZS5ub2RlcyAmJiBlLm5vZGVzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zdGFuY2UubXVsdGlTZWxNZ3IudXBkYXRlU2VsZWN0aW9ucyhlLm5vZGVzLm1hcChuID0+IG4uZGF0YSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShlLm5vZGUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zdGFuY2UubXVsdGlTZWxNZ3IudXBkYXRlU2VsZWN0aW9ucyhlLm5vZGUubWFwKG4gPT4gbi5kYXRhKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnN0YW5jZS5tdWx0aVNlbE1nci51cGRhdGVTZWxlY3Rpb25zKFtlLm5vZGUuZGF0YV0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBmdHQuY2VsbENsaWNrLnN1YnNjcmliZShyb3cgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocm93LmNvbC5maWVsZCA9PT0gRkFWT1JJVEVfRklFTERfTkFNRSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93LmV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2xhc3NMaXN0ID0gcm93LmV2ZW50LnRhcmdldFsnY2xhc3NMaXN0J107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2xhc3NMaXN0LmNvbnRhaW5zKCdmLWxvb2t1cC11bmZhdm9yaXRlJykpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBfdGhpcyA9IHRoaXMuaW5zdGFuY2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGZ1bmN0aW9uIGV2ZXJ5KGl0ZW1zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaXRlbXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgaGFzRmluaXNoID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zLmZvckVhY2goaXRlbSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaGFzRmluaXNoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uZGF0YVtfdGhpcy5pZEZpZWxkXSA9PT0gcm93Lm5vZGVbX3RoaXMuaWRGaWVsZF0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLmRhdGFbRkFWT1JJVEVfRklFTERfTkFNRV0gPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYXNGaW5pc2ggPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpdGVtLmNoaWxkcmVuICYmIGl0ZW0uY2hpbGRyZW4ubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZXJ5KGl0ZW0uY2hpbGRyZW4pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSh0aGlzLmluc3RhbmNlLml0ZW1zKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0dCA9IHRoaXMuaW5zdGFuY2UuY29tcG9uZW50UmVmLmluc3RhbmNlIGFzIFRyZWVUYWJsZUNvbXBvbmVudDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0dC5sb2FkRGF0YSh0aGlzLmluc3RhbmNlLml0ZW1zKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb29rdXBTZWxlY3Rpb25TZXIudXBkYXRlRmF2b3JpdGVEYXRhKHJvdy5ub2RlLmRhdGEsIEZhdm9yaXRlQWN0aW9uLmRlbGV0ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICBmdHQuZGJsQ2xpY2suc3Vic2NyaWJlKCh0cmVlTm9kZTogVHJlZU5vZGUpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaW5zdGFuY2UuZ3JpZE9wdGlvbnMuc2luZ2xlU2VsZWN0ICYmIHRyZWVOb2RlLnNlbGVjdGFibGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmluc3RhbmNlLm9rQnV0dG9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnN0YW5jZS5va0J1dHRvbi5uYXRpdmVFbGVtZW50LmNsaWNrKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZnR0LmNoZWNrQWxsLnN1YnNjcmliZSggZSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBlLmluc3RhbmNlLmNoZWNrZWRzLm1hcChuID0+IG4uZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zdGFuY2UubXVsdGlTZWxNZ3IudXBkYXRlU2VsZWN0aW9ucyhkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnN0YW5jZS5jaGVja2VkQ2hhbmdlLmVtaXQoeyBkYXRhLCBpc0NoZWNrOiB0cnVlICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICBmdHQudW5DaGVja0FsbC5zdWJzY3JpYmUoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmluc3RhbmNlLm11bHRpU2VsTWdyLmNsZWFyKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zdGFuY2UuY2hlY2tlZENoYW5nZS5lbWl0KHsgZGF0YTogW10sIGlzQ2hlY2s6IGZhbHNlICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG4gICAgcHJpdmF0ZSBnZXRGYXZvcml0RGF0YSgpIHtcclxuICAgICAgICBpZiAodGhpcy5pbnN0YW5jZS5wZXJzb25hbENvbmYpIHtcclxuICAgICAgICAgICAgY29uc3QgZmF2RGF0YSA9IHRoaXMuaW5zdGFuY2UucGVyc29uYWxDb25mLmZhdm9yaXRlO1xyXG4gICAgICAgICAgICBjb25zdCBfZGF0YSA9IChmYXZEYXRhICYmIGZhdkRhdGFbdGhpcy5pbnN0YW5jZS5sb2NhbFNlcnZpY2UubG9jYWxlSWRdKSA/IGZhdkRhdGFbdGhpcy5pbnN0YW5jZS5sb2NhbFNlcnZpY2UubG9jYWxlSWRdIDogW107XHJcbiAgICAgICAgICAgIHJldHVybiBfZGF0YTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIFtdO1xyXG4gICAgfVxyXG5cclxuICAgIGdldEZhdm9yaXRJZHMoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0RmF2b3JpdERhdGEoKTtcclxuICAgIH1cclxuXHJcbiAgICBfbG9hZEZhdm9yaXRlRGF0YShkYXRhID0gbnVsbCkge1xyXG4gICAgICAgIGNvbnN0IGZkdCA9IHRoaXMuaW5zdGFuY2UuZmF2b3JpdGVzQ29tcG9uZW50UmVmLmluc3RhbmNlIGFzIERhdGFUYWJsZUNvbXBvbmVudDtcclxuICAgICAgICB0aGlzLmxvYWRGYXZvcml0ZURhdGF0YWJsZShmZHQsIGRhdGEpO1xyXG4gICAgICAgIGZkdC5jZC5tYXJrRm9yQ2hlY2soKTtcclxuICAgICAgICB0aGlzLmluc3RhbmNlLmNsb3NlTG9hZGluZygpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOWKoOi9veaUtuiXj2dyaWTmlbDmja5cclxuICAgIGxvYWRGYXZvcml0ZXNEYXRhKHJlcyA9IG51bGwpIHtcclxuICAgICAgICBjb25zdCBmYXZJZHMgPSB0aGlzLmdldEZhdm9yaXRJZHMoKTtcclxuICAgICAgICBzd2l0Y2ggKHRoaXMuaW5zdGFuY2UuZGlzcGxheVR5cGUpIHtcclxuICAgICAgICAgICAgY2FzZSBMb29rdXBHcmlkRGlzcGxheVR5cGUuTmF2TGlzdDpcclxuICAgICAgICAgICAgY2FzZSBMb29rdXBHcmlkRGlzcGxheVR5cGUuTmF2VHJlZUxpc3Q6XHJcbiAgICAgICAgICAgIGNhc2UgTG9va3VwR3JpZERpc3BsYXlUeXBlLkxpc3Q6IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGZkdCA9IHRoaXMuaW5zdGFuY2UuZmF2b3JpdGVzQ29tcG9uZW50UmVmLmluc3RhbmNlIGFzIERhdGFUYWJsZUNvbXBvbmVudDtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmluc3RhbmNlLmZhdm9yaXRlRGF0YUZyb20gPT09ICdsb2NhbGUnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9sb2FkRmF2b3JpdGVEYXRhKHJlcy5pdGVtcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5pbnN0YW5jZS5odHRwTWdyLmdldEZhdm9yaXRlRGF0YShmYXZJZHMpLnN1YnNjcmliZShyZXNEYXRhID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgIGlmIChyZXNEYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgdGhpcy5fbG9hZEZhdm9yaXRlRGF0YShyZXNEYXRhLml0ZW1zKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgIHRoaXMuaW5zdGFuY2UuY2xvc2VMb2FkaW5nKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZmF2RGF0YSA9IHRoaXMuZ2V0RmF2b3JpdERhdGEoKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRGYXZvcml0ZURhdGF0YWJsZShmZHQsIHJlcyA/IHJlcy5pdGVtcyA6IGZhdkRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2FzZSBMb29rdXBHcmlkRGlzcGxheVR5cGUuVHJlZUxpc3Q6IHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmluc3RhbmNlLmZhdm9yaXRlc0NvbXBvbmVudFJlZiAmJiB0aGlzLmluc3RhbmNlLmZhdm9yaXRlc0NvbXBvbmVudFJlZi5pbnN0YW5jZSBpbnN0YW5jZW9mIFRyZWVUYWJsZUNvbXBvbmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGZ0dCA9IHRoaXMuaW5zdGFuY2UuZmF2b3JpdGVzQ29tcG9uZW50UmVmLmluc3RhbmNlIGFzIFRyZWVUYWJsZUNvbXBvbmVudDtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmJpbmRGYXZUcmVldGFibGUoZnR0KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaW5zdGFuY2UuZmF2b3JpdGVEYXRhRnJvbSA9PT0gJ2xvY2FsZScpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkRmF2b3JpdGVGb3JUcmVlVGFibGUocmVzLml0ZW1zIHx8IFtdLCBmdHQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5pbnN0YW5jZS5odHRwTWdyLmdldEZhdm9yaXRlRGF0YShmYXZJZHMpLnN1YnNjcmliZShyZXNEYXRhID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICBpZiAocmVzRGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgICBjb25zdCBpdGVtcyA9IHJlc0RhdGEuaXRlbXM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgIHRoaXMubG9hZEZhdm9yaXRlRm9yVHJlZVRhYmxlKGl0ZW1zLCBmdHQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICB0aGlzLmluc3RhbmNlLmNsb3NlTG9hZGluZygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRGYXZvcml0ZUZvclRyZWVUYWJsZShyZXMuaXRlbXMsIGZ0dCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBsb2FkRmF2b3JpdGVEYXRhdGFibGUoZmR0OiBEYXRhVGFibGVDb21wb25lbnQsIGRhdGE/OiBhbnkpIHtcclxuICAgICAgICBpZiAoZGF0YSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zdGFuY2UuZmF2b3JpdGVJdGVtcyA9IGRhdGE7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoZmR0LmNvbHVtbnMgJiYgIWZkdC5jb2x1bW5zLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBmZHQuY29sdW1ucyA9IHRoaXMuaW5zdGFuY2UuZmF2b3JpdGVDb2x1bW5zO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZmR0LmxvYWREYXRhKHtcclxuICAgICAgICAgICAgdG90YWw6IDAsXHJcbiAgICAgICAgICAgIHBhZ2VTaXplOiAyMCxcclxuICAgICAgICAgICAgcGFnZUluZGV4OiAxLFxyXG4gICAgICAgICAgICBkYXRhOiB0aGlzLmluc3RhbmNlLmZhdm9yaXRlSXRlbXNcclxuICAgICAgICB9KTtcclxuXHJcblxyXG4gICAgICAgIHRoaXMuaW5zdGFuY2Uuc2VsZWN0aW9uTWdyLnNlbGVjdEN1cnJlbnRWYWx1ZSgpO1xyXG4gICAgICAgIGZkdC5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHByaXZhdGUgYmluZEZhdlRyZWV0YWJsZShmdHQ6IFRyZWVUYWJsZUNvbXBvbmVudCkge1xyXG4gICAgICAgIGZ0dC5hbGxDb2x1bW5zVGl0bGUgPSB0aGlzLmluc3RhbmNlLmFsbENvbHVtbnNUaXRsZTtcclxuICAgICAgICBmdHQuaWRGaWVsZCA9IHRoaXMuaW5zdGFuY2UuaWRGaWVsZDtcclxuXHJcbiAgICAgICAgY29uc3QgY29sdW1ucyA9IHRoaXMuaW5zdGFuY2UuZ3JpZE9wdGlvbnMuY29sdW1ucy5tYXAoaXRlbSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJ0bjogYW55ID0geyAuLi5pdGVtIH07XHJcbiAgICAgICAgICAgIGlmIChpdGVtLmZpZWxkID09PSBGQVZPUklURV9GSUVMRF9OQU1FKSB7XHJcbiAgICAgICAgICAgICAgICBydG4uZm9ybWF0dGVyID0gKHY6IGFueSwgZGF0YTogYW55KTogYW55ID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBmYXZpZHMgPSB0aGlzLmdldEZhdm9yaXRJZHMoKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZmF2aWRzICYmIGZhdmlkcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSBmYXZpZHMuZmluZEluZGV4KGVsID0+IGVsID09PSBkYXRhW3RoaXMuaW5zdGFuY2UuaWRGaWVsZF0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXggPj0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhdm9yaXRlSWNvbi5kZWxldGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gcnRuO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuaW5zdGFuY2UuZmF2b3JpdGVDb2x1bW5zID0gY29sdW1ucztcclxuICAgICAgICBmdHQuY29sdW1ucyA9IGNvbHVtbnM7XHJcblxyXG5cclxuICAgICAgICBpZiAodGhpcy5pbnN0YW5jZS5ncmlkT3B0aW9ucy50cmVlSW5mbykge1xyXG4gICAgICAgICAgICBmdHQub25seVNlbGVjdExlYWYgPSB0aGlzLmluc3RhbmNlLmdyaWRPcHRpb25zLnRyZWVJbmZvLm9ubHlTZWxlY3RMZWFmO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCFmdHQuc2luZ2xlU2VsZWN0KSB7XHJcbiAgICAgICAgICAgIGZ0dC5jaGVja09uU2VsZWN0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgZnR0LnNlbGVjdE9uQ2hlY2sgPSB0cnVlO1xyXG4gICAgICAgICAgICBmdHQuc2hvd0NoZWNrYm94ID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgIC8vIOWQr+eUqOWkmumAieWQju+8jOWQjOaXtuWQr+eUqOe6p+iBlOmAieaLqVxyXG4gICAgICAgICAgICAvLyDlkK/nlKjlpJrpgInlkI7vvIzlkIzml7blkK/nlKjnuqfogZTpgInmi6lcclxuICAgICAgICAgICAgaWYgKHRoaXMuaW5zdGFuY2UuZW5hYmxlQ2FzY2FkZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnN0YW5jZS50dEV2ZW50TWdyLmNhc2NhZGVWYWx1ZUNoYW5nZWQodGhpcy5pbnN0YW5jZS5jYXNjYWRlU3RhdHVzKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGZ0dC5jYXNjYWRlQ2hlY2sgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGZ0dC5jYXNjYWRlRG93biA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgZnR0LmNhc2NhZGVVcCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY2hlY2tOb2RlSXNMZWFmKG5vZGVzOiBhbnkgKSB7XHJcbiAgICAgICAgaWYgKG5vZGVzICYmIG5vZGVzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbm9kZXMubWFwKChub2RlOiBUcmVlTm9kZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKG5vZGUuaGFzT3duUHJvcGVydHkoXCJhZGR0aW9uYWxcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICBub2RlLnNlbGVjdGFibGUgPSAhbm9kZVtcImFkZHRpb25hbFwiXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgaWYgKG5vZGUuY2hpbGRyZW4gJiYgbm9kZS5jaGlsZHJlbi5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNoZWNrTm9kZUlzTGVhZihub2RlLmNoaWxkcmVuKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbm9kZS5sZWFmID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5vZGU7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbm9kZXM7XHJcbiAgICB9XHJcblxyXG4gICAgaW5pdEZhdm9yaXRlVHJlZURhdGEoaXRlbXMpIHtcclxuICAgICAgICBjb25zdCB0cmVlSW5mbyA9IHRoaXMuaW5zdGFuY2UuZ3JpZE9wdGlvbnMudHJlZUluZm87XHJcblxyXG4gICAgICAgIGlmICh0cmVlSW5mbyAmJiAhdHJlZUluZm9bJ3RyZWVEYXRhSXNJbml0J10pIHtcclxuICAgICAgICAgICAgaWYgKHRyZWVJbmZvLmxheWVyVHlwZS50b0xvd2VyQ2FzZSgpID09PSAncGF0aGNvZGUnKSB7XHJcbiAgICAgICAgICAgICAgICBpdGVtcyA9IHRoaXMuaW5zdGFuY2UubG9va3VwVXRpbHMubWFrZVRyZWUoaXRlbXMsIHRyZWVJbmZvKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGl0ZW1zID0gdGhpcy5pbnN0YW5jZS5sb29rdXBVdGlscy5tYWtlVHJlZVdpdGhQYXJlbnRJRChcclxuICAgICAgICAgICAgICAgICAgICBpdGVtcyxcclxuICAgICAgICAgICAgICAgICAgICAnJyxcclxuICAgICAgICAgICAgICAgICAgICBgJHt0cmVlSW5mby5kYXRhRmllbGR9LiR7dHJlZUluZm8ucGFyZW50RmllbGR9YCxcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmluc3RhbmNlLmlkRmllbGRcclxuICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIHJldHVybiB0aGlzLmluc3RhbmNlLmNoZWNrTm9kZUNhbkJlU2VsZWN0KGl0ZW1zLCB0cnVlKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5jaGVja05vZGVJc0xlYWYoaXRlbXMpO1xyXG4gICAgfVxyXG5cclxuICAgIGxvYWRGYXZvcml0ZUZvclRyZWVUYWJsZShpdGVtcywgZnR0OiBhbnkpIHtcclxuICAgICAgICBpdGVtcyA9IHRoaXMuaW5pdEZhdm9yaXRlVHJlZURhdGEoaXRlbXMpO1xyXG4gICAgICAgIHRoaXMuaW5zdGFuY2UuZmF2b3JpdGVJdGVtcyA9IGl0ZW1zO1xyXG4gICAgICAgIGZ0dC5sb2FkRGF0YShpdGVtcyk7XHJcbiAgICAgICAgZnR0LmV4cGFuZEFsbCgpO1xyXG4gICAgICAgIHRoaXMuaW5zdGFuY2Uuc2VsZWN0aW9uTWdyLnNlbGVjdEN1cnJlbnRWYWx1ZSgpO1xyXG5cclxuICAgICAgICByZXR1cm4gaXRlbXM7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5pu05paw5YiX6KGo5Lit55qE5pS26JeP5pWw5o2u5qCH6K+GXHJcbiAgICB1cGRhdGVGYXZvcml0ZXNTdGF0dXMoZGF0YTogYW55W10pIHtcclxuXHJcbiAgICAgICAgaWYgKCFkYXRhIHx8ICF0aGlzLmluc3RhbmNlLnVzZUZhdm9yaXRlKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGZhdklkcyA9IHRoaXMuZ2V0RmF2b3JpdElkcygpO1xyXG5cclxuICAgICAgICBpZiAoZmF2SWRzICYmIGZhdklkcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgLy8g5aSE55CG5pWw5o2u5YiX6KGo5Lit55qE5pS26JeP5pWw5o2u5qCH6K+GXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmluc3RhbmNlLmRpc3BsYXlUeXBlICE9PSBMb29rdXBHcmlkRGlzcGxheVR5cGUuVHJlZUxpc3QpIHtcclxuICAgICAgICAgICAgICAgIGRhdGEubWFwKGl0ZW0gPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChmYXZJZHMgJiYgZmF2SWRzLmxlbmd0aCAmJiBmYXZJZHMuZmluZCh2ID0+IHYgPT09IGl0ZW1bdGhpcy5pbnN0YW5jZS5pZEZpZWxkXSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbVtGQVZPUklURV9GSUVMRF9OQU1FXSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBfdGhpcyA9IHRoaXMuaW5zdGFuY2U7XHJcbiAgICAgICAgICAgICAgICAoZnVuY3Rpb24gZWFjaChfZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIF9kYXRhLmZvckVhY2goaXRlbSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmYXZJZHMgJiYgZmF2SWRzLmxlbmd0aCAmJiBmYXZJZHMuZmluZCh2ID0+IHYgPT09IGl0ZW0uZGF0YVtfdGhpcy5pZEZpZWxkXSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uZGF0YVtGQVZPUklURV9GSUVMRF9OQU1FXSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uY2hpbGRyZW4gJiYgaXRlbS5jaGlsZHJlbi5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlYWNoKGl0ZW0uY2hpbGRyZW4pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9KShkYXRhKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG4gICAgcHJpdmF0ZSBfdXBkYXRlRmF2b3JpdGVzKHZhbHVlOiBhbnksIGFjdGlvbikge1xyXG4gICAgICAgIGNvbnN0IGxvY2FsZUlEID0gdGhpcy5pbnN0YW5jZS5sb2NhbFNlcnZpY2UubG9jYWxlSWQ7XHJcbiAgICAgICAgdGhpcy5pbnN0YW5jZS5wZXJzb25hbENvbmYuZmF2b3JpdGUgPSB0aGlzLmluc3RhbmNlLnBlcnNvbmFsQ29uZi5mYXZvcml0ZSB8fCB7fTtcclxuICAgICAgICBjb25zdCBpdGVtcyA9IHZhbHVlLmZpbHRlcihuID0+ICFuWydfYWRkdGlvbmFsXyddKTtcclxuICAgICAgICBjb25zdCBuZXdWYWwgPSBpdGVtcy5tYXAobiA9PiBuW3RoaXMuaW5zdGFuY2UuaWRGaWVsZF0pLmZpbHRlcihuID0+IG4gIT09IG51bGwgJiYgbiAhPT0gdW5kZWZpbmVkKTtcclxuICAgICAgICAvLyBjb25zdCBmYXZJZHMgPSB0aGlzLmluc3RhbmNlLnBlcnNvbmFsQ29uZi5mYXZvcml0ZVtsb2NhbGVJRF0gfHwgW107XHJcbiAgICAgICAgdGhpcy5pbnN0YW5jZS5wZXJzb25hbENvbmYuZmF2b3JpdGVbbG9jYWxlSURdID0gbmV3VmFsO1xyXG4gICAgICAgIHJldHVybiBuZXdWYWw7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5pS26JeP5pWw5o2u566h55CGXHJcbiAgICBwcml2YXRlIGxpc3RlblBlcnNvbmFsQ29uZmlnSGFuZGxlcigpIHtcclxuICAgICAgICB0aGlzLmxvb2t1cFNlbGVjdGlvblNlci5mYXZvcml0ZUl0ZW1zJC5zdWJzY3JpYmUobiA9PiB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5pbnN0YW5jZS5mYXZvcml0ZXNDb21wb25lbnRSZWYpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY29uc3QgeyBpdGVtcywgYWN0aW9uIH0gPSBuO1xyXG4gICAgICAgICAgICBjb25zdCBmYXZpZHMgPSB0aGlzLl91cGRhdGVGYXZvcml0ZXMoaXRlbXMsIGFjdGlvbik7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmluc3RhbmNlLmh0dHBNZ3Iuc3VibWl0RmF2b3JpdGVEYXRhKGFjdGlvbik7XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5pbnN0YW5jZS5kaXNwbGF5VHlwZSA9PT0gTG9va3VwR3JpZERpc3BsYXlUeXBlLkxpc3QgfHwgdGhpcy5pbnN0YW5jZS5kaXNwbGF5VHlwZS5pbmNsdWRlcygnTkFWJykpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGR0ID0gdGhpcy5pbnN0YW5jZS5mYXZvcml0ZXNDb21wb25lbnRSZWYuaW5zdGFuY2UgYXMgRGF0YVRhYmxlQ29tcG9uZW50O1xyXG4gICAgICAgICAgICAgICAgdGhpcy5sb2FkRmF2b3JpdGVEYXRhdGFibGUoZHQsIGl0ZW1zKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmluc3RhbmNlLmRpc3BsYXlUeXBlID09PSBMb29rdXBHcmlkRGlzcGxheVR5cGUuVHJlZUxpc3QpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGZ0dCA9IHRoaXMuaW5zdGFuY2UuZmF2b3JpdGVzQ29tcG9uZW50UmVmLmluc3RhbmNlIGFzIFRyZWVUYWJsZUNvbXBvbmVudDtcclxuICAgICAgICAgICAgICAgIC8vIGNvbnN0IGZhdmlkcyA9IGl0ZW1zLm1hcChkID0+IGQuaWQpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnN0YW5jZS5zaG93TG9hZGluZygpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnN0YW5jZS5odHRwTWdyLmdldERhdGEoeyBmYXZvcml0ZUlkczogZmF2aWRzIH0sICdmYXYnKS5zdWJzY3JpYmUocmVzRGF0YSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc0RhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgX2l0ZW1zID0gcmVzRGF0YS5pdGVtcztcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkRmF2b3JpdGVGb3JUcmVlVGFibGUoX2l0ZW1zLCBmdHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zdGFuY2UuZmF2b3JpdGVJdGVtcyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmdHQubG9hZERhdGEoW10pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmluc3RhbmNlLmNsb3NlTG9hZGluZygpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbn1cclxuIl19