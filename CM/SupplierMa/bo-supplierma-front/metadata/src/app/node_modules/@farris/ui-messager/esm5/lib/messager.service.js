/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*
 * @Author: 疯狂秀才(Lucas Huang)
 * @LastEditors: 疯狂秀才(Lucas Huang)
 * @Company: Inspur
 * @Version: v0.0.15
 * @Date: 2019-04-02 11:48:08
 * @LastEditTime: 2019-10-26 16:38:34
 */
import { Injectable, Injector, NgZone } from '@angular/core';
import { Subject, of } from 'rxjs';
import { BsModalService } from '@farris/ui-modal';
import { MessagerDefaultConfig, MESSAGER_DEFAULT_CONFIG } from './messager.config';
import { MessagerComponent } from './messager.component';
import { LocaleService } from '@farris/ui-locale';
var MessagerService = /** @class */ (function () {
    function MessagerService(bsModalService, injector) {
        this.bsModalService = bsModalService;
        this.injector = injector;
        this.version = '0.0.15';
        this.currentId = -1;
        this.modals = [];
        this.defaultMessagerConfig = null;
        /** @type {?} */
        var config = this.injector.get(MESSAGER_DEFAULT_CONFIG) || MessagerDefaultConfig;
        this.defaultMessagerConfig = Object.assign({}, MessagerDefaultConfig, config);
        this.ngZone = this.injector.get(NgZone);
        this.localeService = this.injector.get(LocaleService);
    }
    Object.defineProperty(MessagerService.prototype, "okText", {
        get: /**
         * @return {?}
         */
        function () {
            return this.localeService.getValue('messager.ok');
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(MessagerService.prototype, "cancelText", {
        get: /**
         * @return {?}
         */
        function () {
            return this.localeService.getValue('messager.cancel');
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(MessagerService.prototype, "yesText", {
        get: /**
         * @return {?}
         */
        function () {
            return this.localeService.getValue('messager.yes');
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(MessagerService.prototype, "noText", {
        get: /**
         * @return {?}
         */
        function () {
            return this.localeService.getValue('messager.no');
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(MessagerService.prototype, "titleText", {
        get: /**
         * @return {?}
         */
        function () {
            return this.localeService.getValue('messager.title');
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(MessagerService.prototype, "errorTitle", {
        get: /**
         * @return {?}
         */
        function () {
            return this.localeService.getValue('messager.errorTitle');
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} str
     * @return {?}
     */
    MessagerService.prototype.escapeHtml = /**
     * @param {?} str
     * @return {?}
     */
    function (str) {
        if (str === null || str === undefined) {
            return '';
        }
        return str
            .replace(/&/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;')
            .replace(/\"/g, '&quot;')
            .replace(/\'/g, '&#39;')
            .replace(/\//g, '&#x2F;');
    };
    /**
     * 显示信息提示框
     * @param msgtype 消息类别
     * @param message 提示消息一
     * @param opts 参数 提供属性 fitContent:true支持自动适应宽度
     * @param submsg 提示消息二级
     */
    /**
     * 显示信息提示框
     * @param {?} msgtype 消息类别
     * @param {?} message 提示消息一
     * @param {?=} opts 参数 提供属性 fitContent:true支持自动适应宽度
     * @param {?=} submsg 提示消息二级
     * @return {?}
     */
    MessagerService.prototype.show = /**
     * 显示信息提示框
     * @param {?} msgtype 消息类别
     * @param {?} message 提示消息一
     * @param {?=} opts 参数 提供属性 fitContent:true支持自动适应宽度
     * @param {?=} submsg 提示消息二级
     * @return {?}
     */
    function (msgtype, message, opts, submsg) {
        var _this = this;
        if (submsg === void 0) { submsg = ''; }
        if (document.activeElement) {
            ((/** @type {?} */ (document.activeElement))).blur();
        }
        /** @type {?} */
        var modalHeight = 180;
        /** @type {?} */
        var defaultOpts = {
            safeHtml: true,
            title: this.titleText,
            width: 390,
            height: modalHeight,
            showButtons: false,
            showMaxButton: false,
            resizable: false,
            initialState: {
                okText: this.okText,
                okHandle: (/**
                 * @return {?}
                 */
                function () {
                    _this.close();
                })
            },
            class: 'modal-message ' + (msgtype ? 'modal-message-type-' + msgtype : ''),
            showHeader: false,
        };
        defaultOpts = Object.assign({}, this.defaultMessagerConfig, defaultOpts);
        /** @type {?} */
        var extendOpts = {};
        switch (msgtype) {
            case 'prompt':
                // 弹出对话类型
                extendOpts = { showHeader: true, modalHeight: 260 };
                break;
            case 'error':
                // 错误
                extendOpts = { title: this.errorTitle, width: 446, showHeader: true, showMaxButton: true, fitContent: true };
                break;
            case 'exception':
                extendOpts = { safeHtml: false, title: this.errorTitle, width: 446, showHeader: true, fitContent: true };
                break;
            default:
                // 默认其他
                extendOpts = { width: submsg ? 446 : 390, fitContent: true };
        }
        Object.assign(defaultOpts, extendOpts);
        if (opts) {
            Object.assign(defaultOpts, opts);
        }
        if (message && defaultOpts.safeHtml) {
            message = this.escapeHtml(message);
        }
        Object.assign(defaultOpts.initialState, {
            type: msgtype,
            message: message,
            msg: submsg,
            exception: opts && opts['exception'] ? opts['exception'] : null,
            showLines: opts && opts['showLines'] ? opts['showLines'] : 3,
            readonly: opts && opts['readonly'] ? opts['readonly'] : false
        });
        if (defaultOpts['buttons'] && defaultOpts['buttons'].length) {
            if (!defaultOpts.initialState['buttons'] || !defaultOpts.initialState['buttons'].length) {
                defaultOpts.initialState['buttons'] = defaultOpts['buttons'];
            }
        }
        /** @type {?} */
        var _modal = this.bsModalService.show(MessagerComponent, defaultOpts);
        // _modal.content.buttons = defaultOpts['buttons'] || [];
        this.confirmSubject = new Subject();
        if (this.modals.length > 0) {
            /** @type {?} */
            var modalContainerComponent = _modal.dialog;
            modalContainerComponent.instance.isShown = true;
            modalContainerComponent.instance.moveTo(15 * this.modals.length, 15 * this.modals.length);
        }
        this.ngZone.runOutsideAngular((/**
         * @return {?}
         */
        function () {
            // 第1个按钮获取焦点
            setTimeout((/**
             * @return {?}
             */
            function () {
                /** @type {?} */
                var btnOk = _modal.content.btnOkEl ? _modal.content.btnOkEl.nativeElement : null;
                if (btnOk) {
                    btnOk['focus']();
                }
                else {
                    /** @type {?} */
                    var btns = _modal.dialog.location.nativeElement.querySelectorAll('.modal-footer button');
                    if (btns.length) {
                        btns.item(0)['focus']();
                    }
                }
            }));
        }));
        this.msgMgr(_modal);
        return _modal;
    };
    /**
     * @private
     * @param {?} ref
     * @return {?}
     */
    MessagerService.prototype.msgMgr = /**
     * @private
     * @param {?} ref
     * @return {?}
     */
    function (ref) {
        var _this = this;
        /** @type {?} */
        var id = this.bsModalService.getModalsCount() + 1000;
        if (this.modals.length === 0) {
            this.modals.push({ id: id, ref: ref });
        }
        else {
            if (!this.getModalById(id)) {
                this.modals.push({ id: id, ref: ref });
            }
            else {
                this.getModalById(id).ref = ref;
            }
        }
        /** @type {?} */
        var cmp = this.getModalCmp();
        cmp.closed.subscribe((/**
         * @param {?} level
         * @return {?}
         */
        function (level) {
            _this.removeMessager(id);
            _this.confirmSubject.unsubscribe();
        }));
        this.currentId = id;
    };
    /**
     * @param {?} message
     * @param {?} okCallback
     * @param {?=} cancelCallback
     * @param {?=} msg
     * @param {?=} fitContent
     * @return {?}
     */
    MessagerService.prototype.question = /**
     * @param {?} message
     * @param {?} okCallback
     * @param {?=} cancelCallback
     * @param {?=} msg
     * @param {?=} fitContent
     * @return {?}
     */
    function (message, okCallback, cancelCallback, msg, fitContent) {
        if (fitContent === void 0) { fitContent = true; }
        /** @type {?} */
        var questionDlg = this.show('question', message, {
            initialState: {
                okText: this.yesText,
                okHandle: (/**
                 * @return {?}
                 */
                function () {
                    questionDlg.close();
                    if (okCallback) {
                        okCallback();
                    }
                }),
                cancelText: this.noText,
                cancelHandle: (/**
                 * @return {?}
                 */
                function () {
                    questionDlg.close();
                    if (cancelCallback) {
                        cancelCallback();
                    }
                })
            },
            fitContent: fitContent
        }, msg);
        return questionDlg;
    };
    /**
     * @param {?} messager
     * @param {?} btns
     * @param {?=} msg
     * @param {?=} fitContent
     * @return {?}
     */
    MessagerService.prototype.question2 = /**
     * @param {?} messager
     * @param {?} btns
     * @param {?=} msg
     * @param {?=} fitContent
     * @return {?}
     */
    function (messager, btns, msg, fitContent) {
        if (fitContent === void 0) { fitContent = true; }
        return this.show('question', messager, {
            initialState: {
                buttons: btns
            },
            fitContent: fitContent
        }, msg);
    };
    /**
     * 2020年3月7日因为textarea高度在不同浏览器下不一样，固定高度可能会出现滚动条
     * @param title 标题
     * @param msg 信息
     * @param fitContent 自适应内容
     */
    /**
     * 2020年3月7日因为textarea高度在不同浏览器下不一样，固定高度可能会出现滚动条
     * @param {?} title 标题
     * @param {?=} msg 信息
     * @param {?=} fitContent 自适应内容
     * @return {?}
     */
    MessagerService.prototype.prompt = /**
     * 2020年3月7日因为textarea高度在不同浏览器下不一样，固定高度可能会出现滚动条
     * @param {?} title 标题
     * @param {?=} msg 信息
     * @param {?=} fitContent 自适应内容
     * @return {?}
     */
    function (title, msg, fitContent) {
        if (fitContent === void 0) { fitContent = true; }
        /** @type {?} */
        var promptSubject = new Subject();
        /** @type {?} */
        var dlg = this.show('prompt', msg, {
            title: title,
            initialState: {
                okText: this.okText,
                okHandle: (/**
                 * @return {?}
                 */
                function () {
                    /** @type {?} */
                    var mc = (/** @type {?} */ (dlg.content));
                    dlg.close();
                    promptSubject.next(mc.promptText.nativeElement.value);
                }),
                cancelText: this.cancelText,
                cancelHandle: (/**
                 * @return {?}
                 */
                function () {
                    dlg.close();
                    promptSubject.next(false);
                })
            },
            fitContent: fitContent,
            closed: (/**
             * @return {?}
             */
            function () {
                promptSubject.unsubscribe();
            })
        }, msg);
        return promptSubject;
    };
    /**
     * @param {?} title
     * @param {?=} msg
     * @param {?=} opts
     * @return {?}
     */
    MessagerService.prototype.prompt2 = /**
     * @param {?} title
     * @param {?=} msg
     * @param {?=} opts
     * @return {?}
     */
    function (title, msg, opts) {
        var _this = this;
        /** @type {?} */
        var promptSubject = new Subject();
        /** @type {?} */
        var _opts = {
            showOkButton: true,
            showCloseButton: true,
            showFontSize: false,
            fontSize: 18,
            readonly: false,
            saveSize: false,
            closeWhenever: true
        };
        if (!opts) {
            opts = _opts;
        }
        else {
            opts = Object.assign(_opts, opts);
        }
        /** @type {?} */
        var _dialogOpts = {
            title: title,
            initialState: {
                showOkButton: opts.showOkButton === undefined ? true : opts.showOkButton,
                showCancelButton: opts.showCancelButton === undefined ? true : opts.showCancelButton,
                okText: this.okText,
                okHandle: (/**
                 * @return {?}
                 */
                function () {
                    /** @type {?} */
                    var mc = (/** @type {?} */ (dlg.content));
                    /** @type {?} */
                    var val = mc.promptText.nativeElement.value;
                    if (opts.closeWhenever) {
                        dlg.close();
                        promptSubject.next(val);
                    }
                    else {
                        promptSubject.next({ val: val, dlg: dlg });
                    }
                }),
                cancelText: this.cancelText,
                cancelHandle: (/**
                 * @return {?}
                 */
                function () {
                    dlg.close();
                    promptSubject.next(false);
                }),
                showFontSize: opts.showFontSize,
                fontSize: opts.fontSize || 18,
                enableWordCount: !!opts.enableWordCount,
                countType: opts.countType || 'length',
                maxLength: opts.maxLength,
                inputType: opts.inputType || 'textarea',
                placeholder: opts.placeholder || ''
            },
            fitContent: false,
            showMaxButton: true,
            resizable: true,
            class: '',
            closed: (/**
             * @return {?}
             */
            function () {
                promptSubject.unsubscribe();
            }),
            opened: (/**
             * @return {?}
             */
            function () {
                if (opts.inputType !== 'textarea') {
                    return;
                }
                else {
                    setTimeout((/**
                     * @return {?}
                     */
                    function () {
                        /** @type {?} */
                        var textareaEle = dlg.content.promptText.nativeElement;
                        textareaEle.closest('section').style.padding = '15px';
                        textareaEle.style.resize = 'none';
                        textareaEle.style.height = '100%';
                        if (opts.readonly) {
                            textareaEle.readOnly = true;
                        }
                    }));
                }
            }),
            beforeClose: (/**
             * @param {?} modalRef
             * @return {?}
             */
            function (modalRef) {
                if (opts.saveSize && !dlg.dialog.instance.isMax) {
                    /** @type {?} */
                    var data = { fontSize: dlg.content.fontSize, width: modalRef.config.width, height: modalRef.config.height };
                    _this.saveTextAreaSizeInfo(data);
                }
                return of(true);
            })
        };
        /** @type {?} */
        var dialogOpts = _dialogOpts;
        if (opts) {
            dialogOpts = Object.assign(dialogOpts, opts);
        }
        /** @type {?} */
        var dlg = this.show('prompt', msg, dialogOpts, msg);
        if (opts.inputType && dlg.content.promptText) {
            dlg.content.promptText.nativeElement.focus();
        }
        return promptSubject;
    };
    /**
     * @return {?}
     */
    MessagerService.prototype.getKeyString = /**
     * @return {?}
     */
    function () {
        // 一台终端共用一个配置
        // 保留最后一次的设置，
        // 保存窗口大小，字体大小
        return 'IGIX-FARRIS-UI-TEXTAREA-ZOOM-SETTINGS';
    };
    /**
     * @private
     * @param {?} data
     * @return {?}
     */
    MessagerService.prototype.saveTextAreaSizeInfo = /**
     * @private
     * @param {?} data
     * @return {?}
     */
    function (data) {
        if (window.localStorage) {
            /** @type {?} */
            var key = this.getKeyString();
            localStorage.setItem(key, JSON.stringify(data));
        }
    };
    /**
     * @param {?} message
     * @param {?=} msg
     * @param {?=} fitContent
     * @return {?}
     */
    MessagerService.prototype.confirm = /**
     * @param {?} message
     * @param {?=} msg
     * @param {?=} fitContent
     * @return {?}
     */
    function (message, msg, fitContent) {
        if (fitContent === void 0) { fitContent = true; }
        /** @type {?} */
        var confirmSubject = new Subject();
        /** @type {?} */
        var confirmDlg = this.show('question', message, {
            initialState: {
                okText: this.okText,
                okHandle: (/**
                 * @return {?}
                 */
                function () {
                    confirmDlg.close();
                    confirmSubject.next(true);
                }),
                cancelText: this.cancelText,
                cancelHandle: (/**
                 * @return {?}
                 */
                function () {
                    confirmDlg.close();
                    confirmSubject.next(false);
                })
            },
            fitContent: fitContent,
            closed: (/**
             * @return {?}
             */
            function () {
                confirmSubject.unsubscribe();
            })
        }, msg);
        return confirmSubject.asObservable();
    };
    /**
     * @param {?} message
     * @param {?=} callback
     * @param {?=} msg
     * @param {?=} fitContent
     * @return {?}
     */
    MessagerService.prototype.info = /**
     * @param {?} message
     * @param {?=} callback
     * @param {?=} msg
     * @param {?=} fitContent
     * @return {?}
     */
    function (message, callback, msg, fitContent) {
        if (fitContent === void 0) { fitContent = true; }
        /** @type {?} */
        var infoDlg = this.show('info', message, {
            initialState: {
                okText: this.okText,
                okHandle: (/**
                 * @return {?}
                 */
                function () {
                    infoDlg.close();
                    if (callback) {
                        callback();
                    }
                })
            },
            fitContent: fitContent
        }, msg);
        return infoDlg;
    };
    /** 操作成功提示，
     * message: 提示信息
     * msg: 2级信息
     * fitCountent: 默认为true
     * callback: 确定事件回调
     */
    /**
     * 操作成功提示，
     * message: 提示信息
     * msg: 2级信息
     * fitCountent: 默认为true
     * callback: 确定事件回调
     * @param {?} message
     * @param {?=} msg
     * @param {?=} fitContent
     * @param {?=} callback
     * @return {?}
     */
    MessagerService.prototype.success = /**
     * 操作成功提示，
     * message: 提示信息
     * msg: 2级信息
     * fitCountent: 默认为true
     * callback: 确定事件回调
     * @param {?} message
     * @param {?=} msg
     * @param {?=} fitContent
     * @param {?=} callback
     * @return {?}
     */
    function (message, msg, fitContent, callback) {
        if (fitContent === void 0) { fitContent = true; }
        if (callback === void 0) { callback = null; }
        /** @type {?} */
        var successDlg = this.show('success', message, {
            initialState: {
                okText: this.okText,
                okHandle: (/**
                 * @return {?}
                 */
                function () {
                    successDlg.close();
                    if (callback) {
                        callback();
                    }
                })
            },
            fitContent: fitContent
        }, msg);
        return successDlg;
    };
    /** 提示错误信息，
     * message: 提示信息
     * msg: 2级信息
     * fitCountent: 默认为true
     * callback: 确定事件回调
     */
    /**
     * 提示错误信息，
     * message: 提示信息
     * msg: 2级信息
     * fitCountent: 默认为true
     * callback: 确定事件回调
     * @param {?} message
     * @param {?=} msg
     * @param {?=} fitContent
     * @param {?=} callback
     * @param {?=} safeHtml
     * @return {?}
     */
    MessagerService.prototype.error = /**
     * 提示错误信息，
     * message: 提示信息
     * msg: 2级信息
     * fitCountent: 默认为true
     * callback: 确定事件回调
     * @param {?} message
     * @param {?=} msg
     * @param {?=} fitContent
     * @param {?=} callback
     * @param {?=} safeHtml
     * @return {?}
     */
    function (message, msg, fitContent, callback, safeHtml) {
        if (fitContent === void 0) { fitContent = true; }
        if (callback === void 0) { callback = null; }
        if (safeHtml === void 0) { safeHtml = true; }
        /** @type {?} */
        var errorDlg = this.show('error', message, {
            safeHtml: safeHtml,
            initialState: {
                okText: this.okText,
                okHandle: (/**
                 * @return {?}
                 */
                function () {
                    errorDlg.close();
                    if (callback) {
                        callback();
                    }
                })
            },
            fitContent: fitContent
        }, msg);
        return errorDlg;
    };
    /**
     * @param {?} message
     * @param {?=} msg
     * @param {?=} fitContent
     * @param {?=} callback
     * @return {?}
     */
    MessagerService.prototype.warning = /**
     * @param {?} message
     * @param {?=} msg
     * @param {?=} fitContent
     * @param {?=} callback
     * @return {?}
     */
    function (message, msg, fitContent, callback) {
        if (fitContent === void 0) { fitContent = true; }
        if (callback === void 0) { callback = null; }
        /** @type {?} */
        var warningDlg = this.show('warning', message, {
            initialState: {
                okText: this.okText,
                okHandle: (/**
                 * @return {?}
                 */
                function () {
                    warningDlg.close();
                    if (callback) {
                        callback();
                    }
                })
            },
            fitContent: fitContent
        }, msg);
        return warningDlg;
    };
    /**
     * @param {?} type
     * @param {?} title
     * @param {?=} message
     * @param {?=} callback
     * @return {?}
     */
    MessagerService.prototype.showHtmlMsg = /**
     * @param {?} type
     * @param {?} title
     * @param {?=} message
     * @param {?=} callback
     * @return {?}
     */
    function (type, title, message, callback) {
        if (callback === void 0) { callback = null; }
        /** @type {?} */
        var msgDlg = this.show(type, title, {
            safeHtml: false,
            initialState: {
                okText: this.okText,
                okHandle: (/**
                 * @return {?}
                 */
                function () {
                    msgDlg.close();
                    if (callback) {
                        callback();
                    }
                })
            },
            fitContent: true
        }, message);
        return msgDlg;
    };
    /**
     * @private
     * @return {?}
     */
    MessagerService.prototype.close = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.modals.length) {
            /** @type {?} */
            var msgbox = this.getModalById(this.currentId);
            if (msgbox) {
                msgbox.ref.close();
            }
        }
    };
    /**
     * @private
     * @param {?} id
     * @return {?}
     */
    MessagerService.prototype.getModalById = /**
     * @private
     * @param {?} id
     * @return {?}
     */
    function (id) {
        return this.modals.find((/**
         * @param {?} item
         * @return {?}
         */
        function (item) { return item.id === id; }));
    };
    /**
     * @private
     * @return {?}
     */
    MessagerService.prototype.getModalCmp = /**
     * @private
     * @return {?}
     */
    function () {
        return this.bsModalService.getCurrentModalContainer().instance;
    };
    /**
     * @private
     * @param {?} id
     * @return {?}
     */
    MessagerService.prototype.removeMessager = /**
     * @private
     * @param {?} id
     * @return {?}
     */
    function (id) {
        this.modals = this.modals.filter((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n.id !== id; }));
        if (!this.modals.length) {
            this.currentId = -1;
        }
        else {
            this.currentId = this.modals[this.modals.length - 1].id;
        }
    };
    MessagerService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    MessagerService.ctorParameters = function () { return [
        { type: BsModalService },
        { type: Injector }
    ]; };
    return MessagerService;
}());
export { MessagerService };
if (false) {
    /** @type {?} */
    MessagerService.prototype.version;
    /** @type {?} */
    MessagerService.prototype.currentId;
    /** @type {?} */
    MessagerService.prototype.modals;
    /**
     * @type {?}
     * @private
     */
    MessagerService.prototype.defaultMessagerConfig;
    /**
     * @type {?}
     * @private
     */
    MessagerService.prototype.confirmSubject;
    /**
     * @type {?}
     * @private
     */
    MessagerService.prototype.ngZone;
    /**
     * @type {?}
     * @private
     */
    MessagerService.prototype.localeService;
    /**
     * @type {?}
     * @private
     */
    MessagerService.prototype.bsModalService;
    /**
     * @type {?}
     * @private
     */
    MessagerService.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWVzc2FnZXIuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktbWVzc2FnZXIvIiwic291cmNlcyI6WyJsaWIvbWVzc2FnZXIuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFVQSxPQUFPLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDN0QsT0FBTyxFQUFFLE9BQU8sRUFBYyxFQUFFLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDL0MsT0FBTyxFQUFFLGNBQWMsRUFBNEIsTUFBTSxrQkFBa0IsQ0FBQztBQUM1RSxPQUFPLEVBQWtCLHFCQUFxQixFQUFFLHVCQUF1QixFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDbkcsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDekQsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBSWxEO0lBWUkseUJBQW9CLGNBQThCLEVBQVUsUUFBa0I7UUFBMUQsbUJBQWMsR0FBZCxjQUFjLENBQWdCO1FBQVUsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQVY5RSxZQUFPLEdBQUcsUUFBUSxDQUFDO1FBQ25CLGNBQVMsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUNmLFdBQU0sR0FBc0MsRUFBRSxDQUFDO1FBQ3ZDLDBCQUFxQixHQUFtQixJQUFJLENBQUM7O1lBUTNDLE1BQU0sR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyx1QkFBdUIsQ0FBQyxJQUFJLHFCQUFxQjtRQUNsRixJQUFJLENBQUMscUJBQXFCLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUscUJBQXFCLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFDOUUsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUN4QyxJQUFJLENBQUMs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LENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTTs7OztRQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLEVBQUUsS0FBSyxFQUFFLEVBQVgsQ0FBVyxFQUFDLENBQUM7UUFDbkQsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFO1lBQ3JCLElBQUksQ0FBQyxTQUFTLEdBQUcsQ0FBQyxDQUFDLENBQUM7U0FDdkI7YUFBTTtZQUNILElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7U0FDM0Q7SUFDTCxDQUFDOztnQkF6ZUosVUFBVTs7OztnQkFQRixjQUFjO2dCQUZGLFFBQVE7O0lBbWY3QixzQkFBQztDQUFBLEFBMWVELElBMGVDO1NBemVZLGVBQWU7OztJQUN4QixrQ0FBbUI7O0lBQ25CLG9DQUFlOztJQUNmLGlDQUErQzs7Ozs7SUFDL0MsZ0RBQXFEOzs7OztJQUVyRCx5Q0FBdUI7Ozs7O0lBQ3ZCLGlDQUF1Qjs7Ozs7SUFFdkIsd0NBQXFDOzs7OztJQUV6Qix5Q0FBc0M7Ozs7O0lBQUUsbUNBQTBCIiwic291cmNlc0NvbnRlbnQiOlsiXHJcbi8qXHJcbiAqIEBBdXRob3I6IOeWr+eLguengOaJjShMdWNhcyBIdWFuZylcclxuICogQExhc3RFZGl0b3JzOiDnlq/ni4Lnp4DmiY0oTHVjYXMgSHVhbmcpXHJcbiAqIEBDb21wYW55OiBJbnNwdXJcclxuICogQFZlcnNpb246IHYwLjAuMTVcclxuICogQERhdGU6IDIwMTktMDQtMDIgMTE6NDg6MDhcclxuICogQExhc3RFZGl0VGltZTogMjAxOS0xMC0yNiAxNjozODozNFxyXG4gKi9cclxuXHJcbmltcG9ydCB7IEluamVjdGFibGUsIEluamVjdG9yLCBOZ1pvbmUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgU3ViamVjdCwgT2JzZXJ2YWJsZSwgb2YgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgQnNNb2RhbFNlcnZpY2UsIEJzTW9kYWxSZWYsIERpYWxvZ0J1dHRvbiB9IGZyb20gJ0BmYXJyaXMvdWktbW9kYWwnO1xyXG5pbXBvcnQgeyBNZXNzYWdlckNvbmZpZywgTWVzc2FnZXJEZWZhdWx0Q29uZmlnLCBNRVNTQUdFUl9ERUZBVUxUX0NPTkZJRyB9IGZyb20gJy4vbWVzc2FnZXIuY29uZmlnJztcclxuaW1wb3J0IHsgTWVzc2FnZXJDb21wb25lbnQgfSBmcm9tICcuL21lc3NhZ2VyLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IExvY2FsZVNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWxvY2FsZSc7XHJcbmltcG9ydCB7IHVuZXNjYXBlSWRlbnRpZmllciB9IGZyb20gJ0Bhbmd1bGFyL2NvbXBpbGVyJztcclxuXHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBNZXNzYWdlclNlcnZpY2Uge1xyXG4gICAgdmVyc2lvbiA9ICcwLjAuMTUnO1xyXG4gICAgY3VycmVudElkID0gLTE7XHJcbiAgICBtb2RhbHM6IHsgaWQ6IG51bWJlcjsgcmVmOiBCc01vZGFsUmVmIH1bXSA9IFtdO1xyXG4gICAgcHJpdmF0ZSBkZWZhdWx0TWVzc2FnZXJDb25maWc6IE1lc3NhZ2VyQ29uZmlnID0gbnVsbDtcclxuXHJcbiAgICBwcml2YXRlIGNvbmZpcm1TdWJqZWN0O1xyXG4gICAgcHJpdmF0ZSBuZ1pvbmU6IE5nWm9uZTtcclxuXHJcbiAgICBwcml2YXRlIGxvY2FsZVNlcnZpY2U6IExvY2FsZVNlcnZpY2U7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBic01vZGFsU2VydmljZTogQnNNb2RhbFNlcnZpY2UsIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yKSB7XHJcbiAgICAgICAgY29uc3QgY29uZmlnID0gdGhpcy5pbmplY3Rvci5nZXQoTUVTU0FHRVJfREVGQVVMVF9DT05GSUcpIHx8IE1lc3NhZ2VyRGVmYXVsdENvbmZpZztcclxuICAgICAgICB0aGlzLmRlZmF1bHRNZXNzYWdlckNvbmZpZyA9IE9iamVjdC5hc3NpZ24oe30sIE1lc3NhZ2VyRGVmYXVsdENvbmZpZywgY29uZmlnKTtcclxuICAgICAgICB0aGlzLm5nWm9uZSA9IHRoaXMuaW5qZWN0b3IuZ2V0KE5nWm9uZSk7XHJcbiAgICAgICAgdGhpcy5sb2NhbGVTZXJ2aWNlID0gdGhpcy5pbmplY3Rvci5nZXQoTG9jYWxlU2VydmljZSk7XHJcbiAgICB9XHJcbiAgICBnZXQgb2tUZXh0KCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmxvY2FsZVNlcnZpY2UuZ2V0VmFsdWUoJ21lc3NhZ2VyLm9rJyk7XHJcbiAgICB9XHJcbiAgICBnZXQgY2FuY2VsVGV4dCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKCdtZXNzYWdlci5jYW5jZWwnKTtcclxuICAgIH1cclxuICAgIGdldCB5ZXNUZXh0KCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmxvY2FsZVNlcnZpY2UuZ2V0VmFsdWUoJ21lc3NhZ2VyLnllcycpO1xyXG4gICAgfVxyXG4gICAgZ2V0IG5vVGV4dCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKCdtZXNzYWdlci5ubycpO1xyXG4gICAgfVxyXG4gICAgZ2V0IHRpdGxlVGV4dCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKCdtZXNzYWdlci50aXRsZScpO1xyXG4gICAgfVxyXG4gICAgZ2V0IGVycm9yVGl0bGUoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZSgnbWVzc2FnZXIuZXJyb3JUaXRsZScpO1xyXG4gICAgfVxyXG5cclxuICAgIGVzY2FwZUh0bWwoc3RyKSB7XHJcbiAgICAgICAgaWYgKHN0ciA9PT0gbnVsbCB8fCBzdHIgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJyc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBzdHJcclxuICAgICAgICAgICAgLnJlcGxhY2UoLyYvZywgJyZhbXA7JylcclxuICAgICAgICAgICAgLnJlcGxhY2UoLzwvZywgJyZsdDsnKVxyXG4gICAgICAgICAgICAucmVwbGFjZSgvPi9nLCAnJmd0OycpXHJcbiAgICAgICAgICAgIC5yZXBsYWNlKC9cXFwiL2csICcmcXVvdDsnKVxyXG4gICAgICAgICAgICAucmVwbGFjZSgvXFwnL2csICcmIzM5OycpXHJcbiAgICAgICAgICAgIC5yZXBsYWNlKC9cXC8vZywgJyYjeDJGOycpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5pi+56S65L+h5oGv5o+Q56S65qGGXHJcbiAgICAgKiBAcGFyYW0gbXNndHlwZSDmtojmga/nsbvliKtcclxuICAgICAqIEBwYXJhbSBtZXNzYWdlIOaPkOekuua2iOaBr+S4gFxyXG4gICAgICogQHBhcmFtIG9wdHMg5Y+C5pWwIOaPkOS+m+WxnuaApyBmaXRDb250ZW50OnRydWXmlK/mjIHoh6rliqjpgILlupTlrr3luqZcclxuICAgICAqIEBwYXJhbSBzdWJtc2cg5o+Q56S65raI5oGv5LqM57qnXHJcbiAgICAgKi9cclxuICAgIHNob3cobXNndHlwZTogc3RyaW5nLCBtZXNzYWdlOiBzdHJpbmcsIG9wdHM/OiB7fSwgc3VibXNnID0gJycpIHtcclxuICAgICAgICBpZiAoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCkge1xyXG4gICAgICAgICAgICAoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCBhcyBhbnkpLmJsdXIoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgbW9kYWxIZWlnaHQgPSAxODA7XHJcbiAgICAgICAgbGV0IGRlZmF1bHRPcHRzID0ge1xyXG4gICAgICAgICAgICBzYWZlSHRtbDogdHJ1ZSxcclxuICAgICAgICAgICAgdGl0bGU6IHRoaXMudGl0bGVUZXh0LFxyXG4gICAgICAgICAgICB3aWR0aDogMzkwLFxyXG4gICAgICAgICAgICBoZWlnaHQ6IG1vZGFsSGVpZ2h0LFxyXG4gICAgICAgICAgICBzaG93QnV0dG9uczogZmFsc2UsXHJcbiAgICAgICAgICAgIHNob3dNYXhCdXR0b246IGZhbHNlLFxyXG4gICAgICAgICAgICByZXNpemFibGU6IGZhbHNlLFxyXG4gICAgICAgICAgICBpbml0aWFsU3RhdGU6IHtcclxuICAgICAgICAgICAgICAgIG9rVGV4dDogdGhpcy5va1RleHQsXHJcbiAgICAgICAgICAgICAgICBva0hhbmRsZTogKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgY2xhc3M6ICdtb2RhbC1tZXNzYWdlICcgKyAobXNndHlwZSA/ICdtb2RhbC1tZXNzYWdlLXR5cGUtJyArIG1zZ3R5cGUgOiAnJyksXHJcbiAgICAgICAgICAgIHNob3dIZWFkZXI6IGZhbHNlLFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgZGVmYXVsdE9wdHMgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLmRlZmF1bHRNZXNzYWdlckNvbmZpZywgZGVmYXVsdE9wdHMpO1xyXG4gICAgICAgIGxldCBleHRlbmRPcHRzID0ge307XHJcblxyXG4gICAgICAgIHN3aXRjaCAobXNndHlwZSkge1xyXG4gICAgICAgICAgICBjYXNlICdwcm9tcHQnOlxyXG4gICAgICAgICAgICAgICAgLy8g5by55Ye65a+56K+d57G75Z6LXHJcbiAgICAgICAgICAgICAgICBleHRlbmRPcHRzID0geyBzaG93SGVhZGVyOiB0cnVlLCBtb2RhbEhlaWdodDogMjYwIH07XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnZXJyb3InOlxyXG4gICAgICAgICAgICAgICAgLy8g6ZSZ6K+vXHJcbiAgICAgICAgICAgICAgICBleHRlbmRPcHRzID0geyB0aXRsZTogdGhpcy5lcnJvclRpdGxlLCB3aWR0aDogNDQ2LCBzaG93SGVhZGVyOiB0cnVlLCBzaG93TWF4QnV0dG9uOiB0cnVlLCBmaXRDb250ZW50OiB0cnVlIH07XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnZXhjZXB0aW9uJzpcclxuICAgICAgICAgICAgICAgIGV4dGVuZE9wdHMgPSB7IHNhZmVIdG1sOiBmYWxzZSwgdGl0bGU6IHRoaXMuZXJyb3JUaXRsZSwgd2lkdGg6IDQ0Niwgc2hvd0hlYWRlcjogdHJ1ZSwgZml0Q29udGVudDogdHJ1ZSB9O1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAvLyDpu5jorqTlhbbku5ZcclxuICAgICAgICAgICAgICAgIGV4dGVuZE9wdHMgPSB7IHdpZHRoOiBzdWJtc2cgPyA0NDYgOiAzOTAsIGZpdENvbnRlbnQ6IHRydWUgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgT2JqZWN0LmFzc2lnbihkZWZhdWx0T3B0cywgZXh0ZW5kT3B0cyk7XHJcbiAgICAgICAgaWYgKG9wdHMpIHtcclxuICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihkZWZhdWx0T3B0cywgb3B0cyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAobWVzc2FnZSAmJiBkZWZhdWx0T3B0cy5zYWZlSHRtbCkge1xyXG4gICAgICAgICAgICBtZXNzYWdlID0gdGhpcy5lc2NhcGVIdG1sKG1lc3NhZ2UpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgT2JqZWN0LmFzc2lnbihkZWZhdWx0T3B0cy5pbml0aWFsU3RhdGUsIHtcclxuICAgICAgICAgICAgdHlwZTogbXNndHlwZSxcclxuICAgICAgICAgICAgbWVzc2FnZSxcclxuICAgICAgICAgICAgbXNnOiBzdWJtc2csXHJcbiAgICAgICAgICAgIGV4Y2VwdGlvbjogb3B0cyAmJiBvcHRzWydleGNlcHRpb24nXSA/IG9wdHNbJ2V4Y2VwdGlvbiddIDogbnVsbCxcclxuICAgICAgICAgICAgc2hvd0xpbmVzOiBvcHRzICYmIG9wdHNbJ3Nob3dMaW5lcyddID8gb3B0c1snc2hvd0xpbmVzJ10gOiAzLFxyXG4gICAgICAgICAgICByZWFkb25seTogb3B0cyAmJiBvcHRzWydyZWFkb25seSddID8gb3B0c1sncmVhZG9ubHknXSA6IGZhbHNlXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGlmIChkZWZhdWx0T3B0c1snYnV0dG9ucyddICYmIGRlZmF1bHRPcHRzWydidXR0b25zJ10ubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGlmICghZGVmYXVsdE9wdHMuaW5pdGlhbFN0YXRlWydidXR0b25zJ10gfHwgIWRlZmF1bHRPcHRzLmluaXRpYWxTdGF0ZVsnYnV0dG9ucyddLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgZGVmYXVsdE9wdHMuaW5pdGlhbFN0YXRlWydidXR0b25zJ10gPSBkZWZhdWx0T3B0c1snYnV0dG9ucyddO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IF9tb2RhbCA9IHRoaXMuYnNNb2RhbFNlcnZpY2Uuc2hvdyhNZXNzYWdlckNvbXBvbmVudCwgZGVmYXVsdE9wdHMpO1xyXG4gICAgICAgIC8vIF9tb2RhbC5jb250ZW50LmJ1dHRvbnMgPSBkZWZhdWx0T3B0c1snYnV0dG9ucyddIHx8IFtdO1xyXG4gICAgICAgIHRoaXMuY29uZmlybVN1YmplY3QgPSBuZXcgU3ViamVjdDxib29sZWFuPigpO1xyXG4gICAgICAgIGlmICh0aGlzLm1vZGFscy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vZGFsQ29udGFpbmVyQ29tcG9uZW50ID0gX21vZGFsLmRpYWxvZztcclxuICAgICAgICAgICAgbW9kYWxDb250YWluZXJDb21wb25lbnQuaW5zdGFuY2UuaXNTaG93biA9IHRydWU7XHJcbiAgICAgICAgICAgIG1vZGFsQ29udGFpbmVyQ29tcG9uZW50Lmluc3RhbmNlLm1vdmVUbyhcclxuICAgICAgICAgICAgICAgIDE1ICogdGhpcy5tb2RhbHMubGVuZ3RoLFxyXG4gICAgICAgICAgICAgICAgMTUgKiB0aGlzLm1vZGFscy5sZW5ndGhcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcclxuICAgICAgICAgICAgLy8g56ysMeS4quaMiemSruiOt+WPlueEpueCuVxyXG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGJ0bk9rID0gX21vZGFsLmNvbnRlbnQuYnRuT2tFbCA/IF9tb2RhbC5jb250ZW50LmJ0bk9rRWwubmF0aXZlRWxlbWVudCA6IG51bGw7XHJcbiAgICAgICAgICAgICAgICBpZiAoYnRuT2spIHtcclxuICAgICAgICAgICAgICAgICAgICBidG5Pa1snZm9jdXMnXSgpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBidG5zID0gX21vZGFsLmRpYWxvZy5sb2NhdGlvbi5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5tb2RhbC1mb290ZXIgYnV0dG9uJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGJ0bnMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJ0bnMuaXRlbSgwKVsnZm9jdXMnXSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMubXNnTWdyKF9tb2RhbCk7XHJcbiAgICAgICAgcmV0dXJuIF9tb2RhbDtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIG1zZ01ncihyZWY6IEJzTW9kYWxSZWYpIHtcclxuICAgICAgICBjb25zdCBpZCA9IHRoaXMuYnNNb2RhbFNlcnZpY2UuZ2V0TW9kYWxzQ291bnQoKSArIDEwMDA7XHJcbiAgICAgICAgaWYgKHRoaXMubW9kYWxzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICB0aGlzLm1vZGFscy5wdXNoKHsgaWQsIHJlZiB9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuZ2V0TW9kYWxCeUlkKGlkKSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5tb2RhbHMucHVzaCh7IGlkLCByZWYgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmdldE1vZGFsQnlJZChpZCkucmVmID0gcmVmO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBjbXAgPSB0aGlzLmdldE1vZGFsQ21wKCk7XHJcblxyXG4gICAgICAgIGNtcC5jbG9zZWQuc3Vic2NyaWJlKChsZXZlbDogbnVtYmVyKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlTWVzc2FnZXIoaWQpO1xyXG4gICAgICAgICAgICB0aGlzLmNvbmZpcm1TdWJqZWN0LnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMuY3VycmVudElkID0gaWQ7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHF1ZXN0aW9uKG1lc3NhZ2U6IHN0cmluZywgb2tDYWxsYmFjazogKCkgPT4gdm9pZCwgY2FuY2VsQ2FsbGJhY2s/OiAoKSA9PiB2b2lkLCBtc2c/OiBzdHJpbmcsIGZpdENvbnRlbnQgPSB0cnVlKSB7XHJcbiAgICAgICAgY29uc3QgcXVlc3Rpb25EbGcgPSB0aGlzLnNob3coJ3F1ZXN0aW9uJywgbWVzc2FnZSwge1xyXG4gICAgICAgICAgICBpbml0aWFsU3RhdGU6IHtcclxuICAgICAgICAgICAgICAgIG9rVGV4dDogdGhpcy55ZXNUZXh0LFxyXG4gICAgICAgICAgICAgICAgb2tIYW5kbGU6ICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBxdWVzdGlvbkRsZy5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChva0NhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9rQ2FsbGJhY2soKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgY2FuY2VsVGV4dDogdGhpcy5ub1RleHQsXHJcbiAgICAgICAgICAgICAgICBjYW5jZWxIYW5kbGU6ICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBxdWVzdGlvbkRsZy5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjYW5jZWxDYWxsYmFjaykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYW5jZWxDYWxsYmFjaygpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgZml0Q29udGVudFxyXG4gICAgICAgIH0sIG1zZyk7XHJcbiAgICAgICAgcmV0dXJuIHF1ZXN0aW9uRGxnO1xyXG4gICAgfVxyXG5cclxuICAgIHF1ZXN0aW9uMihtZXNzYWdlcjogc3RyaW5nLCBidG5zOiBEaWFsb2dCdXR0b25bXSwgbXNnPzogc3RyaW5nLCBmaXRDb250ZW50ID0gdHJ1ZSkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnNob3coJ3F1ZXN0aW9uJywgbWVzc2FnZXIsIHtcclxuICAgICAgICAgICAgaW5pdGlhbFN0YXRlOiB7XHJcbiAgICAgICAgICAgICAgICBidXR0b25zOiBidG5zXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGZpdENvbnRlbnRcclxuICAgICAgICB9LCBtc2cpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiAyMDIw5bm0M+aciDfml6Xlm6DkuLp0ZXh0YXJlYemrmOW6puWcqOS4jeWQjOa1j+iniOWZqOS4i+S4jeS4gOagt++8jOWbuuWumumrmOW6puWPr+iDveS8muWHuueOsOa7muWKqOadoVxyXG4gICAgICogQHBhcmFtIHRpdGxlIOagh+mimFxyXG4gICAgICogQHBhcmFtIG1zZyDkv6Hmga9cclxuICAgICAqIEBwYXJhbSBmaXRDb250ZW50IOiHqumAguW6lOWGheWuuVxyXG4gICAgICovXHJcbiAgICBwcm9tcHQodGl0bGU6IHN0cmluZywgbXNnPzogc3RyaW5nLCBmaXRDb250ZW50ID0gdHJ1ZSkge1xyXG4gICAgICAgIGNvbnN0IHByb21wdFN1YmplY3QgPSBuZXcgU3ViamVjdCgpO1xyXG4gICAgICAgIGNvbnN0IGRsZyA9IHRoaXMuc2hvdygncHJvbXB0JywgbXNnLCB7XHJcbiAgICAgICAgICAgIHRpdGxlLFxyXG4gICAgICAgICAgICBpbml0aWFsU3RhdGU6IHtcclxuICAgICAgICAgICAgICAgIG9rVGV4dDogdGhpcy5va1RleHQsXHJcbiAgICAgICAgICAgICAgICBva0hhbmRsZTogKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG1jID0gZGxnLmNvbnRlbnQgYXMgTWVzc2FnZXJDb21wb25lbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgZGxnLmNsb3NlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcHJvbXB0U3ViamVjdC5uZXh0KG1jLnByb21wdFRleHQubmF0aXZlRWxlbWVudC52YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgY2FuY2VsVGV4dDogdGhpcy5jYW5jZWxUZXh0LFxyXG4gICAgICAgICAgICAgICAgY2FuY2VsSGFuZGxlOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGxnLmNsb3NlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcHJvbXB0U3ViamVjdC5uZXh0KGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgZml0Q29udGVudCxcclxuICAgICAgICAgICAgY2xvc2VkOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBwcm9tcHRTdWJqZWN0LnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LCBtc2cpO1xyXG5cclxuICAgICAgICByZXR1cm4gcHJvbXB0U3ViamVjdDtcclxuICAgIH1cclxuXHJcbiAgICBwcm9tcHQyKHRpdGxlOiBzdHJpbmcsIG1zZz86IHN0cmluZywgb3B0cz86IGFueSkge1xyXG4gICAgICAgIGNvbnN0IHByb21wdFN1YmplY3QgPSBuZXcgU3ViamVjdCgpO1xyXG5cclxuICAgICAgICBjb25zdCBfb3B0cyA9IHtcclxuICAgICAgICAgICAgc2hvd09rQnV0dG9uOiB0cnVlLFxyXG4gICAgICAgICAgICBzaG93Q2xvc2VCdXR0b246IHRydWUsXHJcbiAgICAgICAgICAgIHNob3dGb250U2l6ZTogZmFsc2UsXHJcbiAgICAgICAgICAgIGZvbnRTaXplOiAxOCxcclxuICAgICAgICAgICAgcmVhZG9ubHk6IGZhbHNlLFxyXG4gICAgICAgICAgICBzYXZlU2l6ZTogZmFsc2UsXHJcbiAgICAgICAgICAgIGNsb3NlV2hlbmV2ZXI6IHRydWVcclxuICAgICAgICB9O1xyXG4gICAgICAgIGlmICghb3B0cykge1xyXG4gICAgICAgICAgICBvcHRzID0gX29wdHM7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgb3B0cyA9IE9iamVjdC5hc3NpZ24oX29wdHMsIG9wdHMpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgX2RpYWxvZ09wdHMgPSB7XHJcbiAgICAgICAgICAgIHRpdGxlLFxyXG4gICAgICAgICAgICBpbml0aWFsU3RhdGU6IHtcclxuICAgICAgICAgICAgICAgIHNob3dPa0J1dHRvbjogb3B0cy5zaG93T2tCdXR0b24gPT09IHVuZGVmaW5lZCA/IHRydWUgOiBvcHRzLnNob3dPa0J1dHRvbixcclxuICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IG9wdHMuc2hvd0NhbmNlbEJ1dHRvbiA9PT0gdW5kZWZpbmVkID8gdHJ1ZSA6IG9wdHMuc2hvd0NhbmNlbEJ1dHRvbixcclxuICAgICAgICAgICAgICAgIG9rVGV4dDogdGhpcy5va1RleHQsXHJcbiAgICAgICAgICAgICAgICBva0hhbmRsZTogKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG1jID0gZGxnLmNvbnRlbnQgYXMgTWVzc2FnZXJDb21wb25lbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsID0gbWMucHJvbXB0VGV4dC5uYXRpdmVFbGVtZW50LnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvcHRzLmNsb3NlV2hlbmV2ZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGxnLmNsb3NlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb21wdFN1YmplY3QubmV4dCh2YWwpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb21wdFN1YmplY3QubmV4dCh7dmFsLCBkbGcgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGNhbmNlbFRleHQ6IHRoaXMuY2FuY2VsVGV4dCxcclxuICAgICAgICAgICAgICAgIGNhbmNlbEhhbmRsZTogKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGRsZy5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHByb21wdFN1YmplY3QubmV4dChmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgc2hvd0ZvbnRTaXplOiBvcHRzLnNob3dGb250U2l6ZSxcclxuICAgICAgICAgICAgICAgIGZvbnRTaXplOiBvcHRzLmZvbnRTaXplIHx8IDE4LFxyXG4gICAgICAgICAgICAgICAgZW5hYmxlV29yZENvdW50OiAhIW9wdHMuZW5hYmxlV29yZENvdW50LFxyXG4gICAgICAgICAgICAgICAgY291bnRUeXBlOiBvcHRzLmNvdW50VHlwZSB8fCAnbGVuZ3RoJyxcclxuICAgICAgICAgICAgICAgIG1heExlbmd0aDogb3B0cy5tYXhMZW5ndGgsXHJcbiAgICAgICAgICAgICAgICBpbnB1dFR5cGU6IG9wdHMuaW5wdXRUeXBlIHx8ICd0ZXh0YXJlYScsXHJcbiAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcjogb3B0cy5wbGFjZWhvbGRlciB8fCAnJ1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBmaXRDb250ZW50OiBmYWxzZSxcclxuICAgICAgICAgICAgc2hvd01heEJ1dHRvbjogdHJ1ZSxcclxuICAgICAgICAgICAgcmVzaXphYmxlOiB0cnVlLFxyXG4gICAgICAgICAgICBjbGFzczogJycsXHJcbiAgICAgICAgICAgIGNsb3NlZDogKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcHJvbXB0U3ViamVjdC51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBvcGVuZWQ6ICgpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChvcHRzLmlucHV0VHlwZSAhPT0gJ3RleHRhcmVhJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRleHRhcmVhRWxlID0gZGxnLmNvbnRlbnQucHJvbXB0VGV4dC5uYXRpdmVFbGVtZW50O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0YXJlYUVsZS5jbG9zZXN0KCdzZWN0aW9uJykuc3R5bGUucGFkZGluZyA9ICcxNXB4JztcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dGFyZWFFbGUuc3R5bGUucmVzaXplID0gJ25vbmUnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0YXJlYUVsZS5zdHlsZS5oZWlnaHQgPSAnMTAwJSc7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob3B0cy5yZWFkb25seSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dGFyZWFFbGUucmVhZE9ubHkgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGJlZm9yZUNsb3NlOiAobW9kYWxSZWY6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKG9wdHMuc2F2ZVNpemUgJiYgIWRsZy5kaWFsb2cuaW5zdGFuY2UuaXNNYXgpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0geyBmb250U2l6ZTogZGxnLmNvbnRlbnQuZm9udFNpemUsIHdpZHRoOiBtb2RhbFJlZi5jb25maWcud2lkdGgsIGhlaWdodDogbW9kYWxSZWYuY29uZmlnLmhlaWdodCB9O1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2F2ZVRleHRBcmVhU2l6ZUluZm8oZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gb2YodHJ1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIGxldCBkaWFsb2dPcHRzID0gX2RpYWxvZ09wdHM7XHJcbiAgICAgICAgaWYgKG9wdHMpIHtcclxuICAgICAgICAgICAgZGlhbG9nT3B0cyA9IE9iamVjdC5hc3NpZ24oZGlhbG9nT3B0cywgb3B0cyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBkbGcgPSB0aGlzLnNob3coJ3Byb21wdCcsIG1zZywgZGlhbG9nT3B0cywgbXNnKTtcclxuXHJcbiAgICAgICAgaWYgKG9wdHMuaW5wdXRUeXBlICYmICBkbGcuY29udGVudC5wcm9tcHRUZXh0KSB7XHJcbiAgICAgICAgICAgIGRsZy5jb250ZW50LnByb21wdFRleHQubmF0aXZlRWxlbWVudC5mb2N1cygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHByb21wdFN1YmplY3Q7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0S2V5U3RyaW5nKCkge1xyXG4gICAgICAgIC8vIOS4gOWPsOe7iOerr+WFseeUqOS4gOS4qumFjee9rlxyXG4gICAgICAgIC8vIOS/neeVmeacgOWQjuS4gOasoeeahOiuvue9ru+8jFxyXG4gICAgICAgIC8vIOS/neWtmOeql+WPo+Wkp+Wwj++8jOWtl+S9k+Wkp+Wwj1xyXG4gICAgICAgIHJldHVybiAnSUdJWC1GQVJSSVMtVUktVEVYVEFSRUEtWk9PTS1TRVRUSU5HUyc7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzYXZlVGV4dEFyZWFTaXplSW5mbyhkYXRhKSB7XHJcbiAgICAgICAgaWYgKHdpbmRvdy5sb2NhbFN0b3JhZ2UpIHtcclxuICAgICAgICAgICAgY29uc3Qga2V5ID0gdGhpcy5nZXRLZXlTdHJpbmcoKTtcclxuICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oa2V5LCBKU09OLnN0cmluZ2lmeShkYXRhKSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbmZpcm0obWVzc2FnZTogc3RyaW5nLCBtc2c/OiBzdHJpbmcsIGZpdENvbnRlbnQgPSB0cnVlKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgICAgICBjb25zdCBjb25maXJtU3ViamVjdCA9IG5ldyBTdWJqZWN0KCk7XHJcbiAgICAgICAgY29uc3QgY29uZmlybURsZyA9IHRoaXMuc2hvdygncXVlc3Rpb24nLCBtZXNzYWdlLCB7XHJcbiAgICAgICAgICAgIGluaXRpYWxTdGF0ZToge1xyXG4gICAgICAgICAgICAgICAgb2tUZXh0OiB0aGlzLm9rVGV4dCxcclxuICAgICAgICAgICAgICAgIG9rSGFuZGxlOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uZmlybURsZy5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpcm1TdWJqZWN0Lm5leHQodHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgY2FuY2VsVGV4dDogdGhpcy5jYW5jZWxUZXh0LFxyXG4gICAgICAgICAgICAgICAgY2FuY2VsSGFuZGxlOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uZmlybURsZy5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpcm1TdWJqZWN0Lm5leHQoZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBmaXRDb250ZW50LFxyXG4gICAgICAgICAgICBjbG9zZWQ6ICgpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbmZpcm1TdWJqZWN0LnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LCBtc2cpO1xyXG5cclxuICAgICAgICByZXR1cm4gY29uZmlybVN1YmplY3QuYXNPYnNlcnZhYmxlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgaW5mbyhtZXNzYWdlOiBzdHJpbmcsIGNhbGxiYWNrPzogKCkgPT4gdm9pZCwgbXNnPzogc3RyaW5nLCBmaXRDb250ZW50ID0gdHJ1ZSkge1xyXG4gICAgICAgIGNvbnN0IGluZm9EbGcgPSB0aGlzLnNob3coJ2luZm8nLCBtZXNzYWdlLCB7XHJcbiAgICAgICAgICAgIGluaXRpYWxTdGF0ZToge1xyXG4gICAgICAgICAgICAgICAgb2tUZXh0OiB0aGlzLm9rVGV4dCxcclxuICAgICAgICAgICAgICAgIG9rSGFuZGxlOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5mb0RsZy5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgZml0Q29udGVudFxyXG4gICAgICAgIH0sIG1zZyk7XHJcbiAgICAgICAgcmV0dXJuIGluZm9EbGc7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIC8qKiDmk43kvZzmiJDlip/mj5DnpLrvvIxcclxuICAgICAqIG1lc3NhZ2U6IOaPkOekuuS/oeaBr1xyXG4gICAgICogbXNnOiAy57qn5L+h5oGvXHJcbiAgICAgKiBmaXRDb3VudGVudDog6buY6K6k5Li6dHJ1ZVxyXG4gICAgICogY2FsbGJhY2s6IOehruWumuS6i+S7tuWbnuiwg1xyXG4gICAgICovXHJcbiAgICBzdWNjZXNzKG1lc3NhZ2U6IHN0cmluZywgbXNnPzogc3RyaW5nLCBmaXRDb250ZW50ID0gdHJ1ZSwgY2FsbGJhY2s6ICgpID0+IHZvaWQgPSBudWxsKSB7XHJcbiAgICAgICAgY29uc3Qgc3VjY2Vzc0RsZyA9IHRoaXMuc2hvdygnc3VjY2VzcycsIG1lc3NhZ2UsIHtcclxuICAgICAgICAgICAgaW5pdGlhbFN0YXRlOiB7XHJcbiAgICAgICAgICAgICAgICBva1RleHQ6IHRoaXMub2tUZXh0LFxyXG4gICAgICAgICAgICAgICAgb2tIYW5kbGU6ICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBzdWNjZXNzRGxnLmNsb3NlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBmaXRDb250ZW50XHJcbiAgICAgICAgfSwgbXNnKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHN1Y2Nlc3NEbGc7XHJcbiAgICB9XHJcbiAgICAvKiog5o+Q56S66ZSZ6K+v5L+h5oGv77yMXHJcbiAgICAgKiBtZXNzYWdlOiDmj5DnpLrkv6Hmga9cclxuICAgICAqIG1zZzogMue6p+S/oeaBr1xyXG4gICAgICogZml0Q291bnRlbnQ6IOm7mOiupOS4unRydWVcclxuICAgICAqIGNhbGxiYWNrOiDnoa7lrprkuovku7blm57osINcclxuICAgICAqL1xyXG4gICAgZXJyb3IobWVzc2FnZTogc3RyaW5nLCBtc2c/OiBzdHJpbmcsIGZpdENvbnRlbnQgPSB0cnVlLCBjYWxsYmFjazogKCkgPT4gdm9pZCA9IG51bGwsIHNhZmVIdG1sID0gdHJ1ZSkge1xyXG4gICAgICAgIGNvbnN0IGVycm9yRGxnID0gdGhpcy5zaG93KCdlcnJvcicsIG1lc3NhZ2UsIHtcclxuICAgICAgICAgICAgc2FmZUh0bWwsXHJcbiAgICAgICAgICAgIGluaXRpYWxTdGF0ZToge1xyXG4gICAgICAgICAgICAgICAgb2tUZXh0OiB0aGlzLm9rVGV4dCxcclxuICAgICAgICAgICAgICAgIG9rSGFuZGxlOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZXJyb3JEbGcuY2xvc2UoKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGZpdENvbnRlbnRcclxuICAgICAgICB9LCBtc2cpO1xyXG5cclxuICAgICAgICByZXR1cm4gZXJyb3JEbGc7XHJcbiAgICB9XHJcblxyXG4gICAgd2FybmluZyhtZXNzYWdlOiBzdHJpbmcsIG1zZz86IHN0cmluZywgZml0Q29udGVudCA9IHRydWUsIGNhbGxiYWNrOiAoKSA9PiB2b2lkID0gbnVsbCkge1xyXG4gICAgICAgIGNvbnN0IHdhcm5pbmdEbGcgPSB0aGlzLnNob3coJ3dhcm5pbmcnLCBtZXNzYWdlLCB7XHJcbiAgICAgICAgICAgIGluaXRpYWxTdGF0ZToge1xyXG4gICAgICAgICAgICAgICAgb2tUZXh0OiB0aGlzLm9rVGV4dCxcclxuICAgICAgICAgICAgICAgIG9rSGFuZGxlOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgd2FybmluZ0RsZy5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgZml0Q29udGVudFxyXG4gICAgICAgIH0sIG1zZyk7XHJcbiAgICAgICAgcmV0dXJuIHdhcm5pbmdEbGc7XHJcbiAgICB9XHJcblxyXG4gICAgc2hvd0h0bWxNc2codHlwZTogJ3dhcm5pbmcnfCAnaW5mbyd8J2Vycm9yJ3wnc3VjY2VzcycsIHRpdGxlOiBzdHJpbmcsIG1lc3NhZ2U/OiBzdHJpbmcsIGNhbGxiYWNrOigpID0+IHZvaWQgPSBudWxsKSB7XHJcbiAgICAgICAgY29uc3QgbXNnRGxnID0gdGhpcy5zaG93KHR5cGUsIHRpdGxlLCB7XHJcbiAgICAgICAgICAgIHNhZmVIdG1sOiBmYWxzZSxcclxuICAgICAgICAgICAgaW5pdGlhbFN0YXRlOiB7XHJcbiAgICAgICAgICAgICAgICBva1RleHQ6IHRoaXMub2tUZXh0LFxyXG4gICAgICAgICAgICAgICAgb2tIYW5kbGU6ICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBtc2dEbGcuY2xvc2UoKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGZpdENvbnRlbnQ6IHRydWVcclxuICAgICAgICB9LCBtZXNzYWdlKTtcclxuICAgICAgICByZXR1cm4gbXNnRGxnO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwcml2YXRlIGNsb3NlKCkge1xyXG4gICAgICAgIGlmICh0aGlzLm1vZGFscy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgY29uc3QgbXNnYm94ID0gdGhpcy5nZXRNb2RhbEJ5SWQodGhpcy5jdXJyZW50SWQpO1xyXG4gICAgICAgICAgICBpZiAobXNnYm94KSB7XHJcbiAgICAgICAgICAgICAgICBtc2dib3gucmVmLmNsb3NlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRNb2RhbEJ5SWQoaWQ6IG51bWJlcikge1xyXG4gICAgICAgIHJldHVybiB0aGlzLm1vZGFscy5maW5kKGl0ZW0gPT4gaXRlbS5pZCA9PT0gaWQpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0TW9kYWxDbXAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuYnNNb2RhbFNlcnZpY2UuZ2V0Q3VycmVudE1vZGFsQ29udGFpbmVyKCkuaW5zdGFuY2U7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSByZW1vdmVNZXNzYWdlcihpZCkge1xyXG4gICAgICAgIHRoaXMubW9kYWxzID0gdGhpcy5tb2RhbHMuZmlsdGVyKG4gPT4gbi5pZCAhPT0gaWQpO1xyXG4gICAgICAgIGlmICghdGhpcy5tb2RhbHMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY3VycmVudElkID0gLTE7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5jdXJyZW50SWQgPSB0aGlzLm1vZGFsc1t0aGlzLm1vZGFscy5sZW5ndGggLSAxXS5pZDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIl19