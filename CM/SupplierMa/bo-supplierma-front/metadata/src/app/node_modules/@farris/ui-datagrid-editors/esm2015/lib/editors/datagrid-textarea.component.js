/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*
 * @Author: 疯狂秀才(Lucas Huang)
 * @Date: 2019-08-14 11:44:30
 * @LastEditors: 疯狂秀才(Lucas Huang)
 * @LastEditTime: 2019-10-14 13:15:49
 * @QQ: 1055818239
 * @Version: v0.0.1
 */
import { Component, ElementRef, ViewChild, Renderer2, NgZone, Injector } from '@angular/core';
import { MessagerService } from '@farris/ui-messager';
import { EventManager } from '@angular/platform-browser';
import { BsModalService } from '@farris/ui-modal';
import { TextareaWordcountDirective } from '@farris/ui-forms';
import { DatagridBaseEditorDirective } from '../datagrid-base-editor.directive';
export class DatagridTextareaComponent extends DatagridBaseEditorDirective {
    /**
     * @param {?} render
     * @param {?} el
     * @param {?} ngzone
     * @param {?} injector
     */
    constructor(render, el, ngzone, injector) {
        super(render, el, injector);
        this.ngzone = ngzone;
        this.injector = injector;
        this.altEnterHandler = null;
        this.modalService = this.injector.get(BsModalService);
        this.messagerService = this.injector.get(MessagerService);
        this.eventManager = this.injector.get(EventManager);
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        super.ngOnInit();
        if (!this.dg.nowrap) {
            this.render.setStyle(this.instance.nativeElement, 'height', `${this.height}px`);
        }
        this.inputElement = this.instance.nativeElement;
        this.ngzone.runOutsideAngular((/**
         * @return {?}
         */
        () => {
            this.inputClickHandler = this.render.listen(this.instance.nativeElement, 'click', (/**
             * @param {?} e
             * @return {?}
             */
            (e) => {
                e.stopPropagation();
                return false;
            }));
        }));
        this.bindEventHandler();
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        if (this.instance) {
            this.inputClickHandler();
            if (this.altEnterHandler) {
                this.altEnterHandler();
            }
        }
    }
    /**
     * @private
     * @return {?}
     */
    bindEventHandler() {
        this.altEnterHandler = this.eventManager.addEventListener(this.inputElement, 'keydown.alt.enter', (/**
         * @param {?} event
         * @return {?}
         */
        (event) => {
            /** @type {?} */
            const target = ((/** @type {?} */ (event.target)));
            /** @type {?} */
            const val = target.value + '\n';
            target.value = val;
            event.preventDefault();
            event.stopPropagation();
            return false;
        }));
    }
    /**
     * @return {?}
     */
    showDialog() {
        const { dialogWidth, dialogHeight } = this.options;
        /** @type {?} */
        const opts = {
            width: dialogWidth || 500,
            height: dialogHeight || 400,
            showFontSize: true,
            enableWordCount: this.options.enableWordCount,
            countType: this.options.countType,
            maxLength: this.options.maxLength
        };
        this.messagerService.prompt2(this.column.title, this.formControl.value, opts).subscribe((/**
         * @param {?} v
         * @return {?}
         */
        v => {
            if (v) {
                this.formControl.setValue(v);
            }
            this.inputElement.focus();
            if (!this.options.onlyShowInDialog && this.wordcountref) {
                this.wordcountref.updateWordsCount();
            }
        }));
    }
}
DatagridTextareaComponent.decorators = [
    { type: Component, args: [{
                selector: 'grid-editor-textarea',
                template: `
    <div [formGroup]="group" class="f-datagrid-cell-formgroup farris-group-auto" style="position:relative">
        <datagrid-tooltip [control]="formControl" [tooltipPosition]="'top-left'" [message]="errorMessage">
            <textarea #input class="form-control"
                style="height:100%;resize:none;min-height:auto;"
                [formControlName]="column.field"
                [word-count]="options?.enableWordCount"
                [countType]="options?.countType"
                #wordcount="WordCountRef"
                [onlyShowInDialog]="options?.onlyShowInDialog"
                maxlength="{{options?.maxLength}}"></textarea>
        </datagrid-tooltip>
        <span class="f-icon modal_maximize" title="弹出窗口进行编辑" *ngIf="options?.editType && options?.editType !== 'default'"
             style="position: absolute;top: 2px;right: 2px; cursor:pointer" (click)="showDialog()"></span>
    </div>
    `
            }] }
];
/** @nocollapse */
DatagridTextareaComponent.ctorParameters = () => [
    { type: Renderer2 },
    { type: ElementRef },
    { type: NgZone },
    { type: Injector }
];
DatagridTextareaComponent.propDecorators = {
    instance: [{ type: ViewChild, args: ['input',] }],
    wordcountref: [{ type: ViewChild, args: ['wordcount',] }]
};
if (false) {
    /** @type {?} */
    DatagridTextareaComponent.prototype.instance;
    /** @type {?} */
    DatagridTextareaComponent.prototype.wordcountref;
    /**
     * @type {?}
     * @private
     */
    DatagridTextareaComponent.prototype.inputClickHandler;
    /**
     * @type {?}
     * @private
     */
    DatagridTextareaComponent.prototype.modalService;
    /**
     * @type {?}
     * @private
     */
    DatagridTextareaComponent.prototype.messagerService;
    /**
     * @type {?}
     * @private
     */
    DatagridTextareaComponent.prototype.eventManager;
    /**
     * @type {?}
     * @private
     */
    DatagridTextareaComponent.prototype.altEnterHandler;
    /**
     * @type {?}
     * @private
     */
    DatagridTextareaComponent.prototype.ngzone;
    /** @type {?} */
    DatagridTextareaComponent.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YWdyaWQtdGV4dGFyZWEuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1kYXRhZ3JpZC1lZGl0b3JzLyIsInNvdXJjZXMiOlsibGliL2VkaXRvcnMvZGF0YWdyaWQtdGV4dGFyZWEuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQVFBLE9BQU8sRUFBRSxTQUFTLEVBQWlCLFVBQVUsRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBYSxRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDeEgsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3RELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUN6RCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDbEQsT0FBTyxFQUFFLDBCQUEwQixFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDOUQsT0FBTyxFQUFFLDJCQUEyQixFQUFFLE1BQU0sbUNBQW1DLENBQUM7QUFxQmhGLE1BQU0sT0FBTyx5QkFBMEIsU0FBUSwyQkFBMkI7Ozs7Ozs7SUFTdEUsWUFDUSxNQUFpQixFQUFFLEVBQWMsRUFBVSxNQUFjLEVBQVMsUUFBa0I7UUFFeEYsS0FBSyxDQUFDLE1BQU0sRUFBRSxFQUFFLEVBQUUsUUFBUSxDQUFDLENBQUM7UUFGbUIsV0FBTSxHQUFOLE1BQU0sQ0FBUTtRQUFTLGFBQVEsR0FBUixRQUFRLENBQVU7UUFGcEYsb0JBQWUsR0FBRyxJQUFJLENBQUM7UUFLM0IsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxjQUFjLENBQUMsQ0FBQztRQUN0RCxJQUFJLENBQUMsZUFBZSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLGVBQWUsQ0FBQyxDQUFDO1FBQzFELElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDeEQsQ0FBQzs7OztJQUVELFFBQVE7UUFDSixLQUFLLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDakIsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsTUFBTSxFQUFFO1lBQ2pCLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsYUFBYSxFQUFFLFFBQVEsRUFBRSxHQUFHLElBQUksQ0FBQyxNQUFNLElBQUksQ0FBQyxDQUFDO1NBQ25GO1FBQ0QsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLGFBQWEsQ0FBQztRQUNoRCxJQUFJLENBQUMsTUFBTSxDQUFDLGlCQUFpQjs7O1FBQUUsR0FBRyxFQUFFO1lBQ2hDLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLGFBQWEsRUFBRSxPQUFPOzs7O1lBQUUsQ0FBQyxDQUFhLEVBQUUsRUFBRTtnQkFDaEcsQ0FBQyxDQUFDLGVBQWUsRUFBRSxDQUFDO2dCQUNwQixPQUFPLEtBQUssQ0FBQztZQUNqQixDQUFDLEVBQUMsQ0FBQztRQUNQLENBQUMsRUFBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUM7SUFDNUIsQ0FBQzs7OztJQUVELFdBQVc7UUFDUCxJQUFJLElBQUksQ0FBQyxRQUFRLEVBQUU7WUFDZixJQUFJLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztZQUV6QixJQUFJLElBQUksQ0FBQyxlQUFlLEVBQUU7Z0JBQ3RCLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQzthQUMxQjtTQUNKO0lBQ0wsQ0FBQzs7Ozs7SUFFTyxnQkFBZ0I7UUFDcEIsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsbUJBQW1COzs7O1FBQ2hHLENBQUMsS0FBb0IsRUFBRSxFQUFFOztrQkFDZixNQUFNLEdBQUcsQ0FBQyxtQkFBQSxLQUFLLENBQUMsTUFBTSxFQUFPLENBQUM7O2tCQUM5QixHQUFHLEdBQUcsTUFBTSxDQUFDLEtBQUssR0FBRyxJQUFJO1lBQy9CLE1BQU0sQ0FBQyxLQUFLLEdBQUcsR0FBRyxDQUFDO1lBQ25CLEtBQUssQ0FBQyxjQUFjLEVBQUUsQ0FBQztZQUN2QixLQUFLLENBQUMsZUFBZSxFQUFFLENBQUM7WUFDeEIsT0FBTyxLQUFLLENBQUM7UUFDakIsQ0FBQyxFQUFDLENBQUM7SUFDUCxDQUFDOzs7O0lBRUQsVUFBVTtjQUVBLEVBQUUsV0FBVyxFQUFFLFlBQVksRUFBRSxHQUFHLElBQUksQ0FBQyxPQUFPOztjQUM1QyxJQUFJLEdBQUc7WUFDVCxLQUFLLEVBQUUsV0FBVyxJQUFJLEdBQUc7WUFDekIsTUFBTSxFQUFFLFlBQVksSUFBSSxHQUFHO1lBQzNCLFlBQVksRUFBRSxJQUFJO1lBQ2xCLGVBQWUsRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLGVBQWU7WUFDN0MsU0FBUyxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUztZQUNqQyxTQUFTLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTO1NBQ3BDO1FBRUQsSUFBSSxDQUFDLGVBQWUsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUMsU0FBUzs7OztRQUFDLENBQUMsQ0FBQyxFQUFFO1lBQ3hGLElBQUksQ0FBQyxFQUFFO2dCQUNILElBQUksQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO2FBQ2hDO1lBQ0QsSUFBSSxDQUFDLFlBQVksQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUUxQixJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxnQkFBZ0IsSUFBSSxJQUFJLENBQUMsWUFBWSxFQUFFO2dCQUNyRCxJQUFJLENBQUMsWUFBWSxDQUFDLGdCQUFnQixFQUFFLENBQUM7YUFDeEM7UUFDTCxDQUFDLEVBQUMsQ0FBQztJQUNQLENBQUM7OztZQWpHSixTQUFTLFNBQUM7Z0JBQ1AsUUFBUSxFQUFFLHNCQUFzQjtnQkFDaEMsUUFBUSxFQUFFOzs7Ozs7Ozs7Ozs7Ozs7S0FlVDthQUNKOzs7O1lBekJ5RCxTQUFTO1lBQWhDLFVBQVU7WUFBd0IsTUFBTTtZQUFhLFFBQVE7Ozt1QkEyQjNGLFNBQVMsU0FBQyxPQUFPOzJCQUNqQixTQUFTLFNBQUMsV0FBVzs7OztJQUR0Qiw2Q0FBeUM7O0lBQ3pDLGlEQUFpRTs7Ozs7SUFDakUsc0RBQStCOzs7OztJQUMvQixpREFBcUM7Ozs7O0lBQ3JDLG9EQUF5Qzs7Ozs7SUFDekMsaURBQW1DOzs7OztJQUVuQyxvREFBK0I7Ozs7O0lBRVksMkNBQXNCOztJQUFFLDZDQUF5QiIsInNvdXJjZXNDb250ZW50IjpbIi8qXHJcbiAqIEBBdXRob3I6IOeWr+eLguengOaJjShMdWNhcyBIdWFuZylcclxuICogQERhdGU6IDIwMTktMDgtMTQgMTE6NDQ6MzBcclxuICogQExhc3RFZGl0b3JzOiDnlq/ni4Lnp4DmiY0oTHVjYXMgSHVhbmcpXHJcbiAqIEBMYXN0RWRpdFRpbWU6IDIwMTktMTAtMTQgMTM6MTU6NDlcclxuICogQFFROiAxMDU1ODE4MjM5XHJcbiAqIEBWZXJzaW9uOiB2MC4wLjFcclxuICovXHJcbmltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBJbnB1dCwgRWxlbWVudFJlZiwgVmlld0NoaWxkLCBSZW5kZXJlcjIsIE5nWm9uZSwgT25EZXN0cm95LCBJbmplY3RvciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBNZXNzYWdlclNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW1lc3NhZ2VyJztcclxuaW1wb3J0IHsgRXZlbnRNYW5hZ2VyIH0gZnJvbSAnQGFuZ3VsYXIvcGxhdGZvcm0tYnJvd3Nlcic7XHJcbmltcG9ydCB7IEJzTW9kYWxTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1tb2RhbCc7XHJcbmltcG9ydCB7IFRleHRhcmVhV29yZGNvdW50RGlyZWN0aXZlIH0gZnJvbSAnQGZhcnJpcy91aS1mb3Jtcyc7XHJcbmltcG9ydCB7IERhdGFncmlkQmFzZUVkaXRvckRpcmVjdGl2ZSB9IGZyb20gJy4uL2RhdGFncmlkLWJhc2UtZWRpdG9yLmRpcmVjdGl2ZSc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAnZ3JpZC1lZGl0b3ItdGV4dGFyZWEnLFxyXG4gICAgdGVtcGxhdGU6IGBcclxuICAgIDxkaXYgW2Zvcm1Hcm91cF09XCJncm91cFwiIGNsYXNzPVwiZi1kYXRhZ3JpZC1jZWxsLWZvcm1ncm91cCBmYXJyaXMtZ3JvdXAtYXV0b1wiIHN0eWxlPVwicG9zaXRpb246cmVsYXRpdmVcIj5cclxuICAgICAgICA8ZGF0YWdyaWQtdG9vbHRpcCBbY29udHJvbF09XCJmb3JtQ29udHJvbFwiIFt0b29sdGlwUG9zaXRpb25dPVwiJ3RvcC1sZWZ0J1wiIFttZXNzYWdlXT1cImVycm9yTWVzc2FnZVwiPlxyXG4gICAgICAgICAgICA8dGV4dGFyZWEgI2lucHV0IGNsYXNzPVwiZm9ybS1jb250cm9sXCJcclxuICAgICAgICAgICAgICAgIHN0eWxlPVwiaGVpZ2h0OjEwMCU7cmVzaXplOm5vbmU7bWluLWhlaWdodDphdXRvO1wiXHJcbiAgICAgICAgICAgICAgICBbZm9ybUNvbnRyb2xOYW1lXT1cImNvbHVtbi5maWVsZFwiXHJcbiAgICAgICAgICAgICAgICBbd29yZC1jb3VudF09XCJvcHRpb25zPy5lbmFibGVXb3JkQ291bnRcIlxyXG4gICAgICAgICAgICAgICAgW2NvdW50VHlwZV09XCJvcHRpb25zPy5jb3VudFR5cGVcIlxyXG4gICAgICAgICAgICAgICAgI3dvcmRjb3VudD1cIldvcmRDb3VudFJlZlwiXHJcbiAgICAgICAgICAgICAgICBbb25seVNob3dJbkRpYWxvZ109XCJvcHRpb25zPy5vbmx5U2hvd0luRGlhbG9nXCJcclxuICAgICAgICAgICAgICAgIG1heGxlbmd0aD1cInt7b3B0aW9ucz8ubWF4TGVuZ3RofX1cIj48L3RleHRhcmVhPlxyXG4gICAgICAgIDwvZGF0YWdyaWQtdG9vbHRpcD5cclxuICAgICAgICA8c3BhbiBjbGFzcz1cImYtaWNvbiBtb2RhbF9tYXhpbWl6ZVwiIHRpdGxlPVwi5by55Ye656qX5Y+j6L+b6KGM57yW6L6RXCIgKm5nSWY9XCJvcHRpb25zPy5lZGl0VHlwZSAmJiBvcHRpb25zPy5lZGl0VHlwZSAhPT0gJ2RlZmF1bHQnXCJcclxuICAgICAgICAgICAgIHN0eWxlPVwicG9zaXRpb246IGFic29sdXRlO3RvcDogMnB4O3JpZ2h0OiAycHg7IGN1cnNvcjpwb2ludGVyXCIgKGNsaWNrKT1cInNob3dEaWFsb2coKVwiPjwvc3Bhbj5cclxuICAgIDwvZGl2PlxyXG4gICAgYFxyXG59KVxyXG5leHBvcnQgY2xhc3MgRGF0YWdyaWRUZXh0YXJlYUNvbXBvbmVudCBleHRlbmRzIERhdGFncmlkQmFzZUVkaXRvckRpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95IHtcclxuICAgIEBWaWV3Q2hpbGQoJ2lucHV0JykgaW5zdGFuY2U6IEVsZW1lbnRSZWY7XHJcbiAgICBAVmlld0NoaWxkKCd3b3JkY291bnQnKSB3b3JkY291bnRyZWY6IFRleHRhcmVhV29yZGNvdW50RGlyZWN0aXZlO1xyXG4gICAgcHJpdmF0ZSBpbnB1dENsaWNrSGFuZGxlcjogYW55O1xyXG4gICAgcHJpdmF0ZSBtb2RhbFNlcnZpY2U6IEJzTW9kYWxTZXJ2aWNlO1xyXG4gICAgcHJpdmF0ZSBtZXNzYWdlclNlcnZpY2U6IE1lc3NhZ2VyU2VydmljZTtcclxuICAgIHByaXZhdGUgZXZlbnRNYW5hZ2VyOiBFdmVudE1hbmFnZXI7XHJcblxyXG4gICAgcHJpdmF0ZSBhbHRFbnRlckhhbmRsZXIgPSBudWxsO1xyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgICAgIHJlbmRlcjogUmVuZGVyZXIyLCBlbDogRWxlbWVudFJlZiwgcHJpdmF0ZSBuZ3pvbmU6IE5nWm9uZSwgcHVibGljIGluamVjdG9yOiBJbmplY3RvclxyXG4gICAgICAgICAgICkge1xyXG4gICAgICAgIHN1cGVyKHJlbmRlciwgZWwsIGluamVjdG9yKTtcclxuICAgICAgICB0aGlzLm1vZGFsU2VydmljZSA9IHRoaXMuaW5qZWN0b3IuZ2V0KEJzTW9kYWxTZXJ2aWNlKTtcclxuICAgICAgICB0aGlzLm1lc3NhZ2VyU2VydmljZSA9IHRoaXMuaW5qZWN0b3IuZ2V0KE1lc3NhZ2VyU2VydmljZSk7XHJcbiAgICAgICAgdGhpcy5ldmVudE1hbmFnZXIgPSB0aGlzLmluamVjdG9yLmdldChFdmVudE1hbmFnZXIpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCkge1xyXG4gICAgICAgIHN1cGVyLm5nT25Jbml0KCk7XHJcbiAgICAgICAgaWYgKCF0aGlzLmRnLm5vd3JhcCkge1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlci5zZXRTdHlsZSh0aGlzLmluc3RhbmNlLm5hdGl2ZUVsZW1lbnQsICdoZWlnaHQnLCBgJHt0aGlzLmhlaWdodH1weGApO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmlucHV0RWxlbWVudCA9IHRoaXMuaW5zdGFuY2UubmF0aXZlRWxlbWVudDtcclxuICAgICAgICB0aGlzLm5nem9uZS5ydW5PdXRzaWRlQW5ndWxhciggKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmlucHV0Q2xpY2tIYW5kbGVyID0gdGhpcy5yZW5kZXIubGlzdGVuKHRoaXMuaW5zdGFuY2UubmF0aXZlRWxlbWVudCwgJ2NsaWNrJywgKGU6IE1vdXNlRXZlbnQpID0+IHtcclxuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLmJpbmRFdmVudEhhbmRsZXIoKTtcclxuICAgIH1cclxuXHJcbiAgICBuZ09uRGVzdHJveSgpIHtcclxuICAgICAgICBpZiAodGhpcy5pbnN0YW5jZSkge1xyXG4gICAgICAgICAgICB0aGlzLmlucHV0Q2xpY2tIYW5kbGVyKCk7XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5hbHRFbnRlckhhbmRsZXIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuYWx0RW50ZXJIYW5kbGVyKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBiaW5kRXZlbnRIYW5kbGVyKCkge1xyXG4gICAgICAgIHRoaXMuYWx0RW50ZXJIYW5kbGVyID0gdGhpcy5ldmVudE1hbmFnZXIuYWRkRXZlbnRMaXN0ZW5lcih0aGlzLmlucHV0RWxlbWVudCwgJ2tleWRvd24uYWx0LmVudGVyJyxcclxuICAgICAgICAoZXZlbnQ6IEtleWJvYXJkRXZlbnQpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgdGFyZ2V0ID0gKGV2ZW50LnRhcmdldCBhcyBhbnkpO1xyXG4gICAgICAgICAgICBjb25zdCB2YWwgPSB0YXJnZXQudmFsdWUgKyAnXFxuJztcclxuICAgICAgICAgICAgdGFyZ2V0LnZhbHVlID0gdmFsO1xyXG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHNob3dEaWFsb2coKSB7XHJcblxyXG4gICAgICAgIGNvbnN0IHsgZGlhbG9nV2lkdGgsIGRpYWxvZ0hlaWdodCB9ID0gdGhpcy5vcHRpb25zO1xyXG4gICAgICAgIGNvbnN0IG9wdHMgPSB7XHJcbiAgICAgICAgICAgIHdpZHRoOiBkaWFsb2dXaWR0aCB8fCA1MDAsXHJcbiAgICAgICAgICAgIGhlaWdodDogZGlhbG9nSGVpZ2h0IHx8IDQwMCxcclxuICAgICAgICAgICAgc2hvd0ZvbnRTaXplOiB0cnVlLFxyXG4gICAgICAgICAgICBlbmFibGVXb3JkQ291bnQ6IHRoaXMub3B0aW9ucy5lbmFibGVXb3JkQ291bnQsXHJcbiAgICAgICAgICAgIGNvdW50VHlwZTogdGhpcy5vcHRpb25zLmNvdW50VHlwZSxcclxuICAgICAgICAgICAgbWF4TGVuZ3RoOiB0aGlzLm9wdGlvbnMubWF4TGVuZ3RoXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdGhpcy5tZXNzYWdlclNlcnZpY2UucHJvbXB0Mih0aGlzLmNvbHVtbi50aXRsZSwgdGhpcy5mb3JtQ29udHJvbC52YWx1ZSwgb3B0cykuc3Vic2NyaWJlKHYgPT4ge1xyXG4gICAgICAgICAgICBpZiAodikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5mb3JtQ29udHJvbC5zZXRWYWx1ZSh2KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmlucHV0RWxlbWVudC5mb2N1cygpO1xyXG5cclxuICAgICAgICAgICAgaWYgKCF0aGlzLm9wdGlvbnMub25seVNob3dJbkRpYWxvZyAmJiB0aGlzLndvcmRjb3VudHJlZikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy53b3JkY291bnRyZWYudXBkYXRlV29yZHNDb3VudCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG5cclxufVxyXG4iXX0=