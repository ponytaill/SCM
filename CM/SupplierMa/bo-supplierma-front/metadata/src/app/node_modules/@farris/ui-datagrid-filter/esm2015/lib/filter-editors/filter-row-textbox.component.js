/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { LocaleService } from '@farris/ui-locale';
import { Component, Input, ComponentFactoryResolver, Injector, ApplicationRef, Renderer2, ViewChild, ElementRef, ChangeDetectorRef, NgZone } from '@angular/core';
import { delay, filter } from 'rxjs/operators';
import ResizeObserver from 'resize-observer-polyfill';
import { ColumnFilterType } from '@farris/ui-datagrid';
import { FilterOperator, TextFilterOperators, NumberOrDateFilterOperators, FilterConditionValue, } from './../operations/operators';
import { FilterRowPanelComponent } from './filter-row-panel.component';
import { DatagridFilterRowService } from '../datagrid-filter-row.service';
import { FilterRowEditorComponent } from './filter-row-editor.component';
export class FilterTextboxComponent extends FilterRowEditorComponent {
    /**
     * @param {?} cfr
     * @param {?} injector
     * @param {?} app
     * @param {?} dfrs
     * @param {?} render
     * @param {?} cd
     * @param {?} localSer
     */
    constructor(cfr, injector, app, dfrs, render, cd, localSer) {
        super();
        this.cfr = cfr;
        this.injector = injector;
        this.app = app;
        this.dfrs = dfrs;
        this.render = render;
        this.cd = cd;
        this.localSer = localSer;
        this.disabled = false;
        this.delay = 300;
        this.filterStr = '';
        this.filterPanelSubscription = null;
        this.ro = null;
        this.zone = null;
        this.el = null;
        this.zone = this.injector.get(NgZone);
        this.el = this.injector.get(ElementRef);
        this.dfrs.filterTextboxChanged.pipe(filter((/**
         * @param {?} v
         * @return {?}
         */
        v => v[this.column.field] !== undefined)), delay(this.delay)).subscribe((/**
         * @param {?} obj
         * @return {?}
         */
        (obj) => {
            /** @type {?} */
            const val = obj[this.column.field];
            if (val !== '') {
                /** @type {?} */
                const _condition = { operator1: FilterOperator.Contains, value1: val };
                if (this.column.filter.type === ColumnFilterType.number) {
                    _condition.operator1 = FilterOperator.Equal;
                }
                this.dfrs.updateColumnConditions(this.column.field, _condition);
            }
            else {
                this.dfrs.updateColumnConditions(this.column.field, FilterConditionValue.All);
            }
        }));
        this.dfrs.removeField.subscribe((/**
         * @param {?} f
         * @return {?}
         */
        f => {
            if (f === this.column.field) {
                this.clearValue();
            }
        }));
    }
    /**
     * @return {?}
     */
    get inputType() {
        if (this.column.filter.type === ColumnFilterType.number) {
            return 'number';
        }
        return 'text';
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        if (this.ro) {
            this.ro.disconnect();
        }
    }
    /**
     * @param {?} event
     * @return {?}
     */
    show(event) {
        this.close();
        event.stopPropagation();
        /** @type {?} */
        const dgContainerEle = ((/** @type {?} */ (event.target))).closest('.f-datagrid');
        if (dgContainerEle) {
            dgContainerEle.addEventListener('click', (/**
             * @param {?} e
             * @return {?}
             */
            (e) => {
                this.close();
            }));
        }
        if (!this.dfrs.gridInstance) {
            this.dfrs.gridInstance = this.gridInstance;
        }
        /** @type {?} */
        const cf = this.cfr.resolveComponentFactory(FilterRowPanelComponent);
        this.filterPanelRef = cf.create(this.injector);
        this.app.attachView(this.filterPanelRef.hostView);
        this.filterPanelRef.instance.column = this.column;
        this.filterPanelRef.instance.gridInstance = this.gridInstance;
        this.initOperators(this.filterPanelRef.instance);
        if (this.column.filter !== false && this.column.filter !== undefined) {
            this.filterPanelRef.instance.datatype = this.column.filter.type;
            if (this.column.filter.type === ColumnFilterType.enum ||
                this.column.filter.type === ColumnFilterType.fromdata) {
                this.filterPanelRef.instance.height = 300;
            }
        }
        /** @type {?} */
        const currentColumnCondition = this.dfrs.columnConditions[this.column.field];
        if (currentColumnCondition) {
            this.filterPanelRef.instance.condition = (/** @type {?} */ (currentColumnCondition));
        }
        else {
            this.filterPanelRef.instance.condition = {
                operator1: 0,
                value1: '',
                relation: '',
                operator2: 0,
                value2: ''
            };
            // this.initOperators(this.filterPanelRef.instance);
        }
        this.filterPanelSubscription = this.filterPanelRef.instance.conditionChange.subscribe((/**
         * @param {?} condition
         * @return {?}
         */
        (condition) => {
            if (condition) {
                this.dfrs.updateColumnConditions(this.column.field, condition);
                this.filterStr = this.dfrs.condition2string(this.column, condition);
                if (this.column.filter.type < 2) {
                    this.disabled = !!this.filterStr;
                }
                this.cd.detectChanges();
            }
            else {
                this.clearValue();
                this.dfrs.updateColumnConditions(this.column.field, FilterConditionValue.All);
            }
        }));
        document.body.appendChild(this.filterPanelRef.location.nativeElement);
        this.updateFilterPanelPosition(event.target);
        this.dfrs.setFilterPanel(this.filterPanelRef);
        /** @type {?} */
        const dgWidth = dgContainerEle.getBoundingClientRect().width;
        this.zone.runOutsideAngular((/**
         * @return {?}
         */
        () => {
            this.ro = new ResizeObserver((/**
             * @param {?} entries
             * @param {?} observer
             * @return {?}
             */
            (entries, observer) => {
                if (entries[0].target.getBoundingClientRect().width !== dgWidth) {
                    this.close();
                }
            }));
            this.ro.observe(dgContainerEle);
        }));
        this.filterPanelRef.instance.target = event;
        this.filterPanelRef.changeDetectorRef.markForCheck();
        this.filterPanelRef.changeDetectorRef.detectChanges();
    }
    /**
     * @return {?}
     */
    close() {
        this.dfrs.closeFilterPanel();
        if (this.filterPanelSubscription) {
            this.filterPanelSubscription.unsubscribe();
            this.filterPanelSubscription = null;
        }
    }
    /**
     * @private
     * @param {?} ins
     * @return {?}
     */
    initOperators(ins) {
        if (this.column.filter.type === ColumnFilterType.string) {
            ins.operators = TextFilterOperators;
            ins.condition.operator1 = FilterOperator.Contains;
            ins.condition.operator2 = FilterOperator.Contains;
        }
        else if (this.column.filter.type === ColumnFilterType.number || this.column.filter.type === ColumnFilterType.datetime
            || this.column.filter.type === ColumnFilterType.date || this.column.filter.type === ColumnFilterType.time) {
            ins.operators = NumberOrDateFilterOperators;
            ins.condition.operator1 = FilterOperator.Equal;
            ins.condition.operator2 = FilterOperator.Equal;
        }
        if (ins.operators) {
            ins.operators.forEach((/**
             * @param {?} o
             * @return {?}
             */
            o => {
                o.label = this.dfrs.getOperatorLabel(o.code);
            }));
        }
    }
    /**
     * @private
     * @param {?} target
     * @return {?}
     */
    updateFilterPanelPosition(target) {
        if (target) {
            /** @type {?} */
            const filterIconParent = target.parentElement;
            if (filterIconParent) {
                /** @type {?} */
                const pos = filterIconParent.getBoundingClientRect();
                /** @type {?} */
                const tr = target.closest('tr');
                /** @type {?} */
                const td = target.closest('td');
                /** @type {?} */
                const headerPos = target.closest('.f-datagrid-header').getBoundingClientRect();
                /** @type {?} */
                const panelWidth = this.filterPanelRef.instance.width;
                /** @type {?} */
                let left = pos.left;
                if (headerPos.width + headerPos.x < pos.x + panelWidth) { // this.column.filter.type === ColumnFilterType.enum
                    left = td.getBoundingClientRect().left + td.offsetWidth - panelWidth;
                    this.filterPanelRef.location.nativeElement.querySelector('.panel-icon').style.left = `${panelWidth - 40}px`;
                }
                // const top = pos.top
                /** @type {?} */
                const panel = this.filterPanelRef.location.nativeElement.querySelector('div');
                if (panel) {
                    this.render.setStyle(panel, 'top', `${pos.top}px`);
                    this.render.setStyle(panel, 'left', `${left}px`);
                }
            }
        }
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onTextValueChange($event) {
        /** @type {?} */
        const value = $event.target.value;
        this.dfrs.filterTextboxChanged.emit({ [this.column.field]: value });
    }
    /**
     * @return {?}
     */
    clearValue() {
        this.filterStr = '';
        if (this.input) {
            this.input.nativeElement.value = '';
        }
        if (this.column.filter.type < 2) {
            this.disabled = false;
        }
        this.cd.detectChanges();
    }
    /**
     * @param {?} condition
     * @return {?}
     */
    initFilter(condition) {
        this.filterStr = this.dfrs.condition2string(this.column, condition);
        this.disabled = !!this.filterStr;
        this.dfrs._updateColumnConditions(this.column.field, condition);
        this.cd.detectChanges();
    }
}
FilterTextboxComponent.decorators = [
    { type: Component, args: [{
                selector: 'filter-textbox',
                template: `
    <div class="f-datagrid-header-cell-content f-datagrid-filter-cell d-flex" style="padding-right: 5px">
        <div class="f-datagrid-cell-formgroup farris-group-auto flex-fill">
            <input *ngIf="!disabled" class="form-control" [attr.type]="inputType" [value]="filterStr"
                (input)="onTextValueChange($event)" #input>
            <input *ngIf="disabled" class="form-control" type="text" [value]="filterStr"
            [attr.title]="filterStr" [disabled]="disabled" [class.filter-editor-disabled]="disabled" >
        </div>
        <div style="min-width: 26px; text-align: center; align-items: center;
            display: flex; justify-content: center;" *ngIf="column.filter.enableOperator">
            <span style="cursor: pointer;" class="f-icon f-icon-filter-sm" (click)="show($event)"></span>
        </div>
    </div>
    `
            }] }
];
/** @nocollapse */
FilterTextboxComponent.ctorParameters = () => [
    { type: ComponentFactoryResolver },
    { type: Injector },
    { type: ApplicationRef },
    { type: DatagridFilterRowService },
    { type: Renderer2 },
    { type: ChangeDetectorRef },
    { type: LocaleService }
];
FilterTextboxComponent.propDecorators = {
    column: [{ type: Input }],
    disabled: [{ type: Input }],
    delay: [{ type: Input }],
    input: [{ type: ViewChild, args: ['input',] }]
};
if (false) {
    /** @type {?} */
    FilterTextboxComponent.prototype.column;
    /** @type {?} */
    FilterTextboxComponent.prototype.disabled;
    /** @type {?} */
    FilterTextboxComponent.prototype.delay;
    /** @type {?} */
    FilterTextboxComponent.prototype.filterStr;
    /** @type {?} */
    FilterTextboxComponent.prototype.gridInstance;
    /** @type {?} */
    FilterTextboxComponent.prototype.filterPanelRef;
    /** @type {?} */
    FilterTextboxComponent.prototype.filterPanelSubscription;
    /** @type {?} */
    FilterTextboxComponent.prototype.input;
    /**
     * @type {?}
     * @private
     */
    FilterTextboxComponent.prototype.ro;
    /**
     * @type {?}
     * @private
     */
    FilterTextboxComponent.prototype.zone;
    /**
     * @type {?}
     * @private
     */
    FilterTextboxComponent.prototype.el;
    /**
     * @type {?}
     * @private
     */
    FilterTextboxComponent.prototype.cfr;
    /**
     * @type {?}
     * @private
     */
    FilterTextboxComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    FilterTextboxComponent.prototype.app;
    /** @type {?} */
    FilterTextboxComponent.prototype.dfrs;
    /**
     * @type {?}
     * @private
     */
    FilterTextboxComponent.prototype.render;
    /**
     * @type {?}
     * @private
     */
    FilterTextboxComponent.prototype.cd;
    /**
     * @type {?}
     * @private
     */
    FilterTextboxComponent.prototype.localSer;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsdGVyLXJvdy10ZXh0Ym94LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktZGF0YWdyaWQtZmlsdGVyLyIsInNvdXJjZXMiOlsibGliL2ZpbHRlci1lZGl0b3JzL2ZpbHRlci1yb3ctdGV4dGJveC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNsRCxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSx3QkFBd0IsRUFBRSxRQUFRLEVBQWdCLGNBQWMsRUFDdkYsU0FBUyxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxFQUFhLE1BQU0sZUFBZSxDQUFDO0FBRWxHLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFnQixNQUFNLGdCQUFnQixDQUFDO0FBRTdELE9BQU8sY0FBYyxNQUFNLDBCQUEwQixDQUFDO0FBRXRELE9BQU8sRUFBRSxnQkFBZ0IsRUFBcUIsTUFBTSxxQkFBcUIsQ0FBQztBQUUxRSxPQUFPLEVBQUUsY0FBYyxFQUNmLG1CQUFtQixFQUFFLDJCQUEyQixFQUFFLG9CQUFvQixHQUFHLE1BQU0sMkJBQTJCLENBQUM7QUFDbkgsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFDdkUsT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFDMUUsT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFtQnpFLE1BQU0sT0FBTyxzQkFBdUIsU0FBUSx3QkFBd0I7Ozs7Ozs7Ozs7SUF5QmhFLFlBQ1ksR0FBNkIsRUFBVSxRQUFrQixFQUFVLEdBQW1CLEVBQ3ZGLElBQThCLEVBQVUsTUFBaUIsRUFBVSxFQUFxQixFQUN2RixRQUF1QjtRQUUvQixLQUFLLEVBQUUsQ0FBQztRQUpBLFFBQUcsR0FBSCxHQUFHLENBQTBCO1FB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Q0FBQyxNQUFNLEVBQUUsU0FBUyxDQUFDLENBQUM7UUFDcEUsSUFBSSxDQUFDLFFBQVEsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQztRQUNqQyxJQUFJLENBQUMsSUFBSSxDQUFDLHVCQUF1QixDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLFNBQVMsQ0FBQyxDQUFDO1FBQ2hFLElBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxFQUFFLENBQUM7SUFDNUIsQ0FBQzs7O1lBMU9KLFNBQVMsU0FBQztnQkFDUCxRQUFRLEVBQUUsZ0JBQWdCO2dCQUMxQixRQUFRLEVBQUU7Ozs7Ozs7Ozs7Ozs7S0FhVDthQUNKOzs7O1lBL0IwQix3QkFBd0I7WUFBRSxRQUFRO1lBQWdCLGNBQWM7WUFZbEYsd0JBQXdCO1lBWDdCLFNBQVM7WUFBeUIsaUJBQWlCO1lBRjlDLGFBQWE7OztxQkFrQ2pCLEtBQUs7dUJBQ0wsS0FBSztvQkFDTCxLQUFLO29CQWdCTCxTQUFTLFNBQUMsT0FBTzs7OztJQWxCbEIsd0NBQXFCOztJQUNyQiwwQ0FBMEI7O0lBQzFCLHVDQUFxQjs7SUFDckIsMkNBQWU7O0lBU2YsOENBQWdDOztJQUVoQyxnREFBc0Q7O0lBRXRELHlEQUE2Qzs7SUFFN0MsdUNBQXNDOzs7OztJQUV0QyxvQ0FBeUM7Ozs7O0lBQ3pDLHNDQUE0Qjs7Ozs7SUFDNUIsb0NBQThCOzs7OztJQUcxQixxQ0FBcUM7Ozs7O0lBQUUsMENBQTBCOzs7OztJQUFFLHFDQUEyQjs7SUFDOUYsc0NBQXFDOzs7OztJQUFFLHdDQUF5Qjs7Ozs7SUFBRSxvQ0FBNkI7Ozs7O0lBQy9GLDBDQUErQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IExvY2FsZVNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWxvY2FsZSc7XHJcbmltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQsIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciwgSW5qZWN0b3IsIENvbXBvbmVudFJlZiwgQXBwbGljYXRpb25SZWYsXHJcbiAgICBSZW5kZXJlcjIsIFZpZXdDaGlsZCwgRWxlbWVudFJlZiwgQ2hhbmdlRGV0ZWN0b3JSZWYsIE5nWm9uZSwgT25EZXN0cm95IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBkZWxheSwgZmlsdGVyLCBkZWJvdW5jZVRpbWUgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcblxyXG5pbXBvcnQgUmVzaXplT2JzZXJ2ZXIgZnJvbSAncmVzaXplLW9ic2VydmVyLXBvbHlmaWxsJztcclxuXHJcbmltcG9ydCB7IENvbHVtbkZpbHRlclR5cGUsIERhdGFncmlkQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1kYXRhZ3JpZCc7XHJcblxyXG5pbXBvcnQgeyBGaWx0ZXJPcGVyYXRvciwgRmlsdGVyQ29uZGl0aW9uLFxyXG4gICAgICAgIFRleHRGaWx0ZXJPcGVyYXRvcnMsIE51bWJlck9yRGF0ZUZpbHRlck9wZXJhdG9ycywgRmlsdGVyQ29uZGl0aW9uVmFsdWUsIH0gZnJvbSAnLi8uLi9vcGVyYXRpb25zL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7IEZpbHRlclJvd1BhbmVsQ29tcG9uZW50IH0gZnJvbSAnLi9maWx0ZXItcm93LXBhbmVsLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IERhdGFncmlkRmlsdGVyUm93U2VydmljZSB9IGZyb20gJy4uL2RhdGFncmlkLWZpbHRlci1yb3cuc2VydmljZSc7XHJcbmltcG9ydCB7IEZpbHRlclJvd0VkaXRvckNvbXBvbmVudCB9IGZyb20gJy4vZmlsdGVyLXJvdy1lZGl0b3IuY29tcG9uZW50JztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdmaWx0ZXItdGV4dGJveCcsXHJcbiAgICB0ZW1wbGF0ZTogYFxyXG4gICAgPGRpdiBjbGFzcz1cImYtZGF0YWdyaWQtaGVhZGVyLWNlbGwtY29udGVudCBmLWRhdGFncmlkLWZpbHRlci1jZWxsIGQtZmxleFwiIHN0eWxlPVwicGFkZGluZy1yaWdodDogNXB4XCI+XHJcbiAgICAgICAgPGRpdiBjbGFzcz1cImYtZGF0YWdyaWQtY2VsbC1mb3JtZ3JvdXAgZmFycmlzLWdyb3VwLWF1dG8gZmxleC1maWxsXCI+XHJcbiAgICAgICAgICAgIDxpbnB1dCAqbmdJZj1cIiFkaXNhYmxlZFwiIGNsYXNzPVwiZm9ybS1jb250cm9sXCIgW2F0dHIudHlwZV09XCJpbnB1dFR5cGVcIiBbdmFsdWVdPVwiZmlsdGVyU3RyXCJcclxuICAgICAgICAgICAgICAgIChpbnB1dCk9XCJvblRleHRWYWx1ZUNoYW5nZSgkZXZlbnQpXCIgI2lucHV0PlxyXG4gICAgICAgICAgICA8aW5wdXQgKm5nSWY9XCJkaXNhYmxlZFwiIGNsYXNzPVwiZm9ybS1jb250cm9sXCIgdHlwZT1cInRleHRcIiBbdmFsdWVdPVwiZmlsdGVyU3RyXCJcclxuICAgICAgICAgICAgW2F0dHIudGl0bGVdPVwiZmlsdGVyU3RyXCIgW2Rpc2FibGVkXT1cImRpc2FibGVkXCIgW2NsYXNzLmZpbHRlci1lZGl0b3ItZGlzYWJsZWRdPVwiZGlzYWJsZWRcIiA+XHJcbiAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgPGRpdiBzdHlsZT1cIm1pbi13aWR0aDogMjZweDsgdGV4dC1hbGlnbjogY2VudGVyOyBhbGlnbi1pdGVtczogY2VudGVyO1xyXG4gICAgICAgICAgICBkaXNwbGF5OiBmbGV4OyBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjtcIiAqbmdJZj1cImNvbHVtbi5maWx0ZXIuZW5hYmxlT3BlcmF0b3JcIj5cclxuICAgICAgICAgICAgPHNwYW4gc3R5bGU9XCJjdXJzb3I6IHBvaW50ZXI7XCIgY2xhc3M9XCJmLWljb24gZi1pY29uLWZpbHRlci1zbVwiIChjbGljayk9XCJzaG93KCRldmVudClcIj48L3NwYW4+XHJcbiAgICAgICAgPC9kaXY+XHJcbiAgICA8L2Rpdj5cclxuICAgIGBcclxufSlcclxuZXhwb3J0IGNsYXNzIEZpbHRlclRleHRib3hDb21wb25lbnQgZXh0ZW5kcyBGaWx0ZXJSb3dFZGl0b3JDb21wb25lbnQgaW1wbGVtZW50cyBPbkRlc3Ryb3kge1xyXG4gICAgQElucHV0KCkgY29sdW1uOiBhbnk7XHJcbiAgICBASW5wdXQoKSBkaXNhYmxlZCA9IGZhbHNlO1xyXG4gICAgQElucHV0KCkgZGVsYXkgPSAzMDA7XHJcbiAgICBmaWx0ZXJTdHIgPSAnJztcclxuXHJcbiAgICBnZXQgaW5wdXRUeXBlKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmNvbHVtbi5maWx0ZXIudHlwZSA9PT0gQ29sdW1uRmlsdGVyVHlwZS5udW1iZXIgKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAnbnVtYmVyJztcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuICd0ZXh0JztcclxuICAgIH1cclxuXHJcbiAgICBncmlkSW5zdGFuY2U6IERhdGFncmlkQ29tcG9uZW50O1xyXG5cclxuICAgIGZpbHRlclBhbmVsUmVmOiBDb21wb25lbnRSZWY8RmlsdGVyUm93UGFuZWxDb21wb25lbnQ+O1xyXG5cclxuICAgIGZpbHRlclBhbmVsU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb24gPSBudWxsO1xyXG5cclxuICAgIEBWaWV3Q2hpbGQoJ2lucHV0JykgaW5wdXQ6IEVsZW1lbnRSZWY7XHJcblxyXG4gICAgcHJpdmF0ZSBybzogUmVzaXplT2JzZXJ2ZXIgfCBudWxsID0gbnVsbDtcclxuICAgIHByaXZhdGUgem9uZTogTmdab25lID0gbnVsbDtcclxuICAgIHByaXZhdGUgZWw6IEVsZW1lbnRSZWYgPSBudWxsO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIHByaXZhdGUgY2ZyOiBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yLCBwcml2YXRlIGFwcDogQXBwbGljYXRpb25SZWYsXHJcbiAgICAgICAgcHVibGljIGRmcnM6IERhdGFncmlkRmlsdGVyUm93U2VydmljZSwgcHJpdmF0ZSByZW5kZXI6IFJlbmRlcmVyMiwgcHJpdmF0ZSBjZDogQ2hhbmdlRGV0ZWN0b3JSZWYsXHJcbiAgICAgICAgcHJpdmF0ZSBsb2NhbFNlcjogTG9jYWxlU2VydmljZVxyXG4gICAgKSB7XHJcbiAgICAgICAgc3VwZXIoKTtcclxuXHJcbiAgICAgICAgdGhpcy56b25lID0gdGhpcy5pbmplY3Rvci5nZXQoTmdab25lKTtcclxuICAgICAgICB0aGlzLmVsID0gdGhpcy5pbmplY3Rvci5nZXQoRWxlbWVudFJlZik7XHJcblxyXG4gICAgICAgIHRoaXMuZGZycy5maWx0ZXJUZXh0Ym94Q2hhbmdlZC5waXBlKFxyXG4gICAgICAgICAgICBmaWx0ZXIodiA9PiB2W3RoaXMuY29sdW1uLmZpZWxkXSAhPT0gdW5kZWZpbmVkKSxcclxuICAgICAgICAgICAgZGVsYXkodGhpcy5kZWxheSlcclxuICAgICAgICApLnN1YnNjcmliZSgob2JqOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgdmFsID0gb2JqW3RoaXMuY29sdW1uLmZpZWxkXTtcclxuICAgICAgICAgICAgaWYgKHZhbCAhPT0gJycpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IF9jb25kaXRpb24gPSB7IG9wZXJhdG9yMTogRmlsdGVyT3BlcmF0b3IuQ29udGFpbnMsIHZhbHVlMTogdmFsIH07XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jb2x1bW4uZmlsdGVyLnR5cGUgPT09IENvbHVtbkZpbHRlclR5cGUubnVtYmVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgX2NvbmRpdGlvbi5vcGVyYXRvcjEgPSBGaWx0ZXJPcGVyYXRvci5FcXVhbDtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLmRmcnMudXBkYXRlQ29sdW1uQ29uZGl0aW9ucyh0aGlzLmNvbHVtbi5maWVsZCwgX2NvbmRpdGlvbiApO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kZnJzLnVwZGF0ZUNvbHVtbkNvbmRpdGlvbnModGhpcy5jb2x1bW4uZmllbGQsIEZpbHRlckNvbmRpdGlvblZhbHVlLkFsbCApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMuZGZycy5yZW1vdmVGaWVsZC5zdWJzY3JpYmUoZiA9PiB7XHJcbiAgICAgICAgICAgIGlmIChmID09PSB0aGlzLmNvbHVtbi5maWVsZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jbGVhclZhbHVlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcclxuICAgICAgICBpZiAodGhpcy5ybykge1xyXG4gICAgICAgICAgICB0aGlzLnJvLmRpc2Nvbm5lY3QoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc2hvdyhldmVudDogTW91c2VFdmVudCkge1xyXG4gICAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuXHJcbiAgICAgICAgY29uc3QgZGdDb250YWluZXJFbGUgPSAoZXZlbnQudGFyZ2V0IGFzIGFueSkuY2xvc2VzdCgnLmYtZGF0YWdyaWQnKTtcclxuICAgICAgICBpZiAoZGdDb250YWluZXJFbGUpIHtcclxuICAgICAgICAgICAgZGdDb250YWluZXJFbGUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICghdGhpcy5kZnJzLmdyaWRJbnN0YW5jZSkge1xyXG4gICAgICAgICAgICB0aGlzLmRmcnMuZ3JpZEluc3RhbmNlID0gdGhpcy5ncmlkSW5zdGFuY2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBjZiA9IHRoaXMuY2ZyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KEZpbHRlclJvd1BhbmVsQ29tcG9uZW50KTtcclxuICAgICAgICB0aGlzLmZpbHRlclBhbmVsUmVmID0gY2YuY3JlYXRlKHRoaXMuaW5qZWN0b3IpO1xyXG4gICAgICAgIHRoaXMuYXBwLmF0dGFjaFZpZXcodGhpcy5maWx0ZXJQYW5lbFJlZi5ob3N0Vmlldyk7XHJcbiAgICAgICAgdGhpcy5maWx0ZXJQYW5lbFJlZi5pbnN0YW5jZS5jb2x1bW4gPSB0aGlzLmNvbHVtbjtcclxuICAgICAgICB0aGlzLmZpbHRlclBhbmVsUmVmLmluc3RhbmNlLmdyaWRJbnN0YW5jZSA9IHRoaXMuZ3JpZEluc3RhbmNlO1xyXG5cclxuICAgICAgICB0aGlzLmluaXRPcGVyYXRvcnModGhpcy5maWx0ZXJQYW5lbFJlZi5pbnN0YW5jZSk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmNvbHVtbi5maWx0ZXIgIT09IGZhbHNlICYmIHRoaXMuY29sdW1uLmZpbHRlciAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZmlsdGVyUGFuZWxSZWYuaW5zdGFuY2UuZGF0YXR5cGUgPSB0aGlzLmNvbHVtbi5maWx0ZXIudHlwZTtcclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbHVtbi5maWx0ZXIudHlwZSA9PT0gQ29sdW1uRmlsdGVyVHlwZS5lbnVtIHx8XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbHVtbi5maWx0ZXIudHlwZSA9PT0gQ29sdW1uRmlsdGVyVHlwZS5mcm9tZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5maWx0ZXJQYW5lbFJlZi5pbnN0YW5jZS5oZWlnaHQgPSAgMzAwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBjdXJyZW50Q29sdW1uQ29uZGl0aW9uID0gdGhpcy5kZnJzLmNvbHVtbkNvbmRpdGlvbnNbdGhpcy5jb2x1bW4uZmllbGRdO1xyXG4gICAgICAgIGlmIChjdXJyZW50Q29sdW1uQ29uZGl0aW9uKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZmlsdGVyUGFuZWxSZWYuaW5zdGFuY2UuY29uZGl0aW9uID0gY3VycmVudENvbHVtbkNvbmRpdGlvbiBhcyBGaWx0ZXJDb25kaXRpb247XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5maWx0ZXJQYW5lbFJlZi5pbnN0YW5jZS5jb25kaXRpb24gPSB7XHJcbiAgICAgICAgICAgICAgICBvcGVyYXRvcjE6IDAsXHJcbiAgICAgICAgICAgICAgICB2YWx1ZTE6ICcnLFxyXG4gICAgICAgICAgICAgICAgcmVsYXRpb246ICcnLFxyXG4gICAgICAgICAgICAgICAgb3BlcmF0b3IyOiAwLFxyXG4gICAgICAgICAgICAgICAgdmFsdWUyOiAnJ1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAvLyB0aGlzLmluaXRPcGVyYXRvcnModGhpcy5maWx0ZXJQYW5lbFJlZi5pbnN0YW5jZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmZpbHRlclBhbmVsU3Vic2NyaXB0aW9uID0gdGhpcy5maWx0ZXJQYW5lbFJlZi5pbnN0YW5jZS5jb25kaXRpb25DaGFuZ2Uuc3Vic2NyaWJlKChjb25kaXRpb246IEZpbHRlckNvbmRpdGlvbikgPT4ge1xyXG4gICAgICAgICAgICBpZiAoY29uZGl0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRmcnMudXBkYXRlQ29sdW1uQ29uZGl0aW9ucyh0aGlzLmNvbHVtbi5maWVsZCwgY29uZGl0aW9uICk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZpbHRlclN0ciA9IHRoaXMuZGZycy5jb25kaXRpb24yc3RyaW5nKHRoaXMuY29sdW1uLCBjb25kaXRpb24pO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY29sdW1uLmZpbHRlci50eXBlIDwgMikge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGlzYWJsZWQgPSAhIXRoaXMuZmlsdGVyU3RyO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsZWFyVmFsdWUoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGZycy51cGRhdGVDb2x1bW5Db25kaXRpb25zKHRoaXMuY29sdW1uLmZpZWxkLCBGaWx0ZXJDb25kaXRpb25WYWx1ZS5BbGwpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5maWx0ZXJQYW5lbFJlZi5sb2NhdGlvbi5uYXRpdmVFbGVtZW50KTtcclxuXHJcbiAgICAgICAgdGhpcy51cGRhdGVGaWx0ZXJQYW5lbFBvc2l0aW9uKGV2ZW50LnRhcmdldCk7XHJcbiAgICAgICAgdGhpcy5kZnJzLnNldEZpbHRlclBhbmVsKHRoaXMuZmlsdGVyUGFuZWxSZWYpO1xyXG4gICAgICAgIGNvbnN0IGRnV2lkdGggPSBkZ0NvbnRhaW5lckVsZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aDtcclxuICAgICAgICB0aGlzLnpvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnJvID0gbmV3IFJlc2l6ZU9ic2VydmVyKChlbnRyaWVzLCBvYnNlcnZlcikgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKGVudHJpZXNbMF0udGFyZ2V0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoICE9PSBkZ1dpZHRoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdGhpcy5yby5vYnNlcnZlKGRnQ29udGFpbmVyRWxlKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGhpcy5maWx0ZXJQYW5lbFJlZi5pbnN0YW5jZS50YXJnZXQgPSBldmVudDtcclxuICAgICAgICB0aGlzLmZpbHRlclBhbmVsUmVmLmNoYW5nZURldGVjdG9yUmVmLm1hcmtGb3JDaGVjaygpO1xyXG4gICAgICAgIHRoaXMuZmlsdGVyUGFuZWxSZWYuY2hhbmdlRGV0ZWN0b3JSZWYuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgfVxyXG5cclxuICAgIGNsb3NlKCkge1xyXG4gICAgICAgIHRoaXMuZGZycy5jbG9zZUZpbHRlclBhbmVsKCk7XHJcbiAgICAgICAgaWYgKHRoaXMuZmlsdGVyUGFuZWxTdWJzY3JpcHRpb24pIHtcclxuICAgICAgICAgICAgdGhpcy5maWx0ZXJQYW5lbFN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICB0aGlzLmZpbHRlclBhbmVsU3Vic2NyaXB0aW9uID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBpbml0T3BlcmF0b3JzKGluczogRmlsdGVyUm93UGFuZWxDb21wb25lbnQpIHtcclxuICAgICAgICBpZiAodGhpcy5jb2x1bW4uZmlsdGVyLnR5cGUgPT09IENvbHVtbkZpbHRlclR5cGUuc3RyaW5nKSB7XHJcbiAgICAgICAgICAgIGlucy5vcGVyYXRvcnMgPSBUZXh0RmlsdGVyT3BlcmF0b3JzO1xyXG4gICAgICAgICAgICBpbnMuY29uZGl0aW9uLm9wZXJhdG9yMSA9IEZpbHRlck9wZXJhdG9yLkNvbnRhaW5zO1xyXG4gICAgICAgICAgICBpbnMuY29uZGl0aW9uLm9wZXJhdG9yMiA9IEZpbHRlck9wZXJhdG9yLkNvbnRhaW5zO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5jb2x1bW4uZmlsdGVyLnR5cGUgPT09IENvbHVtbkZpbHRlclR5cGUubnVtYmVyIHx8IHRoaXMuY29sdW1uLmZpbHRlci50eXBlID09PSBDb2x1bW5GaWx0ZXJUeXBlLmRhdGV0aW1lXHJcbiAgICAgICAgICAgIHx8IHRoaXMuY29sdW1uLmZpbHRlci50eXBlID09PSBDb2x1bW5GaWx0ZXJUeXBlLmRhdGUgfHwgdGhpcy5jb2x1bW4uZmlsdGVyLnR5cGUgPT09IENvbHVtbkZpbHRlclR5cGUudGltZSkge1xyXG4gICAgICAgICAgICBpbnMub3BlcmF0b3JzID0gTnVtYmVyT3JEYXRlRmlsdGVyT3BlcmF0b3JzO1xyXG4gICAgICAgICAgICBpbnMuY29uZGl0aW9uLm9wZXJhdG9yMSA9IEZpbHRlck9wZXJhdG9yLkVxdWFsO1xyXG4gICAgICAgICAgICBpbnMuY29uZGl0aW9uLm9wZXJhdG9yMiA9IEZpbHRlck9wZXJhdG9yLkVxdWFsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGlucy5vcGVyYXRvcnMpIHtcclxuICAgICAgICAgICAgaW5zLm9wZXJhdG9ycy5mb3JFYWNoKG8gPT4ge1xyXG4gICAgICAgICAgICAgICAgby5sYWJlbCA9IHRoaXMuZGZycy5nZXRPcGVyYXRvckxhYmVsKG8uY29kZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHVwZGF0ZUZpbHRlclBhbmVsUG9zaXRpb24odGFyZ2V0KSB7XHJcbiAgICAgICAgaWYgKHRhcmdldCkge1xyXG4gICAgICAgICAgICBjb25zdCBmaWx0ZXJJY29uUGFyZW50ID0gdGFyZ2V0LnBhcmVudEVsZW1lbnQ7XHJcbiAgICAgICAgICAgIGlmIChmaWx0ZXJJY29uUGFyZW50KSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBwb3MgPSBmaWx0ZXJJY29uUGFyZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdHIgPSB0YXJnZXQuY2xvc2VzdCgndHInKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHRkID0gdGFyZ2V0LmNsb3Nlc3QoJ3RkJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgaGVhZGVyUG9zID0gdGFyZ2V0LmNsb3Nlc3QoJy5mLWRhdGFncmlkLWhlYWRlcicpLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcGFuZWxXaWR0aCA9IHRoaXMuZmlsdGVyUGFuZWxSZWYuaW5zdGFuY2Uud2lkdGg7XHJcbiAgICAgICAgICAgICAgICBsZXQgbGVmdCA9IHBvcy5sZWZ0O1xyXG4gICAgICAgICAgICAgICAgaWYgKGhlYWRlclBvcy53aWR0aCArIGhlYWRlclBvcy54IDwgcG9zLnggKyBwYW5lbFdpZHRoICkgeyAvLyB0aGlzLmNvbHVtbi5maWx0ZXIudHlwZSA9PT0gQ29sdW1uRmlsdGVyVHlwZS5lbnVtXHJcbiAgICAgICAgICAgICAgICAgICAgbGVmdCA9IHRkLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmxlZnQgKyB0ZC5vZmZzZXRXaWR0aCAtIHBhbmVsV2lkdGg7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5maWx0ZXJQYW5lbFJlZi5sb2NhdGlvbi5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wYW5lbC1pY29uJykuc3R5bGUubGVmdCA9IGAke3BhbmVsV2lkdGggLSA0MH1weGA7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyBjb25zdCB0b3AgPSBwb3MudG9wXHJcbiAgICAgICAgICAgICAgICBjb25zdCBwYW5lbCA9IHRoaXMuZmlsdGVyUGFuZWxSZWYubG9jYXRpb24ubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCdkaXYnKTtcclxuICAgICAgICAgICAgICAgIGlmIChwYW5lbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyLnNldFN0eWxlKHBhbmVsLCAndG9wJywgYCR7cG9zLnRvcH1weGApO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyLnNldFN0eWxlKHBhbmVsLCAnbGVmdCcsIGAke2xlZnR9cHhgKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBvblRleHRWYWx1ZUNoYW5nZSgkZXZlbnQpIHtcclxuICAgICAgICBjb25zdCB2YWx1ZSA9ICRldmVudC50YXJnZXQudmFsdWU7XHJcbiAgICAgICAgdGhpcy5kZnJzLmZpbHRlclRleHRib3hDaGFuZ2VkLmVtaXQoeyBbdGhpcy5jb2x1bW4uZmllbGRdOiB2YWx1ZSB9KTtcclxuICAgIH1cclxuXHJcbiAgICBjbGVhclZhbHVlKCkge1xyXG4gICAgICAgIHRoaXMuZmlsdGVyU3RyID0gJyc7XHJcbiAgICAgICAgaWYgKHRoaXMuaW5wdXQpIHtcclxuICAgICAgICAgICAgdGhpcy5pbnB1dC5uYXRpdmVFbGVtZW50LnZhbHVlID0gJyc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmNvbHVtbi5maWx0ZXIudHlwZSA8IDIpIHtcclxuICAgICAgICAgICAgdGhpcy5kaXNhYmxlZCA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcclxuICAgIH1cclxuXHJcbiAgICBpbml0RmlsdGVyKGNvbmRpdGlvbjogYW55KSB7XHJcbiAgICAgICAgdGhpcy5maWx0ZXJTdHIgPSB0aGlzLmRmcnMuY29uZGl0aW9uMnN0cmluZyh0aGlzLmNvbHVtbiwgY29uZGl0aW9uKTtcclxuICAgICAgICB0aGlzLmRpc2FibGVkID0gISF0aGlzLmZpbHRlclN0cjtcclxuICAgICAgICB0aGlzLmRmcnMuX3VwZGF0ZUNvbHVtbkNvbmRpdGlvbnModGhpcy5jb2x1bW4uZmllbGQsIGNvbmRpdGlvbik7XHJcbiAgICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICB9XHJcbn1cclxuIl19