import { Modification, ModifyType } from '../changeset/index';
import { Subject } from 'rxjs';
import { Entity, FieldMetadataUtil, EntityList } from '../entity/index';
// tslint:disable: no-bitwise
/**
 * 实体集合
 * @todo：应该用EntityList代替。
 */
class EntityCollection {
    /**
     * 构造函数
     */
    constructor(entityType) {
        this.innerEntitySet = new Set();
        this.innerEntityMap = new Map();
        this.collectionChanged = new Subject();
        this.changes = new Subject();
        this.entityType = entityType;
        this.primaryKey = FieldMetadataUtil.getPrimaryKey(this.entityType) || entityType.prototype.primaryKey;
    }
    /**
     * 实体数量
     */
    count() {
        return this.innerEntitySet.size;
    }
    get entityTypeName() {
        return this.entityType.name;
    }
    /**
     * 是否包含指定主键值的实体
     * @param id 主键值
     */
    has(id) {
        return this.innerEntityMap.has(id);
    }
    /**
     * 清空全部实体
     */
    clear() {
        this.innerEntityMap.clear();
        this.innerEntitySet.clear();
        this.notifyCollectionChanged(new Modification([], ModifyType.Load));
    }
    /**
     * 清空全部实体
     * @param isReset 是否为重置实体操作
     */
    reset(notify = true) {
        this.innerEntityMap.forEach(entity => {
            entity.unsubscribe.next();
            entity.unsubscribe.complete();
        });
        this.innerEntitySet.forEach(entity => {
            entity.unsubscribe.next();
            entity.unsubscribe.complete();
        });
        this.innerEntityMap.clear();
        this.innerEntitySet.clear();
        if (notify === true) {
            const modification = new Modification([], ModifyType.Load);
            modification.isReset = true;
            this.notifyCollectionChanged(modification);
        }
    }
    /**
     * 转换为实体数组
     */
    toArray() {
        return Array.from(this.innerEntitySet);
    }
    /**
     * 转换为JSON数组
     */
    toJSON() {
        const result = [];
        const entities = this.toArray();
        entities.forEach((entity) => {
            result.push(entity.toJSON());
        });
        return result;
    }
    /**
     * 批量加载实体
     */
    loadEntities(entities, entityCreate = false) {
        this.innerEntityMap.clear();
        this.innerEntitySet.clear();
        entities.forEach(entity => {
            this.innerEntitySet.add(entity);
            this.innerEntityMap.set(entity[this.primaryKey], entity);
            this.listenEntityChangeEvent(entity);
        });
        const modification = new Modification(entities, ModifyType.Load);
        modification.entityCreate = entityCreate;
        this.notifyCollectionChanged(modification);
    }
    /**
     * 追加实体
     * @param entity 要追加的实体
     * @param isCloned 实体是否是克隆的
     */
    addEntity(entity, isCloned = false) {
        this.verifyEntityToAdd(entity);
        this.innerEntitySet.add(entity);
        this.innerEntityMap.set(entity[this.primaryKey], entity);
        this.listenEntityChangeEvent(entity);
        const modifyType = isCloned ? ModifyType.Clone : ModifyType.Add;
        this.notifyCollectionChanged(new Modification([entity], modifyType));
    }
    /**
     * 在当前行前或后插入数据
     * @param entity 实体
     * @param position 位置
     */
    insertEntity(entity, position) {
        this.verifyEntityToAdd(entity);
        this.innerEntitySet.add(entity);
        this.innerEntityMap.set(entity[this.primaryKey], entity);
        this.listenEntityChangeEvent(entity);
        this.notifyCollectionChanged(new Modification(entity, ModifyType.Insert, null, null, position));
    }
    /**
     * 更新实体
     * @param entity entity
     * @param data 实体数据
     */
    updateEntity(entity, data) {
        entity.load(data);
        this.notifyCollectionChanged(new Modification(data, ModifyType.Update, null, null));
    }
    /**
     * 批量追加实体
     * @param entities 要加载的实体数组
     */
    addEntities(entities) {
        if (!entities) {
            return;
        }
        const entitiesToAdd = [];
        entities.forEach(entity => {
            this.verifyEntityToAdd(entity);
            entitiesToAdd.push(entity);
        });
        entitiesToAdd.forEach(entity => {
            this.innerEntitySet.add(entity);
            this.innerEntityMap.set(entity[this.primaryKey], entity);
            this.listenEntityChangeEvent(entity);
        });
        this.notifyCollectionChanged(new Modification(entitiesToAdd, ModifyType.Add));
    }
    /**
     * 添加实体（不切换当前行）
     * @param entities 实体
     */
    addData(entities) {
        if (!entities) {
            return;
        }
        const entitiesToAdd = [];
        entities.forEach(entity => {
            this.verifyEntityToAdd(entity);
            entitiesToAdd.push(entity);
        });
        entitiesToAdd.forEach(entity => {
            this.innerEntitySet.add(entity);
            this.innerEntityMap.set(entity[this.primaryKey], entity);
            this.listenEntityChangeEvent(entity);
        });
        this.notifyCollectionChanged(new Modification(entitiesToAdd, ModifyType.AddData));
    }
    /**
     * 根据主键值获取实体
     */
    getEntityById(identity) {
        if (this.innerEntityMap.has(identity) === false) {
            return null;
        }
        const entity = this.innerEntityMap.get(identity);
        return entity;
    }
    /**
     * 根据路径获取实体
     */
    getEntityByPath(pathArray) {
        const rootEntityId = pathArray[0].split(':')[1];
        let parentNode = this.getEntityById(rootEntityId);
        for (let i = 1; i < pathArray.length && parentNode; i = i + 1) {
            const currentPath = pathArray[i];
            if ((parentNode instanceof Entity) || (parentNode.typeName === 'ConcreteEntityPrototype')) {
                // @todo：强识了别冒号
                if (currentPath.indexOf(':') === -1) {
                    parentNode = parentNode[pathArray[i]];
                }
            }
            else {
                parentNode = parentNode.get(pathArray[i].split(':')[1]);
            }
        }
        return parentNode;
    }
    /**
     * id:1/a/id:2/c
     * @param pathArray 路径数组
     */
    getEntitiesByPath(pathArray) {
        const rootEntityId = pathArray[0].split(':')[1];
        let entity = this.getEntityById(rootEntityId);
        for (let i = 1; i < pathArray.length && entity; i += 2) {
            const path = pathArray[i];
            entity = entity[path];
            if (!(entity instanceof EntityList)) {
                throw new Error('路径格式错误');
            }
            if ((i + 1) < pathArray.length) {
                const id = pathArray[i + 1].split(':')[1];
                entity = entity.get(id);
            }
        }
        return entity;
    }
    /**
     * 返回符合指定条件的实体集合
     * @param predicate 条件谓词
     */
    getEntities(predicate) {
        const entities = Array.from(this.innerEntitySet);
        const matchedEntities = entities.filter(predicate);
        return matchedEntities;
    }
    /**
     * 获取全部实体
     */
    getAllEntities() {
        return Array.from(this.innerEntitySet);
    }
    /**
     * 根据主键值删除对应实体
     * @param identity 主键值
     */
    removeEntityById(identity) {
        this.verifyEntityToRemove(identity);
        const entityToRemove = this.innerEntityMap.get(identity);
        this.innerEntityMap.delete(identity);
        this.innerEntitySet.delete(entityToRemove);
        this.notifyCollectionChanged(new Modification([entityToRemove], ModifyType.Remove));
        return entityToRemove;
    }
    removeEntitiesByIds(id) {
    }
    /**
     * 删除符合条件的实体集合
     */
    removeEntities(predicate) {
        const entitiesToRemove = Array.from(this.innerEntitySet).filter(predicate);
        entitiesToRemove.forEach(entityToRemove => {
            this.innerEntityMap.delete(entityToRemove[this.primaryKey]);
            this.innerEntitySet.delete(entityToRemove);
        });
        this.notifyCollectionChanged(new Modification(entitiesToRemove, ModifyType.Remove));
        return entitiesToRemove;
    }
    /**
     * 移除数据（不切换当前行）
     * @param predicate 过滤函数
     */
    removeData(predicate) {
        const entitiesToRemove = Array.from(this.innerEntitySet).filter(predicate);
        entitiesToRemove.forEach(entityToRemove => {
            this.innerEntityMap.delete(entityToRemove[this.primaryKey]);
            this.innerEntitySet.delete(entityToRemove);
        });
        this.notifyCollectionChanged(new Modification(entitiesToRemove, ModifyType.RemoveData));
        return entitiesToRemove;
    }
    /**
     * 重置子表数据
     * @param paths 路径
     * 路径格式 ['id:provinceId','id:cityMDMs','zoneMDMs']
     * @description path参数格式
     * ```json
     * [
     * "id:b5ed23ca-88d9-4377-98ec-92f35c1325f1",
     * "cityMDMs",
     * "id:373706af-622f-4aea-a006-dddbffd7bda3",
     * "zoneMDMs"
     * ]
     * ```
     * @param entities 实体数组
     */
    resetEntities(paths, entities) {
        if (paths[0].indexOf(':') === -1) {
            throw new Error('路径格式错误');
        }
        // 获取主实体
        const id = paths[0].split(':')[1];
        let entity = this.innerEntityMap.get(id);
        let entityList = entity[paths[1]];
        if (!entity) {
            throw new Error(`找不到主键为${id}的实体`);
        }
        for (let index = 2; index < paths.length; index += 2) {
            const pathInfo = paths[index].split(':');
            const entityId = pathInfo[1];
            // 获取到当前层级的实体
            entity = entityList.get(entityId);
            if (!entity) {
                throw new Error(`找不到主键为${id}的实体`);
            }
            // 获取当前层级实体下的列表属性
            entityList = entity[paths[index + 1]];
        }
        entityList.clear();
        entityList.loadEntities(entities);
    }
    /**
     * 验证实体是否能够添加
     */
    verifyEntityToAdd(entity) {
        if (this.has(entity[this.primaryKey])) {
            throw new Error(`The repository already had an item with the save identity of '${entity[this.primaryKey]}'`);
        }
        return true;
    }
    /**
     * 验证实体是否能移除
     */
    verifyEntityToRemove(identity) {
        if (!this.has(identity)) {
            throw new Error(`The entity with identity of '${identity} dose not exsit.'`);
        }
        return true;
    }
    /**
     * 实体集合变更流
     */
    notifyCollectionChanged(modification) {
        this.collectionChanged.next(modification);
    }
    listenEntityChangeEvent(entity) {
        if (entity) {
            entity.onValueChanged.subscribe((change) => this.changes.next(change));
        }
    }
    //#region 分页
    /**
     * 设置分页大小
     */
    set pageSize(pageSize) {
        if (typeof (pageSize) !== 'number' || pageSize < 0) {
            throw new Error('Invalid parameter:pageSize');
        }
        const original = this.paginationInfo;
        // const entityPaginationInfo = Object.assign({}, original[this.entityTypeName], { pageSize });
        // this.paginationInfo = Object.assign({}, original, { [this.entityTypeName]: entityPaginationInfo });
        // this.notifyCollectionChanged(new Modification(this.paginationInfo[this.entityTypeName], ModifyType.PaginationInfoChange));
        this.paginationInfo = Object.assign({}, original, { pageSize });
        this.notifyCollectionChanged(new Modification(this.paginationInfo, ModifyType.PaginationInfoChange));
    }
    /**
     * 获取分页大小
     * @description 如果用户未指定分页大小则默认为0，即获取所有数据
     */
    get pageSize() {
        if (!!this.paginationInfo) {
            return this.paginationInfo.pageSize || 0;
        }
        return 0;
    }
    /**
     * 设置数据总条数
     */
    set totalCount(total) {
        if (typeof (total) !== 'number' || total < 0) {
            throw new Error('Invalid parameter:total');
        }
        const original = this.paginationInfo;
        // const entityPaginationInfo = Object.assign({}, original[this.entityTypeName], { total });
        // this.paginationInfo = Object.assign({}, original, { [this.entityTypeName]: entityPaginationInfo });
        this.paginationInfo = Object.assign({}, original, { total });
        this.notifyCollectionChanged(new Modification(this.paginationInfo, ModifyType.PaginationInfoChange));
    }
    /**
     * 获取数据总条数
     */
    get totalCount() {
        if (!!this.paginationInfo) {
            return this.paginationInfo.total || 0;
        }
        return 0;
    }
    /**
     * 设置当前页码
     */
    set pageIndex(pageIndex) {
        if (typeof (pageIndex) !== 'number' || pageIndex < 0) {
            throw new Error('Invalid parameter:pageIndex');
        }
        const original = this.paginationInfo;
        // const entityPaginationInfo = Object.assign({}, original[this.entityTypeName], { pageIndex });
        // this.paginationInfo = Object.assign({}, original, { [this.entityTypeName]: entityPaginationInfo });
        this.paginationInfo = Object.assign({}, original, { pageIndex });
        this.notifyCollectionChanged(new Modification(this.paginationInfo, ModifyType.PaginationInfoChange));
    }
    /**
     * 获取当前页码
     */
    get pageIndex() {
        if (!!this.paginationInfo) {
            return this.paginationInfo.pageIndex || 1;
        }
        return 1;
    }
    /**
     * 更新分页信息
     * @param path 绑定路径
     * @param pageInfo 分页信息
     */
    updatePaginationInfoByPath(path, pageInfo) {
        const original = this.paginationInfo;
        const { pageIndex, pageSize } = pageInfo;
        const total = pageInfo && (pageInfo.totalCount || pageInfo.total) || 0;
        const paginationInfo = Object.assign({}, original, { pageIndex, pageSize, total });
        this.setPaginationConfigByPath(path, paginationInfo);
    }
    /**
     * 根据路径获取分页大小
     * @param path 路径
     */
    getPaginationConfigByPath(path, defaultValue) {
        if (!path || path === '/') {
            return this.paginationInfo;
        }
        if (typeof path !== 'string') {
            throw new Error('路径必须为字符串！');
        }
        const paths = path.split('/').filter(item => !!item && item.trim().length > 0).map(item => item.trim());
        let config = this.paginationInfo;
        paths.forEach(item => {
            if (config && config.hasOwnProperty(item)) {
                config = config[item];
            }
            else {
                config = null;
            }
        });
        return !!config ? config : typeof defaultValue !== 'undefined' ? defaultValue : undefined;
    }
    /**
     * 设置分页信息
     * @param path 路径
     * @param value 值，其中总条数key为total
     */
    setPaginationConfigByPath(path, value) {
        const original = JSON.stringify(this.paginationInfo);
        if (!path || path === '/') {
            this.paginationInfo = value;
        }
        else {
            if (!Array.isArray(path)) {
                path = path.toString().match(/[^/[\]]+/g) || [];
            }
            path.slice(0, -1).reduce((prev, current, index) => Object(prev[current]) === prev[current]
                ? prev[current]
                : prev[current] = Math.abs(path[index + 1]) >> 0 === +path[index + 1]
                    ? []
                    : {}, this.paginationInfo)[path[path.length - 1]] = value;
        }
        if (JSON.stringify(this.paginationInfo) !== original) {
            this.notifyCollectionChanged(new Modification(this.paginationInfo, ModifyType.PaginationInfoChange));
        }
        return this.paginationInfo;
    }
}
export { EntityCollection };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW50aXR5X2NvbGxlY3Rpb24uanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2RldmtpdC8iLCJzb3VyY2VzIjpbImxpYi9yZXBvc2l0b3J5L2VudGl0eV9jb2xsZWN0aW9uLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQU9BLE9BQU8sRUFBRSxZQUFZLEVBQUUsVUFBVSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDOUQsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMvQixPQUFPLEVBQUUsTUFBTSxFQUFFLGlCQUFpQixFQUFFLFVBQVUsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ3hFLDZCQUE2QjtBQUM3Qjs7O0dBR0c7QUFDSCxNQUFNLGdCQUFnQjtJQWtDcEI7O09BRUc7SUFDSCxZQUFZLFVBQWU7UUFDekIsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLEdBQUcsRUFBSyxDQUFDO1FBQ25DLElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxHQUFHLEVBQWEsQ0FBQztRQUMzQyxJQUFJLENBQUMsaUJBQWlCLEdBQUcsSUFBSSxPQUFPLEVBQWdCLENBQUM7UUFDckQsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLE9BQU8sRUFBZ0IsQ0FBQztRQUMzQyxJQUFJLENBQUMsVUFBVSxHQUFHLFVBQVUsQ0FBQztRQUM3QixJQUFJLENBQUMsVUFBVSxHQUFHLGlCQUFpQixDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksVUFBVSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUM7SUFDeEcsQ0FBQztJQUVEOztPQUVHO0lBQ0ksS0FBSztRQUNWLE9BQU8sSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUM7SUFDbEMsQ0FBQztJQUVELElBQVcsY0FBYztRQUN2QixPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDO0lBQzlCLENBQUM7SUFDRDs7O09BR0c7SUFDSSxHQUFHLENBQUMsRUFBVTtRQUNuQixPQUFP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QyxLQUFLLFFBQVEsRUFBRTtZQUNwRCxJQUFJLENBQUMsdUJBQXVCLENBQUMsSUFBSSxZQUFZLENBQUMsSUFBSSxDQUFDLGNBQWMsRUFBRSxVQUFVLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxDQUFDO1NBQ3RHO1FBQ0QsT0FBTyxJQUFJLENBQUMsY0FBYyxDQUFDO0lBQzdCLENBQUM7Q0FFRjtBQUVELE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLypcclxuICogQEF1dGhvcjogV2l0dFxyXG4gKiBARGF0ZTogMjAxOC0xMC0wMSAxOTozNjo1MVxyXG4gKiBATGFzdCBNb2RpZmllZCBieTogYWFsaXp6d2VsbFxyXG4gKiBATGFzdCBNb2RpZmllZCB0aW1lOiAyMDE5LTA5LTAzIDE5OjQ2OjQyXHJcbiAqL1xyXG5pbXBvcnQgeyBUeXBlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IE1vZGlmaWNhdGlvbiwgTW9kaWZ5VHlwZSB9IGZyb20gJy4uL2NoYW5nZXNldC9pbmRleCc7XHJcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgRW50aXR5LCBGaWVsZE1ldGFkYXRhVXRpbCwgRW50aXR5TGlzdCB9IGZyb20gJy4uL2VudGl0eS9pbmRleCc7XHJcbi8vIHRzbGludDpkaXNhYmxlOiBuby1iaXR3aXNlXHJcbi8qKlxyXG4gKiDlrp7kvZPpm4blkIhcclxuICogQHRvZG/vvJrlupTor6XnlKhFbnRpdHlMaXN05Luj5pu/44CCXHJcbiAqL1xyXG5jbGFzcyBFbnRpdHlDb2xsZWN0aW9uPFQgZXh0ZW5kcyBFbnRpdHk+IHtcclxuXHJcbiAgLyoqXHJcbiAgICog5YaF6YOo5a6e5L2TU2V0XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBpbm5lckVudGl0eVNldDogU2V0PFQ+O1xyXG5cclxuICAvKipcclxuICAgKiDlhoXpg6jlrp7kvZNNYXBcclxuICAgKi9cclxuICBwcml2YXRlIGlubmVyRW50aXR5TWFwOiBNYXA8c3RyaW5nLCBUPjtcclxuICBwdWJsaWMgY2hhbmdlczogU3ViamVjdDxNb2RpZmljYXRpb24+O1xyXG5cclxuICAvKipcclxuICAgKiBFbnRpdHnpm4blkIjlj5jmm7TmtYFcclxuICAgKi9cclxuICBwdWJsaWMgY29sbGVjdGlvbkNoYW5nZWQ6IFN1YmplY3Q8TW9kaWZpY2F0aW9uPjtcclxuXHJcbiAgLyoqXHJcbiAgICog5a6e5L2T57G75Z6LXHJcbiAgICovXHJcbiAgcHVibGljIHJlYWRvbmx5IGVudGl0eVR5cGU6IFR5cGU8VD47XHJcblxyXG4gIC8qKlxyXG4gICAqIOWunuS9k+S4u+mUrlxyXG4gICAqL1xyXG4gIHB1YmxpYyByZWFkb25seSBwcmltYXJ5S2V5OiBzdHJpbmc7XHJcblxyXG4gIC8qKlxyXG4gICAqIOWunuS9k+W9k+WJjeWIhumhteS/oeaBr1xyXG4gICAqL1xyXG4gIHB1YmxpYyBwYWdpbmF0aW9uSW5mbzogYW55O1xyXG5cclxuXHJcbiAgLyoqXHJcbiAgICog5p6E6YCg5Ye95pWwXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoZW50aXR5VHlwZTogYW55KSB7XHJcbiAgICB0aGlzLmlubmVyRW50aXR5U2V0ID0gbmV3IFNldDxUPigpO1xyXG4gICAgdGhpcy5pbm5lckVudGl0eU1hcCA9IG5ldyBNYXA8c3RyaW5nLCBUPigpO1xyXG4gICAgdGhpcy5jb2xsZWN0aW9uQ2hhbmdlZCA9IG5ldyBTdWJqZWN0PE1vZGlmaWNhdGlvbj4oKTtcclxuICAgIHRoaXMuY2hhbmdlcyA9IG5ldyBTdWJqZWN0PE1vZGlmaWNhdGlvbj4oKTtcclxuICAgIHRoaXMuZW50aXR5VHlwZSA9IGVudGl0eVR5cGU7XHJcbiAgICB0aGlzLnByaW1hcnlLZXkgPSBGaWVsZE1ldGFkYXRhVXRpbC5nZXRQcmltYXJ5S2V5KHRoaXMuZW50aXR5VHlwZSkgfHwgZW50aXR5VHlwZS5wcm90b3R5cGUucHJpbWFyeUtleTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWunuS9k+aVsOmHj1xyXG4gICAqL1xyXG4gIHB1YmxpYyBjb3VudCgpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIHRoaXMuaW5uZXJFbnRpdHlTZXQuc2l6ZTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXQgZW50aXR5VHlwZU5hbWUoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5lbnRpdHlUeXBlLm5hbWU7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOaYr+WQpuWMheWQq+aMh+WumuS4u+mUruWAvOeahOWunuS9k1xyXG4gICAqIEBwYXJhbSBpZCDkuLvplK7lgLxcclxuICAgKi9cclxuICBwdWJsaWMgaGFzKGlkOiBzdHJpbmcpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLmlubmVyRW50aXR5TWFwLmhhcyhpZCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmuIXnqbrlhajpg6jlrp7kvZNcclxuICAgKi9cclxuICBwdWJsaWMgY2xlYXIoKSB7XHJcbiAgICB0aGlzLmlubmVyRW50aXR5TWFwLmNsZWFyKCk7XHJcbiAgICB0aGlzLmlubmVyRW50aXR5U2V0LmNsZWFyKCk7XHJcbiAgICB0aGlzLm5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkKG5ldyBNb2RpZmljYXRpb24oW10sIE1vZGlmeVR5cGUuTG9hZCkpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmuIXnqbrlhajpg6jlrp7kvZNcclxuICAgKiBAcGFyYW0gaXNSZXNldCDmmK/lkKbkuLrph43nva7lrp7kvZPmk43kvZxcclxuICAgKi9cclxuICBwdWJsaWMgcmVzZXQobm90aWZ5OiBib29sZWFuID0gdHJ1ZSkge1xyXG4gICAgdGhpcy5pbm5lckVudGl0eU1hcC5mb3JFYWNoKGVudGl0eSA9PiB7XHJcbiAgICAgIGVudGl0eS51bnN1YnNjcmliZS5uZXh0KCk7XHJcbiAgICAgIGVudGl0eS51bnN1YnNjcmliZS5jb21wbGV0ZSgpO1xyXG4gICAgfSk7XHJcbiAgICB0aGlzLmlubmVyRW50aXR5U2V0LmZvckVhY2goZW50aXR5ID0+IHtcclxuICAgICAgZW50aXR5LnVuc3Vic2NyaWJlLm5leHQoKTtcclxuICAgICAgZW50aXR5LnVuc3Vic2NyaWJlLmNvbXBsZXRlKCk7XHJcbiAgICB9KTtcclxuICAgIHRoaXMuaW5uZXJFbnRpdHlNYXAuY2xlYXIoKTtcclxuICAgIHRoaXMuaW5uZXJFbnRpdHlTZXQuY2xlYXIoKTtcclxuICAgIGlmIChub3RpZnkgPT09IHRydWUpIHtcclxuICAgICAgY29uc3QgbW9kaWZpY2F0aW9uID0gbmV3IE1vZGlmaWNhdGlvbihbXSwgTW9kaWZ5VHlwZS5Mb2FkKTtcclxuICAgICAgbW9kaWZpY2F0aW9uLmlzUmVzZXQgPSB0cnVlO1xyXG4gICAgICB0aGlzLm5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkKG1vZGlmaWNhdGlvbik7XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOi9rOaNouS4uuWunuS9k+aVsOe7hFxyXG4gICAqL1xyXG4gIHB1YmxpYyB0b0FycmF5KCk6IEVudGl0eVtdIHtcclxuICAgIHJldHVybiBBcnJheS5mcm9tKHRoaXMuaW5uZXJFbnRpdHlTZXQpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6L2s5o2i5Li6SlNPTuaVsOe7hFxyXG4gICAqL1xyXG4gIHB1YmxpYyB0b0pTT04oKTogYW55W10ge1xyXG4gICAgY29uc3QgcmVzdWx0ID0gW107XHJcbiAgICBjb25zdCBlbnRpdGllcyA9IHRoaXMudG9BcnJheSgpO1xyXG4gICAgZW50aXRpZXMuZm9yRWFjaCgoZW50aXR5OiBFbnRpdHkpID0+IHtcclxuICAgICAgcmVzdWx0LnB1c2goZW50aXR5LnRvSlNPTigpKTtcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaJuemHj+WKoOi9veWunuS9k1xyXG4gICAqL1xyXG4gIHB1YmxpYyBsb2FkRW50aXRpZXMoZW50aXRpZXM6IGFueVtdLCBlbnRpdHlDcmVhdGU6IGJvb2xlYW4gPSBmYWxzZSkge1xyXG4gICAgdGhpcy5pbm5lckVudGl0eU1hcC5jbGVhcigpO1xyXG4gICAgdGhpcy5pbm5lckVudGl0eVNldC5jbGVhcigpO1xyXG5cclxuICAgIGVudGl0aWVzLmZvckVhY2goZW50aXR5ID0+IHtcclxuICAgICAgdGhpcy5pbm5lckVudGl0eVNldC5hZGQoZW50aXR5KTtcclxuICAgICAgdGhpcy5pbm5lckVudGl0eU1hcC5zZXQoZW50aXR5W3RoaXMucHJpbWFyeUtleV0sIGVudGl0eSk7XHJcbiAgICAgIHRoaXMubGlzdGVuRW50aXR5Q2hhbmdlRXZlbnQoZW50aXR5KTtcclxuICAgIH0pO1xyXG4gICAgY29uc3QgbW9kaWZpY2F0aW9uID0gbmV3IE1vZGlmaWNhdGlvbihlbnRpdGllcywgTW9kaWZ5VHlwZS5Mb2FkKTtcclxuICAgIG1vZGlmaWNhdGlvbi5lbnRpdHlDcmVhdGUgPSBlbnRpdHlDcmVhdGU7XHJcbiAgICB0aGlzLm5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkKG1vZGlmaWNhdGlvbik7XHJcblxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6L+95Yqg5a6e5L2TXHJcbiAgICogQHBhcmFtIGVudGl0eSDopoHov73liqDnmoTlrp7kvZNcclxuICAgKiBAcGFyYW0gaXNDbG9uZWQg5a6e5L2T5piv5ZCm5piv5YWL6ZqG55qEXHJcbiAgICovXHJcbiAgcHVibGljIGFkZEVudGl0eShlbnRpdHk6IGFueSwgaXNDbG9uZWQ6IGJvb2xlYW4gPSBmYWxzZSkge1xyXG4gICAgdGhpcy52ZXJpZnlFbnRpdHlUb0FkZChlbnRpdHkpO1xyXG4gICAgdGhpcy5pbm5lckVudGl0eVNldC5hZGQoZW50aXR5KTtcclxuICAgIHRoaXMuaW5uZXJFbnRpdHlNYXAuc2V0KGVudGl0eVt0aGlzLnByaW1hcnlLZXldLCBlbnRpdHkpO1xyXG4gICAgdGhpcy5saXN0ZW5FbnRpdHlDaGFuZ2VFdmVudChlbnRpdHkpO1xyXG4gICAgY29uc3QgbW9kaWZ5VHlwZSA9IGlzQ2xvbmVkID8gTW9kaWZ5VHlwZS5DbG9uZSA6IE1vZGlmeVR5cGUuQWRkO1xyXG4gICAgdGhpcy5ub3RpZnlDb2xsZWN0aW9uQ2hhbmdlZChuZXcgTW9kaWZpY2F0aW9uKFtlbnRpdHldLCBtb2RpZnlUeXBlKSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWcqOW9k+WJjeihjOWJjeaIluWQjuaPkuWFpeaVsOaNrlxyXG4gICAqIEBwYXJhbSBlbnRpdHkg5a6e5L2TXHJcbiAgICogQHBhcmFtIHBvc2l0aW9uIOS9jee9rlxyXG4gICAqL1xyXG4gIHB1YmxpYyBpbnNlcnRFbnRpdHkoZW50aXR5OiBhbnksIHBvc2l0aW9uOiAxIHwgLTEpIHtcclxuICAgIHRoaXMudmVyaWZ5RW50aXR5VG9BZGQoZW50aXR5KTtcclxuICAgIHRoaXMuaW5uZXJFbnRpdHlTZXQuYWRkKGVudGl0eSk7XHJcbiAgICB0aGlzLmlubmVyRW50aXR5TWFwLnNldChlbnRpdHlbdGhpcy5wcmltYXJ5S2V5XSwgZW50aXR5KTtcclxuICAgIHRoaXMubGlzdGVuRW50aXR5Q2hhbmdlRXZlbnQoZW50aXR5KTtcclxuICAgIHRoaXMubm90aWZ5Q29sbGVjdGlvbkNoYW5nZWQobmV3IE1vZGlmaWNhdGlvbihlbnRpdHksIE1vZGlmeVR5cGUuSW5zZXJ0LCBudWxsLCBudWxsLCBwb3NpdGlvbikpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmm7TmlrDlrp7kvZNcclxuICAgKiBAcGFyYW0gZW50aXR5IGVudGl0eVxyXG4gICAqIEBwYXJhbSBkYXRhIOWunuS9k+aVsOaNrlxyXG4gICAqL1xyXG4gIHB1YmxpYyB1cGRhdGVFbnRpdHkoZW50aXR5OiBhbnksIGRhdGE6IGFueSkge1xyXG4gICAgZW50aXR5LmxvYWQoZGF0YSk7XHJcbiAgICB0aGlzLm5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkKG5ldyBNb2RpZmljYXRpb24oZGF0YSwgTW9kaWZ5VHlwZS5VcGRhdGUsIG51bGwsIG51bGwpKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5om56YeP6L+95Yqg5a6e5L2TXHJcbiAgICogQHBhcmFtIGVudGl0aWVzIOimgeWKoOi9veeahOWunuS9k+aVsOe7hFxyXG4gICAqL1xyXG4gIHB1YmxpYyBhZGRFbnRpdGllcyhlbnRpdGllczogYW55W10pIHtcclxuICAgIGlmICghZW50aXRpZXMpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgY29uc3QgZW50aXRpZXNUb0FkZDogYW55W10gPSBbXTtcclxuICAgIGVudGl0aWVzLmZvckVhY2goZW50aXR5ID0+IHtcclxuICAgICAgdGhpcy52ZXJpZnlFbnRpdHlUb0FkZChlbnRpdHkpO1xyXG4gICAgICBlbnRpdGllc1RvQWRkLnB1c2goZW50aXR5KTtcclxuICAgIH0pO1xyXG4gICAgZW50aXRpZXNUb0FkZC5mb3JFYWNoKGVudGl0eSA9PiB7XHJcbiAgICAgIHRoaXMuaW5uZXJFbnRpdHlTZXQuYWRkKGVudGl0eSk7XHJcbiAgICAgIHRoaXMuaW5uZXJFbnRpdHlNYXAuc2V0KGVudGl0eVt0aGlzLnByaW1hcnlLZXldLCBlbnRpdHkpO1xyXG4gICAgICB0aGlzLmxpc3RlbkVudGl0eUNoYW5nZUV2ZW50KGVudGl0eSk7XHJcbiAgICB9KTtcclxuICAgIHRoaXMubm90aWZ5Q29sbGVjdGlvbkNoYW5nZWQobmV3IE1vZGlmaWNhdGlvbihlbnRpdGllc1RvQWRkLCBNb2RpZnlUeXBlLkFkZCkpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmt7vliqDlrp7kvZPvvIjkuI3liIfmjaLlvZPliY3ooYzvvIlcclxuICAgKiBAcGFyYW0gZW50aXRpZXMg5a6e5L2TXHJcbiAgICovXHJcbiAgcHVibGljIGFkZERhdGEoZW50aXRpZXM6IGFueVtdKSB7XHJcbiAgICBpZiAoIWVudGl0aWVzKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGNvbnN0IGVudGl0aWVzVG9BZGQ6IGFueVtdID0gW107XHJcbiAgICBlbnRpdGllcy5mb3JFYWNoKGVudGl0eSA9PiB7XHJcbiAgICAgIHRoaXMudmVyaWZ5RW50aXR5VG9BZGQoZW50aXR5KTtcclxuICAgICAgZW50aXRpZXNUb0FkZC5wdXNoKGVudGl0eSk7XHJcbiAgICB9KTtcclxuICAgIGVudGl0aWVzVG9BZGQuZm9yRWFjaChlbnRpdHkgPT4ge1xyXG4gICAgICB0aGlzLmlubmVyRW50aXR5U2V0LmFkZChlbnRpdHkpO1xyXG4gICAgICB0aGlzLmlubmVyRW50aXR5TWFwLnNldChlbnRpdHlbdGhpcy5wcmltYXJ5S2V5XSwgZW50aXR5KTtcclxuICAgICAgdGhpcy5saXN0ZW5FbnRpdHlDaGFuZ2VFdmVudChlbnRpdHkpO1xyXG4gICAgfSk7XHJcbiAgICB0aGlzLm5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkKG5ldyBNb2RpZmljYXRpb24oZW50aXRpZXNUb0FkZCwgTW9kaWZ5VHlwZS5BZGREYXRhKSk7XHJcbiAgfVxyXG5cclxuXHJcbiAgLyoqXHJcbiAgICog5qC55o2u5Li76ZSu5YC86I635Y+W5a6e5L2TXHJcbiAgICovXHJcbiAgZ2V0RW50aXR5QnlJZChpZGVudGl0eTogc3RyaW5nKTogYW55IHtcclxuICAgIGlmICh0aGlzLmlubmVyRW50aXR5TWFwLmhhcyhpZGVudGl0eSkgPT09IGZhbHNlKSB7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG4gICAgY29uc3QgZW50aXR5ID0gdGhpcy5pbm5lckVudGl0eU1hcC5nZXQoaWRlbnRpdHkpO1xyXG4gICAgcmV0dXJuIGVudGl0eTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOagueaNrui3r+W+hOiOt+WPluWunuS9k1xyXG4gICAqL1xyXG4gIGdldEVudGl0eUJ5UGF0aChwYXRoQXJyYXk6IHN0cmluZ1tdKTogYW55IHtcclxuICAgIGNvbnN0IHJvb3RFbnRpdHlJZCA9IHBhdGhBcnJheVswXS5zcGxpdCgnOicpWzFdO1xyXG4gICAgbGV0IHBhcmVudE5vZGU6IGFueSA9IHRoaXMuZ2V0RW50aXR5QnlJZChyb290RW50aXR5SWQpO1xyXG4gICAgZm9yIChsZXQgaSA9IDE7IGkgPCBwYXRoQXJyYXkubGVuZ3RoICYmIHBhcmVudE5vZGU7IGkgPSBpICsgMSkge1xyXG4gICAgICBjb25zdCBjdXJyZW50UGF0aCA9IHBhdGhBcnJheVtpXTtcclxuICAgICAgaWYgKChwYXJlbnROb2RlIGluc3RhbmNlb2YgRW50aXR5KSB8fCAoXHJcbiAgICAgICAgcGFyZW50Tm9kZS50eXBlTmFtZSA9PT0gJ0NvbmNyZXRlRW50aXR5UHJvdG90eXBlJylcclxuICAgICAgKSB7XHJcbiAgICAgICAgLy8gQHRvZG/vvJrlvLror4bkuobliKvlhpLlj7dcclxuICAgICAgICBpZiAoY3VycmVudFBhdGguaW5kZXhPZignOicpID09PSAtMSkge1xyXG4gICAgICAgICAgcGFyZW50Tm9kZSA9IHBhcmVudE5vZGVbcGF0aEFycmF5W2ldXTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcGFyZW50Tm9kZSA9IHBhcmVudE5vZGUuZ2V0KHBhdGhBcnJheVtpXS5zcGxpdCgnOicpWzFdKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHBhcmVudE5vZGU7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIGlkOjEvYS9pZDoyL2NcclxuICAgKiBAcGFyYW0gcGF0aEFycmF5IOi3r+W+hOaVsOe7hFxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRFbnRpdGllc0J5UGF0aChwYXRoQXJyYXk6IHN0cmluZ1tdKSB7XHJcbiAgICBjb25zdCByb290RW50aXR5SWQgPSBwYXRoQXJyYXlbMF0uc3BsaXQoJzonKVsxXTtcclxuICAgIGxldCBlbnRpdHk6IGFueSA9IHRoaXMuZ2V0RW50aXR5QnlJZChyb290RW50aXR5SWQpO1xyXG4gICAgZm9yIChsZXQgaSA9IDE7IGkgPCBwYXRoQXJyYXkubGVuZ3RoICYmIGVudGl0eTsgaSArPSAyKSB7XHJcbiAgICAgIGNvbnN0IHBhdGggPSBwYXRoQXJyYXlbaV07XHJcbiAgICAgIGVudGl0eSA9IGVudGl0eVtwYXRoXTtcclxuICAgICAgaWYgKCEoZW50aXR5IGluc3RhbmNlb2YgRW50aXR5TGlzdCkpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ+i3r+W+hOagvOW8j+mUmeivrycpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICgoaSArIDEpIDwgcGF0aEFycmF5Lmxlbmd0aCkge1xyXG4gICAgICAgIGNvbnN0IGlkID0gcGF0aEFycmF5W2kgKyAxXS5zcGxpdCgnOicpWzFdO1xyXG4gICAgICAgIGVudGl0eSA9IGVudGl0eS5nZXQoaWQpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZW50aXR5O1xyXG4gIH1cclxuICAvKipcclxuICAgKiDov5Tlm57nrKblkIjmjIflrprmnaHku7bnmoTlrp7kvZPpm4blkIhcclxuICAgKiBAcGFyYW0gcHJlZGljYXRlIOadoeS7tuiwk+ivjVxyXG4gICAqL1xyXG4gIGdldEVudGl0aWVzKHByZWRpY2F0ZTogKHZhbHVlOiBhbnksIGluZGV4OiBudW1iZXIsIGFycmF5OiBhbnlbXSkgPT4gYW55KTogYW55W10ge1xyXG4gICAgY29uc3QgZW50aXRpZXM6IGFueVtdID0gQXJyYXkuZnJvbSh0aGlzLmlubmVyRW50aXR5U2V0KTtcclxuICAgIGNvbnN0IG1hdGNoZWRFbnRpdGllcyA9IGVudGl0aWVzLmZpbHRlcihwcmVkaWNhdGUpO1xyXG4gICAgcmV0dXJuIG1hdGNoZWRFbnRpdGllcztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluWFqOmDqOWunuS9k1xyXG4gICAqL1xyXG4gIGdldEFsbEVudGl0aWVzKCk6IGFueVtdIHtcclxuICAgIHJldHVybiBBcnJheS5mcm9tKHRoaXMuaW5uZXJFbnRpdHlTZXQpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5qC55o2u5Li76ZSu5YC85Yig6Zmk5a+55bqU5a6e5L2TXHJcbiAgICogQHBhcmFtIGlkZW50aXR5IOS4u+mUruWAvFxyXG4gICAqL1xyXG4gIHJlbW92ZUVudGl0eUJ5SWQoaWRlbnRpdHk6IHN0cmluZyk6IGFueSB7XHJcbiAgICB0aGlzLnZlcmlmeUVudGl0eVRvUmVtb3ZlKGlkZW50aXR5KTtcclxuICAgIGNvbnN0IGVudGl0eVRvUmVtb3ZlID0gdGhpcy5pbm5lckVudGl0eU1hcC5nZXQoaWRlbnRpdHkpO1xyXG4gICAgdGhpcy5pbm5lckVudGl0eU1hcC5kZWxldGUoaWRlbnRpdHkpO1xyXG4gICAgdGhpcy5pbm5lckVudGl0eVNldC5kZWxldGUoZW50aXR5VG9SZW1vdmUpO1xyXG4gICAgdGhpcy5ub3RpZnlDb2xsZWN0aW9uQ2hhbmdlZChuZXcgTW9kaWZpY2F0aW9uKFtlbnRpdHlUb1JlbW92ZV0sIE1vZGlmeVR5cGUuUmVtb3ZlKSk7XHJcbiAgICByZXR1cm4gZW50aXR5VG9SZW1vdmU7XHJcbiAgfVxyXG5cclxuICByZW1vdmVFbnRpdGllc0J5SWRzKGlkOiBzdHJpbmcpIHtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWIoOmZpOespuWQiOadoeS7tueahOWunuS9k+mbhuWQiFxyXG4gICAqL1xyXG4gIHB1YmxpYyByZW1vdmVFbnRpdGllcyhwcmVkaWNhdGU6ICh2YWx1ZTogYW55LCBpbmRleDogbnVtYmVyLCBhcnJheTogYW55W10pID0+IGFueSk6IGFueVtdIHtcclxuICAgIGNvbnN0IGVudGl0aWVzVG9SZW1vdmUgPSBBcnJheS5mcm9tKHRoaXMuaW5uZXJFbnRpdHlTZXQpLmZpbHRlcihwcmVkaWNhdGUpO1xyXG4gICAgZW50aXRpZXNUb1JlbW92ZS5mb3JFYWNoKGVudGl0eVRvUmVtb3ZlID0+IHtcclxuICAgICAgdGhpcy5pbm5lckVudGl0eU1hcC5kZWxldGUoZW50aXR5VG9SZW1vdmVbdGhpcy5wcmltYXJ5S2V5XSk7XHJcbiAgICAgIHRoaXMuaW5uZXJFbnRpdHlTZXQuZGVsZXRlKGVudGl0eVRvUmVtb3ZlKTtcclxuICAgIH0pO1xyXG4gICAgdGhpcy5ub3RpZnlDb2xsZWN0aW9uQ2hhbmdlZChuZXcgTW9kaWZpY2F0aW9uKGVudGl0aWVzVG9SZW1vdmUsIE1vZGlmeVR5cGUuUmVtb3ZlKSk7XHJcbiAgICByZXR1cm4gZW50aXRpZXNUb1JlbW92ZTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog56e76Zmk5pWw5o2u77yI5LiN5YiH5o2i5b2T5YmN6KGM77yJXHJcbiAgICogQHBhcmFtIHByZWRpY2F0ZSDov4fmu6Tlh73mlbBcclxuICAgKi9cclxuICBwdWJsaWMgcmVtb3ZlRGF0YShwcmVkaWNhdGU6ICh2YWx1ZTogYW55LCBpbmRleDogbnVtYmVyLCBhcnJheTogYW55W10pID0+IGFueSk6IGFueVtdIHtcclxuICAgIGNvbnN0IGVudGl0aWVzVG9SZW1vdmUgPSBBcnJheS5mcm9tKHRoaXMuaW5uZXJFbnRpdHlTZXQpLmZpbHRlcihwcmVkaWNhdGUpO1xyXG4gICAgZW50aXRpZXNUb1JlbW92ZS5mb3JFYWNoKGVudGl0eVRvUmVtb3ZlID0+IHtcclxuICAgICAgdGhpcy5pbm5lckVudGl0eU1hcC5kZWxldGUoZW50aXR5VG9SZW1vdmVbdGhpcy5wcmltYXJ5S2V5XSk7XHJcbiAgICAgIHRoaXMuaW5uZXJFbnRpdHlTZXQuZGVsZXRlKGVudGl0eVRvUmVtb3ZlKTtcclxuICAgIH0pO1xyXG4gICAgdGhpcy5ub3RpZnlDb2xsZWN0aW9uQ2hhbmdlZChuZXcgTW9kaWZpY2F0aW9uKGVudGl0aWVzVG9SZW1vdmUsIE1vZGlmeVR5cGUuUmVtb3ZlRGF0YSkpO1xyXG4gICAgcmV0dXJuIGVudGl0aWVzVG9SZW1vdmU7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOmHjee9ruWtkOihqOaVsOaNrlxyXG4gICAqIEBwYXJhbSBwYXRocyDot6/lvoRcclxuICAgKiDot6/lvoTmoLzlvI8gWydpZDpwcm92aW5jZUlkJywnaWQ6Y2l0eU1ETXMnLCd6b25lTURNcyddXHJcbiAgICogQGRlc2NyaXB0aW9uIHBhdGjlj4LmlbDmoLzlvI9cclxuICAgKiBgYGBqc29uXHJcbiAgICogW1xyXG4gICAqIFwiaWQ6YjVlZDIzY2EtODhkOS00Mzc3LTk4ZWMtOTJmMzVjMTMyNWYxXCIsXHJcbiAgICogXCJjaXR5TURNc1wiLFxyXG4gICAqIFwiaWQ6MzczNzA2YWYtNjIyZi00YWVhLWEwMDYtZGRkYmZmZDdiZGEzXCIsXHJcbiAgICogXCJ6b25lTURNc1wiXHJcbiAgICogXVxyXG4gICAqIGBgYFxyXG4gICAqIEBwYXJhbSBlbnRpdGllcyDlrp7kvZPmlbDnu4RcclxuICAgKi9cclxuICBwdWJsaWMgcmVzZXRFbnRpdGllcyhwYXRoczogc3RyaW5nW10sIGVudGl0aWVzOiBhbnlbXSkge1xyXG4gICAgaWYgKHBhdGhzWzBdLmluZGV4T2YoJzonKSA9PT0gLTEpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCfot6/lvoTmoLzlvI/plJnor68nKTtcclxuICAgIH1cclxuICAgIC8vIOiOt+WPluS4u+WunuS9k1xyXG4gICAgY29uc3QgaWQgPSBwYXRoc1swXS5zcGxpdCgnOicpWzFdO1xyXG4gICAgbGV0IGVudGl0eTogYW55ID0gdGhpcy5pbm5lckVudGl0eU1hcC5nZXQoaWQpO1xyXG4gICAgbGV0IGVudGl0eUxpc3QgPSBlbnRpdHlbcGF0aHNbMV1dIGFzIEVudGl0eUxpc3Q8YW55PjtcclxuICAgIGlmICghZW50aXR5KSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihg5om+5LiN5Yiw5Li76ZSu5Li6JHtpZH3nmoTlrp7kvZNgKTtcclxuICAgIH1cclxuICAgIGZvciAobGV0IGluZGV4ID0gMjsgaW5kZXggPCBwYXRocy5sZW5ndGg7IGluZGV4ICs9IDIpIHtcclxuICAgICAgY29uc3QgcGF0aEluZm8gPSBwYXRoc1tpbmRleF0uc3BsaXQoJzonKTtcclxuICAgICAgY29uc3QgZW50aXR5SWQgPSBwYXRoSW5mb1sxXTtcclxuICAgICAgLy8g6I635Y+W5Yiw5b2T5YmN5bGC57qn55qE5a6e5L2TXHJcbiAgICAgIGVudGl0eSA9IGVudGl0eUxpc3QuZ2V0KGVudGl0eUlkKTtcclxuICAgICAgaWYgKCFlbnRpdHkpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYOaJvuS4jeWIsOS4u+mUruS4uiR7aWR955qE5a6e5L2TYCk7XHJcbiAgICAgIH1cclxuICAgICAgLy8g6I635Y+W5b2T5YmN5bGC57qn5a6e5L2T5LiL55qE5YiX6KGo5bGe5oCnXHJcbiAgICAgIGVudGl0eUxpc3QgPSBlbnRpdHlbcGF0aHNbaW5kZXggKyAxXV07XHJcbiAgICB9XHJcbiAgICBlbnRpdHlMaXN0LmNsZWFyKCk7XHJcbiAgICBlbnRpdHlMaXN0LmxvYWRFbnRpdGllcyhlbnRpdGllcyk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDpqozor4Hlrp7kvZPmmK/lkKbog73lpJ/mt7vliqBcclxuICAgKi9cclxuICBwcml2YXRlIHZlcmlmeUVudGl0eVRvQWRkKGVudGl0eTogYW55KTogYm9vbGVhbiB7XHJcbiAgICBpZiAodGhpcy5oYXMoZW50aXR5W3RoaXMucHJpbWFyeUtleV0pKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlIHJlcG9zaXRvcnkgYWxyZWFkeSBoYWQgYW4gaXRlbSB3aXRoIHRoZSBzYXZlIGlkZW50aXR5IG9mICcke2VudGl0eVt0aGlzLnByaW1hcnlLZXldfSdgKTtcclxuICAgIH1cclxuICAgIHJldHVybiB0cnVlO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6aqM6K+B5a6e5L2T5piv5ZCm6IO956e76ZmkXHJcbiAgICovXHJcbiAgcHJpdmF0ZSB2ZXJpZnlFbnRpdHlUb1JlbW92ZShpZGVudGl0eTogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgICBpZiAoIXRoaXMuaGFzKGlkZW50aXR5KSkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZSBlbnRpdHkgd2l0aCBpZGVudGl0eSBvZiAnJHtpZGVudGl0eX0gZG9zZSBub3QgZXhzaXQuJ2ApO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRydWU7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlrp7kvZPpm4blkIjlj5jmm7TmtYFcclxuICAgKi9cclxuICBwcml2YXRlIG5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkKG1vZGlmaWNhdGlvbjogTW9kaWZpY2F0aW9uKSB7XHJcbiAgICB0aGlzLmNvbGxlY3Rpb25DaGFuZ2VkLm5leHQobW9kaWZpY2F0aW9uKTtcclxuICB9XHJcbiAgcHJpdmF0ZSBsaXN0ZW5FbnRpdHlDaGFuZ2VFdmVudChlbnRpdHk6IEVudGl0eSkge1xyXG4gICAgaWYgKGVudGl0eSkge1xyXG4gICAgICBlbnRpdHkub25WYWx1ZUNoYW5nZWQuc3Vic2NyaWJlKChjaGFuZ2U6IE1vZGlmaWNhdGlvbikgPT4gdGhpcy5jaGFuZ2VzLm5leHQoY2hhbmdlKSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyNyZWdpb24g5YiG6aG1XHJcblxyXG4gIC8qKlxyXG4gICAqIOiuvue9ruWIhumhteWkp+Wwj1xyXG4gICAqL1xyXG4gIHNldCBwYWdlU2l6ZShwYWdlU2l6ZTogbnVtYmVyKSB7XHJcbiAgICBpZiAodHlwZW9mIChwYWdlU2l6ZSkgIT09ICdudW1iZXInIHx8IHBhZ2VTaXplIDwgMCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgcGFyYW1ldGVyOnBhZ2VTaXplJyk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3Qgb3JpZ2luYWwgPSB0aGlzLnBhZ2luYXRpb25JbmZvO1xyXG4gICAgLy8gY29uc3QgZW50aXR5UGFnaW5hdGlvbkluZm8gPSBPYmplY3QuYXNzaWduKHt9LCBvcmlnaW5hbFt0aGlzLmVudGl0eVR5cGVOYW1lXSwgeyBwYWdlU2l6ZSB9KTtcclxuICAgIC8vIHRoaXMucGFnaW5hdGlvbkluZm8gPSBPYmplY3QuYXNzaWduKHt9LCBvcmlnaW5hbCwgeyBbdGhpcy5lbnRpdHlUeXBlTmFtZV06IGVudGl0eVBhZ2luYXRpb25JbmZvIH0pO1xyXG4gICAgLy8gdGhpcy5ub3RpZnlDb2xsZWN0aW9uQ2hhbmdlZChuZXcgTW9kaWZpY2F0aW9uKHRoaXMucGFnaW5hdGlvbkluZm9bdGhpcy5lbnRpdHlUeXBlTmFtZV0sIE1vZGlmeVR5cGUuUGFnaW5hdGlvbkluZm9DaGFuZ2UpKTtcclxuICAgIHRoaXMucGFnaW5hdGlvbkluZm8gPSBPYmplY3QuYXNzaWduKHt9LCBvcmlnaW5hbCwgeyBwYWdlU2l6ZSB9KTtcclxuICAgIHRoaXMubm90aWZ5Q29sbGVjdGlvbkNoYW5nZWQobmV3IE1vZGlmaWNhdGlvbih0aGlzLnBhZ2luYXRpb25JbmZvLCBNb2RpZnlUeXBlLlBhZ2luYXRpb25JbmZvQ2hhbmdlKSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluWIhumhteWkp+Wwj1xyXG4gICAqIEBkZXNjcmlwdGlvbiDlpoLmnpznlKjmiLfmnKrmjIflrprliIbpobXlpKflsI/liJnpu5jorqTkuLow77yM5Y2z6I635Y+W5omA5pyJ5pWw5o2uXHJcbiAgICovXHJcbiAgZ2V0IHBhZ2VTaXplKCk6IG51bWJlciB7XHJcbiAgICBpZiAoISF0aGlzLnBhZ2luYXRpb25JbmZvKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLnBhZ2luYXRpb25JbmZvLnBhZ2VTaXplIHx8IDA7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gMDtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6K6+572u5pWw5o2u5oC75p2h5pWwXHJcbiAgICovXHJcbiAgc2V0IHRvdGFsQ291bnQodG90YWw6IG51bWJlcikge1xyXG4gICAgaWYgKHR5cGVvZiAodG90YWwpICE9PSAnbnVtYmVyJyB8fCB0b3RhbCA8IDApIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIHBhcmFtZXRlcjp0b3RhbCcpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IG9yaWdpbmFsID0gdGhpcy5wYWdpbmF0aW9uSW5mbztcclxuICAgIC8vIGNvbnN0IGVudGl0eVBhZ2luYXRpb25JbmZvID0gT2JqZWN0LmFzc2lnbih7fSwgb3JpZ2luYWxbdGhpcy5lbnRpdHlUeXBlTmFtZV0sIHsgdG90YWwgfSk7XHJcbiAgICAvLyB0aGlzLnBhZ2luYXRpb25JbmZvID0gT2JqZWN0LmFzc2lnbih7fSwgb3JpZ2luYWwsIHsgW3RoaXMuZW50aXR5VHlwZU5hbWVdOiBlbnRpdHlQYWdpbmF0aW9uSW5mbyB9KTtcclxuICAgIHRoaXMucGFnaW5hdGlvbkluZm8gPSBPYmplY3QuYXNzaWduKHt9LCBvcmlnaW5hbCwgeyB0b3RhbCB9KTtcclxuICAgIHRoaXMubm90aWZ5Q29sbGVjdGlvbkNoYW5nZWQobmV3IE1vZGlmaWNhdGlvbih0aGlzLnBhZ2luYXRpb25JbmZvLCBNb2RpZnlUeXBlLlBhZ2luYXRpb25JbmZvQ2hhbmdlKSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluaVsOaNruaAu+adoeaVsFxyXG4gICAqL1xyXG4gIGdldCB0b3RhbENvdW50KCk6IG51bWJlciB7XHJcbiAgICBpZiAoISF0aGlzLnBhZ2luYXRpb25JbmZvKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLnBhZ2luYXRpb25JbmZvLnRvdGFsIHx8IDA7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gMDtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6K6+572u5b2T5YmN6aG156CBXHJcbiAgICovXHJcbiAgc2V0IHBhZ2VJbmRleChwYWdlSW5kZXg6IG51bWJlcikge1xyXG4gICAgaWYgKHR5cGVvZiAocGFnZUluZGV4KSAhPT0gJ251bWJlcicgfHwgcGFnZUluZGV4IDwgMCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgcGFyYW1ldGVyOnBhZ2VJbmRleCcpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IG9yaWdpbmFsID0gdGhpcy5wYWdpbmF0aW9uSW5mbztcclxuICAgIC8vIGNvbnN0IGVudGl0eVBhZ2luYXRpb25JbmZvID0gT2JqZWN0LmFzc2lnbih7fSwgb3JpZ2luYWxbdGhpcy5lbnRpdHlUeXBlTmFtZV0sIHsgcGFnZUluZGV4IH0pO1xyXG4gICAgLy8gdGhpcy5wYWdpbmF0aW9uSW5mbyA9IE9iamVjdC5hc3NpZ24oe30sIG9yaWdpbmFsLCB7IFt0aGlzLmVudGl0eVR5cGVOYW1lXTogZW50aXR5UGFnaW5hdGlvbkluZm8gfSk7XHJcbiAgICB0aGlzLnBhZ2luYXRpb25JbmZvID0gT2JqZWN0LmFzc2lnbih7fSwgb3JpZ2luYWwsIHsgcGFnZUluZGV4IH0pO1xyXG4gICAgdGhpcy5ub3RpZnlDb2xsZWN0aW9uQ2hhbmdlZChuZXcgTW9kaWZpY2F0aW9uKHRoaXMucGFnaW5hdGlvbkluZm8sIE1vZGlmeVR5cGUuUGFnaW5hdGlvbkluZm9DaGFuZ2UpKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6I635Y+W5b2T5YmN6aG156CBXHJcbiAgICovXHJcbiAgZ2V0IHBhZ2VJbmRleCgpOiBudW1iZXIge1xyXG4gICAgaWYgKCEhdGhpcy5wYWdpbmF0aW9uSW5mbykge1xyXG4gICAgICByZXR1cm4gdGhpcy5wYWdpbmF0aW9uSW5mby5wYWdlSW5kZXggfHwgMTtcclxuICAgIH1cclxuICAgIHJldHVybiAxO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmm7TmlrDliIbpobXkv6Hmga9cclxuICAgKiBAcGFyYW0gcGF0aCDnu5Hlrprot6/lvoRcclxuICAgKiBAcGFyYW0gcGFnZUluZm8g5YiG6aG15L+h5oGvXHJcbiAgICovXHJcbiAgcHVibGljIHVwZGF0ZVBhZ2luYXRpb25JbmZvQnlQYXRoKHBhdGg6IHN0cmluZywgcGFnZUluZm86IHsgcGFnZUluZGV4OiBhbnksIHBhZ2VTaXplOiBhbnksIHRvdGFsQ291bnQ6IGFueSwgW3Byb3A6IHN0cmluZ106IGFueSB9KSB7XHJcbiAgICBjb25zdCBvcmlnaW5hbCA9IHRoaXMucGFnaW5hdGlvbkluZm87XHJcbiAgICBjb25zdCB7IHBhZ2VJbmRleCwgcGFnZVNpemUgfSA9IHBhZ2VJbmZvO1xyXG4gICAgY29uc3QgdG90YWwgPSBwYWdlSW5mbyAmJiAocGFnZUluZm8udG90YWxDb3VudCB8fCBwYWdlSW5mby50b3RhbCkgfHwgMDtcclxuICAgIGNvbnN0IHBhZ2luYXRpb25JbmZvID0gT2JqZWN0LmFzc2lnbih7fSwgb3JpZ2luYWwsIHsgcGFnZUluZGV4LCBwYWdlU2l6ZSwgdG90YWwgfSk7XHJcbiAgICB0aGlzLnNldFBhZ2luYXRpb25Db25maWdCeVBhdGgocGF0aCwgcGFnaW5hdGlvbkluZm8pO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmoLnmja7ot6/lvoTojrflj5bliIbpobXlpKflsI9cclxuICAgKiBAcGFyYW0gcGF0aCDot6/lvoRcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0UGFnaW5hdGlvbkNvbmZpZ0J5UGF0aChwYXRoOiBzdHJpbmcsIGRlZmF1bHRWYWx1ZT86IGFueSkge1xyXG4gICAgaWYgKCFwYXRoIHx8IHBhdGggPT09ICcvJykge1xyXG4gICAgICByZXR1cm4gdGhpcy5wYWdpbmF0aW9uSW5mbztcclxuICAgIH1cclxuICAgIGlmICh0eXBlb2YgcGF0aCAhPT0gJ3N0cmluZycpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCfot6/lvoTlv4XpobvkuLrlrZfnrKbkuLLvvIEnKTtcclxuICAgIH1cclxuICAgIGNvbnN0IHBhdGhzID0gcGF0aC5zcGxpdCgnLycpLmZpbHRlcihpdGVtID0+ICEhaXRlbSAmJiBpdGVtLnRyaW0oKS5sZW5ndGggPiAwKS5tYXAoaXRlbSA9PiBpdGVtLnRyaW0oKSk7XHJcbiAgICBsZXQgY29uZmlnID0gdGhpcy5wYWdpbmF0aW9uSW5mbztcclxuICAgIHBhdGhzLmZvckVhY2goaXRlbSA9PiB7XHJcbiAgICAgIGlmIChjb25maWcgJiYgY29uZmlnLmhhc093blByb3BlcnR5KGl0ZW0pKSB7XHJcbiAgICAgICAgY29uZmlnID0gY29uZmlnW2l0ZW1dO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbmZpZyA9IG51bGw7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgcmV0dXJuICEhY29uZmlnID8gY29uZmlnIDogdHlwZW9mIGRlZmF1bHRWYWx1ZSAhPT0gJ3VuZGVmaW5lZCcgPyBkZWZhdWx0VmFsdWUgOiB1bmRlZmluZWQ7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiuvue9ruWIhumhteS/oeaBr1xyXG4gICAqIEBwYXJhbSBwYXRoIOi3r+W+hFxyXG4gICAqIEBwYXJhbSB2YWx1ZSDlgLzvvIzlhbbkuK3mgLvmnaHmlbBrZXnkuLp0b3RhbFxyXG4gICAqL1xyXG4gIHB1YmxpYyBzZXRQYWdpbmF0aW9uQ29uZmlnQnlQYXRoKHBhdGg6IHN0cmluZyB8IEFycmF5PGFueT4sIHZhbHVlOiBhbnkpIHtcclxuICAgIGNvbnN0IG9yaWdpbmFsID0gSlNPTi5zdHJpbmdpZnkodGhpcy5wYWdpbmF0aW9uSW5mbyk7XHJcbiAgICBpZiAoIXBhdGggfHwgcGF0aCA9PT0gJy8nKSB7XHJcbiAgICAgIHRoaXMucGFnaW5hdGlvbkluZm8gPSB2YWx1ZTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGlmICghQXJyYXkuaXNBcnJheShwYXRoKSkge1xyXG4gICAgICAgIHBhdGggPSBwYXRoLnRvU3RyaW5nKCkubWF0Y2goL1teL1tcXF1dKy9nKSB8fCBbXTtcclxuICAgICAgfVxyXG4gICAgICBwYXRoLnNsaWNlKDAsIC0xKS5yZWR1Y2UoKHByZXYsIGN1cnJlbnQsIGluZGV4KSA9PlxyXG4gICAgICAgIE9iamVjdChwcmV2W2N1cnJlbnRdKSA9PT0gcHJldltjdXJyZW50XVxyXG4gICAgICAgICAgPyBwcmV2W2N1cnJlbnRdXHJcbiAgICAgICAgICA6IHByZXZbY3VycmVudF0gPSBNYXRoLmFicyhwYXRoW2luZGV4ICsgMV0pID4+IDAgPT09ICtwYXRoW2luZGV4ICsgMV1cclxuICAgICAgICAgICAgPyBbXVxyXG4gICAgICAgICAgICA6IHt9LFxyXG4gICAgICAgIHRoaXMucGFnaW5hdGlvbkluZm8pW3BhdGhbcGF0aC5sZW5ndGggLSAxXV0gPSB2YWx1ZTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoSlNPTi5zdHJpbmdpZnkodGhpcy5wYWdpbmF0aW9uSW5mbykgIT09IG9yaWdpbmFsKSB7XHJcbiAgICAgIHRoaXMubm90aWZ5Q29sbGVjdGlvbkNoYW5nZWQobmV3IE1vZGlmaWNhdGlvbih0aGlzLnBhZ2luYXRpb25JbmZvLCBNb2RpZnlUeXBlLlBhZ2luYXRpb25JbmZvQ2hhbmdlKSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGhpcy5wYWdpbmF0aW9uSW5mbztcclxuICB9XHJcbiAgLy8jZW5kcmVnaW9uXHJcbn1cclxuXHJcbmV4cG9ydCB7IEVudGl0eUNvbGxlY3Rpb24gfTtcclxuIl19