import { Inject, Injectable, Injector, LOCALE_ID, Optional } from "@angular/core";
import { map } from "rxjs/operators";
import { FeatureRepository } from "./feature-repository";
import { Prop } from "./types";
export class FeatureDataService {
    constructor(injector, repository, localeId) {
        this.injector = injector;
        this.repository = repository;
        this.localeId = localeId;
        this.localeId = this.localeId || 'zh-CHS';
    }
    /**
     * 根据物料id获取物料特征项及特征值（公共默认值）
     * @param materialId 物料id
     */
    getFeaturesByMaterialId(materialId) {
        return this.repository.getFeaturesByMaterialId(materialId).pipe(map((response) => {
            if (!response || !response.returnValue) {
                return null;
            }
            const returnValue = JSON.parse(response.returnValue);
            const result = { propset: [], props: [] };
            const propsets = returnValue.propset || null;
            const props = returnValue.props || null;
            if (propsets && Array.isArray(propsets)) {
                propsets.map((propset) => {
                    propset.name = this.translateName(propset);
                    return propset;
                });
                result.propset = propsets;
            }
            if (props && Array.isArray(props) && props.length > 0) {
                props.map((prop) => {
                    // 处理多语
                    prop.name = this.translateName(prop);
                    // 处理枚举
                    if (prop.inputtype === Prop.InputType.enum && prop.enuminfo) {
                        prop.data = JSON.parse(prop.enuminfo);
                    }
                    // 处理必填和只读
                    prop.isreadonly = prop.isreadonly === '1' ? true : false;
                    prop.isrequired = prop.isrequired === '1' ? true : false;
                    return prop;
                });
                result.props = props;
            }
            return result;
        }));
    }
    /**
     * 根据物料id及物料特征保存后的hash获取该物料已经存储的特征项值
     * @param materialId 物料Id
     * @param configID 对应该物料的特征项hash
     * @returns
     */
    getConfigedValueByFeatureId(materialId, configID, configType = 'Materials') {
        return this.repository.getConfigedValueByFeatureId(materialId, configID, configType).pipe(map((result) => {
            return JSON.parse(result);
        }));
    }
    /**
     * 保存物料特征项
     * @param materialId 物料id
     * @param charactValue 特征值
     * @param configType 配置类型
     * @returns
     */
    applyFeatures(materialId, charactValue, configType = 'Materials') {
        return this.repository.applyFeatures(materialId, charactValue, configType).pipe(map((config) => {
            return JSON.parse(config);
        }));
    }
    /**
     * 获取帮助信息
     * @param helpid 帮助id
     * @param filter 过滤条件
     * @param params 参数
     * @returns
     */
    getHelpInfo(helpid, filter, params) {
        const url = '/api/scm/scmfnd/v1.0/scmcommoncmpservice/service/gethelpdata';
        const httpParams = {};
        if (params) {
            if (params.pageIndex) {
                httpParams['pageIndex'] = JSON.stringify(params.pageIndex - 0);
            }
            if (params.pageSize) {
                httpParams['pageSize'] = JSON.stringify(params.pageSize - 0);
            }
            if (params.condition) {
                httpParams['condition'] = JSON.stringify(params.condition);
            }
            if (params.searchValue) {
                httpParams['search'] = params.searchValue;
            }
        }
        const body = {
            helpID: helpid,
            queryParam: JSON.stringify(httpParams),
            filterStr: filter
        };
        const befRepository = null; //this.repository as BefRepository<any>;
        const options = {
            body
        };
        return befRepository.proxy.request(url, 'put', null, options).pipe(map((result) => JSON.parse(result)));
    }
    /**
     * 国际化特征项或特征集名称
     * @param object 特征集或特征项对象
     * @returns
     */
    translateName(object) {
        if (!object) {
            return null;
        }
        let name = null;
        switch (this.localeId) {
            case 'en':
                {
                    name = object['name_en'];
                }
                break;
            case 'zh-CHS':
                {
                    name = object['name_chs'];
                }
                break;
            case 'zh-CHT':
                {
                    name = object['name_cht'];
                }
                break;
            default: name = object['name_chs'];
        }
        return name;
    }
}
FeatureDataService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
FeatureDataService.ctorParameters = () => [
    { type: Injector },
    { type: FeatureRepository },
    { type: String, decorators: [{ type: Optional }, { type: Inject, args: [LOCALE_ID,] }] }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmVhdHVyZS1kYXRhLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2NvbW1hbmQtc2VydmljZXMvIiwic291cmNlcyI6WyJsaWIvZmVhdHVyZS1lZGl0L2ZlYXR1cmUtZGF0YS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxTQUFTLEVBQUUsUUFBUSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBSWxGLE9BQU8sRUFBRSxHQUFHLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNyQyxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUN6RCxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sU0FBUyxDQUFDO0FBRy9CLE1BQU0sT0FBTyxrQkFBa0I7SUFDN0IsWUFDVSxRQUFrQixFQUNsQixVQUE2QixFQUNFLFFBQWlCO1FBRmhELGFBQVEsR0FBUixRQUFRLENBQVU7UUFDbEIsZUFBVSxHQUFWLFVBQVUsQ0FBbUI7UUFDRSxhQUFRLEdBQVIsUUFBUSxDQUFTO1FBRXhELElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLFFBQVEsSUFBSSxRQUFRLENBQUM7SUFDNUMsQ0FBQztJQUNEOzs7T0FHRztJQUNJLHVCQUF1QixDQUFDLFVBQWtCO1FBQy9DLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyx1QkFBdUIsQ0FBQyxVQUFVLENBQUMsQ0FBQyxJQUFJLENBQzdELEdBQUcsQ0FBQyxDQUFDLFFBQXNCLEVBQUUsRUFBRTtZQUM3QixJQUFJLENBQUMsUUFBUSxJQUFJLENBQUMsUUFBUSxDQUFDLFdBQVcsRUFBRTtnQkFDdEMsT0FBTyxJQUFJLENBQUM7YUFDYjtZQUNELE1BQU0sV0FBVyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQ3JELE1BQU0sTUFBTSxHQUFzQixFQUFFLE9BQU8sRUFB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QUNiO1FBQ0QsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBQ2hCLFFBQVEsSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNyQixLQUFLLElBQUk7Z0JBQUU7b0JBQ1QsSUFBSSxHQUFHLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQztpQkFDMUI7Z0JBQUMsTUFBTTtZQUNSLEtBQUssUUFBUTtnQkFBRTtvQkFDYixJQUFJLEdBQUcsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDO2lCQUMzQjtnQkFBQyxNQUFNO1lBQ1IsS0FBSyxRQUFRO2dCQUFFO29CQUNiLElBQUksR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUM7aUJBQzNCO2dCQUFDLE1BQU07WUFDUixPQUFPLENBQUMsQ0FBQyxJQUFJLEdBQUcsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1NBQ3BDO1FBQ0QsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDOzs7WUFwSUYsVUFBVTs7OztZQVJrQixRQUFRO1lBSzVCLGlCQUFpQjt5Q0FRckIsUUFBUSxZQUFJLE1BQU0sU0FBQyxTQUFTIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0LCBJbmplY3RhYmxlLCBJbmplY3RvciwgTE9DQUxFX0lELCBPcHRpb25hbCB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XG5pbXBvcnQgeyBCZWZSZXBvc2l0b3J5LCBSZXNwb25zZUluZm8gfSBmcm9tIFwiQGZhcnJpcy9iZWZcIjtcbmltcG9ydCB7IEZyYW1lQ29udGV4dCwgUmVzdGZ1bFNlcnZpY2UsIFJlcG9zaXRvcnkgfSBmcm9tICdAZmFycmlzL2RldmtpdCc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSBcInJ4anNcIjtcbmltcG9ydCB7IG1hcCB9IGZyb20gXCJyeGpzL29wZXJhdG9yc1wiO1xuaW1wb3J0IHsgRmVhdHVyZVJlcG9zaXRvcnkgfSBmcm9tIFwiLi9mZWF0dXJlLXJlcG9zaXRvcnlcIjtcbmltcG9ydCB7IFByb3AgfSBmcm9tIFwiLi90eXBlc1wiO1xuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgRmVhdHVyZURhdGFTZXJ2aWNlIHtcbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IsXG4gICAgcHJpdmF0ZSByZXBvc2l0b3J5OiBGZWF0dXJlUmVwb3NpdG9yeSxcbiAgICBAT3B0aW9uYWwoKSBASW5qZWN0KExPQ0FMRV9JRCkgcHJpdmF0ZSBsb2NhbGVJZD86IHN0cmluZ1xuICApIHtcbiAgICB0aGlzLmxvY2FsZUlkID0gdGhpcy5sb2NhbGVJZCB8fCAnemgtQ0hTJztcbiAgfVxuICAvKipcbiAgICog5qC55o2u54mp5paZaWTojrflj5bnianmlpnnibnlvoHpobnlj4rnibnlvoHlgLzvvIjlhazlhbHpu5jorqTlgLzvvIlcbiAgICogQHBhcmFtIG1hdGVyaWFsSWQg54mp5paZaWRcbiAgICovXG4gIHB1YmxpYyBnZXRGZWF0dXJlc0J5TWF0ZXJpYWxJZChtYXRlcmlhbElkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPFByb3AuSVJldHVyblZhbHVlPiB7XG4gICAgcmV0dXJuIHRoaXMucmVwb3NpdG9yeS5nZXRGZWF0dXJlc0J5TWF0ZXJpYWxJZChtYXRlcmlhbElkKS5waXBlKFxuICAgICAgbWFwKChyZXNwb25zZTogUmVzcG9uc2VJbmZvKSA9PiB7XG4gICAgICAgIGlmICghcmVzcG9uc2UgfHwgIXJlc3BvbnNlLnJldHVyblZhbHVlKSB7XG4gICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmV0dXJuVmFsdWUgPSBKU09OLnBhcnNlKHJlc3BvbnNlLnJldHVyblZhbHVlKTtcbiAgICAgICAgY29uc3QgcmVzdWx0OiBQcm9wLklSZXR1cm5WYWx1ZSA9IHsgcHJvcHNldDogW10sIHByb3BzOiBbXSB9O1xuICAgICAgICBjb25zdCBwcm9wc2V0cyA9IHJldHVyblZhbHVlLnByb3BzZXQgfHwgbnVsbDtcbiAgICAgICAgY29uc3QgcHJvcHMgPSByZXR1cm5WYWx1ZS5wcm9wcyB8fCBudWxsO1xuICAgICAgICBpZiAocHJvcHNldHMgJiYgQXJyYXkuaXNBcnJheShwcm9wc2V0cykpIHtcbiAgICAgICAgICBwcm9wc2V0cy5tYXAoKHByb3BzZXQ6IFByb3AuSVByb3BTZXQpID0+IHtcbiAgICAgICAgICAgIHByb3BzZXQubmFtZSA9IHRoaXMudHJhbnNsYXRlTmFtZShwcm9wc2V0KTtcbiAgICAgICAgICAgIHJldHVybiBwcm9wc2V0O1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJlc3VsdC5wcm9wc2V0ID0gcHJvcHNldHM7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHByb3BzICYmIEFycmF5LmlzQXJyYXkocHJvcHMpICYmIHByb3BzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBwcm9wcy5tYXAoKHByb3A6IFByb3AuSVByb3ApID0+IHtcbiAgICAgICAgICAgIC8vIOWkhOeQhuWkmuivrVxuICAgICAgICAgICAgcHJvcC5uYW1lID0gdGhpcy50cmFuc2xhdGVOYW1lKHByb3ApO1xuICAgICAgICAgICAgLy8g5aSE55CG5p6a5Li+XG4gICAgICAgICAgICBpZiAocHJvcC5pbnB1dHR5cGUgPT09IFByb3AuSW5wdXRUeXBlLmVudW0gJiYgcHJvcC5lbnVtaW5mbykge1xuICAgICAgICAgICAgICBwcm9wLmRhdGEgPSBKU09OLnBhcnNlKHByb3AuZW51bWluZm8pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8g5aSE55CG5b+F5aGr5ZKM5Y+q6K+7XG4gICAgICAgICAgICBwcm9wLmlzcmVhZG9ubHkgPSBwcm9wLmlzcmVhZG9ubHkgPT09ICcxJyA/IHRydWUgOiBmYWxzZTtcbiAgICAgICAgICAgIHByb3AuaXNyZXF1aXJlZCA9IHByb3AuaXNyZXF1aXJlZCA9PT0gJzEnID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgICAgICAgcmV0dXJuIHByb3A7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmVzdWx0LnByb3BzID0gcHJvcHM7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH0pXG4gICAgKTtcbiAgfVxuICAvKipcbiAgICog5qC55o2u54mp5paZaWTlj4rnianmlpnnibnlvoHkv53lrZjlkI7nmoRoYXNo6I635Y+W6K+l54mp5paZ5bey57uP5a2Y5YKo55qE54m55b6B6aG55YC8XG4gICAqIEBwYXJhbSBtYXRlcmlhbElkIOeJqeaWmUlkXG4gICAqIEBwYXJhbSBjb25maWdJRCDlr7nlupTor6XnianmlpnnmoTnibnlvoHpobloYXNoXG4gICAqIEByZXR1cm5zIFxuICAgKi9cbiAgcHVibGljIGdldENvbmZpZ2VkVmFsdWVCeUZlYXR1cmVJZChtYXRlcmlhbElkOiBzdHJpbmcsIGNvbmZpZ0lEOiBzdHJpbmcsIGNvbmZpZ1R5cGU6IHN0cmluZyA9ICdNYXRlcmlhbHMnKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICByZXR1cm4gdGhpcy5yZXBvc2l0b3J5LmdldENvbmZpZ2VkVmFsdWVCeUZlYXR1cmVJZChtYXRlcmlhbElkLCBjb25maWdJRCwgY29uZmlnVHlwZSkucGlwZShtYXAoKHJlc3VsdDogYW55KSA9PiB7XG4gICAgICByZXR1cm4gSlNPTi5wYXJzZShyZXN1bHQpO1xuICAgIH0pKTtcbiAgfVxuICAvKipcbiAgICog5L+d5a2Y54mp5paZ54m55b6B6aG5XG4gICAqIEBwYXJhbSBtYXRlcmlhbElkIOeJqeaWmWlkXG4gICAqIEBwYXJhbSBjaGFyYWN0VmFsdWUg54m55b6B5YC8XG4gICAqIEBwYXJhbSBjb25maWdUeXBlIOmFjee9ruexu+Wei1xuICAgKiBAcmV0dXJucyBcbiAgICovXG4gIHB1YmxpYyBhcHBseUZlYXR1cmVzKG1hdGVyaWFsSWQ6IHN0cmluZywgY2hhcmFjdFZhbHVlOiBhbnksIGNvbmZpZ1R5cGU6IHN0cmluZyA9ICdNYXRlcmlhbHMnKSB7XG4gICAgcmV0dXJuIHRoaXMucmVwb3NpdG9yeS5hcHBseUZlYXR1cmVzKG1hdGVyaWFsSWQsIGNoYXJhY3RWYWx1ZSwgY29uZmlnVHlwZSkucGlwZShtYXAoKGNvbmZpZzogYW55KSA9PiB7XG4gICAgICByZXR1cm4gSlNPTi5wYXJzZShjb25maWcpO1xuICAgIH0pKTtcbiAgfVxuICAvKipcbiAgICog6I635Y+W5biu5Yqp5L+h5oGvXG4gICAqIEBwYXJhbSBoZWxwaWQg5biu5YqpaWRcbiAgICogQHBhcmFtIGZpbHRlciDov4fmu6TmnaHku7ZcbiAgICogQHBhcmFtIHBhcmFtcyDlj4LmlbBcbiAgICogQHJldHVybnMgXG4gICAqL1xuICBwdWJsaWMgZ2V0SGVscEluZm8oaGVscGlkOiBzdHJpbmcsIGZpbHRlcjogc3RyaW5nLCBwYXJhbXM6IGFueSk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgY29uc3QgdXJsID0gJy9hcGkvc2NtL3NjbWZuZC92MS4wL3NjbWNvbW1vbmNtcHNlcnZpY2Uvc2VydmljZS9nZXRoZWxwZGF0YSc7XG4gICAgY29uc3QgaHR0cFBhcmFtczogYW55ID0ge307XG4gICAgaWYgKHBhcmFtcykge1xuICAgICAgaWYgKHBhcmFtcy5wYWdlSW5kZXgpIHtcbiAgICAgICAgaHR0cFBhcmFtc1sncGFnZUluZGV4J10gPSBKU09OLnN0cmluZ2lmeShwYXJhbXMucGFnZUluZGV4IC0gMCk7XG4gICAgICB9XG4gICAgICBpZiAocGFyYW1zLnBhZ2VTaXplKSB7XG4gICAgICAgIGh0dHBQYXJhbXNbJ3BhZ2VTaXplJ10gPSBKU09OLnN0cmluZ2lmeShwYXJhbXMucGFnZVNpemUgLSAwKTtcbiAgICAgIH1cbiAgICAgIGlmIChwYXJhbXMuY29uZGl0aW9uKSB7XG4gICAgICAgIGh0dHBQYXJhbXNbJ2NvbmRpdGlvbiddID0gSlNPTi5zdHJpbmdpZnkocGFyYW1zLmNvbmRpdGlvbik7XG4gICAgICB9XG4gICAgICBpZiAocGFyYW1zLnNlYXJjaFZhbHVlKSB7XG4gICAgICAgIGh0dHBQYXJhbXNbJ3NlYXJjaCddID0gcGFyYW1zLnNlYXJjaFZhbHVlO1xuICAgICAgfVxuICAgIH1cbiAgICBjb25zdCBib2R5ID0ge1xuICAgICAgaGVscElEOiBoZWxwaWQsXG4gICAgICBxdWVyeVBhcmFtOiBKU09OLnN0cmluZ2lmeShodHRwUGFyYW1zKSxcbiAgICAgIGZpbHRlclN0cjogZmlsdGVyXG4gICAgfTtcbiAgICBjb25zdCBiZWZSZXBvc2l0b3J5OiBCZWZSZXBvc2l0b3J5PGFueT4gPSBudWxsOy8vdGhpcy5yZXBvc2l0b3J5IGFzIEJlZlJlcG9zaXRvcnk8YW55PjtcbiAgICBjb25zdCBvcHRpb25zID0ge1xuICAgICAgYm9keVxuICAgIH07XG4gICAgcmV0dXJuIGJlZlJlcG9zaXRvcnkucHJveHkucmVxdWVzdCh1cmwsICdwdXQnLCBudWxsLCBvcHRpb25zKS5waXBlKFxuICAgICAgbWFwKChyZXN1bHQ6IGFueSkgPT4gSlNPTi5wYXJzZShyZXN1bHQpKVxuICAgICk7XG4gIH1cbiAgLyoqXG4gICAqIOWbvemZheWMlueJueW+gemhueaIlueJueW+gembhuWQjeensFxuICAgKiBAcGFyYW0gb2JqZWN0IOeJueW+gembhuaIlueJueW+gemhueWvueixoVxuICAgKiBAcmV0dXJucyBcbiAgICovXG4gIHByaXZhdGUgdHJhbnNsYXRlTmFtZShvYmplY3Q6IFByb3AuSVByb3BTZXQgfCBQcm9wLklQcm9wKTogc3RyaW5nIHtcbiAgICBpZiAoIW9iamVjdCkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGxldCBuYW1lID0gbnVsbDtcbiAgICBzd2l0Y2ggKHRoaXMubG9jYWxlSWQpIHtcbiAgICAgIGNhc2UgJ2VuJzoge1xuICAgICAgICBuYW1lID0gb2JqZWN0WyduYW1lX2VuJ107XG4gICAgICB9IGJyZWFrO1xuICAgICAgY2FzZSAnemgtQ0hTJzoge1xuICAgICAgICBuYW1lID0gb2JqZWN0WyduYW1lX2NocyddO1xuICAgICAgfSBicmVhaztcbiAgICAgIGNhc2UgJ3poLUNIVCc6IHtcbiAgICAgICAgbmFtZSA9IG9iamVjdFsnbmFtZV9jaHQnXTtcbiAgICAgIH0gYnJlYWs7XG4gICAgICBkZWZhdWx0OiBuYW1lID0gb2JqZWN0WyduYW1lX2NocyddO1xuICAgIH1cbiAgICByZXR1cm4gbmFtZTtcbiAgfVxufSJdfQ==