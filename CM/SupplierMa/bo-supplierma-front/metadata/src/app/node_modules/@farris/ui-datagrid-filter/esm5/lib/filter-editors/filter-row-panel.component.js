/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, NgZone, ElementRef, Renderer2, Output, EventEmitter, Injector } from '@angular/core';
import { ColumnFilterType } from '@farris/ui-datagrid';
import { DatagridFilterRowService } from '../datagrid-filter-row.service';
var FilterRowPanelComponent = /** @class */ (function () {
    function FilterRowPanelComponent(ngzone, el, render, dfrs, inject) {
        this.ngzone = ngzone;
        this.el = el;
        this.render = render;
        this.dfrs = dfrs;
        this.inject = inject;
        this.width = 240;
        this.height = 250;
        this.datatype = ColumnFilterType.string;
        this.conditionChange = new EventEmitter();
        this.gridInstance = null;
        this.enumSetting = {};
        this.condition = {
            operator1: 1,
            value1: '',
            relation: '',
            operator2: 1,
            value2: ''
        };
        this.documentClickHandle = null;
        this.ro = null;
        this.zone = null;
        this.zone = this.inject.get(NgZone);
    }
    /**
     * @return {?}
     */
    FilterRowPanelComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.ngzone.runOutsideAngular((/**
         * @return {?}
         */
        function () {
            _this.render.listen(_this.el.nativeElement, 'click', (/**
             * @param {?} e
             * @return {?}
             */
            function (e) {
                e.stopPropagation();
                return false;
            }));
        }));
        this.initEnumSetting();
        this.documentClickHandle = this.render.listen(document, 'click', (/**
         * @param {?} event
         * @return {?}
         */
        function (event) {
            _this.close(event);
        }));
    };
    /**
     * @return {?}
     */
    FilterRowPanelComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        if (this.target) {
            /** @type {?} */
            var panelDiv = this.el.nativeElement.querySelector('div');
            /** @type {?} */
            var panelRect = panelDiv.getBoundingClientRect();
            /** @type {?} */
            var h = panelRect.height;
            /** @type {?} */
            var rect = this.target.target.getBoundingClientRect();
            if (window['innerHeight'] - panelRect.top < h) {
                /** @type {?} */
                var top_1 = 0;
                if (rect.top > h) {
                    top_1 = rect.top - h - 14;
                }
                else {
                    top_1 = 32;
                }
                panelDiv.style.top = top_1 + 'px';
            }
        }
    };
    /**
     * @return {?}
     */
    FilterRowPanelComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        if (this.documentClickHandle) {
            this.documentClickHandle();
            this.documentClickHandle = null;
        }
    };
    /**
     * @param {?} event
     * @return {?}
     */
    FilterRowPanelComponent.prototype.close = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        event.stopPropagation();
        this.dfrs.closeFilterPanel();
    };
    /**
     * @param {?} condition
     * @return {?}
     */
    FilterRowPanelComponent.prototype.onValueChange = /**
     * @param {?} condition
     * @return {?}
     */
    function (condition) {
        this.conditionChange.emit(condition);
    };
    /**
     * @private
     * @return {?}
     */
    FilterRowPanelComponent.prototype.initEnumSetting = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.datatype > 5) {
            this.enumSetting = this.dfrs.getEnumOptions(this.column);
            /** @type {?} */
            var currentColumnCondition = (/** @type {?} */ (this.dfrs.columnConditions[this.column.field]));
            if (currentColumnCondition && currentColumnCondition.value1) {
                this.selectedValues = currentColumnCondition.value1.join(',');
            }
        }
    };
    FilterRowPanelComponent.decorators = [
        { type: Component, args: [{
                    selector: 'filter-row-panel',
                    template: "<div class=\"f-datagrid-filter-panel d-flex flex-column\" [style.width.px]=\"width\" style=\"z-index: 6666\">\r\n    <div class=\"panel-header\">\r\n        <div (click)=\"close($event)\" class=\"panel-icon\" style=\"text-align: center; cursor: pointer;\">\r\n            <span class=\"f-icon f-icon-filter-sm\"></span>\r\n        </div> \r\n    </div>\r\n    <div class=\"panel-content flex-fill\">\r\n        <condition-editor *ngIf=\"datatype < 6\"\r\n            [datatype]=\"datatype\"\r\n            [condition]=\"condition\"\r\n            [operators]=\"operators\"\r\n            [filterOptions]=\"column.filter.options\"\r\n            (conditionChange)=\"onValueChange($event)\"></condition-editor>\r\n            \r\n\r\n        <filter-datalist *ngIf=\"datatype === 6 || datatype === 7\" \r\n            [data]=\"enumSetting?.data\" [valueField]=\"enumSetting?.valueField\"\r\n            [textField]=\"enumSetting?.textField\" [idField]=\"enumSetting?.valueField\"\r\n            [selectedValues]=\"selectedValues\"\r\n            (valueChange)=\"onValueChange($event)\"></filter-datalist>\r\n    </div>\r\n</div>\r\n\r\n<div class=\"filter-panel-overlay\" style=\"position: absolute;\r\nposition: absolute;\r\nz-index: 4444;\r\nwidth: 100%;\r\ntop: 0;\r\nheight: 100%;\r\nbackground: rgb(255, 255, 255);\r\nopacity: 0;\" (click)=\"close($event)\"></div>\r\n"
                }] }
    ];
    /** @nocollapse */
    FilterRowPanelComponent.ctorParameters = function () { return [
        { type: NgZone },
        { type: ElementRef },
        { type: Renderer2 },
        { type: DatagridFilterRowService },
        { type: Injector }
    ]; };
    FilterRowPanelComponent.propDecorators = {
        width: [{ type: Input }],
        height: [{ type: Input }],
        column: [{ type: Input }],
        operators: [{ type: Input }],
        datatype: [{ type: Input }],
        conditionChange: [{ type: Output }]
    };
    return FilterRowPanelComponent;
}());
export { FilterRowPanelComponent };
if (false) {
    /** @type {?} */
    FilterRowPanelComponent.prototype.width;
    /** @type {?} */
    FilterRowPanelComponent.prototype.height;
    /** @type {?} */
    FilterRowPanelComponent.prototype.column;
    /** @type {?} */
    FilterRowPanelComponent.prototype.operators;
    /** @type {?} */
    FilterRowPanelComponent.prototype.datatype;
    /** @type {?} */
    FilterRowPanelComponent.prototype.conditionChange;
    /** @type {?} */
    FilterRowPanelComponent.prototype.gridInstance;
    /** @type {?} */
    FilterRowPanelComponent.prototype.enumSetting;
    /** @type {?} */
    FilterRowPanelComponent.prototype.selectedValues;
    /** @type {?} */
    FilterRowPanelComponent.prototype.condition;
    /** @type {?} */
    FilterRowPanelComponent.prototype.documentClickHandle;
    /** @type {?} */
    FilterRowPanelComponent.prototype.target;
    /**
     * @type {?}
     * @private
     */
    FilterRowPanelComponent.prototype.ro;
    /**
     * @type {?}
     * @private
     */
    FilterRowPanelComponent.prototype.zone;
    /**
     * @type {?}
     * @private
     */
    FilterRowPanelComponent.prototype.ngzone;
    /**
     * @type {?}
     * @private
     */
    FilterRowPanelComponent.prototype.el;
    /**
     * @type {?}
     * @private
     */
    FilterRowPanelComponent.prototype.render;
    /** @type {?} */
    FilterRowPanelComponent.prototype.dfrs;
    /**
     * @type {?}
     * @private
     */
    FilterRowPanelComponent.prototype.inject;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsdGVyLXJvdy1wYW5lbC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWRhdGFncmlkLWZpbHRlci8iLCJzb3VyY2VzIjpbImxpYi9maWx0ZXItZWRpdG9ycy9maWx0ZXItcm93LXBhbmVsLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFVLFVBQVUsRUFDekMsU0FBUyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsUUFBUSxFQUE0QixNQUFNLGVBQWUsQ0FBQztBQUV2RyxPQUFPLEVBQWMsZ0JBQWdCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUVuRSxPQUFPLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUcxRTtJQWtDSSxpQ0FDWSxNQUFjLEVBQVUsRUFBYyxFQUN0QyxNQUFpQixFQUFTLElBQThCLEVBQ3hELE1BQWdCO1FBRmhCLFdBQU0sR0FBTixNQUFNLENBQVE7UUFBVSxPQUFFLEdBQUYsRUFBRSxDQUFZO1FBQ3RDLFdBQU0sR0FBTixNQUFNLENBQVc7UUFBUyxTQUFJLEdBQUosSUFBSSxDQUEwQjtRQUN4RCxXQUFNLEdBQU4sTUFBTSxDQUFVO1FBaENuQixVQUFLLEdBQUcsR0FBRyxDQUFDO1FBQ1osV0FBTSxHQUFHLEdBQUcsQ0FBQztRQUtiLGFBQVEsR0FBRyxnQkFBZ0IsQ0FBQyxNQUFNLENBQUM7UUFFbEMsb0JBQWUsR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBRS9DLGlCQUFZLEdBQUcsSUFBSSxDQUFDO1FBQ3BCLGdCQUFXLEdBQXNCLEVBQUUsQ0FBQztRQUdwQyxjQUFTLEdBQW9CO1lBQ3pCLFNBQVMsRUFBRSxDQUFDO1lBQ1osTUFBTSxFQUFFLEVBQUU7WUFDVixRQUFRLEVBQUUsRUFBRTtZQUNaLFNBQVMsRUFBRSxDQUFDO1lBQ1osTUFBTSxFQUFFLEVBQUU7U0FDYixDQUFDO1FB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RUFBRTtnQkFDekQsSUFBSSxDQUFDLGNBQWMsR0FBRyxzQkFBc0IsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2FBQ2pFO1NBQ0o7SUFDTCxDQUFDOztnQkFwR0osU0FBUyxTQUFDO29CQUNQLFFBQVEsRUFBRSxrQkFBa0I7b0JBQzVCLHUyQ0FBK0M7aUJBQ2xEOzs7O2dCQVgwQixNQUFNO2dCQUFVLFVBQVU7Z0JBQ3pDLFNBQVM7Z0JBSVosd0JBQXdCO2dCQUpZLFFBQVE7Ozt3QkFZaEQsS0FBSzt5QkFDTCxLQUFLO3lCQUVMLEtBQUs7NEJBQ0wsS0FBSzsyQkFFTCxLQUFLO2tDQUVMLE1BQU07O0lBd0ZYLDhCQUFDO0NBQUEsQUFyR0QsSUFxR0M7U0FqR1ksdUJBQXVCOzs7SUFDaEMsd0NBQXFCOztJQUNyQix5Q0FBc0I7O0lBRXRCLHlDQUE0Qjs7SUFDNUIsNENBQXdDOztJQUV4QywyQ0FBNEM7O0lBRTVDLGtEQUErQzs7SUFFL0MsK0NBQW9COztJQUNwQiw4Q0FBb0M7O0lBQ3BDLGlEQUF1Qjs7SUFFdkIsNENBTUU7O0lBRUYsc0RBQTJCOztJQUUzQix5Q0FBWTs7Ozs7SUFFWixxQ0FBeUM7Ozs7O0lBQ3pDLHVDQUE0Qjs7Ozs7SUFHeEIseUNBQXNCOzs7OztJQUFFLHFDQUFzQjs7Ozs7SUFDOUMseUNBQXlCOztJQUFFLHVDQUFxQzs7Ozs7SUFDaEUseUNBQXdCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBJbnB1dCwgTmdab25lLCBPbkluaXQsIEVsZW1lbnRSZWYsXHJcbiAgICAgICAgICAgIFJlbmRlcmVyMiwgT3V0cHV0LCBFdmVudEVtaXR0ZXIsIEluamVjdG9yLCBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3kgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IFJlc2l6ZU9ic2VydmVyIGZyb20gJ3Jlc2l6ZS1vYnNlcnZlci1wb2x5ZmlsbCc7XHJcbmltcG9ydCB7IERhdGFDb2x1bW4sIENvbHVtbkZpbHRlclR5cGUgfSBmcm9tICdAZmFycmlzL3VpLWRhdGFncmlkJztcclxuXHJcbmltcG9ydCB7IERhdGFncmlkRmlsdGVyUm93U2VydmljZSB9IGZyb20gJy4uL2RhdGFncmlkLWZpbHRlci1yb3cuc2VydmljZSc7XHJcbmltcG9ydCB7IEZpbHRlckVudW1TZXR0aW5nLCBGaWx0ZXJDb25kaXRpb24sIEZpbHRlclJvd09wZXJhdG9yIH0gZnJvbSAnLi4vb3BlcmF0aW9ucy9vcGVyYXRvcnMnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ2ZpbHRlci1yb3ctcGFuZWwnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcuL2ZpbHRlci1yb3ctcGFuZWwuY29tcG9lbnQuaHRtbCdcclxufSlcclxuZXhwb3J0IGNsYXNzIEZpbHRlclJvd1BhbmVsQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3kge1xyXG4gICAgQElucHV0KCkgd2lkdGggPSAyNDA7XHJcbiAgICBASW5wdXQoKSBoZWlnaHQgPSAyNTA7XHJcblxyXG4gICAgQElucHV0KCkgY29sdW1uOiBEYXRhQ29sdW1uO1xyXG4gICAgQElucHV0KCkgb3BlcmF0b3JzOiBGaWx0ZXJSb3dPcGVyYXRvcltdO1xyXG5cclxuICAgIEBJbnB1dCgpIGRhdGF0eXBlID0gQ29sdW1uRmlsdGVyVHlwZS5zdHJpbmc7XHJcblxyXG4gICAgQE91dHB1dCgpIGNvbmRpdGlvbkNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuXHJcbiAgICBncmlkSW5zdGFuY2UgPSBudWxsO1xyXG4gICAgZW51bVNldHRpbmc6IEZpbHRlckVudW1TZXR0aW5nID0ge307XHJcbiAgICBzZWxlY3RlZFZhbHVlczogc3RyaW5nO1xyXG5cclxuICAgIGNvbmRpdGlvbjogRmlsdGVyQ29uZGl0aW9uID0ge1xyXG4gICAgICAgIG9wZXJhdG9yMTogMSxcclxuICAgICAgICB2YWx1ZTE6ICcnLFxyXG4gICAgICAgIHJlbGF0aW9uOiAnJyxcclxuICAgICAgICBvcGVyYXRvcjI6IDEsXHJcbiAgICAgICAgdmFsdWUyOiAnJ1xyXG4gICAgfTtcclxuXHJcbiAgICBkb2N1bWVudENsaWNrSGFuZGxlID0gbnVsbDtcclxuXHJcbiAgICB0YXJnZXQ6IGFueTtcclxuXHJcbiAgICBwcml2YXRlIHJvOiBSZXNpemVPYnNlcnZlciB8IG51bGwgPSBudWxsO1xyXG4gICAgcHJpdmF0ZSB6b25lOiBOZ1pvbmUgPSBudWxsO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIHByaXZhdGUgbmd6b25lOiBOZ1pvbmUsIHByaXZhdGUgZWw6IEVsZW1lbnRSZWYsXHJcbiAgICAgICAgcHJpdmF0ZSByZW5kZXI6IFJlbmRlcmVyMiwgcHVibGljIGRmcnM6IERhdGFncmlkRmlsdGVyUm93U2VydmljZSxcclxuICAgICAgICBwcml2YXRlIGluamVjdDogSW5qZWN0b3IpIHtcclxuICAgICAgICB0aGlzLnpvbmUgPSB0aGlzLmluamVjdC5nZXQoTmdab25lKTtcclxuICAgIH1cclxuXHJcbiAgICBuZ09uSW5pdCgpIHtcclxuICAgICAgICB0aGlzLm5nem9uZS5ydW5PdXRzaWRlQW5ndWxhciggKCkgPT4gIHtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXIubGlzdGVuKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgJ2NsaWNrJywgIChlOiBNb3VzZUV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGhpcy5pbml0RW51bVNldHRpbmcoKTtcclxuXHJcbiAgICAgICAgdGhpcy5kb2N1bWVudENsaWNrSGFuZGxlID0gdGhpcy5yZW5kZXIubGlzdGVuKGRvY3VtZW50LCAnY2xpY2snLCAoZXZlbnQpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5jbG9zZShldmVudCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcclxuICAgICAgICBpZiAodGhpcy50YXJnZXQpIHtcclxuICAgICAgICAgICAgY29uc3QgcGFuZWxEaXYgPSB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcignZGl2Jyk7XHJcbiAgICAgICAgICAgIGNvbnN0IHBhbmVsUmVjdCA9IHBhbmVsRGl2LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gICAgICAgICAgICBjb25zdCBoID0gcGFuZWxSZWN0LmhlaWdodDtcclxuICAgICAgICAgICAgY29uc3QgcmVjdCA9IHRoaXMudGFyZ2V0LnRhcmdldC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgICAgICAgICAgaWYgKHdpbmRvd1snaW5uZXJIZWlnaHQnXSAtIHBhbmVsUmVjdC50b3AgPCBoKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgdG9wID0gMDtcclxuICAgICAgICAgICAgICAgIGlmIChyZWN0LnRvcCA+IGgpIHtcclxuICAgICAgICAgICAgICAgICAgICB0b3AgPSByZWN0LnRvcCAtIGggLSAxNDtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdG9wID0gMzI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBwYW5lbERpdi5zdHlsZS50b3AgPSB0b3AgKyAncHgnO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG5nT25EZXN0cm95KCkge1xyXG4gICAgICAgIGlmICh0aGlzLmRvY3VtZW50Q2xpY2tIYW5kbGUpIHtcclxuICAgICAgICAgICAgdGhpcy5kb2N1bWVudENsaWNrSGFuZGxlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuZG9jdW1lbnRDbGlja0hhbmRsZSA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNsb3NlKGV2ZW50OiBNb3VzZUV2ZW50KSB7XHJcbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgdGhpcy5kZnJzLmNsb3NlRmlsdGVyUGFuZWwoKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgb25WYWx1ZUNoYW5nZShjb25kaXRpb24pIHtcclxuICAgICAgICB0aGlzLmNvbmRpdGlvbkNoYW5nZS5lbWl0KGNvbmRpdGlvbik7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBpbml0RW51bVNldHRpbmcoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZGF0YXR5cGUgPiA1KSB7XHJcbiAgICAgICAgICAgIHRoaXMuZW51bVNldHRpbmcgPSB0aGlzLmRmcnMuZ2V0RW51bU9wdGlvbnModGhpcy5jb2x1bW4pO1xyXG4gICAgICAgICAgICBjb25zdCBjdXJyZW50Q29sdW1uQ29uZGl0aW9uID0gdGhpcy5kZnJzLmNvbHVtbkNvbmRpdGlvbnNbdGhpcy5jb2x1bW4uZmllbGRdIGFzIEZpbHRlckNvbmRpdGlvbjtcclxuICAgICAgICAgICAgaWYgKGN1cnJlbnRDb2x1bW5Db25kaXRpb24gJiYgY3VycmVudENvbHVtbkNvbmRpdGlvbi52YWx1ZTEpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRWYWx1ZXMgPSBjdXJyZW50Q29sdW1uQ29uZGl0aW9uLnZhbHVlMS5qb2luKCcsJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIl19