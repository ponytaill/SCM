/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { takeUntil } from 'rxjs/operators';
import { LocaleService } from '@farris/ui-locale';
import { Subject } from 'rxjs';
import { Component, ViewEncapsulation, Injector, ChangeDetectorRef, ElementRef, ViewChild, Renderer2, Input, NgZone } from '@angular/core';
import { DatagridService } from './../../services/datagrid.service';
import ResizeObserver from 'resize-observer-polyfill';
import { DatagridComponent } from '../../datagrid.component';
var DatagridFilterToolbarComponent = /** @class */ (function () {
    function DatagridFilterToolbarComponent(inject, el, cd, dgs, render, ngZone, localeSer) {
        this.inject = inject;
        this.el = el;
        this.cd = cd;
        this.dgs = dgs;
        this.render = render;
        this.ngZone = ngZone;
        this.localeSer = localeSer;
        this.empty = '[ æ—  ]';
        this.filterText = this.empty;
        this.openFilterPanel = false;
        this.showExpand = false;
        this.enableFilterSetting = false;
        this.windowResizeHandler = null;
        this.ro = null;
        this.destory$ = new Subject();
        this.empty = this.localeSer.getValue('datagrid.filter.nofilter');
        this.filterText = this.empty;
    }
    Object.defineProperty(DatagridFilterToolbarComponent.prototype, "toolbarWidth", {
        get: /**
         * @return {?}
         */
        function () {
            return this.filterToolbarRef.nativeElement.offsetWidth;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DatagridFilterToolbarComponent.prototype, "filterTextContainerWidth", {
        get: /**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var actionW = 52;
            if (this.enableFilterSetting) {
                actionW = 65;
            }
            return this.toolbarWidth - 85 - actionW;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DatagridFilterToolbarComponent.prototype, "filterTextRealWidth", {
        get: /**
         * @return {?}
         */
        function () {
            this.render.setStyle(this.filterPanelTextRef.nativeElement, 'white-space', 'nowrap');
            /** @type {?} */
            var w = this.filterPanelTextRef.nativeElement.scrollWidth;
            this.render.setStyle(this.filterPanelTextRef.nativeElement, 'white-space', 'normal');
            return w;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    DatagridFilterToolbarComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.dg = this.inject.get(DatagridComponent);
        this.dfrs = this.dg.clientFilterService;
        this.dgs.clearFilter.pipe(takeUntil(this.destory$)).subscribe((/**
         * @return {?}
         */
        function () {
            _this.filterText = _this.empty;
            _this.openFilterPanel = false;
            _this.dgs.onFilterTextChange(_this.filterText);
            _this.cd.detectChanges();
        }));
        this.filterChangeSubscription = this.dgs.onFilterChanged.pipe(takeUntil(this.destory$)).subscribe((/**
         * @param {?} n
         * @return {?}
         */
        function (n) {
            _this.filterText = _this.dfrs.convertFilterCondition2String(n);
            if (!_this.filterText) {
                _this.filterText = _this.empty;
            }
            _this.updateExpandState();
            setTimeout((/**
             * @return {?}
             */
            function () {
                _this.bindEvent();
            }), 100);
            if (!_this.showExpand) {
                _this.openFilterPanel = false;
            }
            _this.cd.detectChanges();
            _this.dgs.onFilterTextChange(_this.filterText);
        }));
        this.ngZone.runOutsideAngular((/**
         * @return {?}
         */
        function () {
            _this.ro = new ResizeObserver((/**
             * @return {?}
             */
            function () {
                setTimeout((/**
                 * @return {?}
                 */
                function () {
                    _this.updateExpandState();
                    _this.cd.detectChanges();
                }), 100);
            }));
            _this.ro.observe(_this.el.nativeElement.closest('div.f-datagrid'));
        }));
    };
    /**
     * @return {?}
     */
    DatagridFilterToolbarComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.destory$.next();
        this.destory$.complete();
        this.ro.disconnect();
        if (this.filterChangeSubscription) {
            this.filterChangeSubscription.unsubscribe();
            this.filterChangeSubscription = null;
        }
        if (this.windowResizeHandler) {
            this.windowResizeHandler();
            this.windowResizeHandler = null;
        }
    };
    /**
     * @private
     * @return {?}
     */
    DatagridFilterToolbarComponent.prototype.bindEvent = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        this.ngZone.runOutsideAngular((/**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var filterFields = _this.filterToolbarRef.nativeElement.querySelectorAll('.filter-field');
            _this.bindFilterFieldHandler(filterFields);
            /** @type {?} */
            var dropdownFilterFields = _this.filterPanelTextRef.nativeElement.querySelectorAll('.filter-field');
            _this.bindFilterFieldHandler(dropdownFilterFields, false);
        }));
    };
    /**
     * @private
     * @param {?} filterFields
     * @param {?=} hidePanel
     * @return {?}
     */
    DatagridFilterToolbarComponent.prototype.bindFilterFieldHandler = /**
     * @private
     * @param {?} filterFields
     * @param {?=} hidePanel
     * @return {?}
     */
    function (filterFields, hidePanel) {
        var _this = this;
        if (hidePanel === void 0) { hidePanel = true; }
        if (filterFields && filterFields.length) {
            filterFields.forEach((/**
             * @param {?} ff
             * @return {?}
             */
            function (ff) {
                _this.render.listen(ff, 'click', (/**
                 * @return {?}
                 */
                function () {
                    _this.removeFilterField(ff, hidePanel);
                }));
            }));
        }
    };
    /**
     * @private
     * @param {?} ff
     * @param {?=} hidePanel
     * @return {?}
     */
    DatagridFilterToolbarComponent.prototype.removeFilterField = /**
     * @private
     * @param {?} ff
     * @param {?=} hidePanel
     * @return {?}
     */
    function (ff, hidePanel) {
        if (hidePanel === void 0) { hidePanel = true; }
        /** @type {?} */
        var field = ff.classList[1].replace('filter-column-', '');
        delete this.dg.conditions[field];
        this.dfrs.removeFilterField(field);
        ff.remove();
        if (hidePanel) {
            this.openFilterPanel = false;
            this.updateExpandState();
        }
    };
    /**
     * @private
     * @return {?}
     */
    DatagridFilterToolbarComponent.prototype.updateExpandState = /**
     * @private
     * @return {?}
     */
    function () {
        this.showExpand = this.isShowExpand();
    };
    /**
     * @return {?}
     */
    DatagridFilterToolbarComponent.prototype.isShowExpand = /**
     * @return {?}
     */
    function () {
        if (this.filterTextContainerWidth > this.filterTextRealWidth) {
            return false;
        }
        else if (this.filterTextRealWidth > this.filterTextContainerWidth) {
            return true;
        }
        else {
            return false;
        }
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    DatagridFilterToolbarComponent.prototype.clearFilter = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        this.filterText = this.empty;
        this.dgs.onClearFilter();
        this.dgs.onFilterChanged.emit({});
        return false;
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    DatagridFilterToolbarComponent.prototype.refreshFilter = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        this.dg.filterData();
        return false;
    };
    /**
     * @return {?}
     */
    DatagridFilterToolbarComponent.prototype.showFilterTextPanel = /**
     * @return {?}
     */
    function () {
        this.openFilterPanel = !this.openFilterPanel;
        this.cd.detectChanges();
    };
    DatagridFilterToolbarComponent.decorators = [
        { type: Component, args: [{
                    selector: 'filter-toolbar',
                    template: "\n        <div class=\"f-datagrid-filter-toolbar-panel\" #filterPanel [class.show]=\"openFilterPanel\" style=\"width: auto\">\n            <span class=\"filter-text\" #filterPanelText [innerHTML]=\"filterText\"></span>\n        </div>\n        <div class=\"f-datagrid-filter-toolbar\" #filterToolbar>\n            <span class=\"title\">{{'datagrid.filter.title'| locale}}\uFF1A</span>\n            <span #filterbarTxt class=\"filter-text\" [innerHTML]=\"filterText\"> </span>\n            <span class=\"filter-action\" *ngIf=\"filterText !== empty \">\n                <span *ngIf=\"showExpand\" class=\"f-icon filter-action-item\"\n                    [class.f-icon-arrow-chevron-up]=\"openFilterPanel\"\n                    [class.f-icon-arrow-chevron-down]=\"!openFilterPanel\"\n                (click)=\"showFilterTextPanel()\" title=\"{{'datagrid.filter.more'|locale}}\"></span>\n                <span title=\"{{'datagrid.filter.clearAll'|locale}}\" class=\"f-icon f-icon-x filter-action-item filter-clear\" (click)=\"clearFilter($event)\"></span>\n                <span title=\"refresh\" class=\"f-icon f-icon-reload-sm filter-action-item filter-refresh\" style=\"color: #388fff\" (click)=\"refreshFilter($event)\"></span>\n                <span *ngIf=\"enableFilterSetting\" class=\"f-icon f-icon-cog filter-action-item\" title=\"{{'datagrid.filter.setting'|locale}}\"></span>\n            </span>\n        </div>\n    ",
                    encapsulation: ViewEncapsulation.None
                }] }
    ];
    /** @nocollapse */
    DatagridFilterToolbarComponent.ctorParameters = function () { return [
        { type: Injector },
        { type: ElementRef },
        { type: ChangeDetectorRef },
        { type: DatagridService },
        { type: Renderer2 },
        { type: NgZone },
        { type: LocaleService }
    ]; };
    DatagridFilterToolbarComponent.propDecorators = {
        enableFilterSetting: [{ type: Input }],
        filterPanelRef: [{ type: ViewChild, args: ['filterPanel',] }],
        filterPanelTextRef: [{ type: ViewChild, args: ['filterPanelText',] }],
        filterTextRef: [{ type: ViewChild, args: ['filterbarTxt',] }],
        filterToolbarRef: [{ type: ViewChild, args: ['filterToolbar',] }]
    };
    return DatagridFilterToolbarComponent;
}());
export { DatagridFilterToolbarComponent };
if (false) {
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.empty;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.filterText;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.openFilterPanel;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.showExpand;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.enableFilterSetting;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.filterPanelRef;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.filterPanelTextRef;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.filterTextRef;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.filterToolbarRef;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.filterChangeSubscription;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.windowResizeHandler;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.ro;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterToolbarComponent.prototype.destory$;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterToolbarComponent.prototype.dfrs;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterToolbarComponent.prototype.dg;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterToolbarComponent.prototype.inject;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterToolbarComponent.prototype.el;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterToolbarComponent.prototype.cd;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterToolbarComponent.prototype.dgs;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterToolbarComponent.prototype.render;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterToolbarComponent.prototype.ngZone;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterToolbarComponent.prototype.localeSer;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsdGVyLXRvb2xiYXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1kYXRhZ3JpZC8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2ZpbHRlci10b29sYmFyL2ZpbHRlci10b29sYmFyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzNDLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNsRCxPQUFPLEVBQUUsT0FBTyxFQUFnQixNQUFNLE1BQU0sQ0FBQztBQUM3QyxPQUFPLEVBQUUsU0FBUyxFQUFVLGlCQUFpQixFQUFFLFFBQVEsRUFBRSxpQkFBaUIsRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUE2QixNQUFNLGVBQWUsQ0FBQztBQUM5SyxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sbUNBQW1DLENBQUM7QUFHcEUsT0FBTyxjQUFjLE1BQU0sMEJBQTBCLENBQUM7QUFDdEQsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFFN0Q7SUE2REksd0NBQ1ksTUFBZ0IsRUFDaEIsRUFBYyxFQUNkLEVBQXFCLEVBQ3JCLEdBQW9CLEVBQ3BCLE1BQWlCLEVBQ2pCLE1BQWMsRUFDZCxTQUF3QjtRQU54QixXQUFNLEdBQU4sTUFBTSxDQUFVO1FBQ2hCLE9BQUUsR0FBRixFQUFFLENBQVk7UUFDZCxPQUFFLEdBQUYsRUFBRSxDQUFtQjtRQUNyQixRQUFHLEdBQUgsR0FBRyxDQUFpQjtRQUNwQixXQUFNLEdBQU4sTUFBTSxDQUFXO1FBQ2pCLFdBQU0sR0FBTixNQUFNLENBQVE7UUFDZCxjQUFTLEdBQVQsU0FBUyxDQUFlO1FBN0NwQyxVQUFLLEdBQUcsT0FBTyxDQUFDO1FBQ2hCLGVBQVUsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDO1FBRXhCLG9CQUFlLEdBQUcsS0FBSyxDQUFDO1FBQ3hCLGVBQVUsR0FBRyxLQUFLLENBQUM7UUFFVix3QkFBbUIsR0FBRyxLQUFLLENBQUM7UUEyQnJDLHdCQUFtQixHQUFHLElBQUksQ0FBQztRQUMzQixPQUFFLEdBQW1CLElBQUksQ0FBQztRQUNsQixhQUFRLEdBQUcsSUFBSSxPQUFPLEVBQUUsQ0FBQztRQVl6QixJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLDBCQUEwQixDQUFDLENBQUM7UUFDakUsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDO0lBQ2pDLENBQUM7SUFwQ0wsc0JBQUksd0RBQVk7Ozs7UUFBaEI7WUFDSSxPQUFPLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxhQUFhLENBQUMsV0FBVyxDQUFDO1FBQzNELENBQUM7OztPQUFBO0lBRUQsc0JBQUksb0VBQXdCOzs7O1FBQTVCOztnQkFDUSxPQUFPLEdBQUcsRUFBRTtZQUNoQixJQUFJLElBQUksQ0FBQyxtQkFBbUIsRUFBRTtnQkFDMUIsT0FBTyxHQUFHLEVBQUUsQ0FBQzthQUNoQjtZQUNELE9BQU8sSUFBSSxDQUFDLFlBQVksR0FBRyxFQUFFLEdBQUcsT0FBTyxDQUFDO1FBQzVDLENBQUM7OztPQUFBO0lBRUQsc0JBQUksK0RBQW1COzs7O1FBQXZCO1lBQ0ksSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLGFBQWEsRUFBRSxhQUFhLEVBQUUsUUFBUSxDQUFDLENBQUM7O2dCQUMvRSxDQUFDLEdBQUcsSUFBSSxDQUFDLGtCQUFrQixDQUFDLGFBQWEsQ0FBQyxXQUFXO1lBQzNELElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxhQUFhLEVBQUUsYUFBYSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1lBQ3JGLE9BQU8sQ0FBQyxDQUFDO1FBQ2IsQ0FBQzs7O09BQUE7Ozs7SUFxQkQsaURBQVE7OztJQUFSO1FBQUEsaUJBdUNDO1FBdENHLElBQUksQ0FBQyxFQUFFLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQW9CLGlCQUFpQixDQUFDLENBQUM7UUFDaEUsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLG1CQUFtQixDQUFDO1FBRXhDLElBQUksQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsU0FBUzs7O1FBQUM7WUFDMUQsS0FBSSxDQUFDLFVBQVUsR0FBRyxLQUFJLENBQUMsS0FBSyxDQUFDO1lBQzdCLEtBQUksQ0FBQyxlQUFlLEdBQUcsS0FBSyxDQUFDO1lBQzdCLEtBQUksQ0FBQyxHQUFHLENBQUMsa0JBQWtCLENBQUMsS0FBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBQzdDLEtBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxFQUFFLENBQUM7UUFDNUIsQ0FBQyxFQUFDLENBQUM7UUFFSCxJQUFJLENBQUMsd0JBQXdCLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxTQUFTOzs7O1FBQUMsVUFBQyxDQUFDO1lBQ2hHLEtBQUksQ0FBQyxVQUFVLEdBQUcsS0FBSSxDQUFDLElBQUksQ0FBQyw2QkFBNkIsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUM3RCxJQUFJLENBQUMsS0FBSSxDQUFDLFVBQVUsRUFBRTtnQkFDbEIsS0FBSSxDQUFDLFVBQVUsR0FBRyxLQUFJLENBQUMsS0FBSyxDQUFDO2FBQ2hDO1lBRUQsS0FBSSxDQUFDLGlCQUFpQixFQUFFLENBQUM7WUFDekIsVUFBVTs7O1lBQUM7Z0JBQ1AsS0FBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO1lBQ3JCLENBQUMsR0FBRSxHQUFHLENBQUMsQ0FBQztZQUNSLElBQUksQ0FBQyxLQUFJLENBQUMsVUFBVSxFQUFFO2dCQUNsQixLQUFJLENBQUMsZUFBZSxHQUFHLEtBQUssQ0FBQzthQUNoQztZQUNELEtBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxFQUFFLENBQUM7WUFDeEIsS0FBSSxDQUFDLEdBQUcsQ0FBQyxrQkFBa0IsQ0FBQyxLQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDakQsQ0FBQyxFQUFDLENBQUM7UUFFSCxJQUFJLENBQUMsTUFBTSxDQUFDLGlCQUFpQjs7O1FBQUM7WUFFMUIsS0FBSSxDQUFDLEVBQUUsR0FBRyxJQUFJLGNBQWM7OztZQUFDO2dCQUN6QixVQUFVOzs7Z0JBQUM7b0JBQ1AsS0FBSSxDQUFDLGlCQUFpQixFQUFFLENBQUM7b0JBQ3pCLEtBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxFQUFFLENBQUM7Z0JBQzVCLENBQUMsR0FBRSxHQUFHLENBQUMsQ0FBQztZQUNaLENBQUMsRUFBQyxDQUFDO1lBRUgsS0FBSSxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsS0FBSSxDQUFDLEVBQUUsQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQztRQUNyRSxDQUFDLEVBQUMsQ0FBQztJQUNQLENBQUM7Ozs7SUFFRCxvREFBVzs7O0lBQVg7UUFDSSxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ3JCLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDekIsSUFBSSxDQUFDLEVBQUUsQ0FBQyxVQUFVLEVBQUUsQ0FBQztRQUNyQixJQUFJLElBQUksQ0FBQyx3QkFBd0IsRUFBRTtZQUMvQixJQUFJLENBQUMsd0JBQXdCLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDNUMsSUFBSSxDQUFDLHdCQUF3QixHQUFHLElBQUksQ0FBQztTQUN4QztRQUNELElBQUksSUFBSSxDQUFDLG1CQUFtQixFQUFFO1lBQzFCLElBQUksQ0FBQyxtQkFBbUIsRUFBRSxDQUFDO1lBQzNCLElBQUksQ0FBQyxtQkFBbUIsR0FBRyxJQUFJLENBQUM7U0FDbkM7SUFDTCxDQUFDOzs7OztJQUVPLGtEQUFTOzs7O0lBQWpCO1FBQUEsaUJBUUM7UUFQRyxJQUFJLENBQUMsTUFBTSxDQUFDLGlCQUFpQjs7O1FBQUM7O2dCQUNwQixZQUFZLEdBQUcsS0FBSSxDQUFDLGdCQUFnQixDQUFDLGFBQWEsQ0FBQyxnQkFBZ0IsQ0FBQyxlQUFlLENBQUM7WUFDMUYsS0FBSSxDQUFDLHNCQUFzQixDQUFDLFlBQVksQ0FBQyxDQUFDOztnQkFFcEMsb0JBQW9CLEdBQUcsS0FBSSxDQUFDLGtCQUFrQixDQUFDLGFBQWEsQ0FBQyxnQkFBZ0IsQ0FBQyxlQUFlLENBQUM7WUFDcEcsS0FBSSxDQUFDLHNCQUFzQixDQUFDLG9CQUFvQixFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQzdELENBQUMsRUFBQyxDQUFDO0lBQ1AsQ0FBQzs7Ozs7OztJQUVPLCtEQUFzQjs7Ozs7O0lBQTlCLFVBQStCLFlBQWlCLEVBQUUsU0FBZ0I7UUFBbEUsaUJBUUM7UUFSaUQsMEJBQUEsRUFBQSxnQkFBZ0I7UUFDOUQsSUFBSSxZQUFZLElBQUksWUFBWSxDQUFDLE1BQU0sRUFBRTtZQUNyQyxZQUFZLENBQUMsT0FBTzs7OztZQUFDLFVBQUEsRUFBRTtnQkFDbkIsS0FBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLE9BQU87OztnQkFBRTtvQkFDNUIsS0FBSSxDQUFDLGlCQUFpQixDQUFDLEVBQUUsRUFBRSxTQUFTLENBQUMsQ0FBQztnQkFDMUMsQ0FBQyxFQUFDLENBQUM7WUFDUCxDQUFDLEVBQUMsQ0FBQztTQUNOO0lBQ0wsQ0FBQzs7Ozs7OztJQUVPLDBEQUFpQjs7Ozs7O0lBQXpCLFVBQTBCLEVBQU8sRUFBRSxTQUFnQjtRQUFoQiwwQkFBQSxFQUFBLGdCQUFnQjs7WUFDekMsS0FBSyxHQUFHLEVBQUUsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLGdCQUFnQixFQUFFLEVBQUUsQ0FBQztRQUMzRCxPQUFPLElBQUksQ0FBQyxFQUFFLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2pDLElBQUksQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDbkMsRUFBRSxDQUFDLE1BQU0sRUFBRSxDQUFDO1FBQ1osSUFBSSxTQUFTLEVBQUU7WUFDWCxJQUFJLENBQUMsZUFBZSxHQUFHLEtBQUssQ0FBQztZQUM3QixJQUFJLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztTQUM1QjtJQUNMLENBQUM7Ozs7O0lBRU8sMERBQWlCOzs7O0lBQXpCO1FBQ0ksSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7SUFDMUMsQ0FBQzs7OztJQUVELHFEQUFZOzs7SUFBWjtRQUVJLElBQUksSUFBSSxDQUFDLHdCQUF3QixHQUFHLElBQUksQ0FBQyxtQkFBbUIsRUFBRTtZQUMxRCxPQUFPLEtBQUssQ0FBQztTQUNoQjthQUFNLElBQUksSUFBSSxDQUFDLG1CQUFtQixHQUFHLElBQUksQ0FBQyx3QkFBd0IsRUFBRTtZQUNqRSxPQUFPLElBQUksQ0FBQztTQUNmO2FBQU07WUFDSCxPQUFPLEtBQUssQ0FBQztTQUNoQjtJQUNMLENBQUM7Ozs7O0lBRUQsb0RBQVc7Ozs7SUFBWCxVQUFZLE1BQU07UUFDZCxJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUM7UUFDN0IsSUFBSSxDQUFDLEdBQUcsQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUN6QixJQUFJLENBQUMsR0FBRyxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDbEMsT0FBTyxLQUFLLENBQUM7SUFDakIsQ0FBQzs7Ozs7SUFFRCxzREFBYTs7OztJQUFiLFVBQWMsTUFBTTtRQUNoQixJQUFJLENBQUMsRUFBRSxDQUFDLFVBQVUsRUFBRSxDQUFDO1FBQ3JCLE9BQU8sS0FBSyxDQUFDO0lBQ2pCLENBQUM7Ozs7SUFFRCw0REFBbUI7OztJQUFuQjtRQUNJLElBQUksQ0FBQyxlQUFlLEdBQUcsQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDO1FBQzdDLElBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxFQUFFLENBQUM7SUFDNUIsQ0FBQzs7Z0JBOUxKLFNBQVMsU0FBQztvQkFDUCxRQUFRLEVBQUUsZ0JBQWdCO29CQUMxQixRQUFRLEVBQUUsbzVDQWlCVDtvQkFDRCxhQUFhLEVBQUUsaUJBQWlCLENBQUMsSUFBSTtpQkFDeEM7Ozs7Z0JBNUI4QyxRQUFRO2dCQUFxQixVQUFVO2dCQUE3QixpQkFBaUI7Z0JBQ2pFLGVBQWU7Z0JBRDJFLFNBQVM7Z0JBQVMsTUFBTTtnQkFGbEgsYUFBYTs7O3NDQXNDakIsS0FBSztpQ0FFTCxTQUFTLFNBQUMsYUFBYTtxQ0FDdkIsU0FBUyxTQUFDLGlCQUFpQjtnQ0FDM0IsU0FBUyxTQUFDLGNBQWM7bUNBQ3hCLFNBQVMsU0FBQyxlQUFlOztJQTZKOUIscUNBQUM7Q0FBQSxBQS9MRCxJQStMQztTQXpLWSw4QkFBOEI7OztJQUN2QywrQ0FBZ0I7O0lBQ2hCLG9EQUF3Qjs7SUFFeEIseURBQXdCOztJQUN4QixvREFBbUI7O0lBRW5CLDZEQUFxQzs7SUFFckMsd0RBQXFEOztJQUNyRCw0REFBNkQ7O0lBQzdELHVEQUFxRDs7SUFDckQsMERBQXlEOztJQXFCekQsa0VBQXVDOztJQUN2Qyw2REFBMkI7O0lBQzNCLDRDQUEwQjs7Ozs7SUFDMUIsa0RBQWlDOzs7OztJQUNqQyw4Q0FBb0M7Ozs7O0lBQ3BDLDRDQUE4Qjs7Ozs7SUFFMUIsZ0RBQXdCOzs7OztJQUN4Qiw0Q0FBc0I7Ozs7O0lBQ3RCLDRDQUE2Qjs7Ozs7SUFDN0IsNkNBQTRCOzs7OztJQUM1QixnREFBeUI7Ozs7O0lBQ3pCLGdEQUFzQjs7Ozs7SUFDdEIsbURBQWdDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdGFrZVVudGlsIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBMb2NhbGVTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1sb2NhbGUnO1xyXG5pbXBvcnQgeyBTdWJqZWN0LCBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIFZpZXdFbmNhcHN1bGF0aW9uLCBJbmplY3RvciwgQ2hhbmdlRGV0ZWN0b3JSZWYsIEVsZW1lbnRSZWYsIFZpZXdDaGlsZCwgUmVuZGVyZXIyLCBJbnB1dCwgTmdab25lLCBPbkRlc3Ryb3ksIE9wdGlvbmFsLCBIb3N0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IERhdGFncmlkU2VydmljZSB9IGZyb20gJy4vLi4vLi4vc2VydmljZXMvZGF0YWdyaWQuc2VydmljZSc7XHJcbmltcG9ydCB7IERhdGFncmlkRmlsdGVyU2VydmljZSB9IGZyb20gJy4vLi4vLi4vc2VydmljZXMvZGF0YWdyaWQtZmlsdGVyLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyAgfSBmcm9tICcuLy4uLy4uL3NlcnZpY2VzL2RhdGFncmlkLWZhY2FkZS5zZXJ2aWNlJztcclxuaW1wb3J0IFJlc2l6ZU9ic2VydmVyIGZyb20gJ3Jlc2l6ZS1vYnNlcnZlci1wb2x5ZmlsbCc7XHJcbmltcG9ydCB7IERhdGFncmlkQ29tcG9uZW50IH0gZnJvbSAnLi4vLi4vZGF0YWdyaWQuY29tcG9uZW50JztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdmaWx0ZXItdG9vbGJhcicsXHJcbiAgICB0ZW1wbGF0ZTogYFxyXG4gICAgICAgIDxkaXYgY2xhc3M9XCJmLWRhdGFncmlkLWZpbHRlci10b29sYmFyLXBhbmVsXCIgI2ZpbHRlclBhbmVsIFtjbGFzcy5zaG93XT1cIm9wZW5GaWx0ZXJQYW5lbFwiIHN0eWxlPVwid2lkdGg6IGF1dG9cIj5cclxuICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJmaWx0ZXItdGV4dFwiICNmaWx0ZXJQYW5lbFRleHQgW2lubmVySFRNTF09XCJmaWx0ZXJUZXh0XCI+PC9zcGFuPlxyXG4gICAgICAgIDwvZGl2PlxyXG4gICAgICAgIDxkaXYgY2xhc3M9XCJmLWRhdGFncmlkLWZpbHRlci10b29sYmFyXCIgI2ZpbHRlclRvb2xiYXI+XHJcbiAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwidGl0bGVcIj57eydkYXRhZ3JpZC5maWx0ZXIudGl0bGUnfCBsb2NhbGV9fe+8mjwvc3Bhbj5cclxuICAgICAgICAgICAgPHNwYW4gI2ZpbHRlcmJhclR4dCBjbGFzcz1cImZpbHRlci10ZXh0XCIgW2lubmVySFRNTF09XCJmaWx0ZXJUZXh0XCI+IDwvc3Bhbj5cclxuICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJmaWx0ZXItYWN0aW9uXCIgKm5nSWY9XCJmaWx0ZXJUZXh0ICE9PSBlbXB0eSBcIj5cclxuICAgICAgICAgICAgICAgIDxzcGFuICpuZ0lmPVwic2hvd0V4cGFuZFwiIGNsYXNzPVwiZi1pY29uIGZpbHRlci1hY3Rpb24taXRlbVwiXHJcbiAgICAgICAgICAgICAgICAgICAgW2NsYXNzLmYtaWNvbi1hcnJvdy1jaGV2cm9uLXVwXT1cIm9wZW5GaWx0ZXJQYW5lbFwiXHJcbiAgICAgICAgICAgICAgICAgICAgW2NsYXNzLmYtaWNvbi1hcnJvdy1jaGV2cm9uLWRvd25dPVwiIW9wZW5GaWx0ZXJQYW5lbFwiXHJcbiAgICAgICAgICAgICAgICAoY2xpY2spPVwic2hvd0ZpbHRlclRleHRQYW5lbCgpXCIgdGl0bGU9XCJ7eydkYXRhZ3JpZC5maWx0ZXIubW9yZSd8bG9jYWxlfX1cIj48L3NwYW4+XHJcbiAgICAgICAgICAgICAgICA8c3BhbiB0aXRsZT1cInt7J2RhdGFncmlkLmZpbHRlci5jbGVhckFsbCd8bG9jYWxlfX1cIiBjbGFzcz1cImYtaWNvbiBmLWljb24teCBmaWx0ZXItYWN0aW9uLWl0ZW0gZmlsdGVyLWNsZWFyXCIgKGNsaWNrKT1cImNsZWFyRmlsdGVyKCRldmVudClcIj48L3NwYW4+XHJcbiAgICAgICAgICAgICAgICA8c3BhbiB0aXRsZT1cInJlZnJlc2hcIiBjbGFzcz1cImYtaWNvbiBmLWljb24tcmVsb2FkLXNtIGZpbHRlci1hY3Rpb24taXRlbSBmaWx0ZXItcmVmcmVzaFwiIHN0eWxlPVwiY29sb3I6ICMzODhmZmZcIiAoY2xpY2spPVwicmVmcmVzaEZpbHRlcigkZXZlbnQpXCI+PC9zcGFuPlxyXG4gICAgICAgICAgICAgICAgPHNwYW4gKm5nSWY9XCJlbmFibGVGaWx0ZXJTZXR0aW5nXCIgY2xhc3M9XCJmLWljb24gZi1pY29uLWNvZyBmaWx0ZXItYWN0aW9uLWl0ZW1cIiB0aXRsZT1cInt7J2RhdGFncmlkLmZpbHRlci5zZXR0aW5nJ3xsb2NhbGV9fVwiPjwvc3Bhbj5cclxuICAgICAgICAgICAgPC9zcGFuPlxyXG4gICAgICAgIDwvZGl2PlxyXG4gICAgYCxcclxuICAgIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmVcclxufSlcclxuZXhwb3J0IGNsYXNzIERhdGFncmlkRmlsdGVyVG9vbGJhckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95IHtcclxuICAgIGVtcHR5ID0gJ1sg5pegIF0nO1xyXG4gICAgZmlsdGVyVGV4dCA9IHRoaXMuZW1wdHk7XHJcblxyXG4gICAgb3BlbkZpbHRlclBhbmVsID0gZmFsc2U7XHJcbiAgICBzaG93RXhwYW5kID0gZmFsc2U7XHJcblxyXG4gICAgQElucHV0KCkgZW5hYmxlRmlsdGVyU2V0dGluZyA9IGZhbHNlO1xyXG5cclxuICAgIEBWaWV3Q2hpbGQoJ2ZpbHRlclBhbmVsJykgZmlsdGVyUGFuZWxSZWY6IEVsZW1lbnRSZWY7XHJcbiAgICBAVmlld0NoaWxkKCdmaWx0ZXJQYW5lbFRleHQnKSBmaWx0ZXJQYW5lbFRleHRSZWY6IEVsZW1lbnRSZWY7XHJcbiAgICBAVmlld0NoaWxkKCdmaWx0ZXJiYXJUeHQnKSBmaWx0ZXJUZXh0UmVmOiBFbGVtZW50UmVmO1xyXG4gICAgQFZpZXdDaGlsZCgnZmlsdGVyVG9vbGJhcicpIGZpbHRlclRvb2xiYXJSZWY6IEVsZW1lbnRSZWY7XHJcblxyXG4gICAgZ2V0IHRvb2xiYXJXaWR0aCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5maWx0ZXJUb29sYmFyUmVmLm5hdGl2ZUVsZW1lbnQub2Zmc2V0V2lkdGg7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGZpbHRlclRleHRDb250YWluZXJXaWR0aCgpIHtcclxuICAgICAgICBsZXQgYWN0aW9uVyA9IDUyO1xyXG4gICAgICAgIGlmICh0aGlzLmVuYWJsZUZpbHRlclNldHRpbmcpIHtcclxuICAgICAgICAgICAgYWN0aW9uVyA9IDY1O1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy50b29sYmFyV2lkdGggLSA4NSAtIGFjdGlvblc7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGZpbHRlclRleHRSZWFsV2lkdGgoKSB7XHJcbiAgICAgICAgdGhpcy5yZW5kZXIuc2V0U3R5bGUodGhpcy5maWx0ZXJQYW5lbFRleHRSZWYubmF0aXZlRWxlbWVudCwgJ3doaXRlLXNwYWNlJywgJ25vd3JhcCcpO1xyXG4gICAgICAgIGNvbnN0IHcgPSB0aGlzLmZpbHRlclBhbmVsVGV4dFJlZi5uYXRpdmVFbGVtZW50LnNjcm9sbFdpZHRoO1xyXG4gICAgICAgIHRoaXMucmVuZGVyLnNldFN0eWxlKHRoaXMuZmlsdGVyUGFuZWxUZXh0UmVmLm5hdGl2ZUVsZW1lbnQsICd3aGl0ZS1zcGFjZScsICdub3JtYWwnKTtcclxuICAgICAgICByZXR1cm4gdztcclxuICAgIH1cclxuXHJcbiAgICBmaWx0ZXJDaGFuZ2VTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcclxuICAgIHdpbmRvd1Jlc2l6ZUhhbmRsZXIgPSBudWxsO1xyXG4gICAgcm86IFJlc2l6ZU9ic2VydmVyID0gbnVsbDtcclxuICAgIHByaXZhdGUgZGVzdG9yeSQgPSBuZXcgU3ViamVjdCgpO1xyXG4gICAgcHJpdmF0ZSBkZnJzOiBEYXRhZ3JpZEZpbHRlclNlcnZpY2U7XHJcbiAgICBwcml2YXRlIGRnOiBEYXRhZ3JpZENvbXBvbmVudDtcclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIHByaXZhdGUgaW5qZWN0OiBJbmplY3RvcixcclxuICAgICAgICBwcml2YXRlIGVsOiBFbGVtZW50UmVmLFxyXG4gICAgICAgIHByaXZhdGUgY2Q6IENoYW5nZURldGVjdG9yUmVmLFxyXG4gICAgICAgIHByaXZhdGUgZGdzOiBEYXRhZ3JpZFNlcnZpY2UsXHJcbiAgICAgICAgcHJpdmF0ZSByZW5kZXI6IFJlbmRlcmVyMixcclxuICAgICAgICBwcml2YXRlIG5nWm9uZTogTmdab25lLFxyXG4gICAgICAgIHByaXZhdGUgbG9jYWxlU2VyOiBMb2NhbGVTZXJ2aWNlLFxyXG4gICAgICApIHtcclxuICAgICAgICAgICAgdGhpcy5lbXB0eSA9IHRoaXMubG9jYWxlU2VyLmdldFZhbHVlKCdkYXRhZ3JpZC5maWx0ZXIubm9maWx0ZXInKTtcclxuICAgICAgICAgICAgdGhpcy5maWx0ZXJUZXh0ID0gdGhpcy5lbXB0eTtcclxuICAgICAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5kZyA9IHRoaXMuaW5qZWN0LmdldDxEYXRhZ3JpZENvbXBvbmVudD4oRGF0YWdyaWRDb21wb25lbnQpO1xyXG4gICAgICAgIHRoaXMuZGZycyA9IHRoaXMuZGcuY2xpZW50RmlsdGVyU2VydmljZTtcclxuXHJcbiAgICAgICAgdGhpcy5kZ3MuY2xlYXJGaWx0ZXIucGlwZSh0YWtlVW50aWwodGhpcy5kZXN0b3J5JCkpLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuZmlsdGVyVGV4dCA9IHRoaXMuZW1wdHk7XHJcbiAgICAgICAgICAgIHRoaXMub3BlbkZpbHRlclBhbmVsID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHRoaXMuZGdzLm9uRmlsdGVyVGV4dENoYW5nZSh0aGlzLmZpbHRlclRleHQpO1xyXG4gICAgICAgICAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGhpcy5maWx0ZXJDaGFuZ2VTdWJzY3JpcHRpb24gPSB0aGlzLmRncy5vbkZpbHRlckNoYW5nZWQucGlwZSh0YWtlVW50aWwodGhpcy5kZXN0b3J5JCkpLnN1YnNjcmliZSgobikgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmZpbHRlclRleHQgPSB0aGlzLmRmcnMuY29udmVydEZpbHRlckNvbmRpdGlvbjJTdHJpbmcobik7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5maWx0ZXJUZXh0KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZpbHRlclRleHQgPSB0aGlzLmVtcHR5O1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUV4cGFuZFN0YXRlKCk7XHJcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5iaW5kRXZlbnQoKTtcclxuICAgICAgICAgICAgfSwgMTAwKTtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLnNob3dFeHBhbmQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMub3BlbkZpbHRlclBhbmVsID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgICAgIHRoaXMuZGdzLm9uRmlsdGVyVGV4dENoYW5nZSh0aGlzLmZpbHRlclRleHQpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XHJcblxyXG4gICAgICAgICAgICB0aGlzLnJvID0gbmV3IFJlc2l6ZU9ic2VydmVyKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlRXhwYW5kU3RhdGUoKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICAgICAgICAgIH0sIDEwMCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5yby5vYnNlcnZlKHRoaXMuZWwubmF0aXZlRWxlbWVudC5jbG9zZXN0KCdkaXYuZi1kYXRhZ3JpZCcpKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBuZ09uRGVzdHJveSgpIHtcclxuICAgICAgICB0aGlzLmRlc3RvcnkkLm5leHQoKTtcclxuICAgICAgICB0aGlzLmRlc3RvcnkkLmNvbXBsZXRlKCk7XHJcbiAgICAgICAgdGhpcy5yby5kaXNjb25uZWN0KCk7XHJcbiAgICAgICAgaWYgKHRoaXMuZmlsdGVyQ2hhbmdlU3Vic2NyaXB0aW9uKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZmlsdGVyQ2hhbmdlU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuZmlsdGVyQ2hhbmdlU3Vic2NyaXB0aW9uID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMud2luZG93UmVzaXplSGFuZGxlcikge1xyXG4gICAgICAgICAgICB0aGlzLndpbmRvd1Jlc2l6ZUhhbmRsZXIoKTtcclxuICAgICAgICAgICAgdGhpcy53aW5kb3dSZXNpemVIYW5kbGVyID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBiaW5kRXZlbnQoKSB7XHJcbiAgICAgICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBmaWx0ZXJGaWVsZHMgPSB0aGlzLmZpbHRlclRvb2xiYXJSZWYubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZmlsdGVyLWZpZWxkJyk7XHJcbiAgICAgICAgICAgIHRoaXMuYmluZEZpbHRlckZpZWxkSGFuZGxlcihmaWx0ZXJGaWVsZHMpO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgZHJvcGRvd25GaWx0ZXJGaWVsZHMgPSB0aGlzLmZpbHRlclBhbmVsVGV4dFJlZi5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5maWx0ZXItZmllbGQnKTtcclxuICAgICAgICAgICAgdGhpcy5iaW5kRmlsdGVyRmllbGRIYW5kbGVyKGRyb3Bkb3duRmlsdGVyRmllbGRzLCBmYWxzZSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBiaW5kRmlsdGVyRmllbGRIYW5kbGVyKGZpbHRlckZpZWxkczogYW55LCBoaWRlUGFuZWwgPSB0cnVlKSB7XHJcbiAgICAgICAgaWYgKGZpbHRlckZpZWxkcyAmJiBmaWx0ZXJGaWVsZHMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGZpbHRlckZpZWxkcy5mb3JFYWNoKGZmID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyLmxpc3RlbihmZiwgJ2NsaWNrJywgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlRmlsdGVyRmllbGQoZmYsIGhpZGVQYW5lbCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgcmVtb3ZlRmlsdGVyRmllbGQoZmY6IGFueSwgaGlkZVBhbmVsID0gdHJ1ZSkge1xyXG4gICAgICAgIGNvbnN0IGZpZWxkID0gZmYuY2xhc3NMaXN0WzFdLnJlcGxhY2UoJ2ZpbHRlci1jb2x1bW4tJywgJycpO1xyXG4gICAgICAgIGRlbGV0ZSB0aGlzLmRnLmNvbmRpdGlvbnNbZmllbGRdO1xyXG4gICAgICAgIHRoaXMuZGZycy5yZW1vdmVGaWx0ZXJGaWVsZChmaWVsZCk7XHJcbiAgICAgICAgZmYucmVtb3ZlKCk7XHJcbiAgICAgICAgaWYgKGhpZGVQYW5lbCkge1xyXG4gICAgICAgICAgICB0aGlzLm9wZW5GaWx0ZXJQYW5lbCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUV4cGFuZFN0YXRlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgdXBkYXRlRXhwYW5kU3RhdGUoKSB7XHJcbiAgICAgICAgdGhpcy5zaG93RXhwYW5kID0gdGhpcy5pc1Nob3dFeHBhbmQoKTtcclxuICAgIH1cclxuXHJcbiAgICBpc1Nob3dFeHBhbmQoKSB7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmZpbHRlclRleHRDb250YWluZXJXaWR0aCA+IHRoaXMuZmlsdGVyVGV4dFJlYWxXaWR0aCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmZpbHRlclRleHRSZWFsV2lkdGggPiB0aGlzLmZpbHRlclRleHRDb250YWluZXJXaWR0aCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNsZWFyRmlsdGVyKCRldmVudCkge1xyXG4gICAgICAgIHRoaXMuZmlsdGVyVGV4dCA9IHRoaXMuZW1wdHk7XHJcbiAgICAgICAgdGhpcy5kZ3Mub25DbGVhckZpbHRlcigpO1xyXG4gICAgICAgIHRoaXMuZGdzLm9uRmlsdGVyQ2hhbmdlZC5lbWl0KHt9KTtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgcmVmcmVzaEZpbHRlcigkZXZlbnQpIHtcclxuICAgICAgICB0aGlzLmRnLmZpbHRlckRhdGEoKTtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgc2hvd0ZpbHRlclRleHRQYW5lbCgpIHtcclxuICAgICAgICB0aGlzLm9wZW5GaWx0ZXJQYW5lbCA9ICF0aGlzLm9wZW5GaWx0ZXJQYW5lbDtcclxuICAgICAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcclxuICAgIH1cclxufVxyXG4iXX0=