import { Modification, ModifyType } from '../changeset/index';
import { Subject } from 'rxjs';
import { Entity, FieldMetadataUtil, EntityList } from '../entity/index';
// tslint:disable: no-bitwise
/**
 * 实体集合
 * @todo：应该用EntityList代替。
 */
var EntityCollection = /** @class */ (function () {
    /**
     * 构造函数
     */
    function EntityCollection(entityType) {
        this.innerEntitySet = new Set();
        this.innerEntityMap = new Map();
        this.collectionChanged = new Subject();
        this.changes = new Subject();
        this.entityType = entityType;
        this.primaryKey = FieldMetadataUtil.getPrimaryKey(this.entityType) || entityType.prototype.primaryKey;
    }
    /**
     * 实体数量
     */
    EntityCollection.prototype.count = function () {
        return this.innerEntitySet.size;
    };
    Object.defineProperty(EntityCollection.prototype, "entityTypeName", {
        get: function () {
            return this.entityType.name;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * 是否包含指定主键值的实体
     * @param id 主键值
     */
    EntityCollection.prototype.has = function (id) {
        return this.innerEntityMap.has(id);
    };
    /**
     * 清空全部实体
     */
    EntityCollection.prototype.clear = function () {
        this.innerEntityMap.clear();
        this.innerEntitySet.clear();
        this.notifyCollectionChanged(new Modification([], ModifyType.Load));
    };
    /**
     * 清空全部实体
     * @param isReset 是否为重置实体操作
     */
    EntityCollection.prototype.reset = function (notify) {
        if (notify === void 0) { notify = true; }
        this.innerEntityMap.forEach(function (entity) {
            entity.unsubscribe.next();
            entity.unsubscribe.complete();
        });
        this.innerEntitySet.forEach(function (entity) {
            entity.unsubscribe.next();
            entity.unsubscribe.complete();
        });
        this.innerEntityMap.clear();
        this.innerEntitySet.clear();
        if (notify === true) {
            var modification = new Modification([], ModifyType.Load);
            modification.isReset = true;
            this.notifyCollectionChanged(modification);
        }
    };
    /**
     * 转换为实体数组
     */
    EntityCollection.prototype.toArray = function () {
        return Array.from(this.innerEntitySet);
    };
    /**
     * 转换为JSON数组
     */
    EntityCollection.prototype.toJSON = function () {
        var result = [];
        var entities = this.toArray();
        entities.forEach(function (entity) {
            result.push(entity.toJSON());
        });
        return result;
    };
    /**
     * 批量加载实体
     */
    EntityCollection.prototype.loadEntities = function (entities, entityCreate) {
        var _this = this;
        if (entityCreate === void 0) { entityCreate = false; }
        this.innerEntityMap.clear();
        this.innerEntitySet.clear();
        entities.forEach(function (entity) {
            _this.innerEntitySet.add(entity);
            _this.innerEntityMap.set(entity[_this.primaryKey], entity);
            _this.listenEntityChangeEvent(entity);
        });
        var modification = new Modification(entities, ModifyType.Load);
        modification.entityCreate = entityCreate;
        this.notifyCollectionChanged(modification);
    };
    /**
     * 追加实体
     * @param entity 要追加的实体
     * @param isCloned 实体是否是克隆的
     */
    EntityCollection.prototype.addEntity = function (entity, isCloned) {
        if (isCloned === void 0) { isCloned = false; }
        this.verifyEntityToAdd(entity);
        this.innerEntitySet.add(entity);
        this.innerEntityMap.set(entity[this.primaryKey], entity);
        this.listenEntityChangeEvent(entity);
        var modifyType = isCloned ? ModifyType.Clone : ModifyType.Add;
        this.notifyCollectionChanged(new Modification([entity], modifyType));
    };
    /**
     * 在当前行前或后插入数据
     * @param entity 实体
     * @param position 位置
     */
    EntityCollection.prototype.insertEntity = function (entity, position) {
        this.verifyEntityToAdd(entity);
        this.innerEntitySet.add(entity);
        this.innerEntityMap.set(entity[this.primaryKey], entity);
        this.listenEntityChangeEvent(entity);
        this.notifyCollectionChanged(new Modification(entity, ModifyType.Insert, null, null, position));
    };
    /**
     * 更新实体
     * @param entity entity
     * @param data 实体数据
     */
    EntityCollection.prototype.updateEntity = function (entity, data) {
        entity.load(data);
        this.notifyCollectionChanged(new Modification(data, ModifyType.Update, null, null));
    };
    /**
     * 批量追加实体
     * @param entities 要加载的实体数组
     */
    EntityCollection.prototype.addEntities = function (entities) {
        var _this = this;
        if (!entities) {
            return;
        }
        var entitiesToAdd = [];
        entities.forEach(function (entity) {
            _this.verifyEntityToAdd(entity);
            entitiesToAdd.push(entity);
        });
        entitiesToAdd.forEach(function (entity) {
            _this.innerEntitySet.add(entity);
            _this.innerEntityMap.set(entity[_this.primaryKey], entity);
            _this.listenEntityChangeEvent(entity);
        });
        this.notifyCollectionChanged(new Modification(entitiesToAdd, ModifyType.Add));
    };
    /**
     * 添加实体（不切换当前行）
     * @param entities 实体
     */
    EntityCollection.prototype.addData = function (entities) {
        var _this = this;
        if (!entities) {
            return;
        }
        var entitiesToAdd = [];
        entities.forEach(function (entity) {
            _this.verifyEntityToAdd(entity);
            entitiesToAdd.push(entity);
        });
        entitiesToAdd.forEach(function (entity) {
            _this.innerEntitySet.add(entity);
            _this.innerEntityMap.set(entity[_this.primaryKey], entity);
            _this.listenEntityChangeEvent(entity);
        });
        this.notifyCollectionChanged(new Modification(entitiesToAdd, ModifyType.AddData));
    };
    /**
     * 根据主键值获取实体
     */
    EntityCollection.prototype.getEntityById = function (identity) {
        if (this.innerEntityMap.has(identity) === false) {
            return null;
        }
        var entity = this.innerEntityMap.get(identity);
        return entity;
    };
    /**
     * 根据路径获取实体
     */
    EntityCollection.prototype.getEntityByPath = function (pathArray) {
        var rootEntityId = pathArray[0].split(':')[1];
        var parentNode = this.getEntityById(rootEntityId);
        for (var i = 1; i < pathArray.length && parentNode; i = i + 1) {
            var currentPath = pathArray[i];
            if ((parentNode instanceof Entity) || (parentNode.typeName === 'ConcreteEntityPrototype')) {
                // @todo：强识了别冒号
                if (currentPath.indexOf(':') === -1) {
                    parentNode = parentNode[pathArray[i]];
                }
            }
            else {
                parentNode = parentNode.get(pathArray[i].split(':')[1]);
            }
        }
        return parentNode;
    };
    /**
     * id:1/a/id:2/c
     * @param pathArray 路径数组
     */
    EntityCollection.prototype.getEntitiesByPath = function (pathArray) {
        var rootEntityId = pathArray[0].split(':')[1];
        var entity = this.getEntityById(rootEntityId);
        for (var i = 1; i < pathArray.length && entity; i += 2) {
            var path = pathArray[i];
            entity = entity[path];
            if (!(entity instanceof EntityList)) {
                throw new Error('路径格式错误');
            }
            if ((i + 1) < pathArray.length) {
                var id = pathArray[i + 1].split(':')[1];
                entity = entity.get(id);
            }
        }
        return entity;
    };
    /**
     * 返回符合指定条件的实体集合
     * @param predicate 条件谓词
     */
    EntityCollection.prototype.getEntities = function (predicate) {
        var entities = Array.from(this.innerEntitySet);
        var matchedEntities = entities.filter(predicate);
        return matchedEntities;
    };
    /**
     * 获取全部实体
     */
    EntityCollection.prototype.getAllEntities = function () {
        return Array.from(this.innerEntitySet);
    };
    /**
     * 根据主键值删除对应实体
     * @param identity 主键值
     */
    EntityCollection.prototype.removeEntityById = function (identity) {
        this.verifyEntityToRemove(identity);
        var entityToRemove = this.innerEntityMap.get(identity);
        this.innerEntityMap.delete(identity);
        this.innerEntitySet.delete(entityToRemove);
        this.notifyCollectionChanged(new Modification([entityToRemove], ModifyType.Remove));
        return entityToRemove;
    };
    EntityCollection.prototype.removeEntitiesByIds = function (id) {
    };
    /**
     * 删除符合条件的实体集合
     */
    EntityCollection.prototype.removeEntities = function (predicate) {
        var _this = this;
        var entitiesToRemove = Array.from(this.innerEntitySet).filter(predicate);
        entitiesToRemove.forEach(function (entityToRemove) {
            _this.innerEntityMap.delete(entityToRemove[_this.primaryKey]);
            _this.innerEntitySet.delete(entityToRemove);
        });
        this.notifyCollectionChanged(new Modification(entitiesToRemove, ModifyType.Remove));
        return entitiesToRemove;
    };
    /**
     * 移除数据（不切换当前行）
     * @param predicate 过滤函数
     */
    EntityCollection.prototype.removeData = function (predicate) {
        var _this = this;
        var entitiesToRemove = Array.from(this.innerEntitySet).filter(predicate);
        entitiesToRemove.forEach(function (entityToRemove) {
            _this.innerEntityMap.delete(entityToRemove[_this.primaryKey]);
            _this.innerEntitySet.delete(entityToRemove);
        });
        this.notifyCollectionChanged(new Modification(entitiesToRemove, ModifyType.RemoveData));
        return entitiesToRemove;
    };
    /**
     * 重置子表数据
     * @param paths 路径
     * 路径格式 ['id:provinceId','id:cityMDMs','zoneMDMs']
     * @description path参数格式
     * ```json
     * [
     * "id:b5ed23ca-88d9-4377-98ec-92f35c1325f1",
     * "cityMDMs",
     * "id:373706af-622f-4aea-a006-dddbffd7bda3",
     * "zoneMDMs"
     * ]
     * ```
     * @param entities 实体数组
     */
    EntityCollection.prototype.resetEntities = function (paths, entities) {
        if (paths[0].indexOf(':') === -1) {
            throw new Error('路径格式错误');
        }
        // 获取主实体
        var id = paths[0].split(':')[1];
        var entity = this.innerEntityMap.get(id);
        var entityList = entity[paths[1]];
        if (!entity) {
            throw new Error("\u627E\u4E0D\u5230\u4E3B\u952E\u4E3A" + id + "\u7684\u5B9E\u4F53");
        }
        for (var index = 2; index < paths.length; index += 2) {
            var pathInfo = paths[index].split(':');
            var entityId = pathInfo[1];
            // 获取到当前层级的实体
            entity = entityList.get(entityId);
            if (!entity) {
                throw new Error("\u627E\u4E0D\u5230\u4E3B\u952E\u4E3A" + id + "\u7684\u5B9E\u4F53");
            }
            // 获取当前层级实体下的列表属性
            entityList = entity[paths[index + 1]];
        }
        entityList.clear();
        entityList.loadEntities(entities);
    };
    /**
     * 验证实体是否能够添加
     */
    EntityCollection.prototype.verifyEntityToAdd = function (entity) {
        if (this.has(entity[this.primaryKey])) {
            throw new Error("The repository already had an item with the save identity of '" + entity[this.primaryKey] + "'");
        }
        return true;
    };
    /**
     * 验证实体是否能移除
     */
    EntityCollection.prototype.verifyEntityToRemove = function (identity) {
        if (!this.has(identity)) {
            throw new Error("The entity with identity of '" + identity + " dose not exsit.'");
        }
        return true;
    };
    /**
     * 实体集合变更流
     */
    EntityCollection.prototype.notifyCollectionChanged = function (modification) {
        this.collectionChanged.next(modification);
    };
    EntityCollection.prototype.listenEntityChangeEvent = function (entity) {
        var _this = this;
        if (entity) {
            entity.onValueChanged.subscribe(function (change) { return _this.changes.next(change); });
        }
    };
    Object.defineProperty(EntityCollection.prototype, "pageSize", {
        /**
         * 获取分页大小
         * @description 如果用户未指定分页大小则默认为0，即获取所有数据
         */
        get: function () {
            if (!!this.paginationInfo) {
                return this.paginationInfo.pageSize || 0;
            }
            return 0;
        },
        //#region 分页
        /**
         * 设置分页大小
         */
        set: function (pageSize) {
            if (typeof (pageSize) !== 'number' || pageSize < 0) {
                throw new Error('Invalid parameter:pageSize');
            }
            var original = this.paginationInfo;
            // const entityPaginationInfo = Object.assign({}, original[this.entityTypeName], { pageSize });
            // this.paginationInfo = Object.assign({}, original, { [this.entityTypeName]: entityPaginationInfo });
            // this.notifyCollectionChanged(new Modification(this.paginationInfo[this.entityTypeName], ModifyType.PaginationInfoChange));
            this.paginationInfo = Object.assign({}, original, { pageSize: pageSize });
            this.notifyCollectionChanged(new Modification(this.paginationInfo, ModifyType.PaginationInfoChange));
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(EntityCollection.prototype, "totalCount", {
        /**
         * 获取数据总条数
         */
        get: function () {
            if (!!this.paginationInfo) {
                return this.paginationInfo.total || 0;
            }
            return 0;
        },
        /**
         * 设置数据总条数
         */
        set: function (total) {
            if (typeof (total) !== 'number' || total < 0) {
                throw new Error('Invalid parameter:total');
            }
            var original = this.paginationInfo;
            // const entityPaginationInfo = Object.assign({}, original[this.entityTypeName], { total });
            // this.paginationInfo = Object.assign({}, original, { [this.entityTypeName]: entityPaginationInfo });
            this.paginationInfo = Object.assign({}, original, { total: total });
            this.notifyCollectionChanged(new Modification(this.paginationInfo, ModifyType.PaginationInfoChange));
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(EntityCollection.prototype, "pageIndex", {
        /**
         * 获取当前页码
         */
        get: function () {
            if (!!this.paginationInfo) {
                return this.paginationInfo.pageIndex || 1;
            }
            return 1;
        },
        /**
         * 设置当前页码
         */
        set: function (pageIndex) {
            if (typeof (pageIndex) !== 'number' || pageIndex < 0) {
                throw new Error('Invalid parameter:pageIndex');
            }
            var original = this.paginationInfo;
            // const entityPaginationInfo = Object.assign({}, original[this.entityTypeName], { pageIndex });
            // this.paginationInfo = Object.assign({}, original, { [this.entityTypeName]: entityPaginationInfo });
            this.paginationInfo = Object.assign({}, original, { pageIndex: pageIndex });
            this.notifyCollectionChanged(new Modification(this.paginationInfo, ModifyType.PaginationInfoChange));
        },
        enumerable: true,
        configurable: true
    });
    /**
     * 更新分页信息
     * @param path 绑定路径
     * @param pageInfo 分页信息
     */
    EntityCollection.prototype.updatePaginationInfoByPath = function (path, pageInfo) {
        var original = this.paginationInfo;
        var pageIndex = pageInfo.pageIndex, pageSize = pageInfo.pageSize;
        var total = pageInfo && (pageInfo.totalCount || pageInfo.total) || 0;
        var paginationInfo = Object.assign({}, original, { pageIndex: pageIndex, pageSize: pageSize, total: total });
        this.setPaginationConfigByPath(path, paginationInfo);
    };
    /**
     * 根据路径获取分页大小
     * @param path 路径
     */
    EntityCollection.prototype.getPaginationConfigByPath = function (path, defaultValue) {
        if (!path || path === '/') {
            return this.paginationInfo;
        }
        if (typeof path !== 'string') {
            throw new Error('路径必须为字符串！');
        }
        var paths = path.split('/').filter(function (item) { return !!item && item.trim().length > 0; }).map(function (item) { return item.trim(); });
        var config = this.paginationInfo;
        paths.forEach(function (item) {
            if (config && config.hasOwnProperty(item)) {
                config = config[item];
            }
            else {
                config = null;
            }
        });
        return !!config ? config : typeof defaultValue !== 'undefined' ? defaultValue : undefined;
    };
    /**
     * 设置分页信息
     * @param path 路径
     * @param value 值，其中总条数key为total
     */
    EntityCollection.prototype.setPaginationConfigByPath = function (path, value) {
        var original = JSON.stringify(this.paginationInfo);
        if (!path || path === '/') {
            this.paginationInfo = value;
        }
        else {
            if (!Array.isArray(path)) {
                path = path.toString().match(/[^/[\]]+/g) || [];
            }
            path.slice(0, -1).reduce(function (prev, current, index) {
                return Object(prev[current]) === prev[current]
                    ? prev[current]
                    : prev[current] = Math.abs(path[index + 1]) >> 0 === +path[index + 1]
                        ? []
                        : {};
            }, this.paginationInfo)[path[path.length - 1]] = value;
        }
        if (JSON.stringify(this.paginationInfo) !== original) {
            this.notifyCollectionChanged(new Modification(this.paginationInfo, ModifyType.PaginationInfoChange));
        }
        return this.paginationInfo;
    };
    return EntityCollection;
}());
export { EntityCollection };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW50aXR5X2NvbGxlY3Rpb24uanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2RldmtpdC8iLCJzb3VyY2VzIjpbImxpYi9yZXBvc2l0b3J5L2VudGl0eV9jb2xsZWN0aW9uLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQU9BLE9BQU8sRUFBRSxZQUFZLEVBQUUsVUFBVSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDOUQsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMvQixPQUFPLEVBQUUsTUFBTSxFQUFFLGlCQUFpQixFQUFFLFVBQVUsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ3hFLDZCQUE2QjtBQUM3Qjs7O0dBR0c7QUFDSDtJQWtDRTs7T0FFRztJQUNILDBCQUFZLFVBQWU7UUFDekIsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLEdBQUcsRUFBSyxDQUFDO1FBQ25DLElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxHQUFHLEVBQWEsQ0FBQztRQUMzQyxJQUFJLENBQUMsaUJBQWlCLEdBQUcsSUFBSSxPQUFPLEVBQWdCLENBQUM7UUFDckQsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLE9BQU8sRUFBZ0IsQ0FBQztRQUMzQyxJQUFJLENBQUMsVUFBVSxHQUFHLFVBQVUsQ0FBQztRQUM3QixJQUFJLENBQUMsVUFBVSxHQUFHLGlCQUFpQixDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksVUFBVSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUM7SUFDeEcsQ0FBQztJQUVEOztPQUVHO0lBQ0ksZ0NBQUssR0FBWjtRQUNFLE9BQU8sSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUM7SUFDbEMsQ0FBQztJQUVELHNCQUFXLDRDQUFjO2FBQXpCO1lBQ0UsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQztRQUM5QixDQUFDOzs7T0FBQTtJQUNEOzs7T0FHRztJQUNJLDhCQUFHLEdBQVYsVUFBVyxF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LENBQUMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUM7d0JBQ25FLENBQUMsQ0FBQyxFQUFFO3dCQUNKLENBQUMsQ0FBQyxFQUFFO1lBSlIsQ0FJUSxFQUNSLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLEtBQUssQ0FBQztTQUN2RDtRQUVELElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLEtBQUssUUFBUSxFQUFFO1lBQ3BELElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxJQUFJLFlBQVksQ0FBQyxJQUFJLENBQUMsY0FBYyxFQUFFLFVBQVUsQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDLENBQUM7U0FDdEc7UUFDRCxPQUFPLElBQUksQ0FBQyxjQUFjLENBQUM7SUFDN0IsQ0FBQztJQUVILHVCQUFDO0FBQUQsQ0FBQyxBQTVnQkQsSUE0Z0JDO0FBRUQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxyXG4gKiBAQXV0aG9yOiBXaXR0XHJcbiAqIEBEYXRlOiAyMDE4LTEwLTAxIDE5OjM2OjUxXHJcbiAqIEBMYXN0IE1vZGlmaWVkIGJ5OiBhYWxpenp3ZWxsXHJcbiAqIEBMYXN0IE1vZGlmaWVkIHRpbWU6IDIwMTktMDktMDMgMTk6NDY6NDJcclxuICovXHJcbmltcG9ydCB7IFR5cGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgTW9kaWZpY2F0aW9uLCBNb2RpZnlUeXBlIH0gZnJvbSAnLi4vY2hhbmdlc2V0L2luZGV4JztcclxuaW1wb3J0IHsgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBFbnRpdHksIEZpZWxkTWV0YWRhdGFVdGlsLCBFbnRpdHlMaXN0IH0gZnJvbSAnLi4vZW50aXR5L2luZGV4JztcclxuLy8gdHNsaW50OmRpc2FibGU6IG5vLWJpdHdpc2VcclxuLyoqXHJcbiAqIOWunuS9k+mbhuWQiFxyXG4gKiBAdG9kb++8muW6lOivpeeUqEVudGl0eUxpc3Tku6Pmm7/jgIJcclxuICovXHJcbmNsYXNzIEVudGl0eUNvbGxlY3Rpb248VCBleHRlbmRzIEVudGl0eT4ge1xyXG5cclxuICAvKipcclxuICAgKiDlhoXpg6jlrp7kvZNTZXRcclxuICAgKi9cclxuICBwcml2YXRlIGlubmVyRW50aXR5U2V0OiBTZXQ8VD47XHJcblxyXG4gIC8qKlxyXG4gICAqIOWGhemDqOWunuS9k01hcFxyXG4gICAqL1xyXG4gIHByaXZhdGUgaW5uZXJFbnRpdHlNYXA6IE1hcDxzdHJpbmcsIFQ+O1xyXG4gIHB1YmxpYyBjaGFuZ2VzOiBTdWJqZWN0PE1vZGlmaWNhdGlvbj47XHJcblxyXG4gIC8qKlxyXG4gICAqIEVudGl0eembhuWQiOWPmOabtOa1gVxyXG4gICAqL1xyXG4gIHB1YmxpYyBjb2xsZWN0aW9uQ2hhbmdlZDogU3ViamVjdDxNb2RpZmljYXRpb24+O1xyXG5cclxuICAvKipcclxuICAgKiDlrp7kvZPnsbvlnotcclxuICAgKi9cclxuICBwdWJsaWMgcmVhZG9ubHkgZW50aXR5VHlwZTogVHlwZTxUPjtcclxuXHJcbiAgLyoqXHJcbiAgICog5a6e5L2T5Li76ZSuXHJcbiAgICovXHJcbiAgcHVibGljIHJlYWRvbmx5IHByaW1hcnlLZXk6IHN0cmluZztcclxuXHJcbiAgLyoqXHJcbiAgICog5a6e5L2T5b2T5YmN5YiG6aG15L+h5oGvXHJcbiAgICovXHJcbiAgcHVibGljIHBhZ2luYXRpb25JbmZvOiBhbnk7XHJcblxyXG5cclxuICAvKipcclxuICAgKiDmnoTpgKDlh73mlbBcclxuICAgKi9cclxuICBjb25zdHJ1Y3RvcihlbnRpdHlUeXBlOiBhbnkpIHtcclxuICAgIHRoaXMuaW5uZXJFbnRpdHlTZXQgPSBuZXcgU2V0PFQ+KCk7XHJcbiAgICB0aGlzLmlubmVyRW50aXR5TWFwID0gbmV3IE1hcDxzdHJpbmcsIFQ+KCk7XHJcbiAgICB0aGlzLmNvbGxlY3Rpb25DaGFuZ2VkID0gbmV3IFN1YmplY3Q8TW9kaWZpY2F0aW9uPigpO1xyXG4gICAgdGhpcy5jaGFuZ2VzID0gbmV3IFN1YmplY3Q8TW9kaWZpY2F0aW9uPigpO1xyXG4gICAgdGhpcy5lbnRpdHlUeXBlID0gZW50aXR5VHlwZTtcclxuICAgIHRoaXMucHJpbWFyeUtleSA9IEZpZWxkTWV0YWRhdGFVdGlsLmdldFByaW1hcnlLZXkodGhpcy5lbnRpdHlUeXBlKSB8fCBlbnRpdHlUeXBlLnByb3RvdHlwZS5wcmltYXJ5S2V5O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5a6e5L2T5pWw6YePXHJcbiAgICovXHJcbiAgcHVibGljIGNvdW50KCk6IG51bWJlciB7XHJcbiAgICByZXR1cm4gdGhpcy5pbm5lckVudGl0eVNldC5zaXplO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldCBlbnRpdHlUeXBlTmFtZSgpIHtcclxuICAgIHJldHVybiB0aGlzLmVudGl0eVR5cGUubmFtZTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5piv5ZCm5YyF5ZCr5oyH5a6a5Li76ZSu5YC855qE5a6e5L2TXHJcbiAgICogQHBhcmFtIGlkIOS4u+mUruWAvFxyXG4gICAqL1xyXG4gIHB1YmxpYyBoYXMoaWQ6IHN0cmluZyk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHRoaXMuaW5uZXJFbnRpdHlNYXAuaGFzKGlkKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOa4heepuuWFqOmDqOWunuS9k1xyXG4gICAqL1xyXG4gIHB1YmxpYyBjbGVhcigpIHtcclxuICAgIHRoaXMuaW5uZXJFbnRpdHlNYXAuY2xlYXIoKTtcclxuICAgIHRoaXMuaW5uZXJFbnRpdHlTZXQuY2xlYXIoKTtcclxuICAgIHRoaXMubm90aWZ5Q29sbGVjdGlvbkNoYW5nZWQobmV3IE1vZGlmaWNhdGlvbihbXSwgTW9kaWZ5VHlwZS5Mb2FkKSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOa4heepuuWFqOmDqOWunuS9k1xyXG4gICAqIEBwYXJhbSBpc1Jlc2V0IOaYr+WQpuS4uumHjee9ruWunuS9k+aTjeS9nFxyXG4gICAqL1xyXG4gIHB1YmxpYyByZXNldChub3RpZnk6IGJvb2xlYW4gPSB0cnVlKSB7XHJcbiAgICB0aGlzLmlubmVyRW50aXR5TWFwLmZvckVhY2goZW50aXR5ID0+IHtcclxuICAgICAgZW50aXR5LnVuc3Vic2NyaWJlLm5leHQoKTtcclxuICAgICAgZW50aXR5LnVuc3Vic2NyaWJlLmNvbXBsZXRlKCk7XHJcbiAgICB9KTtcclxuICAgIHRoaXMuaW5uZXJFbnRpdHlTZXQuZm9yRWFjaChlbnRpdHkgPT4ge1xyXG4gICAgICBlbnRpdHkudW5zdWJzY3JpYmUubmV4dCgpO1xyXG4gICAgICBlbnRpdHkudW5zdWJzY3JpYmUuY29tcGxldGUoKTtcclxuICAgIH0pO1xyXG4gICAgdGhpcy5pbm5lckVudGl0eU1hcC5jbGVhcigpO1xyXG4gICAgdGhpcy5pbm5lckVudGl0eVNldC5jbGVhcigpO1xyXG4gICAgaWYgKG5vdGlmeSA9PT0gdHJ1ZSkge1xyXG4gICAgICBjb25zdCBtb2RpZmljYXRpb24gPSBuZXcgTW9kaWZpY2F0aW9uKFtdLCBNb2RpZnlUeXBlLkxvYWQpO1xyXG4gICAgICBtb2RpZmljYXRpb24uaXNSZXNldCA9IHRydWU7XHJcbiAgICAgIHRoaXMubm90aWZ5Q29sbGVjdGlvbkNoYW5nZWQobW9kaWZpY2F0aW9uKTtcclxuICAgIH1cclxuICB9XHJcbiAgLyoqXHJcbiAgICog6L2s5o2i5Li65a6e5L2T5pWw57uEXHJcbiAgICovXHJcbiAgcHVibGljIHRvQXJyYXkoKTogRW50aXR5W10ge1xyXG4gICAgcmV0dXJuIEFycmF5LmZyb20odGhpcy5pbm5lckVudGl0eVNldCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDovazmjaLkuLpKU09O5pWw57uEXHJcbiAgICovXHJcbiAgcHVibGljIHRvSlNPTigpOiBhbnlbXSB7XHJcbiAgICBjb25zdCByZXN1bHQgPSBbXTtcclxuICAgIGNvbnN0IGVudGl0aWVzID0gdGhpcy50b0FycmF5KCk7XHJcbiAgICBlbnRpdGllcy5mb3JFYWNoKChlbnRpdHk6IEVudGl0eSkgPT4ge1xyXG4gICAgICByZXN1bHQucHVzaChlbnRpdHkudG9KU09OKCkpO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5om56YeP5Yqg6L295a6e5L2TXHJcbiAgICovXHJcbiAgcHVibGljIGxvYWRFbnRpdGllcyhlbnRpdGllczogYW55W10sIGVudGl0eUNyZWF0ZTogYm9vbGVhbiA9IGZhbHNlKSB7XHJcbiAgICB0aGlzLmlubmVyRW50aXR5TWFwLmNsZWFyKCk7XHJcbiAgICB0aGlzLmlubmVyRW50aXR5U2V0LmNsZWFyKCk7XHJcblxyXG4gICAgZW50aXRpZXMuZm9yRWFjaChlbnRpdHkgPT4ge1xyXG4gICAgICB0aGlzLmlubmVyRW50aXR5U2V0LmFkZChlbnRpdHkpO1xyXG4gICAgICB0aGlzLmlubmVyRW50aXR5TWFwLnNldChlbnRpdHlbdGhpcy5wcmltYXJ5S2V5XSwgZW50aXR5KTtcclxuICAgICAgdGhpcy5saXN0ZW5FbnRpdHlDaGFuZ2VFdmVudChlbnRpdHkpO1xyXG4gICAgfSk7XHJcbiAgICBjb25zdCBtb2RpZmljYXRpb24gPSBuZXcgTW9kaWZpY2F0aW9uKGVudGl0aWVzLCBNb2RpZnlUeXBlLkxvYWQpO1xyXG4gICAgbW9kaWZpY2F0aW9uLmVudGl0eUNyZWF0ZSA9IGVudGl0eUNyZWF0ZTtcclxuICAgIHRoaXMubm90aWZ5Q29sbGVjdGlvbkNoYW5nZWQobW9kaWZpY2F0aW9uKTtcclxuXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDov73liqDlrp7kvZNcclxuICAgKiBAcGFyYW0gZW50aXR5IOimgei/veWKoOeahOWunuS9k1xyXG4gICAqIEBwYXJhbSBpc0Nsb25lZCDlrp7kvZPmmK/lkKbmmK/lhYvpmobnmoRcclxuICAgKi9cclxuICBwdWJsaWMgYWRkRW50aXR5KGVudGl0eTogYW55LCBpc0Nsb25lZDogYm9vbGVhbiA9IGZhbHNlKSB7XHJcbiAgICB0aGlzLnZlcmlmeUVudGl0eVRvQWRkKGVudGl0eSk7XHJcbiAgICB0aGlzLmlubmVyRW50aXR5U2V0LmFkZChlbnRpdHkpO1xyXG4gICAgdGhpcy5pbm5lckVudGl0eU1hcC5zZXQoZW50aXR5W3RoaXMucHJpbWFyeUtleV0sIGVudGl0eSk7XHJcbiAgICB0aGlzLmxpc3RlbkVudGl0eUNoYW5nZUV2ZW50KGVudGl0eSk7XHJcbiAgICBjb25zdCBtb2RpZnlUeXBlID0gaXNDbG9uZWQgPyBNb2RpZnlUeXBlLkNsb25lIDogTW9kaWZ5VHlwZS5BZGQ7XHJcbiAgICB0aGlzLm5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkKG5ldyBNb2RpZmljYXRpb24oW2VudGl0eV0sIG1vZGlmeVR5cGUpKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5Zyo5b2T5YmN6KGM5YmN5oiW5ZCO5o+S5YWl5pWw5o2uXHJcbiAgICogQHBhcmFtIGVudGl0eSDlrp7kvZNcclxuICAgKiBAcGFyYW0gcG9zaXRpb24g5L2N572uXHJcbiAgICovXHJcbiAgcHVibGljIGluc2VydEVudGl0eShlbnRpdHk6IGFueSwgcG9zaXRpb246IDEgfCAtMSkge1xyXG4gICAgdGhpcy52ZXJpZnlFbnRpdHlUb0FkZChlbnRpdHkpO1xyXG4gICAgdGhpcy5pbm5lckVudGl0eVNldC5hZGQoZW50aXR5KTtcclxuICAgIHRoaXMuaW5uZXJFbnRpdHlNYXAuc2V0KGVudGl0eVt0aGlzLnByaW1hcnlLZXldLCBlbnRpdHkpO1xyXG4gICAgdGhpcy5saXN0ZW5FbnRpdHlDaGFuZ2VFdmVudChlbnRpdHkpO1xyXG4gICAgdGhpcy5ub3RpZnlDb2xsZWN0aW9uQ2hhbmdlZChuZXcgTW9kaWZpY2F0aW9uKGVudGl0eSwgTW9kaWZ5VHlwZS5JbnNlcnQsIG51bGwsIG51bGwsIHBvc2l0aW9uKSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOabtOaWsOWunuS9k1xyXG4gICAqIEBwYXJhbSBlbnRpdHkgZW50aXR5XHJcbiAgICogQHBhcmFtIGRhdGEg5a6e5L2T5pWw5o2uXHJcbiAgICovXHJcbiAgcHVibGljIHVwZGF0ZUVudGl0eShlbnRpdHk6IGFueSwgZGF0YTogYW55KSB7XHJcbiAgICBlbnRpdHkubG9hZChkYXRhKTtcclxuICAgIHRoaXMubm90aWZ5Q29sbGVjdGlvbkNoYW5nZWQobmV3IE1vZGlmaWNhdGlvbihkYXRhLCBNb2RpZnlUeXBlLlVwZGF0ZSwgbnVsbCwgbnVsbCkpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmibnph4/ov73liqDlrp7kvZNcclxuICAgKiBAcGFyYW0gZW50aXRpZXMg6KaB5Yqg6L2955qE5a6e5L2T5pWw57uEXHJcbiAgICovXHJcbiAgcHVibGljIGFkZEVudGl0aWVzKGVudGl0aWVzOiBhbnlbXSkge1xyXG4gICAgaWYgKCFlbnRpdGllcykge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBjb25zdCBlbnRpdGllc1RvQWRkOiBhbnlbXSA9IFtdO1xyXG4gICAgZW50aXRpZXMuZm9yRWFjaChlbnRpdHkgPT4ge1xyXG4gICAgICB0aGlzLnZlcmlmeUVudGl0eVRvQWRkKGVudGl0eSk7XHJcbiAgICAgIGVudGl0aWVzVG9BZGQucHVzaChlbnRpdHkpO1xyXG4gICAgfSk7XHJcbiAgICBlbnRpdGllc1RvQWRkLmZvckVhY2goZW50aXR5ID0+IHtcclxuICAgICAgdGhpcy5pbm5lckVudGl0eVNldC5hZGQoZW50aXR5KTtcclxuICAgICAgdGhpcy5pbm5lckVudGl0eU1hcC5zZXQoZW50aXR5W3RoaXMucHJpbWFyeUtleV0sIGVudGl0eSk7XHJcbiAgICAgIHRoaXMubGlzdGVuRW50aXR5Q2hhbmdlRXZlbnQoZW50aXR5KTtcclxuICAgIH0pO1xyXG4gICAgdGhpcy5ub3RpZnlDb2xsZWN0aW9uQ2hhbmdlZChuZXcgTW9kaWZpY2F0aW9uKGVudGl0aWVzVG9BZGQsIE1vZGlmeVR5cGUuQWRkKSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOa3u+WKoOWunuS9k++8iOS4jeWIh+aNouW9k+WJjeihjO+8iVxyXG4gICAqIEBwYXJhbSBlbnRpdGllcyDlrp7kvZNcclxuICAgKi9cclxuICBwdWJsaWMgYWRkRGF0YShlbnRpdGllczogYW55W10pIHtcclxuICAgIGlmICghZW50aXRpZXMpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgY29uc3QgZW50aXRpZXNUb0FkZDogYW55W10gPSBbXTtcclxuICAgIGVudGl0aWVzLmZvckVhY2goZW50aXR5ID0+IHtcclxuICAgICAgdGhpcy52ZXJpZnlFbnRpdHlUb0FkZChlbnRpdHkpO1xyXG4gICAgICBlbnRpdGllc1RvQWRkLnB1c2goZW50aXR5KTtcclxuICAgIH0pO1xyXG4gICAgZW50aXRpZXNUb0FkZC5mb3JFYWNoKGVudGl0eSA9PiB7XHJcbiAgICAgIHRoaXMuaW5uZXJFbnRpdHlTZXQuYWRkKGVudGl0eSk7XHJcbiAgICAgIHRoaXMuaW5uZXJFbnRpdHlNYXAuc2V0KGVudGl0eVt0aGlzLnByaW1hcnlLZXldLCBlbnRpdHkpO1xyXG4gICAgICB0aGlzLmxpc3RlbkVudGl0eUNoYW5nZUV2ZW50KGVudGl0eSk7XHJcbiAgICB9KTtcclxuICAgIHRoaXMubm90aWZ5Q29sbGVjdGlvbkNoYW5nZWQobmV3IE1vZGlmaWNhdGlvbihlbnRpdGllc1RvQWRkLCBNb2RpZnlUeXBlLkFkZERhdGEpKTtcclxuICB9XHJcblxyXG5cclxuICAvKipcclxuICAgKiDmoLnmja7kuLvplK7lgLzojrflj5blrp7kvZNcclxuICAgKi9cclxuICBnZXRFbnRpdHlCeUlkKGlkZW50aXR5OiBzdHJpbmcpOiBhbnkge1xyXG4gICAgaWYgKHRoaXMuaW5uZXJFbnRpdHlNYXAuaGFzKGlkZW50aXR5KSA9PT0gZmFsc2UpIHtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcbiAgICBjb25zdCBlbnRpdHkgPSB0aGlzLmlubmVyRW50aXR5TWFwLmdldChpZGVudGl0eSk7XHJcbiAgICByZXR1cm4gZW50aXR5O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5qC55o2u6Lev5b6E6I635Y+W5a6e5L2TXHJcbiAgICovXHJcbiAgZ2V0RW50aXR5QnlQYXRoKHBhdGhBcnJheTogc3RyaW5nW10pOiBhbnkge1xyXG4gICAgY29uc3Qgcm9vdEVudGl0eUlkID0gcGF0aEFycmF5WzBdLnNwbGl0KCc6JylbMV07XHJcbiAgICBsZXQgcGFyZW50Tm9kZTogYW55ID0gdGhpcy5nZXRFbnRpdHlCeUlkKHJvb3RFbnRpdHlJZCk7XHJcbiAgICBmb3IgKGxldCBpID0gMTsgaSA8IHBhdGhBcnJheS5sZW5ndGggJiYgcGFyZW50Tm9kZTsgaSA9IGkgKyAxKSB7XHJcbiAgICAgIGNvbnN0IGN1cnJlbnRQYXRoID0gcGF0aEFycmF5W2ldO1xyXG4gICAgICBpZiAoKHBhcmVudE5vZGUgaW5zdGFuY2VvZiBFbnRpdHkpIHx8IChcclxuICAgICAgICBwYXJlbnROb2RlLnR5cGVOYW1lID09PSAnQ29uY3JldGVFbnRpdHlQcm90b3R5cGUnKVxyXG4gICAgICApIHtcclxuICAgICAgICAvLyBAdG9kb++8muW8uuivhuS6huWIq+WGkuWPt1xyXG4gICAgICAgIGlmIChjdXJyZW50UGF0aC5pbmRleE9mKCc6JykgPT09IC0xKSB7XHJcbiAgICAgICAgICBwYXJlbnROb2RlID0gcGFyZW50Tm9kZVtwYXRoQXJyYXlbaV1dO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBwYXJlbnROb2RlID0gcGFyZW50Tm9kZS5nZXQocGF0aEFycmF5W2ldLnNwbGl0KCc6JylbMV0pO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcGFyZW50Tm9kZTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICogaWQ6MS9hL2lkOjIvY1xyXG4gICAqIEBwYXJhbSBwYXRoQXJyYXkg6Lev5b6E5pWw57uEXHJcbiAgICovXHJcbiAgcHVibGljIGdldEVudGl0aWVzQnlQYXRoKHBhdGhBcnJheTogc3RyaW5nW10pIHtcclxuICAgIGNvbnN0IHJvb3RFbnRpdHlJZCA9IHBhdGhBcnJheVswXS5zcGxpdCgnOicpWzFdO1xyXG4gICAgbGV0IGVudGl0eTogYW55ID0gdGhpcy5nZXRFbnRpdHlCeUlkKHJvb3RFbnRpdHlJZCk7XHJcbiAgICBmb3IgKGxldCBpID0gMTsgaSA8IHBhdGhBcnJheS5sZW5ndGggJiYgZW50aXR5OyBpICs9IDIpIHtcclxuICAgICAgY29uc3QgcGF0aCA9IHBhdGhBcnJheVtpXTtcclxuICAgICAgZW50aXR5ID0gZW50aXR5W3BhdGhdO1xyXG4gICAgICBpZiAoIShlbnRpdHkgaW5zdGFuY2VvZiBFbnRpdHlMaXN0KSkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcign6Lev5b6E5qC85byP6ZSZ6K+vJyk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKChpICsgMSkgPCBwYXRoQXJyYXkubGVuZ3RoKSB7XHJcbiAgICAgICAgY29uc3QgaWQgPSBwYXRoQXJyYXlbaSArIDFdLnNwbGl0KCc6JylbMV07XHJcbiAgICAgICAgZW50aXR5ID0gZW50aXR5LmdldChpZCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBlbnRpdHk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOi/lOWbnuespuWQiOaMh+WumuadoeS7tueahOWunuS9k+mbhuWQiFxyXG4gICAqIEBwYXJhbSBwcmVkaWNhdGUg5p2h5Lu26LCT6K+NXHJcbiAgICovXHJcbiAgZ2V0RW50aXRpZXMocHJlZGljYXRlOiAodmFsdWU6IGFueSwgaW5kZXg6IG51bWJlciwgYXJyYXk6IGFueVtdKSA9PiBhbnkpOiBhbnlbXSB7XHJcbiAgICBjb25zdCBlbnRpdGllczogYW55W10gPSBBcnJheS5mcm9tKHRoaXMuaW5uZXJFbnRpdHlTZXQpO1xyXG4gICAgY29uc3QgbWF0Y2hlZEVudGl0aWVzID0gZW50aXRpZXMuZmlsdGVyKHByZWRpY2F0ZSk7XHJcbiAgICByZXR1cm4gbWF0Y2hlZEVudGl0aWVzO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+W5YWo6YOo5a6e5L2TXHJcbiAgICovXHJcbiAgZ2V0QWxsRW50aXRpZXMoKTogYW55W10ge1xyXG4gICAgcmV0dXJuIEFycmF5LmZyb20odGhpcy5pbm5lckVudGl0eVNldCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmoLnmja7kuLvplK7lgLzliKDpmaTlr7nlupTlrp7kvZNcclxuICAgKiBAcGFyYW0gaWRlbnRpdHkg5Li76ZSu5YC8XHJcbiAgICovXHJcbiAgcmVtb3ZlRW50aXR5QnlJZChpZGVudGl0eTogc3RyaW5nKTogYW55IHtcclxuICAgIHRoaXMudmVyaWZ5RW50aXR5VG9SZW1vdmUoaWRlbnRpdHkpO1xyXG4gICAgY29uc3QgZW50aXR5VG9SZW1vdmUgPSB0aGlzLmlubmVyRW50aXR5TWFwLmdldChpZGVudGl0eSk7XHJcbiAgICB0aGlzLmlubmVyRW50aXR5TWFwLmRlbGV0ZShpZGVudGl0eSk7XHJcbiAgICB0aGlzLmlubmVyRW50aXR5U2V0LmRlbGV0ZShlbnRpdHlUb1JlbW92ZSk7XHJcbiAgICB0aGlzLm5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkKG5ldyBNb2RpZmljYXRpb24oW2VudGl0eVRvUmVtb3ZlXSwgTW9kaWZ5VHlwZS5SZW1vdmUpKTtcclxuICAgIHJldHVybiBlbnRpdHlUb1JlbW92ZTtcclxuICB9XHJcblxyXG4gIHJlbW92ZUVudGl0aWVzQnlJZHMoaWQ6IHN0cmluZykge1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Yig6Zmk56ym5ZCI5p2h5Lu255qE5a6e5L2T6ZuG5ZCIXHJcbiAgICovXHJcbiAgcHVibGljIHJlbW92ZUVudGl0aWVzKHByZWRpY2F0ZTogKHZhbHVlOiBhbnksIGluZGV4OiBudW1iZXIsIGFycmF5OiBhbnlbXSkgPT4gYW55KTogYW55W10ge1xyXG4gICAgY29uc3QgZW50aXRpZXNUb1JlbW92ZSA9IEFycmF5LmZyb20odGhpcy5pbm5lckVudGl0eVNldCkuZmlsdGVyKHByZWRpY2F0ZSk7XHJcbiAgICBlbnRpdGllc1RvUmVtb3ZlLmZvckVhY2goZW50aXR5VG9SZW1vdmUgPT4ge1xyXG4gICAgICB0aGlzLmlubmVyRW50aXR5TWFwLmRlbGV0ZShlbnRpdHlUb1JlbW92ZVt0aGlzLnByaW1hcnlLZXldKTtcclxuICAgICAgdGhpcy5pbm5lckVudGl0eVNldC5kZWxldGUoZW50aXR5VG9SZW1vdmUpO1xyXG4gICAgfSk7XHJcbiAgICB0aGlzLm5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkKG5ldyBNb2RpZmljYXRpb24oZW50aXRpZXNUb1JlbW92ZSwgTW9kaWZ5VHlwZS5SZW1vdmUpKTtcclxuICAgIHJldHVybiBlbnRpdGllc1RvUmVtb3ZlO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDnp7vpmaTmlbDmja7vvIjkuI3liIfmjaLlvZPliY3ooYzvvIlcclxuICAgKiBAcGFyYW0gcHJlZGljYXRlIOi/h+a7pOWHveaVsFxyXG4gICAqL1xyXG4gIHB1YmxpYyByZW1vdmVEYXRhKHByZWRpY2F0ZTogKHZhbHVlOiBhbnksIGluZGV4OiBudW1iZXIsIGFycmF5OiBhbnlbXSkgPT4gYW55KTogYW55W10ge1xyXG4gICAgY29uc3QgZW50aXRpZXNUb1JlbW92ZSA9IEFycmF5LmZyb20odGhpcy5pbm5lckVudGl0eVNldCkuZmlsdGVyKHByZWRpY2F0ZSk7XHJcbiAgICBlbnRpdGllc1RvUmVtb3ZlLmZvckVhY2goZW50aXR5VG9SZW1vdmUgPT4ge1xyXG4gICAgICB0aGlzLmlubmVyRW50aXR5TWFwLmRlbGV0ZShlbnRpdHlUb1JlbW92ZVt0aGlzLnByaW1hcnlLZXldKTtcclxuICAgICAgdGhpcy5pbm5lckVudGl0eVNldC5kZWxldGUoZW50aXR5VG9SZW1vdmUpO1xyXG4gICAgfSk7XHJcbiAgICB0aGlzLm5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkKG5ldyBNb2RpZmljYXRpb24oZW50aXRpZXNUb1JlbW92ZSwgTW9kaWZ5VHlwZS5SZW1vdmVEYXRhKSk7XHJcbiAgICByZXR1cm4gZW50aXRpZXNUb1JlbW92ZTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6YeN572u5a2Q6KGo5pWw5o2uXHJcbiAgICogQHBhcmFtIHBhdGhzIOi3r+W+hFxyXG4gICAqIOi3r+W+hOagvOW8jyBbJ2lkOnByb3ZpbmNlSWQnLCdpZDpjaXR5TURNcycsJ3pvbmVNRE1zJ11cclxuICAgKiBAZGVzY3JpcHRpb24gcGF0aOWPguaVsOagvOW8j1xyXG4gICAqIGBgYGpzb25cclxuICAgKiBbXHJcbiAgICogXCJpZDpiNWVkMjNjYS04OGQ5LTQzNzctOThlYy05MmYzNWMxMzI1ZjFcIixcclxuICAgKiBcImNpdHlNRE1zXCIsXHJcbiAgICogXCJpZDozNzM3MDZhZi02MjJmLTRhZWEtYTAwNi1kZGRiZmZkN2JkYTNcIixcclxuICAgKiBcInpvbmVNRE1zXCJcclxuICAgKiBdXHJcbiAgICogYGBgXHJcbiAgICogQHBhcmFtIGVudGl0aWVzIOWunuS9k+aVsOe7hFxyXG4gICAqL1xyXG4gIHB1YmxpYyByZXNldEVudGl0aWVzKHBhdGhzOiBzdHJpbmdbXSwgZW50aXRpZXM6IGFueVtdKSB7XHJcbiAgICBpZiAocGF0aHNbMF0uaW5kZXhPZignOicpID09PSAtMSkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ+i3r+W+hOagvOW8j+mUmeivrycpO1xyXG4gICAgfVxyXG4gICAgLy8g6I635Y+W5Li75a6e5L2TXHJcbiAgICBjb25zdCBpZCA9IHBhdGhzWzBdLnNwbGl0KCc6JylbMV07XHJcbiAgICBsZXQgZW50aXR5OiBhbnkgPSB0aGlzLmlubmVyRW50aXR5TWFwLmdldChpZCk7XHJcbiAgICBsZXQgZW50aXR5TGlzdCA9IGVudGl0eVtwYXRoc1sxXV0gYXMgRW50aXR5TGlzdDxhbnk+O1xyXG4gICAgaWYgKCFlbnRpdHkpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKGDmib7kuI3liLDkuLvplK7kuLoke2lkfeeahOWunuS9k2ApO1xyXG4gICAgfVxyXG4gICAgZm9yIChsZXQgaW5kZXggPSAyOyBpbmRleCA8IHBhdGhzLmxlbmd0aDsgaW5kZXggKz0gMikge1xyXG4gICAgICBjb25zdCBwYXRoSW5mbyA9IHBhdGhzW2luZGV4XS5zcGxpdCgnOicpO1xyXG4gICAgICBjb25zdCBlbnRpdHlJZCA9IHBhdGhJbmZvWzFdO1xyXG4gICAgICAvLyDojrflj5bliLDlvZPliY3lsYLnuqfnmoTlrp7kvZNcclxuICAgICAgZW50aXR5ID0gZW50aXR5TGlzdC5nZXQoZW50aXR5SWQpO1xyXG4gICAgICBpZiAoIWVudGl0eSkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihg5om+5LiN5Yiw5Li76ZSu5Li6JHtpZH3nmoTlrp7kvZNgKTtcclxuICAgICAgfVxyXG4gICAgICAvLyDojrflj5blvZPliY3lsYLnuqflrp7kvZPkuIvnmoTliJfooajlsZ7mgKdcclxuICAgICAgZW50aXR5TGlzdCA9IGVudGl0eVtwYXRoc1tpbmRleCArIDFdXTtcclxuICAgIH1cclxuICAgIGVudGl0eUxpc3QuY2xlYXIoKTtcclxuICAgIGVudGl0eUxpc3QubG9hZEVudGl0aWVzKGVudGl0aWVzKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOmqjOivgeWunuS9k+aYr+WQpuiDveWkn+a3u+WKoFxyXG4gICAqL1xyXG4gIHByaXZhdGUgdmVyaWZ5RW50aXR5VG9BZGQoZW50aXR5OiBhbnkpOiBib29sZWFuIHtcclxuICAgIGlmICh0aGlzLmhhcyhlbnRpdHlbdGhpcy5wcmltYXJ5S2V5XSkpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKGBUaGUgcmVwb3NpdG9yeSBhbHJlYWR5IGhhZCBhbiBpdGVtIHdpdGggdGhlIHNhdmUgaWRlbnRpdHkgb2YgJyR7ZW50aXR5W3RoaXMucHJpbWFyeUtleV19J2ApO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRydWU7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDpqozor4Hlrp7kvZPmmK/lkKbog73np7vpmaRcclxuICAgKi9cclxuICBwcml2YXRlIHZlcmlmeUVudGl0eVRvUmVtb3ZlKGlkZW50aXR5OiBzdHJpbmcpOiBib29sZWFuIHtcclxuICAgIGlmICghdGhpcy5oYXMoaWRlbnRpdHkpKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlIGVudGl0eSB3aXRoIGlkZW50aXR5IG9mICcke2lkZW50aXR5fSBkb3NlIG5vdCBleHNpdC4nYCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWunuS9k+mbhuWQiOWPmOabtOa1gVxyXG4gICAqL1xyXG4gIHByaXZhdGUgbm90aWZ5Q29sbGVjdGlvbkNoYW5nZWQobW9kaWZpY2F0aW9uOiBNb2RpZmljYXRpb24pIHtcclxuICAgIHRoaXMuY29sbGVjdGlvbkNoYW5nZWQubmV4dChtb2RpZmljYXRpb24pO1xyXG4gIH1cclxuICBwcml2YXRlIGxpc3RlbkVudGl0eUNoYW5nZUV2ZW50KGVudGl0eTogRW50aXR5KSB7XHJcbiAgICBpZiAoZW50aXR5KSB7XHJcbiAgICAgIGVudGl0eS5vblZhbHVlQ2hhbmdlZC5zdWJzY3JpYmUoKGNoYW5nZTogTW9kaWZpY2F0aW9uKSA9PiB0aGlzLmNoYW5nZXMubmV4dChjaGFuZ2UpKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vI3JlZ2lvbiDliIbpobVcclxuXHJcbiAgLyoqXHJcbiAgICog6K6+572u5YiG6aG15aSn5bCPXHJcbiAgICovXHJcbiAgc2V0IHBhZ2VTaXplKHBhZ2VTaXplOiBudW1iZXIpIHtcclxuICAgIGlmICh0eXBlb2YgKHBhZ2VTaXplKSAhPT0gJ251bWJlcicgfHwgcGFnZVNpemUgPCAwKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBwYXJhbWV0ZXI6cGFnZVNpemUnKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBvcmlnaW5hbCA9IHRoaXMucGFnaW5hdGlvbkluZm87XHJcbiAgICAvLyBjb25zdCBlbnRpdHlQYWdpbmF0aW9uSW5mbyA9IE9iamVjdC5hc3NpZ24oe30sIG9yaWdpbmFsW3RoaXMuZW50aXR5VHlwZU5hbWVdLCB7IHBhZ2VTaXplIH0pO1xyXG4gICAgLy8gdGhpcy5wYWdpbmF0aW9uSW5mbyA9IE9iamVjdC5hc3NpZ24oe30sIG9yaWdpbmFsLCB7IFt0aGlzLmVudGl0eVR5cGVOYW1lXTogZW50aXR5UGFnaW5hdGlvbkluZm8gfSk7XHJcbiAgICAvLyB0aGlzLm5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkKG5ldyBNb2RpZmljYXRpb24odGhpcy5wYWdpbmF0aW9uSW5mb1t0aGlzLmVudGl0eVR5cGVOYW1lXSwgTW9kaWZ5VHlwZS5QYWdpbmF0aW9uSW5mb0NoYW5nZSkpO1xyXG4gICAgdGhpcy5wYWdpbmF0aW9uSW5mbyA9IE9iamVjdC5hc3NpZ24oe30sIG9yaWdpbmFsLCB7IHBhZ2VTaXplIH0pO1xyXG4gICAgdGhpcy5ub3RpZnlDb2xsZWN0aW9uQ2hhbmdlZChuZXcgTW9kaWZpY2F0aW9uKHRoaXMucGFnaW5hdGlvbkluZm8sIE1vZGlmeVR5cGUuUGFnaW5hdGlvbkluZm9DaGFuZ2UpKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6I635Y+W5YiG6aG15aSn5bCPXHJcbiAgICogQGRlc2NyaXB0aW9uIOWmguaenOeUqOaIt+acquaMh+WumuWIhumhteWkp+Wwj+WImem7mOiupOS4ujDvvIzljbPojrflj5bmiYDmnInmlbDmja5cclxuICAgKi9cclxuICBnZXQgcGFnZVNpemUoKTogbnVtYmVyIHtcclxuICAgIGlmICghIXRoaXMucGFnaW5hdGlvbkluZm8pIHtcclxuICAgICAgcmV0dXJuIHRoaXMucGFnaW5hdGlvbkluZm8ucGFnZVNpemUgfHwgMDtcclxuICAgIH1cclxuICAgIHJldHVybiAwO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDorr7nva7mlbDmja7mgLvmnaHmlbBcclxuICAgKi9cclxuICBzZXQgdG90YWxDb3VudCh0b3RhbDogbnVtYmVyKSB7XHJcbiAgICBpZiAodHlwZW9mICh0b3RhbCkgIT09ICdudW1iZXInIHx8IHRvdGFsIDwgMCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgcGFyYW1ldGVyOnRvdGFsJyk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3Qgb3JpZ2luYWwgPSB0aGlzLnBhZ2luYXRpb25JbmZvO1xyXG4gICAgLy8gY29uc3QgZW50aXR5UGFnaW5hdGlvbkluZm8gPSBPYmplY3QuYXNzaWduKHt9LCBvcmlnaW5hbFt0aGlzLmVudGl0eVR5cGVOYW1lXSwgeyB0b3RhbCB9KTtcclxuICAgIC8vIHRoaXMucGFnaW5hdGlvbkluZm8gPSBPYmplY3QuYXNzaWduKHt9LCBvcmlnaW5hbCwgeyBbdGhpcy5lbnRpdHlUeXBlTmFtZV06IGVudGl0eVBhZ2luYXRpb25JbmZvIH0pO1xyXG4gICAgdGhpcy5wYWdpbmF0aW9uSW5mbyA9IE9iamVjdC5hc3NpZ24oe30sIG9yaWdpbmFsLCB7IHRvdGFsIH0pO1xyXG4gICAgdGhpcy5ub3RpZnlDb2xsZWN0aW9uQ2hhbmdlZChuZXcgTW9kaWZpY2F0aW9uKHRoaXMucGFnaW5hdGlvbkluZm8sIE1vZGlmeVR5cGUuUGFnaW5hdGlvbkluZm9DaGFuZ2UpKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6I635Y+W5pWw5o2u5oC75p2h5pWwXHJcbiAgICovXHJcbiAgZ2V0IHRvdGFsQ291bnQoKTogbnVtYmVyIHtcclxuICAgIGlmICghIXRoaXMucGFnaW5hdGlvbkluZm8pIHtcclxuICAgICAgcmV0dXJuIHRoaXMucGFnaW5hdGlvbkluZm8udG90YWwgfHwgMDtcclxuICAgIH1cclxuICAgIHJldHVybiAwO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDorr7nva7lvZPliY3pobXnoIFcclxuICAgKi9cclxuICBzZXQgcGFnZUluZGV4KHBhZ2VJbmRleDogbnVtYmVyKSB7XHJcbiAgICBpZiAodHlwZW9mIChwYWdlSW5kZXgpICE9PSAnbnVtYmVyJyB8fCBwYWdlSW5kZXggPCAwKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBwYXJhbWV0ZXI6cGFnZUluZGV4Jyk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3Qgb3JpZ2luYWwgPSB0aGlzLnBhZ2luYXRpb25JbmZvO1xyXG4gICAgLy8gY29uc3QgZW50aXR5UGFnaW5hdGlvbkluZm8gPSBPYmplY3QuYXNzaWduKHt9LCBvcmlnaW5hbFt0aGlzLmVudGl0eVR5cGVOYW1lXSwgeyBwYWdlSW5kZXggfSk7XHJcbiAgICAvLyB0aGlzLnBhZ2luYXRpb25JbmZvID0gT2JqZWN0LmFzc2lnbih7fSwgb3JpZ2luYWwsIHsgW3RoaXMuZW50aXR5VHlwZU5hbWVdOiBlbnRpdHlQYWdpbmF0aW9uSW5mbyB9KTtcclxuICAgIHRoaXMucGFnaW5hdGlvbkluZm8gPSBPYmplY3QuYXNzaWduKHt9LCBvcmlnaW5hbCwgeyBwYWdlSW5kZXggfSk7XHJcbiAgICB0aGlzLm5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkKG5ldyBNb2RpZmljYXRpb24odGhpcy5wYWdpbmF0aW9uSW5mbywgTW9kaWZ5VHlwZS5QYWdpbmF0aW9uSW5mb0NoYW5nZSkpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDojrflj5blvZPliY3pobXnoIFcclxuICAgKi9cclxuICBnZXQgcGFnZUluZGV4KCk6IG51bWJlciB7XHJcbiAgICBpZiAoISF0aGlzLnBhZ2luYXRpb25JbmZvKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLnBhZ2luYXRpb25JbmZvLnBhZ2VJbmRleCB8fCAxO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIDE7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOabtOaWsOWIhumhteS/oeaBr1xyXG4gICAqIEBwYXJhbSBwYXRoIOe7keWumui3r+W+hFxyXG4gICAqIEBwYXJhbSBwYWdlSW5mbyDliIbpobXkv6Hmga9cclxuICAgKi9cclxuICBwdWJsaWMgdXBkYXRlUGFnaW5hdGlvbkluZm9CeVBhdGgocGF0aDogc3RyaW5nLCBwYWdlSW5mbzogeyBwYWdlSW5kZXg6IGFueSwgcGFnZVNpemU6IGFueSwgdG90YWxDb3VudDogYW55LCBbcHJvcDogc3RyaW5nXTogYW55IH0pIHtcclxuICAgIGNvbnN0IG9yaWdpbmFsID0gdGhpcy5wYWdpbmF0aW9uSW5mbztcclxuICAgIGNvbnN0IHsgcGFnZUluZGV4LCBwYWdlU2l6ZSB9ID0gcGFnZUluZm87XHJcbiAgICBjb25zdCB0b3RhbCA9IHBhZ2VJbmZvICYmIChwYWdlSW5mby50b3RhbENvdW50IHx8IHBhZ2VJbmZvLnRvdGFsKSB8fCAwO1xyXG4gICAgY29uc3QgcGFnaW5hdGlvbkluZm8gPSBPYmplY3QuYXNzaWduKHt9LCBvcmlnaW5hbCwgeyBwYWdlSW5kZXgsIHBhZ2VTaXplLCB0b3RhbCB9KTtcclxuICAgIHRoaXMuc2V0UGFnaW5hdGlvbkNvbmZpZ0J5UGF0aChwYXRoLCBwYWdpbmF0aW9uSW5mbyk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOagueaNrui3r+W+hOiOt+WPluWIhumhteWkp+Wwj1xyXG4gICAqIEBwYXJhbSBwYXRoIOi3r+W+hFxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRQYWdpbmF0aW9uQ29uZmlnQnlQYXRoKHBhdGg6IHN0cmluZywgZGVmYXVsdFZhbHVlPzogYW55KSB7XHJcbiAgICBpZiAoIXBhdGggfHwgcGF0aCA9PT0gJy8nKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLnBhZ2luYXRpb25JbmZvO1xyXG4gICAgfVxyXG4gICAgaWYgKHR5cGVvZiBwYXRoICE9PSAnc3RyaW5nJykge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ+i3r+W+hOW/hemhu+S4uuWtl+espuS4su+8gScpO1xyXG4gICAgfVxyXG4gICAgY29uc3QgcGF0aHMgPSBwYXRoLnNwbGl0KCcvJykuZmlsdGVyKGl0ZW0gPT4gISFpdGVtICYmIGl0ZW0udHJpbSgpLmxlbmd0aCA+IDApLm1hcChpdGVtID0+IGl0ZW0udHJpbSgpKTtcclxuICAgIGxldCBjb25maWcgPSB0aGlzLnBhZ2luYXRpb25JbmZvO1xyXG4gICAgcGF0aHMuZm9yRWFjaChpdGVtID0+IHtcclxuICAgICAgaWYgKGNvbmZpZyAmJiBjb25maWcuaGFzT3duUHJvcGVydHkoaXRlbSkpIHtcclxuICAgICAgICBjb25maWcgPSBjb25maWdbaXRlbV07XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uZmlnID0gbnVsbDtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gISFjb25maWcgPyBjb25maWcgOiB0eXBlb2YgZGVmYXVsdFZhbHVlICE9PSAndW5kZWZpbmVkJyA/IGRlZmF1bHRWYWx1ZSA6IHVuZGVmaW5lZDtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6K6+572u5YiG6aG15L+h5oGvXHJcbiAgICogQHBhcmFtIHBhdGgg6Lev5b6EXHJcbiAgICogQHBhcmFtIHZhbHVlIOWAvO+8jOWFtuS4reaAu+adoeaVsGtleeS4unRvdGFsXHJcbiAgICovXHJcbiAgcHVibGljIHNldFBhZ2luYXRpb25Db25maWdCeVBhdGgocGF0aDogc3RyaW5nIHwgQXJyYXk8YW55PiwgdmFsdWU6IGFueSkge1xyXG4gICAgY29uc3Qgb3JpZ2luYWwgPSBKU09OLnN0cmluZ2lmeSh0aGlzLnBhZ2luYXRpb25JbmZvKTtcclxuICAgIGlmICghcGF0aCB8fCBwYXRoID09PSAnLycpIHtcclxuICAgICAgdGhpcy5wYWdpbmF0aW9uSW5mbyA9IHZhbHVlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHBhdGgpKSB7XHJcbiAgICAgICAgcGF0aCA9IHBhdGgudG9TdHJpbmcoKS5tYXRjaCgvW14vW1xcXV0rL2cpIHx8IFtdO1xyXG4gICAgICB9XHJcbiAgICAgIHBhdGguc2xpY2UoMCwgLTEpLnJlZHVjZSgocHJldiwgY3VycmVudCwgaW5kZXgpID0+XHJcbiAgICAgICAgT2JqZWN0KHByZXZbY3VycmVudF0pID09PSBwcmV2W2N1cnJlbnRdXHJcbiAgICAgICAgICA/IHByZXZbY3VycmVudF1cclxuICAgICAgICAgIDogcHJldltjdXJyZW50XSA9IE1hdGguYWJzKHBhdGhbaW5kZXggKyAxXSkgPj4gMCA9PT0gK3BhdGhbaW5kZXggKyAxXVxyXG4gICAgICAgICAgICA/IFtdXHJcbiAgICAgICAgICAgIDoge30sXHJcbiAgICAgICAgdGhpcy5wYWdpbmF0aW9uSW5mbylbcGF0aFtwYXRoLmxlbmd0aCAtIDFdXSA9IHZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChKU09OLnN0cmluZ2lmeSh0aGlzLnBhZ2luYXRpb25JbmZvKSAhPT0gb3JpZ2luYWwpIHtcclxuICAgICAgdGhpcy5ub3RpZnlDb2xsZWN0aW9uQ2hhbmdlZChuZXcgTW9kaWZpY2F0aW9uKHRoaXMucGFnaW5hdGlvbkluZm8sIE1vZGlmeVR5cGUuUGFnaW5hdGlvbkluZm9DaGFuZ2UpKTtcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLnBhZ2luYXRpb25JbmZvO1xyXG4gIH1cclxuICAvLyNlbmRyZWdpb25cclxufVxyXG5cclxuZXhwb3J0IHsgRW50aXR5Q29sbGVjdGlvbiB9O1xyXG4iXX0=