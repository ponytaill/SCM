/**
 * @fileoverview added by tsickle
 * Generated from: lib/bef_data_service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { HttpClient } from '@angular/common/http';
import { of, zip } from 'rxjs';
import { tap, map, switchMap } from 'rxjs/operators';
import { EventBus, AppContext, DataChangeType, DataTypeInfoUtil, ViewModel, ExpressionUtil } from '@farris/devkit';
import { FrameworkSessionService } from './framework_session_service';
import { BefRestService } from './bef_rest_service';
import { BE_SERVER_URI_TOKEN } from './tokens';
import { BefProxyUtil } from './bef_proxy_util';
import { EntityUtil } from './entity_util';
import { BefDataPathUtil } from './bef_data_path_util';
/**
 * Bef数据访问服务
 * \@todo：
 * 1、临时将BefRepository相关代码转移到该类中；
 * 2、进一步明确职责，调整结构
 * @template T
 */
// tslint:disable: no-string-literal
var /**
 * Bef数据访问服务
 * \@todo：
 * 1、临时将BefRepository相关代码转移到该类中；
 * 2、进一步明确职责，调整结构
 * @template T
 */
// tslint:disable: no-string-literal
BefDataService = /** @class */ (function () {
    /**
     * 构造函数
     */
    function BefDataService(injector, repository) {
        this.injector = injector;
        this.repository = repository;
        /** @type {?} */
        var frmSessionService = injector.get(FrameworkSessionService);
        /** @type {?} */
        var httpClient = injector.get(HttpClient);
        /** @type {?} */
        var serverUri = injector.get(BE_SERVER_URI_TOKEN);
        // 创建BefRestService实例
        /** @type {?} */
        var restBaseUri = serverUri + "/" + this.repository.apiUri;
        /** @type {?} */
        var eventBus = injector.get(EventBus);
        this.restService = new BefRestService(httpClient, restBaseUri, frmSessionService, this.repository, eventBus);
        this.appContext = injector.get(AppContext);
    }
    Object.defineProperty(BefDataService.prototype, "restProxy", {
        /**
         * BefRest代理
         */
        get: /**
         * BefRest代理
         * @return {?}
         */
        function () {
            return this.repository.restService.proxy;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * 获取实体集合
     */
    /**
     * 获取实体集合
     * @param {?} filter
     * @param {?} sort
     * @param {?} pageSize
     * @param {?} pageIndex
     * @return {?}
     */
    BefDataService.prototype.getList = /**
     * 获取实体集合
     * @param {?} filter
     * @param {?} sort
     * @param {?} pageSize
     * @param {?} pageIndex
     * @return {?}
     */
    function (filter, sort, pageSize, pageIndex) {
        var _this = this;
        if (pageSize !== 0) {
            pageSize = pageSize || this.repository.entityCollection.pageSize;
            pageIndex = pageIndex || this.repository.entityCollection.pageIndex;
        }
        /** @type {?} */
        var entityFilter = this.buildEntityFilter(filter, sort, pageSize, pageIndex);
        /** @type {?} */
        var requestInfo = this.restService.buildRequestInfo();
        /** @type {?} */
        var filter$ = this.restProxy.extendQuery(entityFilter, requestInfo);
        return filter$.pipe(map((/**
         * @param {?} responseInfo
         * @return {?}
         */
        function (responseInfo) {
            /** @type {?} */
            var queryResult = (/** @type {?} */ (responseInfo.returnValue));
            /** @type {?} */
            var listData = queryResult.result;
            /** @type {?} */
            var entities = [];
            listData.forEach((/**
             * @param {?} data
             * @return {?}
             */
            function (data) {
                /** @type {?} */
                var entity = _this.repository.buildEntity(data);
                EntityUtil.appendInitialData(entity, data);
                entities.push(entity);
            }));
            // BindingList r95，分页变更集取消，导致设置分页信息后不会触发变更事件，所以将加载数据放到后面
            /** @type {?} */
            var serverPaginationInfo = (/** @type {?} */ (queryResult.pagination));
            if (!!serverPaginationInfo && Object.keys(serverPaginationInfo).length > 0) {
                var pageSize_1 = serverPaginationInfo.pageSize, pageIndex_1 = serverPaginationInfo.pageIndex, totalCount = serverPaginationInfo.totalCount;
                // 处理主表分页信息
                _this.repository.entityCollection.updatePaginationInfoByPath('/', { pageIndex: pageIndex_1, pageSize: pageSize_1, totalCount: totalCount });
            }
            else {
                _this.repository.entityCollection.updatePaginationInfoByPath('/', { pageIndex: 1, pageSize: 0, totalCount: entities.length });
            }
            _this.repository.entityCollection.loadEntities(entities);
            return entities;
        })));
    };
    /**
     * 过滤数据
     * @param filter 过滤条件
     * @param sort 排序条件
     * @param pageSize 分页大小
     * @param pageIndex 当前分页
     */
    /**
     * 过滤数据
     * @param {?} filter 过滤条件
     * @param {?} sort 排序条件
     * @param {?} pageSize 分页大小
     * @param {?} pageIndex 当前分页
     * @return {?}
     */
    BefDataService.prototype.filter = /**
     * 过滤数据
     * @param {?} filter 过滤条件
     * @param {?} sort 排序条件
     * @param {?} pageSize 分页大小
     * @param {?} pageIndex 当前分页
     * @return {?}
     */
    function (filter, sort, pageSize, pageIndex) {
        var _this = this;
        if (pageSize !== 0) {
            pageSize = pageSize || this.repository.entityCollection.pageSize;
            pageIndex = pageIndex || this.repository.entityCollection.pageIndex;
        }
        /** @type {?} */
        var entityFilter = this.buildEntityFilter(filter, sort, pageSize, pageIndex);
        /** @type {?} */
        var requestInfo = this.restService.buildRequestInfo();
        /** @type {?} */
        var filter$ = this.restProxy.filter(entityFilter, requestInfo);
        return filter$.pipe(map((/**
         * @param {?} responseInfo
         * @return {?}
         */
        function (responseInfo) {
            /** @type {?} */
            var queryResult = (/** @type {?} */ (responseInfo.returnValue));
            /** @type {?} */
            var listData = queryResult.result;
            /** @type {?} */
            var entities = [];
            listData.forEach((/**
             * @param {?} data
             * @return {?}
             */
            function (data) {
                /** @type {?} */
                var entity = _this.repository.buildEntity(data);
                EntityUtil.appendInitialData(entity, data);
                entities.push(entity);
            }));
            // BindingList r95，分页变更集取消，导致设置分页信息后不会触发变更事件，所以将加载数据放到后面
            /** @type {?} */
            var serverPaginationInfo = (/** @type {?} */ (queryResult.pagination));
            if (!!serverPaginationInfo && Object.keys(serverPaginationInfo).length > 0) {
                var pageSize_2 = serverPaginationInfo.pageSize, pageIndex_2 = serverPaginationInfo.pageIndex, totalCount = serverPaginationInfo.totalCount;
                // 处理主表分页信息
                _this.repository.entityCollection.updatePaginationInfoByPath('/', { pageIndex: pageIndex_2, pageSize: pageSize_2, totalCount: totalCount });
            }
            else {
                _this.repository.entityCollection.updatePaginationInfoByPath('/', { pageIndex: 1, pageSize: 0, totalCount: entities.length });
            }
            _this.repository.entityCollection.loadEntities(entities);
            return entities;
        })));
    };
    /**
     * 构造EntityFilter
     */
    /**
     * 构造EntityFilter
     * @private
     * @param {?} filter
     * @param {?} sort
     * @param {?} pageSize
     * @param {?} pageIndex
     * @return {?}
     */
    BefDataService.prototype.buildEntityFilter = /**
     * 构造EntityFilter
     * @private
     * @param {?} filter
     * @param {?} sort
     * @param {?} pageSize
     * @param {?} pageIndex
     * @return {?}
     */
    function (filter, sort, pageSize, pageIndex) {
        // @todo：临时兼容老代码，降低改动带来的风险
        if (!filter && !sort && !pageSize && !pageIndex) {
            return null;
        }
        // 纠正最后一个过滤条件的Relation
        if (filter && filter.length > 0) {
            filter[filter.length - 1].Relation = 0;
        }
        /** @type {?} */
        var entityFilter = {
            FilterConditions: filter,
            SortConditions: sort,
            IsUsePagination: pageSize === 0 ? false : true,
            Pagination: {
                PageIndex: pageIndex,
                PageSize: pageSize,
                PageCount: 0,
                TotalCount: 0
            }
        };
        return entityFilter;
    };
    /**
     * 获取单个实体
     * @param id id
     * @param enableChildrenPagination en
     */
    /**
     * 获取单个实体
     * @param {?} id id
     * @return {?}
     */
    BefDataService.prototype.getById = /**
     * 获取单个实体
     * @param {?} id id
     * @return {?}
     */
    function (id) {
        var _this = this;
        /** @type {?} */
        var requestInfo = this.restService.buildRequestInfo();
        /** @type {?} */
        var retrieveParam = this.buildRetrieveParam();
        if (retrieveParam) {
            return this.getEntityById(id);
        }
        /** @type {?} */
        var retrieve$ = this.restService.extendRetrieve(id, requestInfo, retrieveParam);
        /** @type {?} */
        var result$ = retrieve$.pipe(map((/**
         * @param {?} responseInfo
         * @return {?}
         */
        function (responseInfo) {
            /** @type {?} */
            var entityData = responseInfo.returnValue;
            /** @type {?} */
            var entity = _this.repository.buildEntity(entityData);
            _this.repository.entityCollection.loadEntities([entity]);
            return entity;
        })));
        return result$;
    };
    /**
     * @param {?} id
     * @return {?}
     */
    BefDataService.prototype.getEntityById = /**
     * @param {?} id
     * @return {?}
     */
    function (id) {
        var _this = this;
        // 获取所有分页信息
        /** @type {?} */
        var requestInfo = this.restService.buildRequestInfo();
        // 构造分页信息
        /** @type {?} */
        var retrieveParam = this.buildRetrieveParam();
        /** @type {?} */
        var retrieve$ = this.restService.serviceRetrieve(id, retrieveParam, requestInfo);
        /** @type {?} */
        var result$ = retrieve$.pipe(map((/**
         * @param {?} responseInfo
         * @return {?}
         */
        function (responseInfo) {
            /** @type {?} */
            var returnValue = responseInfo.returnValue || {};
            /** @type {?} */
            var entityData = returnValue.result;
            /** @type {?} */
            var serverPaginationInfo = returnValue.pagination;
            _this.updatePagination(serverPaginationInfo);
            /** @type {?} */
            var entity = _this.repository.buildEntity(entityData);
            _this.repository.entityCollection.loadEntities([entity]);
            return entity;
        })));
        return result$;
    };
    /**
     * ['id:xxx', 'chil1s', 'id:xxx', 'grand1s']
     * 分页查询从表/从从表数据
     * 绑定路径格式为['主表主键:主表主键值','child1s','id:从表主键值']
     * @param paths 通用路径
     * @param pageIndex 页码
     * @param pageSize 分页大小
     * @param filter 过滤条件
     * @param sort 排序
     */
    /**
     * ['id:xxx', 'chil1s', 'id:xxx', 'grand1s']
     * 分页查询从表/从从表数据
     * 绑定路径格式为['主表主键:主表主键值','child1s','id:从表主键值']
     * @param {?} paths 通用路径
     * @param {?} pageIndex 页码
     * @param {?} pageSize 分页大小
     * @param {?=} filter 过滤条件
     * @param {?=} sort 排序
     * @return {?}
     */
    BefDataService.prototype.queryChild = /**
     * ['id:xxx', 'chil1s', 'id:xxx', 'grand1s']
     * 分页查询从表/从从表数据
     * 绑定路径格式为['主表主键:主表主键值','child1s','id:从表主键值']
     * @param {?} paths 通用路径
     * @param {?} pageIndex 页码
     * @param {?} pageSize 分页大小
     * @param {?=} filter 过滤条件
     * @param {?=} sort 排序
     * @return {?}
     */
    function (paths, pageIndex, pageSize, filter, sort) {
        var _this = this;
        /** @type {?} */
        var requestInfo = this.restService.buildRequestInfo();
        /** @type {?} */
        var nodeCodes = BefDataPathUtil.convertPathsToNodeCodes(paths);
        /** @type {?} */
        var entityCodes = nodeCodes.map((/**
         * @param {?} node
         * @return {?}
         */
        function (node) { return node.substring(0, node.length - 1); }));
        /** @type {?} */
        var entityName = entityCodes[entityCodes.length - 1];
        // 查询对象可能为从表或从从表
        /** @type {?} */
        var pagination = this.repository.entityCollection.getPaginationConfigByPath("/" + entityName);
        var _a = (pagination || {}).pageSize, ps = _a === void 0 ? 0 : _a;
        /** @type {?} */
        var viewModel = this.injector.get(ViewModel, null);
        /** @type {?} */
        var forceQueryChild = false;
        if (viewModel) {
            forceQueryChild = viewModel.frameContext.appContext.params.get('forceQueryChild') || false;
        }
        if (ps == 0 && !forceQueryChild) {
            return of(null);
        }
        /** @type {?} */
        var ids = BefDataPathUtil.convertPathsToIds(paths);
        /** @type {?} */
        var parentId = ids[ids.length - 1];
        /** @type {?} */
        var params = {
            nodeCodes: entityCodes,
            ids: ids,
            pagination: {
                pageIndex: pageIndex,
                pageSize: pageSize
            },
            requestInfo: requestInfo
        };
        /** @type {?} */
        var request$ = this.restService.queryChild(params);
        return request$.pipe(map((/**
         * @param {?} response
         * @return {?}
         */
        function (response) {
            /** @type {?} */
            var returnValue = response.returnValue;
            if (!returnValue) {
                return null;
            }
            var _a = returnValue.result, result = _a === void 0 ? [] : _a, _b = returnValue.pagination, pagination = _b === void 0 ? {} : _b;
            /** @type {?} */
            var commonPaths = paths.map((/**
             * @param {?} path
             * @param {?} index
             * @return {?}
             */
            function (path, index) {
                if (path.includes(':') && index % 2 === 0) {
                    return path.split(':')[1];
                }
                return path;
            }));
            /** @type {?} */
            var entities = _this.repository.entityManager.createEntitiesByPath("/" + commonPaths.join('/'), result);
            _this.repository.entityCollection.resetEntities(paths, entities);
            // 更新分页信息
            _this.repository.entityCollection.setPaginationConfigByPath("/" + entityName + "_" + parentId, pagination);
        })));
    };
    /**
     * 构造子表分页信息
     */
    /**
     * 构造子表分页信息
     * @private
     * @return {?}
     */
    BefDataService.prototype.buildChildrenPagination = /**
     * 构造子表分页信息
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var paginationInfo = this.repository.entityCollection.getPaginationConfigByPath('/');
        /** @type {?} */
        var childPaginationInfo = {};
        /** @type {?} */
        var childrenEntityCodes = [];
        DataTypeInfoUtil.getChildrenNodeCodes(this.repository.entityTypeInfo, childrenEntityCodes);
        // 实体无子表
        if (!childrenEntityCodes || childrenEntityCodes.length < 1) {
            return null;
        }
        Object.keys(paginationInfo).forEach((/**
         * @param {?} key
         * @return {?}
         */
        function (key) {
            /** @type {?} */
            var value = paginationInfo[key];
            if (typeof value === 'object') {
                /** @type {?} */
                var entityCode = key && key.includes('_') && key.split('_')[0] || null;
                if (!(entityCode && childrenEntityCodes.includes(entityCode + "s"))) {
                    childPaginationInfo[key] = value;
                }
            }
        }));
        return childPaginationInfo;
    };
    /**
     * 更新分页配置信息
     * @param paginationInfo 服务器分页信息
     */
    /**
     * 更新分页配置信息
     * @private
     * @param {?} paginationInfo 服务器分页信息
     * @return {?}
     */
    BefDataService.prototype.updatePagination = /**
     * 更新分页配置信息
     * @private
     * @param {?} paginationInfo 服务器分页信息
     * @return {?}
     */
    function (paginationInfo) {
        var _this = this;
        if (!paginationInfo) {
            return;
        }
        /** @type {?} */
        var childrenEntityCodes = [];
        DataTypeInfoUtil.getChildrenNodeCodes(this.repository.entityTypeInfo, childrenEntityCodes);
        childrenEntityCodes = childrenEntityCodes.map((/**
         * @param {?} item
         * @return {?}
         */
        function (item) { return item.substr(0, item.length - 1); }));
        if (!paginationInfo || Object.keys(paginationInfo).length < 1) {
            if (childrenEntityCodes && childrenEntityCodes.length > 0) {
                childrenEntityCodes.forEach((/**
                 * @param {?} nodeCode
                 * @return {?}
                 */
                function (nodeCode) {
                    /** @type {?} */
                    var original = _this.repository.entityCollection.getPaginationConfigByPath("/" + nodeCode);
                    if (original) {
                        original.pageIndex = 1;
                        original.total = 0;
                        _this.repository.entityCollection.setPaginationConfigByPath("/" + nodeCode, original);
                    }
                }));
            }
            return;
        }
        Object.keys(paginationInfo).forEach((/**
         * @param {?} key
         * @return {?}
         */
        function (key) {
            // const entityName = childrenEntityCodes.find(item => key.startsWith(`${item}_`));
            _this.repository.entityCollection.setPaginationConfigByPath("/" + key, paginationInfo[key]);
        }));
        // childrenEntityCodes.forEach((nodeCode: string) => {
        //   // 确认后端返回的分页信息中是否包含当前实体的分页信息，如果不包含则将index置为1、总条数置为0
        //   // 获取该实体对应到分页信息中key
        //   const key = Object.keys(paginationInfo).find((key: string) => key.startsWith(`${nodeCode}_`));
        //   // 分页中包含当前实体的分页信息
        //   if (key) {
        //     // paginationInfo[key].total = paginationInfo[key].totalCount;
        //     this.repository.entityCollection.setPaginationConfigByPath(`/${key}`, paginationInfo[key]);
        //   } else {
        //     // TODO: 需确认是否必须设置空分页信息
        //     // const original = this.repository.entityCollection.getPaginationConfigByPath(`/${nodeCode}`);
        //     // if (original) {
        //     //   original.pageIndex = 1;
        //     //   original.total = 0;
        //     //   this.repository.entityCollection.setPaginationConfigByPath(`/${nodeCode}`, original);
        //     // }
        //   }
        // });
    };
    /**
     * 构造retrieve分页信息
     * @description 该请求不需要携带parentIds参数，只有切换从从表时才需要使用添加parentIds参数
     */
    /**
     * 构造retrieve分页信息
     * \@description 该请求不需要携带parentIds参数，只有切换从从表时才需要使用添加parentIds参数
     * @private
     * @return {?}
     */
    BefDataService.prototype.buildRetrieveParam = /**
     * 构造retrieve分页信息
     * \@description 该请求不需要携带parentIds参数，只有切换从从表时才需要使用添加parentIds参数
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var childPaginationInfo = this.buildChildrenPagination();
        if (!childPaginationInfo || Object.keys(childPaginationInfo).length < 1) {
            return null;
        }
        /** @type {?} */
        var retrieveParam = { filters: {}, parentIds: {} };
        /** @type {?} */
        var childrenEntityCodes = [];
        ExpressionUtil.getChildrenEntityPaths(this.repository.entityTypeInfo, childrenEntityCodes);
        Object.keys(childPaginationInfo).forEach((/**
         * @param {?} typeName
         * @return {?}
         */
        function (typeName) {
            /** @type {?} */
            var entity = childPaginationInfo[typeName];
            /** @type {?} */
            var pageIndex = entity.pageIndex || 1;
            retrieveParam.filters[typeName] = { pagination: { pageSize: entity.pageSize || 0, pageIndex: pageIndex } };
            // if (this.isChildrenTable(typeName)) {
            //   retrieveParam.parentIds[typeName] = this.getId(typeName, pageIndex);
            // }
        }));
        return retrieveParam;
    };
    /*
    private getId(nodeCode: string, pageIndex: number): string {
      const viewModel = this.injector.get<ViewModel>(ViewModel, null);
      const { pageIndex: originalPageIndex = 1 } = this.repository.entityCollection.getPaginationConfigByPath(`/${nodeCode}`) || {};
      if (pageIndex !== originalPageIndex) {
        return null;
      }
      if (viewModel) {
        const bindingList = viewModel.bindingData.getValue([`${nodeCode}s`]) as BindingList;
        if (bindingList && bindingList.currentId) {
          return bindingList.currentId;
        }
      }
      return null;
    }
    private isChildrenTable(nodeCode: string) {
      let childrenEntityCodes: any[] = [];
      nodeCode += 's';
      ExpressionUtil.getChildrenEntityPaths(this.repository.entityTypeInfo, childrenEntityCodes);
      if (childrenEntityCodes && childrenEntityCodes.length > 0) {
        const index = childrenEntityCodes.findIndex((paths: string[]) => paths.length === 1 && paths[0] === nodeCode);
        return index !== -1;
      }
      return false;
    }*/
    /**
     * 更新并对实体加锁
     * @param id 实体id
     */
    /*
      private getId(nodeCode: string, pageIndex: number): string {
        const viewModel = this.injector.get<ViewModel>(ViewModel, null);
        const { pageIndex: originalPageIndex = 1 } = this.repository.entityCollection.getPaginationConfigByPath(`/${nodeCode}`) || {};
        if (pageIndex !== originalPageIndex) {
          return null;
        }
        if (viewModel) {
          const bindingList = viewModel.bindingData.getValue([`${nodeCode}s`]) as BindingList;
          if (bindingList && bindingList.currentId) {
            return bindingList.currentId;
          }
        }
        return null;
      }
      private isChildrenTable(nodeCode: string) {
        let childrenEntityCodes: any[] = [];
        nodeCode += 's';
        ExpressionUtil.getChildrenEntityPaths(this.repository.entityTypeInfo, childrenEntityCodes);
        if (childrenEntityCodes && childrenEntityCodes.length > 0) {
          const index = childrenEntityCodes.findIndex((paths: string[]) => paths.length === 1 && paths[0] === nodeCode);
          return index !== -1;
        }
        return false;
      }*/
    /**
     * 更新并对实体加锁
     * @param {?} id 实体id
     * @return {?}
     */
    BefDataService.prototype.editById = /*
      private getId(nodeCode: string, pageIndex: number): string {
        const viewModel = this.injector.get<ViewModel>(ViewModel, null);
        const { pageIndex: originalPageIndex = 1 } = this.repository.entityCollection.getPaginationConfigByPath(`/${nodeCode}`) || {};
        if (pageIndex !== originalPageIndex) {
          return null;
        }
        if (viewModel) {
          const bindingList = viewModel.bindingData.getValue([`${nodeCode}s`]) as BindingList;
          if (bindingList && bindingList.currentId) {
            return bindingList.currentId;
          }
        }
        return null;
      }
      private isChildrenTable(nodeCode: string) {
        let childrenEntityCodes: any[] = [];
        nodeCode += 's';
        ExpressionUtil.getChildrenEntityPaths(this.repository.entityTypeInfo, childrenEntityCodes);
        if (childrenEntityCodes && childrenEntityCodes.length > 0) {
          const index = childrenEntityCodes.findIndex((paths: string[]) => paths.length === 1 && paths[0] === nodeCode);
          return index !== -1;
        }
        return false;
      }*/
    /**
     * 更新并对实体加锁
     * @param {?} id 实体id
     * @return {?}
     */
    function (id) {
        var _this = this;
        /** @type {?} */
        var entity = this.repository.entityCollection.getEntityById(id);
        if (!entity) {
            return of(null);
        }
        /** @type {?} */
        var requestInfo = BefProxyUtil.buildRequestInfo(this.repository);
        /** @type {?} */
        var retrieve$ = this.restProxy.edit(id, requestInfo);
        /** @type {?} */
        var result$ = retrieve$.pipe(map((/**
         * @param {?} responseInfo
         * @return {?}
         */
        function (responseInfo) {
            /** @type {?} */
            var entityData = responseInfo.returnValue.data;
            /** @type {?} */
            var entityToUpdate = _this.repository.entityCollection.getEntityById(id);
            if (entityToUpdate && entityData) {
                _this.reloadEntityData(entityToUpdate, entityData);
            }
            return entityToUpdate;
        })));
        return result$;
    };
    /**
     * 根据id更新实体
     * @param id 实体id
     */
    /**
     * 根据id更新实体
     * @param {?} id 实体id
     * @return {?}
     */
    BefDataService.prototype.updateById = /**
     * 根据id更新实体
     * @param {?} id 实体id
     * @return {?}
     */
    function (id) {
        var _this = this;
        // 如果要更新的实体不存在，返回一个null流；
        // @todo：返回empty()还是null流，为了不影响现有行为，临时返回null流。
        /** @type {?} */
        var entity = this.repository.entityCollection.getEntityById(id);
        if (!entity) {
            return of(null);
        }
        /** @type {?} */
        var requestInfo = this.restService.buildRequestInfo();
        /** @type {?} */
        var retrieveParam = this.buildRetrieveParam();
        if (retrieveParam) {
            return this.updateEntityById(id);
        }
        /** @type {?} */
        var retrieve$ = this.restService.extendRetrieve(id, requestInfo, retrieveParam);
        /** @type {?} */
        var result$ = retrieve$.pipe(map((/**
         * @param {?} responseInfo
         * @return {?}
         */
        function (responseInfo) {
            /** @type {?} */
            var entityData = responseInfo.returnValue;
            /** @type {?} */
            var entityToUpdate = _this.repository.entityCollection.getEntityById(id);
            _this.reloadEntityData(entityToUpdate, entityData);
            return entityToUpdate;
        })));
        return result$;
    };
    /**
     * 根据id更新实体
     * @param id 实体id
     */
    /**
     * 根据id更新实体
     * @param {?} id 实体id
     * @return {?}
     */
    BefDataService.prototype.updateEntityById = /**
     * 根据id更新实体
     * @param {?} id 实体id
     * @return {?}
     */
    function (id) {
        var _this = this;
        // 获取所有分页信息
        /** @type {?} */
        var requestInfo = this.restService.buildRequestInfo();
        // 构造分页信息
        /** @type {?} */
        var retrieveParam = this.buildRetrieveParam();
        /** @type {?} */
        var retrieve$ = this.restService.serviceRetrieve(id, retrieveParam, requestInfo);
        /** @type {?} */
        var result$ = retrieve$.pipe(map((/**
         * @param {?} responseInfo
         * @return {?}
         */
        function (responseInfo) {
            /** @type {?} */
            var returnValue = responseInfo.returnValue || {};
            /** @type {?} */
            var entityData = returnValue.result;
            /** @type {?} */
            var serverPaginationInfo = returnValue.pagination;
            _this.updatePagination(serverPaginationInfo);
            /** @type {?} */
            var entityToUpdate = _this.repository.entityCollection.getEntityById(id);
            _this.reloadEntityData(entityToUpdate, entityData);
            return entityToUpdate;
        })));
        return result$;
    };
    /**
     * 重新加载实体数据
     * @param id 要重载的实体id
     * @param entityData 要重载的数据
     * @todo：
     * 1、根本上应该在重新load数据的时候，只发送根节点的一次Load变更；
     * 2、考虑到稳定性和改动量，暂时采取此过渡方案，重构Entity时彻底解决。
     */
    /**
     * 重新加载实体数据
     * \@todo：
     * 1、根本上应该在重新load数据的时候，只发送根节点的一次Load变更；
     * 2、考虑到稳定性和改动量，暂时采取此过渡方案，重构Entity时彻底解决。
     * @private
     * @param {?} entity
     * @param {?} entityData 要重载的数据
     * @return {?}
     */
    BefDataService.prototype.reloadEntityData = /**
     * 重新加载实体数据
     * \@todo：
     * 1、根本上应该在重新load数据的时候，只发送根节点的一次Load变更；
     * 2、考虑到稳定性和改动量，暂时采取此过渡方案，重构Entity时彻底解决。
     * @private
     * @param {?} entity
     * @param {?} entityData 要重载的数据
     * @return {?}
     */
    function (entity, entityData) {
        if (!entity) {
            return;
        }
        // 关闭变更检测
        this.appContext.changeDetectionController.detach();
        // retrieve之后已经是最新数据，移除变更
        // entity.load(entityData);
        this.repository.entityCollection.updateEntity(entity, entityData);
        // 重新加载数据不应该产生变更
        entity.changes.splice(0, entity.changes.length);
        // 重新打开变更检测
        this.appContext.changeDetectionController.reattach();
    };
    /**
     * 创建新实体，并加载
     */
    /**
     * 创建新实体，并加载
     * @param {?=} defaultValue
     * @return {?}
     */
    BefDataService.prototype.create = /**
     * 创建新实体，并加载
     * @param {?=} defaultValue
     * @return {?}
     */
    function (defaultValue) {
        var _this = this;
        /** @type {?} */
        var requestInfo = this.restService.buildRequestInfo();
        /** @type {?} */
        var result$ = this.restService.create(defaultValue, requestInfo);
        return result$.pipe(map((/**
         * @param {?} responseInfo
         * @return {?}
         */
        function (responseInfo) {
            /** @type {?} */
            var newData = responseInfo.returnValue;
            /** @type {?} */
            var newEntity = _this.repository.buildEntity(newData);
            EntityUtil.appendInitialData(newEntity, newData);
            _this.repository.entityCollection.loadEntities([newEntity], true);
            // this.repository.dataChangeHistory.addChange({ dataId: newEntity.primaryValue, changeType: DataChangeType.Add });
            return newEntity;
        })));
    };
    /**
     * 追加实体
     */
    /**
     * 追加实体
     * @param {?=} defaultValue
     * @return {?}
     */
    BefDataService.prototype.append = /**
     * 追加实体
     * @param {?=} defaultValue
     * @return {?}
     */
    function (defaultValue) {
        var _this = this;
        /** @type {?} */
        var requestInfo = this.restService.buildRequestInfo();
        /** @type {?} */
        var append$ = this.restService.create(defaultValue, requestInfo);
        return append$.pipe(map((/**
         * @param {?} responseInfo
         * @return {?}
         */
        function (responseInfo) {
            /** @type {?} */
            var newData = responseInfo.returnValue;
            /** @type {?} */
            var newEntity = _this.repository.buildEntity(newData);
            _this.repository.entityCollection.addEntity(newEntity);
            // this.repository.dataChangeHistory.addChange({ dataId: newEntity.primaryValue, changeType: DataChangeType.Add });
            return newEntity;
        })));
    };
    /**
     * 插入数据
     * @param position 数据插入位置
     * @param defaultValue 默认值
     */
    /**
     * 插入数据
     * @param {?} position 数据插入位置
     * @param {?=} defaultValue 默认值
     * @return {?}
     */
    BefDataService.prototype.insert = /**
     * 插入数据
     * @param {?} position 数据插入位置
     * @param {?=} defaultValue 默认值
     * @return {?}
     */
    function (position, defaultValue) {
        var _this = this;
        /** @type {?} */
        var requestInfo = this.buildRequestInfo();
        /** @type {?} */
        var insert$ = this.restProxy.create(defaultValue, requestInfo);
        return insert$.pipe(map((/**
         * @param {?} responseInfo
         * @return {?}
         */
        function (responseInfo) {
            /** @type {?} */
            var newData = responseInfo.returnValue;
            /** @type {?} */
            var newEntity = _this.repository.buildEntity(newData);
            _this.repository.entityCollection.insertEntity(newEntity, position);
            return newEntity;
        })));
    };
    /**
     * 创建子实体，并追加
     * @param fpath 父路径，格式形如：/1/edus（从表）或/1/edus/2/grades（从从表）
     */
    /**
     * 创建子实体，并追加
     * @param {?} fpath 父路径，格式形如：/1/edus（从表）或/1/edus/2/grades（从从表）
     * @return {?}
     */
    BefDataService.prototype.appendByPath = /**
     * 创建子实体，并追加
     * @param {?} fpath 父路径，格式形如：/1/edus（从表）或/1/edus/2/grades（从从表）
     * @return {?}
     */
    function (fpath) {
        var _this = this;
        /** @type {?} */
        var requestInfo = this.restService.buildRequestInfo();
        /** @type {?} */
        var append$ = this.restService.createByPath(fpath, requestInfo);
        return append$.pipe(map((/**
         * @param {?} responseInfo
         * @return {?}
         */
        function (responseInfo) {
            /** @type {?} */
            var newData = responseInfo.returnValue;
            /** @type {?} */
            var newEntity = _this.repository.entityManager.appendEntityByPath(fpath, newData, newData);
            return newEntity;
        })));
    };
    /**
     * 创建子实体并插入到指定位置
     * @param fpath 父路径
     * @param position 数据插入位置
     */
    /**
     * 创建子实体并插入到指定位置
     * @param {?} fpath 父路径
     * @param {?} position 数据插入位置
     * @return {?}
     */
    BefDataService.prototype.insertByPath = /**
     * 创建子实体并插入到指定位置
     * @param {?} fpath 父路径
     * @param {?} position 数据插入位置
     * @return {?}
     */
    function (fpath, position) {
        var _this = this;
        /** @type {?} */
        var requestInfo = this.buildRequestInfo();
        /** @type {?} */
        var insert$ = this.restProxy.createByPath(fpath, requestInfo);
        return insert$.pipe(map((/**
         * @param {?} responseInfo
         * @return {?}
         */
        function (responseInfo) {
            /** @type {?} */
            var newData = responseInfo.returnValue;
            /** @type {?} */
            var newEntity = _this.repository.entityManager.insertEntityByPath(fpath, newData, newData, position);
            return newEntity;
        })));
    };
    /**
     * 根据id删除实体
     * @param id 内码
     */
    /**
     * 根据id删除实体
     * @param {?} id 内码
     * @param {?=} ifSave
     * @return {?}
     */
    BefDataService.prototype.removeById = /**
     * 根据id删除实体
     * @param {?} id 内码
     * @param {?=} ifSave
     * @return {?}
     */
    function (id, ifSave) {
        var _this = this;
        ifSave = (ifSave === undefined) ? true : ifSave;
        /** @type {?} */
        var requestInfo = BefProxyUtil.buildRequestInfo(this.repository);
        /** @type {?} */
        var delete$;
        if (ifSave) {
            delete$ = this.restProxy.deleteAndSave(id, requestInfo);
            return delete$.pipe(switchMap((/**
             * @return {?}
             */
            function () {
                _this.repository.entityCollection.removeEntityById(id);
                return of(true);
            })));
        }
        else {
            delete$ = this.restService.extendDelete(id, requestInfo);
            return delete$.pipe(switchMap((/**
             * @return {?}
             */
            function () {
                _this.repository.entityCollection.removeEntityById(id);
                _this.repository.dataChangeHistory.addChange({ dataId: id, changeType: DataChangeType.Delete });
                return of(true);
            })));
        }
    };
    /**
     * 删除并保存
     * @param id 要删除的实体id
     */
    /**
     * 删除并保存
     * @param {?} id 要删除的实体id
     * @return {?}
     */
    BefDataService.prototype.removeAndSaveById = /**
     * 删除并保存
     * @param {?} id 要删除的实体id
     * @return {?}
     */
    function (id) {
        var _this = this;
        /** @type {?} */
        var requestInfo = BefProxyUtil.buildRequestInfo(this.repository);
        /** @type {?} */
        var delete$ = this.restProxy.deleteAndSave(id, requestInfo);
        /** @type {?} */
        var result$ = delete$.pipe(switchMap((/**
         * @return {?}
         */
        function () {
            _this.repository.entityCollection.removeEntityById(id);
            // this.repository.dataChangeHistory.addChange({ dataId: id, changeType: DataChangeType.Delete });
            return of(true);
        })));
        return result$;
    };
    /**
     * 批量删除
     * @param id 内码
     * @param ifSave 是否保存
     */
    /**
     * 批量删除
     * @param {?} ids
     * @param {?=} ifSave 是否保存
     * @return {?}
     */
    BefDataService.prototype.removeByIds = /**
     * 批量删除
     * @param {?} ids
     * @param {?=} ifSave 是否保存
     * @return {?}
     */
    function (ids, ifSave) {
        var _this = this;
        ifSave = (ifSave === undefined) ? true : ifSave;
        // 服务器端删除
        /** @type {?} */
        var requestInfo = this.restService.buildRequestInfo();
        /** @type {?} */
        var delete$ = this.restService.extendBatchDelete(ids, requestInfo);
        // 从本地实体集合中移除
        return delete$.pipe(switchMap((/**
         * @return {?}
         */
        function () {
            if (ifSave) {
                // 执行保存
                return _this.applyChangesByIdArray(ids).pipe(tap((/**
                 * @param {?} result
                 * @return {?}
                 */
                function (result) {
                    if (result) {
                        // 从实体集合中删除
                        _this.repository.entityCollection.removeEntities((/**
                         * @param {?} value
                         * @return {?}
                         */
                        function (value) {
                            return _this.checkEntityValueExists(value, ids);
                        }));
                    }
                })));
            }
            else {
                // 从实体集合中删除
                _this.repository.entityCollection.removeEntities((/**
                 * @param {?} value
                 * @return {?}
                 */
                function (value) {
                    return _this.checkEntityValueExists(value, ids);
                }));
                if (ids && ids.length > 0) {
                    /** @type {?} */
                    var changes_1 = [];
                    ids.forEach((/**
                     * @param {?} id
                     * @return {?}
                     */
                    function (id) {
                        changes_1.push({ dataId: id, changeType: DataChangeType.Delete });
                    }));
                    _this.repository.dataChangeHistory.addChanges(changes_1);
                }
                return of(true);
            }
        })));
    };
    /**
     * 根据ids批量删除实体
     * @param ids ids
     * @param ifSave 是否保存
     */
    /**
     * 根据ids批量删除实体
     * @param {?} ids ids
     * @param {?} ifSave 是否保存
     * @return {?}
     */
    BefDataService.prototype.batchRemove = /**
     * 根据ids批量删除实体
     * @param {?} ids ids
     * @param {?} ifSave 是否保存
     * @return {?}
     */
    function (ids, ifSave) {
        var _this = this;
        /** @type {?} */
        var requestInfo = this.restService.buildRequestInfo();
        /** @type {?} */
        var delete$ = this.restService.extendBatchDeletion(ids, requestInfo);
        // 从本地实体集合中移除
        return delete$.pipe(switchMap((/**
         * @return {?}
         */
        function () {
            if (ifSave) {
                // 执行保存
                return _this.applyChangesByIdArray(ids).pipe(tap((/**
                 * @param {?} result
                 * @return {?}
                 */
                function (result) {
                    if (result) {
                        // 从实体集合中删除
                        _this.removeEntities(ids);
                    }
                })));
            }
            else {
                // 从实体集合中删除
                _this.removeEntities(ids);
                _this.addBatchRemoveHistory(ids);
                return of(true);
            }
        })));
    };
    /**
     * 添加批量删除记录到变更记录中
     * @param ids ids
     */
    /**
     * 添加批量删除记录到变更记录中
     * @private
     * @param {?} ids ids
     * @return {?}
     */
    BefDataService.prototype.addBatchRemoveHistory = /**
     * 添加批量删除记录到变更记录中
     * @private
     * @param {?} ids ids
     * @return {?}
     */
    function (ids) {
        if (ids && ids.length > 0) {
            /** @type {?} */
            var changes_2 = [];
            ids.forEach((/**
             * @param {?} id
             * @return {?}
             */
            function (id) {
                changes_2.push({ dataId: id, changeType: DataChangeType.Delete });
            }));
            this.repository.dataChangeHistory.addChanges(changes_2);
        }
    };
    /**
     * 从实体仓库中批量移除指定id的数据
     * @param ids
     */
    /**
     * 从实体仓库中批量移除指定id的数据
     * @private
     * @param {?} ids
     * @return {?}
     */
    BefDataService.prototype.removeEntities = /**
     * 从实体仓库中批量移除指定id的数据
     * @private
     * @param {?} ids
     * @return {?}
     */
    function (ids) {
        var _this = this;
        this.repository.entityCollection.removeEntities((/**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            return _this.checkEntityValueExists(value, ids);
        }));
    };
    /**
     * 检测实体的主键值是否存在于数组中，如果存在返回true
     * @param array 待遍历数组
     */
    /**
     * 检测实体的主键值是否存在于数组中，如果存在返回true
     * @private
     * @param {?} entity
     * @param {?} primaryValueArray
     * @return {?}
     */
    BefDataService.prototype.checkEntityValueExists = /**
     * 检测实体的主键值是否存在于数组中，如果存在返回true
     * @private
     * @param {?} entity
     * @param {?} primaryValueArray
     * @return {?}
     */
    function (entity, primaryValueArray) {
        /** @type {?} */
        var isExistInTargetArray = false;
        for (var i = 0; i < primaryValueArray.length; i++) {
            if (entity.primaryValue === primaryValueArray[i]) {
                isExistInTargetArray = true;
                break;
            }
        }
        return isExistInTargetArray;
    };
    /**
     * 删除子级
     * @param path 路径
     * @param id   内码
     */
    /**
     * 删除子级
     * @param {?} fpath
     * @param {?} id   内码
     * @return {?}
     */
    BefDataService.prototype.removeByPath = /**
     * 删除子级
     * @param {?} fpath
     * @param {?} id   内码
     * @return {?}
     */
    function (fpath, id) {
        var _this = this;
        // 服务器端删除
        /** @type {?} */
        var requestInfo = this.restService.buildRequestInfo();
        /** @type {?} */
        var delete$ = this.restService.extendDeletByPath(fpath, id, requestInfo);
        // 从本地实体集合中移除
        return delete$.pipe(map((/**
         * @return {?}
         */
        function () {
            _this.repository.entityManager.removeEntityByPath(fpath, id);
            _this.repository.dataChangeHistory.addChange({ fpath: fpath, dataId: id, changeType: DataChangeType.Delete });
            return true;
        })));
    };
    /**
     * 批量删除子级
     * @param fPath 路径
     * @param ids  子级id集合
     */
    /**
     * 批量删除子级
     * @param {?} fPath 路径
     * @param {?} ids  子级id集合
     * @return {?}
     */
    BefDataService.prototype.batchRemoveByPath = /**
     * 批量删除子级
     * @param {?} fPath 路径
     * @param {?} ids  子级id集合
     * @return {?}
     */
    function (fPath, ids) {
        var _this = this;
        // 服务器端删除
        /** @type {?} */
        var requestInfo = this.restService.buildRequestInfo();
        /** @type {?} */
        var delete$ = this.restService.batchDeleteByPath(fPath, ids, requestInfo);
        // 从本地实体集合中移除
        return delete$.pipe(map((/**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var idArray = ids.split(',');
            if (idArray.length > 0) {
                idArray.forEach((/**
                 * @param {?} id
                 * @return {?}
                 */
                function (id) {
                    _this.repository.entityManager.removeEntityByPath(fPath, id);
                    _this.repository.dataChangeHistory.addChange({ fPath: fPath, dataId: id, changeType: DataChangeType.Delete });
                }));
            }
            return true;
        })));
    };
    /**
     * 将id对应的实体的变更提交的服务器端
     */
    /**
     * 将id对应的实体的变更提交的服务器端
     * @param {?} id
     * @return {?}
     */
    BefDataService.prototype.updateChangesById = /**
     * 将id对应的实体的变更提交的服务器端
     * @param {?} id
     * @return {?}
     */
    function (id) {
        var _this = this;
        /** @type {?} */
        var entity = this.repository.entityCollection.getEntityById(id);
        // 变更集不存在
        if (!entity.changes) {
            return of(true);
        }
        // 变更集为空
        if (entity.changes.length === 0) {
            return of(true);
        }
        /** @type {?} */
        var changeDetail = this.repository.entityManager.buildEntityChangeDetailById(id);
        /** @type {?} */
        var requestInfo = this.restService.buildRequestInfo();
        /** @type {?} */
        var update$ = this.restService.update(changeDetail, requestInfo);
        /** @type {?} */
        var result$ = update$.pipe(tap((/**
         * @return {?}
         */
        function () {
            _this.repository.entityManager.clearEntityChangesById(id);
        })), map((/**
         * @return {?}
         */
        function () {
            return true;
        })));
        return result$;
    };
    /**
     * 提交path对应实体的变更
     */
    /**
     * 提交path对应实体的变更
     * @param {?} path
     * @param {?} id
     * @return {?}
     */
    BefDataService.prototype.updateChangesByPath = /**
     * 提交path对应实体的变更
     * @param {?} path
     * @param {?} id
     * @return {?}
     */
    function (path, id) {
        throw new Error('Not Implement');
    };
    /**
     * 提交所有变更
     */
    /**
     * 提交所有变更
     * @return {?}
     */
    BefDataService.prototype.updateAllChanges = /**
     * 提交所有变更
     * @return {?}
     */
    function () {
        var _this = this;
        // 遍历实体，提交变更
        /** @type {?} */
        var updateResults = [];
        /** @type {?} */
        var entities = this.repository.entityCollection.toArray();
        if (entities.length === 0) {
            return of(true);
        }
        entities.forEach((/**
         * @param {?} entity
         * @return {?}
         */
        function (entity) {
            /** @type {?} */
            var updateResult$ = _this.updateChangesById(entity.primaryValue);
            updateResults.push(updateResult$);
        }));
        // 串联流
        /** @type {?} */
        var result$ = zip.apply(void 0, tslib_1.__spread(updateResults)).pipe(map((/**
         * @return {?}
         */
        function () {
            return true;
        })));
        return result$;
    };
    /**
     * 应用变更
     */
    /**
     * 应用变更
     * @return {?}
     */
    BefDataService.prototype.applyChanges = /**
     * 应用变更
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var requestInfo = this.restService.buildRequestInfo();
        /** @type {?} */
        var save$ = this.restService.save(requestInfo);
        /** @type {?} */
        var result$ = save$.pipe(tap((/**
         * @return {?}
         */
        function () {
            _this.repository.entityManager.clearAllEntityChanges();
            _this.repository.clearAllVariableChanges(requestInfo.variableChange);
            _this.repository.dataChangeHistory.clear();
        })), map((/**
         * @return {?}
         */
        function () {
            return true;
        })));
        return result$;
    };
    /**
     * 应用idArray对应数据的变更
     */
    /**
     * 应用idArray对应数据的变更
     * @param {?} idArray
     * @return {?}
     */
    BefDataService.prototype.applyChangesByIdArray = /**
     * 应用idArray对应数据的变更
     * @param {?} idArray
     * @return {?}
     */
    function (idArray) {
        var _this = this;
        /** @type {?} */
        var requestInfo = this.restService.buildRequestInfo();
        /** @type {?} */
        var save$ = this.restService.save(requestInfo);
        /** @type {?} */
        var result$ = save$.pipe(tap((/**
         * @return {?}
         */
        function () {
            _this.repository.entityManager.clearEntityChangesByArray(idArray);
            _this.repository.dataChangeHistory.clearByIds(idArray);
        })), map((/**
         * @return {?}
         */
        function () {
            return true;
        })));
        return result$;
    };
    /**
     * 应用id对应数据的变更
     */
    /**
     * 应用id对应数据的变更
     * @param {?} id
     * @return {?}
     */
    BefDataService.prototype.applyChangesById = /**
     * 应用id对应数据的变更
     * @param {?} id
     * @return {?}
     */
    function (id) {
        var _this = this;
        /** @type {?} */
        var requestInfo = this.restService.buildRequestInfo();
        /** @type {?} */
        var save$ = this.restService.save(requestInfo);
        /** @type {?} */
        var result$ = save$.pipe(tap((/**
         * @return {?}
         */
        function () {
            _this.repository.entityManager.clearEntityChangesById(id);
            _this.repository.dataChangeHistory.clearByIds([id]);
        })), map((/**
         * @return {?}
         */
        function () {
            return true;
        })));
        return result$;
    };
    /**
     * 取消变更
     */
    /**
     * 取消变更
     * @param {?=} options
     * @return {?}
     */
    BefDataService.prototype.cancelChanges = /**
     * 取消变更
     * @param {?=} options
     * @return {?}
     */
    function (options) {
        var _this = this;
        /** @type {?} */
        var cancel$ = this.restService.cancel(options);
        /** @type {?} */
        var result$ = cancel$.pipe(tap((/**
         * @return {?}
         */
        function () {
            _this.repository.entityManager.clearAllEntityChanges();
            _this.repository.dataChangeHistory.clear();
        })), map((/**
         * @return {?}
         */
        function () {
            return true;
        })));
        return result$;
    };
    /**
     * 批量新增从表/从从表数据
     * @param path 实体绑定路径，like 1/childs or 1/childs/11/childchilds
     * @param defaultValues 默认实体数据数组
     */
    /**
     * 批量新增从表/从从表数据
     * @param {?} path 实体绑定路径，like 1/childs or 1/childs/11/childchilds
     * @param {?} defaultValues 默认实体数据数组
     * @return {?}
     */
    BefDataService.prototype.batchAppendByPath = /**
     * 批量新增从表/从从表数据
     * @param {?} path 实体绑定路径，like 1/childs or 1/childs/11/childchilds
     * @param {?} defaultValues 默认实体数据数组
     * @return {?}
     */
    function (path, defaultValues) {
        var _this = this;
        /** @type {?} */
        var requestInfo = this.buildRequestInfo();
        /** @type {?} */
        var append$ = this.restProxy.batchAppendByPath(path, defaultValues, requestInfo);
        return append$.pipe(map((/**
         * @param {?} responseInfo
         * @return {?}
         */
        function (responseInfo) {
            /** @type {?} */
            var list = responseInfo.returnValue;
            /** @type {?} */
            var entities = _this.repository.entityManager.createEntitiesByPath(path, list);
            /** @type {?} */
            var paths = path.split('/').filter((/**
             * @param {?} p
             * @return {?}
             */
            function (p) { return p; }));
            _this.repository.entityManager.appendEntitiesByPath(paths, entities);
            return entities;
        })));
    };
    /**
     * 批量新增主表数据
     * @param defaultValues 默认实体数据数组
     */
    /**
     * 批量新增主表数据
     * @param {?} defaultValues 默认实体数据数组
     * @return {?}
     */
    BefDataService.prototype.batchAppend = /**
     * 批量新增主表数据
     * @param {?} defaultValues 默认实体数据数组
     * @return {?}
     */
    function (defaultValues) {
        var _this = this;
        /** @type {?} */
        var requestInfo = this.buildRequestInfo();
        /** @type {?} */
        var append$ = this.restProxy.batchAppend(defaultValues, requestInfo);
        return append$.pipe(map((/**
         * @param {?} responseInfo
         * @return {?}
         */
        function (responseInfo) {
            /** @type {?} */
            var list = responseInfo.returnValue;
            /** @type {?} */
            var entities = _this.repository.buildEntities(list);
            _this.repository.entityCollection.addEntities(entities);
            return entities;
        })));
    };
    /**
     * 构造变更集
     */
    /**
     * 构造变更集
     * @return {?}
     */
    BefDataService.prototype.buildRequestInfo = /**
     * 构造变更集
     * @return {?}
     */
    function () {
        /** @type {?} */
        var requestInfo = {
            dataChange: this.repository.entityManager.buildAllEntityChangeDetails(),
            variableChange: this.repository.variableManager.buildChangeDetail()
        };
        return requestInfo;
    };
    return BefDataService;
}());
if (false) {
    /**
     * 全局上下文
     * @type {?}
     * @private
     */
    BefDataService.prototype.appContext;
    /**
     * 实体仓库
     * @type {?}
     * @private
     */
    BefDataService.prototype.repository;
    /**
     * RestService实例(请使用restProxy代替)
     * @deprecated
     * @type {?}
     */
    BefDataService.prototype.restService;
    /**
     * @type {?}
     * @private
     */
    BefDataService.prototype.injector;
}
export { BefDataService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmVmX2RhdGFfc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvYmVmLyIsInNvdXJjZXMiOlsibGliL2JlZl9kYXRhX3NlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBT0EsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ2xELE9BQU8sRUFBYyxFQUFFLEVBQUUsR0FBRyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRXJELE9BQU8sRUFBVSxRQUFRLEVBQWMsVUFBVSxFQUFFLGNBQWMsRUFBRSxnQkFBZ0IsRUFBaUIsU0FBUyxFQUFFLGNBQWMsRUFBZSxNQUFNLGdCQUFnQixDQUFDO0FBR25LLE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBQ3RFLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUNwRCxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFHL0MsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQ2hELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHNCQUFzQixDQUFDOzs7Ozs7Ozs7QUFRdkQ7Ozs7Ozs7OztJQXlCRTs7T0FFRztJQUNILHdCQUFvQixRQUFrQixFQUFFLFVBQTRCO1FBQWhELGFBQVEsR0FBUixRQUFRLENBQVU7UUFDcEMsSUFBSSxDQUFDLFVBQVUsR0FBRyxVQUFVLENBQUM7O1lBRXZCLGlCQUFpQixHQUFHLFFBQVEsQ0FBQyxHQUFHLENBQTBCLHVCQUF1QixDQUFDOztZQUNsRixVQUFVLEdBQUcsUUFBUSxDQUFDLEdBQUcsQ0FBYSxVQUFVLENBQUM7O1lBQ2pELFNBQVMsR0FBRyxRQUFRLENB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LEVBQUMsQ0FDSCxDQUFDO0lBQ0osQ0FBQztJQUNEOzs7T0FHRzs7Ozs7O0lBQ0ksb0NBQVc7Ozs7O0lBQWxCLFVBQW1CLGFBQXlCO1FBQTVDLGlCQVdDOztZQVZPLFdBQVcsR0FBRyxJQUFJLENBQUMsZ0JBQWdCLEVBQUU7O1lBQ3JDLE9BQU8sR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLFdBQVcsQ0FBQyxhQUFhLEVBQUUsV0FBVyxDQUFDO1FBQ3RFLE9BQU8sT0FBTyxDQUFDLElBQUksQ0FDakIsR0FBRzs7OztRQUFDLFVBQUMsWUFBMEI7O2dCQUN2QixJQUFJLEdBQUcsWUFBWSxDQUFDLFdBQVc7O2dCQUMvQixRQUFRLEdBQUcsS0FBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDO1lBQ3BELEtBQUksQ0FBQyxVQUFVLENBQUMsZ0JBQWdCLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ3ZELE9BQU8sUUFBUSxDQUFDO1FBQ2xCLENBQUMsRUFBQyxDQUNILENBQUM7SUFDSixDQUFDO0lBQ0Q7O09BRUc7Ozs7O0lBQ0kseUNBQWdCOzs7O0lBQXZCOztZQUNRLFdBQVcsR0FBZ0I7WUFDL0IsVUFBVSxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxDQUFDLDJCQUEyQixFQUFFO1lBQ3ZFLGNBQWMsRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLGVBQWUsQ0FBQyxpQkFBaUIsRUFBRTtTQUNwRTtRQUNELE9BQU8sV0FBVyxDQUFDO0lBQ3JCLENBQUM7SUFDSCxxQkFBQztBQUFELENBQUMsQUE3NkJELElBNjZCQzs7Ozs7OztJQXg2QkMsb0NBQStCOzs7Ozs7SUFLL0Isb0NBQXFDOzs7Ozs7SUFhckMscUNBQW1DOzs7OztJQUt2QixrQ0FBMEI7O0FBbTVCeEMsT0FBTyxFQUFFLGNBQWMsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLypcclxuICogQEF1dGhvcjogV2l0dFxyXG4gKiBARGF0ZTogMjAxOS0wMy0wNyAxNjo1NTozM1xyXG4gKiBATGFzdCBNb2RpZmllZCBieTogYWFsaXp6d2VsbFxyXG4gKiBATGFzdCBNb2RpZmllZCB0aW1lOiAyMDE5LTEwLTA5IDE2OjQ0OjU4XHJcbiAqL1xyXG5pbXBvcnQgeyBJbmplY3RhYmxlLCBJbmplY3RvciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBIdHRwQ2xpZW50IH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBvZiwgemlwIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IHRhcCwgbWFwLCBzd2l0Y2hNYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcblxyXG5pbXBvcnQgeyBFbnRpdHksIEV2ZW50QnVzLCBNb2RpZnlUeXBlLCBBcHBDb250ZXh0LCBEYXRhQ2hhbmdlVHlwZSwgRGF0YVR5cGVJbmZvVXRpbCwgRGF0YVByb3BHcm91cCwgVmlld01vZGVsLCBFeHByZXNzaW9uVXRpbCwgQmluZGluZ0xpc3QgfSBmcm9tICdAZmFycmlzL2RldmtpdCc7XHJcblxyXG5pbXBvcnQgeyBSZXNwb25zZUluZm8sIFF1ZXJ5UmVzdWx0LCBQYWdpbmF0aW9uLCBSZXF1ZXN0SW5mbywgUmV0cmlldmVQYXJhbSB9IGZyb20gJy4vdHlwZXMnO1xyXG5pbXBvcnQgeyBGcmFtZXdvcmtTZXNzaW9uU2VydmljZSB9IGZyb20gJy4vZnJhbWV3b3JrX3Nlc3Npb25fc2VydmljZSc7XHJcbmltcG9ydCB7IEJlZlJlc3RTZXJ2aWNlIH0gZnJvbSAnLi9iZWZfcmVzdF9zZXJ2aWNlJztcclxuaW1wb3J0IHsgQkVfU0VSVkVSX1VSSV9UT0tFTiB9IGZyb20gJy4vdG9rZW5zJztcclxuaW1wb3J0IHsgQmVmUmVwb3NpdG9yeSB9IGZyb20gJy4vYmVmX3JlcG9zaXRvcnknO1xyXG5pbXBvcnQgeyBCZWZQcm94eSB9IGZyb20gJy4vYmVmX3Byb3h5JztcclxuaW1wb3J0IHsgQmVmUHJveHlVdGlsIH0gZnJvbSAnLi9iZWZfcHJveHlfdXRpbCc7XHJcbmltcG9ydCB7IEVudGl0eVV0aWwgfSBmcm9tICcuL2VudGl0eV91dGlsJztcclxuaW1wb3J0IHsgQmVmRGF0YVBhdGhVdGlsIH0gZnJvbSAnLi9iZWZfZGF0YV9wYXRoX3V0aWwnO1xyXG4vKipcclxuICogQmVm5pWw5o2u6K6/6Zeu5pyN5YqhXHJcbiAqIEB0b2Rv77yaXHJcbiAqIDHjgIHkuLTml7blsIZCZWZSZXBvc2l0b3J555u45YWz5Luj56CB6L2s56e75Yiw6K+l57G75Lit77ybXHJcbiAqIDLjgIHov5vkuIDmraXmmI7noa7ogYzotKPvvIzosIPmlbTnu5PmnoRcclxuICovXHJcbi8vIHRzbGludDpkaXNhYmxlOiBuby1zdHJpbmctbGl0ZXJhbFxyXG5jbGFzcyBCZWZEYXRhU2VydmljZTxUIGV4dGVuZHMgRW50aXR5PiB7XHJcblxyXG4gIC8qKlxyXG4gICAqIOWFqOWxgOS4iuS4i+aWh1xyXG4gICAqL1xyXG4gIHByaXZhdGUgYXBwQ29udGV4dDogQXBwQ29udGV4dDtcclxuXHJcbiAgLyoqXHJcbiAgICog5a6e5L2T5LuT5bqTXHJcbiAgICovXHJcbiAgcHJpdmF0ZSByZXBvc2l0b3J5OiBCZWZSZXBvc2l0b3J5PFQ+O1xyXG5cclxuICAvKipcclxuICAgKiBCZWZSZXN05Luj55CGXHJcbiAgICovXHJcbiAgcHVibGljIGdldCByZXN0UHJveHkoKTogQmVmUHJveHkge1xyXG4gICAgcmV0dXJuIHRoaXMucmVwb3NpdG9yeS5yZXN0U2VydmljZS5wcm94eTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlc3RTZXJ2aWNl5a6e5L6LKOivt+S9v+eUqHJlc3RQcm94eeS7o+abvylcclxuICAgKiBAZGVwcmVjYXRlZFxyXG4gICAqL1xyXG4gIHB1YmxpYyByZXN0U2VydmljZTogQmVmUmVzdFNlcnZpY2U7XHJcblxyXG4gIC8qKlxyXG4gICAqIOaehOmAoOWHveaVsFxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yLCByZXBvc2l0b3J5OiBCZWZSZXBvc2l0b3J5PFQ+KSB7XHJcbiAgICB0aGlzLnJlcG9zaXRvcnkgPSByZXBvc2l0b3J5O1xyXG5cclxuICAgIGNvbnN0IGZybVNlc3Npb25TZXJ2aWNlID0gaW5qZWN0b3IuZ2V0PEZyYW1ld29ya1Nlc3Npb25TZXJ2aWNlPihGcmFtZXdvcmtTZXNzaW9uU2VydmljZSk7XHJcbiAgICBjb25zdCBodHRwQ2xpZW50ID0gaW5qZWN0b3IuZ2V0PEh0dHBDbGllbnQ+KEh0dHBDbGllbnQpO1xyXG4gICAgY29uc3Qgc2VydmVyVXJpID0gaW5qZWN0b3IuZ2V0PHN0cmluZz4oQkVfU0VSVkVSX1VSSV9UT0tFTik7XHJcblxyXG4gICAgLy8g5Yib5bu6QmVmUmVzdFNlcnZpY2Xlrp7kvotcclxuICAgIGNvbnN0IHJlc3RCYXNlVXJpID0gYCR7c2VydmVyVXJpfS8ke3RoaXMucmVwb3NpdG9yeS5hcGlVcml9YDtcclxuXHJcbiAgICBjb25zdCBldmVudEJ1czogRXZlbnRCdXMgPSBpbmplY3Rvci5nZXQ8RXZlbnRCdXM+KEV2ZW50QnVzKTtcclxuICAgIHRoaXMucmVzdFNlcnZpY2UgPSBuZXcgQmVmUmVzdFNlcnZpY2UoaHR0cENsaWVudCwgcmVzdEJhc2VVcmksIGZybVNlc3Npb25TZXJ2aWNlLCB0aGlzLnJlcG9zaXRvcnksIGV2ZW50QnVzKTtcclxuXHJcbiAgICB0aGlzLmFwcENvbnRleHQgPSBpbmplY3Rvci5nZXQ8QXBwQ29udGV4dD4oQXBwQ29udGV4dCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDojrflj5blrp7kvZPpm4blkIhcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0TGlzdChmaWx0ZXI6IGFueVtdLCBzb3J0OiBhbnlbXSwgcGFnZVNpemU6IG51bWJlciB8IG51bGwsIHBhZ2VJbmRleDogbnVtYmVyIHwgbnVsbCk6IE9ic2VydmFibGU8VFtdPiB7XHJcbiAgICBpZiAocGFnZVNpemUgIT09IDApIHtcclxuICAgICAgcGFnZVNpemUgPSBwYWdlU2l6ZSB8fCB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5wYWdlU2l6ZTtcclxuICAgICAgcGFnZUluZGV4ID0gcGFnZUluZGV4IHx8IHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLnBhZ2VJbmRleDtcclxuICAgIH1cclxuICAgIGNvbnN0IGVudGl0eUZpbHRlciA9IHRoaXMuYnVpbGRFbnRpdHlGaWx0ZXIoZmlsdGVyLCBzb3J0LCBwYWdlU2l6ZSwgcGFnZUluZGV4KTtcclxuICAgIGNvbnN0IHJlcXVlc3RJbmZvID0gdGhpcy5yZXN0U2VydmljZS5idWlsZFJlcXVlc3RJbmZvKCk7XHJcbiAgICBjb25zdCBmaWx0ZXIkID0gdGhpcy5yZXN0UHJveHkuZXh0ZW5kUXVlcnkoZW50aXR5RmlsdGVyLCByZXF1ZXN0SW5mbyk7XHJcbiAgICByZXR1cm4gZmlsdGVyJC5waXBlKFxyXG4gICAgICBtYXAoKHJlc3BvbnNlSW5mbzogUmVzcG9uc2VJbmZvKSA9PiB7XHJcbiAgICAgICAgY29uc3QgcXVlcnlSZXN1bHQgPSByZXNwb25zZUluZm8ucmV0dXJuVmFsdWUgYXMgUXVlcnlSZXN1bHQ7XHJcbiAgICAgICAgY29uc3QgbGlzdERhdGEgPSBxdWVyeVJlc3VsdC5yZXN1bHQ7XHJcbiAgICAgICAgY29uc3QgZW50aXRpZXM6IFRbXSA9IFtdO1xyXG4gICAgICAgIGxpc3REYXRhLmZvckVhY2goKGRhdGE6IGFueSkgPT4ge1xyXG4gICAgICAgICAgY29uc3QgZW50aXR5ID0gdGhpcy5yZXBvc2l0b3J5LmJ1aWxkRW50aXR5KGRhdGEpO1xyXG4gICAgICAgICAgRW50aXR5VXRpbC5hcHBlbmRJbml0aWFsRGF0YShlbnRpdHksIGRhdGEpO1xyXG4gICAgICAgICAgZW50aXRpZXMucHVzaChlbnRpdHkpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIC8vIEJpbmRpbmdMaXN0IHI5Ne+8jOWIhumhteWPmOabtOmbhuWPlua2iO+8jOWvvOiHtOiuvue9ruWIhumhteS/oeaBr+WQjuS4jeS8muinpuWPkeWPmOabtOS6i+S7tu+8jOaJgOS7peWwhuWKoOi9veaVsOaNruaUvuWIsOWQjumdolxyXG4gICAgICAgIGNvbnN0IHNlcnZlclBhZ2luYXRpb25JbmZvID0gcXVlcnlSZXN1bHQucGFnaW5hdGlvbiBhcyBQYWdpbmF0aW9uO1xyXG4gICAgICAgIGlmICghIXNlcnZlclBhZ2luYXRpb25JbmZvICYmIE9iamVjdC5rZXlzKHNlcnZlclBhZ2luYXRpb25JbmZvKS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICBjb25zdCB7IHBhZ2VTaXplLCBwYWdlSW5kZXgsIHRvdGFsQ291bnQgfSA9IHNlcnZlclBhZ2luYXRpb25JbmZvO1xyXG4gICAgICAgICAgLy8g5aSE55CG5Li76KGo5YiG6aG15L+h5oGvXHJcbiAgICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi51cGRhdGVQYWdpbmF0aW9uSW5mb0J5UGF0aCgnLycsIHsgcGFnZUluZGV4LCBwYWdlU2l6ZSwgdG90YWxDb3VudCB9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24udXBkYXRlUGFnaW5hdGlvbkluZm9CeVBhdGgoJy8nLCB7IHBhZ2VJbmRleDogMSwgcGFnZVNpemU6IDAsIHRvdGFsQ291bnQ6IGVudGl0aWVzLmxlbmd0aCB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24ubG9hZEVudGl0aWVzKGVudGl0aWVzKTtcclxuICAgICAgICByZXR1cm4gZW50aXRpZXM7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDov4fmu6TmlbDmja5cclxuICAgKiBAcGFyYW0gZmlsdGVyIOi/h+a7pOadoeS7tlxyXG4gICAqIEBwYXJhbSBzb3J0IOaOkuW6j+adoeS7tlxyXG4gICAqIEBwYXJhbSBwYWdlU2l6ZSDliIbpobXlpKflsI9cclxuICAgKiBAcGFyYW0gcGFnZUluZGV4IOW9k+WJjeWIhumhtVxyXG4gICAqL1xyXG4gIHB1YmxpYyBmaWx0ZXIoZmlsdGVyOiBhbnlbXSwgc29ydDogYW55W10sIHBhZ2VTaXplOiBudW1iZXIgfCBudWxsLCBwYWdlSW5kZXg6IG51bWJlciB8IG51bGwpOiBPYnNlcnZhYmxlPFRbXT4ge1xyXG4gICAgaWYgKHBhZ2VTaXplICE9PSAwKSB7XHJcbiAgICAgIHBhZ2VTaXplID0gcGFnZVNpemUgfHwgdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24ucGFnZVNpemU7XHJcbiAgICAgIHBhZ2VJbmRleCA9IHBhZ2VJbmRleCB8fCB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5wYWdlSW5kZXg7XHJcbiAgICB9XHJcbiAgICBjb25zdCBlbnRpdHlGaWx0ZXIgPSB0aGlzLmJ1aWxkRW50aXR5RmlsdGVyKGZpbHRlciwgc29ydCwgcGFnZVNpemUsIHBhZ2VJbmRleCk7XHJcbiAgICBjb25zdCByZXF1ZXN0SW5mbyA9IHRoaXMucmVzdFNlcnZpY2UuYnVpbGRSZXF1ZXN0SW5mbygpO1xyXG4gICAgY29uc3QgZmlsdGVyJCA9IHRoaXMucmVzdFByb3h5LmZpbHRlcihlbnRpdHlGaWx0ZXIsIHJlcXVlc3RJbmZvKTtcclxuICAgIHJldHVybiBmaWx0ZXIkLnBpcGUoXHJcbiAgICAgIG1hcCgocmVzcG9uc2VJbmZvOiBSZXNwb25zZUluZm8pID0+IHtcclxuICAgICAgICBjb25zdCBxdWVyeVJlc3VsdCA9IHJlc3BvbnNlSW5mby5yZXR1cm5WYWx1ZSBhcyBRdWVyeVJlc3VsdDtcclxuICAgICAgICBjb25zdCBsaXN0RGF0YSA9IHF1ZXJ5UmVzdWx0LnJlc3VsdDtcclxuICAgICAgICBjb25zdCBlbnRpdGllczogVFtdID0gW107XHJcbiAgICAgICAgbGlzdERhdGEuZm9yRWFjaCgoZGF0YTogYW55KSA9PiB7XHJcbiAgICAgICAgICBjb25zdCBlbnRpdHkgPSB0aGlzLnJlcG9zaXRvcnkuYnVpbGRFbnRpdHkoZGF0YSk7XHJcbiAgICAgICAgICBFbnRpdHlVdGlsLmFwcGVuZEluaXRpYWxEYXRhKGVudGl0eSwgZGF0YSk7XHJcbiAgICAgICAgICBlbnRpdGllcy5wdXNoKGVudGl0eSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgLy8gQmluZGluZ0xpc3Qgcjk177yM5YiG6aG15Y+Y5pu06ZuG5Y+W5raI77yM5a+86Ie06K6+572u5YiG6aG15L+h5oGv5ZCO5LiN5Lya6Kem5Y+R5Y+Y5pu05LqL5Lu277yM5omA5Lul5bCG5Yqg6L295pWw5o2u5pS+5Yiw5ZCO6Z2iXHJcbiAgICAgICAgY29uc3Qgc2VydmVyUGFnaW5hdGlvbkluZm8gPSBxdWVyeVJlc3VsdC5wYWdpbmF0aW9uIGFzIFBhZ2luYXRpb247XHJcbiAgICAgICAgaWYgKCEhc2VydmVyUGFnaW5hdGlvbkluZm8gJiYgT2JqZWN0LmtleXMoc2VydmVyUGFnaW5hdGlvbkluZm8pLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgIGNvbnN0IHsgcGFnZVNpemUsIHBhZ2VJbmRleCwgdG90YWxDb3VudCB9ID0gc2VydmVyUGFnaW5hdGlvbkluZm87XHJcbiAgICAgICAgICAvLyDlpITnkIbkuLvooajliIbpobXkv6Hmga9cclxuICAgICAgICAgIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLnVwZGF0ZVBhZ2luYXRpb25JbmZvQnlQYXRoKCcvJywgeyBwYWdlSW5kZXgsIHBhZ2VTaXplLCB0b3RhbENvdW50IH0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi51cGRhdGVQYWdpbmF0aW9uSW5mb0J5UGF0aCgnLycsIHsgcGFnZUluZGV4OiAxLCBwYWdlU2l6ZTogMCwgdG90YWxDb3VudDogZW50aXRpZXMubGVuZ3RoIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5sb2FkRW50aXRpZXMoZW50aXRpZXMpO1xyXG4gICAgICAgIHJldHVybiBlbnRpdGllcztcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOaehOmAoEVudGl0eUZpbHRlclxyXG4gICAqL1xyXG4gIHByaXZhdGUgYnVpbGRFbnRpdHlGaWx0ZXIoZmlsdGVyOiBhbnlbXSwgc29ydDogYW55W10sIHBhZ2VTaXplOiBudW1iZXIsIHBhZ2VJbmRleDogbnVtYmVyKSB7XHJcbiAgICAvLyBAdG9kb++8muS4tOaXtuWFvOWuueiAgeS7o+egge+8jOmZjeS9juaUueWKqOW4puadpeeahOmjjumZqVxyXG4gICAgaWYgKCFmaWx0ZXIgJiYgIXNvcnQgJiYgIXBhZ2VTaXplICYmICFwYWdlSW5kZXgpIHtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g57qg5q2j5pyA5ZCO5LiA5Liq6L+H5ruk5p2h5Lu255qEUmVsYXRpb25cclxuICAgIGlmIChmaWx0ZXIgJiYgZmlsdGVyLmxlbmd0aCA+IDApIHtcclxuICAgICAgZmlsdGVyW2ZpbHRlci5sZW5ndGggLSAxXS5SZWxhdGlvbiA9IDA7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgZW50aXR5RmlsdGVyID0ge1xyXG4gICAgICBGaWx0ZXJDb25kaXRpb25zOiBmaWx0ZXIsXHJcbiAgICAgIFNvcnRDb25kaXRpb25zOiBzb3J0LFxyXG4gICAgICBJc1VzZVBhZ2luYXRpb246IHBhZ2VTaXplID09PSAwID8gZmFsc2UgOiB0cnVlLFxyXG4gICAgICBQYWdpbmF0aW9uOiB7XHJcbiAgICAgICAgUGFnZUluZGV4OiBwYWdlSW5kZXgsXHJcbiAgICAgICAgUGFnZVNpemU6IHBhZ2VTaXplLFxyXG4gICAgICAgIFBhZ2VDb3VudDogMCxcclxuICAgICAgICBUb3RhbENvdW50OiAwXHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgICByZXR1cm4gZW50aXR5RmlsdGVyO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDojrflj5bljZXkuKrlrp7kvZNcclxuICAgKiBAcGFyYW0gaWQgaWRcclxuICAgKiBAcGFyYW0gZW5hYmxlQ2hpbGRyZW5QYWdpbmF0aW9uIGVuXHJcbiAgICovXHJcbiAgcHVibGljIGdldEJ5SWQoaWQ6IHN0cmluZyk6IE9ic2VydmFibGU8VD4ge1xyXG4gICAgY29uc3QgcmVxdWVzdEluZm8gPSB0aGlzLnJlc3RTZXJ2aWNlLmJ1aWxkUmVxdWVzdEluZm8oKTtcclxuICAgIGNvbnN0IHJldHJpZXZlUGFyYW0gPSB0aGlzLmJ1aWxkUmV0cmlldmVQYXJhbSgpO1xyXG4gICAgaWYgKHJldHJpZXZlUGFyYW0pIHtcclxuICAgICAgcmV0dXJuIHRoaXMuZ2V0RW50aXR5QnlJZChpZCk7XHJcbiAgICB9XHJcbiAgICBjb25zdCByZXRyaWV2ZSQgPSB0aGlzLnJlc3RTZXJ2aWNlLmV4dGVuZFJldHJpZXZlKGlkLCByZXF1ZXN0SW5mbywgcmV0cmlldmVQYXJhbSk7XHJcbiAgICBjb25zdCByZXN1bHQkID0gcmV0cmlldmUkLnBpcGUoXHJcbiAgICAgIG1hcCgocmVzcG9uc2VJbmZvOiBSZXNwb25zZUluZm8pID0+IHtcclxuICAgICAgICBjb25zdCBlbnRpdHlEYXRhID0gcmVzcG9uc2VJbmZvLnJldHVyblZhbHVlO1xyXG4gICAgICAgIGNvbnN0IGVudGl0eSA9IHRoaXMucmVwb3NpdG9yeS5idWlsZEVudGl0eShlbnRpdHlEYXRhKTtcclxuICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5sb2FkRW50aXRpZXMoW2VudGl0eV0pO1xyXG4gICAgICAgIHJldHVybiBlbnRpdHk7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gICAgcmV0dXJuIHJlc3VsdCQ7XHJcbiAgfVxyXG4gIHB1YmxpYyBnZXRFbnRpdHlCeUlkKGlkOiBzdHJpbmcpIHtcclxuICAgIC8vIOiOt+WPluaJgOacieWIhumhteS/oeaBr1xyXG4gICAgY29uc3QgcmVxdWVzdEluZm8gPSB0aGlzLnJlc3RTZXJ2aWNlLmJ1aWxkUmVxdWVzdEluZm8oKTtcclxuICAgIC8vIOaehOmAoOWIhumhteS/oeaBr1xyXG4gICAgY29uc3QgcmV0cmlldmVQYXJhbSA9IHRoaXMuYnVpbGRSZXRyaWV2ZVBhcmFtKCk7XHJcbiAgICBjb25zdCByZXRyaWV2ZSQgPSB0aGlzLnJlc3RTZXJ2aWNlLnNlcnZpY2VSZXRyaWV2ZShpZCwgcmV0cmlldmVQYXJhbSwgcmVxdWVzdEluZm8pO1xyXG4gICAgY29uc3QgcmVzdWx0JCA9IHJldHJpZXZlJC5waXBlKFxyXG4gICAgICBtYXAoKHJlc3BvbnNlSW5mbzogYW55KSA9PiB7XHJcbiAgICAgICAgY29uc3QgcmV0dXJuVmFsdWUgPSByZXNwb25zZUluZm8ucmV0dXJuVmFsdWUgfHwge307XHJcbiAgICAgICAgY29uc3QgZW50aXR5RGF0YSA9IHJldHVyblZhbHVlLnJlc3VsdDtcclxuICAgICAgICBjb25zdCBzZXJ2ZXJQYWdpbmF0aW9uSW5mbyA9IHJldHVyblZhbHVlLnBhZ2luYXRpb247XHJcbiAgICAgICAgdGhpcy51cGRhdGVQYWdpbmF0aW9uKHNlcnZlclBhZ2luYXRpb25JbmZvKTtcclxuICAgICAgICBjb25zdCBlbnRpdHkgPSB0aGlzLnJlcG9zaXRvcnkuYnVpbGRFbnRpdHkoZW50aXR5RGF0YSk7XHJcbiAgICAgICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24ubG9hZEVudGl0aWVzKFtlbnRpdHldKTtcclxuICAgICAgICByZXR1cm4gZW50aXR5O1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICAgIHJldHVybiByZXN1bHQkO1xyXG4gIH1cclxuICAvKipcclxuICAgKiBbJ2lkOnh4eCcsICdjaGlsMXMnLCAnaWQ6eHh4JywgJ2dyYW5kMXMnXVxyXG4gICAqIOWIhumhteafpeivouS7juihqC/ku47ku47ooajmlbDmja5cclxuICAgKiDnu5Hlrprot6/lvoTmoLzlvI/kuLpbJ+S4u+ihqOS4u+mUrjrkuLvooajkuLvplK7lgLwnLCdjaGlsZDFzJywnaWQ65LuO6KGo5Li76ZSu5YC8J11cclxuICAgKiBAcGFyYW0gcGF0aHMg6YCa55So6Lev5b6EXHJcbiAgICogQHBhcmFtIHBhZ2VJbmRleCDpobXnoIFcclxuICAgKiBAcGFyYW0gcGFnZVNpemUg5YiG6aG15aSn5bCPXHJcbiAgICogQHBhcmFtIGZpbHRlciDov4fmu6TmnaHku7ZcclxuICAgKiBAcGFyYW0gc29ydCDmjpLluo9cclxuICAgKi9cclxuICBwdWJsaWMgcXVlcnlDaGlsZChwYXRoczogc3RyaW5nW10sIHBhZ2VJbmRleDogbnVtYmVyLCBwYWdlU2l6ZTogbnVtYmVyLCBmaWx0ZXI/OiBzdHJpbmcsIHNvcnQ/OiBzdHJpbmcpIHtcclxuICAgIGNvbnN0IHJlcXVlc3RJbmZvID0gdGhpcy5yZXN0U2VydmljZS5idWlsZFJlcXVlc3RJbmZvKCk7XHJcbiAgICBsZXQgbm9kZUNvZGVzID0gQmVmRGF0YVBhdGhVdGlsLmNvbnZlcnRQYXRoc1RvTm9kZUNvZGVzKHBhdGhzKTtcclxuICAgIGNvbnN0IGVudGl0eUNvZGVzID0gbm9kZUNvZGVzLm1hcChub2RlID0+IG5vZGUuc3Vic3RyaW5nKDAsIG5vZGUubGVuZ3RoIC0gMSkpO1xyXG4gICAgbGV0IGVudGl0eU5hbWUgPSBlbnRpdHlDb2Rlc1tlbnRpdHlDb2Rlcy5sZW5ndGggLSAxXTtcclxuICAgIC8vIOafpeivouWvueixoeWPr+iDveS4uuS7juihqOaIluS7juS7juihqFxyXG4gICAgY29uc3QgcGFnaW5hdGlvbiA9IHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmdldFBhZ2luYXRpb25Db25maWdCeVBhdGgoYC8ke2VudGl0eU5hbWV9YCk7XHJcbiAgICBjb25zdCB7IHBhZ2VTaXplOiBwcyA9IDAgfSA9IHBhZ2luYXRpb24gfHwge307XHJcbiAgICBjb25zdCB2aWV3TW9kZWwgPSB0aGlzLmluamVjdG9yLmdldDxWaWV3TW9kZWw+KFZpZXdNb2RlbCwgbnVsbCk7XHJcbiAgICBsZXQgZm9yY2VRdWVyeUNoaWxkID0gZmFsc2U7XHJcbiAgICBpZiAodmlld01vZGVsKSB7XHJcbiAgICAgIGZvcmNlUXVlcnlDaGlsZCA9IHZpZXdNb2RlbC5mcmFtZUNvbnRleHQuYXBwQ29udGV4dC5wYXJhbXMuZ2V0KCdmb3JjZVF1ZXJ5Q2hpbGQnKSB8fCBmYWxzZTtcclxuICAgIH1cclxuICAgIGlmIChwcyA9PSAwICYmICFmb3JjZVF1ZXJ5Q2hpbGQpIHtcclxuICAgICAgcmV0dXJuIG9mKG51bGwpO1xyXG4gICAgfVxyXG4gICAgY29uc3QgaWRzID0gQmVmRGF0YVBhdGhVdGlsLmNvbnZlcnRQYXRoc1RvSWRzKHBhdGhzKTtcclxuICAgIGNvbnN0IHBhcmVudElkID0gaWRzW2lkcy5sZW5ndGggLSAxXTtcclxuICAgIGNvbnN0IHBhcmFtcyA9IHtcclxuICAgICAgbm9kZUNvZGVzOiBlbnRpdHlDb2RlcyxcclxuICAgICAgaWRzLFxyXG4gICAgICBwYWdpbmF0aW9uOiB7XHJcbiAgICAgICAgcGFnZUluZGV4LFxyXG4gICAgICAgIHBhZ2VTaXplXHJcbiAgICAgIH0sXHJcbiAgICAgIHJlcXVlc3RJbmZvXHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IHJlcXVlc3QkID0gdGhpcy5yZXN0U2VydmljZS5xdWVyeUNoaWxkKHBhcmFtcyk7XHJcbiAgICByZXR1cm4gcmVxdWVzdCQucGlwZShcclxuICAgICAgbWFwKHJlc3BvbnNlID0+IHtcclxuICAgICAgICBjb25zdCByZXR1cm5WYWx1ZSA9IHJlc3BvbnNlLnJldHVyblZhbHVlO1xyXG4gICAgICAgIGlmICghcmV0dXJuVmFsdWUpIHtcclxuICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCB7IHJlc3VsdCA9IFtdLCBwYWdpbmF0aW9uID0ge30gfSA9IHJldHVyblZhbHVlO1xyXG4gICAgICAgIGNvbnN0IGNvbW1vblBhdGhzID0gcGF0aHMubWFwKChwYXRoLCBpbmRleCkgPT4ge1xyXG4gICAgICAgICAgaWYgKHBhdGguaW5jbHVkZXMoJzonKSAmJiBpbmRleCAlIDIgPT09IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIHBhdGguc3BsaXQoJzonKVsxXTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHJldHVybiBwYXRoO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGNvbnN0IGVudGl0aWVzID0gdGhpcy5yZXBvc2l0b3J5LmVudGl0eU1hbmFnZXIuY3JlYXRlRW50aXRpZXNCeVBhdGgoYC8ke2NvbW1vblBhdGhzLmpvaW4oJy8nKX1gLCByZXN1bHQpO1xyXG4gICAgICAgIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLnJlc2V0RW50aXRpZXMocGF0aHMsIGVudGl0aWVzKTtcclxuICAgICAgICAvLyDmm7TmlrDliIbpobXkv6Hmga9cclxuICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5zZXRQYWdpbmF0aW9uQ29uZmlnQnlQYXRoKGAvJHtlbnRpdHlOYW1lfV8ke3BhcmVudElkfWAsIHBhZ2luYXRpb24pO1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5p6E6YCg5a2Q6KGo5YiG6aG15L+h5oGvXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBidWlsZENoaWxkcmVuUGFnaW5hdGlvbigpIHtcclxuICAgIGNvbnN0IHBhZ2luYXRpb25JbmZvID0gdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24uZ2V0UGFnaW5hdGlvbkNvbmZpZ0J5UGF0aCgnLycpO1xyXG4gICAgY29uc3QgY2hpbGRQYWdpbmF0aW9uSW5mbyA9IHt9O1xyXG4gICAgY29uc3QgY2hpbGRyZW5FbnRpdHlDb2RlcyA9IFtdO1xyXG4gICAgRGF0YVR5cGVJbmZvVXRpbC5nZXRDaGlsZHJlbk5vZGVDb2Rlcyh0aGlzLnJlcG9zaXRvcnkuZW50aXR5VHlwZUluZm8sIGNoaWxkcmVuRW50aXR5Q29kZXMpO1xyXG4gICAgLy8g5a6e5L2T5peg5a2Q6KGoXHJcbiAgICBpZiAoIWNoaWxkcmVuRW50aXR5Q29kZXMgfHwgY2hpbGRyZW5FbnRpdHlDb2Rlcy5sZW5ndGggPCAxKSB7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG4gICAgT2JqZWN0LmtleXMocGFnaW5hdGlvbkluZm8pLmZvckVhY2goa2V5ID0+IHtcclxuICAgICAgY29uc3QgdmFsdWUgPSBwYWdpbmF0aW9uSW5mb1trZXldO1xyXG4gICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnb2JqZWN0Jykge1xyXG4gICAgICAgIGNvbnN0IGVudGl0eUNvZGUgPSBrZXkgJiYga2V5LmluY2x1ZGVzKCdfJykgJiYga2V5LnNwbGl0KCdfJylbMF0gfHwgbnVsbDtcclxuICAgICAgICBpZiAoIShlbnRpdHlDb2RlICYmIGNoaWxkcmVuRW50aXR5Q29kZXMuaW5jbHVkZXMoYCR7ZW50aXR5Q29kZX1zYCkpKSB7XHJcbiAgICAgICAgICBjaGlsZFBhZ2luYXRpb25JbmZvW2tleV0gPSB2YWx1ZTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIGNoaWxkUGFnaW5hdGlvbkluZm87XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOabtOaWsOWIhumhtemFjee9ruS/oeaBr1xyXG4gICAqIEBwYXJhbSBwYWdpbmF0aW9uSW5mbyDmnI3liqHlmajliIbpobXkv6Hmga9cclxuICAgKi9cclxuICBwcml2YXRlIHVwZGF0ZVBhZ2luYXRpb24ocGFnaW5hdGlvbkluZm86IGFueSkge1xyXG4gICAgaWYgKCFwYWdpbmF0aW9uSW5mbykge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBsZXQgY2hpbGRyZW5FbnRpdHlDb2Rlczogc3RyaW5nW10gPSBbXTtcclxuICAgIERhdGFUeXBlSW5mb1V0aWwuZ2V0Q2hpbGRyZW5Ob2RlQ29kZXModGhpcy5yZXBvc2l0b3J5LmVudGl0eVR5cGVJbmZvLCBjaGlsZHJlbkVudGl0eUNvZGVzKTtcclxuICAgIGNoaWxkcmVuRW50aXR5Q29kZXMgPSBjaGlsZHJlbkVudGl0eUNvZGVzLm1hcChpdGVtID0+IGl0ZW0uc3Vic3RyKDAsIGl0ZW0ubGVuZ3RoIC0gMSkpO1xyXG4gICAgaWYgKCFwYWdpbmF0aW9uSW5mbyB8fCBPYmplY3Qua2V5cyhwYWdpbmF0aW9uSW5mbykubGVuZ3RoIDwgMSkge1xyXG4gICAgICBpZiAoY2hpbGRyZW5FbnRpdHlDb2RlcyAmJiBjaGlsZHJlbkVudGl0eUNvZGVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICBjaGlsZHJlbkVudGl0eUNvZGVzLmZvckVhY2goKG5vZGVDb2RlOiBzdHJpbmcpID0+IHtcclxuICAgICAgICAgIGNvbnN0IG9yaWdpbmFsID0gdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24uZ2V0UGFnaW5hdGlvbkNvbmZpZ0J5UGF0aChgLyR7bm9kZUNvZGV9YCk7XHJcbiAgICAgICAgICBpZiAob3JpZ2luYWwpIHtcclxuICAgICAgICAgICAgb3JpZ2luYWwucGFnZUluZGV4ID0gMTtcclxuICAgICAgICAgICAgb3JpZ2luYWwudG90YWwgPSAwO1xyXG4gICAgICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5zZXRQYWdpbmF0aW9uQ29uZmlnQnlQYXRoKGAvJHtub2RlQ29kZX1gLCBvcmlnaW5hbCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgT2JqZWN0LmtleXMocGFnaW5hdGlvbkluZm8pLmZvckVhY2goa2V5ID0+IHtcclxuICAgICAgLy8gY29uc3QgZW50aXR5TmFtZSA9IGNoaWxkcmVuRW50aXR5Q29kZXMuZmluZChpdGVtID0+IGtleS5zdGFydHNXaXRoKGAke2l0ZW19X2ApKTtcclxuICAgICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24uc2V0UGFnaW5hdGlvbkNvbmZpZ0J5UGF0aChgLyR7a2V5fWAsIHBhZ2luYXRpb25JbmZvW2tleV0pO1xyXG4gICAgfSk7XHJcbiAgICAvLyBjaGlsZHJlbkVudGl0eUNvZGVzLmZvckVhY2goKG5vZGVDb2RlOiBzdHJpbmcpID0+IHtcclxuICAgIC8vICAgLy8g56Gu6K6k5ZCO56uv6L+U5Zue55qE5YiG6aG15L+h5oGv5Lit5piv5ZCm5YyF5ZCr5b2T5YmN5a6e5L2T55qE5YiG6aG15L+h5oGv77yM5aaC5p6c5LiN5YyF5ZCr5YiZ5bCGaW5kZXjnva7kuLox44CB5oC75p2h5pWw572u5Li6MFxyXG4gICAgLy8gICAvLyDojrflj5bor6Xlrp7kvZPlr7nlupTliLDliIbpobXkv6Hmga/kuK1rZXlcclxuICAgIC8vICAgY29uc3Qga2V5ID0gT2JqZWN0LmtleXMocGFnaW5hdGlvbkluZm8pLmZpbmQoKGtleTogc3RyaW5nKSA9PiBrZXkuc3RhcnRzV2l0aChgJHtub2RlQ29kZX1fYCkpO1xyXG4gICAgLy8gICAvLyDliIbpobXkuK3ljIXlkKvlvZPliY3lrp7kvZPnmoTliIbpobXkv6Hmga9cclxuICAgIC8vICAgaWYgKGtleSkge1xyXG4gICAgLy8gICAgIC8vIHBhZ2luYXRpb25JbmZvW2tleV0udG90YWwgPSBwYWdpbmF0aW9uSW5mb1trZXldLnRvdGFsQ291bnQ7XHJcbiAgICAvLyAgICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24uc2V0UGFnaW5hdGlvbkNvbmZpZ0J5UGF0aChgLyR7a2V5fWAsIHBhZ2luYXRpb25JbmZvW2tleV0pO1xyXG4gICAgLy8gICB9IGVsc2Uge1xyXG4gICAgLy8gICAgIC8vIFRPRE86IOmcgOehruiupOaYr+WQpuW/hemhu+iuvue9ruepuuWIhumhteS/oeaBr1xyXG4gICAgLy8gICAgIC8vIGNvbnN0IG9yaWdpbmFsID0gdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24uZ2V0UGFnaW5hdGlvbkNvbmZpZ0J5UGF0aChgLyR7bm9kZUNvZGV9YCk7XHJcbiAgICAvLyAgICAgLy8gaWYgKG9yaWdpbmFsKSB7XHJcbiAgICAvLyAgICAgLy8gICBvcmlnaW5hbC5wYWdlSW5kZXggPSAxO1xyXG4gICAgLy8gICAgIC8vICAgb3JpZ2luYWwudG90YWwgPSAwO1xyXG4gICAgLy8gICAgIC8vICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24uc2V0UGFnaW5hdGlvbkNvbmZpZ0J5UGF0aChgLyR7bm9kZUNvZGV9YCwgb3JpZ2luYWwpO1xyXG4gICAgLy8gICAgIC8vIH1cclxuICAgIC8vICAgfVxyXG4gICAgLy8gfSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOaehOmAoHJldHJpZXZl5YiG6aG15L+h5oGvXHJcbiAgICogQGRlc2NyaXB0aW9uIOivpeivt+axguS4jemcgOimgeaQuuW4pnBhcmVudElkc+WPguaVsO+8jOWPquacieWIh+aNouS7juS7juihqOaXtuaJjemcgOimgeS9v+eUqOa3u+WKoHBhcmVudElkc+WPguaVsFxyXG4gICAqL1xyXG4gIHByaXZhdGUgYnVpbGRSZXRyaWV2ZVBhcmFtKCkge1xyXG4gICAgY29uc3QgY2hpbGRQYWdpbmF0aW9uSW5mbyA9IHRoaXMuYnVpbGRDaGlsZHJlblBhZ2luYXRpb24oKTtcclxuICAgIGlmICghY2hpbGRQYWdpbmF0aW9uSW5mbyB8fCBPYmplY3Qua2V5cyhjaGlsZFBhZ2luYXRpb25JbmZvKS5sZW5ndGggPCAxKSB7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG4gICAgY29uc3QgcmV0cmlldmVQYXJhbTogUmV0cmlldmVQYXJhbSA9IHsgZmlsdGVyczoge30sIHBhcmVudElkczoge30gfTtcclxuICAgIGxldCBjaGlsZHJlbkVudGl0eUNvZGVzOiBhbnlbXSA9IFtdO1xyXG4gICAgRXhwcmVzc2lvblV0aWwuZ2V0Q2hpbGRyZW5FbnRpdHlQYXRocyh0aGlzLnJlcG9zaXRvcnkuZW50aXR5VHlwZUluZm8sIGNoaWxkcmVuRW50aXR5Q29kZXMpO1xyXG4gICAgT2JqZWN0LmtleXMoY2hpbGRQYWdpbmF0aW9uSW5mbykuZm9yRWFjaCh0eXBlTmFtZSA9PiB7XHJcbiAgICAgIGNvbnN0IGVudGl0eTogYW55ID0gY2hpbGRQYWdpbmF0aW9uSW5mb1t0eXBlTmFtZV07XHJcbiAgICAgIGNvbnN0IHBhZ2VJbmRleCA9IGVudGl0eS5wYWdlSW5kZXggfHwgMTtcclxuICAgICAgcmV0cmlldmVQYXJhbS5maWx0ZXJzW3R5cGVOYW1lXSA9IHsgcGFnaW5hdGlvbjogeyBwYWdlU2l6ZTogZW50aXR5LnBhZ2VTaXplIHx8IDAsIHBhZ2VJbmRleDogcGFnZUluZGV4IH0gfTtcclxuICAgICAgLy8gaWYgKHRoaXMuaXNDaGlsZHJlblRhYmxlKHR5cGVOYW1lKSkge1xyXG4gICAgICAvLyAgIHJldHJpZXZlUGFyYW0ucGFyZW50SWRzW3R5cGVOYW1lXSA9IHRoaXMuZ2V0SWQodHlwZU5hbWUsIHBhZ2VJbmRleCk7XHJcbiAgICAgIC8vIH1cclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiByZXRyaWV2ZVBhcmFtO1xyXG4gIH1cclxuICAvKlxyXG4gIHByaXZhdGUgZ2V0SWQobm9kZUNvZGU6IHN0cmluZywgcGFnZUluZGV4OiBudW1iZXIpOiBzdHJpbmcge1xyXG4gICAgY29uc3Qgdmlld01vZGVsID0gdGhpcy5pbmplY3Rvci5nZXQ8Vmlld01vZGVsPihWaWV3TW9kZWwsIG51bGwpO1xyXG4gICAgY29uc3QgeyBwYWdlSW5kZXg6IG9yaWdpbmFsUGFnZUluZGV4ID0gMSB9ID0gdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24uZ2V0UGFnaW5hdGlvbkNvbmZpZ0J5UGF0aChgLyR7bm9kZUNvZGV9YCkgfHwge307XHJcbiAgICBpZiAocGFnZUluZGV4ICE9PSBvcmlnaW5hbFBhZ2VJbmRleCkge1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICAgIGlmICh2aWV3TW9kZWwpIHtcclxuICAgICAgY29uc3QgYmluZGluZ0xpc3QgPSB2aWV3TW9kZWwuYmluZGluZ0RhdGEuZ2V0VmFsdWUoW2Ake25vZGVDb2RlfXNgXSkgYXMgQmluZGluZ0xpc3Q7XHJcbiAgICAgIGlmIChiaW5kaW5nTGlzdCAmJiBiaW5kaW5nTGlzdC5jdXJyZW50SWQpIHtcclxuICAgICAgICByZXR1cm4gYmluZGluZ0xpc3QuY3VycmVudElkO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcbiAgcHJpdmF0ZSBpc0NoaWxkcmVuVGFibGUobm9kZUNvZGU6IHN0cmluZykge1xyXG4gICAgbGV0IGNoaWxkcmVuRW50aXR5Q29kZXM6IGFueVtdID0gW107XHJcbiAgICBub2RlQ29kZSArPSAncyc7XHJcbiAgICBFeHByZXNzaW9uVXRpbC5nZXRDaGlsZHJlbkVudGl0eVBhdGhzKHRoaXMucmVwb3NpdG9yeS5lbnRpdHlUeXBlSW5mbywgY2hpbGRyZW5FbnRpdHlDb2Rlcyk7XHJcbiAgICBpZiAoY2hpbGRyZW5FbnRpdHlDb2RlcyAmJiBjaGlsZHJlbkVudGl0eUNvZGVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgY29uc3QgaW5kZXggPSBjaGlsZHJlbkVudGl0eUNvZGVzLmZpbmRJbmRleCgocGF0aHM6IHN0cmluZ1tdKSA9PiBwYXRocy5sZW5ndGggPT09IDEgJiYgcGF0aHNbMF0gPT09IG5vZGVDb2RlKTtcclxuICAgICAgcmV0dXJuIGluZGV4ICE9PSAtMTtcclxuICAgIH1cclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9Ki9cclxuICAvKipcclxuICAgKiDmm7TmlrDlubblr7nlrp7kvZPliqDplIFcclxuICAgKiBAcGFyYW0gaWQg5a6e5L2TaWRcclxuICAgKi9cclxuICBwdWJsaWMgZWRpdEJ5SWQoaWQ6IHN0cmluZyk6IE9ic2VydmFibGU8VD4ge1xyXG4gICAgY29uc3QgZW50aXR5ID0gdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24uZ2V0RW50aXR5QnlJZChpZCk7XHJcbiAgICBpZiAoIWVudGl0eSkge1xyXG4gICAgICByZXR1cm4gb2YobnVsbCk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgcmVxdWVzdEluZm8gPSBCZWZQcm94eVV0aWwuYnVpbGRSZXF1ZXN0SW5mbyh0aGlzLnJlcG9zaXRvcnkpO1xyXG4gICAgY29uc3QgcmV0cmlldmUkID0gdGhpcy5yZXN0UHJveHkuZWRpdChpZCwgcmVxdWVzdEluZm8pO1xyXG4gICAgY29uc3QgcmVzdWx0JCA9IHJldHJpZXZlJC5waXBlKFxyXG4gICAgICBtYXAoKHJlc3BvbnNlSW5mbzogUmVzcG9uc2VJbmZvKSA9PiB7XHJcbiAgICAgICAgY29uc3QgZW50aXR5RGF0YSA9IHJlc3BvbnNlSW5mby5yZXR1cm5WYWx1ZS5kYXRhO1xyXG4gICAgICAgIGNvbnN0IGVudGl0eVRvVXBkYXRlID0gdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24uZ2V0RW50aXR5QnlJZChpZCk7XHJcbiAgICAgICAgaWYgKGVudGl0eVRvVXBkYXRlICYmIGVudGl0eURhdGEpIHtcclxuICAgICAgICAgIHRoaXMucmVsb2FkRW50aXR5RGF0YShlbnRpdHlUb1VwZGF0ZSwgZW50aXR5RGF0YSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBlbnRpdHlUb1VwZGF0ZTtcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgICByZXR1cm4gcmVzdWx0JDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOagueaNrmlk5pu05paw5a6e5L2TXHJcbiAgICogQHBhcmFtIGlkIOWunuS9k2lkXHJcbiAgICovXHJcbiAgcHVibGljIHVwZGF0ZUJ5SWQoaWQ6IHN0cmluZyk6IE9ic2VydmFibGU8VD4ge1xyXG4gICAgLy8g5aaC5p6c6KaB5pu05paw55qE5a6e5L2T5LiN5a2Y5Zyo77yM6L+U5Zue5LiA5LiqbnVsbOa1ge+8m1xyXG4gICAgLy8gQHRvZG/vvJrov5Tlm55lbXB0eSgp6L+Y5pivbnVsbOa1ge+8jOS4uuS6huS4jeW9seWTjeeOsOacieihjOS4uu+8jOS4tOaXtui/lOWbnm51bGzmtYHjgIJcclxuICAgIGNvbnN0IGVudGl0eSA9IHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmdldEVudGl0eUJ5SWQoaWQpO1xyXG4gICAgaWYgKCFlbnRpdHkpIHtcclxuICAgICAgcmV0dXJuIG9mKG51bGwpO1xyXG4gICAgfVxyXG4gICAgY29uc3QgcmVxdWVzdEluZm8gPSB0aGlzLnJlc3RTZXJ2aWNlLmJ1aWxkUmVxdWVzdEluZm8oKTtcclxuICAgIGNvbnN0IHJldHJpZXZlUGFyYW0gPSB0aGlzLmJ1aWxkUmV0cmlldmVQYXJhbSgpO1xyXG4gICAgaWYgKHJldHJpZXZlUGFyYW0pIHtcclxuICAgICAgcmV0dXJuIHRoaXMudXBkYXRlRW50aXR5QnlJZChpZCk7XHJcbiAgICB9XHJcbiAgICBjb25zdCByZXRyaWV2ZSQgPSB0aGlzLnJlc3RTZXJ2aWNlLmV4dGVuZFJldHJpZXZlKGlkLCByZXF1ZXN0SW5mbywgcmV0cmlldmVQYXJhbSk7XHJcbiAgICBjb25zdCByZXN1bHQkID0gcmV0cmlldmUkLnBpcGUoXHJcbiAgICAgIG1hcCgocmVzcG9uc2VJbmZvOiBSZXNwb25zZUluZm8pID0+IHtcclxuICAgICAgICBjb25zdCBlbnRpdHlEYXRhID0gcmVzcG9uc2VJbmZvLnJldHVyblZhbHVlO1xyXG4gICAgICAgIGNvbnN0IGVudGl0eVRvVXBkYXRlID0gdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24uZ2V0RW50aXR5QnlJZChpZCk7XHJcbiAgICAgICAgdGhpcy5yZWxvYWRFbnRpdHlEYXRhKGVudGl0eVRvVXBkYXRlLCBlbnRpdHlEYXRhKTtcclxuICAgICAgICByZXR1cm4gZW50aXR5VG9VcGRhdGU7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gICAgcmV0dXJuIHJlc3VsdCQ7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOagueaNrmlk5pu05paw5a6e5L2TXHJcbiAgICogQHBhcmFtIGlkIOWunuS9k2lkXHJcbiAgICovXHJcbiAgcHVibGljIHVwZGF0ZUVudGl0eUJ5SWQoaWQ6IHN0cmluZykge1xyXG4gICAgLy8g6I635Y+W5omA5pyJ5YiG6aG15L+h5oGvXHJcbiAgICBjb25zdCByZXF1ZXN0SW5mbyA9IHRoaXMucmVzdFNlcnZpY2UuYnVpbGRSZXF1ZXN0SW5mbygpO1xyXG4gICAgLy8g5p6E6YCg5YiG6aG15L+h5oGvXHJcbiAgICBjb25zdCByZXRyaWV2ZVBhcmFtID0gdGhpcy5idWlsZFJldHJpZXZlUGFyYW0oKTtcclxuICAgIGNvbnN0IHJldHJpZXZlJCA9IHRoaXMucmVzdFNlcnZpY2Uuc2VydmljZVJldHJpZXZlKGlkLCByZXRyaWV2ZVBhcmFtLCByZXF1ZXN0SW5mbyk7XHJcbiAgICBjb25zdCByZXN1bHQkID0gcmV0cmlldmUkLnBpcGUoXHJcbiAgICAgIG1hcCgocmVzcG9uc2VJbmZvOiBhbnkpID0+IHtcclxuICAgICAgICBjb25zdCByZXR1cm5WYWx1ZSA9IHJlc3BvbnNlSW5mby5yZXR1cm5WYWx1ZSB8fCB7fTtcclxuICAgICAgICBjb25zdCBlbnRpdHlEYXRhID0gcmV0dXJuVmFsdWUucmVzdWx0O1xyXG4gICAgICAgIGNvbnN0IHNlcnZlclBhZ2luYXRpb25JbmZvID0gcmV0dXJuVmFsdWUucGFnaW5hdGlvbjtcclxuICAgICAgICB0aGlzLnVwZGF0ZVBhZ2luYXRpb24oc2VydmVyUGFnaW5hdGlvbkluZm8pO1xyXG4gICAgICAgIGNvbnN0IGVudGl0eVRvVXBkYXRlID0gdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24uZ2V0RW50aXR5QnlJZChpZCk7XHJcbiAgICAgICAgdGhpcy5yZWxvYWRFbnRpdHlEYXRhKGVudGl0eVRvVXBkYXRlLCBlbnRpdHlEYXRhKTtcclxuICAgICAgICByZXR1cm4gZW50aXR5VG9VcGRhdGU7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gICAgcmV0dXJuIHJlc3VsdCQ7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOmHjeaWsOWKoOi9veWunuS9k+aVsOaNrlxyXG4gICAqIEBwYXJhbSBpZCDopoHph43ovb3nmoTlrp7kvZNpZFxyXG4gICAqIEBwYXJhbSBlbnRpdHlEYXRhIOimgemHjei9veeahOaVsOaNrlxyXG4gICAqIEB0b2Rv77yaXHJcbiAgICogMeOAgeagueacrOS4iuW6lOivpeWcqOmHjeaWsGxvYWTmlbDmja7nmoTml7blgJnvvIzlj6rlj5HpgIHmoLnoioLngrnnmoTkuIDmrKFMb2Fk5Y+Y5pu077ybXHJcbiAgICogMuOAgeiAg+iZkeWIsOeos+WumuaAp+WSjOaUueWKqOmHj++8jOaaguaXtumHh+WPluatpOi/h+a4oeaWueahiO+8jOmHjeaehEVudGl0eeaXtuW9u+W6leino+WGs+OAglxyXG4gICAqL1xyXG4gIHByaXZhdGUgcmVsb2FkRW50aXR5RGF0YShlbnRpdHk6IEVudGl0eSwgZW50aXR5RGF0YTogYW55KTogdm9pZCB7XHJcbiAgICBpZiAoIWVudGl0eSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICAvLyDlhbPpl63lj5jmm7Tmo4DmtYtcclxuICAgIHRoaXMuYXBwQ29udGV4dC5jaGFuZ2VEZXRlY3Rpb25Db250cm9sbGVyLmRldGFjaCgpO1xyXG4gICAgLy8gcmV0cmlldmXkuYvlkI7lt7Lnu4/mmK/mnIDmlrDmlbDmja7vvIznp7vpmaTlj5jmm7RcclxuICAgIC8vIGVudGl0eS5sb2FkKGVudGl0eURhdGEpO1xyXG4gICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24udXBkYXRlRW50aXR5KGVudGl0eSwgZW50aXR5RGF0YSk7XHJcbiAgICAvLyDph43mlrDliqDovb3mlbDmja7kuI3lupTor6XkuqfnlJ/lj5jmm7RcclxuICAgIGVudGl0eS5jaGFuZ2VzLnNwbGljZSgwLCBlbnRpdHkuY2hhbmdlcy5sZW5ndGgpO1xyXG4gICAgLy8g6YeN5paw5omT5byA5Y+Y5pu05qOA5rWLXHJcbiAgICB0aGlzLmFwcENvbnRleHQuY2hhbmdlRGV0ZWN0aW9uQ29udHJvbGxlci5yZWF0dGFjaCgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Yib5bu65paw5a6e5L2T77yM5bm25Yqg6L29XHJcbiAgICovXHJcbiAgcHVibGljIGNyZWF0ZShkZWZhdWx0VmFsdWU/OiBhbnkpIHtcclxuICAgIGNvbnN0IHJlcXVlc3RJbmZvID0gdGhpcy5yZXN0U2VydmljZS5idWlsZFJlcXVlc3RJbmZvKCk7XHJcbiAgICBjb25zdCByZXN1bHQkID0gdGhpcy5yZXN0U2VydmljZS5jcmVhdGUoZGVmYXVsdFZhbHVlLCByZXF1ZXN0SW5mbyk7XHJcbiAgICByZXR1cm4gcmVzdWx0JC5waXBlKFxyXG4gICAgICBtYXAoKHJlc3BvbnNlSW5mbzogUmVzcG9uc2VJbmZvKSA9PiB7XHJcbiAgICAgICAgY29uc3QgbmV3RGF0YSA9IHJlc3BvbnNlSW5mby5yZXR1cm5WYWx1ZTtcclxuICAgICAgICBjb25zdCBuZXdFbnRpdHkgPSB0aGlzLnJlcG9zaXRvcnkuYnVpbGRFbnRpdHkobmV3RGF0YSk7XHJcbiAgICAgICAgRW50aXR5VXRpbC5hcHBlbmRJbml0aWFsRGF0YShuZXdFbnRpdHksIG5ld0RhdGEpO1xyXG4gICAgICAgIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmxvYWRFbnRpdGllcyhbbmV3RW50aXR5XSwgdHJ1ZSk7XHJcbiAgICAgICAgLy8gdGhpcy5yZXBvc2l0b3J5LmRhdGFDaGFuZ2VIaXN0b3J5LmFkZENoYW5nZSh7IGRhdGFJZDogbmV3RW50aXR5LnByaW1hcnlWYWx1ZSwgY2hhbmdlVHlwZTogRGF0YUNoYW5nZVR5cGUuQWRkIH0pO1xyXG4gICAgICAgIHJldHVybiBuZXdFbnRpdHk7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6L+95Yqg5a6e5L2TXHJcbiAgICovXHJcbiAgcHVibGljIGFwcGVuZChkZWZhdWx0VmFsdWU/OiBhbnkpOiBPYnNlcnZhYmxlPFQ+IHtcclxuICAgIGNvbnN0IHJlcXVlc3RJbmZvID0gdGhpcy5yZXN0U2VydmljZS5idWlsZFJlcXVlc3RJbmZvKCk7XHJcbiAgICBjb25zdCBhcHBlbmQkID0gdGhpcy5yZXN0U2VydmljZS5jcmVhdGUoZGVmYXVsdFZhbHVlLCByZXF1ZXN0SW5mbyk7XHJcbiAgICByZXR1cm4gYXBwZW5kJC5waXBlKFxyXG4gICAgICBtYXAoKHJlc3BvbnNlSW5mbzogUmVzcG9uc2VJbmZvKSA9PiB7XHJcbiAgICAgICAgY29uc3QgbmV3RGF0YSA9IHJlc3BvbnNlSW5mby5yZXR1cm5WYWx1ZTtcclxuICAgICAgICBjb25zdCBuZXdFbnRpdHkgPSB0aGlzLnJlcG9zaXRvcnkuYnVpbGRFbnRpdHkobmV3RGF0YSk7XHJcbiAgICAgICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24uYWRkRW50aXR5KG5ld0VudGl0eSk7XHJcbiAgICAgICAgLy8gdGhpcy5yZXBvc2l0b3J5LmRhdGFDaGFuZ2VIaXN0b3J5LmFkZENoYW5nZSh7IGRhdGFJZDogbmV3RW50aXR5LnByaW1hcnlWYWx1ZSwgY2hhbmdlVHlwZTogRGF0YUNoYW5nZVR5cGUuQWRkIH0pO1xyXG4gICAgICAgIHJldHVybiBuZXdFbnRpdHk7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmj5LlhaXmlbDmja5cclxuICAgKiBAcGFyYW0gcG9zaXRpb24g5pWw5o2u5o+S5YWl5L2N572uXHJcbiAgICogQHBhcmFtIGRlZmF1bHRWYWx1ZSDpu5jorqTlgLxcclxuICAgKi9cclxuICBwdWJsaWMgaW5zZXJ0KHBvc2l0aW9uOiAxIHwgLTEsIGRlZmF1bHRWYWx1ZT86IGFueSk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBjb25zdCByZXF1ZXN0SW5mbyA9IHRoaXMuYnVpbGRSZXF1ZXN0SW5mbygpO1xyXG4gICAgY29uc3QgaW5zZXJ0JCA9IHRoaXMucmVzdFByb3h5LmNyZWF0ZShkZWZhdWx0VmFsdWUsIHJlcXVlc3RJbmZvKTtcclxuICAgIHJldHVybiBpbnNlcnQkLnBpcGUoXHJcbiAgICAgIG1hcCgocmVzcG9uc2VJbmZvOiBSZXNwb25zZUluZm8pID0+IHtcclxuICAgICAgICBjb25zdCBuZXdEYXRhID0gcmVzcG9uc2VJbmZvLnJldHVyblZhbHVlO1xyXG4gICAgICAgIGNvbnN0IG5ld0VudGl0eSA9IHRoaXMucmVwb3NpdG9yeS5idWlsZEVudGl0eShuZXdEYXRhKTtcclxuICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5pbnNlcnRFbnRpdHkobmV3RW50aXR5LCBwb3NpdGlvbik7XHJcbiAgICAgICAgcmV0dXJuIG5ld0VudGl0eTtcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDliJvlu7rlrZDlrp7kvZPvvIzlubbov73liqBcclxuICAgKiBAcGFyYW0gZnBhdGgg54i26Lev5b6E77yM5qC85byP5b2i5aaC77yaLzEvZWR1c++8iOS7juihqO+8ieaIli8xL2VkdXMvMi9ncmFkZXPvvIjku47ku47ooajvvIlcclxuICAgKi9cclxuICBwdWJsaWMgYXBwZW5kQnlQYXRoKGZwYXRoOiBzdHJpbmcpOiBPYnNlcnZhYmxlPEVudGl0eT4ge1xyXG4gICAgY29uc3QgcmVxdWVzdEluZm8gPSB0aGlzLnJlc3RTZXJ2aWNlLmJ1aWxkUmVxdWVzdEluZm8oKTtcclxuICAgIGNvbnN0IGFwcGVuZCQgPSB0aGlzLnJlc3RTZXJ2aWNlLmNyZWF0ZUJ5UGF0aChmcGF0aCwgcmVxdWVzdEluZm8pO1xyXG4gICAgcmV0dXJuIGFwcGVuZCQucGlwZShcclxuICAgICAgbWFwKChyZXNwb25zZUluZm86IFJlc3BvbnNlSW5mbykgPT4ge1xyXG4gICAgICAgIGNvbnN0IG5ld0RhdGEgPSByZXNwb25zZUluZm8ucmV0dXJuVmFsdWU7XHJcbiAgICAgICAgY29uc3QgbmV3RW50aXR5ID0gdGhpcy5yZXBvc2l0b3J5LmVudGl0eU1hbmFnZXIuYXBwZW5kRW50aXR5QnlQYXRoKGZwYXRoLCBuZXdEYXRhLCBuZXdEYXRhKTtcclxuICAgICAgICByZXR1cm4gbmV3RW50aXR5O1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5Yib5bu65a2Q5a6e5L2T5bm25o+S5YWl5Yiw5oyH5a6a5L2N572uXHJcbiAgICogQHBhcmFtIGZwYXRoIOeItui3r+W+hFxyXG4gICAqIEBwYXJhbSBwb3NpdGlvbiDmlbDmja7mj5LlhaXkvY3nva5cclxuICAgKi9cclxuICBwdWJsaWMgaW5zZXJ0QnlQYXRoKGZwYXRoOiBzdHJpbmcsIHBvc2l0aW9uOiAxIHwgLTEpIHtcclxuICAgIGNvbnN0IHJlcXVlc3RJbmZvID0gdGhpcy5idWlsZFJlcXVlc3RJbmZvKCk7XHJcbiAgICBjb25zdCBpbnNlcnQkID0gdGhpcy5yZXN0UHJveHkuY3JlYXRlQnlQYXRoKGZwYXRoLCByZXF1ZXN0SW5mbyk7XHJcbiAgICByZXR1cm4gaW5zZXJ0JC5waXBlKFxyXG4gICAgICBtYXAoKHJlc3BvbnNlSW5mbzogUmVzcG9uc2VJbmZvKSA9PiB7XHJcbiAgICAgICAgY29uc3QgbmV3RGF0YSA9IHJlc3BvbnNlSW5mby5yZXR1cm5WYWx1ZTtcclxuICAgICAgICBjb25zdCBuZXdFbnRpdHkgPSB0aGlzLnJlcG9zaXRvcnkuZW50aXR5TWFuYWdlci5pbnNlcnRFbnRpdHlCeVBhdGgoZnBhdGgsIG5ld0RhdGEsIG5ld0RhdGEsIHBvc2l0aW9uKTtcclxuICAgICAgICByZXR1cm4gbmV3RW50aXR5O1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOagueaNrmlk5Yig6Zmk5a6e5L2TXHJcbiAgICogQHBhcmFtIGlkIOWGheeggVxyXG4gICAqL1xyXG4gIHB1YmxpYyByZW1vdmVCeUlkKGlkOiBzdHJpbmcsIGlmU2F2ZT86IGJvb2xlYW4pOiBPYnNlcnZhYmxlPGJvb2xlYW4+IHtcclxuICAgIGlmU2F2ZSA9IChpZlNhdmUgPT09IHVuZGVmaW5lZCkgPyB0cnVlIDogaWZTYXZlO1xyXG4gICAgY29uc3QgcmVxdWVzdEluZm8gPSBCZWZQcm94eVV0aWwuYnVpbGRSZXF1ZXN0SW5mbyh0aGlzLnJlcG9zaXRvcnkpO1xyXG4gICAgbGV0IGRlbGV0ZSQ7XHJcbiAgICBpZiAoaWZTYXZlKSB7XHJcbiAgICAgIGRlbGV0ZSQgPSB0aGlzLnJlc3RQcm94eS5kZWxldGVBbmRTYXZlKGlkLCByZXF1ZXN0SW5mbyk7XHJcbiAgICAgIHJldHVybiBkZWxldGUkLnBpcGUoXHJcbiAgICAgICAgc3dpdGNoTWFwKCgpID0+IHtcclxuICAgICAgICAgIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLnJlbW92ZUVudGl0eUJ5SWQoaWQpO1xyXG4gICAgICAgICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBkZWxldGUkID0gdGhpcy5yZXN0U2VydmljZS5leHRlbmREZWxldGUoaWQsIHJlcXVlc3RJbmZvKTtcclxuICAgICAgcmV0dXJuIGRlbGV0ZSQucGlwZShcclxuICAgICAgICBzd2l0Y2hNYXAoKCkgPT4ge1xyXG4gICAgICAgICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24ucmVtb3ZlRW50aXR5QnlJZChpZCk7XHJcbiAgICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZGF0YUNoYW5nZUhpc3RvcnkuYWRkQ2hhbmdlKHsgZGF0YUlkOiBpZCwgY2hhbmdlVHlwZTogRGF0YUNoYW5nZVR5cGUuRGVsZXRlIH0pO1xyXG4gICAgICAgICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Yig6Zmk5bm25L+d5a2YXHJcbiAgICogQHBhcmFtIGlkIOimgeWIoOmZpOeahOWunuS9k2lkXHJcbiAgICovXHJcbiAgcHVibGljIHJlbW92ZUFuZFNhdmVCeUlkKGlkOiBzdHJpbmcpIHtcclxuICAgIGNvbnN0IHJlcXVlc3RJbmZvID0gQmVmUHJveHlVdGlsLmJ1aWxkUmVxdWVzdEluZm8odGhpcy5yZXBvc2l0b3J5KTtcclxuICAgIGNvbnN0IGRlbGV0ZSQgPSB0aGlzLnJlc3RQcm94eS5kZWxldGVBbmRTYXZlKGlkLCByZXF1ZXN0SW5mbyk7XHJcbiAgICBjb25zdCByZXN1bHQkID0gZGVsZXRlJC5waXBlKFxyXG4gICAgICBzd2l0Y2hNYXAoKCkgPT4ge1xyXG4gICAgICAgIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLnJlbW92ZUVudGl0eUJ5SWQoaWQpO1xyXG4gICAgICAgIC8vIHRoaXMucmVwb3NpdG9yeS5kYXRhQ2hhbmdlSGlzdG9yeS5hZGRDaGFuZ2UoeyBkYXRhSWQ6IGlkLCBjaGFuZ2VUeXBlOiBEYXRhQ2hhbmdlVHlwZS5EZWxldGUgfSk7XHJcbiAgICAgICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuXHJcbiAgICByZXR1cm4gcmVzdWx0JDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaJuemHj+WIoOmZpFxyXG4gICAqIEBwYXJhbSBpZCDlhoXnoIFcclxuICAgKiBAcGFyYW0gaWZTYXZlIOaYr+WQpuS/neWtmFxyXG4gICAqL1xyXG4gIHB1YmxpYyByZW1vdmVCeUlkcyhpZHM6IHN0cmluZ1tdLCBpZlNhdmU/OiBib29sZWFuKTogT2JzZXJ2YWJsZTxib29sZWFuPiB7XHJcbiAgICBpZlNhdmUgPSAoaWZTYXZlID09PSB1bmRlZmluZWQpID8gdHJ1ZSA6IGlmU2F2ZTtcclxuICAgIC8vIOacjeWKoeWZqOerr+WIoOmZpFxyXG4gICAgY29uc3QgcmVxdWVzdEluZm8gPSB0aGlzLnJlc3RTZXJ2aWNlLmJ1aWxkUmVxdWVzdEluZm8oKTtcclxuICAgIGNvbnN0IGRlbGV0ZSQgPSB0aGlzLnJlc3RTZXJ2aWNlLmV4dGVuZEJhdGNoRGVsZXRlKGlkcywgcmVxdWVzdEluZm8pO1xyXG5cclxuICAgIC8vIOS7juacrOWcsOWunuS9k+mbhuWQiOS4reenu+mZpFxyXG4gICAgcmV0dXJuIGRlbGV0ZSQucGlwZShcclxuICAgICAgc3dpdGNoTWFwKCgpID0+IHtcclxuICAgICAgICBpZiAoaWZTYXZlKSB7XHJcbiAgICAgICAgICAvLyDmiafooYzkv53lrZhcclxuICAgICAgICAgIHJldHVybiB0aGlzLmFwcGx5Q2hhbmdlc0J5SWRBcnJheShpZHMpLnBpcGUoXHJcbiAgICAgICAgICAgIHRhcChyZXN1bHQgPT4ge1xyXG4gICAgICAgICAgICAgIGlmIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgIC8vIOS7juWunuS9k+mbhuWQiOS4reWIoOmZpFxyXG4gICAgICAgICAgICAgICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24ucmVtb3ZlRW50aXRpZXMoXHJcbiAgICAgICAgICAgICAgICAgICh2YWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNoZWNrRW50aXR5VmFsdWVFeGlzdHModmFsdWUsIGlkcyk7XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgLy8g5LuO5a6e5L2T6ZuG5ZCI5Lit5Yig6ZmkXHJcbiAgICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5yZW1vdmVFbnRpdGllcyhcclxuICAgICAgICAgICAgKHZhbHVlKSA9PiB7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2hlY2tFbnRpdHlWYWx1ZUV4aXN0cyh2YWx1ZSwgaWRzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgKTtcclxuICAgICAgICAgIGlmIChpZHMgJiYgaWRzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgY29uc3QgY2hhbmdlcyA9IFtdO1xyXG4gICAgICAgICAgICBpZHMuZm9yRWFjaChpZCA9PiB7XHJcbiAgICAgICAgICAgICAgY2hhbmdlcy5wdXNoKHsgZGF0YUlkOiBpZCwgY2hhbmdlVHlwZTogRGF0YUNoYW5nZVR5cGUuRGVsZXRlIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdGhpcy5yZXBvc2l0b3J5LmRhdGFDaGFuZ2VIaXN0b3J5LmFkZENoYW5nZXMoY2hhbmdlcyk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICByZXR1cm4gb2YodHJ1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5qC55o2uaWRz5om56YeP5Yig6Zmk5a6e5L2TXHJcbiAgICogQHBhcmFtIGlkcyBpZHNcclxuICAgKiBAcGFyYW0gaWZTYXZlIOaYr+WQpuS/neWtmFxyXG4gICAqL1xyXG4gIHB1YmxpYyBiYXRjaFJlbW92ZShpZHM6IHN0cmluZ1tdLCBpZlNhdmU6IGJvb2xlYW4pOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgY29uc3QgcmVxdWVzdEluZm8gPSB0aGlzLnJlc3RTZXJ2aWNlLmJ1aWxkUmVxdWVzdEluZm8oKTtcclxuICAgIGNvbnN0IGRlbGV0ZSQgPSB0aGlzLnJlc3RTZXJ2aWNlLmV4dGVuZEJhdGNoRGVsZXRpb24oaWRzLCByZXF1ZXN0SW5mbyk7XHJcbiAgICAvLyDku47mnKzlnLDlrp7kvZPpm4blkIjkuK3np7vpmaRcclxuICAgIHJldHVybiBkZWxldGUkLnBpcGUoXHJcbiAgICAgIHN3aXRjaE1hcCgoKSA9PiB7XHJcbiAgICAgICAgaWYgKGlmU2F2ZSkge1xyXG4gICAgICAgICAgLy8g5omn6KGM5L+d5a2YXHJcbiAgICAgICAgICByZXR1cm4gdGhpcy5hcHBseUNoYW5nZXNCeUlkQXJyYXkoaWRzKS5waXBlKFxyXG4gICAgICAgICAgICB0YXAocmVzdWx0ID0+IHtcclxuICAgICAgICAgICAgICBpZiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAvLyDku47lrp7kvZPpm4blkIjkuK3liKDpmaRcclxuICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlRW50aXRpZXMoaWRzKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICApO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAvLyDku47lrp7kvZPpm4blkIjkuK3liKDpmaRcclxuICAgICAgICAgIHRoaXMucmVtb3ZlRW50aXRpZXMoaWRzKTtcclxuICAgICAgICAgIHRoaXMuYWRkQmF0Y2hSZW1vdmVIaXN0b3J5KGlkcyk7XHJcbiAgICAgICAgICByZXR1cm4gb2YodHJ1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5re75Yqg5om56YeP5Yig6Zmk6K6w5b2V5Yiw5Y+Y5pu06K6w5b2V5LitXHJcbiAgICogQHBhcmFtIGlkcyBpZHNcclxuICAgKi9cclxuICBwcml2YXRlIGFkZEJhdGNoUmVtb3ZlSGlzdG9yeShpZHM6IHN0cmluZ1tdKSB7XHJcbiAgICBpZiAoaWRzICYmIGlkcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGNvbnN0IGNoYW5nZXMgPSBbXTtcclxuICAgICAgaWRzLmZvckVhY2goaWQgPT4ge1xyXG4gICAgICAgIGNoYW5nZXMucHVzaCh7IGRhdGFJZDogaWQsIGNoYW5nZVR5cGU6IERhdGFDaGFuZ2VUeXBlLkRlbGV0ZSB9KTtcclxuICAgICAgfSk7XHJcbiAgICAgIHRoaXMucmVwb3NpdG9yeS5kYXRhQ2hhbmdlSGlzdG9yeS5hZGRDaGFuZ2VzKGNoYW5nZXMpO1xyXG4gICAgfVxyXG4gIH1cclxuICAvKipcclxuICAgKiDku47lrp7kvZPku5PlupPkuK3mibnph4/np7vpmaTmjIflrpppZOeahOaVsOaNrlxyXG4gICAqIEBwYXJhbSBpZHMgXHJcbiAgICovXHJcbiAgcHJpdmF0ZSByZW1vdmVFbnRpdGllcyhpZHM6IHN0cmluZ1tdKSB7XHJcbiAgICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5yZW1vdmVFbnRpdGllcyhcclxuICAgICAgKHZhbHVlKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2hlY2tFbnRpdHlWYWx1ZUV4aXN0cyh2YWx1ZSwgaWRzKTtcclxuICAgICAgfVxyXG4gICAgKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5qOA5rWL5a6e5L2T55qE5Li76ZSu5YC85piv5ZCm5a2Y5Zyo5LqO5pWw57uE5Lit77yM5aaC5p6c5a2Y5Zyo6L+U5ZuedHJ1ZVxyXG4gICAqIEBwYXJhbSBhcnJheSDlvoXpgY3ljobmlbDnu4RcclxuICAgKi9cclxuICBwcml2YXRlIGNoZWNrRW50aXR5VmFsdWVFeGlzdHMoZW50aXR5OiBFbnRpdHksIHByaW1hcnlWYWx1ZUFycmF5OiBhbnlbXSk6IGJvb2xlYW4ge1xyXG4gICAgbGV0IGlzRXhpc3RJblRhcmdldEFycmF5ID0gZmFsc2U7XHJcblxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwcmltYXJ5VmFsdWVBcnJheS5sZW5ndGg7IGkrKykge1xyXG4gICAgICBpZiAoZW50aXR5LnByaW1hcnlWYWx1ZSA9PT0gcHJpbWFyeVZhbHVlQXJyYXlbaV0pIHtcclxuICAgICAgICBpc0V4aXN0SW5UYXJnZXRBcnJheSA9IHRydWU7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gaXNFeGlzdEluVGFyZ2V0QXJyYXk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDliKDpmaTlrZDnuqdcclxuICAgKiBAcGFyYW0gcGF0aCDot6/lvoRcclxuICAgKiBAcGFyYW0gaWQgICDlhoXnoIFcclxuICAgKi9cclxuICBwdWJsaWMgcmVtb3ZlQnlQYXRoKGZwYXRoOiBzdHJpbmcsIGlkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGJvb2xlYW4+IHtcclxuXHJcbiAgICAvLyDmnI3liqHlmajnq6/liKDpmaRcclxuICAgIGNvbnN0IHJlcXVlc3RJbmZvID0gdGhpcy5yZXN0U2VydmljZS5idWlsZFJlcXVlc3RJbmZvKCk7XHJcbiAgICBjb25zdCBkZWxldGUkID0gdGhpcy5yZXN0U2VydmljZS5leHRlbmREZWxldEJ5UGF0aChmcGF0aCwgaWQsIHJlcXVlc3RJbmZvKTtcclxuXHJcbiAgICAvLyDku47mnKzlnLDlrp7kvZPpm4blkIjkuK3np7vpmaRcclxuICAgIHJldHVybiBkZWxldGUkLnBpcGUoXHJcbiAgICAgIG1hcCgoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eU1hbmFnZXIucmVtb3ZlRW50aXR5QnlQYXRoKGZwYXRoLCBpZCk7XHJcbiAgICAgICAgdGhpcy5yZXBvc2l0b3J5LmRhdGFDaGFuZ2VIaXN0b3J5LmFkZENoYW5nZSh7IGZwYXRoLCBkYXRhSWQ6IGlkLCBjaGFuZ2VUeXBlOiBEYXRhQ2hhbmdlVHlwZS5EZWxldGUgfSk7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5om56YeP5Yig6Zmk5a2Q57qnXHJcbiAgICogQHBhcmFtIGZQYXRoIOi3r+W+hFxyXG4gICAqIEBwYXJhbSBpZHMgIOWtkOe6p2lk6ZuG5ZCIXHJcbiAgICovXHJcbiAgcHVibGljIGJhdGNoUmVtb3ZlQnlQYXRoKGZQYXRoOiBzdHJpbmcsIGlkczogc3RyaW5nKTogT2JzZXJ2YWJsZTxib29sZWFuPiB7XHJcblxyXG4gICAgLy8g5pyN5Yqh5Zmo56uv5Yig6ZmkXHJcbiAgICBjb25zdCByZXF1ZXN0SW5mbyA9IHRoaXMucmVzdFNlcnZpY2UuYnVpbGRSZXF1ZXN0SW5mbygpO1xyXG4gICAgY29uc3QgZGVsZXRlJCA9IHRoaXMucmVzdFNlcnZpY2UuYmF0Y2hEZWxldGVCeVBhdGgoZlBhdGgsIGlkcywgcmVxdWVzdEluZm8pO1xyXG5cclxuICAgIC8vIOS7juacrOWcsOWunuS9k+mbhuWQiOS4reenu+mZpFxyXG4gICAgcmV0dXJuIGRlbGV0ZSQucGlwZShcclxuICAgICAgbWFwKCgpID0+IHtcclxuICAgICAgICBjb25zdCBpZEFycmF5ID0gaWRzLnNwbGl0KCcsJyk7XHJcbiAgICAgICAgaWYgKGlkQXJyYXkubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgaWRBcnJheS5mb3JFYWNoKChpZCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5TWFuYWdlci5yZW1vdmVFbnRpdHlCeVBhdGgoZlBhdGgsIGlkKTtcclxuICAgICAgICAgICAgdGhpcy5yZXBvc2l0b3J5LmRhdGFDaGFuZ2VIaXN0b3J5LmFkZENoYW5nZSh7IGZQYXRoLCBkYXRhSWQ6IGlkLCBjaGFuZ2VUeXBlOiBEYXRhQ2hhbmdlVHlwZS5EZWxldGUgfSk7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5bCGaWTlr7nlupTnmoTlrp7kvZPnmoTlj5jmm7Tmj5DkuqTnmoTmnI3liqHlmajnq69cclxuICAgKi9cclxuICBwdWJsaWMgdXBkYXRlQ2hhbmdlc0J5SWQoaWQ6IHN0cmluZyk6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xyXG4gICAgY29uc3QgZW50aXR5ID0gdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24uZ2V0RW50aXR5QnlJZChpZCk7XHJcblxyXG4gICAgLy8g5Y+Y5pu06ZuG5LiN5a2Y5ZyoXHJcbiAgICBpZiAoIWVudGl0eS5jaGFuZ2VzKSB7XHJcbiAgICAgIHJldHVybiBvZih0cnVlKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyDlj5jmm7Tpm4bkuLrnqbpcclxuICAgIGlmIChlbnRpdHkuY2hhbmdlcy5sZW5ndGggPT09IDApIHtcclxuICAgICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGNoYW5nZURldGFpbCA9IHRoaXMucmVwb3NpdG9yeS5lbnRpdHlNYW5hZ2VyLmJ1aWxkRW50aXR5Q2hhbmdlRGV0YWlsQnlJZChpZCk7XHJcbiAgICBjb25zdCByZXF1ZXN0SW5mbyA9IHRoaXMucmVzdFNlcnZpY2UuYnVpbGRSZXF1ZXN0SW5mbygpO1xyXG5cclxuICAgIGNvbnN0IHVwZGF0ZSQgPSB0aGlzLnJlc3RTZXJ2aWNlLnVwZGF0ZShjaGFuZ2VEZXRhaWwsIHJlcXVlc3RJbmZvKTtcclxuICAgIGNvbnN0IHJlc3VsdCQgPSB1cGRhdGUkLnBpcGUoXHJcbiAgICAgIHRhcCgoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eU1hbmFnZXIuY2xlYXJFbnRpdHlDaGFuZ2VzQnlJZChpZCk7XHJcbiAgICAgIH0pLFxyXG4gICAgICBtYXAoKCkgPT4ge1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICAgIHJldHVybiByZXN1bHQkO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5o+Q5LqkcGF0aOWvueW6lOWunuS9k+eahOWPmOabtFxyXG4gICAqL1xyXG4gIHB1YmxpYyB1cGRhdGVDaGFuZ2VzQnlQYXRoKHBhdGg6IHN0cmluZywgaWQ6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ05vdCBJbXBsZW1lbnQnKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaPkOS6pOaJgOacieWPmOabtFxyXG4gICAqL1xyXG4gIHB1YmxpYyB1cGRhdGVBbGxDaGFuZ2VzKCk6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xyXG5cclxuICAgIC8vIOmBjeWOhuWunuS9k++8jOaPkOS6pOWPmOabtFxyXG4gICAgY29uc3QgdXBkYXRlUmVzdWx0czogT2JzZXJ2YWJsZTxib29sZWFuPltdID0gW107XHJcbiAgICBjb25zdCBlbnRpdGllczogRW50aXR5W10gPSB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi50b0FycmF5KCk7XHJcbiAgICBpZiAoZW50aXRpZXMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIHJldHVybiBvZih0cnVlKTtcclxuICAgIH1cclxuXHJcbiAgICBlbnRpdGllcy5mb3JFYWNoKChlbnRpdHk6IEVudGl0eSkgPT4ge1xyXG4gICAgICBjb25zdCB1cGRhdGVSZXN1bHQkID0gdGhpcy51cGRhdGVDaGFuZ2VzQnlJZChlbnRpdHkucHJpbWFyeVZhbHVlKTtcclxuICAgICAgdXBkYXRlUmVzdWx0cy5wdXNoKHVwZGF0ZVJlc3VsdCQpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgLy8g5Liy6IGU5rWBXHJcbiAgICBjb25zdCByZXN1bHQkID0gemlwKC4uLnVwZGF0ZVJlc3VsdHMpLnBpcGUoXHJcbiAgICAgIG1hcCgoKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG5cclxuICAgIHJldHVybiByZXN1bHQkO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5bqU55So5Y+Y5pu0XHJcbiAgICovXHJcbiAgcHVibGljIGFwcGx5Q2hhbmdlcygpOiBPYnNlcnZhYmxlPGJvb2xlYW4+IHtcclxuICAgIGNvbnN0IHJlcXVlc3RJbmZvID0gdGhpcy5yZXN0U2VydmljZS5idWlsZFJlcXVlc3RJbmZvKCk7XHJcbiAgICBjb25zdCBzYXZlJCA9IHRoaXMucmVzdFNlcnZpY2Uuc2F2ZShyZXF1ZXN0SW5mbyk7XHJcbiAgICBjb25zdCByZXN1bHQkID0gc2F2ZSQucGlwZShcclxuICAgICAgdGFwKCgpID0+IHtcclxuICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5TWFuYWdlci5jbGVhckFsbEVudGl0eUNoYW5nZXMoKTtcclxuICAgICAgICB0aGlzLnJlcG9zaXRvcnkuY2xlYXJBbGxWYXJpYWJsZUNoYW5nZXMocmVxdWVzdEluZm8udmFyaWFibGVDaGFuZ2UpO1xyXG4gICAgICAgIHRoaXMucmVwb3NpdG9yeS5kYXRhQ2hhbmdlSGlzdG9yeS5jbGVhcigpO1xyXG4gICAgICB9KSxcclxuICAgICAgbWFwKCgpID0+IHtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgfSlcclxuICAgICk7XHJcblxyXG4gICAgcmV0dXJuIHJlc3VsdCQ7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlupTnlKhpZEFycmF55a+55bqU5pWw5o2u55qE5Y+Y5pu0XHJcbiAgICovXHJcbiAgcHVibGljIGFwcGx5Q2hhbmdlc0J5SWRBcnJheShpZEFycmF5OiBzdHJpbmdbXSk6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xyXG4gICAgY29uc3QgcmVxdWVzdEluZm8gPSB0aGlzLnJlc3RTZXJ2aWNlLmJ1aWxkUmVxdWVzdEluZm8oKTtcclxuICAgIGNvbnN0IHNhdmUkID0gdGhpcy5yZXN0U2VydmljZS5zYXZlKHJlcXVlc3RJbmZvKTtcclxuICAgIGNvbnN0IHJlc3VsdCQgPSBzYXZlJC5waXBlKFxyXG4gICAgICB0YXAoKCkgPT4ge1xyXG4gICAgICAgIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlNYW5hZ2VyLmNsZWFyRW50aXR5Q2hhbmdlc0J5QXJyYXkoaWRBcnJheSk7XHJcbiAgICAgICAgdGhpcy5yZXBvc2l0b3J5LmRhdGFDaGFuZ2VIaXN0b3J5LmNsZWFyQnlJZHMoaWRBcnJheSk7XHJcbiAgICAgIH0pLFxyXG4gICAgICBtYXAoKCkgPT4ge1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuXHJcbiAgICByZXR1cm4gcmVzdWx0JDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOW6lOeUqGlk5a+55bqU5pWw5o2u55qE5Y+Y5pu0XHJcbiAgICovXHJcbiAgcHVibGljIGFwcGx5Q2hhbmdlc0J5SWQoaWQ6IHN0cmluZyk6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xyXG4gICAgY29uc3QgcmVxdWVzdEluZm8gPSB0aGlzLnJlc3RTZXJ2aWNlLmJ1aWxkUmVxdWVzdEluZm8oKTtcclxuICAgIGNvbnN0IHNhdmUkID0gdGhpcy5yZXN0U2VydmljZS5zYXZlKHJlcXVlc3RJbmZvKTtcclxuICAgIGNvbnN0IHJlc3VsdCQgPSBzYXZlJC5waXBlKFxyXG4gICAgICB0YXAoKCkgPT4ge1xyXG4gICAgICAgIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlNYW5hZ2VyLmNsZWFyRW50aXR5Q2hhbmdlc0J5SWQoaWQpO1xyXG4gICAgICAgIHRoaXMucmVwb3NpdG9yeS5kYXRhQ2hhbmdlSGlzdG9yeS5jbGVhckJ5SWRzKFtpZF0pO1xyXG4gICAgICB9KSxcclxuICAgICAgbWFwKCgpID0+IHtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgfSlcclxuICAgICk7XHJcblxyXG4gICAgcmV0dXJuIHJlc3VsdCQ7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlj5bmtojlj5jmm7RcclxuICAgKi9cclxuICBwdWJsaWMgY2FuY2VsQ2hhbmdlcyhvcHRpb25zPzogYW55KTogT2JzZXJ2YWJsZTxib29sZWFuPiB7XHJcbiAgICBjb25zdCBjYW5jZWwkID0gdGhpcy5yZXN0U2VydmljZS5jYW5jZWwob3B0aW9ucyk7XHJcbiAgICBjb25zdCByZXN1bHQkID0gY2FuY2VsJC5waXBlKFxyXG4gICAgICB0YXAoKCkgPT4ge1xyXG4gICAgICAgIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlNYW5hZ2VyLmNsZWFyQWxsRW50aXR5Q2hhbmdlcygpO1xyXG4gICAgICAgIHRoaXMucmVwb3NpdG9yeS5kYXRhQ2hhbmdlSGlzdG9yeS5jbGVhcigpO1xyXG4gICAgICB9KSxcclxuICAgICAgbWFwKCgpID0+IHtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgICByZXR1cm4gcmVzdWx0JDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaJuemHj+aWsOWinuS7juihqC/ku47ku47ooajmlbDmja5cclxuICAgKiBAcGFyYW0gcGF0aCDlrp7kvZPnu5Hlrprot6/lvoTvvIxsaWtlIDEvY2hpbGRzIG9yIDEvY2hpbGRzLzExL2NoaWxkY2hpbGRzXHJcbiAgICogQHBhcmFtIGRlZmF1bHRWYWx1ZXMg6buY6K6k5a6e5L2T5pWw5o2u5pWw57uEXHJcbiAgICovXHJcbiAgcHVibGljIGJhdGNoQXBwZW5kQnlQYXRoKHBhdGg6IHN0cmluZywgZGVmYXVsdFZhbHVlczogQXJyYXk8YW55Pik6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBjb25zdCByZXF1ZXN0SW5mbyA9IHRoaXMuYnVpbGRSZXF1ZXN0SW5mbygpO1xyXG4gICAgY29uc3QgYXBwZW5kJCA9IHRoaXMucmVzdFByb3h5LmJhdGNoQXBwZW5kQnlQYXRoKHBhdGgsIGRlZmF1bHRWYWx1ZXMsIHJlcXVlc3RJbmZvKTtcclxuICAgIHJldHVybiBhcHBlbmQkLnBpcGUoXHJcbiAgICAgIG1hcCgocmVzcG9uc2VJbmZvOiBSZXNwb25zZUluZm8pID0+IHtcclxuICAgICAgICBjb25zdCBsaXN0ID0gcmVzcG9uc2VJbmZvLnJldHVyblZhbHVlO1xyXG4gICAgICAgIGNvbnN0IGVudGl0aWVzID0gdGhpcy5yZXBvc2l0b3J5LmVudGl0eU1hbmFnZXIuY3JlYXRlRW50aXRpZXNCeVBhdGgocGF0aCwgbGlzdCk7XHJcbiAgICAgICAgY29uc3QgcGF0aHMgPSBwYXRoLnNwbGl0KCcvJykuZmlsdGVyKHAgPT4gcCk7XHJcbiAgICAgICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eU1hbmFnZXIuYXBwZW5kRW50aXRpZXNCeVBhdGgocGF0aHMsIGVudGl0aWVzKTtcclxuICAgICAgICByZXR1cm4gZW50aXRpZXM7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmibnph4/mlrDlop7kuLvooajmlbDmja5cclxuICAgKiBAcGFyYW0gZGVmYXVsdFZhbHVlcyDpu5jorqTlrp7kvZPmlbDmja7mlbDnu4RcclxuICAgKi9cclxuICBwdWJsaWMgYmF0Y2hBcHBlbmQoZGVmYXVsdFZhbHVlczogQXJyYXk8YW55Pik6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBjb25zdCByZXF1ZXN0SW5mbyA9IHRoaXMuYnVpbGRSZXF1ZXN0SW5mbygpO1xyXG4gICAgY29uc3QgYXBwZW5kJCA9IHRoaXMucmVzdFByb3h5LmJhdGNoQXBwZW5kKGRlZmF1bHRWYWx1ZXMsIHJlcXVlc3RJbmZvKTtcclxuICAgIHJldHVybiBhcHBlbmQkLnBpcGUoXHJcbiAgICAgIG1hcCgocmVzcG9uc2VJbmZvOiBSZXNwb25zZUluZm8pID0+IHtcclxuICAgICAgICBjb25zdCBsaXN0ID0gcmVzcG9uc2VJbmZvLnJldHVyblZhbHVlO1xyXG4gICAgICAgIGNvbnN0IGVudGl0aWVzID0gdGhpcy5yZXBvc2l0b3J5LmJ1aWxkRW50aXRpZXMobGlzdCk7XHJcbiAgICAgICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24uYWRkRW50aXRpZXMoZW50aXRpZXMpO1xyXG4gICAgICAgIHJldHVybiBlbnRpdGllcztcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOaehOmAoOWPmOabtOmbhlxyXG4gICAqL1xyXG4gIHB1YmxpYyBidWlsZFJlcXVlc3RJbmZvKCk6IFJlcXVlc3RJbmZvIHtcclxuICAgIGNvbnN0IHJlcXVlc3RJbmZvOiBSZXF1ZXN0SW5mbyA9IHtcclxuICAgICAgZGF0YUNoYW5nZTogdGhpcy5yZXBvc2l0b3J5LmVudGl0eU1hbmFnZXIuYnVpbGRBbGxFbnRpdHlDaGFuZ2VEZXRhaWxzKCksXHJcbiAgICAgIHZhcmlhYmxlQ2hhbmdlOiB0aGlzLnJlcG9zaXRvcnkudmFyaWFibGVNYW5hZ2VyLmJ1aWxkQ2hhbmdlRGV0YWlsKClcclxuICAgIH07XHJcbiAgICByZXR1cm4gcmVxdWVzdEluZm87XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgeyBCZWZEYXRhU2VydmljZSB9O1xyXG4iXX0=