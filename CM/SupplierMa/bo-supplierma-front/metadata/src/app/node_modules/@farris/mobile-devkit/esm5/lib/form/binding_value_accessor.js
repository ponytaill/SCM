import { BindingPathConverter, DateUtil } from '../utils/index';
import { BindingType } from './types';
/**
 * Entity值访问器
 */
var EntityBindingValueAccessor = /** @class */ (function () {
    function EntityBindingValueAccessor(bindingData, bindingPath, valueConverter) {
        this.bindingData = bindingData;
        this.bindingPathSegments = this.getBindingPathSegments(bindingPath);
        this.valueConverter = valueConverter;
    }
    EntityBindingValueAccessor.prototype.getValue = function () {
        var stateValue = this.bindingData.getValue(this.bindingPathSegments);
        var controlValue = this.valueConverter ? this.valueConverter.convertTo(stateValue) : stateValue;
        return controlValue;
    };
    EntityBindingValueAccessor.prototype.setValue = function (controlValue) {
        var oldStateValue = this.bindingData.getValue(this.bindingPathSegments);
        var stateValue = this.valueConverter ? this.valueConverter.convertFrom(controlValue) : controlValue;
        if (this.isDateConverter(this.valueConverter) === true) {
            if (DateUtil.isEqual(oldStateValue, stateValue) === true) {
                return;
            }
        }
        this.bindingData.setValue(this.bindingPathSegments, stateValue, true, true);
    };
    EntityBindingValueAccessor.prototype.getBindingPathSegments = function (bindingPath) {
        var parentPathSegments = BindingPathConverter.toBindingPathArray(this.bindingData.bindingPath);
        bindingPath = bindingPath.replace(/\./g, '\/');
        var bindingPathSegments = BindingPathConverter.toBindingPathArray(bindingPath);
        return parentPathSegments.concat(bindingPathSegments);
    };
    /**
     * 是否是DateConverter
     */
    EntityBindingValueAccessor.prototype.isDateConverter = function (converter) {
        var isDateConverter = false;
        if (converter && converter.hasOwnProperty('format') === true) {
            isDateConverter = true;
        }
        return isDateConverter;
    };
    return EntityBindingValueAccessor;
}());
/**
 * UIState值访问器
 */
var UIStateBindingValueAccessor = /** @class */ (function () {
    function UIStateBindingValueAccessor(uiState, bindingPath, valueConverter) {
        this.uiState = uiState;
        this.bindingPathSegments = this.getUiStateBindingPath(bindingPath);
    }
    UIStateBindingValueAccessor.prototype.getValue = function () {
        var stateValue;
        var obj = this.uiState;
        this.bindingPathSegments.forEach(function (item) {
            stateValue = obj[item];
            obj = stateValue;
        });
        return stateValue;
    };
    UIStateBindingValueAccessor.prototype.setValue = function (controlValue) {
        var _a;
        var length = this.bindingPathSegments.length;
        if (length === 1) {
            this.uiState.setPropertyValue(this.bindingPathSegments, controlValue);
        }
        else {
            var obj = void 0;
            for (var i = length - 1; i > 0; i--) {
                obj = (_a = {}, _a[this.bindingPathSegments[i]] = controlValue, _a);
                controlValue = obj;
            }
            this.uiState.setPropertyValue(this.bindingPathSegments[0], obj);
        }
    };
    // UISTATE获取路径
    UIStateBindingValueAccessor.prototype.getUiStateBindingPath = function (bindingPath) {
        var index = bindingPath.search('/');
        if (index !== -1) {
            return bindingPath.split('/');
        }
        else {
            return [bindingPath];
        }
    };
    return UIStateBindingValueAccessor;
}());
/**
 * 绑定值访问器工厂
 */
var BindingValueAccessorFactory = /** @class */ (function () {
    function BindingValueAccessorFactory() {
    }
    BindingValueAccessorFactory.create = function (bindingType, bindingBindingPath, bindingValueConverter, viewModelContext) {
        switch (bindingType) {
            case BindingType.EntityState:
                var bindingData = viewModelContext.bindingData;
                return new EntityBindingValueAccessor(bindingData, bindingBindingPath, bindingValueConverter);
            case BindingType.UIState:
                var uiState = viewModelContext.uiState;
                return new UIStateBindingValueAccessor(uiState, bindingBindingPath, bindingValueConverter);
            default:
                throw new Error('Not Supported');
        }
    };
    return BindingValueAccessorFactory;
}());
export { EntityBindingValueAccessor, UIStateBindingValueAccessor, BindingValueAccessorFactory };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmluZGluZ192YWx1ZV9hY2Nlc3Nvci5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvbW9iaWxlLWRldmtpdC8iLCJzb3VyY2VzIjpbImxpYi9mb3JtL2JpbmRpbmdfdmFsdWVfYWNjZXNzb3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBR0EsT0FBTyxFQUFFLG9CQUFvQixFQUFFLFFBQVEsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRWhFLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxTQUFTLENBQUM7QUFhdEM7O0dBRUc7QUFDSDtJQVFFLG9DQUFZLFdBQXdCLEVBQUUsV0FBbUIsRUFBRSxjQUFxQztRQUM5RixJQUFJLENBQUMsV0FBVyxHQUFHLFdBQVcsQ0FBQztRQUMvQixJQUFJLENBQUMsbUJBQW1CLEdBQUcsSUFBSSxDQUFDLHNCQUFzQixDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQ3BFLElBQUksQ0FBQyxjQUFjLEdBQUcsY0FBYyxDQUFDO0lBQ3ZDLENBQUM7SUFFTSw2Q0FBUSxHQUFmO1FBQ0UsSUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLENBQUM7UUFDdkUsSUFBTSxZQUFZLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQztRQUNsRyxPQUFPLFlBQVksQ0FBQztJQUN0QixDQUFDO0lBRU0sNkNBQVEsR0FBZixVQUFnQixZQUFpQjtRQUMvQixJQUFNLGFBQWEsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsbUJBQW1CLENBQUMsQ0FBQztRQUMxRSxJQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLFdBQVcsQ0FBQyxZQUFZLENBQUMs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QVcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDdEMsSUFBSSxLQUFLLEtBQUssQ0FBQyxDQUFDLEVBQUU7WUFDaEIsT0FBTyxXQUFXLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFBO1NBQzlCO2FBQU07WUFDTCxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUE7U0FDckI7SUFDSCxDQUFDO0lBQ0gsa0NBQUM7QUFBRCxDQUFDLEFBN0NELElBNkNDO0FBRUQ7O0dBRUc7QUFDSDtJQUFBO0lBY0EsQ0FBQztJQVpRLGtDQUFNLEdBQWIsVUFBYyxXQUF3QixFQUFFLGtCQUEwQixFQUFFLHFCQUFxQixFQUFFLGdCQUFrQztRQUMzSCxRQUFRLFdBQVcsRUFBRTtZQUNuQixLQUFLLFdBQVcsQ0FBQyxXQUFXO2dCQUMxQixJQUFNLFdBQVcsR0FBRyxnQkFBZ0IsQ0FBQyxXQUFXLENBQUM7Z0JBQ2pELE9BQU8sSUFBSSwwQkFBMEIsQ0FBQyxXQUFXLEVBQUUsa0JBQWtCLEVBQUUscUJBQXFCLENBQUMsQ0FBQztZQUNoRyxLQUFLLFdBQVcsQ0FBQyxPQUFPO2dCQUN0QixJQUFNLE9BQU8sR0FBRyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUM7Z0JBQ3pDLE9BQU8sSUFBSSwyQkFBMkIsQ0FBQyxPQUFPLEVBQUUsa0JBQWtCLEVBQUUscUJBQXFCLENBQUMsQ0FBQztZQUM3RjtnQkFDRSxNQUFNLElBQUksS0FBSyxDQUFDLGVBQWUsQ0FBQyxDQUFDO1NBQ3BDO0lBQ0gsQ0FBQztJQUNILGtDQUFDO0FBQUQsQ0FBQyxBQWRELElBY0M7QUFFRCxPQUFPLEVBQXdCLDBCQUEwQixFQUFFLDJCQUEyQixFQUFFLDJCQUEyQixFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBCaW5kaW5nRGF0YSB9IGZyb20gJy4uL2JpbmRpbmctZGF0YS9pbmRleCc7XHJcbmltcG9ydCB7IFVJU3RhdGUgfSBmcm9tICcuLi91aS1zdGF0ZS9pbmRleCc7XHJcbmltcG9ydCB7IFZpZXdNb2RlbENvbnRleHQgfSBmcm9tICcuLi92aWV3LW1vZGVsL2luZGV4JztcclxuaW1wb3J0IHsgQmluZGluZ1BhdGhDb252ZXJ0ZXIsIERhdGVVdGlsIH0gZnJvbSAnLi4vdXRpbHMvaW5kZXgnO1xyXG5cclxuaW1wb3J0IHsgQmluZGluZ1R5cGUgfSBmcm9tICcuL3R5cGVzJztcclxuaW1wb3J0IHsgQmluZGluZ1ZhbHVlQ29udmVydGVyIH0gZnJvbSAnLi9iaW5kaW5nX3ZhbHVlX2NvbnZlcnRlcic7XHJcblxyXG4vKipcclxuICog57uR5a6a5YC86K6/6Zeu5Zmo5o6l5Y+jXHJcbiAqL1xyXG5pbnRlcmZhY2UgQmluZGluZ1ZhbHVlQWNjZXNzb3Ige1xyXG5cclxuICBnZXRWYWx1ZSgpOiBhbnk7XHJcblxyXG4gIHNldFZhbHVlKGNvbnRyb2xWYWx1ZTogYW55KTogdm9pZDtcclxufVxyXG5cclxuLyoqXHJcbiAqIEVudGl0eeWAvOiuv+mXruWZqFxyXG4gKi9cclxuY2xhc3MgRW50aXR5QmluZGluZ1ZhbHVlQWNjZXNzb3IgaW1wbGVtZW50cyBCaW5kaW5nVmFsdWVBY2Nlc3NvciB7XHJcblxyXG4gIHByaXZhdGUgYmluZGluZ0RhdGE6IEJpbmRpbmdEYXRhO1xyXG5cclxuICBwcml2YXRlIGJpbmRpbmdQYXRoU2VnbWVudHM6IHN0cmluZ1tdO1xyXG5cclxuICBwcml2YXRlIHZhbHVlQ29udmVydGVyOiBCaW5kaW5nVmFsdWVDb252ZXJ0ZXI7XHJcblxyXG4gIGNvbnN0cnVjdG9yKGJpbmRpbmdEYXRhOiBCaW5kaW5nRGF0YSwgYmluZGluZ1BhdGg6IHN0cmluZywgdmFsdWVDb252ZXJ0ZXI6IEJpbmRpbmdWYWx1ZUNvbnZlcnRlcikge1xyXG4gICAgdGhpcy5iaW5kaW5nRGF0YSA9IGJpbmRpbmdEYXRhO1xyXG4gICAgdGhpcy5iaW5kaW5nUGF0aFNlZ21lbnRzID0gdGhpcy5nZXRCaW5kaW5nUGF0aFNlZ21lbnRzKGJpbmRpbmdQYXRoKTtcclxuICAgIHRoaXMudmFsdWVDb252ZXJ0ZXIgPSB2YWx1ZUNvbnZlcnRlcjtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRWYWx1ZSgpOiBhbnkge1xyXG4gICAgY29uc3Qgc3RhdGVWYWx1ZSA9IHRoaXMuYmluZGluZ0RhdGEuZ2V0VmFsdWUodGhpcy5iaW5kaW5nUGF0aFNlZ21lbnRzKTtcclxuICAgIGNvbnN0IGNvbnRyb2xWYWx1ZSA9IHRoaXMudmFsdWVDb252ZXJ0ZXIgPyB0aGlzLnZhbHVlQ29udmVydGVyLmNvbnZlcnRUbyhzdGF0ZVZhbHVlKSA6IHN0YXRlVmFsdWU7XHJcbiAgICByZXR1cm4gY29udHJvbFZhbHVlO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHNldFZhbHVlKGNvbnRyb2xWYWx1ZTogYW55KTogdm9pZCB7XHJcbiAgICBjb25zdCBvbGRTdGF0ZVZhbHVlID0gdGhpcy5iaW5kaW5nRGF0YS5nZXRWYWx1ZSh0aGlzLmJpbmRpbmdQYXRoU2VnbWVudHMpO1xyXG4gICAgY29uc3Qgc3RhdGVWYWx1ZSA9IHRoaXMudmFsdWVDb252ZXJ0ZXIgPyB0aGlzLnZhbHVlQ29udmVydGVyLmNvbnZlcnRGcm9tKGNvbnRyb2xWYWx1ZSkgOiBjb250cm9sVmFsdWU7XHJcblxyXG4gICAgaWYgKHRoaXMuaXNEYXRlQ29udmVydGVyKHRoaXMudmFsdWVDb252ZXJ0ZXIpID09PSB0cnVlKSB7XHJcbiAgICAgIGlmIChEYXRlVXRpbC5pc0VxdWFsKG9sZFN0YXRlVmFsdWUsIHN0YXRlVmFsdWUpID09PSB0cnVlKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5iaW5kaW5nRGF0YS5zZXRWYWx1ZSh0aGlzLmJpbmRpbmdQYXRoU2VnbWVudHMsIHN0YXRlVmFsdWUsIHRydWUsIHRydWUpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXRCaW5kaW5nUGF0aFNlZ21lbnRzKGJpbmRpbmdQYXRoOiBzdHJpbmcpIHtcclxuICAgIGNvbnN0IHBhcmVudFBhdGhTZWdtZW50cyA9IEJpbmRpbmdQYXRoQ29udmVydGVyLnRvQmluZGluZ1BhdGhBcnJheSh0aGlzLmJpbmRpbmdEYXRhLmJpbmRpbmdQYXRoKTtcclxuICAgIGJpbmRpbmdQYXRoID0gYmluZGluZ1BhdGgucmVwbGFjZSgvXFwuL2csICdcXC8nKTtcclxuICAgIGNvbnN0IGJpbmRpbmdQYXRoU2VnbWVudHMgPSBCaW5kaW5nUGF0aENvbnZlcnRlci50b0JpbmRpbmdQYXRoQXJyYXkoYmluZGluZ1BhdGgpO1xyXG4gICAgcmV0dXJuIHBhcmVudFBhdGhTZWdtZW50cy5jb25jYXQoYmluZGluZ1BhdGhTZWdtZW50cyk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmmK/lkKbmmK9EYXRlQ29udmVydGVyXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBpc0RhdGVDb252ZXJ0ZXIoY29udmVydGVyOiBCaW5kaW5nVmFsdWVDb252ZXJ0ZXIpOiBib29sZWFuIHtcclxuICAgIGxldCBpc0RhdGVDb252ZXJ0ZXIgPSBmYWxzZTtcclxuICAgIGlmIChjb252ZXJ0ZXIgJiYgY29udmVydGVyLmhhc093blByb3BlcnR5KCdmb3JtYXQnKSA9PT0gdHJ1ZSkge1xyXG4gICAgICBpc0RhdGVDb252ZXJ0ZXIgPSB0cnVlO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGlzRGF0ZUNvbnZlcnRlcjtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBVSVN0YXRl5YC86K6/6Zeu5ZmoXHJcbiAqL1xyXG5jbGFzcyBVSVN0YXRlQmluZGluZ1ZhbHVlQWNjZXNzb3IgaW1wbGVtZW50cyBCaW5kaW5nVmFsdWVBY2Nlc3NvciB7XHJcblxyXG4gIHByaXZhdGUgdWlTdGF0ZTogVUlTdGF0ZTtcclxuXHJcbiAgcHJpdmF0ZSBiaW5kaW5nUGF0aFNlZ21lbnRzOiBzdHJpbmdbXTtcclxuXHJcblxyXG4gIGNvbnN0cnVjdG9yKHVpU3RhdGU6IFVJU3RhdGUsIGJpbmRpbmdQYXRoOiBzdHJpbmcsIHZhbHVlQ29udmVydGVyOiBCaW5kaW5nVmFsdWVDb252ZXJ0ZXIpIHtcclxuICAgIHRoaXMudWlTdGF0ZSA9IHVpU3RhdGU7XHJcbiAgICB0aGlzLmJpbmRpbmdQYXRoU2VnbWVudHMgPSB0aGlzLmdldFVpU3RhdGVCaW5kaW5nUGF0aChiaW5kaW5nUGF0aCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0VmFsdWUoKTogYW55IHtcclxuICAgIGxldCBzdGF0ZVZhbHVlO1xyXG4gICAgbGV0IG9iaiA9IHRoaXMudWlTdGF0ZTtcclxuICAgIHRoaXMuYmluZGluZ1BhdGhTZWdtZW50cy5mb3JFYWNoKGl0ZW0gPT4ge1xyXG4gICAgICBzdGF0ZVZhbHVlID0gb2JqW2l0ZW1dO1xyXG4gICAgICBvYmogPSBzdGF0ZVZhbHVlXHJcbiAgICB9KVxyXG4gICAgcmV0dXJuIHN0YXRlVmFsdWU7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc2V0VmFsdWUoY29udHJvbFZhbHVlOiBhbnkpOiB2b2lkIHtcclxuICAgIGNvbnN0IGxlbmd0aCA9IHRoaXMuYmluZGluZ1BhdGhTZWdtZW50cy5sZW5ndGg7XHJcbiAgICBpZiAobGVuZ3RoID09PSAxKSB7XHJcbiAgICAgIHRoaXMudWlTdGF0ZS5zZXRQcm9wZXJ0eVZhbHVlKHRoaXMuYmluZGluZ1BhdGhTZWdtZW50cywgY29udHJvbFZhbHVlKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGxldCBvYmo7XHJcbiAgICAgIGZvcihsZXQgaSA9IGxlbmd0aC0xIDsgaSA+IDAgOyBpLS0pe1xyXG4gICAgICAgIG9iaiA9IHtbdGhpcy5iaW5kaW5nUGF0aFNlZ21lbnRzW2ldXTogY29udHJvbFZhbHVlfTtcclxuICAgICAgICBjb250cm9sVmFsdWUgPSBvYmo7XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy51aVN0YXRlLnNldFByb3BlcnR5VmFsdWUodGhpcy5iaW5kaW5nUGF0aFNlZ21lbnRzWzBdLCBvYmopO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gVUlTVEFUReiOt+WPlui3r+W+hFxyXG4gIHByaXZhdGUgZ2V0VWlTdGF0ZUJpbmRpbmdQYXRoKGJpbmRpbmdQYXRoOiBzdHJpbmcpIHtcclxuICAgIGNvbnN0IGluZGV4ID0gYmluZGluZ1BhdGguc2VhcmNoKCcvJyk7XHJcbiAgICBpZiAoaW5kZXggIT09IC0xKSB7XHJcbiAgICAgIHJldHVybiBiaW5kaW5nUGF0aC5zcGxpdCgnLycpXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gW2JpbmRpbmdQYXRoXVxyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIOe7keWumuWAvOiuv+mXruWZqOW3peWOglxyXG4gKi9cclxuY2xhc3MgQmluZGluZ1ZhbHVlQWNjZXNzb3JGYWN0b3J5IHtcclxuXHJcbiAgc3RhdGljIGNyZWF0ZShiaW5kaW5nVHlwZTogQmluZGluZ1R5cGUsIGJpbmRpbmdCaW5kaW5nUGF0aDogc3RyaW5nLCBiaW5kaW5nVmFsdWVDb252ZXJ0ZXIsIHZpZXdNb2RlbENvbnRleHQ6IFZpZXdNb2RlbENvbnRleHQpIHtcclxuICAgIHN3aXRjaCAoYmluZGluZ1R5cGUpIHtcclxuICAgICAgY2FzZSBCaW5kaW5nVHlwZS5FbnRpdHlTdGF0ZTpcclxuICAgICAgICBjb25zdCBiaW5kaW5nRGF0YSA9IHZpZXdNb2RlbENvbnRleHQuYmluZGluZ0RhdGE7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBFbnRpdHlCaW5kaW5nVmFsdWVBY2Nlc3NvcihiaW5kaW5nRGF0YSwgYmluZGluZ0JpbmRpbmdQYXRoLCBiaW5kaW5nVmFsdWVDb252ZXJ0ZXIpO1xyXG4gICAgICBjYXNlIEJpbmRpbmdUeXBlLlVJU3RhdGU6XHJcbiAgICAgICAgY29uc3QgdWlTdGF0ZSA9IHZpZXdNb2RlbENvbnRleHQudWlTdGF0ZTtcclxuICAgICAgICByZXR1cm4gbmV3IFVJU3RhdGVCaW5kaW5nVmFsdWVBY2Nlc3Nvcih1aVN0YXRlLCBiaW5kaW5nQmluZGluZ1BhdGgsIGJpbmRpbmdWYWx1ZUNvbnZlcnRlcik7XHJcbiAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdOb3QgU3VwcG9ydGVkJyk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgeyBCaW5kaW5nVmFsdWVBY2Nlc3NvciwgRW50aXR5QmluZGluZ1ZhbHVlQWNjZXNzb3IsIFVJU3RhdGVCaW5kaW5nVmFsdWVBY2Nlc3NvciwgQmluZGluZ1ZhbHVlQWNjZXNzb3JGYWN0b3J5IH07XHJcbiJdfQ==