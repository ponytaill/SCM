{"version":3,"sources":["ng://@farris/ui-loading/lib/loading.config.ts","ng://@farris/ui-loading/lib/loading.styles.ts","ng://@farris/ui-loading/lib/loading.component.ts","ng://@farris/ui-loading/lib/loading.service.ts","ng://@farris/ui-loading/lib/loading.module.ts"],"names":["loaddingDefaultConfig","width","container","message","posion","type","delay","LOADING_DEFAULT_CONFIG","InjectionToken","LOADING_STYLES","LoadingComponent","Object","defineProperty","prototype","this","_isActive","val","activeSubject","next","ngOnInit","_this_1","activedSubscrition","pipe","takeUntil","destroy$","filter","n","subscribe","v","isActive","render","setStyle","loadingContainerEl","nativeElement","loadingBackdrop","setPosition","ngAfterViewInit","ngOnDestroy","complete","close","remove","removeAttribute","el","closed","emit","containerWidth","clientWidth","containerHeight","clientHeight","animate","animateCls","addAnimationEndEvent","setAttribute","events","_i","arguments","length","_this","forEach","e","addEventListener","handler","removeEventListener","removeClass","Component","args","selector","template","Renderer2","ElementRef","Input","ViewChild","Output","showMessage","loadingStyleDom","BehaviorSubject","EventEmitter","Subject","LoadingService","show","config","_loadingCmpRef","injecotr","get","assign","loadingFactory","cfr","resolveComponentFactory","create","localStorage","getItem","localeSer","getValue","document","querySelector","appendChild","location","Element","instance","state","loadingInstances","id","currentLoadingInstanceID","getMaxLoadingID","clearDom","changeDetectorRef","markForCheck","detectChanges","loadingID","createInsId","loadingId","loadingRef","clearAll","keys","loadings","querySelectorAll","loadingEl","parentNode","removeChild","destroy","ids","map","k","parseInt","max","Injectable","ApplicationRef","ComponentFactoryResolver","Injector","appRef","LocaleService","LoadingModule","forRoot","ngModule","providers","provide","useValue","NgModule","imports","CommonModule","FarrisCommonModule","LocaleModule","declarations","entryComponents"],"mappings":"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","sourcesContent":["import { InjectionToken } from '@angular/core';\r\n\r\nexport interface LoadingConfig {\r\n    width?: number;\r\n    container?: any;\r\n    message?: string;\r\n    position?: string;\r\n    template?: string;\r\n    type?: number;\r\n    /** å»¶è¿1s åå¨æ¾ç¤º */\r\n    delay?: number;\r\n}\r\n\r\nexport const loaddingDefaultConfig = {\r\n    width: 30,\r\n    container: 'body',\r\n    message: 'æ­£å¨å è½½ä¸­ï¼è¯·ç¨å...',\r\n    posion: 'center',\r\n    type: 0,\r\n    delay: 300\r\n};\r\n\r\nexport const LOADING_DEFAULT_CONFIG = new InjectionToken<LoadingConfig>('loading default options.');\r\n","export const LOADING_STYLES = [\r\n  `<div class=\"f-loading-round\"></div>`,\r\n  `<div class=\"f-loading-dot-wrapper\">\r\n    <div class=\"f-loading-dot\">\r\n        <div class=\"dot dot1\"></div>\r\n        <div class=\"dot dot2\"></div>\r\n        <div class=\"dot dot3\"></div>\r\n        <div class=\"dot dot4\"></div>\r\n    </div>\r\n</div>`,\r\n  `<svg width=\"100%\" height=\"100%\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\" preserveAspectRatio=\"xMidYMid\" class=\"lds-coffee\"><defs><linearGradient id=\"gradient\" x1=\"0%\" x2=\"0%\" y1=\"0%\" y2=\"100%\"><stop offset=\"10%\" stop-color=\"black\" stop-opacity=\"0\"></stop><stop offset=\"100%\" stop-color=\"white\" stop-opacity=\"1\"></stop></linearGradient><mask id=\"mask\" maskUnits=\"userSpaceOnUse\" x=\"0\" y=\"0\" width=\"100\" height=\"100\"><rect x=\"22\" y=\"8\" width=\"56\" height=\"54\" fill=\"url(#gradient)\"></rect></mask><path id=\"steam\" d=\"M0-4c-2.1,2.6-2.1,6.4,0,9l0,0c2.1,2.6,2.1,6.4,0,9l0,0c-2.1,2.6-2.1,6.4,0,9l0,0c2.1,2.6,2.1,6.4,0,9l0,0 c-2.1,2.6-2.1,6.4,0,9l0,0c2.1,2.6,2.1,6.4,0,9c-2.1,2.6-2.1,6.4,0,9l0,0c2.1,2.6,2.1,6.4,0,9l0,0c-2.1,2.6-2.1,6.4,0,9l0,0 c2.1,2.6,2.1,6.4,0,9l0,0c-2.1,2.6-2.1,6.4,0,9l0,0c2.1,2.6,2.1,6.4,0,9c-2.1,2.6-2.1,6.4,0,9l0,0c2.1,2.6,2.1,6.4,0,9l0,0 c-2.1,2.6-2.1,6.4,0,9h0c2.1,2.6,2.1,6.4,0,9h0c-2.1,2.6-2.1,6.4,0,9h0c2.1,2.6,2.1,6.4,0,9\" stroke-width=\"6\" stroke-linecap=\"round\" fill=\"#f00\" stroke=\"#58a8f6\"></path></defs><g mask=\"url(#mask)\"><use x=\"29\" y=\"1.00876\" href=\"#steam\"><animate attributeName=\"y\" calcMode=\"linear\" values=\"4;-14\" keyTimes=\"0;1\" dur=\"0.5\" begin=\"0s\" repeatCount=\"indefinite\"></animate></use><use x=\"47\" y=\"-5.98248\" href=\"#steam\"><animate attributeName=\"y\" calcMode=\"linear\" values=\"0;-18\" keyTimes=\"0;1\" dur=\"0.25\" begin=\"0s\" repeatCount=\"indefinite\"></animate></use><use x=\"64\" y=\"-8.48686\" href=\"#steam\"><animate attributeName=\"y\" calcMode=\"linear\" values=\"-4;-22\" keyTimes=\"0;1\" dur=\"0.3333333333333333\" begin=\"0s\" repeatCount=\"indefinite\"></animate></use></g><path d=\"M81.2,52.5l-5.2,0V49c0-1.6-1.3-3-3-3H20c-1.6,0-3,1.3-3,3v11.6C17,71.3,25.7,80,36.5,80h20.1 c7.1,0,13.3-3.8,16.7-9.5h8.3c5.2,0,9.3-4.4,9-9.6C90.2,56.1,86,52.5,81.2,52.5z M81.5,67.5h-6.8c0.8-2.2,1.3-4.5,1.3-7v-5h5.5 c3.3,0,6,2.7,6,6S84.8,67.5,81.5,67.5z\" fill=\"#58a8f6\"></path><path d=\"M78.8,88H19.2c-1.1,0-2-0.9-2-2s0.9-2,2-2h59.5c1.1,0,2,0.9,2,2S79.9,88,78.8,88z\" fill=\"rgba(80.78431372549018%,94.50980392156862%,72.15686274509802%,0)\"></path></svg>`\r\n];\r\n","import { Observable, Subject, Subscription, BehaviorSubject } from 'rxjs';\r\n/*\r\n * @Author: ç¯çç§æ(Lucas Huang)\r\n * @LastEditors: ç¯çç§æ(Lucas Huang)\r\n * @Company: Inspur\r\n * @Version: v0.1.8\r\n * @Date: 2018-09-18 16:04:05\r\n * @LastEditTime: 2019-10-17 13:42:45\r\n */\r\n\r\nimport { Component, OnInit, ElementRef, ViewChild, Renderer2, AfterViewInit, Output, EventEmitter, OnDestroy, Input } from '@angular/core';\r\nimport { LOADING_STYLES } from './loading.styles';\r\nimport { delay, filter, debounceTime, switchMap, takeUntil } from 'rxjs/operators';\r\nimport { of } from 'rxjs';\r\n\r\n@Component({\r\n    selector: 'farris-loading',\r\n    template: `\r\n        <div #loadingBackdrop class=\"farris-loading-backdrop loading-wait\" style=\"display: none\"></div>\r\n        <div #loadingContainerEl class=\"farris-loading\" style=\"display: none\">\r\n            <div class=\"ng-busy-default-wrapper\">\r\n                <div class=\"ng-busy-default-sign\" >\r\n                    <div [style.width]=\"width+ 'px'\" [style.height]=\"width+'px'\" style=\"display: inline-block;margin:4px;\"\r\n                                [innerHTML]=\"loadingStyleDom[type] | safe: 'html'\"></div>\r\n                    <div class=\"ng-busy-default-text\" style=\"margin-left:0;\"\r\n                                 *ngIf=\"showMessage\" [innerHTML]=\"'loading.message' | locale: '' :message | safe: 'html'\"></div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    `,\r\n    styles: [\r\n        `.loading-wait {\r\n            cursor: wait\r\n        }\r\n        .animated-0.5 {\r\n            -webkit-animation-duration: 0s;\r\n            animation-duration: 0s;\r\n        }\r\n        `\r\n    ]\r\n})\r\nexport class LoadingComponent implements OnInit, AfterViewInit, OnDestroy {\r\n    @Input() showMessage = true;\r\n    loadingStyleDom = LOADING_STYLES;\r\n    id: number;\r\n    private _isActive = false;\r\n    private activeSubject = new BehaviorSubject(false);\r\n    message = '';\r\n    width = 30;\r\n    /** loading æ ·å¼ */\r\n    type = 0;\r\n\r\n    delay = 300;\r\n\r\n    get isActive(): boolean {\r\n        return this._isActive;\r\n    }\r\n\r\n    set isActive(val: boolean) {\r\n        this._isActive = val;\r\n        if (this.activeSubject) {\r\n            this.activeSubject.next(val);\r\n        }\r\n    }\r\n\r\n    @ViewChild('loadingContainerEl') loadingContainerEl: ElementRef;\r\n    @ViewChild('loadingBackdrop') loadingBackdrop: ElementRef;\r\n    @Output() closed = new EventEmitter<any>();\r\n    activedSubscrition: Subscription = null;\r\n\r\n    private destroy$ = new Subject();\r\n\r\n    constructor(private render: Renderer2, private el: ElementRef) {\r\n    }\r\n\r\n    ngOnInit() {\r\n        this.activedSubscrition = this.activeSubject.pipe(\r\n            takeUntil(this.destroy$)\r\n        ).pipe(\r\n            filter((n: boolean) => {\r\n                return n;\r\n            }),\r\n            delay(this.delay)\r\n        ).subscribe(v => {\r\n            if (v && this.isActive) {\r\n                // this.animate('f-component-loading fadeIn animated');\r\n                this.render.setStyle(this.loadingContainerEl.nativeElement, 'display', 'block');\r\n                this.render.setStyle(this.loadingBackdrop.nativeElement, 'display', 'block');\r\n                this.setPosition();\r\n            }\r\n        });\r\n    }\r\n\r\n    ngAfterViewInit() {\r\n\r\n    }\r\n\r\n    ngOnDestroy() {\r\n        this.destroy$.next();\r\n        this.destroy$.complete();\r\n        // this.activeSubject.complete();\r\n        // this.activeSubject = null;\r\n        // this.activedSubscrition.unsubscribe();\r\n    }\r\n\r\n    close() {\r\n        // if (this.loadingBackdrop.nativeElement.parentElement) {\r\n        //     this.render.removeChild(this.el.nativeElement, this.loadingBackdrop.nativeElement);\r\n        // }\r\n        // const waitEle = document.body.querySelector('.farris-loading-backdrop');\r\n        if (this.loadingBackdrop) {\r\n            this.loadingBackdrop.nativeElement.remove();\r\n        }\r\n        this.isActive = false;\r\n        this.render.removeAttribute(this.el.nativeElement, 'class');\r\n        // this.animate('f-component-loading fadeOut animated animated-0.5');\r\n        this.closed.emit(this.isActive);\r\n    }\r\n\r\n    private setPosition() {\r\n        const containerWidth = this.loadingContainerEl.nativeElement.clientWidth;\r\n        const containerHeight = this.loadingContainerEl.nativeElement.clientHeight;\r\n\r\n        this.render.setStyle(this.loadingContainerEl.nativeElement, 'marginTop', -containerHeight / 2 + 'px');\r\n        this.render.setStyle(this.loadingContainerEl.nativeElement, 'marginLeft', -containerWidth / 2 + 'px');\r\n    }\r\n\r\n    private animate(animateCls: string) {\r\n        this.addAnimationEndEvent('webkitAnimationEnd', 'mozAnimationEnd', 'MSAnimationEnd', 'oanimationend', 'animationend');\r\n        this.render.setAttribute(this.el.nativeElement, 'class', animateCls);\r\n    }\r\n\r\n    private addAnimationEndEvent(...events: string[]) {\r\n        const _this = this;\r\n\r\n        events.forEach(e => {\r\n            _this.el.nativeElement.addEventListener(e, function handler() {\r\n                _this.el.nativeElement.removeEventListener(e, handler);\r\n                // _this.render.removeAttribute(_this.el.nativeElement, 'class');\r\n                ['fadeIn', 'fadeOut', 'animated', 'animated-0.5'].forEach(n => {\r\n                    _this.render.removeClass(_this.el.nativeElement, n);\r\n                });\r\n                _this.closed.emit(_this.isActive);\r\n            });\r\n        });\r\n    }\r\n}\r\n","import { LocaleService } from '@farris/ui-locale';\r\nimport { Injectable, ApplicationRef, ComponentFactoryResolver, Injector, ComponentRef, ElementRef } from '@angular/core';\r\nimport { LoadingConfig, LOADING_DEFAULT_CONFIG, loaddingDefaultConfig } from './loading.config';\r\nimport { LoadingComponent } from './loading.component';\r\nimport { max } from 'lodash-es';\r\n\r\n@Injectable()\r\nexport class LoadingService {\r\n    config: LoadingConfig;\r\n\r\n    private currentLoadingInstanceID = null;\r\n    private loadingInstances: { [key: number]: ComponentRef<LoadingComponent> } = {};\r\n    private localeSer: LocaleService;\r\n    constructor(private appRef: ApplicationRef,\r\n                private cfr: ComponentFactoryResolver, private injecotr: Injector) {\r\n                    this.localeSer = this.injecotr.get(LocaleService);\r\n    }\r\n\r\n    show(config?: LoadingConfig): LoadingComponent {\r\n        this.config = this.injecotr.get(LOADING_DEFAULT_CONFIG) || {};\r\n        this.config = Object.assign(loaddingDefaultConfig, this.config);\r\n\r\n        let _loadingCmpRef: ComponentRef<LoadingComponent>;\r\n        const loadingFactory = this.cfr.resolveComponentFactory(LoadingComponent);\r\n        _loadingCmpRef = loadingFactory.create(this.injecotr);\r\n\r\n        if (config) {\r\n            this.config = Object.assign({}, this.config, config);\r\n        }\r\n        const languageCode = localStorage.getItem('languageCode');\r\n        // if (languageCode === 'en') {\r\n        //     this.config.message = 'Loading...';\r\n        // }\r\n        if (this.localeSer) {\r\n            if (!this.config.message || this.config.message === 'æ­£å¨å è½½ä¸­ï¼è¯·ç¨å...') {\r\n                this.config.message = this.localeSer.getValue('loading.message');\r\n            }\r\n        }\r\n\r\n        const container = this.config.container;\r\n        if (container === 'body') {\r\n            document.querySelector(container as string).appendChild( _loadingCmpRef.location.nativeElement);\r\n        } else {\r\n            if (container instanceof ElementRef ) {\r\n                container.nativeElement.appendChild(\r\n                    _loadingCmpRef.location.nativeElement\r\n                );\r\n            } else {\r\n                if (container instanceof Element) {\r\n                    container.appendChild(\r\n                        _loadingCmpRef.location.nativeElement\r\n                    );\r\n                }\r\n            }\r\n        }\r\n        _loadingCmpRef.instance.delay = this.config.delay;\r\n        _loadingCmpRef.instance.isActive = true;\r\n        Object.assign(_loadingCmpRef.instance, this.config);\r\n\r\n        _loadingCmpRef.instance.closed.subscribe(state => {\r\n            if (!state) {\r\n                delete this.loadingInstances[_loadingCmpRef.instance.id];\r\n                this.currentLoadingInstanceID = this.getMaxLoadingID();\r\n                this.clearDom(_loadingCmpRef);\r\n            }\r\n        });\r\n\r\n        _loadingCmpRef.changeDetectorRef.markForCheck();\r\n        _loadingCmpRef.changeDetectorRef.detectChanges();\r\n\r\n        const loadingID = this.createInsId();\r\n        _loadingCmpRef.instance.id = loadingID;\r\n        this.loadingInstances[loadingID] =  _loadingCmpRef;\r\n        this.currentLoadingInstanceID = loadingID;\r\n\r\n        return _loadingCmpRef.instance;\r\n    }\r\n\r\n    close(loadingId?: number) {\r\n        const id = loadingId || this.currentLoadingInstanceID;\r\n        const loadingRef = this.loadingInstances[id];\r\n        if (loadingRef) {\r\n            loadingRef.instance.close();\r\n        }\r\n    }\r\n\r\n    clearAll() {\r\n        const keys = Object.keys(this.loadingInstances);\r\n        if (keys.length) {\r\n            keys.forEach(id => {\r\n                this.clearDom(this.loadingInstances[id]);\r\n            });\r\n        } else {\r\n            const loadings = document.querySelectorAll('farris-loading');\r\n            if (loadings.length) {\r\n                loadings.forEach( el => el.remove() );\r\n            }\r\n\r\n            this.loadingInstances = {};\r\n        }\r\n    }\r\n\r\n    private clearDom(_loadingCmpRef: ComponentRef<LoadingComponent>) {\r\n        if (_loadingCmpRef && _loadingCmpRef.location) {\r\n            const loadingEl = _loadingCmpRef.location.nativeElement;\r\n\r\n            if (loadingEl.parentNode) {\r\n                loadingEl.parentNode.removeChild(loadingEl);\r\n            }\r\n\r\n            _loadingCmpRef.destroy();\r\n        }\r\n\r\n        _loadingCmpRef = null;\r\n    }\r\n\r\n    private createInsId() {\r\n        return this.getMaxLoadingID() + 1;\r\n    }\r\n\r\n    private getMaxLoadingID() {\r\n        const ids = Object.keys(this.loadingInstances).map(k => parseInt(k, 10));\r\n        if (ids.length) {\r\n            return max(ids);\r\n        }\r\n\r\n        return 0;\r\n    }\r\n}\r\n\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { LoadingComponent } from './loading.component';\r\nimport { LoadingService } from './loading.service';\r\nimport { LoadingConfig, LOADING_DEFAULT_CONFIG, loaddingDefaultConfig } from './loading.config';\r\nimport { FarrisCommonModule } from '@farris/ui-common';\r\nimport { LocaleModule } from '@farris/ui-locale';\r\n\r\n\r\n@NgModule({\r\n    imports: [\r\n        CommonModule,\r\n        FarrisCommonModule,\r\n        LocaleModule\r\n    ],\r\n    declarations: [\r\n        LoadingComponent\r\n    ],\r\n    entryComponents: [\r\n        LoadingComponent\r\n    ]\r\n})\r\nexport class LoadingModule {\r\n    static forRoot(config?: LoadingConfig): ModuleWithProviders {\r\n        return {\r\n            ngModule: LoadingModule,\r\n            providers: [\r\n                { provide: LOADING_DEFAULT_CONFIG, useValue: config || loaddingDefaultConfig},\r\n                LoadingService\r\n            ]\r\n        };\r\n    }\r\n}\r\n"]}