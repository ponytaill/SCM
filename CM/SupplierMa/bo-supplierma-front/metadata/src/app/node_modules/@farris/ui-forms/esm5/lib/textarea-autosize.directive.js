/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Directive, Input, Injector, ElementRef, HostListener } from '@angular/core';
import { NgControl } from '@angular/forms';
var TextareaAutoSizeDirective = /** @class */ (function () {
    function TextareaAutoSizeDirective(el, ngControl, injector) {
        this.el = el;
        this.ngControl = ngControl;
        this.injector = injector;
        this.enable = true;
        this.previousValue = null;
        this.isUserResized = false;
        this.textarea = this.el.nativeElement;
    }
    /**
     * @return {?}
     */
    TextareaAutoSizeDirective.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.init();
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    TextareaAutoSizeDirective.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        if (changes.enable && !changes.enable.isFirstChange()) {
            this.sizeToFit();
        }
    };
    /**
     * @return {?}
     */
    TextareaAutoSizeDirective.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        this.minHeight = this.textarea.getBoundingClientRect().height;
    };
    /**
     * @private
     * @return {?}
     */
    TextareaAutoSizeDirective.prototype.init = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.enable) {
            this.document = this.textarea.ownerDocument;
            this.documentElement = this.document.documentElement;
            if (this.textarea) {
                if (this.textarea.value) {
                    this.sizeToFit();
                }
            }
            if (this.ngControl) {
                this.ngControl.valueChanges.subscribe((/**
                 * @param {?} v
                 * @return {?}
                 */
                function (v) {
                    if (v !== _this.previousValue) {
                        _this.sizeToFit();
                    }
                }));
            }
        }
    };
    /**
     * @return {?}
     */
    TextareaAutoSizeDirective.prototype.onInput = /**
     * @return {?}
     */
    function () {
        this.sizeToFit();
    };
    /**
     * @return {?}
     */
    TextareaAutoSizeDirective.prototype.onValueChange = /**
     * @return {?}
     */
    function () {
        this.sizeToFit();
    };
    /**
     * @private
     * @return {?}
     */
    TextareaAutoSizeDirective.prototype.overflowOffset = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var offsetTop = 0;
        /** @type {?} */
        var el = this.textarea;
        while (el !== document.body && el !== null) {
            offsetTop += el.offsetTop || 0;
            el = el.offsetParent;
        }
        /** @type {?} */
        var top = offsetTop - document.defaultView.pageYOffset;
        /** @type {?} */
        var bottom = this.documentElement.clientHeight - (top + this.textarea.offsetHeight);
        return { top: top, bottom: bottom };
    };
    /**
     * @private
     * @return {?}
     */
    TextareaAutoSizeDirective.prototype.sizeToFit = /**
     * @private
     * @return {?}
     */
    function () {
        if (!this.enable) {
            return;
        }
        /** @type {?} */
        var textarea = this.textarea;
        /** @type {?} */
        var viewportMarginBottom = 100;
        if (this.isUserResized) {
            return;
        }
        if (this.textarea.value === this.previousValue) {
            return;
        }
        if (this.textarea.offsetWidth <= 0 && this.textarea.offsetHeight <= 0) {
            return;
        }
        // const { top, bottom } = this.overflowOffset();
        // if (top < 0 || bottom < 0) {
        //     return;
        // }
        /** @type {?} */
        var textareaStyle = getComputedStyle(textarea);
        /** @type {?} */
        var topBorderWidth = Number(textareaStyle.borderTopWidth.replace(/px/, ''));
        /** @type {?} */
        var bottomBorderWidth = Number(textareaStyle.borderBottomWidth.replace(/px/, ''));
        /** @type {?} */
        var isBorderBox = textareaStyle.boxSizing === 'border-box';
        /** @type {?} */
        var borderAddOn = isBorderBox ? topBorderWidth + bottomBorderWidth : 0;
        // const maxHeight = Number(textareaStyle.height.replace(/px/, '')) + bottom;
        // const adjustedViewportMarginBottom = bottom < viewportMarginBottom ? bottom : viewportMarginBottom;
        // textarea.style.maxHeight = `${maxHeight - adjustedViewportMarginBottom}px`;
        if (this.maxHeight) {
            textarea.style.maxHeight = this.maxHeight + "px";
        }
        /** @type {?} */
        var container = textarea.parentElement;
        if (container instanceof HTMLElement) {
            /** @type {?} */
            var containerHeight = container.style.height;
            container.style.height = getComputedStyle(container).height;
            textarea.style.height = 'auto';
            /** @type {?} */
            var h = textarea.scrollHeight + borderAddOn;
            if (this.minHeight > h) {
                h = this.minHeight;
            }
            textarea.style.height = h + "px";
            container.style.height = containerHeight;
        }
        this.previousValue = textarea.value;
    };
    TextareaAutoSizeDirective.decorators = [
        { type: Directive, args: [{
                    selector: '[auto-size]',
                },] }
    ];
    /** @nocollapse */
    TextareaAutoSizeDirective.ctorParameters = function () { return [
        { type: ElementRef },
        { type: NgControl },
        { type: Injector }
    ]; };
    TextareaAutoSizeDirective.propDecorators = {
        enable: [{ type: Input, args: ['auto-size',] }],
        maxHeight: [{ type: Input }],
        onInput: [{ type: HostListener, args: ['input',] }],
        onValueChange: [{ type: HostListener, args: ['change',] }]
    };
    return TextareaAutoSizeDirective;
}());
export { TextareaAutoSizeDirective };
if (false) {
    /** @type {?} */
    TextareaAutoSizeDirective.prototype.enable;
    /** @type {?} */
    TextareaAutoSizeDirective.prototype.maxHeight;
    /**
     * @type {?}
     * @private
     */
    TextareaAutoSizeDirective.prototype.previousValue;
    /**
     * @type {?}
     * @private
     */
    TextareaAutoSizeDirective.prototype.isUserResized;
    /**
     * @type {?}
     * @private
     */
    TextareaAutoSizeDirective.prototype.textarea;
    /**
     * @type {?}
     * @private
     */
    TextareaAutoSizeDirective.prototype.document;
    /**
     * @type {?}
     * @private
     */
    TextareaAutoSizeDirective.prototype.documentElement;
    /**
     * @type {?}
     * @private
     */
    TextareaAutoSizeDirective.prototype.minHeight;
    /**
     * @type {?}
     * @private
     */
    TextareaAutoSizeDirective.prototype.el;
    /**
     * @type {?}
     * @private
     */
    TextareaAutoSizeDirective.prototype.ngControl;
    /**
     * @type {?}
     * @private
     */
    TextareaAutoSizeDirective.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGV4dGFyZWEtYXV0b3NpemUuZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1mb3Jtcy8iLCJzb3VyY2VzIjpbImxpYi90ZXh0YXJlYS1hdXRvc2l6ZS5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBVSxVQUFVLEVBQUUsWUFBWSxFQUEyQyxNQUFNLGVBQWUsQ0FBQztBQUN0SSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFM0M7SUFlSSxtQ0FBb0IsRUFBYyxFQUFVLFNBQW9CLEVBQVUsUUFBa0I7UUFBeEUsT0FBRSxHQUFGLEVBQUUsQ0FBWTtRQUFVLGNBQVMsR0FBVCxTQUFTLENBQVc7UUFBVSxhQUFRLEdBQVIsUUFBUSxDQUFVO1FBWHhFLFdBQU0sR0FBRyxJQUFJLENBQUM7UUFHMUIsa0JBQWEsR0FBRyxJQUFJLENBQUM7UUFDckIsa0JBQWEsR0FBRyxLQUFLLENBQUM7UUFRMUIsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLGFBQWEsQ0FBQztJQUMxQyxDQUFDOzs7O0lBRUQsNENBQVE7OztJQUFSO1FBQ0ksSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ2hCLENBQUM7Ozs7O0lBRUQsK0NBQVc7Ozs7SUFBWCxVQUFZLE9BQXNCO1FBQzlCLElBQUksT0FBTyxDQUFDLE1BQU0sSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsYUFBYSxFQUFFLEVBQUU7WUFDbkQsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO1NBQ3BCO0lBQ0wsQ0FBQzs7OztJQUVELG1EQUFlOzs7SUFBZjtRQUNJLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxxQkFBcUIsRUFBRSxDQUFDLE1BQU0sQ0FBQztJQUNsRSxDQUFDOzs7OztJQUVPLHdDQUFJOzs7O0lBQVo7UUFBQSxpQkFrQkM7UUFqQkcsSUFBSSxJQUFJLENBQUMsTUFBTSxFQUFFO1lBQ2IsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLGFBQWEsQ0FBQztZQUM1QyxJQUFJLENBQUMsZUFBZSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsZUFBZSxDQUFDO1lBQ3JELElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRTtnQkFDZixJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUFFO29CQUNyQixJQUFJLENBQUMsU0FBUyxFQUFFLENBQUM7aUJBQ3BCO2FBQ0o7WUFFRCxJQUFJLElBQUksQ0FBQyxTQUFTLEVBQUU7Z0JBQ2hCLElBQUksQ0FBQyxTQUFTLENBQUMsWUFBWSxDQUFDLFNBQVM7Ozs7Z0JBQUMsVUFBQSxDQUFDO29CQUNuQyxJQUFJLENBQUMsS0FBSyxLQUFJLENBQUMsYUFBYSxFQUFFO3dCQUMxQixLQUFJLENBQUMsU0FBUyxFQUFFLENBQUM7cUJBQ3BCO2dCQUNMLENBQUMsRUFBQyxDQUFDO2FBQ047U0FDSjtJQUNMLENBQUM7Ozs7SUFHRCwyQ0FBTzs7O0lBRFA7UUFFSSxJQUFJLENBQUMsU0FBUyxFQUFFLENBQUM7SUFDckIsQ0FBQzs7OztJQUdELGlEQUFhOzs7SUFEYjtRQUVJLElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQztJQUNyQixDQUFDOzs7OztJQUdPLGtEQUFjOzs7O0lBQXRCOztZQUNRLFNBQVMsR0FBRyxDQUFDOztZQUNiLEVBQUUsR0FBRyxJQUFJLENBQUMsUUFBUTtRQUV0QixPQUFPLEVBQUUsS0FBSyxRQUFRLENBQUMsSUFBSSxJQUFJLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDeEMsU0FBUyxJQUFJLEVBQUUsQ0FBQyxTQUFTLElBQUksQ0FBQyxDQUFDO1lBQy9CLEVBQUUsR0FBRyxFQUFFLENBQUMsWUFBWSxDQUFDO1NBQ3hCOztZQUVLLEdBQUcsR0FBRyxTQUFTLEdBQUcsUUFBUSxDQUFDLFdBQVcsQ0FBQyxXQUFXOztZQUNsRCxNQUFNLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxZQUFZLEdBQUcsQ0FBQyxHQUFHLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxZQUFZLENBQUM7UUFDckYsT0FBTyxFQUFFLEdBQUcsS0FBQSxFQUFFLE1BQU0sUUFBQSxFQUFFLENBQUM7SUFDM0IsQ0FBQzs7Ozs7SUFFTyw2Q0FBUzs7OztJQUFqQjtRQUNJLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFO1lBQ2QsT0FBTztTQUNWOztZQUVLLFFBQVEsR0FBRyxJQUFJLENBQUMsUUFBUTs7WUFDeEIsb0JBQW9CLEdBQUcsR0FBRztRQUNoQyxJQUFJLElBQUksQ0FBQyxhQUFhLEVBQUU7WUFBRSxPQUFPO1NBQUU7UUFDbkMsSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssS0FBSyxJQUFJLENBQUMsYUFBYSxFQUFFO1lBQUUsT0FBTztTQUFFO1FBQzNELElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxXQUFXLElBQUksQ0FBQyxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsWUFBWSxJQUFJLENBQUMsRUFBRTtZQUFFLE9BQU87U0FBRTs7Ozs7O1lBTzVFLGFBQWEsR0FBRyxnQkFBZ0IsQ0FBQyxRQUFRLENBQUM7O1lBRTFDLGNBQWMsR0FBRyxNQUFNLENBQUMsYUFBYSxDQUFDLGNBQWMsQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxDQUFDOztZQUN2RSxpQkFBaUIsR0FBRyxNQUFNLENBQUMsYUFBYSxDQUFDLGlCQUFpQixDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLENBQUM7O1lBRTdFLFdBQVcsR0FBRyxhQUFhLENBQUMsU0FBUyxLQUFLLFlBQVk7O1lBQ3RELFdBQVcsR0FBRyxXQUFXLENBQUMsQ0FBQyxDQUFDLGNBQWMsR0FBRyxpQkFBaUIsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUV4RSw2RUFBNkU7UUFDN0Usc0dBQXNHO1FBQ3RHLDhFQUE4RTtRQUU5RSxJQUFJLElBQUksQ0FBQyxTQUFTLEVBQUU7WUFDaEIsUUFBUSxDQUFDLEtBQUssQ0FBQyxTQUFTLEdBQU0sSUFBSSxDQUFDLFNBQVMsT0FBSSxDQUFDO1NBQ3BEOztZQUVLLFNBQVMsR0FBRyxRQUFRLENBQUMsYUFBYTtRQUN4QyxJQUFJLFNBQVMsWUFBWSxXQUFXLEVBQUU7O2dCQUM1QixlQUFlLEdBQUcsU0FBUyxDQUFDLEtBQUssQ0FBQyxNQUFNO1lBQzlDLFNBQVMsQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLGdCQUFnQixDQUFDLFNBQVMsQ0FBQyxDQUFDLE1BQU0sQ0FBQztZQUM1RCxRQUFRLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7O2dCQUUzQixDQUFDLEdBQUcsUUFBUSxDQUFDLFlBQVksR0FBRyxXQUFXO1lBQzNDLElBQUksSUFBSSxDQUFDLFNBQVMsR0FBRyxDQUFDLEVBQUU7Z0JBQ3BCLENBQUMsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDO2FBQ3RCO1lBQ0QsUUFBUSxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQU0sQ0FBQyxPQUFJLENBQUM7WUFDakMsU0FBUyxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsZUFBZSxDQUFDO1NBQzVDO1FBRUQsSUFBSSxDQUFDLGFBQWEsR0FBRyxRQUFRLENBQUMsS0FBSyxDQUFDO0lBQ3hDLENBQUM7O2dCQTdISixTQUFTLFNBQUM7b0JBQ1AsUUFBUSxFQUFFLGFBQWE7aUJBQzFCOzs7O2dCQUw0QyxVQUFVO2dCQUM5QyxTQUFTO2dCQURTLFFBQVE7Ozt5QkFPOUIsS0FBSyxTQUFDLFdBQVc7NEJBQ2pCLEtBQUs7MEJBZ0RMLFlBQVksU0FBQyxPQUFPO2dDQUtwQixZQUFZLFNBQUMsUUFBUTs7SUFvRTFCLGdDQUFDO0NBQUEsQUE5SEQsSUE4SEM7U0EzSFkseUJBQXlCOzs7SUFDbEMsMkNBQWtDOztJQUNsQyw4Q0FBMkI7Ozs7O0lBRTNCLGtEQUE2Qjs7Ozs7SUFDN0Isa0RBQThCOzs7OztJQUU5Qiw2Q0FBaUI7Ozs7O0lBQ2pCLDZDQUFpQjs7Ozs7SUFDakIsb0RBQXdCOzs7OztJQUN4Qiw4Q0FBa0I7Ozs7O0lBRU4sdUNBQXNCOzs7OztJQUFFLDhDQUE0Qjs7Ozs7SUFBRSw2Q0FBMEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEaXJlY3RpdmUsIElucHV0LCBJbmplY3RvciwgT25Jbml0LCBFbGVtZW50UmVmLCBIb3N0TGlzdGVuZXIsIEFmdGVyVmlld0luaXQsIE9uQ2hhbmdlcywgU2ltcGxlQ2hhbmdlcyB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBOZ0NvbnRyb2wgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XHJcblxyXG5ARGlyZWN0aXZlKHtcclxuICAgIHNlbGVjdG9yOiAnW2F1dG8tc2l6ZV0nLFxyXG59KVxyXG5leHBvcnQgY2xhc3MgVGV4dGFyZWFBdXRvU2l6ZURpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCwgT25DaGFuZ2Vze1xyXG4gICAgQElucHV0KCdhdXRvLXNpemUnKSBlbmFibGUgPSB0cnVlO1xyXG4gICAgQElucHV0KCkgbWF4SGVpZ2h0OiBudW1iZXI7XHJcblxyXG4gICAgcHJpdmF0ZSBwcmV2aW91c1ZhbHVlID0gbnVsbDtcclxuICAgIHByaXZhdGUgaXNVc2VyUmVzaXplZCA9IGZhbHNlO1xyXG5cclxuICAgIHByaXZhdGUgdGV4dGFyZWE7XHJcbiAgICBwcml2YXRlIGRvY3VtZW50O1xyXG4gICAgcHJpdmF0ZSBkb2N1bWVudEVsZW1lbnQ7XHJcbiAgICBwcml2YXRlIG1pbkhlaWdodDtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGVsOiBFbGVtZW50UmVmLCBwcml2YXRlIG5nQ29udHJvbDogTmdDb250cm9sLCBwcml2YXRlIGluamVjdG9yOiBJbmplY3Rvcikge1xyXG4gICAgICAgIHRoaXMudGV4dGFyZWEgPSB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQ7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKSB7XHJcbiAgICAgICAgdGhpcy5pbml0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xyXG4gICAgICAgIGlmIChjaGFuZ2VzLmVuYWJsZSAmJiAhY2hhbmdlcy5lbmFibGUuaXNGaXJzdENoYW5nZSgpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2l6ZVRvRml0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcclxuICAgICAgICB0aGlzLm1pbkhlaWdodCA9IHRoaXMudGV4dGFyZWEuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkuaGVpZ2h0O1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgaW5pdCgpIHtcclxuICAgICAgICBpZiAodGhpcy5lbmFibGUpIHtcclxuICAgICAgICAgICAgdGhpcy5kb2N1bWVudCA9IHRoaXMudGV4dGFyZWEub3duZXJEb2N1bWVudDtcclxuICAgICAgICAgICAgdGhpcy5kb2N1bWVudEVsZW1lbnQgPSB0aGlzLmRvY3VtZW50LmRvY3VtZW50RWxlbWVudDtcclxuICAgICAgICAgICAgaWYgKHRoaXMudGV4dGFyZWEpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnRleHRhcmVhLnZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaXplVG9GaXQoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMubmdDb250cm9sKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm5nQ29udHJvbC52YWx1ZUNoYW5nZXMuc3Vic2NyaWJlKHYgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh2ICE9PSB0aGlzLnByZXZpb3VzVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaXplVG9GaXQoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBASG9zdExpc3RlbmVyKCdpbnB1dCcpXHJcbiAgICBvbklucHV0KCkge1xyXG4gICAgICAgIHRoaXMuc2l6ZVRvRml0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgQEhvc3RMaXN0ZW5lcignY2hhbmdlJylcclxuICAgIG9uVmFsdWVDaGFuZ2UoKSB7XHJcbiAgICAgICAgdGhpcy5zaXplVG9GaXQoKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgcHJpdmF0ZSBvdmVyZmxvd09mZnNldCgpIHtcclxuICAgICAgICBsZXQgb2Zmc2V0VG9wID0gMDtcclxuICAgICAgICBsZXQgZWwgPSB0aGlzLnRleHRhcmVhO1xyXG5cclxuICAgICAgICB3aGlsZSAoZWwgIT09IGRvY3VtZW50LmJvZHkgJiYgZWwgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgb2Zmc2V0VG9wICs9IGVsLm9mZnNldFRvcCB8fCAwO1xyXG4gICAgICAgICAgICBlbCA9IGVsLm9mZnNldFBhcmVudDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHRvcCA9IG9mZnNldFRvcCAtIGRvY3VtZW50LmRlZmF1bHRWaWV3LnBhZ2VZT2Zmc2V0O1xyXG4gICAgICAgIGNvbnN0IGJvdHRvbSA9IHRoaXMuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCAtICh0b3AgKyB0aGlzLnRleHRhcmVhLm9mZnNldEhlaWdodCk7XHJcbiAgICAgICAgcmV0dXJuIHsgdG9wLCBib3R0b20gfTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNpemVUb0ZpdCgpIHtcclxuICAgICAgICBpZiAoIXRoaXMuZW5hYmxlKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHRleHRhcmVhID0gdGhpcy50ZXh0YXJlYTtcclxuICAgICAgICBjb25zdCB2aWV3cG9ydE1hcmdpbkJvdHRvbSA9IDEwMDtcclxuICAgICAgICBpZiAodGhpcy5pc1VzZXJSZXNpemVkKSB7IHJldHVybjsgfVxyXG4gICAgICAgIGlmICh0aGlzLnRleHRhcmVhLnZhbHVlID09PSB0aGlzLnByZXZpb3VzVmFsdWUpIHsgcmV0dXJuOyB9XHJcbiAgICAgICAgaWYgKHRoaXMudGV4dGFyZWEub2Zmc2V0V2lkdGggPD0gMCAmJiB0aGlzLnRleHRhcmVhLm9mZnNldEhlaWdodCA8PSAwKSB7IHJldHVybjsgfVxyXG5cclxuICAgICAgICAvLyBjb25zdCB7IHRvcCwgYm90dG9tIH0gPSB0aGlzLm92ZXJmbG93T2Zmc2V0KCk7XHJcbiAgICAgICAgLy8gaWYgKHRvcCA8IDAgfHwgYm90dG9tIDwgMCkge1xyXG4gICAgICAgIC8vICAgICByZXR1cm47XHJcbiAgICAgICAgLy8gfVxyXG5cclxuICAgICAgICBjb25zdCB0ZXh0YXJlYVN0eWxlID0gZ2V0Q29tcHV0ZWRTdHlsZSh0ZXh0YXJlYSk7XHJcblxyXG4gICAgICAgIGNvbnN0IHRvcEJvcmRlcldpZHRoID0gTnVtYmVyKHRleHRhcmVhU3R5bGUuYm9yZGVyVG9wV2lkdGgucmVwbGFjZSgvcHgvLCAnJykpO1xyXG4gICAgICAgIGNvbnN0IGJvdHRvbUJvcmRlcldpZHRoID0gTnVtYmVyKHRleHRhcmVhU3R5bGUuYm9yZGVyQm90dG9tV2lkdGgucmVwbGFjZSgvcHgvLCAnJykpO1xyXG5cclxuICAgICAgICBjb25zdCBpc0JvcmRlckJveCA9IHRleHRhcmVhU3R5bGUuYm94U2l6aW5nID09PSAnYm9yZGVyLWJveCc7XHJcbiAgICAgICAgY29uc3QgYm9yZGVyQWRkT24gPSBpc0JvcmRlckJveCA/IHRvcEJvcmRlcldpZHRoICsgYm90dG9tQm9yZGVyV2lkdGggOiAwO1xyXG5cclxuICAgICAgICAvLyBjb25zdCBtYXhIZWlnaHQgPSBOdW1iZXIodGV4dGFyZWFTdHlsZS5oZWlnaHQucmVwbGFjZSgvcHgvLCAnJykpICsgYm90dG9tO1xyXG4gICAgICAgIC8vIGNvbnN0IGFkanVzdGVkVmlld3BvcnRNYXJnaW5Cb3R0b20gPSBib3R0b20gPCB2aWV3cG9ydE1hcmdpbkJvdHRvbSA/IGJvdHRvbSA6IHZpZXdwb3J0TWFyZ2luQm90dG9tO1xyXG4gICAgICAgIC8vIHRleHRhcmVhLnN0eWxlLm1heEhlaWdodCA9IGAke21heEhlaWdodCAtIGFkanVzdGVkVmlld3BvcnRNYXJnaW5Cb3R0b219cHhgO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5tYXhIZWlnaHQpIHtcclxuICAgICAgICAgICAgdGV4dGFyZWEuc3R5bGUubWF4SGVpZ2h0ID0gYCR7dGhpcy5tYXhIZWlnaHR9cHhgO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgY29udGFpbmVyID0gdGV4dGFyZWEucGFyZW50RWxlbWVudDtcclxuICAgICAgICBpZiAoY29udGFpbmVyIGluc3RhbmNlb2YgSFRNTEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgY29uc3QgY29udGFpbmVySGVpZ2h0ID0gY29udGFpbmVyLnN0eWxlLmhlaWdodDtcclxuICAgICAgICAgICAgY29udGFpbmVyLnN0eWxlLmhlaWdodCA9IGdldENvbXB1dGVkU3R5bGUoY29udGFpbmVyKS5oZWlnaHQ7XHJcbiAgICAgICAgICAgIHRleHRhcmVhLnN0eWxlLmhlaWdodCA9ICdhdXRvJztcclxuXHJcbiAgICAgICAgICAgIGxldCBoID0gdGV4dGFyZWEuc2Nyb2xsSGVpZ2h0ICsgYm9yZGVyQWRkT247XHJcbiAgICAgICAgICAgIGlmICh0aGlzLm1pbkhlaWdodCA+IGgpIHtcclxuICAgICAgICAgICAgICAgIGggPSB0aGlzLm1pbkhlaWdodDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0ZXh0YXJlYS5zdHlsZS5oZWlnaHQgPSBgJHtofXB4YDtcclxuICAgICAgICAgICAgY29udGFpbmVyLnN0eWxlLmhlaWdodCA9IGNvbnRhaW5lckhlaWdodDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMucHJldmlvdXNWYWx1ZSA9IHRleHRhcmVhLnZhbHVlO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==