import { Injector, Optional, Pipe } from '@angular/core';
import { DownloadService } from '@gsp-svc/formdoc-upload';
class ImageIdToUrlPipe {
    constructor(injector) {
        this.injector = injector;
        this.defaultPic = '/platform/common/web/assets/imgs/no-pic.png';
        this.downloadService = this.injector && this.injector.get(DownloadService, null) || null;
    }
    transform(value, rootId = 'default-root') {
        if (!value) {
            return this.defaultPic;
        }
        //const rootId = 'default-root';
        if (this.downloadService) {
            return this.downloadService.getDownloadUrl(value, rootId);
        }
        else {
            console.warn('因安全问题，附件下载提供安全校验机制，附件下载功能需重新编译。');
            return `/api/runtime/dfs/v1.0/formdoc/download/${value}`;
        }
    }
}
ImageIdToUrlPipe.decorators = [
    { type: Pipe, args: [{ name: 'imageIdToUrl' },] }
];
/** @nocollapse */
ImageIdToUrlPipe.ctorParameters = () => [
    { type: Injector, decorators: [{ type: Optional }] }
];
export { ImageIdToUrlPipe };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW1hZ2UtaWQtdG8tdXJsLnBpcGUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2tlbmRvLWJpbmRpbmcvIiwic291cmNlcyI6WyJsaWIvcGlwZXMvaW1hZ2UtaWQtdG8tdXJsLnBpcGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFpQixNQUFNLGVBQWUsQ0FBQztBQUN4RSxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFDMUQsTUFDTSxnQkFBZ0I7SUFHcEIsWUFBZ0MsUUFBa0I7UUFBbEIsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUYxQyxlQUFVLEdBQUcsNkNBQTZDLENBQUM7UUFHakUsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUMsUUFBUSxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFrQixlQUFlLEVBQUUsSUFBSSxDQUFDLElBQUksSUFBSSxDQUFDO0lBQzVHLENBQUM7SUFFRCxTQUFTLENBQUMsS0FBYSxFQUFFLFNBQWlCLGNBQWM7UUFDdEQsSUFBSSxDQUFDLEtBQUssRUFBRTtZQUNWLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQztTQUN4QjtRQUNELGdDQUFnQztRQUNoQyxJQUFJLElBQUksQ0FBQyxlQUFlLEVBQUU7WUFDeEIsT0FBTyxJQUFJLENBQUMsZUFBZSxDQUFDLGNBQWMsQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUM7U0FDM0Q7YUFBTTtZQUNMLE9BQU8sQ0FBQyxJQUFJLENBQUMsaUNBQWlDLENBQUMsQ0FBQztZQUNoRCxPQUFPLDBDQUEwQyxLQUFLLEVBQUUsQ0FBQztTQUMxRDtJQUNILENBQUM7OztZQW5CRixJQUFJLFNBQUMsRUFBRSxJQUFJLEVBQUUsY0FBYyxFQUFFOzs7O1lBRnJCLFFBQVEsdUJBTUYsUUFBUTs7QUFrQnZCLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0b3IsIE9wdGlvbmFsLCBQaXBlLCBQaXBlVHJhbnNmb3JtIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IERvd25sb2FkU2VydmljZSB9IGZyb20gJ0Bnc3Atc3ZjL2Zvcm1kb2MtdXBsb2FkJztcclxuQFBpcGUoeyBuYW1lOiAnaW1hZ2VJZFRvVXJsJyB9KVxyXG5jbGFzcyBJbWFnZUlkVG9VcmxQaXBlIGltcGxlbWVudHMgUGlwZVRyYW5zZm9ybSB7XHJcbiAgcHJpdmF0ZSBkZWZhdWx0UGljID0gJy9wbGF0Zm9ybS9jb21tb24vd2ViL2Fzc2V0cy9pbWdzL25vLXBpYy5wbmcnO1xyXG4gIHByaXZhdGUgZG93bmxvYWRTZXJ2aWNlOiBEb3dubG9hZFNlcnZpY2U7XHJcbiAgY29uc3RydWN0b3IoQE9wdGlvbmFsKCkgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IpIHtcclxuICAgIHRoaXMuZG93bmxvYWRTZXJ2aWNlID0gdGhpcy5pbmplY3RvciAmJiB0aGlzLmluamVjdG9yLmdldDxEb3dubG9hZFNlcnZpY2U+KERvd25sb2FkU2VydmljZSwgbnVsbCkgfHwgbnVsbDtcclxuICB9XHJcblxyXG4gIHRyYW5zZm9ybSh2YWx1ZTogc3RyaW5nLCByb290SWQ6IHN0cmluZyA9ICdkZWZhdWx0LXJvb3QnKTogc3RyaW5nIHtcclxuICAgIGlmICghdmFsdWUpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuZGVmYXVsdFBpYztcclxuICAgIH1cclxuICAgIC8vY29uc3Qgcm9vdElkID0gJ2RlZmF1bHQtcm9vdCc7XHJcbiAgICBpZiAodGhpcy5kb3dubG9hZFNlcnZpY2UpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuZG93bmxvYWRTZXJ2aWNlLmdldERvd25sb2FkVXJsKHZhbHVlLCByb290SWQpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY29uc29sZS53YXJuKCflm6Dlronlhajpl67popjvvIzpmYTku7bkuIvovb3mj5DkvpvlronlhajmoKHpqozmnLrliLbvvIzpmYTku7bkuIvovb3lip/og73pnIDph43mlrDnvJbor5HjgIInKTtcclxuICAgICAgcmV0dXJuIGAvYXBpL3J1bnRpbWUvZGZzL3YxLjAvZm9ybWRvYy9kb3dubG9hZC8ke3ZhbHVlfWA7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgeyBJbWFnZUlkVG9VcmxQaXBlIH07XHJcbiJdfQ==