import { Subject } from 'rxjs';
import { FieldMetadataUtil } from './metadata/index';
;
import { ModifyType, ChangeSet } from '../changeset/index';
import { PARENT_PATH, PARENT_CLASS } from './types';
import { EntityList } from './entity_list';
import { EntityFactory } from './entity_factory';
/**
 * @author Lucas Huang
 * 实体抽象基类，所有实体必须扩展自Entity
 *
 * ### 使用示例
 * ```
 * export class UserEntity extends Entity {
 *    userId: string;
 *    userName: string;
 *
 *    constructor(data: any){
 *        super(data);
 *    }
 * }
 * ```
 */
var Entity = /** @class */ (function () {
    // #endregion
    /**
     * @param data JSON数据
     */
    function Entity(data) {
        // #region 私有、保护属性
        /**
         * 验证错误集合
         */
        this.validErrors = {};
        /**
         * 增量变更集合
         */
        this.changeSet = new ChangeSet();
        /**
         * 是否正在验证
         */
        this.isValidating = false;
        /**
         * 新数据
         */
        this.newData = undefined;
        // #endregion
        // #region 公有属性
        /**
         * 变更流
         */
        this.valueChanged = new Subject();
        /**
         * 属性值改变时触发
         *
         * ### 使用示例
         * ```
         *  const entity = new UserEntity(data);
         *  entity.onValueChanged.subscribe((data: Modification) => {
         *      console.log(data);
         *  })
         *
         * ```
         *
         * @event
         */
        this.onValueChanged = this.valueChanged.asObservable();
        this.newData = Object.assign({}, data);
        this.onValueChanged = this.valueChanged;
        this.initialize();
    }
    Object.defineProperty(Entity.prototype, "data", {
        /**
         * 返回JSON格式的数据
         */
        get: function () {
            return this.newData;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Entity.prototype, "errors", {
        /**
         * 验证错误集合
         */
        get: function () {
            return this.validErrors;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Entity.prototype, "changes", {
        /**
         * 实体变更集
         */
        get: function () {
            return this.changeSet.changes;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Entity.prototype, "primaryProperty", {
        /**
         * 实体主键元数据
         */
        get: function () {
            return FieldMetadataUtil.getPrimaryFieldMetadata(this.constructor);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Entity.prototype, "primaryKey", {
        /**
         * 主键
         * @todo
         * 1、没有主键时返回''不合理，应该返回undefined
         */
        get: function () {
            if (this.primaryProperty) {
                return this.primaryProperty.property;
            }
            else {
                return '';
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Entity.prototype, "primaryValue", {
        /**
         * 实体主键值
         * 1、没有主键时返回''不合理，应该返回undefined
         */
        get: function () {
            if (this.primaryKey) {
                // return this[this.primaryProperty.property].toString();
                var primaryValue = this[this.primaryProperty.property];
                return primaryValue ? primaryValue : '';
            }
            else {
                return '';
            }
        },
        enumerable: true,
        configurable: true
    });
    // #region 公有方法
    /**
     * 将变更记录保存至变更集中
     * @param value 变更记录
     */
    Entity.prototype.setChanges = function (value) {
        var propertyName = value.path[value.path.length - 1];
        // @todo：事件会从下级向上冒泡，change可能是下级的，不能和当前Entity的newData合并。
        // this.newData = Object.assign(this.newData, { [propertyName]: value.value });
        this.valueChanged.next(value);
        this.changeSet.append(value);
    };
    Entity.prototype.getPaths = function () {
        var pathObj = {
            path: [],
            isUdt: false,
            isGrid: false
        };
        var handleParent = function (item) {
            var parentPaths = item[PARENT_PATH];
            if (parentPaths) {
                var prop = parentPaths[parentPaths.length - 1];
                // 父级所在实体包含的ngObject，存在当前实体字段，则判断为UDt字段
                if (Object.keys(FieldMetadataUtil.getNgObjects(item[PARENT_CLASS].constructor)).indexOf(prop) > -1) {
                    pathObj.isUdt = true;
                }
                // 存在类型为ngList，则判断为grid
                if (item[PARENT_CLASS] && item instanceof EntityList === true) {
                    pathObj.isGrid = true;
                }
                pathObj.path.push(prop);
            }
            if (item[PARENT_CLASS] && item instanceof EntityList === true) {
                handleParent(item[PARENT_CLASS]);
            }
        };
        handleParent(this);
        pathObj.path = pathObj.path.reverse();
        return pathObj;
    };
    /**
     * 加载数据
     * @param data 新数据
     */
    Entity.prototype.load = function (data) {
        if (!data) {
            data = {};
        }
        this.loadFields(data);
        this.loadLists(data);
        this.loadObjects(data);
        this.loadDynamicObjects(data);
        this.newData = Object.assign({}, data);
    };
    /**
     * 转换为JSON
     */
    Entity.prototype.toJSON = function () {
        var _this = this;
        var result = {};
        // 简单属性
        var ngFields = FieldMetadataUtil.getNgFields(this.constructor);
        Object.keys(ngFields).forEach(function (propName) {
            var ngField = ngFields[propName];
            var dataField = ngField.dataField || propName;
            result[dataField] = _this[propName];
        });
        // 对象属性
        var ngObjects = FieldMetadataUtil.getNgObjects(this.constructor);
        Object.keys(ngObjects).forEach(function (propName) {
            var ngObject = ngObjects[propName];
            var dataField = ngObject.dataField || propName;
            result[dataField] = _this[propName] ? _this[propName].toJSON() : {};
        });
        // 动态属性
        var ngDynamics = FieldMetadataUtil.getNgDynamic(this.constructor);
        Object.keys(ngDynamics).forEach(function (propName) {
            var ngDynamic = ngDynamics[propName];
            var dataField = ngDynamic.dataField || propName;
            result[dataField] = _this[propName] ? _this[propName].toJSON() : {};
        });
        // 列表属性
        var ngLists = FieldMetadataUtil.getNgList(this.constructor);
        Object.keys(ngLists).forEach(function (propName) {
            var ngList = ngLists[propName];
            var dataField = ngList.dataField || propName;
            result[dataField] = _this[propName] ? _this[propName].toJSON() : {};
        });
        return result;
    };
    // #endregion
    //#region 实体初始化相关private方法
    /**
     * 初始化实体
     */
    Entity.prototype.initialize = function () {
        var constructor = this.constructor;
        var ngFields = FieldMetadataUtil.getNgFields(constructor);
        var ngObjects = FieldMetadataUtil.getNgObjects(constructor);
        var ngLists = FieldMetadataUtil.getNgList(constructor);
        var ngDynamic = FieldMetadataUtil.getNgDynamic(constructor);
        this.initializeNormalField(ngFields);
        this.initializeList(ngLists);
        this.initializeObject(ngObjects);
        this.initializeDynamic(ngDynamic);
    };
    /**
     * 创建path
     * @param propertyName 属性名称
     */
    Entity.prototype.createPath = function (propertyName) {
        var primaryFieldMetadata = this.primaryProperty;
        if (primaryFieldMetadata) {
            var primaryDataField = primaryFieldMetadata.dataField;
            return [primaryDataField + ':' + this.primaryValue, propertyName];
        }
        else {
            return [':', propertyName];
        }
    };
    /**
     * 属性字段初始化
     * @param ngFields 属性字段元数据
     */
    Entity.prototype.initializeNormalField = function (ngFields) {
        var _this = this;
        Object.keys(ngFields).forEach(function (propName) {
            var ngField = ngFields[propName];
            var dataField = ngField.dataField || propName;
            if (delete _this[propName]) {
                Object.defineProperty(_this, propName, {
                    get: function () {
                        return this.getPropValue(propName, ngField);
                    },
                    set: function (newPropValue) {
                        // 有主键的实体，必须先给主键赋值，否则其他字段不允许赋值
                        if (this.primaryKey && this.primaryKey === propName && !newPropValue) {
                            return;
                        }
                        if (this.primaryKey && this.primaryKey !== propName && !this.primaryValue) {
                            return;
                        }
                        // 值相同时不触发变更。
                        var oldPropValue = this.getPropValue(propName, ngField);
                        if (this.isPropValueChanged(propName, ngField, newPropValue, oldPropValue) === false) {
                            return;
                        }
                        this.setPropValue(propName, ngField, newPropValue);
                        this.emitValueChange(propName, ngField, newPropValue, oldPropValue);
                    },
                    configurable: true
                });
            }
        });
    };
    /**
     * 初始化列表类型的元数据
     * @param ngListMetadata 列表类型元数据
     */
    Entity.prototype.initializeList = function (ngListMetadata) {
        var _this = this;
        Object.keys(ngListMetadata).forEach(function (propertyName) {
            var fieldMetadata = ngListMetadata[propertyName];
            var path = _this.createPath(propertyName);
            var dataField = fieldMetadata.dataField || propertyName;
            var val = _this.data[dataField];
            var entityList = new EntityList();
            entityList[PARENT_CLASS] = _this;
            entityList[PARENT_PATH] = path;
            if (val) {
                var entities = val.map(function (v) { return EntityFactory(fieldMetadata.type, v); });
                entityList.loadEntities(entities);
            }
            entityList.onListChanged.subscribe(function (value) {
                if (value) {
                    if (entityList[PARENT_PATH][0] !== value.path[0]) {
                        value.path = entityList[PARENT_PATH].concat(value.path);
                    }
                    _this.setChanges(value);
                }
            });
            _this[propertyName] = entityList;
        });
    };
    /**
     * 初始化子对象
     * @param ngObjectMetadata 子对象元数据
     */
    Entity.prototype.initializeObject = function (ngObjectMetadata) {
        var _this = this;
        Object.keys(ngObjectMetadata).forEach(function (propertyName) {
            var fieldMetadata = ngObjectMetadata[propertyName];
            var path = _this.createPath(propertyName);
            var dataField = fieldMetadata.dataField || propertyName;
            // val不存在时，用空对象代替
            var val = _this.data[dataField] || {};
            var createEntityFromJsonData = function (value) {
                var instance;
                if (value instanceof fieldMetadata.type) {
                    instance = value;
                }
                else {
                    instance = EntityFactory(fieldMetadata.type, value);
                }
                instance[PARENT_CLASS] = _this;
                instance[PARENT_PATH] = path;
                instance.onValueChanged.subscribe(function (changes) {
                    if (changes) {
                        changes.path = (_this[PARENT_PATH] || []).concat(changes.path);
                        _this.setChanges(changes);
                    }
                });
                return instance;
            };
            // 如果没有值用一个空对象代替
            var childEntity = createEntityFromJsonData(val);
            if (delete _this[propertyName]) {
                Object.defineProperty(_this, propertyName, {
                    get: function () {
                        return childEntity;
                    },
                    set: function (value) {
                        var modifyInfo = {
                            path: childEntity[PARENT_PATH],
                            value: value.data,
                            preValue: this[propertyName].data,
                            type: ModifyType.ValueChange
                        };
                        childEntity = createEntityFromJsonData(value);
                        this.setChanges(modifyInfo);
                    },
                    configurable: true
                });
            }
        });
    };
    Entity.prototype.initializeDynamic = function (ngDynamicMetadata) {
        var _this = this;
        Object.keys(ngDynamicMetadata).forEach(function (propertyName) {
            var fieldMetadata = ngDynamicMetadata[propertyName];
            var path = _this.createPath(propertyName);
            var dataField = fieldMetadata.dataField || propertyName;
            var originalData = _this.data[dataField] || {};
            var createEntityFromJsonData = function (value) {
                var instance;
                if (value instanceof fieldMetadata.type) {
                    instance = value;
                }
                else {
                    instance = EntityFactory(fieldMetadata.type, value);
                }
                instance[PARENT_CLASS] = _this;
                instance[PARENT_PATH] = path;
                instance.onValueChanged.subscribe(function (changes) {
                    if (changes) {
                        changes.path = (_this[PARENT_PATH] || []).concat(changes.path);
                        _this.setChanges(changes);
                    }
                });
                return instance;
            };
            var dynamicEntity = createEntityFromJsonData(originalData);
            if (delete _this[propertyName]) {
                Object.defineProperty(_this, propertyName, {
                    get: function () {
                        return dynamicEntity;
                    },
                    set: function (value) {
                        var modifyInfo = {
                            path: dynamicEntity[PARENT_PATH],
                            value: value.data,
                            preValue: this[propertyName].data,
                            type: ModifyType.ValueChange
                        };
                        dynamicEntity = createEntityFromJsonData(value);
                        this.setChanges(modifyInfo);
                    },
                    configurable: true
                });
            }
        });
    };
    //#endregion
    // #region 加载实体数据相关private、projected方法
    /**
     * 加载简单字段值
     * @todo 临时用修改的方式模拟
     */
    Entity.prototype.loadFields = function (data) {
        var _this = this;
        var ngFields = FieldMetadataUtil.getNgFields(this.constructor);
        Object.keys(ngFields).forEach(function (propName) {
            var ngField = ngFields[propName];
            var dataField = ngField.dataField || propName;
            // if (ngField.primary === false) {
            //   this[propName] = data[dataField];
            // }
            _this[propName] = data[dataField];
        });
    };
    /**
     * 加载子列表数据
     * @param data 数据
     */
    Entity.prototype.loadLists = function (data) {
        var _this = this;
        var ngLists = FieldMetadataUtil.getNgList(this.constructor);
        Object.keys(ngLists).forEach(function (propName) {
            var ngList = ngLists[propName];
            var dataField = ngList.dataField || propName;
            var entityType = ngList.type;
            // 创建实体
            var listData = data[dataField];
            if (listData) {
                var entities = listData.map(function (entityData) {
                    return EntityFactory(entityType, entityData);
                });
                _this[propName].loadEntities(entities);
            }
            else {
                _this[propName].loadEntities([]);
            }
        });
    };
    Entity.prototype.loadObjects = function (data) {
        var _this = this;
        var ngObjects = FieldMetadataUtil.getNgObjects(this.constructor);
        Object.keys(ngObjects).forEach(function (propName) {
            var ngObject = ngObjects[propName];
            var dataField = ngObject.dataField || propName;
            var objectData = data[dataField];
            var entity = _this[propName];
            if (!entity || !objectData) {
                return;
            }
            entity.load(objectData);
        });
    };
    Entity.prototype.loadDynamicObjects = function (data) {
        var _this = this;
        var ngDynamicObjects = FieldMetadataUtil.getNgDynamic(this.constructor);
        Object.keys(ngDynamicObjects).forEach(function (propName) {
            var ngDynamicObject = ngDynamicObjects[propName];
            var dataField = ngDynamicObject.dataField || propName;
            var dynamicData = data[dataField] || {};
            var dynamicEntity = _this[propName];
            if (!dynamicEntity) {
                return;
            }
            dynamicEntity.loadDynamicData(dynamicData);
        });
    };
    // #endregion
    // #region 私有工具方法
    /**
     * 发送值变更
     */
    Entity.prototype.emitValueChange = function (propName, propMetadata, newPropValue, oldPropValue) {
        var change = {
            path: this.createPath(propName),
            value: newPropValue,
            preValue: oldPropValue,
            type: ModifyType.ValueChange
        };
        if (this[PARENT_PATH]) {
            change.path = this[PARENT_PATH].concat(change.path);
        }
        this.setChanges(change);
    };
    /**
     * 获取属性值
     */
    Entity.prototype.getPropValue = function (propName, propMetadata) {
        var _a;
        var dataField = propMetadata.dataField || propName;
        var value = this.data[dataField];
        // 对多语录入字段，query不返回问题进行兼容
        if (propMetadata.enableMultiLangInput === true && !value) {
            var langCode = window.localStorage.getItem('languageCode') || 'zh-CHS';
            var originDataField = dataField.replace('_MULTILANGUAGE', '');
            return _a = {},
                _a[langCode] = this.data[originDataField],
                _a;
        }
        return value;
    };
    /**
     * 设置属性值
     */
    Entity.prototype.setPropValue = function (propName, propMetadata, propValue) {
        var dataField = propMetadata.dataField || propName;
        this.data[dataField] = propValue;
    };
    /**
     * 检查属性值是否发生变化
     */
    Entity.prototype.isPropValueChanged = function (propName, propMetadata, newPropValue, oldPropValue) {
        if (propMetadata.enableMultiLangInput === true) {
            if (this.isEmptyMultiLangPropValue(newPropValue) === true && this.isEmptyMultiLangPropValue(oldPropValue) === true) {
                return false;
            }
            return JSON.stringify(newPropValue) !== JSON.stringify(oldPropValue);
        }
        else {
            return newPropValue !== oldPropValue;
        }
    };
    /**
     * 多语录入字段的值是否为空
     */
    Entity.prototype.isEmptyMultiLangPropValue = function (value) {
        return !value || Object.keys(value).length === 0;
    };
    return Entity;
}());
export { Entity };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW50aXR5LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9tb2JpbGUtZGV2a2l0LyIsInNvdXJjZXMiOlsibGliL2VudGl0eS9lbnRpdHkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFjLE9BQU8sRUFBWSxNQUFNLE1BQU0sQ0FBQztBQUVyRCxPQUFPLEVBQW9GLGlCQUFpQixFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFBQSxDQUFDO0FBQ3hJLE9BQU8sRUFBZ0IsVUFBVSxFQUFFLFNBQVMsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQ3pFLE9BQU8sRUFBRSxXQUFXLEVBQUUsWUFBWSxFQUFXLE1BQU0sU0FBUyxDQUFDO0FBQzdELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBRWpEOzs7Ozs7Ozs7Ozs7Ozs7R0FlRztBQUNIO0lBMEdFLGFBQWE7SUFHYjs7T0FFRztJQUNILGdCQUFZLElBQVM7UUE3R3JCLGtCQUFrQjtRQUVsQjs7V0FFRztRQUNLLGdCQUFXLEdBQUcsRUFBRSxDQUFDO1FBRXpCOztXQUVHO1FBQ08sY0FBUyxHQUFHLElBQUksU0FBUyxFQUFFLENBQUM7UUFFdEM7O1dBRUc7UUFDTyxpQkFBWSxHQUFHLEtBQUssQ0FBQztRQUUvQjs7V0FFRztRQUNPLFlBQU8sR0FBRyxTQUFTLENBQUM7UUFFOUIsYUFBYTtRQUdiLGVBQWU7UUFFZjs7V0FFRztRQUNJLGlCQUFZLEdBQUcsSUFBSSxPQUFPLEVBQWdCLENBQUM7UUFFbEQ7Ozs7Ozs7Ozs7Ozs7V0FhRztRQUNJLG1CQUFjLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQWdFdkQsSUFBSSxDQUFDLE9BQU8sR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxJQUFJLENBQUMsQ0FBQztRQUN2QyxJQUFJLENBQUMsY0FBYyxHQUFH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Y3QsIGZyb20sIG9mIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IHNjYW4sIG1hcCwgdGFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBQcmltaXRpdmVQcm9wTWV0YWRhdGEsIExpc3RQcm9wTWV0YWRhdGEsIE9iamVjdFByb3BNZXRhZGF0YSwgRHluYW1pY1Byb3BNZXRhZGF0YSwgRmllbGRNZXRhZGF0YVV0aWwgfSBmcm9tICcuL21ldGFkYXRhL2luZGV4Jzs7XHJcbmltcG9ydCB7IE1vZGlmaWNhdGlvbiwgTW9kaWZ5VHlwZSwgQ2hhbmdlU2V0IH0gZnJvbSAnLi4vY2hhbmdlc2V0L2luZGV4JztcclxuaW1wb3J0IHsgUEFSRU5UX1BBVEgsIFBBUkVOVF9DTEFTUywgRHluYW1pYyB9IGZyb20gJy4vdHlwZXMnO1xyXG5pbXBvcnQgeyBFbnRpdHlMaXN0IH0gZnJvbSAnLi9lbnRpdHlfbGlzdCc7XHJcbmltcG9ydCB7IEVudGl0eUZhY3RvcnkgfSBmcm9tICcuL2VudGl0eV9mYWN0b3J5JztcclxuXHJcbi8qKlxyXG4gKiBAYXV0aG9yIEx1Y2FzIEh1YW5nXHJcbiAqIOWunuS9k+aKveixoeWfuuexu++8jOaJgOacieWunuS9k+W/hemhu+aJqeWxleiHqkVudGl0eVxyXG4gKlxyXG4gKiAjIyMg5L2/55So56S65L6LXHJcbiAqIGBgYFxyXG4gKiBleHBvcnQgY2xhc3MgVXNlckVudGl0eSBleHRlbmRzIEVudGl0eSB7XHJcbiAqICAgIHVzZXJJZDogc3RyaW5nO1xyXG4gKiAgICB1c2VyTmFtZTogc3RyaW5nO1xyXG4gKlxyXG4gKiAgICBjb25zdHJ1Y3RvcihkYXRhOiBhbnkpe1xyXG4gKiAgICAgICAgc3VwZXIoZGF0YSk7XHJcbiAqICAgIH1cclxuICogfVxyXG4gKiBgYGBcclxuICovXHJcbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBFbnRpdHkge1xyXG5cclxuXHJcbiAgLy8gI3JlZ2lvbiDnp4HmnInjgIHkv53miqTlsZ7mgKdcclxuXHJcbiAgLyoqXHJcbiAgICog6aqM6K+B6ZSZ6K+v6ZuG5ZCIXHJcbiAgICovXHJcbiAgcHJpdmF0ZSB2YWxpZEVycm9ycyA9IHt9O1xyXG5cclxuICAvKipcclxuICAgKiDlop7ph4/lj5jmm7Tpm4blkIhcclxuICAgKi9cclxuICBwcm90ZWN0ZWQgY2hhbmdlU2V0ID0gbmV3IENoYW5nZVNldCgpO1xyXG5cclxuICAvKipcclxuICAgKiDmmK/lkKbmraPlnKjpqozor4FcclxuICAgKi9cclxuICBwcm90ZWN0ZWQgaXNWYWxpZGF0aW5nID0gZmFsc2U7XHJcblxyXG4gIC8qKlxyXG4gICAqIOaWsOaVsOaNrlxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBuZXdEYXRhID0gdW5kZWZpbmVkO1xyXG5cclxuICAvLyAjZW5kcmVnaW9uXHJcblxyXG5cclxuICAvLyAjcmVnaW9uIOWFrOacieWxnuaAp1xyXG5cclxuICAvKipcclxuICAgKiDlj5jmm7TmtYFcclxuICAgKi9cclxuICBwdWJsaWMgdmFsdWVDaGFuZ2VkID0gbmV3IFN1YmplY3Q8TW9kaWZpY2F0aW9uPigpO1xyXG5cclxuICAvKipcclxuICAgKiDlsZ7mgKflgLzmlLnlj5jml7bop6blj5FcclxuICAgKlxyXG4gICAqICMjIyDkvb/nlKjnpLrkvotcclxuICAgKiBgYGBcclxuICAgKiAgY29uc3QgZW50aXR5ID0gbmV3IFVzZXJFbnRpdHkoZGF0YSk7XHJcbiAgICogIGVudGl0eS5vblZhbHVlQ2hhbmdlZC5zdWJzY3JpYmUoKGRhdGE6IE1vZGlmaWNhdGlvbikgPT4ge1xyXG4gICAqICAgICAgY29uc29sZS5sb2coZGF0YSk7XHJcbiAgICogIH0pXHJcbiAgICpcclxuICAgKiBgYGBcclxuICAgKlxyXG4gICAqIEBldmVudFxyXG4gICAqL1xyXG4gIHB1YmxpYyBvblZhbHVlQ2hhbmdlZCA9IHRoaXMudmFsdWVDaGFuZ2VkLmFzT2JzZXJ2YWJsZSgpO1xyXG5cclxuICAvKipcclxuICAgKiDov5Tlm55KU09O5qC85byP55qE5pWw5o2uXHJcbiAgICovXHJcbiAgcHVibGljIGdldCBkYXRhKCk6IGFueSB7XHJcbiAgICByZXR1cm4gdGhpcy5uZXdEYXRhO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6aqM6K+B6ZSZ6K+v6ZuG5ZCIXHJcbiAgICovXHJcbiAgcHVibGljIGdldCBlcnJvcnMoKSB7XHJcbiAgICByZXR1cm4gdGhpcy52YWxpZEVycm9ycztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWunuS9k+WPmOabtOmbhlxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXQgY2hhbmdlcygpOiBNb2RpZmljYXRpb25bXSB7XHJcbiAgICByZXR1cm4gdGhpcy5jaGFuZ2VTZXQuY2hhbmdlcztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWunuS9k+S4u+mUruWFg+aVsOaNrlxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXQgcHJpbWFyeVByb3BlcnR5KCk6IFByaW1pdGl2ZVByb3BNZXRhZGF0YSB7XHJcbiAgICByZXR1cm4gRmllbGRNZXRhZGF0YVV0aWwuZ2V0UHJpbWFyeUZpZWxkTWV0YWRhdGEodGhpcy5jb25zdHJ1Y3Rvcik7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDkuLvplK5cclxuICAgKiBAdG9kb1xyXG4gICAqIDHjgIHmsqHmnInkuLvplK7ml7bov5Tlm54nJ+S4jeWQiOeQhu+8jOW6lOivpei/lOWbnnVuZGVmaW5lZFxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXQgcHJpbWFyeUtleSgpOiBzdHJpbmcge1xyXG4gICAgaWYgKHRoaXMucHJpbWFyeVByb3BlcnR5KSB7XHJcbiAgICAgIHJldHVybiB0aGlzLnByaW1hcnlQcm9wZXJ0eS5wcm9wZXJ0eTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiAnJztcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWunuS9k+S4u+mUruWAvFxyXG4gICAqIDHjgIHmsqHmnInkuLvplK7ml7bov5Tlm54nJ+S4jeWQiOeQhu+8jOW6lOivpei/lOWbnnVuZGVmaW5lZFxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXQgcHJpbWFyeVZhbHVlKCk6IHN0cmluZyB7XHJcbiAgICBpZiAodGhpcy5wcmltYXJ5S2V5KSB7XHJcbiAgICAgIC8vIHJldHVybiB0aGlzW3RoaXMucHJpbWFyeVByb3BlcnR5LnByb3BlcnR5XS50b1N0cmluZygpO1xyXG4gICAgICBjb25zdCBwcmltYXJ5VmFsdWUgPSB0aGlzW3RoaXMucHJpbWFyeVByb3BlcnR5LnByb3BlcnR5XTtcclxuICAgICAgcmV0dXJuIHByaW1hcnlWYWx1ZSA/IHByaW1hcnlWYWx1ZSA6ICcnO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuICcnO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gI2VuZHJlZ2lvblxyXG5cclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIGRhdGEgSlNPTuaVsOaNrlxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKGRhdGE6IGFueSkge1xyXG4gICAgdGhpcy5uZXdEYXRhID0gT2JqZWN0LmFzc2lnbih7fSwgZGF0YSk7XHJcbiAgICB0aGlzLm9uVmFsdWVDaGFuZ2VkID0gdGhpcy52YWx1ZUNoYW5nZWQ7XHJcbiAgICB0aGlzLmluaXRpYWxpemUoKTtcclxuICB9XHJcblxyXG5cclxuICAvLyAjcmVnaW9uIOWFrOacieaWueazlVxyXG5cclxuICAvKipcclxuICAgKiDlsIblj5jmm7TorrDlvZXkv53lrZjoh7Plj5jmm7Tpm4bkuK1cclxuICAgKiBAcGFyYW0gdmFsdWUg5Y+Y5pu06K6w5b2VXHJcbiAgICovXHJcbiAgcHVibGljIHNldENoYW5nZXModmFsdWU6IE1vZGlmaWNhdGlvbik6IHZvaWQge1xyXG4gICAgY29uc3QgcHJvcGVydHlOYW1lID0gdmFsdWUucGF0aFt2YWx1ZS5wYXRoLmxlbmd0aCAtIDFdO1xyXG5cclxuICAgIC8vIEB0b2Rv77ya5LqL5Lu25Lya5LuO5LiL57qn5ZCR5LiK5YaS5rOh77yMY2hhbmdl5Y+v6IO95piv5LiL57qn55qE77yM5LiN6IO95ZKM5b2T5YmNRW50aXR555qEbmV3RGF0YeWQiOW5tuOAglxyXG4gICAgLy8gdGhpcy5uZXdEYXRhID0gT2JqZWN0LmFzc2lnbih0aGlzLm5ld0RhdGEsIHsgW3Byb3BlcnR5TmFtZV06IHZhbHVlLnZhbHVlIH0pO1xyXG5cclxuICAgIHRoaXMudmFsdWVDaGFuZ2VkLm5leHQodmFsdWUpO1xyXG4gICAgdGhpcy5jaGFuZ2VTZXQuYXBwZW5kKHZhbHVlKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRQYXRocygpIHtcclxuICAgIGNvbnN0IHBhdGhPYmogPSB7XHJcbiAgICAgIHBhdGg6IFtdLFxyXG4gICAgICBpc1VkdDogZmFsc2UsXHJcbiAgICAgIGlzR3JpZDogZmFsc2VcclxuICAgIH07XHJcbiAgICBjb25zdCBoYW5kbGVQYXJlbnQgPSBpdGVtID0+IHtcclxuICAgICAgY29uc3QgcGFyZW50UGF0aHMgPSBpdGVtW1BBUkVOVF9QQVRIXTtcclxuICAgICAgaWYgKHBhcmVudFBhdGhzKSB7XHJcbiAgICAgICAgY29uc3QgcHJvcCA9IHBhcmVudFBhdGhzW3BhcmVudFBhdGhzLmxlbmd0aCAtIDFdO1xyXG4gICAgICAgIC8vIOeItue6p+aJgOWcqOWunuS9k+WMheWQq+eahG5nT2JqZWN077yM5a2Y5Zyo5b2T5YmN5a6e5L2T5a2X5q6177yM5YiZ5Yik5pat5Li6VUR05a2X5q61XHJcbiAgICAgICAgaWYgKE9iamVjdC5rZXlzKEZpZWxkTWV0YWRhdGFVdGlsLmdldE5nT2JqZWN0cyhpdGVtW1BBUkVOVF9DTEFTU10uY29uc3RydWN0b3IpKS5pbmRleE9mKHByb3ApID4gLTEpIHtcclxuICAgICAgICAgIHBhdGhPYmouaXNVZHQgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyDlrZjlnKjnsbvlnovkuLpuZ0xpc3TvvIzliJnliKTmlq3kuLpncmlkXHJcbiAgICAgICAgaWYgKGl0ZW1bUEFSRU5UX0NMQVNTXSAmJiBpdGVtIGluc3RhbmNlb2YgRW50aXR5TGlzdCA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgcGF0aE9iai5pc0dyaWQgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwYXRoT2JqLnBhdGgucHVzaChwcm9wKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoaXRlbVtQQVJFTlRfQ0xBU1NdICYmIGl0ZW0gaW5zdGFuY2VvZiBFbnRpdHlMaXN0ID09PSB0cnVlKSB7XHJcbiAgICAgICAgaGFuZGxlUGFyZW50KGl0ZW1bUEFSRU5UX0NMQVNTXSk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgICBoYW5kbGVQYXJlbnQodGhpcyk7XHJcbiAgICBwYXRoT2JqLnBhdGggPSBwYXRoT2JqLnBhdGgucmV2ZXJzZSgpO1xyXG4gICAgcmV0dXJuIHBhdGhPYmo7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDliqDovb3mlbDmja5cclxuICAgKiBAcGFyYW0gZGF0YSDmlrDmlbDmja5cclxuICAgKi9cclxuICBwdWJsaWMgbG9hZChkYXRhOiBhbnkpIHtcclxuICAgIGlmICghZGF0YSkge1xyXG4gICAgICBkYXRhID0ge307XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5sb2FkRmllbGRzKGRhdGEpO1xyXG4gICAgdGhpcy5sb2FkTGlzdHMoZGF0YSk7XHJcbiAgICB0aGlzLmxvYWRPYmplY3RzKGRhdGEpO1xyXG5cclxuICAgIHRoaXMubG9hZER5bmFtaWNPYmplY3RzKGRhdGEpO1xyXG4gICAgdGhpcy5uZXdEYXRhID0gT2JqZWN0LmFzc2lnbih7fSwgZGF0YSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDovazmjaLkuLpKU09OXHJcbiAgICovXHJcbiAgcHVibGljIHRvSlNPTigpIHtcclxuICAgIGNvbnN0IHJlc3VsdCA9IHt9O1xyXG5cclxuICAgIC8vIOeugOWNleWxnuaAp1xyXG4gICAgY29uc3QgbmdGaWVsZHMgPSBGaWVsZE1ldGFkYXRhVXRpbC5nZXROZ0ZpZWxkcyh0aGlzLmNvbnN0cnVjdG9yKTtcclxuICAgIE9iamVjdC5rZXlzKG5nRmllbGRzKS5mb3JFYWNoKChwcm9wTmFtZTogc3RyaW5nKSA9PiB7XHJcbiAgICAgIGNvbnN0IG5nRmllbGQgPSBuZ0ZpZWxkc1twcm9wTmFtZV07XHJcbiAgICAgIGNvbnN0IGRhdGFGaWVsZCA9IG5nRmllbGQuZGF0YUZpZWxkIHx8IHByb3BOYW1lO1xyXG4gICAgICByZXN1bHRbZGF0YUZpZWxkXSA9IHRoaXNbcHJvcE5hbWVdO1xyXG4gICAgfSk7XHJcblxyXG4gICAgLy8g5a+56LGh5bGe5oCnXHJcbiAgICBjb25zdCBuZ09iamVjdHMgPSBGaWVsZE1ldGFkYXRhVXRpbC5nZXROZ09iamVjdHModGhpcy5jb25zdHJ1Y3Rvcik7XHJcbiAgICBPYmplY3Qua2V5cyhuZ09iamVjdHMpLmZvckVhY2goKHByb3BOYW1lOiBzdHJpbmcpID0+IHtcclxuICAgICAgY29uc3QgbmdPYmplY3QgPSBuZ09iamVjdHNbcHJvcE5hbWVdO1xyXG4gICAgICBjb25zdCBkYXRhRmllbGQgPSBuZ09iamVjdC5kYXRhRmllbGQgfHwgcHJvcE5hbWU7XHJcbiAgICAgIHJlc3VsdFtkYXRhRmllbGRdID0gdGhpc1twcm9wTmFtZV0gPyB0aGlzW3Byb3BOYW1lXS50b0pTT04oKSA6IHt9O1xyXG4gICAgfSk7XHJcblxyXG4gICAgLy8g5Yqo5oCB5bGe5oCnXHJcbiAgICBjb25zdCBuZ0R5bmFtaWNzID0gRmllbGRNZXRhZGF0YVV0aWwuZ2V0TmdEeW5hbWljKHRoaXMuY29uc3RydWN0b3IpO1xyXG4gICAgT2JqZWN0LmtleXMobmdEeW5hbWljcykuZm9yRWFjaCgocHJvcE5hbWU6IHN0cmluZykgPT4ge1xyXG4gICAgICBjb25zdCBuZ0R5bmFtaWMgPSBuZ0R5bmFtaWNzW3Byb3BOYW1lXTtcclxuICAgICAgY29uc3QgZGF0YUZpZWxkID0gbmdEeW5hbWljLmRhdGFGaWVsZCB8fCBwcm9wTmFtZTtcclxuICAgICAgcmVzdWx0W2RhdGFGaWVsZF0gPSB0aGlzW3Byb3BOYW1lXSA/IHRoaXNbcHJvcE5hbWVdLnRvSlNPTigpIDoge307XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyDliJfooajlsZ7mgKdcclxuICAgIGNvbnN0IG5nTGlzdHMgPSBGaWVsZE1ldGFkYXRhVXRpbC5nZXROZ0xpc3QodGhpcy5jb25zdHJ1Y3Rvcik7XHJcbiAgICBPYmplY3Qua2V5cyhuZ0xpc3RzKS5mb3JFYWNoKChwcm9wTmFtZTogc3RyaW5nKSA9PiB7XHJcbiAgICAgIGNvbnN0IG5nTGlzdCA9IG5nTGlzdHNbcHJvcE5hbWVdO1xyXG4gICAgICBjb25zdCBkYXRhRmllbGQgPSBuZ0xpc3QuZGF0YUZpZWxkIHx8IHByb3BOYW1lO1xyXG4gICAgICByZXN1bHRbZGF0YUZpZWxkXSA9IHRoaXNbcHJvcE5hbWVdID8gdGhpc1twcm9wTmFtZV0udG9KU09OKCkgOiB7fTtcclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiByZXN1bHQ7XHJcbiAgfVxyXG5cclxuICAvLyAjZW5kcmVnaW9uXHJcblxyXG5cclxuICAvLyNyZWdpb24g5a6e5L2T5Yid5aeL5YyW55u45YWzcHJpdmF0ZeaWueazlVxyXG5cclxuICAvKipcclxuICAgKiDliJ3lp4vljJblrp7kvZNcclxuICAgKi9cclxuICBwcml2YXRlIGluaXRpYWxpemUoKSB7XHJcbiAgICBjb25zdCBjb25zdHJ1Y3RvciA9IHRoaXMuY29uc3RydWN0b3I7XHJcblxyXG4gICAgY29uc3QgbmdGaWVsZHMgPSBGaWVsZE1ldGFkYXRhVXRpbC5nZXROZ0ZpZWxkcyhjb25zdHJ1Y3Rvcik7XHJcbiAgICBjb25zdCBuZ09iamVjdHMgPSBGaWVsZE1ldGFkYXRhVXRpbC5nZXROZ09iamVjdHMoY29uc3RydWN0b3IpO1xyXG4gICAgY29uc3QgbmdMaXN0cyA9IEZpZWxkTWV0YWRhdGFVdGlsLmdldE5nTGlzdChjb25zdHJ1Y3Rvcik7XHJcbiAgICBjb25zdCBuZ0R5bmFtaWMgPSBGaWVsZE1ldGFkYXRhVXRpbC5nZXROZ0R5bmFtaWMoY29uc3RydWN0b3IpO1xyXG5cclxuICAgIHRoaXMuaW5pdGlhbGl6ZU5vcm1hbEZpZWxkKG5nRmllbGRzKTtcclxuICAgIHRoaXMuaW5pdGlhbGl6ZUxpc3QobmdMaXN0cyk7XHJcbiAgICB0aGlzLmluaXRpYWxpemVPYmplY3QobmdPYmplY3RzKTtcclxuICAgIHRoaXMuaW5pdGlhbGl6ZUR5bmFtaWMobmdEeW5hbWljKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWIm+W7unBhdGhcclxuICAgKiBAcGFyYW0gcHJvcGVydHlOYW1lIOWxnuaAp+WQjeensFxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBjcmVhdGVQYXRoKHByb3BlcnR5TmFtZTogc3RyaW5nKTogc3RyaW5nW10ge1xyXG4gICAgY29uc3QgcHJpbWFyeUZpZWxkTWV0YWRhdGEgPSB0aGlzLnByaW1hcnlQcm9wZXJ0eTtcclxuICAgIGlmIChwcmltYXJ5RmllbGRNZXRhZGF0YSkge1xyXG4gICAgICBjb25zdCBwcmltYXJ5RGF0YUZpZWxkID0gcHJpbWFyeUZpZWxkTWV0YWRhdGEuZGF0YUZpZWxkO1xyXG4gICAgICByZXR1cm4gW3ByaW1hcnlEYXRhRmllbGQgKyAnOicgKyB0aGlzLnByaW1hcnlWYWx1ZSwgcHJvcGVydHlOYW1lXTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiBbJzonLCBwcm9wZXJ0eU5hbWVdO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5bGe5oCn5a2X5q615Yid5aeL5YyWXHJcbiAgICogQHBhcmFtIG5nRmllbGRzIOWxnuaAp+Wtl+auteWFg+aVsOaNrlxyXG4gICAqL1xyXG4gIHByaXZhdGUgaW5pdGlhbGl6ZU5vcm1hbEZpZWxkKG5nRmllbGRzOiB7IFtrZXk6IHN0cmluZ106IFByaW1pdGl2ZVByb3BNZXRhZGF0YSB9KTogdm9pZCB7XHJcbiAgICBPYmplY3Qua2V5cyhuZ0ZpZWxkcykuZm9yRWFjaChwcm9wTmFtZSA9PiB7XHJcbiAgICAgIGNvbnN0IG5nRmllbGQgPSBuZ0ZpZWxkc1twcm9wTmFtZV0gYXMgUHJpbWl0aXZlUHJvcE1ldGFkYXRhO1xyXG4gICAgICBjb25zdCBkYXRhRmllbGQgPSBuZ0ZpZWxkLmRhdGFGaWVsZCB8fCBwcm9wTmFtZTtcclxuXHJcbiAgICAgIGlmIChkZWxldGUgdGhpc1twcm9wTmFtZV0pIHtcclxuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgcHJvcE5hbWUsIHtcclxuICAgICAgICAgIGdldDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFByb3BWYWx1ZShwcm9wTmFtZSwgbmdGaWVsZCk7XHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgc2V0OiBmdW5jdGlvbihuZXdQcm9wVmFsdWUpIHtcclxuXHJcbiAgICAgICAgICAgIC8vIOacieS4u+mUrueahOWunuS9k++8jOW/hemhu+WFiOe7meS4u+mUrui1i+WAvO+8jOWQpuWImeWFtuS7luWtl+auteS4jeWFgeiuuOi1i+WAvFxyXG4gICAgICAgICAgICBpZiAodGhpcy5wcmltYXJ5S2V5ICYmIHRoaXMucHJpbWFyeUtleSA9PT0gcHJvcE5hbWUgJiYgIW5ld1Byb3BWYWx1ZSkge1xyXG4gICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMucHJpbWFyeUtleSAmJiB0aGlzLnByaW1hcnlLZXkgIT09IHByb3BOYW1lICYmICF0aGlzLnByaW1hcnlWYWx1ZSApIHtcclxuICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIOWAvOebuOWQjOaXtuS4jeinpuWPkeWPmOabtOOAglxyXG4gICAgICAgICAgICBjb25zdCBvbGRQcm9wVmFsdWUgPSB0aGlzLmdldFByb3BWYWx1ZShwcm9wTmFtZSwgbmdGaWVsZCk7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmlzUHJvcFZhbHVlQ2hhbmdlZChwcm9wTmFtZSwgbmdGaWVsZCwgbmV3UHJvcFZhbHVlLCBvbGRQcm9wVmFsdWUpID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLnNldFByb3BWYWx1ZShwcm9wTmFtZSwgbmdGaWVsZCwgbmV3UHJvcFZhbHVlKTtcclxuICAgICAgICAgICAgdGhpcy5lbWl0VmFsdWVDaGFuZ2UocHJvcE5hbWUsIG5nRmllbGQsIG5ld1Byb3BWYWx1ZSwgb2xkUHJvcFZhbHVlKTtcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDliJ3lp4vljJbliJfooajnsbvlnovnmoTlhYPmlbDmja5cclxuICAgKiBAcGFyYW0gbmdMaXN0TWV0YWRhdGEg5YiX6KGo57G75Z6L5YWD5pWw5o2uXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBpbml0aWFsaXplTGlzdChuZ0xpc3RNZXRhZGF0YTogeyBba2V5OiBzdHJpbmddOiBMaXN0UHJvcE1ldGFkYXRhIH0pOiB2b2lkIHtcclxuICAgIE9iamVjdC5rZXlzKG5nTGlzdE1ldGFkYXRhKS5mb3JFYWNoKHByb3BlcnR5TmFtZSA9PiB7XHJcbiAgICAgIGNvbnN0IGZpZWxkTWV0YWRhdGEgPSBuZ0xpc3RNZXRhZGF0YVtwcm9wZXJ0eU5hbWVdIGFzIExpc3RQcm9wTWV0YWRhdGE7XHJcbiAgICAgIGNvbnN0IHBhdGggPSB0aGlzLmNyZWF0ZVBhdGgocHJvcGVydHlOYW1lKTtcclxuICAgICAgY29uc3QgZGF0YUZpZWxkID0gZmllbGRNZXRhZGF0YS5kYXRhRmllbGQgfHwgcHJvcGVydHlOYW1lO1xyXG4gICAgICBjb25zdCB2YWwgPSB0aGlzLmRhdGFbZGF0YUZpZWxkXTtcclxuXHJcbiAgICAgIGNvbnN0IGVudGl0eUxpc3QgPSBuZXcgRW50aXR5TGlzdDx0eXBlb2YgZmllbGRNZXRhZGF0YS50eXBlPigpO1xyXG4gICAgICBlbnRpdHlMaXN0W1BBUkVOVF9DTEFTU10gPSB0aGlzO1xyXG4gICAgICBlbnRpdHlMaXN0W1BBUkVOVF9QQVRIXSA9IHBhdGg7XHJcblxyXG4gICAgICBpZiAodmFsKSB7XHJcbiAgICAgICAgY29uc3QgZW50aXRpZXMgPSB2YWwubWFwKHYgPT4gRW50aXR5RmFjdG9yeTx0eXBlb2YgZmllbGRNZXRhZGF0YS50eXBlPihmaWVsZE1ldGFkYXRhLnR5cGUsIHYpKTtcclxuICAgICAgICBlbnRpdHlMaXN0LmxvYWRFbnRpdGllcyhlbnRpdGllcyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGVudGl0eUxpc3Qub25MaXN0Q2hhbmdlZC5zdWJzY3JpYmUodmFsdWUgPT4ge1xyXG4gICAgICAgIGlmICh2YWx1ZSkge1xyXG4gICAgICAgICAgaWYgKGVudGl0eUxpc3RbUEFSRU5UX1BBVEhdWzBdICE9PSB2YWx1ZS5wYXRoWzBdKSB7XHJcbiAgICAgICAgICAgIHZhbHVlLnBhdGggPSBlbnRpdHlMaXN0W1BBUkVOVF9QQVRIXS5jb25jYXQodmFsdWUucGF0aCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICB0aGlzLnNldENoYW5nZXModmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICAgIHRoaXNbcHJvcGVydHlOYW1lXSA9IGVudGl0eUxpc3Q7XHJcbiAgICB9KTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5Yid5aeL5YyW5a2Q5a+56LGhXHJcbiAgICogQHBhcmFtIG5nT2JqZWN0TWV0YWRhdGEg5a2Q5a+56LGh5YWD5pWw5o2uXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBpbml0aWFsaXplT2JqZWN0KG5nT2JqZWN0TWV0YWRhdGE6IHsgW2tleTogc3RyaW5nXTogT2JqZWN0UHJvcE1ldGFkYXRhIH0pIHtcclxuICAgIE9iamVjdC5rZXlzKG5nT2JqZWN0TWV0YWRhdGEpLmZvckVhY2gocHJvcGVydHlOYW1lID0+IHtcclxuICAgICAgY29uc3QgZmllbGRNZXRhZGF0YSA9IG5nT2JqZWN0TWV0YWRhdGFbcHJvcGVydHlOYW1lXSBhcyBPYmplY3RQcm9wTWV0YWRhdGE7XHJcbiAgICAgIGNvbnN0IHBhdGggPSB0aGlzLmNyZWF0ZVBhdGgocHJvcGVydHlOYW1lKTtcclxuICAgICAgY29uc3QgZGF0YUZpZWxkID0gZmllbGRNZXRhZGF0YS5kYXRhRmllbGQgfHwgcHJvcGVydHlOYW1lO1xyXG5cclxuICAgICAgLy8gdmFs5LiN5a2Y5Zyo5pe277yM55So56m65a+56LGh5Luj5pu/XHJcbiAgICAgIGNvbnN0IHZhbCA9IHRoaXMuZGF0YVtkYXRhRmllbGRdIHx8IHt9O1xyXG5cclxuICAgICAgY29uc3QgY3JlYXRlRW50aXR5RnJvbUpzb25EYXRhID0gKHZhbHVlOiBhbnkpID0+IHtcclxuICAgICAgICBsZXQgaW5zdGFuY2U7XHJcbiAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgZmllbGRNZXRhZGF0YS50eXBlKSB7XHJcbiAgICAgICAgICBpbnN0YW5jZSA9IHZhbHVlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBpbnN0YW5jZSA9IEVudGl0eUZhY3RvcnkoZmllbGRNZXRhZGF0YS50eXBlLCB2YWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGluc3RhbmNlW1BBUkVOVF9DTEFTU10gPSB0aGlzO1xyXG4gICAgICAgIGluc3RhbmNlW1BBUkVOVF9QQVRIXSA9IHBhdGg7XHJcblxyXG4gICAgICAgIGluc3RhbmNlLm9uVmFsdWVDaGFuZ2VkLnN1YnNjcmliZShjaGFuZ2VzID0+IHtcclxuICAgICAgICAgIGlmIChjaGFuZ2VzKSB7XHJcbiAgICAgICAgICAgIGNoYW5nZXMucGF0aCA9ICh0aGlzW1BBUkVOVF9QQVRIXSB8fCBbXSkuY29uY2F0KGNoYW5nZXMucGF0aCk7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0Q2hhbmdlcyhjaGFuZ2VzKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGluc3RhbmNlO1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgLy8g5aaC5p6c5rKh5pyJ5YC855So5LiA5Liq56m65a+56LGh5Luj5pu/XHJcbiAgICAgIGxldCBjaGlsZEVudGl0eSA9IGNyZWF0ZUVudGl0eUZyb21Kc29uRGF0YSh2YWwpO1xyXG4gICAgICBpZiAoZGVsZXRlIHRoaXNbcHJvcGVydHlOYW1lXSkge1xyXG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBwcm9wZXJ0eU5hbWUsIHtcclxuICAgICAgICAgIGdldDogKCkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gY2hpbGRFbnRpdHk7XHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgc2V0OiBmdW5jdGlvbiAodmFsdWU6IGFueSkge1xyXG4gICAgICAgICAgICBjb25zdCBtb2RpZnlJbmZvID0ge1xyXG4gICAgICAgICAgICAgIHBhdGg6IGNoaWxkRW50aXR5W1BBUkVOVF9QQVRIXSxcclxuICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUuZGF0YSxcclxuICAgICAgICAgICAgICBwcmVWYWx1ZTogdGhpc1twcm9wZXJ0eU5hbWVdLmRhdGEsXHJcbiAgICAgICAgICAgICAgdHlwZTogTW9kaWZ5VHlwZS5WYWx1ZUNoYW5nZVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBjaGlsZEVudGl0eSA9IGNyZWF0ZUVudGl0eUZyb21Kc29uRGF0YSh2YWx1ZSk7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0Q2hhbmdlcyhtb2RpZnlJbmZvKTtcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGluaXRpYWxpemVEeW5hbWljKG5nRHluYW1pY01ldGFkYXRhOiB7IFtrZXk6IHN0cmluZ106IER5bmFtaWNQcm9wTWV0YWRhdGEgfSkge1xyXG4gICAgT2JqZWN0LmtleXMobmdEeW5hbWljTWV0YWRhdGEpLmZvckVhY2gocHJvcGVydHlOYW1lID0+IHtcclxuICAgICAgY29uc3QgZmllbGRNZXRhZGF0YSA9IG5nRHluYW1pY01ldGFkYXRhW3Byb3BlcnR5TmFtZV0gYXMgRHluYW1pY1Byb3BNZXRhZGF0YTtcclxuICAgICAgY29uc3QgcGF0aCA9IHRoaXMuY3JlYXRlUGF0aChwcm9wZXJ0eU5hbWUpO1xyXG4gICAgICBjb25zdCBkYXRhRmllbGQgPSBmaWVsZE1ldGFkYXRhLmRhdGFGaWVsZCB8fCBwcm9wZXJ0eU5hbWU7XHJcblxyXG4gICAgICBjb25zdCBvcmlnaW5hbERhdGEgPSB0aGlzLmRhdGFbZGF0YUZpZWxkXSB8fCB7fTtcclxuXHJcbiAgICAgIGNvbnN0IGNyZWF0ZUVudGl0eUZyb21Kc29uRGF0YSA9ICh2YWx1ZTogYW55KSA9PiB7XHJcbiAgICAgICAgbGV0IGluc3RhbmNlO1xyXG4gICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIGZpZWxkTWV0YWRhdGEudHlwZSkge1xyXG4gICAgICAgICAgaW5zdGFuY2UgPSB2YWx1ZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgaW5zdGFuY2UgPSBFbnRpdHlGYWN0b3J5KGZpZWxkTWV0YWRhdGEudHlwZSwgdmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpbnN0YW5jZVtQQVJFTlRfQ0xBU1NdID0gdGhpcztcclxuICAgICAgICBpbnN0YW5jZVtQQVJFTlRfUEFUSF0gPSBwYXRoO1xyXG5cclxuICAgICAgICBpbnN0YW5jZS5vblZhbHVlQ2hhbmdlZC5zdWJzY3JpYmUoY2hhbmdlcyA9PiB7XHJcbiAgICAgICAgICBpZiAoY2hhbmdlcykge1xyXG4gICAgICAgICAgICBjaGFuZ2VzLnBhdGggPSAodGhpc1tQQVJFTlRfUEFUSF0gfHwgW10pLmNvbmNhdChjaGFuZ2VzLnBhdGgpO1xyXG4gICAgICAgICAgICB0aGlzLnNldENoYW5nZXMoY2hhbmdlcyk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiBpbnN0YW5jZTtcclxuICAgICAgfTtcclxuXHJcbiAgICAgIGxldCBkeW5hbWljRW50aXR5ID0gY3JlYXRlRW50aXR5RnJvbUpzb25EYXRhKG9yaWdpbmFsRGF0YSk7XHJcbiAgICAgIGlmIChkZWxldGUgdGhpc1twcm9wZXJ0eU5hbWVdKSB7XHJcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIHByb3BlcnR5TmFtZSwge1xyXG4gICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBkeW5hbWljRW50aXR5O1xyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vZGlmeUluZm8gPSB7XHJcbiAgICAgICAgICAgICAgcGF0aDogZHluYW1pY0VudGl0eVtQQVJFTlRfUEFUSF0sXHJcbiAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLmRhdGEsXHJcbiAgICAgICAgICAgICAgcHJlVmFsdWU6IHRoaXNbcHJvcGVydHlOYW1lXS5kYXRhLFxyXG4gICAgICAgICAgICAgIHR5cGU6IE1vZGlmeVR5cGUuVmFsdWVDaGFuZ2VcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgZHluYW1pY0VudGl0eSA9IGNyZWF0ZUVudGl0eUZyb21Kc29uRGF0YSh2YWx1ZSk7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0Q2hhbmdlcyhtb2RpZnlJbmZvKTtcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvLyNlbmRyZWdpb25cclxuXHJcblxyXG4gIC8vICNyZWdpb24g5Yqg6L295a6e5L2T5pWw5o2u55u45YWzcHJpdmF0ZeOAgXByb2plY3RlZOaWueazlVxyXG5cclxuICAvKipcclxuICAgKiDliqDovb3nroDljZXlrZfmrrXlgLxcclxuICAgKiBAdG9kbyDkuLTml7bnlKjkv67mlLnnmoTmlrnlvI/mqKHmi59cclxuICAgKi9cclxuICBwcm90ZWN0ZWQgbG9hZEZpZWxkcyhkYXRhOiBhbnkpIHtcclxuICAgIGNvbnN0IG5nRmllbGRzID0gRmllbGRNZXRhZGF0YVV0aWwuZ2V0TmdGaWVsZHModGhpcy5jb25zdHJ1Y3Rvcik7XHJcbiAgICBPYmplY3Qua2V5cyhuZ0ZpZWxkcykuZm9yRWFjaCgocHJvcE5hbWU6IHN0cmluZykgPT4ge1xyXG4gICAgICBjb25zdCBuZ0ZpZWxkID0gbmdGaWVsZHNbcHJvcE5hbWVdO1xyXG4gICAgICBjb25zdCBkYXRhRmllbGQgPSBuZ0ZpZWxkLmRhdGFGaWVsZCB8fCBwcm9wTmFtZTtcclxuICAgICAgLy8gaWYgKG5nRmllbGQucHJpbWFyeSA9PT0gZmFsc2UpIHtcclxuICAgICAgLy8gICB0aGlzW3Byb3BOYW1lXSA9IGRhdGFbZGF0YUZpZWxkXTtcclxuICAgICAgLy8gfVxyXG4gICAgICB0aGlzW3Byb3BOYW1lXSA9IGRhdGFbZGF0YUZpZWxkXTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Yqg6L295a2Q5YiX6KGo5pWw5o2uXHJcbiAgICogQHBhcmFtIGRhdGEg5pWw5o2uXHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIGxvYWRMaXN0cyhkYXRhOiBhbnkpIHtcclxuICAgIGNvbnN0IG5nTGlzdHMgPSBGaWVsZE1ldGFkYXRhVXRpbC5nZXROZ0xpc3QodGhpcy5jb25zdHJ1Y3Rvcik7XHJcbiAgICBPYmplY3Qua2V5cyhuZ0xpc3RzKS5mb3JFYWNoKChwcm9wTmFtZTogc3RyaW5nKSA9PiB7XHJcbiAgICAgIGNvbnN0IG5nTGlzdCA9IG5nTGlzdHNbcHJvcE5hbWVdO1xyXG4gICAgICBjb25zdCBkYXRhRmllbGQgPSBuZ0xpc3QuZGF0YUZpZWxkIHx8IHByb3BOYW1lO1xyXG4gICAgICBjb25zdCBlbnRpdHlUeXBlID0gbmdMaXN0LnR5cGU7XHJcblxyXG4gICAgICAvLyDliJvlu7rlrp7kvZNcclxuICAgICAgY29uc3QgbGlzdERhdGEgPSBkYXRhW2RhdGFGaWVsZF07XHJcbiAgICAgIGlmIChsaXN0RGF0YSkge1xyXG4gICAgICAgIGNvbnN0IGVudGl0aWVzID0gbGlzdERhdGEubWFwKChlbnRpdHlEYXRhOiBhbnkpID0+IHtcclxuICAgICAgICAgIHJldHVybiBFbnRpdHlGYWN0b3J5PHR5cGVvZiBlbnRpdHlUeXBlPihlbnRpdHlUeXBlLCBlbnRpdHlEYXRhKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzW3Byb3BOYW1lXS5sb2FkRW50aXRpZXMoZW50aXRpZXMpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXNbcHJvcE5hbWVdLmxvYWRFbnRpdGllcyhbXSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBsb2FkT2JqZWN0cyhkYXRhOiBhbnkpIHtcclxuICAgIGNvbnN0IG5nT2JqZWN0cyA9IEZpZWxkTWV0YWRhdGFVdGlsLmdldE5nT2JqZWN0cyh0aGlzLmNvbnN0cnVjdG9yKTtcclxuICAgIE9iamVjdC5rZXlzKG5nT2JqZWN0cykuZm9yRWFjaCgocHJvcE5hbWU6IHN0cmluZykgPT4ge1xyXG4gICAgICBjb25zdCBuZ09iamVjdCA9IG5nT2JqZWN0c1twcm9wTmFtZV07XHJcbiAgICAgIGNvbnN0IGRhdGFGaWVsZCA9IG5nT2JqZWN0LmRhdGFGaWVsZCB8fCBwcm9wTmFtZTtcclxuICAgICAgY29uc3Qgb2JqZWN0RGF0YSA9IGRhdGFbZGF0YUZpZWxkXTtcclxuICAgICAgY29uc3QgZW50aXR5ID0gdGhpc1twcm9wTmFtZV0gYXMgRW50aXR5O1xyXG4gICAgICBpZiAoIWVudGl0eSB8fCAhb2JqZWN0RGF0YSkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICBlbnRpdHkubG9hZChvYmplY3REYXRhKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcHJvdGVjdGVkIGxvYWREeW5hbWljT2JqZWN0cyhkYXRhOiBhbnkpIHtcclxuICAgIGNvbnN0IG5nRHluYW1pY09iamVjdHMgPSBGaWVsZE1ldGFkYXRhVXRpbC5nZXROZ0R5bmFtaWModGhpcy5jb25zdHJ1Y3Rvcik7XHJcbiAgICBPYmplY3Qua2V5cyhuZ0R5bmFtaWNPYmplY3RzKS5mb3JFYWNoKChwcm9wTmFtZTogc3RyaW5nKSA9PiB7XHJcbiAgICAgIGNvbnN0IG5nRHluYW1pY09iamVjdCA9IG5nRHluYW1pY09iamVjdHNbcHJvcE5hbWVdO1xyXG4gICAgICBjb25zdCBkYXRhRmllbGQgPSBuZ0R5bmFtaWNPYmplY3QuZGF0YUZpZWxkIHx8IHByb3BOYW1lO1xyXG5cclxuICAgICAgY29uc3QgZHluYW1pY0RhdGEgPSBkYXRhW2RhdGFGaWVsZF0gfHwge307XHJcbiAgICAgIGNvbnN0IGR5bmFtaWNFbnRpdHkgPSB0aGlzW3Byb3BOYW1lXSBhcyBEeW5hbWljO1xyXG4gICAgICBpZiAoIWR5bmFtaWNFbnRpdHkpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgICAgZHluYW1pY0VudGl0eS5sb2FkRHluYW1pY0RhdGEoZHluYW1pY0RhdGEpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvLyAjZW5kcmVnaW9uXHJcblxyXG4gIC8vICNyZWdpb24g56eB5pyJ5bel5YW35pa55rOVXHJcblxyXG5cclxuICAvKipcclxuICAgKiDlj5HpgIHlgLzlj5jmm7RcclxuICAgKi9cclxuICBwcml2YXRlIGVtaXRWYWx1ZUNoYW5nZShwcm9wTmFtZTogc3RyaW5nLCBwcm9wTWV0YWRhdGE6IFByaW1pdGl2ZVByb3BNZXRhZGF0YSwgbmV3UHJvcFZhbHVlOiBhbnksIG9sZFByb3BWYWx1ZTogYW55KTogdm9pZCB7XHJcbiAgICBjb25zdCBjaGFuZ2UgPSB7XHJcbiAgICAgIHBhdGg6IHRoaXMuY3JlYXRlUGF0aChwcm9wTmFtZSksXHJcbiAgICAgIHZhbHVlOiBuZXdQcm9wVmFsdWUsXHJcbiAgICAgIHByZVZhbHVlOiBvbGRQcm9wVmFsdWUsXHJcbiAgICAgIHR5cGU6IE1vZGlmeVR5cGUuVmFsdWVDaGFuZ2VcclxuICAgIH07XHJcblxyXG4gICAgaWYgKHRoaXNbUEFSRU5UX1BBVEhdKSB7XHJcbiAgICAgIGNoYW5nZS5wYXRoID0gdGhpc1tQQVJFTlRfUEFUSF0uY29uY2F0KGNoYW5nZS5wYXRoKTtcclxuICAgIH1cclxuICAgIHRoaXMuc2V0Q2hhbmdlcyhjaGFuZ2UpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+W5bGe5oCn5YC8XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXRQcm9wVmFsdWUocHJvcE5hbWU6IHN0cmluZywgcHJvcE1ldGFkYXRhOiBQcmltaXRpdmVQcm9wTWV0YWRhdGEpIHtcclxuICAgIGNvbnN0IGRhdGFGaWVsZCA9IHByb3BNZXRhZGF0YS5kYXRhRmllbGQgfHwgcHJvcE5hbWU7XHJcbiAgICBjb25zdCB2YWx1ZSA9IHRoaXMuZGF0YVtkYXRhRmllbGRdO1xyXG5cclxuICAgIC8vIOWvueWkmuivreW9leWFpeWtl+aute+8jHF1ZXJ55LiN6L+U5Zue6Zeu6aKY6L+b6KGM5YW85a65XHJcbiAgICBpZiAocHJvcE1ldGFkYXRhLmVuYWJsZU11bHRpTGFuZ0lucHV0ID09PSB0cnVlICYmICF2YWx1ZSkge1xyXG4gICAgICBjb25zdCBsYW5nQ29kZSA9IHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnbGFuZ3VhZ2VDb2RlJykgfHwgJ3poLUNIUyc7XHJcbiAgICAgIGNvbnN0IG9yaWdpbkRhdGFGaWVsZCA9IGRhdGFGaWVsZC5yZXBsYWNlKCdfTVVMVElMQU5HVUFHRScsICcnKTtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBbbGFuZ0NvZGVdOiB0aGlzLmRhdGFbb3JpZ2luRGF0YUZpZWxkXVxyXG4gICAgICB9O1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHZhbHVlO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6K6+572u5bGe5oCn5YC8XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzZXRQcm9wVmFsdWUocHJvcE5hbWU6IHN0cmluZywgcHJvcE1ldGFkYXRhOiBQcmltaXRpdmVQcm9wTWV0YWRhdGEsIHByb3BWYWx1ZTogYW55KSB7XHJcbiAgICBjb25zdCBkYXRhRmllbGQgPSBwcm9wTWV0YWRhdGEuZGF0YUZpZWxkIHx8IHByb3BOYW1lO1xyXG4gICAgdGhpcy5kYXRhW2RhdGFGaWVsZF0gPSBwcm9wVmFsdWU7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmo4Dmn6XlsZ7mgKflgLzmmK/lkKblj5HnlJ/lj5jljJZcclxuICAgKi9cclxuICBwcml2YXRlIGlzUHJvcFZhbHVlQ2hhbmdlZChwcm9wTmFtZTogc3RyaW5nLCBwcm9wTWV0YWRhdGE6IFByaW1pdGl2ZVByb3BNZXRhZGF0YSwgbmV3UHJvcFZhbHVlOiBhbnksIG9sZFByb3BWYWx1ZTogYW55KSB7XHJcbiAgICBpZiAocHJvcE1ldGFkYXRhLmVuYWJsZU11bHRpTGFuZ0lucHV0ID09PSB0cnVlKSB7XHJcbiAgICAgIGlmICh0aGlzLmlzRW1wdHlNdWx0aUxhbmdQcm9wVmFsdWUobmV3UHJvcFZhbHVlKSA9PT0gdHJ1ZSAmJiB0aGlzLmlzRW1wdHlNdWx0aUxhbmdQcm9wVmFsdWUob2xkUHJvcFZhbHVlKSA9PT0gdHJ1ZSkge1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkobmV3UHJvcFZhbHVlKSAhPT0gSlNPTi5zdHJpbmdpZnkob2xkUHJvcFZhbHVlKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiBuZXdQcm9wVmFsdWUgIT09IG9sZFByb3BWYWx1ZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWkmuivreW9leWFpeWtl+auteeahOWAvOaYr+WQpuS4uuepulxyXG4gICAqL1xyXG4gIHByaXZhdGUgaXNFbXB0eU11bHRpTGFuZ1Byb3BWYWx1ZSh2YWx1ZTogYW55KSB7XHJcbiAgICByZXR1cm4gIXZhbHVlIHx8IE9iamVjdC5rZXlzKHZhbHVlKS5sZW5ndGggPT09IDA7XHJcbiAgfVxyXG5cclxuICAvLyAjZW5kcmVnaW9uXHJcbn1cclxuIl19