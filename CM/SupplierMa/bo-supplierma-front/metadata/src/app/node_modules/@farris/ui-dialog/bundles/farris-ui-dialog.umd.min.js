!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("rxjs"),require("rxjs/operators"),require("@angular/common"),require("@angular/core"),require("@farris/ui-perfect-scrollbar"),require("@farris/ui-draggable"),require("@farris/ui-modal")):"function"==typeof define&&define.amd?define("@farris/ui-dialog",["exports","rxjs","rxjs/operators","@angular/common","@angular/core","@farris/ui-perfect-scrollbar","@farris/ui-draggable","@farris/ui-modal"],e):e((t.farris=t.farris||{},t.farris["ui-dialog"]={}),t.rxjs,t.rxjs.operators,t.ng.common,t.ng.core,t.uiPerfectScrollbar,t.uiDraggable,t.uiModal)}(this,function(t,o,e,i,n,h,s,r){"use strict";var a=(l.prototype.hasDialogOpened=function(t){var i=0,e="farris-dialog,.overlay-pane";t&&(e+=","+t);var n=window.document.querySelectorAll(e);return Array.from(n).filter(function(t){return!Array.from(n[0].classList).some(function(t){return"f-combo-list"==t})}).forEach(function(t){var e="";""!==(e="DIV"===t.tagName?window.getComputedStyle(t).display:window.getComputedStyle(t.querySelector("div")).display)&&"block"!==e||i++}),0<i},l.decorators=[{type:n.Injectable}],l);function l(){}var d=(g.prototype.ngOnInit=function(){var t=this;this.hostId="farris-dialog_"+(new Date).getTime(),this.render2.setProperty(this.el.nativeElement,"id",this.hostId),this.beforeOpen||(this.beforeOpen=function(){return!0}),this.beforeClose||(this.beforeClose=function(){return!0}),this.modal.onShown.subscribe(function(){t.opened.emit()}),this.modal.onHidden.subscribe(function(){return t.closed.emit()}),this.checkDialogSize(),setTimeout(function(){t.parentElement?t.parentElement.appendChild(t.el.nativeElement):document.body.appendChild(t.el.nativeElement)},100)},g.prototype.ngOnChanges=function(t){},g.prototype.ngOnDestroy=function(){var t=this;setTimeout(function(){t.destroy(),t.el=null,t.parentElement&&(t.parentElement=null)},150)},g.prototype.ngAfterViewInit=function(){var n=this;if(this.dlgHeaderLineHeight=this.getDialogHeaderLineHeight(),this.dialogHeaderHeight&&(this.modalHeader.nativeElement.style.height=this.dialogHeaderHeight+"px"),this.dialogFooterHeight){var t=this.modalContent.nativeElement.querySelector(".modal-footer");t&&(t.style.height=this.dialogFooterHeight+"px")}this.originalHeight=this.height,this.originalWidth=this.width,this.resetPosition(),this.windowResize$=o.fromEvent(window,"resize").pipe(e.delay(50)).subscribe(function(t){var e=window.innerWidth-20,i=window.innerHeight-20;n.isMax?n.maxDialog():(n.width>e||n.height>i)&&n.maxDialog(),n.isMax=n.isMax&&n.width==e,n.toCenter(0,0)})},g.prototype.toCenter=function(t,e){var i=this.getDlgElement();this.resetPosition(),this.render2.setStyle(i,"transform","translate3d("+t+"px, "+e+"px, 0px)"),this.render2.setStyle(i,"top","50%"),this.render2.setStyle(i,"left","50%"),this.draggbar.position={x:t,y:e},this.draggbar.resetPosition()},g.prototype.destroy=function(){this.parentElement?this.parentElement.querySelector("#"+this.hostId)&&this.parentElement.removeChild(this.el.nativeElement):document.body.querySelector("#"+this.hostId)&&document.body.removeChild(this.el.nativeElement),this.windowResize$&&(this.windowResize$.unsubscribe(),this.windowResize$=null)},g.prototype.getDlgElement=function(){return this.el.nativeElement.querySelector(".modal-dialog")},g.prototype.getDialogHeaderLineHeight=function(){return Math.ceil(this.modalHeader.nativeElement.getBoundingClientRect().height)},g.prototype.getDialogFooterHeight=function(){var t=this.modalContent.nativeElement.querySelector(".modal-footer");return t?Math.ceil(t.getBoundingClientRect().height):0},Object.defineProperty(g.prototype,"size",{get:function(){var t=this.getDialogHeaderLineHeight(),e=this.getDialogFooterHeight(),i=this.height-t;return this.showButtons&&(i-=e),{width:this.width,height:this.height,contentHeight:i,contentWidth:this.width,header:t,footer:e}},enumerable:!0,configurable:!0}),g.prototype._checkDialogSize=function(t,e){var i={width:document.body.offsetWidth,height:window.innerHeight};return this.parentElement&&(i.width=this.parentElement.offsetWidth,i.height=this.parentElement.offsetHeight),i.width&&i.width<t&&(t=i.width),i.height&&i.height<e&&(e=i.height),{width:t,height:e}},g.prototype.checkDialogSize=function(){var t=this._checkDialogSize(this.width,this.height);this.width!==t.width&&(this.width=t.width-20,this.widthChange.emit(this.width)),this.height!==t.height&&(this.height=t.height-20,this.heightChange.emit(this.height))},g.prototype.updateModalBodyHeight=function(){var t=this.el.nativeElement.querySelector(".modal-body"),e=this.size.contentHeight;this.render2.setStyle(t,"height",e+"px")},g.prototype.resetPosition=function(){var t=Number.parseInt(""+-this.width/2)+"px",e=Number.parseInt(""+-this.height/2)+"px",i=this.el.nativeElement.querySelector(".modal-dialog"),n=this.el.nativeElement.querySelector(".modal-body");this.el.nativeElement.querySelector(".modal-footer"),this.render2.setStyle(i,"margin-left",t),this.render2.setStyle(i,"margin-top",e);var o=this.size.contentHeight;this.render2.setStyle(n,"height",o+"px"),this.render2.setStyle(n,"overflow","hidden"),this.render2.setStyle(i,"transform","translate3d(0px, 0px, 0px)")},g.prototype.openDialog=function(t){t&&(this.resetPosition(),this.draggbar.resetPosition(),this.modal.show())},g.prototype.closeDialog=function(t){t&&this.modal.hide()},g.prototype.show=function(){var e=this,t=this.beforeOpen();"boolean"==typeof t?this.openDialog(t):t instanceof o.Observable?t.subscribe(function(t){e.openDialog(t)}):t instanceof Promise&&t.then(function(t){e.openDialog(t)})},g.prototype.close=function(t){var e=this;t&&t.stopPropagation();var i=this.beforeClose();"boolean"==typeof i?this.closeDialog(i):i instanceof o.Observable?i.subscribe(function(t){e.closeDialog(t)}):i instanceof Promise&&i.then(function(t){e.closeDialog(t)})},g.prototype.reSize=function(t){t.width&&(this.width=t.width),t.height&&(this.height=t.height),this.resetPosition(),this.draggbar.resetPosition(),this.widthChange.emit(this.width),this.heightChange.emit(this.height),this.resized.emit({size:{width:this.width,height:this.height}})},g.prototype.onResizing=function(t){t.size.width=t.size.width<100?100:t.size.width,t.size.height=t.size.height<100?100:t.size.height,this.width=t.size.width,this.height=t.size.height,this.resizing.emit(t)},g.prototype.resizeStop=function(t){t.size.width=t.size.width<100?100:t.size.width,t.size.height=t.size.height<100?100:t.size.height,this.width=t.size.width,this.height=t.size.height,this.updateModalBodyHeight(),this.widthChange.emit(this.width),this.heightChange.emit(this.height),this.resized.emit(t)},g.prototype.dropdown=function(t){},g.prototype.maxDialog=function(){if(this.el){this.prevWidth=this.width,this.prevHeight=this.height,this.width=window.innerWidth-20,this.height=window.innerHeight-20,this.draggable=!1,this.resizable=!1;var t=this.el.nativeElement.querySelector(".modal-dialog");this.render2.setStyle(t,"top","50%"),this.render2.setStyle(t,"left","50%"),this.isMax=!0,this.resetPosition(),this.resized.emit({size:{width:this.width,height:this.height}}),this.maxed.emit({size:{width:this.width,height:this.height}})}},g.prototype.revertDialog=function(){this.isMax=!1;var t=window.innerWidth-20,e=window.innerHeight-20;this.width=this.prevWidth==t?this.originalWidth:this.prevWidth,this.height=this.prevHeight==e?this.originalHeight:this.prevHeight,this.width>t&&(this.width=t),this.height>e&&(this.height=e),this.draggable=!0,this.resizable=!0,this.resetPosition(),this.draggbar.resetPosition(),this.resized.emit({size:{width:this.width,height:this.height}}),this.maxed.emit({size:{width:this.width,height:this.height}})},g.prototype.changeDialogSize=function(){this.isMax?this.revertDialog():this.maxDialog()},g.decorators=[{type:n.Component,args:[{selector:"farris-dialog",template:'<div #backdropEl class="modal fade farris-modal" bsModal #staticModal="bs-modal" [config]="{backdrop: \'static\'}"\r\n    tabindex="-1" role="dialog" aria-labelledby="dialog-static-name">\r\n    <div [ngDraggable]="draggable" [ngResizable]="resizable" rzHandles="all" [handle]="header"\r\n        (rzStop)="resizeStop($event)" (rzResizing)="onResizing($event)" (stopped)="dropdown($event)"\r\n        [rzMinWidth]="minWidth" [rzMaxWidth]="maxWidth" [rzMinHeight]="minHeight" [rzMaxHeight]="maxHeight"\r\n        [inBounds]="true" [bounds]="backdropEl" class="modal-dialog" [style.width]="width + \'px\'"\r\n        [style.height]="height + \'px\'">\r\n        <div #modalContent class="modal-content">\r\n            <div #header class="modal-header">\r\n                <div class="modal-title">\r\n                    <span *ngIf="iconCls" [class]="iconCls"></span>\r\n                    <span class="modal-title-label">{{ title }}</span>\r\n                </div>\r\n                <div class="actions">\r\n\r\n                    <ul>\r\n                        <li *ngIf="toolTemplate">\r\n                            <ng-template [ngTemplateOutlet]="toolTemplate">\r\n\r\n                            </ng-template>\r\n                        </li>\r\n                        <li *ngIf="showMinButton" class="f-btn-icon f-bare"><span class="f-icon modal_minimize"></span>\r\n                        </li>\r\n                        <li *ngIf="showMaxButton" (click)="changeDialogSize()" class="f-btn-icon f-bare"><span\r\n                                class="f-icon modal_maximize" [class.modalrevert]="isMax"></span></li>\r\n                        <li *ngIf="showCloseButton" (click)="close($event)" class="f-btn-icon f-bare"><span\r\n                                class="f-icon modal_close"></span></li>\r\n                    </ul>\r\n                </div>\r\n            </div>\r\n            <div class="modal-body">\r\n                <perfect-scrollbar [disabled]="!enableScroll" [config]="scrollConfig">\r\n                    <ng-content></ng-content>\r\n                </perfect-scrollbar>\r\n            </div>\r\n            <div class="modal-footer" *ngIf="showButtons" [style.textAlign]="buttonAlign">\r\n                <ng-container [ngTemplateOutlet]="buttons"></ng-container>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>',styles:[""]}]}],g.ctorParameters=function(){return[{type:n.Renderer2},{type:n.ElementRef}]},g.propDecorators={title:[{type:n.Input}],iconCls:[{type:n.Input}],width:[{type:n.Input}],height:[{type:n.Input}],minWidth:[{type:n.Input}],minHeight:[{type:n.Input}],maxWidth:[{type:n.Input}],maxHeight:[{type:n.Input}],showButtons:[{type:n.Input}],showCloseButton:[{type:n.Input}],showMaxButton:[{type:n.Input}],showMinButton:[{type:n.Input}],resizable:[{type:n.Input}],draggable:[{type:n.Input}],buttonAlign:[{type:n.Input}],scrollConfig:[{type:n.Input}],beforeOpen:[{type:n.Input}],beforeClose:[{type:n.Input}],modal:[{type:n.ViewChild,args:[r.ModalDirective]}],draggbar:[{type:n.ViewChild,args:[s.AngularDraggableDirective]}],opened:[{type:n.Output}],closed:[{type:n.Output}],resized:[{type:n.Output}],resizing:[{type:n.Output}],maxed:[{type:n.Output}],widthChange:[{type:n.Output}],heightChange:[{type:n.Output}],enableScroll:[{type:n.Input}],buttons:[{type:n.Input}],dialogHeaderHeight:[{type:n.Input}],dialogFooterHeight:[{type:n.Input}],parentElement:[{type:n.Input}],toolTemplate:[{type:n.ContentChild,args:["toolTemplate"]}],modalContent:[{type:n.ViewChild,args:["modalContent"]}],modalHeader:[{type:n.ViewChild,args:["header"]}]},g);function g(t,e){this.render2=t,this.el=e,this.title="我是标题",this.iconCls=undefined,this.width=300,this.height=200,this.minWidth=100,this.minHeight=100,this.maxWidth=null,this.maxHeight=null,this.showButtons=!0,this.showCloseButton=!0,this.showMaxButton=!0,this.showMinButton=!1,this.resizable=!0,this.draggable=!0,this.buttonAlign="center",this.scrollConfig={},this.opened=new n.EventEmitter,this.closed=new n.EventEmitter,this.resized=new n.EventEmitter,this.resizing=new n.EventEmitter,this.maxed=new n.EventEmitter,this.widthChange=new n.EventEmitter,this.heightChange=new n.EventEmitter,this.enableScroll=!0,this.dialogHeaderHeight=0,this.dialogFooterHeight=0,this.parentElement=null,this.isMax=!1,this.hostId="",this.windowResize$=null}var p=(u.forRoot=function(){return{ngModule:u,providers:[a]}},u.decorators=[{type:n.NgModule,args:[{declarations:[d],imports:[h.PerfectScrollbarModule,s.AngularDraggableModule,r.ModalModule,i.CommonModule],exports:[d,r.ModalModule]}]}],u);function u(){}t.DialogService=a,t.DialogComponent=d,t.FarrisDialogModule=p,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=farris-ui-dialog.umd.min.js.map