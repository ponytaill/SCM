/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, EventEmitter, Output, ViewChild } from '@angular/core';
import { LocaleService } from '@farris/ui-locale';
import { NumberRangeComponent, NumberSpinnerComponent } from '@farris/ui-number-spinner';
export class PanelFlexibleNumberComponent {
    /**
     * @param {?} localeService
     */
    constructor(localeService) {
        this.localeService = localeService;
        this.searchHandle = new EventEmitter();
        this.submitChange = new EventEmitter();
        this.canNull = true;
    }
    /**
     * @param {?} nr
     * @return {?}
     */
    set item(nr) {
        this._item = nr;
        if (this._item) {
            if (!this._item.hasOwnProperty('value')) {
                this._item.value = {
                    startValue: null,
                    endValue: null,
                    value: null,
                    single: true
                };
            }
            if (!this._item.control.hasOwnProperty('single')) {
                this._item.control.single = true;
            }
            this.beginPlaceHolder = (this._item.hasOwnProperty('beginPlaceHolder') && this._item.beginPlaceHolder) ? this._item.beginPlaceHolder : this.localeService.getValue('filterPanel.beginPlaceHolder');
            this.endPlaceHolder = (this._item.hasOwnProperty('endPlaceHolder') && this._item.beginPlaceHolder) ? this._item.endPlaceHolder : this.localeService.getValue('filterPanel.endPlaceHolder');
            this.placeholder = (this._item.hasOwnProperty('placeHolder') && this._item.placeHolder) ? this._item.placeHolder : '';
            this.single = this._item.control.single;
        }
        this.precision = nr.control.precision;
        this.bigNumber = nr.control.bigNumber;
        if (!this.bigNumber) {
            this.min = -2147483648;
            this.max = 2147483647;
        }
        this.constructMultiFieldNumberRange(nr.value);
        this.numberSubmitChange();
    }
    /**
     * @return {?}
     */
    get item() {
        return this._item;
    }
    /**
     * @return {?}
     */
    ngOnInit() { }
    /**
     * @return {?}
     */
    ngAfterContentInit() {
        this.changeFocus();
    }
    /**
     * @param {?} value
     * @return {?}
     */
    constructMultiFieldNumberRange(value) {
        if (this.single) {
            this.value = value.value == null ? null : value.value;
        }
        else {
            this.beginValue = value.startValue == null ? null : value.startValue;
            this.endValue = value.endValue == null ? null : value.endValue;
        }
    }
    /**
     * @param {?} event
     * @return {?}
     */
    numberChange(event) {
        this._item.value.value = event;
        if (Object.keys(this._item.value).length === 0) {
            this._item.valueText = '';
        }
        else {
            this._item.valueText = '' + this._item.value.value;
        }
        this.searchHandle.emit();
        this.numberSubmitChange();
    }
    /**
     * @param {?} event
     * @return {?}
     */
    beginValueChange(event) {
        this._item.value.startValue = event;
        this.setValueText();
        this.numberSubmitChange();
    }
    /**
     * @param {?} event
     * @return {?}
     */
    endValueChange(event) {
        this._item.value.endValue = event;
        this.setValueText();
        this.numberSubmitChange();
    }
    /**
     * @return {?}
     */
    setValueText() {
        //console.log(this._item.value.startValue,this._item.value.endValue);
        if (Object.keys(this._item.value).length === 0 || (this._item.value.startValue == null && this._item.value.endValue == null)) {
            this._item.valueText = '';
        }
        else if (this._item.value.startValue == null) {
            this._item.valueText = '~' + this._item.value.endValue;
        }
        else if (this._item.value.endValue == null) {
            this._item.valueText = this._item.value.startValue + '~';
        }
        else {
            this._item.valueText = this._item.value.startValue + '~' + this._item.value.endValue;
        }
    }
    /**
     * @return {?}
     */
    numberSubmitChange() {
        /** @type {?} */
        const val = this._item.value;
        if (this.single) {
            if (Object.keys(val).length < 0 || (val.value == null || val.value === '' || val === undefined)) {
                this.submitChange.emit(false);
            }
            else {
                this.submitChange.emit(true);
            }
        }
        else {
            if (Object.keys(val).length === 0 || (val.startValue == null && val.endValue == null)) {
                this.submitChange.emit(false);
            }
            else {
                this.submitChange.emit(true);
            }
        }
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onChange(event) {
        this.single = !event;
        this._item.control.single = this.single;
        this._item.value.single = this.single;
        this.changeFocus();
        this.numberSubmitChange();
    }
    /**
     * @return {?}
     */
    changeFocus() {
        setTimeout((/**
         * @return {?}
         */
        () => {
            if (this.beginNumberText)
                this.beginNumberText.input.nativeElement.focus();
            if (this.numberText)
                this.numberText.input.nativeElement.focus();
        }), 0);
    }
}
PanelFlexibleNumberComponent.decorators = [
    { type: Component, args: [{
                selector: 'panel-filter-flexiblenumber',
                template: "<div class=\"f-panel-filter-tip\">\r\n    <span class=\"panel-filter-tip-text\">{{ 'filterPanel.intervalFilter' | locale }}</span>\r\n    <farris-switch size=\"small\" [checked]=\"!single\" (valueChange)=\"onChange($event)\"></farris-switch>\r\n</div>\r\n<div class=\"f-panel-filter-content\">\r\n    <ng-container *ngIf=\"single; else elseTemplate\">\r\n        <farris-number-spinner\r\n            class=\"f-utils-fill-flex-row\"\r\n            [(ngModel)]=\"value\"\r\n            [canNull]=\"canNull\"\r\n            [precision]=\"precision\"\r\n            [bigNumber]=\"bigNumber\"\r\n            [min]=\"min\" \r\n            [max]=\"max\"\r\n            [placeholder]=\"placeholder\"\r\n            (valueChange)=\"numberChange($event)\"\r\n            #numberText\r\n        ></farris-number-spinner>\r\n    </ng-container>\r\n    <ng-template #elseTemplate>\r\n        <div class=\"d-flex panel-flexible-range-wrapper\">\r\n            <farris-number-spinner\r\n                [(ngModel)]=\"beginValue\"\r\n                [canNull]=\"canNull\"\r\n                [precision]=\"precision\"\r\n                [bigNumber]=\"bigNumber\"\r\n                [min]=\"min\" \r\n                [max]=\"endValue?endValue:max\"\r\n                [placeholder]=\"beginPlaceHolder\"\r\n                (valueChange)=\"beginValueChange($event)\"\r\n                #beginNumberText\r\n            ></farris-number-spinner>\r\n            <span class=\"f-icon f-icon-orientation-arrow\"></span>\r\n            <farris-number-spinner\r\n                [(ngModel)]=\"endValue\"\r\n                [canNull]=\"canNull\"\r\n                [precision]=\"precision\"\r\n                [bigNumber]=\"bigNumber\"\r\n                [min]=\"beginValue?beginValue:min\" \r\n                [max]=\"max\"\r\n                [placeholder]=\"endPlaceHolder\"\r\n                (valueChange)=\"endValueChange($event)\"\r\n            ></farris-number-spinner>\r\n        </div>\r\n    </ng-template>\r\n    \r\n</div>"
            }] }
];
/** @nocollapse */
PanelFlexibleNumberComponent.ctorParameters = () => [
    { type: LocaleService }
];
PanelFlexibleNumberComponent.propDecorators = {
    searchHandle: [{ type: Output, args: ['searchHandle',] }],
    submitChange: [{ type: Output, args: ['submitChange',] }],
    item: [{ type: Input }],
    beginNumberText: [{ type: ViewChild, args: ['beginNumberText',] }],
    numberText: [{ type: ViewChild, args: ['numberText',] }]
};
if (false) {
    /** @type {?} */
    PanelFlexibleNumberComponent.prototype.searchHandle;
    /** @type {?} */
    PanelFlexibleNumberComponent.prototype.submitChange;
    /** @type {?} */
    PanelFlexibleNumberComponent.prototype.canNull;
    /** @type {?} */
    PanelFlexibleNumberComponent.prototype.number;
    /** @type {?} */
    PanelFlexibleNumberComponent.prototype.value;
    /** @type {?} */
    PanelFlexibleNumberComponent.prototype.beginValue;
    /** @type {?} */
    PanelFlexibleNumberComponent.prototype.endValue;
    /** @type {?} */
    PanelFlexibleNumberComponent.prototype.precision;
    /** @type {?} */
    PanelFlexibleNumberComponent.prototype.placeholder;
    /** @type {?} */
    PanelFlexibleNumberComponent.prototype.beginPlaceHolder;
    /** @type {?} */
    PanelFlexibleNumberComponent.prototype.endPlaceHolder;
    /** @type {?} */
    PanelFlexibleNumberComponent.prototype.bigNumber;
    /** @type {?} */
    PanelFlexibleNumberComponent.prototype.max;
    /** @type {?} */
    PanelFlexibleNumberComponent.prototype.min;
    /** @type {?} */
    PanelFlexibleNumberComponent.prototype.single;
    /** @type {?} */
    PanelFlexibleNumberComponent.prototype._item;
    /** @type {?} */
    PanelFlexibleNumberComponent.prototype.numberRange;
    /** @type {?} */
    PanelFlexibleNumberComponent.prototype.beginNumberText;
    /** @type {?} */
    PanelFlexibleNumberComponent.prototype.numberText;
    /**
     * @type {?}
     * @private
     */
    PanelFlexibleNumberComponent.prototype.localeService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmxleGlibGVudW1iZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1maWx0ZXItcGFuZWwvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9mbGV4aWJsZW51bWJlcmNvbXBvbmVudC9mbGV4aWJsZW51bWJlci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFVLFlBQVksRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFtQixNQUFNLGVBQWUsQ0FBQztBQUMzRyxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDbEQsT0FBTyxFQUFFLG9CQUFvQixFQUFFLHNCQUFzQixFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFPekYsTUFBTSxPQUFPLDRCQUE0Qjs7OztJQXVEckMsWUFBb0IsYUFBNEI7UUFBNUIsa0JBQWEsR0FBYixhQUFhLENBQWU7UUFyRHhCLGlCQUFZLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUNsQyxpQkFBWSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFDMUQsWUFBTyxHQUFXLElBQUksQ0FBQztJQW1EMkIsQ0FBQzs7Ozs7SUFsQ25ELElBQ0ksSUFBSSxDQUFDLEVBQU87UUFDWixJQUFJLENBQUMsS0FBSyxHQUFHLEVBQUUsQ0FBQztRQUNoQixJQUFHLElBQUksQ0FBQyxLQUFLLEVBQUM7WUFDVixJQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLEVBQUU7Z0JBQ3BDLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxHQUFHO29CQUNmLFVBQVUsRUFBRyxJQUFJO29CQUNqQixRQUFRLEVBQUcsSUFBSTtvQkFDZixLQUFLLEVBQUUsSUFBSTtvQkFDWCxNQUFNLEVBQUMsSUFBSTtpQkFDZCxDQUFBO2FBQ0o7WUFDRCxJQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxP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QixnREFBYzs7SUFDZCxpREFBa0I7O0lBQ2xCLG1EQUFvQjs7SUFDcEIsd0RBQXdCOztJQUN4QixzREFBc0I7O0lBQ3RCLGlEQUFrQjs7SUFDbEIsMkNBQVc7O0lBQ1gsMkNBQVc7O0lBQ1gsOENBQWU7O0lBRWYsNkNBQVc7O0lBQ1gsbURBQW9COztJQWlDcEIsdURBQW1FOztJQUNuRSxrREFBMkQ7Ozs7O0lBQy9DLHFEQUFvQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQsIE9uSW5pdCwgRXZlbnRFbWl0dGVyLCBPdXRwdXQsIFZpZXdDaGlsZCwgQWZ0ZXJDb250ZW50SW5pdH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IExvY2FsZVNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWxvY2FsZSc7XHJcbmltcG9ydCB7IE51bWJlclJhbmdlQ29tcG9uZW50LCBOdW1iZXJTcGlubmVyQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1udW1iZXItc3Bpbm5lcic7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAncGFuZWwtZmlsdGVyLWZsZXhpYmxlbnVtYmVyJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnLi9mbGV4aWJsZW51bWJlci5jb21wb25lbnQuaHRtbCdcclxufSlcclxuXHJcbmV4cG9ydCBjbGFzcyBQYW5lbEZsZXhpYmxlTnVtYmVyQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBBZnRlckNvbnRlbnRJbml0e1xyXG4gICBcclxuICAgIEBPdXRwdXQoJ3NlYXJjaEhhbmRsZScpIHNlYXJjaEhhbmRsZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIEBPdXRwdXQoJ3N1Ym1pdENoYW5nZScpIHN1Ym1pdENoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIGNhbk51bGw6Ym9vbGVhbiA9IHRydWU7XHJcblxyXG4gICAgbnVtYmVyOnN0cmluZztcclxuICAgIHZhbHVlOiBhbnk7XHJcbiAgICBiZWdpblZhbHVlOiBhbnk7XHJcbiAgICBlbmRWYWx1ZTogYW55O1xyXG4gICAgcHJlY2lzaW9uOiBudW1iZXI7XHJcbiAgICBwbGFjZWhvbGRlcjogc3RyaW5nO1xyXG4gICAgYmVnaW5QbGFjZUhvbGRlcjpzdHJpbmc7XHJcbiAgICBlbmRQbGFjZUhvbGRlcjpzdHJpbmc7XHJcbiAgICBiaWdOdW1iZXI6Ym9vbGVhbjtcclxuICAgIG1heDpudW1iZXI7XHJcbiAgICBtaW46bnVtYmVyO1xyXG4gICAgc2luZ2xlOmJvb2xlYW47XHJcblxyXG4gICAgX2l0ZW06IGFueTtcclxuICAgIG51bWJlclJhbmdlOiBzdHJpbmc7XHJcbiAgICBASW5wdXQoKSBcclxuICAgIHNldCBpdGVtKG5yOiBhbnkpe1xyXG4gICAgICAgIHRoaXMuX2l0ZW0gPSBucjtcclxuICAgICAgICBpZih0aGlzLl9pdGVtKXtcclxuICAgICAgICAgICAgaWYoIXRoaXMuX2l0ZW0uaGFzT3duUHJvcGVydHkoJ3ZhbHVlJykpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2l0ZW0udmFsdWUgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RhcnRWYWx1ZSA6IG51bGwsXHJcbiAgICAgICAgICAgICAgICAgICAgZW5kVmFsdWUgOiBudWxsLFxyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiBudWxsLFxyXG4gICAgICAgICAgICAgICAgICAgIHNpbmdsZTp0cnVlXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYoIXRoaXMuX2l0ZW0uY29udHJvbC5oYXNPd25Qcm9wZXJ0eSgnc2luZ2xlJykpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2l0ZW0uY29udHJvbC5zaW5nbGUgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuYmVnaW5QbGFjZUhvbGRlciA9ICh0aGlzLl9pdGVtLmhhc093blByb3BlcnR5KCdiZWdpblBsYWNlSG9sZGVyJykgJiYgdGhpcy5faXRlbS5iZWdpblBsYWNlSG9sZGVyKSA/IHRoaXMuX2l0ZW0uYmVnaW5QbGFjZUhvbGRlcjogdGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKCdmaWx0ZXJQYW5lbC5iZWdpblBsYWNlSG9sZGVyJyk7XHJcbiAgICAgICAgICAgIHRoaXMuZW5kUGxhY2VIb2xkZXIgPSAodGhpcy5faXRlbS5oYXNPd25Qcm9wZXJ0eSgnZW5kUGxhY2VIb2xkZXInKSAmJiB0aGlzLl9pdGVtLmJlZ2luUGxhY2VIb2xkZXIpID8gdGhpcy5faXRlbS5lbmRQbGFjZUhvbGRlcjogdGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKCdmaWx0ZXJQYW5lbC5lbmRQbGFjZUhvbGRlcicpO1xyXG4gICAgICAgICAgICB0aGlzLnBsYWNlaG9sZGVyID0gKHRoaXMuX2l0ZW0uaGFzT3duUHJvcGVydHkoJ3BsYWNlSG9sZGVyJykgJiYgdGhpcy5faXRlbS5wbGFjZUhvbGRlcikgPyB0aGlzLl9pdGVtLnBsYWNlSG9sZGVyOicnO1xyXG4gICAgICAgICAgICB0aGlzLnNpbmdsZSA9IHRoaXMuX2l0ZW0uY29udHJvbC5zaW5nbGU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMucHJlY2lzaW9uID0gbnIuY29udHJvbC5wcmVjaXNpb247XHJcbiAgICAgICAgdGhpcy5iaWdOdW1iZXIgPSBuci5jb250cm9sLmJpZ051bWJlcjtcclxuICAgICAgICBpZighdGhpcy5iaWdOdW1iZXIpe1xyXG4gICAgICAgICAgICB0aGlzLm1pbiA9IC0yMTQ3NDgzNjQ4O1xyXG4gICAgICAgICAgICB0aGlzLm1heCA9IDIxNDc0ODM2NDdcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jb25zdHJ1Y3RNdWx0aUZpZWxkTnVtYmVyUmFuZ2UobnIudmFsdWUpO1xyXG4gICAgICAgIHRoaXMubnVtYmVyU3VibWl0Q2hhbmdlKCk7XHJcbiAgICB9XHJcbiAgICBnZXQgaXRlbSgpe1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9pdGVtO1xyXG4gICAgfVxyXG4gICAgQFZpZXdDaGlsZCgnYmVnaW5OdW1iZXJUZXh0JykgYmVnaW5OdW1iZXJUZXh0Ok51bWJlclJhbmdlQ29tcG9uZW50O1xyXG4gICAgQFZpZXdDaGlsZCgnbnVtYmVyVGV4dCcpIG51bWJlclRleHQ6TnVtYmVyU3Bpbm5lckNvbXBvbmVudDtcclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgbG9jYWxlU2VydmljZTogTG9jYWxlU2VydmljZSl7fVxyXG5cclxuICAgIG5nT25Jbml0KCk6IHZvaWQgeyB9XHJcbiAgICBuZ0FmdGVyQ29udGVudEluaXQoKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5jaGFuZ2VGb2N1cygpO1xyXG4gICAgfVxyXG4gICAgY29uc3RydWN0TXVsdGlGaWVsZE51bWJlclJhbmdlKHZhbHVlKSB7XHJcbiAgICAgICAgaWYodGhpcy5zaW5nbGUpe1xyXG4gICAgICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWUudmFsdWUgPT0gbnVsbCA/IG51bGwgOiB2YWx1ZS52YWx1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZXtcclxuICAgICAgICAgICAgdGhpcy5iZWdpblZhbHVlID0gdmFsdWUuc3RhcnRWYWx1ZSA9PSBudWxsID8gbnVsbCA6IHZhbHVlLnN0YXJ0VmFsdWU7XHJcbiAgICAgICAgICAgIHRoaXMuZW5kVmFsdWUgPSB2YWx1ZS5lbmRWYWx1ZSA9PSBudWxsID8gbnVsbCA6IHZhbHVlLmVuZFZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIG51bWJlckNoYW5nZShldmVudCl7XHJcbiAgICAgICAgdGhpcy5faXRlbS52YWx1ZS52YWx1ZSA9IGV2ZW50O1xyXG4gICAgICAgIGlmIChPYmplY3Qua2V5cyh0aGlzLl9pdGVtLnZhbHVlKS5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgdGhpcy5faXRlbS52YWx1ZVRleHQgPSAnJ1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNle1xyXG4gICAgICAgICAgICB0aGlzLl9pdGVtLnZhbHVlVGV4dCA9ICcnICsgdGhpcy5faXRlbS52YWx1ZS52YWx1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zZWFyY2hIYW5kbGUuZW1pdCgpO1xyXG4gICAgICAgIHRoaXMubnVtYmVyU3VibWl0Q2hhbmdlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgYmVnaW5WYWx1ZUNoYW5nZShldmVudCkge1xyXG4gICAgICAgIHRoaXMuX2l0ZW0udmFsdWUuc3RhcnRWYWx1ZSA9IGV2ZW50O1xyXG4gICAgICAgIHRoaXMuc2V0VmFsdWVUZXh0KCk7XHJcbiAgICAgICAgdGhpcy5udW1iZXJTdWJtaXRDaGFuZ2UoKTtcclxuICAgIH1cclxuXHJcbiAgICBlbmRWYWx1ZUNoYW5nZShldmVudCkge1xyXG4gICAgICAgIHRoaXMuX2l0ZW0udmFsdWUuZW5kVmFsdWUgPSBldmVudDtcclxuICAgICAgICB0aGlzLnNldFZhbHVlVGV4dCgpO1xyXG4gICAgICAgIHRoaXMubnVtYmVyU3VibWl0Q2hhbmdlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0VmFsdWVUZXh0KCl7XHJcbiAgICAgICAgLy9jb25zb2xlLmxvZyh0aGlzLl9pdGVtLnZhbHVlLnN0YXJ0VmFsdWUsdGhpcy5faXRlbS52YWx1ZS5lbmRWYWx1ZSk7XHJcbiAgICAgICAgaWYgKE9iamVjdC5rZXlzKHRoaXMuX2l0ZW0udmFsdWUpLmxlbmd0aCA9PT0gMCB8fCAodGhpcy5faXRlbS52YWx1ZS5zdGFydFZhbHVlID09IG51bGwgJiYgdGhpcy5faXRlbS52YWx1ZS5lbmRWYWx1ZSA9PSBudWxsKSkge1xyXG4gICAgICAgICAgICB0aGlzLl9pdGVtLnZhbHVlVGV4dCA9ICcnXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYodGhpcy5faXRlbS52YWx1ZS5zdGFydFZhbHVlID09IG51bGwpe1xyXG4gICAgICAgICAgICB0aGlzLl9pdGVtLnZhbHVlVGV4dCA9ICd+JyArIHRoaXMuX2l0ZW0udmFsdWUuZW5kVmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYodGhpcy5faXRlbS52YWx1ZS5lbmRWYWx1ZSA9PSBudWxsKXtcclxuICAgICAgICAgICAgdGhpcy5faXRlbS52YWx1ZVRleHQgPSB0aGlzLl9pdGVtLnZhbHVlLnN0YXJ0VmFsdWUgKyAnfic7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2V7XHJcbiAgICAgICAgICAgIHRoaXMuX2l0ZW0udmFsdWVUZXh0ID0gdGhpcy5faXRlbS52YWx1ZS5zdGFydFZhbHVlICsgJ34nICsgdGhpcy5faXRlbS52YWx1ZS5lbmRWYWx1ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbnVtYmVyU3VibWl0Q2hhbmdlKCl7XHJcbiAgICAgICAgY29uc3QgdmFsID0gdGhpcy5faXRlbS52YWx1ZTtcclxuICAgICAgICBpZih0aGlzLnNpbmdsZSl7XHJcbiAgICAgICAgICAgIGlmIChPYmplY3Qua2V5cyh2YWwpLmxlbmd0aCA8IDAgfHwgKHZhbC52YWx1ZSA9PSBudWxsIHx8IHZhbC52YWx1ZSA9PT0gJycgfHwgdmFsID09PSB1bmRlZmluZWQpKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnN1Ym1pdENoYW5nZS5lbWl0KGZhbHNlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNle1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zdWJtaXRDaGFuZ2UuZW1pdCh0cnVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNle1xyXG4gICAgICAgICAgICBpZiAoT2JqZWN0LmtleXModmFsKS5sZW5ndGggPT09IDAgfHwgKHZhbC5zdGFydFZhbHVlID09IG51bGwgJiYgdmFsLmVuZFZhbHVlID09IG51bGwpKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnN1Ym1pdENoYW5nZS5lbWl0KGZhbHNlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNle1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zdWJtaXRDaGFuZ2UuZW1pdCh0cnVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBvbkNoYW5nZShldmVudCl7XHJcbiAgICAgICAgdGhpcy5zaW5nbGUgPSAhZXZlbnQ7XHJcbiAgICAgICAgdGhpcy5faXRlbS5jb250cm9sLnNpbmdsZSA9IHRoaXMuc2luZ2xlO1xyXG4gICAgICAgIHRoaXMuX2l0ZW0udmFsdWUuc2luZ2xlID0gdGhpcy5zaW5nbGU7XHJcbiAgICAgICAgdGhpcy5jaGFuZ2VGb2N1cygpO1xyXG4gICAgICAgIHRoaXMubnVtYmVyU3VibWl0Q2hhbmdlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgY2hhbmdlRm9jdXMoKXtcclxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgaWYodGhpcy5iZWdpbk51bWJlclRleHQpIHRoaXMuYmVnaW5OdW1iZXJUZXh0LmlucHV0Lm5hdGl2ZUVsZW1lbnQuZm9jdXMoKTtcclxuICAgICAgICAgICAgaWYodGhpcy5udW1iZXJUZXh0KSB0aGlzLm51bWJlclRleHQuaW5wdXQubmF0aXZlRWxlbWVudC5mb2N1cygpO1xyXG4gICAgICAgIH0sIDApO1xyXG4gICAgfVxyXG59Il19