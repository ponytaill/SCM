import { Injectable } from '@angular/core';
import { MetadataUtil } from '../../metadata/index';
import { NG_DECLARATION } from './declaration_decorator';
import { VariableParseService } from '../../variable/index';
import { EventTypeEnum } from './event-type';
class Declaration {
    constructor() {
    }
    /**
     * 初始化
     */
    init(frameComponent) {
        if (!frameComponent) {
            return;
        }
        this.bindDeclaration(frameComponent, null);
    }
    /**
     *  依据定义列表进行初始化
     * @param frameComponent 表单component实例
     * @param ngDeclarations 事件定义列表信息
     */
    initWithDeclarations(frameComponent, ngDeclarations) {
        if (!frameComponent) {
            return;
        }
        this.bindDeclaration(frameComponent, null);
    }
    /**
     * 基于事件元数据构建事件
     * @param context 框架上下文
     */
    bindDeclaration(frameComponent, ngDeclarations) {
        const context = frameComponent.context;
        if (!context) {
            return;
        }
        const ngPublicEventProps = ngDeclarations ? ngDeclarations : this.getNgPublicEvent();
        if (!ngPublicEventProps) {
            return;
        }
        Object.keys(ngPublicEventProps).forEach((propertyName) => {
            const ngExportEvent = ngPublicEventProps[propertyName];
            Object.defineProperty(this, propertyName, {
                value: () => {
                    // 获取命令处理上下文
                    const targetContext = context;
                    // todo: 给ngExportEvent添加frameId（保证框架之间的事件隔离）
                    // if (ngExportEvent.frameId) {
                    //   targetContext = context.appContext.getFrameContext(ngExportEvent.frameId);
                    // }
                    const emitter = ngExportEvent.token;
                    const tokenValue = ngExportEvent.token;
                    const eventName = ngExportEvent.name;
                    let eventArgs = JSON.parse(JSON.stringify(ngExportEvent.params));
                    const eventType = ngExportEvent.type;
                    if (!targetContext.eventBus) {
                        return;
                    }
                    const injector = targetContext.injector;
                    const variableParseService = injector.get(VariableParseService);
                    // 执行参数解析
                    setTimeout(() => {
                        eventArgs = variableParseService.parse(eventArgs, targetContext);
                        const eventSender = targetContext.frameComponent;
                        let currentContext = targetContext;
                        const eventId = new Date().valueOf();
                        if (eventType && eventType === EventTypeEnum.ROUTE) {
                            // 事件依次向上冒泡
                            while (currentContext) {
                                currentContext.eventBus.post(emitter, tokenValue, eventName, eventArgs, eventSender, eventType, eventId);
                                // currentContext = currentContext.parent;
                                currentContext = this.getParentContext(currentContext);
                            }
                        }
                        else {
                            currentContext.eventBus.post(emitter, tokenValue, eventName, eventArgs, eventSender);
                        }
                    }, 0);
                }
            });
        });
    }
    /**
     * 获取事件定义列表
     * @returns  事件定义
     */
    getNgPublicEvent() {
        return MetadataUtil.getPropsMetadatasByName(this.constructor, NG_DECLARATION);
    }
    /**
     * 获取父Context
     * @param context 当前上下文
     */
    getParentContext(context) {
        // 首先查找直接上级FrameContext
        if (context.parent) {
            return context.parent;
        }
        // 到了AppContext边界，返回上级AppContext的根FrameContext
        const parentAppContext = context.appContext.parent;
        if (parentAppContext) {
            return parentAppContext.frameContextManager.getRootFrameContext();
        }
        return null;
    }
}
Declaration.decorators = [
    { type: Injectable }
];
/** @nocollapse */
Declaration.ctorParameters = () => [];
export { Declaration };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVjbGFyYXRpb24uanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2RldmtpdC8iLCJzb3VyY2VzIjpbImxpYi9ldmVudC1tZWNoYW5pc20vZGVjbGFyYXRpb24vZGVjbGFyYXRpb24udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFVBQVUsRUFBWSxNQUFNLGVBQWUsQ0FBQztBQUNyRCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFFcEQsT0FBTyxFQUFFLGNBQWMsRUFBaUIsTUFBTSx5QkFBeUIsQ0FBQztBQUN4RSxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUM1RCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sY0FBYyxDQUFDO0FBRTdDLE1BQ00sV0FBVztJQUVmO0lBRUEsQ0FBQztJQUVEOztPQUVHO0lBQ0ksSUFBSSxDQUFDLGNBQThCO1FBQ3hDLElBQUksQ0FBQyxjQUFjLEVBQUU7WUFDbkIsT0FBTztTQUNSO1FBRUQsSUFBSSxDQUFDLGVBQWUsQ0FBQyxjQUFjLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDN0MsQ0FBQztJQUVEOzs7O09BSUc7SUFDSSxvQkFBb0IsQ0FBQyxjQUE4QixFQUFFLGNBRTNEO1FBQ0MsSUFBSSxDQUFDLGNBQWMsRUFBRTtZQUNuQixPQUFPO1NBQ1I7UUFFRCxJQUFJLENBQUMsZUFBZSxDQUFDLGNBQWMsRUFBRSxJQUFJLENBQUMsQ0FBQztJQUM3QyxDQUFDO0lBRUQ7OztPQUdHO0lBQ0ssZUFBZSxDQUFDLGNBQThCLEVBQUUsY0FFdkQ7UUFDQyxNQUFNLE9BQU8sR0FBRyxjQUFjLENBQUMsT0FBTyxDQUFDO1FBQ3ZDLElBQUksQ0FBQyxPQUFPLEVBQUU7WUFDWixPQUFPO1NBQ1I7UUFFRCxNQUFNLGtCQUFrQixHQUFHLGNBQWMsQ0FBQyxDQUFDLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztR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QixFQUFFLENBQUM7U0FDbkU7UUFFRCxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7OztZQTVIRixVQUFVOzs7O0FBK0hYLE9BQU8sRUFBRSxXQUFXLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIEluamVjdG9yIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IE1ldGFkYXRhVXRpbCB9IGZyb20gJy4uLy4uL21ldGFkYXRhL2luZGV4JztcclxuaW1wb3J0IHsgRnJhbWVDb250ZXh0LCBGcmFtZUNvbXBvbmVudCB9IGZyb20gJy4uLy4uL2ZyYW1lJztcclxuaW1wb3J0IHsgTkdfREVDTEFSQVRJT04sIE5nRGVjbGFyYXRpb24gfSBmcm9tICcuL2RlY2xhcmF0aW9uX2RlY29yYXRvcic7XHJcbmltcG9ydCB7IFZhcmlhYmxlUGFyc2VTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vdmFyaWFibGUvaW5kZXgnO1xyXG5pbXBvcnQgeyBFdmVudFR5cGVFbnVtIH0gZnJvbSAnLi9ldmVudC10eXBlJztcclxuXHJcbkBJbmplY3RhYmxlKClcclxuY2xhc3MgRGVjbGFyYXRpb24ge1xyXG5cclxuICBjb25zdHJ1Y3RvcigpIHtcclxuXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDliJ3lp4vljJZcclxuICAgKi9cclxuICBwdWJsaWMgaW5pdChmcmFtZUNvbXBvbmVudDogRnJhbWVDb21wb25lbnQpIHtcclxuICAgIGlmICghZnJhbWVDb21wb25lbnQpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuYmluZERlY2xhcmF0aW9uKGZyYW1lQ29tcG9uZW50LCBudWxsKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqICDkvp3mja7lrprkuYnliJfooajov5vooYzliJ3lp4vljJZcclxuICAgKiBAcGFyYW0gZnJhbWVDb21wb25lbnQg6KGo5Y2VY29tcG9uZW505a6e5L6LXHJcbiAgICogQHBhcmFtIG5nRGVjbGFyYXRpb25zIOS6i+S7tuWumuS5ieWIl+ihqOS/oeaBr1xyXG4gICAqL1xyXG4gIHB1YmxpYyBpbml0V2l0aERlY2xhcmF0aW9ucyhmcmFtZUNvbXBvbmVudDogRnJhbWVDb21wb25lbnQsIG5nRGVjbGFyYXRpb25zOiB7XHJcbiAgICBbcHJvcE5hbWU6IHN0cmluZ106IGFueTtcclxuICB9KTogdm9pZCB7XHJcbiAgICBpZiAoIWZyYW1lQ29tcG9uZW50KSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmJpbmREZWNsYXJhdGlvbihmcmFtZUNvbXBvbmVudCwgbnVsbCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDln7rkuo7kuovku7blhYPmlbDmja7mnoTlu7rkuovku7ZcclxuICAgKiBAcGFyYW0gY29udGV4dCDmoYbmnrbkuIrkuIvmlodcclxuICAgKi9cclxuICBwcml2YXRlIGJpbmREZWNsYXJhdGlvbihmcmFtZUNvbXBvbmVudDogRnJhbWVDb21wb25lbnQsIG5nRGVjbGFyYXRpb25zOiB7XHJcbiAgICBbcHJvcE5hbWU6IHN0cmluZ106IGFueTtcclxuICB9KSB7XHJcbiAgICBjb25zdCBjb250ZXh0ID0gZnJhbWVDb21wb25lbnQuY29udGV4dDtcclxuICAgIGlmICghY29udGV4dCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgbmdQdWJsaWNFdmVudFByb3BzID0gbmdEZWNsYXJhdGlvbnMgPyBuZ0RlY2xhcmF0aW9ucyA6IHRoaXMuZ2V0TmdQdWJsaWNFdmVudCgpO1xyXG4gICAgaWYgKCFuZ1B1YmxpY0V2ZW50UHJvcHMpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIE9iamVjdC5rZXlzKG5nUHVibGljRXZlbnRQcm9wcykuZm9yRWFjaCgocHJvcGVydHlOYW1lOiBzdHJpbmcpID0+IHtcclxuICAgICAgY29uc3QgbmdFeHBvcnRFdmVudDogTmdEZWNsYXJhdGlvbiA9IG5nUHVibGljRXZlbnRQcm9wc1twcm9wZXJ0eU5hbWVdO1xyXG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgcHJvcGVydHlOYW1lLCB7XHJcbiAgICAgICAgdmFsdWU6ICgpID0+IHtcclxuXHJcbiAgICAgICAgICAvLyDojrflj5blkb3ku6TlpITnkIbkuIrkuIvmlodcclxuICAgICAgICAgIGNvbnN0IHRhcmdldENvbnRleHQ6IEZyYW1lQ29udGV4dCA9IGNvbnRleHQ7XHJcblxyXG4gICAgICAgICAgLy8gdG9kbzog57uZbmdFeHBvcnRFdmVudOa3u+WKoGZyYW1lSWTvvIjkv53or4HmoYbmnrbkuYvpl7TnmoTkuovku7bpmpTnprvvvIlcclxuICAgICAgICAgIC8vIGlmIChuZ0V4cG9ydEV2ZW50LmZyYW1lSWQpIHtcclxuICAgICAgICAgIC8vICAgdGFyZ2V0Q29udGV4dCA9IGNvbnRleHQuYXBwQ29udGV4dC5nZXRGcmFtZUNvbnRleHQobmdFeHBvcnRFdmVudC5mcmFtZUlkKTtcclxuICAgICAgICAgIC8vIH1cclxuXHJcbiAgICAgICAgICBjb25zdCBlbWl0dGVyID0gbmdFeHBvcnRFdmVudC50b2tlbjtcclxuICAgICAgICAgIGNvbnN0IHRva2VuVmFsdWUgPSBuZ0V4cG9ydEV2ZW50LnRva2VuO1xyXG4gICAgICAgICAgY29uc3QgZXZlbnROYW1lID0gbmdFeHBvcnRFdmVudC5uYW1lO1xyXG4gICAgICAgICAgbGV0IGV2ZW50QXJncyA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkobmdFeHBvcnRFdmVudC5wYXJhbXMpKTtcclxuICAgICAgICAgIGNvbnN0IGV2ZW50VHlwZSA9IG5nRXhwb3J0RXZlbnQudHlwZTtcclxuXHJcbiAgICAgICAgICBpZiAoIXRhcmdldENvbnRleHQuZXZlbnRCdXMpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgY29uc3QgaW5qZWN0b3IgPSB0YXJnZXRDb250ZXh0LmluamVjdG9yO1xyXG4gICAgICAgICAgY29uc3QgdmFyaWFibGVQYXJzZVNlcnZpY2UgPSBpbmplY3Rvci5nZXQ8VmFyaWFibGVQYXJzZVNlcnZpY2U+KFZhcmlhYmxlUGFyc2VTZXJ2aWNlKTtcclxuXHJcbiAgICAgICAgICAvLyDmiafooYzlj4LmlbDop6PmnpBcclxuICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICBldmVudEFyZ3MgPSB2YXJpYWJsZVBhcnNlU2VydmljZS5wYXJzZShldmVudEFyZ3MsIHRhcmdldENvbnRleHQpO1xyXG4gICAgICAgICAgICBjb25zdCBldmVudFNlbmRlciA9IHRhcmdldENvbnRleHQuZnJhbWVDb21wb25lbnQ7XHJcbiAgICAgICAgICAgIGxldCBjdXJyZW50Q29udGV4dCA9IHRhcmdldENvbnRleHQ7XHJcbiAgICAgICAgICAgIGNvbnN0IGV2ZW50SWQgPSBuZXcgRGF0ZSgpLnZhbHVlT2YoKTtcclxuICAgICAgICAgICAgaWYgKGV2ZW50VHlwZSAmJiBldmVudFR5cGUgPT09IEV2ZW50VHlwZUVudW0uUk9VVEUpIHtcclxuICAgICAgICAgICAgICAvLyDkuovku7bkvp3mrKHlkJHkuIrlhpLms6FcclxuICAgICAgICAgICAgICB3aGlsZSAoY3VycmVudENvbnRleHQpIHtcclxuICAgICAgICAgICAgICAgIGN1cnJlbnRDb250ZXh0LmV2ZW50QnVzLnBvc3QoZW1pdHRlciwgdG9rZW5WYWx1ZSwgZXZlbnROYW1lLCBldmVudEFyZ3MsIGV2ZW50U2VuZGVyLCBldmVudFR5cGUsIGV2ZW50SWQpO1xyXG4gICAgICAgICAgICAgICAgLy8gY3VycmVudENvbnRleHQgPSBjdXJyZW50Q29udGV4dC5wYXJlbnQ7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50Q29udGV4dCA9IHRoaXMuZ2V0UGFyZW50Q29udGV4dChjdXJyZW50Q29udGV4dCk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgIGN1cnJlbnRDb250ZXh0LmV2ZW50QnVzLnBvc3QoZW1pdHRlciwgdG9rZW5WYWx1ZSwgZXZlbnROYW1lLCBldmVudEFyZ3MsIGV2ZW50U2VuZGVyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSwgMCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluS6i+S7tuWumuS5ieWIl+ihqFxyXG4gICAqIEByZXR1cm5zICDkuovku7blrprkuYlcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0TmdQdWJsaWNFdmVudCgpIHtcclxuICAgIHJldHVybiBNZXRhZGF0YVV0aWwuZ2V0UHJvcHNNZXRhZGF0YXNCeU5hbWUodGhpcy5jb25zdHJ1Y3RvciwgTkdfREVDTEFSQVRJT04pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+W54i2Q29udGV4dFxyXG4gICAqIEBwYXJhbSBjb250ZXh0IOW9k+WJjeS4iuS4i+aWh1xyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0UGFyZW50Q29udGV4dChjb250ZXh0OiBGcmFtZUNvbnRleHQpOiBGcmFtZUNvbnRleHQge1xyXG5cclxuICAgIC8vIOmmluWFiOafpeaJvuebtOaOpeS4iue6p0ZyYW1lQ29udGV4dFxyXG4gICAgaWYgKGNvbnRleHQucGFyZW50KSB7XHJcbiAgICAgIHJldHVybiBjb250ZXh0LnBhcmVudDtcclxuICAgIH1cclxuXHJcbiAgICAvLyDliLDkuoZBcHBDb250ZXh06L6555WM77yM6L+U5Zue5LiK57qnQXBwQ29udGV4dOeahOaguUZyYW1lQ29udGV4dFxyXG4gICAgY29uc3QgcGFyZW50QXBwQ29udGV4dCA9IGNvbnRleHQuYXBwQ29udGV4dC5wYXJlbnQ7XHJcbiAgICBpZiAocGFyZW50QXBwQ29udGV4dCkge1xyXG4gICAgICByZXR1cm4gcGFyZW50QXBwQ29udGV4dC5mcmFtZUNvbnRleHRNYW5hZ2VyLmdldFJvb3RGcmFtZUNvbnRleHQoKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCB7IERlY2xhcmF0aW9uIH07XHJcbiJdfQ==