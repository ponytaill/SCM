import { Inject, Injectable, Injector, LOCALE_ID, Optional } from "@angular/core";
import { map } from "rxjs/operators";
import { FeatureRepository } from "./feature-repository";
import { Prop } from "./types";
var FeatureDataService = /** @class */ (function () {
    function FeatureDataService(injector, repository, localeId) {
        this.injector = injector;
        this.repository = repository;
        this.localeId = localeId;
        this.localeId = this.localeId || 'zh-CHS';
    }
    /**
     * 根据物料id获取物料特征项及特征值（公共默认值）
     * @param materialId 物料id
     */
    FeatureDataService.prototype.getFeaturesByMaterialId = function (materialId) {
        var _this = this;
        return this.repository.getFeaturesByMaterialId(materialId).pipe(map(function (response) {
            if (!response || !response.returnValue) {
                return null;
            }
            var returnValue = JSON.parse(response.returnValue);
            var result = { propset: [], props: [] };
            var propsets = returnValue.propset || null;
            var props = returnValue.props || null;
            if (propsets && Array.isArray(propsets)) {
                propsets.map(function (propset) {
                    propset.name = _this.translateName(propset);
                    return propset;
                });
                result.propset = propsets;
            }
            if (props && Array.isArray(props) && props.length > 0) {
                props.map(function (prop) {
                    // 处理多语
                    prop.name = _this.translateName(prop);
                    // 处理枚举
                    if (prop.inputtype === Prop.InputType.enum && prop.enuminfo) {
                        prop.data = JSON.parse(prop.enuminfo);
                    }
                    // 处理必填和只读
                    prop.isreadonly = prop.isreadonly === '1' ? true : false;
                    prop.isrequired = prop.isrequired === '1' ? true : false;
                    return prop;
                });
                result.props = props;
            }
            return result;
        }));
    };
    /**
     * 根据物料id及物料特征保存后的hash获取该物料已经存储的特征项值
     * @param materialId 物料Id
     * @param configID 对应该物料的特征项hash
     * @returns
     */
    FeatureDataService.prototype.getConfigedValueByFeatureId = function (materialId, configID, configType) {
        if (configType === void 0) { configType = 'Materials'; }
        return this.repository.getConfigedValueByFeatureId(materialId, configID, configType).pipe(map(function (result) {
            return JSON.parse(result);
        }));
    };
    /**
     * 保存物料特征项
     * @param materialId 物料id
     * @param charactValue 特征值
     * @param configType 配置类型
     * @returns
     */
    FeatureDataService.prototype.applyFeatures = function (materialId, charactValue, configType) {
        if (configType === void 0) { configType = 'Materials'; }
        return this.repository.applyFeatures(materialId, charactValue, configType).pipe(map(function (config) {
            return JSON.parse(config);
        }));
    };
    /**
     * 获取帮助信息
     * @param helpid 帮助id
     * @param filter 过滤条件
     * @param params 参数
     * @returns
     */
    FeatureDataService.prototype.getHelpInfo = function (helpid, filter, params) {
        var url = '/api/scm/scmfnd/v1.0/scmcommoncmpservice/service/gethelpdata';
        var httpParams = {};
        if (params) {
            if (params.pageIndex) {
                httpParams['pageIndex'] = JSON.stringify(params.pageIndex - 0);
            }
            if (params.pageSize) {
                httpParams['pageSize'] = JSON.stringify(params.pageSize - 0);
            }
            if (params.condition) {
                httpParams['condition'] = JSON.stringify(params.condition);
            }
            if (params.searchValue) {
                httpParams['search'] = params.searchValue;
            }
        }
        var body = {
            helpID: helpid,
            queryParam: JSON.stringify(httpParams),
            filterStr: filter
        };
        var befRepository = null; //this.repository as BefRepository<any>;
        var options = {
            body: body
        };
        return befRepository.proxy.request(url, 'put', null, options).pipe(map(function (result) { return JSON.parse(result); }));
    };
    /**
     * 国际化特征项或特征集名称
     * @param object 特征集或特征项对象
     * @returns
     */
    FeatureDataService.prototype.translateName = function (object) {
        if (!object) {
            return null;
        }
        var name = null;
        switch (this.localeId) {
            case 'en':
                {
                    name = object['name_en'];
                }
                break;
            case 'zh-CHS':
                {
                    name = object['name_chs'];
                }
                break;
            case 'zh-CHT':
                {
                    name = object['name_cht'];
                }
                break;
            default: name = object['name_chs'];
        }
        return name;
    };
    FeatureDataService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    FeatureDataService.ctorParameters = function () { return [
        { type: Injector },
        { type: FeatureRepository },
        { type: String, decorators: [{ type: Optional }, { type: Inject, args: [LOCALE_ID,] }] }
    ]; };
    return FeatureDataService;
}());
export { FeatureDataService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmVhdHVyZS1kYXRhLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2NvbW1hbmQtc2VydmljZXMvIiwic291cmNlcyI6WyJsaWIvZmVhdHVyZS1lZGl0L2ZlYXR1cmUtZGF0YS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxTQUFTLEVBQUUsUUFBUSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBSWxGLE9BQU8sRUFBRSxHQUFHLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNyQyxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUN6RCxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sU0FBUyxDQUFDO0FBRS9CO0lBRUUsNEJBQ1UsUUFBa0IsRUFDbEIsVUFBNkIsRUFDRSxRQUFpQjtRQUZoRCxhQUFRLEdBQVIsUUFBUSxDQUFVO1FBQ2xCLGVBQVUsR0FBVixVQUFVLENBQW1CO1FBQ0UsYUFBUSxHQUFSLFFBQVEsQ0FBUztRQUV4RCxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxRQUFRLElBQUksUUFBUSxDQUFDO0lBQzVDLENBQUM7SUFDRDs7O09BR0c7SUFDSSxvREFBdUIsR0FBOUIsVUFBK0IsVUFBa0I7UUFBakQsaUJBbUNDO1FBbENDLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyx1QkFBdUIsQ0FBQyxVQUFVLENBQUMsQ0FBQyxJQUFJLENBQzdELEdBQUcsQ0FBQyxVQUFDLFFBQXNCO1lBQ3pCLElBQUksQ0FBQyxRQUFRLElBQUksQ0FBQyxRQUFRLENBQUMsV0FBVyxFQUFFO2dCQUN0QyxPQUFPLElBQUksQ0FBQzthQUNiO1lBQ0QsSUFBTSxXQUFXLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLENBQUM7WUFDckQsSUFBTSxNQUFNLEdBQXNCLEVBQUUsT0FBTyxFQUFFLEVBQUUs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QUMsTUFBTSxFQUFFO1lBQ1gsT0FBTyxJQUFJLENBQUM7U0FDYjtRQUNELElBQUksSUFBSSxHQUFHLElBQUksQ0FBQztRQUNoQixRQUFRLElBQUksQ0FBQyxRQUFRLEVBQUU7WUFDckIsS0FBSyxJQUFJO2dCQUFFO29CQUNULElBQUksR0FBRyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUM7aUJBQzFCO2dCQUFDLE1BQU07WUFDUixLQUFLLFFBQVE7Z0JBQUU7b0JBQ2IsSUFBSSxHQUFHLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQztpQkFDM0I7Z0JBQUMsTUFBTTtZQUNSLEtBQUssUUFBUTtnQkFBRTtvQkFDYixJQUFJLEdBQUcsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDO2lCQUMzQjtnQkFBQyxNQUFNO1lBQ1IsT0FBTyxDQUFDLENBQUMsSUFBSSxHQUFHLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQztTQUNwQztRQUNELE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQzs7Z0JBcElGLFVBQVU7Ozs7Z0JBUmtCLFFBQVE7Z0JBSzVCLGlCQUFpQjs2Q0FRckIsUUFBUSxZQUFJLE1BQU0sU0FBQyxTQUFTOztJQWdJakMseUJBQUM7Q0FBQSxBQXJJRCxJQXFJQztTQXBJWSxrQkFBa0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3QsIEluamVjdGFibGUsIEluamVjdG9yLCBMT0NBTEVfSUQsIE9wdGlvbmFsIH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcbmltcG9ydCB7IEJlZlJlcG9zaXRvcnksIFJlc3BvbnNlSW5mbyB9IGZyb20gXCJAZmFycmlzL2JlZlwiO1xuaW1wb3J0IHsgRnJhbWVDb250ZXh0LCBSZXN0ZnVsU2VydmljZSwgUmVwb3NpdG9yeSB9IGZyb20gJ0BmYXJyaXMvZGV2a2l0JztcbmltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tIFwicnhqc1wiO1xuaW1wb3J0IHsgbWFwIH0gZnJvbSBcInJ4anMvb3BlcmF0b3JzXCI7XG5pbXBvcnQgeyBGZWF0dXJlUmVwb3NpdG9yeSB9IGZyb20gXCIuL2ZlYXR1cmUtcmVwb3NpdG9yeVwiO1xuaW1wb3J0IHsgUHJvcCB9IGZyb20gXCIuL3R5cGVzXCI7XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBGZWF0dXJlRGF0YVNlcnZpY2Uge1xuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGluamVjdG9yOiBJbmplY3RvcixcbiAgICBwcml2YXRlIHJlcG9zaXRvcnk6IEZlYXR1cmVSZXBvc2l0b3J5LFxuICAgIEBPcHRpb25hbCgpIEBJbmplY3QoTE9DQUxFX0lEKSBwcml2YXRlIGxvY2FsZUlkPzogc3RyaW5nXG4gICkge1xuICAgIHRoaXMubG9jYWxlSWQgPSB0aGlzLmxvY2FsZUlkIHx8ICd6aC1DSFMnO1xuICB9XG4gIC8qKlxuICAgKiDmoLnmja7nianmlplpZOiOt+WPlueJqeaWmeeJueW+gemhueWPiueJueW+geWAvO+8iOWFrOWFsem7mOiupOWAvO+8iVxuICAgKiBAcGFyYW0gbWF0ZXJpYWxJZCDnianmlplpZFxuICAgKi9cbiAgcHVibGljIGdldEZlYXR1cmVzQnlNYXRlcmlhbElkKG1hdGVyaWFsSWQ6IHN0cmluZyk6IE9ic2VydmFibGU8UHJvcC5JUmV0dXJuVmFsdWU+IHtcbiAgICByZXR1cm4gdGhpcy5yZXBvc2l0b3J5LmdldEZlYXR1cmVzQnlNYXRlcmlhbElkKG1hdGVyaWFsSWQpLnBpcGUoXG4gICAgICBtYXAoKHJlc3BvbnNlOiBSZXNwb25zZUluZm8pID0+IHtcbiAgICAgICAgaWYgKCFyZXNwb25zZSB8fCAhcmVzcG9uc2UucmV0dXJuVmFsdWUpIHtcbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCByZXR1cm5WYWx1ZSA9IEpTT04ucGFyc2UocmVzcG9uc2UucmV0dXJuVmFsdWUpO1xuICAgICAgICBjb25zdCByZXN1bHQ6IFByb3AuSVJldHVyblZhbHVlID0geyBwcm9wc2V0OiBbXSwgcHJvcHM6IFtdIH07XG4gICAgICAgIGNvbnN0IHByb3BzZXRzID0gcmV0dXJuVmFsdWUucHJvcHNldCB8fCBudWxsO1xuICAgICAgICBjb25zdCBwcm9wcyA9IHJldHVyblZhbHVlLnByb3BzIHx8IG51bGw7XG4gICAgICAgIGlmIChwcm9wc2V0cyAmJiBBcnJheS5pc0FycmF5KHByb3BzZXRzKSkge1xuICAgICAgICAgIHByb3BzZXRzLm1hcCgocHJvcHNldDogUHJvcC5JUHJvcFNldCkgPT4ge1xuICAgICAgICAgICAgcHJvcHNldC5uYW1lID0gdGhpcy50cmFuc2xhdGVOYW1lKHByb3BzZXQpO1xuICAgICAgICAgICAgcmV0dXJuIHByb3BzZXQ7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmVzdWx0LnByb3BzZXQgPSBwcm9wc2V0cztcbiAgICAgICAgfVxuICAgICAgICBpZiAocHJvcHMgJiYgQXJyYXkuaXNBcnJheShwcm9wcykgJiYgcHJvcHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHByb3BzLm1hcCgocHJvcDogUHJvcC5JUHJvcCkgPT4ge1xuICAgICAgICAgICAgLy8g5aSE55CG5aSa6K+tXG4gICAgICAgICAgICBwcm9wLm5hbWUgPSB0aGlzLnRyYW5zbGF0ZU5hbWUocHJvcCk7XG4gICAgICAgICAgICAvLyDlpITnkIbmnprkuL5cbiAgICAgICAgICAgIGlmIChwcm9wLmlucHV0dHlwZSA9PT0gUHJvcC5JbnB1dFR5cGUuZW51bSAmJiBwcm9wLmVudW1pbmZvKSB7XG4gICAgICAgICAgICAgIHByb3AuZGF0YSA9IEpTT04ucGFyc2UocHJvcC5lbnVtaW5mbyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyDlpITnkIblv4Xloavlkozlj6ror7tcbiAgICAgICAgICAgIHByb3AuaXNyZWFkb25seSA9IHByb3AuaXNyZWFkb25seSA9PT0gJzEnID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgICAgICAgcHJvcC5pc3JlcXVpcmVkID0gcHJvcC5pc3JlcXVpcmVkID09PSAnMScgPyB0cnVlIDogZmFsc2U7XG4gICAgICAgICAgICByZXR1cm4gcHJvcDtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICByZXN1bHQucHJvcHMgPSBwcm9wcztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfSlcbiAgICApO1xuICB9XG4gIC8qKlxuICAgKiDmoLnmja7nianmlplpZOWPiueJqeaWmeeJueW+geS/neWtmOWQjueahGhhc2jojrflj5bor6Xnianmlpnlt7Lnu4/lrZjlgqjnmoTnibnlvoHpobnlgLxcbiAgICogQHBhcmFtIG1hdGVyaWFsSWQg54mp5paZSWRcbiAgICogQHBhcmFtIGNvbmZpZ0lEIOWvueW6lOivpeeJqeaWmeeahOeJueW+gemhuWhhc2hcbiAgICogQHJldHVybnMgXG4gICAqL1xuICBwdWJsaWMgZ2V0Q29uZmlnZWRWYWx1ZUJ5RmVhdHVyZUlkKG1hdGVyaWFsSWQ6IHN0cmluZywgY29uZmlnSUQ6IHN0cmluZywgY29uZmlnVHlwZTogc3RyaW5nID0gJ01hdGVyaWFscycpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgIHJldHVybiB0aGlzLnJlcG9zaXRvcnkuZ2V0Q29uZmlnZWRWYWx1ZUJ5RmVhdHVyZUlkKG1hdGVyaWFsSWQsIGNvbmZpZ0lELCBjb25maWdUeXBlKS5waXBlKG1hcCgocmVzdWx0OiBhbnkpID0+IHtcbiAgICAgIHJldHVybiBKU09OLnBhcnNlKHJlc3VsdCk7XG4gICAgfSkpO1xuICB9XG4gIC8qKlxuICAgKiDkv53lrZjnianmlpnnibnlvoHpoblcbiAgICogQHBhcmFtIG1hdGVyaWFsSWQg54mp5paZaWRcbiAgICogQHBhcmFtIGNoYXJhY3RWYWx1ZSDnibnlvoHlgLxcbiAgICogQHBhcmFtIGNvbmZpZ1R5cGUg6YWN572u57G75Z6LXG4gICAqIEByZXR1cm5zIFxuICAgKi9cbiAgcHVibGljIGFwcGx5RmVhdHVyZXMobWF0ZXJpYWxJZDogc3RyaW5nLCBjaGFyYWN0VmFsdWU6IGFueSwgY29uZmlnVHlwZTogc3RyaW5nID0gJ01hdGVyaWFscycpIHtcbiAgICByZXR1cm4gdGhpcy5yZXBvc2l0b3J5LmFwcGx5RmVhdHVyZXMobWF0ZXJpYWxJZCwgY2hhcmFjdFZhbHVlLCBjb25maWdUeXBlKS5waXBlKG1hcCgoY29uZmlnOiBhbnkpID0+IHtcbiAgICAgIHJldHVybiBKU09OLnBhcnNlKGNvbmZpZyk7XG4gICAgfSkpO1xuICB9XG4gIC8qKlxuICAgKiDojrflj5bluK7liqnkv6Hmga9cbiAgICogQHBhcmFtIGhlbHBpZCDluK7liqlpZFxuICAgKiBAcGFyYW0gZmlsdGVyIOi/h+a7pOadoeS7tlxuICAgKiBAcGFyYW0gcGFyYW1zIOWPguaVsFxuICAgKiBAcmV0dXJucyBcbiAgICovXG4gIHB1YmxpYyBnZXRIZWxwSW5mbyhoZWxwaWQ6IHN0cmluZywgZmlsdGVyOiBzdHJpbmcsIHBhcmFtczogYW55KTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICBjb25zdCB1cmwgPSAnL2FwaS9zY20vc2NtZm5kL3YxLjAvc2NtY29tbW9uY21wc2VydmljZS9zZXJ2aWNlL2dldGhlbHBkYXRhJztcbiAgICBjb25zdCBodHRwUGFyYW1zOiBhbnkgPSB7fTtcbiAgICBpZiAocGFyYW1zKSB7XG4gICAgICBpZiAocGFyYW1zLnBhZ2VJbmRleCkge1xuICAgICAgICBodHRwUGFyYW1zWydwYWdlSW5kZXgnXSA9IEpTT04uc3RyaW5naWZ5KHBhcmFtcy5wYWdlSW5kZXggLSAwKTtcbiAgICAgIH1cbiAgICAgIGlmIChwYXJhbXMucGFnZVNpemUpIHtcbiAgICAgICAgaHR0cFBhcmFtc1sncGFnZVNpemUnXSA9IEpTT04uc3RyaW5naWZ5KHBhcmFtcy5wYWdlU2l6ZSAtIDApO1xuICAgICAgfVxuICAgICAgaWYgKHBhcmFtcy5jb25kaXRpb24pIHtcbiAgICAgICAgaHR0cFBhcmFtc1snY29uZGl0aW9uJ10gPSBKU09OLnN0cmluZ2lmeShwYXJhbXMuY29uZGl0aW9uKTtcbiAgICAgIH1cbiAgICAgIGlmIChwYXJhbXMuc2VhcmNoVmFsdWUpIHtcbiAgICAgICAgaHR0cFBhcmFtc1snc2VhcmNoJ10gPSBwYXJhbXMuc2VhcmNoVmFsdWU7XG4gICAgICB9XG4gICAgfVxuICAgIGNvbnN0IGJvZHkgPSB7XG4gICAgICBoZWxwSUQ6IGhlbHBpZCxcbiAgICAgIHF1ZXJ5UGFyYW06IEpTT04uc3RyaW5naWZ5KGh0dHBQYXJhbXMpLFxuICAgICAgZmlsdGVyU3RyOiBmaWx0ZXJcbiAgICB9O1xuICAgIGNvbnN0IGJlZlJlcG9zaXRvcnk6IEJlZlJlcG9zaXRvcnk8YW55PiA9IG51bGw7Ly90aGlzLnJlcG9zaXRvcnkgYXMgQmVmUmVwb3NpdG9yeTxhbnk+O1xuICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICBib2R5XG4gICAgfTtcbiAgICByZXR1cm4gYmVmUmVwb3NpdG9yeS5wcm94eS5yZXF1ZXN0KHVybCwgJ3B1dCcsIG51bGwsIG9wdGlvbnMpLnBpcGUoXG4gICAgICBtYXAoKHJlc3VsdDogYW55KSA9PiBKU09OLnBhcnNlKHJlc3VsdCkpXG4gICAgKTtcbiAgfVxuICAvKipcbiAgICog5Zu96ZmF5YyW54m55b6B6aG55oiW54m55b6B6ZuG5ZCN56ewXG4gICAqIEBwYXJhbSBvYmplY3Qg54m55b6B6ZuG5oiW54m55b6B6aG55a+56LGhXG4gICAqIEByZXR1cm5zIFxuICAgKi9cbiAgcHJpdmF0ZSB0cmFuc2xhdGVOYW1lKG9iamVjdDogUHJvcC5JUHJvcFNldCB8IFByb3AuSVByb3ApOiBzdHJpbmcge1xuICAgIGlmICghb2JqZWN0KSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgbGV0IG5hbWUgPSBudWxsO1xuICAgIHN3aXRjaCAodGhpcy5sb2NhbGVJZCkge1xuICAgICAgY2FzZSAnZW4nOiB7XG4gICAgICAgIG5hbWUgPSBvYmplY3RbJ25hbWVfZW4nXTtcbiAgICAgIH0gYnJlYWs7XG4gICAgICBjYXNlICd6aC1DSFMnOiB7XG4gICAgICAgIG5hbWUgPSBvYmplY3RbJ25hbWVfY2hzJ107XG4gICAgICB9IGJyZWFrO1xuICAgICAgY2FzZSAnemgtQ0hUJzoge1xuICAgICAgICBuYW1lID0gb2JqZWN0WyduYW1lX2NodCddO1xuICAgICAgfSBicmVhaztcbiAgICAgIGRlZmF1bHQ6IG5hbWUgPSBvYmplY3RbJ25hbWVfY2hzJ107XG4gICAgfVxuICAgIHJldHVybiBuYW1lO1xuICB9XG59Il19