/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Directive, ElementRef, Renderer2, Injector, Input, Output, ViewContainerRef, NgZone } from '@angular/core';
import { EventEmitter } from '@angular/core';
var InputAppendDirective = /** @class */ (function () {
    // private ngControl: NgControl;
    function InputAppendDirective(viewRef, el, render, injector) {
        this.viewRef = viewRef;
        this.el = el;
        this.render = render;
        this.injector = injector;
        this._enableAppend = true;
        // 追加到哪个类型下 TextBox、MultiTextBox、 StaticText
        this.inputAppendControlType = 'InputGroup';
        // 根据类型不一样，在控件处于禁用、只读时，决定颜色是否可用
        // 有两种：按钮 button 文本 text
        this._appendType = 'button';
        // 追加的文本
        this._inputAppendText = '';
        // 模板
        // @Input() inputAppendTmpl: TemplateRef<any>;
        this._disabled = false;
        /*
            * 文本点击事件
            */
        this.inputAppendClickEvent = new EventEmitter();
        // 标记native的外层
        this.elWrapElement = null;
        // 标记元素
        this.appendWrapElement = null;
        // 暂时不用
        this.appendTextElement = null;
        this.clickHandler = null;
        this.disabledCls = 'f-state-disabled';
        this.ngZone = null;
        this.ngZone = this.injector.get(NgZone);
    }
    Object.defineProperty(InputAppendDirective.prototype, "enableAppend", {
        get: /**
         * @return {?}
         */
        function () {
            return this._enableAppend;
        },
        // 相当于启用禁用此功能
        set: 
        // 相当于启用禁用此功能
        /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            if (value === '' || value) {
                this._enableAppend = true;
                // 需要
                if (!this.appendWrapElement) {
                    this.createStruct();
                }
            }
            else {
                this._enableAppend = false;
                if (this.appendWrapElement) {
                    this.resetStruct();
                }
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(InputAppendDirective.prototype, "inputAppendType", {
        get: /**
         * @return {?}
         */
        function () {
            return this._appendType;
        },
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            var _this = this;
            if (value) {
                if (['button', 'text'].findIndex((/**
                 * @param {?} item
                 * @return {?}
                 */
                function (item) { return item == value; })) < 0) {
                    // 类型在支持范围内
                    value = 'button';
                }
                if (value != this._appendType) {
                    if (this.appendWrapElement) {
                        // 移除原来，追加新的
                        this.render.removeClass(this.appendWrapElement, 'input-append-' + this._appendType);
                        this.render.addClass(this.appendWrapElement, 'input-append-' + value);
                        if (this._appendType == 'button') {
                            // 原来是按钮
                            if (this.clickHandler) {
                                this.clickHandler();
                                this.clickHandler = null;
                            }
                        }
                        else {
                            this.clickHandler = this.render.listen(this.appendWrapElement, 'click', (/**
                             * @param {?} ev
                             * @return {?}
                             */
                            function (ev) {
                                _this.inputAppendClickEvent.emit(ev);
                            }));
                        }
                    }
                    this._appendType = value;
                }
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(InputAppendDirective.prototype, "inputAppendText", {
        get: /**
         * @return {?}
         */
        function () {
            return this._inputAppendText;
        },
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            if (value != this._inputAppendText) {
                this._inputAppendText = value;
                if (this.appendWrapElement && this._enableAppend) {
                    this.render.removeChild(this.appendWrapElement, this.appendTextElement);
                    this.appendTextElement.innerHTML = value;
                    this.render.appendChild(this.appendWrapElement, this.appendTextElement);
                }
                else {
                    this.createStruct();
                }
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(InputAppendDirective.prototype, "inputAppendDisabled", {
        get: /**
         * @return {?}
         */
        function () {
            return this._disabled;
        },
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            if (value != this._disabled) {
                this._disabled = value;
                if (this.appendWrapElement) {
                    value && this.render.addClass(this.appendWrapElement, this.disabledCls);
                    !value && this.render.removeClass(this.appendWrapElement, this.disabledCls);
                }
            }
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    InputAppendDirective.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        //this.ngControl = this.injector.get(NgControl, null);
    };
    /**
     * @return {?}
     */
    InputAppendDirective.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        this.createStruct();
    };
    /**
     * @return {?}
     */
    InputAppendDirective.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        //this.resetStruct();
        if (this.clickHandler) {
            this.clickHandler();
            this.clickHandler = null;
        }
        if (this.appendWrapElement) {
            this.appendWrapElement.remove();
            this.appendWrapElement = null;
        }
        if (this.elWrapElement) {
            this.elWrapElement.remove();
            this.elWrapElement = null;
        }
    };
    /**
     * 重置
     */
    /**
     * 重置
     * @private
     * @return {?}
     */
    InputAppendDirective.prototype.resetStruct = /**
     * 重置
     * @private
     * @return {?}
     */
    function () {
        if (this.clickHandler) {
            this.clickHandler();
            this.clickHandler = null;
        }
        // 分类型移除不同新增加的结构或样式
        switch (this.inputAppendControlType) {
            case 'StaticText':
                this.render.removeClass(this.el.nativeElement, 'f-cmp-static-text-input-append');
                break;
            case 'TextBox':
            case 'MultiTextBox':
                if (this.elWrapElement) {
                    /** @type {?} */
                    var wrapParent = this.render.parentNode(this.elWrapElement);
                    this.render.appendChild(wrapParent, this.el.nativeElement);
                    this.elWrapElement.remove();
                    this.elWrapElement = null;
                }
                break;
        }
        if (this.appendWrapElement) {
            this.appendWrapElement.remove();
            this.appendWrapElement = null;
        }
    };
    /**
     * 创建
     */
    /**
     * 创建
     * @private
     * @return {?}
     */
    InputAppendDirective.prototype.createStruct = /**
     * 创建
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        if (!this.inputAppendText || !this.enableAppend || this.appendWrapElement) {
            return;
        }
        /** @type {?} */
        var buttonWrap = this.render.createElement('div');
        buttonWrap.className = 'input-group-append input-append-wrapper';
        buttonWrap.className += ' input-append-' + this.inputAppendType;
        if (this._disabled) {
            buttonWrap.className += ' ' + this.disabledCls;
        }
        /** @type {?} */
        var buttonTextWrap = this.render.createElement('div');
        buttonTextWrap.className = 'input-group-text';
        buttonTextWrap.innerHTML = this.inputAppendText;
        this.appendTextElement = buttonTextWrap;
        this.appendWrapElement = buttonWrap;
        this.render.appendChild(buttonWrap, buttonTextWrap);
        switch (this.inputAppendControlType) {
            case 'StaticText':
                // 此时还没有生成内部的样式
                // let textareaEl = this.el.nativeElement.querySelector('.f-form-control-textarea');
                this.render.addClass(this.el.nativeElement, 'f-cmp-static-text-input-append' + (this._disabled ? ' ' + this.disabledCls : ''));
                this.render.appendChild(this.el.nativeElement, buttonWrap);
                break;
            case 'TextBox':
            case 'MultiTextBox':
                /** @type {?} */
                var textParent = this.render.parentNode(this.el.nativeElement);
                /** @type {?} */
                var inputWrap = this.render.createElement('div');
                inputWrap.className = 'f-cmp-text-input-append' + (this._disabled ? ' ' + this.disabledCls : '');
                if (this.el.nativeElement.outerHTML.indexOf('textarea') > -1) {
                    inputWrap.className = 'f-cmp-textarea-input-append' + (this._disabled ? ' ' + this.disabledCls : '');
                }
                this.elWrapElement = inputWrap;
                this.render.appendChild(inputWrap, this.el.nativeElement);
                this.render.appendChild(inputWrap, buttonWrap);
                this.render.appendChild(textParent, inputWrap);
                break;
            default:
                // 存在类似下拉这样的控件，内部调用input-group结构还没有初始化
                /** @type {?} */
                var inputGroupEl = this.el.nativeElement.querySelector('.input-group');
                if (inputGroupEl) {
                    this.render.appendChild(inputGroupEl, buttonWrap);
                }
                else {
                    if (this.ngZone) {
                        this.ngZone.runOutsideAngular((/**
                         * @return {?}
                         */
                        function () {
                            setTimeout((/**
                             * @return {?}
                             */
                            function () {
                                /** @type {?} */
                                var inputGroupEl2 = _this.el.nativeElement.querySelector('.input-group');
                                _this.render.appendChild(inputGroupEl2, buttonWrap);
                            }));
                        }));
                    }
                }
        }
        if (this.inputAppendType == 'button') {
            this.clickHandler = this.render.listen(this.appendWrapElement, 'click', (/**
             * @param {?} ev
             * @return {?}
             */
            function (ev) {
                _this.inputAppendClickEvent.emit(ev);
            }));
        }
    };
    InputAppendDirective.decorators = [
        { type: Directive, args: [{
                    selector: '[input-append]',
                },] }
    ];
    /** @nocollapse */
    InputAppendDirective.ctorParameters = function () { return [
        { type: ViewContainerRef },
        { type: ElementRef },
        { type: Renderer2 },
        { type: Injector }
    ]; };
    InputAppendDirective.propDecorators = {
        enableAppend: [{ type: Input, args: ['input-append',] }],
        inputAppendControlType: [{ type: Input }],
        inputAppendType: [{ type: Input }],
        inputAppendText: [{ type: Input }],
        inputAppendDisabled: [{ type: Input }],
        inputAppendClickEvent: [{ type: Output }]
    };
    return InputAppendDirective;
}());
export { InputAppendDirective };
if (false) {
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype._enableAppend;
    /** @type {?} */
    InputAppendDirective.prototype.inputAppendControlType;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype._appendType;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype._inputAppendText;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype._disabled;
    /** @type {?} */
    InputAppendDirective.prototype.inputAppendClickEvent;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype.elWrapElement;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype.appendWrapElement;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype.appendTextElement;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype.clickHandler;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype.disabledCls;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype.ngZone;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype.viewRef;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype.el;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype.render;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5wdXQtYXBwZW5kLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktZm9ybXMvIiwic291cmNlcyI6WyJsaWIvaW5wdXQtYXBwZW5kLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUNILFNBQVMsRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFFLFFBQVEsRUFBVSxLQUFLLEVBQ0wsTUFBTSxFQUFFLGdCQUFnQixFQUFlLE1BQU0sRUFDcEcsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUc3QztJQTZHSSxnQ0FBZ0M7SUFDaEMsOEJBQW9CLE9BQXlCLEVBQVUsRUFBYyxFQUFVLE1BQWlCLEVBQVUsUUFBa0I7UUFBeEcsWUFBTyxHQUFQLE9BQU8sQ0FBa0I7UUFBVSxPQUFFLEdBQUYsRUFBRSxDQUFZO1FBQVUsV0FBTSxHQUFOLE1BQU0sQ0FBVztRQUFVLGFBQVEsR0FBUixRQUFRLENBQVU7UUExR3BILGtCQUFhLEdBQUcsSUFBSSxDQUFDOztRQXFCcEIsMkJBQXNCLEdBQUcsWUFBWSxDQUFDOzs7UUFHdkMsZ0JBQVcsR0FBRyxRQUFRLENBQUM7O1FBa0N2QixxQkFBZ0IsR0FBRyxFQUFFLENBQUM7OztRQW1CdEIsY0FBUyxHQUFHLEtBQUssQ0FBQzs7OztRQWtCaEIsMEJBQXFCLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQzs7UUFFN0Msa0JBQWEsR0FBRyxJQUFJLENBQUM7O1FBRXJCLHNCQUFpQixHQUFHLElBQUksQ0FBQzs7UUFFekIsc0JBQWlCLEdBQUcsSUFBSSxDQUFDO1FBQ3pCLGlCQUFZLEdBQUcsSUFBSSxDQUFDO1FBQ3BCLGdCQUFXLEdBQUcsa0JBQWtCLENBQUM7UUFDakMsV0FBTSxHQUFXLElBQUksQ0FBQztRQUcxQixJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLE1BQU0s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SUFxQjdCLHNEQUErQzs7Ozs7SUFHL0MsMkNBQStCOzs7OztJQWtDL0IsZ0RBQThCOzs7OztJQW1COUIseUNBQTBCOztJQWtCMUIscURBQXFEOzs7OztJQUVyRCw2Q0FBNkI7Ozs7O0lBRTdCLGlEQUFpQzs7Ozs7SUFFakMsaURBQWlDOzs7OztJQUNqQyw0Q0FBNEI7Ozs7O0lBQzVCLDJDQUF5Qzs7Ozs7SUFDekMsc0NBQThCOzs7OztJQUVsQix1Q0FBaUM7Ozs7O0lBQUUsa0NBQXNCOzs7OztJQUFFLHNDQUF5Qjs7Ozs7SUFBRSx3Q0FBMEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xyXG4gICAgRGlyZWN0aXZlLCBFbGVtZW50UmVmLCBSZW5kZXJlcjIsIEluamVjdG9yLCBPbkluaXQsIElucHV0LFxyXG4gICAgQWZ0ZXJWaWV3SW5pdCwgT25EZXN0cm95LCBPbkNoYW5nZXMsIFNpbXBsZUNoYW5nZXMsIE91dHB1dCwgVmlld0NvbnRhaW5lclJlZiwgVGVtcGxhdGVSZWYsIE5nWm9uZVxyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBFdmVudEVtaXR0ZXIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuXHJcblxyXG5ARGlyZWN0aXZlKHtcclxuICAgIHNlbGVjdG9yOiAnW2lucHV0LWFwcGVuZF0nLFxyXG59KVxyXG5leHBvcnQgY2xhc3MgSW5wdXRBcHBlbmREaXJlY3RpdmUgaW1wbGVtZW50cyBPbkluaXQsIEFmdGVyVmlld0luaXQsIE9uRGVzdHJveSB7XHJcbiAgICBwcml2YXRlIF9lbmFibGVBcHBlbmQgPSB0cnVlO1xyXG4gICAgLy8g55u45b2T5LqO5ZCv55So56aB55So5q2k5Yqf6IO9XHJcbiAgICBASW5wdXQoJ2lucHV0LWFwcGVuZCcpXHJcbiAgICBzZXQgZW5hYmxlQXBwZW5kKHZhbHVlOiBzdHJpbmcgfCBib29sZWFuKSB7XHJcbiAgICAgICAgaWYgKHZhbHVlID09PSAnJyB8fCB2YWx1ZSkge1xyXG4gICAgICAgICAgICB0aGlzLl9lbmFibGVBcHBlbmQgPSB0cnVlO1xyXG4gICAgICAgICAgICAvLyDpnIDopoFcclxuICAgICAgICAgICAgaWYgKCF0aGlzLmFwcGVuZFdyYXBFbGVtZW50KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZVN0cnVjdCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5fZW5hYmxlQXBwZW5kID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmFwcGVuZFdyYXBFbGVtZW50KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlc2V0U3RydWN0KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBnZXQgZW5hYmxlQXBwZW5kKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9lbmFibGVBcHBlbmQ7XHJcbiAgICB9XHJcbiAgICAvLyDov73liqDliLDlk6rkuKrnsbvlnovkuIsgVGV4dEJveOOAgU11bHRpVGV4dEJveOOAgSBTdGF0aWNUZXh0XHJcbiAgICBASW5wdXQoKSBpbnB1dEFwcGVuZENvbnRyb2xUeXBlID0gJ0lucHV0R3JvdXAnO1xyXG4gICAgLy8g5qC55o2u57G75Z6L5LiN5LiA5qC377yM5Zyo5o6n5Lu25aSE5LqO56aB55So44CB5Y+q6K+75pe277yM5Yaz5a6a6aKc6Imy5piv5ZCm5Y+v55SoXHJcbiAgICAvLyDmnInkuKTnp43vvJrmjInpkq4gYnV0dG9uIOaWh+acrCB0ZXh0XHJcbiAgICBwcml2YXRlIF9hcHBlbmRUeXBlID0gJ2J1dHRvbic7XHJcbiAgICBASW5wdXQoKVxyXG4gICAgc2V0IGlucHV0QXBwZW5kVHlwZSh2YWx1ZTogc3RyaW5nKSB7XHJcbiAgICAgICAgaWYgKHZhbHVlKSB7XHJcbiAgICAgICAgICAgIGlmIChbJ2J1dHRvbicsICd0ZXh0J10uZmluZEluZGV4KGl0ZW0gPT4gaXRlbSA9PSB2YWx1ZSkgPCAwKSB7XHJcbiAgICAgICAgICAgICAgICAvLyDnsbvlnovlnKjmlK/mjIHojIPlm7TlhoVcclxuICAgICAgICAgICAgICAgIHZhbHVlID0gJ2J1dHRvbic7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHZhbHVlICE9IHRoaXMuX2FwcGVuZFR5cGUpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmFwcGVuZFdyYXBFbGVtZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8g56e76Zmk5Y6f5p2l77yM6L+95Yqg5paw55qEXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIucmVtb3ZlQ2xhc3ModGhpcy5hcHBlbmRXcmFwRWxlbWVudCwgJ2lucHV0LWFwcGVuZC0nICsgdGhpcy5fYXBwZW5kVHlwZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIuYWRkQ2xhc3ModGhpcy5hcHBlbmRXcmFwRWxlbWVudCwgJ2lucHV0LWFwcGVuZC0nICsgdmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9hcHBlbmRUeXBlID09ICdidXR0b24nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOWOn+adpeaYr+aMiemSrlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jbGlja0hhbmRsZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2xpY2tIYW5kbGVyKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsaWNrSGFuZGxlciA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsaWNrSGFuZGxlciA9IHRoaXMucmVuZGVyLmxpc3Rlbih0aGlzLmFwcGVuZFdyYXBFbGVtZW50LCAnY2xpY2snLCAoZXYpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5wdXRBcHBlbmRDbGlja0V2ZW50LmVtaXQoZXYpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9hcHBlbmRUeXBlID0gdmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG4gICAgZ2V0IGlucHV0QXBwZW5kVHlwZSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fYXBwZW5kVHlwZTtcclxuICAgIH1cclxuICAgIC8vIOi/veWKoOeahOaWh+acrFxyXG4gICAgcHJpdmF0ZSBfaW5wdXRBcHBlbmRUZXh0ID0gJyc7XHJcbiAgICBASW5wdXQoKVxyXG4gICAgc2V0IGlucHV0QXBwZW5kVGV4dCh2YWx1ZTogc3RyaW5nKSB7XHJcbiAgICAgICAgaWYgKHZhbHVlICE9IHRoaXMuX2lucHV0QXBwZW5kVGV4dCkge1xyXG4gICAgICAgICAgICB0aGlzLl9pbnB1dEFwcGVuZFRleHQgPSB2YWx1ZTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuYXBwZW5kV3JhcEVsZW1lbnQgJiYgdGhpcy5fZW5hYmxlQXBwZW5kKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5yZW1vdmVDaGlsZCh0aGlzLmFwcGVuZFdyYXBFbGVtZW50LCB0aGlzLmFwcGVuZFRleHRFbGVtZW50KTtcclxuICAgICAgICAgICAgICAgIHRoaXMuYXBwZW5kVGV4dEVsZW1lbnQuaW5uZXJIVE1MID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5hcHBlbmRDaGlsZCh0aGlzLmFwcGVuZFdyYXBFbGVtZW50LCB0aGlzLmFwcGVuZFRleHRFbGVtZW50KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlU3RydWN0KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBnZXQgaW5wdXRBcHBlbmRUZXh0KCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9pbnB1dEFwcGVuZFRleHQ7XHJcbiAgICB9XHJcbiAgICAvLyDmqKHmnb9cclxuICAgIC8vIEBJbnB1dCgpIGlucHV0QXBwZW5kVG1wbDogVGVtcGxhdGVSZWY8YW55PjtcclxuICAgIHByaXZhdGUgX2Rpc2FibGVkID0gZmFsc2U7XHJcbiAgICBASW5wdXQoKVxyXG4gICAgc2V0IGlucHV0QXBwZW5kRGlzYWJsZWQodmFsdWUpIHtcclxuICAgICAgICBpZiAodmFsdWUgIT0gdGhpcy5fZGlzYWJsZWQpIHtcclxuICAgICAgICAgICAgdGhpcy5fZGlzYWJsZWQgPSB2YWx1ZTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuYXBwZW5kV3JhcEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgIHZhbHVlICYmIHRoaXMucmVuZGVyLmFkZENsYXNzKHRoaXMuYXBwZW5kV3JhcEVsZW1lbnQsIHRoaXMuZGlzYWJsZWRDbHMpO1xyXG4gICAgICAgICAgICAgICAgIXZhbHVlICYmIHRoaXMucmVuZGVyLnJlbW92ZUNsYXNzKHRoaXMuYXBwZW5kV3JhcEVsZW1lbnQsIHRoaXMuZGlzYWJsZWRDbHMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgZ2V0IGlucHV0QXBwZW5kRGlzYWJsZWQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2Rpc2FibGVkO1xyXG4gICAgfVxyXG5cclxuICAgIC8qXHJcbiAgICAqIOaWh+acrOeCueWHu+S6i+S7tlxyXG4gICAgKi9cclxuICAgIEBPdXRwdXQoKSBpbnB1dEFwcGVuZENsaWNrRXZlbnQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgICAvLyDmoIforrBuYXRpdmXnmoTlpJblsYJcclxuICAgIHByaXZhdGUgZWxXcmFwRWxlbWVudCA9IG51bGw7XHJcbiAgICAvLyDmoIforrDlhYPntKBcclxuICAgIHByaXZhdGUgYXBwZW5kV3JhcEVsZW1lbnQgPSBudWxsO1xyXG4gICAgLy8g5pqC5pe25LiN55SoXHJcbiAgICBwcml2YXRlIGFwcGVuZFRleHRFbGVtZW50ID0gbnVsbDtcclxuICAgIHByaXZhdGUgY2xpY2tIYW5kbGVyID0gbnVsbDtcclxuICAgIHByaXZhdGUgZGlzYWJsZWRDbHMgPSAnZi1zdGF0ZS1kaXNhYmxlZCc7XHJcbiAgICBwcml2YXRlIG5nWm9uZTogTmdab25lID0gbnVsbDtcclxuICAgIC8vIHByaXZhdGUgbmdDb250cm9sOiBOZ0NvbnRyb2w7XHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHZpZXdSZWY6IFZpZXdDb250YWluZXJSZWYsIHByaXZhdGUgZWw6IEVsZW1lbnRSZWYsIHByaXZhdGUgcmVuZGVyOiBSZW5kZXJlcjIsIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yKSB7XHJcbiAgICAgICAgdGhpcy5uZ1pvbmUgPSB0aGlzLmluamVjdG9yLmdldChOZ1pvbmUpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCkge1xyXG4gICAgICAgIC8vdGhpcy5uZ0NvbnRyb2wgPSB0aGlzLmluamVjdG9yLmdldChOZ0NvbnRyb2wsIG51bGwpO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBuZ0FmdGVyVmlld0luaXQoKSB7XHJcbiAgICAgICAgdGhpcy5jcmVhdGVTdHJ1Y3QoKTtcclxuICAgIH1cclxuXHJcbiAgICBuZ09uRGVzdHJveSgpIHtcclxuICAgICAgICAvL3RoaXMucmVzZXRTdHJ1Y3QoKTtcclxuICAgICAgICBpZiAodGhpcy5jbGlja0hhbmRsZXIpIHtcclxuICAgICAgICAgICAgdGhpcy5jbGlja0hhbmRsZXIoKTtcclxuICAgICAgICAgICAgdGhpcy5jbGlja0hhbmRsZXIgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5hcHBlbmRXcmFwRWxlbWVudCkge1xyXG4gICAgICAgICAgICB0aGlzLmFwcGVuZFdyYXBFbGVtZW50LnJlbW92ZSgpO1xyXG4gICAgICAgICAgICB0aGlzLmFwcGVuZFdyYXBFbGVtZW50ID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuZWxXcmFwRWxlbWVudCkge1xyXG4gICAgICAgICAgICB0aGlzLmVsV3JhcEVsZW1lbnQucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuZWxXcmFwRWxlbWVudCA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDph43nva5cclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSByZXNldFN0cnVjdCgpIHtcclxuICAgICAgICBpZiAodGhpcy5jbGlja0hhbmRsZXIpIHtcclxuICAgICAgICAgICAgdGhpcy5jbGlja0hhbmRsZXIoKTtcclxuICAgICAgICAgICAgdGhpcy5jbGlja0hhbmRsZXIgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyDliIbnsbvlnovnp7vpmaTkuI3lkIzmlrDlop7liqDnmoTnu5PmnoTmiJbmoLflvI9cclxuICAgICAgICBzd2l0Y2ggKHRoaXMuaW5wdXRBcHBlbmRDb250cm9sVHlwZSkge1xyXG4gICAgICAgICAgICBjYXNlICdTdGF0aWNUZXh0JzpcclxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyLnJlbW92ZUNsYXNzKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgJ2YtY21wLXN0YXRpYy10ZXh0LWlucHV0LWFwcGVuZCcpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ1RleHRCb3gnOlxyXG4gICAgICAgICAgICBjYXNlICdNdWx0aVRleHRCb3gnOlxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZWxXcmFwRWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCB3cmFwUGFyZW50ID0gdGhpcy5yZW5kZXIucGFyZW50Tm9kZSh0aGlzLmVsV3JhcEVsZW1lbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyLmFwcGVuZENoaWxkKHdyYXBQYXJlbnQsIHRoaXMuZWwubmF0aXZlRWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbFdyYXBFbGVtZW50LnJlbW92ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZWxXcmFwRWxlbWVudCA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuYXBwZW5kV3JhcEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgdGhpcy5hcHBlbmRXcmFwRWxlbWVudC5yZW1vdmUoKTtcclxuICAgICAgICAgICAgdGhpcy5hcHBlbmRXcmFwRWxlbWVudCA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDliJvlu7pcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBjcmVhdGVTdHJ1Y3QoKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmlucHV0QXBwZW5kVGV4dCB8fCAhdGhpcy5lbmFibGVBcHBlbmQgfHwgdGhpcy5hcHBlbmRXcmFwRWxlbWVudCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGJ1dHRvbldyYXAgPSB0aGlzLnJlbmRlci5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICBidXR0b25XcmFwLmNsYXNzTmFtZSA9ICdpbnB1dC1ncm91cC1hcHBlbmQgaW5wdXQtYXBwZW5kLXdyYXBwZXInO1xyXG4gICAgICAgIGJ1dHRvbldyYXAuY2xhc3NOYW1lICs9ICcgaW5wdXQtYXBwZW5kLScgKyB0aGlzLmlucHV0QXBwZW5kVHlwZTtcclxuICAgICAgICBpZiAodGhpcy5fZGlzYWJsZWQpIHtcclxuICAgICAgICAgICAgYnV0dG9uV3JhcC5jbGFzc05hbWUgKz0gJyAnICsgdGhpcy5kaXNhYmxlZENscztcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgYnV0dG9uVGV4dFdyYXAgPSB0aGlzLnJlbmRlci5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICBidXR0b25UZXh0V3JhcC5jbGFzc05hbWUgPSAnaW5wdXQtZ3JvdXAtdGV4dCc7XHJcbiAgICAgICAgYnV0dG9uVGV4dFdyYXAuaW5uZXJIVE1MID0gdGhpcy5pbnB1dEFwcGVuZFRleHQ7XHJcbiAgICAgICAgdGhpcy5hcHBlbmRUZXh0RWxlbWVudCA9IGJ1dHRvblRleHRXcmFwO1xyXG4gICAgICAgIHRoaXMuYXBwZW5kV3JhcEVsZW1lbnQgPSBidXR0b25XcmFwO1xyXG4gICAgICAgIHRoaXMucmVuZGVyLmFwcGVuZENoaWxkKGJ1dHRvbldyYXAsIGJ1dHRvblRleHRXcmFwKTtcclxuICAgICAgICBzd2l0Y2ggKHRoaXMuaW5wdXRBcHBlbmRDb250cm9sVHlwZSkge1xyXG4gICAgICAgICAgICBjYXNlICdTdGF0aWNUZXh0JzpcclxuICAgICAgICAgICAgICAgIC8vIOatpOaXtui/mOayoeacieeUn+aIkOWGhemDqOeahOagt+W8j1xyXG4gICAgICAgICAgICAgICAgLy8gbGV0IHRleHRhcmVhRWwgPSB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcignLmYtZm9ybS1jb250cm9sLXRleHRhcmVhJyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5hZGRDbGFzcyh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsICdmLWNtcC1zdGF0aWMtdGV4dC1pbnB1dC1hcHBlbmQnICsgKHRoaXMuX2Rpc2FibGVkID8gJyAnICsgdGhpcy5kaXNhYmxlZENscyA6ICcnKSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5hcHBlbmRDaGlsZCh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsIGJ1dHRvbldyYXApO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ1RleHRCb3gnOlxyXG4gICAgICAgICAgICBjYXNlICdNdWx0aVRleHRCb3gnOlxyXG4gICAgICAgICAgICAgICAgbGV0IHRleHRQYXJlbnQgPSB0aGlzLnJlbmRlci5wYXJlbnROb2RlKHRoaXMuZWwubmF0aXZlRWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBpbnB1dFdyYXAgPSB0aGlzLnJlbmRlci5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICAgICAgICAgIGlucHV0V3JhcC5jbGFzc05hbWUgPSAnZi1jbXAtdGV4dC1pbnB1dC1hcHBlbmQnICsgKHRoaXMuX2Rpc2FibGVkID8gJyAnICsgdGhpcy5kaXNhYmxlZENscyA6ICcnKTtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQub3V0ZXJIVE1MLmluZGV4T2YoJ3RleHRhcmVhJykgPiAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlucHV0V3JhcC5jbGFzc05hbWUgPSAnZi1jbXAtdGV4dGFyZWEtaW5wdXQtYXBwZW5kJyArICh0aGlzLl9kaXNhYmxlZCA/ICcgJyArIHRoaXMuZGlzYWJsZWRDbHMgOiAnJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLmVsV3JhcEVsZW1lbnQgPSBpbnB1dFdyYXA7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5hcHBlbmRDaGlsZChpbnB1dFdyYXAsIHRoaXMuZWwubmF0aXZlRWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5hcHBlbmRDaGlsZChpbnB1dFdyYXAsIGJ1dHRvbldyYXApO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIuYXBwZW5kQ2hpbGQodGV4dFBhcmVudCwgaW5wdXRXcmFwKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgLy8g5a2Y5Zyo57G75Ly85LiL5ouJ6L+Z5qC355qE5o6n5Lu277yM5YaF6YOo6LCD55SoaW5wdXQtZ3JvdXDnu5PmnoTov5jmsqHmnInliJ3lp4vljJZcclxuICAgICAgICAgICAgICAgIGxldCBpbnB1dEdyb3VwRWwgPSB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcignLmlucHV0LWdyb3VwJyk7XHJcbiAgICAgICAgICAgICAgICBpZiAoaW5wdXRHcm91cEVsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIuYXBwZW5kQ2hpbGQoaW5wdXRHcm91cEVsLCBidXR0b25XcmFwKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMubmdab25lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBpbnB1dEdyb3VwRWwyID0gdGhpcy5lbC5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5pbnB1dC1ncm91cCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyLmFwcGVuZENoaWxkKGlucHV0R3JvdXBFbDIsIGJ1dHRvbldyYXApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5pbnB1dEFwcGVuZFR5cGUgPT0gJ2J1dHRvbicpIHtcclxuICAgICAgICAgICAgdGhpcy5jbGlja0hhbmRsZXIgPSB0aGlzLnJlbmRlci5saXN0ZW4odGhpcy5hcHBlbmRXcmFwRWxlbWVudCwgJ2NsaWNrJywgKGV2KSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlucHV0QXBwZW5kQ2xpY2tFdmVudC5lbWl0KGV2KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiJdfQ==