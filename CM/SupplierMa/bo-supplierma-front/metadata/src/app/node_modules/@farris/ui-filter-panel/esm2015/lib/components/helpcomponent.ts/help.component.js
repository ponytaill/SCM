/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, Output, EventEmitter, Injector } from '@angular/core';
// import { ServerSideToken } from '@farris/ui-lookup';
// import { LookupHttpBeQueryService } from './service/Lookup-http.service';
import { of } from 'rxjs';
import { cloneDeep } from 'lodash-es';
export class PanelHelpComponent {
    /**
     * @param {?} injector
     */
    constructor(injector) {
        this.injector = injector;
        this.searchHandle = new EventEmitter();
        this.submitChange = new EventEmitter();
        this.onSearch = (/**
         * @return {?}
         */
        () => {
            this.searchHandle.emit();
            return of(true);
        });
    }
    /**
     * @return {?}
     */
    get item() {
        return this._item;
    }
    /**
     * @param {?} data
     * @return {?}
     */
    set item(data) {
        this._item = data;
        if (this._item.placeHolder) {
            this.placeholder = this._item.placeHolder;
        }
        if (!this._item.hasOwnProperty('value')) {
            this._item.value = {
                value: [],
                valueField: '',
                textValue: ''
            };
        }
        this.getHelpBindingInfo();
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        // if(this.item.control && this.item.control.hasOwnProperty('placeholder')){
        //     this.placeholder = this.item.control.placeholder;
        // }
        // this.getHelpBindingInfo();
    }
    /**
     * @param {?} selectedItem
     * @return {?}
     */
    selectedDataHandler(selectedItem) {
        /** @type {?} */
        const helpValue = (this._item.value);
        helpValue.value = this.singleSelect ? [selectedItem] : selectedItem; // 单选返回对象，多选返回数组
        helpValue.valueField = this.valueField;
        helpValue.textValue = this.getTextValue(this.textField, helpValue.value);
        this.textValue = helpValue.textValue;
        this._item.valueText = this._item.value.textValue;
        this.setSubmitChange();
        this.searchHandle.emit();
    }
    /**
     * @return {?}
     */
    getHelpBindingInfo() {
        if (this._item && this._item.control) {
            /** @type {?} */
            const helpOpts = this._item.control;
            this.uri = helpOpts.uri;
            this.title = helpOpts.title;
            this.textField = helpOpts.textField;
            this.valueField = helpOpts.valueField;
            this.idField = helpOpts.idField;
            this.mapFields = helpOpts.mapFields;
            this.context = helpOpts.context;
            this.preEventCmd = helpOpts.preEventCmd;
            this.postEventCmd = helpOpts.postEventCmd;
            this.singleSelect = helpOpts.singleSelect;
            this.enableFullTree = helpOpts.enableFullTree;
            this.loadTreeDataType = helpOpts.loadTreeDataType;
            this.expandLevel = helpOpts.expandLevel;
            this.enableCascade = helpOpts.enableCascade;
            this.helpId = helpOpts.helpId;
            /** @type {?} */
            const helpValue = (this._item.value);
            // if (helpValue && helpValue.value) {
            //     // this.textValue = (this.item.value as HelpValue).value[this.textField];
            //     this.textValue = HelpValue.getPropValue(helpValue.value, this.textField.split('.'));
            // }
            this.displayType = helpOpts.displayType;
            if (helpValue.textValue == 'help-text-value-null') { // 旧数据兼容
                this.textValue = helpValue.getTextValue(this.textField);
            }
            else {
                this.textValue = helpValue.textValue;
            }
        }
        this.setSubmitChange();
    }
    /**
     * @param {?} data
     * @return {?}
     */
    clearData(data) {
        (this._item.value).clearValue();
        this.setSubmitChange();
        this.searchHandle.emit();
    }
    /**
     * @param {?} helpItem
     * @param {?} args
     * @return {?}
     */
    getPropValue(helpItem, args) {
        if (args.length > 1) {
            /** @type {?} */
            const arg = args.shift();
            return helpItem[arg] ? this.getPropValue(helpItem[arg], args) : null;
        }
        return helpItem[args[0]];
    }
    /**
     * @param {?} textField
     * @param {?} value
     * @return {?}
     */
    getTextValue(textField, value) {
        /** @type {?} */
        const args = textField.split('.');
        /** @type {?} */
        const textArr = value.map((/**
         * @param {?} helpItem
         * @return {?}
         */
        helpItem => this.getPropValue(helpItem, cloneDeep(args))));
        return textArr && textArr.length ? textArr.join(',') : '';
    }
    /**
     * @return {?}
     */
    setSubmitChange() {
        /** @type {?} */
        const val = this._item.value;
        if (Object.keys(val).length < 0 || !val.value || !val.valueField) {
            this.submitChange.emit(false);
        }
        else {
            this.submitChange.emit(true);
        }
    }
}
PanelHelpComponent.decorators = [
    { type: Component, args: [{
                selector: 'panel-filter-help',
                template: "<farris-lookup-grid  \r\n    [uri]=\"uri\"\r\n    [title]=\"title\"\r\n    [idField]=\"idField\" \r\n    [textField]=\"textField\" \r\n    [valueField]=\"valueField\" \r\n    [(ngModel)]=\"textValue\"\r\n    [displayType]=\"displayType\"\r\n    [editable]=\"false\"\r\n    (clear)=\"clearData($event)\"\r\n    (selectedData)=\"selectedDataHandler($event)\"\r\n    [placeholder]=\"placeholder\"\r\n    [mapFields]=\"mapFields\"\r\n    [dictPicking]=\"preEventCmd\"\r\n    [dictPicked]=\"postEventCmd\"\r\n    [context]=\"context\"\r\n    [enableFullTree]=\"enableFullTree\"\r\n    [loadTreeDataType]=\"loadTreeDataType\"\r\n    [singleSelect]=\"singleSelect\"\r\n    [expandLevel]=\"expandLevel\"\r\n    [enableCascade]=\"enableCascade\"\r\n>\r\n</farris-lookup-grid>"
                // providers: [{ provide: ServerSideToken, useClass: LookupHttpBeQueryService }]
            }] }
];
/** @nocollapse */
PanelHelpComponent.ctorParameters = () => [
    { type: Injector }
];
PanelHelpComponent.propDecorators = {
    item: [{ type: Input }],
    searchHandle: [{ type: Output }],
    submitChange: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    PanelHelpComponent.prototype._item;
    /** @type {?} */
    PanelHelpComponent.prototype.searchHandle;
    /** @type {?} */
    PanelHelpComponent.prototype.submitChange;
    /** @type {?} */
    PanelHelpComponent.prototype.uri;
    /** @type {?} */
    PanelHelpComponent.prototype.textField;
    /** @type {?} */
    PanelHelpComponent.prototype.idField;
    /** @type {?} */
    PanelHelpComponent.prototype.valueField;
    /** @type {?} */
    PanelHelpComponent.prototype.textValue;
    /** @type {?} */
    PanelHelpComponent.prototype.displayType;
    /** @type {?} */
    PanelHelpComponent.prototype.mapFields;
    /** @type {?} */
    PanelHelpComponent.prototype.context;
    /** @type {?} */
    PanelHelpComponent.prototype.preEventCmd;
    /** @type {?} */
    PanelHelpComponent.prototype.postEventCmd;
    /** @type {?} */
    PanelHelpComponent.prototype.enableFullTree;
    /** @type {?} */
    PanelHelpComponent.prototype.loadTreeDataType;
    /** @type {?} */
    PanelHelpComponent.prototype.singleSelect;
    /** @type {?} */
    PanelHelpComponent.prototype.expandLevel;
    /** @type {?} */
    PanelHelpComponent.prototype.enableCascade;
    /** @type {?} */
    PanelHelpComponent.prototype.placeholder;
    /** @type {?} */
    PanelHelpComponent.prototype.helpId;
    /** @type {?} */
    PanelHelpComponent.prototype.title;
    /** @type {?} */
    PanelHelpComponent.prototype.onSearch;
    /**
     * @type {?}
     * @private
     */
    PanelHelpComponent.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGVscC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWZpbHRlci1wYW5lbC8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2hlbHBjb21wb25lbnQudHMvaGVscC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFVLE1BQU0sRUFBRSxZQUFZLEVBQUUsUUFBUSxFQUFFLE1BQU0sZUFBZSxDQUFDOzs7QUFJekYsT0FBTyxFQUFFLEVBQUUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMxQixPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBUXRDLE1BQU0sT0FBTyxrQkFBa0I7Ozs7SUE4QzNCLFlBQW9CLFFBQWtCO1FBQWxCLGFBQVEsR0FBUixRQUFRLENBQVU7UUF0QjVCLGlCQUFZLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUNsQyxpQkFBWSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUE0RTVDLGFBQVE7OztRQUFHLEdBQUcsRUFBRTtZQUNaLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDekIsT0FBTyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDcEIsQ0FBQyxFQUFBO0lBMUR5QyxDQUFDOzs7O0lBekMzQyxJQUNJLElBQUk7UUFDSixPQUFPLElBQUksQ0FBQyxLQUFLLENBQUM7SUFDdEIsQ0FBQzs7Ozs7SUFDRCxJQUFJLElBQUksQ0FBQyxJQUFJO1FBQ1QsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUM7UUFDbEIsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLFdBQVcsRUFBRTtZQUN4QixJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDO1NBQzdDO1FBQ0QsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FB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SUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7SUFDOUQsQ0FBQzs7OztJQUVELGVBQWU7O2NBQ0wsR0FBRyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSztRQUM1QixJQUFJLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsTUFBTSxHQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsVUFBVSxFQUFFO1lBQzlELElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1NBQ2pDO2FBQU07WUFDSCxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUNoQztJQUNMLENBQUM7OztZQTNJSixTQUFTLFNBQUM7Z0JBQ1AsUUFBUSxFQUFFLG1CQUFtQjtnQkFDN0IsMHdCQUFvQztnQkFDcEMsZ0ZBQWdGO2FBQ25GOzs7O1lBWHdELFFBQVE7OzttQkFrQjVELEtBQUs7MkJBbUJMLE1BQU07MkJBQ04sTUFBTTs7OztJQXJCUCxtQ0FBVzs7SUFvQlgsMENBQTRDOztJQUM1QywwQ0FBNEM7O0lBRTVDLGlDQUFZOztJQUNaLHVDQUFrQjs7SUFDbEIscUNBQWdCOztJQUNoQix3Q0FBZ0I7O0lBQ2hCLHVDQUFlOztJQUNmLHlDQUFZOztJQUNaLHVDQUFlOztJQUNmLHFDQUFhOztJQUNiLHlDQUFpQjs7SUFDakIsMENBQWtCOztJQUNsQiw0Q0FBd0I7O0lBQ3hCLDhDQUFzRDs7SUFDdEQsMENBQXNCOztJQUN0Qix5Q0FBb0I7O0lBQ3BCLDJDQUF1Qjs7SUFDdkIseUNBQW9COztJQUNwQixvQ0FBZTs7SUFDZixtQ0FBYzs7SUF5RGQsc0NBR0M7Ozs7O0lBMURXLHNDQUEwQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQsIE9uSW5pdCwgT3V0cHV0LCBFdmVudEVtaXR0ZXIsIEluamVjdG9yIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcblxyXG4vLyBpbXBvcnQgeyBTZXJ2ZXJTaWRlVG9rZW4gfSBmcm9tICdAZmFycmlzL3VpLWxvb2t1cCc7XHJcbi8vIGltcG9ydCB7IExvb2t1cEh0dHBCZVF1ZXJ5U2VydmljZSB9IGZyb20gJy4vc2VydmljZS9Mb29rdXAtaHR0cC5zZXJ2aWNlJztcclxuaW1wb3J0IHsgb2YgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgY2xvbmVEZWVwIH0gZnJvbSAnbG9kYXNoLWVzJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdwYW5lbC1maWx0ZXItaGVscCcsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vaGVscC5jb21wb25lbnQuaHRtbCdcclxuICAgIC8vIHByb3ZpZGVyczogW3sgcHJvdmlkZTogU2VydmVyU2lkZVRva2VuLCB1c2VDbGFzczogTG9va3VwSHR0cEJlUXVlcnlTZXJ2aWNlIH1dXHJcbn0pXHJcblxyXG5leHBvcnQgY2xhc3MgUGFuZWxIZWxwQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuXHJcbiAgICAvLyBASW5wdXQoKSBpdGVtOmFueTtcclxuXHJcbiAgICBfaXRlbTogYW55O1xyXG4gICAgQElucHV0KClcclxuICAgIGdldCBpdGVtKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9pdGVtO1xyXG4gICAgfVxyXG4gICAgc2V0IGl0ZW0oZGF0YSkge1xyXG4gICAgICAgIHRoaXMuX2l0ZW0gPSBkYXRhO1xyXG4gICAgICAgIGlmICh0aGlzLl9pdGVtLnBsYWNlSG9sZGVyKSB7XHJcbiAgICAgICAgICAgIHRoaXMucGxhY2Vob2xkZXIgPSB0aGlzLl9pdGVtLnBsYWNlSG9sZGVyO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIXRoaXMuX2l0ZW0uaGFzT3duUHJvcGVydHkoJ3ZhbHVlJykpIHtcclxuICAgICAgICAgICAgdGhpcy5faXRlbS52YWx1ZSA9IHtcclxuICAgICAgICAgICAgICAgIHZhbHVlOiBbXSxcclxuICAgICAgICAgICAgICAgIHZhbHVlRmllbGQ6ICcnLFxyXG4gICAgICAgICAgICAgICAgdGV4dFZhbHVlOiAnJ1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmdldEhlbHBCaW5kaW5nSW5mbygpO1xyXG4gICAgfVxyXG5cclxuICAgIEBPdXRwdXQoKSBzZWFyY2hIYW5kbGUgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgICBAT3V0cHV0KCkgc3VibWl0Q2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG5cclxuICAgIHVyaTogc3RyaW5nO1xyXG4gICAgdGV4dEZpZWxkOiBzdHJpbmc7XHJcbiAgICBpZEZpZWxkOiBzdHJpbmc7XHJcbiAgICB2YWx1ZUZpZWxkOiBhbnk7XHJcbiAgICB0ZXh0VmFsdWU6IGFueTtcclxuICAgIGRpc3BsYXlUeXBlO1xyXG4gICAgbWFwRmllbGRzOiBhbnk7XHJcbiAgICBjb250ZXh0OiBhbnk7XHJcbiAgICBwcmVFdmVudENtZDogYW55O1xyXG4gICAgcG9zdEV2ZW50Q21kOiBhbnk7XHJcbiAgICBlbmFibGVGdWxsVHJlZTogYm9vbGVhbjtcclxuICAgIGxvYWRUcmVlRGF0YVR5cGU6ICdkZWZhdWx0JyB8ICdsb2FkYWxsJyB8ICdsYXllcmxvYWQnO1xyXG4gICAgc2luZ2xlU2VsZWN0OiBib29sZWFuO1xyXG4gICAgZXhwYW5kTGV2ZWw6IG51bWJlcjtcclxuICAgIGVuYWJsZUNhc2NhZGU6IGJvb2xlYW47XHJcbiAgICBwbGFjZWhvbGRlcjogc3RyaW5nO1xyXG4gICAgaGVscElkOiBzdHJpbmc7XHJcbiAgICB0aXRsZTogc3RyaW5nO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yKSB7IH1cclxuXHJcbiAgICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgICAgICAvLyBpZih0aGlzLml0ZW0uY29udHJvbCAmJiB0aGlzLml0ZW0uY29udHJvbC5oYXNPd25Qcm9wZXJ0eSgncGxhY2Vob2xkZXInKSl7XHJcbiAgICAgICAgLy8gICAgIHRoaXMucGxhY2Vob2xkZXIgPSB0aGlzLml0ZW0uY29udHJvbC5wbGFjZWhvbGRlcjtcclxuICAgICAgICAvLyB9XHJcbiAgICAgICAgLy8gdGhpcy5nZXRIZWxwQmluZGluZ0luZm8oKTtcclxuICAgIH1cclxuXHJcbiAgICBzZWxlY3RlZERhdGFIYW5kbGVyKHNlbGVjdGVkSXRlbTogYW55KSB7XHJcbiAgICAgICAgY29uc3QgaGVscFZhbHVlID0gKHRoaXMuX2l0ZW0udmFsdWUpO1xyXG4gICAgICAgIGhlbHBWYWx1ZS52YWx1ZSA9IHRoaXMuc2luZ2xlU2VsZWN0ID8gW3NlbGVjdGVkSXRlbV0gOiBzZWxlY3RlZEl0ZW07IC8vIOWNlemAiei/lOWbnuWvueixoe+8jOWkmumAiei/lOWbnuaVsOe7hFxyXG4gICAgICAgIGhlbHBWYWx1ZS52YWx1ZUZpZWxkID0gdGhpcy52YWx1ZUZpZWxkO1xyXG4gICAgICAgIGhlbHBWYWx1ZS50ZXh0VmFsdWUgPSB0aGlzLmdldFRleHRWYWx1ZSh0aGlzLnRleHRGaWVsZCwgaGVscFZhbHVlLnZhbHVlKTtcclxuICAgICAgICB0aGlzLnRleHRWYWx1ZSA9IGhlbHBWYWx1ZS50ZXh0VmFsdWU7XHJcbiAgICAgICAgdGhpcy5faXRlbS52YWx1ZVRleHQgPSB0aGlzLl9pdGVtLnZhbHVlLnRleHRWYWx1ZTtcclxuICAgICAgICB0aGlzLnNldFN1Ym1pdENoYW5nZSgpO1xyXG4gICAgICAgIHRoaXMuc2VhcmNoSGFuZGxlLmVtaXQoKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRIZWxwQmluZGluZ0luZm8oKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX2l0ZW0gJiYgdGhpcy5faXRlbS5jb250cm9sKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGhlbHBPcHRzID0gdGhpcy5faXRlbS5jb250cm9sO1xyXG4gICAgICAgICAgICB0aGlzLnVyaSA9IGhlbHBPcHRzLnVyaTtcclxuICAgICAgICAgICAgdGhpcy50aXRsZSA9IGhlbHBPcHRzLnRpdGxlO1xyXG4gICAgICAgICAgICB0aGlzLnRleHRGaWVsZCA9IGhlbHBPcHRzLnRleHRGaWVsZDtcclxuICAgICAgICAgICAgdGhpcy52YWx1ZUZpZWxkID0gaGVscE9wdHMudmFsdWVGaWVsZDtcclxuICAgICAgICAgICAgdGhpcy5pZEZpZWxkID0gaGVscE9wdHMuaWRGaWVsZDtcclxuICAgICAgICAgICAgdGhpcy5tYXBGaWVsZHMgPSBoZWxwT3B0cy5tYXBGaWVsZHM7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGV4dCA9IGhlbHBPcHRzLmNvbnRleHQ7XHJcbiAgICAgICAgICAgIHRoaXMucHJlRXZlbnRDbWQgPSBoZWxwT3B0cy5wcmVFdmVudENtZDtcclxuICAgICAgICAgICAgdGhpcy5wb3N0RXZlbnRDbWQgPSBoZWxwT3B0cy5wb3N0RXZlbnRDbWQ7XHJcbiAgICAgICAgICAgIHRoaXMuc2luZ2xlU2VsZWN0ID0gaGVscE9wdHMuc2luZ2xlU2VsZWN0O1xyXG4gICAgICAgICAgICB0aGlzLmVuYWJsZUZ1bGxUcmVlID0gaGVscE9wdHMuZW5hYmxlRnVsbFRyZWU7XHJcbiAgICAgICAgICAgIHRoaXMubG9hZFRyZWVEYXRhVHlwZSA9IGhlbHBPcHRzLmxvYWRUcmVlRGF0YVR5cGU7XHJcbiAgICAgICAgICAgIHRoaXMuZXhwYW5kTGV2ZWwgPSBoZWxwT3B0cy5leHBhbmRMZXZlbDtcclxuICAgICAgICAgICAgdGhpcy5lbmFibGVDYXNjYWRlID0gaGVscE9wdHMuZW5hYmxlQ2FzY2FkZTtcclxuICAgICAgICAgICAgdGhpcy5oZWxwSWQgPSBoZWxwT3B0cy5oZWxwSWQ7XHJcbiAgICAgICAgICAgIGNvbnN0IGhlbHBWYWx1ZSA9ICh0aGlzLl9pdGVtLnZhbHVlKTtcclxuICAgICAgICAgICAgLy8gaWYgKGhlbHBWYWx1ZSAmJiBoZWxwVmFsdWUudmFsdWUpIHtcclxuICAgICAgICAgICAgLy8gICAgIC8vIHRoaXMudGV4dFZhbHVlID0gKHRoaXMuaXRlbS52YWx1ZSBhcyBIZWxwVmFsdWUpLnZhbHVlW3RoaXMudGV4dEZpZWxkXTtcclxuICAgICAgICAgICAgLy8gICAgIHRoaXMudGV4dFZhbHVlID0gSGVscFZhbHVlLmdldFByb3BWYWx1ZShoZWxwVmFsdWUudmFsdWUsIHRoaXMudGV4dEZpZWxkLnNwbGl0KCcuJykpO1xyXG4gICAgICAgICAgICAvLyB9XHJcbiAgICAgICAgICAgIHRoaXMuZGlzcGxheVR5cGUgPSBoZWxwT3B0cy5kaXNwbGF5VHlwZTtcclxuICAgICAgICAgICAgaWYgKGhlbHBWYWx1ZS50ZXh0VmFsdWUgPT0gJ2hlbHAtdGV4dC12YWx1ZS1udWxsJykgey8vIOaXp+aVsOaNruWFvOWuuVxyXG4gICAgICAgICAgICAgICAgdGhpcy50ZXh0VmFsdWUgPSBoZWxwVmFsdWUuZ2V0VGV4dFZhbHVlKHRoaXMudGV4dEZpZWxkKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudGV4dFZhbHVlID0gaGVscFZhbHVlLnRleHRWYWx1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zZXRTdWJtaXRDaGFuZ2UoKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgb25TZWFyY2ggPSAoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5zZWFyY2hIYW5kbGUuZW1pdCgpO1xyXG4gICAgICAgIHJldHVybiBvZih0cnVlKTtcclxuICAgIH1cclxuXHJcbiAgICBjbGVhckRhdGEoZGF0YTogYW55KSB7XHJcbiAgICAgICAgKHRoaXMuX2l0ZW0udmFsdWUpLmNsZWFyVmFsdWUoKTtcclxuICAgICAgICB0aGlzLnNldFN1Ym1pdENoYW5nZSgpO1xyXG4gICAgICAgIHRoaXMuc2VhcmNoSGFuZGxlLmVtaXQoKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRQcm9wVmFsdWUoaGVscEl0ZW06IGFueSwgYXJnczogQXJyYXk8c3RyaW5nPik6IGFueSB7XHJcbiAgICAgICAgaWYgKGFyZ3MubGVuZ3RoID4gMSkge1xyXG4gICAgICAgICAgICBjb25zdCBhcmcgPSBhcmdzLnNoaWZ0KCk7XHJcbiAgICAgICAgICAgIHJldHVybiBoZWxwSXRlbVthcmddID8gdGhpcy5nZXRQcm9wVmFsdWUoaGVscEl0ZW1bYXJnXSwgYXJncykgOiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gaGVscEl0ZW1bYXJnc1swXV07XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0VGV4dFZhbHVlKHRleHRGaWVsZDogc3RyaW5nLCB2YWx1ZSk6IHN0cmluZyB7XHJcbiAgICAgICAgY29uc3QgYXJncyA9IHRleHRGaWVsZC5zcGxpdCgnLicpO1xyXG4gICAgICAgIGNvbnN0IHRleHRBcnIgPSB2YWx1ZS5tYXAoaGVscEl0ZW0gPT4gdGhpcy5nZXRQcm9wVmFsdWUoaGVscEl0ZW0sIGNsb25lRGVlcChhcmdzKSkpO1xyXG4gICAgICAgIHJldHVybiB0ZXh0QXJyICYmIHRleHRBcnIubGVuZ3RoID8gdGV4dEFyci5qb2luKCcsJykgOiAnJztcclxuICAgIH1cclxuXHJcbiAgICBzZXRTdWJtaXRDaGFuZ2UoKSB7XHJcbiAgICAgICAgY29uc3QgdmFsID0gdGhpcy5faXRlbS52YWx1ZTtcclxuICAgICAgICBpZiAoT2JqZWN0LmtleXModmFsKS5sZW5ndGggPCAwIHx8ICF2YWwudmFsdWUgfHwgIXZhbC52YWx1ZUZpZWxkKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc3VibWl0Q2hhbmdlLmVtaXQoZmFsc2UpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuc3VibWl0Q2hhbmdlLmVtaXQodHJ1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxufVxyXG4iXX0=