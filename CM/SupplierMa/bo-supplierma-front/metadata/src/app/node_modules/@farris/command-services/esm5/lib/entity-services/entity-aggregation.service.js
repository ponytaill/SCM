import { Injectable } from '@angular/core';
import { FrameContext, BindingList } from '@farris/devkit';
import { EntityTraversingService } from './entity-traversing.service';
/**
 * 实体聚合服务
 */
var EntityAggregationService = /** @class */ (function () {
    function EntityAggregationService(frameContext) {
        this.frameContext = frameContext;
        this.traversingService = this.frameContext.injector.get(EntityTraversingService);
    }
    Object.defineProperty(EntityAggregationService.prototype, "bindingData", {
        get: function () {
            return this.frameContext.bindingData;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * 获取path对应列表记录的条数
     */
    EntityAggregationService.prototype.count = function (path) {
        var splitedPath = this.splitPath(path);
        var entityListData = this.traversingService.getEntityListData(splitedPath.listPath);
        return entityListData.length;
    };
    /**
     * 获取path对应字段的和
     */
    EntityAggregationService.prototype.sum = function (path) {
        var _this = this;
        var splitedPath = this.splitPath(path);
        var entityListData = this.traversingService.getEntityListData(splitedPath.listPath);
        var total = entityListData.reduce(function (accTotal, entityData) {
            var propValue = parseFloat(_this.getPropValue(entityData, splitedPath.propPath));
            propValue = isNaN(propValue) ? 0 : propValue;
            accTotal += propValue;
            return accTotal;
        }, 0);
        return total;
    };
    /**
     * 获取path对应字段的平均值
     */
    EntityAggregationService.prototype.avg = function (path) {
        var count = this.count(path);
        var total = this.sum(path);
        return count !== 0 ? total / count : 0;
    };
    /**
     * 获取path对应字段的最大值
     */
    EntityAggregationService.prototype.max = function (path) {
        var _this = this;
        var splitedPath = this.splitPath(path);
        var entityListData = this.traversingService.getEntityListData(splitedPath.listPath);
        var max = entityListData.reduce(function (accMax, entityData) {
            var propValue = parseFloat(_this.getPropValue(entityData, splitedPath.propPath));
            if (isNaN(propValue) === false && (!accMax || propValue > accMax)) {
                accMax = propValue;
            }
            return accMax;
        }, null);
        return max ? max : 0;
    };
    /**
     * 获取path对应字段的最小值
     */
    EntityAggregationService.prototype.min = function (path) {
        var _this = this;
        var splitedPath = this.splitPath(path);
        var entityListData = this.traversingService.getEntityListData(splitedPath.listPath);
        var min = entityListData.reduce(function (accMin, entityData) {
            var propValue = parseFloat(_this.getPropValue(entityData, splitedPath.propPath));
            if (isNaN(propValue) === false && (!accMin || propValue < accMin)) {
                accMin = propValue;
            }
            return accMin;
        }, null);
        return min ? min : 0;
    };
    /**
     * 获取属性值
     */
    EntityAggregationService.prototype.getPropValue = function (entityData, path) {
        var currentData = entityData;
        path.forEach(function (pathItem) {
            // 提前退出的都重置为null，主要针对关联对象未赋值场景
            if (!currentData) {
                currentData = null;
                return;
            }
            currentData = currentData[pathItem];
        });
        return currentData;
    };
    /**
     * 分隔路径，分隔符列表路径和属性路径
     * @return 形如 {parentListPath: [], propertyPath: []}
     */
    EntityAggregationService.prototype.splitPath = function (path) {
        var listPath = path.concat([]);
        var propPath = [];
        var currentNode = this.bindingData.getValue(listPath);
        while (currentNode instanceof BindingList !== true) {
            var propPathItem = listPath.pop();
            if (!propPathItem) {
                return;
            }
            propPath.unshift(propPathItem);
            currentNode = this.bindingData.getValue(listPath);
        }
        return {
            listPath: listPath,
            propPath: propPath
        };
    };
    EntityAggregationService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    EntityAggregationService.ctorParameters = function () { return [
        { type: FrameContext }
    ]; };
    return EntityAggregationService;
}());
export { EntityAggregationService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW50aXR5LWFnZ3JlZ2F0aW9uLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2NvbW1hbmQtc2VydmljZXMvIiwic291cmNlcyI6WyJsaWIvZW50aXR5LXNlcnZpY2VzL2VudGl0eS1hZ2dyZWdhdGlvbi5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLFlBQVksRUFBZSxXQUFXLEVBQWlCLE1BQU0sZ0JBQWdCLENBQUM7QUFDdkYsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFPdEU7O0dBRUc7QUFDSDtJQVNFLGtDQUFvQixZQUEwQjtRQUExQixpQkFBWSxHQUFaLFlBQVksQ0FBYztRQUM1QyxJQUFJLENBQUMsaUJBQWlCLEdBQUssSUFBSSxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUEwQix1QkFBdUIsQ0FBQyxDQUFDO0lBQzlHLENBQUM7SUFSRCxzQkFBWSxpREFBVzthQUF2QjtZQUNFLE9BQU8sSUFBSSxDQUFDLFlBQVksQ0FBQyxXQUFXLENBQUM7UUFDdkMsQ0FBQzs7O09BQUE7SUFRRDs7T0FFRztJQUNJLHdDQUFLLEdBQVosVUFBYSxJQUFjO1FBQ3pCLElBQU0sV0FBVyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDekMsSUFBTSxjQUFjLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixDQUFDLGlCQUFpQixDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUN0RixPQUFPLGNBQWMsQ0FBQyxNQUFNLENBQUM7SUFDL0IsQ0FBQztJQUVEOztPQUVHO0lBQ0ksc0NBQUcsR0FBVixVQUFXLElBQWM7UUFBekIsaUJBV0M7UUFWQyxJQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3pDLElBQU0sY0FBYyxH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Y2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBGcmFtZUNvbnRleHQsIEJpbmRpbmdEYXRhLCBCaW5kaW5nTGlzdCwgQmluZGluZ09iamVjdCB9IGZyb20gJ0BmYXJyaXMvZGV2a2l0JztcbmltcG9ydCB7IEVudGl0eVRyYXZlcnNpbmdTZXJ2aWNlIH0gZnJvbSAnLi9lbnRpdHktdHJhdmVyc2luZy5zZXJ2aWNlJztcblxuaW50ZXJmYWNlIFNwbGl0ZWRQYXRoIHtcbiAgbGlzdFBhdGg6IHN0cmluZ1tdO1xuICBwcm9wUGF0aDogc3RyaW5nW107XG59XG5cbi8qKlxuICog5a6e5L2T6IGa5ZCI5pyN5YqhXG4gKi9cbkBJbmplY3RhYmxlKClcbmNsYXNzIEVudGl0eUFnZ3JlZ2F0aW9uU2VydmljZSB7XG5cbiAgcHJpdmF0ZSBnZXQgYmluZGluZ0RhdGEoKTogQmluZGluZ0RhdGEge1xuICAgIHJldHVybiB0aGlzLmZyYW1lQ29udGV4dC5iaW5kaW5nRGF0YTtcbiAgfVxuXG4gIHByaXZhdGUgdHJhdmVyc2luZ1NlcnZpY2U6IEVudGl0eVRyYXZlcnNpbmdTZXJ2aWNlO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgZnJhbWVDb250ZXh0OiBGcmFtZUNvbnRleHQpIHtcbiAgICB0aGlzLnRyYXZlcnNpbmdTZXJ2aWNlICAgPSB0aGlzLmZyYW1lQ29udGV4dC5pbmplY3Rvci5nZXQ8RW50aXR5VHJhdmVyc2luZ1NlcnZpY2U+KEVudGl0eVRyYXZlcnNpbmdTZXJ2aWNlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5ZwYXRo5a+55bqU5YiX6KGo6K6w5b2V55qE5p2h5pWwXG4gICAqL1xuICBwdWJsaWMgY291bnQocGF0aDogc3RyaW5nW10pOiBudW1iZXIge1xuICAgIGNvbnN0IHNwbGl0ZWRQYXRoID0gdGhpcy5zcGxpdFBhdGgocGF0aCk7XG4gICAgY29uc3QgZW50aXR5TGlzdERhdGEgPSB0aGlzLnRyYXZlcnNpbmdTZXJ2aWNlLmdldEVudGl0eUxpc3REYXRhKHNwbGl0ZWRQYXRoLmxpc3RQYXRoKTtcbiAgICByZXR1cm4gZW50aXR5TGlzdERhdGEubGVuZ3RoO1xuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPlnBhdGjlr7nlupTlrZfmrrXnmoTlkoxcbiAgICovXG4gIHB1YmxpYyBzdW0ocGF0aDogc3RyaW5nW10pIHtcbiAgICBjb25zdCBzcGxpdGVkUGF0aCA9IHRoaXMuc3BsaXRQYXRoKHBhdGgpO1xuICAgIGNvbnN0IGVudGl0eUxpc3REYXRhID0gdGhpcy50cmF2ZXJzaW5nU2VydmljZS5nZXRFbnRpdHlMaXN0RGF0YShzcGxpdGVkUGF0aC5saXN0UGF0aCk7XG5cbiAgICBjb25zdCB0b3RhbCA9IGVudGl0eUxpc3REYXRhLnJlZHVjZSgoYWNjVG90YWw6IG51bWJlciwgZW50aXR5RGF0YTogYW55KSA9PiB7XG4gICAgICBsZXQgcHJvcFZhbHVlID0gcGFyc2VGbG9hdCh0aGlzLmdldFByb3BWYWx1ZShlbnRpdHlEYXRhLCBzcGxpdGVkUGF0aC5wcm9wUGF0aCkpO1xuICAgICAgcHJvcFZhbHVlID0gaXNOYU4ocHJvcFZhbHVlKSA/IDAgOiBwcm9wVmFsdWU7XG4gICAgICBhY2NUb3RhbCArPSBwcm9wVmFsdWU7XG4gICAgICByZXR1cm4gYWNjVG90YWw7XG4gICAgfSwgMCk7XG4gICAgcmV0dXJuIHRvdGFsO1xuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPlnBhdGjlr7nlupTlrZfmrrXnmoTlubPlnYflgLxcbiAgICovXG4gIHB1YmxpYyBhdmcocGF0aDogc3RyaW5nW10pIHtcbiAgICBjb25zdCBjb3VudCA9IHRoaXMuY291bnQocGF0aCk7XG4gICAgY29uc3QgdG90YWwgPSB0aGlzLnN1bShwYXRoKTtcbiAgICByZXR1cm4gY291bnQgIT09IDAgPyB0b3RhbCAvIGNvdW50IDogMDtcbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5ZwYXRo5a+55bqU5a2X5q6155qE5pyA5aSn5YC8XG4gICAqL1xuICBwdWJsaWMgbWF4KHBhdGg6IHN0cmluZ1tdKTogbnVtYmVyIHtcbiAgICBjb25zdCBzcGxpdGVkUGF0aCA9IHRoaXMuc3BsaXRQYXRoKHBhdGgpO1xuICAgIGNvbnN0IGVudGl0eUxpc3REYXRhID0gdGhpcy50cmF2ZXJzaW5nU2VydmljZS5nZXRFbnRpdHlMaXN0RGF0YShzcGxpdGVkUGF0aC5saXN0UGF0aCk7XG5cbiAgICBjb25zdCBtYXggPSAgZW50aXR5TGlzdERhdGEucmVkdWNlKChhY2NNYXg6IG51bWJlciwgZW50aXR5RGF0YTogYW55KSA9PiB7XG4gICAgICBjb25zdCBwcm9wVmFsdWUgPSBwYXJzZUZsb2F0KHRoaXMuZ2V0UHJvcFZhbHVlKGVudGl0eURhdGEsIHNwbGl0ZWRQYXRoLnByb3BQYXRoKSk7XG4gICAgICBpZiAoaXNOYU4ocHJvcFZhbHVlKSA9PT0gZmFsc2UgJiYgKCAhYWNjTWF4IHx8IHByb3BWYWx1ZSA+IGFjY01heCkpIHtcbiAgICAgICAgYWNjTWF4ID0gcHJvcFZhbHVlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGFjY01heDtcbiAgICB9LCBudWxsKTtcbiAgICByZXR1cm4gbWF4ID8gbWF4IDogMDtcbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5ZwYXRo5a+55bqU5a2X5q6155qE5pyA5bCP5YC8XG4gICAqL1xuICBwdWJsaWMgbWluKHBhdGg6IHN0cmluZ1tdKTogbnVtYmVyIHtcbiAgICBjb25zdCBzcGxpdGVkUGF0aCA9IHRoaXMuc3BsaXRQYXRoKHBhdGgpO1xuICAgIGNvbnN0IGVudGl0eUxpc3REYXRhID0gdGhpcy50cmF2ZXJzaW5nU2VydmljZS5nZXRFbnRpdHlMaXN0RGF0YShzcGxpdGVkUGF0aC5saXN0UGF0aCk7XG5cbiAgICBjb25zdCBtaW4gPSBlbnRpdHlMaXN0RGF0YS5yZWR1Y2UoKGFjY01pbjogbnVtYmVyLCBlbnRpdHlEYXRhOiBhbnkpID0+IHtcbiAgICAgIGNvbnN0IHByb3BWYWx1ZSA9IHBhcnNlRmxvYXQodGhpcy5nZXRQcm9wVmFsdWUoZW50aXR5RGF0YSwgc3BsaXRlZFBhdGgucHJvcFBhdGgpKTtcbiAgICAgIGlmIChpc05hTihwcm9wVmFsdWUpID09PSBmYWxzZSAmJiAoICFhY2NNaW4gfHwgcHJvcFZhbHVlIDwgYWNjTWluKSkge1xuICAgICAgICBhY2NNaW4gPSBwcm9wVmFsdWU7XG4gICAgICB9XG4gICAgICByZXR1cm4gYWNjTWluO1xuICAgIH0sIG51bGwpO1xuICAgIHJldHVybiBtaW4gPyBtaW4gOiAwO1xuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPluWxnuaAp+WAvFxuICAgKi9cbiAgcHJpdmF0ZSBnZXRQcm9wVmFsdWUoZW50aXR5RGF0YTogYW55LCBwYXRoOiBzdHJpbmdbXSkge1xuICAgIGxldCBjdXJyZW50RGF0YSA9IGVudGl0eURhdGE7XG4gICAgcGF0aC5mb3JFYWNoKChwYXRoSXRlbTogc3RyaW5nKSA9PiB7XG5cbiAgICAgIC8vIOaPkOWJjemAgOWHuueahOmDvemHjee9ruS4um51bGzvvIzkuLvopoHpkojlr7nlhbPogZTlr7nosaHmnKrotYvlgLzlnLrmma9cbiAgICAgIGlmICghY3VycmVudERhdGEpIHtcbiAgICAgICAgY3VycmVudERhdGEgPSBudWxsO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjdXJyZW50RGF0YSA9IGN1cnJlbnREYXRhW3BhdGhJdGVtXTtcbiAgICB9KTtcblxuICAgIHJldHVybiBjdXJyZW50RGF0YTtcbiAgfVxuXG4gIC8qKlxuICAgKiDliIbpmpTot6/lvoTvvIzliIbpmpTnrKbliJfooajot6/lvoTlkozlsZ7mgKfot6/lvoRcbiAgICogQHJldHVybiDlvaLlpoIge3BhcmVudExpc3RQYXRoOiBbXSwgcHJvcGVydHlQYXRoOiBbXX1cbiAgICovXG4gIHByaXZhdGUgc3BsaXRQYXRoKHBhdGg6IHN0cmluZ1tdKTogU3BsaXRlZFBhdGgge1xuICAgIGNvbnN0IGxpc3RQYXRoID0gcGF0aC5jb25jYXQoW10pO1xuICAgIGNvbnN0IHByb3BQYXRoID0gW107XG4gICAgbGV0IGN1cnJlbnROb2RlID0gdGhpcy5iaW5kaW5nRGF0YS5nZXRWYWx1ZShsaXN0UGF0aCk7XG4gICAgd2hpbGUgKGN1cnJlbnROb2RlIGluc3RhbmNlb2YgQmluZGluZ0xpc3QgIT09IHRydWUpIHtcbiAgICAgIGNvbnN0IHByb3BQYXRoSXRlbSA9IGxpc3RQYXRoLnBvcCgpO1xuICAgICAgaWYgKCFwcm9wUGF0aEl0ZW0pIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgcHJvcFBhdGgudW5zaGlmdChwcm9wUGF0aEl0ZW0pO1xuICAgICAgY3VycmVudE5vZGUgPSB0aGlzLmJpbmRpbmdEYXRhLmdldFZhbHVlKGxpc3RQYXRoKTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgbGlzdFBhdGg6IGxpc3RQYXRoLFxuICAgICAgcHJvcFBhdGg6IHByb3BQYXRoXG4gICAgfTtcbiAgfVxuXG59XG5cbmV4cG9ydCB7IEVudGl0eUFnZ3JlZ2F0aW9uU2VydmljZSB9O1xuIl19