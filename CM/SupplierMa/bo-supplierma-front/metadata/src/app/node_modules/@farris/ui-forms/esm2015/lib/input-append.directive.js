/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Directive, ElementRef, Renderer2, Injector, Input, Output, ViewContainerRef, NgZone } from '@angular/core';
import { EventEmitter } from '@angular/core';
export class InputAppendDirective {
    // private ngControl: NgControl;
    /**
     * @param {?} viewRef
     * @param {?} el
     * @param {?} render
     * @param {?} injector
     */
    constructor(viewRef, el, render, injector) {
        this.viewRef = viewRef;
        this.el = el;
        this.render = render;
        this.injector = injector;
        this._enableAppend = true;
        // 追加到哪个类型下 TextBox、MultiTextBox、 StaticText
        this.inputAppendControlType = 'InputGroup';
        // 根据类型不一样，在控件处于禁用、只读时，决定颜色是否可用
        // 有两种：按钮 button 文本 text
        this._appendType = 'button';
        // 追加的文本
        this._inputAppendText = '';
        // 模板
        // @Input() inputAppendTmpl: TemplateRef<any>;
        this._disabled = false;
        /*
            * 文本点击事件
            */
        this.inputAppendClickEvent = new EventEmitter();
        // 标记native的外层
        this.elWrapElement = null;
        // 标记元素
        this.appendWrapElement = null;
        // 暂时不用
        this.appendTextElement = null;
        this.clickHandler = null;
        this.disabledCls = 'f-state-disabled';
        this.ngZone = null;
        this.ngZone = this.injector.get(NgZone);
    }
    // 相当于启用禁用此功能
    /**
     * @param {?} value
     * @return {?}
     */
    set enableAppend(value) {
        if (value === '' || value) {
            this._enableAppend = true;
            // 需要
            if (!this.appendWrapElement) {
                this.createStruct();
            }
        }
        else {
            this._enableAppend = false;
            if (this.appendWrapElement) {
                this.resetStruct();
            }
        }
    }
    /**
     * @return {?}
     */
    get enableAppend() {
        return this._enableAppend;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set inputAppendType(value) {
        if (value) {
            if (['button', 'text'].findIndex((/**
             * @param {?} item
             * @return {?}
             */
            item => item == value)) < 0) {
                // 类型在支持范围内
                value = 'button';
            }
            if (value != this._appendType) {
                if (this.appendWrapElement) {
                    // 移除原来，追加新的
                    this.render.removeClass(this.appendWrapElement, 'input-append-' + this._appendType);
                    this.render.addClass(this.appendWrapElement, 'input-append-' + value);
                    if (this._appendType == 'button') {
                        // 原来是按钮
                        if (this.clickHandler) {
                            this.clickHandler();
                            this.clickHandler = null;
                        }
                    }
                    else {
                        this.clickHandler = this.render.listen(this.appendWrapElement, 'click', (/**
                         * @param {?} ev
                         * @return {?}
                         */
                        (ev) => {
                            this.inputAppendClickEvent.emit(ev);
                        }));
                    }
                }
                this._appendType = value;
            }
        }
    }
    /**
     * @return {?}
     */
    get inputAppendType() {
        return this._appendType;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set inputAppendText(value) {
        if (value != this._inputAppendText) {
            this._inputAppendText = value;
            if (this.appendWrapElement && this._enableAppend) {
                this.render.removeChild(this.appendWrapElement, this.appendTextElement);
                this.appendTextElement.innerHTML = value;
                this.render.appendChild(this.appendWrapElement, this.appendTextElement);
            }
            else {
                this.createStruct();
            }
        }
    }
    /**
     * @return {?}
     */
    get inputAppendText() {
        return this._inputAppendText;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set inputAppendDisabled(value) {
        if (value != this._disabled) {
            this._disabled = value;
            if (this.appendWrapElement) {
                value && this.render.addClass(this.appendWrapElement, this.disabledCls);
                !value && this.render.removeClass(this.appendWrapElement, this.disabledCls);
            }
        }
    }
    /**
     * @return {?}
     */
    get inputAppendDisabled() {
        return this._disabled;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        //this.ngControl = this.injector.get(NgControl, null);
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        this.createStruct();
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        //this.resetStruct();
        if (this.clickHandler) {
            this.clickHandler();
            this.clickHandler = null;
        }
        if (this.appendWrapElement) {
            this.appendWrapElement.remove();
            this.appendWrapElement = null;
        }
        if (this.elWrapElement) {
            this.elWrapElement.remove();
            this.elWrapElement = null;
        }
    }
    /**
     * 重置
     * @private
     * @return {?}
     */
    resetStruct() {
        if (this.clickHandler) {
            this.clickHandler();
            this.clickHandler = null;
        }
        // 分类型移除不同新增加的结构或样式
        switch (this.inputAppendControlType) {
            case 'StaticText':
                this.render.removeClass(this.el.nativeElement, 'f-cmp-static-text-input-append');
                break;
            case 'TextBox':
            case 'MultiTextBox':
                if (this.elWrapElement) {
                    /** @type {?} */
                    let wrapParent = this.render.parentNode(this.elWrapElement);
                    this.render.appendChild(wrapParent, this.el.nativeElement);
                    this.elWrapElement.remove();
                    this.elWrapElement = null;
                }
                break;
        }
        if (this.appendWrapElement) {
            this.appendWrapElement.remove();
            this.appendWrapElement = null;
        }
    }
    /**
     * 创建
     * @private
     * @return {?}
     */
    createStruct() {
        if (!this.inputAppendText || !this.enableAppend || this.appendWrapElement) {
            return;
        }
        /** @type {?} */
        const buttonWrap = this.render.createElement('div');
        buttonWrap.className = 'input-group-append input-append-wrapper';
        buttonWrap.className += ' input-append-' + this.inputAppendType;
        if (this._disabled) {
            buttonWrap.className += ' ' + this.disabledCls;
        }
        /** @type {?} */
        const buttonTextWrap = this.render.createElement('div');
        buttonTextWrap.className = 'input-group-text';
        buttonTextWrap.innerHTML = this.inputAppendText;
        this.appendTextElement = buttonTextWrap;
        this.appendWrapElement = buttonWrap;
        this.render.appendChild(buttonWrap, buttonTextWrap);
        switch (this.inputAppendControlType) {
            case 'StaticText':
                // 此时还没有生成内部的样式
                // let textareaEl = this.el.nativeElement.querySelector('.f-form-control-textarea');
                this.render.addClass(this.el.nativeElement, 'f-cmp-static-text-input-append' + (this._disabled ? ' ' + this.disabledCls : ''));
                this.render.appendChild(this.el.nativeElement, buttonWrap);
                break;
            case 'TextBox':
            case 'MultiTextBox':
                /** @type {?} */
                let textParent = this.render.parentNode(this.el.nativeElement);
                /** @type {?} */
                const inputWrap = this.render.createElement('div');
                inputWrap.className = 'f-cmp-text-input-append' + (this._disabled ? ' ' + this.disabledCls : '');
                if (this.el.nativeElement.outerHTML.indexOf('textarea') > -1) {
                    inputWrap.className = 'f-cmp-textarea-input-append' + (this._disabled ? ' ' + this.disabledCls : '');
                }
                this.elWrapElement = inputWrap;
                this.render.appendChild(inputWrap, this.el.nativeElement);
                this.render.appendChild(inputWrap, buttonWrap);
                this.render.appendChild(textParent, inputWrap);
                break;
            default:
                // 存在类似下拉这样的控件，内部调用input-group结构还没有初始化
                /** @type {?} */
                let inputGroupEl = this.el.nativeElement.querySelector('.input-group');
                if (inputGroupEl) {
                    this.render.appendChild(inputGroupEl, buttonWrap);
                }
                else {
                    if (this.ngZone) {
                        this.ngZone.runOutsideAngular((/**
                         * @return {?}
                         */
                        () => {
                            setTimeout((/**
                             * @return {?}
                             */
                            () => {
                                /** @type {?} */
                                let inputGroupEl2 = this.el.nativeElement.querySelector('.input-group');
                                this.render.appendChild(inputGroupEl2, buttonWrap);
                            }));
                        }));
                    }
                }
        }
        if (this.inputAppendType == 'button') {
            this.clickHandler = this.render.listen(this.appendWrapElement, 'click', (/**
             * @param {?} ev
             * @return {?}
             */
            (ev) => {
                this.inputAppendClickEvent.emit(ev);
            }));
        }
    }
}
InputAppendDirective.decorators = [
    { type: Directive, args: [{
                selector: '[input-append]',
            },] }
];
/** @nocollapse */
InputAppendDirective.ctorParameters = () => [
    { type: ViewContainerRef },
    { type: ElementRef },
    { type: Renderer2 },
    { type: Injector }
];
InputAppendDirective.propDecorators = {
    enableAppend: [{ type: Input, args: ['input-append',] }],
    inputAppendControlType: [{ type: Input }],
    inputAppendType: [{ type: Input }],
    inputAppendText: [{ type: Input }],
    inputAppendDisabled: [{ type: Input }],
    inputAppendClickEvent: [{ type: Output }]
};
if (false) {
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype._enableAppend;
    /** @type {?} */
    InputAppendDirective.prototype.inputAppendControlType;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype._appendType;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype._inputAppendText;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype._disabled;
    /** @type {?} */
    InputAppendDirective.prototype.inputAppendClickEvent;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype.elWrapElement;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype.appendWrapElement;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype.appendTextElement;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype.clickHandler;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype.disabledCls;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype.ngZone;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype.viewRef;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype.el;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype.render;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5wdXQtYXBwZW5kLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktZm9ybXMvIiwic291cmNlcyI6WyJsaWIvaW5wdXQtYXBwZW5kLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUNILFNBQVMsRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFFLFFBQVEsRUFBVSxLQUFLLEVBQ0wsTUFBTSxFQUFFLGdCQUFnQixFQUFlLE1BQU0sRUFDcEcsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQU03QyxNQUFNLE9BQU8sb0JBQW9COzs7Ozs7OztJQTJHN0IsWUFBb0IsT0FBeUIsRUFBVSxFQUFjLEVBQVUsTUFBaUIsRUFBVSxRQUFrQjtRQUF4RyxZQUFPLEdBQVAsT0FBTyxDQUFrQjtRQUFVLE9BQUUsR0FBRixFQUFFLENBQVk7UUFBVSxXQUFNLEdBQU4sTUFBTSxDQUFXO1FBQVUsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQTFHcEgsa0JBQWEsR0FBRyxJQUFJLENBQUM7O1FBcUJwQiwyQkFBc0IsR0FBRyxZQUFZLENBQUM7OztRQUd2QyxnQkFBVyxHQUFHLFFBQVEsQ0FBQzs7UUFrQ3ZCLHFCQUFnQixHQUFHLEVBQUUsQ0FBQzs7O1FBbUJ0QixjQUFTLEdBQUcsS0FBSyxDQUFDOzs7O1FBa0JoQiwwQkFBcUIsR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDOztRQUU3QyxrQkFBYSxHQUFHLElBQUksQ0FBQzs7UUFFckIsc0JBQWlCLEdBQUcsSUFBSSxDQUFDOztRQUV6QixzQkFBaUIsR0FBRyxJQUFJLENBQUM7UUFDekIsaUJBQVksR0FBRyxJQUFJLENBQUM7UUFDcEIsZ0JBQVcsR0FBRyxrQkFBa0IsQ0FBQztRQUNqQyxXQUFNLEdBQVcsSUFBSSxDQUFDO1FBRzFCLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFH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O0lBQzVCLDJDQUF5Qzs7Ozs7SUFDekMsc0NBQThCOzs7OztJQUVsQix1Q0FBaUM7Ozs7O0lBQUUsa0NBQXNCOzs7OztJQUFFLHNDQUF5Qjs7Ozs7SUFBRSx3Q0FBMEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xyXG4gICAgRGlyZWN0aXZlLCBFbGVtZW50UmVmLCBSZW5kZXJlcjIsIEluamVjdG9yLCBPbkluaXQsIElucHV0LFxyXG4gICAgQWZ0ZXJWaWV3SW5pdCwgT25EZXN0cm95LCBPbkNoYW5nZXMsIFNpbXBsZUNoYW5nZXMsIE91dHB1dCwgVmlld0NvbnRhaW5lclJlZiwgVGVtcGxhdGVSZWYsIE5nWm9uZVxyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBFdmVudEVtaXR0ZXIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuXHJcblxyXG5ARGlyZWN0aXZlKHtcclxuICAgIHNlbGVjdG9yOiAnW2lucHV0LWFwcGVuZF0nLFxyXG59KVxyXG5leHBvcnQgY2xhc3MgSW5wdXRBcHBlbmREaXJlY3RpdmUgaW1wbGVtZW50cyBPbkluaXQsIEFmdGVyVmlld0luaXQsIE9uRGVzdHJveSB7XHJcbiAgICBwcml2YXRlIF9lbmFibGVBcHBlbmQgPSB0cnVlO1xyXG4gICAgLy8g55u45b2T5LqO5ZCv55So56aB55So5q2k5Yqf6IO9XHJcbiAgICBASW5wdXQoJ2lucHV0LWFwcGVuZCcpXHJcbiAgICBzZXQgZW5hYmxlQXBwZW5kKHZhbHVlOiBzdHJpbmcgfCBib29sZWFuKSB7XHJcbiAgICAgICAgaWYgKHZhbHVlID09PSAnJyB8fCB2YWx1ZSkge1xyXG4gICAgICAgICAgICB0aGlzLl9lbmFibGVBcHBlbmQgPSB0cnVlO1xyXG4gICAgICAgICAgICAvLyDpnIDopoFcclxuICAgICAgICAgICAgaWYgKCF0aGlzLmFwcGVuZFdyYXBFbGVtZW50KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZVN0cnVjdCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5fZW5hYmxlQXBwZW5kID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmFwcGVuZFdyYXBFbGVtZW50KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlc2V0U3RydWN0KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBnZXQgZW5hYmxlQXBwZW5kKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9lbmFibGVBcHBlbmQ7XHJcbiAgICB9XHJcbiAgICAvLyDov73liqDliLDlk6rkuKrnsbvlnovkuIsgVGV4dEJveOOAgU11bHRpVGV4dEJveOOAgSBTdGF0aWNUZXh0XHJcbiAgICBASW5wdXQoKSBpbnB1dEFwcGVuZENvbnRyb2xUeXBlID0gJ0lucHV0R3JvdXAnO1xyXG4gICAgLy8g5qC55o2u57G75Z6L5LiN5LiA5qC377yM5Zyo5o6n5Lu25aSE5LqO56aB55So44CB5Y+q6K+75pe277yM5Yaz5a6a6aKc6Imy5piv5ZCm5Y+v55SoXHJcbiAgICAvLyDmnInkuKTnp43vvJrmjInpkq4gYnV0dG9uIOaWh+acrCB0ZXh0XHJcbiAgICBwcml2YXRlIF9hcHBlbmRUeXBlID0gJ2J1dHRvbic7XHJcbiAgICBASW5wdXQoKVxyXG4gICAgc2V0IGlucHV0QXBwZW5kVHlwZSh2YWx1ZTogc3RyaW5nKSB7XHJcbiAgICAgICAgaWYgKHZhbHVlKSB7XHJcbiAgICAgICAgICAgIGlmIChbJ2J1dHRvbicsICd0ZXh0J10uZmluZEluZGV4KGl0ZW0gPT4gaXRlbSA9PSB2YWx1ZSkgPCAwKSB7XHJcbiAgICAgICAgICAgICAgICAvLyDnsbvlnovlnKjmlK/mjIHojIPlm7TlhoVcclxuICAgICAgICAgICAgICAgIHZhbHVlID0gJ2J1dHRvbic7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHZhbHVlICE9IHRoaXMuX2FwcGVuZFR5cGUpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmFwcGVuZFdyYXBFbGVtZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8g56e76Zmk5Y6f5p2l77yM6L+95Yqg5paw55qEXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIucmVtb3ZlQ2xhc3ModGhpcy5hcHBlbmRXcmFwRWxlbWVudCwgJ2lucHV0LWFwcGVuZC0nICsgdGhpcy5fYXBwZW5kVHlwZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIuYWRkQ2xhc3ModGhpcy5hcHBlbmRXcmFwRWxlbWVudCwgJ2lucHV0LWFwcGVuZC0nICsgdmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9hcHBlbmRUeXBlID09ICdidXR0b24nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOWOn+adpeaYr+aMiemSrlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jbGlja0hhbmRsZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2xpY2tIYW5kbGVyKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsaWNrSGFuZGxlciA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsaWNrSGFuZGxlciA9IHRoaXMucmVuZGVyLmxpc3Rlbih0aGlzLmFwcGVuZFdyYXBFbGVtZW50LCAnY2xpY2snLCAoZXYpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5wdXRBcHBlbmRDbGlja0V2ZW50LmVtaXQoZXYpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9hcHBlbmRUeXBlID0gdmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG4gICAgZ2V0IGlucHV0QXBwZW5kVHlwZSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fYXBwZW5kVHlwZTtcclxuICAgIH1cclxuICAgIC8vIOi/veWKoOeahOaWh+acrFxyXG4gICAgcHJpdmF0ZSBfaW5wdXRBcHBlbmRUZXh0ID0gJyc7XHJcbiAgICBASW5wdXQoKVxyXG4gICAgc2V0IGlucHV0QXBwZW5kVGV4dCh2YWx1ZTogc3RyaW5nKSB7XHJcbiAgICAgICAgaWYgKHZhbHVlICE9IHRoaXMuX2lucHV0QXBwZW5kVGV4dCkge1xyXG4gICAgICAgICAgICB0aGlzLl9pbnB1dEFwcGVuZFRleHQgPSB2YWx1ZTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuYXBwZW5kV3JhcEVsZW1lbnQgJiYgdGhpcy5fZW5hYmxlQXBwZW5kKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5yZW1vdmVDaGlsZCh0aGlzLmFwcGVuZFdyYXBFbGVtZW50LCB0aGlzLmFwcGVuZFRleHRFbGVtZW50KTtcclxuICAgICAgICAgICAgICAgIHRoaXMuYXBwZW5kVGV4dEVsZW1lbnQuaW5uZXJIVE1MID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5hcHBlbmRDaGlsZCh0aGlzLmFwcGVuZFdyYXBFbGVtZW50LCB0aGlzLmFwcGVuZFRleHRFbGVtZW50KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlU3RydWN0KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBnZXQgaW5wdXRBcHBlbmRUZXh0KCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9pbnB1dEFwcGVuZFRleHQ7XHJcbiAgICB9XHJcbiAgICAvLyDmqKHmnb9cclxuICAgIC8vIEBJbnB1dCgpIGlucHV0QXBwZW5kVG1wbDogVGVtcGxhdGVSZWY8YW55PjtcclxuICAgIHByaXZhdGUgX2Rpc2FibGVkID0gZmFsc2U7XHJcbiAgICBASW5wdXQoKVxyXG4gICAgc2V0IGlucHV0QXBwZW5kRGlzYWJsZWQodmFsdWUpIHtcclxuICAgICAgICBpZiAodmFsdWUgIT0gdGhpcy5fZGlzYWJsZWQpIHtcclxuICAgICAgICAgICAgdGhpcy5fZGlzYWJsZWQgPSB2YWx1ZTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuYXBwZW5kV3JhcEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgIHZhbHVlICYmIHRoaXMucmVuZGVyLmFkZENsYXNzKHRoaXMuYXBwZW5kV3JhcEVsZW1lbnQsIHRoaXMuZGlzYWJsZWRDbHMpO1xyXG4gICAgICAgICAgICAgICAgIXZhbHVlICYmIHRoaXMucmVuZGVyLnJlbW92ZUNsYXNzKHRoaXMuYXBwZW5kV3JhcEVsZW1lbnQsIHRoaXMuZGlzYWJsZWRDbHMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgZ2V0IGlucHV0QXBwZW5kRGlzYWJsZWQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2Rpc2FibGVkO1xyXG4gICAgfVxyXG5cclxuICAgIC8qXHJcbiAgICAqIOaWh+acrOeCueWHu+S6i+S7tlxyXG4gICAgKi9cclxuICAgIEBPdXRwdXQoKSBpbnB1dEFwcGVuZENsaWNrRXZlbnQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgICAvLyDmoIforrBuYXRpdmXnmoTlpJblsYJcclxuICAgIHByaXZhdGUgZWxXcmFwRWxlbWVudCA9IG51bGw7XHJcbiAgICAvLyDmoIforrDlhYPntKBcclxuICAgIHByaXZhdGUgYXBwZW5kV3JhcEVsZW1lbnQgPSBudWxsO1xyXG4gICAgLy8g5pqC5pe25LiN55SoXHJcbiAgICBwcml2YXRlIGFwcGVuZFRleHRFbGVtZW50ID0gbnVsbDtcclxuICAgIHByaXZhdGUgY2xpY2tIYW5kbGVyID0gbnVsbDtcclxuICAgIHByaXZhdGUgZGlzYWJsZWRDbHMgPSAnZi1zdGF0ZS1kaXNhYmxlZCc7XHJcbiAgICBwcml2YXRlIG5nWm9uZTogTmdab25lID0gbnVsbDtcclxuICAgIC8vIHByaXZhdGUgbmdDb250cm9sOiBOZ0NvbnRyb2w7XHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHZpZXdSZWY6IFZpZXdDb250YWluZXJSZWYsIHByaXZhdGUgZWw6IEVsZW1lbnRSZWYsIHByaXZhdGUgcmVuZGVyOiBSZW5kZXJlcjIsIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yKSB7XHJcbiAgICAgICAgdGhpcy5uZ1pvbmUgPSB0aGlzLmluamVjdG9yLmdldChOZ1pvbmUpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCkge1xyXG4gICAgICAgIC8vdGhpcy5uZ0NvbnRyb2wgPSB0aGlzLmluamVjdG9yLmdldChOZ0NvbnRyb2wsIG51bGwpO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBuZ0FmdGVyVmlld0luaXQoKSB7XHJcbiAgICAgICAgdGhpcy5jcmVhdGVTdHJ1Y3QoKTtcclxuICAgIH1cclxuXHJcbiAgICBuZ09uRGVzdHJveSgpIHtcclxuICAgICAgICAvL3RoaXMucmVzZXRTdHJ1Y3QoKTtcclxuICAgICAgICBpZiAodGhpcy5jbGlja0hhbmRsZXIpIHtcclxuICAgICAgICAgICAgdGhpcy5jbGlja0hhbmRsZXIoKTtcclxuICAgICAgICAgICAgdGhpcy5jbGlja0hhbmRsZXIgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5hcHBlbmRXcmFwRWxlbWVudCkge1xyXG4gICAgICAgICAgICB0aGlzLmFwcGVuZFdyYXBFbGVtZW50LnJlbW92ZSgpO1xyXG4gICAgICAgICAgICB0aGlzLmFwcGVuZFdyYXBFbGVtZW50ID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuZWxXcmFwRWxlbWVudCkge1xyXG4gICAgICAgICAgICB0aGlzLmVsV3JhcEVsZW1lbnQucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuZWxXcmFwRWxlbWVudCA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDph43nva5cclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSByZXNldFN0cnVjdCgpIHtcclxuICAgICAgICBpZiAodGhpcy5jbGlja0hhbmRsZXIpIHtcclxuICAgICAgICAgICAgdGhpcy5jbGlja0hhbmRsZXIoKTtcclxuICAgICAgICAgICAgdGhpcy5jbGlja0hhbmRsZXIgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyDliIbnsbvlnovnp7vpmaTkuI3lkIzmlrDlop7liqDnmoTnu5PmnoTmiJbmoLflvI9cclxuICAgICAgICBzd2l0Y2ggKHRoaXMuaW5wdXRBcHBlbmRDb250cm9sVHlwZSkge1xyXG4gICAgICAgICAgICBjYXNlICdTdGF0aWNUZXh0JzpcclxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyLnJlbW92ZUNsYXNzKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgJ2YtY21wLXN0YXRpYy10ZXh0LWlucHV0LWFwcGVuZCcpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ1RleHRCb3gnOlxyXG4gICAgICAgICAgICBjYXNlICdNdWx0aVRleHRCb3gnOlxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZWxXcmFwRWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCB3cmFwUGFyZW50ID0gdGhpcy5yZW5kZXIucGFyZW50Tm9kZSh0aGlzLmVsV3JhcEVsZW1lbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyLmFwcGVuZENoaWxkKHdyYXBQYXJlbnQsIHRoaXMuZWwubmF0aXZlRWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbFdyYXBFbGVtZW50LnJlbW92ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZWxXcmFwRWxlbWVudCA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuYXBwZW5kV3JhcEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgdGhpcy5hcHBlbmRXcmFwRWxlbWVudC5yZW1vdmUoKTtcclxuICAgICAgICAgICAgdGhpcy5hcHBlbmRXcmFwRWxlbWVudCA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDliJvlu7pcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBjcmVhdGVTdHJ1Y3QoKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmlucHV0QXBwZW5kVGV4dCB8fCAhdGhpcy5lbmFibGVBcHBlbmQgfHwgdGhpcy5hcHBlbmRXcmFwRWxlbWVudCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGJ1dHRvbldyYXAgPSB0aGlzLnJlbmRlci5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICBidXR0b25XcmFwLmNsYXNzTmFtZSA9ICdpbnB1dC1ncm91cC1hcHBlbmQgaW5wdXQtYXBwZW5kLXdyYXBwZXInO1xyXG4gICAgICAgIGJ1dHRvbldyYXAuY2xhc3NOYW1lICs9ICcgaW5wdXQtYXBwZW5kLScgKyB0aGlzLmlucHV0QXBwZW5kVHlwZTtcclxuICAgICAgICBpZiAodGhpcy5fZGlzYWJsZWQpIHtcclxuICAgICAgICAgICAgYnV0dG9uV3JhcC5jbGFzc05hbWUgKz0gJyAnICsgdGhpcy5kaXNhYmxlZENscztcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgYnV0dG9uVGV4dFdyYXAgPSB0aGlzLnJlbmRlci5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICBidXR0b25UZXh0V3JhcC5jbGFzc05hbWUgPSAnaW5wdXQtZ3JvdXAtdGV4dCc7XHJcbiAgICAgICAgYnV0dG9uVGV4dFdyYXAuaW5uZXJIVE1MID0gdGhpcy5pbnB1dEFwcGVuZFRleHQ7XHJcbiAgICAgICAgdGhpcy5hcHBlbmRUZXh0RWxlbWVudCA9IGJ1dHRvblRleHRXcmFwO1xyXG4gICAgICAgIHRoaXMuYXBwZW5kV3JhcEVsZW1lbnQgPSBidXR0b25XcmFwO1xyXG4gICAgICAgIHRoaXMucmVuZGVyLmFwcGVuZENoaWxkKGJ1dHRvbldyYXAsIGJ1dHRvblRleHRXcmFwKTtcclxuICAgICAgICBzd2l0Y2ggKHRoaXMuaW5wdXRBcHBlbmRDb250cm9sVHlwZSkge1xyXG4gICAgICAgICAgICBjYXNlICdTdGF0aWNUZXh0JzpcclxuICAgICAgICAgICAgICAgIC8vIOatpOaXtui/mOayoeacieeUn+aIkOWGhemDqOeahOagt+W8j1xyXG4gICAgICAgICAgICAgICAgLy8gbGV0IHRleHRhcmVhRWwgPSB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcignLmYtZm9ybS1jb250cm9sLXRleHRhcmVhJyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5hZGRDbGFzcyh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsICdmLWNtcC1zdGF0aWMtdGV4dC1pbnB1dC1hcHBlbmQnICsgKHRoaXMuX2Rpc2FibGVkID8gJyAnICsgdGhpcy5kaXNhYmxlZENscyA6ICcnKSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5hcHBlbmRDaGlsZCh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsIGJ1dHRvbldyYXApO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ1RleHRCb3gnOlxyXG4gICAgICAgICAgICBjYXNlICdNdWx0aVRleHRCb3gnOlxyXG4gICAgICAgICAgICAgICAgbGV0IHRleHRQYXJlbnQgPSB0aGlzLnJlbmRlci5wYXJlbnROb2RlKHRoaXMuZWwubmF0aXZlRWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBpbnB1dFdyYXAgPSB0aGlzLnJlbmRlci5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICAgICAgICAgIGlucHV0V3JhcC5jbGFzc05hbWUgPSAnZi1jbXAtdGV4dC1pbnB1dC1hcHBlbmQnICsgKHRoaXMuX2Rpc2FibGVkID8gJyAnICsgdGhpcy5kaXNhYmxlZENscyA6ICcnKTtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQub3V0ZXJIVE1MLmluZGV4T2YoJ3RleHRhcmVhJykgPiAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlucHV0V3JhcC5jbGFzc05hbWUgPSAnZi1jbXAtdGV4dGFyZWEtaW5wdXQtYXBwZW5kJyArICh0aGlzLl9kaXNhYmxlZCA/ICcgJyArIHRoaXMuZGlzYWJsZWRDbHMgOiAnJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLmVsV3JhcEVsZW1lbnQgPSBpbnB1dFdyYXA7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5hcHBlbmRDaGlsZChpbnB1dFdyYXAsIHRoaXMuZWwubmF0aXZlRWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5hcHBlbmRDaGlsZChpbnB1dFdyYXAsIGJ1dHRvbldyYXApO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIuYXBwZW5kQ2hpbGQodGV4dFBhcmVudCwgaW5wdXRXcmFwKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgLy8g5a2Y5Zyo57G75Ly85LiL5ouJ6L+Z5qC355qE5o6n5Lu277yM5YaF6YOo6LCD55SoaW5wdXQtZ3JvdXDnu5PmnoTov5jmsqHmnInliJ3lp4vljJZcclxuICAgICAgICAgICAgICAgIGxldCBpbnB1dEdyb3VwRWwgPSB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcignLmlucHV0LWdyb3VwJyk7XHJcbiAgICAgICAgICAgICAgICBpZiAoaW5wdXRHcm91cEVsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIuYXBwZW5kQ2hpbGQoaW5wdXRHcm91cEVsLCBidXR0b25XcmFwKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMubmdab25lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBpbnB1dEdyb3VwRWwyID0gdGhpcy5lbC5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5pbnB1dC1ncm91cCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyLmFwcGVuZENoaWxkKGlucHV0R3JvdXBFbDIsIGJ1dHRvbldyYXApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5pbnB1dEFwcGVuZFR5cGUgPT0gJ2J1dHRvbicpIHtcclxuICAgICAgICAgICAgdGhpcy5jbGlja0hhbmRsZXIgPSB0aGlzLnJlbmRlci5saXN0ZW4odGhpcy5hcHBlbmRXcmFwRWxlbWVudCwgJ2NsaWNrJywgKGV2KSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlucHV0QXBwZW5kQ2xpY2tFdmVudC5lbWl0KGV2KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiJdfQ==