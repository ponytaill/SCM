!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/router"),require("@farris/ui-common"),require("@angular/core"),require("@angular/common"),require("@angular/forms")):"function"==typeof define&&define.amd?define("@farris/ui-editor",["exports","@angular/router","@farris/ui-common","@angular/core","@angular/common","@angular/forms"],e):e((t.farris=t.farris||{},t.farris["ui-editor"]={}),t.ng.router,t.uiCommon,t.ng.core,t.ng.common,t.ng.forms)}(this,function(t,s,e,a,n,i){"use strict";var u=(o.decorators=[{type:a.Injectable,args:[{providedIn:"root"}]}],o.ctorParameters=function(){return[]},o.ngInjectableDef=a.defineInjectable({factory:function(){return new o},token:o,providedIn:"root"}),o);function o(){}var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};var l=function(){return(l=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},d=function(){var t="undefined"!=typeof window?window:undefined;return t&&t.tinymce?t.tinymce:null},p=(c.propDecorators={onBeforePaste:[{type:a.Output}],onBlur:[{type:a.Output}],onClick:[{type:a.Output}],onContextMenu:[{type:a.Output}],onCopy:[{type:a.Output}],onCut:[{type:a.Output}],onDblclick:[{type:a.Output}],onDrag:[{type:a.Output}],onDragDrop:[{type:a.Output}],onDragEnd:[{type:a.Output}],onDragGesture:[{type:a.Output}],onDragOver:[{type:a.Output}],onDrop:[{type:a.Output}],onFocus:[{type:a.Output}],onFocusIn:[{type:a.Output}],onFocusOut:[{type:a.Output}],onKeyDown:[{type:a.Output}],onKeyPress:[{type:a.Output}],onKeyUp:[{type:a.Output}],onMouseDown:[{type:a.Output}],onMouseEnter:[{type:a.Output}],onMouseLeave:[{type:a.Output}],onMouseMove:[{type:a.Output}],onMouseOut:[{type:a.Output}],onMouseOver:[{type:a.Output}],onMouseUp:[{type:a.Output}],onPaste:[{type:a.Output}],onSelectionChange:[{type:a.Output}],onActivate:[{type:a.Output}],onAddUndo:[{type:a.Output}],onBeforeAddUndo:[{type:a.Output}],onBeforeExecCommand:[{type:a.Output}],onBeforeGetContent:[{type:a.Output}],onBeforeRenderUI:[{type:a.Output}],onBeforeSetContent:[{type:a.Output}],onChange:[{type:a.Output}],onClearUndos:[{type:a.Output}],onDeactivate:[{type:a.Output}],onDirty:[{type:a.Output}],onExecCommand:[{type:a.Output}],onGetContent:[{type:a.Output}],onHide:[{type:a.Output}],onInit:[{type:a.Output}],onLoadContent:[{type:a.Output}],onNodeChange:[{type:a.Output}],onPostProcess:[{type:a.Output}],onPostRender:[{type:a.Output}],onPreInit:[{type:a.Output}],onPreProcess:[{type:a.Output}],onProgressState:[{type:a.Output}],onRedo:[{type:a.Output}],onRemove:[{type:a.Output}],onReset:[{type:a.Output}],onSaveContent:[{type:a.Output}],onSetAttrib:[{type:a.Output}],onObjectResizeStart:[{type:a.Output}],onObjectResized:[{type:a.Output}],onObjectSelected:[{type:a.Output}],onSetContent:[{type:a.Output}],onShow:[{type:a.Output}],onSubmit:[{type:a.Output}],onUndo:[{type:a.Output}],onVisualAid:[{type:a.Output}]},c);function c(){this.onBeforePaste=new a.EventEmitter,this.onBlur=new a.EventEmitter,this.onClick=new a.EventEmitter,this.onContextMenu=new a.EventEmitter,this.onCopy=new a.EventEmitter,this.onCut=new a.EventEmitter,this.onDblclick=new a.EventEmitter,this.onDrag=new a.EventEmitter,this.onDragDrop=new a.EventEmitter,this.onDragEnd=new a.EventEmitter,this.onDragGesture=new a.EventEmitter,this.onDragOver=new a.EventEmitter,this.onDrop=new a.EventEmitter,this.onFocus=new a.EventEmitter,this.onFocusIn=new a.EventEmitter,this.onFocusOut=new a.EventEmitter,this.onKeyDown=new a.EventEmitter,this.onKeyPress=new a.EventEmitter,this.onKeyUp=new a.EventEmitter,this.onMouseDown=new a.EventEmitter,this.onMouseEnter=new a.EventEmitter,this.onMouseLeave=new a.EventEmitter,this.onMouseMove=new a.EventEmitter,this.onMouseOut=new a.EventEmitter,this.onMouseOver=new a.EventEmitter,this.onMouseUp=new a.EventEmitter,this.onPaste=new a.EventEmitter,this.onSelectionChange=new a.EventEmitter,this.onActivate=new a.EventEmitter,this.onAddUndo=new a.EventEmitter,this.onBeforeAddUndo=new a.EventEmitter,this.onBeforeExecCommand=new a.EventEmitter,this.onBeforeGetContent=new a.EventEmitter,this.onBeforeRenderUI=new a.EventEmitter,this.onBeforeSetContent=new a.EventEmitter,this.onChange=new a.EventEmitter,this.onClearUndos=new a.EventEmitter,this.onDeactivate=new a.EventEmitter,this.onDirty=new a.EventEmitter,this.onExecCommand=new a.EventEmitter,this.onGetContent=new a.EventEmitter,this.onHide=new a.EventEmitter,this.onInit=new a.EventEmitter,this.onLoadContent=new a.EventEmitter,this.onNodeChange=new a.EventEmitter,this.onPostProcess=new a.EventEmitter,this.onPostRender=new a.EventEmitter,this.onPreInit=new a.EventEmitter,this.onPreProcess=new a.EventEmitter,this.onProgressState=new a.EventEmitter,this.onRedo=new a.EventEmitter,this.onRemove=new a.EventEmitter,this.onReset=new a.EventEmitter,this.onSaveContent=new a.EventEmitter,this.onSetAttrib=new a.EventEmitter,this.onObjectResizeStart=new a.EventEmitter,this.onObjectResized=new a.EventEmitter,this.onObjectSelected=new a.EventEmitter,this.onSetContent=new a.EventEmitter,this.onShow=new a.EventEmitter,this.onSubmit=new a.EventEmitter,this.onUndo=new a.EventEmitter,this.onVisualAid=new a.EventEmitter}var h,m,f=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],y=function(n,i){f.forEach(function(t){var e=n[t];i.on(t.substring(2),function(t){return n.ngZone.run(function(){return e.emit({event:t,editor:i})})})})},E=0,g=function(t){var e=(new Date).getTime();return t+"_"+Math.floor(1e9*Math.random())+ ++E+String(e)},v=function(t){return void 0!==t&&"textarea"===t.tagName.toLowerCase()},_=function(t){return void 0===t||""===t?[]:Array.isArray(t)?t:t.split(" ")},b=function(t,e){return _(t).concat(_(e))},O=function(){},w=function(t){return null===t||t===undefined},C=function(){return{listeners:[],scriptId:g("tiny-script"),scriptLoaded:!1}},P=(h=C(),{load:function(t,e,n){h.scriptLoaded?n():(h.listeners.push(n),t.getElementById(h.scriptId)||function(t,e,n,i){var o=e.createElement("script");o.referrerPolicy="origin",o.type="application/javascript",o.id=t,o.src=n;var r=function(){o.removeEventListener("load",r),i()};o.addEventListener("load",r),e.head&&e.head.appendChild(o)}(h.scriptId,t,e,function(){h.listeners.forEach(function(t){return t()}),h.scriptLoaded=!0}))},reinitialize:function(){h=C()}}),S=new a.InjectionToken("TINYMCE_SCRIPT_SRC"),I={provide:i.NG_VALUE_ACCESSOR,useExisting:a.forwardRef(function(){return F}),multi:!0},F=(function R(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(M,m=p),Object.defineProperty(M.prototype,"disabledClass",{get:function(){return this._disabled},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"readonlyClass",{get:function(){return this._readOnly},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"disabled",{get:function(){return this._disabled},set:function(t){this._disabled=t,this._editor&&this._editor.initialized&&(this._editor.setMode(t?"readonly":"design"),this.setDivElement(t),this.editorBlured())},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"readOnly",{get:function(){return this._readOnly},set:function(t){this._readOnly=t,this._editor&&this._editor.initialized&&(this._editor.setMode(t?"readonly":"design"),this.setDivElement(t),this.editorBlured())},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"editor",{get:function(){return this._editor},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"fontFamilyList",{get:function(){return this._fontFamilyList},set:function(t){t&&(this._fontFamilyList=t)},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"defaultFontFamily",{get:function(){return this._defaultFontFamily},set:function(t){t&&(this._defaultFontFamily=t)},enumerable:!0,configurable:!0}),M.prototype.ngOnInit=function(){var o=this;this.init={selector:"textarea",menubar:!1,inline:!1,plugins:["advlist autolink lists link image charmap print preview anchor textcolor powerpaste","searchreplace visualblocks code fullscreen","insertdatetime media table image imagetools code help nonbreaking"],language:this.localeIds[this.currentLocale],toolbar:"undo redo | formatselect fontsizeselect fontselect |                         bold italic underline strikethrough forecolor backcolor link |                         alignleft aligncenter alignright alignjustify |                         bullist numlist outdent indent table image | removeformat",min_height:100,block_formats:"Paragraph=p;Heading 1=h1;Heading 2=h2;Heading 3=h3;Heading 4=h4;Heading 5=h5;Heading 6=h6",fontsize_formats:"12px 14px 16px 18px 24px 36px 48px 56px 72px",font_formats:"微软雅黑=Microsoft YaHei,Helvetica Neue,PingFang SC,sans-serif;苹果苹方=PingFang SC,Microsoft YaHei,sans-serif;                            宋体=simsun,serif;仿宋体=FangSong,serif;黑体=SimHei,sans-serif;Arial=arial,helvetica,sans-serif;                            Arial Black=arial black,avant garde;Book Antiqua=book antiqua,palatino;",images_upload_url:"postAcceptor.php",images_upload_handler:function(t,e,n){if(o.beforeUpload)o.beforeUpload(t).subscribe(function(t){e(t)},function(t){n(t)});else{var i=new FileReader;i.readAsDataURL(t.blob()),i.onload=function(){e(this.result)}}},branding:!1,readonly:!1,setup:null,end_container_on_empty_block:!0,powerpaste_word_import:"propmt",powerpaste_html_import:"propmt",powerpaste_allow_local_images:!0,paste_data_images:!0,autoresize_min_height:100,autoresize_max_height:800,autoresize_on_init:!0,autoresize_overflow_padding:0,nonbreaking_force_tab:!0,default_link_target:"_blank"}},M.prototype.editorBlured=function(){var e=this;setTimeout(function(){var t=e._editor.iframeElement.contentWindow.document.getElementsByClassName(e.editorBodyCls);t&&t.length&&t[0].blur()},0)},M.prototype.writeValue=function(t){this._editor&&this._editor.initialized?(this._editor.setContent(w(t)?"":t),this._divElement.innerHTML=w(t)?"":t):this.initialValue=null===t?undefined:t,!this.__WEBPAGEURL__&&this.router&&(this.__WEBPAGEURL__=this.router.url)},M.prototype.registerOnChange=function(t){this.onChangeCallback=t},M.prototype.registerOnTouched=function(t){this.onTouchedCallback=t},M.prototype.setDisabledState=function(t){this._editor?this._editor.setMode(t?"readonly":"design"):t&&(this.init=l({},this.init,{readonly:!0}))},M.prototype.ngAfterViewInit=function(){n.isPlatformBrowser(this.platformId)&&(this.editorId=this.editorId||g("tiny-angular"),this.inline="undefined"!=typeof this.inline?"boolean"!=typeof this.inline||this.inline:this.init&&this.init.inline,this.createElement(),this.init.selector="#"+this.editorId,d()?this.initialise():this._element&&this._element.ownerDocument&&P.load(this._element.ownerDocument,this.getScriptSrc(),this.initialise))},M.prototype.ngOnDestroy=function(){this.__WEBPAGEURL__="",this._editor&&(this._editor.remove(),this._editor=null,this._divElement=null)},M.prototype.createElement=function(){var t="string"==typeof this.tagName?this.tagName:"div";this._element=document.createElement(this.inline?t:"textarea"),this._element.setAttribute("class","d-none"),this._divElement=document.createElement("div"),this.showBorder?this._divElement.className="farris-editor-placeholder":this._divElement.className="farris-editor-placeholder farris-editor-placeholder-border",this._render.setStyle(this._divElement,"height",this.height+"px"),this._element&&(this._element.id=this.editorId,v(this._element)&&(this._element.style.visibility="hidden"),this._elementRef.nativeElement.appendChild(this._element),this._elementRef.nativeElement.appendChild(this._divElement))},M.prototype.initialise=function(n){var i=this;void 0===n&&(n=!0);var t=l({},this.init,{target:this._element,inline:this.inline,plugins:b(this.init&&this.init.plugins,this.plugins),toolbar:this.init&&this.init.toolbar,height:this.height,autoresize_max_height:this.autoresizeMaxHeight,setup:function(e){(i._editor=e).on("init",function(t){i.initEditor(e,n),i._readOnly||i._disabled?i._editor.setMode("readonly"):i._editor.setMode("design"),setTimeout(function(){i.setDivElement(i._readOnly||i._disabled)},0)}),e.on("PastePostProcess",function(t){i.replaceFontFamily(t.node)}),y(i,e),i.init&&"function"==typeof i.init.setup&&i.init.setup(e)}});this.customToolbar&&(t.toolbar=e.Convert2HtmlEditorToolbars("advanced",this.toolbar)),v(this._element)&&(this._element.style.visibility=""),this.ngZone.runOutsideAngular(function(){setTimeout(function(){d().init(t)},100)})},M.prototype.refresh=function(){this.editor&&this.editor.destroy(),this.initialise(!1)},M.prototype.setToolbar=function(t){this.toolbar=t,this.refresh()},M.prototype.setDivElement=function(t){t?this._divElement.classList.remove("d-none"):this._divElement.classList.add("d-none")},M.prototype.getScriptSrc=function(){return w(this.tinymceScriptSrc)?"https://cdn.tiny.cloud/1/"+this.apiKey+"/tinymce/"+this.cloudChannel+"/tinymce.min.js":this.tinymceScriptSrc},M.prototype.initEditor=function(t,e){var n=this;t.on("blur",function(){return n.ngZone.run(function(){return n.onTouchedCallback()})}),t.on(this.modelEvents,function(){n.ngZone.run(function(){n.onChangeCallback(t.getContent({format:n.outputFormat})),n._divElement.innerHTML=t.getContent({format:n.outputFormat})})}),"string"==typeof this.initialValue&&e&&this.ngZone.run(function(){t.setContent(n.initialValue),n._divElement.innerHTML=n.initialValue,n.onChangeCallback(t.getContent({format:n.outputFormat}))})},M.prototype.replaceFontFamily=function(t){if(t.children&&t.children.length)for(var e=0;e<t.children.length;e++)this.replaceFontFamily(t.children[e]);var n=t.style.fontFamily,i=t.getAttribute("face");if(n){var o=n.split(","),r=this.getFontFamilyArray(o);t.style.fontFamily=r}if(i){var s=i.split(",");r=this.getFontFamilyArray(s),t.setAttribute("face",r)}},M.prototype.getFontFamilyArray=function(t,n){var i=this;void 0===n&&(n=this._fontFamilyList);var o=[];t.forEach(function(e){n.find(function(t){return t===i.trim(e)})&&o.push(i.trim(e))});var e=o.join(",");return e=e||this._defaultFontFamily},M.prototype.trim=function(t){return t.replace(/^\s*|\s*$/g,"")},M.decorators=[{type:a.Component,args:[{selector:"farris-editor",template:"<ng-template></ng-template>",providers:[I],encapsulation:a.ViewEncapsulation.None,styles:[":host{display:block}.farris-editor .mce-tinymce .mce-toolbar .mce-btn-group>div{white-space:pre-wrap}.farris-editor .mce-tinymce{box-sizing:border-box;box-shadow:none}.farris-editor .mce-panel,.farris-editor .mce-tinymce{border-color:#d8dce6}.farris-editor.farris-editor-disabled .mce-statusbar,.farris-editor.farris-editor-disabled .mce-top-part,.farris-editor.farris-editor-readonly .mce-statusbar,.farris-editor.farris-editor-readonly .mce-top-part{display:none}.farris-editor.farris-editor-disabled .mce-edit-area,.farris-editor.farris-editor-readonly .mce-edit-area{border-top:none}.farris-editor.farris-editor-disabled.farris-editor-border .mce-tinymce,.farris-editor.farris-editor-readonly.farris-editor-border .mce-tinymce{border-width:0 0 1px!important}"]}]}],M.ctorParameters=function(){return[{type:a.ElementRef},{type:a.NgZone},{type:Object,decorators:[{type:a.Inject,args:[a.PLATFORM_ID]}]},{type:a.Injector,decorators:[{type:a.Optional}]},{type:String,decorators:[{type:a.Optional},{type:a.Inject,args:[S]}]}]},M.propDecorators={rootClass:[{type:a.HostBinding,args:["class"]}],disabledClass:[{type:a.HostBinding,args:["class.farris-editor-disabled"]}],readonlyClass:[{type:a.HostBinding,args:["class.farris-editor-readonly"]}],disabled:[{type:a.Input}],customToolbar:[{type:a.Input}],readOnly:[{type:a.Input}],cloudChannel:[{type:a.Input}],apiKey:[{type:a.Input}],editorId:[{type:a.Input}],initialValue:[{type:a.Input}],outputFormat:[{type:a.Input}],inline:[{type:a.Input}],tagName:[{type:a.Input}],plugins:[{type:a.Input}],toolbar:[{type:a.Input}],modelEvents:[{type:a.Input}],height:[{type:a.Input}],autoresizeMaxHeight:[{type:a.Input}],showBorder:[{type:a.Input},{type:a.HostBinding,args:["class.farris-editor-border"]}],fontFamilyList:[{type:a.Input}],defaultFontFamily:[{type:a.Input}],beforeUpload:[{type:a.Input}]},M);function M(t,e,n,i,o){var r=m.call(this)||this;return r.platformId=n,r.injector=i,r.tinymceScriptSrc=o,r.rootClass="farris-editor",r.customToolbar=!1,r.localeIds={en:"es","zh-CHS":"zh_CN"},r.currentLocale="zh-CHS",r.cloudChannel="5",r.apiKey="no-api-key",r.editorId="",r.modelEvents="change keyup undo redo",r.height=100,r.autoresizeMaxHeight=800,r.showBorder=!0,r._fontFamilyList=["Microsoft YaHei","Helvetica Neue","PingFang SC","sans-serif","simsun","serif","SimHei","arial","helvetica","arial black","avant garde","book antiqua","palatino","FangSong"],r._defaultFontFamily="Microsoft YaHei",r.onTouchedCallback=O,r.onChangeCallback=O,r.__WEBPAGEURL__="",r.editorBodyCls="mce-content-body",r._elementRef=t,r.ngZone=e,r._render=r.injector.get(a.Renderer2),r.initialise=r.initialise.bind(r),r.injector&&(r.currentLocale=r.injector.get(a.LOCALE_ID),r.editorService=r.injector.get(u),r.router=r.injector.get(s.Router,null),r.router&&r.router.events.subscribe(function(t){t instanceof s.NavigationStart?r.__WEBPAGEURL__||(r.__WEBPAGEURL__=t.url):t instanceof s.NavigationEnd&&r.__WEBPAGEURL__===t.url&&r.editor&&(r.editor.destroy(),r.initialise(!1))})),r}var D=(B.forRoot=function(t){return{ngModule:B,providers:[{provide:S,useValue:t}]}},B.decorators=[{type:a.NgModule,args:[{declarations:[F],imports:[n.CommonModule,i.FormsModule],exports:[F],providers:[u]}]}],B);function B(){}t.EditorService=u,t.TINYMCE_SCRIPT_SRC=S,t.EditorComponent=F,t.EditorModule=D,t.Events=p,t.validEvents=f,t.getTinymce=d,t.ScriptLoader=P,t.bindHandlers=y,t.uuid=g,t.isTextarea=v,t.normalizePluginArray=_,t.mergePlugins=b,t.noop=O,t.isNullOrUndefined=w,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=farris-ui-editor.umd.min.js.map