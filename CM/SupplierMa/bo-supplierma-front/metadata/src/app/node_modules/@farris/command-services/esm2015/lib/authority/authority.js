import { empty } from 'rxjs';
import { map } from 'rxjs/operators';
/**
 * 权限
 */
export class Authority {
    constructor() {
        this.operationLabelMap = new Map();
        this.authOfLabel = new Map();
    }
    /**
     * 设置label到operation id的映射
     * @param labelMap
     */
    setLabelMap(labelMap) {
        for (var i in labelMap) {
            this.operationLabelMap.set(i, labelMap[i]);
        }
        this.operationLabelMap.forEach((opId, label) => {
            this[label] = false;
        });
    }
    /**
     * 初始化权限的值
     */
    initialize(authorityService) {
        if (this.operationLabelMap && this.operationLabelMap.size > 0) {
            return authorityService.queryOperationAuthority(Array.from(this.operationLabelMap.values())).pipe(map((operationAuth) => {
                this.operationLabelMap.forEach((opId, label) => {
                    this.authOfLabel.set(label, operationAuth.has(opId) ? operationAuth.get(opId) : false);
                });
            }));
        }
        else {
            return empty();
        }
    }
    /**
     * 返回操作权限，即用户是否拥有Label所对应的权限
     * @param label 标签，可以是button id等
     */
    hasOperation(label) {
        return this.authOfLabel.has(label) && this.authOfLabel.get(label);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0aG9yaXR5LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9jb21tYW5kLXNlcnZpY2VzLyIsInNvdXJjZXMiOlsibGliL2F1dGhvcml0eS9hdXRob3JpdHkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFhLEtBQUssRUFBQyxNQUFNLE1BQU0sQ0FBQztBQUN2QyxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFckM7O0dBRUc7QUFDSCxNQUFNLE9BQU8sU0FBUztJQUVsQjtRQUNJLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxJQUFJLEdBQUcsRUFBa0IsQ0FBQztRQUNuRCxJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksR0FBRyxFQUFtQixDQUFDO0lBQ2xELENBQUM7SUFZRDs7O09BR0c7SUFDTyxXQUFXLENBQUMsUUFBZ0I7UUFDbEMsS0FBSSxJQUFJLENBQUMsSUFBSSxRQUFRLEVBQUU7WUFDbkIsSUFBSSxDQUFDLGlCQUFpQixDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDOUM7UUFDRCxJQUFJLENBQUMsaUJBQWlCLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxFQUFFLEtBQUssRUFBRSxFQUFFO1lBQzNDLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxLQUFLLENBQUM7UUFDeEIsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBRUQ7O09BRUc7SUFDSCxVQUFVLENBQUMsZ0JBQWtDO1FBQ3pDLElBQUcsSUFBSSxDQUFDLGlCQUFpQixJQUFJLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLEdBQUMsQ0FBQyxFQUFFO1lBQ3hELE9BQU8sZ0JBQWdCLENBQUMsdUJBQXVCLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FDN0YsR0FBRyxDQUFDLENBQUMsYUFBYSxFQUFFLEVBQUU7Z0JBQ2xCLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLEVBQUUsS0FBSyxFQUFFLEVBQUU7b0JBQzNDLElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRSxhQUFhLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQztnQkFDM0YsQ0FBQyxDQUFDLENBQUM7WUFDUCxDQUFDLENBQUMsQ0FDTCxDQUFDO1NBQ0w7YUFBSTtZQUNELE9BQU8sS0FBSyxFQUFFLENBQUM7U0FDbEI7SUFDTCxDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsWUFBWSxDQUFDLEtBQVk7UUFDckIsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUN0RSxDQUFDO0NBSUoiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBdXRob3JpdHlTZXJ2aWNlIH0gZnJvbSAnLi9hdXRob3JpdHkuc2VydmljZSc7XG5pbXBvcnQge09ic2VydmFibGUsIGVtcHR5fSBmcm9tICdyeGpzJztcbmltcG9ydCB7IG1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcblxuLyoqXG4gKiDmnYPpmZBcbiAqL1xuZXhwb3J0IGNsYXNzIEF1dGhvcml0eSB7XG4gICAgXG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMub3BlcmF0aW9uTGFiZWxNYXAgPSBuZXcgTWFwPHN0cmluZywgc3RyaW5nPigpO1xuICAgICAgICB0aGlzLmF1dGhPZkxhYmVsID0gbmV3IE1hcDxzdHJpbmcsIGJvb2xlYW4+KCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICog5LuObGFiZWzliLDmk43kvZzmnYPpmZBJROeahOaYoOWwhO+8jGxhYmVs5Y+v5Lul5pivYnV0dG9uIGlk562JXG4gICAgICovXG4gICAgcHJpdmF0ZSBvcGVyYXRpb25MYWJlbE1hcDogTWFwPHN0cmluZywgc3RyaW5nPjtcblxuICAgIC8qKlxuICAgICAqIOiusOW9lWxhYmVs5a+55LqO55qE5pON5L2c5p2D6ZmQ77yM5piv5ZCm6YCa6L+HXG4gICAgICovXG4gICAgcHJpdmF0ZSBhdXRoT2ZMYWJlbDogTWFwPHN0cmluZywgYm9vbGVhbj47XG5cbiAgICAvKipcbiAgICAgKiDorr7nva5sYWJlbOWIsG9wZXJhdGlvbiBpZOeahOaYoOWwhFxuICAgICAqIEBwYXJhbSBsYWJlbE1hcCBcbiAgICAgKi9cbiAgICBwcm90ZWN0ZWQgc2V0TGFiZWxNYXAobGFiZWxNYXA6IE9iamVjdCkge1xuICAgICAgICBmb3IodmFyIGkgaW4gbGFiZWxNYXApIHtcbiAgICAgICAgICAgIHRoaXMub3BlcmF0aW9uTGFiZWxNYXAuc2V0KGksIGxhYmVsTWFwW2ldKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLm9wZXJhdGlvbkxhYmVsTWFwLmZvckVhY2goKG9wSWQsIGxhYmVsKSA9PiB7XG4gICAgICAgICAgICB0aGlzW2xhYmVsXSA9IGZhbHNlO1xuICAgICAgICB9KTsgICAgICAgIFxuICAgIH1cbiAgICBcbiAgICAvKipcbiAgICAgKiDliJ3lp4vljJbmnYPpmZDnmoTlgLxcbiAgICAgKi9cbiAgICBpbml0aWFsaXplKGF1dGhvcml0eVNlcnZpY2U6IEF1dGhvcml0eVNlcnZpY2UpOiBPYnNlcnZhYmxlPHZvaWQ+IHtcbiAgICAgICAgaWYodGhpcy5vcGVyYXRpb25MYWJlbE1hcCAmJiB0aGlzLm9wZXJhdGlvbkxhYmVsTWFwLnNpemU+MCkge1xuICAgICAgICAgICAgcmV0dXJuIGF1dGhvcml0eVNlcnZpY2UucXVlcnlPcGVyYXRpb25BdXRob3JpdHkoQXJyYXkuZnJvbSh0aGlzLm9wZXJhdGlvbkxhYmVsTWFwLnZhbHVlcygpKSkucGlwZShcbiAgICAgICAgICAgICAgICBtYXAoKG9wZXJhdGlvbkF1dGgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vcGVyYXRpb25MYWJlbE1hcC5mb3JFYWNoKChvcElkLCBsYWJlbCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hdXRoT2ZMYWJlbC5zZXQobGFiZWwsIG9wZXJhdGlvbkF1dGguaGFzKG9wSWQpID8gb3BlcmF0aW9uQXV0aC5nZXQob3BJZCkgOiBmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApO1xuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIHJldHVybiBlbXB0eSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICog6L+U5Zue5pON5L2c5p2D6ZmQ77yM5Y2z55So5oi35piv5ZCm5oul5pyJTGFiZWzmiYDlr7nlupTnmoTmnYPpmZBcbiAgICAgKiBAcGFyYW0gbGFiZWwg5qCH562+77yM5Y+v5Lul5pivYnV0dG9uIGlk562JXG4gICAgICovXG4gICAgaGFzT3BlcmF0aW9uKGxhYmVsOnN0cmluZykgeyAgICAgICAgXG4gICAgICAgIHJldHVybiB0aGlzLmF1dGhPZkxhYmVsLmhhcyhsYWJlbCkgJiYgdGhpcy5hdXRoT2ZMYWJlbC5nZXQobGFiZWwpO1xuICAgIH1cblxuICAgIC8vIOi/lOWbnuWtl+auteadg+mZkFxuICAgIC8vIGhhc0ZpZWxkKGZpZWxkOnN0cmluZylcbn0iXX0=