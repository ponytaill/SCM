/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, HostBinding, EventEmitter, Output, ElementRef } from '@angular/core';
import { SolutionService } from '../../service/solution.service';
// import { NumberRangeValue } from '../../entity/conditionvalue/numberrangevaue';
export class NumberComponent {
    /**
     * @param {?} solutionService
     * @param {?} element
     */
    constructor(solutionService, element) {
        this.solutionService = solutionService;
        this.element = element;
        this.searchHandle = new EventEmitter();
        /**
         * 判断是否是在扩展区域展示
         */
        this.extend = false;
        /**
         * 判断是否显示label
         */
        this.showlabel = true;
        this.canNull = true;
        /**
         * 某个字段发生值变化事件时，需要同步清空的字段，可能不是当前字段
         */
        this.changeFields = [];
    }
    /**
     * @return {?}
     */
    get isExtend() {
        return !this.extend && this.autoLabel;
    }
    /**
     * @return {?}
     */
    get hidenLabel() {
        return !this.showlabel;
    }
    /**
     * @param {?} nr
     * @return {?}
     */
    set item(nr) {
        this._item = nr;
        this.precision = nr.control.precision;
        this.bigNumber = nr.control.bigNumber;
        this.constructMultiFieldNumberRange((/** @type {?} */ (nr.value)));
        if (this._item && this._item.control && this._item.control.hasOwnProperty('isExtend')) {
            this.extend = this._item.control.isExtend;
            if (!this.extend) {
                this.showlabel = this._item.control.showLabel;
            }
        }
    }
    /**
     * @return {?}
     */
    get item() {
        return this._item;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        if (this.item) {
            /** @type {?} */
            const type = Object.prototype.toString.call(this.item.placeHolder);
            if (type == '[object Undefined]') {
                if (this.item.control && this.item.control.hasOwnProperty('placeholder')) {
                    this.placeholder = this.item.control.placeholder;
                }
            }
            else {
                this.placeholder = this.item.placeHolder;
            }
            /** @type {?} */
            const beginplac = Object.prototype.toString.call(this.item.beginPlaceHolder);
            if (beginplac == '[object Undefined]') {
                if (this.item.control && this.item.control.hasOwnProperty('placeholder')) {
                    this.beginPlaceHolder = this.item.control.beginPlaceHolder;
                }
            }
            else {
                this.beginPlaceHolder = this.item.beginPlaceHolder;
            }
            /** @type {?} */
            const endplac = Object.prototype.toString.call(this.item.beginPlaceHolder);
            if (endplac == '[object Undefined]') {
                if (this.item.control && this.item.control.hasOwnProperty('placeholder')) {
                    this.endPlaceHolder = this.item.control.endPlaceHolder;
                }
            }
            else {
                this.endPlaceHolder = this.item.endPlaceHolder;
            }
        }
        ((/** @type {?} */ (this.item.value))).clear$.subscribe((/**
         * @return {?}
         */
        () => {
            this.beginValue = '';
            this.endValue = '';
        }));
        this.solutionService.addFilterEditorInstance(this.item.fieldCode, this);
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (changes['changeFields'] && changes['changeFields'].currentValue && !changes['changeFields'].firstChange) {
            /** @type {?} */
            const isChange = changes['changeFields'].currentValue.some((/**
             * @param {?} field
             * @return {?}
             */
            field => field == this.item.fieldCode));
            if (isChange) {
                this.constructMultiFieldNumberRange((/** @type {?} */ (this.item.value)));
            }
        }
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        // if(!this.extend){
        //     const El = this.element.nativeElement;
        //     const itemWidth = El.clientWidth;
        //     El.querySelector('.list-filter-number-item').style.width = itemWidth + 'px';
        //     El.querySelector('.number-item-btns').style.width = itemWidth + 100 + 'px';
        // }
    }
    // getConditionItemStyle(field: QueryCondition, controlType: any) {
    //     return this.solutionService.getConditionItemStyle(field,controlType);
    // }
    /**
     * @param {?} field
     * @return {?}
     */
    getConditionItemTitle(field) {
        return this.solutionService.getConditionItemTitle(field);
    }
    // constructNumberRange(value: NumberRangeValue): string{
    //     return "a~b".replace(/a/,value.startValue?value.startValue.toString().trim():"").replace(/b/,value.endValue?value.endValue.toString().trim():"");
    // }
    /**
     * @param {?} value
     * @return {?}
     */
    constructMultiFieldNumberRange(value) {
        // this.beginValue = value && value.startValue ? value.startValue.toString().trim() : '';
        // this.endValue = value && value.endValue ? value.endValue.toString().trim() : '';
        this.beginValue = value.startValue == null ? null : value.startValue;
        this.endValue = value.endValue == null ? null : value.endValue;
    }
    /**
     * @param {?} event
     * @return {?}
     */
    numberChange(event) {
        if (event) {
            // const dataArray = event.split("~");
            // console.log(dataArray);
            // this._item.value = (new NumberRangeValueConvertor).initFromObject({startValue: dataArray[0], endValue: dataArray[1]});
            /** @type {?} */
            const dataArray = event.split("~");
            this.item.value.startValue = dataArray[0] ? dataArray[0] : null;
            this.item.value.endValue = dataArray[1] ? dataArray[1] : null;
        }
        else {
            this._item.value.startValue = null;
            this._item.value.endValue = null;
        }
        // const dataArray = event.split("~");
        // this._item.value = (new NumberRangeValueConvertor).initFromObject({startValue: dataArray[0], endValue: dataArray[1]});
        if (this.disabled) {
            return;
        }
        this.searchHandle.emit();
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    beginValueChange($event) {
        this.beginValue = $event;
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    endValueChange($event) {
        this.endValue = $event;
    }
}
NumberComponent.decorators = [
    { type: Component, args: [{
                selector: 'app-filter-number',
                template: "<label class=\"col-form-label\" *ngIf=\"item && showlabel\" title=\"{{getConditionItemTitle(item)}}\">\r\n    <span class=\"farris-label-info text-danger\" *ngIf=\"item.control.required\">*</span>\r\n    <span class=\"farris-label-text\">{{item.fieldName}}</span>\r\n</label>\r\n<div class=\"farris-input-wrap d-flex\">\r\n    <farris-number-range class=\"f-utils-fill-flex-row\" [canNull]=\"canNull\" [disabled]=\"disabled\" [beginValue]=\"beginValue\" [endValue]=\"endValue\" \r\n    (beginValueChange)=\"beginValueChange($event)\" (endValueChange)=\"endValueChange($event)\" (valueChange)=\"numberChange($event)\" \r\n    [beginPlaceHolder]=\"beginPlaceHolder\" [endPlaceHolder]=\"endPlaceHolder\" [placeholder]=\"placeholder\" [precision]=\"precision\" [bigNumber]=\"bigNumber\"></farris-number-range>\r\n</div>",
                styles: [""]
            }] }
];
/** @nocollapse */
NumberComponent.ctorParameters = () => [
    { type: SolutionService },
    { type: ElementRef }
];
NumberComponent.propDecorators = {
    autoLabel: [{ type: Input }],
    disabled: [{ type: Input }],
    searchHandle: [{ type: Output, args: ['searchHandle',] }],
    isExtend: [{ type: HostBinding, args: ['class.filter-item-wrap',] }],
    hidenLabel: [{ type: HostBinding, args: ['class.filter-item-hiddenlabel',] }],
    item: [{ type: Input }],
    changeFields: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    NumberComponent.prototype.autoLabel;
    /** @type {?} */
    NumberComponent.prototype.disabled;
    /** @type {?} */
    NumberComponent.prototype.searchHandle;
    /**
     * 判断是否是在扩展区域展示
     * @type {?}
     */
    NumberComponent.prototype.extend;
    /**
     * 判断是否显示label
     * @type {?}
     */
    NumberComponent.prototype.showlabel;
    /** @type {?} */
    NumberComponent.prototype.canNull;
    /** @type {?} */
    NumberComponent.prototype.number;
    /** @type {?} */
    NumberComponent.prototype.beginValue;
    /** @type {?} */
    NumberComponent.prototype.endValue;
    /** @type {?} */
    NumberComponent.prototype.precision;
    /** @type {?} */
    NumberComponent.prototype.placeholder;
    /** @type {?} */
    NumberComponent.prototype.beginPlaceHolder;
    /** @type {?} */
    NumberComponent.prototype.endPlaceHolder;
    /** @type {?} */
    NumberComponent.prototype.bigNumber;
    /** @type {?} */
    NumberComponent.prototype._item;
    /** @type {?} */
    NumberComponent.prototype.numberRange;
    /**
     * 某个字段发生值变化事件时，需要同步清空的字段，可能不是当前字段
     * @type {?}
     */
    NumberComponent.prototype.changeFields;
    /**
     * @type {?}
     * @private
     */
    NumberComponent.prototype.solutionService;
    /**
     * @type {?}
     * @private
     */
    NumberComponent.prototype.element;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibnVtYmVyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktbGlzdC1maWx0ZXIvIiwic291cmNlcyI6WyJsaWIvY29udHJvbGNvbXBvbmVudC9udW1iZXJjb21wb25lbnQvbnVtYmVyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQVUsV0FBVyxFQUFFLFlBQVksRUFBRSxNQUFNLEVBQWlCLFVBQVUsRUFBNEIsTUFBTSxlQUFlLENBQUM7QUFFakosT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLGdDQUFnQyxDQUFDOztBQVdqRSxNQUFNLE9BQU8sZUFBZTs7Ozs7SUF1RHhCLFlBQW9CLGVBQWdDLEVBQW1CLE9BQW1CO1FBQXRFLG9CQUFlLEdBQWYsZUFBZSxDQUFpQjtRQUFtQixZQUFPLEdBQVAsT0FBTyxDQUFZO1FBbERsRSxpQkFBWSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7Ozs7UUFHMUQsV0FBTSxHQUFZLEtBQUssQ0FBQzs7OztRQUV4QixjQUFTLEdBQVksSUFBSSxDQUFDO1FBQzFCLFlBQU8sR0FBWSxJQUFJLENBQUM7Ozs7UUEyQ2YsaUJBQVksR0FBa0IsRUFBRSxDQUFDO0lBQ29ELENBQUM7Ozs7SUFqQy9GLElBQ0ksUUFBUTtRQUNSLE9BQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUM7SUFDMUMsQ0FBQzs7OztJQUNELElBQ0ksVUFBVTtRQUNWLE9BQU8sQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDO0lBQzNCLENBQUM7Ozs7O0lBSUQsSUFDSSxJQUFJLENBQUMsRUFBTztRQUNaLElBQUksQ0FBQyxLQUFLLEdBQUcsRUFBRSxDQUFDO1FBQ2hCLElBQUksQ0FBQyxTQUFTLEdBQUcsRUFBRSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUM7UUFDdEMsSUFBSSxDQUFDLFNBQVMsR0FBRyxFQUFFLENBQUMs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LGNBQWM7dUJBaUJyQixXQUFXLFNBQUMsd0JBQXdCO3lCQUlwQyxXQUFXLFNBQUMsK0JBQStCO21CQU8zQyxLQUFLOzJCQXFCTCxLQUFLOzs7O0lBbkROLG9DQUE0Qjs7SUFDNUIsbUNBQTJCOztJQUMzQix1Q0FBMEQ7Ozs7O0lBRzFELGlDQUF3Qjs7Ozs7SUFFeEIsb0NBQTBCOztJQUMxQixrQ0FBd0I7O0lBRXhCLGlDQUFlOztJQUNmLHFDQUFnQjs7SUFDaEIsbUNBQWM7O0lBQ2Qsb0NBQWtCOztJQUNsQixzQ0FBb0I7O0lBQ3BCLDJDQUF5Qjs7SUFDekIseUNBQXVCOztJQUN2QixvQ0FBbUI7O0lBV25CLGdDQUFXOztJQUNYLHNDQUFvQjs7Ozs7SUFzQnBCLHVDQUEwQzs7Ozs7SUFDOUIsMENBQXdDOzs7OztJQUFFLGtDQUFvQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQsIE9uSW5pdCwgSG9zdEJpbmRpbmcsIEV2ZW50RW1pdHRlciwgT3V0cHV0LCBBZnRlclZpZXdJbml0LCBFbGVtZW50UmVmLCBTaW1wbGVDaGFuZ2VzLCBPbkNoYW5nZXMgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgUXVlcnlDb25kaXRpb24gfSBmcm9tICcuLi8uLi9lbnRpdHkvcXVlcnljb25kaXRpb24nO1xyXG5pbXBvcnQgeyBTb2x1dGlvblNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlL3NvbHV0aW9uLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBOdW1iZXJSYW5nZVZhbHVlLCBOdW1iZXJSYW5nZVZhbHVlQ29udmVydG9yIH0gZnJvbSAnLi4vLi4vZW50aXR5L2NvbmRpdGlvbnZhbHVlL251bWJlcnJhbmdldmF1ZSc7XHJcbi8vIGltcG9ydCB7IE51bWJlclJhbmdlVmFsdWUgfSBmcm9tICcuLi8uLi9lbnRpdHkvY29uZGl0aW9udmFsdWUvbnVtYmVycmFuZ2V2YXVlJztcclxuXHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAnYXBwLWZpbHRlci1udW1iZXInLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcuL251bWJlci5jb21wb25lbnQuaHRtbCcsXHJcbiAgICBzdHlsZVVybHM6IFsnLi9udW1iZXIuY29tcG9uZW50LnNjc3MnXVxyXG59KVxyXG5cclxuZXhwb3J0IGNsYXNzIE51bWJlckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCxPbkNoYW5nZXMge1xyXG5cclxuICAgIC8vIEBJbnB1dCgpIGl0ZW06YW55O1xyXG4gICAgQElucHV0KCkgYXV0b0xhYmVsOiBib29sZWFuO1xyXG4gICAgQElucHV0KCkgZGlzYWJsZWQ6IGJvb2xlYW47XHJcbiAgICBAT3V0cHV0KCdzZWFyY2hIYW5kbGUnKSBzZWFyY2hIYW5kbGUgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcblxyXG4gICAgLyoq5Yik5pat5piv5ZCm5piv5Zyo5omp5bGV5Yy65Z+f5bGV56S6ICovXHJcbiAgICBleHRlbmQ6IGJvb2xlYW4gPSBmYWxzZTtcclxuICAgIC8qKuWIpOaWreaYr+WQpuaYvuekumxhYmVsICovXHJcbiAgICBzaG93bGFiZWw6IGJvb2xlYW4gPSB0cnVlO1xyXG4gICAgY2FuTnVsbDogYm9vbGVhbiA9IHRydWU7XHJcblxyXG4gICAgbnVtYmVyOiBzdHJpbmc7XHJcbiAgICBiZWdpblZhbHVlOiBhbnk7XHJcbiAgICBlbmRWYWx1ZTogYW55O1xyXG4gICAgcHJlY2lzaW9uOiBudW1iZXI7XHJcbiAgICBwbGFjZWhvbGRlcjogc3RyaW5nO1xyXG4gICAgYmVnaW5QbGFjZUhvbGRlcjogc3RyaW5nO1xyXG4gICAgZW5kUGxhY2VIb2xkZXI6IHN0cmluZztcclxuICAgIGJpZ051bWJlcjogYm9vbGVhbjtcclxuXHJcbiAgICBASG9zdEJpbmRpbmcoJ2NsYXNzLmZpbHRlci1pdGVtLXdyYXAnKVxyXG4gICAgZ2V0IGlzRXh0ZW5kKCk6IGJvb2xlYW4ge1xyXG4gICAgICAgIHJldHVybiAhdGhpcy5leHRlbmQgJiYgdGhpcy5hdXRvTGFiZWw7XHJcbiAgICB9XHJcbiAgICBASG9zdEJpbmRpbmcoJ2NsYXNzLmZpbHRlci1pdGVtLWhpZGRlbmxhYmVsJylcclxuICAgIGdldCBoaWRlbkxhYmVsKCk6IGJvb2xlYW4ge1xyXG4gICAgICAgIHJldHVybiAhdGhpcy5zaG93bGFiZWw7XHJcbiAgICB9XHJcblxyXG4gICAgX2l0ZW06IGFueTtcclxuICAgIG51bWJlclJhbmdlOiBzdHJpbmc7XHJcbiAgICBASW5wdXQoKVxyXG4gICAgc2V0IGl0ZW0obnI6IGFueSkge1xyXG4gICAgICAgIHRoaXMuX2l0ZW0gPSBucjtcclxuICAgICAgICB0aGlzLnByZWNpc2lvbiA9IG5yLmNvbnRyb2wucHJlY2lzaW9uO1xyXG4gICAgICAgIHRoaXMuYmlnTnVtYmVyID0gbnIuY29udHJvbC5iaWdOdW1iZXI7XHJcbiAgICAgICAgdGhpcy5jb25zdHJ1Y3RNdWx0aUZpZWxkTnVtYmVyUmFuZ2UobnIudmFsdWUgYXMgTnVtYmVyUmFuZ2VWYWx1ZSk7XHJcbiAgICAgICAgaWYgKHRoaXMuX2l0ZW0gJiYgdGhpcy5faXRlbS5jb250cm9sICYmIHRoaXMuX2l0ZW0uY29udHJvbC5oYXNPd25Qcm9wZXJ0eSgnaXNFeHRlbmQnKSkge1xyXG4gICAgICAgICAgICB0aGlzLmV4dGVuZCA9IHRoaXMuX2l0ZW0uY29udHJvbC5pc0V4dGVuZDtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLmV4dGVuZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zaG93bGFiZWwgPSB0aGlzLl9pdGVtLmNvbnRyb2wuc2hvd0xhYmVsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldCBpdGVtKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9pdGVtO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5p+Q5Liq5a2X5q615Y+R55Sf5YC85Y+Y5YyW5LqL5Lu25pe277yM6ZyA6KaB5ZCM5q2l5riF56m655qE5a2X5q6177yM5Y+v6IO95LiN5piv5b2T5YmN5a2X5q61XHJcbiAgICAgKi9cclxuICAgIEBJbnB1dCgpIGNoYW5nZUZpZWxkczogQXJyYXk8c3RyaW5nPiA9IFtdO1xyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBzb2x1dGlvblNlcnZpY2U6IFNvbHV0aW9uU2VydmljZSwgcHJpdmF0ZSByZWFkb25seSBlbGVtZW50OiBFbGVtZW50UmVmKSB7IH1cclxuXHJcbiAgICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgICAgICBpZiAodGhpcy5pdGVtKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHR5cGUgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodGhpcy5pdGVtLnBsYWNlSG9sZGVyKTtcclxuICAgICAgICAgICAgaWYgKHR5cGUgPT0gJ1tvYmplY3QgVW5kZWZpbmVkXScpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLml0ZW0uY29udHJvbCAmJiB0aGlzLml0ZW0uY29udHJvbC5oYXNPd25Qcm9wZXJ0eSgncGxhY2Vob2xkZXInKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGxhY2Vob2xkZXIgPSB0aGlzLml0ZW0uY29udHJvbC5wbGFjZWhvbGRlcjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucGxhY2Vob2xkZXIgPSB0aGlzLml0ZW0ucGxhY2VIb2xkZXI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29uc3QgYmVnaW5wbGFjID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHRoaXMuaXRlbS5iZWdpblBsYWNlSG9sZGVyKTtcclxuICAgICAgICAgICAgaWYgKGJlZ2lucGxhYyA9PSAnW29iamVjdCBVbmRlZmluZWRdJykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaXRlbS5jb250cm9sICYmIHRoaXMuaXRlbS5jb250cm9sLmhhc093blByb3BlcnR5KCdwbGFjZWhvbGRlcicpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5iZWdpblBsYWNlSG9sZGVyID0gdGhpcy5pdGVtLmNvbnRyb2wuYmVnaW5QbGFjZUhvbGRlcjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuYmVnaW5QbGFjZUhvbGRlciA9IHRoaXMuaXRlbS5iZWdpblBsYWNlSG9sZGVyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IGVuZHBsYWMgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodGhpcy5pdGVtLmJlZ2luUGxhY2VIb2xkZXIpO1xyXG4gICAgICAgICAgICBpZiAoZW5kcGxhYyA9PSAnW29iamVjdCBVbmRlZmluZWRdJykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaXRlbS5jb250cm9sICYmIHRoaXMuaXRlbS5jb250cm9sLmhhc093blByb3BlcnR5KCdwbGFjZWhvbGRlcicpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbmRQbGFjZUhvbGRlciA9IHRoaXMuaXRlbS5jb250cm9sLmVuZFBsYWNlSG9sZGVyO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5lbmRQbGFjZUhvbGRlciA9IHRoaXMuaXRlbS5lbmRQbGFjZUhvbGRlcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICh0aGlzLml0ZW0udmFsdWUgYXMgTnVtYmVyUmFuZ2VWYWx1ZSkuY2xlYXIkLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuYmVnaW5WYWx1ZSA9ICcnO1xyXG4gICAgICAgICAgICB0aGlzLmVuZFZhbHVlID0gJyc7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMuc29sdXRpb25TZXJ2aWNlLmFkZEZpbHRlckVkaXRvckluc3RhbmNlKHRoaXMuaXRlbS5maWVsZENvZGUsIHRoaXMpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpOiB2b2lkIHtcclxuICAgICAgICBpZihjaGFuZ2VzWydjaGFuZ2VGaWVsZHMnXSAmJiBjaGFuZ2VzWydjaGFuZ2VGaWVsZHMnXS5jdXJyZW50VmFsdWUgJiYgIWNoYW5nZXNbJ2NoYW5nZUZpZWxkcyddLmZpcnN0Q2hhbmdlKSB7XHJcbiAgICAgICAgICBjb25zdCBpc0NoYW5nZSA9IGNoYW5nZXNbJ2NoYW5nZUZpZWxkcyddLmN1cnJlbnRWYWx1ZS5zb21lKGZpZWxkID0+IGZpZWxkID09IHRoaXMuaXRlbS5maWVsZENvZGUpO1xyXG4gICAgICAgICAgaWYoaXNDaGFuZ2Upe1xyXG4gICAgICAgICAgICB0aGlzLmNvbnN0cnVjdE11bHRpRmllbGROdW1iZXJSYW5nZSh0aGlzLml0ZW0udmFsdWUgYXMgTnVtYmVyUmFuZ2VWYWx1ZSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgfVxyXG4gICAgbmdBZnRlclZpZXdJbml0KCkge1xyXG4gICAgICAgIC8vIGlmKCF0aGlzLmV4dGVuZCl7XHJcbiAgICAgICAgLy8gICAgIGNvbnN0IEVsID0gdGhpcy5lbGVtZW50Lm5hdGl2ZUVsZW1lbnQ7XHJcbiAgICAgICAgLy8gICAgIGNvbnN0IGl0ZW1XaWR0aCA9IEVsLmNsaWVudFdpZHRoO1xyXG4gICAgICAgIC8vICAgICBFbC5xdWVyeVNlbGVjdG9yKCcubGlzdC1maWx0ZXItbnVtYmVyLWl0ZW0nKS5zdHlsZS53aWR0aCA9IGl0ZW1XaWR0aCArICdweCc7XHJcbiAgICAgICAgLy8gICAgIEVsLnF1ZXJ5U2VsZWN0b3IoJy5udW1iZXItaXRlbS1idG5zJykuc3R5bGUud2lkdGggPSBpdGVtV2lkdGggKyAxMDAgKyAncHgnO1xyXG4gICAgICAgIC8vIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBnZXRDb25kaXRpb25JdGVtU3R5bGUoZmllbGQ6IFF1ZXJ5Q29uZGl0aW9uLCBjb250cm9sVHlwZTogYW55KSB7XHJcbiAgICAvLyAgICAgcmV0dXJuIHRoaXMuc29sdXRpb25TZXJ2aWNlLmdldENvbmRpdGlvbkl0ZW1TdHlsZShmaWVsZCxjb250cm9sVHlwZSk7XHJcbiAgICAvLyB9XHJcblxyXG4gICAgZ2V0Q29uZGl0aW9uSXRlbVRpdGxlKGZpZWxkOiBRdWVyeUNvbmRpdGlvbikge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnNvbHV0aW9uU2VydmljZS5nZXRDb25kaXRpb25JdGVtVGl0bGUoZmllbGQpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIGNvbnN0cnVjdE51bWJlclJhbmdlKHZhbHVlOiBOdW1iZXJSYW5nZVZhbHVlKTogc3RyaW5ne1xyXG4gICAgLy8gICAgIHJldHVybiBcImF+YlwiLnJlcGxhY2UoL2EvLHZhbHVlLnN0YXJ0VmFsdWU/dmFsdWUuc3RhcnRWYWx1ZS50b1N0cmluZygpLnRyaW0oKTpcIlwiKS5yZXBsYWNlKC9iLyx2YWx1ZS5lbmRWYWx1ZT92YWx1ZS5lbmRWYWx1ZS50b1N0cmluZygpLnRyaW0oKTpcIlwiKTtcclxuICAgIC8vIH1cclxuICAgIGNvbnN0cnVjdE11bHRpRmllbGROdW1iZXJSYW5nZSh2YWx1ZTogTnVtYmVyUmFuZ2VWYWx1ZSkge1xyXG4gICAgICAgIC8vIHRoaXMuYmVnaW5WYWx1ZSA9IHZhbHVlICYmIHZhbHVlLnN0YXJ0VmFsdWUgPyB2YWx1ZS5zdGFydFZhbHVlLnRvU3RyaW5nKCkudHJpbSgpIDogJyc7XHJcbiAgICAgICAgLy8gdGhpcy5lbmRWYWx1ZSA9IHZhbHVlICYmIHZhbHVlLmVuZFZhbHVlID8gdmFsdWUuZW5kVmFsdWUudG9TdHJpbmcoKS50cmltKCkgOiAnJztcclxuICAgICAgICB0aGlzLmJlZ2luVmFsdWUgPSB2YWx1ZS5zdGFydFZhbHVlID09IG51bGwgPyBudWxsIDogdmFsdWUuc3RhcnRWYWx1ZTtcclxuICAgICAgICB0aGlzLmVuZFZhbHVlID0gdmFsdWUuZW5kVmFsdWUgPT0gbnVsbCA/IG51bGwgOiB2YWx1ZS5lbmRWYWx1ZTtcclxuICAgIH1cclxuXHJcbiAgICBudW1iZXJDaGFuZ2UoZXZlbnQpIHtcclxuICAgICAgICBpZiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgLy8gY29uc3QgZGF0YUFycmF5ID0gZXZlbnQuc3BsaXQoXCJ+XCIpO1xyXG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhkYXRhQXJyYXkpO1xyXG4gICAgICAgICAgICAvLyB0aGlzLl9pdGVtLnZhbHVlID0gKG5ldyBOdW1iZXJSYW5nZVZhbHVlQ29udmVydG9yKS5pbml0RnJvbU9iamVjdCh7c3RhcnRWYWx1ZTogZGF0YUFycmF5WzBdLCBlbmRWYWx1ZTogZGF0YUFycmF5WzFdfSk7XHJcbiAgICAgICAgICAgIGNvbnN0IGRhdGFBcnJheSA9IGV2ZW50LnNwbGl0KFwiflwiKTtcclxuICAgICAgICAgICAgdGhpcy5pdGVtLnZhbHVlLnN0YXJ0VmFsdWUgPSBkYXRhQXJyYXlbMF0gPyBkYXRhQXJyYXlbMF0gOiBudWxsO1xyXG4gICAgICAgICAgICB0aGlzLml0ZW0udmFsdWUuZW5kVmFsdWUgPSBkYXRhQXJyYXlbMV0gPyBkYXRhQXJyYXlbMV0gOiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5faXRlbS52YWx1ZS5zdGFydFZhbHVlID0gbnVsbDtcclxuICAgICAgICAgICAgdGhpcy5faXRlbS52YWx1ZS5lbmRWYWx1ZSA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIGNvbnN0IGRhdGFBcnJheSA9IGV2ZW50LnNwbGl0KFwiflwiKTtcclxuICAgICAgICAvLyB0aGlzLl9pdGVtLnZhbHVlID0gKG5ldyBOdW1iZXJSYW5nZVZhbHVlQ29udmVydG9yKS5pbml0RnJvbU9iamVjdCh7c3RhcnRWYWx1ZTogZGF0YUFycmF5WzBdLCBlbmRWYWx1ZTogZGF0YUFycmF5WzFdfSk7XHJcbiAgICAgICAgaWYgKHRoaXMuZGlzYWJsZWQpIHsgcmV0dXJuOyB9XHJcbiAgICAgICAgdGhpcy5zZWFyY2hIYW5kbGUuZW1pdCgpO1xyXG4gICAgfVxyXG5cclxuICAgIGJlZ2luVmFsdWVDaGFuZ2UoJGV2ZW50KSB7XHJcbiAgICAgICAgdGhpcy5iZWdpblZhbHVlID0gJGV2ZW50O1xyXG4gICAgfVxyXG5cclxuICAgIGVuZFZhbHVlQ2hhbmdlKCRldmVudCkge1xyXG4gICAgICAgIHRoaXMuZW5kVmFsdWUgPSAkZXZlbnQ7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gb25TZWFyY2goKXtcclxuICAgIC8vICAgICBpZih0aGlzLmRpc2FibGVkKXtyZXR1cm47fVxyXG4gICAgLy8gICAgIHRoaXMuc2VhcmNoSGFuZGxlLmVtaXQoKTtcclxuICAgIC8vIH1cclxufSJdfQ==