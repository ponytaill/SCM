/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*
* @Author: 疯狂秀才(Lucas Huang)
* @Date: 2018-12-14 14:40:48
 * @LastEditors: 疯狂秀才(Lucas Huang)
 * @LastEditTime: 2019-09-25 18:10:29
* @Company: Inspur
* @Version: v0.0.1
*/
import { Component, ViewChild, ViewContainerRef, EventEmitter, Output, ComponentFactoryResolver, ChangeDetectorRef } from '@angular/core';
import { of } from 'rxjs';
import { DataTableComponent } from '@farris/ui-datatable';
import { TreeTableComponent } from '@farris/ui-treetable';
export class LookupLeftComponent {
    /**
     * @param {?} cfr
     * @param {?} cd
     */
    constructor(cfr, cd) {
        this.cfr = cfr;
        this.cd = cd;
        this.selected = new EventEmitter();
        this.unselected = new EventEmitter();
        this.search = new EventEmitter();
        this.pageChanged = new EventEmitter();
        this._searchState = null;
        this.allData = null;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
    }
    /**
     * @return {?}
     */
    createComponent() {
        /** @type {?} */
        let dtFac = null;
        if (!this.isTreeList()) {
            dtFac = this.cfr.resolveComponentFactory(DataTableComponent);
        }
        else {
            dtFac = this.cfr.resolveComponentFactory(TreeTableComponent);
        }
        this.navOptions['keepSelect'] = false;
        // 左侧查询过滤条，隐藏掉；
        this.navOptions['showFilterBar'] = true;
        // if (this.navOptions.width) {
        //     this.navOptions.width = this.navOptions.width - 2;
        // }
        this.navOptions.width = this.lookupCmp.leftPanelWidth - 2;
        // const injector: Injector = ReflectiveInjector.resolveAndCreate([
        //     { provide: DataTableService, useFactory: () => { new DataTableService()}}
        // ]);
        this.cmpRef = this.cmpContainer.createComponent(dtFac);
        if (!this.isTreeList()) {
            this.navOptions['fill'] = true;
            this.cmpRef.instance.maxSize = 5;
            this.cmpRef.instance.fill = true;
        }
        else {
            this.navOptions['fit'] = true;
        }
        // this.cmpRef.instance.fit = true;
        if (this.navOptions.pageInfo) {
            if (this.navOptions.pageInfo.pageList) {
                this.navOptions.pageList = this.navOptions.pageInfo.pageList;
            }
            this.navOptions.pagination = this.navOptions.pageInfo.enablePager;
            this.navOptions.pageIndex = this.navOptions.pageInfo.pageIndex;
            this.navOptions.pageSize = this.navOptions.pageInfo.pageSize;
        }
        else {
            this.navOptions.pagination = false;
        }
        Object.assign(this.cmpRef.instance, this.navOptions);
        this.loadData();
        return of(this.cmpRef);
    }
    /**
     * @return {?}
     */
    update() {
        this.cd.detectChanges();
    }
    /**
     * @param {?=} size
     * @return {?}
     */
    resize(size) {
        if (size) {
            size.width = size.width - 2;
            // if (this.cmpRef.instance instanceof TreeTableComponent) {
            //     size.height += 46;
            // }
            this.cmpRef.instance.resize(size);
        }
    }
    /**
     * @return {?}
     */
    isTreeList() {
        return this.navOptions.displayType.toLowerCase() === 'treelist';
    }
    /**
     * @private
     * @param {?} items
     * @param {?} dt
     * @return {?}
     */
    selectLeftDataTableRow(items, dt) {
        if (items && items.length) {
            /** @type {?} */
            let item = null;
            if (this.lookupCmp.navSelectedIds) {
                item = items.find((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => n[dt.idField] == this.lookupCmp.navSelectedIds));
            }
            else {
                if (this.lookupCmp.selectFirstInNav) {
                    item = items[0];
                }
            }
            if (item) {
                dt.dtBody.selectedRowIndex = -1;
                dt.dtBody.selectedRow('', 0, item);
            }
        }
    }
    /**
     * @private
     * @return {?}
     */
    closeLoading() {
        this.lookupCmp.closeLoading();
    }
    /**
     * @private
     * @param {?} dt
     * @return {?}
     */
    initDataTable(dt) {
        dt.loadData({
            pageSize: this.navOptions.pageSize,
            pageIndex: this.navOptions.pageIndex,
            total: this.navOptions.total,
            data: this.navOptions.items,
        });
        dt.resize({ width: 320, height: this.navOptions.height });
        // 行选中
        dt.selectedRow.subscribe((/**
         * @param {?} d
         * @return {?}
         */
        d => {
            this.selected.emit({ data: d.data });
        }));
        dt.unSelectRow.subscribe((/**
         * @param {?} d
         * @return {?}
         */
        d => {
            this.selected.emit(null);
        }));
        /** @type {?} */
        const p = { pageInfo: { pageIndex: 1, pageSize: this.navOptions.pageSize }, search: '' };
        /** @type {?} */
        const loadTableData = {
            next: (/**
             * @param {?} data
             * @return {?}
             */
            (data) => {
                this.closeLoading();
                dataTableReLoad(data);
            }),
            error: (/**
             * @param {?} err
             * @return {?}
             */
            (err) => {
                this.closeLoading();
            })
        };
        // 查询
        dt.search.subscribe((/**
         * @param {?} searchData
         * @return {?}
         */
        searchData => {
            this._searchState = searchData;
            this.search.emit(searchData);
            p.search = searchData;
            p.pageInfo.pageSize = dt.pageSize;
            this.lookupCmp.navigationFilter = null;
            this.lookupCmp.httpMgr.getData(p, 'navsearch').subscribe(loadTableData);
        }));
        /** @type {?} */
        const dataTableReLoad = (/**
         * @param {?} data
         * @return {?}
         */
        (data) => {
            dt.loadData({
                pageSize: data.pageInfo.pageSize,
                pageIndex: data.pageInfo.pageIndex,
                total: data.total,
                data: data.items,
            });
            this.selectLeftDataTableRow(data.items, dt);
            dt.cd.markForCheck();
        });
        // 分页
        dt.pageChanged.subscribe((/**
         * @param {?} d
         * @return {?}
         */
        d => {
            this.pageChanged.emit(d);
            this.lookupCmp.navigationFilter = null;
            this.lookupCmp.httpMgr.getData(d, 'navsearch').subscribe(loadTableData);
        }));
        dt.pageSizeChanged.subscribe((/**
         * @param {?} e
         * @return {?}
         */
        (e) => {
            this.lookupCmp.navigationFilter = null;
            this.lookupCmp.httpMgr.getData(e, 'navsearch').subscribe(loadTableData);
        }));
        dt.columnSorted.subscribe((/**
         * @param {?} sort
         * @return {?}
         */
        (sort) => {
            const { sortName, sortOrder } = Object.assign({}, sort);
            this.lookupCmp.navigationFilter = null;
            /** @type {?} */
            const param = Object.assign({ sortName, sortOrder }, this._searchState);
            this.lookupCmp.httpMgr.getData(param, 'navsearch').subscribe(loadTableData);
        }));
        dt.clearSearchValue.subscribe((/**
         * @return {?}
         */
        () => {
            this._searchState = null;
        }));
        this.selectLeftDataTableRow(this.navOptions.items, dt);
    }
    /**
     * @private
     * @param {?} tt
     * @return {?}
     */
    initTreeTable(tt) {
        tt.virtualized = true;
        tt.nodeSelected.subscribe((/**
         * @param {?} d
         * @return {?}
         */
        d => {
            this.selected.emit({ data: d.node.data });
        }));
        tt.nodeUnSelect.subscribe((/**
         * @param {?} d
         * @return {?}
         */
        d => {
            this.selected.emit(null);
        }));
        tt.fixedHeader = true;
        // tt.fit = true;
        this.lookupCmp.treeNodeHelper.updateTreeNodeExpanded(this.navOptions.items, this.navOptions.treeInfo);
        tt.loadDataType = this.navOptions.treeInfo.loadDataType;
        // 检查完整树过滤条件 By Lucas 20200302
        this.navOptions.items = this.lookupCmp.checkNodeCanBeSelect(this.navOptions.items, this.navOptions.treeInfo.loadDataType === 'all');
        tt.loadData(this.navOptions.items);
        if (this.lookupCmp.navSelectedIds) {
            tt.selectNode(this.lookupCmp.navSelectedIds);
        }
        else if (this.lookupCmp.selectFirstInNav) {
            tt.selectFirstNode();
        }
        this.allData = this.navOptions.items;
        /** @type {?} */
        const loadTreeData = {
            next: (/**
             * @param {?} resData
             * @return {?}
             */
            (resData) => {
                this.closeLoading();
                tt.clearAll();
                /** @type {?} */
                const items = this.lookupCmp.checkNodeCanBeSelect(resData.items, this.navOptions.treeInfo.loadDataType === 'all');
                tt.loadData(items);
                tt.resize();
            }),
            error: (/**
             * @param {?} err
             * @return {?}
             */
            (err) => {
                this.closeLoading();
            })
        };
        tt.search.subscribe((/**
         * @param {?} search
         * @return {?}
         */
        search => {
            this._searchState = search;
            this.lookupCmp.navigationFilter = null;
            this.lookupCmp.httpMgr.getData({ search }, 'navsearch').subscribe(loadTreeData);
        }));
        tt.columnSorted.subscribe((/**
         * @param {?} sort
         * @return {?}
         */
        (sort) => {
            this.lookupCmp.navigationFilter = null;
            if (tt.loadDataType === 'all') {
                tt.clientSort();
            }
            else {
                const { sortName, sortOrder } = Object.assign({}, sort);
                /** @type {?} */
                const param = Object.assign({ sortName, sortOrder }, this._searchState);
                this.lookupCmp.httpMgr.getData(param, 'nav').subscribe(loadTreeData);
            }
        }));
        tt.clearSearchValue.subscribe((/**
         * @return {?}
         */
        () => {
            this._searchState = null;
            tt.loadData(this.allData);
        }));
        tt.expand.subscribe((/**
         * @param {?} tn
         * @return {?}
         */
        (tn) => {
            this.onNodeExpanded(tn, tt);
        }));
    }
    /**
     * @private
     * @param {?} tn
     * @param {?} tt
     * @return {?}
     */
    onNodeExpanded(tn, tt) {
        if (tn.leaf) {
            return;
        }
        if (!tn.children || !tn.children.length) {
            /** @type {?} */
            const treeInfo = this.navOptions.treeInfo;
            if (this.navOptions.treeInfo.loadDataType === 'async') {
                /** @type {?} */
                let parentPath = '';
                /** @type {?} */
                let parentLayer = -1;
                const { field = '*', value = '' } = Object.assign({}, tt.searchData);
                tn['showLoading'] = true;
                tt.detectChanges();
                if (treeInfo.layerType === 'parentId') {
                    // 父ID加载方式
                    parentPath = tn['id'];
                }
                else {
                    /** @type {?} */
                    const treeInfoField = treeInfo.dataField;
                    if (treeInfoField) {
                        parentPath = tn.data[treeInfoField][treeInfo.pathField];
                        parentLayer = tn.data[treeInfoField][treeInfo.layerField];
                    }
                    else {
                        console.log('未找到分级信息。');
                    }
                }
                if (!this.lookupCmp.uri) {
                    this.lookupCmp.expandTreeNode.emit({
                        instance: tt, node: tn,
                        parentIdOrPath: parentPath, parentLayer, search: { value, field }
                    });
                    return;
                }
                this.getChildren(parentPath, parentLayer, { searchField: field === '*' ? '*' : field, searchValue: value }, tt).subscribe((/**
                 * @param {?} data
                 * @return {?}
                 */
                data => {
                    if (tt) {
                        if (tn && data.items && data.items.length) {
                            tt.appendChildren(data.items, tn);
                        }
                        tn['showLoading'] = false;
                        tt.detectChanges();
                    }
                }));
            }
        }
    }
    /**
     * @private
     * @param {?} parentPath
     * @param {?} parentLayer
     * @param {?} searchData
     * @param {?} tt
     * @return {?}
     */
    getChildren(parentPath, parentLayer, searchData, tt) {
        /** @type {?} */
        const uri = this.lookupCmp.gridOptions.uri;
        /** @type {?} */
        const search = Object.assign({ parentLayer, category: 'nav' }, searchData);
        if (this.navOptions.treeInfo.layerType === 'parentId') {
            search['parentId'] = parentPath;
        }
        else {
            search['parentPath'] = parentPath;
        }
        /** @type {?} */
        const param = {
            searchValue: JSON.stringify(search),
            customData: this.lookupCmp.customData,
            enableFullTree: false,
            loadTreeDataType: 'layerload'
        };
        if (this.lookupCmp.helpId) {
            param['helpId'] = this.lookupCmp.helpId;
        }
        if (tt && tt.sortName) {
            Object.assign(param, {
                sortName: tt.sortName,
                sortOrder: tt.sortOrder
            });
        }
        return this.lookupCmp.http.getData(uri, param);
    }
    /**
     * @return {?}
     */
    loadData() {
        this.cmpRef.instance.allColumnsTitle = this.lookupCmp.allColumnsTitle;
        if (!this.isTreeList()) {
            /** @type {?} */
            const dt = (/** @type {?} */ (this.cmpRef.instance));
            this.initDataTable(dt);
        }
        else {
            /** @type {?} */
            const tt = (/** @type {?} */ (this.cmpRef.instance));
            this.initTreeTable(tt);
        }
    }
}
LookupLeftComponent.decorators = [
    { type: Component, args: [{
                selector: 'lookup-left',
                template: "<div style=\"height: 100%;position: relative;\">\r\n    <ng-container #container></ng-container>\r\n</div>"
            }] }
];
/** @nocollapse */
LookupLeftComponent.ctorParameters = () => [
    { type: ComponentFactoryResolver },
    { type: ChangeDetectorRef }
];
LookupLeftComponent.propDecorators = {
    cmpContainer: [{ type: ViewChild, args: ['container', { read: ViewContainerRef },] }],
    selected: [{ type: Output }],
    unselected: [{ type: Output }],
    search: [{ type: Output }],
    pageChanged: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    LookupLeftComponent.prototype.cmpRef;
    /** @type {?} */
    LookupLeftComponent.prototype.navOptions;
    /** @type {?} */
    LookupLeftComponent.prototype.lookupCmp;
    /** @type {?} */
    LookupLeftComponent.prototype.cmpContainer;
    /** @type {?} */
    LookupLeftComponent.prototype.selected;
    /** @type {?} */
    LookupLeftComponent.prototype.unselected;
    /** @type {?} */
    LookupLeftComponent.prototype.search;
    /** @type {?} */
    LookupLeftComponent.prototype.pageChanged;
    /**
     * @type {?}
     * @private
     */
    LookupLeftComponent.prototype._searchState;
    /**
     * @type {?}
     * @private
     */
    LookupLeftComponent.prototype.allData;
    /**
     * @type {?}
     * @private
     */
    LookupLeftComponent.prototype.cfr;
    /**
     * @type {?}
     * @private
     */
    LookupLeftComponent.prototype.cd;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9va3VwLWxlZnQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1sb29rdXAvIiwic291cmNlcyI6WyJsaWIvbG9va3VwLWxlZnQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQVNBLE9BQU8sRUFBRSxTQUFTLEVBQVUsU0FBUyxFQUFFLGdCQUFnQixFQUFFLFlBQVksRUFBRSxNQUFNLEVBQ3pFLHdCQUF3QixFQUFnQixpQkFBaUIsRUFDNUQsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFjLEVBQUUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUV0QyxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUMxRCxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQVUxRCxNQUFNLE9BQU8sbUJBQW1COzs7OztJQWdCNUIsWUFBb0IsR0FBNkIsRUFBVSxFQUFxQjtRQUE1RCxRQUFHLEdBQUgsR0FBRyxDQUEwQjtRQUFVLE9BQUUsR0FBRixFQUFFLENBQW1CO1FBUnRFLGFBQVEsR0FBRyxJQUFJLFlBQVksRUFBZ0IsQ0FBQztRQUM1QyxlQUFVLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUNoQyxXQUFNLEdBQUcsSUFBSSxZQUFZLEVBQW9DLENBQUM7UUFDOUQsZ0JBQVcsR0FBRyxJQUFJLFlBQVksRUFBK0YsQ0FBQztRQUVoSSxpQkFBWSxHQUFHLElBQUksQ0FBQztRQUNwQixZQUFPLEdBQUcsSUFBSSxDQUFDO0lBRTZELENBQUM7Ozs7SUFFckYsUUFBUTtJQUNSLENBQUM7Ozs7SUFFRCxlQUFlOztZQUNQLEtBQUssR0FBRyxJQUFJO1FBQ2hCLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLEVBQUU7WUFDcEIsS0FBSyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsdUJBQXVCLENBQUMsa0JBQWtCLENBQUMsQ0FBQztTQUNoRTthQUFN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QUFDLEdBQUcsRUFBRyxLQUFLLENBQUMsQ0FBQztJQUNwRCxDQUFDOzs7O0lBR0QsUUFBUTtRQUNKLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLGVBQWUsQ0FBQztRQUN0RSxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSxFQUFFOztrQkFDZCxFQUFFLEdBQUcsbUJBQUEsSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLEVBQXNCO1lBQ3JELElBQUksQ0FBQyxhQUFhLENBQUMsRUFBRSxDQUFDLENBQUM7U0FDMUI7YUFBTTs7a0JBQ0csRUFBRSxHQUFHLG1CQUFBLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxFQUFzQjtZQUNyRCxJQUFJLENBQUMsYUFBYSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1NBQzFCO0lBQ0wsQ0FBQzs7O1lBcFdKLFNBQVMsU0FBQztnQkFDUCxRQUFRLEVBQUUsYUFBYTtnQkFDdkIsc0hBQTJDO2FBQzlDOzs7O1lBYkcsd0JBQXdCO1lBQWdCLGlCQUFpQjs7OzJCQXNCeEQsU0FBUyxTQUFDLFdBQVcsRUFBRSxFQUFDLElBQUksRUFBRSxnQkFBZ0IsRUFBQzt1QkFDL0MsTUFBTTt5QkFDTixNQUFNO3FCQUNOLE1BQU07MEJBQ04sTUFBTTs7OztJQVRQLHFDQUEwQjs7SUFDMUIseUNBQThCOztJQUM5Qix3Q0FBK0I7O0lBRy9CLDJDQUFpRjs7SUFDakYsdUNBQXNEOztJQUN0RCx5Q0FBMEM7O0lBQzFDLHFDQUF3RTs7SUFDeEUsMENBQXdJOzs7OztJQUV4SSwyQ0FBNEI7Ozs7O0lBQzVCLHNDQUF1Qjs7Ozs7SUFFWCxrQ0FBcUM7Ozs7O0lBQUUsaUNBQTZCIiwic291cmNlc0NvbnRlbnQiOlsiLypcclxuKiBAQXV0aG9yOiDnlq/ni4Lnp4DmiY0oTHVjYXMgSHVhbmcpXHJcbiogQERhdGU6IDIwMTgtMTItMTQgMTQ6NDA6NDhcclxuICogQExhc3RFZGl0b3JzOiDnlq/ni4Lnp4DmiY0oTHVjYXMgSHVhbmcpXHJcbiAqIEBMYXN0RWRpdFRpbWU6IDIwMTktMDktMjUgMTg6MTA6MjlcclxuKiBAQ29tcGFueTogSW5zcHVyXHJcbiogQFZlcnNpb246IHYwLjAuMVxyXG4qL1xyXG5cclxuaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIFZpZXdDaGlsZCwgVmlld0NvbnRhaW5lclJlZiwgRXZlbnRFbWl0dGVyLCBPdXRwdXQsXHJcbiAgICBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsIENvbXBvbmVudFJlZiwgQ2hhbmdlRGV0ZWN0b3JSZWYsIEluamVjdG9yLCBSZWZsZWN0aXZlSW5qZWN0b3JcclxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgb2YgfSBmcm9tICdyeGpzJztcclxuXHJcbmltcG9ydCB7IERhdGFUYWJsZUNvbXBvbmVudCB9IGZyb20gJ0BmYXJyaXMvdWktZGF0YXRhYmxlJztcclxuaW1wb3J0IHsgVHJlZVRhYmxlQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS10cmVldGFibGUnO1xyXG5cclxuaW1wb3J0IHsgTG9va3VwR3JpZE9wdGlvbnMsIExvb2t1cEdyaWRSZXN1bHQgfSBmcm9tICcuL2xvb2t1cC1ncmlkLW9wdGlvbnMnO1xyXG5pbXBvcnQgeyBMb29rdXBHcmlkQ29tcG9uZW50IH0gZnJvbSAnLi9sb29rdXAtZ3JpZC5jb21wb25lbnQnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ2xvb2t1cC1sZWZ0JyxcclxuICAgIHRlbXBsYXRlVXJsOiAnLi9sb29rdXAtbGVmdC5jb21wb25lbnQuaHRtbCdcclxufSlcclxuXHJcbmV4cG9ydCBjbGFzcyBMb29rdXBMZWZ0Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuXHJcbiAgICBjbXBSZWY6IENvbXBvbmVudFJlZjxhbnk+O1xyXG4gICAgbmF2T3B0aW9uczogTG9va3VwR3JpZE9wdGlvbnM7XHJcbiAgICBsb29rdXBDbXA6IExvb2t1cEdyaWRDb21wb25lbnQ7XHJcblxyXG5cclxuICAgIEBWaWV3Q2hpbGQoJ2NvbnRhaW5lcicsIHtyZWFkOiBWaWV3Q29udGFpbmVyUmVmfSkgY21wQ29udGFpbmVyOiBWaWV3Q29udGFpbmVyUmVmO1xyXG4gICAgQE91dHB1dCgpIHNlbGVjdGVkID0gbmV3IEV2ZW50RW1pdHRlcjx7IGRhdGE6IGFueX0+KCk7XHJcbiAgICBAT3V0cHV0KCkgdW5zZWxlY3RlZCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIEBPdXRwdXQoKSBzZWFyY2ggPSBuZXcgRXZlbnRFbWl0dGVyPHsgZmllbGQ6IHN0cmluZywgdmFsdWU6IHN0cmluZyB9PigpO1xyXG4gICAgQE91dHB1dCgpIHBhZ2VDaGFuZ2VkID0gbmV3IEV2ZW50RW1pdHRlcjx7IHBhZ2VJbmZvOiB7cGFnZUluZGV4OiBudW1iZXIsIHBhZ2VTaXplOiBudW1iZXJ9LCBzZWFyY2g6IHtmaWVsZDogc3RyaW5nLCB2YWx1ZTogc3RyaW5nfSB9PigpO1xyXG5cclxuICAgIHByaXZhdGUgX3NlYXJjaFN0YXRlID0gbnVsbDtcclxuICAgIHByaXZhdGUgYWxsRGF0YSA9IG51bGw7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBjZnI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciwgcHJpdmF0ZSBjZDogQ2hhbmdlRGV0ZWN0b3JSZWYpIHsgfVxyXG5cclxuICAgIG5nT25Jbml0KCkge1xyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZUNvbXBvbmVudCgpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgICAgIGxldCBkdEZhYyA9IG51bGw7XHJcbiAgICAgICAgaWYgKCF0aGlzLmlzVHJlZUxpc3QoKSkge1xyXG4gICAgICAgICAgICBkdEZhYyA9IHRoaXMuY2ZyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KERhdGFUYWJsZUNvbXBvbmVudCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgZHRGYWMgPSB0aGlzLmNmci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShUcmVlVGFibGVDb21wb25lbnQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLm5hdk9wdGlvbnNbJ2tlZXBTZWxlY3QnXSA9IGZhbHNlO1xyXG4gICAgICAgIC8vIOW3puS+p+afpeivoui/h+a7pOadoe+8jOmakOiXj+aOie+8m1xyXG4gICAgICAgIHRoaXMubmF2T3B0aW9uc1snc2hvd0ZpbHRlckJhciddID0gdHJ1ZTtcclxuICAgICAgICAvLyBpZiAodGhpcy5uYXZPcHRpb25zLndpZHRoKSB7XHJcbiAgICAgICAgLy8gICAgIHRoaXMubmF2T3B0aW9ucy53aWR0aCA9IHRoaXMubmF2T3B0aW9ucy53aWR0aCAtIDI7XHJcbiAgICAgICAgLy8gfVxyXG5cclxuICAgICAgICB0aGlzLm5hdk9wdGlvbnMud2lkdGggPSB0aGlzLmxvb2t1cENtcC5sZWZ0UGFuZWxXaWR0aCAtIDI7XHJcblxyXG4gICAgICAgIC8vIGNvbnN0IGluamVjdG9yOiBJbmplY3RvciA9IFJlZmxlY3RpdmVJbmplY3Rvci5yZXNvbHZlQW5kQ3JlYXRlKFtcclxuICAgICAgICAvLyAgICAgeyBwcm92aWRlOiBEYXRhVGFibGVTZXJ2aWNlLCB1c2VGYWN0b3J5OiAoKSA9PiB7IG5ldyBEYXRhVGFibGVTZXJ2aWNlKCl9fVxyXG4gICAgICAgIC8vIF0pO1xyXG5cclxuICAgICAgICB0aGlzLmNtcFJlZiA9IHRoaXMuY21wQ29udGFpbmVyLmNyZWF0ZUNvbXBvbmVudChkdEZhYyk7XHJcblxyXG4gICAgICAgIGlmICghdGhpcy5pc1RyZWVMaXN0KCkpIHtcclxuICAgICAgICAgICAgdGhpcy5uYXZPcHRpb25zWydmaWxsJ10gPSB0cnVlO1xyXG4gICAgICAgICAgICB0aGlzLmNtcFJlZi5pbnN0YW5jZS5tYXhTaXplID0gNTtcclxuICAgICAgICAgICAgdGhpcy5jbXBSZWYuaW5zdGFuY2UuZmlsbCA9IHRydWU7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5uYXZPcHRpb25zWydmaXQnXSA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIHRoaXMuY21wUmVmLmluc3RhbmNlLmZpdCA9IHRydWU7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLm5hdk9wdGlvbnMucGFnZUluZm8pIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMubmF2T3B0aW9ucy5wYWdlSW5mby5wYWdlTGlzdCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5uYXZPcHRpb25zLnBhZ2VMaXN0ID0gdGhpcy5uYXZPcHRpb25zLnBhZ2VJbmZvLnBhZ2VMaXN0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMubmF2T3B0aW9ucy5wYWdpbmF0aW9uID0gdGhpcy5uYXZPcHRpb25zLnBhZ2VJbmZvLmVuYWJsZVBhZ2VyO1xyXG4gICAgICAgICAgICB0aGlzLm5hdk9wdGlvbnMucGFnZUluZGV4ID0gdGhpcy5uYXZPcHRpb25zLnBhZ2VJbmZvLnBhZ2VJbmRleDtcclxuICAgICAgICAgICAgdGhpcy5uYXZPcHRpb25zLnBhZ2VTaXplID0gdGhpcy5uYXZPcHRpb25zLnBhZ2VJbmZvLnBhZ2VTaXplO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMubmF2T3B0aW9ucy5wYWdpbmF0aW9uID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBPYmplY3QuYXNzaWduKHRoaXMuY21wUmVmLmluc3RhbmNlLCB0aGlzLm5hdk9wdGlvbnMpO1xyXG5cclxuICAgICAgICB0aGlzLmxvYWREYXRhKCk7XHJcbiAgICAgICAgcmV0dXJuIG9mKHRoaXMuY21wUmVmKTtcclxuICAgIH1cclxuXHJcbiAgICB1cGRhdGUoKSB7XHJcbiAgICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVzaXplKHNpemU/OiB7d2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXJ9KSB7XHJcbiAgICAgICAgaWYgKHNpemUpIHtcclxuICAgICAgICAgICAgc2l6ZS53aWR0aCA9IHNpemUud2lkdGggLSAyO1xyXG4gICAgICAgICAgICAvLyBpZiAodGhpcy5jbXBSZWYuaW5zdGFuY2UgaW5zdGFuY2VvZiBUcmVlVGFibGVDb21wb25lbnQpIHtcclxuICAgICAgICAgICAgLy8gICAgIHNpemUuaGVpZ2h0ICs9IDQ2O1xyXG4gICAgICAgICAgICAvLyB9XHJcbiAgICAgICAgICAgIHRoaXMuY21wUmVmLmluc3RhbmNlLnJlc2l6ZShzaXplKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaXNUcmVlTGlzdCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5uYXZPcHRpb25zLmRpc3BsYXlUeXBlLnRvTG93ZXJDYXNlKCkgPT09ICd0cmVlbGlzdCc7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzZWxlY3RMZWZ0RGF0YVRhYmxlUm93KGl0ZW1zOiBhbnksIGR0OiBEYXRhVGFibGVDb21wb25lbnQpIHtcclxuICAgICAgICBpZiAoaXRlbXMgJiYgaXRlbXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGxldCBpdGVtID0gbnVsbDtcclxuICAgICAgICAgICAgaWYgKHRoaXMubG9va3VwQ21wLm5hdlNlbGVjdGVkSWRzKSB7XHJcbiAgICAgICAgICAgICAgICBpdGVtID0gaXRlbXMuZmluZChuID0+IG5bZHQuaWRGaWVsZF0gPT0gdGhpcy5sb29rdXBDbXAubmF2U2VsZWN0ZWRJZHMpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubG9va3VwQ21wLnNlbGVjdEZpcnN0SW5OYXYpIHtcclxuICAgICAgICAgICAgICAgICAgICBpdGVtID0gaXRlbXNbMF07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICBkdC5kdEJvZHkuc2VsZWN0ZWRSb3dJbmRleCA9IC0xO1xyXG4gICAgICAgICAgICAgICAgZHQuZHRCb2R5LnNlbGVjdGVkUm93KCcnLCAwLCBpdGVtKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNsb3NlTG9hZGluZygpIHtcclxuICAgICAgICB0aGlzLmxvb2t1cENtcC5jbG9zZUxvYWRpbmcoKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGluaXREYXRhVGFibGUoZHQ6IERhdGFUYWJsZUNvbXBvbmVudCkge1xyXG4gICAgICAgIGR0LmxvYWREYXRhKHtcclxuICAgICAgICAgICAgcGFnZVNpemU6IHRoaXMubmF2T3B0aW9ucy5wYWdlU2l6ZSxcclxuICAgICAgICAgICAgcGFnZUluZGV4OiB0aGlzLm5hdk9wdGlvbnMucGFnZUluZGV4LFxyXG4gICAgICAgICAgICB0b3RhbDogdGhpcy5uYXZPcHRpb25zLnRvdGFsLFxyXG4gICAgICAgICAgICBkYXRhOiB0aGlzLm5hdk9wdGlvbnMuaXRlbXMsXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGR0LnJlc2l6ZSh7IHdpZHRoOiAzMjAsIGhlaWdodDogdGhpcy5uYXZPcHRpb25zLmhlaWdodH0pO1xyXG4gICAgICAgIC8vIOihjOmAieS4rVxyXG4gICAgICAgIGR0LnNlbGVjdGVkUm93LnN1YnNjcmliZShkID0+IHtcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZC5lbWl0KHsgZGF0YTogZC5kYXRhIH0pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBkdC51blNlbGVjdFJvdy5zdWJzY3JpYmUoZCA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWQuZW1pdChudWxsKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgY29uc3QgcCA9IHsgcGFnZUluZm86IHsgcGFnZUluZGV4OiAxLCBwYWdlU2l6ZTogdGhpcy5uYXZPcHRpb25zLnBhZ2VTaXplIH0sIHNlYXJjaDogJycgfTtcclxuXHJcblxyXG4gICAgICAgIGNvbnN0IGxvYWRUYWJsZURhdGEgPSB7XHJcbiAgICAgICAgICAgIG5leHQ6IChkYXRhOiBMb29rdXBHcmlkUmVzdWx0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlTG9hZGluZygpO1xyXG4gICAgICAgICAgICAgICAgZGF0YVRhYmxlUmVMb2FkKGRhdGEpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBlcnJvcjogKGVycikgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZUxvYWRpbmcoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vIOafpeivolxyXG4gICAgICAgIGR0LnNlYXJjaC5zdWJzY3JpYmUoIHNlYXJjaERhdGEgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLl9zZWFyY2hTdGF0ZSA9IHNlYXJjaERhdGE7XHJcbiAgICAgICAgICAgIHRoaXMuc2VhcmNoLmVtaXQoc2VhcmNoRGF0YSk7XHJcbiAgICAgICAgICAgIHAuc2VhcmNoID0gc2VhcmNoRGF0YTtcclxuICAgICAgICAgICAgcC5wYWdlSW5mby5wYWdlU2l6ZSA9IGR0LnBhZ2VTaXplO1xyXG4gICAgICAgICAgICB0aGlzLmxvb2t1cENtcC5uYXZpZ2F0aW9uRmlsdGVyID0gbnVsbDtcclxuICAgICAgICAgICAgdGhpcy5sb29rdXBDbXAuaHR0cE1nci5nZXREYXRhKHAsICduYXZzZWFyY2gnKS5zdWJzY3JpYmUobG9hZFRhYmxlRGF0YSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGNvbnN0IGRhdGFUYWJsZVJlTG9hZCA9IChkYXRhKSA9PiB7XHJcbiAgICAgICAgICAgIGR0LmxvYWREYXRhKHtcclxuICAgICAgICAgICAgICAgIHBhZ2VTaXplOiBkYXRhLnBhZ2VJbmZvLnBhZ2VTaXplLFxyXG4gICAgICAgICAgICAgICAgcGFnZUluZGV4OiBkYXRhLnBhZ2VJbmZvLnBhZ2VJbmRleCxcclxuICAgICAgICAgICAgICAgIHRvdGFsOiBkYXRhLnRvdGFsLFxyXG4gICAgICAgICAgICAgICAgZGF0YTogZGF0YS5pdGVtcyxcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdExlZnREYXRhVGFibGVSb3coZGF0YS5pdGVtcywgZHQpO1xyXG4gICAgICAgICAgICBkdC5jZC5tYXJrRm9yQ2hlY2soKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvLyDliIbpobVcclxuICAgICAgICBkdC5wYWdlQ2hhbmdlZC5zdWJzY3JpYmUoZCA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMucGFnZUNoYW5nZWQuZW1pdChkKTtcclxuICAgICAgICAgICAgdGhpcy5sb29rdXBDbXAubmF2aWdhdGlvbkZpbHRlciA9IG51bGw7XHJcbiAgICAgICAgICAgIHRoaXMubG9va3VwQ21wLmh0dHBNZ3IuZ2V0RGF0YShkLCAnbmF2c2VhcmNoJykuc3Vic2NyaWJlKGxvYWRUYWJsZURhdGEpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBkdC5wYWdlU2l6ZUNoYW5nZWQuc3Vic2NyaWJlKChlKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMubG9va3VwQ21wLm5hdmlnYXRpb25GaWx0ZXIgPSBudWxsO1xyXG4gICAgICAgICAgICB0aGlzLmxvb2t1cENtcC5odHRwTWdyLmdldERhdGEoZSwgJ25hdnNlYXJjaCcpLnN1YnNjcmliZShsb2FkVGFibGVEYXRhKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgZHQuY29sdW1uU29ydGVkLnN1YnNjcmliZSggKHNvcnQ6IHtzb3J0TmFtZTogc3RyaW5nLCBzb3J0T3JkZXI6IGFueX0pID0+IHtcclxuICAgICAgICAgICAgY29uc3QgeyBzb3J0TmFtZSwgc29ydE9yZGVyIH0gPSB7Li4uc29ydH07XHJcbiAgICAgICAgICAgIHRoaXMubG9va3VwQ21wLm5hdmlnYXRpb25GaWx0ZXIgPSBudWxsO1xyXG4gICAgICAgICAgICBjb25zdCBwYXJhbSA9IE9iamVjdC5hc3NpZ24oeyBzb3J0TmFtZSwgc29ydE9yZGVyIH0sIHRoaXMuX3NlYXJjaFN0YXRlKTtcclxuICAgICAgICAgICAgdGhpcy5sb29rdXBDbXAuaHR0cE1nci5nZXREYXRhKHBhcmFtLCAnbmF2c2VhcmNoJykuc3Vic2NyaWJlKGxvYWRUYWJsZURhdGEpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBkdC5jbGVhclNlYXJjaFZhbHVlLnN1YnNjcmliZSggKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLl9zZWFyY2hTdGF0ZSA9IG51bGw7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMuc2VsZWN0TGVmdERhdGFUYWJsZVJvdyh0aGlzLm5hdk9wdGlvbnMuaXRlbXMsIGR0KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGluaXRUcmVlVGFibGUodHQ6IFRyZWVUYWJsZUNvbXBvbmVudCkge1xyXG4gICAgICAgIHR0LnZpcnR1YWxpemVkID0gdHJ1ZTtcclxuICAgICAgICB0dC5ub2RlU2VsZWN0ZWQuc3Vic2NyaWJlKGQgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkLmVtaXQoe2RhdGE6IGQubm9kZS5kYXRhfSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHR0Lm5vZGVVblNlbGVjdC5zdWJzY3JpYmUoZCA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWQuZW1pdChudWxsKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdHQuZml4ZWRIZWFkZXIgPSB0cnVlO1xyXG5cclxuICAgICAgICAvLyB0dC5maXQgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMubG9va3VwQ21wLnRyZWVOb2RlSGVscGVyLnVwZGF0ZVRyZWVOb2RlRXhwYW5kZWQodGhpcy5uYXZPcHRpb25zLml0ZW1zLCB0aGlzLm5hdk9wdGlvbnMudHJlZUluZm8pO1xyXG5cclxuICAgICAgICB0dC5sb2FkRGF0YVR5cGUgPSB0aGlzLm5hdk9wdGlvbnMudHJlZUluZm8ubG9hZERhdGFUeXBlO1xyXG4gICAgICAgIC8vIOajgOafpeWujOaVtOagkei/h+a7pOadoeS7tiBCeSBMdWNhcyAyMDIwMDMwMlxyXG4gICAgICAgIHRoaXMubmF2T3B0aW9ucy5pdGVtcyA9IHRoaXMubG9va3VwQ21wLmNoZWNrTm9kZUNhbkJlU2VsZWN0KHRoaXMubmF2T3B0aW9ucy5pdGVtcywgdGhpcy5uYXZPcHRpb25zLnRyZWVJbmZvLmxvYWREYXRhVHlwZSA9PT0gJ2FsbCcpO1xyXG4gICAgICAgIHR0LmxvYWREYXRhKHRoaXMubmF2T3B0aW9ucy5pdGVtcyk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmxvb2t1cENtcC5uYXZTZWxlY3RlZElkcykge1xyXG4gICAgICAgICAgICB0dC5zZWxlY3ROb2RlKHRoaXMubG9va3VwQ21wLm5hdlNlbGVjdGVkSWRzKTtcclxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMubG9va3VwQ21wLnNlbGVjdEZpcnN0SW5OYXYpIHtcclxuICAgICAgICAgICAgdHQuc2VsZWN0Rmlyc3ROb2RlKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmFsbERhdGEgPSB0aGlzLm5hdk9wdGlvbnMuaXRlbXM7XHJcblxyXG4gICAgICAgIGNvbnN0IGxvYWRUcmVlRGF0YSA9IHtcclxuICAgICAgICAgICAgbmV4dDogKHJlc0RhdGE6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZUxvYWRpbmcoKTtcclxuICAgICAgICAgICAgICAgIHR0LmNsZWFyQWxsKCk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBpdGVtcyA9IHRoaXMubG9va3VwQ21wLmNoZWNrTm9kZUNhbkJlU2VsZWN0KHJlc0RhdGEuaXRlbXMsIHRoaXMubmF2T3B0aW9ucy50cmVlSW5mby5sb2FkRGF0YVR5cGUgPT09ICdhbGwnKTtcclxuICAgICAgICAgICAgICAgIHR0LmxvYWREYXRhKGl0ZW1zKTtcclxuICAgICAgICAgICAgICAgIHR0LnJlc2l6ZSgpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBlcnJvcjogKGVycikgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZUxvYWRpbmcoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG5cclxuICAgICAgICB0dC5zZWFyY2guc3Vic2NyaWJlKHNlYXJjaCA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuX3NlYXJjaFN0YXRlID0gc2VhcmNoO1xyXG4gICAgICAgICAgICB0aGlzLmxvb2t1cENtcC5uYXZpZ2F0aW9uRmlsdGVyID0gbnVsbDtcclxuICAgICAgICAgICAgdGhpcy5sb29rdXBDbXAuaHR0cE1nci5nZXREYXRhKHsgc2VhcmNoIH0sICduYXZzZWFyY2gnKS5zdWJzY3JpYmUobG9hZFRyZWVEYXRhKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdHQuY29sdW1uU29ydGVkLnN1YnNjcmliZSggKHNvcnQ6IHtzb3J0TmFtZTogc3RyaW5nLCBzb3J0T3JkZXI6IGFueX0pID0+IHtcclxuICAgICAgICAgICAgdGhpcy5sb29rdXBDbXAubmF2aWdhdGlvbkZpbHRlciA9IG51bGw7XHJcbiAgICAgICAgICAgIGlmICh0dC5sb2FkRGF0YVR5cGUgPT09ICdhbGwnKSB7XHJcbiAgICAgICAgICAgICAgICB0dC5jbGllbnRTb3J0KCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB7IHNvcnROYW1lLCBzb3J0T3JkZXIgfSA9IHsuLi5zb3J0fTtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBwYXJhbSA9IE9iamVjdC5hc3NpZ24oeyBzb3J0TmFtZSwgc29ydE9yZGVyIH0sIHRoaXMuX3NlYXJjaFN0YXRlKTtcclxuICAgICAgICAgICAgICAgIHRoaXMubG9va3VwQ21wLmh0dHBNZ3IuZ2V0RGF0YShwYXJhbSwgJ25hdicpLnN1YnNjcmliZShsb2FkVHJlZURhdGEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHR0LmNsZWFyU2VhcmNoVmFsdWUuc3Vic2NyaWJlKCAoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuX3NlYXJjaFN0YXRlID0gbnVsbDtcclxuICAgICAgICAgICAgdHQubG9hZERhdGEodGhpcy5hbGxEYXRhKTtcclxuICAgICAgICB9KTtcclxuXHJcblxyXG4gICAgICAgIHR0LmV4cGFuZC5zdWJzY3JpYmUoKHRuOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5vbk5vZGVFeHBhbmRlZCh0biwgdHQpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwcml2YXRlIG9uTm9kZUV4cGFuZGVkKHRuOiBhbnksIHR0KSB7XHJcbiAgICAgICAgaWYgKHRuLmxlYWYpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIXRuLmNoaWxkcmVuIHx8ICF0bi5jaGlsZHJlbi5sZW5ndGgpIHtcclxuICAgICAgICAgICAgY29uc3QgdHJlZUluZm8gPSB0aGlzLm5hdk9wdGlvbnMudHJlZUluZm87XHJcbiAgICAgICAgICAgIGlmICh0aGlzLm5hdk9wdGlvbnMudHJlZUluZm8ubG9hZERhdGFUeXBlID09PSAnYXN5bmMnKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgcGFyZW50UGF0aCA9ICcnO1xyXG4gICAgICAgICAgICAgICAgbGV0IHBhcmVudExheWVyID0gLTE7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB7IGZpZWxkID0gJyonLCB2YWx1ZSA9ICcnIH0gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLi4udHQuc2VhcmNoRGF0YVxyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICB0blsnc2hvd0xvYWRpbmcnXSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB0dC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgICAgICAgICBpZiAodHJlZUluZm8ubGF5ZXJUeXBlID09PSAncGFyZW50SWQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8g54i2SUTliqDovb3mlrnlvI9cclxuICAgICAgICAgICAgICAgICAgICBwYXJlbnRQYXRoID0gdG5bJ2lkJ107XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHRyZWVJbmZvRmllbGQgPSB0cmVlSW5mby5kYXRhRmllbGQ7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRyZWVJbmZvRmllbGQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50UGF0aCA9IHRuLmRhdGFbdHJlZUluZm9GaWVsZF1bdHJlZUluZm8ucGF0aEZpZWxkXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50TGF5ZXIgPSB0bi5kYXRhW3RyZWVJbmZvRmllbGRdW3RyZWVJbmZvLmxheWVyRmllbGRdO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCfmnKrmib7liLDliIbnuqfkv6Hmga/jgIInKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmxvb2t1cENtcC51cmkpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvb2t1cENtcC5leHBhbmRUcmVlTm9kZS5lbWl0KHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2U6IHR0LCBub2RlOiB0bixcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50SWRPclBhdGg6IHBhcmVudFBhdGgsIHBhcmVudExheWVyLCBzZWFyY2g6IHsgdmFsdWUsIGZpZWxkIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGhpcy5nZXRDaGlsZHJlbihcclxuICAgICAgICAgICAgICAgICAgICBwYXJlbnRQYXRoLCBwYXJlbnRMYXllciwge3NlYXJjaEZpZWxkOiBmaWVsZCA9PT0gJyonID8gJyonIDogZmllbGQsIHNlYXJjaFZhbHVlOiB2YWx1ZX0sIHR0XHJcbiAgICAgICAgICAgICAgICApLnN1YnNjcmliZShkYXRhID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRuICYmIGRhdGEuaXRlbXMgJiYgZGF0YS5pdGVtcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR0LmFwcGVuZENoaWxkcmVuKGRhdGEuaXRlbXMsIHRuKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0blsnc2hvd0xvYWRpbmcnXSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0dC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRDaGlsZHJlbiggcGFyZW50UGF0aCwgcGFyZW50TGF5ZXIsIHNlYXJjaERhdGE6IHsgc2VhcmNoRmllbGQ6IHN0cmluZzsgc2VhcmNoVmFsdWU6IHN0cmluZyB9LCB0dCApOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgICAgIGNvbnN0IHVyaSA9IHRoaXMubG9va3VwQ21wLmdyaWRPcHRpb25zLnVyaTtcclxuICAgICAgICBjb25zdCBzZWFyY2ggPSB7IHBhcmVudExheWVyLCBjYXRlZ29yeTogJ25hdicsIC4uLnNlYXJjaERhdGEgfTtcclxuICAgICAgICBpZiAodGhpcy5uYXZPcHRpb25zLnRyZWVJbmZvLmxheWVyVHlwZSA9PT0gJ3BhcmVudElkJykge1xyXG4gICAgICAgICAgICBzZWFyY2hbJ3BhcmVudElkJ10gPSBwYXJlbnRQYXRoO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHNlYXJjaFsncGFyZW50UGF0aCddID0gcGFyZW50UGF0aDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHBhcmFtID0ge1xyXG4gICAgICAgICAgICBzZWFyY2hWYWx1ZTogSlNPTi5zdHJpbmdpZnkoc2VhcmNoKSxcclxuICAgICAgICAgICAgY3VzdG9tRGF0YTogdGhpcy5sb29rdXBDbXAuY3VzdG9tRGF0YSxcclxuICAgICAgICAgICAgZW5hYmxlRnVsbFRyZWU6IGZhbHNlLFxyXG4gICAgICAgICAgICBsb2FkVHJlZURhdGFUeXBlOiAnbGF5ZXJsb2FkJ1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmxvb2t1cENtcC5oZWxwSWQpIHtcclxuICAgICAgICAgICAgcGFyYW1bJ2hlbHBJZCddID0gdGhpcy5sb29rdXBDbXAuaGVscElkO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHR0ICYmIHR0LnNvcnROYW1lKSB7XHJcbiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24ocGFyYW0sIHtcclxuICAgICAgICAgICAgICAgIHNvcnROYW1lOiB0dC5zb3J0TmFtZSxcclxuICAgICAgICAgICAgICAgIHNvcnRPcmRlcjogdHQuc29ydE9yZGVyXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMubG9va3VwQ21wLmh0dHAuZ2V0RGF0YSh1cmkgLCBwYXJhbSk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGxvYWREYXRhKCkge1xyXG4gICAgICAgIHRoaXMuY21wUmVmLmluc3RhbmNlLmFsbENvbHVtbnNUaXRsZSA9IHRoaXMubG9va3VwQ21wLmFsbENvbHVtbnNUaXRsZTtcclxuICAgICAgICBpZiAoIXRoaXMuaXNUcmVlTGlzdCgpKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGR0ID0gdGhpcy5jbXBSZWYuaW5zdGFuY2UgYXMgRGF0YVRhYmxlQ29tcG9uZW50O1xyXG4gICAgICAgICAgICB0aGlzLmluaXREYXRhVGFibGUoZHQpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHR0ID0gdGhpcy5jbXBSZWYuaW5zdGFuY2UgYXMgVHJlZVRhYmxlQ29tcG9uZW50O1xyXG4gICAgICAgICAgICB0aGlzLmluaXRUcmVlVGFibGUodHQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iXX0=