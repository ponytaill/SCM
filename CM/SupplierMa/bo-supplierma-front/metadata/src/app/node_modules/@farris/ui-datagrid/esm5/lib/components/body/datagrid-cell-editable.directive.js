/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*
 * @Author: 疯狂秀才(Lucas Huang)
 * @Date: 2019-08-06 07:43:07
 * @LastEditors: 疯狂秀才(Lucas Huang)
 * @LastEditTime: 2019-11-19 15:48:27
 * @QQ: 1055818239
 * @Version: v0.0.1
 */
import { Directive, Input, ElementRef, Renderer2, ContentChild, Injector, forwardRef, Inject, NgZone } from '@angular/core';
import { filter, debounceTime, takeUntil } from 'rxjs/operators';
import { DatagridService } from './../../services/datagrid.service';
import { DatagridCellComponent } from './datagrid-cell.component';
import { DatagridBodyComponent } from './datagrid-body.component';
import { DatagridRowDirective } from './datagrid-row.directive';
import { DatagridFacadeService } from '../../services/datagrid-facade.service';
import { DatagridComponent } from '../../datagrid.component';
import { CELL_SELECTED_CLS, CELL_EDITING_CLS, ALLOW_EDIT_CELL_HIGHLIGHT_CLS } from '../../types/constant';
import { of, noop, Subject } from 'rxjs';
import { Utils } from '../../utils/utils';
var DatagridCellEditableDirective = /** @class */ (function () {
    function DatagridCellEditableDirective(injector, el, render, dg, ngZone) {
        var _this = this;
        this.injector = injector;
        this.el = el;
        this.render = render;
        this.dg = dg;
        this.ngZone = ngZone;
        // private _readonly$ = null;
        this.cellEditorCreatedSubscription = null;
        this.cellEditorDestorySubscription = null;
        this.destroy$ = new Subject();
        this.dgb = this.injector.get(DatagridBodyComponent);
        this.dr = this.injector.get(DatagridRowDirective);
        this.dfs = this.injector.get(DatagridFacadeService);
        this.dgs = this.injector.get(DatagridService);
        if (!this.cellEditorCreatedSubscription) {
            this.cellEditorCreatedSubscription = this.dgs.cellEditorCreated.pipe(takeUntil(this.destroy$)).pipe(filter((/**
             * @param {?} __0
             * @return {?}
             */
            function (_a) {
                var column = _a.column, editorRef = _a.editorRef, cellEditorRef = _a.cellEditorRef, templateRef = _a.templateRef;
                return column.field === _this.column.field && _this.dg.selectedRow.id === _this.dr.rowId;
            }))).subscribe((/**
             * @param {?} __0
             * @return {?}
             */
            function (_a) {
                var editorRef = _a.editorRef, cellEditorRef = _a.cellEditorRef, templateRef = _a.templateRef;
                if (editorRef) {
                    _this['editor'] = editorRef.instance;
                    _this['formControl'] = (/** @type {?} */ (_this.editor.formControl));
                    _this.cellEditorRef = cellEditorRef;
                    _this.emitBeginEdit();
                }
                else {
                    _this['formControl'] = (/** @type {?} */ (_this.dr.form.get(_this.column.field)));
                    _this.bindEditorInputEvent();
                    _this.dg.beginEdit.emit({ editor: null, column: _this.column, rowData: _this.rowData, gridInstance: _this.dg, template: templateRef });
                }
            }));
        }
        this.dg.dgs.cellEditorDestory.pipe(takeUntil(this.destroy$)).pipe(filter((/**
         * @param {?} __0
         * @return {?}
         */
        function (_a) {
            var column = _a.column;
            return _this.dg.selectedRow && column.field === _this.column.field && _this.dg.selectedRow.id === _this.dr.rowId;
        }))).subscribe((/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            if (_this.dg.editMode === 'cell') {
                _this.dg.selectedRow.editors = [];
                if (_this.dg.currentCell) {
                    _this.dg.currentCell.editor = null;
                    _this.dg.currentCell.cellEditorRef = null;
                }
            }
            _this.unBindEditorInputEvent();
            _this.cellEditorRef = null;
            _this.formControl = null;
            _this.editor = null;
        }));
    }
    /**
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        if (changes.rowData && !changes.rowData.isFirstChange()) {
            this.setCellClsWithEditorType();
        }
    };
    /**
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        this.initCellEvent();
        this.setCellClsWithEditorType();
    };
    /**
     * @private
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.initCellEvent = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        // this.cellclick = this.render.listen(this.el.nativeElement, 'click', (e) => this.onClickCell(e));
        if (this.column && (this.column.editor || this.column.editorTemplate)) {
            if (!this.dg.clickToEdit) {
                this.celldblclick = this.render.listen(this.el.nativeElement, 'dblclick', (/**
                 * @param {?} e
                 * @return {?}
                 */
                function (e) {
                    _this.onDblClickCell(e);
                }));
            }
            this.el.nativeElement.edit = (/**
             * @param {?} e
             * @return {?}
             */
            function (e) { return _this.onClickCell(e); });
            this.el.nativeElement.editCell = (/**
             * @param {?} e
             * @return {?}
             */
            function (e) {
                _this.openCellEditor();
            });
        }
        else {
            this.clickTimer = 0;
        }
        this.el.nativeElement.gridCellData = { rowData: this.rowData, rowIndex: this.dr.rowIndex };
        this.el.nativeElement.closeEdit = (/**
         * @return {?}
         */
        function () { return _this.closeEditingCell(); });
        this.el.nativeElement.selectCell = (/**
         * @param {?} e
         * @param {?} el
         * @return {?}
         */
        function (e, el) {
            if (_this.dg.disableRow && _this.dg.disableRow(_this.rowData, _this.dr.rowIndex)) {
                return;
            }
            if (_this.dg.currentCell && _this.dg.currentCell.cellElement.id === el.id && !_this.dg.keepSelect) {
                _this.dg.cancelSelectCell();
            }
            else {
                _this.selectCell(_this.column.field, el);
                _this.dg.cellClick.emit({ column: _this.column, rowData: _this.rowData, gridInstance: _this.dg, event: e });
            }
        });
        this.el.nativeElement.cancelSelected = (/**
         * @return {?}
         */
        function () {
            // DomHandler.removeClass(this.el.nativeElement, CELL_SELECTED_CLS);
            // DomHandler.removeClass(this.el.nativeElement, CELL_EDITING_CLS);
            _this.render.removeClass(_this.el.nativeElement, CELL_SELECTED_CLS);
            _this.render.removeClass(_this.el.nativeElement, CELL_EDITING_CLS);
        });
    };
    /**
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.destroy$.next();
        this.destroy$.complete();
        if (this.cellclick) {
            this.cellclick();
        }
        if (this.celldblclick) {
            this.celldblclick();
        }
        this.unBindEditorInputEvent();
        if (this.bindCellEventSubscription) {
            this.bindCellEventSubscription.unsubscribe();
            this.bindCellEventSubscription = null;
        }
        if (this.cellEditorCreatedSubscription) {
            this.cellEditorCreatedSubscription.unsubscribe();
            this.cellEditorCreatedSubscription = null;
        }
        if (this.cellEditorDestorySubscription) {
            this.cellEditorDestorySubscription.unsubscribe();
            this.cellEditorDestorySubscription = null;
        }
        this.editor = null;
        this.cellEditorRef = null;
        this.formControl = null;
        if (this.el) {
            this.el.nativeElement.cancelSelected = noop;
            this.el.nativeElement.selectCell = noop;
            this.el.nativeElement.closeEdit = noop;
            this.el.nativeElement.gridCellData = noop;
            this.el.nativeElement.edit = noop;
            this.el.nativeElement.selectCell = noop;
            this.el = null;
        }
    };
    /**
     * @private
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.isDifferentCell = /**
     * @private
     * @return {?}
     */
    function () {
        if (!this.dg.currentCell) {
            return true;
        }
        else {
            if (!this.dg.selectedRow || this.dg.selectedRow.index !== this.dr.rowIndex) {
                return true;
            }
            else {
                if (this.dr.rowIndex !== this.dg.currentCell.rowIndex) {
                    return true;
                }
                else {
                    return this.dg.currentCell.field !== this.column.field;
                }
            }
        }
    };
    /**
     * @private
     * @param {?} event
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.onClickCell = /**
     * @private
     * @param {?} event
     * @return {?}
     */
    function (event) {
        var _this = this;
        // 关闭其他Grid 的编辑器
        document.body.click();
        this.dg.beforeClickCell.emit({ rowIndex: this.dr.rowIndex, rowData: this.rowData, column: this.column, gridInstance: this.dg });
        if (this.dr.disabled) {
            return;
        }
        // 20210422
        // if (this.dg.closeOtherGridEditor) {
        //     document.body.click();
        // }
        if (this.dg.disabled) {
            return;
        }
        else {
            if (!this.dg.editable || this.isReadonly()) {
                if (this.dg.enableHighlightCell) {
                    event.stopPropagation();
                    this.dg.endEditing();
                    this.selectCell(this.column.field);
                }
                return;
            }
            else {
                if (this.dg.editMode === 'row') {
                    return;
                }
            }
        }
        if (this.dg.selectionMode === 'default' && event) {
            if (event.ctrlKey || event.shiftKey) {
                return;
            }
        }
        event.stopPropagation();
        if (event.target['nodeName'] === 'INPUT') {
            return;
        }
        if (this.dg.clickToEdit && !this.dg.dblclickRow.observers.length) {
            this.dg.clickDelay = 0;
        }
        this.render.addClass(this.dg.el.nativeElement, 'f-datagrid-unselect');
        if (!this.dg.isSingleClick && this.dg.editMode) {
            this.dg.isSingleClick = true;
            this.clickTimer = setTimeout((/**
             * @return {?}
             */
            function () {
                if (_this.dg.isSingleClick && _this.dg.editable && _this.dg.editMode === 'cell') {
                    _this.dg.isSingleClick = false;
                    clearTimeout(_this.clickTimer);
                    // if (!this.closeEditingCell()) {
                    //     return;
                    // }
                    _this.closeEditingCell().pipe(takeUntil(_this.destroy$)).subscribe((/**
                     * @param {?} f
                     * @return {?}
                     */
                    function (f) {
                        if (f) {
                            if (_this.dg.clickToEdit) {
                                _this.openCellEditor();
                            }
                            else {
                                _this.selectCell(_this.column.field);
                            }
                            _this.render.removeClass(_this.dg.el.nativeElement, 'f-datagrid-unselect');
                            event.preventDefault();
                        }
                    }));
                }
            }), this.dg.clickDelay);
        }
    };
    /**
     * @private
     * @param {?} event
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.onDblClickCell = /**
     * @private
     * @param {?} event
     * @return {?}
     */
    function (event) {
        var _this = this;
        if (this.dg.disabled || this.isReadonly()) {
            return;
        }
        if (event.target['nodeName'] === 'INPUT' || event.target['nodeName'] === 'TEXTAREA') {
            return;
        }
        if (this.dg.editable && this.dg.editMode === 'cell') {
            // if (!this.closeEditingCell()) {
            //     return;
            // }
            this.closeEditingCell().pipe(takeUntil(this.destroy$)).subscribe((/**
             * @param {?} f
             * @return {?}
             */
            function (f) {
                if (f) {
                    setTimeout((/**
                     * @return {?}
                     */
                    function () {
                        _this.openCellEditor();
                    }));
                }
            }));
        }
        if (this.clickTimer) {
            this.dg.isSingleClick = false;
            clearTimeout(this.clickTimer);
            this.clickTimer = null;
        }
    };
    /**
     * @param {?=} col
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.isReadonly = /**
     * @param {?=} col
     * @return {?}
     */
    function (col) {
        if (col === void 0) { col = this.column; }
        if (this.dg.editable) {
            // 参与合并的单元格不允许编辑
            if (this.dg.mergeCell && this.dg.mergeFields.indexOf(col.field) > -1) {
                return true;
            }
            return this.getReadonlyValue(col);
        }
        else {
            return true;
        }
    };
    /**
     * @private
     * @param {?=} col
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.getReadonlyValue = /**
     * @private
     * @param {?=} col
     * @return {?}
     */
    function (col) {
        if (col === void 0) { col = this.column; }
        if (col.readonly !== undefined) {
            if (typeof col.readonly === 'boolean') {
                return col.readonly;
            }
            else if (typeof col.readonly === 'function') {
                return col.readonly(this.rowData);
            }
        }
        return false;
    };
    /**
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.openCellEditor = /**
     * @return {?}
     */
    function () {
        var _this = this;
        // 当前行禁用，不允许编辑。
        if (this.dr.disabled) {
            return;
        }
        if ((!this.column.editor && !this.column.editorTemplate) || !this.dg.editable || this.isReadonly()) {
            if (this.dg.selectionMode === 'default' && this.dg.multiSelect) {
                this.dg.clearCheckeds();
            }
            this.selectCell(this.column.field);
            return;
        }
        /** @type {?} */
        var beforeEditEvent = this.dg.beforeEdit({ rowIndex: this.dr.rowIndex, rowData: this.rowData, column: this.column, gridInstance: this.dg });
        if (!beforeEditEvent || !beforeEditEvent.subscribe) {
            this.dg.writeConsole('please return an Observable Type.');
            return;
        }
        if (this.dg.currentCell) {
            if (!this.dg.currentCell.cellRef || this.dg.currentCell.cellRef.column.field !== this.column.field) {
                this.dg.currentCell.cellRef = this.dc;
            }
        }
        beforeEditEvent.pipe(takeUntil(this.destroy$)).subscribe((/**
         * @param {?} flag
         * @return {?}
         */
        function (flag) {
            if (flag) {
                if (_this.isDifferentCell()) {
                    if (_this.dg.selectionMode === 'default' && _this.dg.multiSelect) {
                        _this.dg.clearCheckeds();
                    }
                    _this.selectCell(_this.column.field);
                }
                _this.dfs.editCell();
                // this.emitBeginEdit();
            }
            else {
                _this.selectCell(_this.column.field);
            }
        }));
    };
    /**
     * @private
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.emitBeginEdit = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var _cellEditorRef = this.cellEditorRef || this.dc.cellEditor;
        this.render.removeClass(this.dg.el.nativeElement, 'f-datagrid-unselect');
        if (this.dg.editMode === 'cell') {
            this.dg.selectedRow.editors = [this.editor];
            this.dg.currentCell.editor = this.editor;
            this.dg.currentCell.cellEditorRef = _cellEditorRef;
            this.bindEditorInputEvent();
            this.render.addClass(this.el.nativeElement, CELL_EDITING_CLS);
            // this.formControl.setValue(this.dc.value);
            this.dg.beginEdit.emit({ editor: _cellEditorRef, column: this.column, rowData: this.rowData, gridInstance: this.dg });
            if (this.column.editor.type === 'textarea' && this.column.editor.options && this.column.editor.options.editType === 'dialog') {
                this.editor.showDialog();
            }
        }
        if (this.dr && !this.dg.nowrap) {
            this.dr.updateRowHeight();
        }
    };
    /**
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.closeEditingCell = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (!this.dg.isCellEditing()) {
            return of(true);
        }
        /** @type {?} */
        var currentCell = null;
        /** @type {?} */
        var editor = null;
        if (this.dg.currentCell) {
            // this.dg.currentCell.isEditing = false;
            // this.dfs.getCurrentCell().isEditing = false;
            currentCell = (/** @type {?} */ (this.dg.currentCell.cellRef));
            if (currentCell) {
                if (!currentCell.isEditing) {
                    return of(true);
                }
                if (currentCell.cellEditor && currentCell.cellEditor.componentRef && !currentCell.column.editorTemplate) {
                    editor = currentCell.cellEditor.componentRef.instance;
                    if (editor) {
                        // 执行blur 事件
                        if (editor.inputElement) {
                            /** @type {?} */
                            var domName = editor.inputElement.nodeName;
                            /** @type {?} */
                            var blurFn = editor.options && editor.options.onBlur;
                            if (blurFn) {
                                if ((domName === 'INPUT' || domName === 'TEXTAREA') && this.dg['focusElement'] === editor.inputElement) {
                                    blurFn({ editorRef: editor, rowData: currentCell.rowData });
                                }
                            }
                            if (editor.inputElement.blur) {
                                editor.inputElement.blur();
                            }
                            this.dg['focusElement'] = null;
                        }
                        if (editor.blur) {
                            editor.blur();
                        }
                        if (editor.pending) {
                            return of(false);
                        }
                        if (editor.formControl) {
                            if (editor.formControl.pending) {
                                return of(false);
                            }
                            if (editor.formControl && editor.formControl.invalid && !this.dg.endEditByInvalid) {
                                return of(false);
                            }
                        }
                        else {
                            return of(true);
                        }
                    }
                    else {
                        return of(true);
                    }
                }
            }
        }
        else {
            return of(true);
        }
        this.dg.isSingleClick = false;
        /** @type {?} */
        var _col_ = (editor || currentCell).column;
        /** @type {?} */
        var afterEditEvent = this.dg.afterEdit(currentCell.rowIndex, currentCell.rowData, _col_, editor);
        if (!afterEditEvent || !afterEditEvent.subscribe) {
            this.dg.writeConsole('please return an Observable Type.');
            return;
        }
        /** @type {?} */
        var cellEndEdit = of(undefined);
        afterEditEvent.pipe(takeUntil(this.destroy$)).subscribe((/**
         * @param {?} flag
         * @return {?}
         */
        function (flag) {
            if (flag) {
                /** @type {?} */
                var val = currentCell.value;
                if (currentCell && currentCell.formControl && val !== currentCell.formControl.value) {
                    val = currentCell.formControl.value;
                    currentCell.isEditing = false;
                    currentCell.updateValue(val);
                }
                _this.dfs.endEditCell();
                _this.dgs.onEndCellEdit(_this.dfs.getCurrentCell());
                _this.unBindEditorInputEvent();
                // 移除编辑样式
                _this.render.removeClass(_this.el.nativeElement, CELL_EDITING_CLS);
                if (_this.dg.selectedRow) {
                    _this.dg.selectedRow.editors = [];
                }
                // this.dg.selectedRow.data = this.rowData;
                // 更新行样式或者单元格样式
                _this.dfs.rowUpdate$.next({ index: currentCell.rowIndex, data: currentCell.rowData, cellRef: currentCell });
                _this.dg.endEdit.emit({ rowIndex: currentCell.rowIndex, rowData: currentCell.rowData, column: _col_, value: val });
                // 更新footerData
                _this.dgs.refreshFooterData.emit();
                cellEndEdit = of(true);
                // 刷新行数据
                // this.dr.refresh();
                if (_this.dg.selectedRow && _this.dg.selectedRow.dr) {
                    _this.dg.selectedRow.dr.refresh();
                }
            }
            else {
                if (currentCell && currentCell.cellEditor) {
                    editor = currentCell.cellEditor.componentRef.instance;
                    editor.inputElement.focus();
                    cellEndEdit = of(false);
                }
                else {
                    cellEndEdit = of(true);
                }
            }
        }));
        return cellEndEdit;
    };
    /**
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.cancelCellEditing = /**
     * @return {?}
     */
    function () {
        if (this.dg.currentCell && this.dg.currentCell.isEditing && this.dg.selectedRow.index > -1) {
            // this.dfs.resetRow(this.dg.selectedRow.id);
            this.dc.rowData = this.dg.selectedRow.data;
            this.formControl.reset(Utils.getValue(this.column.field, this.dc.rowData));
            this.closeEditingCell();
        }
    };
    /**
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.bindEditorInputEvent = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var ceRef = this.cellEditorRef || this.dc.cellEditor;
        /** @type {?} */
        var input = null;
        if (ceRef) {
            input = ceRef.componentRef.instance.inputElement;
        }
        else {
            if (this.column.editorTemplate) {
                input = this.dc.el.nativeElement.querySelector('input,textarea');
            }
        }
        if (input) {
            input.focus();
            if (this.dg.selectOnEditing && this.column.editorTemplate) {
                setTimeout((/**
                 * @return {?}
                 */
                function () {
                    if (input.select) {
                        input.select();
                    }
                }));
            }
            this.editorInputKeydownEvent = this.render.listen(input, 'keydown', (/**
             * @param {?} e
             * @return {?}
             */
            function (e) {
                _this.onKeyDownForInput(e);
            }));
        }
    };
    /**
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.unBindEditorInputEvent = /**
     * @return {?}
     */
    function () {
        if (this.editorInputKeydownEvent) {
            this.editorInputKeydownEvent();
            this.editorInputKeydownEvent = null;
        }
    };
    /**
     * @param {?} e
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.onKeyDownForInput = /**
     * @param {?} e
     * @return {?}
     */
    function (e) {
        var _this = this;
        /** @type {?} */
        var keyCode = e.keyCode;
        if (e.altKey || e.ctrlKey) {
            return;
        }
        if ((this.editor && this.editor.stopPropagation) || keyCode === 13 || this.column.editorTemplate) {
            e.stopPropagation();
        }
        switch (keyCode) {
            case 32: // SPACE
                if (this.column.editor.type === 'switch') {
                    e.preventDefault();
                    this.editor.instance.updateChecked(e, false);
                }
                break;
            case 13: // Enter
                this.closeEditingCell().pipe(takeUntil(this.destroy$)).pipe(debounceTime(100)).subscribe((/**
                 * @param {?} f
                 * @return {?}
                 */
                function (f) {
                    if (f) {
                        _this.dg.dgContainer.nativeElement.focus();
                        /** @type {?} */
                        var enterParam = { gird: _this.dg, cell: _this.dg.currentCell, event: e };
                        if (_this.column.onEnterHandler) {
                            _this.column.onEnterHandler(enterParam);
                        }
                        else {
                            /** @type {?} */
                            var nextTd = _this.dg.currentCell.cellElement.nextElementSibling;
                            if (_this.dg.currentCell.lastRow && !nextTd) {
                                _this.dg.lastCellEnterHandle.emit(enterParam);
                            }
                        }
                    }
                }));
                break;
            case 27: // ESC
                this.cancelCellEditing();
                break;
            case 9: // Tab
                e.stopPropagation();
                this.dg.clickDelay = 0;
                if (e.shiftKey) {
                    this.closeEditingCell().pipe(takeUntil(this.destroy$)).subscribe((/**
                     * @param {?} f
                     * @return {?}
                     */
                    function (f) {
                        if (f) {
                            _this.movePrevCellAndEdit();
                        }
                    }));
                }
                else {
                    this.closeEditingCell().pipe(takeUntil(this.destroy$)).subscribe((/**
                     * @param {?} f
                     * @return {?}
                     */
                    function (f) {
                        if (f) {
                            _this.moveNextCellAndEdit(e);
                        }
                    }));
                    e.preventDefault();
                }
                break;
            case 40: // ↓
                /** 选中下一行，且当前列进入编辑态; 仅普通文本输入框支持 */
                if (this.column.editor.type === 'textbox') {
                    this.closeEditingCell().pipe(takeUntil(this.destroy$)).subscribe((/**
                     * @param {?} f
                     * @return {?}
                     */
                    function (f) {
                        if (f) {
                            _this.selectNextRowAndEditCell(_this.column.field, 'down');
                        }
                    }));
                    e.preventDefault();
                }
                break;
            case 38: // ↑
                /** 选中上一行，且当前列进入编辑态; 仅普通文本输入框支持 */
                if (this.column.editor.type === 'textbox') {
                    this.closeEditingCell().pipe(takeUntil(this.destroy$)).subscribe((/**
                     * @param {?} f
                     * @return {?}
                     */
                    function (f) {
                        if (f) {
                            _this.selectNextRowAndEditCell(_this.column.field, 'up');
                        }
                    }));
                    e.preventDefault();
                }
                break;
        }
    };
    /**
     * @private
     * @param {?} field
     * @param {?=} tdElement
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.selectCell = /**
     * @private
     * @param {?} field
     * @param {?=} tdElement
     * @return {?}
     */
    function (field, tdElement) {
        var _this = this;
        this.closeEditingCell().subscribe((/**
         * @param {?} t
         * @return {?}
         */
        function (t) {
            if (!t) {
                return;
            }
            tdElement = tdElement || _this.el.nativeElement;
            _this.clearCellSelectedClass();
            if (field !== _this.dg.ControlPanelFeild) {
                _this.render.addClass(tdElement, CELL_SELECTED_CLS);
            }
            // this.dr.drHover.setRowHoverCls(false);
            _this.dfs.setCurrentCell(_this.dr, field, tdElement, _this.dc);
            if (!_this.dg.fast) {
                _this.moveScrollbar(tdElement);
            }
        }));
    };
    /**
     * @private
     * @param {?} td
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.moveScrollbar = /**
     * @private
     * @param {?} td
     * @return {?}
     */
    function (td) {
        /** @type {?} */
        var tdPosLeft = td.offsetLeft + td.offsetWidth;
        /** @type {?} */
        var containerWidth = this.dg.width - this.dgb.columnsGroup.leftFixedWidth;
        /** @type {?} */
        var tdRect = td.getBoundingClientRect();
        /** @type {?} */
        var scrollContainer = this.dgb.ps.elementRef.nativeElement;
        /** @type {?} */
        var psContainer = scrollContainer.getBoundingClientRect();
        /** @type {?} */
        var scrollTop = scrollContainer.scrollTop;
        /** @type {?} */
        var scrollLeft = scrollContainer.scrollLeft;
        /** @type {?} */
        var scrollbarXLeft = this.dgb.ps.elementRef.nativeElement.scrollLeft;
        if (tdPosLeft > containerWidth) {
            /** @type {?} */
            var x = tdPosLeft - containerWidth + 2;
            if (x > scrollbarXLeft) {
                this.dgb.ps.scrollToX(x);
            }
        }
        else {
            if (tdRect.x < psContainer.x) {
                /** @type {?} */
                var x = scrollLeft - tdRect.x;
                this.dgb.ps.scrollToX(x);
            }
        }
        /** @type {?} */
        var tdPosTop = tdRect.top - psContainer.top + tdRect.height;
        if (tdPosTop > psContainer.height) {
            /** @type {?} */
            var y = tdPosTop - psContainer.height;
            this.dgb.ps.scrollToY(scrollTop + y);
        }
        else {
            if (tdRect.y < psContainer.y) {
                this.dgb.ps.scrollToY(scrollTop - (psContainer.y - tdRect.y));
            }
        }
    };
    /**
     * @private
     * @param {?=} event
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.moveNextCellAndEdit = /**
     * @private
     * @param {?=} event
     * @return {?}
     */
    function (event) {
        // if (!this.closeEditingCell()) {
        //     return;
        // }
        /** @type {?} */
        var fieldIndex = this.dfs.getColumnIndex(this.column.field);
        if (fieldIndex + 1 < this.dgb.columnsGroup.normalColumns.length) {
            /** @type {?} */
            var nextColumn = this.dgb.columnsGroup.normalColumns[fieldIndex + 1];
            /** @type {?} */
            var nextTd = this.dg.currentCell.cellElement.nextElementSibling;
            if (nextColumn && ((!nextColumn.editor && !nextColumn.editorTemplate) || this.isReadonly(nextColumn))) {
                if (nextTd) {
                    nextTd.selectCell(event, nextTd);
                }
                return;
            }
            if (nextTd) {
                nextTd.focus();
                if (nextColumn.editor || nextColumn.editorTemplate) {
                    nextTd.editCell();
                    this.dgs.onCellEdit(nextTd);
                }
            }
        }
        else {
            // next row's first cell to editing
            /** @type {?} */
            var nextTr = this.dg.currentCell.cellElement.parentElement.nextElementSibling;
            if (nextTr && nextTr.tagName === 'TR') {
                // nextTr.children.find(td => td.editCell).editCell();
                /** @type {?} */
                var firstEditor = false;
                /** @type {?} */
                var i = 0;
                while (!firstEditor) {
                    firstEditor = !!nextTr.children[i].editCell;
                    if (!firstEditor) {
                        i++;
                    }
                }
                if (this.dg.selectionMode === 'default') {
                    this.dg.clearCheckeds();
                }
                nextTr.children[i].editCell();
            }
        }
    };
    /**
     * @private
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.movePrevCellAndEdit = /**
     * @private
     * @return {?}
     */
    function () {
        // if (!this.closeEditingCell()) {
        //     return;
        // }
        /** @type {?} */
        var fieldIndex = this.dfs.getColumnIndex(this.column.field);
        if (fieldIndex - 1 >= 0) {
            /** @type {?} */
            var nextColumn = this.dgb.columnsGroup.normalColumns[fieldIndex - 1];
            if (nextColumn && this.isReadonly(nextColumn)) {
                return;
            }
            /** @type {?} */
            var nextTd = this.dg.currentCell.cellElement.previousElementSibling;
            if (nextTd) {
                // this.selectCell(nextColumn.field, nextTd);
                nextTd.focus();
                if (nextColumn.editor) {
                    // this.dfs.editCell();
                    nextTd.click();
                    this.dgs.onCellEdit(nextTd);
                }
            }
        }
    };
    /**
     * @private
     * @param {?} cellFieldName
     * @param {?} dir
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.selectNextRowAndEditCell = /**
     * @private
     * @param {?} cellFieldName
     * @param {?} dir
     * @return {?}
     */
    function (cellFieldName, dir) {
        /** @type {?} */
        var p = dir === 'down' ? 'nextElementSibling' : 'previousElementSibling';
        /** @type {?} */
        var nextTr = this.dg.currentCell.cellElement.parentElement[p];
        if (nextTr && nextTr.tagName === 'TR') {
            /** @type {?} */
            var td = Array.from(nextTr.children).find((/**
             * @param {?} td
             * @return {?}
             */
            function (td) { return td.getAttribute('field') == cellFieldName; }));
            if (td && td.editCell) {
                if (this.dg.selectionMode === 'default') {
                    this.dg.clearCheckeds();
                }
                td.editCell();
            }
        }
    };
    /**
     * @private
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.clearCellSelectedClass = /**
     * @private
     * @return {?}
     */
    function () {
        // if (this.dg.currentCell) {
        //     DomHandler.removeClass(this.dg.currentCell.cellElement, CELL_SELECTED_CLS);
        //     this.render.removeClass(this.dg.currentCell.cellElement, CELL_EDITING_CLS);
        //     const selectedCell = this.dg.el.nativeElement.querySelectorAll('.' + CELL_SELECTED_CLS);
        //     if (selectedCell.length) {
        //         selectedCell.forEach(n => {
        //             this.render.removeClass(n, CELL_SELECTED_CLS);
        //         });
        //     }
        // }
        this.dg.removeCellSelectedCls();
    };
    /**
     * @private
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.setCellClsWithEditorType = /**
     * @private
     * @return {?}
     */
    function () {
        // 设置当前选中单元格样式
        if (this.dg.currentCell && this.dg.enableHighlightCell) {
            if (this.dg.currentCell.field === this.column.field && this.dg.currentCell.rowId === this.rowData[this.dg.idField] && !this.dc.isEditing) {
                this.clearCellSelectedClass();
                this.render.addClass(this.el.nativeElement, CELL_SELECTED_CLS);
            }
        }
        if (!this.dg.enableEditCellStyle) {
            return;
        }
        /** @type {?} */
        var td = this.el.nativeElement;
        this.cleanOtherEditorIcon(td);
        // 当前行禁用，不允许编辑。
        if (this.dr.disabled) {
            return;
        }
        if (!this.column.editor) {
            return;
        }
        if (this.isReadonly()) {
            return;
        }
        /** @type {?} */
        var editorType = this.column.editor.type;
        /** @type {?} */
        var cls = this.column.align === 'right' ? 'allow-edit-cell-left' : 'allow-edit-cell';
        this.render.addClass(td, cls);
        this.render.addClass(td, ALLOW_EDIT_CELL_HIGHLIGHT_CLS[editorType]);
    };
    /**
     * @private
     * @param {?} td
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.cleanOtherEditorIcon = /**
     * @private
     * @param {?} td
     * @return {?}
     */
    function (td) {
        /** @type {?} */
        var values = Object.values(ALLOW_EDIT_CELL_HIGHLIGHT_CLS);
        values.forEach((/**
         * @param {?} v
         * @return {?}
         */
        function (v) {
            if (td.className.indexOf(v) > -1) {
                td.className = td.className.replace('allow-edit-cell-left', '').replace('allow-edit-cell', '');
                td.className = td.className.replace(v, '');
            }
        }));
    };
    DatagridCellEditableDirective.decorators = [
        { type: Directive, args: [{
                    selector: '[cell-editable]',
                    exportAs: 'cellEditable'
                },] }
    ];
    /** @nocollapse */
    DatagridCellEditableDirective.ctorParameters = function () { return [
        { type: Injector },
        { type: ElementRef },
        { type: Renderer2 },
        { type: DatagridComponent, decorators: [{ type: Inject, args: [forwardRef((/**
                         * @return {?}
                         */
                        function () { return DatagridComponent; })),] }] },
        { type: NgZone }
    ]; };
    DatagridCellEditableDirective.propDecorators = {
        rowData: [{ type: Input, args: ['cell-editable',] }],
        column: [{ type: Input }],
        dc: [{ type: ContentChild, args: [DatagridCellComponent,] }]
    };
    return DatagridCellEditableDirective;
}());
export { DatagridCellEditableDirective };
if (false) {
    /** @type {?} */
    DatagridCellEditableDirective.prototype.rowData;
    /** @type {?} */
    DatagridCellEditableDirective.prototype.column;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.clickTimer;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.cellclick;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.celldblclick;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.bindCellEventSubscription;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.editorInputKeydownEvent;
    /** @type {?} */
    DatagridCellEditableDirective.prototype.editor;
    /** @type {?} */
    DatagridCellEditableDirective.prototype.formControl;
    /** @type {?} */
    DatagridCellEditableDirective.prototype.cellEditorRef;
    /** @type {?} */
    DatagridCellEditableDirective.prototype.dc;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.dgb;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.dr;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.dfs;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.dgs;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.cellEditorCreatedSubscription;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.cellEditorDestorySubscription;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.destroy$;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.injector;
    /** @type {?} */
    DatagridCellEditableDirective.prototype.el;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.render;
    /** @type {?} */
    DatagridCellEditableDirective.prototype.dg;
    /** @type {?} */
    DatagridCellEditableDirective.prototype.ngZone;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YWdyaWQtY2VsbC1lZGl0YWJsZS5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWRhdGFncmlkLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvYm9keS9kYXRhZ3JpZC1jZWxsLWVkaXRhYmxlLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFRQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFVLFlBQVksRUFBYSxRQUFRLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBaUIsTUFBTSxFQUE0QixNQUFNLGVBQWUsQ0FBQztBQUV4TCxPQUFPLEVBQUUsTUFBTSxFQUE0QixZQUFZLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDM0YsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG1DQUFtQyxDQUFDO0FBQ3BFLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ2xFLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ2xFLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBRWhFLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLHdDQUF3QyxDQUFDO0FBQy9FLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQzdELE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxnQkFBZ0IsRUFBRSw2QkFBNkIsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBRTFHLE9BQU8sRUFBRSxFQUFFLEVBQWlCLElBQUksRUFBRSxPQUFPLEVBQUcsTUFBTSxNQUFNLENBQUM7QUFDekQsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBRTFDO0lBNENJLHVDQUNZLFFBQWtCLEVBQVMsRUFBYyxFQUFVLE1BQWlCLEVBQ3hCLEVBQXFCLEVBQVMsTUFBYztR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QUUsY0FBYztpQkFDM0I7Ozs7Z0JBbEJrRixRQUFRO2dCQUFoRSxVQUFVO2dCQUFFLFNBQVM7Z0JBU3ZDLGlCQUFpQix1QkFvRGpCLE1BQU0sU0FBQyxVQUFVOzs7d0JBQUMsY0FBTSxPQUFBLGlCQUFpQixFQUFqQixDQUFpQixFQUFDO2dCQTdENkUsTUFBTTs7OzBCQW9CakksS0FBSyxTQUFDLGVBQWU7eUJBQ3JCLEtBQUs7cUJBNEJMLFlBQVksU0FBQyxxQkFBcUI7O0lBeXlCdkMsb0NBQUM7Q0FBQSxBQTMwQkQsSUEyMEJDO1NBdjBCWSw2QkFBNkI7OztJQUN0QyxnREFBcUM7O0lBQ3JDLCtDQUE0Qjs7Ozs7SUFFNUIsbURBQXdCOzs7OztJQUV4QixrREFBdUI7Ozs7O0lBQ3ZCLHFEQUEwQjs7Ozs7SUFDMUIsa0VBQWdEOzs7OztJQUVoRCxnRUFBcUM7O0lBQ3JDLCtDQUFZOztJQUNaLG9EQUF5Qjs7SUFDekIsc0RBQW1COztJQWlCbkIsMkNBQStEOzs7OztJQUMvRCw0Q0FBbUM7Ozs7O0lBQ25DLDJDQUFpQzs7Ozs7SUFDakMsNENBQW1DOzs7OztJQUNuQyw0Q0FBNkI7Ozs7O0lBRzdCLHNFQUE2Qzs7Ozs7SUFDN0Msc0VBQTZDOzs7OztJQUM3QyxpREFBaUM7Ozs7O0lBRTdCLGlEQUEwQjs7SUFBRSwyQ0FBcUI7Ozs7O0lBQUUsK0NBQXlCOztJQUM1RSwyQ0FBeUU7O0lBQUUsK0NBQXFCIiwic291cmNlc0NvbnRlbnQiOlsiLypcclxuICogQEF1dGhvcjog55av54uC56eA5omNKEx1Y2FzIEh1YW5nKVxyXG4gKiBARGF0ZTogMjAxOS0wOC0wNiAwNzo0MzowN1xyXG4gKiBATGFzdEVkaXRvcnM6IOeWr+eLguengOaJjShMdWNhcyBIdWFuZylcclxuICogQExhc3RFZGl0VGltZTogMjAxOS0xMS0xOSAxNTo0ODoyN1xyXG4gKiBAUVE6IDEwNTU4MTgyMzlcclxuICogQFZlcnNpb246IHYwLjAuMVxyXG4gKi9cclxuaW1wb3J0IHsgRGlyZWN0aXZlLCBJbnB1dCwgRWxlbWVudFJlZiwgUmVuZGVyZXIyLCBPbkluaXQsIENvbnRlbnRDaGlsZCwgT25EZXN0cm95LCBJbmplY3RvciwgZm9yd2FyZFJlZiwgSW5qZWN0LCBBZnRlclZpZXdJbml0LCBOZ1pvbmUsIE9uQ2hhbmdlcywgU2ltcGxlQ2hhbmdlcyB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBGb3JtQ29udHJvbCB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcclxuaW1wb3J0IHsgZmlsdGVyLCBtYXAsIHN3aXRjaE1hcCwgdGFrZUxhc3QsIGRlYm91bmNlVGltZSwgdGFrZVVudGlsIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZFNlcnZpY2UgfSBmcm9tICcuLy4uLy4uL3NlcnZpY2VzL2RhdGFncmlkLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZENlbGxDb21wb25lbnQgfSBmcm9tICcuL2RhdGFncmlkLWNlbGwuY29tcG9uZW50JztcclxuaW1wb3J0IHsgRGF0YWdyaWRCb2R5Q29tcG9uZW50IH0gZnJvbSAnLi9kYXRhZ3JpZC1ib2R5LmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IERhdGFncmlkUm93RGlyZWN0aXZlIH0gZnJvbSAnLi9kYXRhZ3JpZC1yb3cuZGlyZWN0aXZlJztcclxuaW1wb3J0IHsgRGF0YUNvbHVtbiB9IGZyb20gJy4vLi4vLi4vdHlwZXMvZGF0YS1jb2x1bW4nO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZEZhY2FkZVNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9kYXRhZ3JpZC1mYWNhZGUuc2VydmljZSc7XHJcbmltcG9ydCB7IERhdGFncmlkQ29tcG9uZW50IH0gZnJvbSAnLi4vLi4vZGF0YWdyaWQuY29tcG9uZW50JztcclxuaW1wb3J0IHsgQ0VMTF9TRUxFQ1RFRF9DTFMsIENFTExfRURJVElOR19DTFMsIEFMTE9XX0VESVRfQ0VMTF9ISUdITElHSFRfQ0xTIH0gZnJvbSAnLi4vLi4vdHlwZXMvY29uc3RhbnQnO1xyXG5pbXBvcnQgeyBEb21IYW5kbGVyIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvZG9taGFuZGxlcic7XHJcbmltcG9ydCB7IG9mLCBTdWJzY3JpcHRpb24sICBub29wLCBTdWJqZWN0ICB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBVdGlscyB9IGZyb20gJy4uLy4uL3V0aWxzL3V0aWxzJztcclxuXHJcbkBEaXJlY3RpdmUoe1xyXG4gICAgc2VsZWN0b3I6ICdbY2VsbC1lZGl0YWJsZV0nLFxyXG4gICAgZXhwb3J0QXM6ICdjZWxsRWRpdGFibGUnXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBEYXRhZ3JpZENlbGxFZGl0YWJsZURpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95LCBPbkNoYW5nZXMsIEFmdGVyVmlld0luaXQge1xyXG4gICAgQElucHV0KCdjZWxsLWVkaXRhYmxlJykgcm93RGF0YTogYW55O1xyXG4gICAgQElucHV0KCkgY29sdW1uOiBEYXRhQ29sdW1uO1xyXG5cclxuICAgIHByaXZhdGUgY2xpY2tUaW1lcjogYW55O1xyXG5cclxuICAgIHByaXZhdGUgY2VsbGNsaWNrOiBhbnk7XHJcbiAgICBwcml2YXRlIGNlbGxkYmxjbGljazogYW55O1xyXG4gICAgcHJpdmF0ZSBiaW5kQ2VsbEV2ZW50U3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XHJcblxyXG4gICAgcHJpdmF0ZSBlZGl0b3JJbnB1dEtleWRvd25FdmVudDogYW55O1xyXG4gICAgZWRpdG9yOiBhbnk7XHJcbiAgICBmb3JtQ29udHJvbDogRm9ybUNvbnRyb2w7XHJcbiAgICBjZWxsRWRpdG9yUmVmOiBhbnk7XHJcbiAgICAvLyBnZXQgZWRpdG9yKCkge1xyXG4gICAgLy8gICAgIGlmICh0aGlzLmRjLmNlbGxFZGl0b3IpIHtcclxuICAgIC8vICAgICAgICAgY29uc3QgX2VkaXRvciA9IHRoaXMuZGMuY2VsbEVkaXRvci5jb21wb25lbnRSZWYuaW5zdGFuY2U7XHJcbiAgICAvLyAgICAgICAgIHRoaXMuZGcucGVuZGluZyA9IF9lZGl0b3IucGVuZGluZztcclxuICAgIC8vICAgICAgICAgcmV0dXJuIF9lZGl0b3I7XHJcbiAgICAvLyAgICAgfVxyXG4gICAgLy8gICAgIHJldHVybiBudWxsO1xyXG4gICAgLy8gfVxyXG5cclxuICAgIC8vIGdldCBmb3JtQ29udHJvbCgpIHtcclxuICAgIC8vICAgICBpZiAodGhpcy5lZGl0b3IpIHtcclxuICAgIC8vICAgICAgICAgcmV0dXJuIHRoaXMuZWRpdG9yLmZvcm1Db250cm9sIGFzIEZvcm1Db250cm9sO1xyXG4gICAgLy8gICAgIH1cclxuICAgIC8vICAgICByZXR1cm4gbnVsbDtcclxuICAgIC8vIH1cclxuXHJcbiAgICBAQ29udGVudENoaWxkKERhdGFncmlkQ2VsbENvbXBvbmVudCkgZGM6IERhdGFncmlkQ2VsbENvbXBvbmVudDtcclxuICAgIHByaXZhdGUgZGdiOiBEYXRhZ3JpZEJvZHlDb21wb25lbnQ7XHJcbiAgICBwcml2YXRlIGRyOiBEYXRhZ3JpZFJvd0RpcmVjdGl2ZTtcclxuICAgIHByaXZhdGUgZGZzOiBEYXRhZ3JpZEZhY2FkZVNlcnZpY2U7XHJcbiAgICBwcml2YXRlIGRnczogRGF0YWdyaWRTZXJ2aWNlO1xyXG5cclxuICAgIC8vIHByaXZhdGUgX3JlYWRvbmx5JCA9IG51bGw7XHJcbiAgICBwcml2YXRlIGNlbGxFZGl0b3JDcmVhdGVkU3Vic2NyaXB0aW9uID0gbnVsbDtcclxuICAgIHByaXZhdGUgY2VsbEVkaXRvckRlc3RvcnlTdWJzY3JpcHRpb24gPSBudWxsO1xyXG4gICAgcHJpdmF0ZSBkZXN0cm95JCA9IG5ldyBTdWJqZWN0KCk7XHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwcml2YXRlIGluamVjdG9yOiBJbmplY3RvciwgcHVibGljIGVsOiBFbGVtZW50UmVmLCBwcml2YXRlIHJlbmRlcjogUmVuZGVyZXIyLFxyXG4gICAgICAgIEBJbmplY3QoZm9yd2FyZFJlZigoKSA9PiBEYXRhZ3JpZENvbXBvbmVudCkpIHB1YmxpYyBkZzogRGF0YWdyaWRDb21wb25lbnQsIHB1YmxpYyBuZ1pvbmU6IE5nWm9uZSkge1xyXG4gICAgICAgIHRoaXMuZGdiID0gdGhpcy5pbmplY3Rvci5nZXQoRGF0YWdyaWRCb2R5Q29tcG9uZW50KTtcclxuICAgICAgICB0aGlzLmRyID0gdGhpcy5pbmplY3Rvci5nZXQoRGF0YWdyaWRSb3dEaXJlY3RpdmUpO1xyXG4gICAgICAgIHRoaXMuZGZzID0gdGhpcy5pbmplY3Rvci5nZXQoRGF0YWdyaWRGYWNhZGVTZXJ2aWNlKTtcclxuICAgICAgICB0aGlzLmRncyA9IHRoaXMuaW5qZWN0b3IuZ2V0KERhdGFncmlkU2VydmljZSk7XHJcblxyXG5cclxuICAgICAgICBpZiAoIXRoaXMuY2VsbEVkaXRvckNyZWF0ZWRTdWJzY3JpcHRpb24pIHtcclxuICAgICAgICAgICAgdGhpcy5jZWxsRWRpdG9yQ3JlYXRlZFN1YnNjcmlwdGlvbiA9IHRoaXMuZGdzLmNlbGxFZGl0b3JDcmVhdGVkLnBpcGUoXHJcbiAgICAgICAgICAgICAgICB0YWtlVW50aWwodGhpcy5kZXN0cm95JClcclxuICAgICAgICAgICAgKS5waXBlKFxyXG4gICAgICAgICAgICAgICAgZmlsdGVyKCh7IGNvbHVtbiwgZWRpdG9yUmVmLCBjZWxsRWRpdG9yUmVmLCB0ZW1wbGF0ZVJlZiB9KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbHVtbi5maWVsZCA9PT0gdGhpcy5jb2x1bW4uZmllbGQgJiYgdGhpcy5kZy5zZWxlY3RlZFJvdy5pZCA9PT0gdGhpcy5kci5yb3dJZDtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICkuc3Vic2NyaWJlKCh7IGVkaXRvclJlZiwgY2VsbEVkaXRvclJlZiwgdGVtcGxhdGVSZWYgfSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKGVkaXRvclJlZikge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXNbJ2VkaXRvciddID0gZWRpdG9yUmVmLmluc3RhbmNlO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXNbJ2Zvcm1Db250cm9sJ10gPSB0aGlzLmVkaXRvci5mb3JtQ29udHJvbCBhcyBGb3JtQ29udHJvbDtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNlbGxFZGl0b3JSZWYgPSBjZWxsRWRpdG9yUmVmO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZW1pdEJlZ2luRWRpdCgpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzWydmb3JtQ29udHJvbCddID0gdGhpcy5kci5mb3JtLmdldCh0aGlzLmNvbHVtbi5maWVsZCkgYXMgRm9ybUNvbnRyb2w7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5iaW5kRWRpdG9ySW5wdXRFdmVudCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGcuYmVnaW5FZGl0LmVtaXQoeyBlZGl0b3I6IG51bGwsIGNvbHVtbjogdGhpcy5jb2x1bW4sIHJvd0RhdGE6IHRoaXMucm93RGF0YSwgZ3JpZEluc3RhbmNlOiB0aGlzLmRnLCB0ZW1wbGF0ZTogdGVtcGxhdGVSZWYgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICB0aGlzLmRnLmRncy5jZWxsRWRpdG9yRGVzdG9yeS5waXBlKFxyXG4gICAgICAgICAgICB0YWtlVW50aWwodGhpcy5kZXN0cm95JClcclxuICAgICAgICApLnBpcGUoXHJcbiAgICAgICAgICAgIGZpbHRlcigoeyBjb2x1bW4gfSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGcuc2VsZWN0ZWRSb3cgJiYgY29sdW1uLmZpZWxkID09PSB0aGlzLmNvbHVtbi5maWVsZCAmJiB0aGlzLmRnLnNlbGVjdGVkUm93LmlkID09PSB0aGlzLmRyLnJvd0lkO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICkuc3Vic2NyaWJlKChlOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZGcuZWRpdE1vZGUgPT09ICdjZWxsJykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kZy5zZWxlY3RlZFJvdy5lZGl0b3JzID0gW107XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kZy5jdXJyZW50Q2VsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGcuY3VycmVudENlbGwuZWRpdG9yID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRnLmN1cnJlbnRDZWxsLmNlbGxFZGl0b3JSZWYgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMudW5CaW5kRWRpdG9ySW5wdXRFdmVudCgpO1xyXG4gICAgICAgICAgICB0aGlzLmNlbGxFZGl0b3JSZWYgPSBudWxsO1xyXG4gICAgICAgICAgICB0aGlzLmZvcm1Db250cm9sID0gbnVsbDtcclxuICAgICAgICAgICAgdGhpcy5lZGl0b3IgPSBudWxsO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBuZ09uSW5pdCgpIHtcclxuICAgIH1cclxuXHJcbiAgICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XHJcbiAgICAgICAgaWYgKGNoYW5nZXMucm93RGF0YSAmJiAhY2hhbmdlcy5yb3dEYXRhLmlzRmlyc3RDaGFuZ2UoKSkge1xyXG4gICAgICAgICAgICB0aGlzLnNldENlbGxDbHNXaXRoRWRpdG9yVHlwZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBuZ0FmdGVyVmlld0luaXQoKSB7XHJcbiAgICAgICAgdGhpcy5pbml0Q2VsbEV2ZW50KCk7XHJcbiAgICAgICAgdGhpcy5zZXRDZWxsQ2xzV2l0aEVkaXRvclR5cGUoKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGluaXRDZWxsRXZlbnQoKSB7XHJcbiAgICAgICAgLy8gdGhpcy5jZWxsY2xpY2sgPSB0aGlzLnJlbmRlci5saXN0ZW4odGhpcy5lbC5uYXRpdmVFbGVtZW50LCAnY2xpY2snLCAoZSkgPT4gdGhpcy5vbkNsaWNrQ2VsbChlKSk7XHJcbiAgICAgICAgaWYgKHRoaXMuY29sdW1uICYmICh0aGlzLmNvbHVtbi5lZGl0b3IgfHwgdGhpcy5jb2x1bW4uZWRpdG9yVGVtcGxhdGUpKSB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5kZy5jbGlja1RvRWRpdCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jZWxsZGJsY2xpY2sgPSB0aGlzLnJlbmRlci5saXN0ZW4odGhpcy5lbC5uYXRpdmVFbGVtZW50LCAnZGJsY2xpY2snLCAoZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMub25EYmxDbGlja0NlbGwoZSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuZWRpdCA9IChlKSA9PiB0aGlzLm9uQ2xpY2tDZWxsKGUpO1xyXG4gICAgICAgICAgICB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuZWRpdENlbGwgPSAoZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5vcGVuQ2VsbEVkaXRvcigpO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2xpY2tUaW1lciA9IDA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZWwubmF0aXZlRWxlbWVudC5ncmlkQ2VsbERhdGEgPSB7IHJvd0RhdGE6IHRoaXMucm93RGF0YSwgcm93SW5kZXg6IHRoaXMuZHIucm93SW5kZXggfTtcclxuICAgICAgICB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuY2xvc2VFZGl0ID0gKCkgPT4gdGhpcy5jbG9zZUVkaXRpbmdDZWxsKCk7XHJcbiAgICAgICAgdGhpcy5lbC5uYXRpdmVFbGVtZW50LnNlbGVjdENlbGwgPSAoZSwgZWwpID0+IHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZGcuZGlzYWJsZVJvdyAmJiB0aGlzLmRnLmRpc2FibGVSb3codGhpcy5yb3dEYXRhLCB0aGlzLmRyLnJvd0luZGV4KSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5kZy5jdXJyZW50Q2VsbCAmJiB0aGlzLmRnLmN1cnJlbnRDZWxsLmNlbGxFbGVtZW50LmlkID09PSBlbC5pZCAmJiAhdGhpcy5kZy5rZWVwU2VsZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRnLmNhbmNlbFNlbGVjdENlbGwoKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0Q2VsbCh0aGlzLmNvbHVtbi5maWVsZCwgZWwpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kZy5jZWxsQ2xpY2suZW1pdCh7IGNvbHVtbjogdGhpcy5jb2x1bW4sIHJvd0RhdGE6IHRoaXMucm93RGF0YSwgZ3JpZEluc3RhbmNlOiB0aGlzLmRnLCBldmVudDogZSB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdGhpcy5lbC5uYXRpdmVFbGVtZW50LmNhbmNlbFNlbGVjdGVkID0gKCkgPT4ge1xyXG4gICAgICAgICAgICAvLyBEb21IYW5kbGVyLnJlbW92ZUNsYXNzKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgQ0VMTF9TRUxFQ1RFRF9DTFMpO1xyXG4gICAgICAgICAgICAvLyBEb21IYW5kbGVyLnJlbW92ZUNsYXNzKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgQ0VMTF9FRElUSU5HX0NMUyk7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyLnJlbW92ZUNsYXNzKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgQ0VMTF9TRUxFQ1RFRF9DTFMpO1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlci5yZW1vdmVDbGFzcyh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsIENFTExfRURJVElOR19DTFMpO1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkRlc3Ryb3koKSB7XHJcbiAgICAgICAgdGhpcy5kZXN0cm95JC5uZXh0KCk7XHJcbiAgICAgICAgdGhpcy5kZXN0cm95JC5jb21wbGV0ZSgpO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5jZWxsY2xpY2spIHtcclxuICAgICAgICAgICAgdGhpcy5jZWxsY2xpY2soKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmNlbGxkYmxjbGljaykge1xyXG4gICAgICAgICAgICB0aGlzLmNlbGxkYmxjbGljaygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy51bkJpbmRFZGl0b3JJbnB1dEV2ZW50KCk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmJpbmRDZWxsRXZlbnRTdWJzY3JpcHRpb24pIHtcclxuICAgICAgICAgICAgdGhpcy5iaW5kQ2VsbEV2ZW50U3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuYmluZENlbGxFdmVudFN1YnNjcmlwdGlvbiA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5jZWxsRWRpdG9yQ3JlYXRlZFN1YnNjcmlwdGlvbikge1xyXG4gICAgICAgICAgICB0aGlzLmNlbGxFZGl0b3JDcmVhdGVkU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuY2VsbEVkaXRvckNyZWF0ZWRTdWJzY3JpcHRpb24gPSBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuY2VsbEVkaXRvckRlc3RvcnlTdWJzY3JpcHRpb24pIHtcclxuICAgICAgICAgICAgdGhpcy5jZWxsRWRpdG9yRGVzdG9yeVN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICB0aGlzLmNlbGxFZGl0b3JEZXN0b3J5U3Vic2NyaXB0aW9uID0gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuZWRpdG9yID0gbnVsbDtcclxuICAgICAgICB0aGlzLmNlbGxFZGl0b3JSZWYgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuZm9ybUNvbnRyb2wgPSBudWxsO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5lbCkge1xyXG4gICAgICAgICAgICB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuY2FuY2VsU2VsZWN0ZWQgPSBub29wO1xyXG4gICAgICAgICAgICB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuc2VsZWN0Q2VsbCA9IG5vb3A7XHJcbiAgICAgICAgICAgIHRoaXMuZWwubmF0aXZlRWxlbWVudC5jbG9zZUVkaXQgPSBub29wO1xyXG4gICAgICAgICAgICB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuZ3JpZENlbGxEYXRhID0gbm9vcDtcclxuICAgICAgICAgICAgdGhpcy5lbC5uYXRpdmVFbGVtZW50LmVkaXQgPSBub29wO1xyXG4gICAgICAgICAgICB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuc2VsZWN0Q2VsbCA9IG5vb3A7XHJcbiAgICAgICAgICAgIHRoaXMuZWwgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGlzRGlmZmVyZW50Q2VsbCgpIHtcclxuICAgICAgICBpZiAoIXRoaXMuZGcuY3VycmVudENlbGwpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLmRnLnNlbGVjdGVkUm93IHx8IHRoaXMuZGcuc2VsZWN0ZWRSb3cuaW5kZXggIT09IHRoaXMuZHIucm93SW5kZXgpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZHIucm93SW5kZXggIT09IHRoaXMuZGcuY3VycmVudENlbGwucm93SW5kZXgpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGcuY3VycmVudENlbGwuZmllbGQgIT09IHRoaXMuY29sdW1uLmZpZWxkO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgb25DbGlja0NlbGwoZXZlbnQ6IGFueSkge1xyXG4gICAgICAgIC8vIOWFs+mXreWFtuS7lkdyaWQg55qE57yW6L6R5ZmoXHJcbiAgICAgICAgZG9jdW1lbnQuYm9keS5jbGljaygpO1xyXG5cclxuICAgICAgICB0aGlzLmRnLmJlZm9yZUNsaWNrQ2VsbC5lbWl0KHsgcm93SW5kZXg6IHRoaXMuZHIucm93SW5kZXgsIHJvd0RhdGE6IHRoaXMucm93RGF0YSwgY29sdW1uOiB0aGlzLmNvbHVtbiwgZ3JpZEluc3RhbmNlOiB0aGlzLmRnIH0pO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5kci5kaXNhYmxlZCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyAyMDIxMDQyMlxyXG4gICAgICAgIC8vIGlmICh0aGlzLmRnLmNsb3NlT3RoZXJHcmlkRWRpdG9yKSB7XHJcbiAgICAgICAgLy8gICAgIGRvY3VtZW50LmJvZHkuY2xpY2soKTtcclxuICAgICAgICAvLyB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmRnLmRpc2FibGVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuZGcuZWRpdGFibGUgfHwgdGhpcy5pc1JlYWRvbmx5KCkpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRnLmVuYWJsZUhpZ2hsaWdodENlbGwpIHtcclxuICAgICAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRnLmVuZEVkaXRpbmcoKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdENlbGwodGhpcy5jb2x1bW4uZmllbGQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZGcuZWRpdE1vZGUgPT09ICdyb3cnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5kZy5zZWxlY3Rpb25Nb2RlID09PSAnZGVmYXVsdCcgJiYgZXZlbnQpIHtcclxuICAgICAgICAgICAgaWYgKGV2ZW50LmN0cmxLZXkgfHwgZXZlbnQuc2hpZnRLZXkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgIGlmIChldmVudC50YXJnZXRbJ25vZGVOYW1lJ10gPT09ICdJTlBVVCcpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGlmICh0aGlzLmRnLmNsaWNrVG9FZGl0ICYmICF0aGlzLmRnLmRibGNsaWNrUm93Lm9ic2VydmVycy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgdGhpcy5kZy5jbGlja0RlbGF5ID0gMDtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICB0aGlzLnJlbmRlci5hZGRDbGFzcyh0aGlzLmRnLmVsLm5hdGl2ZUVsZW1lbnQsICdmLWRhdGFncmlkLXVuc2VsZWN0Jyk7XHJcblxyXG4gICAgICAgIGlmICghdGhpcy5kZy5pc1NpbmdsZUNsaWNrICYmIHRoaXMuZGcuZWRpdE1vZGUpIHtcclxuICAgICAgICAgICAgdGhpcy5kZy5pc1NpbmdsZUNsaWNrID0gdHJ1ZTtcclxuICAgICAgICAgICAgdGhpcy5jbGlja1RpbWVyID0gc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kZy5pc1NpbmdsZUNsaWNrICYmIHRoaXMuZGcuZWRpdGFibGUgJiYgdGhpcy5kZy5lZGl0TW9kZSA9PT0gJ2NlbGwnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZy5pc1NpbmdsZUNsaWNrID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuY2xpY2tUaW1lcik7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgKCF0aGlzLmNsb3NlRWRpdGluZ0NlbGwoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gfVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VFZGl0aW5nQ2VsbCgpLnBpcGUodGFrZVVudGlsKHRoaXMuZGVzdHJveSQpKS5zdWJzY3JpYmUoKGY6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZGcuY2xpY2tUb0VkaXQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9wZW5DZWxsRWRpdG9yKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0Q2VsbCh0aGlzLmNvbHVtbi5maWVsZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5yZW1vdmVDbGFzcyh0aGlzLmRnLmVsLm5hdGl2ZUVsZW1lbnQsICdmLWRhdGFncmlkLXVuc2VsZWN0Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIHRoaXMuZGcuY2xpY2tEZWxheSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgb25EYmxDbGlja0NlbGwoZXZlbnQ6IE1vdXNlRXZlbnQpIHtcclxuICAgICAgICBpZiAodGhpcy5kZy5kaXNhYmxlZCB8fCB0aGlzLmlzUmVhZG9ubHkoKSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoZXZlbnQudGFyZ2V0Wydub2RlTmFtZSddID09PSAnSU5QVVQnIHx8IGV2ZW50LnRhcmdldFsnbm9kZU5hbWUnXSA9PT0gJ1RFWFRBUkVBJykge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmRnLmVkaXRhYmxlICYmIHRoaXMuZGcuZWRpdE1vZGUgPT09ICdjZWxsJykge1xyXG4gICAgICAgICAgICAvLyBpZiAoIXRoaXMuY2xvc2VFZGl0aW5nQ2VsbCgpKSB7XHJcbiAgICAgICAgICAgIC8vICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIC8vIH1cclxuICAgICAgICAgICAgdGhpcy5jbG9zZUVkaXRpbmdDZWxsKCkucGlwZSh0YWtlVW50aWwodGhpcy5kZXN0cm95JCkpLnN1YnNjcmliZShmID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChmKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub3BlbkNlbGxFZGl0b3IoKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmNsaWNrVGltZXIpIHtcclxuICAgICAgICAgICAgdGhpcy5kZy5pc1NpbmdsZUNsaWNrID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLmNsaWNrVGltZXIpO1xyXG4gICAgICAgICAgICB0aGlzLmNsaWNrVGltZXIgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBpc1JlYWRvbmx5KGNvbCA9IHRoaXMuY29sdW1uKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZGcuZWRpdGFibGUpIHtcclxuICAgICAgICAgICAgLy8g5Y+C5LiO5ZCI5bm255qE5Y2V5YWD5qC85LiN5YWB6K6457yW6L6RXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmRnLm1lcmdlQ2VsbCAmJiB0aGlzLmRnLm1lcmdlRmllbGRzLmluZGV4T2YoY29sLmZpZWxkKSA+IC0xKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRSZWFkb25seVZhbHVlKGNvbCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0UmVhZG9ubHlWYWx1ZShjb2wgPSB0aGlzLmNvbHVtbikge1xyXG4gICAgICAgIGlmIChjb2wucmVhZG9ubHkgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIGNvbC5yZWFkb25seSA9PT0gJ2Jvb2xlYW4nKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY29sLnJlYWRvbmx5O1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBjb2wucmVhZG9ubHkgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBjb2wucmVhZG9ubHkodGhpcy5yb3dEYXRhKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgb3BlbkNlbGxFZGl0b3IoKSB7XHJcbiAgICAgICAgLy8g5b2T5YmN6KGM56aB55So77yM5LiN5YWB6K6457yW6L6R44CCXHJcbiAgICAgICAgaWYgKHRoaXMuZHIuZGlzYWJsZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCghdGhpcy5jb2x1bW4uZWRpdG9yICYmICF0aGlzLmNvbHVtbi5lZGl0b3JUZW1wbGF0ZSkgfHwgIXRoaXMuZGcuZWRpdGFibGUgfHwgdGhpcy5pc1JlYWRvbmx5KCkpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZGcuc2VsZWN0aW9uTW9kZSA9PT0gJ2RlZmF1bHQnICYmIHRoaXMuZGcubXVsdGlTZWxlY3QpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGcuY2xlYXJDaGVja2VkcygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0Q2VsbCh0aGlzLmNvbHVtbi5maWVsZCk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGJlZm9yZUVkaXRFdmVudCA9IHRoaXMuZGcuYmVmb3JlRWRpdCh7IHJvd0luZGV4OiB0aGlzLmRyLnJvd0luZGV4LCByb3dEYXRhOiB0aGlzLnJvd0RhdGEsIGNvbHVtbjogdGhpcy5jb2x1bW4sIGdyaWRJbnN0YW5jZTogdGhpcy5kZyB9KTtcclxuICAgICAgICBpZiAoIWJlZm9yZUVkaXRFdmVudCB8fCAhYmVmb3JlRWRpdEV2ZW50LnN1YnNjcmliZSkge1xyXG4gICAgICAgICAgICB0aGlzLmRnLndyaXRlQ29uc29sZSgncGxlYXNlIHJldHVybiBhbiBPYnNlcnZhYmxlIFR5cGUuJyk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmRnLmN1cnJlbnRDZWxsKSB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5kZy5jdXJyZW50Q2VsbC5jZWxsUmVmIHx8IHRoaXMuZGcuY3VycmVudENlbGwuY2VsbFJlZi5jb2x1bW4uZmllbGQgIT09IHRoaXMuY29sdW1uLmZpZWxkKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRnLmN1cnJlbnRDZWxsLmNlbGxSZWYgPSB0aGlzLmRjO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgYmVmb3JlRWRpdEV2ZW50LnBpcGUodGFrZVVudGlsKHRoaXMuZGVzdHJveSQpKS5zdWJzY3JpYmUoKGZsYWcpID0+IHtcclxuICAgICAgICAgICAgaWYgKGZsYWcpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzRGlmZmVyZW50Q2VsbCgpKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmRnLnNlbGVjdGlvbk1vZGUgPT09ICdkZWZhdWx0JyAmJiB0aGlzLmRnLm11bHRpU2VsZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGcuY2xlYXJDaGVja2VkcygpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RDZWxsKHRoaXMuY29sdW1uLmZpZWxkKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLmRmcy5lZGl0Q2VsbCgpO1xyXG4gICAgICAgICAgICAgICAgLy8gdGhpcy5lbWl0QmVnaW5FZGl0KCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdENlbGwodGhpcy5jb2x1bW4uZmllbGQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBlbWl0QmVnaW5FZGl0KCkge1xyXG5cclxuICAgICAgICBjb25zdCBfY2VsbEVkaXRvclJlZiA9IHRoaXMuY2VsbEVkaXRvclJlZiB8fCB0aGlzLmRjLmNlbGxFZGl0b3I7XHJcblxyXG4gICAgICAgIHRoaXMucmVuZGVyLnJlbW92ZUNsYXNzKHRoaXMuZGcuZWwubmF0aXZlRWxlbWVudCwgJ2YtZGF0YWdyaWQtdW5zZWxlY3QnKTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZGcuZWRpdE1vZGUgPT09ICdjZWxsJykge1xyXG4gICAgICAgICAgICB0aGlzLmRnLnNlbGVjdGVkUm93LmVkaXRvcnMgPSBbdGhpcy5lZGl0b3JdO1xyXG4gICAgICAgICAgICB0aGlzLmRnLmN1cnJlbnRDZWxsLmVkaXRvciA9IHRoaXMuZWRpdG9yO1xyXG4gICAgICAgICAgICB0aGlzLmRnLmN1cnJlbnRDZWxsLmNlbGxFZGl0b3JSZWYgPSBfY2VsbEVkaXRvclJlZjtcclxuICAgICAgICAgICAgdGhpcy5iaW5kRWRpdG9ySW5wdXRFdmVudCgpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5yZW5kZXIuYWRkQ2xhc3ModGhpcy5lbC5uYXRpdmVFbGVtZW50LCBDRUxMX0VESVRJTkdfQ0xTKTtcclxuXHJcbiAgICAgICAgICAgIC8vIHRoaXMuZm9ybUNvbnRyb2wuc2V0VmFsdWUodGhpcy5kYy52YWx1ZSk7XHJcbiAgICAgICAgICAgIHRoaXMuZGcuYmVnaW5FZGl0LmVtaXQoeyBlZGl0b3I6IF9jZWxsRWRpdG9yUmVmLCBjb2x1bW46IHRoaXMuY29sdW1uLCByb3dEYXRhOiB0aGlzLnJvd0RhdGEsIGdyaWRJbnN0YW5jZTogdGhpcy5kZyB9KTtcclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbHVtbi5lZGl0b3IudHlwZSA9PT0gJ3RleHRhcmVhJyAmJiB0aGlzLmNvbHVtbi5lZGl0b3Iub3B0aW9ucyAmJiB0aGlzLmNvbHVtbi5lZGl0b3Iub3B0aW9ucy5lZGl0VHlwZSA9PT0gJ2RpYWxvZycpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZWRpdG9yLnNob3dEaWFsb2coKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZHIgJiYgIXRoaXMuZGcubm93cmFwKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZHIudXBkYXRlUm93SGVpZ2h0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNsb3NlRWRpdGluZ0NlbGwoKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmRnLmlzQ2VsbEVkaXRpbmcoKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gb2YodHJ1ZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgY3VycmVudENlbGwgPSBudWxsO1xyXG4gICAgICAgIGxldCBlZGl0b3I6IGFueSA9IG51bGw7XHJcbiAgICAgICAgaWYgKHRoaXMuZGcuY3VycmVudENlbGwpIHtcclxuICAgICAgICAgICAgLy8gdGhpcy5kZy5jdXJyZW50Q2VsbC5pc0VkaXRpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgLy8gdGhpcy5kZnMuZ2V0Q3VycmVudENlbGwoKS5pc0VkaXRpbmcgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgIGN1cnJlbnRDZWxsID0gdGhpcy5kZy5jdXJyZW50Q2VsbC5jZWxsUmVmIGFzIERhdGFncmlkQ2VsbENvbXBvbmVudDtcclxuICAgICAgICAgICAgaWYgKGN1cnJlbnRDZWxsKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIWN1cnJlbnRDZWxsLmlzRWRpdGluZykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvZih0cnVlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoY3VycmVudENlbGwuY2VsbEVkaXRvciAmJiBjdXJyZW50Q2VsbC5jZWxsRWRpdG9yLmNvbXBvbmVudFJlZiAmJiAhY3VycmVudENlbGwuY29sdW1uLmVkaXRvclRlbXBsYXRlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZWRpdG9yID0gY3VycmVudENlbGwuY2VsbEVkaXRvci5jb21wb25lbnRSZWYuaW5zdGFuY2U7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChlZGl0b3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8g5omn6KGMYmx1ciDkuovku7ZcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVkaXRvci5pbnB1dEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRvbU5hbWUgPSBlZGl0b3IuaW5wdXRFbGVtZW50Lm5vZGVOYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYmx1ckZuID0gIGVkaXRvci5vcHRpb25zICYmIGVkaXRvci5vcHRpb25zLm9uQmx1cjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChibHVyRm4pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKGRvbU5hbWUgPT09ICdJTlBVVCcgfHwgZG9tTmFtZSA9PT0gJ1RFWFRBUkVBJykgJiYgIHRoaXMuZGdbJ2ZvY3VzRWxlbWVudCddID09PSBlZGl0b3IuaW5wdXRFbGVtZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsdXJGbih7IGVkaXRvclJlZjogZWRpdG9yLCByb3dEYXRhOiBjdXJyZW50Q2VsbC5yb3dEYXRhfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVkaXRvci5pbnB1dEVsZW1lbnQuYmx1cikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRvci5pbnB1dEVsZW1lbnQuYmx1cigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGdbJ2ZvY3VzRWxlbWVudCddID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVkaXRvci5ibHVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZGl0b3IuYmx1cigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWRpdG9yLnBlbmRpbmcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvZihmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlZGl0b3IuZm9ybUNvbnRyb2wpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlZGl0b3IuZm9ybUNvbnRyb2wucGVuZGluZykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvZihmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVkaXRvci5mb3JtQ29udHJvbCAmJiBlZGl0b3IuZm9ybUNvbnRyb2wuaW52YWxpZCAmJiAhdGhpcy5kZy5lbmRFZGl0QnlJbnZhbGlkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9mKGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvZih0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvZih0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gb2YodHJ1ZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmRnLmlzU2luZ2xlQ2xpY2sgPSBmYWxzZTtcclxuICAgICAgICBjb25zdCBfY29sXyA9IChlZGl0b3IgfHwgY3VycmVudENlbGwpLmNvbHVtbjtcclxuICAgICAgICBjb25zdCBhZnRlckVkaXRFdmVudCA9IHRoaXMuZGcuYWZ0ZXJFZGl0KGN1cnJlbnRDZWxsLnJvd0luZGV4LCBjdXJyZW50Q2VsbC5yb3dEYXRhLCBfY29sXywgZWRpdG9yKTtcclxuICAgICAgICBpZiAoIWFmdGVyRWRpdEV2ZW50IHx8ICFhZnRlckVkaXRFdmVudC5zdWJzY3JpYmUpIHtcclxuICAgICAgICAgICAgdGhpcy5kZy53cml0ZUNvbnNvbGUoJ3BsZWFzZSByZXR1cm4gYW4gT2JzZXJ2YWJsZSBUeXBlLicpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgY2VsbEVuZEVkaXQgPSBvZih1bmRlZmluZWQpO1xyXG5cclxuICAgICAgICBhZnRlckVkaXRFdmVudC5waXBlKHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKSkuc3Vic2NyaWJlKChmbGFnOiBib29sZWFuKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChmbGFnKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgdmFsID0gY3VycmVudENlbGwudmFsdWU7XHJcbiAgICAgICAgICAgICAgICBpZiAoY3VycmVudENlbGwgJiYgY3VycmVudENlbGwuZm9ybUNvbnRyb2wgJiYgdmFsICE9PSBjdXJyZW50Q2VsbC5mb3JtQ29udHJvbC52YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhbCA9IGN1cnJlbnRDZWxsLmZvcm1Db250cm9sLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRDZWxsLmlzRWRpdGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRDZWxsLnVwZGF0ZVZhbHVlKHZhbCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRmcy5lbmRFZGl0Q2VsbCgpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kZ3Mub25FbmRDZWxsRWRpdCh0aGlzLmRmcy5nZXRDdXJyZW50Q2VsbCgpKTtcclxuICAgICAgICAgICAgICAgIHRoaXMudW5CaW5kRWRpdG9ySW5wdXRFdmVudCgpO1xyXG4gICAgICAgICAgICAgICAgLy8g56e76Zmk57yW6L6R5qC35byPXHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5yZW1vdmVDbGFzcyh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsIENFTExfRURJVElOR19DTFMpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRnLnNlbGVjdGVkUm93KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZy5zZWxlY3RlZFJvdy5lZGl0b3JzID0gW107XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyB0aGlzLmRnLnNlbGVjdGVkUm93LmRhdGEgPSB0aGlzLnJvd0RhdGE7XHJcbiAgICAgICAgICAgICAgICAvLyDmm7TmlrDooYzmoLflvI/miJbogIXljZXlhYPmoLzmoLflvI9cclxuICAgICAgICAgICAgICAgIHRoaXMuZGZzLnJvd1VwZGF0ZSQubmV4dCh7IGluZGV4OiBjdXJyZW50Q2VsbC5yb3dJbmRleCwgZGF0YTogY3VycmVudENlbGwucm93RGF0YSwgY2VsbFJlZjogY3VycmVudENlbGwgfSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRnLmVuZEVkaXQuZW1pdCh7IHJvd0luZGV4OiBjdXJyZW50Q2VsbC5yb3dJbmRleCwgcm93RGF0YTogY3VycmVudENlbGwucm93RGF0YSwgY29sdW1uOiBfY29sXywgdmFsdWU6IHZhbCB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyDmm7TmlrBmb290ZXJEYXRhXHJcbiAgICAgICAgICAgICAgICB0aGlzLmRncy5yZWZyZXNoRm9vdGVyRGF0YS5lbWl0KCk7XHJcbiAgICAgICAgICAgICAgICBjZWxsRW5kRWRpdCA9IG9mKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgLy8g5Yi35paw6KGM5pWw5o2uXHJcbiAgICAgICAgICAgICAgICAvLyB0aGlzLmRyLnJlZnJlc2goKTtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRnLnNlbGVjdGVkUm93ICYmIHRoaXMuZGcuc2VsZWN0ZWRSb3cuZHIpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRnLnNlbGVjdGVkUm93LmRyLnJlZnJlc2goKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoY3VycmVudENlbGwgJiYgY3VycmVudENlbGwuY2VsbEVkaXRvcikge1xyXG4gICAgICAgICAgICAgICAgICAgIGVkaXRvciA9IGN1cnJlbnRDZWxsLmNlbGxFZGl0b3IuY29tcG9uZW50UmVmLmluc3RhbmNlO1xyXG4gICAgICAgICAgICAgICAgICAgIGVkaXRvci5pbnB1dEVsZW1lbnQuZm9jdXMoKTtcclxuICAgICAgICAgICAgICAgICAgICBjZWxsRW5kRWRpdCA9IG9mKGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2VsbEVuZEVkaXQgPSBvZih0cnVlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBjZWxsRW5kRWRpdDtcclxuICAgIH1cclxuXHJcbiAgICBjYW5jZWxDZWxsRWRpdGluZygpIHtcclxuICAgICAgICBpZiAodGhpcy5kZy5jdXJyZW50Q2VsbCAmJiB0aGlzLmRnLmN1cnJlbnRDZWxsLmlzRWRpdGluZyAmJiB0aGlzLmRnLnNlbGVjdGVkUm93LmluZGV4ID4gLTEpIHtcclxuICAgICAgICAgICAgLy8gdGhpcy5kZnMucmVzZXRSb3codGhpcy5kZy5zZWxlY3RlZFJvdy5pZCk7XHJcbiAgICAgICAgICAgIHRoaXMuZGMucm93RGF0YSA9IHRoaXMuZGcuc2VsZWN0ZWRSb3cuZGF0YTtcclxuICAgICAgICAgICAgdGhpcy5mb3JtQ29udHJvbC5yZXNldChVdGlscy5nZXRWYWx1ZSh0aGlzLmNvbHVtbi5maWVsZCwgdGhpcy5kYy5yb3dEYXRhKSk7XHJcbiAgICAgICAgICAgIHRoaXMuY2xvc2VFZGl0aW5nQ2VsbCgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG4gICAgYmluZEVkaXRvcklucHV0RXZlbnQoKSB7XHJcbiAgICAgICAgY29uc3QgY2VSZWYgPSB0aGlzLmNlbGxFZGl0b3JSZWYgfHwgdGhpcy5kYy5jZWxsRWRpdG9yO1xyXG4gICAgICAgIGxldCBpbnB1dCA9IG51bGw7XHJcbiAgICAgICAgaWYgKGNlUmVmKSB7XHJcbiAgICAgICAgICAgIGlucHV0ID0gY2VSZWYuY29tcG9uZW50UmVmLmluc3RhbmNlLmlucHV0RWxlbWVudDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5jb2x1bW4uZWRpdG9yVGVtcGxhdGUpIHtcclxuICAgICAgICAgICAgICAgIGlucHV0ID0gdGhpcy5kYy5lbC5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0LHRleHRhcmVhJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGlucHV0KSB7XHJcbiAgICAgICAgICAgIGlucHV0LmZvY3VzKCk7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmRnLnNlbGVjdE9uRWRpdGluZyAmJiB0aGlzLmNvbHVtbi5lZGl0b3JUZW1wbGF0ZSkge1xyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlucHV0LnNlbGVjdCkgeyBpbnB1dC5zZWxlY3QoKTsgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMuZWRpdG9ySW5wdXRLZXlkb3duRXZlbnQgPSB0aGlzLnJlbmRlci5saXN0ZW4oaW5wdXQsICdrZXlkb3duJywgKGUpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMub25LZXlEb3duRm9ySW5wdXQoZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB1bkJpbmRFZGl0b3JJbnB1dEV2ZW50KCkge1xyXG4gICAgICAgIGlmICh0aGlzLmVkaXRvcklucHV0S2V5ZG93bkV2ZW50KSB7XHJcbiAgICAgICAgICAgIHRoaXMuZWRpdG9ySW5wdXRLZXlkb3duRXZlbnQoKTtcclxuICAgICAgICAgICAgdGhpcy5lZGl0b3JJbnB1dEtleWRvd25FdmVudCA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9uS2V5RG93bkZvcklucHV0KGU6IEtleWJvYXJkRXZlbnQpIHtcclxuICAgICAgICBjb25zdCBrZXlDb2RlID0gZS5rZXlDb2RlO1xyXG4gICAgICAgIGlmIChlLmFsdEtleSB8fCBlLmN0cmxLZXkpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoKHRoaXMuZWRpdG9yICYmIHRoaXMuZWRpdG9yLnN0b3BQcm9wYWdhdGlvbikgfHwga2V5Q29kZSA9PT0gMTMgfHwgdGhpcy5jb2x1bW4uZWRpdG9yVGVtcGxhdGUpIHtcclxuICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHN3aXRjaCAoa2V5Q29kZSkge1xyXG4gICAgICAgICAgICBjYXNlIDMyOiAgLy8gU1BBQ0VcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbHVtbi5lZGl0b3IudHlwZSA9PT0gJ3N3aXRjaCcpIHtcclxuICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lZGl0b3IuaW5zdGFuY2UudXBkYXRlQ2hlY2tlZChlLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAxMzogIC8vIEVudGVyXHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlRWRpdGluZ0NlbGwoKS5waXBlKHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKSkucGlwZShcclxuICAgICAgICAgICAgICAgICAgICBkZWJvdW5jZVRpbWUoMTAwKVxyXG4gICAgICAgICAgICAgICAgKS5zdWJzY3JpYmUoZiA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGYpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kZy5kZ0NvbnRhaW5lci5uYXRpdmVFbGVtZW50LmZvY3VzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGVudGVyUGFyYW0gPSB7IGdpcmQ6IHRoaXMuZGcsIGNlbGw6IHRoaXMuZGcuY3VycmVudENlbGwsIGV2ZW50OiBlIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbHVtbi5vbkVudGVySGFuZGxlcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb2x1bW4ub25FbnRlckhhbmRsZXIoZW50ZXJQYXJhbSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXh0VGQgPSB0aGlzLmRnLmN1cnJlbnRDZWxsLmNlbGxFbGVtZW50Lm5leHRFbGVtZW50U2libGluZztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmRnLmN1cnJlbnRDZWxsLmxhc3RSb3cgJiYgIW5leHRUZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGcubGFzdENlbGxFbnRlckhhbmRsZS5lbWl0KGVudGVyUGFyYW0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAyNzogLy8gRVNDXHJcbiAgICAgICAgICAgICAgICB0aGlzLmNhbmNlbENlbGxFZGl0aW5nKCk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSA5OiAvLyBUYWJcclxuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRnLmNsaWNrRGVsYXkgPSAwO1xyXG4gICAgICAgICAgICAgICAgaWYgKGUuc2hpZnRLZXkpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlRWRpdGluZ0NlbGwoKS5waXBlKHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKSkuc3Vic2NyaWJlKGYgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3ZlUHJldkNlbGxBbmRFZGl0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZUVkaXRpbmdDZWxsKCkucGlwZSh0YWtlVW50aWwodGhpcy5kZXN0cm95JCkpLnN1YnNjcmliZShmID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGYpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW92ZU5leHRDZWxsQW5kRWRpdChlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIDQwOiAvLyDihpNcclxuICAgICAgICAgICAgICAgIC8qKiDpgInkuK3kuIvkuIDooYzvvIzkuJTlvZPliY3liJfov5vlhaXnvJbovpHmgIE7IOS7heaZrumAmuaWh+acrOi+k+WFpeahhuaUr+aMgSAqL1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY29sdW1uLmVkaXRvci50eXBlID09PSAndGV4dGJveCcpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlRWRpdGluZ0NlbGwoKS5waXBlKHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKSkuc3Vic2NyaWJlKGYgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3ROZXh0Um93QW5kRWRpdENlbGwodGhpcy5jb2x1bW4uZmllbGQsICdkb3duJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAzODogLy8g4oaRXHJcbiAgICAgICAgICAgICAgICAvKiog6YCJ5Lit5LiK5LiA6KGM77yM5LiU5b2T5YmN5YiX6L+b5YWl57yW6L6R5oCBOyDku4Xmma7pgJrmlofmnKzovpPlhaXmoYbmlK/mjIEgKi9cclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbHVtbi5lZGl0b3IudHlwZSA9PT0gJ3RleHRib3gnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZUVkaXRpbmdDZWxsKCkucGlwZSh0YWtlVW50aWwodGhpcy5kZXN0cm95JCkpLnN1YnNjcmliZShmID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGYpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0TmV4dFJvd0FuZEVkaXRDZWxsKHRoaXMuY29sdW1uLmZpZWxkLCAndXAnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNlbGVjdENlbGwoZmllbGQ6IHN0cmluZywgdGRFbGVtZW50PzogYW55KSB7XHJcbiAgICAgICAgdGhpcy5jbG9zZUVkaXRpbmdDZWxsKCkuc3Vic2NyaWJlKHQgPT4ge1xyXG4gICAgICAgICAgICBpZiAoIXQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0ZEVsZW1lbnQgPSB0ZEVsZW1lbnQgfHwgdGhpcy5lbC5uYXRpdmVFbGVtZW50O1xyXG4gICAgICAgICAgICB0aGlzLmNsZWFyQ2VsbFNlbGVjdGVkQ2xhc3MoKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChmaWVsZCAhPT0gdGhpcy5kZy5Db250cm9sUGFuZWxGZWlsZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIuYWRkQ2xhc3ModGRFbGVtZW50LCBDRUxMX1NFTEVDVEVEX0NMUyk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIHRoaXMuZHIuZHJIb3Zlci5zZXRSb3dIb3ZlckNscyhmYWxzZSk7XHJcbiAgICAgICAgICAgIHRoaXMuZGZzLnNldEN1cnJlbnRDZWxsKHRoaXMuZHIsIGZpZWxkLCB0ZEVsZW1lbnQsIHRoaXMuZGMpO1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuZGcuZmFzdCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5tb3ZlU2Nyb2xsYmFyKHRkRWxlbWVudCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIG1vdmVTY3JvbGxiYXIodGQ6IGFueSkge1xyXG4gICAgICAgIGNvbnN0IHRkUG9zTGVmdCA9IHRkLm9mZnNldExlZnQgKyB0ZC5vZmZzZXRXaWR0aDtcclxuICAgICAgICBjb25zdCBjb250YWluZXJXaWR0aCA9IHRoaXMuZGcud2lkdGggLSB0aGlzLmRnYi5jb2x1bW5zR3JvdXAubGVmdEZpeGVkV2lkdGg7XHJcbiAgICAgICAgY29uc3QgdGRSZWN0ID0gdGQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcbiAgICAgICAgY29uc3Qgc2Nyb2xsQ29udGFpbmVyID0gdGhpcy5kZ2IucHMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50O1xyXG4gICAgICAgIGNvbnN0IHBzQ29udGFpbmVyID0gc2Nyb2xsQ29udGFpbmVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gICAgICAgIGNvbnN0IHNjcm9sbFRvcCA9IHNjcm9sbENvbnRhaW5lci5zY3JvbGxUb3A7XHJcbiAgICAgICAgY29uc3Qgc2Nyb2xsTGVmdCA9IHNjcm9sbENvbnRhaW5lci5zY3JvbGxMZWZ0O1xyXG4gICAgICAgIGNvbnN0IHNjcm9sbGJhclhMZWZ0ID0gdGhpcy5kZ2IucHMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LnNjcm9sbExlZnQ7XHJcbiAgICAgICAgaWYgKHRkUG9zTGVmdCA+IGNvbnRhaW5lcldpZHRoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHggPSB0ZFBvc0xlZnQgLSBjb250YWluZXJXaWR0aCArIDI7XHJcbiAgICAgICAgICAgIGlmICh4ID4gc2Nyb2xsYmFyWExlZnQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGdiLnBzLnNjcm9sbFRvWCh4KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlmICh0ZFJlY3QueCA8IHBzQ29udGFpbmVyLngpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHggPSBzY3JvbGxMZWZ0IC0gdGRSZWN0Lng7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRnYi5wcy5zY3JvbGxUb1goeCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHRkUG9zVG9wID0gdGRSZWN0LnRvcCAtIHBzQ29udGFpbmVyLnRvcCArIHRkUmVjdC5oZWlnaHQ7XHJcbiAgICAgICAgaWYgKHRkUG9zVG9wID4gcHNDb250YWluZXIuaGVpZ2h0KSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHkgPSB0ZFBvc1RvcCAtIHBzQ29udGFpbmVyLmhlaWdodDtcclxuICAgICAgICAgICAgdGhpcy5kZ2IucHMuc2Nyb2xsVG9ZKHNjcm9sbFRvcCArIHkpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlmICh0ZFJlY3QueSA8IHBzQ29udGFpbmVyLnkpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGdiLnBzLnNjcm9sbFRvWShzY3JvbGxUb3AgLSAocHNDb250YWluZXIueSAtIHRkUmVjdC55KSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBtb3ZlTmV4dENlbGxBbmRFZGl0KGV2ZW50PzogYW55KSB7XHJcbiAgICAgICAgLy8gaWYgKCF0aGlzLmNsb3NlRWRpdGluZ0NlbGwoKSkge1xyXG4gICAgICAgIC8vICAgICByZXR1cm47XHJcbiAgICAgICAgLy8gfVxyXG4gICAgICAgIGNvbnN0IGZpZWxkSW5kZXggPSB0aGlzLmRmcy5nZXRDb2x1bW5JbmRleCh0aGlzLmNvbHVtbi5maWVsZCk7XHJcbiAgICAgICAgaWYgKGZpZWxkSW5kZXggKyAxIDwgdGhpcy5kZ2IuY29sdW1uc0dyb3VwLm5vcm1hbENvbHVtbnMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG5leHRDb2x1bW4gPSB0aGlzLmRnYi5jb2x1bW5zR3JvdXAubm9ybWFsQ29sdW1uc1tmaWVsZEluZGV4ICsgMV07XHJcblxyXG4gICAgICAgICAgICBjb25zdCBuZXh0VGQgPSB0aGlzLmRnLmN1cnJlbnRDZWxsLmNlbGxFbGVtZW50Lm5leHRFbGVtZW50U2libGluZztcclxuICAgICAgICAgICAgaWYgKG5leHRDb2x1bW4gJiYgKCghbmV4dENvbHVtbi5lZGl0b3IgJiYgIW5leHRDb2x1bW4uZWRpdG9yVGVtcGxhdGUpIHx8IHRoaXMuaXNSZWFkb25seShuZXh0Q29sdW1uKSkpIHtcclxuICAgICAgICAgICAgICAgIGlmIChuZXh0VGQpIHtcclxuICAgICAgICAgICAgICAgICAgICBuZXh0VGQuc2VsZWN0Q2VsbChldmVudCwgbmV4dFRkKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKG5leHRUZCkge1xyXG4gICAgICAgICAgICAgICAgbmV4dFRkLmZvY3VzKCk7XHJcbiAgICAgICAgICAgICAgICBpZiAobmV4dENvbHVtbi5lZGl0b3IgfHwgbmV4dENvbHVtbi5lZGl0b3JUZW1wbGF0ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5leHRUZC5lZGl0Q2VsbCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGdzLm9uQ2VsbEVkaXQobmV4dFRkKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIG5leHQgcm93J3MgZmlyc3QgY2VsbCB0byBlZGl0aW5nXHJcbiAgICAgICAgICAgIGNvbnN0IG5leHRUciA9IHRoaXMuZGcuY3VycmVudENlbGwuY2VsbEVsZW1lbnQucGFyZW50RWxlbWVudC5uZXh0RWxlbWVudFNpYmxpbmc7XHJcbiAgICAgICAgICAgIGlmIChuZXh0VHIgJiYgbmV4dFRyLnRhZ05hbWUgPT09ICdUUicpIHtcclxuICAgICAgICAgICAgICAgIC8vIG5leHRUci5jaGlsZHJlbi5maW5kKHRkID0+IHRkLmVkaXRDZWxsKS5lZGl0Q2VsbCgpO1xyXG4gICAgICAgICAgICAgICAgbGV0IGZpcnN0RWRpdG9yID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBsZXQgaSA9IDA7XHJcbiAgICAgICAgICAgICAgICB3aGlsZSAoIWZpcnN0RWRpdG9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZmlyc3RFZGl0b3IgPSAhIW5leHRUci5jaGlsZHJlbltpXS5lZGl0Q2VsbDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIWZpcnN0RWRpdG9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kZy5zZWxlY3Rpb25Nb2RlID09PSAnZGVmYXVsdCcpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRnLmNsZWFyQ2hlY2tlZHMoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIG5leHRUci5jaGlsZHJlbltpXS5lZGl0Q2VsbCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgbW92ZVByZXZDZWxsQW5kRWRpdCgpIHtcclxuICAgICAgICAvLyBpZiAoIXRoaXMuY2xvc2VFZGl0aW5nQ2VsbCgpKSB7XHJcbiAgICAgICAgLy8gICAgIHJldHVybjtcclxuICAgICAgICAvLyB9XHJcbiAgICAgICAgY29uc3QgZmllbGRJbmRleCA9IHRoaXMuZGZzLmdldENvbHVtbkluZGV4KHRoaXMuY29sdW1uLmZpZWxkKTtcclxuICAgICAgICBpZiAoZmllbGRJbmRleCAtIDEgPj0gMCkge1xyXG4gICAgICAgICAgICBjb25zdCBuZXh0Q29sdW1uID0gdGhpcy5kZ2IuY29sdW1uc0dyb3VwLm5vcm1hbENvbHVtbnNbZmllbGRJbmRleCAtIDFdO1xyXG4gICAgICAgICAgICBpZiAobmV4dENvbHVtbiAmJiB0aGlzLmlzUmVhZG9ubHkobmV4dENvbHVtbikpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCBuZXh0VGQgPSB0aGlzLmRnLmN1cnJlbnRDZWxsLmNlbGxFbGVtZW50LnByZXZpb3VzRWxlbWVudFNpYmxpbmc7XHJcbiAgICAgICAgICAgIGlmIChuZXh0VGQpIHtcclxuICAgICAgICAgICAgICAgIC8vIHRoaXMuc2VsZWN0Q2VsbChuZXh0Q29sdW1uLmZpZWxkLCBuZXh0VGQpO1xyXG4gICAgICAgICAgICAgICAgbmV4dFRkLmZvY3VzKCk7XHJcbiAgICAgICAgICAgICAgICBpZiAobmV4dENvbHVtbi5lZGl0b3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLmRmcy5lZGl0Q2VsbCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIG5leHRUZC5jbGljaygpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGdzLm9uQ2VsbEVkaXQobmV4dFRkKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNlbGVjdE5leHRSb3dBbmRFZGl0Q2VsbChjZWxsRmllbGROYW1lOiBzdHJpbmcsIGRpcjogJ2Rvd24nIHwgJ3VwJykge1xyXG4gICAgICAgIGNvbnN0IHAgPSBkaXIgPT09ICdkb3duJyA/ICduZXh0RWxlbWVudFNpYmxpbmcnOiAncHJldmlvdXNFbGVtZW50U2libGluZyc7XHJcbiAgICAgICAgY29uc3QgbmV4dFRyID0gdGhpcy5kZy5jdXJyZW50Q2VsbC5jZWxsRWxlbWVudC5wYXJlbnRFbGVtZW50W3BdO1xyXG4gICAgICAgIGlmIChuZXh0VHIgJiYgbmV4dFRyLnRhZ05hbWUgPT09ICdUUicpIHtcclxuICAgICAgICAgICAgY29uc3QgdGQ6IGFueSA9IEFycmF5LmZyb20obmV4dFRyLmNoaWxkcmVuKS5maW5kKCh0ZDogYW55KSA9PiB0ZC5nZXRBdHRyaWJ1dGUoJ2ZpZWxkJykgPT0gY2VsbEZpZWxkTmFtZSk7XHJcbiAgICAgICAgICAgIGlmICh0ZCAmJiB0ZC5lZGl0Q2VsbCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZGcuc2VsZWN0aW9uTW9kZSA9PT0gJ2RlZmF1bHQnICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGcuY2xlYXJDaGVja2VkcygpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGQuZWRpdENlbGwoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNsZWFyQ2VsbFNlbGVjdGVkQ2xhc3MoKSB7XHJcbiAgICAgICAgLy8gaWYgKHRoaXMuZGcuY3VycmVudENlbGwpIHtcclxuICAgICAgICAvLyAgICAgRG9tSGFuZGxlci5yZW1vdmVDbGFzcyh0aGlzLmRnLmN1cnJlbnRDZWxsLmNlbGxFbGVtZW50LCBDRUxMX1NFTEVDVEVEX0NMUyk7XHJcbiAgICAgICAgLy8gICAgIHRoaXMucmVuZGVyLnJlbW92ZUNsYXNzKHRoaXMuZGcuY3VycmVudENlbGwuY2VsbEVsZW1lbnQsIENFTExfRURJVElOR19DTFMpO1xyXG5cclxuICAgICAgICAvLyAgICAgY29uc3Qgc2VsZWN0ZWRDZWxsID0gdGhpcy5kZy5lbC5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy4nICsgQ0VMTF9TRUxFQ1RFRF9DTFMpO1xyXG4gICAgICAgIC8vICAgICBpZiAoc2VsZWN0ZWRDZWxsLmxlbmd0aCkge1xyXG4gICAgICAgIC8vICAgICAgICAgc2VsZWN0ZWRDZWxsLmZvckVhY2gobiA9PiB7XHJcbiAgICAgICAgLy8gICAgICAgICAgICAgdGhpcy5yZW5kZXIucmVtb3ZlQ2xhc3MobiwgQ0VMTF9TRUxFQ1RFRF9DTFMpO1xyXG4gICAgICAgIC8vICAgICAgICAgfSk7XHJcbiAgICAgICAgLy8gICAgIH1cclxuICAgICAgICAvLyB9XHJcblxyXG4gICAgICAgIHRoaXMuZGcucmVtb3ZlQ2VsbFNlbGVjdGVkQ2xzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzZXRDZWxsQ2xzV2l0aEVkaXRvclR5cGUoKSB7XHJcblxyXG4gICAgICAgIC8vIOiuvue9ruW9k+WJjemAieS4reWNleWFg+agvOagt+W8j1xyXG4gICAgICAgIGlmICh0aGlzLmRnLmN1cnJlbnRDZWxsICYmIHRoaXMuZGcuZW5hYmxlSGlnaGxpZ2h0Q2VsbCkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5kZy5jdXJyZW50Q2VsbC5maWVsZCA9PT0gdGhpcy5jb2x1bW4uZmllbGQgJiYgdGhpcy5kZy5jdXJyZW50Q2VsbC5yb3dJZCA9PT0gdGhpcy5yb3dEYXRhW3RoaXMuZGcuaWRGaWVsZF0gJiYgIXRoaXMuZGMuaXNFZGl0aW5nKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsZWFyQ2VsbFNlbGVjdGVkQ2xhc3MoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyLmFkZENsYXNzKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgQ0VMTF9TRUxFQ1RFRF9DTFMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgaWYgKCF0aGlzLmRnLmVuYWJsZUVkaXRDZWxsU3R5bGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgdGQgPSB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQ7XHJcbiAgICAgICAgdGhpcy5jbGVhbk90aGVyRWRpdG9ySWNvbih0ZCk7XHJcbiAgICAgICAgLy8g5b2T5YmN6KGM56aB55So77yM5LiN5YWB6K6457yW6L6R44CCXHJcbiAgICAgICAgaWYgKHRoaXMuZHIuZGlzYWJsZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCF0aGlzLmNvbHVtbi5lZGl0b3IpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuaXNSZWFkb25seSgpKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGVkaXRvclR5cGUgPSB0aGlzLmNvbHVtbi5lZGl0b3IudHlwZTtcclxuICAgICAgICBjb25zdCBjbHMgPSB0aGlzLmNvbHVtbi5hbGlnbiA9PT0gJ3JpZ2h0JyA/ICdhbGxvdy1lZGl0LWNlbGwtbGVmdCcgOiAnYWxsb3ctZWRpdC1jZWxsJztcclxuICAgICAgICB0aGlzLnJlbmRlci5hZGRDbGFzcyh0ZCwgY2xzKTtcclxuICAgICAgICB0aGlzLnJlbmRlci5hZGRDbGFzcyh0ZCwgQUxMT1dfRURJVF9DRUxMX0hJR0hMSUdIVF9DTFNbZWRpdG9yVHlwZV0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY2xlYW5PdGhlckVkaXRvckljb24odGQpIHtcclxuICAgICAgICBjb25zdCB2YWx1ZXMgPSBPYmplY3QudmFsdWVzKEFMTE9XX0VESVRfQ0VMTF9ISUdITElHSFRfQ0xTKTtcclxuICAgICAgICB2YWx1ZXMuZm9yRWFjaCh2ID0+IHtcclxuICAgICAgICAgICAgaWYgKHRkLmNsYXNzTmFtZS5pbmRleE9mKHYpID4gLTEpIHtcclxuICAgICAgICAgICAgICAgIHRkLmNsYXNzTmFtZSA9IHRkLmNsYXNzTmFtZS5yZXBsYWNlKCdhbGxvdy1lZGl0LWNlbGwtbGVmdCcsICcnKS5yZXBsYWNlKCdhbGxvdy1lZGl0LWNlbGwnLCAnJyk7XHJcbiAgICAgICAgICAgICAgICB0ZC5jbGFzc05hbWUgPSB0ZC5jbGFzc05hbWUucmVwbGFjZSh2LCAnJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxufVxyXG4iXX0=