/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, ViewChild, TemplateRef, Output, EventEmitter } from '@angular/core';
import { MessageNotice, activitySendTime, processSendTime } from '../message-notice';
import { MessagerService } from '@farris/ui-messager';
import { ProcessDesignerUIState } from '../../../app/process-designer.uistate';
import { ExpressionService, InjectedType } from "@gsp-svc/expression";
export class MessageNoticeEditComponent {
    /**
     * @param {?} message
     * @param {?} uistate
     * @param {?} expr
     */
    constructor(message, uistate, expr) {
        this.message = message;
        this.uistate = uistate;
        this.expr = expr;
        this.groupIcon2 = '<i class="f-icon f-icon-lookup"></i>';
        this.exprAble = false;
        this.closeEmitter = new EventEmitter();
        this.submitEmitter = new EventEmitter();
        this._location = 'activity';
        this.messageNotice = new MessageNotice();
        this.typeGroup = this.uistate.messageChannels.map((/**
         * @param {?} m
         * @return {?}
         */
        m => ({ value: m.code, name: m.name })));
        this.receiverVariables = [
            { value: 'workItemParticipant', name: '任务办理人' }
        ];
        this.sendTimes = [];
        this.bindingData = {};
    }
    /**
     * @param {?} l
     * @return {?}
     */
    set location(l) {
        this._location = l;
        if (this.location !== 'activity') {
            this.receiverVariables = [{ value: 'procInstCreator', name: '流程发起人' }];
        }
    }
    /**
     * @return {?}
     */
    get location() {
        return this._location;
    }
    /**
     * @param {?} m
     * @return {?}
     */
    set value(m) {
        this.messageNotice = Object.assign({}, m);
        if (this.messageNotice.receiver && this.messageNotice.receiver.length > 0) {
            /** @type {?} */
            let array = this.messageNotice.receiver.split(',');
            if (array.indexOf('workItemParticipant') > -1) {
                this.receiverVari = 'workItemParticipant';
            }
            else if (array.indexOf('procInstCreator') > -1) {
                this.receiverVari = 'procInstCreator';
            }
            if (array.length > 0) {
                array = array.filter((/**
                 * @param {?} a
                 * @return {?}
                 */
                a => (a !== 'workItemParticipant' && a !== 'procInstCreator')));
                this.bindingData.id = '';
                for (const r of array) {
                    this.bindingData.id += r + ',';
                }
                if (this.bindingData.id) {
                    this.bindingData.id = this.bindingData.id.substring(0, this.bindingData.id.length - 1);
                }
            }
        }
        if (this.messageNotice.receiverText && this.messageNotice.receiverText.length > 0) {
            /** @type {?} */
            let array = this.messageNotice.receiverText.split(',');
            if (array.length > 0) {
                array = array.filter((/**
                 * @param {?} a
                 * @return {?}
                 */
                a => (a !== '任务办理人' && a !== '流程发起人')));
                this.bindingData.name = '';
                for (const r of array) {
                    this.bindingData.name += r + ',';
                }
                if (this.bindingData.name) {
                    this.bindingData.name = this.bindingData.name.substring(0, this.bindingData.name.length - 1);
                }
            }
        }
        this.exprAble = this.messageNotice.subject.charAt(0) === '{';
    }
    /**
     * @return {?}
     */
    get value() {
        return this.messageNotice;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        if (this.location === 'activity') {
            this.sendTimes = activitySendTime;
        }
        else {
            this.sendTimes = processSendTime;
        }
    }
    /**
     * @return {?}
     */
    clickOK() {
        this.setReceiver();
        if (this.validator()) {
            this.submitEmitter.emit(this.messageNotice);
        }
    }
    /**
     * @return {?}
     */
    clickCancel() {
        this.closeEmitter.emit();
    }
    /**
     * @param {?} data
     * @return {?}
     */
    sendTimeChange(data) {
        if (data.data.value === activitySendTime[0].value) {
            this.receiverVari = 'workItemParticipant';
            this.clear();
        }
    }
    /**
     * @param {?} data
     * @return {?}
     */
    usersSelect(data) {
        console.log(data);
    }
    /**
     * @param {?} data
     * @return {?}
     */
    changeValue(data) {
        console.log(data);
    }
    /**
     * @return {?}
     */
    clear() {
        this.bindingData = {};
    }
    /**
     * @private
     * @return {?}
     */
    setReceiver() {
        /** @type {?} */
        let receiver = '';
        /** @type {?} */
        let receiverText = '';
        if (this.receiverVari) {
            receiver += this.receiverVari + ',';
            /** @type {?} */
            const array = this.receiverVari.split(',');
            if (array.length > 0) {
                for (const a of array) {
                    /** @type {?} */
                    const t = this.receiverVariables.find((/**
                     * @param {?} v
                     * @return {?}
                     */
                    v => v.value === a)).name;
                    receiverText += t + ',';
                }
            }
        }
        if (this.bindingData.id) {
            receiver += this.bindingData.id + ',';
            receiverText += this.bindingData.name + ',';
        }
        if (receiver) {
            receiver = receiver.substring(0, receiver.length - 1);
        }
        if (receiverText) {
            receiverText = receiverText.substring(0, receiverText.length - 1);
        }
        this.messageNotice.receiver = receiver;
        this.messageNotice.receiverText = receiverText;
    }
    /**
     * @private
     * @return {?}
     */
    validator() {
        if (!this.messageNotice.sendType) {
            this.message.info('发送方式不允许为空！');
            return false;
        }
        if (this.location !== 'messageActivity' && !this.messageNotice.sendTime) {
            this.message.info('发送时机不允许为空！');
            return false;
        }
        if (!this.messageNotice.subject) {
            this.message.info('消息主题不允许为空！');
            return false;
        }
        if (!this.messageNotice.content) {
            this.message.info('消息内容不允许为空！');
            return false;
        }
        if (!this.messageNotice.receiver) {
            this.message.info('接收人不允许为空！');
            return false;
        }
        return true;
    }
    /**
     * @param {?} data
     * @return {?}
     */
    titleExpr(data) {
        this.showTitleHelp(data);
    }
    /**
     * @param {?} data
     * @return {?}
     */
    contentExpr(data) {
        this.showContentHelp(data);
    }
    /**
     * @param {?} data
     * @return {?}
     */
    showContentHelp(data) {
        this.showExpr();
        if (this.messageNotice.content && this.messageNotice.content.length > 0) {
            this.expr.addExpressionText(this.messageNotice.content);
        }
        else {
            this.expr.addExpressionText('');
        }
        this.expr.buildExpression().then((/**
         * @param {?} expressionInfo
         * @return {?}
         */
        (expressionInfo) => {
            this.messageNotice.content = expressionInfo;
        }));
    }
    /**
     * @param {?} data
     * @return {?}
     */
    showTitleHelp(data) {
        if (this.messageNotice.subject && this.messageNotice.subject.charAt(0) !== '{') {
            this.messageNotice.subject = '';
        }
        this.showExpr();
        if (this.messageNotice.subject && this.messageNotice.subject.length > 0) {
            this.expr.addExpressionText(this.messageNotice.subject);
        }
        else {
            this.expr.addExpressionText('');
        }
        this.expr.buildExpression().then((/**
         * @param {?} expressionInfo
         * @return {?}
         */
        (expressionInfo) => {
            this.messageNotice.subject = expressionInfo;
        }));
    }
    /**
     * @return {?}
     */
    showExpr() {
        if (this.uistate.schemas.length > 0) {
            for (const schema of this.uistate.schemas) {
                // this.expr.addCommonObject(co);
                this.expr.addSchema('Schema', schema);
            }
            if (this.uistate.schemas[0].entityTypes && this.uistate.schemas[0].entityTypes.length > 0) {
                /** @type {?} */
                const entityType = this.uistate.schemas[0].entityTypes[0];
                this.expr.addInjectedEntity(entityType.name, 'Schema', entityType.name, InjectedType.EntityType);
            }
        }
        /** @type {?} */
        const context = new Array();
        if (this.uistate.procInstContext.length > 0) {
            for (const variable of this.uistate.procInstContext) {
                context.push(variable);
                // this.expr.addContext(variable);
            }
        }
        if (this.uistate.processVariableContext.length > 0) {
            for (const variable of this.uistate.processVariableContext) {
                if (!context.some((/**
                 * @param {?} c
                 * @return {?}
                 */
                c => c.key === variable.key))) {
                    context.push(variable);
                }
                // this.expr.addContext(variable);
            }
        }
        if (context.length > 0) {
            for (const v of context) {
                this.expr.addContext(v);
            }
        }
    }
    /**
     * @return {?}
     */
    tranExpr() {
        this.messageNotice.subject = '';
    }
}
MessageNoticeEditComponent.decorators = [
    { type: Component, args: [{
                selector: 'lib-message-notice-edit',
                template: "<div class=\"f-page\">\r\n  <div class=\"f-utils-fill-flex-column farris-split-section m-2 h-100\">\r\n    <section class=\"f-utils-fill-flex-column h-100\">\r\n      <div class=\"f-section-header pt-2 mx-2\">\r\n        <div class=\"f-title\">\r\n          <h4 class=\"f-title-text\">\u6D88\u606F\u901A\u77E5\u8BBE\u7F6E</h4>\r\n        </div>\r\n      </div>\r\n      <div class=\"f-utils-fill-flex-column h-100\">\r\n        <perfect-scrollbar [config]=\"{}\">\r\n          <form class=\"h-100\">\r\n            <div class=\"farris-form form-inline farris-form-inline\">\r\n              <div class=\"farris-group-wrap\">\r\n                <div class=\"form-group farris-form-group\">\r\n                  <label class=\"col-form-label\">\r\n                    <span class=\"farris-label-info text-danger\">*</span>\r\n                    <span class=\"farris-label-text\">\u53D1\u9001\u65B9\u5F0F</span>\r\n                  </label>\r\n                  <div class=\"farris-input-wrap ml-1\">\r\n                    <farris-checkboxgroup #checkboxGroup [(ngModel)]=\"messageNotice.sendType\" name=\"sendType\" [horizontal]=\"true\"\r\n                      [data]=\"typeGroup\">\r\n                    </farris-checkboxgroup>\r\n                    <div class=\"farris-feedback valid-feedback\"></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div *ngIf=\"location!=='messageActivity'\" class=\"farris-group-wrap my-3\">\r\n                <div class=\"form-group farris-form-group\">\r\n                  <label class=\"col-form-label\">\r\n                    <span class=\"farris-label-info text-danger\">*</span>\r\n                    <span class=\"farris-label-text\">\u53D1\u9001\u65F6\u673A</span>\r\n                  </label>\r\n                  <div class=\"farris-input-wrap ml-1\">\r\n                    <farris-combo-list [(ngModel)]=\"messageNotice.sendTime\" [idField]=\"'value'\" [textField]=\"'text'\"\r\n                      [enableClear]=\"false\" [data]=\"sendTimes\" name=\"sendTime\" [editable]=\"false\" (selectChange)=\"sendTimeChange($event)\">\r\n                    </farris-combo-list>\r\n                    <div class=\"farris-feedback valid-feedback\"></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div class=\"farris-group-wrap my-3\">\r\n                <div class=\"form-group farris-form-group\">\r\n                  <label class=\"col-form-label\">\r\n                    <span class=\"farris-label-info text-danger\">*</span>\r\n                    <span class=\"farris-label-text\">\u6D88\u606F\u4E3B\u9898</span>\r\n                  </label>\r\n                  <div class=\"farris-input-wrap ml-1\" *ngIf=\"!exprAble; else disabled\">\r\n                    <input class=\"form-control\" type=\"text\" value=\"subject\" [(ngModel)]=\"messageNotice.subject\" name=\"subject\" />\r\n                    <div class=\"farris-feedback valid-feedback\"></div>\r\n                  </div>\r\n                  <ng-template #disabled>\r\n                    <input-group [editable]=\"false\" [customCls]=\"'custom-cls'\" [groupText]=\"groupIcon2\"\r\n                                 [(value)]=\"messageNotice.subject\" (clickHandle)=\"titleExpr($event)\">\r\n                    </input-group>\r\n                    <div class=\"farris-feedback valid-feedback\"></div>\r\n                  </ng-template>\r\n                  <label class=\"col-form-label pl-1 mr-3\">\r\n                    <span class=\"farris-label-text\">\u542F\u7528\u8868\u8FBE\u5F0F</span>\r\n                  </label>\r\n                  <div class=\"farris-input-wrap mr-5\">\r\n                    <farris-switch [(ngModel)]=\"exprAble\" name=\"enable\" (click)=\"tranExpr()\"></farris-switch>\r\n                    <div class=\"farris-feedback valid-feedback\"></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div class=\"farris-group-wrap my-3\">\r\n                <div class=\"form-group farris-form-group\">\r\n                  <label class=\"col-form-label\">\r\n                    <span class=\"farris-label-info text-danger\">*</span>\r\n                    <span class=\"farris-label-text\">\u6D88\u606F\u5185\u5BB9</span>\r\n                  </label>\r\n                  <div class=\"farris-input-wrap ml-1\">\r\n                    <input-group [editable]=\"false\" [customCls]=\"'custom-cls'\" [groupText]=\"groupIcon2\"\r\n                                 [(value)]=\"messageNotice.content\" (clickHandle)=\"contentExpr($event)\">\r\n                    </input-group>\r\n                    <div class=\"farris-feedback valid-feedback\"></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div class=\"farris-group-wrap\">\r\n                <div class=\"form-group farris-form-group\">\r\n                  <label class=\"col-form-label\">\r\n                    <span class=\"farris-label-info text-danger\">*</span>\r\n                    <span class=\"farris-label-text\">\u63A5\u6536\u4EBA</span>\r\n                  </label>\r\n                  <div class=\"farris-input-wrap ml-1\">\r\n                    <div class=\"pb-2\">\r\n                      <farris-checkboxgroup #receiverVariable [(ngModel)]=\"receiverVari\" name=\"receiverVariable\"\r\n                        [horizontal]=\"true\" [data]=\"receiverVariables\" (changeValue)=\"changeValue($event)\">\r\n                      </farris-checkboxgroup>\r\n                    </div>\r\n                    <div *ngIf=\"messageNotice.sendTime!=='WORKITEM_CREATED'\">\r\n                      <sys-farris-grid-lookup #userHelp [singleSelect]=\"false\" [displayTxt]=\"bindingData.name\" [pagination]=\"true\"\r\n                        [pageSize]=\"20\" [title]=\"'\u7CFB\u7EDF\u7528\u6237'\" [sourceType]=\"'user'\" (afterConfirm)=\"usersSelect($event)\" [typeMode]=\"1\"\r\n                        [bindingData]=\"bindingData\" [filter]=\"{notGetCurrentUser:false, notGetStopUser:true}\" (clear)=\"clear()\" [required]=\"false\">\r\n                      </sys-farris-grid-lookup>\r\n                    </div>\r\n                    <div class=\"farris-feedback valid-feedback\"></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </form>\r\n        </perfect-scrollbar>\r\n      </div>\r\n    </section>\r\n  </div>\r\n</div>\r\n\r\n<ng-template #footer>\r\n  <button type=\"button\" class=\"btn btn-primary btn-sm mx-2\" (click)=\"clickOK()\">\u786E\u5B9A</button>\r\n  <button type=\"button\" class=\"btn btn-secondary btn-sm mx-2\" (click)=\"clickCancel()\">\u53D6\u6D88</button>\r\n</ng-template>\r\n",
                styles: [""]
            }] }
];
/** @nocollapse */
MessageNoticeEditComponent.ctorParameters = () => [
    { type: MessagerService },
    { type: ProcessDesignerUIState },
    { type: ExpressionService }
];
MessageNoticeEditComponent.propDecorators = {
    footer: [{ type: ViewChild, args: ['footer',] }],
    closeEmitter: [{ type: Output }],
    submitEmitter: [{ type: Output }],
    location: [{ type: Input }],
    value: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    MessageNoticeEditComponent.prototype.groupIcon2;
    /** @type {?} */
    MessageNoticeEditComponent.prototype.exprAble;
    /** @type {?} */
    MessageNoticeEditComponent.prototype.footer;
    /** @type {?} */
    MessageNoticeEditComponent.prototype.closeEmitter;
    /** @type {?} */
    MessageNoticeEditComponent.prototype.submitEmitter;
    /**
     * @type {?}
     * @private
     */
    MessageNoticeEditComponent.prototype._location;
    /** @type {?} */
    MessageNoticeEditComponent.prototype.messageNotice;
    /** @type {?} */
    MessageNoticeEditComponent.prototype.typeGroup;
    /** @type {?} */
    MessageNoticeEditComponent.prototype.receiverVariables;
    /** @type {?} */
    MessageNoticeEditComponent.prototype.sendTimes;
    /** @type {?} */
    MessageNoticeEditComponent.prototype.receiverVari;
    /** @type {?} */
    MessageNoticeEditComponent.prototype.bindingData;
    /**
     * @type {?}
     * @private
     */
    MessageNoticeEditComponent.prototype.message;
    /**
     * @type {?}
     * @private
     */
    MessageNoticeEditComponent.prototype.uistate;
    /**
     * @type {?}
     * @private
     */
    MessageNoticeEditComponent.prototype.expr;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWVzc2FnZS1ub3RpY2UtZWRpdC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLXdmL3dmLXByb2Nlc3MtZWRpdG9yLyIsInNvdXJjZXMiOlsibGliL3ZpZXdzL21lc3NhZ2Utbm90aWNlL21lc3NhZ2Utbm90aWNlLWVkaXQvbWVzc2FnZS1ub3RpY2UtZWRpdC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsS0FBSyxFQUFFLFNBQVMsRUFBRSxXQUFXLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN2RyxPQUFPLEVBQUUsYUFBYSxFQUFFLGdCQUFnQixFQUFhLGVBQWUsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ2hHLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN0RCxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSx1Q0FBdUMsQ0FBQztBQUMvRSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsWUFBWSxFQUFDLE1BQU0scUJBQXFCLENBQUM7QUFPckUsTUFBTSxPQUFPLDBCQUEwQjs7Ozs7O0lBMkVyQyxZQUNVLE9BQXdCLEVBQ3hCLE9BQStCLEVBQy9CLElBQXVCO1FBRnZCLFlBQU8sR0FBUCxPQUFPLENBQWlCO1FBQ3hCLFlBQU8sR0FBUCxPQUFPLENBQXdCO1FBQy9CLFNBQUksR0FBSixJQUFJLENBQW1CO1FBNUVqQyxlQUFVLEdBQUcsc0NBQXNDLENBQUM7UUFDcEQsYUFBUSxHQUFHLEtBQUssQ0FBQztRQUdQLGlCQUFZLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUN2QyxrQkFBYSxHQUFHLElBQUksWUFBWSxFQUFpQixDQUFDO1FBRXBELGNBQVMsR0FBK0MsVUFBVSxDQUFDO1FBYTNFLGtCQUFhLEdBQUcsSUFBSSxhQUFhLEVBQUUsQ0FBQztRQTBDcEMsY0FBUyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMs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N09GLFNBQVMsU0FBQztnQkFDVCxRQUFRLEVBQUUseUJBQXlCO2dCQUNuQyw4cE5BQW1EOzthQUVwRDs7OztZQVJRLGVBQWU7WUFDZixzQkFBc0I7WUFDdEIsaUJBQWlCOzs7cUJBV3ZCLFNBQVMsU0FBQyxRQUFROzJCQUVsQixNQUFNOzRCQUNOLE1BQU07dUJBR04sS0FBSztvQkFhTCxLQUFLOzs7O0lBckJOLGdEQUFvRDs7SUFDcEQsOENBQWlCOztJQUNqQiw0Q0FBOEM7O0lBRTlDLGtEQUFpRDs7SUFDakQsbURBQTREOzs7OztJQUU1RCwrQ0FBMkU7O0lBYTNFLG1EQUFvQzs7SUEwQ3BDLCtDQUFxRjs7SUFFckYsdURBRUU7O0lBRUYsK0NBQWU7O0lBRWYsa0RBQXFCOztJQUVyQixpREFBZ0M7Ozs7O0lBRTlCLDZDQUFnQzs7Ozs7SUFDaEMsNkNBQXVDOzs7OztJQUN2QywwQ0FBK0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgSW5wdXQsIFZpZXdDaGlsZCwgVGVtcGxhdGVSZWYsIE91dHB1dCwgRXZlbnRFbWl0dGVyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IE1lc3NhZ2VOb3RpY2UsIGFjdGl2aXR5U2VuZFRpbWUsIHNlbmRUeXBlcywgcHJvY2Vzc1NlbmRUaW1lIH0gZnJvbSAnLi4vbWVzc2FnZS1ub3RpY2UnO1xyXG5pbXBvcnQgeyBNZXNzYWdlclNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW1lc3NhZ2VyJztcclxuaW1wb3J0IHsgUHJvY2Vzc0Rlc2lnbmVyVUlTdGF0ZSB9IGZyb20gJy4uLy4uLy4uL2FwcC9wcm9jZXNzLWRlc2lnbmVyLnVpc3RhdGUnO1xyXG5pbXBvcnQgeyBFeHByZXNzaW9uU2VydmljZSwgSW5qZWN0ZWRUeXBlfSBmcm9tIFwiQGdzcC1zdmMvZXhwcmVzc2lvblwiO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdsaWItbWVzc2FnZS1ub3RpY2UtZWRpdCcsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL21lc3NhZ2Utbm90aWNlLWVkaXQuY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsczogWycuL21lc3NhZ2Utbm90aWNlLWVkaXQuY29tcG9uZW50LnNjc3MnXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgTWVzc2FnZU5vdGljZUVkaXRDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG5cclxuICBncm91cEljb24yID0gJzxpIGNsYXNzPVwiZi1pY29uIGYtaWNvbi1sb29rdXBcIj48L2k+JztcclxuICBleHByQWJsZSA9IGZhbHNlO1xyXG4gIEBWaWV3Q2hpbGQoJ2Zvb3RlcicpIGZvb3RlcjogVGVtcGxhdGVSZWY8YW55PjtcclxuXHJcbiAgQE91dHB1dCgpIGNsb3NlRW1pdHRlciA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG4gIEBPdXRwdXQoKSBzdWJtaXRFbWl0dGVyID0gbmV3IEV2ZW50RW1pdHRlcjxNZXNzYWdlTm90aWNlPigpO1xyXG5cclxuICBwcml2YXRlIF9sb2NhdGlvbjogJ2FjdGl2aXR5JyB8ICdwcm9jZXNzJyB8ICdtZXNzYWdlQWN0aXZpdHknID0gJ2FjdGl2aXR5JztcclxuICBASW5wdXQoKVxyXG4gIHNldCBsb2NhdGlvbihsOiAnYWN0aXZpdHknIHwgJ3Byb2Nlc3MnIHwgJ21lc3NhZ2VBY3Rpdml0eScpIHtcclxuICAgIHRoaXMuX2xvY2F0aW9uID0gbDtcclxuICAgIGlmICh0aGlzLmxvY2F0aW9uICE9PSAnYWN0aXZpdHknKSB7XHJcbiAgICAgIHRoaXMucmVjZWl2ZXJWYXJpYWJsZXMgPSBbeyB2YWx1ZTogJ3Byb2NJbnN0Q3JlYXRvcicsIG5hbWU6ICfmtYHnqIvlj5HotbfkuronIH1dO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZ2V0IGxvY2F0aW9uKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX2xvY2F0aW9uO1xyXG4gIH1cclxuXHJcbiAgbWVzc2FnZU5vdGljZSA9IG5ldyBNZXNzYWdlTm90aWNlKCk7XHJcbiAgQElucHV0KClcclxuICBzZXQgdmFsdWUobTogTWVzc2FnZU5vdGljZSkge1xyXG4gICAgdGhpcy5tZXNzYWdlTm90aWNlID0gT2JqZWN0LmFzc2lnbih7fSwgbSkgO1xyXG4gICAgaWYgKHRoaXMubWVzc2FnZU5vdGljZS5yZWNlaXZlciAmJiB0aGlzLm1lc3NhZ2VOb3RpY2UucmVjZWl2ZXIubGVuZ3RoID4gMCkge1xyXG4gICAgICBsZXQgYXJyYXkgPSB0aGlzLm1lc3NhZ2VOb3RpY2UucmVjZWl2ZXIuc3BsaXQoJywnKTtcclxuICAgICAgaWYgKGFycmF5LmluZGV4T2YoJ3dvcmtJdGVtUGFydGljaXBhbnQnKSA+IC0xKSB7XHJcbiAgICAgICAgdGhpcy5yZWNlaXZlclZhcmkgPSAnd29ya0l0ZW1QYXJ0aWNpcGFudCc7XHJcbiAgICAgIH0gZWxzZSBpZiAoYXJyYXkuaW5kZXhPZigncHJvY0luc3RDcmVhdG9yJykgPiAtMSkge1xyXG4gICAgICAgIHRoaXMucmVjZWl2ZXJWYXJpID0gJ3Byb2NJbnN0Q3JlYXRvcic7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKGFycmF5Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICBhcnJheSA9IGFycmF5LmZpbHRlcihhID0+IChhICE9PSAnd29ya0l0ZW1QYXJ0aWNpcGFudCcgJiYgYSAhPT0gJ3Byb2NJbnN0Q3JlYXRvcicpKTtcclxuICAgICAgICB0aGlzLmJpbmRpbmdEYXRhLmlkID0gJyc7XHJcbiAgICAgICAgZm9yIChjb25zdCByIG9mIGFycmF5KSB7XHJcbiAgICAgICAgICB0aGlzLmJpbmRpbmdEYXRhLmlkICs9IHIgKyAnLCc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmJpbmRpbmdEYXRhLmlkKSB7XHJcbiAgICAgICAgICB0aGlzLmJpbmRpbmdEYXRhLmlkID0gdGhpcy5iaW5kaW5nRGF0YS5pZC5zdWJzdHJpbmcoMCwgdGhpcy5iaW5kaW5nRGF0YS5pZC5sZW5ndGggLSAxKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGlmICh0aGlzLm1lc3NhZ2VOb3RpY2UucmVjZWl2ZXJUZXh0ICYmIHRoaXMubWVzc2FnZU5vdGljZS5yZWNlaXZlclRleHQubGVuZ3RoID4gMCkge1xyXG4gICAgICBsZXQgYXJyYXkgPSB0aGlzLm1lc3NhZ2VOb3RpY2UucmVjZWl2ZXJUZXh0LnNwbGl0KCcsJyk7XHJcbiAgICAgIGlmIChhcnJheS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgYXJyYXkgPSBhcnJheS5maWx0ZXIoYSA9PiAoYSAhPT0gJ+S7u+WKoeWKnueQhuS6uicgJiYgYSAhPT0gJ+a1geeoi+WPkei1t+S6uicpKTtcclxuICAgICAgICB0aGlzLmJpbmRpbmdEYXRhLm5hbWUgPSAnJztcclxuICAgICAgICBmb3IgKGNvbnN0IHIgb2YgYXJyYXkpIHtcclxuICAgICAgICAgIHRoaXMuYmluZGluZ0RhdGEubmFtZSArPSByICsgJywnO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5iaW5kaW5nRGF0YS5uYW1lKSB7XHJcbiAgICAgICAgICB0aGlzLmJpbmRpbmdEYXRhLm5hbWUgPSB0aGlzLmJpbmRpbmdEYXRhLm5hbWUuc3Vic3RyaW5nKDAsIHRoaXMuYmluZGluZ0RhdGEubmFtZS5sZW5ndGggLSAxKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHRoaXMuZXhwckFibGUgPSB0aGlzLm1lc3NhZ2VOb3RpY2Uuc3ViamVjdC5jaGFyQXQoMCkgPT09ICd7JztcclxuICB9XHJcblxyXG4gIGdldCB2YWx1ZSgpIHtcclxuICAgIHJldHVybiB0aGlzLm1lc3NhZ2VOb3RpY2U7XHJcbiAgfVxyXG5cclxuICB0eXBlR3JvdXAgPSB0aGlzLnVpc3RhdGUubWVzc2FnZUNoYW5uZWxzLm1hcChtID0+ICh7IHZhbHVlOiBtLmNvZGUsIG5hbWU6IG0ubmFtZSB9KSk7XHJcblxyXG4gIHJlY2VpdmVyVmFyaWFibGVzID0gW1xyXG4gICAgeyB2YWx1ZTogJ3dvcmtJdGVtUGFydGljaXBhbnQnLCBuYW1lOiAn5Lu75Yqh5Yqe55CG5Lq6JyB9XHJcbiAgXTtcclxuXHJcbiAgc2VuZFRpbWVzID0gW107XHJcblxyXG4gIHJlY2VpdmVyVmFyaTogc3RyaW5nO1xyXG5cclxuICBiaW5kaW5nRGF0YTogeyBpZD8sIG5hbWU/fSA9IHt9O1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJpdmF0ZSBtZXNzYWdlOiBNZXNzYWdlclNlcnZpY2UsXHJcbiAgICBwcml2YXRlIHVpc3RhdGU6IFByb2Nlc3NEZXNpZ25lclVJU3RhdGUsXHJcbiAgICBwcml2YXRlIGV4cHI6IEV4cHJlc3Npb25TZXJ2aWNlLFxyXG4gICkgeyB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gICAgaWYgKHRoaXMubG9jYXRpb24gPT09ICdhY3Rpdml0eScpIHtcclxuICAgICAgdGhpcy5zZW5kVGltZXMgPSBhY3Rpdml0eVNlbmRUaW1lO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5zZW5kVGltZXMgPSBwcm9jZXNzU2VuZFRpbWU7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBjbGlja09LKCkge1xyXG4gICAgdGhpcy5zZXRSZWNlaXZlcigpO1xyXG4gICAgaWYgKHRoaXMudmFsaWRhdG9yKCkpIHtcclxuICAgICAgdGhpcy5zdWJtaXRFbWl0dGVyLmVtaXQodGhpcy5tZXNzYWdlTm90aWNlKTtcclxuICAgIH1cclxuICB9XHJcbiAgY2xpY2tDYW5jZWwoKSB7XHJcbiAgICB0aGlzLmNsb3NlRW1pdHRlci5lbWl0KCk7XHJcbiAgfVxyXG5cclxuICBzZW5kVGltZUNoYW5nZShkYXRhOiBhbnkpIHtcclxuICAgIGlmIChkYXRhLmRhdGEudmFsdWUgPT09IGFjdGl2aXR5U2VuZFRpbWVbMF0udmFsdWUpIHtcclxuICAgICAgdGhpcy5yZWNlaXZlclZhcmkgPSAnd29ya0l0ZW1QYXJ0aWNpcGFudCc7XHJcbiAgICAgIHRoaXMuY2xlYXIoKTtcclxuICAgIH1cclxuICB9XHJcbiAgdXNlcnNTZWxlY3QoZGF0YSkge1xyXG4gICAgY29uc29sZS5sb2coZGF0YSk7XHJcbiAgfVxyXG4gIGNoYW5nZVZhbHVlKGRhdGEpIHtcclxuICAgIGNvbnNvbGUubG9nKGRhdGEpO1xyXG4gIH1cclxuICBjbGVhcigpIHtcclxuICAgIHRoaXMuYmluZGluZ0RhdGEgPSB7fTtcclxuICB9XHJcbiAgcHJpdmF0ZSBzZXRSZWNlaXZlcigpIHtcclxuICAgIGxldCByZWNlaXZlciA9ICcnO1xyXG4gICAgbGV0IHJlY2VpdmVyVGV4dCA9ICcnO1xyXG4gICAgaWYgKHRoaXMucmVjZWl2ZXJWYXJpKSB7XHJcbiAgICAgIHJlY2VpdmVyICs9IHRoaXMucmVjZWl2ZXJWYXJpICsgJywnO1xyXG4gICAgICBjb25zdCBhcnJheSA9IHRoaXMucmVjZWl2ZXJWYXJpLnNwbGl0KCcsJyk7XHJcbiAgICAgIGlmIChhcnJheS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgZm9yIChjb25zdCBhIG9mIGFycmF5KSB7XHJcbiAgICAgICAgICBjb25zdCB0ID0gdGhpcy5yZWNlaXZlclZhcmlhYmxlcy5maW5kKHYgPT4gdi52YWx1ZSA9PT0gYSkubmFtZTtcclxuICAgICAgICAgIHJlY2VpdmVyVGV4dCArPSB0ICsgJywnO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMuYmluZGluZ0RhdGEuaWQpIHtcclxuICAgICAgcmVjZWl2ZXIgKz0gdGhpcy5iaW5kaW5nRGF0YS5pZCArICcsJztcclxuICAgICAgcmVjZWl2ZXJUZXh0ICs9IHRoaXMuYmluZGluZ0RhdGEubmFtZSArICcsJztcclxuICAgIH1cclxuICAgIGlmIChyZWNlaXZlcikge1xyXG4gICAgICByZWNlaXZlciA9IHJlY2VpdmVyLnN1YnN0cmluZygwLCByZWNlaXZlci5sZW5ndGggLSAxKTtcclxuICAgIH1cclxuICAgIGlmIChyZWNlaXZlclRleHQpIHtcclxuICAgICAgcmVjZWl2ZXJUZXh0ID0gcmVjZWl2ZXJUZXh0LnN1YnN0cmluZygwLCByZWNlaXZlclRleHQubGVuZ3RoIC0gMSk7XHJcbiAgICB9XHJcbiAgICB0aGlzLm1lc3NhZ2VOb3RpY2UucmVjZWl2ZXIgPSByZWNlaXZlcjtcclxuICAgIHRoaXMubWVzc2FnZU5vdGljZS5yZWNlaXZlclRleHQgPSByZWNlaXZlclRleHQ7XHJcbiAgfVxyXG4gIHByaXZhdGUgdmFsaWRhdG9yKCk6IGJvb2xlYW4ge1xyXG4gICAgaWYgKCF0aGlzLm1lc3NhZ2VOb3RpY2Uuc2VuZFR5cGUpIHtcclxuICAgICAgdGhpcy5tZXNzYWdlLmluZm8oJ+WPkemAgeaWueW8j+S4jeWFgeiuuOS4uuepuu+8gScpO1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5sb2NhdGlvbiAhPT0gJ21lc3NhZ2VBY3Rpdml0eScgJiYgIXRoaXMubWVzc2FnZU5vdGljZS5zZW5kVGltZSkge1xyXG4gICAgICB0aGlzLm1lc3NhZ2UuaW5mbygn5Y+R6YCB5pe25py65LiN5YWB6K645Li656m677yBJyk7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICAgIGlmICghdGhpcy5tZXNzYWdlTm90aWNlLnN1YmplY3QpIHtcclxuICAgICAgdGhpcy5tZXNzYWdlLmluZm8oJ+a2iOaBr+S4u+mimOS4jeWFgeiuuOS4uuepuu+8gScpO1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBpZiAoIXRoaXMubWVzc2FnZU5vdGljZS5jb250ZW50KSB7XHJcbiAgICAgIHRoaXMubWVzc2FnZS5pbmZvKCfmtojmga/lhoXlrrnkuI3lhYHorrjkuLrnqbrvvIEnKTtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgaWYgKCF0aGlzLm1lc3NhZ2VOb3RpY2UucmVjZWl2ZXIpIHtcclxuICAgICAgdGhpcy5tZXNzYWdlLmluZm8oJ+aOpeaUtuS6uuS4jeWFgeiuuOS4uuepuu+8gScpO1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcblxyXG4gIHRpdGxlRXhwcihkYXRhOiBhbnkpe1xyXG4gICAgdGhpcy5zaG93VGl0bGVIZWxwKGRhdGEpO1xyXG4gIH1cclxuICBjb250ZW50RXhwcihkYXRhOiBhbnkpe1xyXG4gICAgdGhpcy5zaG93Q29udGVudEhlbHAoZGF0YSk7XHJcbiAgfVxyXG5cclxuICBzaG93Q29udGVudEhlbHAoZGF0YTogc3RyaW5nKXtcclxuICAgIHRoaXMuc2hvd0V4cHIoKTtcclxuICAgIGlmICh0aGlzLm1lc3NhZ2VOb3RpY2UuY29udGVudCAmJiB0aGlzLm1lc3NhZ2VOb3RpY2UuY29udGVudC5sZW5ndGggPiAwKSB7XHJcbiAgICAgIHRoaXMuZXhwci5hZGRFeHByZXNzaW9uVGV4dCh0aGlzLm1lc3NhZ2VOb3RpY2UuY29udGVudCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLmV4cHIuYWRkRXhwcmVzc2lvblRleHQoJycpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5leHByLmJ1aWxkRXhwcmVzc2lvbigpLnRoZW4oKGV4cHJlc3Npb25JbmZvOiBzdHJpbmcpID0+IHtcclxuICAgICAgdGhpcy5tZXNzYWdlTm90aWNlLmNvbnRlbnQgPSBleHByZXNzaW9uSW5mbztcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgc2hvd1RpdGxlSGVscChkYXRhOiBzdHJpbmcpIHtcclxuICAgIGlmKHRoaXMubWVzc2FnZU5vdGljZS5zdWJqZWN0ICYmIHRoaXMubWVzc2FnZU5vdGljZS5zdWJqZWN0LmNoYXJBdCgwKSAhPT0gJ3snKXtcclxuICAgICAgdGhpcy5tZXNzYWdlTm90aWNlLnN1YmplY3QgPSAnJztcclxuICAgIH1cclxuICAgIHRoaXMuc2hvd0V4cHIoKTtcclxuICAgIGlmICh0aGlzLm1lc3NhZ2VOb3RpY2Uuc3ViamVjdCAmJiB0aGlzLm1lc3NhZ2VOb3RpY2Uuc3ViamVjdC5sZW5ndGggPiAwKSB7XHJcbiAgICAgIHRoaXMuZXhwci5hZGRFeHByZXNzaW9uVGV4dCh0aGlzLm1lc3NhZ2VOb3RpY2Uuc3ViamVjdCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLmV4cHIuYWRkRXhwcmVzc2lvblRleHQoJycpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5leHByLmJ1aWxkRXhwcmVzc2lvbigpLnRoZW4oKGV4cHJlc3Npb25JbmZvOiBzdHJpbmcpID0+IHtcclxuICAgICAgdGhpcy5tZXNzYWdlTm90aWNlLnN1YmplY3QgPSBleHByZXNzaW9uSW5mbztcclxuICAgIH0pO1xyXG4gIH1cclxuICBzaG93RXhwcigpe1xyXG4gICAgaWYgKHRoaXMudWlzdGF0ZS5zY2hlbWFzLmxlbmd0aCA+IDApIHtcclxuICAgICAgZm9yIChjb25zdCBzY2hlbWEgb2YgdGhpcy51aXN0YXRlLnNjaGVtYXMpIHtcclxuICAgICAgICAvLyB0aGlzLmV4cHIuYWRkQ29tbW9uT2JqZWN0KGNvKTtcclxuICAgICAgICB0aGlzLmV4cHIuYWRkU2NoZW1hKCdTY2hlbWEnLCBzY2hlbWEpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICh0aGlzLnVpc3RhdGUuc2NoZW1hc1swXS5lbnRpdHlUeXBlcyAmJiB0aGlzLnVpc3RhdGUuc2NoZW1hc1swXS5lbnRpdHlUeXBlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgY29uc3QgZW50aXR5VHlwZSA9IHRoaXMudWlzdGF0ZS5zY2hlbWFzWzBdLmVudGl0eVR5cGVzWzBdO1xyXG4gICAgICAgIHRoaXMuZXhwci5hZGRJbmplY3RlZEVudGl0eShlbnRpdHlUeXBlLm5hbWUsICdTY2hlbWEnLFxyXG4gICAgICAgICAgZW50aXR5VHlwZS5uYW1lLCBJbmplY3RlZFR5cGUuRW50aXR5VHlwZSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGNvbnN0IGNvbnRleHQgPSBuZXcgQXJyYXkoKTtcclxuICAgIGlmICh0aGlzLnVpc3RhdGUucHJvY0luc3RDb250ZXh0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgZm9yIChjb25zdCB2YXJpYWJsZSBvZiB0aGlzLnVpc3RhdGUucHJvY0luc3RDb250ZXh0KSB7XHJcbiAgICAgICAgY29udGV4dC5wdXNoKHZhcmlhYmxlKTtcclxuICAgICAgICAvLyB0aGlzLmV4cHIuYWRkQ29udGV4dCh2YXJpYWJsZSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGlmICh0aGlzLnVpc3RhdGUucHJvY2Vzc1ZhcmlhYmxlQ29udGV4dC5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGZvciAoY29uc3QgdmFyaWFibGUgb2YgdGhpcy51aXN0YXRlLnByb2Nlc3NWYXJpYWJsZUNvbnRleHQpIHtcclxuICAgICAgICBpZiAoIWNvbnRleHQuc29tZShjID0+IGMua2V5ID09PSB2YXJpYWJsZS5rZXkpKSB7XHJcbiAgICAgICAgICBjb250ZXh0LnB1c2godmFyaWFibGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyB0aGlzLmV4cHIuYWRkQ29udGV4dCh2YXJpYWJsZSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGlmIChjb250ZXh0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgZm9yIChjb25zdCB2IG9mIGNvbnRleHQpIHtcclxuICAgICAgICB0aGlzLmV4cHIuYWRkQ29udGV4dCh2KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuICB0cmFuRXhwcigpe1xyXG4gICAgdGhpcy5tZXNzYWdlTm90aWNlLnN1YmplY3QgPSAnJztcclxuICB9XHJcbn1cclxuIl19