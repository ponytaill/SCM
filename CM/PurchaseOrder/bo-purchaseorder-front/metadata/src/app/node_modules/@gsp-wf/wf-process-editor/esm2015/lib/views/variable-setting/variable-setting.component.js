/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, HostBinding, Output, EventEmitter, Input, ViewChild, TemplateRef, Injector, ComponentFactoryResolver } from '@angular/core';
import { DatagridComponent } from '@farris/ui-datagrid';
import { MessagerService } from '@farris/ui-messager';
import { BsModalService } from '@farris/ui-modal';
import { ProcessVariablesComponent } from '../process-variables/process-variables.component';
import { ProcessDesignerUIState } from '../../app/process-designer.uistate';
import { VariableSetting } from './variable-setting';
import { EditorTypes } from '@farris/ui-datagrid-editors';
import { ExprEditMode, ExpressionService, InjectedType } from '@gsp-svc/expression';
import { ComponentEditComponent } from './views/component-edit/component-edit.component';
import { of } from 'rxjs';
export class VariableSettingComponent {
    /**
     * @param {?} resolver
     * @param {?} injector
     * @param {?} modalService
     * @param {?} message
     * @param {?} uistate
     * @param {?} expr
     */
    constructor(resolver, injector, modalService, message, uistate, expr) {
        this.resolver = resolver;
        this.injector = injector;
        this.modalService = modalService;
        this.message = message;
        this.uistate = uistate;
        this.expr = expr;
        this.cls = 'farris-main-area flex-column';
        this.closeModal = new EventEmitter();
        this.submitModal = new EventEmitter();
        this.value = new Array();
        this.editorParams = {};
        this.columns = [];
        this.tags = [
            { value: 'constant', text: '常量' },
            { value: 'expression', text: '表达式' },
            { value: 'component', text: '构件' }
        ];
        this.opportunities = [
            { value: 'ACTIVITY_STARTED', text: '活动开始' },
            { value: 'ACTIVITY_COMPLETED', text: '活动结束' }
        ];
        this.modalConfig = {
            title: '变量设置',
            width: 780,
            height: 460,
            showButtons: true
        };
        this.beforeEdit = (/**
         * @param {?} param
         * @return {?}
         */
        (param) => {
            /** @type {?} */
            const rowData = (/** @type {?} */ (param.rowData));
            /** @type {?} */
            const column = param.column;
            if (column.field === 'valueText') {
                if (((/** @type {?} */ (rowData))).tag === this.tags[0].value) {
                    param.column.editor = { type: EditorTypes.TEXTBOX, options: {} };
                }
                else {
                    param.column.editor = {
                        type: 'input-group',
                        options: {
                            groupText: '<i class="f-icon f-icon-lookup"></i>',
                            editable: false,
                            showClear: false,
                            clickHandle: (/**
                             * @param {?} e
                             * @return {?}
                             */
                            (e) => {
                                e.formControl.setValue(e.instance.value ? e.instance.value : '');
                                this.valueEdit(e);
                            }),
                            clear: (/**
                             * @param {?} e
                             * @return {?}
                             */
                            (e) => {
                                console.log('clear', e);
                            })
                        }
                    };
                }
            }
            return of(true);
        });
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.columns = [
            {
                field: 'variableCode', width: 90, title: '变量编号', sortable: true,
                validators: [
                    { type: 'required', messager: '必填' }
                ]
            },
            {
                field: 'variableName', width: 90, title: '变量名称', sortable: true,
                validators: [
                    { type: 'required', messager: '必填' }
                ]
            }, {
                field: 'tag', width: 60, title: '值类型', sortable: true,
                formatter: {
                    type: 'enum',
                    options: { valueField: 'value', textField: 'text', data: this.tags }
                },
                editor: {
                    type: EditorTypes.COMBOLIST,
                    options: {
                        valueField: 'value', textField: 'text', data: this.tags, idField: 'value', panelHeight: 'auto', showClear: false,
                        selectChange: (/**
                         * @param {?} e
                         * @return {?}
                         */
                        (e) => {
                            this.value = this.value.map((/**
                             * @param {?} v
                             * @return {?}
                             */
                            v => {
                                if (v.variableCode === e.rowId) {
                                    v.value = null;
                                    v.valueText = null;
                                    if (v.component) {
                                        v.component = null;
                                    }
                                    return v;
                                }
                                else {
                                    return v;
                                }
                            }));
                        })
                    }
                },
                validators: [
                    { type: 'required', messager: '必填' }
                ]
            }, {
                field: 'executionTime', width: 80, title: '执行时机', sortable: true,
                formatter: {
                    type: 'enum',
                    options: { valueField: 'value', textField: 'text', data: this.opportunities }
                },
                editor: {
                    type: EditorTypes.COMBOLIST,
                    options: {
                        valueField: 'value', textField: 'text', data: this.opportunities, idField: 'value', panelHeight: 'auto', showClear: false,
                    }
                },
                validators: [
                    { type: 'required', messager: '必填' }
                ],
            },
            {
                field: 'valueText', width: 150, title: '变量值', showTips: true,
                editor: { type: EditorTypes.TEXTBOX, options: {} },
                validators: [
                    { type: 'required', messager: '必填' }
                ]
            }
        ];
    }
    /**
     * @return {?}
     */
    add() {
        /** @type {?} */
        let dialog;
        /** @type {?} */
        const compFactory = this.resolver.resolveComponentFactory(ProcessVariablesComponent);
        /** @type {?} */
        const compRef = compFactory.create(this.injector);
        compRef.instance.variableSetting = true;
        compRef.instance.value = this.uistate.ProcessVariables;
        compRef.instance.variableSetEmitter.subscribe((/**
         * @param {?} re
         * @return {?}
         */
        (re) => {
            for (const v of re) {
                /** @type {?} */
                const variableSet = new VariableSetting();
                variableSet.variableCode = v.data.name;
                variableSet.variableName = v.data.documentation;
                variableSet.tag = v.data.tag || this.tags[0].value;
                variableSet.executionTime = v.data.executionTime || this.opportunities[0].value;
                if (this.value.findIndex((/**
                 * @param {?} i
                 * @return {?}
                 */
                i => i.variableCode === variableSet.variableCode)) === -1) {
                    this.value = this.value.concat([variableSet]);
                }
            }
            dialog.close();
        }));
        compRef.instance.closeModal.subscribe((/**
         * @param {?} re
         * @return {?}
         */
        re => {
            dialog.close();
        }));
        /** @type {?} */
        const modalConfig = {
            title: '流程变量',
            width: 660,
            height: 460,
            showButtons: true,
            buttons: compRef.instance.modalFooter
        };
        dialog = this.modalService.show(compRef, modalConfig);
    }
    /**
     * @return {?}
     */
    delete() {
        this.grid.endCellEdit();
        /** @type {?} */
        const selected = this.grid.selectedRow;
        if (!selected) {
            this.message.info('尚未选中变量！');
            return;
        }
        this.value = this.value.filter((/**
         * @param {?} v
         * @return {?}
         */
        v => v.variableCode !== selected.data.variableCode));
    }
    /**
     * @return {?}
     */
    clickOK() {
        this.grid.endCellEdit();
        if (this.validator()) {
            /** @type {?} */
            const object = { value: this.value, parameters: null };
            this.submitModal.emit(object);
        }
    }
    /**
     * @return {?}
     */
    clickCancel() {
        this.closeModal.emit();
    }
    /**
     * @return {?}
     */
    validator() {
        for (const item of this.value) {
            if (!item.value) {
                this.message.warning('变量值不允许为空！');
                return false;
            }
        }
        return true;
    }
    /**
     * @param {?} data
     * @return {?}
     */
    endEdit(data) {
        if (data.column.field === 'valueText' && data.rowData.tag === this.tags[0].value) {
            data.rowData.value = data.rowData.valueText;
        }
    }
    /**
     * @param {?} e
     * @return {?}
     */
    valueEdit(e) {
        /** @type {?} */
        const rowdata = e.rowData;
        switch (rowdata.tag) {
            case this.tags[1].value:
                this.editExpression(e);
                break;
            case this.tags[2].value:
                this.editComponent(e);
                break;
        }
    }
    /**
     * @private
     * @param {?} e
     * @return {?}
     */
    editExpression(e) {
        /** @type {?} */
        const data = e.rowData;
        if (this.uistate.schemas.length > 0) {
            for (const schema of this.uistate.schemas) {
                this.expr.addSchema('Schema', schema);
            }
            if (this.uistate.schemas[0].entityTypes && this.uistate.schemas[0].entityTypes.length > 0) {
                /** @type {?} */
                const entityType = this.uistate.schemas[0].entityTypes[0];
                this.expr.addInjectedEntity(entityType.name, 'Schema', entityType.name, InjectedType.EntityType);
            }
        }
        /** @type {?} */
        const context = new Array();
        if (this.uistate.procInstContext.length > 0) {
            for (const variable of this.uistate.procInstContext) {
                context.push(variable);
            }
        }
        if (this.uistate.formalParameterContext.length > 0) {
            for (const variable of this.uistate.formalParameterContext) {
                if (!context.some((/**
                 * @param {?} c
                 * @return {?}
                 */
                c => c.key === variable.key))) {
                    context.push(variable);
                }
            }
        }
        if (this.uistate.participantContext.length > 0) {
            for (const variable of this.uistate.participantContext) {
                if (!context.some((/**
                 * @param {?} c
                 * @return {?}
                 */
                c => c.key === variable.key))) {
                    context.push(variable);
                }
            }
        }
        if (this.uistate.processVariableContext.length > 0) {
            for (const variable of this.uistate.processVariableContext) {
                if (!context.some((/**
                 * @param {?} c
                 * @return {?}
                 */
                c => c.key === variable.key))) {
                    context.push(variable);
                }
            }
        }
        if (context.length > 0) {
            for (const v of context) {
                this.expr.addContext(v);
            }
        }
        this.expr.setEditPattern(ExprEditMode.Advanced); // 表达式展现模式：默认高级版
        this.expr.addExpressionText(data.value);
        this.expr.buildExpression().then((/**
         * @param {?} re
         * @return {?}
         */
        (re) => {
            e.formControl.setValue(re);
            e.instance.cd.detectChanges();
            data.value = re;
        }));
    }
    /**
     * @private
     * @param {?} e
     * @return {?}
     */
    editComponent(e) {
        /** @type {?} */
        const data = e.rowData;
        /** @type {?} */
        let dialog;
        /** @type {?} */
        const compFactory = this.resolver.resolveComponentFactory(ComponentEditComponent);
        /** @type {?} */
        const compRef = compFactory.create(this.injector);
        compRef.instance.component = data.component;
        compRef.instance.submitEmitter.subscribe((/**
         * @param {?} re
         * @return {?}
         */
        (re) => {
            e.formControl.setValue(re.Name + '-' + re.MethodCode);
            e.instance.cd.detectChanges();
            data.value = re.Id;
            data.component = re;
            dialog.close();
        }));
        compRef.instance.closeEmitter.subscribe((/**
         * @param {?} re
         * @return {?}
         */
        re => {
            dialog.close();
        }));
        /** @type {?} */
        const modalConfig = {
            title: '构件',
            width: 800,
            height: 515,
            showButtons: true,
            buttons: compRef.instance.footer
        };
        dialog = this.modalService.show(compRef, modalConfig);
    }
}
VariableSettingComponent.decorators = [
    { type: Component, args: [{
                selector: 'lib-variable-setting',
                template: "<div class=\"f-page\">\r\n  <div class=\"f-page-header\">\r\n    <nav class=\"f-page-header-base\">\r\n      <div class=\"f-title\">\r\n        <span class=\"f-title-icon f-text-orna-bill\">\r\n          <i class=\"f-icon f-icon-page-title-administer\"></i>\r\n        </span>\r\n        <h4 class=\"f-title-text\">\u5217\u8868</h4>\r\n      </div>\r\n      <div class=\"btn-toolbar btn-group-lg\">\r\n        <button class=\"btn btn-primary mr-2\" (click)=\"add()\">\u65B0\u589E</button>\r\n        <button class=\"btn btn-secondary\" (click)=\"delete()\">\u5220\u9664</button>\r\n      </div>\r\n    </nav>\r\n  </div>\r\n  <div class=\"f-page-main f-utils-fill-flex-column h-100\">\r\n    <div class=\"f-utils-fill-flex-column farris-overflow-y-auto h-100\">\r\n      <farris-datagrid #grid [data]=\"value\" [columns]=\"columns\" [idField]=\"'variableCode'\" [fit]=\"true\" [fitColumns]=\"true\"\r\n        [editable]=\"true\" [editMode]=\"'cell'\" [pagination]=\"false\" [showCheckbox]=\"false\" [multiSelect]=\"false\"\r\n        [showLineNumber]=\"true\" [lineNumberTitle]=\"'\u5E8F\u53F7'\" [lineNumberWidth]=\"50\" [striped]=\"true\"\r\n        (endEdit)=\"endEdit($event)\" [beforeEdit]=\"beforeEdit\">\r\n      </farris-datagrid>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<ng-template #iconSelectFooter>\r\n  <button type=\"button\" class=\"btn btn-primary btn-sm px-3 mx-2\" (click)=\"clickOK()\">\u786E\u5B9A</button>\r\n  <button type=\"button\" class=\"btn btn-secondary btn-sm px-3 mx-2\" (click)=\"clickCancel()\">\u53D6\u6D88</button>\r\n</ng-template>\r\n\r\n<ng-template #cell let-ctx>\r\n  <span (click)=\"valueEdit(ctx)\" class=\"link\"> {{ ctx.rowData.value?'\uFF08\u5DF2\u8BBE\u7F6E\uFF09': '\uFF08\u672A\u8BBE\u7F6E\uFF09' }}</span>\r\n</ng-template>",
                styles: [".link{color:#1206bb;font-size:14px}.link:hover{color:#5d478b;font-size:14px}"]
            }] }
];
/** @nocollapse */
VariableSettingComponent.ctorParameters = () => [
    { type: ComponentFactoryResolver },
    { type: Injector },
    { type: BsModalService },
    { type: MessagerService },
    { type: ProcessDesignerUIState },
    { type: ExpressionService }
];
VariableSettingComponent.propDecorators = {
    cls: [{ type: HostBinding, args: ['class',] }],
    closeModal: [{ type: Output }],
    submitModal: [{ type: Output }],
    value: [{ type: Input }],
    editorParams: [{ type: Input }],
    modalFooter: [{ type: ViewChild, args: ['iconSelectFooter',] }],
    grid: [{ type: ViewChild, args: ['grid',] }],
    cell: [{ type: ViewChild, args: ['cell',] }]
};
if (false) {
    /** @type {?} */
    VariableSettingComponent.prototype.cls;
    /** @type {?} */
    VariableSettingComponent.prototype.closeModal;
    /** @type {?} */
    VariableSettingComponent.prototype.submitModal;
    /** @type {?} */
    VariableSettingComponent.prototype.value;
    /** @type {?} */
    VariableSettingComponent.prototype.editorParams;
    /** @type {?} */
    VariableSettingComponent.prototype.modalFooter;
    /** @type {?} */
    VariableSettingComponent.prototype.grid;
    /** @type {?} */
    VariableSettingComponent.prototype.cell;
    /** @type {?} */
    VariableSettingComponent.prototype.columns;
    /**
     * @type {?}
     * @private
     */
    VariableSettingComponent.prototype.tags;
    /**
     * @type {?}
     * @private
     */
    VariableSettingComponent.prototype.opportunities;
    /** @type {?} */
    VariableSettingComponent.prototype.modalConfig;
    /** @type {?} */
    VariableSettingComponent.prototype.beforeEdit;
    /**
     * @type {?}
     * @private
     */
    VariableSettingComponent.prototype.resolver;
    /**
     * @type {?}
     * @private
     */
    VariableSettingComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    VariableSettingComponent.prototype.modalService;
    /**
     * @type {?}
     * @private
     */
    VariableSettingComponent.prototype.message;
    /**
     * @type {?}
     * @private
     */
    VariableSettingComponent.prototype.uistate;
    /**
     * @type {?}
     * @private
     */
    VariableSettingComponent.prototype.expr;
}
export class VariableSettingConverter {
    constructor() { }
    /**
     * @param {?} data
     * @return {?}
     */
    convertTo(data) {
        if (data && data.length > 0) {
            return '（已设置）';
        }
        else {
            return '（未设置）';
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmFyaWFibGUtc2V0dGluZy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLXdmL3dmLXByb2Nlc3MtZWRpdG9yLyIsInNvdXJjZXMiOlsibGliL3ZpZXdzL3ZhcmlhYmxlLXNldHRpbmcvdmFyaWFibGUtc2V0dGluZy5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsV0FBVyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxXQUFXLEVBQUUsUUFBUSxFQUFFLHdCQUF3QixFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3hKLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3hELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUV0RCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDbEQsT0FBTyxFQUFFLHlCQUF5QixFQUFFLE1BQU0sa0RBQWtELENBQUM7QUFDN0YsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sb0NBQW9DLENBQUM7QUFDNUUsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQ3JELE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUMxRCxPQUFPLEVBQUUsWUFBWSxFQUFFLGlCQUFpQixFQUFFLFlBQVksRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3BGLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLGlEQUFpRCxDQUFDO0FBRXpGLE9BQU8sRUFBRSxFQUFFLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFPMUIsTUFBTSxPQUFPLHdCQUF3Qjs7Ozs7Ozs7O0lBZ0NuQyxZQUNVLFFBQWtDLEVBQ2xDLFFBQWtCLEVBQ2xCLFlBQTRCLEVBQzVCLE9BQXdCLEVBQ3hCLE9BQStCLEVBQy9CLElBQXVCO1FBTHZCLGFBQVEsR0FBUixRQUFRLENBQTBCO1FBQ2xDLGFBQVEsR0FBUixRQUFRLENBQVU7UUFDbEIsaUJBQVksR0FBWixZQUFZLENBQWdCO1FBQzVCLFlBQU8sR0FBUCxPQUFPLENBQWlCO1FBQ3hCLFlBQU8sR0FBUCxPQUFPLENBQXdCO1FBQy9CLFNBQUksR0FBSixJQUFJLENBQW1CO1FBcENqQyxRQUFHLEdBQUcsOEJBQThCLENBQUM7UUFDM0IsZUFBVSxHQUFHLElBQUksWUFBWSxFQUFPLENBQUM7UUFDckMsZ0JBQVcsR0FBRyxJQUFJLFlBQVksRUFBTyxDQUFDO1FBRXZDLFVBQUssR0FBMkIsSUFBSSxLQUFLLEVBQUUsQ0FBQztRQUM1QyxpQkFBWSxHQUFRLEVBQUUsQ0FBQztRQUtoQyxZQUFPLEdBQUcsRUFBRSxDQUFDO1FBRUwsU0FBSSxHQUFHO1lBQ2IsRUFBRSxLQUFLLEVBQUUsVUFBVSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUU7WUFDakMsRUFBRSxLQUFLLEVBQUUsWUFBWSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUU7WUFDcEMsRUFBRSxLQUFLLEVBQUUsV0FBVyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUU7U0FDbkMsQ0FBQztRQUVNLGtCQUFhLEdBQUc7WUFDdEIsRUFBRSxLQUFLLEVBQUUsa0JBQWtCLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRTtZQUMzQyxFQUFFLEtBQUssRUFBRSxvQkFBb0IsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFO1NBQzlDLENBQUM7UUFFRixnQkFBVyxHQUFHO1lBQ1osS0FBSyxFQUFFLE1BQU07WUFDYixLQUFLLEVBQUUsR0FBRztZQUNWLE1BQU0sRUFBRSxHQUFHO1lBQ1gsV0FBVyxFQUFFLElBQUk7U0FDbEIsQ0FBQztRQThJRixlQUFVOzs7O1FBQUcsQ0FBQyxLQUFtQixFQUFFLEVBQUU7O2tCQUM3QixPQUFPLEdBQUcsbUJBQUEsS0FBSyxDQUFDLE9BQU8sRUFBTzs7a0JBQzlCLE1BQU0sR0FBRyxLQUFLLENBQUMsTUFBTTtZQUMzQixJQUFJLE1BQU0sQ0FBQyxLQUFLLEtBQUssV0FBVyxFQUFFO2dCQUNoQyxJQUFJLENBQUMsbUJBQUEsT0FBTyxFQUFtQixDQUFDLENBQUMsR0FBRyxLQUFLLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxFQUFFO29CQUMzRCxLQUFLLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxFQUFFLElBQUksRUFBRSxXQUFXLENBQUMsT0FBTyxFQUFFLE9BQU8sRUFBRSxFQUFFLEVBQUUsQ0FBQztpQkFDbEU7cUJBQU07b0JBQ0wsS0FBSyxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUc7d0JBQ3BCLElBQUksRUFBRSxhQUFhO3dCQUNuQixPQUFPLEVBQUU7NEJBQ1AsU0FBUyxFQUFFLHNDQUFzQzs0QkFDakQsUUFBUSxFQUFFLEtBQUs7NEJBQ2YsU0FBUyxFQUFFLEtBQUs7NEJBQ2hCLFdBQVc7Ozs7NEJBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRTtnQ0FDakIsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQztnQ0FDakUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQzs0QkFDcEIsQ0FBQyxDQUFBOzRCQUNELEtBQUs7Ozs7NEJBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRTtnQ0FDWCxPQUFPLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUMsQ0FBQzs0QkFDMUIsQ0FBQyxDQUFBO3lCQUNGO3FCQUNGLENBQUM7aUJBQ0g7YUFDRjtZQUNELE9BQU8sRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ2xCLENBQUMsRUFBQTtJQTlKRyxDQUFDOzs7O0lBRUwsUUFBUTtRQUNOLElBQUksQ0FBQyxPQUFPLEdBQUc7WUFDYjtnQkFDRSxLQUFLLEVBQUUsY0FBYyxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsSUFBSTtnQkFDL0QsVUFBVSxFQUFFO29CQUNWLEVBQUUsSUFBSSxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFO2lCQUNyQzthQUNGO1lBQ0Q7Z0JBQ0UsS0FBSyxFQUFFLGNBQWMsRUFBRSxLQUFLLEVBQUUsRUFBRSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFFLElBQUk7Z0JBQy9ELFVBQVUsRUFBRTtvQkFDVixFQUFFLElBQUksRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRTtpQkFDckM7YUFDRixFQUFFO2dCQUNELEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSxJQUFJO2dCQUNyRCxTQUFTLEVBQUU7b0JBQ1QsSUFBSSxFQUFFLE1BQU07b0JBQ1osT0FBTyxFQUFFLEVBQUUsVUFBVSxFQUFFLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsSUFBSSxFQUFFO2lCQUNyRTtnQkFDRCxNQUFNLEVBQUU7b0JBQ04sSUFBSSxFQUFFLFdBQVcsQ0FBQyxTQUFTO29CQUMzQixPQUFPLEVBQUU7d0JBQ1AsVUFBVSxFQUFFLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsSUFBSSxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsS0FBSzt3QkFDaEgsWUFBWTs7Ozt3QkFBRSxDQUFDLENBQUMsRUFBRSxFQUFFOzRCQUNsQixJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRzs7Ozs0QkFBQyxDQUFDLENBQUMsRUFBRTtnQ0FDOUIsSUFBSSxDQUFDLENBQUMsWUFBWSxLQUFLLENBQUMsQ0FBQyxLQUFLLEVBQUU7b0NBQzlCLENBQUMsQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDO29DQUNmLENBQUMsQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDO29DQUNuQixJQUFJLENBQUMsQ0FBQyxTQUFTLEVBQUU7d0NBQ2YsQ0FBQyxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUM7cUNBQ3BCO29DQUNELE9BQU8sQ0FBQyxDQUFDO2lDQUNWO3FDQUFNO29DQUNMLE9BQU8sQ0FBQyxDQUFDO2lDQUNWOzRCQUNILENBQUMsRUFBQyxDQUFDO3dCQUNMLENBQUMsQ0FBQTtxQkFDRjtpQkFDRjtnQkFDRCxVQUFVLEVBQUU7b0JBQ1YsRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUU7aUJBQ3JDO2FBQ0YsRUFBRTtnQkFDRCxLQUFLLEVBQUUsZUFBZSxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsSUFBSTtnQkFDaEUsU0FBUyxFQUFFO29CQUNULElBQUksRUFBRSxNQUFNO29CQUNaLE9BQU8sRUFBRSxFQUFFLFVBQVUsRUFBRSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLGFBQWEsRUFBRTtpQkFDOUU7Z0JBQ0QsTUFBTSxFQUFFO29CQUNOLElBQUksRUFBRSxXQUFXLENBQUMsU0FBUztvQkFDM0IsT0FBTyxFQUFFO3dCQUNQLFVBQVUsRUFBRSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLGFBQWEsRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLEtBQUs7cUJBQzFIO2lCQUNGO2dCQUNELFVBQVUsRUFBRTtvQkFDVixFQUFFLElBQUksRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRTtpQkFDckM7YUFDRjtZQUNEO2dCQUNFLEtBQUssRUFBRSxXQUFXLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSxJQUFJO2dCQUM1RCxNQUFNLEVBQUUsRUFBRSxJQUFJLEVBQUUsV0FBVyxDQUFDLE9BQU8sRUFBRSxPQUFPLEVBQUUsRUFBRSxFQUFFO2dCQUNsRCxVQUFVLEVBQUU7b0JBQ1YsRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUU7aUJBQ3JDO2FBQ0Y7U0FDRixDQUFDO0lBQ0osQ0FBQzs7OztJQUVELEdBQUc7O1lBQ0csTUFBVzs7Y0FDVCxXQUFXLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyx1QkFBdUIsQ0FBQyx5QkFBeUIsQ0FBQzs7Y0FDOUUsT0FBTyxHQUFHLFdBQVcsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQztRQUNqRCxPQUFPLENBQUMsUUFBUSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUM7UUFDeEMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQztRQUN2RCxPQUFPLENBQUMsUUFBUSxDQUFDLGtCQUFrQixDQUFDLFNBQVM7Ozs7UUFBQyxDQUFDLEVBQVMsRUFBRSxFQUFFO1lBQzFELEtBQUssTUFBTSxDQUFDLElBQUksRUFBRSxFQUFFOztzQkFDWixXQUFXLEdBQUcsSUFBSSxlQUFlLEVBQUU7Z0JBQ3pDLFdBQVcsQ0FBQyxZQUFZLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUM7Z0JBQ3ZDLFdBQVcsQ0FBQyxZQUFZLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUM7Z0JBQ2hELFdBQVcsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUM7Z0JBQ25ELFdBQVcsQ0FBQyxhQUFhLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxhQUFhLElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUM7Z0JBQ2hGLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxTQUFTOzs7O2dCQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLFlBQVksS0FBSyxXQUFXLENBQUMsWUFBWSxFQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUU7b0JBQ2pGLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDO2lCQUMvQzthQUNGO1lBQ0QsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ2pCLENBQUMsRUFBQyxDQUFDO1FBQ0gsT0FBTyxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsU0FBUzs7OztRQUFDLEVBQUUsQ0FBQyxFQUFFO1lBQ3pDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUNqQixDQUFDLEVBQUMsQ0FBQzs7Y0FDRyxXQUFXLEdBQUc7WUFDbEIsS0FBSyxFQUFFLE1BQU07WUFDYixLQUFLLEVBQUUsR0FBRztZQUNWLE1BQU0sRUFBRSxHQUFHO1lBQ1gsV0FBVyxFQUFFLElBQUk7WUFDakIsT0FBTyxFQUFFLE9BQU8sQ0FBQyxRQUFRLENBQUMsV0FBVztTQUN0QztRQUNELE1BQU0sR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsV0FBVyxDQUFDLENBQUM7SUFDeEQsQ0FBQzs7OztJQUVELE1BQU07UUFDSixJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDOztjQUNsQixRQUFRLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXO1FBQ3RDLElBQUksQ0FBQyxRQUFRLEVBQUU7WUFDYixJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUM3QixPQUFPO1NBQ1I7UUFDRCxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTTs7OztRQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLFlBQVksS0FBSyxRQUFRLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBQyxDQUFDO0lBQ3JGLENBQUM7Ozs7SUFFRCxPQUFPO1FBQ0wsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUN4QixJQUFJLElBQUksQ0FBQyxTQUFTLEVBQUUsRUFBRTs7a0JBQ2QsTUFBTSxHQUFHLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQyxLQUFLLEVBQUUsVUFBVSxFQUFFLElBQUksRUFBRTtZQUN0RCxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztTQUMvQjtJQUNILENBQUM7Ozs7SUFFRCxXQUFXO1FBQ1QsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUN6QixDQUFDOzs7O0lBRUQsU0FBUztRQUNQLEtBQUssTUFBTSxJQUFJLElBQUksSUFBSSxDQUFDLEtBQUssRUFBRTtZQUM3QixJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRTtnQkFDZixJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUMsQ0FBQztnQkFDbEMsT0FBTyxLQUFLLENBQUM7YUFDZDtTQUNGO1FBQ0QsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDOzs7OztJQTRCRCxPQUFPLENBQUMsSUFBUztRQUNmLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEtBQUssV0FBVyxJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxLQUFLLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxFQUFFO1lBQ2hGLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDO1NBQzdDO0lBQ0gsQ0FBQzs7Ozs7SUFFRCxTQUFTLENBQUMsQ0FBTTs7Y0FDUixPQUFPLEdBQW9CLENBQUMsQ0FBQyxPQUFPO1FBQzFDLFFBQVEsT0FBTyxDQUFDLEdBQUcsRUFBRTtZQUNuQixLQUFLLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSztnQkFDckIsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDdkIsTUFBTTtZQUNSLEtBQUssSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLO2dCQUNyQixJQUFJLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUN0QixNQUFNO1NBQ1Q7SUFDSCxDQUFDOzs7Ozs7SUFFTyxjQUFjLENBQUMsQ0FBTTs7Y0FDckIsSUFBSSxHQUFvQixDQUFDLENBQUMsT0FBTztRQUN2QyxJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDbkMsS0FBSyxNQUFNLE1BQU0sSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRTtnQkFDekMsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxFQUFFLE1BQU0sQ0FBQyxDQUFDO2FBQ3ZDO1lBQ0QsSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxXQUFXLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7O3NCQUNuRixVQUFVLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQztnQkFDekQsSUFBSSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxVQUFVLENBQUMsSUFBSSxFQUFFLFFBQVEsRUFDbkQsVUFBVSxDQUFDLElBQUksRUFBRSxZQUFZLENBQUMsVUFBVSxDQUFDLENBQUM7YUFDN0M7U0FDRjs7Y0FDSyxPQUFPLEdBQUcsSUFBSSxLQUFLLEVBQUU7UUFDM0IsSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLGVBQWUsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO1lBQzNDLEtBQUssTUFBTSxRQUFRLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxlQUFlLEVBQUU7Z0JBQ25ELE9BQU8sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7YUFDeEI7U0FDRjtRQUNELElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxzQkFBc0IsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO1lBQ2xELEtBQUssTUFBTSxRQUFRLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxzQkFBc0IsRUFBRTtnQkFDMUQsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJOzs7O2dCQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsS0FBSyxRQUFRLENBQUMsR0FBRyxFQUFDLEVBQUU7b0JBQzlDLE9BQU8sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7aUJBQ3hCO2FBQ0Y7U0FDRjtRQUNELElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO1lBQzlDLEtBQUssTUFBTSxRQUFRLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxrQkFBa0IsRUFBRTtnQkFDdEQsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJOzs7O2dCQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsS0FBSyxRQUFRLENBQUMsR0FBRyxFQUFDLEVBQUU7b0JBQzlDLE9BQU8sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7aUJBQ3hCO2FBQ0Y7U0FDRjtRQUNELElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxzQkFBc0IsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO1lBQ2xELEtBQUssTUFBTSxRQUFRLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxzQkFBc0IsRUFBRTtnQkFDMUQsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJOzs7O2dCQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsS0FBSyxRQUFRLENBQUMsR0FBRyxFQUFDLEVBQUU7b0JBQzlDLE9BQU8sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7aUJBQ3hCO2FBQ0Y7U0FDRjtRQUNELElBQUksT0FBTyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDdEIsS0FBSyxNQUFNLENBQUMsSUFBSSxPQUFPLEVBQUU7Z0JBQ3ZCLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDO2FBQ3pCO1NBQ0Y7UUFDRCxJQUFJLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxZQUFZLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxnQkFBZ0I7UUFDakUsSUFBSSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDeEMsSUFBSSxDQUFDLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQyxJQUFJOzs7O1FBQUMsQ0FBQyxFQUFVLEVBQUUsRUFBRTtZQUM5QyxDQUFDLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUMzQixDQUFDLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxhQUFhLEVBQUUsQ0FBQztZQUM5QixJQUFJLENBQUMsS0FBSyxHQUFHLEVBQUUsQ0FBQztRQUNsQixDQUFDLEVBQUMsQ0FBQztJQUNMLENBQUM7Ozs7OztJQUVPLGFBQWEsQ0FBQyxDQUFNOztjQUNwQixJQUFJLEdBQW9CLENBQUMsQ0FBQyxPQUFPOztZQUNuQyxNQUFXOztjQUNULFdBQVcsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLHVCQUF1QixDQUFDLHNCQUFzQixDQUFDOztjQUMzRSxPQUFPLEdBQUcsV0FBVyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDO1FBQ2pELE9BQU8sQ0FBQyxRQUFRLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUM7UUFDNUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxhQUFhLENBQUMsU0FBUzs7OztRQUFDLENBQUMsRUFBTyxFQUFFLEVBQUU7WUFDbkQsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLElBQUksR0FBRyxHQUFHLEdBQUcsRUFBRSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBQ3RELENBQUMsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLGFBQWEsRUFBRSxDQUFDO1lBQzlCLElBQUksQ0FBQyxLQUFLLEdBQUcsRUFBRSxDQUFDLEVBQUUsQ0FBQztZQUNuQixJQUFJLENBQUMsU0FBUyxHQUFHLEVBQUUsQ0FBQztZQUNwQixNQUFNLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDakIsQ0FBQyxFQUFDLENBQUM7UUFDSCxPQUFPLENBQUMsUUFBUSxDQUFDLFlBQVksQ0FBQyxTQUFTOzs7O1FBQUMsRUFBRSxDQUFDLEVBQUU7WUFDM0MsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ2pCLENBQUMsRUFBQyxDQUFDOztjQUNHLFdBQVcsR0FBRztZQUNsQixLQUFLLEVBQUUsSUFBSTtZQUNYLEtBQUssRUFBRSxHQUFHO1lBQ1YsTUFBTSxFQUFFLEdBQUc7WUFDWCxXQUFXLEVBQUUsSUFBSTtZQUNqQixPQUFPLEVBQUUsT0FBTyxDQUFDLFFBQVEsQ0FBQyxNQUFNO1NBQ2pDO1FBQ0QsTUFBTSxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxXQUFXLENBQUMsQ0FBQztJQUN4RCxDQUFDOzs7WUEzU0YsU0FBUyxTQUFDO2dCQUNULFFBQVEsRUFBRSxzQkFBc0I7Z0JBQ2hDLDJ2REFBZ0Q7O2FBRWpEOzs7O1lBbEJ1Ryx3QkFBd0I7WUFBbEMsUUFBUTtZQUk3RixjQUFjO1lBRmQsZUFBZTtZQUlmLHNCQUFzQjtZQUdSLGlCQUFpQjs7O2tCQVdyQyxXQUFXLFNBQUMsT0FBTzt5QkFFbkIsTUFBTTswQkFDTixNQUFNO29CQUVOLEtBQUs7MkJBQ0wsS0FBSzswQkFDTCxTQUFTLFNBQUMsa0JBQWtCO21CQUM1QixTQUFTLFNBQUMsTUFBTTttQkFDaEIsU0FBUyxTQUFDLE1BQU07Ozs7SUFUakIsdUNBQ3FDOztJQUNyQyw4Q0FBK0M7O0lBQy9DLCtDQUFnRDs7SUFFaEQseUNBQXFEOztJQUNyRCxnREFBZ0M7O0lBQ2hDLCtDQUE2RDs7SUFDN0Qsd0NBQTJDOztJQUMzQyx3Q0FBMEM7O0lBRTFDLDJDQUFhOzs7OztJQUViLHdDQUlFOzs7OztJQUVGLGlEQUdFOztJQUVGLCtDQUtFOztJQThJRiw4Q0F5QkM7Ozs7O0lBcEtDLDRDQUEwQzs7Ozs7SUFDMUMsNENBQTBCOzs7OztJQUMxQixnREFBb0M7Ozs7O0lBQ3BDLDJDQUFnQzs7Ozs7SUFDaEMsMkNBQXVDOzs7OztJQUN2Qyx3Q0FBK0I7O0FBbVFuQyxNQUFNLE9BQU8sd0JBQXdCO0lBQ25DLGdCQUFnQixDQUFDOzs7OztJQUVqQixTQUFTLENBQUMsSUFBVztRQUNuQixJQUFJLElBQUksSUFBSSxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUMzQixPQUFPLE9BQU8sQ0FBQztTQUNoQjthQUFNO1lBQ0wsT0FBTyxPQUFPLENBQUM7U0FDaEI7SUFDSCxDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgSG9zdEJpbmRpbmcsIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBJbnB1dCwgVmlld0NoaWxkLCBUZW1wbGF0ZVJlZiwgSW5qZWN0b3IsIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZENvbXBvbmVudCB9IGZyb20gJ0BmYXJyaXMvdWktZGF0YWdyaWQnO1xyXG5pbXBvcnQgeyBNZXNzYWdlclNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW1lc3NhZ2VyJztcclxuaW1wb3J0IHsgVHlwZUNvbnZlcnRlciB9IGZyb20gJ0BmYXJyaXMvdWktcHJvcGVydHktcGFuZWwnO1xyXG5pbXBvcnQgeyBCc01vZGFsU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbW9kYWwnO1xyXG5pbXBvcnQgeyBQcm9jZXNzVmFyaWFibGVzQ29tcG9uZW50IH0gZnJvbSAnLi4vcHJvY2Vzcy12YXJpYWJsZXMvcHJvY2Vzcy12YXJpYWJsZXMuY29tcG9uZW50JztcclxuaW1wb3J0IHsgUHJvY2Vzc0Rlc2lnbmVyVUlTdGF0ZSB9IGZyb20gJy4uLy4uL2FwcC9wcm9jZXNzLWRlc2lnbmVyLnVpc3RhdGUnO1xyXG5pbXBvcnQgeyBWYXJpYWJsZVNldHRpbmcgfSBmcm9tICcuL3ZhcmlhYmxlLXNldHRpbmcnO1xyXG5pbXBvcnQgeyBFZGl0b3JUeXBlcyB9IGZyb20gJ0BmYXJyaXMvdWktZGF0YWdyaWQtZWRpdG9ycyc7XHJcbmltcG9ydCB7IEV4cHJFZGl0TW9kZSwgRXhwcmVzc2lvblNlcnZpY2UsIEluamVjdGVkVHlwZSB9IGZyb20gJ0Bnc3Atc3ZjL2V4cHJlc3Npb24nO1xyXG5pbXBvcnQgeyBDb21wb25lbnRFZGl0Q29tcG9uZW50IH0gZnJvbSAnLi92aWV3cy9jb21wb25lbnQtZWRpdC9jb21wb25lbnQtZWRpdC5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBSb3dFZGl0UGFyYW0gfSBmcm9tICdAZmFycmlzL3VpLWRhdGFncmlkL2xpYi90eXBlcyc7XHJcbmltcG9ydCB7IG9mIH0gZnJvbSAncnhqcyc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ2xpYi12YXJpYWJsZS1zZXR0aW5nJyxcclxuICB0ZW1wbGF0ZVVybDogJy4vdmFyaWFibGUtc2V0dGluZy5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vdmFyaWFibGUtc2V0dGluZy5jb21wb25lbnQuc2NzcyddXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBWYXJpYWJsZVNldHRpbmdDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG4gIEBIb3N0QmluZGluZygnY2xhc3MnKVxyXG4gIGNscyA9ICdmYXJyaXMtbWFpbi1hcmVhIGZsZXgtY29sdW1uJztcclxuICBAT3V0cHV0KCkgY2xvc2VNb2RhbCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG4gIEBPdXRwdXQoKSBzdWJtaXRNb2RhbCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG5cclxuICBASW5wdXQoKSB2YWx1ZTogQXJyYXk8VmFyaWFibGVTZXR0aW5nPiA9IG5ldyBBcnJheSgpO1xyXG4gIEBJbnB1dCgpIGVkaXRvclBhcmFtczogYW55ID0ge307XHJcbiAgQFZpZXdDaGlsZCgnaWNvblNlbGVjdEZvb3RlcicpIG1vZGFsRm9vdGVyOiBUZW1wbGF0ZVJlZjxhbnk+O1xyXG4gIEBWaWV3Q2hpbGQoJ2dyaWQnKSBncmlkOiBEYXRhZ3JpZENvbXBvbmVudDtcclxuICBAVmlld0NoaWxkKCdjZWxsJykgY2VsbDogVGVtcGxhdGVSZWY8YW55PjtcclxuXHJcbiAgY29sdW1ucyA9IFtdO1xyXG5cclxuICBwcml2YXRlIHRhZ3MgPSBbXHJcbiAgICB7IHZhbHVlOiAnY29uc3RhbnQnLCB0ZXh0OiAn5bi46YePJyB9LFxyXG4gICAgeyB2YWx1ZTogJ2V4cHJlc3Npb24nLCB0ZXh0OiAn6KGo6L6+5byPJyB9LFxyXG4gICAgeyB2YWx1ZTogJ2NvbXBvbmVudCcsIHRleHQ6ICfmnoTku7YnIH1cclxuICBdO1xyXG5cclxuICBwcml2YXRlIG9wcG9ydHVuaXRpZXMgPSBbXHJcbiAgICB7IHZhbHVlOiAnQUNUSVZJVFlfU1RBUlRFRCcsIHRleHQ6ICfmtLvliqjlvIDlp4snIH0sXHJcbiAgICB7IHZhbHVlOiAnQUNUSVZJVFlfQ09NUExFVEVEJywgdGV4dDogJ+a0u+WKqOe7k+adnycgfVxyXG4gIF07XHJcblxyXG4gIG1vZGFsQ29uZmlnID0ge1xyXG4gICAgdGl0bGU6ICflj5jph4/orr7nva4nLFxyXG4gICAgd2lkdGg6IDc4MCxcclxuICAgIGhlaWdodDogNDYwLFxyXG4gICAgc2hvd0J1dHRvbnM6IHRydWVcclxuICB9O1xyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgcmVzb2x2ZXI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcclxuICAgIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yLFxyXG4gICAgcHJpdmF0ZSBtb2RhbFNlcnZpY2U6IEJzTW9kYWxTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBtZXNzYWdlOiBNZXNzYWdlclNlcnZpY2UsXHJcbiAgICBwcml2YXRlIHVpc3RhdGU6IFByb2Nlc3NEZXNpZ25lclVJU3RhdGUsXHJcbiAgICBwcml2YXRlIGV4cHI6IEV4cHJlc3Npb25TZXJ2aWNlXHJcbiAgKSB7IH1cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICB0aGlzLmNvbHVtbnMgPSBbXHJcbiAgICAgIHtcclxuICAgICAgICBmaWVsZDogJ3ZhcmlhYmxlQ29kZScsIHdpZHRoOiA5MCwgdGl0bGU6ICflj5jph4/nvJblj7cnLCBzb3J0YWJsZTogdHJ1ZSxcclxuICAgICAgICB2YWxpZGF0b3JzOiBbXHJcbiAgICAgICAgICB7IHR5cGU6ICdyZXF1aXJlZCcsIG1lc3NhZ2VyOiAn5b+F5aGrJyB9XHJcbiAgICAgICAgXVxyXG4gICAgICB9LFxyXG4gICAgICB7XHJcbiAgICAgICAgZmllbGQ6ICd2YXJpYWJsZU5hbWUnLCB3aWR0aDogOTAsIHRpdGxlOiAn5Y+Y6YeP5ZCN56ewJywgc29ydGFibGU6IHRydWUsXHJcbiAgICAgICAgdmFsaWRhdG9yczogW1xyXG4gICAgICAgICAgeyB0eXBlOiAncmVxdWlyZWQnLCBtZXNzYWdlcjogJ+W/heWhqycgfVxyXG4gICAgICAgIF1cclxuICAgICAgfSwge1xyXG4gICAgICAgIGZpZWxkOiAndGFnJywgd2lkdGg6IDYwLCB0aXRsZTogJ+WAvOexu+WeiycsIHNvcnRhYmxlOiB0cnVlLFxyXG4gICAgICAgIGZvcm1hdHRlcjoge1xyXG4gICAgICAgICAgdHlwZTogJ2VudW0nLFxyXG4gICAgICAgICAgb3B0aW9uczogeyB2YWx1ZUZpZWxkOiAndmFsdWUnLCB0ZXh0RmllbGQ6ICd0ZXh0JywgZGF0YTogdGhpcy50YWdzIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIGVkaXRvcjoge1xyXG4gICAgICAgICAgdHlwZTogRWRpdG9yVHlwZXMuQ09NQk9MSVNULFxyXG4gICAgICAgICAgb3B0aW9uczoge1xyXG4gICAgICAgICAgICB2YWx1ZUZpZWxkOiAndmFsdWUnLCB0ZXh0RmllbGQ6ICd0ZXh0JywgZGF0YTogdGhpcy50YWdzLCBpZEZpZWxkOiAndmFsdWUnLCBwYW5lbEhlaWdodDogJ2F1dG8nLCBzaG93Q2xlYXI6IGZhbHNlLFxyXG4gICAgICAgICAgICBzZWxlY3RDaGFuZ2U6IChlKSA9PiB7XHJcbiAgICAgICAgICAgICAgdGhpcy52YWx1ZSA9IHRoaXMudmFsdWUubWFwKHYgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHYudmFyaWFibGVDb2RlID09PSBlLnJvd0lkKSB7XHJcbiAgICAgICAgICAgICAgICAgIHYudmFsdWUgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICB2LnZhbHVlVGV4dCA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgIGlmICh2LmNvbXBvbmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHYuY29tcG9uZW50ID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICByZXR1cm4gdjtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgIHJldHVybiB2O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICB2YWxpZGF0b3JzOiBbXHJcbiAgICAgICAgICB7IHR5cGU6ICdyZXF1aXJlZCcsIG1lc3NhZ2VyOiAn5b+F5aGrJyB9XHJcbiAgICAgICAgXVxyXG4gICAgICB9LCB7XHJcbiAgICAgICAgZmllbGQ6ICdleGVjdXRpb25UaW1lJywgd2lkdGg6IDgwLCB0aXRsZTogJ+aJp+ihjOaXtuacuicsIHNvcnRhYmxlOiB0cnVlLFxyXG4gICAgICAgIGZvcm1hdHRlcjoge1xyXG4gICAgICAgICAgdHlwZTogJ2VudW0nLFxyXG4gICAgICAgICAgb3B0aW9uczogeyB2YWx1ZUZpZWxkOiAndmFsdWUnLCB0ZXh0RmllbGQ6ICd0ZXh0JywgZGF0YTogdGhpcy5vcHBvcnR1bml0aWVzIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIGVkaXRvcjoge1xyXG4gICAgICAgICAgdHlwZTogRWRpdG9yVHlwZXMuQ09NQk9MSVNULFxyXG4gICAgICAgICAgb3B0aW9uczoge1xyXG4gICAgICAgICAgICB2YWx1ZUZpZWxkOiAndmFsdWUnLCB0ZXh0RmllbGQ6ICd0ZXh0JywgZGF0YTogdGhpcy5vcHBvcnR1bml0aWVzLCBpZEZpZWxkOiAndmFsdWUnLCBwYW5lbEhlaWdodDogJ2F1dG8nLCBzaG93Q2xlYXI6IGZhbHNlLFxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdmFsaWRhdG9yczogW1xyXG4gICAgICAgICAgeyB0eXBlOiAncmVxdWlyZWQnLCBtZXNzYWdlcjogJ+W/heWhqycgfVxyXG4gICAgICAgIF0sXHJcbiAgICAgIH0sXHJcbiAgICAgIHtcclxuICAgICAgICBmaWVsZDogJ3ZhbHVlVGV4dCcsIHdpZHRoOiAxNTAsIHRpdGxlOiAn5Y+Y6YeP5YC8Jywgc2hvd1RpcHM6IHRydWUsXHJcbiAgICAgICAgZWRpdG9yOiB7IHR5cGU6IEVkaXRvclR5cGVzLlRFWFRCT1gsIG9wdGlvbnM6IHt9IH0sXHJcbiAgICAgICAgdmFsaWRhdG9yczogW1xyXG4gICAgICAgICAgeyB0eXBlOiAncmVxdWlyZWQnLCBtZXNzYWdlcjogJ+W/heWhqycgfVxyXG4gICAgICAgIF1cclxuICAgICAgfVxyXG4gICAgXTtcclxuICB9XHJcblxyXG4gIGFkZCgpIHtcclxuICAgIGxldCBkaWFsb2c6IGFueTtcclxuICAgIGNvbnN0IGNvbXBGYWN0b3J5ID0gdGhpcy5yZXNvbHZlci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShQcm9jZXNzVmFyaWFibGVzQ29tcG9uZW50KTtcclxuICAgIGNvbnN0IGNvbXBSZWYgPSBjb21wRmFjdG9yeS5jcmVhdGUodGhpcy5pbmplY3Rvcik7XHJcbiAgICBjb21wUmVmLmluc3RhbmNlLnZhcmlhYmxlU2V0dGluZyA9IHRydWU7XHJcbiAgICBjb21wUmVmLmluc3RhbmNlLnZhbHVlID0gdGhpcy51aXN0YXRlLlByb2Nlc3NWYXJpYWJsZXM7XHJcbiAgICBjb21wUmVmLmluc3RhbmNlLnZhcmlhYmxlU2V0RW1pdHRlci5zdWJzY3JpYmUoKHJlOiBhbnlbXSkgPT4ge1xyXG4gICAgICBmb3IgKGNvbnN0IHYgb2YgcmUpIHtcclxuICAgICAgICBjb25zdCB2YXJpYWJsZVNldCA9IG5ldyBWYXJpYWJsZVNldHRpbmcoKTtcclxuICAgICAgICB2YXJpYWJsZVNldC52YXJpYWJsZUNvZGUgPSB2LmRhdGEubmFtZTtcclxuICAgICAgICB2YXJpYWJsZVNldC52YXJpYWJsZU5hbWUgPSB2LmRhdGEuZG9jdW1lbnRhdGlvbjtcclxuICAgICAgICB2YXJpYWJsZVNldC50YWcgPSB2LmRhdGEudGFnIHx8IHRoaXMudGFnc1swXS52YWx1ZTtcclxuICAgICAgICB2YXJpYWJsZVNldC5leGVjdXRpb25UaW1lID0gdi5kYXRhLmV4ZWN1dGlvblRpbWUgfHwgdGhpcy5vcHBvcnR1bml0aWVzWzBdLnZhbHVlO1xyXG4gICAgICAgIGlmICh0aGlzLnZhbHVlLmZpbmRJbmRleChpID0+IGkudmFyaWFibGVDb2RlID09PSB2YXJpYWJsZVNldC52YXJpYWJsZUNvZGUpID09PSAtMSkge1xyXG4gICAgICAgICAgdGhpcy52YWx1ZSA9IHRoaXMudmFsdWUuY29uY2F0KFt2YXJpYWJsZVNldF0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBkaWFsb2cuY2xvc2UoKTtcclxuICAgIH0pO1xyXG4gICAgY29tcFJlZi5pbnN0YW5jZS5jbG9zZU1vZGFsLnN1YnNjcmliZShyZSA9PiB7XHJcbiAgICAgIGRpYWxvZy5jbG9zZSgpO1xyXG4gICAgfSk7XHJcbiAgICBjb25zdCBtb2RhbENvbmZpZyA9IHtcclxuICAgICAgdGl0bGU6ICfmtYHnqIvlj5jph48nLFxyXG4gICAgICB3aWR0aDogNjYwLFxyXG4gICAgICBoZWlnaHQ6IDQ2MCxcclxuICAgICAgc2hvd0J1dHRvbnM6IHRydWUsXHJcbiAgICAgIGJ1dHRvbnM6IGNvbXBSZWYuaW5zdGFuY2UubW9kYWxGb290ZXJcclxuICAgIH07XHJcbiAgICBkaWFsb2cgPSB0aGlzLm1vZGFsU2VydmljZS5zaG93KGNvbXBSZWYsIG1vZGFsQ29uZmlnKTtcclxuICB9XHJcblxyXG4gIGRlbGV0ZSgpIHtcclxuICAgIHRoaXMuZ3JpZC5lbmRDZWxsRWRpdCgpO1xyXG4gICAgY29uc3Qgc2VsZWN0ZWQgPSB0aGlzLmdyaWQuc2VsZWN0ZWRSb3c7XHJcbiAgICBpZiAoIXNlbGVjdGVkKSB7XHJcbiAgICAgIHRoaXMubWVzc2FnZS5pbmZvKCflsJrmnKrpgInkuK3lj5jph4/vvIEnKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy52YWx1ZSA9IHRoaXMudmFsdWUuZmlsdGVyKHYgPT4gdi52YXJpYWJsZUNvZGUgIT09IHNlbGVjdGVkLmRhdGEudmFyaWFibGVDb2RlKTtcclxuICB9XHJcblxyXG4gIGNsaWNrT0soKSB7XHJcbiAgICB0aGlzLmdyaWQuZW5kQ2VsbEVkaXQoKTtcclxuICAgIGlmICh0aGlzLnZhbGlkYXRvcigpKSB7XHJcbiAgICAgIGNvbnN0IG9iamVjdCA9IHsgdmFsdWU6IHRoaXMudmFsdWUsIHBhcmFtZXRlcnM6IG51bGwgfTtcclxuICAgICAgdGhpcy5zdWJtaXRNb2RhbC5lbWl0KG9iamVjdCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBjbGlja0NhbmNlbCgpIHtcclxuICAgIHRoaXMuY2xvc2VNb2RhbC5lbWl0KCk7XHJcbiAgfVxyXG5cclxuICB2YWxpZGF0b3IoKSB7XHJcbiAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgdGhpcy52YWx1ZSkge1xyXG4gICAgICBpZiAoIWl0ZW0udmFsdWUpIHtcclxuICAgICAgICB0aGlzLm1lc3NhZ2Uud2FybmluZygn5Y+Y6YeP5YC85LiN5YWB6K645Li656m677yBJyk7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcbiAgYmVmb3JlRWRpdCA9IChwYXJhbTogUm93RWRpdFBhcmFtKSA9PiB7XHJcbiAgICBjb25zdCByb3dEYXRhID0gcGFyYW0ucm93RGF0YSBhcyBhbnk7XHJcbiAgICBjb25zdCBjb2x1bW4gPSBwYXJhbS5jb2x1bW47XHJcbiAgICBpZiAoY29sdW1uLmZpZWxkID09PSAndmFsdWVUZXh0Jykge1xyXG4gICAgICBpZiAoKHJvd0RhdGEgYXMgVmFyaWFibGVTZXR0aW5nKS50YWcgPT09IHRoaXMudGFnc1swXS52YWx1ZSkge1xyXG4gICAgICAgIHBhcmFtLmNvbHVtbi5lZGl0b3IgPSB7IHR5cGU6IEVkaXRvclR5cGVzLlRFWFRCT1gsIG9wdGlvbnM6IHt9IH07XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcGFyYW0uY29sdW1uLmVkaXRvciA9IHtcclxuICAgICAgICAgIHR5cGU6ICdpbnB1dC1ncm91cCcsXHJcbiAgICAgICAgICBvcHRpb25zOiB7XHJcbiAgICAgICAgICAgIGdyb3VwVGV4dDogJzxpIGNsYXNzPVwiZi1pY29uIGYtaWNvbi1sb29rdXBcIj48L2k+JyxcclxuICAgICAgICAgICAgZWRpdGFibGU6IGZhbHNlLFxyXG4gICAgICAgICAgICBzaG93Q2xlYXI6IGZhbHNlLFxyXG4gICAgICAgICAgICBjbGlja0hhbmRsZTogKGUpID0+IHtcclxuICAgICAgICAgICAgICBlLmZvcm1Db250cm9sLnNldFZhbHVlKGUuaW5zdGFuY2UudmFsdWUgPyBlLmluc3RhbmNlLnZhbHVlIDogJycpO1xyXG4gICAgICAgICAgICAgIHRoaXMudmFsdWVFZGl0KGUpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBjbGVhcjogKGUpID0+IHtcclxuICAgICAgICAgICAgICBjb25zb2xlLmxvZygnY2xlYXInLCBlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBvZih0cnVlKTtcclxuICB9XHJcblxyXG4gIGVuZEVkaXQoZGF0YTogYW55KSB7XHJcbiAgICBpZiAoZGF0YS5jb2x1bW4uZmllbGQgPT09ICd2YWx1ZVRleHQnICYmIGRhdGEucm93RGF0YS50YWcgPT09IHRoaXMudGFnc1swXS52YWx1ZSkge1xyXG4gICAgICBkYXRhLnJvd0RhdGEudmFsdWUgPSBkYXRhLnJvd0RhdGEudmFsdWVUZXh0O1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgdmFsdWVFZGl0KGU6IGFueSkge1xyXG4gICAgY29uc3Qgcm93ZGF0YTogVmFyaWFibGVTZXR0aW5nID0gZS5yb3dEYXRhO1xyXG4gICAgc3dpdGNoIChyb3dkYXRhLnRhZykge1xyXG4gICAgICBjYXNlIHRoaXMudGFnc1sxXS52YWx1ZTpcclxuICAgICAgICB0aGlzLmVkaXRFeHByZXNzaW9uKGUpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlIHRoaXMudGFnc1syXS52YWx1ZTpcclxuICAgICAgICB0aGlzLmVkaXRDb21wb25lbnQoZSk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGVkaXRFeHByZXNzaW9uKGU6IGFueSkge1xyXG4gICAgY29uc3QgZGF0YTogVmFyaWFibGVTZXR0aW5nID0gZS5yb3dEYXRhO1xyXG4gICAgaWYgKHRoaXMudWlzdGF0ZS5zY2hlbWFzLmxlbmd0aCA+IDApIHtcclxuICAgICAgZm9yIChjb25zdCBzY2hlbWEgb2YgdGhpcy51aXN0YXRlLnNjaGVtYXMpIHtcclxuICAgICAgICB0aGlzLmV4cHIuYWRkU2NoZW1hKCdTY2hlbWEnLCBzY2hlbWEpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICh0aGlzLnVpc3RhdGUuc2NoZW1hc1swXS5lbnRpdHlUeXBlcyAmJiB0aGlzLnVpc3RhdGUuc2NoZW1hc1swXS5lbnRpdHlUeXBlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgY29uc3QgZW50aXR5VHlwZSA9IHRoaXMudWlzdGF0ZS5zY2hlbWFzWzBdLmVudGl0eVR5cGVzWzBdO1xyXG4gICAgICAgIHRoaXMuZXhwci5hZGRJbmplY3RlZEVudGl0eShlbnRpdHlUeXBlLm5hbWUsICdTY2hlbWEnLFxyXG4gICAgICAgICAgZW50aXR5VHlwZS5uYW1lLCBJbmplY3RlZFR5cGUuRW50aXR5VHlwZSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGNvbnN0IGNvbnRleHQgPSBuZXcgQXJyYXkoKTtcclxuICAgIGlmICh0aGlzLnVpc3RhdGUucHJvY0luc3RDb250ZXh0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgZm9yIChjb25zdCB2YXJpYWJsZSBvZiB0aGlzLnVpc3RhdGUucHJvY0luc3RDb250ZXh0KSB7XHJcbiAgICAgICAgY29udGV4dC5wdXNoKHZhcmlhYmxlKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMudWlzdGF0ZS5mb3JtYWxQYXJhbWV0ZXJDb250ZXh0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgZm9yIChjb25zdCB2YXJpYWJsZSBvZiB0aGlzLnVpc3RhdGUuZm9ybWFsUGFyYW1ldGVyQ29udGV4dCkge1xyXG4gICAgICAgIGlmICghY29udGV4dC5zb21lKGMgPT4gYy5rZXkgPT09IHZhcmlhYmxlLmtleSkpIHtcclxuICAgICAgICAgIGNvbnRleHQucHVzaCh2YXJpYWJsZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy51aXN0YXRlLnBhcnRpY2lwYW50Q29udGV4dC5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGZvciAoY29uc3QgdmFyaWFibGUgb2YgdGhpcy51aXN0YXRlLnBhcnRpY2lwYW50Q29udGV4dCkge1xyXG4gICAgICAgIGlmICghY29udGV4dC5zb21lKGMgPT4gYy5rZXkgPT09IHZhcmlhYmxlLmtleSkpIHtcclxuICAgICAgICAgIGNvbnRleHQucHVzaCh2YXJpYWJsZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy51aXN0YXRlLnByb2Nlc3NWYXJpYWJsZUNvbnRleHQubGVuZ3RoID4gMCkge1xyXG4gICAgICBmb3IgKGNvbnN0IHZhcmlhYmxlIG9mIHRoaXMudWlzdGF0ZS5wcm9jZXNzVmFyaWFibGVDb250ZXh0KSB7XHJcbiAgICAgICAgaWYgKCFjb250ZXh0LnNvbWUoYyA9PiBjLmtleSA9PT0gdmFyaWFibGUua2V5KSkge1xyXG4gICAgICAgICAgY29udGV4dC5wdXNoKHZhcmlhYmxlKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGlmIChjb250ZXh0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgZm9yIChjb25zdCB2IG9mIGNvbnRleHQpIHtcclxuICAgICAgICB0aGlzLmV4cHIuYWRkQ29udGV4dCh2KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgdGhpcy5leHByLnNldEVkaXRQYXR0ZXJuKEV4cHJFZGl0TW9kZS5BZHZhbmNlZCk7IC8vIOihqOi+vuW8j+WxleeOsOaooeW8j++8mum7mOiupOmrmOe6p+eJiFxyXG4gICAgdGhpcy5leHByLmFkZEV4cHJlc3Npb25UZXh0KGRhdGEudmFsdWUpO1xyXG4gICAgdGhpcy5leHByLmJ1aWxkRXhwcmVzc2lvbigpLnRoZW4oKHJlOiBzdHJpbmcpID0+IHtcclxuICAgICAgZS5mb3JtQ29udHJvbC5zZXRWYWx1ZShyZSk7XHJcbiAgICAgIGUuaW5zdGFuY2UuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICBkYXRhLnZhbHVlID0gcmU7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZWRpdENvbXBvbmVudChlOiBhbnkpIHtcclxuICAgIGNvbnN0IGRhdGE6IFZhcmlhYmxlU2V0dGluZyA9IGUucm93RGF0YTtcclxuICAgIGxldCBkaWFsb2c6IGFueTtcclxuICAgIGNvbnN0IGNvbXBGYWN0b3J5ID0gdGhpcy5yZXNvbHZlci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShDb21wb25lbnRFZGl0Q29tcG9uZW50KTtcclxuICAgIGNvbnN0IGNvbXBSZWYgPSBjb21wRmFjdG9yeS5jcmVhdGUodGhpcy5pbmplY3Rvcik7XHJcbiAgICBjb21wUmVmLmluc3RhbmNlLmNvbXBvbmVudCA9IGRhdGEuY29tcG9uZW50O1xyXG4gICAgY29tcFJlZi5pbnN0YW5jZS5zdWJtaXRFbWl0dGVyLnN1YnNjcmliZSgocmU6IGFueSkgPT4ge1xyXG4gICAgICBlLmZvcm1Db250cm9sLnNldFZhbHVlKHJlLk5hbWUgKyAnLScgKyByZS5NZXRob2RDb2RlKTtcclxuICAgICAgZS5pbnN0YW5jZS5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgIGRhdGEudmFsdWUgPSByZS5JZDtcclxuICAgICAgZGF0YS5jb21wb25lbnQgPSByZTtcclxuICAgICAgZGlhbG9nLmNsb3NlKCk7XHJcbiAgICB9KTtcclxuICAgIGNvbXBSZWYuaW5zdGFuY2UuY2xvc2VFbWl0dGVyLnN1YnNjcmliZShyZSA9PiB7XHJcbiAgICAgIGRpYWxvZy5jbG9zZSgpO1xyXG4gICAgfSk7XHJcbiAgICBjb25zdCBtb2RhbENvbmZpZyA9IHtcclxuICAgICAgdGl0bGU6ICfmnoTku7YnLFxyXG4gICAgICB3aWR0aDogODAwLFxyXG4gICAgICBoZWlnaHQ6IDUxNSxcclxuICAgICAgc2hvd0J1dHRvbnM6IHRydWUsXHJcbiAgICAgIGJ1dHRvbnM6IGNvbXBSZWYuaW5zdGFuY2UuZm9vdGVyXHJcbiAgICB9O1xyXG4gICAgZGlhbG9nID0gdGhpcy5tb2RhbFNlcnZpY2Uuc2hvdyhjb21wUmVmLCBtb2RhbENvbmZpZyk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgVmFyaWFibGVTZXR0aW5nQ29udmVydGVyIGltcGxlbWVudHMgVHlwZUNvbnZlcnRlciB7XHJcbiAgY29uc3RydWN0b3IoKSB7IH1cclxuXHJcbiAgY29udmVydFRvKGRhdGE6IGFueVtdKTogc3RyaW5nIHtcclxuICAgIGlmIChkYXRhICYmIGRhdGEubGVuZ3RoID4gMCkge1xyXG4gICAgICByZXR1cm4gJ++8iOW3suiuvue9ru+8iSc7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gJ++8iOacquiuvue9ru+8iSc7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcbiJdfQ==