!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/platform-browser"),require("rxjs/observable/forkJoin"),require("rxjs/observable/of"),require("rxjs/ReplaySubject"),require("@gsp-cmp/wscmp-models"),require("rxjs/Subject"),require("@farris/lookup-config"),require("@angular/router"),require("@angular/forms"),require("@gsp-cmp/ccmp-ui"),require("@gsp-sys/sysmgr-ui"),require("@gsp-sys/rtf-ui"),require("@farris/ui-treetable"),require("@farris/ui-property-panel"),require("@farris/ui-datatable"),require("@farris/ui-layout"),require("@farris/ui-splitter"),require("@farris/ui-flex-layout"),require("@farris/ui-panel"),require("@farris/ui-responsive"),require("@farris/ui-popover"),require("@farris/ui-pagination"),require("@farris/ui-dropdown"),require("@farris/ui-wizard"),require("@farris/ui-perfect-scrollbar"),require("@gsp-svc/expression"),require("@gsp-wf/wf-bizprocess-lookup"),require("@farris/ui-number-spinner"),require("rxjs"),require("rxjs/operators"),require("@farris/ui-button"),require("@angular/common"),require("@angular/common/http"),require("@ecp-caf/caf-common"),require("@gsp-sys/rtf-common"),require("@gsp-lcm/bo-rt-service"),require("@farris/ui-response-toolbar"),require("@farris/ui-list-filter"),require("@farris/ui-draggable"),require("@farris/ui-common"),require("@farris/ui-forms"),require("@farris/ui-section"),require("@farris/ui-datagrid-editors"),require("@farris/ui-datagrid"),require("@farris/ui-combo-list"),require("@farris/ui-input-group"),require("@farris/ui-dialog"),require("@farris/ui-switch"),require("@farris/ui-tabs"),require("@farris/ui-lookup"),require("@farris/ui-loading"),require("@farris/ui-messager"),require("@farris/ui-notify"),require("@gsp-lcm/metadatart-selector"),require("@farris/ui-modal"),require("@edp-bif/common-api"),require("@gsp-bef/gsp-cm-metadata"),require("@angular/core")):"function"==typeof define&&define.amd?define("@gsp-wf/wf-process-editor",["exports","@angular/platform-browser","rxjs/observable/forkJoin","rxjs/observable/of","rxjs/ReplaySubject","@gsp-cmp/wscmp-models","rxjs/Subject","@farris/lookup-config","@angular/router","@angular/forms","@gsp-cmp/ccmp-ui","@gsp-sys/sysmgr-ui","@gsp-sys/rtf-ui","@farris/ui-treetable","@farris/ui-property-panel","@farris/ui-datatable","@farris/ui-layout","@farris/ui-splitter","@farris/ui-flex-layout","@farris/ui-panel","@farris/ui-responsive","@farris/ui-popover","@farris/ui-pagination","@farris/ui-dropdown","@farris/ui-wizard","@farris/ui-perfect-scrollbar","@gsp-svc/expression","@gsp-wf/wf-bizprocess-lookup","@farris/ui-number-spinner","rxjs","rxjs/operators","@farris/ui-button","@angular/common","@angular/common/http","@ecp-caf/caf-common","@gsp-sys/rtf-common","@gsp-lcm/bo-rt-service","@farris/ui-response-toolbar","@farris/ui-list-filter","@farris/ui-draggable","@farris/ui-common","@farris/ui-forms","@farris/ui-section","@farris/ui-datagrid-editors","@farris/ui-datagrid","@farris/ui-combo-list","@farris/ui-input-group","@farris/ui-dialog","@farris/ui-switch","@farris/ui-tabs","@farris/ui-lookup","@farris/ui-loading","@farris/ui-messager","@farris/ui-notify","@gsp-lcm/metadatart-selector","@farris/ui-modal","@edp-bif/common-api","@gsp-bef/gsp-cm-metadata","@angular/core"],t):t((e["gsp-wf"]=e["gsp-wf"]||{},e["gsp-wf"]["wf-process-editor"]={}),e.ng.platformBrowser,e.rxjs["observable/forkJoin"],e.rxjs["observable/of"],e.rxjs.ReplaySubject,e.wscmpModels,e.rxjs.Subject,e.lookupConfig,e.ng.router,e.ng.forms,e.ccmpUi,e.sysmgrUi,e.rtfUi,e.uiTreetable,e.uiPropertyPanel,e.uiDatatable,e.uiLayout,e.uiSplitter,e.uiFlexLayout,e.uiPanel,e.uiResponsive,e.uiPopover,e.uiPagination,e.uiDropdown,e.uiWizard,e.uiPerfectScrollbar,e.expression,e.wfBizprocessLookup,e.uiNumberSpinner,e.rxjs,e.rxjs.operators,e.uiButton,e.ng.common,e.ng.common.http,e.cafCommon,e.rtfCommon,e.boRtService,e.uiResponseToolbar,e.uiListFilter,e.uiDraggable,e.uiCommon,e.uiForms,e.uiSection,e.uiDatagridEditors,e.uiDatagrid,e.uiComboList,e.uiInputGroup,e.uiDialog,e.uiSwitch,e.uiTabs,e.uiLookup,e.uiLoading,e.uiMessager,e.uiNotify,e.metadatartSelector,e.uiModal,e.commonApi,e.gspCmMetadata,e.ng.core)}(this,function(e,t,n,r,i,f,a,o,s,l,c,d,p,u,h,m,v,y,g,b,x,w,C,I,S,k,J,E,P,T,F,A,M,D,O,V,L,N,B,R,z,H,j,U,q,G,K,_,W,$,X,Z,Y,Q,ee,te,re,ie,ne){"use strict";var ae=(oe.decorators=[{type:ne.Injectable,args:[{providedIn:"root"}]}],oe.ctorParameters=function(){return[]},oe.ngInjectableDef=ne.defineInjectable({factory:function(){return new oe},token:oe,providedIn:"root"}),oe);function oe(){}var se={dt:"dt",rt:"rt"},le=function(e,t){return(le=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)};function ce(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}le(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var de=function(){return(de=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};function pe(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],i=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function ue(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,a=r.call(e),o=[];try{for(;(void 0===t||0<t--)&&!(i=a.next()).done;)o.push(i.value)}catch(s){n={error:s}}finally{try{i&&!i.done&&(r=a["return"])&&r.call(a)}finally{if(n)throw n.error}}return o}function fe(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(ue(arguments[t]));return e}var he=function ms(){},me=(Object.defineProperty(ve.prototype,"ProcessVariables",{get:function(){return this.processVariables},set:function(e){this.processVariables=e,this.setProcessVariableContext()},enumerable:!0,configurable:!0}),ve.prototype.variableContextName=function(t){return this.participantContext.find(function(e){return e.key===t}).name},ve.prototype.ranksName=function(t){return this.dimensions.find(function(e){return e.value===t}).text},ve.prototype.getMessageChannels=function(){var t=this;this.http.get("/api/runtime/sys/v1.0/messageplatform/channel/getenabledchannels").subscribe(function(e){t.messageChannels=e})},ve.prototype.getAdministratorInfo=function(){var f=this;this.getCurrentUser().subscribe(function(e){var t=e.userId;T.forkJoin(f.getAdministratorConfig(),f.getAdministrator(t)).subscribe(function(e){f.isAdministratorConfig="true"===e[0].currentValue,f.administrator=e[1],f.isAdministratorConfig&&f.administrator&&f.administrator.enable&&T.forkJoin(f.administrator.administratorAuthorities.map(function(e){return e.includeSubordinate?f.getSysOrgWithAllSubsById(e.organization):f.getSysOrgById(e.organization)})).subscribe(function(e){var t,r,i,n;if(e&&0<e.length){f.organizations=new Array;try{for(var a=pe(e),o=a.next();!o.done;o=a.next()){var s=o.value;if(s&&0<s.length){var l=function(t){f.organizations.some(function(e){return e.id===t.id})||f.organizations.push(t)};try{for(var c=pe(s),d=c.next();!d.done;d=c.next())l(d.value)}catch(p){i={error:p}}finally{try{d&&!d.done&&(n=c["return"])&&n.call(c)}finally{if(i)throw i.error}}}}}catch(u){t={error:u}}finally{try{o&&!o.done&&(r=a["return"])&&r.call(a)}finally{if(t)throw t.error}}}})})})},ve.prototype.getCurrentUser=function(){return this.http.get("/api/runtime/sys/v1.0/userinfos?infoType=user")},ve.prototype.getAdministrator=function(e){var t="/api/runtime/wf/v1.0/processAdministrator/"+e;return this.http.get(t)},ve.prototype.getAdministratorConfig=function(){return this.http.get("/api/runtime/wf/v1.0/generalConfig/Is_EnableAdministrator")},ve.prototype.getSysOrgById=function(e){var t="/api/runtime/sys/v1.0/sysOrgs/"+e;return this.http.get(t)},ve.prototype.getSysOrgWithAllSubsById=function(e){var t="/api/runtime/sys/v1.0/sysOrgs?param="+encodeURIComponent('{"parentId":"'+e+'","withAllSub":true}');return this.http.get(t)},ve.prototype.getCurUserInfo=function(e){var t="/api/runtime/sys/v1.0/users/"+e;return this.http.get(t)},ve.prototype.setProcessVariableContext=function(){var e,t;if(this.processVariableContext=new Array,this.ProcessVariables&&0<this.ProcessVariables.length)try{for(var r=pe(this.ProcessVariables),i=r.next();!i.done;i=r.next()){var n=i.value,a={key:n.name,name:n.documentation,description:n.description};this.processVariableContext.push(a)}}catch(o){e={error:o}}finally{try{i&&!i.done&&(t=r["return"])&&t.call(r)}finally{if(e)throw e.error}}},ve.prototype.getTopWindow=function(){var e=window.self;try{for(;e.location.origin===e.parent.location.origin&&e!==e.parent&&!e.isRTFTopWin;)e=e.parent}catch(t){}return e},ve.prototype.initUIState=function(){this.propertyConfig=[],this.propertyData=null,this.content="",this.schemas=[]},ve.prototype.getUserActList=function(e){var t,r;if(this.userActList=[],e&&0<e.length)try{for(var i=pe(e),n=i.next();!n.done;n=i.next()){var a=n.value,o={Id:a.Id,Name:a.Name};this.userActList.push(o)}}catch(s){t={error:s}}finally{try{n&&!n.done&&(r=i["return"])&&r.call(i)}finally{if(t)throw t.error}}},ve.prototype.getEndEventList=function(e){var t,r;if(this.allActList=[],e&&0<e.length)try{for(var i=pe(e),n=i.next();!n.done;n=i.next()){var a=n.value,o={Id:a.Id,Name:a.Name};this.allActList.push(o)}}catch(s){t={error:s}}finally{try{n&&!n.done&&(r=i["return"])&&r.call(i)}finally{if(t)throw t.error}}this.allActList=this.allActList.concat(this.userActList)},ve.decorators=[{type:ne.Injectable}],ve.ctorParameters=function(){return[{type:O.HttpService}]},ve);function ve(e){this.http=e,this.flowFormInfo=new he,this.content="",this.propertyConfig=[],this.propertyData={},this.POST_MESSAGE_TARGET=window.document.location.origin+"/platform/runtime/wf/web/designer/index.html",this.schemas=[],this.counterSignVariables=[],this.approvalItems=[],this.userActList=[],this.allActList=[],this.isAdministratorConfig=!1,this.organizations=new Array,this.assignIterator=[{key:"ALL",value:"所有"},{key:"ASSIGN",value:"指派"},{key:"CLAIM",value:"领用"}],this.completeIterator=[{key:"Preempt",value:"抢占模式"},{key:"Parallel",value:"并行会签"},{key:"Sequential",value:"串行会签"}],this.completeIterator4Claim=[{key:"Preempt",value:"抢占模式"}],this.boolIterator=[{key:!0,value:"是"},{key:!1,value:"否"}],this.noJump4Sign=[{key:!1,value:"否"}],this.procInstContext=[{key:"dataId",name:"单据内码",description:"单据内码"},{key:"procInstId",name:"流程实例ID",description:"流程实例ID"},{key:"bizDefKey",name:"入口单据ID",description:"入口单据ID"},{key:"processDefinitionKey",name:"流程定义KEY",description:"流程定义KEY"},{key:"procInstCreator",name:"流程发起人",description:"流程发起人"},{key:"procInstDescription",name:"流程摘要",description:"流程摘要"},{key:"comment",name:"审批意见",description:"审批意见"}],this.urgeContext=[{key:"dataId",name:"单据内码",description:"单据内码"},{key:"procInstId",name:"流程实例ID",description:"流程实例ID"},{key:"bizDefKey",name:"入口单据ID",description:"入口单据ID"},{key:"processDefinitionKey",name:"流程定义KEY",description:"流程定义KEY"},{key:"procInstCreator",name:"流程发起人",description:"流程发起人"},{key:"procInstDescription",name:"流程摘要",description:"流程摘要"},{key:"comment",name:"审批意见",description:"审批意见"},{key:"bizDefName",name:"流程分类名称",description:"流程分类名称"},{key:"curLoginUsername",name:"当前登录人名称",description:"当前登录人名称"},{key:"procInstCreatorName",name:"流程发起人名称",description:"流程发起人名称"}],this.formalParameterContext=[],this.participantContext=[{key:"procInstCreator",name:"流程发起人",description:"流程发起人"},{key:"currentUser",name:"当前执行人",description:"当前执行人"},{key:"preActExecutors",name:"上一个活动的执行人",description:"上一个活动的执行人"}],this.activityComponentContext=[{key:"conclusionType",name:"结论类型",description:"审批项流转方向，1正向，2反向，3终止"},{key:"conclusionValue",name:"结论值",description:'审批项编号，例如，"Pass"、"Back"、"Refuse"'}],this.processVariableContext=new Array,this.processVariables=new Array,this.dimensions=[{value:"directSuperior",text:"直接上级"},{value:"higherSuperior",text:"间接上级"}],this.startModeIterator=[{key:"DIRECT",value:"直接"},{key:"EXTERNAL_PROCESS",value:"外部流程"},{key:"SUB_PROCESS",value:"子流程"}],this.displayTerminal=[{key:"ALL",value:"电脑端和移动端"},{key:"WEB",value:"电脑端"},{key:"APP",value:"移动端"}],this.messageChannels=new Array,this.orgTypeCollection=[]}var ye="new",ge="open",be="updateProperty",xe="refresh",we="loadBizActivity",Ce="initProperty",Ie="save",Se="saveAs",ke="wf_sync",Ee="wf_note",Pe="release",Te="closeDesigner",Fe="getActivities",Ae="getEndEvents",Me="showTip",De="EntryForm",Oe="ConditionExpression",Ve="ParticipantSchemes",Le="ApprovalItems",Ne="AssignStrategy",Be="OperatorConfig",Re="CompleteStrategy",ze="SignRule",He="Retrievable",je="AddSignFrontAble",Ue="AddSignBehindAble",qe="NotifyAble",Ge="DisplayTerminal",Ke="sendBackedTask",Je="SelectTargetAble",_e="JumpScope",We="BackWardRule",$e="Tools",Xe="SelectBranch",Ze="Default",Ye="allowPreAssign",Qe="startMode",et="transferScope",tt="EventDefinitions",rt="urgeHandleRule",it="callActivitySubProcess",nt="wf_Component",at="wf_ExecuteForms_PC",ot="wf_ExecuteForms_Mobile",st="wf_TitleExpression",lt="wf_CustomizeAction",ct="timeLimitControl",dt="anonymousSet",pt="processVariables",ut="variableSettings",ft="messageNotice",ht="approvalPivotConfig",mt="aifProcessCode",vt=(yt.GenerateElementId=function(){return++this.generatedId,"_"+this.Decimal2String(this.generatedId)},yt.Decimal2String=function(e){for(var t,r="";t=e%this.exponent,r=this.keys[t]+r,0<(e=(e-t)/this.exponent););return r},yt.createNM=function(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},yt.prototype.getProcessDesignerRouter=function(){return"processList"},yt.prototype.getFlowFormWebApi=function(){return"/api/runtime/wf/v1.0/flowForm"},yt.prototype.getFormalParametersWebApi=function(){return"/api/runtime/wf/v1.0/formalParameter"},yt.prototype.getMetaDataRUWebApi=function(){return"/api/runtime/lcm/v1.0/rt-metadatas/"},yt.prototype.getBizComponentsWebApi=function(){return"/api/runtime/wf/v1.0/bizComponent"},yt.prototype.getExcuteFormsWebApi=function(){return"/api/runtime/wf/v1.0/excuteForm"},yt.prototype.getProcessDefinitionWebApi=function(){return"/api/runtime/wf/v1.0/dtProcDefs"},yt.prototype.getCheckExistActiveProcDefApi=function(){return"/api/runtime/wf/v1.0/procDefs/checkExistActiveProcDef"},yt.prototype.getBizActivityWebApi=function(e){return"/api/runtime/wf/v1.0/bizActivity?flowFormKey="+e},yt.prototype.getProcDefKeyWebApi=function(){return"/api/runtime/wf/v1.0/procDefs/processDefinitionKeys"},yt.prototype.deployWebApi=function(){return"/api/runtime/wf/v1.0/procDefs/deploy"},yt.prototype.saveWebApi=function(){return"/api/runtime/wf/v1.0/DTProcessDefinitions/SaveBpmnModel"},yt.prototype.getApprovalActionWebApi=function(){return"/api/runtime/wf/v1.0/approvalAction"},yt.prototype.getRTProcessDefinitionWebApi=function(){return"/api/runtime/wf/v1.0/procDefs"},yt.prototype.getValue=function(e,t){return t?-1===t.indexOf(".")?e[t]:t.split(".").reduce(function(e,t){return e?e[t]:null},e):""},yt.prototype.toUpperCase=function(e){var t,r;if("object"==typeof e)try{for(var i=pe(Object.keys(e)),n=i.next();!n.done;n=i.next()){var a=n.value;e[a.substring(0,1).toUpperCase()+a.substring(1)]=e[a],delete e[a]}}catch(o){t={error:o}}finally{try{n&&!n.done&&(r=i["return"])&&r.call(i)}finally{if(t)throw t.error}}return e},yt.prototype.toLowCase=function(e){var t,r;if("object"==typeof e)try{for(var i=pe(Object.keys(e)),n=i.next();!n.done;n=i.next()){var a=n.value;a.substring(0,1).toLowerCase()+a.substring(1)!==a&&(e[a.substring(0,1).toLowerCase()+a.substring(1)]=e[a],delete e[a])}}catch(o){t={error:o}}finally{try{n&&!n.done&&(r=i["return"])&&r.call(i)}finally{if(t)throw t.error}}return e},yt.generatedId=parseInt(Date.now().toString()),yt.keys="0123456789ABCDEFGHJKLMNPQRSTUVWXYZ",yt.exponent=34,yt.decorators=[{type:ne.Injectable}],yt.ctorParameters=function(){return[]},yt);function yt(){}var gt=(bt.prototype.GetFlowFormbyId=function(e){if(e){var t=this.util.getFlowFormWebApi();return t+="/"+e,this.http.get(t)}},bt.prototype.getParametersbyFlowFormKey=function(e){if(e){var t=this.util.getFormalParametersWebApi();return t+="?flowFormKey="+e,this.http.get(t)}},bt.prototype.getComponentsbyFlowformkey=function(e){if(e){var t=this.util.getBizComponentsWebApi();return t+="/query?param="+encodeURIComponent('{"flowFormKey":"'+e+'"}'),this.http.get(t)}},bt.prototype.getExecuteFormbyFlowFormKey=function(e){if(e){var t=this.util.getExcuteFormsWebApi();return t+="?flowFormKey="+e,this.http.get(t)}},bt.prototype.getBizActivities=function(e){if(e){var t=this.util.getBizActivityWebApi(e);return this.http.get(t)}},bt.prototype.getCustomizeActions=function(e){if(e){var t="/api/runtime/wf/v1.0/customizeAction?flowFormKey="+e;return this.http.get(t)}},bt.prototype.getBizActivityComponents=function(e,t){if(t){var r=this.util.getBizComponentsWebApi();return r+="/query?param="+encodeURIComponent('{"flowFormKey":"'+e+'","owner":"'+t+'","ownerType":"Activity"}'),this.http.get(r)}},bt.prototype.getBizActivityActions=function(e){if(e){var t=this.util.getApprovalActionWebApi();return t+="?bizActivityId="+e,this.http.get(t)}},bt.prototype.getBusinessEntitybyId=function(e){if(e){var t="/api/runtime/lcm/v1.0/bef/expression?beId="+e;return this.http.get(t)}},bt.prototype.getProcContentbyKey=function(e){if(e){var t=this.util.getProcessDefinitionWebApi();return t+="/bpmnModel?procDefKey="+e,this.http.get(t)}},bt.prototype.getRTProcContentbyId=function(e){if(e){var t=this.util.getRTProcessDefinitionWebApi();return t+="/"+e+"/bpmnModel",this.http.get(t)}},bt.prototype.saveProcess=function(e,t,r){if(e){var i={organization:t.procOrg?t.procOrg.orgId:"",organizationName:t.procOrg?t.procOrg.orgName:"",accessLevel:t.accessLevel,procContent:e,state:r},n=this.util.getProcessDefinitionWebApi();return this.http.post(n,JSON.stringify(i))}},bt.prototype.auditProcessDef=function(e){this.http.post("/api/runtime/wf/v1.0/dtProcDefs/auditProcessDef",e).subscribe(function(e){})},bt.prototype.deployProcess=function(e){if(e){var t={procDefContent:e},r=this.util.deployWebApi();return this.http.post(r,JSON.stringify(t))}},bt.prototype.saveRTProcess=function(e,t){if(e){var r={procDefContent:e},i=this.util.getRTProcessDefinitionWebApi();return i+="/"+t+"/adjust",this.http.post(i,JSON.stringify(r))}},bt.prototype.syncDtProcess=function(e,t){if(e){var r={organization:t.procOrg?t.procOrg.orgId:"",organizationName:t.procOrg?t.procOrg.orgName:"",accessLevel:t.accessLevel||"public",procContent:e,state:0};return this.http.post("/api/runtime/wf/v1.0/dtProcDefs",JSON.stringify(r))}},bt.decorators=[{type:ne.Injectable}],bt.ctorParameters=function(){return[{type:O.HttpService},{type:vt}]},bt);function bt(e,t){this.http=e,this.util=t}var xt="bpmn.Process",wt="wf.UserActivity",Ct="wf.OperationActivity",It="wf.CallActivitySubProcess",St="wf.AutoActivity",kt="wf.IntermediateCatchEventImpl",Et="wf.MessageActivity",Pt="wf.NotifyActivity",Tt="wf.AifCreationBillActivity",Ft=(Object.defineProperty(At.prototype,"value",{set:function(e){e&&(this.flowFormId=e.id)},enumerable:!0,configurable:!0}),At.prototype.ngOnInit=function(){this.getBaseAndExtendFlowForm()},At.prototype.ngAfterViewInit=function(){},At.prototype.clickOK=function(){if(this.grid.selectedRow){var e={value:this.grid.selectedRow.data,parameters:null};this.submitModal.emit(e)}else this.message.info("尚未选择流程分类")},At.prototype.clickCancel=function(){this.closeModal.emit()},At.prototype.getBaseAndExtendFlowForm=function(){var t=this;if(this.flowFormId){var e="/api/runtime/wf/v1.0/flowForm/"+this.flowFormId+"/baseAndExtend";this.http.get(e).subscribe(function(e){e&&0<e.length?(t.data=e,setTimeout(function(){t.grid.selectRow(t.flowFormId,!0)},0)):t.message.info("流程分类已经不存在")})}},At.decorators=[{type:ne.Component,args:[{selector:"app-entry-form-editor",template:'<div class="f-page">\r\n  <div class="f-page-main f-utils-fill-flex-column h-100">\r\n    <div class="f-utils-fill-flex-column farris-overflow-y-auto h-100">\r\n      <farris-datagrid #grid [data]="data" [columns]="columns" [idField]="\'id\'" [fit]="true" [fitColumns]="true"\r\n         [pagination]="false" [showCheckbox]="false" [multiSelect]="false" [showLineNumber]="true" [lineNumberTitle]="\'序号\'" \r\n         [lineNumberWidth]="50">\r\n      </farris-datagrid>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n\r\n<ng-template #iconSelectFooter>\r\n    <button type="button" class="btn btn-primary btn-sm px-3 mx-2" (click)="clickOK()">重新绑定</button>\r\n    <button type="button" class="btn btn-secondary btn-sm px-3" (click)="clickCancel()">取消</button>\r\n</ng-template>\r\n',styles:[""]}]}],At.ctorParameters=function(){return[{type:O.HttpService},{type:Y.MessagerService}]},At.propDecorators={closeModal:[{type:ne.Output}],submitModal:[{type:ne.Output}],value:[{type:ne.Input}],modalFooter:[{type:ne.ViewChild,args:["iconSelectFooter"]}],grid:[{type:ne.ViewChild,args:["grid"]}],editorParams:[{type:ne.Input}]},At);function At(e,t){this.http=e,this.message=t,this.closeModal=new ne.EventEmitter,this.submitModal=new ne.EventEmitter,this.editorParams={},this.modalConfig={title:"流程分类",width:540,height:520,showButtons:!0},this.columns=[{title:"编号",field:"code",width:100,sortable:!0},{title:"名称",field:"name",width:100,sortable:!0},{title:"类型",field:"base",width:60,formatter:{type:"boolean",options:{trueText:"基础",falseText:"扩展"}}}],this.data=[]}var Mt=(Dt.prototype.convertTo=function(e){if(e)return e.name},Dt);function Dt(){}var Ot=(Vt.decorators=[{type:ne.Injectable}],Vt);function Vt(){this.components=[],this.allComponents=[],this.executionCollection=[{text:"流程启动",value:"PROCESSINSTANCE_STARTED"},{text:"流程挂起",value:"PROCESSINSTANCE_SUSPENDED"},{text:"流程恢复",value:"PROCESSINSTANCE_RESUMED"},{text:"流程完成",value:"PROCESSINSTANCE_COMPLETED"},{text:"流程终止",value:"PROCESSINSTANCE_ABORTED"},{text:"流程取消",value:"PROCESSINSTANCE_CANCELED"},{text:"流程复活",value:"PROCESSINSTANCE_REACTIVATED"},{text:"流程驳回",value:"PROCESSINSTANCE_ROLLBACK"},{text:"重新提交",value:"PROCESSINSTANCE_RESUBMIT"},{text:"环节办理人变更",value:"ACTIVITY_AND_PARTICIPANT_UPDATED"},{text:"管理员终止",value:"PROCESSINSTANCE_ABORTED_BY_ADMIN"},{text:"流程启动前",value:"PROCESSINSTANCE_BEFORE_START"},{text:"任务完成前",value:"WORKITEM_BEFORE_COMPLETE"},{text:"任务完成后",value:"WORKITEM_AFTER_COMPLETE"},{text:"获取数据",value:"LOADDATA"}],this.activityCollection=[{text:"活动启动",value:"ACTIVITY_STARTED"},{text:"活动完成",value:"ACTIVITY_COMPLETED"},{text:"活动终止",value:"ACTIVITY_ABORTED"},{text:"工作项创建",value:"WORKITEM_CREATED"},{text:"工作项完成",value:"WORKITEM_COMPLETED"},{text:"工作项挂起",value:"WORKITEM_SUSPENDED"},{text:"工作项恢复",value:"WORKITEM_RESUMED"},{text:"工作项终止",value:"WORKITEM_ABORTED"},{text:"工作项取回",value:"WORKITEM_RETRIEVED"},{text:"工作项领用",value:"WORKITEM_CLAIMED"},{text:"工作项反领用",value:"WORKITEM_UNCLAIMED"},{text:"任务分配前",value:"ACTIVITY_ASSIGNMENT"}]}var Lt=function vs(e,t,r){this.id=vt.GenerateElementId(),this.name=e,this.metadataId=t,this.methodCode=r,this.isForCompensation=!1},Nt="Activity",Bt=(Rt.prototype.loadComponents=function(e,t){var r=this,i=this.util.getBizComponentsWebApi();t?(i+="/query?param="+encodeURIComponent('{"flowFormKey":"'+e+'","owner":"'+t+'","ownerType":"Activity"}'),this.http.get(i).subscribe(function(e){r.uistate.allComponents=e.filter(function(e){return e.ownerType===Nt})})):this.uistate.allComponents=[]},Rt.prototype.removeComponent=function(t){if(t){var e=this.uistate.components.findIndex(function(e){return e.id===t});-1<e&&(this.uistate.components.splice(e,1),0<this.uistate.components.length?this.subject.next(this.uistate.components[0]):this.uistate.curComponent=null)}},Rt.prototype.addComponent=function(e){if(e){var t=new Lt(e.name,e.id,e.operations[0].code);t.id=vt.GenerateElementId(),t.actualParameters=this.bindParas(e),this.uistate.components.push(t),this.subject.next(t)}},Rt.prototype.bindParas=function(e){var t=[];return e.operations[0].parameters&&0<e.operations[0].parameters.length&&(t=-1<this.defaultProcessComponentIds.indexOf(e.id)?this.assignParameterValue(e.operations[0].parameters):e.operations[0].parameters.map(function(e){return{code:e.code,name:e.name,value:""}})),t},Rt.prototype.assignParameterValue=function(e){var r=this;return e.map(function(e){if(-1<e.code.indexOf("beId")){var t=r.designerState.formalParameterContext.filter(function(e){return-1<e.key.indexOf("metadataId")})[0].key;return{code:e.code,name:e.name,value:'{"expr":"DefaultFunction.GetContextParameter(\\"'+t+'\\")"}'}}return-1<e.code.indexOf("nodeId")?(t=r.designerState.formalParameterContext.filter(function(e){return-1<e.key.indexOf("schemaId")})[0].key,{code:e.code,name:e.name,value:'{"expr":"DefaultFunction.GetContextParameter(\\"'+t+'\\")"}'}):-1<e.code.indexOf("dataId")?{code:e.code,name:e.name,value:'{"expr":"DefaultFunction.GetContextParameter(\\"dataId\\")"}'}:-1<e.code.indexOf("procInstId")?{code:e.code,name:e.name,value:'{"expr":"DefaultFunction.GetContextParameter(\\"procInstId\\")"}'}:{code:e.code,name:e.name,value:""}})},Rt.prototype.swapArray=function(e,t,r){return e[t]=e.splice(r,1,e[t])[0],e},Rt.decorators=[{type:ne.Injectable}],Rt.ctorParameters=function(){return[{type:Ot},{type:vt},{type:O.HttpService},{type:me}]},Rt);function Rt(e,t,r,i){this.uistate=e,this.util=t,this.http=r,this.designerState=i,this.defaultProcessComponentIds=["5863c8a8-e0a7-4137-a8b2-4c05e42b3b73","be781ba1-a88b-4bb8-9c88-2e2a27a9226e"],this.subject=new T.Subject}var zt=(Ht.prototype.deleteRow=function(){this.uistate.curComponent&&("LOADDATA"===this.uistate.curComponent.executionTime?this.messager.info("取数构件不允许删除，请了解！"):this.repository.removeComponent(this.uistate.curComponent.id))},Ht.prototype.componentSelect=function(e){e&&this.repository.addComponent(e)},Ht.prototype.loadComponents=function(e,t){this.repository.loadComponents(e,t)},Ht.decorators=[{type:ne.Injectable}],Ht.ctorParameters=function(){return[{type:Ot},{type:Bt},{type:Y.MessagerService}]},Ht);function Ht(e,t,r){this.uistate=e,this.repository=t,this.messager=r}var jt=function ys(e,t,r){this.code=e,this.name=t,this.value=r},Ut=(Object.defineProperty(qt.prototype,"value",{set:function(e){var t,r,i,n;if(e&&0<e.length)try{for(var a=pe(e),o=a.next();!o.done;o=a.next()){var s=o.value,l=new Lt(s.Name||s.name,s.MetadataId||s.metadataId,s.MethodCode||s.methodCode);if(l.executionTime=s.Time||s.executionTime,l.id=s.Id||s.id,l.isForCompensation=s.isForCompensation,l.actualParameters=[],s.ActualParameters&&0<s.ActualParameters.length||s.actualParameters&&0<s.actualParameters.length){var c=s.ActualParameters||s.actualParameters;try{for(var d=pe(c),p=d.next();!p.done;p=d.next()){var u=p.value,f=new jt(u.Name||u.code,u.Name||u.name,u.Value||u.value);l.actualParameters.push(f)}}catch(h){i={error:h}}finally{try{p&&!p.done&&(n=d["return"])&&n.call(d)}finally{if(i)throw i.error}}}this.uistate.components.push(l)}}catch(m){t={error:m}}finally{try{o&&!o.done&&(r=a["return"])&&r.call(a)}finally{if(t)throw t.error}}},enumerable:!0,configurable:!0}),qt.prototype.ngOnInit=function(){var i=this;this.location=this.editorParams.location,"activity"===this.location?(this.uistate.executionCollection=this.uistate.activityCollection,this.columns=[{field:"name",width:100,title:"构件名称"},{field:"metadataId",width:100,title:"构件ID"},{field:"methodCode",width:100,title:"构件方法"},{field:"executionTime",width:100,title:"执行时机",editor:{type:U.EditorTypes.COMBOLIST,options:{data:this.uistate.executionCollection,valueField:"value",textField:"text",idField:"value",panelHeight:"auto"}},formatter:function(t,e,r){return t?i.uistate.executionCollection.find(function(e){return e.value===t}).text:""},validators:[{type:"required",messager:"必填"}]},{field:"isForCompensation",width:50,title:"补偿操作",editor:{type:U.EditorTypes.SWITCH,options:{}},formatter:{type:"boolean",options:{trueText:"是",falseText:"否"}}}]):"autoActivity"===this.location?this.columns=[{field:"name",width:100,title:"构件名称"},{field:"metadataId",width:100,title:"构件ID"},{field:"methodCode",width:100,title:"构件方法"},{field:"isForCompensation",width:50,title:"补偿操作",editor:{type:U.EditorTypes.SWITCH,options:{}},formatter:{type:"boolean",options:{trueText:"是",falseText:"否"}}}]:this.columns=[{field:"name",width:100,title:"构件名称"},{field:"metadataId",width:100,title:"构件ID"},{field:"methodCode",width:100,title:"构件方法"},{field:"executionTime",width:100,title:"执行时机",editor:{type:U.EditorTypes.COMBOLIST,options:{data:this.uistate.executionCollection,valueField:"value",textField:"text",idField:"value",panelHeight:"auto"}},formatter:function(t,e,r){return t?i.uistate.executionCollection.find(function(e){return e.value===t}).text:""},validators:[{type:"required",messager:"必填"}]}],this.uistate.components&&0<this.uistate.components.length&&this.cmplist.selectRow(this.uistate.components[0].id,!0),this.paramColumns=[{field:"code",width:50,title:"编号"},{field:"name",width:50,title:"名称"},{field:"value",width:100,title:"参数值",editor:{type:"input-group",options:{groupText:'<i class="f-icon f-icon-lookup"></i>',editable:!1,clickHandle:function(e){e.formControl.setValue(e.instance.value?e.instance.value:""),i.showExprHelp(e)},clear:function(e){console.log("clear",e)}}}}],this.repository.subject.subscribe(function(e){i.cmplist.loadData(i.uistate.components),e?i.cmplist.selectRow(e.id,!0):i.uistate.curComponent=null})},qt.prototype.ngAfterViewInit=function(){this.uistate.components&&0<this.uistate.components.length&&this.cmplist.selectRow(this.uistate.components[0].id,!0)},qt.prototype.deleteRow=function(){this.closeCellEdit(),this.viewModel.deleteRow()},qt.prototype.moveUp=function(){if(this.uistate.curComponent){var t=this.uistate.curComponent.id,e=this.uistate.components.findIndex(function(e){return e.id===t});0!==e&&(this.repository.swapArray(this.uistate.components,e,e-1),this.cmplist.loadData(this.uistate.components),this.cmplist.selectRow(t,!0))}else this.message.info("尚未选中构件！")},qt.prototype.moveDown=function(){if(this.uistate.curComponent){var t=this.uistate.curComponent.id,e=this.uistate.components.findIndex(function(e){return e.id===t});e!==this.uistate.components.length-1&&(this.repository.swapArray(this.uistate.components,e,e+1),this.cmplist.loadData(this.uistate.components),this.cmplist.selectRow(t,!0))}else this.message.info("尚未选中构件！")},qt.prototype.clickOK=function(){if(this.closeCellEdit(),this.validator()){var e={value:this.uistate.components,parameters:null};this.submitModal.emit(e)}},qt.prototype.clickCancel=function(){this.closeModal.emit()},qt.prototype.componentSelect=function(){var i=this,e=this.resolver.resolveComponentFactory(ee.SelectMetadataRTComponent).create(this.injector);e.instance.typeList="WebServiceComponent",e.instance.selectedMetadata.subscribe(function(e){try{var t=e.metadata;i.openComponentSelectorNew(t.id,i.sessionSrc.getUserSessionId())}catch(r){throw console.log("$event",e),new Error("获取解析构件出错"+e)}});var t=this.modalService.show(e,{title:"构件选择",width:980,height:548,showButtons:!1});e.instance.closeModalEmitter.subscribe(function(e){return t.close()})},qt.prototype.openComponentSelectorNew=function(e,t){var r=this;this.componentService.openSelector(e,t).subscribe(function(e){e.confirmEvent.subscribe(function(e){r.viewModel.componentSelect(e)})})},qt.prototype.showExprHelp=function(t){var e,r,i,n,a,o,s,l,c,d,p,u,f,h;if(0<this.designerState.schemas.length){try{for(var m=pe(this.designerState.schemas),v=m.next();!v.done;v=m.next()){var y=v.value;this.expr.addSchema("Schema",y)}}catch(R){e={error:R}}finally{try{v&&!v.done&&(r=m["return"])&&r.call(m)}finally{if(e)throw e.error}}if(this.designerState.schemas[0].entityTypes&&0<this.designerState.schemas[0].entityTypes.length){var g=this.designerState.schemas[0].entityTypes[0];this.expr.addInjectedEntity(g.name,"Schema",g.name,J.InjectedType.EntityType)}}var b=new Array;if(0<this.designerState.procInstContext.length)try{for(var x=pe(this.designerState.procInstContext),w=x.next();!w.done;w=x.next()){var C=w.value;b.push(C)}}catch(z){i={error:z}}finally{try{w&&!w.done&&(n=x["return"])&&n.call(x)}finally{if(i)throw i.error}}if(0<this.designerState.formalParameterContext.length){var I=function(t){b.some(function(e){return e.key===t.key})||b.push(t)};try{for(var S=pe(this.designerState.formalParameterContext),k=S.next();!k.done;k=S.next())I(C=k.value)}catch(H){a={error:H}}finally{try{k&&!k.done&&(o=S["return"])&&o.call(S)}finally{if(a)throw a.error}}}if(0<this.designerState.participantContext.length){var E=function(t){b.some(function(e){return e.key===t.key})||b.push(t)};try{for(var P=pe(this.designerState.participantContext),T=P.next();!T.done;T=P.next())E(C=T.value)}catch(j){s={error:j}}finally{try{T&&!T.done&&(l=P["return"])&&l.call(P)}finally{if(s)throw s.error}}}if("activity"===this.location){var F=function(t){b.some(function(e){return e.key===t.key})||b.push(t)};try{for(var A=pe(this.designerState.activityComponentContext),M=A.next();!M.done;M=A.next())F(C=M.value)}catch(U){c={error:U}}finally{try{M&&!M.done&&(d=A["return"])&&d.call(A)}finally{if(c)throw c.error}}}if(0<this.designerState.processVariableContext.length){var D=function(t){b.some(function(e){return e.key===t.key})||b.push(t)};try{for(var O=pe(this.designerState.processVariableContext),V=O.next();!V.done;V=O.next())D(C=V.value)}catch(q){p={error:q}}finally{try{V&&!V.done&&(u=O["return"])&&u.call(O)}finally{if(p)throw p.error}}}if(0<b.length)try{for(var L=pe(b),N=L.next();!N.done;N=L.next()){var B=N.value;this.expr.addContext(B)}}catch(G){f={error:G}}finally{try{N&&!N.done&&(h=L["return"])&&h.call(L)}finally{if(f)throw f.error}}this.expr.setEditPattern(J.ExprEditMode.Advanced),this.expr.addExpressionText(t.instance.value),this.expr.buildExpression().then(function(e){t.formControl.setValue(e),t.instance.cd.detectChanges()})},qt.prototype.selectionChange=function(e){this.uistate.curComponent=e.data},qt.prototype.closeCellEdit=function(){this.cmplist.endCellEdit(),this.paramlist&&this.paramlist.endCellEdit()},qt.prototype.validator=function(){var e,t;try{for(var r=pe(this.uistate.components),i=r.next();!i.done;i=r.next())if(!i.value.executionTime&&"autoActivity"!==this.location)return this.message.warning("构件执行时机不允许为空！"),!1}catch(n){e={error:n}}finally{try{i&&!i.done&&(t=r["return"])&&t.call(r)}finally{if(e)throw e.error}}return!0},qt.decorators=[{type:ne.Component,args:[{selector:"app-activity-component",template:'\r\n<div class="f-page">\r\n  <div class="f-page-header">\r\n    <nav class="f-page-header-base">\r\n      <div class="f-title">\r\n        <span class="f-title-icon f-text-orna-bill">\r\n          <i class="f-icon f-icon-page-title-administer"></i>\r\n        </span>\r\n        <h4 class="f-title-text">构件列表</h4>\r\n      </div>\r\n      <div class="btn-toolbar btn-group-lg">\r\n        <button class="btn btn-primary mr-2" (click)="componentSelect()">新增</button>\r\n        <button class="btn btn-secondary mr-2" (click)="deleteRow()">删除</button>\r\n        <button class="btn btn-secondary mr-2" (click)="moveUp()">上移</button>\r\n        <button class="btn btn-secondary" (click)="moveDown()">下移</button>\r\n      </div>\r\n    </nav>\r\n  </div>\r\n  <div class="f-page-main f-utils-fill-flex-column h-100">\r\n    <div class="f-utils-fill-flex-column farris-overflow-y-auto h-100">\r\n      <div [style.height.%]="uistate.curComponent?45:100">\r\n        <farris-datagrid #cmplist [data]="uistate.components" [idField]="\'id\'" [columns]="columns" [fit]="true"\r\n          [fitColumns]="true" [editable]="true" [editMode]="\'cell\'" [pagination]="false" [showCheckbox]="false"\r\n          [multiSelect]="false" (selectChanged)="selectionChange($event)" [closeOtherGridEditor]="true">\r\n        </farris-datagrid>\r\n      </div>\r\n      <ng-container *ngIf="uistate.curComponent">\r\n        <farris-tabs class="f-utils-fill" [value]="\'parameters\'" [contentFill]="true" [autoTitleWidth]="true">\r\n          <farris-tab [title]="\'参数列表\'" [id]="\'parameters\'">\r\n            <ng-template #content>\r\n              <div class="f-utils-fill-flex-column h-100">\r\n                <farris-datagrid #paramlist [data]="uistate.curComponent.actualParameters" \r\n                  [columns]="paramColumns" [idField]="\'code\'" [fit]="true" [fitColumns]="true" \r\n                  [editable]="true" [editMode]="\'cell\'" [pagination]="false"\r\n                  [showCheckbox]="false" [multiSelect]="false" [afterEdit]="paramAfterEdit" [closeOtherGridEditor]="true">\r\n                </farris-datagrid>\r\n              </div>\r\n            </ng-template>\r\n          </farris-tab>\r\n        </farris-tabs>\r\n      </ng-container>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n\r\n<ng-template #iconSelectFooter>\r\n  <button type="button" class="btn btn-primary btn-sm px-3 mx-2" (click)="clickOK()">确定</button>\r\n  <button type="button" class="btn btn-secondary btn-sm px-3" (click)="clickCancel()">取消</button>\r\n</ng-template>\r\n\r\n',providers:[Bt,Ot,zt],styles:[""]}]}],qt.ctorParameters=function(){return[{type:Ot},{type:zt},{type:l.FormBuilder},{type:me},{type:J.ExpressionService},{type:ne.ComponentFactoryResolver},{type:ne.Injector},{type:O.SessionService},{type:te.BsModalService},{type:c.CommonComponentUiRTService},{type:Bt},{type:Y.MessagerService}]},qt.propDecorators={cls:[{type:ne.HostBinding,args:["class"]}],closeModal:[{type:ne.Output}],submitModal:[{type:ne.Output}],editorParams:[{type:ne.Input}],modalFooter:[{type:ne.ViewChild,args:["iconSelectFooter"]}],value:[{type:ne.Input}],cmplist:[{type:ne.ViewChild,args:["cmplist"]}],paramlist:[{type:ne.ViewChild,args:["paramlist"]}]},qt);function qt(e,t,r,i,n,a,o,s,l,c,d,p){this.uistate=e,this.viewModel=t,this.formBuilder=r,this.designerState=i,this.expr=n,this.resolver=a,this.injector=o,this.sessionSrc=s,this.modalService=l,this.componentService=c,this.repository=d,this.message=p,this.cls="farris-main-area flex-column",this.closeModal=new ne.EventEmitter,this.submitModal=new ne.EventEmitter,this.editorParams={},this.modalConfig={title:"构件",width:1e3,height:530,showButtons:!0},this.columns=[],this.paramColumns=[],this.paramAfterEdit=function(e,t,r){return T.of(!0)}}var Gt=(Kt.prototype.convertTo=function(e){return e&&0<e.length?"（已设置）":"（未设置）"},Kt);function Kt(){}var Jt=(_t.decorators=[{type:ne.Injectable}],_t);function _t(){this.formTypeCollection=[{text:"流程嵌表单",value:"0"},{text:"表单嵌流程",value:"1"}]}var Wt=($t.decorators=[{type:ne.Injectable}],$t);function $t(){}var Xt=(Zt.decorators=[{type:ne.Injectable}],Zt);function Zt(){}var Yt=function gs(){},Qt=function bs(){},er="PC",tr="MOBILE",rr=(ir.prototype.getData=function(e,t){var r=t.customData,i=t.pageIndex||1,n=t.pageSize||20,a=JSON.parse(t.searchValue),o="?param=",s='{"terminal":"'+("web"===r.tab?"PC":"Mobile")+'"';return a.searchValue&&("*"===a.searchField?s+=',"allColumns":"'+a.searchValue+'"':s+=',"'+a.searchField+'":"'+a.searchValue+'"'),s+="}",e+=o+=(s=encodeURIComponent(s))+"&pageNum="+i+"&pageSize="+n,this.http.get(e).pipe(F.map(function(e){return{items:e.content,total:e.totalElements,pageInfo:{pageIndex:e.pageable.pageNumber+1,pageSize:e.pageable.pageSize,pageList:[20,40,60,80,100],enablePager:!0}}}))},ir.decorators=[{type:ne.Injectable}],ir.ctorParameters=function(){return[{type:O.HttpService}]},ir);function ir(e){this.http=e}var nr=function xs(){},ar=(or.prototype.ngOnInit=function(){this.getAllExecuteForms()},or.prototype.clickOK=function(){if(this.grid.selectedRow){var e=this.grid.selectedRow.data,t=new Yt;t.Id=vt.GenerateElementId(),t.Name=e.name,t.ComponentId=e.appId,t.FormType=e.formType,t.formFormatId=e.formFormatId,t.TerminalType="web"===this.tab?er:tr,t.ActualParameters=e.actualParameters.map(function(e){var t=new Qt;return t.Name=e.code,t.Value=e.value,t}),this.submit.next(t)}else this.message.info("尚未选择表单定义！")},or.prototype.clickCancel=function(){this.cancel.next()},or.prototype.selectOtherFormFormat=function(){this.lookUp.showDialog()},or.prototype.selectOtherFunc=function(){this.appHelper.showHelp(this.session.getUserSessionId())},or.prototype.funcSelected=function(e){var t=this;if(e&&0<e.length){var r=new Yt;if(r.Id=vt.GenerateElementId(),r.Name=e[0].Name,r.ComponentId=e[0].Id,r.FormType="0",r.formFormatId=null,r.TerminalType="web"===this.tab?er:tr,r.ActualParameters=[],e[0].InvokingConfig.entityParams){var i=JSON.parse(e[0].InvokingConfig.entityParams);r.ActualParameters=i.map(function(e){return{Name:e.name,Value:""}})}setTimeout(function(){t.submit.next(r)},0)}},or.prototype.getAllExecuteForms=function(){var l=this;T.forkJoin(this.getExecuteForms(),this.getFormFormats()).subscribe(function(e){var t,r;if(e[0]&&(l.forms=e[0]),e[1]&&0<e[1].length){var i=e[1],n=function(t){if(-1===l.forms.findIndex(function(e){return e.formFormatId&&e.formFormatId===t.id})){var e=new nr;if(e.id=vt.createNM(),e.flowFormKey=l.state.flowFormInfo.flowForm.id,e.appId=null,e.code=t.code,e.name=t.name,e.actualParameters=[],e.isDefault=!1,e.formType="0",e.terminal="web",e.formFormatId=t.id,e.sysInit=0,e.remarks="",t.urlParameters&&0<t.urlParameters.length){var r=t.urlParameters.map(function(e){return{code:e.code,name:e.name,value:e.value}});e.actualParameters=r}l.forms.push(e)}};try{for(var a=pe(i),o=a.next();!o.done;o=a.next())n(o.value)}catch(s){t={error:s}}finally{try{o&&!o.done&&(r=a["return"])&&r.call(a)}finally{if(t)throw t.error}}}})},or.prototype.getExecuteForms=function(){var t=this;if(this.state.flowFormInfo.flowForm.id&&this.tab){var e="/api/runtime/wf/v1.0/excuteForm?flowFormKey="+this.state.flowFormInfo.flowForm.id;return this.http.get(e).pipe(F.map(function(e){return"web"===t.tab?e.filter(function(e){return-1<e.terminal.indexOf("web")}):"mobile"===t.tab?e.filter(function(e){return-1<e.terminal.indexOf("app")}):void 0}))}return T.from(new Array)},or.prototype.getFormFormats=function(){if(this.state.flowFormInfo.flowForm.businessObjectId&&this.tab){var e="web"===this.tab?"PC":"Mobile",t="/api/runtime/wf/v1.0/formFormat/query?param=",r='{"bizCategory":"'+this.state.flowFormInfo.flowForm.businessObjectId+'","terminal":"'+e+'"}';return t+=r=encodeURIComponent(r),this.http.get(t)}return T.from(new Array)},or.decorators=[{type:ne.Component,args:[{selector:"lib-add-execute-form",template:'<div class="f-page f-page-is-managelist">\r\n  \x3c!-- <div class="f-page-header">\r\n    <nav class="f-page-header-base mt-2 py-0" style="min-height: 2rem;">\r\n      <div class="f-title">\r\n        <span class="f-title-icon f-text-orna-bill">\r\n          <i class="f-icon f-icon-page-title-administer"></i>\r\n        </span>\r\n        <h4 class="f-title-text">表单格式列表</h4>\r\n      </div>\r\n      <div class="btn-toolbar btn-group-lg">\r\n        <button class="btn btn-secondary mr-2" (click)="selectOtherFormFormat()">\r\n          引入表单格式\r\n        </button>\r\n        <button class="btn btn-secondary" (click)="selectOtherFunc()">\r\n          引入功能菜单\r\n        </button>\r\n      </div>\r\n    </nav>\r\n  </div> --\x3e\r\n  <div class="f-page-main my-0">\r\n    <div class="f-struct-wrapper f-utils-fill-flex-column">\r\n      <farris-section class="f-section-grid f-section-in-managelist p-2" [showHeader]="false">\r\n        <farris-datagrid class="f-component-grid" [columns]="columns" [data]="forms" #grid\r\n          [idField]="\'id\'" [showLineNumber]="true" [striped]="true"\r\n          [showCheckbox]="false" [virtualized]="true" [pagination]="false" [fit]="true" [fitColumns]="true">\r\n        </farris-datagrid>\r\n      </farris-section>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<ng-template #iconSelectFooter>\r\n  <button type="button" class="btn btn-primary btn-sm mx-2" (click)="clickOK()">确定</button>\r\n  <button type="button" class="btn btn-secondary btn-sm" (click)="clickCancel()">取消</button>\r\n</ng-template>\r\n\r\n<app-rtf-app-help #appHelper (afterHelpConfirm)="funcSelected($event)" [isLayeredLoad]="true">\r\n</app-rtf-app-help>\r\n\r\n\x3c!-- 单据格式帮助 --\x3e\r\n<farris-lookup-grid #lookup style="display: none;" [editable]="false" [columns]="cols" [singleSelect]="true"\r\n  [title]="\'单据格式\'" [displayType]="\'List\'" [uri]="dataUri" [idField]="\'id\'" [pageIndex]="1" [pageSize]="20"\r\n  [pagination]="true" [valueField]="\'id\'" [textField]="\'name\'" [dialogWidth]="550" [dictPicked]="dictPicked"\r\n  [dictPicking]="dictPicking">\r\n</farris-lookup-grid>\r\n',providers:[{provide:X.ServerSideToken,useClass:rr}],styles:[""]}]}],or.ctorParameters=function(){return[{type:me},{type:O.HttpService},{type:O.SessionService},{type:Y.MessagerService}]},or.propDecorators={modalFooter:[{type:ne.ViewChild,args:["iconSelectFooter"]}],appHelper:[{type:ne.ViewChild,args:[p.RtfAppHelpComponent]}],lookUp:[{type:ne.ViewChild,args:["lookup"]}],grid:[{type:ne.ViewChild,args:["grid"]}]},or);function or(e,t,r,i){var n=this;this.state=e,this.http=t,this.session=r,this.message=i,this.submit=new T.Subject,this.cancel=new T.Subject,this.forms=new Array,this.columns=[{field:"code",width:100,title:"编号"},{field:"name",width:100,title:"名称"},{field:"tag",width:80,title:"单据类型",formatter:function(e,t,r){return t.appId?"功能菜单":t.formFormatId?"表单格式":void 0}}],this.cols=[{field:"code",width:100,title:"单据格式编号",searchField:"code"},{field:"name",width:100,title:"单据格式名称",searchField:"name"}],this.dataUri="/api/runtime/wf/v1.0/formFormat/page",this.dictPicking=function(e){return T.of({showDialog:!0,data:{tab:n.tab}})},this.dictPicked=function(e){var t=new Yt;return t.Id=vt.GenerateElementId(),t.Name=e.name,t.ComponentId=null,t.FormType="0",t.formFormatId=e.id,t.TerminalType="web"===n.tab?er:tr,t.ActualParameters=e.urlParameters.map(function(e){var t=new Qt;return t.Name=e.code,t.Value=e.value,t}),n.submit.next(t),T.of({closeDialog:!0})}}var sr=(Object.defineProperty(lr.prototype,"mode",{get:function(){return this._mode},set:function(e){var t=this;"bpmn"===(this._mode=e)?(this.idField="Name",this.cols=[{field:"Name",width:50,title:"编号"},{field:"Value",width:100,title:"参数值",editor:{type:"input-group",options:{groupText:'<i class="f-icon f-icon-lookup"></i>',editable:!1,clickHandle:function(e){e.formControl.setValue(e.instance.value?e.instance.value:""),t.showExprHelp(e)},clear:function(e){console.log("clear",e)}}}}]):(this.idField="code",this.cols=[{field:"code",width:50,title:"编号"},{field:"name",width:50,title:"名称"},{field:"value",width:100,title:"参数值",editor:{type:"input-group",options:{groupText:'<i class="f-icon f-icon-lookup"></i>',editable:!1,clickHandle:function(e){e.formControl.setValue(e.instance.value?e.instance.value:""),t.showExprHelp(e)},clear:function(e){console.log("clear",e)}}}}])},enumerable:!0,configurable:!0}),lr.prototype.ngOnInit=function(){},lr.prototype.showExprHelp=function(t){var e,r,i,n,a,o,s,l,c,d,p,u;if(0<this.designerState.schemas.length){try{for(var f=pe(this.designerState.schemas),h=f.next();!h.done;h=f.next()){var m=h.value;this.expr.addSchema("Schema",m)}}catch(O){e={error:O}}finally{try{h&&!h.done&&(r=f["return"])&&r.call(f)}finally{if(e)throw e.error}}if(this.designerState.schemas[0].entityTypes&&0<this.designerState.schemas[0].entityTypes.length){var v=this.designerState.schemas[0].entityTypes[0];this.expr.addInjectedEntity(v.name,"Schema",v.name,J.InjectedType.EntityType)}}var y=new Array;if(0<this.designerState.procInstContext.length)try{for(var g=pe(this.designerState.procInstContext),b=g.next();!b.done;b=g.next()){var x=b.value;y.push(x)}}catch(V){i={error:V}}finally{try{b&&!b.done&&(n=g["return"])&&n.call(g)}finally{if(i)throw i.error}}if(0<this.designerState.formalParameterContext.length){var w=function(t){y.some(function(e){return e.key===t.key})||y.push(t)};try{for(var C=pe(this.designerState.formalParameterContext),I=C.next();!I.done;I=C.next())w(x=I.value)}catch(L){a={error:L}}finally{try{I&&!I.done&&(o=C["return"])&&o.call(C)}finally{if(a)throw a.error}}}if(0<this.designerState.participantContext.length){var S=function(t){y.some(function(e){return e.key===t.key})||y.push(t)};try{for(var k=pe(this.designerState.participantContext),E=k.next();!E.done;E=k.next())S(x=E.value)}catch(N){s={error:N}}finally{try{E&&!E.done&&(l=k["return"])&&l.call(k)}finally{if(s)throw s.error}}}if(0<this.designerState.processVariableContext.length){var P=function(t){y.some(function(e){return e.key===t.key})||y.push(t)};try{for(var T=pe(this.designerState.processVariableContext),F=T.next();!F.done;F=T.next())P(x=F.value)}catch(B){c={error:B}}finally{try{F&&!F.done&&(d=T["return"])&&d.call(T)}finally{if(c)throw c.error}}}if(0<y.length)try{for(var A=pe(y),M=A.next();!M.done;M=A.next()){var D=M.value;this.expr.addContext(D)}}catch(R){p={error:R}}finally{try{M&&!M.done&&(u=A["return"])&&u.call(A)}finally{if(p)throw p.error}}this.expr.addExpressionText(t.instance.value),this.expr.buildExpression().then(function(e){e&&(t.formControl.setValue(e),t.instance.cd.detectChanges())})},lr.prototype.clickOK=function(){this.grid.endCellEdit(),this.submit.next({parameters:this.parameters,formType:this.formType})},lr.prototype.clickCancel=function(){this.cancel.next()},lr.decorators=[{type:ne.Component,args:[{selector:"lib-parameter-setting",template:'\r\n<div class="f-page f-page-is-managelist">\r\n  <div class="f-page-main my-0">\r\n    <div class="f-struct-wrapper f-utils-fill-flex-column">\r\n      <farris-section class="f-section-grid f-section-in-managelist px-0" [showHeader]="showFormType" [mainTitle]="\'参数\'" [enableMaximize]="false">\r\n        <ng-template farrisSectionToolbar>\r\n          <farris-combo-list [(ngModel)]="formType" name="formType" [idField]="\'value\'" [textField]="\'text\'"\r\n            [enableClear]="false" [valueField]="\'value\'" [data]="formTypeCollection" [panelHeight]="\'auto\'" [editable]="false"\r\n            style="width: 130px;">\r\n          </farris-combo-list>\r\n        </ng-template>\r\n        <farris-datagrid class="f-component-grid" [columns]="cols" [data]="parameters" #grid\r\n          [idField]="idField" [fit]="true" [fitColumns]="true" [editable]="true" [editMode]="\'cell\'" [pagination]="false"\r\n          [showCheckbox]="false" [multiSelect]="false" [showLineNumber]="true" [striped]="true"\r\n          [virtualized]="true">\r\n        </farris-datagrid>\r\n      </farris-section>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<ng-template #iconSelectFooter>\r\n  <button type="button" class="btn btn-primary btn-sm mx-2" (click)="clickOK()">确定</button>\r\n  <button type="button" class="btn btn-secondary btn-sm" (click)="clickCancel()">取消</button>\r\n</ng-template>',styles:[""]}]}],lr.ctorParameters=function(){return[{type:J.ExpressionService},{type:me}]},lr.propDecorators={modalFooter:[{type:ne.ViewChild,args:["iconSelectFooter"]}],grid:[{type:ne.ViewChild,args:["grid"]}]},lr);function lr(e,t){this.expr=e,this.designerState=t,this.idField="Name",this._mode="bpmn",this.submit=new T.Subject,this.cancel=new T.Subject,this.formTypeCollection=[{text:"流程嵌表单",value:"0"},{text:"表单嵌流程",value:"1"}],this.cols=new Array,this.parameters=new Array,this.formType=this.formTypeCollection[0].value,this.showFormType=!1}var cr=(Object.defineProperty(dr.prototype,"value",{set:function(e){if(e){var r=new Array;e.ActualParameters.forEach(function(e){var t=new Qt;t.Name=e.Name,t.Value=e.Value,r.push(t)}),this.form.ActualParameters=r,this.form.Id=e.Id,this.form.Name=e.Name,this.form.ComponentId=e.ComponentId,this.form.formFormatId=e.formFormatId,this.form.formatConfigId=e.formatConfigId,this.form.FormType=e.FormType,this.form.TerminalType=e.TerminalType}},enumerable:!0,configurable:!0}),dr.prototype.ngAfterViewInit=function(){},dr.prototype.ngOnInit=function(){this.location=this.editorParams.location,this.tab=this.editorParams.tab,"userActivity"===this.location?this.showMethodTab=!0:this.showMethodTab=!1},dr.prototype.clickOK=function(){var r=this;new Yt,this.getForm().subscribe(function(e){if(e.result){var t={value:e.form,parameters:null};r.submitModal.emit(t)}})},dr.prototype.clickCancel=function(){this.closeModal.emit()},dr.prototype.getForm=function(){var t=this;return this.form.ComponentId?r.of({result:!0,form:this.form}):this.form.formFormatId?this.configContainer.submit().pipe(F.switchMap(function(e){return e.result?(t.form.formatConfigId=e.configId,r.of({result:!0,form:t.form})):r.of({result:!1,form:t.form})})):r.of({result:!0,form:null})},dr.prototype.parametersSet=function(){var t=this,e=this.resolver.resolveComponentFactory(sr).create(this.injector);e.instance.mode="bpmn","web"===this.tab?(this.form.ComponentId&&(e.instance.showFormType=!0,e.instance.formType=this.form.FormType),e.instance.parameters=fe(this.form.ActualParameters.map(function(e){return Object.assign({},e)}))):e.instance.parameters=fe(this.form.ActualParameters.map(function(e){return Object.assign({},e)}));var r={title:"参数设置",width:620,height:400,showButtons:!0,buttons:e.instance.modalFooter},i=this.modalService.show(e,r);e.instance.submit.subscribe(function(e){"web"===t.tab?(t.form.ActualParameters=e.parameters,t.form.FormType=e.formType):t.form.ActualParameters=e.parameters,i.close()}),e.instance.cancel.subscribe(function(e){i.close()})},dr.prototype.selectExecuteForm=function(){var t=this,e=this.resolver.resolveComponentFactory(ar).create(this.injector);e.instance.tab=this.tab;var r={title:"表单定义列表",width:650,height:400,showButtons:!0,buttons:e.instance.modalFooter},i=this.modalService.show(e,r);e.instance.submit.subscribe(function(e){t.form=e,i.close()}),e.instance.cancel.subscribe(function(e){i.close()})},dr.prototype.clear=function(){this.form=new Yt},dr.decorators=[{type:ne.Component,args:[{selector:"app-execute-forms",template:'  \x3c!-- <div class="h-100 farris-split-section m-2">\r\n    <farris-tabs #tabs [value]="\'web\'" [fill]="true" (tabChange)="tabChange($event)" [contentFill]="true" class="f-utils-fill h-100">\r\n      <farris-tab title="Web表单" [show]="true" [id]="\'web\'" class="h-100">\r\n        <ng-template #content>\r\n          <farris-section class="f-section-form f-section-in-mainsubcard pt-0" [enableAccordion]="\'default\'" [mainTitle]="\'表单定义\'"\r\n            [subTitle]="\'\'" [enableMaximize]="false">\r\n            <div class="farris-form farris-form-controls-inline farris-form-auto f-form-lable-auto">\r\n              <div class="f-section-formgroup-inputs">\r\n                <div class="col-12 col-md-10">\r\n                  <div class="farris-group-wrap">\r\n                    <div class="form-group farris-form-group mb-0">\r\n                      <div class="farris-input-wrap pl-4">\r\n                        <input-group class="form-control" style="width: 100%;padding:0;border:0;" [enableClear]="true"\r\n                          [showButtonWhenDisabled]="false" [(ngModel)]="webForm.Name" name="webForm" [placeholder]="\'请选择\'"\r\n                          [editable]="false" (clickHandle)="selectExecuteForm()" (clear)="clear()" [groupText]="groupIcon">\r\n                        </input-group>\r\n                        <div class="farris-feedback valid-feedback"></div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                <div class="col-12 col-md-2">\r\n                  <div class="farris-group-wrap">\r\n                    <div class="form-group farris-form-group mb-0">\r\n                      <div class="farris-input-wrap">\r\n                        <button [disabled]="!webForm.ComponentId && !webForm.formFormatId" class="btn-sm btn-secondary btn" \r\n                          (click)="parametersSet()">\r\n                          表单参数\r\n                        </button>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </farris-section>\r\n          <farris-section #webConfigSection class="f-section-tabs f-section-in-mainsubcard pb-0 pt-1" [enableAccordion]="\'\'" [mainTitle]="\'表单格式设置\'"\r\n            [subTitle]="\'\'" [enableMaximize]="false" [fill]="true">\r\n            <lib-form-config-container #webConfigContainer *ngIf="webForm.formFormatId; else empty" \r\n            [formFormatId]="webForm.formFormatId" [formatConfigId]="webForm.formatConfigId" [showMethodTab]="showMethodTab" class="h-100"></lib-form-config-container>\r\n          </farris-section>\r\n        </ng-template>\r\n      </farris-tab>\r\n      <farris-tab title="移动表单" [id]="\'mobile\'" class="h-100">\r\n        <ng-template #content>\r\n          <farris-section class="f-section-form f-section-in-mainsubcard pt-0" [enableAccordion]="\'default\'" [mainTitle]="\'表单定义\'"\r\n            [subTitle]="\'\'" [enableMaximize]="false">\r\n            <div class="farris-form farris-form-controls-inline farris-form-auto f-form-lable-auto">\r\n              <div class="f-section-formgroup-inputs">\r\n                <div class="col-12 col-md-10">\r\n                  <div class="farris-group-wrap">\r\n                    <div class="form-group farris-form-group mb-0">\r\n                      <div class="farris-input-wrap pl-4">\r\n                        <input-group class="form-control" style="width: 100%;padding:0;border:0;" [enableClear]="true"\r\n                          [showButtonWhenDisabled]="false" [(ngModel)]="mobileForm.Name" name="mobileForm" [placeholder]="\'请选择\'"\r\n                          [editable]="false" (clickHandle)="selectExecuteForm()" (clear)="clear()" [groupText]="groupIcon">\r\n                        </input-group>\r\n                        <div class="farris-feedback valid-feedback"></div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                <div class="col-12 col-md-2">\r\n                  <div class="farris-group-wrap">\r\n                    <div class="form-group farris-form-group mb-0">\r\n                      <div class="farris-input-wrap">\r\n                        <button [disabled]="!mobileForm.ComponentId && !mobileForm.formFormatId" class="btn-sm btn-secondary btn"\r\n                          (click)="parametersSet()">\r\n                          表单参数\r\n                        </button>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </farris-section>\r\n          <farris-section #appConfigSection class="f-section-tabs f-section-in-mainsubcard pb-0 pt-1" [enableAccordion]="\'\'"\r\n            [mainTitle]="\'表单格式设置\'" [subTitle]="\'\'" [enableMaximize]="false" [fill]="true">\r\n            <lib-form-config-container #appConfigContainer *ngIf="mobileForm.formFormatId; else empty"\r\n              [formFormatId]="mobileForm.formFormatId" [formatConfigId]="mobileForm.formatConfigId" [showMethodTab]="showMethodTab" class="h-100">\r\n            </lib-form-config-container>\r\n          </farris-section>\r\n        </ng-template>\r\n      </farris-tab>\r\n    </farris-tabs>\r\n  </div> --\x3e\r\n  \r\n<ng-template #iconSelectFooter>\r\n  <button type="button" class="btn btn-primary btn-sm mx-2" (click)="clickOK()">确定</button>\r\n  <button type="button" class="btn btn-secondary btn-sm" (click)="clickCancel()">取消</button>\r\n</ng-template>\r\n\r\n<ng-template #empty>\r\n  <div class="f-utils-fill-flex-column h-100">\r\n    <div class="f-datagrid-norecords" style="height: 100%;">\r\n      <div class="f-datagrid-norecords-content w-100">暂无表单格式</div>\r\n    </div>\r\n  </div>\r\n</ng-template>\r\n\r\n<div class="f-page f-page-is-managelist">\r\n  <div class="f-page-main mx-3">\r\n    <div class="farris-form farris-form-controls-inline farris-form-auto f-form-lable-auto">\r\n      <div class="f-section-formgroup-inputs">\r\n        <div class="col-12 col-md-5 px-0 my-2">\r\n          <div class="farris-group-wrap">\r\n            <div class="form-group farris-form-group mb-0">\r\n              <div class="farris-input-wrap">\r\n                <input-group class="form-control" style="width: 100%;padding:0;border:0;" [enableClear]="true"\r\n                  [showButtonWhenDisabled]="false" [(ngModel)]="form.Name" name="form" [placeholder]="\'请选择\'"\r\n                  [editable]="false" (clickHandle)="selectExecuteForm()" (clear)="clear()" [groupText]="groupIcon">\r\n                </input-group>\r\n                <div class="farris-feedback valid-feedback"></div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div class="col-12 col-md-2 my-2 px-0">\r\n          <div class="farris-group-wrap" style="padding-top: 2px;">\r\n            <div class="form-group farris-form-group mb-0">\r\n              <div class="farris-input-wrap">\r\n                <farris-button [disabled]="!form.ComponentId && !form.formFormatId" [type]="\'link\'" (click)="parametersSet()">\r\n                  参数\r\n                </farris-button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <lib-form-config-container #configContainer\r\n      [formFormatId]="form.formFormatId" [formatConfigId]="form.formatConfigId" [showMethodTab]="showMethodTab"\r\n      class="h-100"></lib-form-config-container>\r\n  </div>\r\n</div>\r\n\r\n\r\n\r\n\r\n',providers:[Jt,Wt,Xt],styles:[""]}]}],dr.ctorParameters=function(){return[{type:l.FormBuilder},{type:Jt},{type:Wt},{type:ne.ComponentFactoryResolver},{type:ne.Injector},{type:te.BsModalService}]},dr.propDecorators={cls:[{type:ne.HostBinding,args:["class"]}],style:[{type:ne.HostBinding,args:["style.background"]}],closeModal:[{type:ne.Output}],submitModal:[{type:ne.Output}],value:[{type:ne.Input}],editorParams:[{type:ne.Input}],modalFooter:[{type:ne.ViewChild,args:["iconSelectFooter"]}],configContainer:[{type:ne.ViewChild,args:["configContainer"]}],configSection:[{type:ne.ViewChild,args:["configSection",{read:ne.ElementRef}]}]},dr);function dr(e,t,r,i,n,a){this.formBuilder=e,this.uistate=t,this.viewmodel=r,this.resolver=i,this.injector=n,this.modalService=a,this.modalConfig={title:"表单定义",width:794,height:505,showButtons:!0},this.cls="farris-main-area flex-column",this.style="#FFF",this.closeModal=new ne.EventEmitter,this.submitModal=new ne.EventEmitter,this.editorParams={},this.tab="web",this.groupIcon='<i class="f-icon f-icon-lookup"></i>',this.cols=[],this.showMethodTab=!0,this.form=new Yt}var pr=(ur.prototype.convertTo=function(e){return e?e.Name:"（未设置）"},ur);function ur(){}var fr=(hr.prototype.ngOnInit=function(){var e,t,r,i,n,a,o,s;if(this.contextEntities=new Array,0<this.designerState.procInstContext.length)try{for(var l=pe(this.designerState.procInstContext),c=l.next();!c.done;c=l.next()){var d=c.value;this.contextEntities=this.contextEntities.concat([d])}}catch(I){e={error:I}}finally{try{c&&!c.done&&(t=l["return"])&&t.call(l)}finally{if(e)throw e.error}}if(0<this.designerState.formalParameterContext.length){var p=function(t){u.contextEntities.some(function(e){return e.key===t.key})||(u.contextEntities=u.contextEntities.concat([t]))},u=this;try{for(var f=pe(this.designerState.formalParameterContext),h=f.next();!h.done;h=f.next())p(d=h.value)}catch(S){r={error:S}}finally{try{h&&!h.done&&(i=f["return"])&&i.call(f)}finally{if(r)throw r.error}}}if(0<this.designerState.participantContext.length){var m=function(t){v.contextEntities.some(function(e){return e.key===t.key})||(v.contextEntities=v.contextEntities.concat([t]))},v=this;try{for(var y=pe(this.designerState.participantContext),g=y.next();!g.done;g=y.next())m(d=g.value)}catch(k){n={error:k}}finally{try{g&&!g.done&&(a=y["return"])&&a.call(y)}finally{if(n)throw n.error}}}if(0<this.designerState.processVariableContext.length){var b=function(t){x.contextEntities.some(function(e){return e.key===t.key})||(x.contextEntities=x.contextEntities.concat([t]))},x=this;try{for(var w=pe(this.designerState.processVariableContext),C=w.next();!C.done;C=w.next())b(d=C.value)}catch(E){o={error:E}}finally{try{C&&!C.done&&(s=w["return"])&&s.call(w)}finally{if(o)throw o.error}}}},hr.prototype.clickOK=function(){this.value=this.convertToValue(this.editor.getExpr());var e={value:this.value,parameters:null};this.submitModal.emit(e)},hr.prototype.clickCancel=function(){this.closeModal.emit()},hr.prototype.convertToValue=function(e){return e&&e.substring(9,e.length-2)?e:""},hr.decorators=[{type:ne.Component,args:[{selector:"app-title-expression",template:'\x3c!-- <div class="f-page">\r\n  <div class="f-utils-fill-flex-column farris-split-section m-2">\r\n    <textarea [(ngModel)]="value" name="condition" class="form-control k-textarea h-100 w-100"></textarea>\r\n  </div>\r\n</div> --\x3e\r\n<app-expressioneditor \r\n  [isPanel]="true" [contextEntities]="contextEntities" [text]="value" [customSchemaName]="\'Schema\'"\r\n  [customSchema]="schema" [injectName]="injectName"\r\n  [injectSchemaName]="\'Schema\'" [injectNameInSchema]="injectName">\r\n</app-expressioneditor>\r\n\r\n<ng-template #iconSelectFooter>\r\n  <div class="btns">\r\n    \x3c!-- <button type="button" class="btn btn-primary btn-sm mr-2" (click)="clickOpen()">编辑器</button> --\x3e\r\n    <button type="button" class="btn btn-primary btn-sm mr-2" (click)="clickOK()">确定</button>\r\n    <button type="button" class="btn btn-secondary btn-sm" (click)="clickCancel()">取消</button>\r\n  </div>\r\n</ng-template>',styles:[""]}]}],hr.ctorParameters=function(){return[{type:J.ExpressionService},{type:me}]},hr.propDecorators={closeModal:[{type:ne.Output}],submitModal:[{type:ne.Output}],value:[{type:ne.Input}],modalFooter:[{type:ne.ViewChild,args:["iconSelectFooter"]}],editorParams:[{type:ne.Input}],editor:[{type:ne.ViewChild,args:[J.ExpressioneditorComponent]}]},hr);function hr(e,t){this.expr=e,this.designerState=t,this.closeModal=new ne.EventEmitter,this.submitModal=new ne.EventEmitter,this.editorParams={},this.contextEntities=[],this.schema={},this.injectName="",this.modalConfig={title:"任务描述",width:1140,height:520,showButtons:!0},this.designerState.schemas[0]&&(this.schema=this.designerState.schemas[0],this.designerState.schemas[0].entityTypes&&0<this.designerState.schemas[0].entityTypes.length&&(this.injectName=this.designerState.schemas[0].entityTypes[0].name))}var mr=(vr.prototype.convertTo=function(e){return e||"（未设置）"},vr);function vr(){}var yr=function ws(e,t,r){this.id=e,this.code=t,this.name=r},gr=(br.prototype.ngOnInit=function(){},br.prototype.clickOK=function(){var c=[],e=this.grid.checkeds;e&&0<e.length&&e.forEach(function(e){var t,r,i=new yr(e.data.id,e.data.code,e.data.name);if(i.terminalType=e.data.terminal,i.actualParameters=[],e.data.actualParameters&&0<e.data.actualParameters.length)try{for(var n=pe(e.data.actualParameters),a=n.next();!a.done;a=n.next()){var o=a.value,s={Name:o.code,Value:o.value,ValueText:o.name,Tag:"expression"};i.actualParameters.push(s)}}catch(l){t={error:l}}finally{try{a&&!a.done&&(r=n["return"])&&r.call(n)}finally{if(t)throw t.error}}c.push(i)}),this.submit.emit(c)},br.prototype.clickCancel=function(){this.cancel.emit(!0)},br.decorators=[{type:ne.Component,args:[{selector:"app-customize-action-list",template:'<div class="f-utils-fill-flex-column farris-overflow-y-auto h-100 m-2">\r\n  <farris-datagrid #grid [columns]="cols" [data]="customActionList" [idField]="\'id\'" [fit]="true"\r\n    [fitColumns]="true" [pagination]=\'false\' [multiSelect]="true" [showCheckbox]="true" [multiSelect]="true"\r\n    [checkOnSelect]="true" [selectOnCheck]="true">\r\n  </farris-datagrid>\r\n</div>\r\n\r\n<ng-template #footer>\r\n  <button type="button" class="btn btn-primary btn-sm px-3 mx-2" (click)="clickOK()">确定</button>\r\n  <button type="button" class="btn btn-secondary btn-sm px-3" (click)="clickCancel()">取消</button>\r\n</ng-template>',styles:[""]}]}],br.ctorParameters=function(){return[{type:me}]},br.propDecorators={grid:[{type:ne.ViewChild,args:["grid"]}],footer:[{type:ne.ViewChild,args:["footer"]}],submit:[{type:ne.Output}],cancel:[{type:ne.Output}]},br);function br(e){this.designerUIState=e,this.submit=new ne.EventEmitter,this.cancel=new ne.EventEmitter,this.terminalList=[{value:"app",text:"移动"},{value:"web",text:"web"},{value:"web,app",text:"web,移动"}],this.cols=[{field:"code",width:100,title:"编号"},{field:"name",width:100,title:"名称"},{field:"terminal",width:100,title:"适用终端",formatter:{type:"enum",options:{valueField:"value",textField:"text",data:this.terminalList}}},{field:"isAll",width:100,title:"是否默认",formatter:{type:"boolean",options:{trueText:"是",falseText:"否"}}}],this.customActionList=this.designerUIState.flowFormInfo.customizeActions||[]}var xr=(Object.defineProperty(wr.prototype,"value",{set:function(e){var t,r,i,n;if(e&&0<e.length)try{for(var a=pe(e),o=a.next();!o.done;o=a.next()){var s=o.value,l=new yr(s.id,s.code,s.name);if(l.terminalType=s.terminalType,l.actualParameters=[],s.actualParameters&&0<s.actualParameters.length)try{for(var c=pe(s.actualParameters),d=c.next();!d.done;d=c.next()){var p=d.value,u=new Qt;u.Name=p.Name,u.Value=p.Value,u.ValueText=p.ValueText,u.Tag=p.Tag,l.actualParameters.push(u)}}catch(f){i={error:f}}finally{try{d&&!d.done&&(n=c["return"])&&n.call(c)}finally{if(i)throw i.error}}this.actions.push(l)}}catch(h){t={error:h}}finally{try{o&&!o.done&&(r=a["return"])&&r.call(a)}finally{if(t)throw t.error}}},enumerable:!0,configurable:!0}),wr.prototype.ngOnInit=function(){},wr.prototype.ngAfterViewInit=function(){this.loadData()},wr.prototype.addActions=function(){var s=this,e=this.resolver.resolveComponentFactory(gr).create(this.injector),t={title:"自定义动作选择",width:800,height:520,showButtons:!0,buttons:e.instance.footer},l=this.modalService.show(e,t);e.instance.submit.subscribe(function(e){var t,r;if(e&&0<e.length){var i=function(t){var e=s.actions.findIndex(function(e){return e.code===t.code});-1<e&&s.actions.splice(e,1),s.actions.push(t)};try{for(var n=pe(e),a=n.next();!a.done;a=n.next())i(a.value)}catch(o){t={error:o}}finally{try{a&&!a.done&&(r=n["return"])&&r.call(n)}finally{if(t)throw t.error}}s.loadData()}l.close()}),e.instance.cancel.subscribe(function(e){return l.close()})},wr.prototype["delete"]=function(){var t=this;if(this.actionlist.endCellEdit(),this.actionlist.selectedRow&&this.actionlist.selectedRow.data){var e=this.actions.findIndex(function(e){return e.code===t.actionlist.selectedRow.data.code});this.actions.splice(e,1),this.loadData()}else this.message.info("请首先选中一条选项！")},wr.prototype.clickOK=function(){this.actionlist.endCellEdit(),this.paramlist&&this.paramlist.endCellEdit();var e={value:this.actions,parameters:null};this.submitModal.emit(e)},wr.prototype.clickCancel=function(){this.closeModal.emit()},wr.prototype.loadData=function(){this.actionlist.loadData(this.actions),!(0<this.actions.length)||this.actionlist.selectedRow&&this.actionlist.selectedRow.data?this.curAction=null:this.actionlist.selectRow(this.actions[0].id,!0)},wr.prototype.selectChanged=function(e){this.curAction=e.data},wr.prototype.showExprHelp=function(t){var e,r,i,n,a,o,s,l,c,d,p,u;if(0<this.designerState.schemas.length){try{for(var f=pe(this.designerState.schemas),h=f.next();!h.done;h=f.next()){var m=h.value;this.expr.addSchema("Schema",m)}}catch(O){e={error:O}}finally{try{h&&!h.done&&(r=f["return"])&&r.call(f)}finally{if(e)throw e.error}}if(this.designerState.schemas[0].entityTypes&&0<this.designerState.schemas[0].entityTypes.length){var v=this.designerState.schemas[0].entityTypes[0];this.expr.addInjectedEntity(v.name,"Schema",v.name,J.InjectedType.EntityType)}}var y=new Array;if(0<this.designerState.procInstContext.length)try{for(var g=pe(this.designerState.procInstContext),b=g.next();!b.done;b=g.next()){var x=b.value;y.push(x)}}catch(V){i={error:V}}finally{try{b&&!b.done&&(n=g["return"])&&n.call(g)}finally{if(i)throw i.error}}if(0<this.designerState.formalParameterContext.length){var w=function(t){y.some(function(e){return e.key===t.key})||y.push(t)};try{for(var C=pe(this.designerState.formalParameterContext),I=C.next();!I.done;I=C.next())w(x=I.value)}catch(L){a={error:L}}finally{try{I&&!I.done&&(o=C["return"])&&o.call(C)}finally{if(a)throw a.error}}}if(0<this.designerState.participantContext.length){var S=function(t){y.some(function(e){return e.key===t.key})||y.push(t)};try{for(var k=pe(this.designerState.participantContext),E=k.next();!E.done;E=k.next())S(x=E.value)}catch(N){s={error:N}}finally{try{E&&!E.done&&(l=k["return"])&&l.call(k)}finally{if(s)throw s.error}}}if(0<this.designerState.processVariableContext.length){var P=function(t){y.some(function(e){return e.key===t.key})||y.push(t)};try{for(var T=pe(this.designerState.processVariableContext),F=T.next();!F.done;F=T.next())P(x=F.value)}catch(B){c={error:B}}finally{try{F&&!F.done&&(d=T["return"])&&d.call(T)}finally{if(c)throw c.error}}}if(0<y.length)try{for(var A=pe(y),M=A.next();!M.done;M=A.next()){var D=M.value;this.expr.addContext(D)}}catch(R){p={error:R}}finally{try{M&&!M.done&&(u=A["return"])&&u.call(A)}finally{if(p)throw p.error}}this.expr.addExpressionText(t.instance.value),this.expr.buildExpression().then(function(e){t.formControl.setValue(e),t.instance.cd.detectChanges()})},wr.decorators=[{type:ne.Component,args:[{selector:"app-customize-action",template:'<div class="f-page">\r\n  <div class="f-page-header">\r\n    <nav class="f-page-header-base">\r\n      <div class="f-title">\r\n        <span class="f-title-icon f-text-orna-bill">\r\n          <i class="f-icon f-icon-page-title-administer"></i>\r\n        </span>\r\n        <h4 class="f-title-text">列表</h4>\r\n      </div>\r\n      <div class="btn-toolbar btn-group-lg">\r\n        <button class="btn btn-primary mr-2" (click)="addActions()">新增</button>\r\n        <button class="btn btn-secondary" (click)="delete()">删除</button>\r\n      </div>\r\n    </nav>\r\n  </div>\r\n  <div class="f-page-main f-utils-fill-flex-column h-100">\r\n    <div class="f-utils-fill-flex-column farris-overflow-y-auto h-100">\r\n      <div [style.height.%]="curAction?45:100">\r\n        <farris-datagrid #actionlist [data]="actions" [idField]="\'id\'"\r\n          [columns]="columns" [fit]="true" [fitColumns]="true" [editable]="true"\r\n          [editMode]="\'cell\'" [pagination]="false" [showCheckbox]="false" [multiSelect]="false"\r\n          (selectChanged)="selectChanged($event)" [closeOtherGridEditor]="true">\r\n        </farris-datagrid>\r\n      </div>\r\n      <ng-container *ngIf="curAction">\r\n        <farris-tabs class="f-utils-fill" [value]="\'parameters\'" [contentFill]="true" [autoTitleWidth]="true">\r\n          <farris-tab [title]="\'参数列表\'" [id]="\'parameters\'">\r\n            <ng-template #content>\r\n              <div class="f-utils-fill-flex-column h-100">\r\n                <farris-datagrid #paramlist [data]="curAction.actualParameters" [columns]="paramColumns"\r\n                  [idField]="\'Name\'" [fit]="true" [fitColumns]="true" [editable]="true" [editMode]="\'cell\'"\r\n                  [pagination]="false" [showCheckbox]="false" [multiSelect]="false" [closeOtherGridEditor]="true">\r\n                </farris-datagrid>\r\n              </div>\r\n            </ng-template>\r\n          </farris-tab>\r\n        </farris-tabs>\r\n      </ng-container>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n\r\n<ng-template #iconSelectFooter>\r\n  <button type="button" class="btn btn-primary btn-sm px-3 mx-2" (click)="clickOK()">确定</button>\r\n  <button type="button" class="btn btn-secondary btn-sm px-3" (click)="clickCancel()">取消</button>\r\n</ng-template>',styles:[""]}]}],wr.ctorParameters=function(){return[{type:me},{type:J.ExpressionService},{type:ne.ComponentFactoryResolver},{type:ne.Injector},{type:te.BsModalService},{type:Y.MessagerService}]},wr.propDecorators={cls:[{type:ne.HostBinding,args:["class"]}],closeModal:[{type:ne.Output}],submitModal:[{type:ne.Output}],editorParams:[{type:ne.Input}],modalFooter:[{type:ne.ViewChild,args:["iconSelectFooter"]}],value:[{type:ne.Input}],actionlist:[{type:ne.ViewChild,args:["actionlist"]}],paramlist:[{type:ne.ViewChild,args:["paramlist"]}]},wr);function wr(e,t,r,i,n,a){var o=this;this.designerState=e,this.expr=t,this.resolver=r,this.injector=i,this.modalService=n,this.message=a,this.cls="farris-main-area flex-column",this.closeModal=new ne.EventEmitter,this.submitModal=new ne.EventEmitter,this.editorParams={},this.modalConfig={title:"自定义动作",width:800,height:520,showButtons:!0},this.terminalList=[{value:"app",text:"移动"},{value:"web",text:"web"},{value:"web,app",text:"web,移动"}],this.actions=[],this.columns=[{field:"code",width:100,title:"编号"},{field:"name",width:100,title:"名称"},{field:"terminalType",width:100,title:"适用终端",formatter:{type:"enum",options:{valueField:"value",textField:"text",data:this.terminalList}}}],this.paramColumns=[{field:"Name",width:50,title:"编号"},{field:"ValueText",width:50,title:"名称"},{field:"Value",width:100,title:"参数值",editor:{type:"input-group",options:{groupText:'<i class="f-icon f-icon-lookup"></i>',editable:!1,clickHandle:function(e){e.formControl.setValue(e.instance.value?e.instance.value:""),o.showExprHelp(e)},clear:function(e){console.log("clear",e)}}}}]}var Cr=(Ir.prototype.convertTo=function(e){return e&&0<e.length?"（已设置）":"（未设置）"},Ir);function Ir(){}var Sr=function Cs(){this.id=vt.GenerateElementId(),this.basicType="String"},kr=(Er.prototype.ngOnInit=function(){},Er.prototype.clickOK=function(){this.submitEmitter.emit(this.value)},Er.prototype.clickCancel=function(){this.closeEmitter.emit()},Er.decorators=[{type:ne.Component,args:[{selector:"lib-constant-edit",template:'<div class="f-page">\r\n  <div class="f-utils-fill-flex-column farris-split-section m-2 h-100">\r\n    <section class="f-utils-fill-flex-column h-100">\r\n      <textarea class="form-control" type="text" value="message" [(ngModel)]="value"\r\n        name="message" style="height: 100%;"></textarea>\r\n      <div class="farris-feedback valid-feedback"></div>        \r\n    </section>\r\n  </div>\r\n</div>\r\n\r\n<ng-template #footer>\r\n  <button type="button" class="btn btn-primary btn-sm mx-2" (click)="clickOK()">确定</button>\r\n  <button type="button" class="btn btn-secondary btn-sm" (click)="clickCancel()">取消</button>\r\n</ng-template>',styles:[""]}]}],Er.ctorParameters=function(){return[]},Er.propDecorators={footer:[{type:ne.ViewChild,args:["footer"]}],closeEmitter:[{type:ne.Output}],submitEmitter:[{type:ne.Output}],value:[{type:ne.Input}]},Er);function Er(){this.closeEmitter=new ne.EventEmitter,this.submitEmitter=new ne.EventEmitter}var Pr=(Tr.prototype.getData=function(e,t){var r=t.customData,i=t.pageIndex||1,n=t.pageSize||20,a=t.searchValue;if(r.helpId){var o="?helpId="+r.helpId+"&pageIndex="+i+"&pageSize="+n;return a&&(o+="&searchValue="+a),e+=o,this.http.get(e)}},Tr.decorators=[{type:ne.Injectable}],Tr.ctorParameters=function(){return[{type:O.HttpService}]},Tr);function Tr(e){this.http=e}var Fr=(Ar.prototype.getHelpMetaData=function(e,t){var r="/api/runtime/lcm/v1.0/rt-metadatas/"+e;return this.http.get(r)},Ar.decorators=[{type:ne.Injectable}],Ar.ctorParameters=function(){return[{type:O.HttpService}]},Ar);function Ar(e){this.http=e}var Mr=function Is(){this.Id=vt.GenerateElementId(),this.ActualParameters=new Array},Dr=(Object.defineProperty(Or.prototype,"component",{get:function(){return this._component},set:function(t){var i=this;t&&t.MethodCode?this.service.getHelpMetaData(t.MetadataId,"").subscribe(function(e){var r=JSON.parse(e.content).operations.find(function(e){return e.code===t.MethodCode});if(!r)throw new Error("当前构件已不存在此方法，请更新！");t.ActualParameters=t.ActualParameters.map(function(t){var e=r.parameters.find(function(e){return e.code===t.Name});if(e)return de({},t,{fetchValueMode:e.fetchValueMode,fetchValueSetting:e.fetchValueSetting});throw new Error("当前构件方法参数不一致，请更新！")}),i._component=t}):this._component=new Mr},enumerable:!0,configurable:!0}),Or.prototype.ngOnInit=function(){},Or.prototype.ngAfterViewInit=function(){var e=this;this.ngZone.runOutsideAngular(function(){e.inputGroup.nativeElement.addEventListener("mouseenter",e.onMouseEnter.bind(e)),e.inputGroup.nativeElement.addEventListener("mouseleave",e.onMouseLeave.bind(e))})},Or.prototype.onMouseEnter=function(e){this.showClearButton=!0,this.showClearButton&&this.toggleClearIcon(e,!0)},Or.prototype.onMouseLeave=function(e){this.showClearButton=!1,this.toggleClearIcon(e,!1)},Or.prototype.toggleClearIcon=function(e,t){void 0===t&&(t=!1);var r=t?"":"none",i=e.target.querySelector(".input-group-clear");i&&(i.style.display=r)},Or.prototype.clickOK=function(){this.grid.endCellEdit(),this.validator()?this.submitEmitter.emit(this.component):this.message.info("尚未选择构件方法!")},Or.prototype.clickCancel=function(){this.closeEmitter.emit()},Or.prototype.validator=function(){return!(!this.component.MethodCode||!this.component.MetadataId)},Or.prototype.clear=function(){this.component=new Mr},Or.prototype.selectComponent=function(){var i=this,e=this.resolver.resolveComponentFactory(ee.SelectMetadataRTComponent).create(this.injector);e.instance.typeList="WebServiceComponent",e.instance.selectedMetadata.subscribe(function(e){try{var t=e.metadata;i.openComponentSelectorNew(t.id,i.sessionSrc.getUserSessionId())}catch(r){throw console.log("$event",e),new Error("获取解析构件出错"+e)}});var t=this.modalService.show(e,{title:"构件选择",width:980,height:548,showButtons:!1});e.instance.closeModalEmitter.subscribe(function(e){return t.close()})},Or.prototype.openComponentSelectorNew=function(e,t){var r=this;this.componentService.openSelector(e,t).subscribe(function(e){e.confirmEvent.subscribe(function(e){e&&(r.component.Name=e.name,r.component.MetadataId=e.id,r.component.MethodCode=e.operations[0].code,r.component.ActualParameters=[],e.operations[0].parameters&&0<e.operations[0].parameters.length&&(r.component.ActualParameters=e.operations[0].parameters.map(function(e){return{Name:e.code,Value:"",Tag:-1<e.fetchValueMode.indexOf("express,none")?"expression":"constant",fetchValueMode:e.fetchValueMode,fetchValueSetting:e.fetchValueSetting}})))})})},Or.prototype.showExprHelp=function(t){var e,r,i,n,a,o,s,l,c,d,p,u;if(0<this.designerState.schemas.length){try{for(var f=pe(this.designerState.schemas),h=f.next();!h.done;h=f.next()){var m=h.value;this.expr.addSchema("Schema",m)}}catch(O){e={error:O}}finally{try{h&&!h.done&&(r=f["return"])&&r.call(f)}finally{if(e)throw e.error}}if(this.designerState.schemas[0].entityTypes&&0<this.designerState.schemas[0].entityTypes.length){var v=this.designerState.schemas[0].entityTypes[0];this.expr.addInjectedEntity(v.name,"Schema",v.name,J.InjectedType.EntityType)}}var y=new Array;if(0<this.designerState.procInstContext.length)try{for(var g=pe(this.designerState.procInstContext),b=g.next();!b.done;b=g.next()){var x=b.value;y.push(x)}}catch(V){i={error:V}}finally{try{b&&!b.done&&(n=g["return"])&&n.call(g)}finally{if(i)throw i.error}}if(0<this.designerState.formalParameterContext.length){var w=function(t){y.some(function(e){return e.key===t.key})||y.push(t)};try{for(var C=pe(this.designerState.formalParameterContext),I=C.next();!I.done;I=C.next())w(x=I.value)}catch(L){a={error:L}}finally{try{I&&!I.done&&(o=C["return"])&&o.call(C)}finally{if(a)throw a.error}}}if(0<this.designerState.participantContext.length){var S=function(t){y.some(function(e){return e.key===t.key})||y.push(t)};try{for(var k=pe(this.designerState.participantContext),E=k.next();!E.done;E=k.next())S(x=E.value)}catch(N){s={error:N}}finally{try{E&&!E.done&&(l=k["return"])&&l.call(k)}finally{if(s)throw s.error}}}if(0<this.designerState.processVariableContext.length){var P=function(t){y.some(function(e){return e.key===t.key})||y.push(t)};try{for(var T=pe(this.designerState.processVariableContext),F=T.next();!F.done;F=T.next())P(x=F.value)}catch(B){c={error:B}}finally{try{F&&!F.done&&(d=T["return"])&&d.call(T)}finally{if(c)throw c.error}}}if(0<y.length)try{for(var A=pe(y),M=A.next();!M.done;M=A.next()){var D=M.value;this.expr.addContext(D)}}catch(R){p={error:R}}finally{try{M&&!M.done&&(u=A["return"])&&u.call(A)}finally{if(p)throw p.error}}this.expr.addExpressionText(t.instance.value),this.expr.buildExpression().then(function(e){t.formControl.setValue(e),t.instance.cd.detectChanges()})},Or.prototype.getHelpInfo=function(){return this.service.getHelpMetaData(this.helpId,this.su)},Or.decorators=[{type:ne.Component,args:[{selector:"lib-component-edit",template:'<div class="f-utils-fill-flex-column farris-overflow-y-auto h-100 m-2" style="background:#FFF;">\r\n  <form class="farris-form farris-card-content-bg farris-card-section mx-2">\r\n    <div class="d-flex flex-wrap flex-column mb-2 pr-4">\r\n      <div class="farris-form-controls-inline farris-form-auto mb-2">\r\n        <div class="farris-group-wrap mx-3">\r\n          <div class="form-group">\r\n            <label class="col-form-label">\r\n              <span class="farris-label-info text-danger">*</span>\r\n              <span class="farris-label-text">构件名称</span>\r\n            </label>\r\n            <div class="farris-input-wrap ml-2">\r\n              <input type="text" class="k-textbox form-control" name="name" [(ngModel)]="component.Name" />\r\n              <div class="farris-feedback valid-feedback"></div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class="farris-form-controls-inline farris-form-auto">\r\n        <div class="farris-group-wrap mx-3">\r\n          <div class="form-group">\r\n            <label class="col-form-label">\r\n              <span class="farris-label-info text-danger">*</span>\r\n              <span class="farris-label-text">构件选择</span>\r\n            </label>\r\n            <div class="farris-input-wrap ml-2">\r\n              <div #inputGroup class="input-group">\r\n                <input type="text" class="form-control" [(ngModel)]="component.MethodCode" name="methodCode"\r\n                  [readOnly]="true" />\r\n                <div class="input-group-append">\r\n                  <span [style.display]="showClearButton ? \'\' : \'none\'" class="input-group-text input-group-clear"\r\n                    (click)="clear()">\r\n                    <i class="f-icon modal_close"></i>\r\n                  </span>\r\n                  <span class="input-group-text" (click)="selectComponent()" style="background: #FFF;">\r\n                    <i class="f-icon f-icon-lookup"></i>\r\n                  </span>\r\n                </div>\r\n              </div>\r\n              <div class="farris-feedback valid-feedback"></div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </form>\r\n  <farris-tabs class="f-utils-fill" #params [value]="\'params\'" [contentFill]="true">\r\n    <farris-tab title="参数列表" [id]="\'params\'">\r\n      <ng-template #content>\r\n        <div class="f-utils-fill-flex-column h-100">\r\n          <farris-datagrid #grid [data]="component.ActualParameters" [columns]="columns" [idField]="\'Name\'" [fit]="true"\r\n            [fitColumns]="true" [editable]="true" [editMode]="\'cell\'" [pagination]="false" [showCheckbox]="false" [striped]="true"\r\n            [multiSelect]="false" [afterEdit]="afterEdit" [beforeEdit]="beforeEdit"></farris-datagrid>\r\n        </div>\r\n      </ng-template>\r\n    </farris-tab>\r\n  </farris-tabs>\r\n</div>\r\n\r\n<farris-lookup-grid style="display: none;" #lookup [(ngModel)]="value" [editable]="false" [columns]="helpCols"\r\n  [singleSelect]="true" [title]="title" [displayType]="displayType" [uri]="dataUri"\r\n  [idField]="helpFields.idField" [pagination]="true" [valueField]="helpFields.valueField"\r\n  [textField]="helpFields.textField" [dictPicking]="dictPicking" [dictPicked]="dictPicked">\r\n</farris-lookup-grid>\r\n\r\n<ng-template #footer>\r\n  <button type="button" class="btn btn-primary btn-sm mx-2" (click)="clickOK()">确定</button>\r\n  <button type="button" class="btn btn-secondary btn-sm" (click)="clickCancel()">取消</button>\r\n</ng-template>',providers:[Fr,{provide:X.ServerSideToken,useClass:Pr}],styles:[""]}]}],Or.ctorParameters=function(){return[{type:l.FormBuilder},{type:me},{type:J.ExpressionService},{type:ne.ComponentFactoryResolver},{type:ne.Injector},{type:O.SessionService},{type:te.BsModalService},{type:c.CommonComponentUiRTService},{type:ne.NgZone},{type:Fr},{type:vt},{type:Y.MessagerService}]},Or.propDecorators={cls:[{type:ne.HostBinding,args:["class"]}],grid:[{type:ne.ViewChild,args:[q.DatagridComponent]}],lookup:[{type:ne.ViewChild,args:[X.LookupGridComponent]}],footer:[{type:ne.ViewChild,args:["footer"]}],closeEmitter:[{type:ne.Output}],submitEmitter:[{type:ne.Output}],inputGroup:[{type:ne.ViewChild,args:["inputGroup"]}],component:[{type:ne.Input}]},Or);function Or(e,t,r,i,n,a,o,s,l,c,d,p){var u=this;this.formBuilder=e,this.designerState=t,this.expr=r,this.resolver=i,this.injector=n,this.sessionSrc=a,this.modalService=o,this.componentService=s,this.ngZone=l,this.service=c,this.util=d,this.message=p,this.cls="farris-main-area flex-column",this.closeEmitter=new ne.EventEmitter,this.submitEmitter=new ne.EventEmitter,this.showClearButton=!1,this._component=new Mr,this.columns=[{field:"Name",width:100,title:"参数名"},{field:"Value",width:100,title:"参数值",editor:{type:"input-group",options:{groupText:'<i class="f-icon f-icon-lookup"></i>',editable:!1,clickHandle:function(e){e.formControl.setValue(e.instance.value?e.instance.value:""),u.showExprHelp(e)},clear:function(e){console.log("clear",e)}}}}],this.helpFields={idField:"",valueField:"",textField:""},this.dataUri="/api/runtime/wf/v1.0/dtProcDefs/getHelpData",this.helpCols=[],this.displayType="List",this.title="",this.beforeEdit=function(e){var t=e.rowData;switch(t.fetchValueMode){case f.ParameterFetchValueMode.express:e.column.editor={type:"input-group",options:{groupText:'<i class="f-icon f-icon-lookup"></i>',editable:!1,clickHandle:function(e){e.formControl.setValue(e.instance.value?e.instance.value:""),u.showExprHelp(e)},clear:function(e){console.log("clear",e)}}};break;case f.ParameterFetchValueMode.none:e.column.editor={type:"input-group",options:{groupText:'<i class="f-icon f-icon-lookup"></i>',editable:!1,clickHandle:function(e){e.formControl.setValue(e.instance.value?e.instance.value:""),u.showExprHelp(e)},clear:function(e){console.log("clear",e)}}};break;case f.ParameterFetchValueMode["const"]:case f.ParameterFetchValueMode["enum"]:e.column.editor={type:U.EditorTypes.TEXTBOX,options:{}};break;case f.ParameterFetchValueMode.help:e.column.editor={type:"input-group",options:{groupText:'<i class="f-icon f-icon-lookup"></i>',editable:!1,clickHandle:function(e){u.cell=e,u.helpId=t.fetchValueSetting.helpId,u.su=t.fetchValueSetting.serviceUnit,u.getHelpInfo().subscribe(function(e){console.log(e);var t=e,r=JSON.parse(t.content);u.helpCols=r.dataSource.columns,u.displayType=r.displayType,u.helpFields={idField:r.idField,valueField:r.valueField,textField:r.textField},u.lookup.onClear(),u.lookup.showDialog()},function(e){u.message.error("帮助元数据不存在，请联系系统管理员查看原因！")})},clear:function(e){console.log("clear",e)}}}}return T.of(!0)},this.afterEdit=function(e,t,r){return T.of(!0)},this.dictPicking=function(){return T.of({showDialog:!0,data:{helpId:u.helpId}})},this.dictPicked=function(e){if(u.cell)return console.log(e),u.cell.formControl.setValue(u.util.getValue(e,u.helpFields.valueField)),u.cell.instance.cd.detectChanges(),T.of(!0)}}var Vr=(Lr.prototype.ngOnInit=function(){this.variableSetting&&(this.columns=this.columns.filter(function(e){return"tag"!==e.field&&"valueText"!==e.field&&"description"!==e.field}))},Lr.prototype.add=function(){var e=new Sr;this.value=this.value.concat([e])},Lr.prototype["delete"]=function(){this.grid.endCellEdit();var t=this.grid.selectedRow;t?this.value=this.value.filter(function(e){return e.id!==t.data.id}):this.message.info("尚未选中流程变量！")},Lr.prototype.clickOK=function(){if(this.variableSetting){var e=this.grid.checkeds;0<e.length?this.variableSetEmitter.emit(e):this.message.info("尚未选中流程变量！")}else if(this.grid.endCellEdit(),this.validator()){var t={value:this.value,parameters:null};this.submitModal.emit(t)}},Lr.prototype.clickCancel=function(){this.closeModal.emit()},Lr.prototype.endEdit=function(e){"valueText"===e.column.field&&e.rowData.tag===this.tags[0].value&&(e.rowData.value=e.rowData.valueText)},Lr.prototype.valueEdit=function(e){switch(e.rowData.tag){case this.tags[0].value:this.editConstant(e);break;case this.tags[1].value:this.editExpression(e);break;case this.tags[2].value:this.editComponent(e)}},Lr.prototype.editConstant=function(t){var r,i=t.rowData,e=this.resolver.resolveComponentFactory(kr).create(this.injector);e.instance.value=i.value,e.instance.submitEmitter.subscribe(function(e){t.formControl.setValue(e),t.instance.cd.detectChanges(),i.value=e,r.close()}),e.instance.closeEmitter.subscribe(function(e){r.close()});var n={title:"常量",width:340,height:280,showButtons:!0,buttons:e.instance.footer};r=this.modalService.show(e,n)},Lr.prototype.editExpression=function(t){var e,r,i,n,a,o,s,l,c,d,p,u,f=t.rowData;if(0<this.uistate.schemas.length){try{for(var h=pe(this.uistate.schemas),m=h.next();!m.done;m=h.next()){var v=m.value;this.expr.addSchema("Schema",v)}}catch(V){e={error:V}}finally{try{m&&!m.done&&(r=h["return"])&&r.call(h)}finally{if(e)throw e.error}}if(this.uistate.schemas[0].entityTypes&&0<this.uistate.schemas[0].entityTypes.length){var y=this.uistate.schemas[0].entityTypes[0];this.expr.addInjectedEntity(y.name,"Schema",y.name,J.InjectedType.EntityType)}}var g=new Array;if(0<this.uistate.procInstContext.length)try{for(var b=pe(this.uistate.procInstContext),x=b.next();!x.done;x=b.next()){var w=x.value;g.push(w)}}catch(L){i={error:L}}finally{try{x&&!x.done&&(n=b["return"])&&n.call(b)}finally{if(i)throw i.error}}if(0<this.uistate.formalParameterContext.length){var C=function(t){g.some(function(e){return e.key===t.key})||g.push(t)};try{for(var I=pe(this.uistate.formalParameterContext),S=I.next();!S.done;S=I.next())C(w=S.value)}catch(N){a={error:N}}finally{try{S&&!S.done&&(o=I["return"])&&o.call(I)}finally{if(a)throw a.error}}}if(0<this.uistate.participantContext.length){var k=function(t){g.some(function(e){return e.key===t.key})||g.push(t)};try{for(var E=pe(this.uistate.participantContext),P=E.next();!P.done;P=E.next())k(w=P.value)}catch(B){s={error:B}}finally{try{P&&!P.done&&(l=E["return"])&&l.call(E)}finally{if(s)throw s.error}}}if(0<this.uistate.processVariableContext.length){var T=function(t){g.some(function(e){return e.key===t.key})||g.push(t)};try{for(var F=pe(this.uistate.processVariableContext),A=F.next();!A.done;A=F.next())T(w=A.value)}catch(R){c={error:R}}finally{try{A&&!A.done&&(d=F["return"])&&d.call(F)}finally{if(c)throw c.error}}}if(0<g.length)try{for(var M=pe(g),D=M.next();!D.done;D=M.next()){var O=D.value;this.expr.addContext(O)}}catch(z){p={error:z}}finally{try{D&&!D.done&&(u=M["return"])&&u.call(M)}finally{if(p)throw p.error}}this.expr.setEditPattern(J.ExprEditMode.Advanced),this.expr.addExpressionText(f.value),this.expr.buildExpression().then(function(e){t.formControl.setValue(e),t.instance.cd.detectChanges(),f.value=e})},Lr.prototype.editComponent=function(t){var r,i=t.rowData,e=this.resolver.resolveComponentFactory(Dr).create(this.injector);e.instance.component=i.component,e.instance.submitEmitter.subscribe(function(e){t.formControl.setValue(e.Name+"-"+e.MethodCode),t.instance.cd.detectChanges(),i.value=e.Id,i.component=e,r.close()}),e.instance.closeEmitter.subscribe(function(e){r.close()});var n={title:"构件",width:800,height:515,showButtons:!0,buttons:e.instance.footer};r=this.modalService.show(e,n)},Lr.prototype.validator=function(){var e,t;try{for(var r=pe(this.value),i=r.next();!i.done;i=r.next()){var n=i.value;if(!n.name)return this.message.warning("变量编号不允许为空！"),!1;if(!n.documentation)return this.message.warning("变量名称不允许为空！"),!1;if(!this.IsMatchVariableNameRules(n.name))return this.message.warning("变量编号只能包含字母、数字和下划线，且不能以数字开头！"),!1}}catch(l){e={error:l}}finally{try{i&&!i.done&&(t=r["return"])&&t.call(r)}finally{if(e)throw e.error}}if(1<this.value.length)for(var a=0;a<this.value.length;a++)for(var o=this.value[a].name,s=a+1;s<this.value.length;s++)if(o===this.value[s].name)return this.message.warning("流程变量编号不允许重复！"),!1;return!0},Lr.prototype.IsMatchVariableNameRules=function(e){return!!/^[a-zA-Z_][a-zA-Z_0-9]{0,}/.test(e)},Lr.decorators=[{type:ne.Component,args:[{selector:"lib-process-variables",template:'<div class="f-page">\r\n  <div *ngIf="!variableSetting" class="f-page-header">\r\n    <nav class="f-page-header-base">\r\n      <div class="f-title">\r\n        <span class="f-title-icon f-text-orna-bill">\r\n          <i class="f-icon f-icon-page-title-administer"></i>\r\n        </span>\r\n        <h4 class="f-title-text">列表</h4>\r\n      </div>\r\n      <div class="btn-toolbar btn-group-lg">\r\n        <button class="btn btn-primary mr-2" (click)="add()">新增</button>\r\n        <button class="btn btn-secondary" (click)="delete()">删除</button>\r\n      </div>\r\n    </nav>\r\n  </div>\r\n  <div class="f-page-main f-utils-fill-flex-column h-100">\r\n    <div class="f-utils-fill-flex-column farris-overflow-y-auto h-100">\r\n      <farris-datagrid #grid [data]="value" [columns]="columns" [idField]="\'id\'" [fit]="true" [fitColumns]="true"\r\n        [editable]="!variableSetting" [editMode]="\'cell\'" [pagination]="false" (endEdit)="endEdit($event)" [beforeEdit]="beforeEdit"\r\n        [showCheckbox]="variableSetting" [multiSelect]="variableSetting" [checkOnSelect]="true" [selectOnCheck]="true" [showAllCheckbox]="variableSetting"\r\n        [showLineNumber]="true" [lineNumberTitle]="\'序号\'" [lineNumberWidth]="50" [striped]="true">\r\n      </farris-datagrid>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<ng-template #iconSelectFooter>\r\n  <button type="button" class="btn btn-primary btn-sm px-3 mx-2" (click)="clickOK()">确定</button>\r\n  <button type="button" class="btn btn-secondary btn-sm px-3 mx-2" (click)="clickCancel()">取消</button>\r\n</ng-template>\r\n',styles:[""]}]}],Lr.ctorParameters=function(){return[{type:Y.MessagerService},{type:ne.ComponentFactoryResolver},{type:ne.Injector},{type:te.BsModalService},{type:me},{type:J.ExpressionService}]},Lr.propDecorators={cls:[{type:ne.HostBinding,args:["class"]}],variableSetting:[{type:ne.Input}],closeModal:[{type:ne.Output}],submitModal:[{type:ne.Output}],variableSetEmitter:[{type:ne.Output}],value:[{type:ne.Input}],editorParams:[{type:ne.Input}],modalFooter:[{type:ne.ViewChild,args:["iconSelectFooter"]}],grid:[{type:ne.ViewChild,args:["grid"]}]},Lr);function Lr(e,t,r,i,n,a){var o=this;this.message=e,this.resolver=t,this.injector=r,this.modalService=i,this.uistate=n,this.expr=a,this.cls="farris-main-area flex-column",this.variableSetting=!1,this.closeModal=new ne.EventEmitter,this.submitModal=new ne.EventEmitter,this.variableSetEmitter=new ne.EventEmitter,this.value=new Array,this.editorParams={},this.basicTypes=[{value:"String",text:"字符"},{value:"Integer",text:"整形"},{value:"Decimal",text:"小数"},{value:"Boolean",text:"布尔"}],this.tags=[{value:"constant",text:"常量"},{value:"expression",text:"表达式"},{value:"component",text:"构件"}],this.columns=[{field:"name",width:80,title:"变量编号",sortable:!0,editor:{type:U.EditorTypes.TEXTBOX,options:{}},validators:[{type:"required",messager:"必填"}]},{field:"documentation",width:80,title:"变量名称",sortable:!0,editor:{type:U.EditorTypes.TEXTBOX,options:{}},validators:[{type:"required",messager:"必填"}]},{field:"basicType",width:60,title:"变量类型",sortable:!0,formatter:{type:"enum",options:{valueField:"value",textField:"text",data:this.basicTypes}},editor:{type:U.EditorTypes.COMBOLIST,options:{valueField:"value",textField:"text",data:this.basicTypes,idField:"value",panelHeight:"auto",showClear:!1}},validators:[{type:"required",messager:"必填"}]},{field:"description",width:100,title:"描述",showTips:!0,editor:{type:U.EditorTypes.TEXTBOX,options:{}}},{field:"tag",width:60,title:"初始值类型",sortable:!0,formatter:{type:"enum",options:{valueField:"value",textField:"text",data:this.tags}},editor:{type:U.EditorTypes.COMBOLIST,options:{valueField:"value",textField:"text",data:this.tags,idField:"value",panelHeight:"auto",selectChange:function(t){o.value=o.value.map(function(e){return e.id===t.rowId&&(e.value=null,e.valueText=null,e.component&&(e.component=null)),e})},clear:function(t){o.value=o.value.map(function(e){return e.id===t.rowId&&(e.value=null,e.valueText=null,e.component&&(e.component=null)),e})}}}},{field:"valueText",width:120,title:"初始值",showTips:!0,editor:{type:U.EditorTypes.TEXTBOX,options:{}}}],this.modalConfig={title:"流程变量",width:1070,height:510,showButtons:!0},this.beforeEdit=function(e){var t=e.rowData;if("valueText"===e.column.field){if(!t.tag)return T.of(!1);t.tag===o.tags[0].value?e.column.editor={type:U.EditorTypes.TEXTBOX,options:{}}:e.column.editor={type:"input-group",options:{groupText:'<i class="f-icon f-icon-lookup"></i>',editable:!1,showClear:!1,clickHandle:function(e){e.formControl.setValue(e.instance.value?e.instance.value:""),o.valueEdit(e)},clear:function(e){console.log("clear",e)}}}}return T.of(!0)}}var Nr=(Br.prototype.convertTo=function(e){return e&&0<e.length?"（已设置）":"（未设置）"},Br);function Br(){}var Rr,zr=function Ss(){this.tag="constant",this.enable=!1,this.timeUnit="day",this.expireOperations=new Array},Hr=function ks(){this.id=vt.GenerateElementId(),this.durationType="BeforeDuration",this.timeDuration=0,this.timeUnit="day",this.operationTypeName="SendMessageExpireOperation"},jr=(ce(Ur,Rr=Hr),Ur);function Ur(e){var t=Rr.call(this)||this;return t.cycleEnable=!1,t.cycleTimeUnit="day",t.receiver="activity"===e?"workItemParticipant":"procInstCreator",t.receiverText="activity"===e?"当前节点办理人":"流程发起人",t.subject="超时预警",t.message="activity"===e?"您有一条待办消息即将超时。":"您有一条消息即将超时",t}var qr,Gr=(ce(Kr,qr=Hr),Kr);function Kr(e){var t=qr.call(this)||this;return t.autoHandleType=e,t.message="同意",t}var Jr=(Object.defineProperty(_r.prototype,"value",{get:function(){return this.operation},set:function(e){var t,r,i,n,a;if(this.operation=Object.assign({},e),this.operation.sendType===undefined){var o=new jr(this.location);this.operation.cycleEnable=o.cycleEnable,this.operation.cycleTimeUnit=o.cycleTimeUnit,this.operation.receiver=o.receiver,this.operation.subject=o.subject,this.operation.message=o.message}if(this.operation.receiver&&0<this.operation.receiver.length&&(-1<(a=this.operation.receiver.split(",")).indexOf("workItemParticipant")&&(this.receiverVari="workItemParticipant",this.activityReceiverVar+="workItemParticipant,"),-1<a.indexOf("procInstCreator")&&(this.receiverVari="procInstCreator",this.activityReceiverVar+="procInstCreator,"),-1<a.indexOf("preActExecutors")&&(this.activityReceiverVar+="preActExecutors,"),0<this.activityReceiverVar.length&&(this.activityReceiverVar=this.activityReceiverVar.substring(0,this.activityReceiverVar.length-1)),0<a.length)){a=a.filter(function(e){return"procInstCreator"!==e}),this.bindingData.id="";try{for(var s=pe(a),l=s.next();!l.done;l=s.next()){var c=l.value;this.bindingData.id+=c+","}}catch(u){t={error:u}}finally{try{l&&!l.done&&(r=s["return"])&&r.call(s)}finally{if(t)throw t.error}}this.bindingData.id&&(this.bindingData.id=this.bindingData.id.substring(0,this.bindingData.id.length-1))}if(this.operation.receiverText&&0<this.operation.receiverText.length&&0<(a=this.operation.receiverText.split(",")).length){a=a.filter(function(e){return"流程发起人"!==e}),this.bindingData.name="";try{for(var d=pe(a),p=d.next();!p.done;p=d.next())c=p.value,this.bindingData.name+=c+","}catch(f){i={error:f}}finally{try{p&&!p.done&&(n=d["return"])&&n.call(d)}finally{if(i)throw i.error}}this.bindingData.name&&(this.bindingData.name=this.bindingData.name.substring(0,this.bindingData.name.length-1))}},enumerable:!0,configurable:!0}),_r.prototype.ngOnInit=function(){},_r.prototype.clickOK=function(){this.operation.cycleTime+="","process"===this.location&&this.setReceiver(),"activity"===this.location&&this.setActivityReceiver(),this.validator()&&this.submitEmitter.emit(this.operation)},_r.prototype.clickCancel=function(){this.closeEmitter.emit()},_r.prototype.clear=function(){this.bindingData={}},_r.prototype.setReceiver=function(){var e,t,r="",i="";if(this.receiverVari){r+=this.receiverVari+",";var n=this.receiverVari.split(",");if(0<n.length){var a=function(t){var e=o.receiverVariables.find(function(e){return e.value===t}).name;i+=e+","},o=this;try{for(var s=pe(n),l=s.next();!l.done;l=s.next())a(l.value)}catch(c){e={error:c}}finally{try{l&&!l.done&&(t=s["return"])&&t.call(s)}finally{if(e)throw e.error}}}}this.bindingData.id&&(r+=this.bindingData.id+",",i+=this.bindingData.name+","),r&&(r=r.substring(0,r.length-1)),i&&(i=i.substring(0,i.length-1)),this.operation.receiver=r,this.operation.receiverText=i},_r.prototype.setActivityReceiver=function(){var e="";this.activityReceiverVar&&(e+=this.activityReceiverVar+","),e&&(e=e.substring(0,e.length-1)),this.operation.receiver=e},_r.prototype.validator=function(){return this.operation.sendType?this.operation.subject?this.operation.message?!!this.operation.receiver||(this.message.info("接收人不允许为空！"),!1):(this.message.info("消息内容不允许为空！"),!1):(this.message.info("消息主题不允许为空！"),!1):(this.message.info("发送方式不允许为空！"),!1)},_r.decorators=[{type:ne.Component,args:[{selector:"lib-send-message-operation",template:'<div class="f-page">\r\n  <div class="f-utils-fill-flex-column farris-split-section m-2 h-100">\r\n    <section class="f-utils-fill-flex-column h-100">\r\n      <div class="f-section-header pt-2 mx-2">\r\n        <div class="f-title">\r\n          <h4 class="f-title-text">预警消息设置</h4>\r\n        </div>\r\n      </div>\r\n      <div class="f-utils-fill-flex-column h-100">\r\n        <perfect-scrollbar [config]="{}">\r\n          <form class="h-100">\r\n            <div class="farris-form form-inline farris-form-inline">\r\n              <div class="farris-form-controls-inline">\r\n                <div class="farris-group-wrap">\r\n                  <div class="form-group">\r\n                    <label class="col-form-label pl-1 mr-3">\r\n                      <span class="farris-label-text">启用循环预警</span>\r\n                    </label>\r\n                    <div class="farris-input-wrap mr-5">\r\n                      <farris-switch [(ngModel)]="operation.cycleEnable" name="cycleEnable"></farris-switch>\r\n                      <div class="farris-feedback valid-feedback"></div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div class="farris-form-controls-inline">\r\n                <div class="farris-group-wrap">\r\n                  <div class="form-group" style="width: 100%;">\r\n                    <label class="col-form-label pl-1 mr-3">\r\n                      <span class="farris-label-text">循环时间间隔</span>\r\n                    </label>\r\n                    <div class="farris-input-wrap mr-1" style="width: 35%;">\r\n                      <farris-number-spinner [(ngModel)]="operation.cycleTime" name="cycleTime"\r\n                                             [editable]="true" [precision]="0" [parser]="parser"\r\n                                             [min]="0"></farris-number-spinner>\r\n                      <div class="farris-feedback valid-feedback"></div>\r\n                    </div>\r\n                    <div class="farris-input-wrap mr-5" style="width: 30%;">\r\n                      <farris-combo-list [(ngModel)]="operation.cycleTimeUnit" name="cycleTimeUnit" [idField]="\'value\'" [textField]="\'text\'"\r\n                                         [valueField]="\'value\'" [data]="timeUnitCollection" [panelHeight]="\'auto\'"\r\n                                         [editable]="false" [enableClear]="false">\r\n                      </farris-combo-list>\r\n                      <div class="farris-feedback valid-feedback"></div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div class="farris-group-wrap">\r\n                <div class="form-group farris-form-group">\r\n                  <label class="col-form-label">\r\n                    <span class="farris-label-info text-danger">*</span>\r\n                    <span class="farris-label-text">发送方式</span>\r\n                  </label>\r\n                  <div class="farris-input-wrap ml-1">\r\n                    <farris-checkboxgroup #checkboxGroup [(ngModel)]="operation.sendType" name="sendType" [horizontal]="true"\r\n                      [data]="typeGroup">\r\n                    </farris-checkboxgroup>\r\n                    <div class="farris-feedback valid-feedback"></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div class="farris-group-wrap my-3">\r\n                <div class="form-group farris-form-group">\r\n                  <label class="col-form-label">\r\n                    <span class="farris-label-info text-danger">*</span>\r\n                    <span class="farris-label-text">消息主题</span>\r\n                  </label>\r\n                  <div class="farris-input-wrap ml-1">\r\n                    <input class="form-control" type="text" value="subject" [(ngModel)]="operation.subject" name="subject"\r\n                      [placeholder]="placeholder" />\r\n                    <div class="farris-feedback valid-feedback"></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div class="farris-group-wrap my-3">\r\n                <div class="form-group farris-form-group">\r\n                  <label class="col-form-label">\r\n                    <span class="farris-label-info text-danger">*</span>\r\n                    <span class="farris-label-text">消息内容</span>\r\n                  </label>\r\n                  <div class="farris-input-wrap ml-1">\r\n                    <textarea class="form-control" type="text" value="message" [(ngModel)]="operation.message" name="message"\r\n                      [placeholder]="placeholder2" style="height: 100px;"></textarea>\r\n                    <div class="farris-feedback valid-feedback"></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div *ngIf="location===\'process\'" class="farris-group-wrap">\r\n                <div class="form-group farris-form-group">\r\n                  <label class="col-form-label">\r\n                    <span class="farris-label-info text-danger">*</span>\r\n                    <span class="farris-label-text">接收人</span>\r\n                  </label>\r\n                  <div class="farris-input-wrap ml-1">\r\n                    <div class="pb-2">\r\n                      <farris-checkboxgroup #receiverVariable [(ngModel)]="receiverVari" name="receiverVariable"\r\n                        [horizontal]="true" [data]="receiverVariables">\r\n                      </farris-checkboxgroup>\r\n                    </div>\r\n                    <div>\r\n                      <sys-farris-grid-lookup #userHelp [singleSelect]="false" [displayTxt]="bindingData.name" [pagination]="true"\r\n                        [pageSize]="20" [title]="\'系统用户\'" [sourceType]="\'user\'" [bindingData]="bindingData"\r\n                        [filter]="{notGetCurrentUser:false, notGetStopUser:true}" [typeMode]="1" (clear)="clear()">\r\n                      </sys-farris-grid-lookup>\r\n                    </div>\r\n                    <div class="farris-feedback valid-feedback"></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div *ngIf="location===\'activity\'" class="farris-group-wrap">\r\n                <div class="form-group farris-form-group">\r\n                  <label class="col-form-label">\r\n                    <span class="farris-label-info text-danger">*</span>\r\n                    <span class="farris-label-text">接收人</span>\r\n                  </label>\r\n                  <div class="farris-input-wrap ml-1">\r\n                    <div class="pb-2">\r\n                      <farris-checkboxgroup #receiverVariable1 [(ngModel)]="activityReceiverVar" name="ActivityReceiverVariable"\r\n                                            [horizontal]="true" [data]="activityReceiverVariables">\r\n                      </farris-checkboxgroup>\r\n                    </div>\r\n                    <div class="farris-feedback valid-feedback"></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </form>\r\n        </perfect-scrollbar>\r\n\r\n      </div>\r\n    </section>\r\n  </div>\r\n</div>\r\n\r\n<ng-template #footer>\r\n  <button type="button" class="btn btn-primary btn-sm mx-2" (click)="clickOK()">确定</button>\r\n  <button type="button" class="btn btn-secondary btn-sm mx-2" (click)="clickCancel()">取消</button>\r\n</ng-template>\r\n',styles:[""]}]}],_r.ctorParameters=function(){return[{type:ne.Injector},{type:Y.MessagerService},{type:me}]},_r.propDecorators={footer:[{type:ne.ViewChild,args:["footer"]}],value:[{type:ne.Input}],closeEmitter:[{type:ne.Output}],submitEmitter:[{type:ne.Output}]},_r);function _r(e,t,r){this.injector=e,this.message=t,this.uistate=r,this.operation=new jr("activity"),this.closeEmitter=new ne.EventEmitter,this.submitEmitter=new ne.EventEmitter,this.typeGroup=this.uistate.messageChannels.map(function(e){return{value:e.code,name:e.name}}),this.receiverVariables=[{value:"procInstCreator",name:"流程发起人"}],this.activityReceiverVariables=[{value:"workItemParticipant",name:"当前节点办理人"},{value:"procInstCreator",name:"流程发起人"},{value:"preActExecutors",name:"上一节点办理人"}],this.placeholder="",this.placeholder2="",this.parser=function(e){return Number(e)},this.timeUnitCollection=[{value:"day",text:"天"},{value:"hour",text:"时"},{value:"minute",text:"分"}],this.location="activity",this.activityReceiverVar="",this.bindingData={}}var Wr=(Object.defineProperty($r.prototype,"value",{get:function(){return this.operation},set:function(e){if(this.operation=Object.assign({},e),this.operation.autoHandleType===undefined){var t=new Gr(this.autoHandleType[0].value);this.operation.autoHandleType=t.autoHandleType,this.operation.message=t.message}},enumerable:!0,configurable:!0}),$r.prototype.ngOnInit=function(){},$r.prototype.clickOK=function(){this.validator()&&this.submitEmitter.emit(this.operation)},$r.prototype.clickCancel=function(){this.closeEmitter.emit()},$r.prototype.validator=function(){return this.operation.message?!!this.operation.autoHandleType||(this.message.info("自动办理不允许为空！"),!1):(this.message.info("自动办理意见不允许为空！"),!1)},$r.decorators=[{type:ne.Component,args:[{selector:"lib-auto-handle-operation",template:'<div class="f-page">\r\n  <div class="f-utils-fill-flex-column farris-split-section m-2 h-100">\r\n    <section class="f-utils-fill-flex-column h-100">\r\n      <div class="f-section-header pt-2 mx-2">\r\n        <div class="f-title">\r\n          <h4 class="f-title-text">自动办理设置</h4>\r\n        </div>\r\n      </div>\r\n      <div class="f-utils-fill-flex-column h-100">\r\n        <perfect-scrollbar [config]="{}">\r\n          <form class="h-100">\r\n            <div class="farris-form form-inline farris-form-inline">\r\n              <div class="farris-group-wrap">\r\n                <div class="form-group farris-form-group">\r\n                  <label class="col-form-label">\r\n                    <span class="farris-label-info text-danger">*</span>\r\n                    <span class="farris-label-text">自动办理方式</span>\r\n                  </label>\r\n                  <div class="farris-input-wrap ml-1">\r\n                    <farris-combo-list [(ngModel)]="operation.autoHandleType" name="cycleTimeUnit" [idField]="\'value\'" [textField]="\'text\'"\r\n                                       [valueField]="\'value\'" [data]="autoHandleType" [panelHeight]="\'auto\'"\r\n                                       [editable]="false" [enableClear]="false">\r\n                    </farris-combo-list>\r\n                    <div class="farris-feedback valid-feedback"></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div class="farris-group-wrap my-3">\r\n                <div class="form-group farris-form-group">\r\n                  <label class="col-form-label">\r\n                    <span class="farris-label-info text-danger">*</span>\r\n                    <span class="farris-label-text">自动办理意见</span>\r\n                  </label>\r\n                  <div class="farris-input-wrap ml-1">\r\n                    <textarea class="form-control" type="text" value="message" [(ngModel)]="operation.message" name="message"\r\n                              [placeholder]="placeholder" style="height: 100px;"></textarea>\r\n                    <div class="farris-feedback valid-feedback"></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </form>\r\n        </perfect-scrollbar>\r\n      </div>\r\n    </section>\r\n  </div>\r\n</div>\r\n\r\n<ng-template #footer>\r\n  <button type="button" class="btn btn-primary btn-sm mx-2" (click)="clickOK()">确定</button>\r\n  <button type="button" class="btn btn-secondary btn-sm mx-2" (click)="clickCancel()">取消</button>\r\n</ng-template>\r\n',styles:[""]}]}],$r.ctorParameters=function(){return[{type:Y.MessagerService},{type:me}]},$r.propDecorators={footer:[{type:ne.ViewChild,args:["footer"]}],value:[{type:ne.Input}],submitEmitter:[{type:ne.Output}],closeEmitter:[{type:ne.Output}]},$r);function $r(e,t){var r,i;this.message=e,this.uiState=t,this.placeholder="",this.operation=new Gr("Pass"),this.submitEmitter=new ne.EventEmitter,this.closeEmitter=new ne.EventEmitter,this.autoHandleType=[];try{for(var n=pe(this.uiState.propertyData.ApprovalItems),a=n.next();!a.done;a=n.next()){var o=a.value;this.autoHandleType.push({value:o.Value,text:o.Text})}}catch(s){r={error:s}}finally{try{a&&!a.done&&(i=n["return"])&&i.call(n)}finally{if(r)throw r.error}}}var Xr=(Object.defineProperty(Zr.prototype,"value",{set:function(e){var t,r;this.timeLimitInfo=e||new zr;try{for(var i=pe(this.timeLimitInfo.expireOperations),n=i.next();!n.done;n=i.next()){var a=n.value;a.operationTypeName===undefined&&(a.operationTypeName="SendMessageExpireOperation")}}catch(o){t={error:o}}finally{try{n&&!n.done&&(r=i["return"])&&r.call(i)}finally{if(t)throw t.error}}},enumerable:!0,configurable:!0}),Zr.prototype.ngOnInit=function(){this.location=this.editorParams.location,"activity"===this.location?this.operationTypeName=this.activityOperationTypeName:this.operationTypeName=this.processOperationTypeName,this.cols=[{field:"durationType",width:80,title:"期限类型",formatter:{type:"enum",options:{valueField:"value",textField:"text",data:this.durationTypeCollection}},editor:{type:U.EditorTypes.COMBOLIST,options:{valueField:"value",textField:"text",data:this.durationTypeCollection,idField:"value",panelHeight:"auto",valueChange:this.durationTypeChange,showClear:!1}},validators:[{type:"required",messager:"必填"}]},{field:"timeDuration",width:60,title:"时长",editor:{type:U.EditorTypes.NUMBERBOX,options:{min:0}},validators:[{type:"required",messager:"必填"}]},{field:"timeUnit",width:60,title:"单位",formatter:{type:"enum",options:{valueField:"value",textField:"text",data:this.timeUnitCollection}},editor:{type:U.EditorTypes.COMBOLIST,options:{valueField:"value",textField:"text",data:this.timeUnitCollection,idField:"value",panelHeight:"auto"}},validators:[{type:"required",messager:"必填"}]},{field:"operationTypeName",width:100,title:"操作类型名称",formatter:{type:"enum",options:{valueField:"value",textField:"text",data:this.operationTypeName}},editor:{type:U.EditorTypes.COMBOLIST,options:{valueField:"value",textField:"text",data:this.operationTypeName,idField:"value",panelHeight:"auto"}},validators:[{type:"required",messager:"必填"}]},{field:"sendType",width:80,title:"操作",template:this.cell,validators:[{type:"required",messager:"必填"}]}]},Zr.prototype.clickOK=function(){if(this.grid.endCellEdit(),this.timeLimitInfo.dueTime+="",this.validator()){var e={value:this.timeLimitInfo,parameters:null};this.submitModal.emit(e)}},Zr.prototype.clickCancel=function(){this.closeModal.emit()},Zr.prototype.validator=function(){var e,t;if(this.timeLimitInfo.expireOperations&&0<this.timeLimitInfo.expireOperations.length)try{for(var r=pe(this.timeLimitInfo.expireOperations),i=r.next();!i.done;i=r.next()){var n=i.value;if("SendMessageExpireOperation"===n.operationTypeName&&!(a=n).sendType)return this.message.info("请设置超时操作！"),!1;if("AutoHandleExpireOperation"===n.operationTypeName){var a;if(!(a=n).autoHandleType)return this.message.info("请设置自动办理类型！"),!1;if(!a.message)return this.message.info("请设置自动办理意见！"),!1}}}catch(o){e={error:o}}finally{try{i&&!i.done&&(t=r["return"])&&t.call(r)}finally{if(e)throw e.error}}return!0},Zr.prototype.add=function(){var e=new Hr;this.timeLimitInfo.expireOperations.push(e),this.grid.loadData(this.timeLimitInfo.expireOperations),this.grid.selectRow(e.id)},Zr.prototype.remove=function(){this.grid.endCellEdit();var t=this.grid.selectedRow;if(t){var e=this.timeLimitInfo.expireOperations.findIndex(function(e){return e.id===t.data.id});-1<e&&(this.timeLimitInfo.expireOperations.splice(e,1),this.grid.loadData(this.timeLimitInfo.expireOperations))}else this.message.info("尚未选中预警操作！")},Zr.prototype.editOperation=function(t){var r=this;this.grid.endCellEdit(),"SendMessageExpireOperation"===t.rowData.operationTypeName&&this.sendMassageOperation(t),"AutoHandleExpireOperation"===t.rowData.operationTypeName&&this.message.confirm("下一节点是由当前办理人指派的话，当前节点不支持任务自动办理").subscribe(function(e){return!0===e?r.autoHandleOperation(t):null})},Zr.prototype.sendMassageOperation=function(e){var r,i=this,t=this.resolver.resolveComponentFactory(Jr).create(this.injector);t.instance.location=this.location,t.instance.value=Object.assign({},e.rowData),t.instance.submitEmitter.subscribe(function(t){var e=i.timeLimitInfo.expireOperations.find(function(e){return e.id===t.id});e=Object.assign(e,t),r.close()}),t.instance.closeEmitter.subscribe(function(e){r.close()});var n={title:"预警消息",width:500,height:"activity"===this.location?390:460,buttons:t.instance.footer,showButtons:!0};r=this.modalService.show(t,n)},Zr.prototype.autoHandleOperation=function(e){var r,i=this,t=this.resolver.resolveComponentFactory(Wr).create(this.injector);t.instance.value=Object.assign({},e.rowData),t.instance.submitEmitter.subscribe(function(t){var e=i.timeLimitInfo.expireOperations.find(function(e){return e.id===t.id});e=Object.assign(e,t),r.close()}),t.instance.closeEmitter.subscribe(function(e){r.close()});var n={title:"自动办理",width:500,height:"activity"===this.location?390:460,buttons:t.instance.footer,showButtons:!0};r=this.modalService.show(t,n)},Zr.prototype.tagSelectChange=function(e){"constant"===e.data.value?this.timeLimitInfo.timeUnit="day":"scope"===e.data.value&&(this.timeLimitInfo.timeUnit="",this.timeLimitInfo.dueTime=this.timeScopeValue)},Zr.prototype.changeTimeScope=function(e){this.timeScopeValue=e,this.timeLimitInfo.dueTime=this.timeScopeValue},Zr.decorators=[{type:ne.Component,args:[{selector:"lib-time-limit-control",template:'<div class="f-page">\r\n  <div class="f-utils-fill-flex-column farris-split-section m-2 h-100">\r\n    <section class="f-utils-fill-flex-column h-100">\r\n      <div class="f-section-header pt-2 mx-2">\r\n        <div class="f-title">\r\n          <h4 class="f-title-text">任务处理时效控制</h4>\r\n        </div>\r\n      </div>\r\n      <div class="f-utils-fill-flex-column h-100">\r\n        <form class="h-100">\r\n          <div class="f-utils-fill-flex-column h-100">\r\n            <div class="farris-form-controls-inline">\r\n              <div class="farris-group-wrap">\r\n                <div class="form-group">\r\n                  <label class="col-form-label pl-1 mr-3">\r\n                    <span class="farris-label-text">是否启用</span>\r\n                  </label>\r\n                  <div class="farris-input-wrap mr-5">\r\n                    <farris-switch [(ngModel)]="timeLimitInfo.enable" name="enable"></farris-switch>\r\n                    <div class="farris-feedback valid-feedback"></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div class="farris-form-controls-inline">\r\n              <div class="farris-group-wrap">\r\n                <div class="form-group" style="width: 100%;">\r\n                  <label class="col-form-label pl-1 mr-3">\r\n                    <span class="farris-label-text">任务期限</span>\r\n                  </label>\r\n                  <div class="farris-input-wrap mr-1" style="width: 35%;">\x3c!--name="tag"--\x3e\r\n                    <farris-combo-list [(ngModel)]="timeLimitInfo.tag" [idField]="\'value\'" [textField]="\'text\'" name="tag"\r\n                                       [valueField]="\'value\'" [data]="tagCollection" [panelHeight]="\'auto\'"\r\n                                       [editable]="false" [enableClear]="false" (selectChange)="tagSelectChange($event)">\r\n                    </farris-combo-list>\r\n                    <div class="farris-feedback valid-feedback"></div>\r\n                  </div>\r\n                  <div *ngIf="timeLimitInfo.tag === \'constant\'" class="farris-input-wrap mr-1" style="width: 35%;">\r\n                    <farris-number-spinner [(ngModel)]="timeLimitInfo.dueTime" name="dueTime"\r\n                      [editable]="true" [precision]="0" [parser]="parser"\r\n                      [min]="0"></farris-number-spinner>\r\n                    <div class="farris-feedback valid-feedback"></div>\r\n                  </div>\r\n                  <div *ngIf="timeLimitInfo.tag === \'constant\'" class="farris-input-wrap mr-5" style="width: 30%;">\r\n                    <farris-combo-list [(ngModel)]="timeLimitInfo.timeUnit" name="timeUnit" [idField]="\'value\'" [textField]="\'text\'"\r\n                    [valueField]="\'value\'" [data]="timeUnitCollection" [panelHeight]="\'auto\'"\r\n                    [editable]="false" [enableClear]="false">\r\n                    </farris-combo-list>\r\n                    <div class="farris-feedback valid-feedback"></div>\r\n                  </div>\r\n                  <div *ngIf="timeLimitInfo.tag === \'scope\'" class="farris-input-wrap mr-1" style="width: 65%;">\r\n                    <farris-radiogroup [(ngModel)]="timeLimitInfo.dueTime" name="scope"\r\n                                       [data]="timeScopeCollection"\r\n                                       (changeValue)="changeTimeScope($event)">\r\n                    </farris-radiogroup>\r\n                    <div class="farris-feedback valid-feedback"></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div class="mx-2 mt-3">\r\n              <div class="title-content">\r\n                <h4 class="title-text">时效预警操作</h4><span class="title-line"></span>\r\n              </div>\r\n            </div>\r\n            <div class="mx-2 h-100">\r\n              <farris-tabs class="f-utils-fill h-100" [value]="\'operation\'" [contentFill]="true" [autoTitleWidth]="true">\r\n                <farris-tab [title]="\'操作列表\'" [id]="\'operation\'">\r\n                  <ng-template farrisTabsExtend>\r\n                    <div class="mx-2">\r\n                      <button type="button" (click)="add()"\r\n                        class="btn btn-primary mr-2">新增</button>\r\n                      <button type="button" (click)="remove()"\r\n                        class="btn btn-secondary">删除</button>\r\n                    </div>\r\n                  </ng-template>\r\n                  <ng-template #content>\r\n                    <div class="f-utils-fill-flex-column h-100" style="background: #FFF;">\r\n                      <farris-datagrid #grid [data]="timeLimitInfo.expireOperations" [idField]="\'id\'" [columns]="cols"\r\n                        [fit]="true" [editMode]="\'cell\'" [editable]="true"\r\n                        [fitColumns]="true" [pagination]="false" [showCheckbox]="false" [multiSelect]="false">\x3c!--[beforeEdit]="beforeEdit" [afterEdit]="afterEdit"--\x3e\r\n                      </farris-datagrid>\r\n                    </div>\r\n                  </ng-template>\r\n                </farris-tab>\r\n              </farris-tabs>\r\n            </div>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </section>\r\n  </div>\r\n</div>\r\n\r\n<ng-template #iconSelectFooter>\r\n  <button type="button" class="btn btn-primary btn-sm mx-2" (click)="clickOK()">确定</button>\r\n  <button type="button" class="btn btn-secondary btn-sm" (click)="clickCancel()">取消</button>\r\n</ng-template>\r\n\r\n<ng-template #cell let-ctx>\r\n  <span (click)="editOperation(ctx)" *ngIf="ctx.rowData.operationTypeName === \'SendMessageExpireOperation\'" class="link">\r\n    {{ ctx.rowData.sendType?\'（已设置）\': \'（未设置）\' }}\r\n  </span>\r\n  <span (click)="editOperation(ctx)" *ngIf="ctx.rowData.operationTypeName === \'AutoHandleExpireOperation\'" class="link">\r\n    {{ (ctx.rowData.autoHandleType && ctx.rowData.message)?\'（已设置）\': \'（未设置）\' }}\r\n  </span>\r\n</ng-template>\r\n',styles:[".title-content{color:#000;display:inline-flex;align-items:center;line-height:1.375rem;position:relative;overflow:hidden;padding:0 0 0 1rem;min-width:760px}.title-content ::before{content:'';width:.25rem;height:1.125rem;background:#59a1ff;border-radius:1px;position:absolute;top:50%;left:0;margin-top:-.5625rem}.title-text{font-size:1rem;line-height:1.375rem;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;margin-bottom:0;margin-right:10px}.title-line{flex-grow:1;border-bottom:1px dashed rgba(0,0,0,.1)}.link{color:#1206bb;font-size:14px}.link:hover{color:#5d478b;font-size:14px}"]}]}],Zr.ctorParameters=function(){return[{type:ne.ComponentFactoryResolver},{type:ne.Injector},{type:te.BsModalService},{type:Y.MessagerService}]},Zr.propDecorators={cls:[{type:ne.HostBinding,args:["class"]}],closeModal:[{type:ne.Output}],submitModal:[{type:ne.Output}],value:[{type:ne.Input}],editorParams:[{type:ne.Input}],modalFooter:[{type:ne.ViewChild,args:["iconSelectFooter"]}],cell:[{type:ne.ViewChild,args:["cell"]}],grid:[{type:ne.ViewChild,args:["grid"]}]},Zr);function Zr(e,t,r,i){var n=this;this.resolver=e,this.injector=t,this.modalService=r,this.message=i,this.cls="farris-main-area flex-column",this.closeModal=new ne.EventEmitter,this.submitModal=new ne.EventEmitter,this.editorParams={},this.modalConfig={title:"超时操作",width:580,height:460,showButtons:!0},this.timeLimitInfo=new zr,this.tagCollection=[{value:"constant",text:"固定值"},{value:"scope",text:"时间范围"}],this.timeUnitCollection=[{value:"day",text:"天"},{value:"hour",text:"时"},{value:"minute",text:"分"}],this.durationTypeCollection=[{value:"BeforeDuration",text:"到期之前"},{value:"OnDuration",text:"到期时"},{value:"AfterDuration",text:"到期之后"}],this.activityOperationTypeName=[{value:"SendMessageExpireOperation",text:"超时预警"},{value:"AutoHandleExpireOperation",text:"自动办理"}],this.processOperationTypeName=[{value:"SendMessageExpireOperation",text:"超时预警"}],this.operationTypeName=[],this.timeScopeCollection=[{value:"curDay",name:"当天"}],this.timeScopeValue=this.timeScopeCollection[0].value,this.cols=[],this.location="activity",this.parser=function(e){return Number(e)},this.durationTypeChange=function(t){t&&t.value&&t.value.value===n.durationTypeCollection[1].value&&(n.timeLimitInfo.expireOperations.find(function(e){return e.id===t.rowData.id}).timeDuration=0)}}var Yr=(Qr.prototype.convertTo=function(e){return e&&e.enable?"（已设置）":"（未设置）"},Qr);function Qr(){}var ei=function Es(){this.id=vt.GenerateElementId(),this.subject="消息通知",this.content='{"expr":"\'您有一条消息通知。\'","sexpr":""}'},ti=[{value:"PROCESSINSTANCE_COMPLETED",text:"流程完成"},{value:"PROCESSINSTANCE_ABORTED",text:"流程终止"},{value:"PROCESSINSTANCE_ROLLBACK",text:"流程驳回"}],ri=[{value:"WORKITEM_CREATED",text:"任务创建"},{value:"ACTIVITY_COMPLETED",text:"活动完成"},{value:"ACTIVITY_ABORTED",text:"活动终止"}],ii=(Object.defineProperty(ni.prototype,"location",{get:function(){return this._location},set:function(e){this._location=e,"activity"!==this.location&&(this.receiverVariables=[{value:"procInstCreator",name:"流程发起人"}])},enumerable:!0,configurable:!0}),Object.defineProperty(ni.prototype,"value",{get:function(){return this.messageNotice},set:function(e){var t,r,i,n,a;if(this.messageNotice=Object.assign({},e),this.messageNotice.receiver&&0<this.messageNotice.receiver.length&&(-1<(a=this.messageNotice.receiver.split(",")).indexOf("workItemParticipant")?this.receiverVari="workItemParticipant":-1<a.indexOf("procInstCreator")&&(this.receiverVari="procInstCreator"),0<a.length)){a=a.filter(function(e){return"workItemParticipant"!==e&&"procInstCreator"!==e}),this.bindingData.id="";try{for(var o=pe(a),s=o.next();!s.done;s=o.next()){var l=s.value;this.bindingData.id+=l+","}}catch(p){t={error:p}}finally{try{s&&!s.done&&(r=o["return"])&&r.call(o)}finally{if(t)throw t.error}}this.bindingData.id&&(this.bindingData.id=this.bindingData.id.substring(0,this.bindingData.id.length-1))}if(this.messageNotice.receiverText&&0<this.messageNotice.receiverText.length&&0<(a=this.messageNotice.receiverText.split(",")).length){a=a.filter(function(e){return"任务办理人"!==e&&"流程发起人"!==e}),this.bindingData.name="";try{for(var c=pe(a),d=c.next();!d.done;d=c.next())l=d.value,this.bindingData.name+=l+","}catch(u){i={error:u}}finally{try{d&&!d.done&&(n=c["return"])&&n.call(c)}finally{if(i)throw i.error}}this.bindingData.name&&(this.bindingData.name=this.bindingData.name.substring(0,this.bindingData.name.length-1))}this.exprAble="{"===this.messageNotice.subject.charAt(0)},enumerable:!0,configurable:!0}),ni.prototype.ngOnInit=function(){"activity"===this.location?this.sendTimes=ri:this.sendTimes=ti},ni.prototype.clickOK=function(){this.setReceiver(),this.validator()&&this.submitEmitter.emit(this.messageNotice)},ni.prototype.clickCancel=function(){this.closeEmitter.emit()},ni.prototype.sendTimeChange=function(e){e.data.value===ri[0].value&&(this.receiverVari="workItemParticipant",this.clear())},ni.prototype.usersSelect=function(e){console.log(e)},ni.prototype.changeValue=function(e){console.log(e)},ni.prototype.clear=function(){this.bindingData={}},ni.prototype.setReceiver=function(){var e,t,r="",i="";if(this.receiverVari){r+=this.receiverVari+",";var n=this.receiverVari.split(",");if(0<n.length){var a=function(t){var e=o.receiverVariables.find(function(e){return e.value===t}).name;i+=e+","},o=this;try{for(var s=pe(n),l=s.next();!l.done;l=s.next())a(l.value)}catch(c){e={error:c}}finally{try{l&&!l.done&&(t=s["return"])&&t.call(s)}finally{if(e)throw e.error}}}}this.bindingData.id&&(r+=this.bindingData.id+",",i+=this.bindingData.name+","),r&&(r=r.substring(0,r.length-1)),i&&(i=i.substring(0,i.length-1)),this.messageNotice.receiver=r,this.messageNotice.receiverText=i},ni.prototype.validator=function(){return this.messageNotice.sendType?"messageActivity"===this.location||this.messageNotice.sendTime?this.messageNotice.subject?this.messageNotice.content?!!this.messageNotice.receiver||(this.message.info("接收人不允许为空！"),!1):(this.message.info("消息内容不允许为空！"),!1):(this.message.info("消息主题不允许为空！"),!1):(this.message.info("发送时机不允许为空！"),!1):(this.message.info("发送方式不允许为空！"),!1)},ni.prototype.titleExpr=function(e){this.showTitleHelp(e)},ni.prototype.contentExpr=function(e){this.showContentHelp(e)},ni.prototype.showContentHelp=function(e){var t=this;this.showExpr(),this.messageNotice.content&&0<this.messageNotice.content.length?this.expr.addExpressionText(this.messageNotice.content):this.expr.addExpressionText(""),this.expr.buildExpression().then(function(e){t.messageNotice.content=e})},ni.prototype.showTitleHelp=function(e){var t=this;this.messageNotice.subject&&"{"!==this.messageNotice.subject.charAt(0)&&(this.messageNotice.subject=""),this.showExpr(),this.messageNotice.subject&&0<this.messageNotice.subject.length?this.expr.addExpressionText(this.messageNotice.subject):this.expr.addExpressionText(""),this.expr.buildExpression().then(function(e){t.messageNotice.subject=e})},ni.prototype.showExpr=function(){var e,t,r,i,n,a,o,s;if(0<this.uistate.schemas.length){try{for(var l=pe(this.uistate.schemas),c=l.next();!c.done;c=l.next()){var d=c.value;this.expr.addSchema("Schema",d)}}catch(C){e={error:C}}finally{try{c&&!c.done&&(t=l["return"])&&t.call(l)}finally{if(e)throw e.error}}if(this.uistate.schemas[0].entityTypes&&0<this.uistate.schemas[0].entityTypes.length){var p=this.uistate.schemas[0].entityTypes[0];this.expr.addInjectedEntity(p.name,"Schema",p.name,J.InjectedType.EntityType)}}var u=new Array;if(0<this.uistate.procInstContext.length)try{for(var f=pe(this.uistate.procInstContext),h=f.next();!h.done;h=f.next()){var m=h.value;u.push(m)}}catch(I){r={error:I}}finally{try{h&&!h.done&&(i=f["return"])&&i.call(f)}finally{if(r)throw r.error}}if(0<this.uistate.processVariableContext.length){var v=function(t){u.some(function(e){return e.key===t.key})||u.push(t)};try{for(var y=pe(this.uistate.processVariableContext),g=y.next();!g.done;g=y.next())v(m=g.value)}catch(S){n={error:S}}finally{try{g&&!g.done&&(a=y["return"])&&a.call(y)}finally{if(n)throw n.error}}}if(0<u.length)try{for(var b=pe(u),x=b.next();!x.done;x=b.next()){var w=x.value;this.expr.addContext(w)}}catch(k){o={error:k}}finally{try{x&&!x.done&&(s=b["return"])&&s.call(b)}finally{if(o)throw o.error}}},ni.prototype.tranExpr=function(){this.messageNotice.subject=""},ni.decorators=[{type:ne.Component,args:[{selector:"lib-message-notice-edit",template:'<div class="f-page">\r\n  <div class="f-utils-fill-flex-column farris-split-section m-2 h-100">\r\n    <section class="f-utils-fill-flex-column h-100">\r\n      <div class="f-section-header pt-2 mx-2">\r\n        <div class="f-title">\r\n          <h4 class="f-title-text">消息通知设置</h4>\r\n        </div>\r\n      </div>\r\n      <div class="f-utils-fill-flex-column h-100">\r\n        <perfect-scrollbar [config]="{}">\r\n          <form class="h-100">\r\n            <div class="farris-form form-inline farris-form-inline">\r\n              <div class="farris-group-wrap">\r\n                <div class="form-group farris-form-group">\r\n                  <label class="col-form-label">\r\n                    <span class="farris-label-info text-danger">*</span>\r\n                    <span class="farris-label-text">发送方式</span>\r\n                  </label>\r\n                  <div class="farris-input-wrap ml-1">\r\n                    <farris-checkboxgroup #checkboxGroup [(ngModel)]="messageNotice.sendType" name="sendType" [horizontal]="true"\r\n                      [data]="typeGroup">\r\n                    </farris-checkboxgroup>\r\n                    <div class="farris-feedback valid-feedback"></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div *ngIf="location!==\'messageActivity\'" class="farris-group-wrap my-3">\r\n                <div class="form-group farris-form-group">\r\n                  <label class="col-form-label">\r\n                    <span class="farris-label-info text-danger">*</span>\r\n                    <span class="farris-label-text">发送时机</span>\r\n                  </label>\r\n                  <div class="farris-input-wrap ml-1">\r\n                    <farris-combo-list [(ngModel)]="messageNotice.sendTime" [idField]="\'value\'" [textField]="\'text\'"\r\n                      [enableClear]="false" [data]="sendTimes" name="sendTime" [editable]="false" (selectChange)="sendTimeChange($event)">\r\n                    </farris-combo-list>\r\n                    <div class="farris-feedback valid-feedback"></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div class="farris-group-wrap my-3">\r\n                <div class="form-group farris-form-group">\r\n                  <label class="col-form-label">\r\n                    <span class="farris-label-info text-danger">*</span>\r\n                    <span class="farris-label-text">消息主题</span>\r\n                  </label>\r\n                  <div class="farris-input-wrap ml-1" *ngIf="!exprAble; else disabled">\r\n                    <input class="form-control" type="text" value="subject" [(ngModel)]="messageNotice.subject" name="subject" />\r\n                    <div class="farris-feedback valid-feedback"></div>\r\n                  </div>\r\n                  <ng-template #disabled>\r\n                    <input-group [editable]="false" [customCls]="\'custom-cls\'" [groupText]="groupIcon2"\r\n                                 [(value)]="messageNotice.subject" (clickHandle)="titleExpr($event)">\r\n                    </input-group>\r\n                    <div class="farris-feedback valid-feedback"></div>\r\n                  </ng-template>\r\n                  <label class="col-form-label pl-1 mr-3">\r\n                    <span class="farris-label-text">启用表达式</span>\r\n                  </label>\r\n                  <div class="farris-input-wrap mr-5">\r\n                    <farris-switch [(ngModel)]="exprAble" name="enable" (click)="tranExpr()"></farris-switch>\r\n                    <div class="farris-feedback valid-feedback"></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div class="farris-group-wrap my-3">\r\n                <div class="form-group farris-form-group">\r\n                  <label class="col-form-label">\r\n                    <span class="farris-label-info text-danger">*</span>\r\n                    <span class="farris-label-text">消息内容</span>\r\n                  </label>\r\n                  <div class="farris-input-wrap ml-1">\r\n                    <input-group [editable]="false" [customCls]="\'custom-cls\'" [groupText]="groupIcon2"\r\n                                 [(value)]="messageNotice.content" (clickHandle)="contentExpr($event)">\r\n                    </input-group>\r\n                    <div class="farris-feedback valid-feedback"></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div class="farris-group-wrap">\r\n                <div class="form-group farris-form-group">\r\n                  <label class="col-form-label">\r\n                    <span class="farris-label-info text-danger">*</span>\r\n                    <span class="farris-label-text">接收人</span>\r\n                  </label>\r\n                  <div class="farris-input-wrap ml-1">\r\n                    <div class="pb-2">\r\n                      <farris-checkboxgroup #receiverVariable [(ngModel)]="receiverVari" name="receiverVariable"\r\n                        [horizontal]="true" [data]="receiverVariables" (changeValue)="changeValue($event)">\r\n                      </farris-checkboxgroup>\r\n                    </div>\r\n                    <div *ngIf="messageNotice.sendTime!==\'WORKITEM_CREATED\'">\r\n                      <sys-farris-grid-lookup #userHelp [singleSelect]="false" [displayTxt]="bindingData.name" [pagination]="true"\r\n                        [pageSize]="20" [title]="\'系统用户\'" [sourceType]="\'user\'" (afterConfirm)="usersSelect($event)" [typeMode]="1"\r\n                        [bindingData]="bindingData" [filter]="{notGetCurrentUser:false, notGetStopUser:true}" (clear)="clear()" [required]="false">\r\n                      </sys-farris-grid-lookup>\r\n                    </div>\r\n                    <div class="farris-feedback valid-feedback"></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </form>\r\n        </perfect-scrollbar>\r\n      </div>\r\n    </section>\r\n  </div>\r\n</div>\r\n\r\n<ng-template #footer>\r\n  <button type="button" class="btn btn-primary btn-sm mx-2" (click)="clickOK()">确定</button>\r\n  <button type="button" class="btn btn-secondary btn-sm mx-2" (click)="clickCancel()">取消</button>\r\n</ng-template>\r\n',styles:[""]}]}],ni.ctorParameters=function(){return[{type:Y.MessagerService},{type:me},{type:J.ExpressionService}]},ni.propDecorators={footer:[{type:ne.ViewChild,args:["footer"]}],closeEmitter:[{type:ne.Output}],submitEmitter:[{type:ne.Output}],location:[{type:ne.Input}],value:[{type:ne.Input}]},ni);function ni(e,t,r){this.message=e,this.uistate=t,this.expr=r,this.groupIcon2='<i class="f-icon f-icon-lookup"></i>',this.exprAble=!1,this.closeEmitter=new ne.EventEmitter,this.submitEmitter=new ne.EventEmitter,this._location="activity",this.messageNotice=new ei,this.typeGroup=this.uistate.messageChannels.map(function(e){return{value:e.code,name:e.name}}),this.receiverVariables=[{value:"workItemParticipant",name:"任务办理人"}],this.sendTimes=[],this.bindingData={}}var ai=(Object.defineProperty(oi.prototype,"value",{set:function(e){e&&0<e.length&&(this.messageNotices=e.map(function(e){return{id:vt.GenerateElementId(),content:e.content,sendTime:e.sendTime,sendType:e.sendType,subject:e.subject,receiver:e.receiver,receiverText:e.receiverText}}))},enumerable:!0,configurable:!0}),oi.prototype.ngOnInit=function(){this.location=this.editorParams.location,this.columns=[{field:"subject",width:100,title:"消息主题"},{field:"content",width:150,title:"消息内容",showTips:!0},{field:"sendTime",width:100,title:"发送时机",formatter:{type:"enum",options:{valueField:"value",textField:"text",data:"process"===this.location?ti:ri}}},{field:"sendType",width:100,title:"发送方式",formatter:{type:"enum",options:{valueField:"value",textField:"name",data:this.uistate.messageChannels.map(function(e){return{value:e.code,name:e.name}})}}},{field:"receiverText",width:120,title:"消息接收人",showTips:!0}],"messageActivity"===this.location&&(this.columns=this.columns.filter(function(e){return"sendTime"!==e.field}))},oi.prototype.add=function(){var t,r=this,e=this.resolver.resolveComponentFactory(ii).create(this.injector);e.instance.location=this.location;var i=new ei;"activity"===this.location?(i.sendTime="WORKITEM_CREATED",i.receiver="workItemParticipant",i.receiverText="任务办理人"):"process"===this.location?(i.sendTime="PROCESSINSTANCE_COMPLETED",i.receiver="procInstCreator",i.receiverText="流程发起人"):"messageActivity"===this.location&&(i.receiver="procInstCreator",i.receiverText="流程发起人"),e.instance.value=i,e.instance.submitEmitter.subscribe(function(e){r.messageNotices=r.messageNotices.concat([e]),t.close()}),e.instance.closeEmitter.subscribe(function(e){t.close()});var n={title:"消息通知",width:490,height:"messageActivity"===this.location?450:490,showButtons:!0,buttons:e.instance.footer};t=this.modalService.show(e,n)},oi.prototype.edit=function(){var e=this;if(this.grid.selectedRow){var r,t=this.resolver.resolveComponentFactory(ii).create(this.injector);t.instance.location=this.location,t.instance.value=this.grid.selectedRow.data,t.instance.submitEmitter.subscribe(function(t){e.messageNotices=e.messageNotices.map(function(e){return e.id===t.id?t:e}),r.close()}),t.instance.closeEmitter.subscribe(function(e){r.close()});var i={title:"消息通知",width:490,height:"messageActivity"===this.location?450:490,showButtons:!0,buttons:t.instance.footer};r=this.modalService.show(t,i)}else this.message.info("尚未选中消息通知！")},oi.prototype["delete"]=function(){var t=this.grid.selectedRow;t?this.messageNotices=this.messageNotices.filter(function(e){return e.id!==t.id}):this.message.info("尚未选中消息通知！")},oi.prototype.clickOK=function(){var e={value:this.messageNotices,parameters:null};this.submitModal.emit(e)},oi.prototype.clickCancel=function(){this.closeModal.emit()},oi.decorators=[{type:ne.Component,args:[{selector:"lib-message-notice",template:'<div class="f-page">\r\n  <div class="f-page-header">\r\n    <nav class="f-page-header-base">\r\n      <div class="f-title">\r\n        <span class="f-title-icon f-text-orna-bill">\r\n          <i class="f-icon f-icon-page-title-administer"></i>\r\n        </span>\r\n        <h4 class="f-title-text">列表</h4>\r\n      </div>\r\n      <div class="btn-toolbar btn-group-lg">\r\n        <button class="btn btn-primary mr-2" (click)="add()">新增</button>\r\n        <button class="btn btn-secondary mr-2" (click)="edit()">编辑</button>\r\n        <button class="btn btn-secondary" (click)="delete()">删除</button>\r\n      </div>\r\n    </nav>\r\n  </div>\r\n  <div class="f-page-main f-utils-fill-flex-column h-100">\r\n    <div class="f-utils-fill-flex-column farris-overflow-y-auto h-100">\r\n      <farris-datagrid #grid [data]="messageNotices" [columns]="columns" [idField]="\'id\'" [fit]="true"\r\n        [fitColumns]="true" [editable]="false" [pagination]="false" [showCheckbox]="false"\r\n        [multiSelect]="false" [showLineNumber]="true" [lineNumberTitle]="\'序号\'" [lineNumberWidth]="50" \r\n        [striped]="true">\r\n      </farris-datagrid>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<ng-template #iconSelectFooter>\r\n  <button type="button" class="btn btn-primary btn-sm px-3 mx-2" (click)="clickOK()">确定</button>\r\n  <button type="button" class="btn btn-secondary btn-sm px-3 mx-2" (click)="clickCancel()">取消</button>\r\n</ng-template>\r\n',styles:[""]}]}],oi.ctorParameters=function(){return[{type:ne.ComponentFactoryResolver},{type:ne.Injector},{type:te.BsModalService},{type:Y.MessagerService},{type:me}]},oi.propDecorators={cls:[{type:ne.HostBinding,args:["class"]}],closeModal:[{type:ne.Output}],submitModal:[{type:ne.Output}],value:[{type:ne.Input}],editorParams:[{type:ne.Input}],modalFooter:[{type:ne.ViewChild,args:["iconSelectFooter"]}],grid:[{type:ne.ViewChild,args:["grid"]}]},oi);function oi(e,t,r,i,n){this.resolver=e,this.injector=t,this.modalService=r,this.message=i,this.uistate=n,this.cls="farris-main-area flex-column",this.closeModal=new ne.EventEmitter,this.submitModal=new ne.EventEmitter,this.editorParams={},this.modalConfig={title:"消息通知",width:800,height:515,showButtons:!0},this.messageNotices=new Array,this.columns=[],this.location="activity"}var si=(li.prototype.convertTo=function(e){return e&&0<e.length?"（已设置）":"（未设置）"},li);function li(){}var ci=(Object.defineProperty(di.prototype,"value",{set:function(e){e&&0<e.length&&(this.procExtendProperty=e.map(function(e){return{id:e.id,code:e.code,parentId:e.parentId,sortOrder:e.sortOrder,propertyNote:e.propertyNote,propertyTitle:e.propertyTitle,propertyLocation:e.propertyLocation,propertyType:e.propertyType,enumValue:e.enumValue,bizDefKey:e.bizDefKey,bizCategoryId:e.bizCategoryId,startMode:e.startMode,value:e.value}}))},enumerable:!0,configurable:!0}),di.prototype.setProperty=function(e){this.uiState.propertyData=e.propertyData,this.uiState.propertyConfig=e.propertyConfig},di.prototype.ngOnInit=function(){},di.prototype.clickOK=function(){var e={value:this.procExtendProperty,parameters:null};this.submitModal.emit(e)},di.prototype.cancel=function(){this.closeModal.emit()},di.decorators=[{type:ne.Component,args:[{selector:"lib-extend-property",template:'<div class="f-page">\r\n  <div class="f-page-main">\r\n    <section class="">\r\n      <div class="f-section-header pt-2 mx-2">\r\n      </div>\r\n      <div class="f-section-content">\r\n        <div class="f-form-layout farris-form farris-form-controls-inline">\r\n          <fieldset class="f-section-formgroup"\r\n            style="flex-grow: 1; overflow-y: auto; height: 210px;">\r\n            <div class="f-section-formgroup-inputs">\r\n              <ng-container *ngFor="let data of procExtendProperty">\r\n                \x3c!-- 文本型属性框 --\x3e\r\n                <div *ngIf="data.propertyType === \'text\'" class="col-12 farris-group-auto pr-5">\r\n                  <div class="farris-group-wrap">\r\n                    <div class="form-group farris-form-group">\r\n                      <label class="col-form-label">\r\n                        <span class="farris-label-text">{{data.propertyTitle}}</span>\r\n                      </label>\r\n                      <div class="farris-input-wrap ml-1" style="padding-right: 30px">\r\n                        <input-group [(ngModel)]="data.value"></input-group>\r\n                        <div class="farris-feedback valid-feedback"></div>\r\n                      </div>\r\n                      <span class="f-icon f-icon-info" farrisPopover [popoverTitle]="\'说明\'"\r\n                        [popover]="data.propertyNote" [container]="\'body\'" [triggers]="\'hover\'"\r\n                        [placement]="\'left\'"></span>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                \x3c!-- 枚举型属性框 --\x3e\r\n                  <div *ngIf="data.propertyType === \'enum\'" class="col-12 farris-group-auto pr-5">\r\n                    <div class="farris-group-wrap">\r\n                      <div class="form-group farris-form-group">\r\n                        <label class="col-form-label">\r\n                          <span class="farris-label-text">{{data.propertyTitle}}</span>\r\n                        </label>\r\n                        <div class="farris-input-wrap ml-1" style="padding-right: 30px">\r\n                          <farris-combo-list autoHeight="true" [(ngModel)]="data.value" name="booleanProperty"\r\n                            [idField]="\'value\'" [textField]="\'key\'" [valueField]="\'value\'" [data]="data.enumValue"\r\n                            [placeholder]="\'请选择\'">\r\n                          </farris-combo-list>\r\n                          <div class="farris-feedback valid-feedback"></div>\r\n                        </div>\r\n                        <span class="f-icon f-icon-info" farrisPopover [popoverTitle]="\'说明\'"\r\n                          [popover]="data.propertyNote" [container]="\'body\'" [triggers]="\'hover\'"\r\n                          [placement]="\'left\'"></span>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                \x3c!-- 布尔型属性框 mt-4 --\x3e\r\n                  <div *ngIf="data.propertyType === \'boolean\'" class="col-12 farris-group-auto pr-5">\r\n                    <div class="farris-group-wrap">\r\n                      <div class="form-group farris-form-group">\r\n                        <label class="col-form-label">\r\n                          <span class="farris-label-text">{{data.propertyTitle}}</span>\r\n                        </label>\r\n                        <div class="farris-input-wrap ml-1" style="padding-right: 30px">\r\n                          <farris-combo-list autoHeight="true" [(ngModel)]="data.value" name="booleanProperty"\r\n                            [idField]="\'value\'" [textField]="\'key\'" [valueField]="\'value\'" [data]="booleanlist"\r\n                            [placeholder]="\'请选择\'">\r\n                          </farris-combo-list>\r\n                          <div class="farris-feedback valid-feedback"></div>\r\n                        </div>\r\n                        <span class="f-icon f-icon-info" farrisPopover [popoverTitle]="\'说明\'"\r\n                          [popover]="data.propertyNote" [container]="\'body\'" [triggers]="\'hover\'"\r\n                          [placement]="\'left\'"></span>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n              </ng-container>\r\n            </div>\r\n          </fieldset>\r\n        </div>\r\n      </div>\r\n    </section>\r\n  </div>\r\n</div>\r\n\r\n<ng-template #iconSelectFooter>\r\n  <button type="button" class="btn btn-primary btn-sm mx-2" (click)="clickOK()">确定</button>\r\n  <button type="button" class="btn btn-secondary btn-sm mx-2" (click)="cancel()">取消</button>\r\n</ng-template>\r\n',styles:[""]}]}],di.ctorParameters=function(){return[{type:me}]},di.propDecorators={closeModal:[{type:ne.Output}],submitModal:[{type:ne.Output}],modalFooter:[{type:ne.ViewChild,args:["iconSelectFooter"]}],value:[{type:ne.Input}]},di);function di(e){this.uiState=e,this.closeModal=new ne.EventEmitter,this.submitModal=new ne.EventEmitter,this.modalConfig={title:"扩展属性",width:430,height:370,showButtons:!0},this.procExtendProperty=new Array,this.booleanlist=[{key:"是",value:"true"},{key:"否",value:"false"}],this.extendPropertyList={key:"",value:""}}var pi=(ui.prototype.convertTo=function(e){return e&&e instanceof Array&&e.some(function(e){return e.value})?"（已设置）":"（未设置）"},ui);function ui(){}var fi=(hi.prototype.setProcessProperty=function(e){this.uiState.propertyData=e.propertyData,this.uiState.ProcessVariables=this.uiState.propertyData[pt],this.uiState.propertyConfig=this.setProcessConfig(e.propertyConfig)},hi.prototype.setProcessConfig=function(e){var t=this,r=[];return e&&e.forEach(function(e){t.setProcessEntity(e.properties),r.push(e)}),r},hi.prototype.setProcessEntity=function(e){var t=this;0<e.length&&e.forEach(function(e){switch(e.propertyID){case De:e.editor=Ft,e.converter=new Mt;break;case nt:e.editor=Ut,e.converter=new Gt,e.editorParams={location:"process"};break;case at:e.editor=cr,e.converter=new pr,e.editorParams={location:"process",tab:"web"};break;case ot:e.editor=cr,e.converter=new pr,e.editorParams={location:"process",tab:"mobile"};break;case st:e.editor=fr,e.converter=new mr;break;case Ye:e.iterator=t.uiState.boolIterator;break;case Qe:e.iterator=t.uiState.startModeIterator;break;case Ge:e.iterator=t.uiState.displayTerminal;break;case lt:e.editor=xr,e.converter=new Cr;break;case pt:e.editor=Vr,e.converter=new Nr;break;case ct:e.editor=Xr,e.converter=new Yr,e.editorParams={location:"process"};break;case ft:e.editor=ai,e.converter=new si,e.editorParams={location:"process"};break;default:e.editor=ci,e.converter=new pi}})},hi.decorators=[{type:ne.Injectable}],hi.ctorParameters=function(){return[{type:me}]},hi);function hi(e){this.uiState=e}var mi=function Ps(e,t,r){this.isDefault=!1,this.commentNecessary=!1,this.certification=!1,this.attachmentNecessary=!1,this.value=e,this.text=t,this.workFlowAction=r},vi=function Ts(){},yi=function Fs(){},gi="AssignUser",bi="Transfer",xi="AddSignFront",wi="AddSignBehind",Ci="Notify",Ii=(Object.defineProperty(Si.prototype,"value",{set:function(e){this.assingPerformerConfigForm=new l.FormGroup({multiSelect:new l.FormControl(e.multiSelect),necessary:new l.FormControl(e.necessary)}),this.operator=e.operator||"currentUser",this.allowGlobalAssign=e.allowGlobalAssign||!1,e.assignScope&&(this.organizationLevel=e.assignScope.organizationLevel,this.includeChildren=e.assignScope.includeChildren)},enumerable:!0,configurable:!0}),Si.prototype.ngOnInit=function(){},Si.prototype.clickOK=function(){var t=this;if(this.config={operator:this.operator,multiSelect:this.assingPerformerConfigForm.get("multiSelect").value,necessary:this.assingPerformerConfigForm.get("necessary").value,allowGlobalAssign:this.allowGlobalAssign},this.allowGlobalAssign&&this.organizationLevel!==this.organizationLevelCollection[0].value){var e=new yi;e.actionScope=gi,e.organizationLevel=this.organizationLevel,e.organizationId=this.organizationLevelCollection.find(function(e){return e.value===t.organizationLevel}).orgId,e.organizationName=this.organizationLevelCollection.find(function(e){return e.value===t.organizationLevel}).text,e.includeChildren=this.includeChildren,e.tag="variable",this.config.assignScope=e}var r={value:this.config,parameters:null};this.submitModal.emit(r)},Si.prototype.clickCancel=function(){this.closeModal.emit()},Si.prototype.valueChange=function(e){switch(e.value){case this.organizationLevelCollection[0].value:this.includeChildren=!1;break;case this.organizationLevelCollection[1].value:this.includeChildren=!0;break;case this.organizationLevelCollection[2].value:this.includeChildren=!1}},Si.decorators=[{type:ne.Component,args:[{selector:"app-assign-performer-config",template:'<div class="f-page">\r\n  <div class="f-utils-fill-flex-column farris-split-section m-2 h-100">\r\n    <section class="f-utils-fill-flex-column h-100">\r\n      <div class="f-section-header pt-2 mx-2">\r\n        <div class="f-title">\r\n          <h4 class="f-title-text">指派规则选项</h4>\r\n        </div>\r\n      </div>\r\n      <div class="f-utils-fill-flex-column h-100">\r\n        <form class="h-100" [formGroup]="assingPerformerConfigForm">\r\n          <div class="f-utils-fill-flex-column justify-content-center h-100 pb-4">\r\n            <div class="my-2 mx-5">\r\n              <div class="farris-group-wrap">\r\n                <div class="form-group">\r\n                  <label class="col-form-label">\r\n                    <span class="farris-label-text">指派操作人</span>\r\n                  </label>\r\n                  <div class="farris-input-wrap mt-1" style="width: 300px;">\r\n                    <farris-combo-list [(ngModel)]="operator" name="operator" [ngModelOptions]="{standalone: true}"\r\n                      [idField]="\'value\'" [textField]="\'text\'" [valueField]="\'value\'" [data]="operatorCollection"\r\n                      [panelHeight]="60">\r\n                    </farris-combo-list>\r\n                    <div class="farris-feedback valid-feedback"></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div class="my-2 mx-5">\r\n              <div class="farris-input-wrap">\r\n                <div class="custom-control custom-checkbox">\r\n                  <input class="custom-control-input" type="checkbox" id="multiSelect" formControlName="multiSelect"\r\n                    [readOnly]="false" />\r\n                  <label class="custom-control-label" for="multiSelect">允许选择多个待选用户</label>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div class="my-2 mx-5">\r\n              <div class="farris-input-wrap">\r\n                <div class="custom-control custom-checkbox">\r\n                  <input class="custom-control-input" type="checkbox" id="necessary" formControlName="necessary" [readOnly]="false" />\r\n                  <label class="custom-control-label" for="necessary">只有一个待选用户时，仍需手工选择</label>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div class="mx-2 mt-3">\r\n              <div class="title-content">\r\n                <h4 class="title-text">设定的参与者范围外指派</h4><span class="title-line"></span>\r\n              </div>\r\n            </div>\r\n            <div class="farris-form form-inline farris-form-inline my-1">\r\n              <div class="col-12 mt-3">\r\n                <div class="farris-group-wrap">\r\n                  <div class="form-group farris-form-group">\r\n                    <label class="col-form-label">\r\n                      <span class="farris-label-text">是否启用</span>\r\n                    </label>\r\n                    <div class="farris-input-wrap ml-1">\r\n                      <farris-switch [(ngModel)]="allowGlobalAssign" [ngModelOptions]="{standalone: true}" name="allowGlobalAssign"></farris-switch>\r\n                      <div class="farris-feedback valid-feedback"></div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div class="d-flex flex-row">\r\n                <div class="col-8 my-2">\r\n                  <div class="farris-group-wrap">\r\n                    <div class="form-group farris-form-group">\r\n                      <label class="col-form-label">\r\n                        <span class="farris-label-text">组织范围</span>\r\n                      </label>\r\n                      <div class="farris-input-wrap ml-1">\r\n                        <farris-combo-list [panelHeight]="100" [(ngModel)]="organizationLevel" [ngModelOptions]="{standalone: true}"\r\n                          name="organizationLevel" [idField]="\'value\'" [textField]="\'text\'" [valueField]="\'value\'"\r\n                          [data]="organizationLevelCollection" [readonly]="allowGlobalAssign===false" (valueChange)="valueChange($event)">\r\n                        </farris-combo-list>\r\n                        <div class="farris-feedback valid-feedback"></div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                <div class="col-4 my-2">\r\n                  <div class="farris-input-wrap pt-1">\r\n                    <div class="custom-control custom-checkbox mr-3">\r\n                      <input class="custom-control-input" type="checkbox" [(ngModel)]="includeChildren" [ngModelOptions]="{standalone: true}"\r\n                        name="includeChildren" id="includeChildren" [disabled]="!(allowGlobalAssign===true && organizationLevel === organizationLevelCollection[2].value)" />\r\n                      <label class="custom-control-label" for="includeChildren">包含下级</label>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </section>\r\n  </div>\r\n</div>\r\n\r\n<ng-template #iconSelectFooter>\r\n  <button type="button" class="btn btn-primary btn-sm px-3 mx-2" (click)="clickOK()">确定</button>\r\n  <button type="button" class="btn btn-secondary btn-sm px-3 mx-2" (click)="clickCancel()">取消</button>\r\n</ng-template>\r\n\r\n',styles:[".title-content{color:#000;display:inline-flex;align-items:center;line-height:1.375rem;position:relative;overflow:hidden;padding:0 0 0 1rem;min-width:415px}.title-content ::before{content:'';width:.25rem;height:1.125rem;background:#59a1ff;border-radius:1px;position:absolute;top:50%;left:0;margin-top:-.5625rem}.title-text{font-size:1rem;line-height:1.375rem;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;margin-bottom:0;margin-right:10px}.title-line{flex-grow:1;border-bottom:1px dashed rgba(0,0,0,.1)}"]}]}],Si.ctorParameters=function(){return[]},Si.propDecorators={cls:[{type:ne.HostBinding,args:["class"]}],closeModal:[{type:ne.Output}],submitModal:[{type:ne.Output}],value:[{type:ne.Input}],modalFooter:[{type:ne.ViewChild,args:["iconSelectFooter"]}]},Si);function Si(){this.cls="farris-main-area flex-column",this.closeModal=new ne.EventEmitter,this.submitModal=new ne.EventEmitter,this.allowGlobalAssign=!1,this.operatorCollection=[{text:"当前办理人",value:"currentUser"},{text:"流程发起人",value:"procInstCreator"}],this.operator="currentUser",this.organizationLevelCollection=[{value:"GLOBAL",text:"全员",orgId:"global"},{value:"UNIT",text:"本单位",orgId:"currentUnit"},{value:"DEPARTMENT",text:"本部门",orgId:"currentDepartment"}],this.organizationLevel=this.organizationLevelCollection[0].value,this.includeChildren=!1,this.modalConfig={title:"指派规则",width:450,height:470,showButtons:!0}}var ki=(Ei.prototype.convertTo=function(e){return"（已设置）"},Ei);function Ei(){}var Pi=function As(){},Ti=(Object.defineProperty(Fi.prototype,"value",{set:function(e){var t,r;if(e&&0<e.length)try{for(var i=pe(e),n=i.next();!n.done;n=i.next()){var a=n.value,o=new Pi;o.id=vt.GenerateElementId(),o.conclusionValue=a.ConclusionValue,o.conclusionName=a.ConclusionName,o.calculateType=a.CalculateType?a.CalculateType:"null",o.conditionValue=a.ConditionValue?a.ConditionValue:0,o.waitAllVotes=!!a.WaitAllVotes&&a.WaitAllVotes,o.completionCondition=a.CompletionCondition?a.CompletionCondition._value:null,this.data.push(o)}}catch(s){t={error:s}}finally{try{n&&!n.done&&(r=i["return"])&&r.call(i)}finally{if(t)throw t.error}}else this.deleteRow()},enumerable:!0,configurable:!0}),Fi.prototype.ngOnInit=function(){this.counterSignVariables=this.designerUIState.counterSignVariables||[],this.approvalItems=this.designerUIState.approvalItems||[]},Fi.prototype.deleteRow=function(){var e,t;this.data=[];var r=this.designerUIState.approvalItems||[];if(r&&0<r.length)try{for(var i=pe(r),n=i.next();!n.done;n=i.next()){var a=n.value,o=new Pi;"Pass"===a.value?(o.id=vt.GenerateElementId(),o.conclusionValue=a.value,o.conclusionName=a.text,o.calculateType="byProportion",o.conditionValue="100"):"Back"===a.value?(o.id=vt.GenerateElementId(),o.conclusionValue=a.value,o.conclusionName=a.text,o.calculateType="byNumber",o.conditionValue="1"):(o.id=vt.GenerateElementId(),o.conclusionValue=a.value,o.conclusionName=a.text,o.calculateType="null",o.conditionValue="0"),o.waitAllVotes=!0,this.data.push(o)}}catch(s){e={error:s}}finally{try{n&&!n.done&&(t=i["return"])&&t.call(i)}finally{if(e)throw e.error}}},Fi.prototype.clickOK=function(){if(this.grid.endCellEdit(),0===this.data.length)this.message.warning("完成策略为会签时，会签规则不允许为空，请了解！");else{var e={value:this.data,parameters:null};this.submitModal.emit(e)}},Fi.prototype.clickCancel=function(){this.closeModal.emit()},Fi.prototype.editConditon=function(t){var e,r;if(this.counterSignVariables&&0<this.counterSignVariables.length)try{for(var i=pe(this.counterSignVariables),n=i.next();!n.done;n=i.next()){var a=n.value;this.exprService.addContext(a)}}catch(o){e={error:o}}finally{try{n&&!n.done&&(r=i["return"])&&r.call(i)}finally{if(e)throw e.error}}this.exprService.setEditPattern(J.ExprEditMode.Advanced),this.exprService.addExpressionText(t.instance.value),this.exprService.buildExpression().then(function(e){t.formControl.setValue(e),t.instance.cd.detectChanges()})},Fi.prototype.approvalSelect=function(){var e,t,r=this.apvlItemsGrid.checkeds;if(r&&0<r.length){try{for(var i=pe(r),n=i.next();!n.done;n=i.next()){var a=n.value,o=new Pi;o.id=vt.GenerateElementId(),o.conclusionValue=a.data.value,o.conclusionName=a.data.text,this.data.push(o)}}catch(s){e={error:s}}finally{try{n&&!n.done&&(t=i["return"])&&t.call(i)}finally{if(e)throw e.error}}this.grid.loadData(this.data),this.apvlItemDialog.close()}else this.message.info("请首先选中一条审批项！")},Fi.prototype.endEdit=function(e){this.curValue=e.rowData,this.preValue.completionCondition!==this.curValue.completionCondition?(this.data[e.rowIndex].calculateType="null",this.data[e.rowIndex].conditionValue="0",this.data[e.rowIndex].waitAllVotes=!1):this.preValue.calculateType===this.curValue.calculateType&&this.preValue.conditionValue===this.curValue.conditionValue&&this.preValue.waitAllVotes===this.curValue.waitAllVotes||(this.data[e.rowIndex].completionCondition=null),"conditionValue"===e.column.field&&"byProportion"===this.data[e.rowIndex].calculateType&&100<Number.parseInt(e.value)?(this.message.info("条件值最大值是100"),this.data[e.rowIndex].conditionValue="100"):"conditionValue"===e.column.field&&Number.parseInt(e.value)<0?(this.message.info("条件值最小值是0"),this.data[e.rowIndex].conditionValue="0"):"calculateType"!==e.column.field&&"conditionValue"!==e.column.field||"oneVote"!==this.data[e.rowIndex].calculateType&&"fullVote"!==this.data[e.rowIndex].calculateType||0===Number.parseInt(this.data[e.rowIndex].conditionValue)?"calculateType"===e.column.field&&"byProportion"===this.data[e.rowIndex].calculateType&&100<Number.parseInt(this.data[e.rowIndex].conditionValue)&&(this.message.info("条件值最大值是100"),this.data[e.rowIndex].conditionValue="100"):(this.message.info("结论执行方式为全票或一票时不需要条件值"),this.data[e.rowIndex].conditionValue="0")},Fi.decorators=[{type:ne.Component,args:[{selector:"app-sign-rule",template:'<div class="f-page">\r\n  <div class="f-page-header">\r\n    <nav class="f-page-header-base">\r\n      <div class="f-title">\r\n        <span class="f-title-icon f-text-orna-bill">\r\n          <i class="f-icon f-icon-page-title-administer"></i>\r\n        </span>\r\n        <h4 class="f-title-text">规则列表</h4>\r\n      </div>\r\n      <div class="btn-toolbar btn-group-lg">\r\n      </div>\r\n    </nav>\r\n  </div>\r\n  <div class="f-page-main f-utils-fill-flex-column h-100">\r\n    <div class="f-utils-fill-flex-column farris-overflow-y-auto h-100">\r\n      <farris-datagrid #grid [data]="data" [columns]="columns" [idField]="\'id\'" [fit]="true"\r\n        [fitColumns]="true" [editable]="true" [editMode]="\'cell\'" [pagination]="false" [showCheckbox]="false"\r\n        [multiSelect]="false" [afterEdit]=\'afterEdit\' (endEdit)="endEdit($event)">\r\n      </farris-datagrid>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<ng-template #iconSelectFooter>\r\n  <button type="button" class="btn btn-primary btn-sm px-3 mx-2" (click)="clickOK()">确定</button>\r\n  <button type="button" class="btn btn-secondary btn-sm px-3 mx-2" (click)="deleteRow()">重置</button>\r\n  <button type="button" class="btn btn-secondary btn-sm px-3 mx-2" (click)="clickCancel()">取消</button>\r\n</ng-template>\r\n\r\n<farris-dialog #approvalItemDialog [buttons]="buttonRef" [width]="700" [height]="520" [title]="\'审批选项\'">\r\n  <div class="f-utils-fill-flex-column farris-overflow-y-auto h-100 m-2">\r\n      <farris-datagrid #approvalTable [columns]="approvalCols" [data]="approvalItems" [idField]="\'value\'"\r\n        [fit]="true" [fitColumns]="true" [pagination]=\'false\' [multiSelect]="true"\r\n        [showCheckbox]="true" [multiSelect]="true" [checkOnSelect]="true" [selectOnCheck]="true">\r\n      </farris-datagrid>\r\n  </div>\r\n</farris-dialog>\r\n<ng-template #buttonRef>\r\n  <button class="btn btn-sm btn-primary px-3 mx-2" (click)="approvalSelect()">确定</button>\r\n  <button class="btn btn-secondary btn-sm px-3 mx-2" (click)="approvalItemDialog.close()">取消</button>\r\n</ng-template>\r\n',styles:[""]}]}],Fi.ctorParameters=function(){return[{type:l.FormBuilder},{type:Y.MessagerService},{type:J.ExpressionService},{type:me}]},Fi.propDecorators={cls:[{type:ne.HostBinding,args:["class"]}],closeModal:[{type:ne.Output}],submitModal:[{type:ne.Output}],value:[{type:ne.Input}],editorParams:[{type:ne.Input}],modalFooter:[{type:ne.ViewChild,args:["iconSelectFooter"]}],apvlItemsGrid:[{type:ne.ViewChild,args:["approvalTable"]}],apvlItemDialog:[{type:ne.ViewChild,args:["approvalItemDialog"]}],grid:[{type:ne.ViewChild,args:["grid"]}]},Fi);function Fi(e,t,r,i){var n=this;this.formBuilder=e,this.message=t,this.exprService=r,this.designerUIState=i,this.cls="farris-main-area flex-column",this.closeModal=new ne.EventEmitter,this.submitModal=new ne.EventEmitter,this.editorParams={},this.modalConfig={title:"会签规则",width:800,height:520,showButtons:!0},this.data=[],this.calculationMethods=[{text:"按数量",value:"byNumber"},{text:"按比例(%)",value:"byProportion"},{text:"自定义条件",value:"null"}],this.counterSignVariables=[],this.approvalCols=[{title:"编号",field:"value",width:80},{title:"名称",field:"text",width:90}],this.approvalItems=[],this.columns=[{field:"conclusionName",width:25,title:"结论名称"},{field:"conclusionValue",width:25,title:"结论值"},{field:"calculateType",width:40,title:"计算方式",formatter:{type:"enum",options:{valueField:"value",textField:"text",data:this.calculationMethods}},editor:{type:U.EditorTypes.COMBOLIST,options:{valueField:"value",textField:"text",data:this.calculationMethods,idField:"value",panelHeight:"auto"}}},{field:"conditionValue",width:25,title:"条件值",editor:{type:U.EditorTypes.NUMBERBOX,options:{}},formatter:{type:"number",options:{precision:0,min:0}}},{field:"waitAllVotes",width:35,title:"等待全员办结",editor:{type:U.EditorTypes.SWITCH,options:{}},formatter:{type:"boolean",options:{trueText:"是",falseText:"否"}}},{field:"completionCondition",width:50,title:"自定义条件",editor:{type:"input-group",options:{groupText:'<i class="f-icon f-icon-lookup"></i>',editable:!1,clickHandle:function(e){e.formControl.setValue(e.instance.value?e.instance.value:""),n.editConditon(e)},clear:function(e){console.log("clear",e)}}}}],this.afterEdit=function(e,t,r){return n.preValue=JSON.parse(JSON.stringify(t)),T.of(!0)}}var Ai=(Mi.prototype.convertTo=function(e){return e&&0<e.length?"（已设置）":"（未设置）"},Mi);function Mi(){}var Di=(Object.defineProperty(Oi.prototype,"value",{set:function(e){var t,r;if(e&&0<e.length)try{for(var i=pe(e),n=i.next();!n.done;n=i.next()){var a=n.value,o=new mi;o.value=a.Value,o.text=a.Text,o.workFlowAction=a.WorkFlowAction,o.isDefault=a.IsDefault,null===a.commentNecessary||a.commentNecessary===undefined?o.commentNecessary="Back"===a.Value:o.commentNecessary=a.commentNecessary,o.certification=!!a.certification&&a.certification,o.attachmentNecessary=!!a.attachmentNecessary&&a.attachmentNecessary,this.data.push(o)}}catch(s){t={error:s}}finally{try{n&&!n.done&&(r=i["return"])&&r.call(i)}finally{if(t)throw t.error}}},enumerable:!0,configurable:!0}),Oi.prototype.ngOnInit=function(){this.getActionsList()},Oi.prototype.clickOK=function(){if(this.grid.endCellEdit(),this.validator()){var e={value:this.data,parameters:null};this.submitModal.emit(e)}},Oi.prototype.clickCancel=function(){this.closeModal.emit()},Oi.prototype.validator=function(){return!(-1<this.data.findIndex(function(e){return!e.workFlowAction})&&(this.message.warning("审批项流转方向不允许为空，请修改！"),1))},Oi.prototype.selectChanged=function(e){},Oi.prototype.deleteRow=function(){var t=this;if(this.grid.endCellEdit(),this.grid.selectedRow&&this.grid.selectedRow.data){var e=this.data.findIndex(function(e){return e.value===t.grid.selectedRow.data.value});this.data.splice(e,1),this.grid.loadData(this.data)}else this.message.info("请首先选中一条选项！")},Oi.prototype.getActionsList=function(){var t=this,e=this.util.getApprovalActionWebApi()+"?";this.uiState.bizActivityId?e+="bizActivityId="+this.uiState.bizActivityId:e+="bizActivityId=",this.http.get(e).subscribe(function(e){e=e.filter(function(e){return t.actionValidate(e)}),t.actions=e})},Oi.prototype.actionsSelect=function(){var i=this,e=this.actionsTable.checkeds;e&&0<e.length&&(e.forEach(function(t){var e=new mi(t.data.code,t.data.name,t.data.workFlowAction),r=i.data.findIndex(function(e){return e.value===t.data.code});-1<r&&i.data.splice(r,1),i.data.push(e)}),this.grid.loadData(this.data)),this.actionsDialog.close()},Oi.prototype.actionValidate=function(e){return-1===["ViewBizLog","ViewFlowChart","AssignUser","Claim","Unclaim","Retrieve","Resubmit","Obsolete","Transfer","AddSignFront","ViewExecuteForm"].indexOf(e.code.trim())},Oi.decorators=[{type:ne.Component,args:[{selector:"app-approvel-items",template:'<div class="f-page">\r\n  <div class="f-page-header">\r\n    <nav class="f-page-header-base">\r\n      <div class="f-title">\r\n        <span class="f-title-icon f-text-orna-bill">\r\n          <i class="f-icon f-icon-page-title-administer"></i>\r\n        </span>\r\n        <h4 class="f-title-text">审批项列表</h4>\r\n      </div>\r\n      <div class="btn-toolbar btn-group-lg">\r\n      <button class="btn btn-primary mr-2" (click)="actionsDialog.show()">新增</button>\r\n      <button class="btn btn-secondary" (click)="deleteRow()">删除</button>\r\n      </div>\r\n    </nav>\r\n  </div>\r\n  <div class="f-page-main f-utils-fill-flex-column h-100">\r\n    <div class="f-utils-fill-flex-column farris-overflow-y-auto h-100">\r\n      <farris-datagrid #grid [data]="data" [columns]="columns" [idField]="\'value\'" [fit]="true"\r\n        [fitColumns]="true" [editable]="true" [editMode]="\'cell\'" [pagination]="false" [showCheckbox]="false"\r\n        [multiSelect]="false" (selectChanged)="selectChanged($event)">\r\n      </farris-datagrid>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<ng-template #iconSelectFooter>\r\n  <button type="button" class="btn btn-primary btn-sm px-3 mx-2" (click)="clickOK()">确定</button>\r\n  <button type="button" class="btn btn-secondary btn-sm px-3 mx-2" (click)="clickCancel()">取消</button>\r\n</ng-template>\r\n\r\n<ng-template #buttonRef>\r\n  <button class="btn btn-sm btn-primary px-3" (click)="actionsSelect()">确定</button>\r\n  <button class="btn btn-sm btn-default px-3" (click)="actionsDialog.close()">取消</button>\r\n</ng-template>\r\n<farris-dialog #actionsDialog [buttons]="buttonRef" [width]="700" [height]="520" [title]="\'审批动作\'">\r\n  <div class="f-utils-fill-flex-column farris-overflow-y-auto h-100 m-2">\r\n    <farris-datagrid #actionsTable [columns]="actionsCols" [data]="actions"\r\n      [idField]="\'id\'" [fit]="true" [fitColumns]="true" [pagination]=\'false\'\r\n      [showCheckbox]="true" [multiSelect]="true" [checkOnSelect]="true" [selectOnCheck]="true" [showAllCheckbox]="true"\r\n      [showLineNumber]="true" [lineNumberTitle]="\'序号\'" [lineNumberWidth]="50" [striped]="true">\r\n    </farris-datagrid>\r\n  </div>\r\n</farris-dialog>\r\n',styles:[""]}]}],Oi.ctorParameters=function(){return[{type:l.FormBuilder},{type:Y.MessagerService},{type:vt},{type:O.HttpService},{type:me}]},Oi.propDecorators={cls:[{type:ne.HostBinding,args:["class"]}],closeModal:[{type:ne.Output}],submitModal:[{type:ne.Output}],value:[{type:ne.Input}],modalFooter:[{type:ne.ViewChild,args:["iconSelectFooter"]}],actionsTable:[{type:ne.ViewChild,args:["actionsTable"]}],actionsDialog:[{type:ne.ViewChild,args:["actionsDialog"]}],grid:[{type:ne.ViewChild,args:["grid"]}]},Oi);function Oi(e,t,r,i,n){this.formBuilder=e,this.message=t,this.util=r,this.http=i,this.uiState=n,this.cls="farris-main-area flex-column",this.closeModal=new ne.EventEmitter,this.submitModal=new ne.EventEmitter,this.modalConfig={title:"审批选项",width:880,height:515,showButtons:!0},this.workFlowActions=[{text:"正向",value:"Forward"},{text:"反向",value:"Backward"},{text:"终止",value:"Abort"}],this.columns=[{field:"value",width:80,title:"编号"},{field:"text",width:80,title:"名称"},{field:"workFlowAction",width:80,title:"流转方向",formatter:{type:"enum",options:{valueField:"value",textField:"text",data:this.workFlowActions}},editor:{type:U.EditorTypes.COMBOLIST,options:{valueField:"value",textField:"text",data:this.workFlowActions,idField:"value",panelHeight:"auto"}},validators:[{type:"required",messager:"必填"}]},{field:"isDefault",width:60,title:"默认",editor:{type:U.EditorTypes.SWITCH,options:{}},formatter:{type:"boolean",options:{trueText:"是",falseText:"否"}},validators:[{type:"required",messager:"必填"}]},{field:"commentNecessary",width:60,title:"意见必填",editor:{type:U.EditorTypes.SWITCH,options:{}},formatter:{type:"boolean",options:{trueText:"是",falseText:"否"}},validators:[{type:"required",messager:"必填"}]},{field:"attachmentNecessary",width:60,title:"附件上传",editor:{type:U.EditorTypes.SWITCH,options:{}},formatter:{type:"boolean",options:{trueText:"是",falseText:"否"}},validators:[{type:"required",messager:"必填"}]},{field:"certification",width:60,title:"数字签名",editor:{type:U.EditorTypes.SWITCH,options:{}},formatter:{type:"boolean",options:{trueText:"是",falseText:"否"}},validators:[{type:"required",messager:"必填"}]}],this.data=[],this.actionsCols=[{title:"编号",field:"code",width:80},{title:"名称",field:"name",width:90}]}var Vi=(Li.prototype.convertTo=function(e){return e&&0<e.length?"（已设置）":"（未设置）"},Li);function Li(){}var Ni=(Bi.prototype.ngOnInit=function(){var e,t,r,i,n,a,o,s,l,c;if(this.contextEntities=new Array,0<this.designerState.procInstContext.length)try{for(var d=pe(this.designerState.procInstContext),p=d.next();!p.done;p=d.next()){var u=p.value;this.contextEntities=this.contextEntities.concat([u])}}catch(F){e={error:F}}finally{try{p&&!p.done&&(t=d["return"])&&t.call(d)}finally{if(e)throw e.error}}if(0<this.designerState.formalParameterContext.length){var f=function(t){h.contextEntities.some(function(e){return e.key===t.key})||(h.contextEntities=h.contextEntities.concat([t]))},h=this;try{for(var m=pe(this.designerState.formalParameterContext),v=m.next();!v.done;v=m.next())f(u=v.value)}catch(A){r={error:A}}finally{try{v&&!v.done&&(i=m["return"])&&i.call(m)}finally{if(r)throw r.error}}}if(0<this.designerState.participantContext.length){var y=function(t){g.contextEntities.some(function(e){return e.key===t.key})||(g.contextEntities=g.contextEntities.concat([t]))},g=this;try{for(var b=pe(this.designerState.participantContext),x=b.next();!x.done;x=b.next())y(u=x.value)}catch(M){n={error:M}}finally{try{x&&!x.done&&(a=b["return"])&&a.call(b)}finally{if(n)throw n.error}}}if(0<this.designerState.activityComponentContext.length){var w=function(t){C.contextEntities.some(function(e){return e.key===t.key})||(C.contextEntities=C.contextEntities.concat([t]))},C=this;try{for(var I=pe(this.designerState.activityComponentContext),S=I.next();!S.done;S=I.next())w(u=S.value)}catch(D){o={error:D}}finally{try{S&&!S.done&&(s=I["return"])&&s.call(I)}finally{if(o)throw o.error}}}if(0<this.designerState.processVariableContext.length){var k=function(t){E.contextEntities.some(function(e){return e.key===t.key})||(E.contextEntities=E.contextEntities.concat([t]))},E=this;try{for(var P=pe(this.designerState.processVariableContext),T=P.next();!T.done;T=P.next())k(u=T.value)}catch(O){l={error:O}}finally{try{T&&!T.done&&(c=P["return"])&&c.call(P)}finally{if(l)throw l.error}}}},Bi.prototype.clickOK=function(){var e=this.compute.getExpr();this.value=this.convertToValue(e.text);var t={value:this.value,parameters:null};this.submitModal.emit(t)},Bi.prototype.changeType=function(){this.compute.changeType()},Bi.prototype.clickCancel=function(){this.closeModal.emit()},Bi.prototype.convertToValue=function(e){return e&&e.substring(9,e.length-2)?e:""},Bi.decorators=[{type:ne.Component,args:[{selector:"app-expression-editor",template:'<app-compute-rule-editor #compute\r\n  [text]="value"\r\n  [advancedContexts]="contextEntities"\r\n  [injectName]="injectName"\r\n  [injectSchemaName]="\'Schema\'"\r\n  [injectNameInSchema]="injectName"\r\n  [schema]="schema"\r\n  [schemaName]="\'Schema\'"   >\r\n</app-compute-rule-editor>\r\n\r\n<ng-template #iconSelectFooter>\r\n  <div class="btns">\r\n    <button type="button" class="btn btn-primary btn-sm mr-2" (click)="clickOK()">确定</button>\r\n    <button type="button" class="btn btn-secondary btn-sm mr-2" (click)="changeType()">切换类型</button>\r\n    <button type="button" class="btn btn-secondary btn-sm" (click)="clickCancel()">取消</button>\r\n  </div>\r\n</ng-template>\r\n',styles:[""]}]}],Bi.ctorParameters=function(){return[{type:J.ExpressionService},{type:me}]},Bi.propDecorators={closeModal:[{type:ne.Output}],submitModal:[{type:ne.Output}],value:[{type:ne.Input}],modalFooter:[{type:ne.ViewChild,args:["iconSelectFooter"]}],editorParams:[{type:ne.Input}],editor:[{type:ne.ViewChild,args:[J.ExpressioneditorComponent]}],compute:[{type:ne.ViewChild,args:["compute"]}]},Bi);function Bi(e,t){this.expr=e,this.designerState=t,this.closeModal=new ne.EventEmitter,this.submitModal=new ne.EventEmitter,this.editorParams={},this.contextEntities=[],this.schema={},this.injectName="",this.modalConfig={title:"条件编辑",width:1140,height:520,showButtons:!0},this.designerState.schemas[0]&&(this.schema=this.designerState.schemas[0],this.designerState.schemas[0].entityTypes&&0<this.designerState.schemas[0].entityTypes.length&&(this.injectName=this.designerState.schemas[0].entityTypes[0].name))}var Ri=(zi.prototype.convertTo=function(e){return e||"（未设置）"},zi);function zi(){}var Hi=(Object.defineProperty(ji.prototype,"value",{set:function(e){var t,r,i,n;if(e){this.category=e.Category,this.defaultType=e.DefaultType;var a=e.DefaultActivity;if(null!=a)try{for(var o=pe(this.uistate.allActList),s=o.next();!s.done;s=o.next()){var l=s.value;l.Id===a&&(this.defaultacty=l.Name)}}catch(h){t={error:h}}finally{try{s&&!s.done&&(r=o["return"])&&r.call(o)}finally{if(t)throw t.error}}var c=e.DestinationActivities;if(c&&0<c.length){var d=function(t){var e=p.uistate.userActList.filter(function(e){return e.Id===t})[0].Name;p.actis.push(e)},p=this;try{for(var u=pe(c),f=u.next();!f.done;f=u.next())d(f.value)}catch(m){i={error:m}}finally{try{f&&!f.done&&(n=u["return"])&&n.call(u)}finally{if(i)throw i.error}}}}else this.category="OutConnectNode",this.defaultType="FirstNode"},enumerable:!0,configurable:!0}),ji.prototype.ngOnInit=function(){},ji.prototype.clickOK=function(){var e,t,r,i,n,a;if(this.validator()){var o=[];if(""===this.defaultActivity&&""!==this.defaultacty)try{for(var s=pe(this.uistate.allActList),l=s.next();!l.done;l=s.next()){var c=l.value;c.Name===this.defaultacty&&(this.defaultActivity=c.Id)}}catch(y){e={error:y}}finally{try{l&&!l.done&&(t=s["return"])&&t.call(s)}finally{if(e)throw e.error}}if(0===this.fullActis.length&&0<this.actis.length)try{for(var d=pe(this.actis),p=d.next();!p.done;p=d.next()){var u=p.value;try{for(var f=pe(this.uistate.userActList),h=f.next();!h.done;h=f.next()){var m=h.value;u===m.Name&&o.push(m.Id)}}catch(g){n={error:g}}finally{try{h&&!h.done&&(a=f["return"])&&a.call(f)}finally{if(n)throw n.error}}}}catch(b){r={error:b}}finally{try{p&&!p.done&&(i=d["return"])&&i.call(d)}finally{if(r)throw r.error}}else"SpecifiedSet"===this.category&&this.fullActis&&0<this.fullActis.length&&this.fullActis.forEach(function(e){return o.push(e.Id)});var v={value:{Category:this.category,DefaultType:this.defaultType,DefaultActivity:this.defaultActivity,DestinationActivities:o},parameters:null};this.submitModal.emit(v)}},ji.prototype.clickCancel=function(){this.closeModal.emit()},ji.prototype.validator=function(){return this.category?"SpecifyNode"!==this.defaultType||""!==this.defaultacty||(this.message.warning("尚未指定默认节点，请了解！"),!1):(this.message.warning("尚未设置目标节点选项，请了解！"),!1)},ji.prototype.deleteRow=function(){var t=this;if(this.actTable.selectedRow&&this.actTable.selectedRow.data){var e=this.actis.findIndex(function(e){return e.id===t.actTable.selectedRow.data.id});this.actis.splice(e,1),this.actTable.loadData(this.actis)}else this.message.info("请首先选中一条选项！")},ji.decorators=[{type:ne.Component,args:[{selector:"app-jump-scope",template:'<div class="f-page">\r\n  <div class="f-utils-fill-flex-column farris-split-section m-2 h-100">\r\n    <section class="f-utils-fill-flex-column h-100">\r\n      <div class="f-utils-fill-flex-column h-100">\r\n        <form class="h-100">\r\n          <div class="f-utils-fill-flex-column h-100">\r\n            \x3c!-- 允许选择目标节点单选项 --\x3e\r\n            \x3c!-- <div class="mx-4 mt-3 farris-form-controls-inline">\r\n              <div class="farris-group-wrap">\r\n                <div class="form-group farris-form-group">\r\n                  <div class="farris-input-wrap">\r\n                    <div class="custom-control custom-checkbox">\r\n                      <input class="custom-control-input" name="submitterAutoPass" type="checkbox"\r\n                        id="submitterAutoPass" [(ngModel)]="outConnectNode" />\r\n                      <label class="custom-control-label" for="submitterAutoPass">允许选择目标节点</label>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div> --\x3e\r\n            \x3c!-- 可选节点小标题 --\x3e\r\n            <div class="mx-2 mt-1">\r\n              <div class="title-content">\r\n                <h4 class="title-text">可选节点</h4><span class="title-line"></span>\r\n              </div>\r\n            </div>\r\n            <div class="mt-2 mx-4 farris-form-controls-inline">\r\n              <div class="farris-group-wrap">\r\n                <div class="form-group">\r\n                  \x3c!-- 竖列枚举的category选项 --\x3e\r\n                  <farris-radiogroup [(ngModel)]="category" [data]="categoryListItems" name="category"\r\n                    [horizontal]=false>\r\n                  </farris-radiogroup>\r\n                </div>\r\n                \x3c!-- 附加节点帮助 --\x3e\r\n                <farris-lookup-grid #userActisDialog\r\n                  [items]="uistate.userActList | jumpScopePipe:uistate.propertyData.Id " [columns]="cols"\r\n                  [disabled]="!(category === \'SpecifiedSet\')" [resizable]="true" [singleSelect]="false" [idField]="\'Id\'"\r\n                  [textField]="\'Name\'" [(ngModel)]="actis" [valueField]="\'Id\'" [pagination]="true"\r\n                  [pageIndex]="pageInfo.pageIndex" name="defaultActivities" [pageSize]="pageInfo.pageSize"\r\n                  [pageList]="pageInfo.pageList" [total]="total" [enableClear]="false" [title]="\'附加节点列表\'"\r\n                  [displayType]="\'List\'" [remoteSearch]=\'false\' [enableToSelect]="false" [placeholder]="\'请选择附加节点\'" [dictPicked]="actisSelect">\r\n                </farris-lookup-grid>\r\n              </div>\r\n            </div>\r\n            \x3c!-- 默认节点小标题 --\x3e\r\n            <div class="mx-2 mt-1">\r\n              <div class="title-content">\r\n                <h4 class="title-text">默认节点</h4><span class="title-line"></span>\r\n              </div>\r\n            </div>\r\n            <div class="mt-2 mx-4 farris-form-controls-inline">\r\n              <div class="farris-group-wrap">\r\n                <div class="form-group">\r\n                  \x3c!-- 竖列枚举的DefaultType选项 --\x3e\r\n                  <farris-radiogroup [(ngModel)]="defaultType" [data]="defaultTypeListItems" name="defaultType"\r\n                    [horizontal]=false>\r\n                  </farris-radiogroup>\r\n                </div>\r\n                \x3c!-- 默认节点帮助 --\x3e\r\n                <farris-lookup-grid #allActisTable [items]="uistate.allActList | jumpScopePipe:uistate.propertyData.Id "\r\n                  [columns]="cols" [disabled]="!(defaultType === \'SpecifyNode\')" [resizable]="true"\r\n                  [singleSelect]="true" [idField]="\'Id\'" [textField]="\'Name\'" [(ngModel)]="defaultacty"\r\n                  [valueField]="\'Id\'" [pagination]="true" [placeholder]="\'请选择默认节点\'" [pageIndex]="pageInfo.pageIndex"\r\n                  name="defaultActivity" [pageSize]="pageInfo.pageSize" [pageList]="pageInfo.pageList" [total]="total"\r\n                  [enableClear]="false" [title]="\'默认节点列表\'" [displayType]="\'List\'" [remoteSearch]=\'false\' [dictPicked]="defaultActivitySelect">\r\n                </farris-lookup-grid>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </section>\r\n  </div>\r\n</div>\r\n\r\n<ng-template #iconSelectFooter>\r\n  <button type="button" class="btn btn-primary btn-sm mx-2" (click)="clickOK()">确定</button>\r\n  <button type="button" class="btn btn-secondary btn-sm" (click)="clickCancel()">取消</button>\r\n</ng-template>\r\n\r\n\x3c!-- <ng-template #buttonRef>\r\n  <button class="btn btn-sm btn-primary mx-2" (click)="actisSelect()">确定</button>\r\n  <button class="btn btn-sm btn-default" (click)="allActisDialog.close()">取消</button>\r\n</ng-template> --\x3e\r\n\x3c!-- <farris-dialog #allActisDialog [buttons]="buttonRef" [width]="700" [height]="520" [title]="\'活动列表\'">\r\n  <div class="f-utils-fill-flex-column farris-overflow-y-auto h-100 m-2">\r\n    <farris-datagrid #allActisTable [columns]="cols"\r\n      [data]="uistate.userActList | jumpScopePipe:uistate.propertyData.Id" [idField]="\'Id\'" [fit]="true"\r\n      [fitColumns]="true" [pagination]=\'false\' [multiSelect]="true" [showCheckbox]="true" [multiSelect]="true"\r\n      [checkOnSelect]="true" [selectOnCheck]="true">\r\n    </farris-datagrid>\r\n  </div>\r\n</farris-dialog> --\x3e\r\n',styles:[".title-content{color:#000;display:inline-flex;align-items:center;line-height:1.375rem;position:relative;overflow:hidden;padding:0 0 0 1rem;min-width:760px}.title-content ::before{content:'';width:.25rem;height:1.125rem;background:#59a1ff;border-radius:1px;position:absolute;top:50%;left:0;margin-top:-.5625rem}.title-text{font-size:1rem;line-height:1.375rem;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;margin-bottom:0;margin-right:10px}.title-line{flex-grow:1;border-bottom:1px dashed rgba(0,0,0,.1)}"]}]}],ji.ctorParameters=function(){return[{type:me},{type:Y.MessagerService}]},ji.propDecorators={cls:[{type:ne.HostBinding,args:["class"]}],closeModal:[{type:ne.Output}],submitModal:[{type:ne.Output}],value:[{type:ne.Input}],modalFooter:[{type:ne.ViewChild,args:["iconSelectFooter"]}],allActisTable:[{type:ne.ViewChild,args:["allActisTable"]}],allActisDialog:[{type:ne.ViewChild,args:["allActisDialog"]}],actTable:[{type:ne.ViewChild,args:["actTable"]}],lookup:[{type:ne.ViewChild,args:["lookup"]}]},ji);function ji(e,t){var r=this;this.uistate=e,this.message=t,this.cls="farris-main-area flex-column",this.closeModal=new ne.EventEmitter,this.submitModal=new ne.EventEmitter,this.modalConfig={title:"目标节点选项",width:520,height:460,showButtons:!0},this.cols=[{title:"名称",field:"Name",width:60,searchField:"Name"},{title:"ID",field:"Id",width:90,searchField:"Id"}],this.actis=[],this.fullActis=[],this.defaultacty="",this.categoryListItems=[{value:"OutConnectNode",name:"流程图连线节点"},{value:"Global",name:"流程内所有节点"},{value:"AfterNodes",name:"所有后继节点"},{value:"SpecifiedSet",name:"流程图连线节点+附加节点"}],this.category="",this.defaultType="",this.defaultTypeListItems=[{value:"FirstNode",name:"条件为true的连线节点，当有多条时默认选中首条"},{value:"NullNode",name:"默认为空，每次都手动选择"},{value:"SpecifyNode",name:"指定默认节点"}],this.defaultActivity="",this.pageInfo={pageIndex:1,pageList:[10,20,30,50],pageSize:20},this.actisSelect=function(e){return r.fullActis=e,T.of({closeDialog:!0})},this.defaultActivitySelect=function(e){return r.defaultActivity=e.Id,T.of({closeDialog:!0})}}var Ui=(qi.prototype.convertTo=function(e){return e?"（已设置）":"（未设置）"},qi);function qi(){}var Gi=(Object.defineProperty(Ki.prototype,"value",{set:function(e){var t=this;if(e){this.selectAbleChecked=e.SelectTargetAble,this.waitReturnChecked=e.WaitReturn,this.dynamicBackWardRuleAbleChecked=e.DynamicBackWardRuleAble,e.TargetRef?this.targetRef=e.TargetRef:this.targetRef="Empty";var r=this.listItems.find(function(e){return e.Id===t.targetRef});r?this.displayText=r.Name:(this.displayText="",setTimeout(function(){t.message.warning("驳回活动节点已不存在，请重新编辑")},500))}},enumerable:!0,configurable:!0}),Ki.prototype.ngOnInit=function(){this.nodeType=this.editorParams.nodeType,"UserActivity"!==this.nodeType&&(this.listItems=this.listItems.filter(function(e){return"Empty"!==e.Id}),this.items=this.listItems,this.total=this.listItems.length)},Ki.prototype.ngAfterViewInit=function(){},Ki.prototype.selectAbleClick=function(){var e=this;"wf.UserActivity"===this.uiState.propertyData.ClrTypeID&&this.uiState.propertyData.CompleteStrategy!==this.uiState.completeIterator[0].key&&!0===this.selectAbleChecked&&this.message.info("会签策略下，不允许“动态选择驳回级次”!",function(){e.selectAbleChecked=!1})},Ki.prototype.waitReturnClick=function(){this.waitReturnChecked=!this.waitReturnChecked},Ki.prototype.dynamicBackWardRuleAbleClick=function(){this.dynamicBackWardRuleAbleChecked=!this.dynamicBackWardRuleAbleChecked},Ki.prototype.clickOK=function(){var e={value:{TargetRef:this.getTargetRef(),SelectTargetAble:this.selectAbleChecked,WaitReturn:this.waitReturnChecked,DynamicBackWardRuleAble:this.dynamicBackWardRuleAbleChecked},parameters:null};this.submitModal.emit(e)},Ki.prototype.clickCancel=function(){this.closeModal.emit()},Ki.prototype.pagerChanged=function(e){this.pageInfo.pageIndex=e.pageIndex,this.pageInfo.pageSize=e.pageSize;var t={field:e.searchValue.searchField,value:e.searchValue.searchValue};this.load(t)},Ki.prototype.pageSizeChange=function(e){console.log(e),this.pageInfo.pageIndex=e.pageIndex,this.pageInfo.pageSize=e.pageSize;var t={field:e.searchValue.searchField,value:e.searchValue.searchValue};this.load(t)},Ki.prototype.search=function(e){this.pageInfo.pageIndex=e.pageInfo.pageIndex,this.pageInfo.pageSize=e.pageInfo.pageSize;var t=e.search;this.load(t)},Ki.prototype.load=function(t){this.pageInfo.pageIndex,this.pageInfo.pageSize,this.pageInfo.pageSize;var e=[];e=t?"*"===t.field?this.listItems.filter(function(e){return-1<e.Name.indexOf(t.value)||-1<e.Id.indexOf(t.value)}):this.listItems.filter(function(e){return-1<e[t.field].indexOf(t.value)}):this.listItems,this.total=e.length,this.items=e,this.hlp.componentRef.instance.loadData({data:this.items})},Ki.prototype.getTargetRef=function(){return"Empty"===this.targetRef?"":this.targetRef},Ki.decorators=[{type:ne.Component,args:[{selector:"procDesigner-backward-rule",template:'<div class="f-page">\r\n  <div class="f-utils-fill-flex-column farris-split-section m-2 h-100">\r\n    <section class="f-utils-fill-flex-column h-100">\r\n      <div class="f-section-header pt-2 mx-2">\r\n        <div class="f-title">\r\n          <h4 class="f-title-text">驳回规则设置</h4>\r\n        </div>\r\n      </div>\r\n      <div class="f-utils-fill-flex-column h-100">\r\n        <div class="farris-form form-inline farris-form-inline">\r\n          <div class="col-12 farris-group-auto my-4 pr-5">\r\n            <div class="farris-group-wrap">\r\n              <div class="form-group farris-form-group">\r\n                <label class="col-form-label">\r\n                  <span class="farris-label-info text-danger">*</span>\r\n                  <span class="farris-label-text">驳回至</span>\r\n                </label>\r\n                <div class="farris-input-wrap">\r\n                  <farris-lookup-grid #hlp [items]="items" [columns]="columns" [resizable]="true"\r\n                    [singleSelect]="true" [idField]="\'Id\'" [textField]="\'Name\'" [(ngModel)]="displayText"\r\n                    [valueField]="\'Id\'" [pagination]="false" [pageIndex]="pageInfo.pageIndex"\r\n                    [pageSize]="pageInfo.pageSize" [pageList]="pageInfo.pageList" [total]="total"\r\n                    [title]="\'活动列表\'" [displayType]="\'List\'" [dictPicked]="dictPicked" [remoteSearch]=\'false\'\r\n                    (pagerChanged)="pagerChanged($event)" (search)="search($event)" [enableClear]="false"\r\n                    (pageSizeChange)="pageSizeChange($event)">\r\n                  </farris-lookup-grid>\r\n                  <div class="farris-feedback valid-feedback"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div *ngIf="nodeType===\'UserActivity\'" class="col-12 farris-group-auto my-4">\r\n            <div class="farris-group-wrap pl-5">\r\n              <div class="form-group farris-form-group">\r\n                <div class="farris-input-wrap">\r\n                  <div class="custom-control custom-checkbox">\r\n                    <input class="custom-control-input" name="selectAble" type="checkbox" id="selectAble"\r\n                      [(ngModel)]="selectAbleChecked" (change)="selectAbleClick()" />\r\n                    <label class="custom-control-label" for="selectAble">动态选择驳回级次</label>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class="col-12 farris-group-auto my-4">\r\n            <div class="farris-group-wrap pl-5">\r\n              <div class="form-group farris-form-group">\r\n                <div class="farris-input-wrap">\r\n                  <div class="custom-control custom-checkbox">\r\n                    <input class="custom-control-input" name="waitReturn" type="checkbox" id="waitReturn" [checked]="waitReturnChecked"\r\n                      (change)="waitReturnClick()" />\r\n                    <label class="custom-control-label" for="waitReturn">驳回后重新提交至本节点</label>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class="col-12 farris-group-auto my-4">\r\n            <div class="farris-group-wrap pl-5">\r\n              <div class="form-group farris-form-group">\r\n                <div class="farris-input-wrap">\r\n                  <div class="custom-control custom-checkbox">\r\n                    <input class="custom-control-input" name="dynamicBackWardRuleAble" type="checkbox" id="dynamicBackWardRuleAble" [checked]="dynamicBackWardRuleAbleChecked"\r\n                      (change)="dynamicBackWardRuleAbleClick()" />\r\n                    <label class="custom-control-label" for="dynamicBackWardRuleAble">动态选择驳回规则</label>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        \x3c!-- <form class="h-100">\r\n          <div class="f-utils-fill-flex-column justify-content-center h-100 pb-4">\r\n            <div class="my-2 mx-5">\r\n              <div class="farris-group-wrap">\r\n                <div class="form-group">\r\n                  <label class="col-form-label">\r\n                    <span class="farris-label-text">驳回至</span>\r\n                  </label>\r\n                  <div class="farris-input-wrap mt-1" style="width: 300px;">\r\n                    <farris-combo-list [(ngModel)]="targetRef" name="targetRef" [ngModelOptions]="{standalone: true}"\r\n                      [idField]="\'value\'" [textField]="\'text\'" [valueField]="\'value\'" [data]="listItems"\r\n                      [panelHeight]="100">\r\n                    </farris-combo-list>\r\n                    <div class="farris-feedback valid-feedback"></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div class="my-2 mx-5">\r\n              <div class="farris-input-wrap">\r\n                <div class="custom-control custom-checkbox">\r\n                  <input class="custom-control-input" name="selectAble" type="checkbox" id="selectAble" [(ngModel)]="selectAbleChecked"\r\n                    (change)="selectAbleClick()" />\r\n                  <label class="custom-control-label" for="selectAble">动态选择驳回级次</label>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div class="my-2 mx-5">\r\n              <div class="farris-input-wrap">\r\n                <div class="custom-control custom-checkbox">\r\n                  <input class="custom-control-input" name="waitReturn" type="checkbox" id="waitReturn" [checked]="waitReturnChecked"\r\n                    (change)="waitReturnClick()" />\r\n                  <label class="custom-control-label" for="waitReturn">驳回后重新提交至本节点</label>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </form> --\x3e\r\n      </div>\r\n    </section>\r\n  </div>\r\n</div>\r\n<ng-template #iconSelectFooter>\r\n  <button type="button" class="btn btn-primary btn-sm mx-2" (click)="clickOK()">确定</button>\r\n  <button type="button" class="btn btn-secondary btn-sm mx-2" (click)="clickCancel()">取消</button>\r\n</ng-template>\r\n',styles:[".item-header{padding:1rem}.item{padding:.5rem 5rem}"]}]}],Ki.ctorParameters=function(){return[{type:me},{type:Y.MessagerService}]},Ki.propDecorators={cls:[{type:ne.HostBinding,args:["class"]}],editorParams:[{type:ne.Input}],value:[{type:ne.Input}],nodeType:[{type:ne.Input}],closeModal:[{type:ne.Output}],submitModal:[{type:ne.Output}],modalFooter:[{type:ne.ViewChild,args:["iconSelectFooter"]}],hlp:[{type:ne.ViewChild,args:["hlp"]}]},Ki);function Ki(e,t){var r=this;this.uiState=e,this.message=t,this.cls="farris-main-area flex-column",this.editorParams={},this.nodeType="UserActivity",this.closeModal=new ne.EventEmitter,this.submitModal=new ne.EventEmitter,this.modalConfig={title:"驳回规则",width:430,height:370,showButtons:!0},this.listItems=[{Id:"InitialActityId",Name:"开始节点"},{Id:"PrecursorActivityId",Name:"前置节点"},{Id:"Empty",Name:"空"}],this.items=[],this.columns=[{title:"名称",field:"Name",width:100,searchField:"Name"},{title:"标识",field:"Id",width:100,searchField:"Id"}],this.selectAbleChecked=!1,this.waitReturnChecked=!1,this.dynamicBackWardRuleAbleChecked=!1,this.targetRef=this.listItems[0].Id,this.pageInfo={pageIndex:1,pageList:[10,20,30,50],pageSize:20},this.dictPicked=function(e){return r.targetRef=e.Id,r.displayText=e.Name,T.of({closeDialog:!0})},this.listItems=this.listItems.concat(this.uiState.userActList),this.items=this.listItems,this.total=this.listItems.length}var Ji=(_i.prototype.convertTo=function(e){return e?"（已设置）":"（未设置）"},_i);function _i(){}var Wi=($i.decorators=[{type:ne.Injectable}],$i);function $i(){this.performersList=[],this.typeCollection=[{text:"用户",value:"wf.UserParticipant"},{text:"岗位",value:"wf.PositionParticipant"},{text:"构件参与者",value:"wf.ComponentParticipant"},{text:"汇报关系",value:"wf.ReportingLineParticipant"},{text:"矩阵",value:"wf.MatrixParticipant"}],this.performerInfo={performers:[],components:[],reportingLines:[],matrixParticipants:[],options:null}}var Xi=(Zi.decorators=[{type:ne.Injectable}],Zi);function Zi(){}var Yi=(Qi.decorators=[{type:ne.Injectable}],Qi.ctorParameters=function(){return[{type:ne.ComponentFactoryResolver},{type:ne.Injector},{type:te.BsModalService}]},Qi);function Qi(e,t,r){this.resolver=e,this.injector=t,this.modalService=r}var en,tn=function Ms(e,t,r){this.id="_"+vt.GenerateElementId(),this.performerId=e,this.performerName=t,this.type=r},rn=(ce(nn,en=tn),nn);function nn(e,t,r){return en.call(this,e,t,r)||this}var an=(on.prototype.getLookupConfig=function(){return this.lookupConfig.asObservable()},on.decorators=[{type:ne.Injectable}],on.ctorParameters=function(){return[{type:D.HttpClient}]},on);function on(e){var t=this;this.http=e,this.lookupConfig=new i.ReplaySubject,this.http.get("/platform/runtime/wf/web/wf-proc-designer/assets/config/performerlookupconfig.json").subscribe(function(e){t.lookupConfig.next(e)})}var sn=(ln.prototype.ngOnInit=function(){var t=this;this.http.get("/api/runtime/wf/v1.0/reportingOrgType/hasAdminOrg").subscribe(function(e){t.hasAdminOrg=e})},ln.prototype.ngAfterViewInit=function(){var e=this;this.ngZone.runOutsideAngular(function(){e.inputGroup.nativeElement.addEventListener("mouseenter",e.onMouseEnter.bind(e)),e.inputGroup.nativeElement.addEventListener("mouseleave",e.onMouseLeave.bind(e))})},ln.prototype.onMouseEnter=function(e){this.showClearButton=!0,this.showClearButton&&this.toggleClearIcon(e,!0)},ln.prototype.onMouseLeave=function(e){this.showClearButton=!1,this.toggleClearIcon(e,!1)},ln.prototype.toggleClearIcon=function(e,t){void 0===t&&(t=!1);var r=t?"":"none",i=e.target.querySelector(".input-group-clear");i&&(i.style.display=r)},ln.prototype.userTypeChange=function(e){this.users=[],this.orgTypeChange("Sys"),this.userTypeButtonNeedShow=this.hasAdminOrg&&"variable"===e.data.value},ln.prototype.clear=function(e){this.bindingData={},this.users=[],this.variableOrgTypes=[{name:"系统用户",value:"Sys"},{name:"行政人员",value:"Administrative_organization"}]},ln.prototype.selectUsers=function(e){var r=this;this.userType===this.userTypeCollection[0].value?this.lookupConfig.getLookupConfig().subscribe(function(e){e.user&&e.user.impl?System["import"](e.user.impl).then(function(e){Object.values(e)[0].create(r.injector).instance.showHelp().subscribe(function(e){e&&0<e.length&&(r.users=e.map(function(e){var t=new rn(e.id,e.name,"wf.UserParticipant");return t.orgId=e.orgId,t.orgName=e.orgName,t.userType=r.userTypeCollection[0].value,t}))})}):r.userHelp.showHelp()}):this.showExprHelp()},ln.prototype.editConditon=function(){var e,t,r,i,n,a,o,s,l,c,d,p,u,f,h=this;if(0<this.designerUIState.schemas.length){try{for(var m=pe(this.designerUIState.schemas),v=m.next();!v.done;v=m.next()){var y=v.value;this.expr.addSchema("Schema",y)}}catch(R){e={error:R}}finally{try{v&&!v.done&&(t=m["return"])&&t.call(m)}finally{if(e)throw e.error}}if(this.designerUIState.schemas[0].entityTypes&&0<this.designerUIState.schemas[0].entityTypes.length){var g=this.designerUIState.schemas[0].entityTypes[0];this.expr.addInjectedEntity(g.name,"Schema",g.name,J.InjectedType.EntityType)}}var b=new Array;if(0<this.designerUIState.procInstContext.length)try{for(var x=pe(this.designerUIState.procInstContext),w=x.next();!w.done;w=x.next()){var C=w.value;b.push(C)}}catch(z){r={error:z}}finally{try{w&&!w.done&&(i=x["return"])&&i.call(x)}finally{if(r)throw r.error}}if(0<this.designerUIState.formalParameterContext.length){var I=function(t){b.some(function(e){return e.key===t.key})||b.push(t)};try{for(var S=pe(this.designerUIState.formalParameterContext),k=S.next();!k.done;k=S.next())I(C=k.value)}catch(H){n={error:H}}finally{try{k&&!k.done&&(a=S["return"])&&a.call(S)}finally{if(n)throw n.error}}}if(0<this.designerUIState.participantContext.length){var E=function(t){b.some(function(e){return e.key===t.key})||b.push(t)};try{for(var P=pe(this.designerUIState.participantContext),T=P.next();!T.done;T=P.next())E(C=T.value)}catch(j){o={error:j}}finally{try{T&&!T.done&&(s=P["return"])&&s.call(P)}finally{if(o)throw o.error}}}if(0<this.designerUIState.processVariableContext.length){var F=function(t){b.some(function(e){return e.key===t.key})||b.push(t)};try{for(var A=pe(this.designerUIState.processVariableContext),M=A.next();!M.done;M=A.next())F(C=M.value)}catch(U){l={error:U}}finally{try{M&&!M.done&&(c=A["return"])&&c.call(A)}finally{if(l)throw l.error}}}if(0<this.designerUIState.activityComponentContext.length){var D=function(t){b.some(function(e){return e.key===t.key})||b.push(t)};try{for(var O=pe(this.designerUIState.activityComponentContext),V=O.next();!V.done;V=O.next())D(C=V.value)}catch(q){d={error:q}}finally{try{V&&!V.done&&(p=O["return"])&&p.call(O)}finally{if(d)throw d.error}}}if(0<b.length)try{for(var L=pe(b),N=L.next();!N.done;N=L.next()){var B=N.value;this.expr.addContext(B)}}catch(G){u={error:G}}finally{try{N&&!N.done&&(f=L["return"])&&f.call(L)}finally{if(u)throw u.error}}this.expr.setEditPattern(J.ExprEditMode.Conditional),this.expr.addExpressionText(this.condition),this.expr.buildExpression().then(function(e){h.condition=e})},ln.prototype.usersSelect=function(e){var r=this;this.users=e.map(function(e){var t=new rn(e.id,e.name,"wf.UserParticipant");return t.orgId=e.sysOrgId,t.orgName=e.sysOrgName,t.userType=r.userTypeCollection[0].value,t})},ln.prototype.showExprHelp=function(){var e,t,r,i,n,a,o,s,l=this;if(0<this.designerUIState.schemas.length){try{for(var c=pe(this.designerUIState.schemas),d=c.next();!d.done;d=c.next()){var p=d.value;this.expr.addSchema("Schema",p)}}catch(I){e={error:I}}finally{try{d&&!d.done&&(t=c["return"])&&t.call(c)}finally{if(e)throw e.error}}if(this.designerUIState.schemas[0].entityTypes&&0<this.designerUIState.schemas[0].entityTypes.length){var u=this.designerUIState.schemas[0].entityTypes[0];this.expr.addInjectedEntity(u.name,"Schema",u.name,J.InjectedType.EntityType)}}var f=new Array;if(0<this.designerUIState.participantContext.length)try{for(var h=pe(this.designerUIState.participantContext),m=h.next();!m.done;m=h.next()){var v=m.value;f.push(v)}}catch(S){r={error:S}}finally{try{m&&!m.done&&(i=h["return"])&&i.call(h)}finally{if(r)throw r.error}}if(0<this.designerUIState.processVariableContext.length){var y=function(t){f.some(function(e){return e.key===t.key})||f.push(t)};try{for(var g=pe(this.designerUIState.processVariableContext),b=g.next();!b.done;b=g.next())y(v=b.value)}catch(k){n={error:k}}finally{try{b&&!b.done&&(a=g["return"])&&a.call(g)}finally{if(n)throw n.error}}}if(0<f.length)try{for(var x=pe(f),w=x.next();!w.done;w=x.next()){var C=w.value;this.expr.addContext(C)}}catch(E){o={error:E}}finally{try{w&&!w.done&&(s=x["return"])&&s.call(x)}finally{if(o)throw o.error}}0<this.users.length?this.expr.addExpressionText(this.users[0].performerId):this.expr.addExpressionText(""),this.expr.buildExpression().then(function(e){var t=new rn(e,"","wf.UserParticipant");t.tag="expression",t.performerName=l.variableParticipantName(e),t.userType=l.userTypeCollection[1].value,""===l.variableParticipantName(e)?(l.message.error("行政人员类型不能使用上下文变量"),l.users=[]):l.users=[t],0<=t.performerId.indexOf("GetContextParameter")?l.variableOrgTypes=[{name:"系统用户",value:"Sys"}]:l.variableOrgTypes=[{name:"系统用户",value:"Sys"},{name:"行政人员",value:"Administrative_organization"}]})},ln.prototype.getPerformers=function(){var t=this;return this.users.map(function(e){if(e.orgId===undefined)return e.orgType=t.curOrgType,e}),this.condition&&(this.users=this.users.map(function(e){return e.condition=t.condition,e})),this.users},ln.prototype.variableParticipantName=function(e){var t,r,i,n;try{for(var a=pe(this.designerUIState.participantContext),o=a.next();!o.done;o=a.next()){var s=o.value;if(-1<e.indexOf(s.key))return"Sys"!==this.curOrgType?"":s.name}}catch(d){t={error:d}}finally{try{o&&!o.done&&(r=a["return"])&&r.call(a)}finally{if(t)throw t.error}}try{for(var l=pe(this.designerUIState.processVariableContext),c=l.next();!c.done;c=l.next())if(s=c.value,-1<e.indexOf(s.key))return s.name}catch(p){i={error:p}}finally{try{c&&!c.done&&(n=l["return"])&&n.call(l)}finally{if(i)throw i.error}}return"业务字段"},ln.prototype.orgTypeChange=function(e){this.curOrgType="Sys"===e?this.variableOrgTypes[0].value:this.variableOrgTypes[1].value},ln.decorators=[{type:ne.Component,args:[{selector:"app-user-performer",template:'<div class="d-flex flex-fill farris-overflow-y-auto p-md-2">\r\n  <form style="background: #F0F3F6; width: 100%;" >\r\n    <div class="d-flex m-2 flex-column w-100">\r\n      <div class="d-flex flex-column mx-5 my-4" style="background: #FFF;">\r\n        <div class="farris-form form-inline  farris-form-inline mr-5 my-2">\r\n          <div class="col-12 farris-group-auto my-4">\r\n            <div class="farris-group-wrap">\r\n              <div class="form-group farris-form-group">\r\n                <label class="col-form-label">\r\n                  <span class="farris-label-info text-danger">*</span>\r\n                  <span class="farris-label-text">用户类型</span>\r\n                </label>\r\n                <div class="farris-input-wrap">\r\n                  <farris-combo-list [(ngModel)]="userType" name="userType" [idField]="\'value\'" [textField]="\'text\'"\r\n                    [valueField]="\'value\'" [data]="userTypeCollection" [panelHeight]="60" (selectChange)=\'userTypeChange($event)\'>\r\n                  </farris-combo-list>\r\n                  <div class="farris-feedback valid-feedback"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class="col-12 farris-group-auto my-4">\r\n            <div class="farris-group-wrap">\r\n              <div class="form-group farris-form-group">\r\n                <label class="col-form-label">\r\n                  <span class="farris-label-info text-danger">*</span>\r\n                  <span class="farris-label-text">用户</span>\r\n                </label>\r\n                <div class="farris-input-wrap">\r\n                  <div #inputGroup class="input-group">\r\n                    <input type="text" class="form-control" [value]="users | usersName " name="users" [readOnly]="true" />\r\n                    <div class="input-group-append">\r\n                      <span [style.display]="showClearButton ? \'\' : \'none\'" class="input-group-text input-group-clear"\r\n                        (click)="clear($event)">\r\n                        <i class="f-icon modal_close"></i>\r\n                      </span>\r\n                      <span class="input-group-text" (click)="selectUsers($event)" style="background: #FFF;">\r\n                        <i class="f-icon f-icon-lookup"></i>\r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n                  <div class="farris-feedback valid-feedback"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class="col-12 farris-group-auto my-4" [ngStyle]="{\'visibility\' : userTypeButtonNeedShow ? \'visible\' : \'hidden\'}">\r\n            <div class="farris-group-wrap">\r\n              <div class="form-group farris-form-group">\r\n                <label class="col-form-label">\r\n                  <span class="farris-label-info text-danger">*</span>\r\n                  <span class="farris-label-text">人员类型</span>\r\n                </label>\r\n                <div class="farris-input-wrap">\r\n                  <farris-radiogroup [data]="variableOrgTypes" [horizontal]="true"\r\n                                     [(ngModel)]="curOrgType" name="referObject"\r\n                                     (changeValue)="orgTypeChange($event)"\r\n                  ></farris-radiogroup>\r\n                  <div class="farris-feedback valid-feedback"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class="d-flex flex-column mx-5" style="background: #FFF;">\r\n        <div class="farris-form form-inline farris-form-inline mr-5">\r\n          <div class="col-12 farris-group-auto my-4">\r\n            <div class="farris-group-wrap">\r\n              <div class="form-group farris-form-group">\r\n                <label class="col-form-label">\r\n                  <span class="farris-label-text">启用条件</span>\r\n                </label>\r\n                <div class="farris-input-wrap">\r\n                  <div class="input-group">\r\n                    <input type="text" class="form-control" [(ngModel)]="condition" name="conditon" [readOnly]="true" />\r\n                    <div class="input-group-append">\r\n                      <span class="input-group-text" (click)="editConditon()" style="background: #FFF;">\r\n                        <i class="f-icon f-icon-lookup"></i>\r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n                  <div class="farris-feedback valid-feedback"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </form>\r\n</div>\r\n\r\n<sys-farris-grid-lookup #userHelp style="display: none;" [singleSelect]="false" [displayTxt]="bindingData.name"\r\n  [pagination]="true" [pageSize]="20" [title]="\'系统用户\'" [sourceType]="\'user\'" (afterConfirm)="usersSelect($event)"\r\n  [bindingData]="bindingData" [filter]="{notGetCurrentUser:false}" [typeMode]="1">\r\n</sys-farris-grid-lookup>\r\n',styles:[""]}]}],ln.ctorParameters=function(){return[{type:me},{type:J.ExpressionService},{type:ne.Injector},{type:an},{type:ne.NgZone},{type:O.HttpService},{type:Y.MessagerService}]},ln.propDecorators={cls:[{type:ne.HostBinding,args:["class"]}],userHelp:[{type:ne.ViewChild,args:[d.SysFarrisLookupComponent]}],inputGroup:[{type:ne.ViewChild,args:["inputGroup"]}]},ln);function ln(e,t,r,i,n,a,o){this.designerUIState=e,this.expr=t,this.injector=r,this.lookupConfig=i,this.ngZone=n,this.http=a,this.message=o,this.cls="d-flex flex-fill h-100",this.showClearButton=!1,this.bindingData={},this.userTypeCollection=[{text:"固定用户",value:"user"},{text:"变量参与者",value:"variable"}],this.userType=this.userTypeCollection[0].value,this.variableOrgTypes=[{name:"系统用户",value:"Sys"},{name:"行政人员",value:"Administrative_organization"}],this.curOrgType=this.variableOrgTypes[0].value,this.hasAdminOrg=!1,this.userTypeButtonNeedShow=!1,this.users=[]}var cn,dn=(ce(pn,cn=tn),pn);function pn(){return cn.call(this)||this}var un=(fn.prototype.ngOnInit=function(){},fn.prototype.ngAfterViewInit=function(){var e=this;this.ngZone.runOutsideAngular(function(){e.inputGroup.nativeElement.addEventListener("mouseenter",e.onMouseEnter.bind(e)),e.inputGroup.nativeElement.addEventListener("mouseleave",e.onMouseLeave.bind(e))})},fn.prototype.onMouseEnter=function(e){this.showClearButton=!0,this.showClearButton&&this.toggleClearIcon(e,!0)},fn.prototype.onMouseLeave=function(e){this.showClearButton=!1,this.toggleClearIcon(e,!1)},fn.prototype.toggleClearIcon=function(e,t){void 0===t&&(t=!1);var r=t?"":"none",i=e.target.querySelector(".input-group-clear");i&&(i.style.display=r)},fn.prototype.clear=function(){this.position.performerId=null,this.position.performerName=null},fn.prototype.positionTypeChange=function(e){"0"===e.value?this.filter={positionType:0}:this.filter={positionType:1},this.clear(),this.position.orgType=null,this.position.orgId=null},fn.prototype.selectOrganition=function(){var e,t,r=this;if("1"===this.position.positionType){if(0<this.designerUIState.schemas.length){try{for(var i=pe(this.designerUIState.schemas),n=i.next();!n.done;n=i.next()){var a=n.value;this.expr.addSchema("Schema",a)}}catch(s){e={error:s}}finally{try{n&&!n.done&&(t=i["return"])&&t.call(i)}finally{if(e)throw e.error}}if(this.designerUIState.schemas[0].entityTypes&&0<this.designerUIState.schemas[0].entityTypes.length){var o=this.designerUIState.schemas[0].entityTypes[0];this.expr.addInjectedEntity(o.name,"Schema",o.name,J.InjectedType.EntityType)}}this.expr.addExpressionText(this.position.orgId),this.expr.buildExpression().then(function(e){r.position.orgId=e})}},fn.prototype.selectPosition=function(){this.posiHelp.showHelp()},fn.prototype.editCondition=function(){var e,t,r,i,n,a,o,s,l,c,d,p,u,f,h=this;if(0<this.designerUIState.schemas.length){try{for(var m=pe(this.designerUIState.schemas),v=m.next();!v.done;v=m.next()){var y=v.value;this.expr.addSchema("Schema",y)}}catch(R){e={error:R}}finally{try{v&&!v.done&&(t=m["return"])&&t.call(m)}finally{if(e)throw e.error}}if(this.designerUIState.schemas[0].entityTypes&&0<this.designerUIState.schemas[0].entityTypes.length){var g=this.designerUIState.schemas[0].entityTypes[0];this.expr.addInjectedEntity(g.name,"Schema",g.name,J.InjectedType.EntityType)}}var b=new Array;if(0<this.designerUIState.procInstContext.length)try{for(var x=pe(this.designerUIState.procInstContext),w=x.next();!w.done;w=x.next()){var C=w.value;b.push(C)}}catch(z){r={error:z}}finally{try{w&&!w.done&&(i=x["return"])&&i.call(x)}finally{if(r)throw r.error}}if(0<this.designerUIState.formalParameterContext.length){var I=function(t){b.some(function(e){return e.key===t.key})||b.push(t)};try{for(var S=pe(this.designerUIState.formalParameterContext),k=S.next();!k.done;k=S.next())I(C=k.value)}catch(H){n={error:H}}finally{try{k&&!k.done&&(a=S["return"])&&a.call(S)}finally{if(n)throw n.error}}}if(0<this.designerUIState.participantContext.length){var E=function(t){b.some(function(e){return e.key===t.key})||b.push(t)};try{for(var P=pe(this.designerUIState.participantContext),T=P.next();!T.done;T=P.next())E(C=T.value)}catch(j){o={error:j}}finally{try{T&&!T.done&&(s=P["return"])&&s.call(P)}finally{if(o)throw o.error}}}if(0<this.designerUIState.processVariableContext.length){var F=function(t){b.some(function(e){return e.key===t.key})||b.push(t)};try{for(var A=pe(this.designerUIState.processVariableContext),M=A.next();!M.done;M=A.next())F(C=M.value)}catch(U){l={error:U}}finally{try{M&&!M.done&&(c=A["return"])&&c.call(A)}finally{if(l)throw l.error}}}if(0<this.designerUIState.activityComponentContext.length){var D=function(t){b.some(function(e){return e.key===t.key})||b.push(t)};try{for(var O=pe(this.designerUIState.activityComponentContext),V=O.next();!V.done;V=O.next())D(C=V.value)}catch(q){d={error:q}}finally{try{V&&!V.done&&(p=O["return"])&&p.call(O)}finally{if(d)throw d.error}}}if(0<b.length)try{for(var L=pe(b),N=L.next();!N.done;N=L.next()){var B=N.value;this.expr.addContext(B)}}catch(G){u={error:G}}finally{try{N&&!N.done&&(f=L["return"])&&f.call(L)}finally{if(u)throw u.error}}this.expr.setEditPattern(J.ExprEditMode.Conditional),this.expr.addExpressionText(this.position.condition),this.expr.buildExpression().then(function(e){h.position.condition=e})},fn.prototype.orgTypeChange=function(e){this.position.orgType=e.data.value},fn.prototype.clearOrgType=function(){this.position.orgType=null},fn.prototype.positionsSelect=function(e){e&&(this.position.performerId=e.id,this.position.performerName=e.name,this.position.type="wf.PositionParticipant",this.position.positionType||(this.position.positionType=e.posType+"",this.filter={positionType:e.posType}))},fn.prototype.getPerformers=function(){return this.position},fn.decorators=[{type:ne.Component,args:[{selector:"app-position-performer",template:'<div class="d-flex flex-fill farris-overflow-y-auto p-md-2">\r\n  <form style="background: #F0F3F6; width: 100%;">\r\n    <div class="d-flex m-2 flex-column w-100">\r\n      <div class="d-flex flex-column mx-5 my-4" style="background: #FFF;">\r\n        <div class="farris-form form-inline  farris-form-inline mr-5">\r\n          <div class="col-12 farris-group-auto my-3">\r\n            <div class="farris-group-wrap">\r\n              <div class="form-group farris-form-group">\r\n                <label class="col-form-label">\r\n                  \x3c!-- <span class="farris-label-info text-danger">*</span> --\x3e\r\n                  <span class="farris-label-text">岗位类型</span>\r\n                </label>\r\n                <div class="farris-input-wrap">\r\n                  <farris-combo-list [(ngModel)]="position.positionType" name="positionType" [panelHeight]="\'auto\'" [idField]="\'value\'"\r\n                    [textField]="\'text\'" [data]="positionTypes" (valueChange)="positionTypeChange($event)"\r\n                    [panelHeight]="\'auto\'" [enableClear]="false">\r\n                  </farris-combo-list>\r\n                  <div class="farris-feedback valid-feedback"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class="col-12 farris-group-auto my-4">\r\n            <div class="farris-group-wrap">\r\n              <div class="form-group farris-form-group">\r\n                <label class="col-form-label">\r\n                  <span class="farris-label-info text-danger">*</span>\r\n                  <span class="farris-label-text">岗位</span>\r\n                </label>\r\n                <div class="farris-input-wrap">\r\n                  <div #inputGroup class="input-group">\r\n                    <input type="text" class="form-control" [(ngModel)]="position.performerName" name="positionName" [readOnly]="true" />\r\n                    <div class="input-group-append">\r\n                      <span [style.display]="showClearButton ? \'\' : \'none\'" class="input-group-text input-group-clear" (click)="clear()">\r\n                        <i class="f-icon modal_close"></i>\r\n                      </span>\r\n                      <span class="input-group-text" (click)="selectPosition()" style="background: #FFF;">\r\n                        <i class="f-icon f-icon-lookup"></i>\r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n                  <div class="farris-feedback valid-feedback"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class="col-12 farris-group-auto my-4">\r\n            <div class="farris-group-wrap">\r\n              <div class="form-group farris-form-group">\r\n                <label class="col-form-label">\r\n                  \x3c!-- <span *ngIf="filter.positionType===1" class="farris-label-info text-danger">*</span> --\x3e\r\n                  <span class="farris-label-text">组织类型</span>\r\n                </label>\r\n                <div class="farris-input-wrap">\r\n                  <farris-combo-list [(ngModel)]="position.orgType" name="orgType" [idField]="\'value\'" [textField]="\'text\'" [valueField]="\'value\'"\r\n                    [data]="designerUIState.orgTypeCollection" [panelHeight]="\'auto\'" (clear)="clearOrgType()"\r\n                    (selectChange)=\'orgTypeChange($event)\' [readonly]="!(position.positionType===\'1\')" [placeholder]="position.positionType===\'1\'?\'请选择\':\'\'">\r\n                  </farris-combo-list>\r\n                  <div class="farris-feedback valid-feedback"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class="col-12 farris-group-auto my-3">\r\n            <div class="farris-group-wrap">\r\n              <div class="form-group farris-form-group">\r\n                <label class="col-form-label">\r\n                  \x3c!-- <span *ngIf="filter.positionType===1" class="farris-label-info text-danger">*</span> --\x3e\r\n                  <span class="farris-label-text">组织</span>\r\n                </label>\r\n                <div class="farris-input-wrap">\r\n                  \x3c!-- <div class="input-group">\r\n                    <input type="text" class="form-control" [(ngModel)]="position.orgId" name="organization" [readOnly]="true" />\r\n                    <div class="input-group-append">\r\n                      <span class="input-group-text" (click)="selectOrganition()" style="background: #FFF;">\r\n                        <i class="f-icon f-icon-lookup"></i>\r\n                      </span>\r\n                    </div>\r\n                  </div> --\x3e\r\n                  <input-group class="form-control" style="width: 100%;padding:0;border:0;" [enableClear]="false"\r\n                    [showButtonWhenDisabled]="false" [readonly]="!(position.positionType===\'1\')"\r\n                    [(ngModel)]="position.orgId" name="organization" [placeholder]="position.positionType===\'1\'?\'请选择\':\'\'"\r\n                    [editable]="false" (clickHandle)="selectOrganition()" [groupText]="groupIcon"></input-group>\r\n                  <div class="farris-feedback valid-feedback"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class="d-flex flex-column mx-5" style="background: #FFF;">\r\n        <div class="farris-form form-inline farris-form-inline mr-5">\r\n          <div class="col-12 farris-group-auto my-3">\r\n            <div class="farris-group-wrap">\r\n              <div class="form-group farris-form-group">\r\n                <label class="col-form-label">\r\n                  <span class="farris-label-text">启用条件</span>\r\n                </label>\r\n                <div class="farris-input-wrap">\r\n                  <div class="input-group">\r\n                    <input type="text" class="form-control" [(ngModel)]="this.position.condition" name="conditon" [readOnly]="true" />\r\n                    <div class="input-group-append">\r\n                      <span class="input-group-text" (click)="editCondition()" style="background: #FFF;">\r\n                        <i class="f-icon f-icon-lookup"></i>\r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n                  <div class="farris-feedback valid-feedback"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </form>\r\n</div>\r\n\r\n<sys-farris-grid-lookup #posiHelp style="display: none;" [singleSelect]="true"\r\n  [pagination]="true" [pageSize]="20" [title]="\'系统岗位\'" [sourceType]="\'position\'"\r\n  (afterConfirm)="positionsSelect($event)" [filter]="filter">\r\n</sys-farris-grid-lookup>\r\n',styles:[""]}]}],fn.ctorParameters=function(){return[{type:O.HttpService},{type:me},{type:J.ExpressionService},{type:ne.NgZone}]},fn.propDecorators={cls:[{type:ne.HostBinding,args:["class"]}],posiHelp:[{type:ne.ViewChild,args:[d.SysFarrisLookupComponent]}],inputGroup:[{type:ne.ViewChild,args:["inputGroup"]}]},fn);function fn(e,t,r,i){this.http=e,this.designerUIState=t,this.expr=r,this.ngZone=i,this.cls="d-flex flex-fill h-100",this.showClearButton=!1,this.groupIcon='<i class="f-icon f-icon-lookup"></i>',this.positionTypes=[{value:"0",text:"组织岗"},{value:"1",text:"通用岗"}],this.filter={},this.position=new dn}var hn=(mn.prototype.getLookUpData=function(e,t,r,i,n){var a="/api/runtime/wf/v1.0/dtProcDefs/getHelpData?helpId="+e+"&pageIndex="+r+"&pageSize="+i;return n&&(a+="&searchValue="+JSON.stringify(n)),this.http.get(a)},mn.prototype.getHelpMetaData=function(e,t){var r="/api/runtime/lcm/v1.0/rt-metadatas/"+e;return this.http.get(r)},mn.decorators=[{type:ne.Injectable}],mn.ctorParameters=function(){return[{type:O.HttpService}]},mn);function mn(e){this.http=e}var vn=function Ds(){this.id=vt.GenerateElementId()},yn=(Object.defineProperty(gn.prototype,"component",{get:function(){return this.componentPerformer},set:function(t){var i=this;t&&t.methodCode?this.service.getHelpMetaData(t.metadataId,"").subscribe(function(e){var r=JSON.parse(e.content).operations.find(function(e){return e.code===t.methodCode});if(!r)throw new Error("当前构件已不存在此方法，请更新！");t.actualParameters=t.actualParameters.map(function(t){var e=r.parameters.find(function(e){return e.code===t.code});if(e)return{code:t.code,name:e.name,value:t.value,valueText:t.valueText?t.valueText:t.value,description:e.description,tag:t.tag,fetchValueMode:e.fetchValueMode,fetchValueSetting:e.fetchValueSetting};throw new Error("当前构件方法参数不一致，请更新！")}),i.componentPerformer=t}):this.componentPerformer=new vn},enumerable:!0,configurable:!0}),gn.prototype.ngOnInit=function(){},gn.prototype.ngAfterViewInit=function(){var e=this;this.ngZone.runOutsideAngular(function(){e.inputGroup.nativeElement.addEventListener("mouseenter",e.onMouseEnter.bind(e)),e.inputGroup.nativeElement.addEventListener("mouseleave",e.onMouseLeave.bind(e))})},gn.prototype.onMouseEnter=function(e){this.showClearButton=!0,this.showClearButton&&this.toggleClearIcon(e,!0)},gn.prototype.onMouseLeave=function(e){this.showClearButton=!1,this.toggleClearIcon(e,!1)},gn.prototype.toggleClearIcon=function(e,t){void 0===t&&(t=!1);var r=t?"":"none",i=e.target.querySelector(".input-group-clear");i&&(i.style.display=r)},gn.prototype.selectChanged=function(e){this.curParameter=e.data},gn.prototype.endEdit=function(e){e.rowData.fetchValueMode!==f.ParameterFetchValueMode["const"]&&e.rowData.fetchValueMode!==f.ParameterFetchValueMode["enum"]||(this.component.actualParameters[e.rowIndex].value=this.component.actualParameters[e.rowIndex].valueText)},gn.prototype.clear=function(){this.componentPerformer.name="",this.componentPerformer.metadataId="",this.componentPerformer.methodCode="",this.componentPerformer.methodName="",this.componentPerformer.condition="",this.componentPerformer.actualParameters=new Array},gn.prototype.selectComponent=function(){var i=this,e=this.resolver.resolveComponentFactory(ee.SelectMetadataRTComponent).create(this.injector);e.instance.typeList="WebServiceComponent",e.instance.selectedMetadata.subscribe(function(e){try{var t=e.metadata;i.openComponentSelectorNew(t.id,i.sessionSrc.getUserSessionId())}catch(r){throw console.log("$event",e),new Error("获取解析构件出错"+e)}});var t=this.modalService.show(e,{title:"构件选择",width:980,height:548,showButtons:!1});e.instance.closeModalEmitter.subscribe(function(e){return t.close()})},gn.prototype.openComponentSelectorNew=function(e,t){var r=this;this.componentService.openSelector(e,t).subscribe(function(e){e.confirmEvent.subscribe(function(e){e&&(r.component.name=e.name,r.component.metadataId=e.id,r.component.methodCode=e.operations[0].code,r.component.methodName=e.operations[0].name,r.component.actualParameters=[],e.operations[0].parameters&&0<e.operations[0].parameters.length&&(r.component.actualParameters=e.operations[0].parameters.map(function(e){return{code:e.code,name:e.name,value:"",valueText:"",description:e.description,fetchValueMode:e.fetchValueMode,fetchValueSetting:e.fetchValueSetting}})))})})},gn.prototype.showExprHelp=function(s){var e,t,r,i,n,a,o,l,c,d,p,u,f=this;if(0<this.designerState.schemas.length){try{for(var h=pe(this.designerState.schemas),m=h.next();!m.done;m=h.next()){var v=m.value;this.expr.addSchema("Schema",v)}}catch(V){e={error:V}}finally{try{m&&!m.done&&(t=h["return"])&&t.call(h)}finally{if(e)throw e.error}}if(this.designerState.schemas[0].entityTypes&&0<this.designerState.schemas[0].entityTypes.length){var y=this.designerState.schemas[0].entityTypes[0];this.expr.addInjectedEntity(y.name,"Schema",y.name,J.InjectedType.EntityType)}}var g=new Array;if(0<this.designerState.procInstContext.length)try{for(var b=pe(this.designerState.procInstContext),x=b.next();!x.done;x=b.next()){var w=x.value;g.push(w)}}catch(L){r={error:L}}finally{try{x&&!x.done&&(i=b["return"])&&i.call(b)}finally{if(r)throw r.error}}if(0<this.designerState.formalParameterContext.length){var C=function(t){g.some(function(e){return e.key===t.key})||g.push(t)};try{for(var I=pe(this.designerState.formalParameterContext),S=I.next();!S.done;S=I.next())C(w=S.value)}catch(N){n={error:N}}finally{try{S&&!S.done&&(a=I["return"])&&a.call(I)}finally{if(n)throw n.error}}}if(0<this.designerState.participantContext.length){var k=function(t){g.some(function(e){return e.key===t.key})||g.push(t)};try{for(var E=pe(this.designerState.participantContext),P=E.next();!P.done;P=E.next())k(w=P.value)}catch(B){o={error:B}}finally{try{P&&!P.done&&(l=E["return"])&&l.call(E)}finally{if(o)throw o.error}}}if(0<this.designerState.processVariableContext.length){var T=function(t){g.some(function(e){return e.key===t.key})||g.push(t)};try{for(var F=pe(this.designerState.processVariableContext),A=F.next();!A.done;A=F.next())T(w=A.value)}catch(R){c={error:R}}finally{try{A&&!A.done&&(d=F["return"])&&d.call(F)}finally{if(c)throw c.error}}}if(0<g.length)try{for(var M=pe(g),D=M.next();!D.done;D=M.next()){var O=D.value;this.expr.addContext(O)}}catch(z){p={error:z}}finally{try{D&&!D.done&&(u=M["return"])&&u.call(M)}finally{if(p)throw p.error}}this.expr.setEditPattern(J.ExprEditMode.Advanced),this.expr.addExpressionText(s.instance.value),this.expr.buildExpression().then(function(e){var t,r;if(e){s.formControl.setValue(e),s.instance.cd.detectChanges(),s.rowData.value=e;try{for(var i=pe(f.component.actualParameters),n=i.next();!n.done;n=i.next()){var a=n.value;a.code===s.rowId&&(a.value=e)}}catch(o){t={error:o}}finally{try{n&&!n.done&&(r=i["return"])&&r.call(i)}finally{if(t)throw t.error}}}})},gn.prototype.getPerformers=function(){return this.grid.endCellEdit(),console.log(this.component),this.component},gn.prototype.getHelpInfo=function(){var n=this;T.forkJoin(this.service.getHelpMetaData(this.helpInfo.helpId,this.helpInfo.su),this.service.getLookUpData(this.helpInfo.helpId,this.helpInfo.su,this.helpInfo.pageInfo.pageIndex,this.helpInfo.pageInfo.pageSize,this.helpInfo.search)).subscribe(function(e){if(!e[0])throw new Error("帮助元数据不存在！");var t=e[0],r=JSON.parse(t.content);if(n.helpInfo.columns=r.dataSource.columns,n.helpInfo.displayType=r.displayType,n.helpInfo.fieldInfo={idField:r.idField,valueField:r.valueField,textField:r.textField},!e[1])throw new Error("获取帮助数据源失败！");var i=e[1];n.helpInfo.items=i.items,n.helpInfo.title=i.title,n.helpInfo.total=i.total,n.lookup.showDialog()})},gn.prototype.pagerChanged=function(e){var t=this;e&&(this.helpInfo.pageInfo.pageIndex=e.pageIndex,this.helpInfo.pageInfo.pageSize=e.pageSize,this.service.getLookUpData(this.helpInfo.helpId,this.helpInfo.su,this.helpInfo.pageInfo.pageIndex,this.helpInfo.pageInfo.pageSize,this.helpInfo.search).subscribe(function(e){t.helpInfo.items=e.items,t.helpInfo.title=e.title,t.helpInfo.total=e.total,t.lookup.loadData(e)}))},gn.prototype.search=function(e){var t=this;if(console.log(e),this.helpInfo.search={category:"search"},e){var r={searchField:e.field||e.search.field,searchValue:e.value||e.search.value};this.helpInfo.search=Object.assign(this.helpInfo.search,r),this.service.getLookUpData(this.helpInfo.helpId,this.helpInfo.su,this.helpInfo.pageInfo.pageIndex,this.helpInfo.pageInfo.pageSize,this.helpInfo.search).subscribe(function(e){t.helpInfo.items=e.items,t.helpInfo.title=e.title,t.helpInfo.total=e.total,t.lookup.loadData(e)})}},gn.decorators=[{type:ne.Component,args:[{selector:"app-component-performer",template:'\r\n    <div class="f-utils-fill-flex-column farris-overflow-y-auto h-100">\r\n      <form class="farris-form farris-card-content-bg farris-card-section mx-2">\r\n        <div class="d-flex flex-wrap flex-column mb-2 pr-4">\r\n          <div class="farris-form-controls-inline farris-form-auto mb-2">\r\n            <div class="farris-group-wrap mx-3">\r\n              <div class="form-group">\r\n                <label class="col-form-label">\r\n                  <span class="farris-label-info text-danger">*</span>\r\n                  <span class="farris-label-text">构件名称</span>\r\n                </label>\r\n                <div class="farris-input-wrap ml-2">\r\n                  <input type="text" class="k-textbox form-control" name="name"\r\n                    [(ngModel)]="component.name" />\r\n                  <div class="farris-feedback valid-feedback"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class="farris-form-controls-inline farris-form-auto">\r\n            <div class="farris-group-wrap mx-3">\r\n              <div class="form-group">\r\n                <label class="col-form-label">\r\n                  <span class="farris-label-info text-danger">*</span>\r\n                  <span class="farris-label-text">构件选择</span>\r\n                </label>\r\n                <div class="farris-input-wrap ml-2">\r\n                  <div #inputGroup class="input-group">\r\n                    <input type="text" class="form-control" [(ngModel)]="component.methodCode" name="methodCode" [readOnly]="true" />\r\n                    <div class="input-group-append">\r\n                      <span [style.display]="showClearButton ? \'\' : \'none\'" class="input-group-text input-group-clear" (click)="clear()">\r\n                        <i class="f-icon modal_close"></i>\r\n                      </span>\r\n                      <span class="input-group-text" (click)="selectComponent()" style="background: #FFF;">\r\n                        <i class="f-icon f-icon-lookup"></i>\r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n                  <div class="farris-feedback valid-feedback"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </form>\r\n      <farris-tabs class="f-utils-fill" #params [value]="\'params\'" [contentFill]="true">\r\n        <farris-tab title="参数列表" [id]="\'params\'">\r\n          <ng-template #content>\r\n            <div class="f-utils-fill-flex-column h-100">\r\n              <farris-datagrid #grid [data]="component.actualParameters" [columns]="columns" [idField]="\'code\'" [fit]="true"\r\n                [fitColumns]="true" [editable]="true" [editMode]="\'cell\'" [pagination]="false" [showCheckbox]="false"\r\n                [multiSelect]="false" [afterEdit]="afterEdit" [beforeEdit]="beforeEdit" \r\n                (selectChanged)="selectChanged($event)" (endEdit)="endEdit($event)"></farris-datagrid>\r\n            </div>\r\n          </ng-template>\r\n        </farris-tab>\r\n      </farris-tabs>\r\n    </div>\r\n\r\n<farris-lookup-grid style="display: none;" [items]="helpInfo.items" [columns]="helpInfo.columns"  [resizable]="true" [singleSelect]="true" \r\n  [idField]="helpInfo.fieldInfo.idField" [textField]="helpInfo.fieldInfo.textField" [valueField]="helpInfo.fieldInfo.valueField" \r\n  [pagination]="true"  [pageIndex]="helpInfo.pageInfo.pageIndex" [pageSize]="helpInfo.pageInfo.pageSize" [pageList]="helpInfo.pageInfo.pageList" \r\n  [total]="helpInfo.total" [title]="helpInfo.title" [displayType]="helpInfo.displayType" [dictPicked]="dictPicked" [remoteSearch]=\'false\'\r\n  (pagerChanged)="pagerChanged($event)" (search)="search($event)">\r\n</farris-lookup-grid>',providers:[hn],styles:[""]}]}],gn.ctorParameters=function(){return[{type:l.FormBuilder},{type:me},{type:J.ExpressionService},{type:ne.ComponentFactoryResolver},{type:ne.Injector},{type:O.SessionService},{type:te.BsModalService},{type:c.CommonComponentUiRTService},{type:ne.NgZone},{type:hn},{type:vt}]},gn.propDecorators={cls:[{type:ne.HostBinding,args:["class"]}],grid:[{type:ne.ViewChild,args:[q.DatagridComponent]}],lookup:[{type:ne.ViewChild,args:[X.LookupGridComponent]}],inputGroup:[{type:ne.ViewChild,args:["inputGroup"]}],component:[{type:ne.Input}]},gn);function gn(e,t,r,i,n,a,o,s,l,c,d){var p=this;this.formBuilder=e,this.designerState=t,this.expr=r,this.resolver=i,this.injector=n,this.sessionSrc=a,this.modalService=o,this.componentService=s,this.ngZone=l,this.service=c,this.util=d,this.cls="farris-main-area flex-column",this.showClearButton=!1,this.columns=[{field:"code",width:60,title:"编号"},{field:"name",width:60,title:"名称"},{field:"description",width:60,title:"描述",showTips:!0},{field:"valueText",width:100,title:"参数值",editor:{type:"input-group",options:{groupText:'<i class="f-icon f-icon-lookup"></i>',editable:!1,clickHandle:function(e){e.formControl.setValue(e.instance.value?e.instance.value:""),p.showExprHelp(e)},clear:function(e){var t,r;e.rowData.value="";try{for(var i=pe(p.component.actualParameters),n=i.next();!n.done;n=i.next()){var a=n.value;a.code===e.rowId&&(a.value="")}}catch(o){t={error:o}}finally{try{n&&!n.done&&(r=i["return"])&&r.call(i)}finally{if(t)throw t.error}}}}}}],this.helpInfo={helpId:"",su:"",columns:[],displayType:"List",items:[],pageInfo:{pageIndex:1,pageList:[10,20,30,50],pageSize:20},search:{category:"search"},title:"帮助",total:100,fieldInfo:{idField:"id",textField:"name",valueField:"id"}},this.beforeEdit=function(e){var t=e.rowData;switch((p.curParameter=t).fetchValueMode){case f.ParameterFetchValueMode.express:e.column.editor={type:"input-group",options:{groupText:'<i class="f-icon f-icon-lookup"></i>',editable:!1,clickHandle:function(e){e.formControl.setValue(e.instance.value?e.instance.value:""),p.showExprHelp(e)},clear:function(e){var t,r;e.rowData.value="";try{for(var i=pe(p.component.actualParameters),n=i.next();!n.done;n=i.next()){var a=n.value;a.code===e.rowId&&(a.value="")}}catch(o){t={error:o}}finally{try{n&&!n.done&&(r=i["return"])&&r.call(i)}finally{if(t)throw t.error}}}}};break;case f.ParameterFetchValueMode.none:e.column.editor={type:"input-group",options:{groupText:'<i class="f-icon f-icon-lookup"></i>',editable:!1,clickHandle:function(e){e.formControl.setValue(e.instance.value?e.instance.value:""),p.showExprHelp(e)},clear:function(e){var t,r;e.rowData.value="";try{for(var i=pe(p.component.actualParameters),n=i.next();!n.done;n=i.next()){var a=n.value;a.code===e.rowId&&(a.value="")}}catch(o){t={error:o}}finally{try{n&&!n.done&&(r=i["return"])&&r.call(i)}finally{if(t)throw t.error}}}}};break;case f.ParameterFetchValueMode["const"]:case f.ParameterFetchValueMode["enum"]:e.column.editor={type:U.EditorTypes.TEXTBOX,options:{}};break;case f.ParameterFetchValueMode.help:e.column.editor={type:"input-group",options:{groupText:'<i class="f-icon f-icon-lookup"></i>',editable:!1,clickHandle:function(e){p.cell=e,p.helpInfo.helpId=t.fetchValueSetting.helpId,p.helpInfo.su=t.fetchValueSetting.serviceUnit,p.helpInfo.pageInfo={pageIndex:1,pageList:[10,20,30,50],pageSize:20},p.helpInfo.search={category:"search"},p.getHelpInfo()},clear:function(e){var t,r;e.rowData.value="";try{for(var i=pe(p.component.actualParameters),n=i.next();!n.done;n=i.next()){var a=n.value;a.code===e.rowId&&(a.value="")}}catch(o){t={error:o}}finally{try{n&&!n.done&&(r=i["return"])&&r.call(i)}finally{if(t)throw t.error}}}}}}return T.of(!0)},this.afterEdit=function(e,t,r){return T.of(!0)},this.dictPicked=function(e){var t,r;if(p.cell){p.cell.formControl.setValue(p.util.getValue(e,p.helpInfo.fieldInfo.textField)),p.cell.instance.cd.detectChanges(),p.cell.rowData.value=p.util.getValue(e,p.helpInfo.fieldInfo.valueField);try{for(var i=pe(p.component.actualParameters),n=i.next();!n.done;n=i.next()){var a=n.value;a.code===p.cell.rowId&&(a.value=p.util.getValue(e,p.helpInfo.fieldInfo.valueField))}}catch(o){t={error:o}}finally{try{n&&!n.done&&(r=i["return"])&&r.call(i)}finally{if(t)throw t.error}}return T.of(!0)}}}var bn,xn=(ce(wn,bn=tn),wn);function wn(e,t,r){return bn.call(this,e,t,r)||this}var Cn=(In.prototype.getData=function(e,t){var r,i,n=t.customData,a=t.pageIndex||1,o=t.pageSize||20,s=JSON.parse(t.searchValue);if(s.searchValue||n.filter){var l="{";if(s.searchValue&&("*"===s.searchField?l+='"codeOrNameLike":"'+s.searchValue+'",':l+='"'+s.searchField+'":"'+s.searchValue+'",'),n.filter){var c=Object.keys(n.filter);if(c&&0<c.length)try{for(var d=pe(c),p=d.next();!p.done;p=d.next()){var u=p.value;n.filter[u]&&(l+='"'+u+'":"'+n.filter[u]+'",')}}catch(f){r={error:f}}finally{try{p&&!p.done&&(i=d["return"])&&i.call(d)}finally{if(r)throw r.error}}}","===l.substr(l.length-1,1)&&(l=l.substring(0,l.length-1)),l+="}",l=encodeURIComponent(l),e+="?pageFilter="+(l+="&pageIndex="+a+"&pageSize="+o)}else e+="?pageIndex="+a+"&pageSize="+o;return this.http.get(e).pipe(F.map(function(e){return{items:e.content,total:e.totalElements,pageInfo:{pageIndex:e.pageable.pageNumber+1,pageSize:e.pageable.pageSize,pageList:[20,40,60,80,100],enablePager:!0}}}))},In.decorators=[{type:ne.Injectable}],In.ctorParameters=function(){return[{type:O.HttpService}]},In);function In(e){this.http=e}var Sn=(kn.prototype.ngOnInit=function(){this.columns=[{title:"编号",field:"code",width:"80",searchField:"code"},{title:"名称",field:"name",width:"100",searchField:"name"}],this.dataUri="/api/runtime/wf/v1.0/reportingLineDefinitions/query",this.lookUp.mapFields={id:"id",name:"name"}},kn.prototype.afterClear=function(e){this.clear.next(e)},kn.prototype.showHelp=function(){this.lookUp.showDialog()},kn.decorators=[{type:ne.Component,args:[{selector:"app-wf-report-def-help",template:'\n    <farris-lookup-grid #lookup\n      [disabled]="disabled"\n      [editable]="false"\n      [bindingData]="bindingData"\n      [(ngModel)]="displayTxt"\n      [columns]="columns"\n      [singleSelect]="singleSelect"\n      [title]="title"\n      [displayType]="\'List\'"\n      [uri]="dataUri"\n      [idField]="\'id\'"\n      [pageIndex]="pageIndex"\n      [pageSize]="pageSize"\n      [pagination]="pagination"\n      [valueField]="\'id\'"\n      [textField]="\'name\'"\n      (clear)="afterClear($event)"\n      [dialogWidth]="width"\n      [dictPicking]="beforeOpen"\n      [dictPicked]="dictPicked">\n    </farris-lookup-grid>\n  ',providers:[{provide:X.ServerSideToken,useClass:Cn}]}]}],kn.ctorParameters=function(){return[]},kn.propDecorators={title:[{type:ne.Input}],width:[{type:ne.Input}],sourceType:[{type:ne.Input}],disabled:[{type:ne.Input}],singleSelect:[{type:ne.Input}],pagination:[{type:ne.Input}],pageIndex:[{type:ne.Input}],pageSize:[{type:ne.Input}],displayTxt:[{type:ne.Input}],bindingData:[{type:ne.Input}],filter:[{type:ne.Input}],afterConfirm:[{type:ne.Output}],dialogClosed:[{type:ne.Output}],clear:[{type:ne.Output}],lookUp:[{type:ne.ViewChild,args:["lookup"]}]},kn);function kn(){var t=this;this.width=550,this.disabled=!1,this.singleSelect=!0,this.pagination=!0,this.pageIndex=1,this.pageSize=20,this.filter={},this.afterConfirm=new ne.EventEmitter,this.dialogClosed=new ne.EventEmitter,this.clear=new ne.EventEmitter,this.columns=[],this.beforeOpen=function(e){return T.of({showDialog:!0,data:{filter:t.filter}})},this.dictPicked=function(e){return t.afterConfirm.next(e),T.of({closeDialog:!0})}}var En=(Object.defineProperty(Pn.prototype,"setReportingLineDataEntity",{set:function(e){var l=this;this.defName=e.reportingLineDefName;var t="/api/runtime/wf/v1.0/reportingLineDefinitions/"+(this.reportingLineDataEntity=e).reportingLineDefId;this.http.get(t).subscribe(function(e){var t,r;if(l.reportingLineDefinition=e,l.designerUIState.dimensions=[{value:"higherSuperior",text:"间接上级"}],"directSuperior"!==JSON.parse(l.reportingLineDefinition.dimensions)[0].code){var i={value:"directSuperior",text:"直接上级"};l.designerUIState.dimensions.push(i)}try{for(var n=pe(JSON.parse(l.reportingLineDefinition.dimensions)),a=n.next();!a.done;a=n.next()){var o=a.value;i={value:o.code,text:o.name},l.designerUIState.dimensions.push(i)}}catch(s){t={error:s}}finally{try{a&&!a.done&&(r=n["return"])&&r.call(n)}finally{if(t)throw t.error}}}),this.users=[e],e.refUserId?(this.users[0].performerName=this.variableParticipantName(e.refUserId),this.curReportingRefer=this.reportingReferObjects[1].value,this.display="block"):e.refEmployeeId?(this.users[0].performerName=e.refEmployeeId,this.curReportingRefer=this.reportingReferObjects[2].value,this.display="block"):this.curReportingRefer=this.reportingReferObjects[0].value,e.reportingLineDefId&&(this.typeReadOnly=!0)},enumerable:!0,configurable:!0}),Pn.prototype.ngOnInit=function(){},Pn.prototype.getReportingLineType=function(){var t=this;this.http.get("/api/runtime/wf/v1.0/reportingLineDefinitions").subscribe(function(e){t.reportingLineDefinitionList=e,t.items=t.reportingLineDefinitionList.slice(0,t.pageSize),t.total=t.reportingLineDefinitionList.length})},Pn.prototype.onclear=function(){this.reportingLineDataEntity=new xn},Pn.prototype.referObjectChange=function(e){"dept"===e?(this.display="none",this.curReportingRefer=this.reportingReferObjects[0].value,this.reportingLineDataEntity.refUserId=null,this.reportingLineDataEntity.refEmployeeId=null):"sysUser"===e?(this.display="block",this.curReportingRefer=this.reportingReferObjects[1].value,this.reportingLineDataEntity.refOrgId=null,this.reportingLineDataEntity.refOrgName=null,this.reportingLineDataEntity.refEmployeeId=null):(this.display="block",this.curReportingRefer=this.reportingReferObjects[2].value,this.reportingLineDataEntity.refOrgId=null,this.reportingLineDataEntity.refOrgName=null,this.reportingLineDataEntity.refUserId=null),this.users=[],this.departments=[]},Pn.prototype.referUserChange=function(e){console.log(e)},Pn.prototype.reportingDimensionChange=function(e){},Pn.prototype.orgSelected=function(e){this.reportingLineDataEntity.refOrgId=e.id,this.reportingLineDataEntity.refOrgName=e.name},Pn.prototype.editCondition=function(){var e,t,r,i,n,a,o,s,l,c,d,p,u,f,h=this;if(0<this.designerUIState.schemas.length){try{for(var m=pe(this.designerUIState.schemas),v=m.next();!v.done;v=m.next()){var y=v.value;this.expr.addSchema("Schema",y)}}catch(R){e={error:R}}finally{try{v&&!v.done&&(t=m["return"])&&t.call(m)}finally{if(e)throw e.error}}if(this.designerUIState.schemas[0].entityTypes&&0<this.designerUIState.schemas[0].entityTypes.length){var g=this.designerUIState.schemas[0].entityTypes[0];this.expr.addInjectedEntity(g.name,"Schema",g.name,J.InjectedType.EntityType)}}var b=new Array;if(0<this.designerUIState.procInstContext.length)try{for(var x=pe(this.designerUIState.procInstContext),w=x.next();!w.done;w=x.next()){var C=w.value;b.push(C)}}catch(z){r={error:z}}finally{try{w&&!w.done&&(i=x["return"])&&i.call(x)}finally{if(r)throw r.error}}if(0<this.designerUIState.formalParameterContext.length){var I=function(t){b.some(function(e){return e.key===t.key})||b.push(t)};try{for(var S=pe(this.designerUIState.formalParameterContext),k=S.next();!k.done;k=S.next())I(C=k.value)}catch(H){n={error:H}}finally{try{k&&!k.done&&(a=S["return"])&&a.call(S)}finally{if(n)throw n.error}}}if(0<this.designerUIState.participantContext.length){var E=function(t){b.some(function(e){return e.key===t.key})||b.push(t)};try{for(var P=pe(this.designerUIState.participantContext),T=P.next();!T.done;T=P.next())E(C=T.value)}catch(j){o={error:j}}finally{try{T&&!T.done&&(s=P["return"])&&s.call(P)}finally{if(o)throw o.error}}}if(0<this.designerUIState.processVariableContext.length){var F=function(t){b.some(function(e){return e.key===t.key})||b.push(t)};try{for(var A=pe(this.designerUIState.processVariableContext),M=A.next();!M.done;M=A.next())F(C=M.value)}catch(U){l={error:U}}finally{try{M&&!M.done&&(c=A["return"])&&c.call(A)}finally{if(l)throw l.error}}}if(0<this.designerUIState.activityComponentContext.length){var D=function(t){b.some(function(e){return e.key===t.key})||b.push(t)};try{for(var O=pe(this.designerUIState.activityComponentContext),V=O.next();!V.done;V=O.next())D(C=V.value)}catch(q){d={error:q}}finally{try{V&&!V.done&&(p=O["return"])&&p.call(O)}finally{if(d)throw d.error}}}if(0<b.length)try{for(var L=pe(b),N=L.next();!N.done;N=L.next()){var B=N.value;this.expr.addContext(B)}}catch(G){u={error:G}}finally{try{N&&!N.done&&(f=L["return"])&&f.call(L)}finally{if(u)throw u.error}}this.expr.setEditPattern(J.ExprEditMode.Conditional),this.expr.addExpressionText(this.reportingLineDataEntity.condition),this.expr.buildExpression().then(function(e){h.reportingLineDataEntity.condition=e})},Pn.prototype.getReportingTypes=function(t){var e=(this.pageIndex-1)*this.pageSize,r=e+this.pageSize,i=[];i=t?this.reportingLineDefinitionList.filter(function(e){return-1<e.name.indexOf(t)||-1<e.code.indexOf(t)}):this.reportingLineDefinitionList,this.total=i.length,this.items=i.slice(e,r),this.lookup.componentRef.instance.loadData({total:this.total,pageSize:this.pageSize,pageIndex:this.pageIndex,data:this.items})},Pn.prototype.ngAfterViewInit=function(){var e=this;this.ngZone.runOutsideAngular(function(){e.inputGroup.nativeElement.addEventListener("mouseenter",e.onMouseEnter.bind(e)),e.inputGroup.nativeElement.addEventListener("mouseleave",e.onMouseLeave.bind(e)),e.inputGroup1.nativeElement.addEventListener("mouseenter",e.onMouseEnter.bind(e)),e.inputGroup1.nativeElement.addEventListener("mouseleave",e.onMouseLeave.bind(e))})},Pn.prototype.onMouseEnter=function(e){this.showClearButton=!0,this.showClearButton&&this.toggleClearIcon(e,!0)},Pn.prototype.onMouseLeave=function(e){this.showClearButton=!1,this.toggleClearIcon(e,!1)},Pn.prototype.toggleClearIcon=function(e,t){void 0===t&&(t=!1);var r=t?"":"none",i=e.target.querySelector(".input-group-clear");i&&(i.style.display=r)},Pn.prototype.clear=function(e){this.reportingLineDataEntity.refOrgId="",this.reportingLineDataEntity.refOrgName=""},Pn.prototype.clearUser=function(){this.users=[],this.reportingLineDataEntity.refUserId="",this.reportingLineDataEntity.refEmployeeId=""},Pn.prototype.clearOrg=function(){this.departments=[],this.reportingLineDataEntity.refOrgId=""},Pn.prototype.selectOrg=function(e){this.showExprHelp(e)},Pn.prototype.selectUsers=function(e){this.showExprHelp(e)},Pn.prototype.showExprHelp=function(i){var e,t,r,n,a,o,s,l,c=this;if(this.expr.setEditPattern(J.ExprEditMode.Advanced),0<this.designerUIState.schemas.length){try{for(var d=pe(this.designerUIState.schemas),p=d.next();!p.done;p=d.next()){var u=p.value;this.expr.addSchema("Schema",u)}}catch(S){e={error:S}}finally{try{p&&!p.done&&(t=d["return"])&&t.call(d)}finally{if(e)throw e.error}}if(this.designerUIState.schemas[0].entityTypes&&0<this.designerUIState.schemas[0].entityTypes.length){var f=this.designerUIState.schemas[0].entityTypes[0];this.expr.addInjectedEntity(f.name,"Schema",f.name,J.InjectedType.EntityType)}}var h=new Array;if(0<this.designerUIState.participantContext.length)try{for(var m=pe(this.designerUIState.participantContext),v=m.next();!v.done;v=m.next()){var y=v.value;h.push(y)}}catch(k){r={error:k}}finally{try{v&&!v.done&&(n=m["return"])&&n.call(m)}finally{if(r)throw r.error}}if(0<this.designerUIState.processVariableContext.length){var g=function(t){h.some(function(e){return e.key===t.key})||h.push(t)};try{for(var b=pe(this.designerUIState.processVariableContext),x=b.next();!x.done;x=b.next())g(y=x.value)}catch(E){a={error:E}}finally{try{x&&!x.done&&(o=b["return"])&&o.call(b)}finally{if(a)throw a.error}}}if(0<h.length)try{for(var w=pe(h),C=w.next();!C.done;C=w.next()){var I=C.value;this.expr.addContext(I)}}catch(P){s={error:P}}finally{try{C&&!C.done&&(l=w["return"])&&l.call(w)}finally{if(s)throw s.error}}"sysUser"===i?this.reportingLineDataEntity.refUserId&&0<this.reportingLineDataEntity.refUserId.length?this.expr.addExpressionText(this.reportingLineDataEntity.refUserId):this.expr.addExpressionText(""):"org"===i?this.reportingLineDataEntity.refOrgId&&0<this.reportingLineDataEntity.refOrgId.length?this.expr.addExpressionText(this.reportingLineDataEntity.refOrgId):this.expr.addExpressionText(""):this.reportingLineDataEntity.refEmployeeId&&0<this.reportingLineDataEntity.refEmployeeId.length?this.expr.addExpressionText(this.reportingLineDataEntity.refEmployeeId):this.expr.addExpressionText(""),this.expr.buildExpression().then(function(e){if("sysUser"===i){var t=new tn(e,"","wf.ReportingLineParticipant");t.tag="expression",t.performerName=c.variableParticipantName(e),c.reportingLineDataEntity.refUserId=t.performerId,c.reportingLineDataEntity.tag=t.tag,c.reportingLineDataEntity.performerName=t.performerName,c.users=[c.reportingLineDataEntity]}else if("org"===i)new tn(e,"","wf.ReportingLineParticipant").tag="expression",c.reportingLineDataEntity.refOrgName=e,c.reportingLineDataEntity.refOrgId=e,c.departments=[c.reportingLineDataEntity];else{var r=new tn(e,"","wf.ReportingLineParticipant");r.performerName=e,r.tag="expression",c.reportingLineDataEntity.refEmployeeId=e,c.reportingLineDataEntity.performerName=r.performerName,c.users=[c.reportingLineDataEntity]}})},Pn.prototype.variableParticipantName=function(e){var t,r,i,n;try{for(var a=pe(this.designerUIState.participantContext),o=a.next();!o.done;o=a.next()){var s=o.value;if(-1<e.indexOf(s.key))return s.name}}catch(d){t={error:d}}finally{try{o&&!o.done&&(r=a["return"])&&r.call(a)}finally{if(t)throw t.error}}try{for(var l=pe(this.designerUIState.processVariableContext),c=l.next();!c.done;c=l.next())if(s=c.value,-1<e.indexOf(s.key))return s.name}catch(p){i={error:p}}finally{try{c&&!c.done&&(n=l["return"])&&n.call(l)}finally{if(i)throw i.error}}return"业务字段"},Pn.prototype.defChanged=function(){var t=this;System["import"]("/platform/runtime/wf/web/wf-reporting-data/reportingLineDefHelp.js?v=20210903").then(function(){window.gspWfReportingLineDef.ReportingLineDefHelpUtil.getReportingLineHelp().then(function(e){t.defSelected(e)})})},Pn.prototype.defSelected=function(e){var t,r;if(this.defName=e.name,this.reportingLineDataEntity.reportingLineDefId=e.id,this.reportingLineDataEntity.reportingLineDefName=e.name,this.reportingLineDimension=JSON.parse(e.dimensions),this.designerUIState.dimensions=[{value:"higherSuperior",text:"间接上级"}],"directSuperior"!==this.reportingLineDimension[0].code){var i={value:"directSuperior",text:"直接上级"};this.designerUIState.dimensions.push(i)}try{for(var n=pe(this.reportingLineDimension),a=n.next();!a.done;a=n.next()){var o=a.value;i={value:o.code,text:o.name},this.designerUIState.dimensions.push(i)}}catch(s){t={error:s}}finally{try{a&&!a.done&&(r=n["return"])&&r.call(n)}finally{if(t)throw t.error}}return this.curReportingRefer=this.reportingReferObjects[0].value,T.of(!0)},Pn.prototype.getPerformers=function(){return this.reportingLineDataEntity.type="wf.ReportingLineParticipant",this.reportingLineDataEntity.reportingReferObject=this.curReportingRefer,this.reportingLineDataEntity},Pn.decorators=[{type:ne.Component,args:[{selector:"app-reporting-line",template:'<sys-farris-tree-help class="flex-fill" #orgHelp style="display: none;"\r\n                      [singleSelect]="true" [sourceType]="\'org\'" [disabled]="false" [filter]="treeFilter"\r\n                      [useBeforeCloseEvent]="false" [async]="true"\r\n                      (afterConfirm)="orgSelected($event)">\r\n</sys-farris-tree-help>\r\n\r\n<div class="d-flex flex-fill farris-overflow-y-auto p-md-2">\r\n  <form style="background: #F0F3F6; width: 100%; height: 420px">\r\n    <div class="d-flex m-2 flex-column w-100">\r\n      <div class="d-flex flex-column mx-5 my-4" style="background: #FFF;">\r\n        <div class="farris-form form-inline  farris-form-inline mr-5">\r\n          <div class="col-12 farris-group-auto my-4">\r\n            <div class="farris-group-wrap">\r\n              <div class="form-group farris-form-group">\r\n                <label class="col-form-label">\r\n                  <span class="farris-label-info text-danger">*</span>\r\n                  <span class="farris-label-text">汇报定义</span>\r\n                </label>\r\n                <div class="farris-input-wrap">\r\n                  \x3c!--<farris-lookup-grid [items]="items" [columns]="columns" [(ngModel)]="reportingLineDataEntity.reportingLineDefName"\r\n                    name="definitionId" [resizable]="true" [singleSelect]="true" [idField]="\'id\'" [pagination]="true"\r\n                    [pageIndex]="pageIndex" [pageSize]="pageSize" [pageList]="pageList" [total]="total" [textField]="\'name\'"\r\n                    [valueField]="\'id\'" [title]="\'汇报类型\'" [dictPicked]="dictPicked" (clear)="onclear()" [readonly]="typeReadOnly"\r\n                    [customDisplayType] = "true" [displayType]="\'LIST\'">\r\n                  </farris-lookup-grid>--\x3e\r\n                  <input-group [editable]="false" [customCls]="\'custom-cls\'" [groupText]="groupIcon2"\r\n                               [(value)]="defName"\r\n                               (clickHandle)="defChanged()" [enableClear]="false"\r\n                  ></input-group>\r\n                  <div class="farris-feedback valid-feedback"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class="col-12 farris-group-auto my-4">\r\n            <div class="farris-group-wrap">\r\n              <div class="form-group farris-form-group">\r\n                <label class="col-form-label">\r\n                  <span class="farris-label-info text-danger">*</span>\r\n                  <span class="farris-label-text">汇报级别</span>\r\n                </label>\r\n                <div class="farris-input-wrap">\r\n                  <farris-combo-list [(ngModel)]="reportingLineDataEntity.dimension" name="dimension" [panelHeight]="200"\r\n                                     [idField]="\'value\'" [textField]="\'text\'" [data]="this.designerUIState.dimensions" (valueChange)="reportingDimensionChange($event)"\r\n                                     ></farris-combo-list>\r\n                  <div class="farris-feedback valid-feedback"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class="col-12 farris-group-auto my-4">\r\n            <div class="farris-group-wrap">\r\n              <div class="form-group farris-form-group">\r\n                <label class="col-form-label">\r\n                  <span class="farris-label-info text-danger">*</span>\r\n                  <span class="farris-label-text">参照类型</span>\r\n                </label>\r\n                <div class="farris-input-wrap">\r\n                  <farris-radiogroup [data]="reportingReferObjects" [horizontal]="true"\r\n                                     [(ngModel)]="curReportingRefer" name="referObject"\r\n                                     (changeValue)="referObjectChange($event)"\r\n                  ></farris-radiogroup>\r\n                  <div class="farris-feedback valid-feedback"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class="col-12 farris-group-auto my-4" [ngStyle]="{\'display\':display}">\r\n            <div class="farris-group-wrap">\r\n              <div class="form-group farris-form-group">\r\n                <label class="col-form-label">\r\n                  <span class="farris-label-info text-danger">*</span>\r\n                  <span class="farris-label-text">参照人</span>\r\n                </label>\r\n                <div class="farris-input-wrap">\r\n                  <div #inputGroup1 class="input-group">\r\n                    <input type="text" class="form-control" [value]="users | usersName " [(ngModel)]="reportingLineDataEntity.performerName" name="users" [readOnly]="true" />\r\n                    <div class="input-group-append">\r\n                      <span [style.display]="showClearButton ? \'\' : \'none\'" class="input-group-text input-group-clear"\r\n                            (click)="clearUser()">\r\n                        <i class="f-icon modal_close"></i>\r\n                      </span>\r\n                      <span *ngIf="curReportingRefer === \'sysUser\'" class="input-group-text" (click)="selectUsers(\'sysUser\')" style="background: #FFF;">\r\n                        <i class="f-icon f-icon-lookup"></i>\r\n                      </span>\r\n                      <span *ngIf="curReportingRefer === \'employee\'" class="input-group-text" (click)="selectUsers(\'employee\')" style="background: #FFF;">\r\n                        <i class="f-icon f-icon-lookup"></i>\r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n                  <div class="farris-feedback valid-feedback"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class="col-12 farris-group-auto my-4">\r\n            <div class="farris-group-wrap">\r\n              <div class="form-group farris-form-group">\r\n                <label class="col-form-label">\r\n                  <span class="farris-label-info text-danger" [ngStyle]="{\'display\':display === \'none\' ? \'block\':\'none\'}">*</span>\r\n                  <span class="farris-label-text">参照组织</span>\r\n                </label>\r\n                <div class="farris-input-wrap">\r\n                  <div #inputGroup class="input-group">\r\n                    <input type="text" class="form-control" [(ngModel)]="reportingLineDataEntity.refOrgId" name="dept" [readOnly]="true" />\r\n                    <div class="input-group-append">\r\n                      <span [style.display]="showClearButton ? \'\' : \'none\'" class="input-group-text input-group-clear"\r\n                            (click)="clearOrg()">\r\n                        <i class="f-icon modal_close"></i>\r\n                      </span>\r\n                      <span class="input-group-text" (click)="selectOrg(\'org\')" style="background: #FFF;">\r\n                        <i class="f-icon f-icon-lookup"></i>\r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n                  <div class="farris-feedback valid-feedback"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class="d-flex flex-column mx-5" style="background: #FFF;">\r\n        <div class="farris-form form-inline farris-form-inline mr-5">\r\n          <div class="col-12 farris-group-auto my-4">\r\n            <div class="farris-group-wrap">\r\n              <div class="form-group farris-form-group">\r\n                <label class="col-form-label">\r\n                  <span class="farris-label-text">启用条件</span>\r\n                </label>\r\n                <div class="farris-input-wrap">\r\n                  <div class="input-group">\r\n                    <input type="text" class="form-control" [(ngModel)]="reportingLineDataEntity.condition" name="conditon" [readOnly]="true" />\r\n                    <div class="input-group-append">\r\n                      <span class="input-group-text" (click)="editCondition()" style="background: #FFF;">\r\n                        <i class="f-icon f-icon-lookup"></i>\r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n                  <div class="farris-feedback valid-feedback"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </form>\r\n</div>\r\n\r\n<app-wf-report-def-help style="display: none;" [singleSelect]="true" [title]="\'汇报关系定义\'" (afterConfirm)="defSelected($event)">\r\n\r\n</app-wf-report-def-help>\r\n',styles:[""]}]}],Pn.ctorParameters=function(){return[{type:O.HttpService},{type:me},{type:J.ExpressionService},{type:ne.NgZone}]},Pn.propDecorators={cls:[{type:ne.HostBinding,args:["class"]}],reportingLineDefHelp:[{type:ne.ViewChild,args:[Sn]}],setReportingLineDataEntity:[{type:ne.Input}],lookup:[{type:ne.ViewChild,args:[X.LookupGridComponent]}],orgHelp:[{type:ne.ViewChild,args:[d.SysFarrisTreeHelpComponent]}],inputGroup:[{type:ne.ViewChild,args:["inputGroup"]}],inputGroup1:[{type:ne.ViewChild,args:["inputGroup1"]}]},Pn);function Pn(e,t,r,i){this.http=e,this.designerUIState=t,this.expr=r,this.ngZone=i,this.cls="d-flex flex-fill h-100",this.treeFilter="",this.display="none",this.typeReadOnly=!1,this.groupIcon2='<i class="f-icon f-icon-lookup"></i>',this.defName="",this.reportingLineDataEntity=new xn,this.reportingLineDefinitionList=[],this.reportingLineDimension=[],this.showClearButton=!1,this.items=[],this.users=[],this.departments=[],this.pageIndex=1,this.pageSize=20,this.pageList=[10,20,30,50,100],this.total=0,this.columns=[{title:"编号",field:"code",width:100},{title:"名称",field:"name",width:100}],this.reportingReferObjects=[{name:"组织",value:"dept"},{name:"系统用户",value:"sysUser"},{name:"员工",value:"employee"}],this.curReportingRefer=this.reportingReferObjects[0].value,this.getReportingLineType()}var Tn,Fn=function Os(){},An=(ce(Mn,Tn=tn),Mn);function Mn(e,t,r){return Tn.call(this,e,t,r)||this}var Dn=(On.prototype.ngOnInit=function(){},On.prototype.load=function(e){this.data=fe(e)},On.prototype.onConfirm=function(){var e=this;0===this.selectedIds.length&&this.messageService.warning("尚未选中枚举值");var t=this.data.filter(function(t){return-1<e.selectedIds.findIndex(function(e){return e===t.key})});this.confirm.next(t),this.closeModalEmitter.next()},On.prototype.cancel=function(){this.closeModalEmitter.next()},On.decorators=[{type:ne.Component,args:[{selector:"app-enum-list",template:'<ng-template #buttons>\r\n  <button class="btn btn-primary" (click)="onConfirm()">确定</button>\r\n  <button class="btn btn-secondary" (click)="cancel()">取消</button>\r\n</ng-template>\r\n\r\n<div class="f-page">\r\n  <div class="f-page-main f-utils-fill-flex-column h-100">\r\n    <div class="f-utils-fill-flex-column farris-overflow-y-auto h-100">\r\n      <farris-datagrid [data]="data" [columns]="columns" #dg="datagrid" [fit]="true"\r\n                       [idField]="\'key\'" [fitColumns]="true" [showLineNumber]="true" [(checkValues)]="selectedIds"\r\n                       [showAllCheckbox]="true" [showCheckbox]="true" [multiSelect]="false" [checkOnSelect]="true" [selectOnCheck]="true"\r\n                       [lineNumberTitle]="\'序号\'" [lineNumberWidth]="50" [striped]="true" [virtualized]="true" [pagination]="false">\r\n      </farris-datagrid>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n',styles:[""]}]}],On.ctorParameters=function(){return[{type:Y.MessagerService},{type:ne.Injector}]},On.propDecorators={cls:[{type:ne.HostBinding,args:["class"]}],dg:[{type:ne.ViewChild,args:["dg"]}],btnRef:[{type:ne.ViewChild,args:["buttons"]}]},On);function On(e,t){this.messageService=e,this.injector=t,this.cls="farris-main-area flex-column",this.columns=[{field:"key",width:100,title:"键"},{field:"value",width:100,title:"值"}],this.confirm=new a.Subject,this.closeModalEmitter=new a.Subject,this.data=new Array,this.selectedIds=new Array}var Vn=(Object.defineProperty(Ln.prototype,"setMatrixDataEntity",{set:function(t){var r=this,e="/api/runtime/wf/v1.0/matrixDefinition/"+(this.curMatrixDataEntity=t).matrixDefId;this.http.get(e).subscribe(function(e){r.curMatrixDefEntity=e,r.setFields(),r.curDataFieldValue=t.dataFieldAlias}),t.matrixDefId&&(this.typeReadOnly=!0),this.curMatrixDataEntity.conditionField1?"{"===this.curMatrixDataEntity.conditionField1.charAt(0)?(this.condition1="expr",this.condition1ExprAble=!0):(this.condition1="help",this.condition1ExprAble=!1):(this.condition1="expr",this.condition1ExprAble=!0),this.curMatrixDataEntity.conditionField2?"{"===this.curMatrixDataEntity.conditionField2.charAt(0)?(this.condition2="expr",this.condition2ExprAble=!0):(this.condition2="help",this.condition2ExprAble=!1):(this.condition2="expr",this.condition2ExprAble=!0),this.curMatrixDataEntity.conditionField3?"{"===this.curMatrixDataEntity.conditionField3.charAt(0)?(this.condition3="expr",this.condition3ExprAble=!0):(this.condition3="help",this.condition3ExprAble=!1):(this.condition3="expr",this.condition3ExprAble=!0),this.condition1Text=this.curMatrixDataEntity.conditionFieldText1?this.curMatrixDataEntity.conditionFieldText1:"",this.condition1Value=this.curMatrixDataEntity.conditionField1?this.curMatrixDataEntity.conditionField1:"",this.condition2Text=this.curMatrixDataEntity.conditionFieldText2?this.curMatrixDataEntity.conditionFieldText2:"",this.condition2Value=this.curMatrixDataEntity.conditionField2?this.curMatrixDataEntity.conditionField2:"",this.condition3Text=this.curMatrixDataEntity.conditionFieldText3?this.curMatrixDataEntity.conditionFieldText3:"",this.condition3Value=this.curMatrixDataEntity.conditionField3?this.curMatrixDataEntity.conditionField3:""},enumerable:!0,configurable:!0}),Ln.prototype.ngOnInit=function(){},Ln.prototype.getMatrixLineType=function(){var t=this;this.http.get("/api/runtime/wf/v1.0/matrixDefinition").subscribe(function(e){t.matrixDefEntityList=e,t.items=t.matrixDefEntityList.slice(0,t.pageSize),t.total=t.matrixDefEntityList.length})},Ln.prototype.setFields=function(){var e,t,r,i;this.conditionFields=[],this.dataFieldAndValues=[],this.curMatrixDefEntity.conditionField.sort(function(e,t){return e.sortOrder-t.sortOrder});try{for(var n=pe(this.curMatrixDefEntity.conditionField),a=n.next();!a.done;a=n.next()){var o=a.value;this.conditionFields.push(o)}}catch(p){e={error:p}}finally{try{a&&!a.done&&(t=n["return"])&&t.call(n)}finally{if(e)throw e.error}}this.curMatrixDefEntity.dataField.sort(function(e,t){return e.sortOrder-t.sortOrder});try{for(var s=pe(this.curMatrixDefEntity.dataField),l=s.next();!l.done;l=s.next()){var c=l.value,d={text:c.alias,value:c.alias};this.dataFieldAndValues.push(d)}}catch(u){r={error:u}}finally{try{l&&!l.done&&(i=s["return"])&&i.call(s)}finally{if(r)throw r.error}}},Ln.prototype.onClear=function(){this.curMatrixDataEntity=new An},Ln.prototype.editCondition=function(){var e,t,r,i,n,a,o,s,l,c,d,p,u=this;if(0<this.designerUIState.schemas.length){try{for(var f=pe(this.designerUIState.schemas),h=f.next();!h.done;h=f.next()){var m=h.value;this.expr.addSchema("Schema",m)}}catch(O){e={error:O}}finally{try{h&&!h.done&&(t=f["return"])&&t.call(f)}finally{if(e)throw e.error}}if(this.designerUIState.schemas[0].entityTypes&&0<this.designerUIState.schemas[0].entityTypes.length){var v=this.designerUIState.schemas[0].entityTypes[0];this.expr.addInjectedEntity(v.name,"Schema",v.name,J.InjectedType.EntityType)}}var y=new Array;if(0<this.designerUIState.procInstContext.length)try{for(var g=pe(this.designerUIState.procInstContext),b=g.next();!b.done;b=g.next()){var x=b.value;y.push(x)}}catch(V){r={error:V}}finally{try{b&&!b.done&&(i=g["return"])&&i.call(g)}finally{if(r)throw r.error}}if(0<this.designerUIState.formalParameterContext.length){var w=function(t){y.some(function(e){return e.key===t.key})||y.push(t)};try{for(var C=pe(this.designerUIState.formalParameterContext),I=C.next();!I.done;I=C.next())w(x=I.value)}catch(L){n={error:L}}finally{try{I&&!I.done&&(a=C["return"])&&a.call(C)}finally{if(n)throw n.error}}}if(0<this.designerUIState.participantContext.length){var S=function(t){y.some(function(e){return e.key===t.key})||y.push(t)};try{for(var k=pe(this.designerUIState.participantContext),E=k.next();!E.done;E=k.next())S(x=E.value)}catch(N){o={error:N}}finally{try{E&&!E.done&&(s=k["return"])&&s.call(k)}finally{if(o)throw o.error}}}if(0<this.designerUIState.processVariableContext.length){var P=function(t){y.some(function(e){return e.key===t.key})||y.push(t)};try{for(var T=pe(this.designerUIState.processVariableContext),F=T.next();!F.done;F=T.next())P(x=F.value)}catch(B){l={error:B}}finally{try{F&&!F.done&&(c=T["return"])&&c.call(T)}finally{if(l)throw l.error}}}if(0<y.length)try{for(var A=pe(y),M=A.next();!M.done;M=A.next()){var D=M.value;this.expr.addContext(D)}}catch(R){d={error:R}}finally{try{M&&!M.done&&(p=A["return"])&&p.call(A)}finally{if(d)throw d.error}}this.expr.setEditPattern(J.ExprEditMode.Conditional),this.expr.addExpressionText(this.curMatrixDataEntity.condition),this.expr.buildExpression().then(function(e){u.curMatrixDataEntity.condition=e})},Ln.prototype.onHelpSearch=function(e,t,r){this.index=t,this.fieldId=r,this.helpId=this.curMatrixDefEntity.conditionField[this.index].smartHelp,this.lookUp.onClear(),this.lookUp.showDialog()},Ln.prototype.openEnumValue=function(e,t){this.index=e,this.fieldId=t,this.showEnumList(JSON.parse(this.curMatrixDefEntity.conditionField[this.index].enumList))},Ln.prototype.showEnumList=function(e){var t=this,r=this.resolver.resolveComponentFactory(Dn).create(this.injector),i={title:"枚举选择",width:650,height:450,showButtons:!0,buttons:r.instance.btnRef};e&&0<e.length&&r.instance.load(e),r.instance.confirm.subscribe(function(e){0===t.index?(t.condition1Text=e[0].value,t.condition1Value=e[0].value):1===t.index?(t.condition2Text=e[0].value,t.condition2Value=e[0].value):2===t.index&&(t.condition3Text=e[0].value,t.condition3Value=e[0].value)});var n=this.modalService.show(r,i);r.instance.closeModalEmitter.subscribe(function(){n.close()})},Ln.prototype.dataFieldChange=function(e){this.curMatrixDataEntity.dataFieldAlias=e.data.value},Ln.prototype.selectedDataHandler=function(e){0===this.index?(this.condition1Text=e.name,this.condition1Value=e.id):1===this.index?(this.condition2Text=e.name,this.condition2Value=e.id):2===this.index&&(this.condition3Text=e.name,this.condition3Value=e.id)},Ln.prototype.getPerformers=function(){return this.curMatrixDataEntity.type="wf.MatrixParticipant",this.curMatrixDataEntity.conditionFieldText1=this.condition1Text,this.curMatrixDataEntity.conditionField1=""===this.condition1Text?"":this.condition1Value,this.curMatrixDataEntity.conditionFieldText2=this.condition2Text,this.curMatrixDataEntity.conditionField2=""===this.condition2Text?"":this.condition2Value,this.curMatrixDataEntity.conditionFieldText3=this.condition3Text,this.curMatrixDataEntity.conditionField3=""===this.condition3Text?"":this.condition3Value,this.curMatrixDataEntity},Ln.prototype.showExprHelp=function(t){var e,r,i,n,a,o,s,l,c=this;if(0<this.designerUIState.schemas.length){try{for(var d=pe(this.designerUIState.schemas),p=d.next();!p.done;p=d.next()){var u=p.value;this.expr.addSchema("Schema",u)}}catch(S){e={error:S}}finally{try{p&&!p.done&&(r=d["return"])&&r.call(d)}finally{if(e)throw e.error}}if(this.designerUIState.schemas[0].entityTypes&&0<this.designerUIState.schemas[0].entityTypes.length){var f=this.designerUIState.schemas[0].entityTypes[0];this.expr.addInjectedEntity(f.name,"Schema",f.name,J.InjectedType.EntityType)}}var h=new Array;if(0<this.designerUIState.participantContext.length)try{for(var m=pe(this.designerUIState.participantContext),v=m.next();!v.done;v=m.next()){var y=v.value;h.push(y)}}catch(k){i={error:k}}finally{try{v&&!v.done&&(n=m["return"])&&n.call(m)}finally{if(i)throw i.error}}if(0<this.designerUIState.processVariableContext.length){var g=function(t){h.some(function(e){return e.key===t.key})||h.push(t)};try{for(var b=pe(this.designerUIState.processVariableContext),x=b.next();!x.done;x=b.next())g(y=x.value)}catch(E){a={error:E}}finally{try{x&&!x.done&&(o=b["return"])&&o.call(b)}finally{if(a)throw a.error}}}if(0<h.length)try{for(var w=pe(h),C=w.next();!C.done;C=w.next()){var I=C.value;this.expr.addContext(I)}}catch(P){s={error:P}}finally{try{C&&!C.done&&(l=w["return"])&&l.call(w)}finally{if(s)throw s.error}}"condition1"===t?this.curMatrixDataEntity.conditionField1?this.expr.addExpressionText(this.curMatrixDataEntity.conditionField1):this.expr.addExpressionText(""):"condition2"===t?this.curMatrixDataEntity.conditionField2?this.expr.addExpressionText(this.curMatrixDataEntity.conditionField2):this.expr.addExpressionText(""):"condition3"===t&&(this.curMatrixDataEntity.conditionField3?this.expr.addExpressionText(this.curMatrixDataEntity.conditionField3):this.expr.addExpressionText("")),this.expr.buildExpression().then(function(e){"condition1"===t?(c.condition1Text=e,c.condition1Value=e):"condition2"===t?(c.condition2Text=e,c.condition2Value=e):(c.condition3Text=e,c.condition3Value=e)})},Ln.prototype.condition1Expr=function(e){this.showExprHelp(e)},Ln.prototype.condition1ExprClick=function(){this.condition1ExprAble=!this.condition1ExprAble,this.condition1Text="",this.condition1Value=""},Ln.prototype.condition2Expr=function(e){this.showExprHelp(e)},Ln.prototype.condition2ExprClick=function(){this.condition2ExprAble=!this.condition2ExprAble,this.condition2Text="",this.condition2Value=""},Ln.prototype.condition3Expr=function(e){this.showExprHelp(e)},Ln.prototype.condition3ExprClick=function(){this.condition3ExprAble=!this.condition3ExprAble,this.condition3Text="",this.condition3Value=""},Ln.decorators=[{type:ne.Component,args:[{selector:"app-matrix-performer",template:'<div class="d-flex flex-fill farris-overflow-y-auto p-md-2">\r\n  <form style="background: #F0F3F6; width: 100%; height: 470px">\r\n    <div class="d-flex m-2 flex-column w-100">\r\n      <div class="d-flex flex-column mx-5 my-4" style="background: #FFF;">\r\n        <div class="farris-form form-inline  farris-form-inline">\x3c!--mr-5--\x3e\r\n          <div class="col-12 farris-group-auto my-4">\r\n            <div class="farris-group-wrap">\r\n              <div class="form-group farris-form-group">\r\n                <label class="col-form-label" style="width: 15%">\r\n                  <span class="farris-label-info text-danger">*</span>\r\n                  <span class="farris-label-text">引用矩阵表</span>\r\n                </label>\r\n                <div class="farris-input-wrap" style="width: 70%">\r\n                  <farris-lookup-grid [items]="items" [columns]="columns" [(ngModel)]="curMatrixDataEntity.matrixDefName"\r\n                                      name="definitionId" [resizable]="true" [singleSelect]="true" [idField]="\'id\'" [pagination]="true"\r\n                                      [pageIndex]="pageIndex" [pageSize]="pageSize" [pageList]="pageList" [total]="total" [textField]="\'name\'"\r\n                                      [valueField]="\'id\'" [title]="\'矩阵表\'" [dictPicked]="dictPicked" (clear)="onClear()" [readonly]="typeReadOnly"\r\n                                      [customDisplayType] = "true" [displayType]="\'LIST\'">\r\n                  </farris-lookup-grid>\r\n                  <div class="farris-feedback valid-feedback"></div>\r\n                </div>\r\n                <div style="width: 15%"></div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class="col-12 farris-group-auto my-4">\r\n            <div class="farris-group-wrap">\r\n              <div class="form-group farris-form-group">\r\n                <label class="col-form-label" style="width: 15%">\r\n                  <span class="farris-label-info text-danger">*</span>\r\n                  <span class="farris-label-text">结果列</span>\r\n                </label>\r\n                <div class="farris-input-wrap" style="width: 70%">\r\n                  \x3c!--下拉列表--\x3e\r\n                  <farris-combo-list [(ngModel)]="curDataFieldValue" name="referObject" [panelHeight]="200" [idField]="\'value\'"\r\n                                     [textField]="\'text\'" [data]="dataFieldAndValues" (selectChange)=\'dataFieldChange($event)\'>\r\n                  </farris-combo-list>\r\n                  <div class="farris-feedback valid-feedback"></div>\r\n                </div>\r\n                <div style="width: 15%"></div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class="col-12 farris-group-auto my-4" *ngIf="conditionFields && conditionFields.length > 0">\r\n            <div class="farris-group-wrap">\r\n              <div class="form-group farris-form-group" style="margin-top: -17px; margin-bottom: -22px">\r\n                <label class="col-form-label" style="width: 15%">\r\n                  <span class="farris-label-text" style="color: rgb(180,180,180)">条件字段</span>\r\n                </label>\r\n                <div class="farris-input-wrap" style="width: 70%">\r\n                  <hr size="3px">\r\n                </div>\r\n                <div style="width: 15%"></div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class="col-12 farris-group-auto my-4" *ngIf="conditionFields && conditionFields.length > 0">\r\n            <div class="farris-group-wrap">\r\n              <div class="form-group farris-form-group">\r\n                <label class="col-form-label" style="width: 15%">\r\n                  <span class="farris-label-text">{{conditionFields[0].alias}}</span>\r\n                </label>\r\n                <div class="farris-input-wrap" style="width: 70%" *ngIf="conditionFields[0].inputType === \'help\' && !condition1ExprAble">\r\n                  <input-group name="condition1" [editable]="false" [customCls]="\'custom-cls\'" [groupText]="groupIcon2" [(ngModel)]="condition1Text" (clickHandle)="onHelpSearch($event,0,conditionFields[0].id)"></input-group>\r\n                </div>\r\n                <div class="farris-input-wrap" style="width: 70%" *ngIf="conditionFields[0].inputType === \'enum\' && !condition1ExprAble">\r\n                  <input-group name="condition1" [editable]="false" [customCls]="\'custom-cls\'" [groupText]="groupIcon2" [(ngModel)]="condition1Text" (clickHandle)="openEnumValue(0,conditionFields[0].id)"></input-group>\r\n                </div>\r\n                <div class="farris-input-wrap" style="width: 70%" *ngIf="condition1ExprAble">\r\n                  <input-group name="condition1" [editable]="false" [customCls]="\'custom-cls\'" [groupText]="groupIcon2"\r\n                               [(ngModel)]="condition1Text" (clickHandle)="condition1Expr(\'condition1\')">\r\n                  </input-group>\r\n                </div>\r\n                <farris-checkboxgroup style="width: 15%; padding-left: 10px" [(ngModel)]="condition1" name="Expr1Able" [horizontal]="true"\r\n                                      [data]="exprGroup" (changeValue)="condition1ExprClick()">\r\n                </farris-checkboxgroup>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class="col-12 farris-group-auto my-4" *ngIf="conditionFields && conditionFields.length > 1">\r\n            <div class="farris-group-wrap">\r\n              <div class="form-group farris-form-group">\r\n                <label class="col-form-label" style="width: 15%">\r\n                  <span class="farris-label-text">{{conditionFields[1].alias}}</span>\r\n                </label>\r\n                <div class="farris-input-wrap" style="width: 70%" *ngIf="conditionFields[1].inputType === \'help\' && !condition2ExprAble">\r\n                  <input-group name="condition2" [editable]="false" [customCls]="\'custom-cls\'" [groupText]="groupIcon2" [(ngModel)]="condition2Text" (clickHandle)="onHelpSearch($event,1,conditionFields[1].id)"></input-group>\r\n                </div>\r\n                <div class="farris-input-wrap" style="width: 70%" *ngIf="conditionFields[1].inputType === \'enum\' && !condition2ExprAble">\r\n                  <input-group name="condition2" [editable]="false" [customCls]="\'custom-cls\'" [groupText]="groupIcon2" [(ngModel)]="condition2Text" (clickHandle)="openEnumValue(1,conditionFields[1].id)"></input-group>\r\n                </div>\r\n                <div class="farris-input-wrap" style="width: 70%" *ngIf="condition2ExprAble">\r\n                  <input-group name="condition2" [editable]="false" [customCls]="\'custom-cls\'" [groupText]="groupIcon2"\r\n                               [(ngModel)]="condition2Text" (clickHandle)="condition2Expr(\'condition2\')">\r\n                  </input-group>\r\n                </div>\r\n                <farris-checkboxgroup style="width: 15%; padding-left: 10px" [(ngModel)]="condition2" name="Expr2Able" [horizontal]="true"\r\n                                      [data]="exprGroup" (changeValue)="condition2ExprClick()">\r\n                </farris-checkboxgroup>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class="col-12 farris-group-auto my-4" *ngIf="conditionFields && conditionFields.length > 2">\r\n            <div class="farris-group-wrap">\r\n              <div class="form-group farris-form-group">\r\n                <label class="col-form-label" style="width: 15%">\r\n                  <span class="farris-label-text">{{conditionFields[2].alias}}</span>\r\n                </label>\r\n                <div class="farris-input-wrap" style="width: 70%" *ngIf="conditionFields[2].inputType === \'help\' && !condition3ExprAble">\r\n                  <input-group name="condition3" [editable]="false" [customCls]="\'custom-cls\'" [groupText]="groupIcon2" [(ngModel)]="condition3Text" (clickHandle)="onHelpSearch($event,2,conditionFields[2].id)"></input-group>\r\n                </div>\r\n                <div class="farris-input-wrap" style="width: 70%" *ngIf="conditionFields[2].inputType === \'enum\' && !condition3ExprAble">\r\n                  <input-group name="condition3" [editable]="false" [customCls]="\'custom-cls\'" [groupText]="groupIcon2" [(ngModel)]="condition3Text" (clickHandle)="openEnumValue(2,conditionFields[2].id)"></input-group>\r\n                </div>\r\n                <div class="farris-input-wrap" style="width: 70%" *ngIf="condition3ExprAble">\r\n                  <input-group name="condition3" [editable]="false" [customCls]="\'custom-cls\'" [groupText]="groupIcon2"\r\n                               [(ngModel)]="condition3Text" (clickHandle)="condition3Expr(\'condition3\')">\r\n                  </input-group>\r\n                </div>\r\n                <farris-checkboxgroup style="width: 15%; padding-left: 10px" [(ngModel)]="condition3" name="Expr3Able" [horizontal]="true"\r\n                                      [data]="exprGroup" (changeValue)="condition3ExprClick()">\r\n                </farris-checkboxgroup>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class="d-flex flex-column mx-5" style="background: #FFF;">\r\n        <div class="farris-form form-inline farris-form-inline mr-5">\r\n          <div class="col-12 farris-group-auto my-4">\r\n            <div class="farris-group-wrap">\r\n              <div class="form-group farris-form-group">\r\n                <label class="col-form-label">\r\n                  <span class="farris-label-text">启用条件</span>\r\n                </label>\r\n                <div class="farris-input-wrap">\r\n                  <div class="input-group">\r\n                    <input type="text" class="form-control" [(ngModel)]="curMatrixDataEntity.condition" name="conditon" [readOnly]="true" />\r\n                    <div class="input-group-append">\r\n                      <span class="input-group-text" (click)="editCondition()" style="background: #FFF;">\r\n                        <i class="f-icon f-icon-lookup"></i>\r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n                  <div class="farris-feedback valid-feedback"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </form>\r\n</div>\r\n\r\n<farris-lookup-grid style="display: none;" #lookup [(ngModel)]="value" name="value" [helpId]="helpId"\r\n                    [singleSelect]="true" [uri]="\'assets/data/tree-list-help.json\'" (selectedData)="selectedDataHandler($event)"\r\n                    [dictPicked]="dictHelpPicked" [enableCascade]="false">\r\n</farris-lookup-grid>\r\n',providers:[{provide:X.ServerSideToken,useClass:o.LookupDataService}],styles:[""]}]}],Ln.ctorParameters=function(){return[{type:O.HttpService},{type:me},{type:J.ExpressionService},{type:te.BsModalService},{type:ne.ComponentFactoryResolver},{type:ne.Injector}]},Ln.propDecorators={cls:[{type:ne.HostBinding,args:["class"]}],setMatrixDataEntity:[{type:ne.Input}],lookUp:[{type:ne.ViewChild,args:["lookup"]}]},Ln);function Ln(e,t,r,i,n,a){var o=this;this.http=e,this.designerUIState=t,this.expr=r,this.modalService=i,this.resolver=n,this.injector=a,this.cls="d-flex flex-fill h-100",this.display="none",this.typeReadOnly=!1,this.items=[],this.pageIndex=1,this.pageSize=20,this.pageList=[10,20,30,50,100],this.total=0,this.groupIcon2='<i class="f-icon f-icon-lookup"></i>',this.fieldId="",this.columns=[{title:"编号",field:"code",width:100},{title:"名称",field:"name",width:100}],this.users=[],this.dataFieldAndValues=[],this.curDataFieldValue="",this.matrixDefEntityList=[],this.curMatrixDefEntity=new Fn,this.curMatrixDataEntity=new An,this.conditionFields=[],this.exprGroup=[{name:"帮助",value:"help"}],this.condition1ExprAble=!0,this.condition2ExprAble=!0,this.condition3ExprAble=!0,this.condition1Text="",this.condition1Value="",this.condition2Text="",this.condition2Value="",this.condition3Text="",this.condition3Value="",this.dictPicked=function(e){return o.curMatrixDataEntity=new An,o.curDataFieldValue="",o.curMatrixDefEntity=e,o.curMatrixDataEntity.matrixDefId=e.id,o.curMatrixDataEntity.matrixDefName=e.name,o.setFields(),T.of(!0)},this.dictHelpPicked=function(e){return o.value=null,T.of({closeDialog:!0})},this.getMatrixLineType()}var Nn=(Bn.prototype.ngOnInit=function(){},Bn.prototype.ngAfterViewInit=function(){var r=this;if(this.performer)switch(this.performer.type){case"wf.UserParticipant":this.tab="user",this.usersCmp.users=[],this.usersCmp.users.push(this.performer.value),this.performer.value.performerId&&"{"===this.performer.value.performerId.charAt(0)?this.http.get("/api/runtime/wf/v1.0/reportingOrgType/hasAdminOrg").subscribe(function(e){r.usersCmp.userTypeButtonNeedShow=e,r.usersCmp.userType="variable",r.usersCmp.curOrgType="Sys"===r.performer.value.orgType?"Sys":"Administrative_organization",r.usersCmp.condition=r.performer.value.condition;var t=0<=r.performer.value.performerId.indexOf("GetContextParameter");r.usersCmp.variableOrgTypes=t?[{name:"系统用户",value:"Sys"}]:[{name:"系统用户",value:"Sys"},{name:"行政人员",value:"Administrative_organization"}]}):(this.usersCmp.userType="user",this.usersCmp.condition=this.performer.value.condition);break;case"wf.PositionParticipant":this.tab="position",this.posiCmp.position=Object.assign({},this.performer.value),"0"===this.posiCmp.position.positionType?this.posiCmp.filter={positionType:0}:this.posiCmp.filter={positionType:1};break;case"wf.ReportingLineParticipant":this.tab="report",this.reportingLineCmp.setReportingLineDataEntity=this.performer.value;break;case"wf.ComponentParticipant":this.tab="component",this.cmpCmp.component=this.performer.value;break;case"wf.MatrixParticipant":this.tab="matrix",this.cmpCmp.component=this.performer.value,this.matrixCmp.setMatrixDataEntity=this.performer.value}},Bn.prototype.getPerformers=function(){var e=this.usersCmp.getPerformers(),t=this.posiCmp.getPerformers(),r=this.cmpCmp.getPerformers(),i=this.reportingLineCmp.getPerformers(),n=this.matrixCmp.getPerformers(),a=[],o=[];return e&&0<e.length&&(o=o.concat(e)),t&&t.performerId&&a.push(t),{userPerformers:o,positionPerformers:a,component:r,reportingLine:i,matrix:n}},Bn.decorators=[{type:ne.Component,args:[{selector:"app-performer-edit",template:'<div class="flex-fill farris-split-section m-2 farris-overflow-y-auto f-utils-flex-column">\r\n    <farris-tabs class="f-utils-fill h-100" #tabs [value]="tab" [fill]="true" [contentFill]="true">\r\n      <farris-tab title="用户" [show]="true" [id]="\'user\'">\r\n        <ng-template #content>\r\n          <app-user-performer></app-user-performer>\r\n        </ng-template>\r\n      </farris-tab>\r\n      <farris-tab title="岗位" [id]="\'position\'">\r\n        <ng-template #content>\r\n          <app-position-performer></app-position-performer>\r\n        </ng-template>\r\n      </farris-tab>\r\n      <farris-tab title="汇报关系" [id]="\'report\'">\r\n        <ng-template #content>\r\n          <app-reporting-line></app-reporting-line>\r\n        </ng-template>\r\n      </farris-tab>\r\n      <farris-tab title="矩阵" [id]="\'matrix\'" *ngIf="display">\r\n        <ng-template #content>\r\n          <app-matrix-performer></app-matrix-performer>\r\n        </ng-template>\r\n      </farris-tab>\r\n      <farris-tab title="参与者构件" [id]="\'component\'">\r\n        <ng-template #content>\r\n          <app-component-performer [component]="component" style="background: #FFF;"></app-component-performer>\r\n        </ng-template>\r\n      </farris-tab>\r\n    </farris-tabs>\r\n</div>\r\n',styles:[""]}]}],Bn.ctorParameters=function(){return[{type:O.HttpService}]},Bn.propDecorators={cls:[{type:ne.HostBinding,args:["class"]}],display:[{type:ne.Input}],usersCmp:[{type:ne.ViewChild,args:[sn]}],posiCmp:[{type:ne.ViewChild,args:[un]}],cmpCmp:[{type:ne.ViewChild,args:[yn]}],reportingLineCmp:[{type:ne.ViewChild,args:[En]}],matrixCmp:[{type:ne.ViewChild,args:[Vn]}]},Bn);function Bn(e){this.http=e,this.cls="farris-main-area flex-column",this.tab="user",this.display=!0}var Rn=(Object.defineProperty(zn.prototype,"options",{set:function(e){e&&(this.exclusionPerformers=e.ExclusionPerformers,this.noPerformerStrategy=e.NoPerformerStrategy,this.historicFirst=e.HistoricFirst,this.automaticPerformers=e.automaticPerformers)},enumerable:!0,configurable:!0}),Object.defineProperty(zn.prototype,"exclusionPerformers",{set:function(e){e&&("string"==typeof e?(this.excludeProcInstCreator=-1<e.indexOf("procInstCreator"),this.excludePreActExecutors=-1<e.indexOf("preActExecutors")):(this.excludeProcInstCreator=-1<e.findIndex(function(e){return"procInstCreator"===e}),this.excludePreActExecutors=-1<e.findIndex(function(e){return"preActExecutors"===e}),this.excludeAllPassExecutors=-1<e.findIndex(function(e){return"allPassExecutors"===e}),this.excludeExprPerformer=e.find(function(e){return-1<e.indexOf("expr")})))},enumerable:!0,configurable:!0}),Object.defineProperty(zn.prototype,"automaticPerformers",{set:function(e){e&&0<e.length&&(this.autoProcInstCreator=-1<e.findIndex(function(e){return"procInstCreator"===e}),this.autoPreActExecutors=-1<e.findIndex(function(e){return"preActExecutors"===e}),this.autoAllPassExecutors=-1<e.findIndex(function(e){return"allPassExecutors"===e}))},enumerable:!0,configurable:!0}),zn.prototype.ngOnInit=function(){},zn.prototype.ngAfterViewInit=function(){var e=this;this.ngZone.runOutsideAngular(function(){e.inputGroup.nativeElement.addEventListener("mouseenter",e.onMouseEnter.bind(e)),e.inputGroup.nativeElement.addEventListener("mouseleave",e.onMouseLeave.bind(e))})},zn.prototype.onMouseEnter=function(e){this.showClearButton=!0,this.showClearButton&&this.toggleClearIcon(e,!0)},zn.prototype.onMouseLeave=function(e){this.showClearButton=!1,this.toggleClearIcon(e,!1)},zn.prototype.toggleClearIcon=function(e,t){void 0===t&&(t=!1);var r=t?"":"none",i=e.target.querySelector(".input-group-clear");i&&(i.style.display=r)},zn.prototype.excludeProcInstCreatorClick=function(e){this.excludeProcInstCreator&&this.autoProcInstCreator&&(this.autoProcInstCreator=!1)},zn.prototype.excludePreActExecutorsClick=function(e){var t=this;!0!==this.autoAllPassExecutors||!0!==this.excludePreActExecutors?this.excludePreActExecutors&&this.autoPreActExecutors&&(this.autoPreActExecutors=!1):this.message.info("所有已办理人员已设置自动审批，上个节点已办理人员默认不允许排除！",function(){t.excludePreActExecutors=!1})},zn.prototype.excludeAllPassExecutorsClick=function(e){this.excludeAllPassExecutors&&(this.autoPreActExecutors&&(this.autoPreActExecutors=!1),this.autoAllPassExecutors&&(this.autoAllPassExecutors=!1))},zn.prototype.autoProcInstCreatorClick=function(e){var t=this;this.designerState.propertyData.AssignStrategy!==this.designerState.assignIterator[2].key||!0!==this.autoProcInstCreator?this.autoProcInstCreator&&this.excludeProcInstCreator&&(this.excludeProcInstCreator=!1):this.message.info("【分配策略】为【领用】时，不允许设置自动审批，请了解！",function(){t.autoProcInstCreator=!1})},zn.prototype.autoPreActExecutorsClick=function(e){var t=this;this.designerState.propertyData.AssignStrategy!==this.designerState.assignIterator[2].key||!0!==this.autoPreActExecutors?!0!==this.excludeAllPassExecutors||!0!==this.autoPreActExecutors?this.autoPreActExecutors&&this.excludePreActExecutors&&(this.excludePreActExecutors=!1):this.message.info("所有已办理人员已设置不允许审批，所以上个节点已办理人员默认不允许自动审批！",function(){t.autoPreActExecutors=!1}):this.message.info("【分配策略】为【领用】时，不允许设置自动审批，请了解！",function(){t.autoPreActExecutors=!1})},zn.prototype.autoAllPassExecutorsClick=function(e){var t=this;this.designerState.propertyData.AssignStrategy!==this.designerState.assignIterator[2].key||!0!==this.autoAllPassExecutors?this.autoAllPassExecutors&&(this.excludeAllPassExecutors&&(this.excludeAllPassExecutors=!1),this.excludePreActExecutors&&(this.excludePreActExecutors=!1)):this.message.info("【分配策略】为【领用】时，不允许设置自动审批，请了解！",function(){t.autoAllPassExecutors=!1})},zn.prototype.getPerformerOptions=function(){return{ExclusionPerformers:this.getExclusionPerformers(),NoPerformerStrategy:this.noPerformerStrategy,HistoricFirst:this.historicFirst,automaticPerformers:this.getAutoPerformers()}},zn.prototype.getExclusionPerformers=function(){var e=[];return this.excludeProcInstCreator&&e.push("procInstCreator"),this.excludePreActExecutors&&e.push("preActExecutors"),this.excludeAllPassExecutors&&e.push("allPassExecutors"),this.excludeExprPerformer&&e.push(this.excludeExprPerformer),e},zn.prototype.getAutoPerformers=function(){var e=new Array;return this.autoProcInstCreator&&e.push("procInstCreator"),this.autoPreActExecutors&&e.push("preActExecutors"),this.autoAllPassExecutors&&e.push("allPassExecutors"),e},zn.prototype.openExprEditor=function(){var e,t,r,i,n,a,o,s,l,c,d,p,u=this;if(0<this.designerState.schemas.length){try{for(var f=pe(this.designerState.schemas),h=f.next();!h.done;h=f.next()){var m=h.value;this.expr.addSchema("Schema",m)}}catch(O){e={error:O}}finally{try{h&&!h.done&&(t=f["return"])&&t.call(f)}finally{if(e)throw e.error}}if(this.designerState.schemas[0].entityTypes&&0<this.designerState.schemas[0].entityTypes.length){var v=this.designerState.schemas[0].entityTypes[0];this.expr.addInjectedEntity(v.name,"Schema",v.name,J.InjectedType.EntityType)}}var y=new Array;if(0<this.designerState.procInstContext.length)try{for(var g=pe(this.designerState.procInstContext),b=g.next();!b.done;b=g.next()){var x=b.value;y.push(x)}}catch(V){r={error:V}}finally{try{b&&!b.done&&(i=g["return"])&&i.call(g)}finally{if(r)throw r.error}}if(0<this.designerState.formalParameterContext.length){var w=function(t){y.some(function(e){return e.key===t.key})||y.push(t)};try{for(var C=pe(this.designerState.formalParameterContext),I=C.next();!I.done;I=C.next())w(x=I.value)}catch(L){n={error:L}}finally{try{I&&!I.done&&(a=C["return"])&&a.call(C)}finally{if(n)throw n.error}}}if(0<this.designerState.participantContext.length){var S=function(t){y.some(function(e){return e.key===t.key})||y.push(t)};try{for(var k=pe(this.designerState.participantContext),E=k.next();!E.done;E=k.next())S(x=E.value)}catch(N){o={error:N}}finally{try{E&&!E.done&&(s=k["return"])&&s.call(k)}finally{if(o)throw o.error}}}if(0<this.designerState.processVariableContext.length){var P=function(t){y.some(function(e){return e.key===t.key})||y.push(t)};try{for(var T=pe(this.designerState.processVariableContext),F=T.next();!F.done;F=T.next())P(x=F.value)}catch(B){l={error:B}}finally{try{F&&!F.done&&(c=T["return"])&&c.call(T)}finally{if(l)throw l.error}}}if(0<y.length)try{for(var A=pe(y),M=A.next();!M.done;M=A.next()){var D=M.value;this.expr.addContext(D)}}catch(R){d={error:R}}finally{try{M&&!M.done&&(p=A["return"])&&p.call(A)}finally{if(d)throw d.error}}this.expr.addExpressionText(this.excludeExprPerformer),this.expr.buildExpression().then(function(e){u.excludeExprPerformer=e})},zn.prototype.clear=function(){this.excludeExprPerformer=""},zn.decorators=[{type:ne.Component,args:[{selector:"app-performer-options",template:'<div class="f-page">\r\n  <div class="f-utils-fill-flex-column farris-split-section m-2 h-100">\r\n    <section class="f-utils-fill-flex-column h-100">\r\n      <div class="f-section-header pt-2 mx-2">\r\n        <div class="f-title">\r\n          <h4 class="f-title-text">参与者高级选项</h4>\r\n        </div>\r\n      </div>\r\n      <div class="f-utils-fill-flex-column h-100">\r\n        <perfect-scrollbar [config]="{}">\r\n          <form class="h-100">\r\n            <div class="f-utils-fill-flex-column h-100 pb-4">\r\n              <div class="farris-form form-inline farris-form-inline">\r\n                <div class="col-12 farris-group-auto">\r\n                  <div class="farris-group-wrap pl-3">\r\n                    <div class="form-group farris-form-group">\r\n                      <div class="farris-input-wrap">\r\n                        <div class="custom-control custom-checkbox">\r\n                          <input class="custom-control-input" name="historicFirst" type="checkbox" id="historicFirst"\r\n                            [(ngModel)]="historicFirst" />\r\n                          <label class="custom-control-label" for="historicFirst">再次进入节点时，办理人是节点的已办人员</label>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                <div class="col-9 farris-group-auto mt-2 pr-4">\r\n                  <div class="farris-group-wrap f-form-lable-auto pl-3">\r\n                    <div class="form-group farris-form-group">\r\n                      <label class="col-form-label">\r\n                        <span class="farris-label-text">办理人为空策略：</span>\r\n                      </label>\r\n                      <div class="farris-input-wrap">\r\n                        <farris-combo-list [(ngModel)]="noPerformerStrategy" name="noPerformerStrategy" [idField]="\'value\'"\r\n                          [textField]="\'text\'" [valueField]="\'value\'" [data]="noPerformerStrategyList" [panelHeight]="60">\r\n                        </farris-combo-list>\r\n                        <div class="farris-feedback valid-feedback"></div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                <div class="mx-2 mt-3">\r\n                  <div class="title-content">\r\n                    <h4 class="title-text">排除办理人选项</h4><span class="title-line"></span>\r\n                  </div>\r\n                </div>\r\n                <div class="col-12 farris-group-auto mt-2">\r\n                  <div class="farris-group-wrap pl-3">\r\n                    <div class="form-group farris-form-group">\r\n                      <div class="farris-input-wrap">\r\n                        <div class="custom-control custom-checkbox">\r\n                          <input class="custom-control-input" name="excludeProcInstCreator" type="checkbox" id="excludeProcInstCreator"\r\n                            [(ngModel)]="excludeProcInstCreator" (change)="excludeProcInstCreatorClick($event)" />\r\n                          <label class="custom-control-label" for="excludeProcInstCreator">流程发起人默认不参与审批</label>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                <div class="col-12 farris-group-auto mt-2">\r\n                  <div class="farris-group-wrap pl-3">\r\n                    <div class="form-group farris-form-group">\r\n                      <div class="farris-input-wrap">\r\n                        <div class="custom-control custom-checkbox">\r\n                          <input class="custom-control-input" name="excludePreActExecutors" type="checkbox" id="excludePreActExecutors"\r\n                            [(ngModel)]="excludePreActExecutors" (change)="excludePreActExecutorsClick($event)"/>\r\n                          <label class="custom-control-label" for="excludePreActExecutors">上个节点已办理人员默认不参与审批</label>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                <div class="col-12 farris-group-auto mt-2">\r\n                  <div class="farris-group-wrap pl-3">\r\n                    <div class="form-group farris-form-group">\r\n                      <div class="farris-input-wrap">\r\n                        <div class="custom-control custom-checkbox">\r\n                          <input class="custom-control-input" name="excludeAllPassExecutors" type="checkbox" id="excludeAllPassExecutors"\r\n                            [(ngModel)]="excludeAllPassExecutors" (change)="excludeAllPassExecutorsClick($event)"/>\r\n                          <label class="custom-control-label" for="excludeAllPassExecutors">所有已办理人员默认不参与审批</label>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                <div class="col-11 farris-group-auto pr-4">\r\n                  <div class="farris-group-wrap f-form-lable-auto pl-3">\r\n                    <div class="form-group farris-form-group">\r\n                      <label class="col-form-label">\r\n                        <span class="farris-label-text">流程变量：</span>\r\n                      </label>\r\n                      <div class="farris-input-wrap">\r\n                        <div #inputGroup class="input-group">\r\n                          <input type="text" class="form-control" [(ngModel)]="excludeExprPerformer" name="excludeExprPerformer"\r\n                            [readOnly]="true" />\r\n                          <div class="input-group-append">\r\n                            <span [style.display]="showClearButton ? \'\' : \'none\'" class="input-group-text input-group-clear"\r\n                              (click)="clear()">\r\n                              <i class="f-icon modal_close"></i>\r\n                            </span>\r\n                            <span class="input-group-text" (click)="openExprEditor()" style="background: #FFF;">\r\n                              <i class="f-icon f-icon-lookup"></i>\r\n                            </span>\r\n                          </div>\r\n                        </div>\r\n                        <div class="farris-feedback valid-feedback"></div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                <div class="mx-2 mt-3">\r\n                  <div class="title-content">\r\n                    <h4 class="title-text">自动审批选项</h4><span class="title-line"></span>\r\n                  </div>\r\n                </div>\r\n                <div class="col-12 farris-group-auto mt-2">\r\n                  <div class="farris-group-wrap pl-3">\r\n                    <div class="form-group farris-form-group">\r\n                      <div class="farris-input-wrap">\r\n                        <div class="custom-control custom-checkbox">\r\n                          <input class="custom-control-input" name="autoProcInstCreator" type="checkbox" id="autoProcInstCreator"\r\n                            [(ngModel)]="autoProcInstCreator" (change)="autoProcInstCreatorClick($event)" />\r\n                          <label class="custom-control-label" for="autoProcInstCreator">流程发起人默认自动审批通过</label>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div><div class="col-12 farris-group-auto mt-2">\r\n                  <div class="farris-group-wrap pl-3">\r\n                    <div class="form-group farris-form-group">\r\n                      <div class="farris-input-wrap">\r\n                        <div class="custom-control custom-checkbox">\r\n                          <input class="custom-control-input" name="autoPreActExecutors" type="checkbox" id="autoPreActExecutors"\r\n                            [(ngModel)]="autoPreActExecutors" (change)="autoPreActExecutorsClick($event)" />\r\n                          <label class="custom-control-label" for="autoPreActExecutors">上一节点办理人员默认自动审批通过</label>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div><div class="col-12 farris-group-auto mt-2">\r\n                  <div class="farris-group-wrap pl-3">\r\n                    <div class="form-group farris-form-group">\r\n                      <div class="farris-input-wrap">\r\n                        <div class="custom-control custom-checkbox">\r\n                          <input class="custom-control-input" name="autoAllPassExecutors" type="checkbox" id="autoAllPassExecutors"\r\n                            [(ngModel)]="autoAllPassExecutors" (change)="autoAllPassExecutorsClick($event)" />\r\n                          <label class="custom-control-label" for="autoAllPassExecutors">所有已办理人员默认自动审批通过</label>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </form>\r\n        </perfect-scrollbar>\r\n        \r\n      </div>\r\n    </section>\r\n  </div>\r\n</div>',styles:[".item-header{padding:1rem}.item{padding:.5rem 5rem}.title-content{color:#000;display:inline-flex;align-items:center;line-height:1.375rem;position:relative;overflow:hidden;padding:0 0 0 1rem;min-width:450px}.title-content ::before{content:'';width:.25rem;height:1.125rem;background:#59a1ff;border-radius:1px;position:absolute;top:50%;left:0;margin-top:-.5625rem}.title-text{font-size:1rem;line-height:1.375rem;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;margin-bottom:0;margin-right:10px}.title-line{flex-grow:1;border-bottom:1px dashed rgba(0,0,0,.1)}"]}]}],zn.ctorParameters=function(){return[{type:ne.NgZone},{type:me},{type:J.ExpressionService},{type:Y.MessagerService}]},zn.propDecorators={cls:[{type:ne.HostBinding,args:["class"]}],options:[{type:ne.Input}],exclusionPerformers:[{type:ne.Input}],inputGroup:[{type:ne.ViewChild,args:["inputGroup"]}]},zn);function zn(e,t,r,i){this.ngZone=e,this.designerState=t,this.expr=r,this.message=i,this.cls="farris-main-area flex-column",this.showClearButton=!1,this.historicFirst=!1,this.excludeProcInstCreator=!1,this.excludePreActExecutors=!1,this.excludeAllPassExecutors=!1,this.autoProcInstCreator=!1,this.autoPreActExecutors=!1,this.autoAllPassExecutors=!1,this.noPerformerStrategyList=[{text:"向下流转",value:"leave"},{text:"异常提示",value:"throwException"}],this.exclusionPerformersOptions=[{value:"procInstCreator",name:"流程发起人"},{value:"preActExecutors",name:"上一节点办理人"},{value:"allPassExecutors",name:"所有已办理人员"}],this.noPerformerStrategy=this.noPerformerStrategyList[0].value}var Hn=(Object.defineProperty(jn.prototype,"value",{set:function(e){var t=this;e.performers&&0<e.performers.length&&(this.uistate.performerInfo.performers=e.performers,this.uistate.performersList=this.uistate.performersList.concat(e.performers),this.uistate.performersList.map(function(e){return e.description=t.performerDescription(e)})),e.components&&0<e.components.length&&(this.uistate.performerInfo.components=e.components,e.components.forEach(function(e){t.uistate.performersList.push({id:e.id,type:"wf.ComponentParticipant",performerName:e.name,description:t.componentDescription(e),condition:e.condition})})),e.reportingLines&&0<e.reportingLines.length&&(this.uistate.performerInfo.reportingLines=e.reportingLines,e.reportingLines.forEach(function(e){t.uistate.performersList.push({id:e.id,type:"wf.ReportingLineParticipant",performerName:e.reportingLineDefName+"-"+e.dimension,description:t.reportingLineDescription(e),condition:e.condition})})),e.matrixParticipants&&0<e.matrixParticipants.length&&(this.uistate.performerInfo.matrixParticipants=e.matrixParticipants,e.matrixParticipants.forEach(function(e){t.uistate.performersList.push({id:e.id,type:"wf.MatrixParticipant",performerName:e.matrixDefName+"-"+e.dataFieldAlias,description:t.matrixDescription(e),condition:e.condition})})),e.options&&(this.uistate.performerInfo.options=e.options)},enumerable:!0,configurable:!0}),jn.prototype.ngOnInit=function(){var t=this;this.getMatrixConfig().subscribe(function(e){e&&"false"===e.currentValue&&(t.display=!1)})},jn.prototype.add=function(){this.editState="new";var e=this.resolver.resolveComponentFactory(Nn);this.compRef=e.create(this.injector),this.compRef.instance.display=this.display;var t={title:"参与者选择",width:800,height:515,buttons:this.editFooter,showButtons:!0};this.editDialog=this.modalService.show(this.compRef,t)},jn.prototype.edit=function(){var t=this;if(this.editState="edit",this.uistate.curPerformer){var r={title:"参与者选择",width:800,height:515,buttons:this.editFooter,showButtons:!0},e=this.resolver.resolveComponentFactory(Nn);switch(this.compRef=e.create(this.injector),this.uistate.curPerformer.type){case"wf.PositionParticipant":this.compRef.instance.performer={type:"wf.PositionParticipant",value:this.uistate.performerInfo.performers.find(function(e){return e.id===t.uistate.curPerformer.id})};break;case"wf.UserParticipant":this.compRef.instance.performer={type:"wf.UserParticipant",value:this.uistate.performerInfo.performers.find(function(e){return e.id===t.uistate.curPerformer.id})};break;case"wf.ReportingLineParticipant":var i=this.uistate.performerInfo.reportingLines.find(function(e){return e.id===t.uistate.curPerformer.id});this.compRef.instance.performer={type:"wf.ReportingLineParticipant",value:i};var n="/api/runtime/wf/v1.0/reportingLineDefinitions/"+i.reportingLineDefId;this.http.get(n).subscribe(function(e){e?t.editDialog=t.modalService.show(t.compRef,r):(t.message.error("该条汇报关系数据的定义已删除，该条数据将删除"),t.remove())});break;case"wf.MatrixParticipant":var a=this.uistate.performerInfo.matrixParticipants.find(function(e){return e.id===t.uistate.curPerformer.id});this.compRef.instance.performer={type:"wf.MatrixParticipant",value:a};var o="/api/runtime/wf/v1.0/matrixDefinition/"+a.matrixDefId;this.http.get(o).subscribe(function(e){e?t.editDialog=t.modalService.show(t.compRef,r):(t.message.error("该条矩阵数据的定义已删除，该条数据将删除"),t.remove())});break;case"wf.ComponentParticipant":this.compRef.instance.performer={type:"wf.ComponentParticipant",value:this.uistate.performerInfo.components.find(function(e){return e.id===t.uistate.curPerformer.id})}}"wf.ReportingLineParticipant"!==this.uistate.curPerformer.type&&"wf.MatrixParticipant"!==this.uistate.curPerformer.type&&(this.editDialog=this.modalService.show(this.compRef,r))}},jn.prototype.remove=function(){var t=this;if(this.grid.selectedRow){if(this.grid.endCellEdit(),"wf.ComponentParticipant"===this.grid.selectedRow.data.type){var e=this.uistate.performerInfo.components.findIndex(function(e){return e.id===t.grid.selectedRow.data.id});this.uistate.performerInfo.components.splice(e,1)}else"wf.ReportingLineParticipant"===this.grid.selectedRow.data.type?(e=this.uistate.performerInfo.reportingLines.findIndex(function(e){return e.id===t.grid.selectedRow.data.id}),this.uistate.performerInfo.reportingLines.splice(e,1)):"wf.MatrixParticipant"===this.grid.selectedRow.data.type?(e=this.uistate.performerInfo.matrixParticipants.findIndex(function(e){return e.id===t.grid.selectedRow.data.id}),this.uistate.performerInfo.matrixParticipants.splice(e,1)):(e=this.uistate.performerInfo.performers.findIndex(function(e){return e.id===t.grid.selectedRow.data.id}),this.uistate.performerInfo.performers.splice(e,1));var r=this.uistate.performersList.findIndex(function(e){return e.id===t.grid.selectedRow.data.id});this.uistate.performersList.splice(r,1),this.grid.loadData(this.uistate.performersList)}else this.message.info("请先选中一条参与者信息！")},jn.prototype.clear=function(){this.uistate.performerInfo.performers=[],this.uistate.performerInfo.components=[],this.uistate.performerInfo.reportingLines=[],this.uistate.performerInfo.matrixParticipants=[],this.uistate.performersList=[],this.grid.loadData(this.uistate.performersList)},jn.prototype.clickOK=function(){this.grid.endCellEdit();var e={value:this.uistate.performerInfo,parameters:null};this.submitModal.emit(e)},jn.prototype.clickCancel=function(){this.closeModal.emit()},jn.prototype.editOK=function(){var n=this;if(this.compRef){var t=this.compRef.instance.getPerformers();if(t.userPerformers&&0<t.userPerformers.length&&(t.userPerformers.forEach(function(t){var e=n.uistate.performerInfo.performers.findIndex(function(e){return e.id===t.id||e.performerId===t.performerId});if(-1<e){var r=n.uistate.performerInfo.performers[e].id;n.uistate.performerInfo.performers[e]=t;var i=n.uistate.performersList.findIndex(function(e){return e.id===r});n.uistate.performersList[i]=t}else"edit"===n.editState&&n.remove(),n.uistate.performerInfo.performers.push(t),n.uistate.performersList=n.uistate.performersList.concat([t])}),this.uistate.performersList.filter(function(e){return e.type===n.uistate.typeCollection[0].value||e.type===n.uistate.typeCollection[1].value}).map(function(e){return e.description=n.performerDescription(e)})),t.positionPerformers&&0<t.positionPerformers.length&&(t.positionPerformers.forEach(function(t){var e=n.uistate.performerInfo.performers.findIndex(function(e){return e.id===t.id||e.performerId===t.performerId});if(-1<e){var r=n.uistate.performerInfo.performers[e].id;n.uistate.performerInfo.performers[e]=t;var i=n.uistate.performersList.findIndex(function(e){return e.id===r});n.uistate.performersList[i]=t}else n.uistate.performerInfo.performers.push(t),n.uistate.performersList=n.uistate.performersList.concat([t])}),this.uistate.performersList.filter(function(e){return e.type===n.uistate.typeCollection[0].value||e.type===n.uistate.typeCollection[1].value}).map(function(e){return e.description=n.performerDescription(e)})),t.component&&t.component.metadataId&&t.component.methodCode){var e=this.uistate.performerInfo.components.findIndex(function(e){return e.id===t.component.id});if(-1<e){this.uistate.performerInfo.components[e]=t.component;var r=this.uistate.performersList.findIndex(function(e){return e.id===t.component.id});this.uistate.performersList[r]={id:t.component.id,type:"wf.ComponentParticipant",performerName:t.component.name,description:this.componentDescription(t.component),condition:t.component.condition}}else this.uistate.performerInfo.components.push(t.component),this.uistate.performersList.push({id:t.component.id,type:"wf.ComponentParticipant",performerName:t.component.name,description:this.componentDescription(t.component),condition:""})}t.reportingLine&&t.reportingLine.reportingLineDefId&&t.reportingLine.dimension&&("dept"!==t.reportingLine.reportingReferObject||t.reportingLine.refOrgId?"dept"===t.reportingLine.reportingReferObject||t.reportingLine.refUserId||t.reportingLine.refEmployeeId?(this.isClose=!0,this.addReportingLineData(t)):(this.isClose=!1,this.message.info("“用户”汇报关系类型下，参照人不能为空")):(this.isClose=!1,this.message.info("“部门”汇报关系类型下，参照人所在部门不能为空"))),t.matrix&&t.matrix.matrixDefId&&(t.matrix.conditionField1||t.matrix.conditionField2||t.matrix.conditionField3?t.matrix.dataFieldAlias?(this.isClose=!0,this.addMatrixData(t)):(this.isClose=!1,this.message.info("数据字段不能为空")):(this.isClose=!1,this.message.info("条件字段至少要存在一个"))),this.grid.loadData(this.uistate.performersList)}this.editDialog&&this.isClose&&this.editDialog.close()},jn.prototype.addReportingLineData=function(t){var e,r,i=this.uistate.performerInfo.reportingLines.findIndex(function(e){return e.id===t.reportingLine.id});if(-1<i){this.uistate.performerInfo.reportingLines[i]=t.reportingLine;var n=this.uistate.performersList.findIndex(function(e){return e.id===t.reportingLine.id});this.uistate.performersList[n]={id:t.reportingLine.id,type:"wf.ReportingLineParticipant",performerName:t.reportingLine.reportingLineDefName+"-"+t.reportingLine.dimension,description:this.reportingLineDescription(t.reportingLine),condition:t.reportingLine.condition}}else{try{for(var a=pe(this.uistate.performerInfo.reportingLines),o=a.next();!o.done;o=a.next()){var s=o.value;if(s.reportingLineDefId===t.reportingLine.definitionId&&s.dimension===t.reportingLine.dimension&&s.refUserId===t.reportingLine.referUserId&&s.refEmployeeId===t.reportingLine.refEmployeeId&&s.refOrgId===t.reportingLine.referDeptId)return void this.message.error("该汇报关系已经进行过配置")}}catch(l){e={error:l}}finally{try{o&&!o.done&&(r=a["return"])&&r.call(a)}finally{if(e)throw e.error}}this.uistate.performerInfo.reportingLines.push(t.reportingLine),this.uistate.performersList.push({id:t.reportingLine.id,type:"wf.ReportingLineParticipant",performerName:t.reportingLine.reportingLineDefName+"-"+t.reportingLine.dimension,description:this.reportingLineDescription(t.reportingLine),condition:t.reportingLine.condition})}},jn.prototype.addMatrixData=function(t){var e,r,i=this.uistate.performerInfo.matrixParticipants.findIndex(function(e){return e.id===t.matrix.id});if(-1<i){this.uistate.performerInfo.matrixParticipants[i]=t.matrix;var n=this.uistate.performersList.findIndex(function(e){return e.id===t.matrix.id});this.uistate.performersList[n]={id:t.matrix.id,type:"wf.MatrixParticipant",performerName:t.matrix.matrixDefName+"-"+t.matrix.dataFieldAlias,description:this.matrixDescription(t.matrix),condition:t.matrix.condition}}else{try{for(var a=pe(this.uistate.performerInfo.matrixParticipants),o=a.next();!o.done;o=a.next()){var s=o.value;if(s.matrixDefId===t.matrix.matrixDefId&&s.conditionField1===t.matrix.conditionField1&&s.conditionField2===t.matrix.conditionField2&&s.conditionField3===t.matrix.conditionField3&&s.dataFieldAlias===t.matrix.dataFieldAlias)return void this.message.error("该矩阵已经进行过配置")}}catch(l){e={error:l}}finally{try{o&&!o.done&&(r=a["return"])&&r.call(a)}finally{if(e)throw e.error}}this.uistate.performerInfo.matrixParticipants.push(t.matrix),this.uistate.performersList.push({id:t.matrix.id,type:"wf.MatrixParticipant",performerName:t.matrix.matrixDefName+"-"+t.matrix.dataFieldAlias,description:this.matrixDescription(t.matrix),condition:t.matrix.condition})}},jn.prototype.editCancel=function(){this.editDialog&&this.editDialog.close()},jn.prototype.participantOptionsSet=function(){this.uistate.performerInfo.options=this.options.getPerformerOptions(),this.optionsDialog.close()},jn.prototype.performerDescription=function(e){if("wf.UserParticipant"===e.type)return"expression"===e.tag?e.performerId:e.orgName?"部门："+e.orgName:"";if("wf.PositionParticipant"===e.type){if("1"===e.positionType)return e.orgId?"岗位类型：通用岗位，部门："+e.orgId:"岗位类型：通用岗位";if("0"===e.positionType)return"岗位类型：组织岗位"}},jn.prototype.componentDescription=function(e){var t="构件："+e.name+",参数：{";return e.actualParameters&&0<e.actualParameters.length&&(e.actualParameters.forEach(function(e){t+=e.code+"："+e.value+"，"}),t=t.substring(0,t.length-1)),t+="}"},jn.prototype.reportingLineDescription=function(e){var t="";return e.refUserId&&(t+="参照人："+e.refUserId),e.refEmployeeId&&(t+="参照人："+e.refEmployeeId),e.refOrgId&&(e.refUserId&&(t+="，"),e.refEmployeeId&&(t+="，"),t+="参照组织："+e.refOrgId),t},jn.prototype.matrixDescription=function(e){var t="";return e.conditionField1&&(t+="条件1："+e.conditionFieldText1+"，"),e.conditionField2&&(t+="条件2："+e.conditionFieldText2+"，"),e.conditionField3&&(t+="条件3："+e.conditionFieldText3+"，"),e.dataFieldAlias&&(t+="数据："+e.dataFieldAlias+"，"),t.slice(0,t.length-1)},jn.prototype.editConditon=function(t){var e,r,i,n,a,o,s,l,c,d,p,u,f,h,m=this;if(0<this.designerUIState.schemas.length){try{for(var v=pe(this.designerUIState.schemas),y=v.next();!y.done;y=v.next()){var g=y.value;this.expr.addSchema("Schema",g)}}catch(z){e={error:z}}finally{try{y&&!y.done&&(r=v["return"])&&r.call(v)}finally{if(e)throw e.error}}if(this.designerUIState.schemas[0].entityTypes&&0<this.designerUIState.schemas[0].entityTypes.length){var b=this.designerUIState.schemas[0].entityTypes[0];this.expr.addInjectedEntity(b.name,"Schema",b.name,J.InjectedType.EntityType)}}var x=new Array;if(0<this.designerUIState.procInstContext.length)try{for(var w=pe(this.designerUIState.procInstContext),C=w.next();!C.done;C=w.next()){var I=C.value;x.push(I)}}catch(H){i={error:H}}finally{try{C&&!C.done&&(n=w["return"])&&n.call(w)}finally{if(i)throw i.error}}if(0<this.designerUIState.formalParameterContext.length){var S=function(t){x.some(function(e){return e.key===t.key})||x.push(t)};try{for(var k=pe(this.designerUIState.formalParameterContext),E=k.next();!E.done;E=k.next())S(I=E.value)}catch(j){a={error:j}}finally{try{E&&!E.done&&(o=k["return"])&&o.call(k)}finally{if(a)throw a.error}}}if(0<this.designerUIState.participantContext.length){var P=function(t){x.some(function(e){return e.key===t.key})||x.push(t)};try{for(var T=pe(this.designerUIState.participantContext),F=T.next();!F.done;F=T.next())P(I=F.value)}catch(U){s={error:U}}finally{try{F&&!F.done&&(l=T["return"])&&l.call(T)}finally{if(s)throw s.error}}}if(0<this.designerUIState.processVariableContext.length){var A=function(t){x.some(function(e){return e.key===t.key})||x.push(t)};try{for(var M=pe(this.designerUIState.processVariableContext),D=M.next();!D.done;D=M.next())A(I=D.value)}catch(q){c={error:q}}finally{try{D&&!D.done&&(d=M["return"])&&d.call(M)}finally{if(c)throw c.error}}}if(0<this.designerUIState.activityComponentContext.length){var O=function(t){x.some(function(e){return e.key===t.key})||x.push(t)};try{for(var V=pe(this.designerUIState.activityComponentContext),L=V.next();!L.done;L=V.next())O(I=L.value)}catch(G){p={error:G}}finally{try{L&&!L.done&&(u=V["return"])&&u.call(V)}finally{if(p)throw p.error}}}if(0<x.length)try{for(var N=pe(x),B=N.next();!B.done;B=N.next()){var R=B.value;this.expr.addContext(R)}}catch(K){f={error:K}}finally{try{B&&!B.done&&(h=N["return"])&&h.call(N)}finally{if(f)throw f.error}}this.expr.addExpressionText(t.instance.value),this.expr.setEditPattern(J.ExprEditMode.Conditional),this.expr.buildExpression().then(function(e){"wf.ComponentParticipant"===m.grid.selectedRow.data.type?m.uistate.performerInfo.components.find(function(e){return e.id===m.grid.selectedRow.data.id}).condition=e:"wf.ReportingLineParticipant"===m.grid.selectedRow.data.type?m.uistate.performerInfo.reportingLines.find(function(e){return e.id===m.grid.selectedRow.data.id}).condition=e:"wf.MatrixParticipant"===m.grid.selectedRow.data.type?m.uistate.performerInfo.matrixParticipants.find(function(e){return e.id===m.grid.selectedRow.data.id}).condition=e:m.uistate.performerInfo.performers.find(function(e){return e.id===m.grid.selectedRow.data.id}).condition=e,t.formControl.setValue(e),t.instance.cd.detectChanges()})},jn.prototype.selectChanged=function(e){this.uistate.curPerformer=e.data},jn.prototype.GetOrganizationType=function(){var t=this;this.http.get("/api/runtime/sys/v1.0/authfields/globalauthfields").subscribe(function(e){return t.designerUIState.orgTypeCollection=e.map(function(e){return{value:e.id,text:e.name}})})},jn.prototype.getMatrixConfig=function(){return this.http.get("/api/runtime/wf/v1.0/generalConfig/Is_EnableMatrix")},jn.decorators=[{type:ne.Component,args:[{selector:"app-performer",template:'<div class="f-page">\r\n  <div class="f-page-header">\r\n    <nav class="f-page-header-base">\r\n      <div class="f-title">\r\n        <span class="f-title-icon f-text-orna-bill">\r\n          <i class="f-icon f-icon-page-title-administer"></i>\r\n        </span>\r\n        <h4 class="f-title-text">参与者列表</h4>\r\n      </div>\r\n      <div class="btn-toolbar btn-group-lg">\r\n      <button class="btn btn-primary mr-2" (click)="add()">新增</button>\r\n      <button class="btn btn-secondary mr-2" [disabled]="(!uistate.curPerformer)"\r\n      (click)="edit()">编辑</button>\r\n      <button class="btn btn-secondary mr-2" (click)="remove()">移除</button>\r\n      <button class="btn btn-secondary mr-2" (click)="clear()">清空</button>\r\n      <button class="btn btn-secondary" (click)="participantOptions.show()">参与者选项</button>\r\n      </div>\r\n    </nav>\r\n  </div>\r\n  <div class="f-page-main f-utils-fill-flex-column h-100">\r\n    <div class="f-utils-fill-flex-column farris-overflow-y-auto h-100">\r\n      <farris-datagrid #grid [data]="uistate.performersList" [columns]="columns" [idField]="\'id\'" [fit]="true"\r\n        [fitColumns]="true" [editable]="true" [editMode]="\'cell\'" [pagination]="false" [showCheckbox]="false"\r\n        [multiSelect]="false" [afterEdit]="afterEdit" (selectChanged)="selectChanged($event)">\r\n      </farris-datagrid>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<ng-template #iconSelectFooter>\r\n  <button type="button" class="btn btn-primary btn-sm px-3 mx-2" (click)="clickOK()">确定</button>\r\n  <button type="button" class="btn btn-secondary btn-sm px-3 mx-2" (click)="clickCancel()">取消</button>\r\n</ng-template>\r\n\r\n<ng-template #editFooter>\r\n  <button type="button" class="btn btn-primary btn-sm px-3 mx-2" (click)="editOK()">确定</button>\r\n  <button type="button" class="btn btn-secondary btn-sm px-3 mx-2" (click)="editCancel()">取消</button>\r\n</ng-template>\r\n\r\n<farris-dialog #participantOptions [buttons]="buttonRef" [width]="500" [height]="530" [title]="\'参与者选项\'">\r\n  <app-performer-options [options]="uistate.performerInfo.options"></app-performer-options>\r\n</farris-dialog>\r\n<ng-template #buttonRef>\r\n  <button class="btn btn-sm btn-primary px-3" (click)="participantOptionsSet()">确定</button>\r\n  <button class="btn btn-sm btn-default px-3" (click)="participantOptions.close()">取消</button>\r\n</ng-template>\r\n',providers:[Yi,Xi,Wi],styles:[""]}]}],jn.ctorParameters=function(){return[{type:Yi},{type:Wi},{type:l.FormBuilder},{type:ne.ComponentFactoryResolver},{type:ne.Injector},{type:te.BsModalService},{type:Y.MessagerService},{type:me},{type:J.ExpressionService},{type:O.HttpService}]},jn.propDecorators={cls:[{type:ne.HostBinding,args:["class"]}],modalFooter:[{type:ne.ViewChild,args:["iconSelectFooter"]}],editFooter:[{type:ne.ViewChild,args:["editFooter"]}],options:[{type:ne.ViewChild,args:[Rn]}],optionsDialog:[{type:ne.ViewChild,args:["participantOptions"]}],grid:[{type:ne.ViewChild,args:[q.DatagridComponent]}],closeModal:[{type:ne.Output}],submitModal:[{type:ne.Output}],value:[{type:ne.Input}],editorParams:[{type:ne.Input}]},jn);function jn(e,t,r,i,n,a,o,s,l,c){var d=this;this.viewModel=e,this.uistate=t,this.formBuilder=r,this.resolver=i,this.injector=n,this.modalService=a,this.message=o,this.designerUIState=s,this.expr=l,this.http=c,this.cls="farris-main-area flex-column",this.display=!0,this.closeModal=new ne.EventEmitter,this.submitModal=new ne.EventEmitter,this.editorParams={},this.isClose=!0,this.modalConfig={title:"参与者",width:800,height:515,showButtons:!0},this.columns=[{field:"type",width:50,title:"类型",formatter:{type:"enum",options:{valueField:"value",textField:"text",data:this.uistate.typeCollection}}},{field:"performerName",width:50,title:"名称"},{field:"description",width:100,title:"描述",showTips:!0},{field:"condition",width:60,title:"启用条件",showTips:!0,editor:{type:"input-group",options:{groupText:'<i class="f-icon f-icon-lookup"></i>',editable:!1,clickHandle:function(e){e.formControl.setValue(e.instance.value?e.instance.value:""),d.editConditon(e)},clear:function(t){if("wf.ComponentParticipant"===t.rowData.type){var e=d.uistate.performerInfo.components.findIndex(function(e){return e.id===t.rowData.id});d.uistate.performerInfo.components[e].condition=""}else if("wf.ReportingLineParticipant"===t.rowData.type){e=d.uistate.performerInfo.reportingLines.findIndex(function(e){return e.id===t.rowData.id});d.uistate.performerInfo.reportingLines[e].condition=""}else if("wf.MatrixParticipant"===t.rowData.type){e=d.uistate.performerInfo.matrixParticipants.findIndex(function(e){return e.id===t.rowData.id});d.uistate.performerInfo.matrixParticipants[e].condition=""}}}}}],this.editState="new",this.afterEdit=function(e,t,r){return T.of(!0)},this.GetOrganizationType()}var Un=(qn.prototype.convertTo=function(e){return e.performers&&0<e.performers.length||e.components&&0<e.components.length||e.reportingLines&&0<e.reportingLines.length||e.matrixParticipants&&0<e.matrixParticipants.length?"（已设置）":"（未设置）"},qn);function qn(){}var Gn=(Object.defineProperty(Kn.prototype,"value",{set:function(e){this.action=e.action,this.action!==this.actionCollection[2].value||null!==e.enable&&e.enable!==undefined?this.enable=e.enable:this.enable=!0,e.scope&&(this.organizationLevel=e.scope.organizationLevel,this.includeChildren=e.scope.includeChildren)},enumerable:!0,configurable:!0}),Kn.prototype.ngOnInit=function(){},Kn.prototype.clickOK=function(){var t=this,e=new vi;if(e.enable=this.enable,e.action=this.action,e.enable&&this.organizationLevel!==this.organizationLevelCollection[0].value){var r=new yi;r.actionScope=this.action,r.organizationLevel=this.organizationLevel,r.organizationId=this.organizationLevelCollection.find(function(e){return e.value===t.organizationLevel}).orgId,r.organizationName=this.organizationLevelCollection.find(function(e){return e.value===t.organizationLevel}).text,r.includeChildren=this.includeChildren,r.tag="variable",e.scope=r}var i={value:e,parameters:null};this.submitModal.emit(i)},Kn.prototype.clickCancel=function(){this.closeModal.emit()},Kn.prototype.valueChange=function(e){switch(e.value){case this.organizationLevelCollection[0].value:this.includeChildren=!1;break;case this.organizationLevelCollection[1].value:this.includeChildren=!0;break;case this.organizationLevelCollection[2].value:this.includeChildren=!1}},Kn.decorators=[{type:ne.Component,args:[{selector:"app-organization-potential-owner",template:'<div class="f-page">\r\n  <div class="f-utils-fill-flex-column farris-split-section m-2 h-100">\r\n    <section class="f-utils-fill-flex-column h-100">\r\n      <div class="f-section-header pt-2 mx-2">\r\n        <div class="f-title">\r\n          <h4 class="f-title-text">{{actionName()+\'选项\'}}</h4>\r\n        </div>\r\n      </div>\r\n      <div class="f-utils-fill-flex-column h-100">\r\n        <div class="farris-form form-inline farris-form-inline">\r\n          <div class="col-12 farris-group-auto my-3 pr-5">\r\n            <div class="farris-group-wrap">\r\n              <div class="form-group farris-form-group">\r\n                <label class="col-form-label">\r\n                  <span class="farris-label-text">是否启用</span>\r\n                </label>\r\n                <div class="farris-input-wrap ml-1">\r\n                  <farris-switch [(ngModel)]="enable" name="enable"></farris-switch>\r\n                  <div class="farris-feedback valid-feedback"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class="col-12 farris-group-auto mt-4 pr-5">\r\n            <div class="farris-group-wrap">\r\n              <div class="form-group farris-form-group">\r\n                <label class="col-form-label">\r\n                  <span class="farris-label-text">{{actionName()+\'范围\'}}</span>\r\n                </label>\r\n                <div class="farris-input-wrap ml-1 pr-5">\r\n                  <farris-combo-list [panelHeight]="100" [(ngModel)]="organizationLevel" name="actionScope" [idField]="\'value\'"\r\n                    [textField]="\'text\'" [valueField]="\'value\'" [data]="organizationLevelCollection"\r\n                    (valueChange)="valueChange($event)" [readonly]="enable===false">\r\n                  </farris-combo-list>\r\n                  <div class="farris-feedback valid-feedback"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div *ngIf="organizationLevel===organizationLevelCollection[2].value" class="col-12 farris-group-auto my-3 pr-5">\r\n            <div class="farris-group-wrap">\r\n              <div class="form-group farris-form-group">\r\n                <label class="col-form-label">\r\n                  <span class="farris-label-text">包含下级</span>\r\n                </label>\r\n                <div class="farris-input-wrap ml-1">\r\n                  <farris-switch [(ngModel)]="includeChildren" name="includeChildren" [editable]="enable===true"></farris-switch>\r\n                  <div class="farris-feedback valid-feedback"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </section>\r\n  </div>\r\n</div>\r\n\r\n<ng-template #iconSelectFooter>\r\n  <button type="button" class="btn btn-primary btn-sm mx-2" (click)="clickOK()">确定</button>\r\n  <button type="button" class="btn btn-secondary btn-sm mx-2" (click)="clickCancel()">取消</button>\r\n</ng-template>\r\n',styles:[".title-content{color:#000;display:inline-flex;align-items:center;line-height:1.375rem;position:relative;overflow:hidden;padding:0 0 0 1rem;min-width:390px}.title-content ::before{content:'';width:.25rem;height:1.125rem;background:#59a1ff;border-radius:1px;position:absolute;top:50%;left:0;margin-top:-.5625rem}.title-text{font-size:1rem;line-height:1.375rem;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;margin-bottom:0;margin-right:10px}.title-line{flex-grow:1;border-bottom:1px dashed rgba(0,0,0,.1)}"]}]}],Kn.ctorParameters=function(){return[]},Kn.propDecorators={cls:[{type:ne.HostBinding,args:["class"]}],closeModal:[{type:ne.Output}],submitModal:[{type:ne.Output}],value:[{type:ne.Input}],modalFooter:[{type:ne.ViewChild,args:["iconSelectFooter"]}]},Kn);function Kn(){var t=this;this.cls="farris-main-area flex-column",this.closeModal=new ne.EventEmitter,this.submitModal=new ne.EventEmitter,this.modalConfig={title:"选项设置",width:425,height:360,showButtons:!0},this.organizationLevelCollection=[{value:"GLOBAL",text:"全员",orgId:"global"},{value:"UNIT",text:"本单位",orgId:"currentUnit"},{value:"DEPARTMENT",text:"本部门",orgId:"currentDepartment"}],this.actionCollection=[{value:wi,name:"加签"},{value:xi,name:"征询"},{value:bi,name:"移交"},{value:Ci,name:"知会"}],this.enable=!1,this.organizationLevel=this.organizationLevelCollection[0].value,this.action=this.actionCollection[0].value,this.includeChildren=!1,this.actionName=function(){return t.actionCollection.find(function(e){return e.value===t.action}).name}}var Jn=(_n.prototype.convertTo=function(e){return e.action!==bi||null!==e.enable&&e.enable!==undefined?e.enable?"（已设置）":"（未设置）":"（已设置）"},_n);function _n(){}var Wn=function Vs(){this.isAnonymity=!1,this.anonymous="审批人"},$n=(Object.defineProperty(Xn.prototype,"value",{set:function(e){this.anonymousSet.isAnonymity=e.isAnonymity||!1,this.anonymousSet.anonymous=e.anonymous||"审批人"},enumerable:!0,configurable:!0}),Xn.prototype.ngOnInit=function(){},Xn.prototype.clickOK=function(){var e={value:this.anonymousSet,parameters:null};this.submitModal.emit(e)},Xn.prototype.clickCancel=function(){this.closeModal.emit()},Xn.decorators=[{type:ne.Component,args:[{selector:"lib-anonymous-set",template:'<div class="f-page">\r\n  <div class="f-utils-fill-flex-column farris-split-section m-2 h-100">\r\n    <section class="f-utils-fill-flex-column h-100">\r\n      <div class="f-section-header pt-2 mx-2">\r\n        <div class="f-title">\r\n          <h4 class="f-title-text">匿名设置</h4>\r\n        </div>\r\n      </div>\r\n      <div class="f-utils-fill-flex-column h-100">\r\n        <div class="farris-form form-inline farris-form-inline">\r\n          <div class="col-12 farris-group-auto my-3 pr-5">\r\n            <div class="farris-group-wrap">\r\n              <div class="form-group farris-form-group">\r\n                <label class="col-form-label">\r\n                  <span class="farris-label-text">是否启用</span>\r\n                </label>\r\n                <div class="farris-input-wrap ml-1">\r\n                  <farris-switch [(ngModel)]="anonymousSet.isAnonymity" name="isAnonymity"></farris-switch>\r\n                  <div class="farris-feedback valid-feedback"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class="col-12 farris-group-auto mt-4 pr-5">\r\n            <div class="farris-group-wrap">\r\n              <div class="form-group farris-form-group">\r\n                <label class="col-form-label">\r\n                  <span class="farris-label-text">匿名代称</span>\r\n                </label>\r\n                <div class="farris-input-wrap ml-1">\r\n                  <textarea class="form-control" type="text" value="anonymous" [(ngModel)]="anonymousSet.anonymous" name="anonymous"\r\n                  style="height: 50px;" [readOnly]="!anonymousSet.isAnonymity"></textarea>\r\n                  <div class="farris-feedback valid-feedback"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </section>\r\n  </div>\r\n</div>\r\n\r\n<ng-template #iconSelectFooter>\r\n  <button type="button" class="btn btn-primary btn-sm mx-2" (click)="clickOK()">确定</button>\r\n  <button type="button" class="btn btn-secondary btn-sm mx-2" (click)="clickCancel()">取消</button>\r\n</ng-template>',styles:[""]}]}],Xn.ctorParameters=function(){return[{type:ne.Injector}]},Xn.propDecorators={cls:[{type:ne.HostBinding,args:["class"]}],closeModal:[{type:ne.Output}],submitModal:[{type:ne.Output}],value:[{type:ne.Input}],modalFooter:[{type:ne.ViewChild,args:["iconSelectFooter"]}]},Xn);function Xn(e){this.injector=e,this.cls="farris-main-area flex-column",this.closeModal=new ne.EventEmitter,this.submitModal=new ne.EventEmitter,this.anonymousSet=new Wn,this.modalConfig={title:"匿名选项",width:450,height:360,showButtons:!0}}var Zn=(Yn.prototype.convertTo=function(e){return e&&e.isAnonymity?"（已设置）":"（未设置）"},Yn);function Yn(){}var Qn=function Ls(){},ea=(ta.prototype.ngOnInit=function(){var e=this;this.columns=[{field:"variableCode",width:90,title:"变量编号",sortable:!0,validators:[{type:"required",messager:"必填"}]},{field:"variableName",width:90,title:"变量名称",sortable:!0,validators:[{type:"required",messager:"必填"}]},{field:"tag",width:60,title:"值类型",sortable:!0,formatter:{type:"enum",options:{valueField:"value",textField:"text",data:this.tags}},editor:{type:U.EditorTypes.COMBOLIST,options:{valueField:"value",textField:"text",data:this.tags,idField:"value",panelHeight:"auto",showClear:!1,selectChange:function(t){e.value=e.value.map(function(e){return e.variableCode===t.rowId&&(e.value=null,e.valueText=null,e.component&&(e.component=null)),e})}}},validators:[{type:"required",messager:"必填"}]},{field:"executionTime",width:80,title:"执行时机",sortable:!0,formatter:{type:"enum",options:{valueField:"value",textField:"text",data:this.opportunities}},editor:{type:U.EditorTypes.COMBOLIST,options:{valueField:"value",textField:"text",data:this.opportunities,idField:"value",panelHeight:"auto",showClear:!1}},validators:[{type:"required",messager:"必填"}]},{field:"valueText",width:150,title:"变量值",showTips:!0,editor:{type:U.EditorTypes.TEXTBOX,options:{}},validators:[{type:"required",messager:"必填"}]}]},ta.prototype.add=function(){var s,l=this,e=this.resolver.resolveComponentFactory(Vr).create(this.injector);e.instance.variableSetting=!0,e.instance.value=this.uistate.ProcessVariables,e.instance.variableSetEmitter.subscribe(function(e){function t(e){var t=new Qn;t.variableCode=e.data.name,t.variableName=e.data.documentation,t.tag=e.data.tag||l.tags[0].value,t.executionTime=e.data.executionTime||l.opportunities[0].value,-1===l.value.findIndex(function(e){return e.variableCode===t.variableCode})&&(l.value=l.value.concat([t]))}var r,i;try{for(var n=pe(e),a=n.next();!a.done;a=n.next())t(a.value)}catch(o){r={error:o}}finally{try{a&&!a.done&&(i=n["return"])&&i.call(n)}finally{if(r)throw r.error}}s.close()}),e.instance.closeModal.subscribe(function(e){s.close()});var t={title:"流程变量",width:660,height:460,showButtons:!0,buttons:e.instance.modalFooter};s=this.modalService.show(e,t)},ta.prototype["delete"]=function(){this.grid.endCellEdit();var t=this.grid.selectedRow;t?this.value=this.value.filter(function(e){return e.variableCode!==t.data.variableCode}):this.message.info("尚未选中变量！")},ta.prototype.clickOK=function(){if(this.grid.endCellEdit(),this.validator()){var e={value:this.value,parameters:null};this.submitModal.emit(e)}},ta.prototype.clickCancel=function(){this.closeModal.emit()},ta.prototype.validator=function(){var e,t;try{for(var r=pe(this.value),i=r.next();!i.done;i=r.next())if(!i.value.value)return this.message.warning("变量值不允许为空！"),!1}catch(n){e={error:n}}finally{try{i&&!i.done&&(t=r["return"])&&t.call(r)}finally{if(e)throw e.error}}return!0},ta.prototype.endEdit=function(e){"valueText"===e.column.field&&e.rowData.tag===this.tags[0].value&&(e.rowData.value=e.rowData.valueText)},ta.prototype.valueEdit=function(e){switch(e.rowData.tag){case this.tags[1].value:this.editExpression(e);break;case this.tags[2].value:this.editComponent(e)}},ta.prototype.editExpression=function(t){var e,r,i,n,a,o,s,l,c,d,p,u,f=t.rowData;if(0<this.uistate.schemas.length){try{for(var h=pe(this.uistate.schemas),m=h.next();!m.done;m=h.next()){var v=m.value;this.expr.addSchema("Schema",v)}}catch(V){e={error:V}}finally{try{m&&!m.done&&(r=h["return"])&&r.call(h)}finally{if(e)throw e.error}}if(this.uistate.schemas[0].entityTypes&&0<this.uistate.schemas[0].entityTypes.length){var y=this.uistate.schemas[0].entityTypes[0];this.expr.addInjectedEntity(y.name,"Schema",y.name,J.InjectedType.EntityType)}}var g=new Array;if(0<this.uistate.procInstContext.length)try{for(var b=pe(this.uistate.procInstContext),x=b.next();!x.done;x=b.next()){var w=x.value;g.push(w)}}catch(L){i={error:L}}finally{try{x&&!x.done&&(n=b["return"])&&n.call(b)}finally{if(i)throw i.error}}if(0<this.uistate.formalParameterContext.length){var C=function(t){g.some(function(e){return e.key===t.key})||g.push(t)};try{for(var I=pe(this.uistate.formalParameterContext),S=I.next();!S.done;S=I.next())C(w=S.value)}catch(N){a={error:N}}finally{try{S&&!S.done&&(o=I["return"])&&o.call(I)}finally{if(a)throw a.error}}}if(0<this.uistate.participantContext.length){var k=function(t){g.some(function(e){return e.key===t.key})||g.push(t)};try{for(var E=pe(this.uistate.participantContext),P=E.next();!P.done;P=E.next())k(w=P.value)}catch(B){s={error:B}}finally{try{P&&!P.done&&(l=E["return"])&&l.call(E)}finally{if(s)throw s.error}}}if(0<this.uistate.processVariableContext.length){var T=function(t){g.some(function(e){return e.key===t.key})||g.push(t)};try{for(var F=pe(this.uistate.processVariableContext),A=F.next();!A.done;A=F.next())T(w=A.value)}catch(R){c={error:R}}finally{try{A&&!A.done&&(d=F["return"])&&d.call(F)}finally{if(c)throw c.error}}}if(0<g.length)try{for(var M=pe(g),D=M.next();!D.done;D=M.next()){var O=D.value;this.expr.addContext(O)}}catch(z){p={error:z}}finally{try{D&&!D.done&&(u=M["return"])&&u.call(M)}finally{if(p)throw p.error}}this.expr.setEditPattern(J.ExprEditMode.Advanced),this.expr.addExpressionText(f.value),this.expr.buildExpression().then(function(e){t.formControl.setValue(e),t.instance.cd.detectChanges(),f.value=e})},ta.prototype.editComponent=function(t){var r,i=t.rowData,e=this.resolver.resolveComponentFactory(Dr).create(this.injector);e.instance.component=i.component,e.instance.submitEmitter.subscribe(function(e){t.formControl.setValue(e.Name+"-"+e.MethodCode),t.instance.cd.detectChanges(),i.value=e.Id,i.component=e,r.close()}),e.instance.closeEmitter.subscribe(function(e){r.close()});var n={title:"构件",width:800,height:515,showButtons:!0,buttons:e.instance.footer};r=this.modalService.show(e,n)},ta.decorators=[{type:ne.Component,args:[{selector:"lib-variable-setting",template:'<div class="f-page">\r\n  <div class="f-page-header">\r\n    <nav class="f-page-header-base">\r\n      <div class="f-title">\r\n        <span class="f-title-icon f-text-orna-bill">\r\n          <i class="f-icon f-icon-page-title-administer"></i>\r\n        </span>\r\n        <h4 class="f-title-text">列表</h4>\r\n      </div>\r\n      <div class="btn-toolbar btn-group-lg">\r\n        <button class="btn btn-primary mr-2" (click)="add()">新增</button>\r\n        <button class="btn btn-secondary" (click)="delete()">删除</button>\r\n      </div>\r\n    </nav>\r\n  </div>\r\n  <div class="f-page-main f-utils-fill-flex-column h-100">\r\n    <div class="f-utils-fill-flex-column farris-overflow-y-auto h-100">\r\n      <farris-datagrid #grid [data]="value" [columns]="columns" [idField]="\'variableCode\'" [fit]="true" [fitColumns]="true"\r\n        [editable]="true" [editMode]="\'cell\'" [pagination]="false" [showCheckbox]="false" [multiSelect]="false"\r\n        [showLineNumber]="true" [lineNumberTitle]="\'序号\'" [lineNumberWidth]="50" [striped]="true"\r\n        (endEdit)="endEdit($event)" [beforeEdit]="beforeEdit">\r\n      </farris-datagrid>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<ng-template #iconSelectFooter>\r\n  <button type="button" class="btn btn-primary btn-sm px-3 mx-2" (click)="clickOK()">确定</button>\r\n  <button type="button" class="btn btn-secondary btn-sm px-3 mx-2" (click)="clickCancel()">取消</button>\r\n</ng-template>\r\n\r\n<ng-template #cell let-ctx>\r\n  <span (click)="valueEdit(ctx)" class="link"> {{ ctx.rowData.value?\'（已设置）\': \'（未设置）\' }}</span>\r\n</ng-template>',styles:[".link{color:#1206bb;font-size:14px}.link:hover{color:#5d478b;font-size:14px}"]}]}],ta.ctorParameters=function(){return[{type:ne.ComponentFactoryResolver},{type:ne.Injector},{type:te.BsModalService},{type:Y.MessagerService},{type:me},{type:J.ExpressionService}]},ta.propDecorators={cls:[{type:ne.HostBinding,args:["class"]}],closeModal:[{type:ne.Output}],submitModal:[{type:ne.Output}],value:[{type:ne.Input}],editorParams:[{type:ne.Input}],modalFooter:[{type:ne.ViewChild,args:["iconSelectFooter"]}],grid:[{type:ne.ViewChild,args:["grid"]}],cell:[{type:ne.ViewChild,args:["cell"]}]},ta);function ta(e,t,r,i,n,a){var o=this;this.resolver=e,this.injector=t,this.modalService=r,this.message=i,this.uistate=n,this.expr=a,this.cls="farris-main-area flex-column",this.closeModal=new ne.EventEmitter,this.submitModal=new ne.EventEmitter,this.value=new Array,this.editorParams={},this.columns=[],this.tags=[{value:"constant",text:"常量"},{value:"expression",text:"表达式"},{value:"component",text:"构件"}],this.opportunities=[{value:"ACTIVITY_STARTED",text:"活动开始"},{value:"ACTIVITY_COMPLETED",text:"活动结束"}],this.modalConfig={title:"变量设置",width:780,height:460,showButtons:!0},this.beforeEdit=function(e){var t=e.rowData;return"valueText"===e.column.field&&(t.tag===o.tags[0].value?e.column.editor={type:U.EditorTypes.TEXTBOX,options:{}}:e.column.editor={type:"input-group",options:{groupText:'<i class="f-icon f-icon-lookup"></i>',editable:!1,showClear:!1,clickHandle:function(e){e.formControl.setValue(e.instance.value?e.instance.value:""),o.valueEdit(e)},clear:function(e){console.log("clear",e)}}}),T.of(!0)}}var ra=(ia.prototype.convertTo=function(e){return e&&0<e.length?"（已设置）":"（未设置）"},ia);function ia(){}var na=function Ns(){this.enable=!1,this.title="审批要点",this.approvalPivots=new Array},aa=function Bs(){this.id=vt.GenerateElementId(),this.type="REMIND"},oa=(Object.defineProperty(sa.prototype,"value",{set:function(e){var t,r;if(e&&(this.config.enable=e.enable,this.config.title=e.title,e.approvalPivots&&0<e.approvalPivots.length))try{for(var i=pe(e.approvalPivots),n=i.next();!n.done;n=i.next()){var a=n.value,o=new aa;o.type=a.type,o.title=a.title,o.description=a.description,a.condition&&("string"==typeof a.condition?o.condition=a.condition:o.condition=a.condition._value),this.config.approvalPivots=this.config.approvalPivots.concat([o])}}catch(s){t={error:s}}finally{try{n&&!n.done&&(r=i["return"])&&r.call(i)}finally{if(t)throw t.error}}},enumerable:!0,configurable:!0}),sa.prototype.ngOnInit=function(){},sa.prototype.add=function(){var e=new aa;this.config.approvalPivots=this.config.approvalPivots.concat([e])},sa.prototype["delete"]=function(){var t=this.grid.selectedRow;t?this.config.approvalPivots=this.config.approvalPivots.filter(function(e){return e.id!==t.id}):this.message.info("尚未选中审批要点！")},sa.prototype.clickOK=function(){if(this.config.title||!this.config.enable){if(this.grid.endCellEdit(),this.validator()){var e={value:this.config,parameters:null};this.submitModal.emit(e)}}else this.message.info("尚未填写显示标题！")},sa.prototype.clickCancel=function(){this.closeModal.emit()},sa.prototype.validator=function(){return!0},sa.prototype.editConditon=function(t){var e,r,i,n,a,o,s,l,c,d,p,u,f,h;if(0<this.designerUIState.schemas.length){try{for(var m=pe(this.designerUIState.schemas),v=m.next();!v.done;v=m.next()){var y=v.value;this.expr.addSchema("Schema",y)}}catch(R){e={error:R}}finally{try{v&&!v.done&&(r=m["return"])&&r.call(m)}finally{if(e)throw e.error}}if(this.designerUIState.schemas[0].entityTypes&&0<this.designerUIState.schemas[0].entityTypes.length){var g=this.designerUIState.schemas[0].entityTypes[0];this.expr.addInjectedEntity(g.name,"Schema",g.name,J.InjectedType.EntityType)}}var b=new Array;if(0<this.designerUIState.procInstContext.length)try{for(var x=pe(this.designerUIState.procInstContext),w=x.next();!w.done;w=x.next()){var C=w.value;b.push(C)}}catch(z){i={error:z}}finally{try{w&&!w.done&&(n=x["return"])&&n.call(x)}finally{if(i)throw i.error}}if(0<this.designerUIState.formalParameterContext.length){var I=function(t){b.some(function(e){return e.key===t.key})||b.push(t)};try{for(var S=pe(this.designerUIState.formalParameterContext),k=S.next();!k.done;k=S.next())I(C=k.value)}catch(H){a={error:H}}finally{try{k&&!k.done&&(o=S["return"])&&o.call(S)}finally{if(a)throw a.error}}}if(0<this.designerUIState.participantContext.length){var E=function(t){b.some(function(e){return e.key===t.key})||b.push(t)};try{for(var P=pe(this.designerUIState.participantContext),T=P.next();!T.done;T=P.next())E(C=T.value)}catch(j){s={error:j}}finally{try{T&&!T.done&&(l=P["return"])&&l.call(P)}finally{if(s)throw s.error}}}if(0<this.designerUIState.processVariableContext.length){var F=function(t){b.some(function(e){return e.key===t.key})||b.push(t)};try{for(var A=pe(this.designerUIState.processVariableContext),M=A.next();!M.done;M=A.next())F(C=M.value)}catch(U){c={error:U}}finally{try{M&&!M.done&&(d=A["return"])&&d.call(A)}finally{if(c)throw c.error}}}if(0<this.designerUIState.activityComponentContext.length){var D=function(t){b.some(function(e){return e.key===t.key})||b.push(t)};try{for(var O=pe(this.designerUIState.activityComponentContext),V=O.next();!V.done;V=O.next())D(C=V.value)}catch(q){p={error:q}}finally{try{V&&!V.done&&(u=O["return"])&&u.call(O)}finally{if(p)throw p.error}}}if(0<b.length)try{for(var L=pe(b),N=L.next();!N.done;N=L.next()){var B=N.value;this.expr.addContext(B)}}catch(G){f={error:G}}finally{try{N&&!N.done&&(h=L["return"])&&h.call(L)}finally{if(f)throw f.error}}this.expr.addExpressionText(t.instance.value),this.expr.setEditPattern(J.ExprEditMode.Conditional),this.expr.buildExpression().then(function(e){t.formControl.setValue(e),t.instance.cd.detectChanges()})},sa.decorators=[{type:ne.Component,args:[{selector:"lib-approval-pivot",template:'<div class="f-page">\r\n  <section class="f-page-main d-flex flex-column">\r\n    <farris-section class="pt-0 f-section-form f-section-in-mainsubcard" [mainTitle]="\'审批要点\'" [enableAccordion]="\'default\'"\r\n      [enableMaximize]="false">\r\n      <div class="f-form-layout farris-form farris-form-controls-inline">\r\n        <fieldset class="f-section-formgroup">\r\n          <div class="f-section-formgroup-inputs">\r\n            <div class="col-12">\r\n              <div class="farris-group-wrap">\r\n                <div class="form-group farris-form-group">\r\n                  <label class="col-form-label">\r\n                    <span class="farris-label-text">是否启用</span>\r\n                  </label>\r\n                  <div class="farris-input-wrap ml-1">\r\n                    <farris-switch [(ngModel)]="config.enable" name="enable"></farris-switch>\r\n                    <div class="farris-feedback valid-feedback"></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div class="col-12">\r\n              <div class="farris-group-wrap">\r\n                <div class="form-group farris-form-group">\r\n                  <label class="col-form-label">\r\n                    <span class="farris-label-info text-danger">*</span>\r\n                    <span class="farris-label-text">显示标题</span>\r\n                  </label>\r\n                  <div class="farris-input-wrap">\r\n                    <input type="text" class="form-control" [(ngModel)]="config.title" name="title"/>\r\n                    <div class="farris-feedback valid-feedback"></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </fieldset>\r\n      </div>\r\n    </farris-section>\r\n    <farris-section class="pt-0 f-section-grid f-section-in-managelist" [mainTitle]="\'列表\'" [enableAccordion]="\'\'"\r\n      [enableMaximize]="false" [fill]="true">\r\n      <ng-template farrisSectionToolbar>\r\n        <button class="btn btn-link pr-2 mr-2" (click)="add()">新增</button>\r\n        <button class="btn btn-link mr-0" (click)="delete()">删除</button>\r\n      </ng-template>\r\n      <farris-datagrid class="f-component-grid" [columns]="columns" [data]="config.approvalPivots" #grid [idField]="\'id\'" [showLineNumber]="true"\r\n        [striped]="true" [showCheckbox]="false" [pagination]="false" [fit]="true" [fitColumns]="true" [editable]="true" [editMode]="\'cell\'"\r\n        [multiSelect]="false">\r\n      </farris-datagrid>\r\n    </farris-section>\r\n  </section>\r\n</div>\r\n\r\n<ng-template #iconSelectFooter>\r\n  <button type="button" class="btn btn-primary btn-sm px-3 mx-2" (click)="clickOK()">确定</button>\r\n  <button type="button" class="btn btn-secondary btn-sm px-3" (click)="clickCancel()">取消</button>\r\n</ng-template>\r\n',styles:[""]}]}],sa.ctorParameters=function(){return[{type:me},{type:J.ExpressionService},{type:Y.MessagerService}]},sa.propDecorators={cls:[{type:ne.HostBinding,args:["class"]}],closeModal:[{type:ne.Output}],submitModal:[{type:ne.Output}],modalFooter:[{type:ne.ViewChild,args:["iconSelectFooter"]}],grid:[{type:ne.ViewChild,args:["grid"]}],value:[{type:ne.Input}]},sa);function sa(e,t,r){var i=this;this.designerUIState=e,this.expr=t,this.message=r,this.cls="farris-main-area flex-column",this.closeModal=new ne.EventEmitter,this.submitModal=new ne.EventEmitter,this.config=new na,this.typeList=[{value:"REMIND",text:"文字提示"}],this.columns=[{field:"type",width:80,title:"类型",formatter:{type:"enum",options:{valueField:"value",textField:"text",data:this.typeList}},editor:{type:U.EditorTypes.COMBOLIST,options:{valueField:"value",textField:"text",data:this.typeList,idField:"value",panelHeight:"auto",enableClear:!1}},validators:[{type:"required",messager:"必填"}]},{field:"condition",width:120,title:"条件",showTips:!0,editor:{type:"input-group",options:{groupText:'<i class="f-icon f-icon-lookup"></i>',editable:!1,clickHandle:function(e){e.formControl.setValue(e.instance.value?e.instance.value:""),i.editConditon(e)},clear:function(e){console.log("clear",e)}}}},{field:"title",width:80,title:"显示名称",editor:{type:U.EditorTypes.TEXTBOX,options:{}}},{field:"description",width:100,title:"详细说明",showTips:!0,editor:{type:U.EditorTypes.TEXTBOX,options:{}}}],this.modalConfig={title:"审批要点",width:800,height:480,showButtons:!0}}var la=(ca.prototype.convertTo=function(e){return e&&e.enable?"（已设置）":"（未设置）"},ca);function ca(){}var da=function Rs(){this.urgeHandleAble=!1,this.earlyTime=0,this.intervalTime=0,this.urgeMessageSubject='{"expr":"\'催办审批：\' + DefaultFunction.GetContextParameter(\\"bizDefName\\")","sexpr":""}',this.urgeMessageContent='{"expr":"\'请您尽快审批\' + DefaultFunction.GetContextParameter(\\"procInstCreatorName\\") + \'的\' + DefaultFunction.GetContextParameter(\\"bizDefName\\") + \'。\'","sexpr":""}',this.addReminder=!1,this.subjectEditable=!0,this.contentEditable=!0},pa=(Object.defineProperty(ua.prototype,"value",{set:function(e){e?this.urgeHandleRule=e:(this.urgeHandleRule.urgeHandleAble=!0,this.urgeHandleRule.sendType="cloudplus,inmail")},enumerable:!0,configurable:!0}),ua.prototype.ngOnInit=function(){},ua.prototype.clickOK=function(){if(this.validator()){var e={value:this.urgeHandleRule,parameters:null};this.submitModal.emit(e)}},ua.prototype.clickCancel=function(){this.closeModal.emit()},ua.prototype.validator=function(){return!(this.urgeHandleRule.urgeHandleAble&&(this.urgeHandleRule.sendType?this.urgeHandleRule.urgeMessageSubject?!this.urgeHandleRule.urgeMessageContent&&(this.message.info("尚未选择消息内容！"),1):(this.message.info("尚未配置消息主题！"),1):(this.message.info("尚未选择发送方式！"),1)))},ua.prototype.titleExpr=function(e){this.showTitleHelp(e)},ua.prototype.contentExpr=function(e){this.showContentHelp(e)},ua.prototype.showTitleHelp=function(e){var t=this;this.showExpr(),this.urgeHandleRule.urgeMessageSubject&&0<this.urgeHandleRule.urgeMessageSubject.length?this.expr.addExpressionText(this.urgeHandleRule.urgeMessageSubject):this.expr.addExpressionText(""),this.expr.buildExpression().then(function(e){t.urgeHandleRule.urgeMessageSubject=e})},ua.prototype.showContentHelp=function(e){var t=this;this.showExpr(),this.urgeHandleRule.urgeMessageContent&&0<this.urgeHandleRule.urgeMessageContent.length?this.expr.addExpressionText(this.urgeHandleRule.urgeMessageContent):this.expr.addExpressionText(""),this.expr.buildExpression().then(function(e){t.urgeHandleRule.urgeMessageContent=e})},ua.prototype.showExpr=function(){var e,t,r,i,n,a,o,s;if(0<this.designerUIState.schemas.length){try{for(var l=pe(this.designerUIState.schemas),c=l.next();!c.done;c=l.next()){var d=c.value;this.expr.addSchema("Schema",d)}}catch(C){e={error:C}}finally{try{c&&!c.done&&(t=l["return"])&&t.call(l)}finally{if(e)throw e.error}}if(this.designerUIState.schemas[0].entityTypes&&0<this.designerUIState.schemas[0].entityTypes.length){var p=this.designerUIState.schemas[0].entityTypes[0];this.expr.addInjectedEntity(p.name,"Schema",p.name,J.InjectedType.EntityType)}}var u=new Array;if(0<this.designerUIState.urgeContext.length)try{for(var f=pe(this.designerUIState.urgeContext),h=f.next();!h.done;h=f.next()){var m=h.value;u.push(m)}}catch(I){r={error:I}}finally{try{h&&!h.done&&(i=f["return"])&&i.call(f)}finally{if(r)throw r.error}}if(0<this.designerUIState.processVariableContext.length){var v=function(t){u.some(function(e){return e.key===t.key})||u.push(t)};try{for(var y=pe(this.designerUIState.processVariableContext),g=y.next();!g.done;g=y.next())v(m=g.value)}catch(S){n={error:S}}finally{try{g&&!g.done&&(a=y["return"])&&a.call(y)}finally{if(n)throw n.error}}}if(0<u.length)try{for(var b=pe(u),x=b.next();!x.done;x=b.next()){var w=x.value;this.expr.addContext(w)}}catch(k){o={error:k}}finally{try{x&&!x.done&&(s=b["return"])&&s.call(b)}finally{if(o)throw o.error}}},ua.decorators=[{type:ne.Component,args:[{selector:"lib-urge-handle-rule",template:'<div class="f-page">\r\n  <section class="f-page-main d-flex flex-column">\r\n    <farris-section class="pt-0 f-section-form f-section-in-mainsubcard" [mainTitle]="\'催办选项\'"\r\n      [enableAccordion]="\'\'" [enableMaximize]="false">\r\n      <div class="f-form-layout farris-form farris-form-controls-inline">\r\n        <fieldset class="f-section-formgroup">\r\n          <div class="f-section-formgroup-inputs">\r\n            <div class="col-12">\r\n              <div class="farris-group-wrap">\r\n                <div class="form-group farris-form-group">\r\n                  <label class="col-form-label">\r\n                    <span class="farris-label-info text-danger">*</span>\r\n                    <span class="farris-label-text">启用催办</span>\r\n                  </label>\r\n                  <div class="farris-input-wrap ml-1">\r\n                    <farris-switch [(ngModel)]="urgeHandleRule.urgeHandleAble" name="enable"></farris-switch>\r\n                    <div class="farris-feedback valid-feedback"></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div class="col-12 mt-2 pt-1">\r\n              <div class="farris-group-wrap">\r\n                <div class="form-group farris-form-group">\r\n                  <label class="col-form-label">\r\n                    <span class="farris-label-info text-danger">*</span>\r\n                    <span class="farris-label-text">时间设置</span>\r\n                  </label>\r\n                  <label style="width: 55%;" class="mb-0">\r\n                    <span class="farris-label-text">最早允许催办时间（小时）</span>\r\n                  </label>\r\n                  <div class="farris-input-wrap">\r\n                    <farris-number-spinner [(ngModel)]="urgeHandleRule.earlyTime" name="earlyTime" [editable]="true" [precision]="0"\r\n                      [parser]="parser" [min]="0"></farris-number-spinner>\r\n                    <div class="farris-feedback valid-feedback"></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div class="col-12">\r\n              <div class="farris-group-wrap">\r\n                <div class="form-group farris-form-group">\r\n                  <label class="col-form-label">\r\n                    <span class="farris-label-text"></span>\r\n                  </label>\r\n                  <label style="width: 55%;" class="mb-0">\r\n                    <span class="farris-label-text">最小允许催办间隔（小时）</span>\r\n                  </label>\r\n                  <div class="farris-input-wrap">\r\n                    <farris-number-spinner [(ngModel)]="urgeHandleRule.intervalTime" name="intervalTime" [editable]="true" [precision]="0"\r\n                      [parser]="parser" [min]="0"></farris-number-spinner>\r\n                    <div class="farris-feedback valid-feedback"></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div class="col-12 mt-2 pt-1">\r\n              <div class="farris-group-wrap">\r\n                <div class="form-group farris-form-group">\r\n                  <label class="col-form-label">\r\n                    <span class="farris-label-info text-danger">*</span>\r\n                    <span class="farris-label-text">发送方式</span>\r\n                  </label>\r\n                  <div class="farris-input-wrap">\r\n                    <farris-checkboxgroup #checkboxGroup [(ngModel)]="urgeHandleRule.sendType" name="sendType" [horizontal]="true"\r\n                      [data]="typeGroup">\r\n                    </farris-checkboxgroup>\r\n                    <div class="farris-feedback valid-feedback"></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div class="col-12 mt-2 pt-1">\r\n              <div class="farris-group-wrap">\r\n                <div class="form-group farris-form-group">\r\n                  <label class="col-form-label">\r\n                    <span class="farris-label-info text-danger">*</span>\r\n                    <span class="farris-label-text">消息主题</span>\r\n                  </label>\r\n                  <div class="farris-input-wrap">\r\n                    <input-group [editable]="false" [customCls]="\'custom-cls\'" [groupText]="groupIcon2"\r\n                                 [(value)]="urgeHandleRule.urgeMessageSubject" (clickHandle)="titleExpr($event)">\r\n                    </input-group>\r\n                    <div class="farris-feedback valid-feedback"></div>\r\n                  </div>\r\n                  <label class="col-form-label">\r\n                    <span class="farris-label-text">支持编辑</span>\r\n                  </label>\r\n                  <div class="farris-input-wrap" style="text-align: right">\r\n                    <farris-switch [(ngModel)]="urgeHandleRule.subjectEditable" name="enable" size="small"></farris-switch>\r\n                    <div class="farris-feedback valid-feedback"></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div class="col-12 mt-2 pt-1">\r\n              <div class="farris-group-wrap">\r\n                <div class="form-group farris-form-group">\r\n                  <label class="col-form-label">\r\n                    <span class="farris-label-info text-danger">*</span>\r\n                    <span class="farris-label-text">消息内容</span>\r\n                  </label>\r\n                  <div class="farris-input-wrap">\r\n                    <input-group [editable]="false" [customCls]="\'custom-cls\'" [groupText]="groupIcon2"\r\n                                 [(value)]="urgeHandleRule.urgeMessageContent" (clickHandle)="contentExpr($event)">\r\n                    </input-group>\r\n                    <div class="farris-feedback valid-feedback"></div>\r\n                  </div>\r\n                  <label class="col-form-label">\r\n                    <span class="farris-label-text">支持编辑</span>\r\n                  </label>\r\n                  <div class="farris-input-wrap">\r\n                    <farris-switch [(ngModel)]="urgeHandleRule.contentEditable" name="enable" size="small"></farris-switch>\r\n                    <div class="farris-feedback valid-feedback"></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div class="col-12 mt-2 pt-1">\r\n              <div class="farris-group-wrap">\r\n                <div class="form-group farris-form-group">\r\n                  <label class="col-form-label">\r\n                    <span class="farris-label-text">显示催办人</span>\r\n                  </label>\r\n                  <div class="farris-input-wrap">\r\n                    <farris-switch [(ngModel)]="urgeHandleRule.addReminder" name="enable" size="small"></farris-switch>\r\n                    <div class="farris-feedback valid-feedback"></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </fieldset>\r\n      </div>\r\n    </farris-section>\r\n  </section>\r\n</div>\r\n\r\n<ng-template #iconSelectFooter>\r\n  <button type="button" class="btn btn-primary btn-sm px-3 mx-2" (click)="clickOK()">确定</button>\r\n  <button type="button" class="btn btn-secondary btn-sm px-3" (click)="clickCancel()">取消</button>\r\n</ng-template>\r\n',styles:[""]}]}],ua.ctorParameters=function(){return[{type:me},{type:J.ExpressionService},{type:Y.MessagerService}]},ua.propDecorators={closeModal:[{type:ne.Output}],submitModal:[{type:ne.Output}],modalFooter:[{type:ne.ViewChild,args:["iconSelectFooter"]}],value:[{type:ne.Input}]},ua);function ua(e,t,r){this.designerUIState=e,this.expr=t,this.message=r,this.groupIcon2='<i class="f-icon f-icon-lookup"></i>',this.closeModal=new ne.EventEmitter,this.submitModal=new ne.EventEmitter,this.urgeHandleRule=new da,this.typeGroup=this.designerUIState.messageChannels.map(function(e){return{value:e.code,name:e.name}}),this.modalConfig={title:"催办",width:500,height:445,showButtons:!0},this.parser=function(e){return Number(e)}}var fa=(ha.prototype.convertTo=function(e){return e?e.urgeHandleAble?"（已设置）":"（未设置）":"（已设置）"},ha);function ha(){}var ma=(va.prototype.setFlowElementProperty=function(e){this.uiState.propertyData=e.propertyData,this.uiState.propertyConfig=this.setFlowEleConfig(e.propertyConfig)},va.prototype.setFlowEleConfig=function(e){var t=this,r=[];return e&&e.forEach(function(e){t.setFlowEleEntity(e.properties),r.push(e)}),r},va.prototype.setFlowEleEntity=function(e){var t=this;e&&0<e.length&&e.forEach(function(e){switch(e.propertyID){case Oe:e.editor=Ni,e.converter=new Ri,e.editorParams={};break;case at:e.editor=cr,e.converter=new pr,e.editorParams={location:"startActivity",tab:"web"};break;case ot:e.editor=cr,e.converter=new pr,e.editorParams={location:"startActivity",tab:"mobile"};break;case Ke:case Je:e.iterator=t.uiState.boolIterator;break;case _e:e.editor=Hi,e.converter=new Ui;break;case Ze:e.iterator=t.uiState.boolIterator;break;default:e.editor=ci,e.converter=new pi}})},va.prototype.setUserActivityProperty=function(e){e.propertyData.ApprovalItems&&(this.buildApprovalItems(e.propertyData.ApprovalItems),this.buildCounterSignVariables(e.propertyData.ApprovalItems),this.buildSignRules(e.propertyData.SignRule)),this.uiState.propertyData=e.propertyData,this.uiState.bizActivityId=e.propertyData.BizActivityID,this.uiState.propertyConfig=this.setUserActConfig(e.propertyConfig)},va.prototype.setUserActConfig=function(e){var t=this,r=[];return e&&e.forEach(function(e){t.setUserActEntity(e.properties),r.push(e)}),r},va.prototype.setUserActEntity=function(e){var t=this;e&&0<e.length&&e.forEach(function(e){switch(e.propertyID){case Ve:e.editor=Hn,e.converter=new Un;break;case at:e.editor=cr,e.converter=new pr,e.editorParams={location:"userActivity",tab:"web"};break;case ot:e.editor=cr,e.converter=new pr,e.editorParams={location:"userActivity",tab:"mobile"};break;case Ne:e.iterator=t.uiState.assignIterator;break;case Be:e.editor=Ii,e.converter=new ki;break;case Re:t.uiState.propertyData.AssignStrategy===t.uiState.assignIterator[2].key?e.iterator=t.uiState.completeIterator4Claim:e.iterator=t.uiState.completeIterator;break;case ze:e.editor=Ti,e.converter=new Ai,e.editorParams={variables:t.uiState.counterSignVariables,approvalItems:t.uiState.approvalItems};break;case Le:e.editor=Di,e.converter=new Vi;break;case He:e.iterator=t.uiState.boolIterator;break;case je:case Ue:case qe:case et:e.editor=Gn,e.converter=new Jn;break;case Xe:e.iterator=t.uiState.boolIterator;break;case Je:t.uiState.propertyData.CompleteStrategy&&t.uiState.propertyData.CompleteStrategy!==t.uiState.completeIterator[0].key?e.iterator=t.uiState.noJump4Sign:e.iterator=t.uiState.boolIterator;break;case _e:e.editor=Hi,e.converter=new Ui;break;case We:e.editor=Gi,e.converter=new Ji,e.editorParams={nodeType:"UserActivity"};break;case st:e.editor=fr,e.converter=new mr;break;case $e:e.editor=Ut,e.converter=new Gt,e.editorParams={location:"activity"};break;case lt:e.editor=xr,e.converter=new Cr;break;case ct:e.editor=Xr,e.converter=new Yr,e.editorParams={location:"activity"};break;case dt:e.editor=$n,e.converter=new Zn;break;case ut:e.editor=ea,e.converter=new ra;break;case ft:e.editor=ai,e.converter=new si,e.editorParams={location:"activity"};break;case ht:e.editor=oa,e.converter=new la;break;case Ge:e.iterator=t.uiState.displayTerminal;break;case rt:e.editor=pa,e.converter=new fa;break;default:e.editor=ci,e.converter=new pi}})},va.prototype.buildCounterSignVariables=function(e){var t,r;if(this.uiState.counterSignVariables=[],this.uiState.counterSignVariables=this.uiState.counterSignVariables.concat([{key:"nrOfInstances",name:"总任务数",description:"总任务数"},{key:"nrOfCompletedInstances",name:"已完成任务数",description:"已完成任务数"}]),e&&0<e.length)try{for(var i=pe(e),n=i.next();!n.done;n=i.next()){var a=n.value,o=new J.VarEntity;o.key="nrOf"+a.Value,o.name=a.Text+"_任务数",o.description=a.Text+"_任务数",this.uiState.counterSignVariables.push(o)}}catch(s){t={error:s}}finally{try{n&&!n.done&&(r=i["return"])&&r.call(i)}finally{if(t)throw t.error}}},va.prototype.buildApprovalItems=function(e){var t,r;if(this.uiState.approvalItems=[],e&&0<e.length)try{for(var i=pe(e),n=i.next();!n.done;n=i.next()){var a=n.value,o=new mi;o.value=a.Value,o.text=a.Text,o.workFlowAction=a.WorkFlowAction,o.isDefault=a.IsDefault,this.uiState.approvalItems.push(o)}}catch(s){t={error:s}}finally{try{n&&!n.done&&(r=i["return"])&&r.call(i)}finally{if(t)throw t.error}}},va.prototype.buildSignRules=function(e){var t,r;if(e&&0<e.length){var i=function(t){var e=n.uiState.approvalItems.find(function(e){return e.value===t.ConclusionValue});e&&(t.ConclusionName=e.text)},n=this;try{for(var a=pe(e),o=a.next();!o.done;o=a.next())i(o.value)}catch(s){t={error:s}}finally{try{o&&!o.done&&(r=a["return"])&&r.call(a)}finally{if(t)throw t.error}}}},va.decorators=[{type:ne.Injectable}],va.ctorParameters=function(){return[{type:me},{type:Y.MessagerService},{type:ne.Injector},{type:te.BsModalService},{type:ne.ComponentFactoryResolver}]},va);function va(e,t,r,i,n){this.uiState=e,this.message=t,this.injector=r,this.modalService=i,this.resolver=n}var ya=(Object.defineProperty(ga.prototype,"organizations",{get:function(){return this._organizations},set:function(e){this._organizations=e,this._organizations&&0<this._organizations.length?this.items=this.makeTreeByParent(this._organizations,"parentId","id"):this.items=new Array},enumerable:!0,configurable:!0}),ga.prototype.ngOnInit=function(){},ga.prototype.saveAsOK=function(){this.validator()&&this.submit.next({procName:this.procName,accessLevel:this.accessLevel,organization:this.organization,organizationName:this.organizationName})},ga.prototype.saveAsCancel=function(){this.cancel.emit()},ga.prototype.validator=function(){return!0},ga.prototype.search=function(e){this.lookUp.componentRef.instance.searchHandle.search(e.field,e.value,"client")},ga.prototype.makeTreeByParent=function(r,i,n){var t=this,e=r.filter(function(t){return!t[i]||!r.find(function(e){return e[n]===t[i]})||void 0}),a=[];return e.forEach(function(e){var t={};t.data=e,t.children=[],a.push(t)}),a.forEach(function(e){t.findChildrenByParent(e,r,i,n)}),a},ga.prototype.findChildrenByParent=function(r,i,n,a){var o=this,e=i.filter(function(e){if(e[n]===r.data[a])return!0});e&&0<e.length&&e.forEach(function(e){var t={};t.data=e,t.children=[],r.children.push(t),o.findChildrenByParent(t,i,n,a)})},ga.decorators=[{type:ne.Component,args:[{selector:"app-save-as-edit",template:'\x3c!-- <div class="f-page">\r\n  <div class="f-page-main">\r\n    <div class="d-flex m-2 py-2 farris-row">\r\n      <div class="w-100 px-4">\r\n        <label class="col-form-label">\r\n          <span class="farris-label-text">流程名称</span>\r\n        </label>\r\n        <div class="farris-input-wrap">\r\n          <input type="text" class="form-control" [(ngModel)]="procName" name="procName" />\r\n          <div class="farris-feedback valid-feedback"></div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div class="d-flex m-2 py-2 farris-row">\r\n      <div class="px-4 w-100">\r\n        <label class="col-form-label">\r\n          <span class="farris-label-text">流程Key值</span>\r\n        </label>\r\n        <div class="farris-input-wrap">\r\n          <input type="text" class="form-control" [(ngModel)]="procKey" name="procKey" [readonly]="true" />\r\n          <div class="farris-feedback valid-feedback"></div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div> --\x3e\r\n\r\n<div class="f-page f-page-card f-page-is-mainsubcard">\r\n  <section class="f-page-main">\r\n    \x3c!--不确认---------------------------卡片组件不同的Section是在不同的组件里，还是在同一个卡片组件里--\x3e\r\n    \x3c!--表单区域--\x3e\r\n    \x3c!--需要嵌套的层---------------------------IDE转化成组件-----------\x3e\r\n    <div class="f-struct-wrapper">\r\n      <farris-section class="f-section-form f-section-in-mainsubcard" [enableAccordion]="\'\'" [mainTitle]="\'基础属性\'"\r\n        [subTitle]="\'\'" [enableMaximize]="false">\r\n\r\n        \x3c!--输入控件 没有分组--\x3e\r\n        <div class="f-form-layout farris-form farris-form-controls-inline pr-4 m-2">\r\n          <div class="col-12 px-0 my-2">\r\n            <div class="farris-group-wrap">\r\n              <div class="form-group farris-form-group">\r\n                <label class="col-form-label">\r\n                  <span class="farris-label-info text-danger">*</span>\r\n                  <span class="farris-label-text">流程名称</span>\r\n                </label>\r\n                <div class="farris-input-wrap">\r\n                  <input type="text" class="form-control" [(ngModel)]="procName" name="procName" />\r\n                  <div class="farris-feedback valid-feedback"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class="col-12 px-0 my-2">\r\n            <div class="farris-group-wrap">\r\n              <div class="form-group farris-form-group">\r\n                <label class="col-form-label">\r\n                  <span class="farris-label-text">流程Key值</span>\r\n                </label>\r\n                <div class="farris-input-wrap">\r\n                  <input type="text" class="form-control" [(ngModel)]="procKey" name="procKey" [readonly]="true" />\r\n                  <div class="farris-feedback valid-feedback"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class="col-12 px-0 my-2">\r\n            <div class="farris-group-wrap">\r\n              <div class="form-group farris-form-group">\r\n                <label class="col-form-label">\r\n                  <span class="farris-label-text">维护组织</span>\r\n                </label>\r\n                <div class="farris-input-wrap">\r\n                  <farris-lookup-grid #lookup [(ngModel)]="organizationName" name="orgName"\r\n                    [columns]="columns" [items]="items" [singleSelect]="true" [displayType]="\'TreeList\'"\r\n                    [idField]="\'id\'" [valueField]="\'id\'" [textField]="\'name\'" [dictPicked]="dictPicked"\r\n                    [enableClear]="false" (search)="search($event)" [remoteSearch]="false" [title]="\'组织\'"\r\n                    [readonly]="!isAdministratorConfig">\r\n                  </farris-lookup-grid>\r\n                  <div class="farris-feedback valid-feedback"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class="col-12 px-0 my-2">\r\n            <div class="farris-group-wrap">\r\n              <div class="form-group farris-form-group">\r\n                <label class="col-form-label">\r\n                  <span class="farris-label-info text-danger">*</span>\r\n                  <span class="farris-label-text">访问级别</span>\r\n                </label>\r\n                <div class="farris-input-wrap">\r\n                  <farris-combo-list [(ngModel)]="accessLevel" name="accessLevel"\r\n                    [ngModelOptions]="{standalone: true}" [idField]="\'value\'" [textField]="\'text\'"\r\n                    [valueField]="\'value\'" [data]="accessLevelCollection" [panelHeight]="\'auto\'" [enableClear]="false">\r\n                  </farris-combo-list>\r\n                  <div class="farris-feedback valid-feedback"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </farris-section>\r\n    </div>\r\n  </section>\r\n</div>\r\n\r\n<ng-template #buttonRef>\r\n  <button type="button" class="btn btn-sm btn-primary mx-2" (click)="saveAsOK()">确定</button>\r\n  <button type="button" class="btn btn-secondary btn-sm mx-2" (click)="saveAsCancel()">取消</button>\r\n</ng-template>\r\n',styles:[""]}]}],ga.ctorParameters=function(){return[]},ga.propDecorators={btnRef:[{type:ne.ViewChild,args:["buttonRef"]}],procName:[{type:ne.Input}],procKey:[{type:ne.Input}],lookUp:[{type:ne.ViewChild,args:["lookup"]}],submit:[{type:ne.Output}],cancel:[{type:ne.Output}]},ga);function ga(){var t=this;this.submit=new ne.EventEmitter,this.cancel=new ne.EventEmitter,this.accessLevel="public",this.isAdministratorConfig=!1,this.items=new Array,this.accessLevelCollection=[{value:"public",text:"公有"},{value:"private",text:"私有"}],this.columns=[{title:"编号",field:"code",width:"100",searchField:"code"},{title:"名称",field:"name",width:"100",searchField:"name"}],this.dictPicked=function(e){return t.organizationName=e.name,t.organization=e.id,T.of(!0)}}var ba={InheritParent:"SameWithParent",VariablesExpression:"VariablesExpression",AutoCreation:"AutoGenerateDownBill"},xa={Dynamic:"Dynamic",Specified:"Specified"},wa=function zs(){this.subProcessType=xa.Specified,this.billSourceType=ba.InheritParent},Ca=(Ia.bifMonitorAppId="BillIntegrationFrameworkRT",Ia.bifManagerAppEntrance="bif-manager",Ia.bifDiagnostorFuncId="BifDiagnostor",Ia.bifManagerFuncId="BifManager",Ia);function Ia(){}var Sa,ka={BifCreationProcess:"BifCreationProcess",BifWritebackProcess:"BifWritebackProcess"},Ea=(ce(Pa,Sa=re.JsonConvertableImpl),Pa.prototype.ResetBeforeLoadFrom=function(){Sa.prototype.ResetBeforeLoadFrom.call(this),this.id=null,this.code=null,this.name=null,this.upBillVoName=null,this.downBillVoName=null,this.parentId=null,this.bifMetadataType=null,this.lastModifiedTime=null,this.sysInit=!1,this.originId=null,this.rootId=null},Pa.prototype.ConvertToJsonObject=function(){var e=Sa.prototype.ConvertToJsonObject.call(this);return re.BpmnModelJsonHelper.SetAttributeValue(e,"id",this.id),re.BpmnModelJsonHelper.SetAttributeValue(e,"code",this.code),re.BpmnModelJsonHelper.SetAttributeValue(e,"name",this.name),re.BpmnModelJsonHelper.SetAttributeValue(e,"upBillVoName",this.upBillVoName),re.BpmnModelJsonHelper.SetAttributeValue(e,"downBillVoName",this.downBillVoName),re.BpmnModelJsonHelper.SetAttributeValue(e,"parentId",this.parentId),re.BpmnModelJsonHelper.SetAttributeValue(e,"bifMetadataType",this.bifMetadataType),re.BpmnModelJsonHelper.SetAttributeValue(e,"lastModifiedTime",this.lastModifiedTime),re.BpmnModelJsonHelper.SetAttributeValue(e,"sysInit",this.sysInit),re.BpmnModelJsonHelper.SetAttributeValue(e,"originId",this.originId),re.BpmnModelJsonHelper.SetAttributeValue(e,"rootId",this.rootId),e},Pa.prototype.LoadFromJsonObject=function(e){Sa.prototype.LoadFromJsonObject.call(this,e),this.id=re.BpmnModelJsonHelper.GetAttributeValueAsString(e,"id"),this.code=re.BpmnModelJsonHelper.GetAttributeValueAsString(e,"code"),this.name=re.BpmnModelJsonHelper.GetAttributeValueAsString(e,"name"),this.upBillVoName=re.BpmnModelJsonHelper.GetAttributeValueAsString(e,"upBillVoName"),this.downBillVoName=re.BpmnModelJsonHelper.GetAttributeValueAsString(e,"downBillVoName"),this.parentId=re.BpmnModelJsonHelper.GetAttributeValueAsString(e,"parentId"),this.bifMetadataType=ka[re.BpmnModelJsonHelper.GetAttributeValueAsString(e,"bifMetadataType")],this.lastModifiedTime=re.BpmnModelJsonHelper.GetAttributeValueAsDateTime(e,"lastModifiedTime"),this.sysInit=re.BpmnModelJsonHelper.GetAttributeValueAsBoolean(e,"sysInit"),this.originId=re.BpmnModelJsonHelper.GetAttributeValueAsString(e,"originId"),this.rootId=re.BpmnModelJsonHelper.GetAttributeValueAsString(e,"rootId")},Pa);function Pa(){var e=null!==Sa&&Sa.apply(this,arguments)||this;return e.sysInit=!1,e}var Ta,Fa=(ce(Aa,Ta=Ea),Aa.prototype.ResetBeforeLoadFrom=function(){Ta.prototype.ResetBeforeLoadFrom.call(this),this.isEnabled=!1},Aa.prototype.ConvertToJsonObject=function(){var e=Ta.prototype.ConvertToJsonObject.call(this);return re.BpmnModelJsonHelper.SetAttributeValue(e,"isEnabled",this.isEnabled),e},Aa.prototype.LoadFromJsonObject=function(e){Ta.prototype.LoadFromJsonObject.call(this,e),this.isEnabled=re.BpmnModelJsonHelper.GetAttributeValueAsBoolean(e,"isEnabled")},Aa);function Aa(){return null!==Ta&&Ta.apply(this,arguments)||this}var Ma,Da=(ce(Oa,Ma=Fa),Oa.prototype.ResetBeforeLoadFrom=function(){Ma.prototype.ResetBeforeLoadFrom.call(this),this.isEnabled=!1,this.customizationEntities.length=0},Oa.prototype.ConvertToJsonObject=function(){var e=Ma.prototype.ConvertToJsonObject.call(this);return re.BpmnModelJsonHelper.SetAttributeValue(e,"isEnabled",this.isEnabled),re.BpmnModelJsonHelper.SetAttributeValue(e,"customizationEntities",this.customizationEntities),e},Oa.prototype.LoadFromJsonObject=function(e){Ma.prototype.LoadFromJsonObject.call(this,e),this.isEnabled=re.BpmnModelJsonHelper.GetAttributeValueAsBoolean(e,"isEnabled"),this.customizationEntities=re.BpmnModelJsonHelper.GetAttributeValueAsList(e,"customizationEntities",Oa)},Oa.prototype.getTClass=function(){return Oa},Oa);function Oa(){var e=null!==Ma&&Ma.apply(this,arguments)||this;return e.customizationEntities=new Array,e}var Va,La=(ce(Na,Va=re.JsonConvertableImpl),Na.prototype.ResetBeforeLoadFrom=function(){Va.prototype.ResetBeforeLoadFrom.call(this),this.totalCount=0,this.pageCount=0,this.pageIndex=0,this.pageSize=0,this.entities.length=0},Na.prototype.ConvertToJsonObject=function(){var e=Va.prototype.ConvertToJsonObject.call(this);return re.BpmnModelJsonHelper.SetAttributeValue(e,"totalCount",this.totalCount),re.BpmnModelJsonHelper.SetAttributeValue(e,"pageCount",this.pageCount),re.BpmnModelJsonHelper.SetAttributeValue(e,"pageIndex",this.pageIndex),re.BpmnModelJsonHelper.SetAttributeValue(e,"pageSize",this.pageSize),re.BpmnModelJsonHelper.SetAttributeValue(e,"entities",this.entities),e},Na.prototype.LoadFromJsonObject=function(e){Va.prototype.LoadFromJsonObject.call(this,e),this.totalCount=re.BpmnModelJsonHelper.GetAttributeValueAsNumber(e,"totalCount"),this.pageCount=re.BpmnModelJsonHelper.GetAttributeValueAsNumber(e,"pageCount"),this.pageIndex=re.BpmnModelJsonHelper.GetAttributeValueAsNumber(e,"pageIndex"),this.pageSize=re.BpmnModelJsonHelper.GetAttributeValueAsNumber(e,"pageSize"),this.entities=re.BpmnModelJsonHelper.GetAttributeValueAsList(e,"entities",Da)},Na);function Na(){var e=null!==Va&&Va.apply(this,arguments)||this;return e.entities=new Array,e}var Ba=(Ra.prototype.openBifManagerApp=function(e){var t=new Map;t.set("id",e.id),t.set("type",e.bifMetadataType),t.set("srcFuncId",Ca.bifDiagnostorFuncId);var r={funcId:Ca.bifManagerFuncId,appId:Ca.bifMonitorAppId,appEntrance:Ca.bifManagerAppEntrance,appType:"menu",entityParams:{},queryStringParams:t,tabId:e.id,tabName:e.name};this.frameworkService.openMenu(r)},Ra.prototype.getDatagridData=function(e){var t=e.ConvertToJson();return null!=e.bizType?this.httpService.post(this.baseUrl+"/getpatch",t).pipe(F.map(function(e){var t=new La;return t.entities=e.map(function(e){var t=new Fa;return t.LoadFromJsonObject(e),t}),t})):this.httpService.post(this.baseUrl+"/getpagedpatch",t).pipe(F.map(function(e){var t=new La;return t.LoadFromJsonObject(e),t}))},Ra.decorators=[{type:ne.Injectable}],Ra.ctorParameters=function(){return[{type:V.AppService},{type:V.FrameworkService},{type:O.HttpService}]},Ra);function Ra(e,t,r){this.appService=e,this.frameworkService=t,this.httpService=r,this.baseUrl="/api/runtime/aif/v1.0/rtbillprocess"}var za,Ha=(ce(ja,za=re.JsonConvertableImpl),ja.prototype.ResetBeforeLoadFrom=function(){za.prototype.ResetBeforeLoadFrom.call(this),this.name=null,this.upBillVoId=null,this.downBillVoId=null,this.isEnabled=null,this.billProcessType=null,this.sysInit=null,this.bizType=null,this.orderByCode=null,this.orderByName=null,this.OrderByLastModifiedTime=null,this.pageSize=0,this.pageIndex=0},ja.prototype.ConvertToJsonObject=function(){var e=za.prototype.ConvertToJsonObject.call(this);return re.BpmnModelJsonHelper.SetAttributeValue(e,"name",this.name),re.BpmnModelJsonHelper.SetAttributeValue(e,"upBillVoId",this.upBillVoId),re.BpmnModelJsonHelper.SetAttributeValue(e,"downBillVoId",this.downBillVoId),re.BpmnModelJsonHelper.SetAttributeValue(e,"isEnabled",this.isEnabled),re.BpmnModelJsonHelper.SetAttributeValue(e,"billProcessType",this.billProcessType),re.BpmnModelJsonHelper.SetAttributeValue(e,"sysInit",this.sysInit),re.BpmnModelJsonHelper.SetAttributeValue(e,"bizType",this.bizType),re.BpmnModelJsonHelper.SetAttributeValue(e,"orderByCode",this.orderByCode),re.BpmnModelJsonHelper.SetAttributeValue(e,"orderByName",this.orderByName),re.BpmnModelJsonHelper.SetAttributeValue(e,"OrderByLastModifiedTime",this.OrderByLastModifiedTime),re.BpmnModelJsonHelper.SetAttributeValue(e,"pageSize",this.pageSize),re.BpmnModelJsonHelper.SetAttributeValue(e,"pageIndex",this.pageIndex),e},ja.prototype.LoadFromJsonObject=function(e){za.prototype.LoadFromJsonObject.call(this,e),this.name=re.BpmnModelJsonHelper.GetAttributeValueAsJsonSerializable(e,"name",re.TextValue),this.upBillVoId=re.BpmnModelJsonHelper.GetAttributeValueAsJsonSerializable(e,"upBillVoId",re.TextValue),this.downBillVoId=re.BpmnModelJsonHelper.GetAttributeValueAsJsonSerializable(e,"downBillVoId",re.TextValue),this.isEnabled=re.BpmnModelJsonHelper.GetAttributeValueAsJsonSerializable(e,"isEnabled",re.TextValue),this.billProcessType=re.BpmnModelJsonHelper.GetAttributeValueAsJsonSerializable(e,"billProcessType",re.TextValue),this.sysInit=re.BpmnModelJsonHelper.GetAttributeValueAsJsonSerializable(e,"sysInit",re.TextValue),this.bizType=re.BpmnModelJsonHelper.GetAttributeValueAsJsonSerializable(e,"bizType",re.TextValue),this.orderByCode=re.BpmnModelJsonHelper.GetAttributeValueAsJsonSerializable(e,"orderByCode",re.TextValue),this.orderByName=re.BpmnModelJsonHelper.GetAttributeValueAsJsonSerializable(e,"orderByName",re.TextValue),this.OrderByLastModifiedTime=re.BpmnModelJsonHelper.GetAttributeValueAsJsonSerializable(e,"OrderByLastModifiedTime",re.TextValue),this.pageSize=re.BpmnModelJsonHelper.GetAttributeValueAsNumber(e,"pageSize"),this.pageIndex=re.BpmnModelJsonHelper.GetAttributeValueAsNumber(e,"pageIndex")},ja);function ja(){return null!==za&&za.apply(this,arguments)||this}var Ua="Asc",qa="Desc",Ga=new ne.InjectionToken("BIF_LANG_RESOURCES"),Ka=(Ja.prototype.transform=function(e){return this.lang[e]||e},Ja.prototype.instant=function(e){return this.transform(e)},Ja.decorators=[{type:ne.Pipe,args:[{name:"aifLocale"}]}],Ja.ctorParameters=function(){return[{type:String,decorators:[{type:ne.Inject,args:[ne.LOCALE_ID]}]},{type:undefined,decorators:[{type:ne.Inject,args:[Ga]}]}]},Ja);function Ja(e,t){this.defaultLang="zh-CHS",this.langCode=e||this.defaultLang,this.resources=t||{},this.lang=t[this.langCode]||t[this.defaultLang]||{}}var _a=(Object.defineProperty(Wa.prototype,"value",{set:function(e){e&&(this.processCode=e)},enumerable:!0,configurable:!0}),Wa.prototype.ngOnInit=function(){var t=this;this.configTtColumns(),this.editorParams&&this.editorParams.bizTypeId&&(this.queryParam.filterArgs.bizType=new re.TextValue,this.queryParam.filterArgs.bizType.value=this.editorParams.bizTypeId,this.queryParam.filterArgs.bizType.hasValue=!0),this.loadItems(this.queryParam.filterArgs).subscribe(function(){setTimeout(function(){if(t.ttData&&0<t.ttData.length){var e=null!=t.processCode?t.ttData.find(function(e){return e.code==t.processCode}):t.ttData[0];e&&t.tt.selectRow(e.id)}},300)})},Wa.prototype.clickOk=function(e){if(null!=this.tt.selectedRow){this.procEmitter.emit(this.tt.selectedRow.data);var t={value:this.tt.selectedRow.data.code,parameters:null};this.submitModal.emit(t),this.modalRef&&this.modalRef.close()}else this.notify.warning(this.localePipe.transform("pleaseSelectOneItemOnly"))},Wa.prototype.clickCancel=function(e){this.procEmitter.complete(),this.closeModal.emit(),this.modalRef&&this.modalRef.close()},Wa.prototype.onSearch=function(e){var t=this;this.queryParam=e,console.log(this.queryParam),this.loadItems(this.queryParam.filterArgs).subscribe(function(){t.tt.clearCheckeds(),t.tt.clearSelections()})},Wa.prototype.clickNameCell=function(e){this.procHelpService.openBifManagerApp(e.rowData)},Wa.prototype.columnSorted=function(e){console.log(e)},Wa.prototype.onPageSizeChanged=function(e){var t=this;console.log("PageSize Changed:",e);var r=this.tt.checkeds.map(function(e){return e.data.id});this.queryParam.filterArgs.pageSize=e.pageSize,this.loadItems(this.queryParam.filterArgs).subscribe(function(){setTimeout(function(){t.tt.checkRows(r)},0)})},Wa.prototype.onPageChanged=function(e){var t=this;console.log("PageNumber Changed:",e);var r=this.tt.checkeds.map(function(e){return e.data.id});this.queryParam.filterArgs.pageIndex=e.pageIndex-1,this.queryParam.filterArgs.pageSize=e.pageSize,this.loadItems(this.queryParam.filterArgs).subscribe(function(){setTimeout(function(){t.tt.checkRows(r)},0)})},Wa.prototype.pageChangeHandler=function(e){console.log(e)},Wa.prototype.pageSizeChangeHandler=function(e){console.log(e)},Wa.prototype.loadItems=function(e){var t=this,r=this.loading.show({message:this.localePipe.transform("loading")});return this.procHelpService.getDatagridData(e).pipe(F.switchMap(function(e){return t.ttData=fe(e.entities),t.tt.setPageIndex(e.pageIndex+1),t.tt.total=e.totalCount,t.tt.pageSize=e.pageSize,r.close(),T.of(e)}),F.catchError(function(e){throw r.close(),setTimeout(function(){t.messager.error(null==e.error?e.message:e.error.Message||e.error.message||e.message)},300),e}))},Wa.prototype.configTtColumns=function(){this.ttColumns=[{field:"code",title:this.localePipe.transform("code"),width:120,sortable:!0},{field:"name",title:this.localePipe.transform("name"),width:250,sortable:!0,template:this.nameCellTemp},{field:"upBillVoName",title:this.localePipe.transform("upBill"),width:120,sortable:!0},{field:"downBillVoName",title:this.localePipe.transform("downBill"),width:120,sortable:!0}]},Wa.prototype.createDefaultQueryParam=function(){var e={filterArgs:new Ha,filterArgsExt:{}};return e.filterArgs.pageSize=this.defaultPageSize,e.filterArgs.pageIndex=0,e.filterArgs.OrderByLastModifiedTime=new re.TextValue,e.filterArgs.OrderByLastModifiedTime.value=qa,e.filterArgs.OrderByLastModifiedTime.hasValue=!0,e.filterArgs.billProcessType=new re.TextValue,e.filterArgs.billProcessType.value=ka.BifCreationProcess,e.filterArgs.billProcessType.hasValue=!0,e.filterArgs.isEnabled=new re.TextValue,e.filterArgs.isEnabled.value="true",e.filterArgs.isEnabled.hasValue=!0,e},Wa.decorators=[{type:ne.Component,args:[{selector:"app-process-list-help",template:'<div class="f-page f-page-is-managelist" id="bif-manager-list">\r\n  \x3c!-- <app-proc-help-query-solution id="query-solution" #querySolution [(queryParam)]="queryParam"\r\n    (onSearch)="onSearch($event)">\r\n  </app-proc-help-query-solution> --\x3e\r\n\r\n  <div class="f-page-main" id="page-main">\r\n    <div class="f-utils-fill-flex-column">\r\n      <farris-datagrid id="tt" #tt [data]="ttData" [columns]="ttColumns" [idField]="ttIdField" [multiSelect]="true"\r\n        [showCheckbox]="false" [showAllCheckbox]="false" [onlySelectSelf]="true" [keepSelect]="true"\r\n        [selectOnCheck]="true" [checkOnSelect]="false" [showHeader]="true" [fit]="true" [fitColumns]="true"\r\n        [pagination]="true" [showPageList]="true" [pageSize]="defaultPageSize" [pageList]="pageList"\r\n        (pageChanged)="onPageChanged($event)" (pageSizeChanged)="onPageSizeChanged($event)" [remoteSort]="true"\r\n        [multiSort]="false" [beforeSortColumn]="beforeSortColumn" (columnSorted)="columnSorted($event)">\r\n      </farris-datagrid>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<ng-template #nameCellTemp let-ctx>\r\n  <a href="javascript: void(0);" (click)="clickNameCell(ctx)">{{ctx?.rowData?.name}}</a>\r\n</ng-template>\r\n\r\n<ng-template #iconSelectFooter>\r\n  <button type="button" class="btn btn-primary btn-sm px-3 mx-2" (click)="clickOk()">确定</button>\r\n  <button type="button" class="btn btn-secondary btn-sm px-3 mx-2" (click)="clickCancel()">取消</button>\r\n</ng-template>\r\n',styles:[""]}]}],Wa.ctorParameters=function(){return[{type:Ba},{type:Y.MessagerService},{type:Q.NotifyService},{type:te.BsModalService},{type:V.FrameworkService},{type:s.Router},{type:s.ActivatedRoute},{type:Z.LoadingService},{type:String,decorators:[{type:ne.Inject,args:[ne.LOCALE_ID]}]},{type:Ka}]},Wa.propDecorators={closeModal:[{type:ne.Output}],submitModal:[{type:ne.Output}],value:[{type:ne.Input}],editorParams:[{type:ne.Input}],tt:[{type:ne.ViewChild,args:["tt"]}],nameCellTemp:[{type:ne.ViewChild,args:["nameCellTemp"]}],modalFooter:[{type:ne.ViewChild,args:["iconSelectFooter"]}]},Wa);function Wa(e,t,r,i,n,a,o,s,l,c){var d=this;this.procHelpService=e,this.messager=t,this.notify=r,this.modalService=i,this.frameworkService=n,this.router=a,this.activatedRoute=o,this.loading=s,this.localePipe=c,this.closeModal=new ne.EventEmitter,this.submitModal=new ne.EventEmitter,this.editorParams={},this.modalConfig={title:"生单流程选择",width:1250,height:500,showButtons:!0},this.procEmitter=new ne.EventEmitter,this.ttIdField="id",this.ttData=[],this.ttColumns=[],this.cascadeCheck=!1,this.cascadeDown=!1,this.cascadeUp=!1,this.defaultPageSize=30,this.pageList=[this.defaultPageSize,50,100,200,500],this.beforeSortColumn=function(e,t){var r=e.split(","),i=t.split(",");d.queryParam.filterArgs.orderByCode=null,d.queryParam.filterArgs.orderByName=null,d.queryParam.filterArgs.OrderByLastModifiedTime=null;for(var n=0;n<r.length;n++){var a=null;"asc"==i[n]?((a=new re.TextValue).hasValue=!0,a.value=Ua):"desc"==i[n]&&((a=new re.TextValue).hasValue=!0,a.value=qa),"code"==r[n]?d.queryParam.filterArgs.orderByCode=a:"name"==r[n]?d.queryParam.filterArgs.orderByName=a:"lastModifiedTime"==r[n]&&(d.queryParam.filterArgs.OrderByLastModifiedTime=a)}return d.loadItems(d.queryParam.filterArgs)},this.queryParam=this.createDefaultQueryParam()}var $a=(Object.defineProperty(Xa.prototype,"value",{set:function(e){e&&(this.callActivitySubProcess=e,null==this.callActivitySubProcess.calledElement||""==this.callActivitySubProcess.calledElement?null==this.callActivitySubProcess.calledBizDefKey||""==this.callActivitySubProcess.calledBizDefKey?this.callActivitySubProcess.subProcessType=xa.Specified:this.callActivitySubProcess.subProcessType=xa.Dynamic:this.callActivitySubProcess.subProcessType=xa.Specified,!0===this.callActivitySubProcess.inheritBizDataId?this.callActivitySubProcess.billSourceType=ba.InheritParent:!1===this.callActivitySubProcess.inheritBizDataId&&!1===this.callActivitySubProcess.useAutoCreationData?this.callActivitySubProcess.billSourceType=ba.VariablesExpression:!1===this.callActivitySubProcess.inheritBizDataId&&!0===this.callActivitySubProcess.useAutoCreationData&&(this.callActivitySubProcess.billSourceType=ba.AutoCreation),this.getProcessDefKey(this.callActivitySubProcess.calledElement),this.getFlowForm(this.callActivitySubProcess.calledBizDefKey),this.getAifProcessName(this.callActivitySubProcess.aifProcessCode))},enumerable:!0,configurable:!0}),Xa.prototype.ngOnInit=function(){},Xa.prototype.clickOK=function(){if(this.validator()){var e={value:this.callActivitySubProcess,parameters:null};this.submitModal.emit(e)}},Xa.prototype.clickCancel=function(){this.closeModal.emit()},Xa.prototype.processConfirm=function(e){e&&(this.callActivitySubProcess.calledElement=e.id,this.callActivitySubProcess.calledElementName=e.name)},Xa.prototype.processTypeChange=function(e){console.log(e),e==xa.Specified?(this.callActivitySubProcess.calledBizDefKey=null,this.callActivitySubProcess.calledBizDefName=null):e==xa.Dynamic&&(this.callActivitySubProcess.calledElement=null,this.callActivitySubProcess.calledElementName=null)},Xa.prototype.billSourceChange=function(e){console.log(e),e==ba.InheritParent?(this.callActivitySubProcess.inheritBizDataId=!0,this.callActivitySubProcess.useAutoCreationData=!1):e==ba.AutoCreation?(this.callActivitySubProcess.inheritBizDataId=!1,this.callActivitySubProcess.useAutoCreationData=!0):e==ba.VariablesExpression&&(this.callActivitySubProcess.inheritBizDataId=!1,this.callActivitySubProcess.useAutoCreationData=!1)},Xa.prototype.selectProcess=function(){var t=this;this.openProcHelp().subscribe(function(e){null!=e?(t.callActivitySubProcess.aifProcessCode=e.code,t.callActivitySubProcess.aifProcessName=e.name):t.notify.warning("请选中一条生单流程")})},Xa.prototype.clearProcess=function(){this.callActivitySubProcess.aifProcessCode=null,this.callActivitySubProcess.aifProcessName=null},Xa.prototype.openProcHelp=function(){var t=this.cfr.resolveComponentFactory(_a).create(this.inj,[]);t.instance.editorParams=this.editorParams;var r=this.modalService.show(t,{title:"生单流程",width:1250,height:500,resizable:!0,buttons:[{text:"确定",cls:"btn btn-primary",handle:function(e){t.instance.clickOk(e),r.close()}},{text:"取消",cls:"btn btn-secondary",handle:function(e){t.instance.clickCancel(e),r.close()}}],closed:function(){r.dialog.destroy()}});return t.instance.modalRef=r,t.instance.procEmitter.asObservable()},Xa.prototype.clearProcessDef=function(e){this.callActivitySubProcess.calledElement="",this.callActivitySubProcess.calledElementName=""},Xa.prototype.flowFormConfirm=function(e){e&&(this.callActivitySubProcess.calledBizDefKey=e.id,this.callActivitySubProcess.calledBizDefName=e.name)},Xa.prototype.clearFlowForm=function(e){this.callActivitySubProcess.calledBizDefKey="",this.callActivitySubProcess.calledBizDefName=""},Xa.prototype.setBizDataId=function(){this.showExprHelp()},Xa.prototype.showExprHelp=function(){var e,t,r,i,n,a,o,s,l,c,d,p,u=this;if(0<this.designerState.schemas.length){try{for(var f=pe(this.designerState.schemas),h=f.next();!h.done;h=f.next()){var m=h.value;this.expr.addSchema("Schema",m)}}catch(O){e={error:O}}finally{try{h&&!h.done&&(t=f["return"])&&t.call(f)}finally{if(e)throw e.error}}if(this.designerState.schemas[0].entityTypes&&0<this.designerState.schemas[0].entityTypes.length){var v=this.designerState.schemas[0].entityTypes[0];this.expr.addInjectedEntity(v.name,"Schema",v.name,J.InjectedType.EntityType)}}var y=new Array;if(0<this.designerState.procInstContext.length)try{for(var g=pe(this.designerState.procInstContext),b=g.next();!b.done;b=g.next()){var x=b.value;y.push(x)}}catch(V){r={error:V}}finally{try{b&&!b.done&&(i=g["return"])&&i.call(g)}finally{if(r)throw r.error}}if(0<this.designerState.formalParameterContext.length){var w=function(t){y.some(function(e){return e.key===t.key})||y.push(t)};try{for(var C=pe(this.designerState.formalParameterContext),I=C.next();!I.done;I=C.next())w(x=I.value)}catch(L){n={error:L}}finally{try{I&&!I.done&&(a=C["return"])&&a.call(C)}finally{if(n)throw n.error}}}if(0<this.designerState.participantContext.length){var S=function(t){y.some(function(e){return e.key===t.key})||y.push(t)};try{for(var k=pe(this.designerState.participantContext),E=k.next();!E.done;E=k.next())S(x=E.value)}catch(N){o={error:N}}finally{try{E&&!E.done&&(s=k["return"])&&s.call(k)}finally{if(o)throw o.error}}}if(0<this.designerState.processVariableContext.length){var P=function(t){y.some(function(e){return e.key===t.key})||y.push(t)};try{for(var T=pe(this.designerState.processVariableContext),F=T.next();!F.done;F=T.next())P(x=F.value)}catch(B){l={error:B}}finally{try{F&&!F.done&&(c=T["return"])&&c.call(T)}finally{if(l)throw l.error}}}if(0<y.length)try{for(var A=pe(y),M=A.next();!M.done;M=A.next()){var D=M.value;this.expr.addContext(D)}}catch(R){d={error:R}}finally{try{M&&!M.done&&(p=A["return"])&&p.call(A)}finally{if(d)throw d.error}}this.expr.addExpressionText(this.callActivitySubProcess.bizDataId),this.expr.buildExpression().then(function(e){u.callActivitySubProcess.bizDataId=e})},Xa.prototype.valueChange=function(e){e&&(this.callActivitySubProcess.bizDataId=null)},Xa.prototype.validator=function(){return!!(this.callActivitySubProcess.inheritBizDataId||this.callActivitySubProcess.useAutoCreationData||this.callActivitySubProcess.bizDataId)||(this.message.warning("当子流程与父流程单据不一致时，请设置子流程单据内码！"),!1)},Xa.prototype.getProcessDefKey=function(e){var t=this,r=this.util.getProcDefKeyWebApi();e&&(r+="/"+e,this.http.get(r).subscribe(function(e){t.callActivitySubProcess.calledElementName=e.name}))},Xa.prototype.getFlowForm=function(e){var t=this,r=this.util.getFlowFormWebApi();e&&(r+="/"+e,this.http.get(r).subscribe(function(e){t.callActivitySubProcess.calledBizDefName=e.name}))},Xa.prototype.getAifProcessName=function(e){var t=this;null!=e&&""!=e&&this.http.request("GET","/api/runtime/aif/v1.0/rtbillcreationprocess/getname/"+e,{responseType:"text"}).subscribe(function(e){t.callActivitySubProcess.aifProcessName=e},function(e){throw setTimeout(function(){t.message.error(null==e.error?e.message:e.error.Message||e.error.message||e.message)},300),e})},Xa.decorators=[{type:ne.Component,args:[{selector:"lib-call-activity-sub-process2",template:'<div class="f-page">\r\n  <div class="f-utils-fill-flex-column farris-split-section m-2 h-100">\r\n    <section>\r\n      <div class="f-section-header pt-2 mx-2">\r\n        <div class="f-title">\r\n          <h4 class="f-title-text">选择子流程</h4>\r\n        </div>\r\n      </div>\r\n      <div class="f-utils-fill-flex-column h-100">\r\n        <div class="h-100">\r\n          <div class="farris-form form-inline farris-form-inline">\r\n            <div class="farris-group-wrap mt-1">\r\n              <div class="form-group farris-form-group">\r\n                <label class="col-form-label">\r\n                  <span class="farris-label-text">子流程类型</span>\r\n                </label>\r\n                <div class="farris-input-wrap ml-1">\r\n                  \x3c!-- <farris-combo-list #comboProcessType\r\n                    [(ngModel)]="callActivitySubProcess&&callActivitySubProcess.subProcessType"\r\n                    [idField]="comboProcessTypeIdField" [valueField]="comboProcessTypeValueField"\r\n                    [textField]="comboProcessTypeTextField" [data]="comboProcessTypeData"\r\n                    (valueChange)="processTypeChange($event)" [enableClear]="false" [editable]="false">\r\n                  </farris-combo-list> --\x3e\r\n                  <farris-radiogroup #radioGroupProcessType\r\n                    [(ngModel)]="callActivitySubProcess&&callActivitySubProcess.subProcessType" [horizontal]="false"\r\n                    [data]="radioGroupProcessTypeData" (changeValue)="processTypeChange($event)">\r\n                  </farris-radiogroup>\r\n                  <div class="farris-feedback valid-feedback"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <div class="farris-group-wrap mt-1" *ngIf="callActivitySubProcess.subProcessType==subProcessType.Dynamic">\r\n              <div class="form-group farris-form-group">\r\n                <label class="col-form-label">\r\n                  <span class="farris-label-text">流程分类</span>\r\n                </label>\r\n                <div class="farris-input-wrap ml-1">\r\n                  <wf-bizprocess-lookup [title]="\'流程分类\'" [sourceType]="\'flowform\'"\r\n                    [displayTxt]="callActivitySubProcess.calledBizDefName" (afterConfirm)="flowFormConfirm($event)"\r\n                    (clear)="clearFlowForm($event)">\r\n                  </wf-bizprocess-lookup>\r\n                  <div class="farris-feedback valid-feedback"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <div class="farris-group-wrap mt-1" *ngIf="callActivitySubProcess.subProcessType==subProcessType.Specified">\r\n              <div class="form-group farris-form-group">\r\n                <label class="col-form-label">\r\n                  <span class="farris-label-text">流程定义</span>\r\n                </label>\r\n                <div class="farris-input-wrap ml-1">\r\n                  <wf-bizprocess-lookup [title]="\'流程定义\'" [displayTxt]="callActivitySubProcess.calledElementName"\r\n                    (afterConfirm)="processConfirm($event)" (clear)="clearProcessDef($event)">\r\n                  </wf-bizprocess-lookup>\r\n                  <div class="farris-feedback valid-feedback"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </section>\r\n    <section class="">\r\n      <div class="f-section-header pt-2 mx-2">\r\n        <div class="f-title">\r\n          <h4 class="f-title-text">单据来源</h4>\r\n        </div>\r\n      </div>\r\n      <div class="f-utils-fill-flex-column h-100">\r\n        <div class="h-100">\r\n          <div class="farris-form form-inline farris-form-inline">\r\n\r\n            <div class="farris-group-wrap mt-1">\r\n              <div class="form-group farris-form-group">\r\n                <label class="col-form-label">\r\n                  <span class="farris-label-text">单据来源</span>\r\n                </label>\r\n                <div class="farris-input-wrap ml-1">\r\n                  <farris-radiogroup #radioGroupBillSource\r\n                    [(ngModel)]="callActivitySubProcess&&callActivitySubProcess.billSourceType" [horizontal]="false"\r\n                    [data]="radioGroupBillSourceData" (changeValue)="billSourceChange($event)">\r\n                  </farris-radiogroup>\r\n                  \x3c!-- <farris-combo-list #comboBillSource\r\n                    [(ngModel)]="callActivitySubProcess&&callActivitySubProcess.billSourceType"\r\n                    [idField]="comboBillSourceIdField" [valueField]="comboBillSourceValueField"\r\n                    [textField]="comboBillSourceTextField" [data]="comboBillSourceData"\r\n                    (valueChange)="billSourceChange($event)" [enableClear]="false" [editable]="false">\r\n                  </farris-combo-list> --\x3e\r\n                </div>\r\n                <div class="farris-feedback valid-feedback"></div>\r\n              </div>\r\n            </div>\r\n\r\n            <div class="farris-group-wrap mt-1"\r\n              *ngIf="callActivitySubProcess.billSourceType==billSourceType.AutoCreation">\r\n              <div class="form-group farris-form-group">\r\n                <label class="col-form-label">\r\n                  <span class="farris-label-text">生单流程</span>\r\n                </label>\r\n                <div class="farris-input-wrap ml-1">\r\n                  <input-group [ngModel]="callActivitySubProcess&&callActivitySubProcess.aifProcessName"\r\n                    [editable]="false" (clickHandle)="selectProcess()" [groupText]="groupIcon" (clear)="clearProcess()">\r\n                  </input-group>\r\n                  <div class="farris-feedback valid-feedback"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <div class="farris-group-wrap mt-1"\r\n              *ngIf="callActivitySubProcess.billSourceType==billSourceType.VariablesExpression">\r\n              <div class="form-group farris-form-group">\r\n                <label class="col-form-label">\r\n                  <span class="farris-label-text">单据内码</span>\r\n                </label>\r\n                <div class="farris-input-wrap ml-1">\r\n                  <input-group [ngModel]="callActivitySubProcess.bizDataId" [enableClear]="false"\r\n                    [ngModel]="callActivitySubProcess.bizDataId" name="bizDataId" [editable]="false"\r\n                    (clickHandle)="setBizDataId()" [groupText]="groupIcon">\r\n                  </input-group>\r\n                  <div class="farris-feedback valid-feedback"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </section>\r\n  </div>\r\n</div>\r\n\r\n<ng-template #iconSelectFooter>\r\n  <button type="button" class="btn btn-primary btn-sm mx-2" (click)="clickOK()">确定</button>\r\n  <button type="button" class="btn btn-secondary btn-sm mx-2" (click)="clickCancel()">取消</button>\r\n</ng-template>'}]}],Xa.ctorParameters=function(){return[{type:Q.NotifyService},{type:te.BsModalService},{type:Y.MessagerService},{type:vt},{type:O.HttpService},{type:me},{type:J.ExpressionService},{type:ne.ComponentFactoryResolver},{type:ne.Injector}]},Xa.propDecorators={cls:[{type:ne.HostBinding,args:["class"]}],editorParams:[{type:ne.Input}],value:[{type:ne.Input}],closeModal:[{type:ne.Output}],submitModal:[{type:ne.Output}],modalFooter:[{type:ne.ViewChild,args:["iconSelectFooter"]}],radioGroupProcessType:[{type:ne.ViewChild,args:["radioGroupProcessType"]}],radioGroupBillSource:[{type:ne.ViewChild,args:["radioGroupBillSource"]}]},Xa);function Xa(e,t,r,i,n,a,o,s,l){this.notify=e,this.modalService=t,this.message=r,this.util=i,this.http=n,this.designerState=a,this.expr=o,this.cfr=s,this.inj=l,this.cls="farris-main-area flex-column",this.editorParams={},this.closeModal=new ne.EventEmitter,this.submitModal=new ne.EventEmitter,this.modalConfig={title:"子流程设置",width:480,height:400,showButtons:!0},this.callActivitySubProcess=new wa,this.groupIcon='<i class="f-icon f-icon-lookup"></i>',this.subProcessType=xa,this.billSourceType=ba,this.radioGroupProcessTypeData=[{value:"Specified",name:"指定子流程"},{value:"Dynamic",name:"动态子流程"}],this.radioGroupBillSourceData=[{value:ba.InheritParent,name:"与父流程相同"},{value:ba.AutoCreation,name:"自动生成下游单据"},{value:ba.VariablesExpression,name:"变量表达式"}]}var Za=(Ya.prototype.convertTo=function(e){return e&&(e.calledBizDefKey||e.calledElement)?"（已设置）":"（未设置）"},Ya);function Ya(){}var Qa=(eo.prototype.setProperty=function(e){this.uiState.propertyData=e.propertyData,this.uiState.propertyConfig=this.setConfig(e.propertyConfig)},eo.prototype.setConfig=function(e){var t=this,r=[];return e&&e.forEach(function(e){t.setEntity(e.properties),r.push(e)}),r},eo.prototype.setEntity=function(e){var t=this;e&&0<e.length&&e.forEach(function(e){switch(e.propertyID){case it:e.editor=$a,e.converter=new Za,e.editorParams={bizTypeId:t.uiState.flowFormInfo.flowForm.businessObjectId};break;case We:e.editor=Gi,e.converter=new Ji,e.editorParams={nodeType:"CallActivitySubProcess"};break;case ut:e.editor=ea,e.converter=new ra}})},eo.decorators=[{type:ne.Injectable}],eo.ctorParameters=function(){return[{type:me}]},eo);function eo(e){this.uiState=e}var to=(ro.prototype.setProperty=function(e){this.uiState.propertyData=e.propertyData,this.uiState.propertyConfig=this.setConfig(e.propertyConfig)},ro.prototype.setConfig=function(e){var t=this,r=[];return e&&e.forEach(function(e){t.setEntity(e.properties),r.push(e)}),r},ro.prototype.setEntity=function(e){e&&0<e.length&&e.forEach(function(e){switch(e.propertyID){case $e:e.editor=Ut,e.converter=new Gt,e.editorParams={location:"autoActivity"};break;case ut:e.editor=ea,e.converter=new ra}})},ro.decorators=[{type:ne.Injectable}],ro.ctorParameters=function(){return[{type:me}]},ro);function ro(e){this.uiState=e}var io=function Hs(){this.triggerAction="Pass",this.Async=!1},no=(Object.defineProperty(ao.prototype,"value",{set:function(e){var t,r;if(e&&0<e.length)try{for(var i=pe(e),n=i.next();!n.done;n=i.next()){var a=n.value,o=new io;o.Id=a.Id,o.name=a.name,o.triggerAction=a.triggerAction,o.Async=a.Async,o.SignalRef=a.SignalRef,this.data.push(o)}}catch(s){t={error:s}}finally{try{n&&!n.done&&(r=i["return"])&&r.call(i)}finally{if(t)throw t.error}}},enumerable:!0,configurable:!0}),ao.prototype.ngOnInit=function(){this.columns=[{field:"SignalRef",width:100,title:"信号编号",editor:{type:U.EditorTypes.TEXTBOX,options:{}},validators:[{type:"required",messager:"必填"}]},{field:"name",width:100,title:"信号名称",editor:{type:U.EditorTypes.TEXTBOX,options:{}},validators:[{type:"required",messager:"必填"}]},{field:"triggerAction",width:100,title:"流转方向",formatter:{type:"enum",options:{valueField:"value",textField:"text",data:this.triggerActionCollection}},editor:{type:U.EditorTypes.COMBOLIST,options:{valueField:"value",textField:"text",data:this.triggerActionCollection,idField:"value",panelHeight:"auto",showClear:!1}},validators:[{type:"required",messager:"必填"}]}]},ao.prototype.add=function(){var e=new io;e.Id=vt.GenerateElementId(),this.data.push(e),this.grid.loadData(this.data)},ao.prototype["delete"]=function(){var t=this;if(this.grid.endCellEdit(),this.grid.selectedRow&&this.grid.selectedRow.data){var e=this.data.findIndex(function(e){return e.Id===t.grid.selectedRow.data.Id});this.data.splice(e,1),this.grid.loadData(this.data)}else this.message.info("尚未选中一条触发事件！")},ao.prototype.clickOK=function(){if(this.grid.endCellEdit(),this.validator()){var e={value:this.data,parameters:null};this.submitModal.emit(e)}},ao.prototype.clickCancel=function(){this.closeModal.emit()},ao.prototype.validator=function(){var e,t;if(0===this.data.length)return this.message.info("至少需要一个信号定义，请了解！"),!1;try{for(var r=pe(this.data),i=r.next();!i.done;i=r.next()){var n=i.value;if(!n.SignalRef)return this.message.info("信号编号不允许为空！"),!1;if(!n.name)return this.message.info("信号名称不允许为空！"),!1}}catch(l){e={error:l}}finally{try{i&&!i.done&&(t=r["return"])&&t.call(r)}finally{if(e)throw e.error}}if(1<this.data.length)for(var a=0;a<this.data.length;a++)for(var o=this.data[a].SignalRef,s=a+1;s<this.data.length;s++)if(o===this.data[s].SignalRef)return this.message.warning("信号编号不允许重复！"),!1;return!0},ao.decorators=[{type:ne.Component,args:[{selector:"lib-event-definition",template:'<div class="f-page">\r\n  <div class="f-page-header">\r\n    <nav class="f-page-header-base">\r\n      <div class="f-title">\r\n        <span class="f-title-icon f-text-orna-bill">\r\n          <i class="f-icon f-icon-page-title-administer"></i>\r\n        </span>\r\n        <h4 class="f-title-text">列表</h4>\r\n      </div>\r\n      <div class="btn-toolbar btn-group-lg">\r\n        <button class="btn btn-primary mr-2" (click)="add()">新增</button>\r\n        <button class="btn btn-secondary" (click)="delete()">删除</button>\r\n      </div>\r\n    </nav>\r\n  </div>\r\n  <div class="f-page-main f-utils-fill-flex-column h-100">\r\n    <div class="f-utils-fill-flex-column farris-overflow-y-auto h-100">\r\n      <farris-datagrid #grid [data]="data" [columns]="columns" [idField]="\'Id\'" [fit]="true" [fitColumns]="true"\r\n        [editable]="true" [editMode]="\'cell\'" [pagination]="false" [showCheckbox]="false" [multiSelect]="false">\r\n      </farris-datagrid>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<ng-template #iconSelectFooter>\r\n  <button type="button" class="btn btn-primary btn-sm px-3 mx-2" (click)="clickOK()">确定</button>\r\n  <button type="button" class="btn btn-secondary btn-sm px-3 mx-2" (click)="clickCancel()">取消</button>\r\n</ng-template>\r\n',styles:[""]}]}],ao.ctorParameters=function(){return[{type:Y.MessagerService},{type:vt},{type:ne.Injector}]},ao.propDecorators={cls:[{type:ne.HostBinding,args:["class"]}],closeModal:[{type:ne.Output}],submitModal:[{type:ne.Output}],value:[{type:ne.Input}],modalFooter:[{type:ne.ViewChild,args:["iconSelectFooter"]}],grid:[{type:ne.ViewChild,args:["grid"]}]},ao);function ao(e,t,r){this.message=e,this.util=t,this.injector=r,this.cls="farris-main-area flex-column",this.closeModal=new ne.EventEmitter,this.submitModal=new ne.EventEmitter,this.modalConfig={title:"信号定义",width:560,height:420,showButtons:!0},this.triggerActionCollection=[{text:"正向",value:"Pass"},{text:"反向",value:"Back"},{text:"终止",value:"Abort"}],this.columns=new Array,this.data=new Array}var oo=(so.prototype.convertTo=function(e){return e&&0<e.length?"（已设置）":"（未设置）"},so);function so(){}var lo=(co.prototype.setProperty=function(e){this.uiState.propertyData=e.propertyData,this.uiState.propertyConfig=this.setConfig(e.propertyConfig)},co.prototype.setConfig=function(e){var t=this,r=[];return e&&e.forEach(function(e){t.setEntity(e.properties),r.push(e)}),r},co.prototype.setEntity=function(e){e&&0<e.length&&e.forEach(function(e){switch(e.propertyID){case We:e.editor=Gi,e.converter=new Ji,e.editorParams={nodeType:"CallActivitySubProcess"};break;case tt:e.editor=no,e.converter=new oo;break;case ut:e.editor=ea,e.converter=new ra}})},co.decorators=[{type:ne.Injectable}],co.ctorParameters=function(){return[{type:me},{type:ne.Injector}]},co);function co(e,t){this.uiState=e,this.injector=t}var po=(uo.prototype.setProperty=function(e){this.uiState.propertyData=e.propertyData,this.uiState.propertyConfig=this.setConfig(e.propertyConfig)},uo.prototype.setConfig=function(e){var t=this,r=[];return e&&e.forEach(function(e){t.setEntity(e.properties),r.push(e)}),r},uo.prototype.setEntity=function(e){e&&0<e.length&&e.forEach(function(e){switch(e.propertyID){case ft:e.editor=ai,e.converter=new si,e.editorParams={location:"messageActivity"};break;case ut:e.editor=ea,e.converter=new ra}})},uo.decorators=[{type:ne.Injectable}],uo.ctorParameters=function(){return[{type:me}]},uo);function uo(e){this.uiState=e}function fo(){}var ho=function js(){},mo="WF_ProcessDef_SaveDT",vo="WF_ProcessDef_SaveRT",yo="WF_ProcessDef_Deploy",go="WF_ProcessDef_SyncDT",bo=function Us(){},xo=(wo.prototype.setProperty=function(e){this.uiState.propertyData=e.propertyData,this.uiState.propertyConfig=this.setConfig(e.propertyConfig)},wo.prototype.setConfig=function(e){var t=this,r=[];return e&&e.forEach(function(e){t.setEntity(e.properties),r.push(e)}),r},wo.prototype.setEntity=function(e){e&&0<e.length&&e.forEach(function(e){switch(e.propertyID){case Ve:e.editor=Hn,e.converter=new Un;break;case at:e.editor=cr,e.converter=new pr,e.editorParams={location:"notifyActivity",tab:"web"};break;case ot:e.editor=cr,e.converter=new pr,e.editorParams={location:"notifyActivity",tab:"mobile"};break;case ft:e.editor=ai,e.converter=new si,e.editorParams={location:"activity"};break;default:e.editor=ci,e.converter=new pi}})},wo.decorators=[{type:ne.Injectable}],wo.ctorParameters=function(){return[{type:me}]},wo);function wo(e){this.uiState=e}var Co=(Io.prototype.convertTo=function(e){return e?e.name||e.code||"（已设置）":"（未设置）"},Io);function Io(){}var So=(ko.prototype.setProperty=function(e){this.uiState.propertyData=e.propertyData,this.uiState.propertyConfig=this.setConfig(e.propertyConfig)},ko.prototype.setConfig=function(e){var t=this,r=[];return e&&e.forEach(function(e){t.setEntity(e.properties),r.push(e)}),r},ko.prototype.setEntity=function(e){var t=this;e&&0<e.length&&e.forEach(function(e){switch(e.propertyID){case mt:e.editor=_a,e.converter=new Co,e.editorParams={bizTypeId:t.uiState.flowFormInfo.flowForm.businessObjectId}}})},ko.decorators=[{type:ne.Injectable}],ko.ctorParameters=function(){return[{type:me}]},ko);function ko(e){this.uiState=e}var Eo=(Po.prototype.initProcessProperty=function(e){var t=e.propertyData;t.EntryForm&&(t.EntryForm=this.uiState.flowFormInfo.flowForm),this.uiState.propertyConfig=this.process.setProcessConfig(e.propertyConfig),this.uiState.propertyData=t},Po.prototype.setProperty=function(e){switch(e.propertyData.ClrTypeID){case xt:this.process.setProcessProperty(e);break;case wt:this.activity.setUserActivityProperty(e);break;case It:this.subProcess.setProperty(e);break;case St:this.autoActAdapter.setProperty(e);break;case kt:this.catchEventAdapter.setProperty(e);break;case Ct:this.activity.setUserActivityProperty(e);break;case Et:this.messageActAdapter.setProperty(e);break;case Pt:this.notifyActAdapter.setProperty(e);break;case Tt:this.creationActAdapter.setProperty(e);break;default:this.activity.setFlowElementProperty(e)}},Po.prototype.updateSchemas=function(){var t=this;if(this.uiState.schemas=[],this.uiState.flowFormInfo.formalParameters&&0<this.uiState.flowFormInfo.formalParameters.length){var e=this.uiState.flowFormInfo.formalParameters.filter(function(e){return"CDTSchema"===e.dataType&&e.schemaMetadataId});n.forkJoin(e.map(function(e){return t.service.getBusinessEntitybyId(e.schemaMetadataId)})).subscribe(function(e){e&&0<e.length&&e.forEach(function(e){t.uiState.schemas.push(e)})},function(e){t.uiState.schemas=[]})}else this.uiState.schemas=[]},Po.prototype.getFlowFormInfoById=function(e){var r=this,i=new T.Subject;return e&&n.forkJoin(this.service.GetFlowFormbyId(e),this.service.getParametersbyFlowFormKey(e).pipe(F.map(function(e){return r.setFormParamCxt(e),e})),this.service.getComponentsbyFlowformkey(e),this.service.getExecuteFormbyFlowFormKey(e),this.service.getBizActivities(e),this.service.getCustomizeActions(e)).subscribe(function(e){var t=new he;t.flowForm=e[0],t.formalParameters=e[1],t.bizComponents=e[2].filter(function(e){return"Activity"!==e.ownerType}),t.excuteForms=e[3],t.bizActivities=e[4],t.customizeActions=e[5],r.uiState.flowFormInfo=t,r.updateSchemas(),i.next(t)}),i.asObservable()},Po.prototype.getFormFormatsByBizCategory=function(){if(this.uiState.flowFormInfo.flowForm.businessObjectId){var e="/api/runtime/wf/v1.0/formFormat/query?param=",t='{"bizCategory":"'+this.uiState.flowFormInfo.flowForm.businessObjectId+'"}';return e+=t=encodeURIComponent(t),this.http.get(e)}return T.from(new Array)},Po.prototype.saveProcess=function(e,t,r){return this.service.saveProcess(e,t,r)},Po.prototype.deployProcess=function(e){return this.service.deployProcess(e)},Po.prototype.auditProcessDef=function(e,t,r){var i=new ho;i.auditId=e,i.success=t,i.processDefKey=r,this.service.auditProcessDef(i)},Po.prototype.saveRTProcess=function(e,t){return this.service.saveRTProcess(e,t)},Po.prototype.saveAsProcess=function(r,e){var i=this,t=this.resolver.resolveComponentFactory(ya).create(this.injector);t.instance.procKey=r.DefaultProcess.Key,t.instance.procName=r.DefaultProcess.Name+"_副本",t.instance.isAdministratorConfig=this.uiState.isAdministratorConfig,t.instance.organizations=this.uiState.organizations,t.instance.accessLevel=e.accessLevel,t.instance.organization=e.procOrg.orgId,t.instance.organizationName=e.procOrg.orgName;var n={title:"另存为",width:450,height:400,buttons:t.instance.btnRef,showButtons:!0},a=this.modalService.show(t,n);t.instance.submit.subscribe(function(e){r.DefaultProcess.Name=e.procName;var t=new bo;t.accessLevel=e.accessLevel,t.procOrg={orgId:e.organization,orgName:e.organizationName},i.saveProcess(JSON.stringify(r),t,1).subscribe(function(e){i.notify.success({title:"系统提示",msg:"另存为成功",timeout:3e3})},function(e){i.notify.error({title:"系统提示",msg:"另存为失败，请检查流程是否正确！",timeout:3e3})}),a.close()}),t.instance.cancel.subscribe(function(e){a.close()})},Po.prototype.syncDtProcess=function(e,t){var r=this;if(e){var i=JSON.parse(e);this.message.question("是否将当前版本流程定义同步到设计时流程定义包！",function(){r.service.syncDtProcess(e,t).subscribe(function(e){r.notify.success({title:"系统提示",msg:"同步成功",timeout:3e3}),r.auditProcessDef(go,!0,i.DefaultProcess.Key)},function(e){r.notify.error({title:"系统提示",msg:"同步失败，请联系管理员查看原因！",timeout:3e3}),r.auditProcessDef(go,!1,i.DefaultProcess.Key)})})}},Po.prototype.beforeCompleteStrategyChange=function(e,t){var r=this,i="/api/runtime/wf/v1.0/processInstances/runtimeActivityInstances?procDefId="+t.rtProcDefId+"&activityDefinitionId="+e.Id;return this.http.get(i).pipe(F.switchMap(function(e){return e&&0<e.length?(r.message.info("当前节点存在运行中的活动实例，不允许调整完成策略，请了解！"),T.of(!1)):T.of(!0)}))},Po.prototype.getProcessCategory=function(e){return this.service.GetFlowFormbyId(e)},Po.prototype.setFormParamCxt=function(e){var r=this;this.uiState.formalParameterContext=[],e&&0<e.length&&e.forEach(function(e){if("CDTSchema"===e.dataType){var t=[{key:"schemaId_"+e.code,name:"schemaId_"+e.name,description:"schemaId_"+e.name},{key:"metadataId_"+e.code,name:"metadataId_"+e.name,description:"metadataId_"+e.name}];r.uiState.formalParameterContext=r.uiState.formalParameterContext.concat(t)}})},Po.decorators=[{type:ne.Injectable}],Po.ctorParameters=function(){return[{type:me},{type:gt},{type:vt},{type:Q.NotifyService},{type:Y.MessagerService},{type:fi},{type:ma},{type:Qa},{type:to},{type:lo},{type:po},{type:xo},{type:So},{type:te.BsModalService},{type:ne.Injector},{type:ne.ComponentFactoryResolver},{type:O.HttpService}]},Po);function Po(e,t,r,i,n,a,o,s,l,c,d,p,u,f,h,m,v){this.uiState=e,this.service=t,this.util=r,this.notify=i,this.message=n,this.process=a,this.activity=o,this.subProcess=s,this.autoActAdapter=l,this.catchEventAdapter=c,this.messageActAdapter=d,this.notifyActAdapter=p,this.creationActAdapter=u,this.modalService=f,this.injector=h,this.resolver=m,this.http=v}var To=(Fo.prototype.ngOnInit=function(){},Fo.prototype.clickOK=function(){this.submit.next(this.record)},Fo.prototype.clickCancel=function(){this.cancel.next()},Fo.decorators=[{type:ne.Component,args:[{selector:"lib-note",template:'<div class="f-page">\r\n  <div class="f-page-main f-utils-fill-flex-column h-100">\r\n    <div class="f-utils-fill-flex-column farris-overflow-y-auto h-100">\r\n      <textarea class="form-control content-textarea" style="height: 100%;" [(ngModel)]="record" [placeholder]="placeholder"></textarea>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<ng-template #footer>\r\n  <button type="button" class="btn btn-primary btn-sm mx-2" (click)="clickOK()">确定</button>\r\n  <button type="button" class="btn btn-secondary btn-sm" (click)="clickCancel()">取消</button>\r\n</ng-template>\r\n',styles:[""]}]}],Fo.ctorParameters=function(){return[]},Fo.propDecorators={footer:[{type:ne.ViewChild,args:["footer"]}]},Fo);function Fo(){this.submit=new T.Subject,this.cancel=new T.Subject,this.placeholder="请输入流程变更记录"}var Ao=(Object.defineProperty(Mo.prototype,"time",{get:function(){return this._time},set:function(e){this._time=e},enumerable:!0,configurable:!0}),Mo.prototype.ngOnInit=function(){this.getSrc(),this.uiState.initUIState(),this.showLoading(),this.updateProperty(),this.uiState.getMessageChannels()},Mo.prototype.getSrc=function(){var e,t=this;e=this._time===se.rt?this.rtProcessInfo.flowFormId:this.processInfo.flowFormId,this.viewModel.getProcessCategory(e).subscribe(function(e){t.src="/platform/runtime/wf/web/designer/index.html",t._time===se.rt?t.src=t.src+"?time=rt":(t.src=t.src+"?time=dt",e&&(t.src=t.src+"&bizCategoryId="+e.businessObjectId)),"view"===t.action?t.src=t.src+"&action=view":t.src=t.src+"&action=edit","general"===t.mode?t.src=t.src+"&mode=general":t.src=t.src+"&mode=simplify",t.src=t.sanitizer.bypassSecurityTrustResourceUrl(t.src)})},Mo.prototype.addMessageListener=function(){window.addEventListener("message",this.eventHandler,!1),Mo.func=this.eventHandler},Mo.prototype.updateProperty=function(){var t=this;return this.propertyPanel.propertyChanged.subscribe(function(e){t.updateChangeProperty(e)}),this.propertyPanel.submitModal.subscribe(function(e){t.updateChangeProperty(e.changeObject)}),!1},Mo.prototype.updateChangeProperty=function(t){var r=this;switch(t.Id=this.uiState.propertyData.Id,t.propertyID){case De:this.bindEntryFormInfo(t);break;case Le:this.sendMessage(be,JSON.stringify(t)),this.activity.buildCounterSignVariables(t.propertyValue);break;case Re:this.beforeCompleteStrategyChange(t).subscribe(function(e){e?(r.sendMessage(be,JSON.stringify(t)),r.completeStrategyChanged(t.propertyValue)):r.sendMessage(xe,JSON.stringify(t))});break;case ze:default:this.sendMessage(be,JSON.stringify(t))}},Mo.prototype.bindEntryFormInfo=function(r){var i=this,e=r.propertyValue.id;e&&this.viewModel.getFlowFormInfoById(e).subscribe(function(e){r.flowForm=e.flowForm,r.formalParameters=e.formalParameters,r.processBizComponnets=e.bizComponents,r.executeForms=[],e.excuteForms.forEach(function(e){if(e.isDefault){var t=i.ConvertExecuteForm(e);r.executeForms=r.executeForms.concat(t)}}),r.customizeActions=e.customizeActions.filter(function(e){return!0===e.isAll}).map(function(e){return{id:e.id,code:e.code,name:e.name,terminalType:e.terminal,actualParameters:e.actualParameters.map(function(e){return{Name:e.code,Value:e.value,ValueText:e.name,Tag:"expression"}})}}),i.sendMessage(we,e.bizActivities||[]),i.sendMessage(be,JSON.stringify(r))})},Mo.prototype.note=function(e){var t=this,r=this.resolver.resolveComponentFactory(To).create(this.injector);r.instance.record=e;var i={title:"流程变更记录",width:800,height:520,showButtons:!0,buttons:r.instance.footer},n=this.modalService.show(r,i);r.instance.cancel.subscribe(function(e){return n.close()}),r.instance.submit.subscribe(function(e){t.sendMessage(Ee,e),n.close()})},Mo.prototype.openProcContent=function(){var t=this;if(this.time===se.dt){if(!this.processInfo)throw new Error("不存在设计时流程信息！请先赋值！");this.processInfo.processKey===ye&&this.processInfo.flowFormId?this.openNewProcess(this.processInfo.flowFormId):this.viewModel.getFlowFormInfoById(this.processInfo.flowFormId).subscribe(function(e){t.sendMessage(we,e.bizActivities||[]),t.getProcContent(t.processInfo.processKey).subscribe(function(e){t.uiState.content=t.checkModelContent(JSON.stringify(e)),t.sendMessage(ge,{content:t.uiState.content})})})}else if(this.time===se.rt){if(!this.rtProcessInfo)throw new Error("不存在运行时流程信息！请先赋值！");this.viewModel.getFlowFormInfoById(this.rtProcessInfo.flowFormId).subscribe(function(e){t.sendMessage(we,e.bizActivities||[]),t.getProcContent(t.rtProcessInfo.rtProcDefId).subscribe(function(e){t.uiState.content=t.checkModelContent(JSON.stringify(e)),t.sendMessage(ge,{content:t.uiState.content})})})}},Mo.prototype.openNewProcess=function(o){var s=this;this.viewModel.getFlowFormInfoById(o).subscribe(function(r){var i=r.bizComponents,n=r.customizeActions.filter(function(e){return!0===e.isAll}).map(function(e){return{id:e.id,code:e.code,name:e.name,terminalType:e.terminal,actualParameters:e.actualParameters.map(function(e){return{Name:e.code,Value:e.value,ValueText:e.name,Tag:"expression"}})}}),a=[];r.excuteForms.forEach(function(e){if(e.isDefault){var t=s.ConvertExecuteForm(e);a=a.concat(t)}}),0===a.length||-1===a.findIndex(function(e){return e.TerminalType===er})||-1===a.findIndex(function(e){return e.TerminalType===tr})?s.viewModel.getFormFormatsByBizCategory().subscribe(function(e){var t;e&&0<e.length&&(-1===a.findIndex(function(e){return e.TerminalType===er})&&(t=e.filter(function(e){return"PC"===e.terminal&&0===e.status})[0])&&a.push(s.formFormat2ExecuteForm(t)),-1===a.findIndex(function(e){return e.TerminalType===tr})&&(t=e.filter(function(e){return"Mobile"===e.terminal&&0===e.status})[0])&&a.push(s.formFormat2ExecuteForm(t)));s.sendMessage(we,r.bizActivities||[]),s.sendMessage(ye,{name:s.processInfo.processName,bizObjId:s.processInfo.bizObjId,ffId:o,ffName:s.processInfo.flowFormName,startMode:s.processInfo.startMode,formalParameters:r.formalParameters,processBizComponnets:i,executeForms:a,customizeActions:n,processDescription:r.flowForm.processDescription})}):(s.sendMessage(we,r.bizActivities||[]),s.sendMessage(ye,{name:s.processInfo.processName,bizObjId:s.processInfo.bizObjId,ffId:o,ffName:s.processInfo.flowFormName,startMode:s.processInfo.startMode,formalParameters:r.formalParameters,processBizComponnets:i,executeForms:a,customizeActions:n,processDescription:r.flowForm.processDescription}))})},Mo.prototype.sendMessage=function(e,t){var r=this.iframe.nativeElement.contentWindow,i=this.wrapMessage(e,t);r.postMessage(i,this.uiState.POST_MESSAGE_TARGET)},Mo.prototype.wrapMessage=function(e,t){return{action:e,data:t}},Mo.prototype.showTip=function(e){if("message"===e.type)switch(e.level){case"warning":this.message.warning(e.message);break;case"error":this.message.error(e.message);break;default:this.message.info(e.message)}else if("notify"===e.type)switch(e.level){case"warning":this.notify.warning(e.message);break;case"error":this.notify.error(e.message);break;default:this.notify.info(e.message)}},Mo.prototype.getProcContent=function(e){if(e){if(this.time===se.dt)return this.service.getProcContentbyKey(e);if(this.time===se.rt)return this.service.getRTProcContentbyId(e);throw new Error("设计器运行时机错误！")}},Mo.prototype.save=function(){var t=this,r=JSON.parse(this.uiState.content);this.saveHttp().subscribe(function(e){t.closeLoading(),t.notify.success({title:"系统提示",msg:"保存成功",timeout:3e3}),t.time===se.dt?t.viewModel.auditProcessDef(mo,!0,r.DefaultProcess.Key):t.time===se.rt&&t.viewModel.auditProcessDef(vo,!0,r.DefaultProcess.Key)},function(e){t.closeLoading(),t.notify.error({title:"系统提示",msg:"保存失败，请检查流程是否正确！",timeout:3e3}),t.time===se.dt?t.viewModel.auditProcessDef(mo,!1,r.DefaultProcess.Key):t.time===se.rt&&t.viewModel.auditProcessDef(vo,!1,r.DefaultProcess.Key)})},Mo.prototype.saveHttp=function(){if(this.uiState.content){if(this.time===se.dt)return this.viewModel.saveProcess(this.uiState.content,this.processInfo,1);if(this.time===se.rt)return this.viewModel.saveRTProcess(this.uiState.content,this.rtProcessInfo.rtProcDefId);throw new Error("设计器运行时机错误！")}},Mo.prototype.showLoading=function(){this.loadService.show({container:"body",message:"",type:1})},Mo.prototype.closeLoading=function(){this.loadService.close()},Mo.prototype.ConvertExecuteForm=function(e){var t=new Array;if("web,app"===e.terminal){var r=new Yt;r.ComponentId=e.appId,r.formFormatId=e.formFormatId,r.FormType=e.formType,r.Name=e.name,r.TerminalType=er,e.actualParameters&&0<e.actualParameters.length&&(r.ActualParameters=e.actualParameters.map(function(e){return{Name:e.code,Value:e.value}})),t.push(r);var i=new Yt;i.ComponentId=e.appId,i.formFormatId=e.formFormatId,i.FormType=e.formType,i.Name=e.name,i.TerminalType=tr,e.actualParameters&&0<e.actualParameters.length&&(i.ActualParameters=e.actualParameters.map(function(e){return{Name:e.code,Value:e.value}})),t.push(i)}else{var n=new Yt;switch(n.ComponentId=e.appId,n.formFormatId=e.formFormatId,n.FormType=e.formType,n.Name=e.name,e.terminal){case"web":n.TerminalType=er;break;case"app":n.TerminalType=tr}e.actualParameters&&0<e.actualParameters.length&&(n.ActualParameters=e.actualParameters.map(function(e){return{Name:e.code,Value:e.value}})),t.push(n)}return t},Mo.prototype.formFormat2ExecuteForm=function(e){var t=new Yt;switch(t.Id=vt.GenerateElementId(),t.ComponentId=null,t.formFormatId=e.id,t.FormType="0",t.Name=e.name,e.terminal){case"PC":t.TerminalType=er;break;case"Mobile":t.TerminalType=tr}return e.urlParameters&&0<e.urlParameters.length&&(t.ActualParameters=e.urlParameters.map(function(e){return{Name:e.code,Value:e.value}})),t},Mo.prototype.completeStrategyChanged=function(e){var t=this;if(e!==this.uiState.completeIterator[0].key){if(!this.uiState.propertyData.SignRule){var r=this.resolver.resolveComponentFactory(Ti).create(this.injector);r.instance.value=[];var i=Object.assign(r.instance.modalConfig,{buttons:r.instance.modalFooter}),n=this.modalService.show(r,i);r.instance.closeModal.subscribe(function(e){return n.close()}),r.instance.submitModal.subscribe(function(e){t.updateChangeProperty({categoryId:"performerProperty",propertyID:ze,propertyValue:e.value}),n.close()})}!0===this.uiState.propertyData.BackWardRule.SelectTargetAble&&setTimeout(function(){t.message.warning("会签策略下,“驳回规则”不允许“动态选择驳回级次”，请修改！")},500)}},Mo.prototype.beforeCompleteStrategyChange=function(e){return this.time===se.rt?this.viewModel.beforeCompleteStrategyChange(e,this.rtProcessInfo):T.of(!0)},Mo.prototype.checkModelContent=function(e){var t=JSON.parse(e),r=t.DefaultProcess.extensionElements.find(function(e){return"wf.ProcessHeader"===e.ClrTypeID}).BizDefKey;return this.time===se.dt?r===this.processInfo.flowFormId?e:(t.DefaultProcess.extensionElements.find(function(e){return"wf.ProcessHeader"===e.ClrTypeID}).BizDefKey=this.processInfo.flowFormId,t.DefaultProcess.extensionElements.find(function(e){return"wf.ProcessHeader"===e.ClrTypeID}).BizDefName=this.uiState.flowFormInfo.flowForm.name,JSON.stringify(t)):this.time===se.rt?r===this.rtProcessInfo.flowFormId?e:(t.DefaultProcess.extensionElements.find(function(e){return"wf.ProcessHeader"===e.ClrTypeID}).BizDefKey=this.rtProcessInfo.flowFormId,t.DefaultProcess.extensionElements.find(function(e){return"wf.ProcessHeader"===e.ClrTypeID}).BizDefName=this.uiState.flowFormInfo.flowForm.name,JSON.stringify(t)):void 0},Mo.func=null,Mo.decorators=[{type:ne.Component,args:[{selector:"wf-process-editor",template:'\n  <div class="f-utils-flex-column h-100 m-2">\n    <div class="flex-auto d-flex flex-fill flex-row" style="position:relative; overflow: hidden">\n      <div class="flex-grow-1">\n        <div *ngIf="src" class="h-100">\n          <iframe #iframe class="bpmn-designer" [src]="src" frameborder="0">\n          </iframe>\n        </div>\n      </div>\n      <div>\n        <app-property-panel #propertyPanel [(propertyConfig)]="uiState.propertyConfig" [(propertyData)]="uiState.propertyData"\n          width="235" showCloseBtn="false"></app-property-panel>\n      </div>\n    </div>\n  </div>',styles:["\n    .bpmn-designer {\n      height: 100%;\n      min-height: 400px;\n      width: 100%;\n    }"]}]}],Mo.ctorParameters=function(){return[{type:t.DomSanitizer},{type:me},{type:Eo},{type:gt},{type:Z.LoadingService},{type:Q.NotifyService},{type:Y.MessagerService},{type:ma},{type:ne.Injector},{type:te.BsModalService},{type:ne.ComponentFactoryResolver}]},Mo.propDecorators={cls:[{type:ne.HostBinding,args:["class"]}],time:[{type:ne.Input}],processInfo:[{type:ne.Input}],rtProcessInfo:[{type:ne.Input}],action:[{type:ne.Input}],mode:[{type:ne.Input}],close:[{type:ne.Output}],propertyPanel:[{type:ne.ViewChild,args:["propertyPanel"]}],iframe:[{type:ne.ViewChild,args:["iframe"]}]},Mo);function Mo(e,t,r,i,n,a,o,s,l,c,d){var p=this;this.sanitizer=e,this.uiState=t,this.viewModel=r,this.service=i,this.loadService=n,this.notify=a,this.message=o,this.activity=s,this.injector=l,this.modalService=c,this.resolver=d,this.flag=!0,this.cls="farris-main-area flex-column",this.action="edit",this.mode="general",this.close=new ne.EventEmitter,this.eventHandler=function(e){var t=e.data;if(-1<p.uiState.POST_MESSAGE_TARGET.search(e.origin))switch(t.action){case Ce:p.flag&&(p.flag=!1,p.closeLoading()),p.viewModel.initProcessProperty(t.data);break;case Ie:p.uiState.content=t.data,p.showLoading(),p.save();break;case Pe:p.uiState.content=t.data,p.showLoading(),p.viewModel.deployProcess(p.uiState.content).subscribe(function(e){p.closeLoading(),p.viewModel.saveProcess(p.uiState.content,p.processInfo,0).subscribe(function(e){}),p.notify.success({title:"系统提示",msg:"发布成功",timeout:3e3});var t=JSON.parse(p.uiState.content);p.viewModel.auditProcessDef(yo,!0,t.DefaultProcess.Key)},function(e){p.closeLoading(),p.notify.error({title:"系统提示",msg:"发布失败，请检查流程是否正确！",timeout:3e3});var t=JSON.parse(p.uiState.content);p.viewModel.auditProcessDef(yo,!1,t.DefaultProcess.Key)});break;case Se:var r=t.data;p.viewModel.saveAsProcess(r,p.processInfo);break;case ke:var i=t.data;p.viewModel.syncDtProcess(i,p.rtProcessInfo);break;case Ee:p.note(t.data);break;case Te:p.close.emit();break;case Fe:p.uiState.getUserActList(t.data);break;case Ae:p.uiState.getEndEventList(t.data);break;case"loaded":p.openProcContent();break;case Me:p.showTip(t.data);break;default:p.viewModel.setProperty(t.data)}},Mo.func&&window.removeEventListener("message",Mo.func,!1),this.addMessageListener(),this.uiState.getAdministratorInfo()}var Do=(Oo.prototype.transform=function(e,t){return e.filter(function(e){return e.Id!==t})},Oo.decorators=[{type:ne.Pipe,args:[{name:"jumpScopePipe"}]}],Oo);function Oo(){}var Vo=(Lo.prototype.transform=function(e,t){void 0===t&&(t="");var r="";return e.forEach(function(e){r+=e.performerName+"，"}),r&&(r=r.substring(0,r.length-1)),r||t},Lo.decorators=[{type:ne.Pipe,args:[{name:"usersName"}]}],Lo.ctorParameters=function(){return[]},Lo);function Lo(){}var No=[me,Eo,fi,ma,Qa,to,lo,po,xo,So],Bo=[gt],Ro=[],zo=(Object.defineProperty(Ho.prototype,"value",{set:function(e){e&&(this.callActivitySubProcess=e,this.getProcessDefKey(this.callActivitySubProcess.calledElement),this.getFlowForm(this.callActivitySubProcess.calledBizDefKey))},enumerable:!0,configurable:!0}),Ho.prototype.ngOnInit=function(){},Ho.prototype.clickOK=function(){if(this.validator()){var e={value:this.callActivitySubProcess,parameters:null};this.submitModal.emit(e)}},Ho.prototype.clickCancel=function(){this.closeModal.emit()},Ho.prototype.processConfirm=function(e){e&&(this.callActivitySubProcess.calledElement=e.id,this.callActivitySubProcess.calledElementName=e.name)},Ho.prototype.clearProcessDef=function(e){this.callActivitySubProcess.calledElement="",this.callActivitySubProcess.calledElementName=""},Ho.prototype.flowFormConfirm=function(e){e&&(this.callActivitySubProcess.calledBizDefKey=e.id,this.callActivitySubProcess.calledBizDefName=e.name)},Ho.prototype.clearFlowForm=function(e){this.callActivitySubProcess.calledBizDefKey="",this.callActivitySubProcess.calledBizDefName=""},Ho.prototype.setBizDataId=function(){this.showExprHelp()},Ho.prototype.showExprHelp=function(){var e,t,r,i,n,a,o,s,l,c,d,p,u=this;if(0<this.designerState.schemas.length){try{for(var f=pe(this.designerState.schemas),h=f.next();!h.done;h=f.next()){var m=h.value;this.expr.addSchema("Schema",m)}}catch(O){e={error:O}}finally{try{h&&!h.done&&(t=f["return"])&&t.call(f)}finally{if(e)throw e.error}}if(this.designerState.schemas[0].entityTypes&&0<this.designerState.schemas[0].entityTypes.length){var v=this.designerState.schemas[0].entityTypes[0];this.expr.addInjectedEntity(v.name,"Schema",v.name,J.InjectedType.EntityType)}}var y=new Array;if(0<this.designerState.procInstContext.length)try{for(var g=pe(this.designerState.procInstContext),b=g.next();!b.done;b=g.next()){var x=b.value;y.push(x)}}catch(V){r={error:V}}finally{try{b&&!b.done&&(i=g["return"])&&i.call(g)}finally{if(r)throw r.error}}if(0<this.designerState.formalParameterContext.length){var w=function(t){y.some(function(e){return e.key===t.key})||y.push(t)};try{for(var C=pe(this.designerState.formalParameterContext),I=C.next();!I.done;I=C.next())w(x=I.value)}catch(L){n={error:L}}finally{try{I&&!I.done&&(a=C["return"])&&a.call(C)}finally{if(n)throw n.error}}}if(0<this.designerState.participantContext.length){var S=function(t){y.some(function(e){return e.key===t.key})||y.push(t)};try{for(var k=pe(this.designerState.participantContext),E=k.next();!E.done;E=k.next())S(x=E.value)}catch(N){o={error:N}}finally{try{E&&!E.done&&(s=k["return"])&&s.call(k)}finally{if(o)throw o.error}}}if(0<this.designerState.processVariableContext.length){var P=function(t){y.some(function(e){return e.key===t.key})||y.push(t)};try{for(var T=pe(this.designerState.processVariableContext),F=T.next();!F.done;F=T.next())P(x=F.value)}catch(B){l={error:B}}finally{try{F&&!F.done&&(c=T["return"])&&c.call(T)}finally{if(l)throw l.error}}}if(0<y.length)try{for(var A=pe(y),M=A.next();!M.done;M=A.next()){var D=M.value;this.expr.addContext(D)}}catch(R){d={error:R}}finally{try{M&&!M.done&&(p=A["return"])&&p.call(A)}finally{if(d)throw d.error}}this.expr.addExpressionText(this.callActivitySubProcess.bizDataId),this.expr.buildExpression().then(function(e){u.callActivitySubProcess.bizDataId=e})},Ho.prototype.valueChange=function(e){e&&(this.callActivitySubProcess.bizDataId=null)},Ho.prototype.validator=function(){return!(!this.callActivitySubProcess.inheritBizDataId&&!this.callActivitySubProcess.bizDataId&&(this.message.warning("当子流程与父流程单据不一致时，请设置子流程单据内码！"),1))},Ho.prototype.getProcessDefKey=function(e){var t=this,r=this.util.getProcDefKeyWebApi();e&&(r+="/"+e,this.http.get(r).subscribe(function(e){t.callActivitySubProcess.calledElementName=e.name}))},Ho.prototype.getFlowForm=function(e){var t=this,r=this.util.getFlowFormWebApi();e&&(r+="/"+e,this.http.get(r).subscribe(function(e){t.callActivitySubProcess.calledBizDefName=e.name}))},Ho.decorators=[{type:ne.Component,args:[{selector:"lib-call-activity-sub-process",template:'<div class="f-page">\r\n  <div class="f-utils-fill-flex-column farris-split-section m-2 h-100">\r\n    <section class="f-utils-fill-flex-column h-100">\r\n      <div class="f-section-header pt-2 mx-2">\r\n        <div class="f-title">\r\n          <h4 class="f-title-text">设置选项</h4>\r\n        </div>\r\n      </div>\r\n      <div class="f-utils-fill-flex-column h-100">\r\n        <form class="h-100">\r\n          <div class="farris-form form-inline farris-form-inline">\r\n            <div class="farris-group-wrap mt-1">\r\n              <div class="form-group farris-form-group">\r\n                <label class="col-form-label">\r\n                  <span class="farris-label-text">流程分类</span>\r\n                </label>\r\n                <div class="farris-input-wrap ml-1">\r\n                  <wf-bizprocess-lookup [title]="\'流程分类\'" [sourceType]="\'flowform\'" [displayTxt]="callActivitySubProcess.calledBizDefName"\r\n                    (afterConfirm)="flowFormConfirm($event)" (clear)="clearFlowForm($event)">\r\n                  </wf-bizprocess-lookup>\r\n                  <div class="farris-feedback valid-feedback"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div class="farris-group-wrap my-4">\r\n              <div class="form-group farris-form-group">\r\n                <label class="col-form-label">\r\n                  <span class="farris-label-text">流程定义</span>\r\n                </label>\r\n                <div class="farris-input-wrap ml-1">\r\n                  <wf-bizprocess-lookup [title]="\'流程定义\'"  [displayTxt]="callActivitySubProcess.calledElementName"\r\n                    (afterConfirm)="processConfirm($event)" (clear)="clearProcessDef($event)">\r\n                  </wf-bizprocess-lookup>\r\n                  <div class="farris-feedback valid-feedback"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            \x3c!-- <div class="farris-group-wrap my-4">\r\n              <div class="form-group farris-form-group">\r\n                <label class="col-form-label">\r\n                  <span class="farris-label-info text-danger">*</span>\r\n                  <span class="farris-label-text">继承变量</span>\r\n                </label>\r\n                <div class="farris-input-wrap ml-1">\r\n                  <farris-switch [(ngModel)]="callActivitySubProcess.inheritVariables" name="inheritVariables">\r\n                  </farris-switch>\r\n                  <div class="farris-feedback valid-feedback"></div>\r\n                </div>\r\n              </div>\r\n            </div> --\x3e\r\n            <div class="farris-group-wrap my-4">\r\n              <div class="form-group farris-form-group">\r\n                <label class="ml-4 pl-3">\r\n                  <span class="farris-label-text">与父流程同一张业务单据</span>\r\n                </label>\r\n                <div class="farris-input-wrap ml-3">\r\n                  <farris-switch  [(ngModel)]="callActivitySubProcess.inheritBizDataId" name="inheritBizDataId"\r\n                    (valueChange)="valueChange($event)">\r\n                  </farris-switch>\r\n                  <div class="farris-feedback valid-feedback"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div *ngIf="!callActivitySubProcess.inheritBizDataId" class="farris-group-wrap">\r\n              <div class="form-group farris-form-group">\r\n                <label class="ml-4 pl-3">\r\n                  <span class="farris-label-text">设置单据内码</span>\r\n                </label>\r\n                <div class="farris-input-wrap ml-3">\r\n                  <input-group class="form-control" style="width: 100%;padding:0;border:0;" [enableClear]="false"\r\n                    [ngModel]="callActivitySubProcess.bizDataId" name="bizDataId"\r\n                    [editable]="false" (clickHandle)="setBizDataId()" [groupText]="groupIcon"></input-group>\r\n                  <div class="farris-feedback valid-feedback"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </section>\r\n  </div>\r\n</div>\r\n\r\n<ng-template #iconSelectFooter>\r\n  <button type="button" class="btn btn-primary btn-sm mx-2" (click)="clickOK()">确定</button>\r\n  <button type="button" class="btn btn-secondary btn-sm mx-2" (click)="clickCancel()">取消</button>\r\n</ng-template>\r\n',styles:[""]}]}],Ho.ctorParameters=function(){return[{type:Y.MessagerService},{type:vt},{type:O.HttpService},{type:me},{type:J.ExpressionService}]},Ho.propDecorators={cls:[{type:ne.HostBinding,args:["class"]}],value:[{type:ne.Input}],closeModal:[{type:ne.Output}],submitModal:[{type:ne.Output}],modalFooter:[{type:ne.ViewChild,args:["iconSelectFooter"]}]},Ho);function Ho(e,t,r,i,n){this.message=e,this.util=t,this.http=r,this.designerState=i,this.expr=n,this.cls="farris-main-area flex-column",this.closeModal=new ne.EventEmitter,this.submitModal=new ne.EventEmitter,this.modalConfig={title:"子流程选项",width:480,height:360,showButtons:!0},this.callActivitySubProcess=new wa,this.groupIcon='<i class="f-icon f-icon-lookup"></i>'}var jo=function qs(){},Uo=function Gs(){this.id=vt.createNM(),this.formMethodConfigs=new Array},qo=function Ks(){},Go=function Js(){},Ko=[{text:"正向",value:"Forward"},{text:"反向",value:"Backward"},{text:"终止",value:"Abort"}],Jo=[{text:"流转前",value:"Pre"},{text:"流转后",value:"Post"}],_o=function _s(){this.id=vt.createNM(),this.workFlowAction=Ko[0].value,this.executionTime=Jo[0].value,this.sortOrder=1},Wo=(Object.defineProperty($o.prototype,"formFormatId",{get:function(){return this._fromFormatId},set:function(e){this._fromFormatId=e,this._fromFormatId&&this.getFormMethods()},enumerable:!0,configurable:!0}),$o.prototype.ngOnInit=function(){var n=this;this.cols=[{field:"workFlowAction",width:80,title:"流转方向",formatter:{type:"enum",options:{valueField:"value",textField:"text",data:Ko}},editor:{type:U.EditorTypes.COMBOLIST,options:{valueField:"value",textField:"text",data:Ko,idField:"value",panelHeight:"auto",enableClear:!1}},validators:[{type:"required",messager:"必填"}]},{field:"method",width:100,title:"表单操作",editor:{type:"input-group",options:{groupText:'<i class="f-icon f-icon-lookup"></i>',editable:!1,clickHandle:function(e){e.formControl.setValue(e.instance.value?e.instance.value:""),n.e=e,n.methodsDialog.show(),n.state="edit"},clear:function(e){console.log("clear",e)}}},formatter:function(t,e,r){if(t){var i=n.formMethods.find(function(e){return e.method===t});return i?i.methodName:""}return""},validators:[{type:"required",messager:"必填"}]},{field:"executionTime",width:80,title:"执行时机",formatter:{type:"enum",options:{valueField:"value",textField:"text",data:Jo}},editor:{type:U.EditorTypes.COMBOLIST,options:{valueField:"value",textField:"text",data:Jo,idField:"value",panelHeight:"auto",enableClear:!1}},validators:[{type:"required",messager:"必填"}]},{field:"sortOrder",width:60,title:"执行顺序",editor:{type:U.EditorTypes.NUMBERBOX,options:{}},formatter:{type:"number",options:{precision:0}},validators:[{type:"required",messager:"必填"}]},{field:"methodParameters",width:80,title:"参数",template:this.cell,halign:"center",align:"center"}]},$o.prototype.add=function(){this.methodsDialog.show(),this.state="add"},$o.prototype["delete"]=function(){var t=this;this.grid.selectedRow?this.operations=this.operations.filter(function(e){return e.id!==t.grid.selectedRow.id}):this.message.info("尚未选中表单操作配置！")},$o.prototype.editParam=function(s){var l=this,e=this.resolver.resolveComponentFactory(sr).create(this.injector);e.instance.mode="usual",e.instance.showFormType=!1,s.rowData.methodParameters?e.instance.parameters=fe(s.rowData.methodParameters.map(function(e){return Object.assign({},e)})):e.instance.parameters=new Array;var t={title:"参数设置",width:620,height:400,showButtons:!0,buttons:e.instance.modalFooter},c=this.modalService.show(e,t);e.instance.submit.subscribe(function(e){var t,r;try{for(var i=pe(l.operations),n=i.next();!n.done;n=i.next()){var a=n.value;a.id===s.rowData.id&&(a.methodParameters=e.parameters)}}catch(o){t={error:o}}finally{try{n&&!n.done&&(r=i["return"])&&r.call(i)}finally{if(t)throw t.error}}c.close()}),e.instance.cancel.subscribe(function(e){c.close()})},$o.prototype.methodSelected=function(){var e,t;if(this.methodGrid.selectedRow){var r=this.methodGrid.selectedRow.data;if("edit"===this.state){if(this.e){this.e.formControl.setValue(r.method),this.e.instance.cd.detectChanges();try{for(var i=pe(this.operations),n=i.next();!n.done;n=i.next()){var a=n.value;a.id===r.id&&(a.method=r.method,a.sortOrder=r.sortOrder,a.methodParameters=r.methodParameters)}}catch(s){e={error:s}}finally{try{n&&!n.done&&(t=i["return"])&&t.call(i)}finally{if(e)throw e.error}}}}else{var o=new _o;o.formFormatConfigId=this.formFormatConfigId,o.method=r.method,o.sortOrder=r.sortOrder,o.methodParameters=r.methodParameters,this.operations=this.operations.concat([o])}this.methodsDialog.close()}else this.message.info("尚未选中表单操作！")},$o.prototype.validator=function(){var e,t;this.grid.endCellEdit();try{for(var r=pe(this.operations),i=r.next();!i.done;i=r.next())if(!i.value.method)return this.message.info("尚未选择表单操作！"),!1}catch(n){e={error:n}}finally{try{i&&!i.done&&(t=r["return"])&&t.call(r)}finally{if(e)throw e.error}}return!0},$o.prototype.getFormMethods=function(){var t=this;if(this.formFormatId){var e="/api/runtime/wf/v1.0/formOperation?formFormatId="+this.formFormatId;this.http.get(e).subscribe(function(e){e&&(t.formMethods=e)})}},$o.decorators=[{type:ne.Component,args:[{selector:"lib-form-operation-config",template:'<div class="f-utils-fill-flex-column h-100" style="background: #FFF;">\r\n  <farris-datagrid class="f-component-grid f-utils-fill" [columns]="cols" [data]="operations" #grid\r\n    [idField]="\'id\'" [showLineNumber]="true" [fitColumns]="true" [striped]="true" [showCheckbox]="false"\r\n    [virtualized]="true" [pagination]="false" [useThemes]="false" [fit]="true"\r\n    [editable]="true" [editMode]="\'cell\'" >\r\n  </farris-datagrid>\r\n  <ng-template #cell let-ctx>\r\n    <a href="javascript: void(0);" title="参数设置" (click)="editParam(ctx)">设置</a>\r\n  </ng-template>\r\n</div>\r\n\r\n<ng-template #buttonRef>\r\n  <button class="btn btn-sm btn-primary px-3" (click)="methodSelected()">确定</button>\r\n  <button class="btn btn-sm btn-default px-3" (click)="methodsDialog.close()">取消</button>\r\n</ng-template>\r\n<farris-dialog #methodsDialog [buttons]="buttonRef" [width]="700" [height]="500" [title]="\'表单事件\'">\r\n  <div class="f-page f-page-is-managelist">\r\n    <div class="f-page-main">\r\n      <div class="f-struct-wrapper f-utils-fill-flex-column">\r\n        <farris-section class="f-section-grid f-section-in-managelist p-0" [showHeader]="false">\r\n          <farris-datagrid class="f-component-grid" [columns]="methodCols" [data]="formMethods" #methodGrid [idField]="\'id\'"\r\n            [showLineNumber]="true" [striped]="true" [showCheckbox]="false" [virtualized]="true" [pagination]="false"\r\n            [fit]="true" [fitColumns]="true">\r\n          </farris-datagrid>\r\n        </farris-section>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</farris-dialog>\r\n\r\n',styles:[""]}]}],$o.ctorParameters=function(){return[{type:O.HttpService},{type:Y.MessagerService},{type:ne.ComponentFactoryResolver},{type:ne.Injector},{type:te.BsModalService}]},$o.propDecorators={formFormatId:[{type:ne.Input}],formFormatConfigId:[{type:ne.Input}],operations:[{type:ne.Input}],methodsDialog:[{type:ne.ViewChild,args:["methodsDialog"]}],grid:[{type:ne.ViewChild,args:["grid"]}],methodGrid:[{type:ne.ViewChild,args:["methodGrid"]}],cell:[{type:ne.ViewChild,args:["cell"]}]},$o);function $o(e,t,r,i,n){this.http=e,this.message=t,this.resolver=r,this.injector=i,this.modalService=n,this.operations=new Array,this.cols=new Array,this.methodCols=[{field:"method",width:100,title:"方法标识",showTips:!0},{field:"methodName",width:80,title:"方法名称",showTips:!0},{field:"description",width:120,title:"描述",showTips:!0}],this.formMethods=new Array,this.state="add"}var Xo=(Object.defineProperty(Zo.prototype,"formFormatId",{get:function(){return this._formFormatId},set:function(e){this._formFormatId=e,this.config.formFormatId=e},enumerable:!0,configurable:!0}),Object.defineProperty(Zo.prototype,"formatConfigId",{get:function(){return this._formatConfigId},set:function(e){(this._formatConfigId=e)||(this.state="new")},enumerable:!0,configurable:!0}),Zo.prototype.ngOnInit=function(){this.buttonCols=[{field:"buttonName",width:100,title:"按钮名称"},{title:"是否可用",field:"enable",width:80,template:this.btnEnable,align:"center",hAlign:"center"},{title:"是否禁用",field:"disabled",width:80,template:this.btnDisabled,align:"center",hAlign:"center"},{title:"是否隐藏",field:"hidden",width:80,template:this.btnHidden,align:"center",hAlign:"center"}],this.fieldCols=[{field:"fieldName",width:100,title:"字段名称"},{title:"是否可写",field:"editable",width:80,template:this.fieldEditable,align:"center",hAlign:"center"},{title:"是否只读",field:"readonly",width:80,template:this.fieldReadonly,align:"center",hAlign:"center"},{title:"是否隐藏",field:"hidden",width:80,template:this.fieldHidden,align:"center",hAlign:"center"},{title:"是否必填",field:"required",width:80,template:this.fieldRequired,align:"center",hAlign:"center"}],this.getConfig()},Zo.prototype.submit=function(){var t=this;return this.validator()?(this.setBtnAndFieldConfigs(),"new"===this.state&&0===this.config.formButtonConfigs.length&&0===this.config.formFieldConfigs.length&&0===this.operationConfig.operations.length?T.of({result:!0,configId:null}):this.saveConfig(this.config).pipe(F.switchMap(function(e){return T.of({result:!0,configId:t.config.id})}),F.catchError(function(e){return t.message.error("保存配置失败，请联系管理员查看原因！"),T.of({result:!1,configId:t.config.id})}))):T.of({result:!1,configId:null})},Zo.prototype.btnConfigChange=function(e,t,r){var i,n;if(e)try{for(var a=pe(this.buttonConfigs),o=a.next();!o.done;o=a.next()){var s=o.value;if(s.id===r)switch(t){case"enable":s.enable=e,s.disabled=!1,s.hidden=!1;break;case"disabled":s.disabled=e,s.enable=!1,s.hidden=!1;break;case"hidden":s.hidden=e,s.disabled=!1,s.enable=!1}}}catch(l){i={error:l}}finally{try{o&&!o.done&&(n=a["return"])&&n.call(a)}finally{if(i)throw i.error}}},Zo.prototype.btnBatchOperate=function(e){var t,r,i=this.btnGrid.checkedRows;if(i&&0<i.length)try{for(var n=pe(i),a=n.next();!a.done;a=n.next()){var o=a.value;this.btnConfigChange(!0,e,o.id)}}catch(s){t={error:s}}finally{try{a&&!a.done&&(r=n["return"])&&r.call(n)}finally{if(t)throw t.error}}},Zo.prototype.btnBatchReset=function(){var e,t,r=this.btnGrid.checkedRows;if(r&&0<r.length){var i=function(t){var e,r,i=l.formFormat.formButtons.find(function(e){return e.id===t.id});try{for(var n=pe(l.buttonConfigs),a=n.next();!a.done;a=n.next()){var o=a.value;o.id===t.id&&(o.enable="Enable"===i.buttonState,o.disabled="Disabled"===i.buttonState,o.hidden="Hidden"===i.buttonState)}}catch(s){e={error:s}}finally{try{a&&!a.done&&(r=n["return"])&&r.call(n)}finally{if(e)throw e.error}}},l=this;try{for(var n=pe(r),a=n.next();!a.done;a=n.next())i(a.value)}catch(o){e={error:o}}finally{try{a&&!a.done&&(t=n["return"])&&t.call(n)}finally{if(e)throw e.error}}}},Zo.prototype.fieldConfigChange=function(e,t,r){e&&this.fieldSwitchChange(this.fieldConfigs,t,r)},Zo.prototype.fieldSwitchChange=function(e,t,r){var i,n;if(0<e.length)try{for(var a=pe(e),o=a.next();!o.done;o=a.next()){var s=o.value;if(s.data.id===r){switch(t){case"editable":s.data.editable=!0,s.data.readonly=!1,s.data.hidden=!1,s.data.required=!1;break;case"readonly":s.data.editable=!1,s.data.readonly=!0,s.data.hidden=!1,s.data.required=!1;break;case"hidden":s.data.editable=!1,s.data.readonly=!1,s.data.hidden=!0,s.data.required=!1;break;case"required":s.data.editable=!1,s.data.readonly=!1,s.data.hidden=!1,s.data.required=!0}return}s.children&&0<s.children.length&&this.fieldSwitchChange(s.children,t,r)}}catch(l){i={error:l}}finally{try{o&&!o.done&&(n=a["return"])&&n.call(a)}finally{if(i)throw i.error}}},Zo.prototype.fieldBatchOperate=function(e){var t,r,i=this.fieldTree.checkeds;if(i&&0<i.length)try{for(var n=pe(i),a=n.next();!a.done;a=n.next()){var o=a.value;this.fieldConfigChange(!0,e,o.data.id)}}catch(s){t={error:s}}finally{try{a&&!a.done&&(r=n["return"])&&r.call(n)}finally{if(t)throw t.error}}},Zo.prototype.fieldBatchReset=function(){var e,t,r=this.fieldTree.checkeds;if(r&&0<r.length){var i=function(t){var e=n.formatFieldList.find(function(e){return e.id===t.data.id});n.resetFieldConfig(n.fieldConfigs,t.data.id,e)},n=this;try{for(var a=pe(r),o=a.next();!o.done;o=a.next())i(o.value)}catch(s){e={error:s}}finally{try{o&&!o.done&&(t=a["return"])&&t.call(a)}finally{if(e)throw e.error}}}},Zo.prototype.resetFieldConfig=function(e,t,r){var i,n;if(0<e.length)try{for(var a=pe(e),o=a.next();!o.done;o=a.next()){var s=o.value;if(!0===s.leaf&&s.data.id===t)return s.data.editable="Editable"===r.fieldState,s.data.readonly="Readonly"===r.fieldState,s.data.hidden="Hidden"===r.fieldState,void(s.data.required="Required"===r.fieldState);s.children&&0<s.children.length&&this.resetFieldConfig(s.children,t,r)}}catch(l){i={error:l}}finally{try{o&&!o.done&&(n=a["return"])&&n.call(a)}finally{if(i)throw i.error}}},Zo.prototype.validator=function(){return this.operationConfig.validator()},Zo.prototype.setBtnAndFieldConfigs=function(){var e,t;function r(t){var e=i.formFormat.formButtons.find(function(e){return e.buttonId===t.buttonId}),r=new qo;if(r.buttonId=t.buttonId,t.enable)r.buttonState="Enable";else if(t.disabled)r.buttonState="Disabled";else{if(!t.hidden)return"continue";r.buttonState="Hidden"}!e.buttonState&&r.buttonState&&i.config.formButtonConfigs.push(r),e.buttonState&&e.buttonState!==r.buttonState&&i.config.formButtonConfigs.push(r)}this.config.formButtonConfigs=new Array;var i=this;try{for(var n=pe(this.buttonConfigs),a=n.next();!a.done;a=n.next())r(a.value)}catch(o){e={error:o}}finally{try{a&&!a.done&&(t=n["return"])&&t.call(n)}finally{if(e)throw e.error}}this.config.formFieldConfigs=new Array,this.getFieldConfigs(this.fieldConfigs),this.config.formMethodConfigs=this.operationConfig.operations||new Array},Zo.prototype.getFieldConfigs=function(e){var t,r;if(e&&0<e.length){var i=function(t){if(t.children&&0<t.children.length&&n.getFieldConfigs(t.children),!1===t.leaf)return"continue";var e=n.formatFieldList.find(function(e){return e.fieldId===t.data.fieldId}),r=new Go;if(r.fieldId=t.data.fieldId,t.data.editable)r.fieldState="Editable";else if(t.data.readonly)r.fieldState="Readonly";else if(t.data.hidden)r.fieldState="Hidden";else{if(!t.data.required)return"continue";r.fieldState="Required"}!e.fieldState&&r.fieldState&&n.config.formFieldConfigs.push(r),e.fieldState&&e.fieldState!==r.fieldState&&n.config.formFieldConfigs.push(r)},n=this;try{for(var a=pe(e),o=a.next();!o.done;o=a.next())i(o.value)}catch(s){t={error:s}}finally{try{o&&!o.done&&(r=a["return"])&&r.call(a)}finally{if(t)throw t.error}}}},Zo.prototype.getConfig=function(){var I=this;this.formFormatId&&T.forkJoin(this.getFormFormat(),this.getFormFormatConfig()).subscribe(function(e){var t,r,i,n,a,o,s=e[0];s&&(I.formFormat=I.convertFormFormat(s));var l=e[1];if(l&&(I.config=l),I.formFormat.formButtons){I.buttonConfigs=I.formFormat.formButtons.map(function(e){return Object.assign({},e,{enable:"Enable"===e.buttonState,disabled:"Disabled"===e.buttonState,hidden:"Hidden"===e.buttonState})});var c=new Array;l&&l.formButtonConfigs&&(c=l.formButtonConfigs);try{for(var d=pe(c),p=d.next();!p.done;p=d.next()){var u=p.value;try{for(var f=pe(I.buttonConfigs),h=f.next();!h.done;h=f.next()){var m=h.value;if(m.buttonId===u.buttonId){switch(u.buttonState){case"Enable":m.enable=!0,m.disabled=!1,m.hidden=!1;break;case"Disabled":m.enable=!1,m.disabled=!0,m.hidden=!1;break;case"Hidden":m.enable=!1,m.disabled=!1,m.hidden=!0}break}}}catch(x){i={error:x}}finally{try{h&&!h.done&&(n=f["return"])&&n.call(f)}finally{if(i)throw i.error}}}}catch(w){t={error:w}}finally{try{p&&!p.done&&(r=d["return"])&&r.call(d)}finally{if(t)throw t.error}}}if(I.formFormat.formFields){I.fieldConfigs=fe(I.formFormat.formFields),I.orgFieldConfigs(I.fieldConfigs);var v=new Array;l&&l.formFieldConfigs&&(v=l.formFieldConfigs);try{for(var y=pe(v),g=y.next();!g.done;g=y.next()){var b=g.value;I.setFieldConfig(I.fieldConfigs,b)}}catch(C){a={error:C}}finally{try{g&&!g.done&&(o=y["return"])&&o.call(y)}finally{if(a)throw a.error}}}})},Zo.prototype.orgFieldConfigs=function(e){var t,r;if(0<e.length)try{for(var i=pe(e),n=i.next();!n.done;n=i.next()){var a=n.value;a.data=Object.assign({},a.data,{editable:"Editable"===a.data.fieldState,readonly:"Readonly"===a.data.fieldState,hidden:"Hidden"===a.data.fieldState,required:"Required"===a.data.fieldState}),a.children&&a.children&&this.orgFieldConfigs(a.children)}}catch(o){t={error:o}}finally{try{n&&!n.done&&(r=i["return"])&&r.call(i)}finally{if(t)throw t.error}}},Zo.prototype.setFieldConfig=function(e,t){var r,i;if(0<e.length)try{for(var n=pe(e),a=n.next();!a.done;a=n.next()){var o=a.value;if(o.data.fieldId===t.fieldId){switch(t.fieldState){case"Editable":o.data.editable=!0,o.data.readonly=!1,o.data.hidden=!1,o.data.required=!1;break;case"Readonly":o.data.editable=!1,o.data.readonly=!0,o.data.hidden=!1,o.data.required=!1;break;case"Hidden":o.data.editable=!1,o.data.readonly=!1,o.data.hidden=!0,o.data.required=!1;break;case"Required":o.data.editable=!1,o.data.readonly=!1,o.data.hidden=!1,o.data.required=!0}return}o.children&&0<o.children.length&&this.setFieldConfig(o.children,t)}}catch(s){r={error:s}}finally{try{a&&!a.done&&(i=n["return"])&&i.call(n)}finally{if(r)throw r.error}}},Zo.prototype.saveConfig=function(e){return this.http.post("/api/runtime/wf/v1.0/formFormatConfig",e)},Zo.prototype.getFormFormat=function(){if(this.formFormatId){var e="/api/runtime/wf/v1.0/formFormat/"+this.formFormatId;return e=encodeURI(e),this.http.get(e)}return T.of(null)},Zo.prototype.getFormFormatConfig=function(){if(this.formatConfigId){var e="/api/runtime/wf/v1.0/formFormatConfig/"+this.formatConfigId;return e=encodeURI(e),this.http.get(e)}return T.of(null)},Zo.prototype.convertFormFormat=function(e){return e.status||(e.status=0),this.convertformFields(e.formFields),this.getFormatFieldList(e.formFields,this.formatFieldList),e},Zo.prototype.convertformFields=function(e){var t,r;if(0<e.length)try{for(var i=pe(e),n=i.next();!n.done;n=i.next()){var a=n.value;"boolean"==typeof a.leaf||null!=a.leaf&&a.leaf!==undefined||(a.leaf=!0),a.children&&a.children&&this.orgFieldConfigs(a.children)}}catch(o){t={error:o}}finally{try{n&&!n.done&&(r=i["return"])&&r.call(i)}finally{if(t)throw t.error}}},Zo.prototype.getFormatFieldList=function(e,t){var r,i;if(0<e.length)try{for(var n=pe(e),a=n.next();!a.done;a=n.next()){var o=a.value;t.push(o.data),o.children&&o.children&&this.getFormatFieldList(o.children,t)}}catch(s){r={error:s}}finally{try{a&&!a.done&&(i=n["return"])&&i.call(n)}finally{if(r)throw r.error}}},Zo.prototype.getFormatField=function(e,t){var r,i;try{for(var n=pe(e),a=n.next();!a.done;a=n.next()){var o=a.value;if(o.data.fieldId===t)return o;if(o.children&&0<o.children.length)return this.getFormatField(o.children,t)}}catch(s){r={error:s}}finally{try{a&&!a.done&&(i=n["return"])&&i.call(n)}finally{if(r)throw r.error}}},Zo.decorators=[{type:ne.Component,args:[{selector:"lib-form-format-config",template:'\r\n\x3c!--需要嵌套的层-----------标签页----------------\x3e\r\n<farris-tabs class="h-100 f-component-tabs f-tabs-has-grid" [value]="\'buttonConfig\'" [contentFill]="true">\r\n  <farris-tab [title]="\'表单按钮\'" [id]="\'buttonConfig\'">\r\n    <ng-template farrisTabsExtend>\r\n      <farris-button [type]="\'link\'" (click)="btnBatchOperate(\'enable\')">\r\n        可用\r\n      </farris-button>\r\n      <farris-button [type]="\'link\'" (click)="btnBatchOperate(\'disabled\')">\r\n        禁用\r\n      </farris-button>\r\n      <farris-button [type]="\'link\'" (click)="btnBatchOperate(\'hidden\')">\r\n        隐藏\r\n      </farris-button>\r\n      <farris-button [type]="\'link\'" (click)="btnBatchReset()">\r\n        重置\r\n      </farris-button>\r\n    </ng-template>\r\n    <ng-template #content>\r\n      <div class="f-utils-fill-flex-column" style="background: #FFF;">\r\n        <farris-datagrid class="f-component-grid f-utils-fill" [columns]="buttonCols" [data]="buttonConfigs" #btnGrid\r\n          [idField]="\'id\'" [showLineNumber]="false" [fitColumns]="true" [striped]="true"\r\n          [virtualized]="true" [pagination]="false" [useThemes]="false" [fit]="true" [showAllCheckbox]="true" \r\n          [showCheckbox]="true" [multiSelect]="true">\r\n        </farris-datagrid>\r\n      </div>\r\n    </ng-template>\r\n  </farris-tab>\r\n  <farris-tab [title]="\'表单字段\'" [id]="\'fieldConfig\'">\r\n    <ng-template farrisTabsExtend>\r\n      <farris-button [type]="\'link\'" (click)="fieldBatchOperate(\'editable\')">\r\n        可写\r\n      </farris-button>\r\n      <farris-button [type]="\'link\'" (click)="fieldBatchOperate(\'readonly\')">\r\n        只读\r\n      </farris-button>\r\n      <farris-button [type]="\'link\'" (click)="fieldBatchOperate(\'hidden\')">\r\n        隐藏\r\n      </farris-button>\r\n      <farris-button [type]="\'link\'" (click)="fieldBatchOperate(\'required\')">\r\n        必填\r\n      </farris-button>\r\n      <farris-button [type]="\'link\'" (click)="fieldBatchReset()">\r\n        重置\r\n      </farris-button>\r\n    </ng-template>\r\n    <ng-template #content>\r\n      <div class="f-utils-fill-flex-column" style="background: #FFF;">\r\n        \x3c!-- <farris-datagrid class="f-component-grid f-utils-fill" [columns]="fieldCols" [data]="fieldConfigs" #fieldGrid\r\n          [idField]="\'id\'" [showLineNumber]="false" [fitColumns]="true" [striped]="true"\r\n          [virtualized]="true" [pagination]="false" [useThemes]="false" [fit]="true" [showAllCheckbox]="true" \r\n          [showCheckbox]="true" [multiSelect]="true">\r\n        </farris-datagrid> --\x3e\r\n        <farris-treetable #fieldTree [columns]="fieldCols" \r\n          [showBorder]="false" [showHeader]="true" [data]="fieldConfigs" [fit]="true" [fitColumns]="true"\r\n          [idField]="\'id\'" [singleSelect]="false" [showCheckbox]="true" \r\n          [showCheckAll]="true" [striped]="true" [fixedHeader]="true">\r\n        </farris-treetable>\r\n      </div>\r\n    </ng-template>\r\n  </farris-tab>\r\n  <farris-tab [title]="\'表单事件\'" [id]="\'operationConfig\'" [show]="showMethodTab">\r\n    <ng-template farrisTabsExtend>\r\n      <farris-button [type]="\'link\'" (click)="operationConfig.add()">\r\n        新增\r\n      </farris-button>\r\n      <farris-button [type]="\'link\'" (click)="operationConfig.delete()">\r\n        删除\r\n      </farris-button>\r\n    </ng-template>\r\n    <ng-template #content>\r\n      <lib-form-operation-config \r\n        [formFormatId]="formFormatId" \r\n        [formFormatConfigId]="config.id" \r\n        [operations]="config.formMethodConfigs"\r\n        class="h-100"></lib-form-operation-config>\r\n    </ng-template>\r\n  </farris-tab>\r\n</farris-tabs>\r\n\x3c!--Tab区域--\x3e  \r\n      \r\n  \x3c!-- </section>\r\n</div> --\x3e\r\n\r\n<ng-template #btnEnable let-ctx>\r\n  <farris-switch [(ngModel)]="ctx.rowData.enable" (valueChange)="btnConfigChange($event, ctx.field, ctx.rowData.id)"></farris-switch>\r\n</ng-template>\r\n<ng-template #btnDisabled let-ctx>\r\n  <farris-switch [(ngModel)]="ctx.rowData.disabled" (valueChange)="btnConfigChange($event, ctx.field, ctx.rowData.id)"></farris-switch>\r\n</ng-template>\r\n<ng-template #btnHidden let-ctx>\r\n  <farris-switch [(ngModel)]="ctx.rowData.hidden" (valueChange)="btnConfigChange($event, ctx.field, ctx.rowData.id)"></farris-switch>\r\n</ng-template>\r\n<ng-template #fieldEditable let-ctx>\r\n  <farris-switch *ngIf="ctx.node.leaf" size="small" [(ngModel)]="ctx.node.data.editable"\r\n  (valueChange)="fieldConfigChange($event, ctx.column.field, ctx.node.data.id)">\r\n  </farris-switch>\r\n</ng-template>\r\n<ng-template #fieldReadonly let-ctx>\r\n  <farris-switch *ngIf="ctx.node.leaf" size="small" [(ngModel)]="ctx.node.data.readonly"\r\n    (valueChange)="fieldConfigChange($event, ctx.column.field, ctx.node.data.id)">\r\n  </farris-switch>\r\n</ng-template>\r\n<ng-template #fieldHidden let-ctx>\r\n  <farris-switch *ngIf="ctx.node.leaf" size="small" [(ngModel)]="ctx.node.data.hidden"\r\n    (valueChange)="fieldConfigChange($event, ctx.column.field, ctx.node.data.id)">\r\n  </farris-switch>\r\n</ng-template>\r\n<ng-template #fieldRequired let-ctx>\r\n  <farris-switch *ngIf="ctx.node.leaf" size="small" [(ngModel)]="ctx.node.data.required"\r\n    (valueChange)="fieldConfigChange($event, ctx.column.field, ctx.node.data.id)">\r\n  </farris-switch>\r\n</ng-template>\r\n\r\n\r\n',styles:[""]}]}],Zo.ctorParameters=function(){return[{type:O.HttpService},{type:Y.MessagerService},{type:Q.NotifyService}]},Zo.propDecorators={btnEnable:[{type:ne.ViewChild,args:["btnEnable"]}],btnDisabled:[{type:ne.ViewChild,args:["btnDisabled"]}],btnHidden:[{type:ne.ViewChild,args:["btnHidden"]}],fieldEditable:[{type:ne.ViewChild,args:["fieldEditable"]}],fieldReadonly:[{type:ne.ViewChild,args:["fieldReadonly"]}],fieldHidden:[{type:ne.ViewChild,args:["fieldHidden"]}],fieldRequired:[{type:ne.ViewChild,args:["fieldRequired"]}],btnGrid:[{type:ne.ViewChild,args:["btnGrid"]}],fieldTree:[{type:ne.ViewChild,args:["fieldTree"]}],operationConfig:[{type:ne.ViewChild,args:[Wo]}],showMethodTab:[{type:ne.Input}]},Zo);function Zo(e,t,r){this.http=e,this.message=t,this.notify=r,this.config=new Uo,this.formFormat=new jo,this.state="edit",this.showMethodTab=!0,this.buttonCols=[],this.buttonConfigs=new Array,this.fieldCols=[],this.fieldConfigs=new Array,this.formatFieldList=new Array}var Yo=(Qo.prototype.ngOnInit=function(){},Qo.prototype.ngOnChanges=function(e){e.formFormatId&&e.formFormatId.currentValue?this.showComponentRef():(this.componentRef=this.createWFComponentRef(),this.componentRef.instance.formFormatId=null,this.componentRef.instance.formatConfigId=null,this.componentRef.instance.showMethodTab=this.showMethodTab,this.container.clear(),this.container.insert(this.componentRef.hostView))},Qo.prototype.submit=function(){return this.componentRef.instance.submit()},Qo.prototype.showComponentRef=function(){this.componentRef=this.createWFComponentRef(),this.componentRef.instance.formFormatId=this.formFormatId,this.componentRef.instance.formatConfigId=this.formatConfigId,this.componentRef.instance.showMethodTab=this.showMethodTab,this.container.clear(),this.container.insert(this.componentRef.hostView)},Qo.prototype.createWFComponentRef=function(){return this.cfr.resolveComponentFactory(Xo).create(this.injector)},Qo.prototype.getFormFormatType=function(){if(this.formFormatId){var e="/api/runtime/wf/v1.0/formFormatType/formFormat?formFormat="+this.formFormatId;return this.http.get(e)}},Qo.decorators=[{type:ne.Component,args:[{selector:"lib-form-config-container",template:"<ng-container #container></ng-container>\r\n",styles:[""]}]}],Qo.ctorParameters=function(){return[{type:ne.Injector},{type:ne.ComponentFactoryResolver},{type:O.HttpService}]},Qo.propDecorators={container:[{type:ne.ViewChild,args:["container",{read:ne.ViewContainerRef}]}],modalFooter:[{type:ne.ViewChild,args:["iconSelectFooter"]}],formFormatId:[{type:ne.Input}],formatConfigId:[{type:ne.Input}],showMethodTab:[{type:ne.Input}]},Qo);function Qo(e,t,r){this.injector=e,this.cfr=t,this.http=r,this.showMethodTab=!0}var es={FromBE:0,FromVO:1,FromNone:2};es[es.FromBE]="FromBE",es[es.FromVO]="FromVO",es[es.FromNone]="FromNone";var ts=(rs.getCommonModelType=function(e){var t=ie.CommonModelUtil.GetGeneratedConfigID(e);return t="com."+t},rs.judgeVoTemplateType=function(e){return!0===e.IsVirtual?e.TemplateVoInfo&&null!=e.TemplateVoInfo.TemplateVoId?es.FromVO:es.FromNone:es.FromBE},rs);function rs(){}var is=(ns.prototype.ngOnInit=function(){},ns.prototype.processNameChange=function(e){this.queryParam.filterArgs.name=new re.TextValue,this.queryParam.filterArgs.name.hasValue=!0,this.queryParam.filterArgs.name.value=e,this.queryParam.filterArgsExt.name=e},ns.prototype.processTypeChange=function(e){var t=e.selections[0];this.queryParam.filterArgs.billProcessType=new re.TextValue,null!=t&&(""!=t.value&&(this.queryParam.filterArgs.billProcessType.hasValue=!0),this.queryParam.filterArgs.billProcessType.value=t.value)},ns.prototype.enabledStateChange=function(e){var t=e.selections[0];this.queryParam.filterArgs.isEnabled=new re.TextValue,null!=t&&(""!=t.value&&(this.queryParam.filterArgs.isEnabled.hasValue=!0),this.queryParam.filterArgs.isEnabled.value=String(t.value))},ns.prototype.sysInitChange=function(e){var t=e.selections[0];this.queryParam.filterArgs.sysInit=new re.TextValue,null!=t&&(""!=t.value&&(this.queryParam.filterArgs.sysInit.hasValue=!0),this.queryParam.filterArgs.sysInit.value=String(t.value))},ns.prototype.selectUpBill=function(){var i=this,e=this.resolver.resolveComponentFactory(ee.SelectMetadataRTComponent).create(this.injector);e.instance.typeList="GSPViewModel",e.instance.selectedMetadata.subscribe(function(e){i.clearUpBill();var t=e.metadata,r=JSON.parse(t.content);switch(ts.judgeVoTemplateType(r)){case es.FromBE:i.queryParam.filterArgs.upBillVoId=new re.TextValue,i.queryParam.filterArgs.upBillVoId.hasValue=!0,i.queryParam.filterArgs.upBillVoId.value=r.ID,i.queryParam.filterArgsExt.upBillVoName=r.MainObject.Name;break;default:i.notify.error(i.localePipe.transform("pleaseSelectNonVirtualVO"))}},function(e){console.error(e),i.messager.error(null==e.error?e.message:e.error.Message||e.error.message||e.message),i.clearUpBill()});var t={title:this.localePipe.transform("billSelector"),width:930,height:573,showButtons:!1},r=this.modalService.show(e,t);e.instance.closeModalEmitter.subscribe(function(e){return r.close()})},ns.prototype.selectDownBill=function(){var i=this,e=this.resolver.resolveComponentFactory(ee.SelectMetadataRTComponent).create(this.injector);e.instance.typeList="GSPViewModel",e.instance.selectedMetadata.subscribe(function(e){i.clearDownBill();var t=e.metadata,r=JSON.parse(t.content);switch(ts.judgeVoTemplateType(r)){case es.FromBE:i.queryParam.filterArgs.downBillVoId=new re.TextValue,i.queryParam.filterArgs.downBillVoId.hasValue=!0,i.queryParam.filterArgs.downBillVoId.value=r.ID,i.queryParam.filterArgsExt.downBillVoName=r.MainObject.Name;break;default:i.notify.error(i.localePipe.transform("pleaseSelectNonVirtualVO"))}},function(e){console.error(e),i.messager.error(null==e.error?e.message:e.error.Message||e.error.message||e.message),i.clearUpBill()});var t={title:this.localePipe.transform("billSelector"),width:930,height:573,showButtons:!1},r=this.modalService.show(e,t);e.instance.closeModalEmitter.subscribe(function(e){return r.close()})},ns.prototype.clearProcessName=function(){delete this.queryParam.filterArgs.name,this.queryParam.filterArgsExt.name=null},ns.prototype.clearProcessType=function(){delete this.queryParam.filterArgs.billProcessType},ns.prototype.clearUpBill=function(){delete this.queryParam.filterArgs.upBillVoId,this.queryParam.filterArgsExt.upBillVoName=null},ns.prototype.clearDownBill=function(){delete this.queryParam.filterArgs.downBillVoId,this.queryParam.filterArgsExt.downBillVoName=null},ns.prototype.clearIsEnabled=function(){delete this.queryParam.filterArgs.isEnabled},ns.prototype.clearIsPublished=function(){},ns.prototype.clearSysInit=function(){delete this.queryParam.filterArgs.sysInit},ns.prototype.clickBtnFilter=function(){this.queryParam.filterArgs.pageIndex=0,this.onSearchEmitter.emit(this.queryParam)},ns.prototype.clickBtnClear=function(){this.comboProcessType.onClear(),this.comboProcessTypeData=this.comboProcessTypeData.map(function(e){return de({},e)}),this.comboEnabledState.onClear(),this.comboEnabledStateData=this.comboEnabledStateData.map(function(e){return de({},e)}),this.comboSysInit.onClear(),this.comboSysInitData=this.comboSysInitData.map(function(e){return de({},e)});var e=this.queryParam;e.filterArgsExt={},e.filterArgs.isEnabled=null,e.filterArgs.billProcessType=null,e.filterArgs.upBillVoId=null,e.filterArgs.downBillVoId=null,e.filterArgs.sysInit=null,this.queryParam=e},ns.decorators=[{type:ne.Component,args:[{selector:"app-proc-help-query-solution",template:'<farris-section #sectionQuerySolution class="f-section-scheme f-section-in-managelist" [expandStatus]="true"\r\n  [enableMaximize]="false" [enableAccordion]="\'\'" mainTitle="{{ \'querySolution\' | aifLocale }}" [fill]="false"\r\n  [showHeader]="true">\r\n  <ng-template farrisSectionTitle>\r\n    <div\r\n      style="border-radius: 6px; padding: 5px 12px; background: linear-gradient(-51deg, rgb(42, 135, 255, 0.2) 0%, rgb(50, 139, 255, 0.2) 100%);">\r\n      <span style="font-size: 13px;color: #2A87FF;line-height: 16px;">{{ \'querySolution\' | aifLocale }}</span>\r\n    </div>\r\n  </ng-template>\r\n\r\n  <ng-template farrisSectionToolbar>\r\n    <div class="query-solution">\r\n      <div class="solution-action">\r\n        <ng-container *ngIf="sectionQuerySolution.expandStatus == true">\r\n          <div class="btn-group">\r\n            <button class="btn btn-primary" (click)="clickBtnFilter()">{{ \'filter\' | aifLocale }}</button>\r\n          </div>\r\n          <div class="icon-group">\r\n            <span class="icon-group-remove" title="{{\'clear\' | aifLocale}}" (click)="clickBtnClear()">\r\n              <span class="f-icon f-icon-remove"></span>\r\n            </span>\r\n            <span class="divide"></span>\r\n            <span class="icon-group-setup" *ngIf="false">\r\n              <span class="f-icon f-icon-home-setup"></span>\r\n            </span>\r\n            <span class="icon-group-packup" title="{{ \'collapse\' | aifLocale }}"\r\n              (click)="sectionQuerySolution.expandStatus = false">\r\n              <span class="f-icon f-icon-packup"></span>\r\n            </span>\r\n          </div>\r\n        </ng-container>\r\n        <ng-container *ngIf="sectionQuerySolution.expandStatus == false">\r\n          <div class="icon-group">\r\n            <span class="icon-group-packup" title="{{ \'expand\' | aifLocale }}"\r\n              (click)="sectionQuerySolution.expandStatus = true">\r\n              <span class="f-icon f-icon-packup" style="transform: rotate(180deg);"></span>\r\n            </span>\r\n          </div>\r\n        </ng-container>\r\n      </div>\r\n    </div>\r\n  </ng-template>\r\n\r\n  <div class="form f-form-layout farris-form farris-form-controls-inline"\r\n    *ngIf="sectionQuerySolution.expandStatus == true">\r\n    \x3c!-- 流程名称 --\x3e\r\n    <div class="col-12 col-md-6 col-xl-3">\r\n      <div class="farris-group-wrap">\r\n        <div class="form-group farris-form-group">\r\n          <label for="" class="col-form-label" title="{{\'processName\' | aifLocale}}">\r\n            <span class="farris-label-text">{{"processName" | aifLocale}}</span>\r\n          </label>\r\n          <div class="farris-input-wrap">\r\n            <input-group [ngModel]="queryParam.filterArgsExt.name" (valueChange)="processNameChange($event)"\r\n              (clear)="clearProcessName()">\r\n            </input-group>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    \x3c!-- 流程类型 --\x3e\r\n    <div class="col-12 col-md-6 col-xl-3" *ngIf="true">\r\n      <div class="farris-group-wrap">\r\n        <div class="form-group farris-form-group">\r\n          <label for="" class="col-form-label" title="{{\'processType\' | aifLocale}}">\r\n            <span class="farris-label-text">{{"processType" | aifLocale}}</span>\r\n          </label>\r\n          <div class="farris-input-wrap">\r\n            <farris-combo-list #comboProcessType [ngModel]="queryParam.filterArgs.billProcessType?.value"\r\n              [idField]="comboProcessTypeIdField" [valueField]="comboProcessTypeValueField"\r\n              [textField]="comboProcessTypeTextField" [data]="comboProcessTypeData" (clear)="clearProcessType()"\r\n              (valueChange)="processTypeChange($event)" [editable]="false"></farris-combo-list>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    \x3c!-- 上游单据 --\x3e\r\n    <div class="col-12 col-md-6 col-xl-3">\r\n      <div class="farris-group-wrap">\r\n        <div class="form-group farris-form-group">\r\n          <label for="" class="col-form-label" title="{{\'upBill\' | aifLocale}}">\r\n            <span class="farris-label-text">{{"upBill" | aifLocale}}</span>\r\n          </label>\r\n          <div class="farris-input-wrap">\r\n            <input-group [editable]="false" [ngModel]="queryParam.filterArgsExt.upBillVoName"\r\n              (clickHandle)="selectUpBill()" [groupText]="groupIcon" (clear)="clearUpBill()"></input-group>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    \x3c!-- 下游单据 --\x3e\r\n    <div class="col-12 col-md-6 col-xl-3">\r\n      <div class="farris-group-wrap">\r\n        <div class="form-group farris-form-group">\r\n          <label for="" class="col-form-label" title="{{\'downBill\' | aifLocale}}">\r\n            <span class="farris-label-text">{{"downBill" | aifLocale}}</span>\r\n          </label>\r\n          <div class="farris-input-wrap">\r\n            <input-group [editable]="false" [ngModel]="queryParam.filterArgsExt.downBillVoName"\r\n              (clickHandle)="selectDownBill()" [groupText]="groupIcon" (clear)="clearDownBill()">\r\n            </input-group>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    \x3c!-- 启用状态 --\x3e\r\n    <div class="col-12 col-md-6 col-xl-3">\r\n      <div class="farris-group-wrap">\r\n        <div class="form-group farris-form-group">\r\n          <label for="enabledState" class="col-form-label" title="{{\'enabledState\' | aifLocale}}">\r\n            <span class="farris-label-text">{{"enabledState" | aifLocale}}</span>\r\n          </label>\r\n          <div class="farris-input-wrap">\r\n            <farris-combo-list #comboEnabledState [ngModel]="queryParam.filterArgs.isEnabled?.value"\r\n              [idField]="comboEnabledStateIdField" [valueField]="comboEnabledStateValueField"\r\n              [textField]="comboEnabledStateTextField" [data]="comboEnabledStateData" (clear)="clearIsEnabled()"\r\n              (valueChange)="enabledStateChange($event)" [editable]="false"></farris-combo-list>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    \x3c!-- 系统预置 --\x3e\r\n    <div class="col-12 col-md-6 col-xl-3" *ngIf="true">\r\n      <div class="farris-group-wrap">\r\n        <div class="form-group farris-form-group">\r\n          <label for="" class="col-form-label" title="{{\'sysInit\' | aifLocale}}">\r\n            <span class="farris-label-text">{{"sysInit" | aifLocale}}</span>\r\n          </label>\r\n          <div class="farris-input-wrap">\r\n            <farris-combo-list #comboSysInit [ngModel]="queryParam.filterArgs.sysInit?.value"\r\n              [idField]="comboSysInitIdField" [valueField]="comboSysInitValueField" [textField]="comboSysInitTextField"\r\n              [data]="comboSysInitData" (clear)="clearSysInit()" (valueChange)="sysInitChange($event)"\r\n              [editable]="false">\r\n            </farris-combo-list>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</farris-section>',styles:[".query-solution span{vertical-align:middle;margin:0 3px;cursor:pointer}"]}]}],ns.ctorParameters=function(){return[{type:Ba},{type:Y.MessagerService},{type:Q.NotifyService},{type:ee.GSPMetadataRTService},{type:te.BsModalService},{type:ne.Injector},{type:ne.ComponentFactoryResolver},{type:Ka}]},ns.propDecorators={queryParam:[{type:ne.Input,args:["queryParam"]}],queryParamChange:[{type:ne.Output,args:["queryParamChange"]}],onSearchEmitter:[{type:ne.Output,args:["onSearch"]}],comboProcessType:[{type:ne.ViewChild,args:["comboProcessType"]}],comboEnabledState:[{type:ne.ViewChild,args:["comboEnabledState"]}],comboSysInit:[{type:ne.ViewChild,args:["comboSysInit"]}]},ns);function ns(e,t,r,i,n,a,o,s){this.procHelpService=e,this.messager=t,this.notify=r,this.metadataService=i,this.modalService=n,this.injector=a,this.resolver=o,this.localePipe=s,this.groupIcon='<i class="f-icon f-icon-lookup"></i>',this.queryParamChange=new ne.EventEmitter,this.onSearchEmitter=new ne.EventEmitter,this.comboProcessTypeIdField="value",this.comboProcessTypeValueField="value",this.comboProcessTypeTextField="text",this.comboProcessTypeData=[{value:"",text:this.localePipe.transform("all")},{value:ka.BifCreationProcess,text:this.localePipe.transform("creation")},{value:ka.BifWritebackProcess,text:this.localePipe.transform("writeback")}],this.comboEnabledStateIdField="value",this.comboEnabledStateValueField="value",this.comboEnabledStateTextField="text",this.comboEnabledStateData=[{value:"",text:this.localePipe.transform("all")},{value:"true",text:this.localePipe.transform("enabled")},{value:"false",text:this.localePipe.transform("disabled")}],this.comboSysInitIdField="value",this.comboSysInitValueField="value",this.comboSysInitTextField="text",this.comboSysInitData=[{value:"",text:this.localePipe.transform("all")},{value:"true",text:this.localePipe.transform("yes")},{value:"false",text:this.localePipe.transform("no")}]}var as=(os.decorators=[{type:ne.NgModule,args:[{declarations:[Ka],exports:[Ka]}]}],os);function os(){}var ss={"zh-CHS":{code:"编号",name:"名称",lastModifiedTime:"最后修改时间",upBill:"上游单据",downBill:"下游单据",processName:"流程名称",processType:"流程类型",creation:"生单",writeback:"回写",enabledState:"启用状态",sysInit:"系统预置",filter:"筛选",all:"全部",enabled:"已启用",disabled:"已禁用",yes:"是",no:"否",billSelector:"单据选择",querySolution:"筛选方案",collapse:"收起",expand:"展开",loading:"加载中",pleaseSelectNonVirtualVO:"请选择非虚拟VO",pleaseSelectOneItemOnly:"请选中一条数据",isExtendProcess:"扩展流程"},en:{code:"Code",name:"Name",lastModifiedTime:"Last Modified Time",upBill:"Upstream Bill",downBill:"Downstream Bill",processName:"Process Name",processType:"Process Type",creation:"Creation",writeback:"Writeback",enabledState:"Enabled State",sysInit:"System Init",filter:"Filter",all:"All",enabled:"Enabled",disabled:"Disabled",yes:"Yes",no:"No",billSelector:"Bill Selector",querySolution:"Query Solution",collapse:"Collapse",expand:"Expand",loading:"Loading...",pleaseSelectNonVirtualVO:"Please select non-virtual VO",pleaseSelectOneItemOnly:"Please select only one item",isExtendProcess:"Extend Process"},"zh-CHT":{code:"編號",name:"名稱",lastModifiedTime:"最後修改時間",upBill:"上遊單據",downBill:"下遊單據",processName:"流程名稱",processType:"流程類型",creation:"生單",writeback:"回寫",enabledState:"啟用狀態",sysInit:"系統預置",filter:"篩選",all:"全部",enabled:"已啟用",disabled:"已禁用",yes:"是",no:"否",billSelector:"單據選擇",querySolution:"篩選方案",collapse:"收起",expand:"展開",loading:"加載中",pleaseSelectNonVirtualVO:"請選擇非虛擬VO",pleaseSelectOneItemOnly:"請選中壹條數據",isExtendProcess:"擴展流程"}},ls=localStorage.getItem("languageCode")||"zh-CHS",cs=ss,ds=(ps.decorators=[{type:ne.NgModule,args:[{imports:[M.CommonModule,D.HttpClientModule,ee.MetadataRTSelectModule,ee.GSPMetadataRTServiceModule.forRoot(""),N.FResponseToolbarModule,B.ListFilterModule,R.AngularDraggableModule,z.FarrisCommonModule.forRoot(),H.FarrisFormsModule,j.FarrisSectionModule,U.DatagridEditorsModule,q.DatagridModule.forRoot(fe(U.EditorProviders)),G.ComboListModule,K.InputGroupModule,_.FarrisDialogModule,W.SwitchModule,$.FarrisTabsModule,X.LookupModule,Z.LoadingModule.forRoot({message:"Loading..."}),Q.NotifyModule.forRoot(),Y.MessagerModule.forRoot({width:550,height:450}),te.ModalModule.forRoot(),as],providers:[O.CacheService,O.SessionService,O.HttpService,V.FrmEventBus,V.FuncsService,Z.LoadingService,V.AppService,V.FrameworkService,{provide:ne.LOCALE_ID,useValue:ls},ee.GSPMetadataRTService,L.BusinessObjectRtService,Ba,{provide:Ga,useValue:cs},Ka],declarations:[_a,is],entryComponents:[_a,is]}]}],ps);function ps(){}var us=(fs.decorators=[{type:ne.NgModule,args:[{declarations:[Ao,Ft,Ni,Ii,Ti,Di,cr,Hi,Gi,Do,Ut,Hn,Nn,sn,yn,un,Rn,Vo,En,fr,ya,Gn,xr,gr,zo,Xr,Jr,no,$n,Vr,ea,kr,Dr,ai,ii,ar,Xo,Yo,sr,Wo,To,oa,Sn,pa,To,Vn,Dn,Wr,ci,$a],imports:[M.CommonModule,l.ReactiveFormsModule,l.FormsModule,D.HttpClientModule,d.SysManagerUIModule,p.RtfAppHelpModule,c.CommonComponentUiModule,ee.GSPMetadataRTServiceModule.forRoot(""),ee.MetadataRTSelectModule,u.TreeTableModule,m.DataTableModule,v.LayoutModule,Q.NotifyModule,_.FarrisDialogModule,y.SplitterModule,K.InputGroupModule,X.LookupModule,g.FlexLayoutModule,b.FarrisPanelModule,x.FarrisResponsiveModule,J.ExpressionModule,h.PropertyPanelModule,$.FarrisTabsModule,Z.LoadingModule.forRoot({message:"加载中..."}),Y.MessagerModule.forRoot({width:500}),te.ModalModule,w.PopoverModule,C.PaginationModule,I.FarrisDropdownModule,U.DatagridEditorsModule,q.DatagridModule.forRoot(fe(U.EditorProviders)),G.ComboListModule,S.WizardModule,H.FarrisFormsModule,W.SwitchModule,E.WfBizprocessLookupModule,P.NumberSpinnerModule,k.PerfectScrollbarModule,j.FarrisSectionModule,A.FarrisButtonModule,ds],providers:[O.SessionService,O.HttpService,J.ExpressionService,c.CommonComponentUiRTService,No,Bo,Ro,an,vt,Cn],exports:[Ao],entryComponents:[Ft,Ni,Ii,Ti,Di,cr,Hi,Gi,Ut,ee.SelectMetadataRTComponent,Hn,Nn,sn,yn,un,Rn,En,fr,ya,Gn,xr,gr,zo,Xr,Jr,no,$n,Vr,ea,kr,Dr,ai,ii,ar,Xo,Yo,sr,Wo,To,oa,pa,To,Vn,Dn,Wr,_a,ci,$a]}]}],fs);function fs(){}function hs(){}e.WfProcessEditorService=ae,e.WfProcessEditorComponent=Ao,e.WfProcessEditorModule=us,e.ProcessTime=se,e.ProcessInfo=bo,e.ProcessOrganization=fo,e.RTProcessInfo=hs,e.ɵde=is,e.ɵdd=_a,e.ɵdc=ss,e.ɵcx=ds,e.ɵdb=Ba,e.ɵcy=as,e.ɵda=Ka,e.ɵcz=Ga,e.ɵl=So,e.ɵh=to,e.ɵe=fi,e.ɵi=lo,e.ɵj=po,e.ɵk=xo,e.ɵa=me,e.ɵb=Eo,e.ɵg=Qa,e.ɵf=ma,e.ɵd=vt,e.ɵc=gt,e.ɵdf=No,e.ɵdg=Bo,e.ɵdh=Ro,e.ɵy=Ut,e.ɵz=Bt,e.ɵba=Ot,e.ɵbb=zt,e.ɵcb=$n,e.ɵcr=oa,e.ɵq=Di,e.ɵo=Ii,e.ɵw=Gi,e.ɵbx=zo,e.ɵcw=$a,e.ɵbv=xr,e.ɵbw=gr,e.ɵm=Ft,e.ɵca=no,e.ɵck=ar,e.ɵcl=rr,e.ɵr=cr,e.ɵu=Xt,e.ɵs=Jt,e.ɵt=Wt,e.ɵco=Yo,e.ɵcm=Xo,e.ɵcn=Wo,e.ɵcp=sr,e.ɵn=Ni,e.ɵcv=ci,e.ɵv=Hi,e.ɵx=Do,e.ɵcj=ii,e.ɵci=ai,e.ɵcq=To,e.ɵbu=Gn,e.ɵbj=an,e.ɵbc=Hn,e.ɵbe=Xi,e.ɵbf=Wi,e.ɵbd=Yi,e.ɵbl=yn,e.ɵbm=hn,e.ɵct=Dn,e.ɵbq=Vn,e.ɵbh=Nn,e.ɵbg=Rn,e.ɵbk=un,e.ɵbn=En,e.ɵbo=Sn,e.ɵbp=Cn,e.ɵbi=sn,e.ɵbr=Vo,e.ɵcc=Vr,e.ɵbt=ya,e.ɵp=Ti,e.ɵcu=Wr,e.ɵbz=Jr,e.ɵby=Xr,e.ɵbs=fr,e.ɵcs=pa,e.ɵcd=ea,e.ɵch=Pr,e.ɵcf=Dr,e.ɵcg=Fr,e.ɵce=kr,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=gsp-wf-wf-process-editor.umd.min.js.map