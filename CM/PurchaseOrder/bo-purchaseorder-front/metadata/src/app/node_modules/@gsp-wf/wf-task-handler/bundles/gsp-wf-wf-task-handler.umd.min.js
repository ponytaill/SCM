!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@farris/ui-modal"),require("@angular/common"),require("@farris/ui-datatable"),require("@farris/ui-dialog"),require("@farris/ui-pagination"),require("@farris/ui-combo-list"),require("@farris/ui-input-group"),require("@farris/ui-datagrid"),require("@farris/ui-forms"),require("@farris/ui-switch"),require("@gsp-wf/wf-approval-logs"),require("@gsp-wf/ui-flowchart"),require("@gsp-wf/task-impl-api"),require("@farris/ui-avatar"),require("@farris/ui-dropdown"),require("@gsp-wf/wf-sign"),require("@gsp-sys/rtf-common"),require("@gsp-sys/sysmgr-ui"),require("rxjs/operators"),require("@angular/core"),require("@angular/forms"),require("@gsp-svc/formdoc-upload"),require("@farris/ui-messager"),require("@gsp-svc/file-load"),require("rxjs"),require("@ecp-caf/caf-common"),require("@farris/ui-datagrid-editors"),require("@farris/ui-loading"),require("@farris/ui-notify")):"function"==typeof define&&define.amd?define("@gsp-wf/wf-task-handler",["exports","@farris/ui-modal","@angular/common","@farris/ui-datatable","@farris/ui-dialog","@farris/ui-pagination","@farris/ui-combo-list","@farris/ui-input-group","@farris/ui-datagrid","@farris/ui-forms","@farris/ui-switch","@gsp-wf/wf-approval-logs","@gsp-wf/ui-flowchart","@gsp-wf/task-impl-api","@farris/ui-avatar","@farris/ui-dropdown","@gsp-wf/wf-sign","@gsp-sys/rtf-common","@gsp-sys/sysmgr-ui","rxjs/operators","@angular/core","@angular/forms","@gsp-svc/formdoc-upload","@farris/ui-messager","@gsp-svc/file-load","rxjs","@ecp-caf/caf-common","@farris/ui-datagrid-editors","@farris/ui-loading","@farris/ui-notify"],t):t((e["gsp-wf"]=e["gsp-wf"]||{},e["gsp-wf"]["wf-task-handler"]={}),e.uiModal,e.ng.common,e.uiDatatable,e.uiDialog,e.uiPagination,e.uiComboList,e.uiInputGroup,e.uiDatagrid,e.uiForms,e.uiSwitch,e.wfApprovalLogs,e.uiFlowchart,e.taskImplApi,e.uiAvatar,e.uiDropdown,e.wfSign,e.rtfCommon,e.sysmgrUi,e.rxjs.operators,e.ng.core,e.ng.forms,e.formdocUpload,e.uiMessager,e.fileLoad,e.rxjs,e.cafCommon,e.uiDatagridEditors,e.uiLoading,e.uiNotify)}(this,function(e,t,s,n,i,r,o,a,c,l,u,d,p,f,h,m,g,v,b,y,S,w,I,x,k,C,T,N,U,P){"use strict";var A=function(e,t){return(A=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])})(e,t)};function j(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function s(){this.constructor=e}A(e,t),e.prototype=null===t?Object.create(t):(s.prototype=t.prototype,new s)}function D(e){var t="function"==typeof Symbol&&Symbol.iterator,s=t&&e[t],n=0;if(s)return s.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function V(e,t){var s="function"==typeof Symbol&&e[Symbol.iterator];if(!s)return e;var n,i,r=s.call(e),o=[];try{for(;(void 0===t||0<t--)&&!(n=r.next()).done;)o.push(n.value)}catch(a){i={error:a}}finally{try{n&&!n.done&&(s=r["return"])&&s.call(r)}finally{if(i)throw i.error}}return o}function E(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(V(arguments[t]));return e}var H=(M.prototype.getUsersByIds=function(e){var t=this;return C.forkJoin(e.map(function(e){return t.httpSvc.get("/api/runtime/sys/v1.0/users/"+e+"?mode=0002")}))},M.prototype.getWorkItemActions=function(e){var t="/api/runtime/wf/v1.0/workItems/"+e+"/actions";return this.httpSvc.get(t)},M.prototype.complete=function(e){return this.httpSvc.post("/api/runtime/wf/v1.0/workItems/complete",e)},M.prototype.completeSimulate=function(e){return this.httpSvc.post("/api/runtime/wf/v1.0/workItems/complete-simulation",e)},M.prototype.getDestinationScope=function(e,t){var s="/api/runtime/wf/v1.0/workItems/"+e+"/nextNodes/"+t;return this.httpSvc.get(s)},M.prototype.getSimulationAssigneeInfo=function(e,t){var s="/api/runtime/wf/v1.0/workItems/"+e+"/simulation-assigneeInfo?nodeIds=["+t+"]";return this.httpSvc.get(s)},M.prototype.addSign=function(e){return this.httpSvc.post("/api/runtime/wf/v1.0/workItems/counterSignAdd",e)},M.prototype.readTask=function(e){return this.httpSvc.post("/api/runtime/wf/v1.0/workItems/read",e)},M.prototype.getAppInfo=function(e){var t="/api/runtime/wf/v1.0/workItems/"+e+"/formInfo";return this.httpSvc.get(t)},M.prototype.getAssigneeInfo=function(e){var t="/api/runtime/wf/v1.0/workItems/"+e+"/assigneeInfo";return this.httpSvc.get(t)},M.prototype.getOrganizationScope=function(e,t){var s="/api/runtime/wf/v1.0/workItems/"+e+"/organizationScope/"+t;return this.httpSvc.get(s)},M.prototype.getTaskByProcInstId=function(e,t){var s="/api/runtime/task/v1.0/tasks/processInstanceId?procInstId="+e+"&state="+t;return this.httpSvc.get(s)},M.prototype.getTaskByWorkItemId=function(e){var t="/api/runtime/task/v1.0/tasks/sourceId/"+e;return this.httpSvc.get(t)},M.prototype.assignNextUsersByWorkItemId=function(e){return this.httpSvc.post("/api/runtime/wf/v1.0/workItems/assignUser",e)},M.prototype.retrieve=function(e){return this.httpSvc.post("/api/runtime/wf/v1.0/workItems/retrieve",e)},M.prototype.transfer=function(e){return this.httpSvc.post("/api/runtime/wf/v1.0/workItems/transfer",e)},M.prototype.comment=function(e){return this.httpSvc.post("/api/runtime/wf/v1.0/workItems/comment",e)},M.prototype.claim=function(e,t){var s={workItemId:e,comment:t};return this.httpSvc.post("/api/runtime/wf/v1.0/workItems/claim",s)},M.prototype.unClaim=function(e,t){var s={workItemId:e,comment:t};return this.httpSvc.post("/api/runtime/wf/v1.0/workItems/unclaim",s)},M.prototype.error=function(e){if(e&&e.error&&e.error.Message){var t=e.error.Message;this.message.warning(t)}},M.prototype.startProcess=function(e){return this.httpSvc.post("/api/runtime/wf/v1.0/processInstances/startProcess",e)},M.prototype.startProcessSimulate=function(e){return this.httpSvc.post("/api/runtime/wf/v1.0/processInstances/startProcess-simulation",e)},M.prototype.cancelSubmit=function(e){return this.httpSvc.post("/api/runtime/wf/v1.0/processInstances/cancelSubmit",e)},M.newId=function(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},M.prototype.getCommentList=function(){return this.httpSvc.get("/api/runtime/wf/v1.0/commonComments")},M.prototype.addComment=function(){return this.httpSvc.post("/api/runtime/wf/v1.0/commonComments",{})},M.prototype.getTaskCenterConfigByCode=function(e,t,s){var n="/api/runtime/task/v1.0/task-center-setting/code?code="+e;return t&&(n+="&ownerType="+t),s&&(n+="&ownerId="+s),this.httpSvc.get(n)},M.prototype.addTaskCenterConfig=function(e,t){var s="/api/runtime/task/v1.0/task-center-setting/add?configCode="+e+"&currentValue="+t;return this.httpSvc.post(s,null)},M.prototype.getAllUserConfig=function(){return this.httpSvc.get("/api/runtime/task/v1.0/task-center-setting/all")},M.prototype.uploadAttachment=function(e){return this.httpSvc.put("/api/runtime/dfs/v1.0/doc/commit",e)},M.prototype.deleteAttachment=function(e){return this.httpSvc["delete"]("/api/runtime/dfs/v1.0/doc",e)},M.prototype.uploadSignature=function(e){var t=this.httpSvc.setHeader({body:e,responseType:"text"});return this.httpSvc.request("Post","/api/runtime/dfs/v1.0/doc",t)},M.prototype.createNM=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},M.prototype.getUserInfo=function(){return this.httpSvc.get("/api/runtime/sys/v1.0/userinfos?infoType=user")},M.prototype.getUserSign=function(e){var t="/api/runtime/dfs/v1.0/formdoc/fileinfo/form?formid="+e+"&rootid=taskcentersignature";return this.httpSvc.get(t)},M.prototype.createItem=function(e){var t=e.fileName.lastIndexOf("."),s=e.fileName.substring(t+1);return s=""==s?"Default":s.toLowerCase(),s=0<="doc-docx-htm-html-js-pdf-ppt-pptx-rar-zip-txt-xls-xlsx".indexOf(s)?s.toLowerCase():0<="wav-aif-aiff-au-mp1-mp2-mp3-ra-rm-ram-mid-rmi".indexOf(s)?"video":0<="avi-rm-rmvb-mpeg-mpg-dat-mov-qt-asf-wm-mp4".indexOf(s)?"audio":0<="webp-baibmp-dupcx-tif-gif-jpeg-tga-exif-fpx-svg-psd-cdr-pcd-dxf-ufo-eps-ai-png-hdri-raw-wmf-flic-emf-ico-jpg".indexOf(s)?"picture":"default"},M.prototype.subjectRegister=function(e,t){return window.gspframeworkService.rtf.broadcast.subjectRegister(e,{funcId:t})},M.prototype.subjectNotify=function(e,t){window.gspframeworkService.rtf.broadcast.notify(e,t)},M.prototype.subjectResponse=function(e,t,s){window.gspframeworkService.rtf.broadcast.response(e,t,s)},M.prototype.urgeHandleSimulate=function(e){return this.httpSvc.post("/api/runtime/wf/v1.0/processInstances/getUrgeHandleInfo",e)},M.prototype.urgeHandle=function(e){return this.httpSvc.post("/api/runtime/wf/v1.0/processInstances/urgeHandle",e)},M.prototype.batchVerifySigned=function(e){return this.httpSvc.post("/api/runtime/wf/v1.0/workItems/batchVerifySigned",e)},M.prototype.getWfUserHelpConfig=function(){var e="/platform/runtime/wf/web/wf-user-help/config.json?v="+(new Date).getTime();return this.httpSvc.get(e)},M.prototype.getAdhocConfig=function(e){var t="/api/runtime/wf/v1.0/workItems/"+e+"/adhocConfig/AddSignBehind";return this.httpSvc.get(t)},M.prototype.adhocAssignee=function(e){return this.httpSvc.post("/api/runtime/wf/v1.0/workItems/adhocAssignee",e)},M.prototype.cancelConsult=function(e){return this.httpSvc.post("/api/runtime/wf/v1.0/workItems/cancelConsult",e)},M.decorators=[{type:S.Injectable}],M.ctorParameters=function(){return[{type:T.HttpService},{type:x.MessagerService}]},M);function M(e,t){this.httpSvc=e,this.message=t}var O,F=(j(L,O=function $e(){}),L);function L(){return null!==O&&O.apply(this,arguments)||this}var B={"zh-CHS":{"static":{assignee:{title:"请选择用户",noAssignee:"请选择办理人员",successAssign:"操作成功"},transfer:{title:"请选择用户",selectHandover:"请选择用户",successTransfer:"任务移交成功"},columnName:{name:"名称",code:"编号",department:"组织信息"},comment:{successComment:"任务评论成功"},title:"审批确认",inputLabel:"审批意见",inputHolder:"请输入审批意见",selectActivity:"下一环节",footOk:"确定",footCancel:"取消",selectUser:"选择用户",hideComment:"意见隐藏"},cueWords:{successClaim:"领用成功",successUnClaim:"取消领用成功",successRetrieve:"任务取回成功",successPass:"审批通过",successBack:"驳回成功",successRefuse:"否决成功",success:"操作成功",inputOpinion:"请输入审批意见",selectNode:"请选择下一环节",select:"请选择",processor:"办理人",attachmentsRequired:"请上传附件",assignUser:"指派"},task:{selectPlaceholder:"请选择",passComment:"通过",processAlone:"请单独处理",urgeText:"接收人员",backNodeText:"驳回节点",selectProcessor:"请选择办理人员",notFoundBill:"该单据不支持在电脑端办理，请尝试去移动端进行办理",nextNodeText:"下一环节",assignText:"办理人员",noUser:"无",title:"任务办理",noTask:"未找到对应的任务",commentTooLong:"审批意见超长",activityName:"办理人员",receiver:"接收人员",urgeComment:"请输入催办信息",noUrgeUsers:"没有符合条件的催办用户",noUrgeSubject:"消息主题未配置",noUrgeContent:"消息内容未配置",person:"人员",addSign:"加签"},startProcess:{selectProcess:"请选择流程",title:"选择流程",selectNode:"请选择下一环节",submitSuccess:"提交审批成功",submitFailed:"提交审批失败",cancelSubmitSuccess:"取消提交成功",cancelSubmitFailed:"取消提交失败",dataIdIsNull:"请选择一条数据",dataIdIsEmpty:"请选择一条数据",bizDefKeyIsNull:"流程分类ID不能为空",success:"取消成功",row:"条<br/>",failed:"取消失败",node:"节点，",noUser:"没有找到合适的办理人"},batchSubmit:{row:"条，<br/>",success:"办理成功",error:"办理失败",failed:"需要交互",single:"失败的任务请单独处理"},batchStartProcess:{row:"条，<br/>",success:"提交成功",error:"提交失败",failed:"需要交互",validationFailed:"验签失败",single:"失败的单据请单独处理"},comment:{"static":{title:"常用意见管理",add:"新增","delete":"删除",save:"保存",cancel:"取消",content:"常用意见",order:"顺序",inputLabel:"常用意见",manage:"意见管理",attachmentUpload:"附件",repeatFile:"包含重复文件：",type:"类别",operate:"操作",confirm:"确认",clickToAdd:"新增常用意见","public":"公有","private":"个人",messageSubject:"消息主题",messageContent:"消息内容"},attachment:{tips:"点击上传附件"},signature:{title:"签名",reset:"清空",ok:"确定",sign:"手写签名，",upload:"上传图片",tips:"点击设置签名",dialogTitle:"电子签名",note1:"电子签名可",note2:"也可通过",note3:"进行设置",disable:"不启用签名"}},addSign:{allowSignToSign:"允许再",multiInstanceType:"多人审批方式",parallel:"并行会签",preempt:"任意人处理",sequential:"按顺序依次处理"},backWardConfig:{allowResubmitToThisNode:"后再次提交时直接回到本节点"}},en:{"static":{assignee:{title:"Select Operator",noAssignee:"Please select at least one approver.",successAssign:"Operate successfully."},transfer:{title:"Select transfer person",selectHandover:"Please select transfer persons.",successTransfer:"Transfer successfully."},comment:{successComment:"Comment success."},columnName:{name:"Name",code:"Code",department:"Department"},title:"Approval confirmation",inputLabel:"Approval comments",inputHolder:"Please enter an approval opinion",selectActivity:"Please select approve note",addSignee:"Add signee",footOk:"OK",footCancel:"Cancel",selectUser:"Select User",hideComment:"Hide comment"},cueWords:{successClaim:"Claim successfully.",successUnClaim:"Cancel to claim successfully.",successRetrieve:"Retrieve successfully.",successPass:"Approved successfully.",successBack:"Dismissed successfully.",successRefuse:"Veto successfully.",success:"Operate successfully.",inputOpinion:"Please input your opinion",selectNode:"Please select target nodes",select:"Please select",processor:"processor",attachmentsRequired:"Please upload the attachment",assignUser:"Assign user"},task:{selectPlaceholder:"Please select",passComment:"Pass",processAlone:"Please handle it separately",urgeText:"Receiver",backNodeText:"Back node",selectProcessor:"Please select the user",notFoundBill:"This document cannot be processed on the computer. Please try to process it on the mobile terminal",nextNodeText:"Next node",assignText:"Assign to",noUser:"No one",title:"Handle Task",noTask:"There is no task.",commentTooLong:"Comment is too long",activityName:"processor",receiver:"receiver",urgeComment:"Please input your comment",noUrgeUsers:"There is no user to urge handle",noUrgeSubject:"no urge subject",noUrgeContent:"no urge content",person:" people",addSign:"Add sign"},startProcess:{selectProcess:"Please select process",title:"Select process",selectNode:"Please select next node",submitSuccess:"Start process successfully",submitFailed:"Start process failed",cancelSubmitSuccess:"Cancel submit successfully",cancelSubmitFailed:"Cancel submit failed",dataIdIsNull:"Please select a data",dataIdIsEmpty:"Please select a data",bizDefKeyIsNull:"Biz definition key is null",success:"Success",row:"",failed:", failed",node:"node, ",noUser:"no suitable handler was found"},batchSubmit:{row:"",success:"Success",error:"Error",failed:"Failed",validationFailed:"Signature verification failed",single:"Failed tasks please process it singly"},batchStartProcess:{row:"<br/>",success:"Success",error:"Error",failed:"Failed",single:"Failed tasks please process it singly"},comment:{"static":{title:"Approval comments",add:"Add","delete":"Delete",save:"Save",cancel:"Cancel",content:"Content",order:"Order",inputLabel:"Comments",manage:"Comments management",attachmentUpload:"Attachment",repeatFile:"Contains repeat files:",type:"Type",operate:"Operate",confirm:"Confirm",clickToAdd:"Click to add","public":"public","private":"private",messageSubject:"message subject",messageContent:"message content"},attachment:{tips:"click to upload attachments"},signature:{title:"Signature",reset:"Reset",ok:"OK",sign:"Sign, ",upload:"Upload",tips:"click to sign or upload a picture",dialogTitle:"Signature",note1:"",note2:"or",note3:"",disable:"disable signature"}},addSign:{allowSignToSign:"Allow",multiInstanceType:"Multi instance type",parallel:"parallel",preempt:"preempt",sequential:"sequential"},backWardConfig:{allowResubmitToThisNode:",resubmit to this node"}},"zh-CHT":{"static":{assignee:{title:"請選擇用戶",noAssignee:"請選擇辦理人員",successAssign:"操作成功"},transfer:{title:"請選擇用戶",selectHandover:"請選擇用戶",successTransfer:"任務移交成功"},columnName:{name:"名稱",code:"編號",department:"組織信息"},comment:{successComment:"任務評論成功"},title:"審批確認",inputLabel:"審批意見",inputHolder:"請輸入審批意見",selectActivity:"下一環節",addSignee:"加簽人員",footOk:"確定",footCancel:"取消",selectUser:"選擇用戶",hideComment:"意見隱藏"},cueWords:{successClaim:"領用成功",successUnClaim:"取消領用成功",successRetrieve:"任務取回成功",successPass:"審批通過",successBack:"駁回成功",successRefuse:"否決成功",success:"操作成功",inputOpinion:"請輸入審批意見",selectNode:"請選擇下一環節",select:"請選擇",processor:"辦理人",attachmentsRequired:"請上傳附件",assignUser:"指派"},task:{selectPlaceholder:"請選擇",passComment:"通過",processAlone:"請單獨處理",urgeText:"接收人员",backNodeText:"駁回節點",selectProcessor:"請選擇辦理人員",notFoundBill:"該單據不支持在電腦端辦理，請嘗試去移動端進行辦理",nextNodeText:"下一環節",assignText:"辦理人員",noUser:"無",title:"任務辦理",noTask:"未找到對應的任務",commentTooLong:"審批意見超長",activityName:"辦理人員",receiver:"接收人員",urgeComment:"請輸入催辦信息",noUrgeUsers:"沒有符合條件的催辦用戶",noUrgeSubject:"消息主題未配置",noUrgeContent:"消息內容未配置",person:"人员",addSign:"加签"},startProcess:{selectProcess:"請選擇流程",title:"選擇流程",selectNode:"請選擇下一環節",submitSuccess:"提交審批成功",submitFailed:"提交審批失敗",cancelSubmitSuccess:"取消提交成功",cancelSubmitFailed:"取消提交失敗",dataIdIsNull:"請選擇一條數據",dataIdIsEmpty:"請選擇一條數據",bizDefKeyIsNull:"流程分類ID不能為空",success:"取消成功",row:"條<br/>",failed:"取消失敗",node:"節點，",noUser:"沒有找到合適的辦理人"},batchSubmit:{row:"條，<br/>",success:"辦理成功",error:"辦理失敗",failed:"需要交互",single:"失敗的任務請單獨處理"},batchStartProcess:{row:"條，<br/>",success:"提交成功",error:"提交失敗",failed:"需要交互",validationFailed:"驗簽失敗",single:"失敗的單據請單獨處理"},comment:{"static":{title:"常用意見管理",add:"新增","delete":"刪除",save:"保存",cancel:"取消",content:"常用意見",order:"順序",inputLabel:"常用意見",manage:"意見管理",attachmentUpload:"附件",repeatFile:"包含重復文件：",type:"類別",operate:"操作",confirm:"確認",clickToAdd:"新增常用意見","public":"公有","private":"個人",messageSubject:"消息主題",messageContent:"消息內容"},attachment:{tips:"點擊上傳附件"},signature:{title:"簽名",reset:"清空",ok:"確定",sign:"手寫簽名，",upload:"上傳圖片",tips:"點擊設置簽名",dialogTitle:"電子簽名",note1:"電子簽名可",note2:"也可通過",note3:"進行設置",disable:"不啟用簽名"}},addSign:{allowSignToSign:"允許再",multiInstanceType:"多人審批方式",parallel:"並行會簽",preempt:"任意人處理",sequential:"按順序依次處理"},backWardConfig:{allowResubmitToThisNode:"后再次提交时直接回到本节点"}}},z=(R.prototype.getValue=function(e){return e?-1===e.indexOf(".")?this.langData[e]:e.split(".").reduce(function(e,t){return e?e[t]:null},this.langData):""},R.decorators=[{type:S.Injectable}],R.ctorParameters=function(){return[]},R);function R(){this.defaultLang=localStorage.getItem("languageCode"),this.defaultLang?this.langData=B[this.defaultLang]:this.langData=B["zh-CHS"]}var W,_=function Xe(){},q=function Ze(){},K=function Qe(){},G=function Ye(){},J=function et(){},$="If_Show_Submit_Dialog",X="Info_After_Submit",Z="Info_After_Cancel_Submit",Q="If_Use_Sign_By_Default",Y="If_Show_Attachment",ee="If_Show_Signature",te="Default_Approval_Comment",se="If_Store_Comment",ne="If_Can_Edit_Signature",ie="bizdefkey",re=function tt(){};j(oe,W=re);function oe(){return null!==W&&W.apply(this,arguments)||this}var ae,ce=function st(){};j(le,ae=function nt(){});function le(){return null!==ae&&ae.apply(this,arguments)||this}var ue=function it(){},de=function rt(){},pe=function ot(){},fe=(he.prototype.ngOnInit=function(){},he.decorators=[{type:S.Component,args:[{selector:"urge-handle",template:'<div class="wf-task-handler-help-div">\r\n  <div class="wf-task-handler-help-text">\r\n    {{ "comment.static.messageSubject" | translate }}\r\n  </div>\r\n  <div class="farris-input-wrap">\r\n    <input\r\n      class="form-control"\r\n      type="text"\r\n      value="subject"\r\n      name="subject"\r\n      [placeholder]="placeholder"\r\n      [(ngModel)]="urgeMessageSubject"\r\n      [readOnly]="!subjectEditable"\r\n    />\r\n  </div>\r\n</div>\r\n\r\n<div class="wf-task-handler-help-div">\r\n  <div class="wf-task-handler-help-text">\r\n    {{ "comment.static.messageContent" | translate }}\r\n  </div>\r\n  <textarea\r\n    class="form-control content-textarea"\r\n    [(ngModel)]="urgeMessageContent"\r\n    [attr.placeholder]="placeholder"\r\n    [style.height.px]="textAreaHeight"\r\n    [readOnly]="!contentEditable"\r\n  ></textarea>\r\n</div>\r\n',styles:["",".wf-task-handler-help-div{font-size:13px;color:#2d2f33;margin-bottom:20px}.wf-task-handler-help-div-submit{margin-bottom:20px}.wf-task-handler-help-text{padding-bottom:8px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}"]}]}],he.ctorParameters=function(){return[]},he.propDecorators={placeholder:[{type:S.Input}],showMessageSubject:[{type:S.Input}],textAreaHeight:[{type:S.Input}],urgeMessageSubject:[{type:S.Input}],urgeMessageContent:[{type:S.Input}],subjectEditable:[{type:S.Input}],contentEditable:[{type:S.Input}]},he);function he(){this.placeholder="",this.showMessageSubject=!1,this.subjectEditable=!1,this.contentEditable=!1}var me,ge={Preempt:"Preempt",Parallel:"Parallel",Sequential:"Sequential"};j(ve,me=function at(){});function ve(){return null!==me&&me.apply(this,arguments)||this}var be,ye=(j(Se,be=f.ActionBaseImplComponent),Se.prototype.ngAfterViewInit=function(){},Se.prototype.ngOnInit=function(){var r=this,o=this.loadingService.show();this.taskService.getAllUserConfig().subscribe(function(e){o.close();var t,s,n=(r.configList=e).find(function(e){return e.configCode===te}),i=e.find(function(e){return e.configCode===se});n&&n.currentValue&&(t=JSON.parse(n.currentValue).pass,s=JSON.parse(n.currentValue).back,"Pass"===r.actionEntity.code&&(r.comment=t),"Back"===r.actionEntity.code&&(r.comment=s)),i&&"true"===i.currentValue&&r.wfCacheComment&&("Back"==r.actionEntity.code&&r.wfCacheComment==t||(r.comment=r.wfCacheComment))},function(){o.close()}),this.origin===f.ActionOrigin.TaskForm&&(this.initFormEvent(),this.taskService.getAppInfo(this.workItemId).subscribe(function(e){e&&e.billMethodConfigs&&e.billMethodConfigs.length&&(r.billMethodConfigs=e.billMethodConfigs)})),(new ce).procInstId=this.processInstanceId},Se.prototype.addMessageListener=function(){window.addEventListener("message",this.eventHandler,!1),Se.func=this.eventHandler},Se.prototype.setTask=function(e){e&&(this.task=e,this.workItemId=e.sourceId,this.processInstanceId=e.processInstanceId,this.wfContext.processCategoryId=e.categoryId)},Se.prototype.setAction=function(e){e&&(this.actionEntity=e,this.task&&this.execute(this.actionEntity))},Se.prototype.initFormEvent=function(){var s=this,n=this.workItemId+"action",i="FormSubjectCode";window.gspWfEventService=window.gspWfEventService||{},window.gspWfEventService.register=function(e){s.taskService.subjectRegister(i,n),s.ifRegistered=!0,s.formObject=e},window.gspWfEventService.notify=function(e){if(s.ifRegistered)s.taskService.subjectNotify(n,e);else{var t=s.workItemId+"simulate";s.taskService.subjectRegister(i,t),s.taskService.subjectResponse(t,"",function(e){e&&e.dataChanged&&s.completeSimulate()}),s.taskService.subjectNotify(t,e)}}},Se.prototype.beforeCompleteSubmit=function(){var t=this,e=this.billMethodConfigs.filter(function(e){return e.action===t.actionEntity.code&&"Pre"===e.executionTime}).sort(function(e,t){return e.sortOrder-t.sortOrder});e&&e.length?this.executeFormActions(E(e)):this.completeSubmit()},Se.prototype.executeFormActions=function(s){var n=this;if(0<s.length){this.messageSubject=new C.Subject,this.messageSubject.subscribe(function(e){console.log(e.data);var t=e.data.data;if(!0!==t.result)throw n.subject.next({result:!1,isClose:!1}),new Error("审批前表单操作执行失败！");!0===t.dataChanged?n.completeSimulate().subscribe(function(e){e?n.executeFormActions(s):n.subject.next({result:!1,isClose:!1})}):n.executeFormActions(s)});var e=s.shift();this.sendMessage(this.workItemId,e)}else this.completeSubmit()},Se.prototype.execute=function(e){switch(e.code){case"AssignUser":this.assignSimulate();break;case"Claim":this.showAttachment=!1;break;case"Unclaim":case"Retrieve":break;case"Transfer":this.transferSimulate();break;case"AddSign":this.addSignSimulate();break;case"AddSignFront":this.addSignFrontSimulate();break;case"Notify":this.notifySimulate();break;case"Refuse":case"Obsolete":case"Comment":break;case"ReadTask":this.ifShowCommentToMySelf=!0,this.dialogHeight=340;break;case"UrgeHandle":this.urgeHandleSimulate();break;case"CancelConsult":break;default:this.completeSimulate()}},Se.prototype.submit=function(){switch(this.actionEntity.code){case"AssignUser":this.assignSubmit();break;case"Claim":this.claimSubmit();break;case"Unclaim":this.unClaimSubmit();break;case"Retrieve":this.retrieveSubmit();break;case"Transfer":this.transferSubmit();break;case"AddSign":this.addSignSubmit();break;case"AddSignFront":this.addSignFrontSubmit();break;case"Comment":this.commentSubmit();break;case"Notify":this.notifySubmit();break;case"ReadTask":this.readSubmit();break;case"UrgeHandle":this.urgeHandleSubmit();break;case"CancelConsult":this.cancelConsultSubmit();break;default:this.beforeCompleteSubmit()}return this.subject.asObservable()},Se.prototype.batchSubmit=function(c){var e,t,l=this,u=0,d=new C.BehaviorSubject(null),p={result:!0,isClose:!0};if("Back"!==this.actionEntity.code&&"Refuse"!==this.actionEntity.code||this.comment)if(300<this.comment.length)this.notify.warning(this.i18nService.getValue("task.commentTooLong")),d.next({result:!1,isClose:!1});else{var s=c.filter(function(e){return-1===e.actions.findIndex(function(e){return e.code===l.actionEntity.code})});if(s&&0<s.length)try{for(var n=D(s),i=n.next();!i.done;i=n.next())i.value,++u===c.length&&(d.next(p),this.showBatchSubmitInfo(0,u,0,0))}catch(r){e={error:r}}finally{try{i&&!i.done&&(t=n["return"])&&t.call(n)}finally{if(e)throw e.error}}var f=c.filter(function(e){return e.actions.some(function(e){return e.code===l.actionEntity.code})});f&&0<f.length&&this.executeBatchEvent(E(this.actionEntity.preEvents.filter(function(e){return e.batch})),f,this.actionEntity,function(e){var t,s;if(e&&e.result){if(e.passTasks){var n=f.filter(function(t){return-1===e.passTasks.findIndex(function(e){return e===t.id})});if(n&&0<n.length)try{for(var i=D(n),r=i.next();!r.done;r=i.next())r.value,++u===c.length&&(d.next(p),l.showBatchSubmitInfo(0,u,0,0))}catch(a){t={error:a}}finally{try{r&&!r.done&&(s=i["return"])&&s.call(i)}finally{if(t)throw t.error}}f=f.filter(function(t){return-1<e.passTasks.findIndex(function(e){return e===t.id})})}if(0<f.length){var o=new de;l.batchverifySubmit(f,u,o).subscribe(function(e){e&&e.successSubmit&&e.successSubmit.result&&l.executeBatchEvent(E(l.actionEntity.postEvents.filter(function(e){return e.batch})),e.successHandleTasks,l.actionEntity,function(){d.next(e.successSubmit)},{result:!0,passTasks:e.successHandleTasks.map(function(e){return e.id})})})}}else d.next({result:!1,isClose:!1})},{result:!0,passTasks:f.map(function(e){return e.id})})}else this.notify.warning(this.i18nService.getValue("cueWords.inputOpinion")),d.next({result:!1,isClose:!1});return d.asObservable()},Se.prototype.batchverifySubmit=function(s,n,i){var r=this;void 0===n&&(n=0);var o=new C.Subject,a=s.filter(function(e){var t=e.actions.find(function(e){return e.code===r.actionEntity.code});return!!t&&!!t.parameters.some(function(e){return"CertificationNecessary"===e.code&&"true"===e.value})}),c=a.length;if(0<a.length){var l=this;window.gspframeworkService&&window.gspframeworkService.rtf&&window.gspframeworkService.rtf.caEvent.on(window.gspframeworkService.rtf.caEvent.signedMsgOverToken(),"signedMsgOver",function(e){if(e&&"true"===e[0]&&0<e.length){var t=gspCA.getCurCert();l.verifySigned={certBase64Info:gspCA.getCertBase64(t),msg:["BatchDigitalSignature"],signedmsg:e[1][0],useCase:null},i.verifySigned=l.verifySigned,l.taskService.batchVerifySigned(i).subscribe(function(){l.batchComplete(s,n,0).subscribe(function(e){o.next(e)})},function(e){var t=s.filter(function(t){return-1===a.findIndex(function(e){return e.id===t.id})});l.batchComplete(t,n,c).subscribe(function(e){o.next(e)})})}else l.notify.error(e[1]),o.next({successSubmit:{result:!1,isClose:!1},successHandleTasks:new Array})}),gspCA.getSignedMsg(["BatchDigitalSignature"])}else this.batchComplete(s,n,c).subscribe(function(e){o.next(e)});return o.asObservable()},Se.prototype.batchComplete=function(n,i,r){var e,t,o=this;function s(t){var s=new q;s.workItemId=t.sourceId,s.conclusionValue=h.actionEntity.code,s.comment=h.comment,s.addendum=h.addendum,h.taskService.completeSimulate(s).subscribe(function(e){e&&!0===e.needInteraction?c+ ++l+u===n.length&&(f.close(),a.next({successSubmit:d,successHandleTasks:p}),o.showBatchSubmitInfo(c,l+i,u,r)):o.taskService.complete(s).subscribe(function(){c++,p.push(t),c+l+u===n.length&&(f.close(),a.next({successSubmit:d,successHandleTasks:p}),o.showBatchSubmitInfo(c,l+i,u,r))},function(){c+l+ ++u===n.length&&(f.close(),a.next({successSubmit:d,successHandleTasks:p}),o.showBatchSubmitInfo(c,l+i,u,r))})},function(){c+l+ ++u===n.length&&(f.close(),a.next({successSubmit:d,successHandleTasks:p}),o.showBatchSubmitInfo(c,l+i,u,r))})}void 0===i&&(i=0);var a=new C.Subject,c=0,l=0,u=0,d={result:!0,isClose:!0},p=new Array,f=this.loadingService.show(),h=this;try{for(var m=D(n),g=m.next();!g.done;g=m.next())s(g.value)}catch(v){e={error:v}}finally{try{g&&!g.done&&(t=m["return"])&&t.call(m)}finally{if(e)throw e.error}}return a.asObservable()},Se.prototype.showBatchSubmitInfo=function(e,t,s,n){var i="";!e||t||s||n?(e&&(i+=this.i18nService.getValue("batchSubmit.success")+"【"+e+"】"+this.i18nService.getValue("batchSubmit.row")),s&&(i+=this.i18nService.getValue("batchSubmit.error")+"【"+s+"】"+this.i18nService.getValue("batchSubmit.row")),t&&(i+=this.i18nService.getValue("batchSubmit.failed")+"【"+t+"】"+this.i18nService.getValue("batchSubmit.row")),n&&(i+=this.i18nService.getValue("batchSubmit.validationFailed")+"【"+n+"】"+this.i18nService.getValue("batchSubmit.row")),i+=this.i18nService.getValue("batchSubmit.single"),this.message.show("warning",i,{safeHtml:!1})):this.notify.success(this.i18nService.getValue("cueWords.success"))},Se.prototype.executeBatchEvent=function(n,i,r,o,a){var c=this;if(this.injector)if(n&&0<n.length&&i&&0<i.length){var e=n.shift(),t=e.eventImpl.split("#")[0],l=e.eventImpl.split("#")[1];System["import"](t+"?v="+(new Date).getTime().toString()).then(function(e){var t=Object.values(e)[0].create(c.injector),s={action:r,taskList:i,origin:"TaskCenter",preEventResult:a};t.instance[l].apply(t.instance,[s]).subscribe(function(e){e&&e.result?c.executeBatchEvent(n,i,r,o,e):o(e)})})}else o(a);else o(a)},Se.prototype.assignSimulate=function(){var t=this;this.showAttachment=!1,this.ifAssignUser=!0,this.dialogHeight+=this.dialogHeightBase,this.taskService.getAssigneeInfo(this.workItemId).subscribe(function(e){t.assignInfos=[{selectedAssignees:e.selectedAssignees,assigneeInfo:e.assigneeInfo,assignees:e.selectedAssignees.map(function(e){return{id:e.id,name:e.name}}),activityName:e.activityDefinitionName,dependency:e.dependency,anonymous:e.anonymous,anonymousText:e.anonymousText,resolved:e.resolved}]},function(e){t.taskService.error(e)})},Se.prototype.transferSimulate=function(){this.ifSelectUser=!0,this.selectUserText=this.actionEntity.name+this.i18nService.getValue("task.person"),this.singleSelect=!0,this.dialogHeight+=this.dialogHeightBase,this.getOrganizationScope()},Se.prototype.addSignFrontSimulate=function(){this.ifSelectUser=!0,this.selectUserText=this.actionEntity.name+this.i18nService.getValue("task.person"),this.dialogHeight+=this.dialogHeightBase,this.getOrganizationScope()},Se.prototype.addSignSimulate=function(){var t=this;this.ifSelectUser=!0,this.selectUserText=this.actionEntity.name+this.i18nService.getValue("task.person"),this.dialogHeight+=2*this.dialogHeightBase;var s=this.loadingService.show();this.taskService.getAdhocConfig(this.workItemId).subscribe(function(e){s.close(),t.addSign.showSignToSign=e.showSignToSign,t.addSign.originMultiInstType=e.multiInstanceType,e.organization&&(t.filter.orgId=e.organization.id,t.filter.withAllOrg=e.organization.includeChildren)},function(e){s.close(),t.taskService.error(e)})},Se.prototype.notifySimulate=function(){this.ifSelectUser=!0,this.selectUserText=this.actionEntity.name+this.i18nService.getValue("task.person"),this.dialogHeight+=this.dialogHeightBase,this.singleSelect=!1,this.getOrganizationScope()},Se.prototype.getOrganizationScope=function(){var t=this,s=this.loadingService.show();this.taskService.getOrganizationScope(this.workItemId,this.actionEntity.code).subscribe(function(e){s.close(),e.length&&(t.filter.orgId=e[0].id,t.filter.withAllOrg=e[0].includeChildren)},function(e){s.close(),t.taskService.error(e)})},Se.prototype.urgeHandleSimulate=function(){var n=this;this.ifSelectNode=!1,this.ifSelectUser=!1,this.ifAssignUser=!1,this.ifUrgeType=!0,this.commentPlaceHolder=this.i18nService.getValue("task.urgeComment"),this.showCommonComment=!1,this.showAttachment=!1,this.showUrgeMessageSubject=!0,this.showSign=!1,this.dialogHeight+=2*this.dialogHeightBase;var i=this.loadingService.show(),e=new ce;e.procInstId=this.processInstanceId,this.taskService.urgeHandleSimulate(e).subscribe(function(e){if(i.close(),(n.urgeHandleResponse=e)&&e.urgeUsers&&e.urgeUsers.length){n.urgeMessageSubject=e.urgeUsers[0].urgeInfos[0].urgeMessageSubject,n.urgeMessageContent=e.urgeUsers[0].urgeInfos[0].urgeMessageContent,n.subjectEditable=e.urgeUsers[0].urgeInfos[0].subjectEditable,n.contentEditable=e.urgeUsers[0].urgeInfos[0].contentEditable,n.addReminder=e.urgeUsers[0].urgeInfos[0].addReminder;var t=e.urgeUsers,s=new J;t.forEach(function(e){e.anonymousText&&(e.name=e.anonymousText,e.code="",e.orgName="")}),s.assigneeUsers=t,s.selectAssignee=1<t.length,s.multiSelect=!0,n.assignInfos[0].assigneeInfo=s,n.assignInfos[0].assignees=1==t.length?t:[]}else n.notify.warning(n.i18nService.getValue("task.noUrgeUsers"))},function(e){i.close(),n.taskService.error(e)})},Se.prototype.completeSimulate=function(){var s=this,n=new C.Subject;this.ifSelectNode=!0,this.ifAssignUser=!0,this.dialogHeight+=2*this.dialogHeightBase,this.actionEntity.parameters&&this.actionEntity.parameters.length&&this.actionEntity.parameters.forEach(function(e){if("AddSignBehindAble"===e.code&&"true"===e.value){s.ifSelectUser=!0,s.selectUserText=s.i18nService.getValue("task.addSign")+s.i18nService.getValue("task.person"),s.dialogHeight+=s.dialogHeightBase;var t=s.loadingService.show();s.taskService.getOrganizationScope(s.workItemId,"AddSignBehind").subscribe(function(e){t.close(),e.length&&(s.filter.orgId=e[0].id,s.filter.withAllOrg=e[0].includeChildren)},function(e){s.taskService.error(e)})}}),"Back"===this.actionEntity.code&&(this.selectNodeText=this.i18nService.getValue("task.backNodeText"));var e=new q;e.workItemId=this.workItemId,e.conclusionValue=this.actionEntity.code;var i=this.loadingService.show();return this.taskService.completeSimulate(e).subscribe(function(e){if(i.close(),s.clearSimulateResult(),s.response=e,s.showBackWardConfig.dynamicBackWardRuleAble=e.dynamicBackWardRuleAble,e.simulationPaths.length){s.destNodes=e.simulationPaths&&e.simulationPaths.map(function(e){return{id:e.nodeInfoList.map(function(e){return e.activityDefinitionId}).join("，"),name:e.nodeInfoList.map(function(e){return e.activityDefinitionName}).join("，")}});var t=e.simulationPaths.findIndex(function(e){return e["default"]});-1<t?(s.selectedNodeId=s.destNodes[t].id,s.nodePlaceholder=-1<s.destNodes[t].name.indexOf("，")?e.simulationPaths[t].name:s.destNodes[t].name,s.setAssignInfo(e.simulationPaths[t].nodeInfoList)):s.nodePlaceholder=s.i18nService.getValue("task.selectPlaceholder")}else s.ifSelectNode=!1,s.ifAssignUser=!1;n.next(!0)},function(e){i.close(),n.next(!1),s.taskService.error(e)}),n.asObservable()},Se.prototype.clearSimulateResult=function(){this.assignInfos=[{selectedAssignees:[],assigneeInfo:null,assignees:[],activityName:"",dependency:"",anonymous:!1,anonymousText:"",resolved:!1}],this.destNodes=[],this.nodePlaceholder="",this.selectedNodeId=""},Se.prototype.setAssignInfo=function(s){var n=this;this.assignInfos=[],this.selectedNodeId.split("，").forEach(function(t){var e=s.find(function(e){return e.activityDefinitionId===t});e?n.assignInfos.push({selectedAssignees:e.selectedAssignees,assigneeInfo:e.assigneeInfo,assignees:e.selectedAssignees.map(function(e){return{id:e.id,name:e.name}}),activityName:e.activityDefinitionName,dependency:e.dependency,anonymous:e.anonymous,anonymousText:e.anonymousText,resolved:e.resolved}):n.assignInfos.push({selectedAssignees:[],assigneeInfo:null,assignees:[],activityName:"",dependency:"",anonymous:!1,anonymousText:"",resolved:!1})}),this.cd.detectChanges()},Se.prototype.assignSubmit=function(){var t=this;if(300<this.comment.length)this.notify.warning(this.i18nService.getValue("task.commentTooLong")),this.subject.next({result:!1,isClose:!1});else if(this.assignInfos[0].assignees.length){var e={workItemId:this.workItemId,assigneeIds:this.assignInfos[0].assignees.map(function(e){return e.id}),comment:this.comment,addendum:this.addendum};this.taskService.assignNextUsersByWorkItemId(e).subscribe(function(){t.notify.success(t.i18nService.getValue("static.assignee.successAssign")),t.subject.next(t.submitResult)},function(e){t.subject.next({result:!1,isClose:!1}),t.taskService.error(e)})}else this.notify.warning(this.i18nService.getValue("static.assignee.noAssignee")),this.subject.next({result:!1,isClose:!1})},Se.prototype.claimSubmit=function(){var t=this;300<this.comment.length?(this.notify.warning(this.i18nService.getValue("task.commentTooLong")),this.subject.next({result:!1,isClose:!1})):this.taskService.claim(this.workItemId,this.comment).subscribe(function(){t.notify.success(t.i18nService.getValue("cueWords.successClaim")),t.submitResult.isClose=!1,t.subject.next(t.submitResult)},function(e){t.subject.next({result:!1,isClose:!1}),t.taskService.error(e)})},Se.prototype.unClaimSubmit=function(){var t=this;300<this.comment.length?(this.notify.warning(this.i18nService.getValue("task.commentTooLong")),this.subject.next({result:!1,isClose:!1})):this.taskService.unClaim(this.workItemId,this.comment).subscribe(function(){t.notify.success(t.i18nService.getValue("cueWords.successUnClaim")),t.subject.next(t.submitResult)},function(e){t.subject.next({result:!1,isClose:!1}),t.taskService.error(e)})},Se.prototype.retrieveSubmit=function(){var t=this;if(300<this.comment.length)this.notify.warning(this.i18nService.getValue("task.commentTooLong")),this.subject.next({result:!1,isClose:!1});else{var e={workItemId:this.workItemId,comment:this.comment};this.taskService.retrieve(e).subscribe(function(){t.notify.success(t.i18nService.getValue("cueWords.successRetrieve")),t.subject.next(t.submitResult)},function(e){t.subject.next({result:!1,isClose:!1}),t.taskService.error(e)})}},Se.prototype.transferSubmit=function(){var t=this;if(300<this.comment.length)this.notify.warning(this.i18nService.getValue("task.commentTooLong")),this.subject.next({result:!1,isClose:!1});else if(0===this.selectedUsers.length)this.notify.warning(this.i18nService.getValue("task.selectPlaceholder")+this.selectUserText),this.subject.next({result:!1,isClose:!1});else{var e={workItemId:this.workItemId,assignee:this.selectedUsers[0],comment:this.comment,addendum:this.addendum};this.submitDisable=!0,this.taskService.transfer(e).subscribe(function(){t.notify.success(t.i18nService.getValue("static.transfer.successTransfer")),t.subject.next(t.submitResult)},function(e){t.subject.next({result:!1,isClose:!1}),t.taskService.error(e)})}},Se.prototype.commentSubmit=function(){var t=this;if(this.comment&&0!==this.comment.length)if(300<this.comment.length)this.notify.warning(this.i18nService.getValue("task.commentTooLong")),this.subject.next({result:!1,isClose:!1});else{var e={workItemId:this.workItemId,comment:this.comment,addendum:this.addendum};this.taskService.comment(e).subscribe(function(){t.notify.success(t.i18nService.getValue("static.comment.successComment")),t.submitResult.isClose=!1,t.subject.next(t.submitResult)},function(e){t.subject.next({result:!1,isClose:!1}),t.taskService.error(e)}),this.comment=""}else this.notify.warning(this.i18nService.getValue("cueWords.inputOpinion")),this.subject.next({result:!1,isClose:!1})},Se.prototype.addSignFrontSubmit=function(){var t=this;if(300<this.comment.length)this.notify.warning(this.i18nService.getValue("task.commentTooLong")),this.subject.next({result:!1,isClose:!1});else if(0===this.selectedUsers.length)this.notify.warning(this.i18nService.getValue("task.selectPlaceholder")+this.selectUserText),this.subject.next({result:!1,isClose:!1});else{var e={workItemId:this.workItemId,action:this.actionEntity.code,assignees:this.selectedUsers,comment:this.comment,addendum:this.addendum};this.submitDisable=!0,this.taskService.addSign(e).subscribe(function(){t.notify.success(t.i18nService.getValue("cueWords.success")),t.subject.next(t.submitResult)},function(e){t.subject.next({result:!1,isClose:!1}),t.taskService.error(e)})}},Se.prototype.addSignSubmit=function(){var t=this;if(300<this.comment.length)this.notify.warning(this.i18nService.getValue("task.commentTooLong")),this.subject.next({result:!1,isClose:!1});else if(0===this.selectedUsers.length)this.notify.warning(this.i18nService.getValue("task.selectPlaceholder")+this.selectUserText),this.subject.next({result:!1,isClose:!1});else{var e={workItemId:this.workItemId,comment:this.comment,conclusionValue:"Pass",signAssignees:this.selectedUsers,actionCode:"AddSignBehind",multiInstanceType:this.addSign.showMultiInstanceType?this.addSign.curMultiInstType:this.addSign.originMultiInstType,counterSignRule:"allPass",completedRule:"all",allowSignToSign:this.addSign.allowSignToSIgn,activityName:"",addendum:this.addendum},s=this.loadingService.show();this.taskService.adhocAssignee(e).subscribe(function(e){t.notify.success(t.i18nService.getValue("cueWords.success")),t.subject.next({result:!0,isClose:!0}),s.close()},function(e){s.close(),t.subject.next({result:!1,isClose:!1}),t.taskService.error(e)})}},Se.prototype.readSubmit=function(){var t=this;if(300<this.comment.length)this.notify.warning(this.i18nService.getValue("task.commentTooLong")),this.subject.next({result:!1,isClose:!1});else{var e={workItemId:this.workItemId,comment:this.comment,addendum:this.addendum,hideComment:this.hideComment};this.taskService.readTask(e).subscribe(function(){t.notify.success(t.i18nService.getValue("cueWords.success")),t.subject.next({result:!0,isClose:!0})},function(e){t.taskService.error(e),t.subject.next({result:!1,isClose:!1})})}},Se.prototype.notifySubmit=function(){var t=this;if(300<this.comment.length)this.notify.warning(this.i18nService.getValue("task.commentTooLong")),this.subject.next({result:!1,isClose:!1});else if(0===this.selectedUsers.length)this.notify.warning(this.i18nService.getValue("task.selectPlaceholder")+this.selectUserText),this.subject.next({result:!1,isClose:!1});else{var e={workItemId:this.workItemId,comment:this.comment,addendum:this.addendum,action:this.actionEntity.code,assignees:this.selectedUsers};this.taskService.addSign(e).subscribe(function(){t.notify.success(t.i18nService.getValue("cueWords.success")),t.subject.next({result:!0,isClose:!1})},function(e){t.subject.next({result:!1,isClose:!1}),t.taskService.error(e)})}},Se.prototype.urgeHandleSubmit=function(){var s=this;if(300<this.comment.length)this.notify.warning(this.i18nService.getValue("task.commentTooLong")),this.subject.next({result:!1,isClose:!1});else if(this.urgeHandleResponse.urgeUsers&&this.urgeHandleResponse.urgeUsers.length)if(this.assignInfos[0].assignees.length)if(this.urgeHandleComponent.urgeMessageSubject)if(this.urgeHandleComponent.urgeMessageContent){var e=new ue;e.procInstId=this.processInstanceId,e.urgeUsers=this.urgeHandleResponse.urgeUsers.filter(function(t){return s.assignInfos[0].assignees.some(function(e){return e.id==t.id})}),e.urgeMessageSubject=this.urgeHandleComponent.urgeMessageSubject,e.urgeMessageContent=this.urgeHandleComponent.urgeMessageContent,e.addReminder=this.addReminder;var t=this.loadingService.show();this.taskService.urgeHandle(e).subscribe(function(e){s.notify.success(s.i18nService.getValue("cueWords.success")),s.subject.next({result:!0,isClose:!1}),t.close()},function(e){t.close(),s.subject.next({result:!1,isClose:!1}),s.taskService.error(e)})}else this.notify.warning(this.i18nService.getValue("task.noUrgeContent")),this.subject.next({result:!1,isClose:!1});else this.notify.warning(this.i18nService.getValue("task.noUrgeSubject")),this.subject.next({result:!1,isClose:!1});else this.notify.warning(this.i18nService.getValue("task.selectPlaceholder")+this.i18nService.getValue("task.receiver")),this.subject.next({result:!1,isClose:!1});else this.notify.warning(this.i18nService.getValue("task.noUrgeUsers")),this.subject.next({result:!1,isClose:!1})},Se.prototype.cancelConsultSubmit=function(){var t=this,e=new re;e.workItemId=this.workItemId,e.comment=this.comment,e.addendum=this.addendum;var s=this.loadingService.show();this.taskService.cancelConsult(e).subscribe(function(){s.close(),t.notify.success(t.i18nService.getValue("cueWords.success")),t.subject.next({result:!0,isClose:!1})},function(e){s.close(),t.subject.next({result:!1,isClose:!1}),t.taskService.error(e)})},Se.prototype.completeSubmit=function(){var e={workItemId:this.workItemId,conclusionValue:this.actionEntity.code,comment:this.comment,signAssignees:this.selectedUsers,nextFlowNodes:[],addendum:this.addendum,dynamicBackWardRule:this.showBackWardConfig.dynamicBackWardRuleAble?this.showBackWardConfig.enable?"backToThisNode":"sequence":""};if(!e.signAssignees.length&&this.response&&this.response.simulationPaths.length){if(this.selectedNodeId){for(var t=[],s=this.selectedNodeId.split("，"),n=0;n<s.length;n++){var i={activityDefinitionId:s[n],activityDefinitionName:this.assignInfos[n].activityName,dependency:this.assignInfos[n].dependency,selectedAssignees:this.assignInfos[n].assigneeInfo?this.assignInfos[n].assignees:[],assigneeInfo:null,resolved:!1,anonymous:this.assignInfos[n].anonymous,anonymousText:this.assignInfos[n].anonymousText};if(this.response&&this.response.simulationPaths.length&&!this.response.simulationPaths[0].id.startsWith("ParallelGateway")&&1==s.length&&s[n].startsWith("UserActivity")&&this.assignInfos[n].resolved&&!this.assignInfos[n].assigneeInfo&&!this.assignInfos[n].selectedAssignees.length){var r=this.assignInfos[n].activityName+this.i18nService.getValue("startProcess.node")+this.i18nService.getValue("startProcess.noUser");return this.notify.warning(r),void this.subject.next({result:!1,isClose:!1})}t.push(i)}e.nextFlowNodes=t}1<this.destNodes.length&&e.nextFlowNodes.length<=0?(this.notify.warning(this.i18nService.getValue("cueWords.selectNode")),this.subject.next({result:!1,isClose:!1})):this.assignInfos.filter(function(e){return e.assigneeInfo&&e.assigneeInfo.selectAssignee&&!e.assignees.length}).length?(this.notify.warning(this.i18nService.getValue("task.selectProcessor")),this.subject.next({result:!1,isClose:!1})):this.completeTask(e)}else this.completeTask(e)},Se.prototype.completeTask=function(e){var t=this,s=this.actionEntity.parameters.find(function(e){return"AttachmentNecessary"===e.code}),n=this.actionEntity.parameters.find(function(e){return"CertificationNecessary"===e.code}),i=this.actionEntity.parameters.find(function(e){return"CommentNecessary"===e.code});if(!s||"true"!==s.value||e.addendum.attachment&&"[]"!==e.addendum.attachment)if(i&&"true"===i.value&&!e.comment)this.notify.warning(this.i18nService.getValue("cueWords.inputOpinion")),this.subject.next({result:!1,isClose:!1});else if(300<this.comment.length)this.notify.warning(this.i18nService.getValue("task.commentTooLong")),this.subject.next({result:!1,isClose:!1});else if(n&&"true"===n.value){this.verifySignature(function(){e.verifySigned=t.verifySigned,t.taskComplete(e)});var r=[this.workItemId];gspCA.getSignedMsg(r)}else this.taskComplete(e);else this.notify.warning(this.i18nService.getValue("cueWords.attachmentsRequired")),this.subject.next({result:!1,isClose:!1})},Se.prototype.executeFormActionsAfterCompleteTask=function(e){var t=this,s=this.billMethodConfigs.filter(function(e){return e.action===t.actionEntity.code&&"Post"===e.executionTime}).sort(function(e,t){return e.sortOrder-t.sortOrder});this.ifRegistered&&this.formObject&&s.length?this.executePostFormActions(s,e):e()},Se.prototype.executePostFormActions=function(t,s){var n=this;if(0<t.length){this.messageSubject=new C.Subject,this.messageSubject.subscribe(function(e){if(console.log(e.data),!0!==e.data.data.result)throw n.subject.next({result:!1,isClose:!1}),new Error("审批后表单操作执行失败！");n.executePostFormActions(t,s)});var e=t.shift();this.sendMessage(this.workItemId,e)}else s()},Se.prototype.afterConfirmForTransfer=function(e){e&&e.length?(this.selectedUsers=e.map(function(e){return e.id}),this.selectedUserNgModule=e.map(function(e){return e.name}).join()):this.selectedUsers=[],"AddSign"==this.actionEntity.code&&this.addSign.originMultiInstType==ge.Preempt.toString()&&1<this.selectedUsers.length?this.addSign.showMultiInstanceType=!0:this.addSign.showMultiInstanceType=!1},Se.prototype.cancel=function(){return this.submitResult.isClose=!1,this.subject.next(this.submitResult),this.subject.asObservable()},Se.prototype.getSubject=function(){return this.subject.asObservable()},Se.prototype.selectNodeChange=function(e){var t=this;if(this.selectedNodeId=e&&e.data&&e.data.id,this.response.simulationPaths[e.index].nodeInfoList.every(function(e){return!0===e.resolved}))this.setAssignInfo(this.response.simulationPaths[e.index].nodeInfoList);else{var s=this.selectedNodeId.split("，").map(function(e){return'"'+e+'"'}).join(),n=this.loadingService.show();this.taskService.getSimulationAssigneeInfo(this.workItemId,s).subscribe(function(e){n.close(),t.setAssignInfo(e)},function(e){n.close(),t.taskService.error(e)})}},Se.prototype.selectNodeClear=function(){this.selectedNodeId=null,this.assignInfos=[{selectedAssignees:[],assigneeInfo:null,assignees:[],activityName:"",dependency:"",anonymous:!1,anonymousText:"",resolved:!1}]},Se.prototype.afterConfirmForAssign=function(e,t){this.assignInfos[t].assignees=e},Se.prototype.addAttachment=function(e){this.addendum.attachment=JSON.stringify(e)},Se.prototype.addSignature=function(e){if(e){var t={id:e,waterMarking:null};this.addendum.signature=JSON.stringify(t)}else this.addendum.signature=""},Se.prototype.addPadding=function(){this.cls="f-utils-fill-flex-column h-100 px-4 py-2"},Se.prototype.sendMessage=function(e,t){if(!this.iframe)throw new Error("表单尚未加载!");var s=this.iframe.nativeElement.contentWindow,n={target:e,data:{command:t.method,arguments:t.methodParameters}};s.postMessage(n,this.POST_MESSAGE_TARGET)},Se.prototype.verifySignature=function(s){var n=this;window.gspframeworkService&&window.gspframeworkService.rtf&&window.gspframeworkService.rtf.caEvent.on(window.gspframeworkService.rtf.caEvent.signedMsgOverToken(),"signedMsgOver",function(e){if(!(e&&"true"===e[0]&&0<e.length))throw n.loadingService.close(),n.subject.next({result:!1,isClose:!1}),n.notify.error(e[1]),new Error(e[1]);var t=gspCA.getCurCert();n.verifySigned={certBase64Info:gspCA.getCertBase64(t),msg:[n.workItemId],signedmsg:e[1][0],useCase:null},s()})},Se.prototype.taskComplete=function(n){var i=this;this.taskService.complete(n).subscribe(function(s){i.executeFormActionsAfterCompleteTask(function(){if(s.needInteraction){i.origin==f.ActionOrigin.TaskCenter?i.subject.next({result:!0,isClose:!1}):i.subject.next({result:!1,isClose:!1}),i.notify.info(i.i18nService.getValue("cueWords.select")+"【"+s.nextFlowNodes[0].activityDefinitionName+"】"+i.i18nService.getValue("cueWords.processor"));var e=new _,t=new F;e.sourceId=s.nextFlowNodes[0].assigneeInfo.workItemId,t.code="AssignUser",t.name=i.i18nService.getValue("cueWords.assignUser"),i.handlerService.execute(e,t).subscribe(function(e){e&&i.subject.next({result:!0,isClose:!0})})}else"Pass"===n.conclusionValue?i.notify.success(i.i18nService.getValue("cueWords.successPass")):"Back"===n.conclusionValue?i.notify.success(i.i18nService.getValue("cueWords.successBack")):i.notify.success(i.i18nService.getValue("cueWords.success")),i.subject.next({result:!0,isClose:!0})})},function(e){i.subject.next({result:!1,isClose:!1}),i.taskService.error(e)})},Se.func=null,Se.decorators=[{type:S.Component,args:[{selector:"lib-task-execute",template:'\x3c!-- 意见输入 --\x3e\r\n<wf-comment\r\n  *ngIf="!showUrgeMessageSubject"\r\n  class="w-100"\r\n  name="comment"\r\n  [(ngModel)]="comment"\r\n  [placeholder]="commentPlaceHolder"\r\n  [processInstanceId]="processInstanceId"\r\n  [showAttachment]="showAttachment"\r\n  [showCommonComment]="showCommonComment"\r\n  [showSign]="showSign"\r\n  [textAreaHeight]="textAreaHeight"\r\n  [TaskCenterConfig]="configList"\r\n  (attachment)="addAttachment($event)"\r\n  (signature)="addSignature($event)"\r\n>\r\n</wf-comment>\r\n\r\n\x3c!--催办消息--\x3e\r\n<urge-handle\r\n  *ngIf="showUrgeMessageSubject"\r\n  [placeholder]="commentPlaceHolder"\r\n  [showMessageSubject]="showUrgeMessageSubject"\r\n  [urgeMessageSubject]="urgeMessageSubject"\r\n  [urgeMessageContent]="urgeMessageContent"\r\n  [subjectEditable]="subjectEditable"\r\n  [contentEditable]="contentEditable"\r\n  [textAreaHeight]="textAreaHeight"\r\n>\r\n</urge-handle>\r\n\r\n\x3c!-- 审批记录隐藏（仅对自己可见） --\x3e\r\n<div\r\n  *ngIf="ifShowCommentToMySelf"\r\n  class="custom-control custom-checkbox custom-control-inline"\r\n  style="margin-bottom: 10px"\r\n>\r\n  <input\r\n    type="checkbox"\r\n    class="custom-control-input"\r\n    [(ngModel)]="hideComment"\r\n    id="taskcenterhidecomment"\r\n    name="taskcenterhidecomment"\r\n  />\r\n  <label class="custom-control-label" for="taskcenterhidecomment">{{\r\n    "static.hideComment" | translate\r\n  }}</label>\r\n</div>\r\n\r\n\x3c!-- 下一环节 --\x3e\r\n<div *ngIf="ifSelectNode" class="wf-task-handler-help-div">\r\n  <div class="wf-task-handler-help-text">{{ selectNodeText }}</div>\r\n  <div class="d-flex" style="flex: 1">\r\n    <farris-combo-list\r\n      style="flex: 1"\r\n      [data]="destNodes"\r\n      [editable]="false"\r\n      [textField]="\'name\'"\r\n      [valueField]="\'id\'"\r\n      [idField]="\'id\'"\r\n      [readonly]="destNodes.length > 1 ? false : true"\r\n      (selectChange)="selectNodeChange($event)"\r\n      (clear)="selectNodeClear()"\r\n      [placeholder]="nodePlaceholder"\r\n      [forcePlaceholder]="true"\r\n    >\r\n    </farris-combo-list>\r\n  </div>\r\n</div>\r\n\r\n\x3c!-- 办理人员（指派） --\x3e\r\n<div *ngIf="ifAssignUser || ifUrgeType">\r\n  <lib-assignee-info\r\n    *ngFor="let assignInfo of assignInfos; let i = index"\r\n    [assigneeInfo]="assignInfo.assigneeInfo"\r\n    [setAnonymous]="assignInfo.anonymous"\r\n    [setAnonymousText]="assignInfo.anonymousText"\r\n    [selectedAssignees]="assignInfo.selectedAssignees"\r\n    [activityName]="\r\n      assignInfos.length > 1\r\n        ? assignInfo.activityName\r\n        : ifUrgeType\r\n        ? (\'task.urgeText\' | translate)\r\n        : \'\'\r\n    "\r\n    [ifShowBlank]="assignInfos.length > 1 ? false : true"\r\n    [wfContext]="wfContext"\r\n    (afterConfirm)="afterConfirmForAssign($event, i)"\r\n  ></lib-assignee-info>\r\n</div>\r\n\r\n\x3c!-- 移交、加签、征询、知会 人员帮助--\x3e\r\n<lib-assignee-info\r\n  *ngIf="ifSelectUser"\r\n  [activityName]="selectUserText"\r\n  [singleSelect]="singleSelect"\r\n  [filter]="filter"\r\n  [disabled]="false"\r\n  [placeholder]="\'task.selectPlaceholder\' | translate"\r\n  [allowGlobalAssign]="true"\r\n  [wfContext]="wfContext"\r\n  (afterConfirm)="afterConfirmForTransfer($event)"\r\n>\r\n</lib-assignee-info>\r\n\r\n\x3c!-- 加签 --\x3e\r\n\x3c!-- 审批策略 --\x3e\r\n<div *ngIf="addSign.showMultiInstanceType" class="wf-task-handler-help-div">\r\n  <div class="wf-task-handler-help-text">\r\n    {{ "addSign.multiInstanceType" | translate }}\r\n  </div>\r\n  <div class="d-flex" style="flex: 1">\r\n    <farris-radiogroup\r\n      [(ngModel)]="addSign.curMultiInstType"\r\n      [data]="addSign.multiInstanceType"\r\n      [horizontal]="true"\r\n    >\r\n    </farris-radiogroup>\r\n  </div>\r\n</div>\r\n\r\n\x3c!-- 允许再加签 --\x3e\r\n<div *ngIf="addSign.showSignToSign" class="wf-task-handler-help-div">\r\n  <div class="wf-task-handler-help-text">\r\n    {{ "addSign.allowSignToSign" | translate }}{{ actionEntity.name }}\r\n  </div>\r\n  <farris-switch\r\n    [(ngModel)]="addSign.allowSignToSIgn"\r\n    [size]="\'small\'"\r\n    trueValue="true"\r\n    falseValue="false"\r\n  >\r\n  </farris-switch>\r\n</div>\r\n\r\n\x3c!-- 驳回后再次提交时直接回到本节点 --\x3e\r\n<div\r\n  *ngIf="showBackWardConfig.dynamicBackWardRuleAble"\r\n  class="wf-task-handler-help-div"\r\n>\r\n  <div class="wf-task-handler-help-text">\r\n    {{ actionEntity.name\r\n    }}{{ "backWardConfig.allowResubmitToThisNode" | translate }}\r\n  </div>\r\n  <farris-switch\r\n    [(ngModel)]="showBackWardConfig.enable"\r\n    [size]="\'small\'"\r\n    trueValue="true"\r\n    falseValue="false"\r\n  >\r\n  </farris-switch>\r\n</div>\r\n\r\n\x3c!-- 按钮 --\x3e\r\n<ng-template #taskExecuteButtons>\r\n  <button type="button" class="btn btn-secondary" (click)="cancel()">\r\n    {{ "static.footCancel" | translate }}\r\n  </button>\r\n  <button\r\n    type="button"\r\n    class="btn btn-primary"\r\n    (click)="submit()"\r\n    [disabled]="submitDisable"\r\n  >\r\n    {{ "static.footOk" | translate }}\r\n  </button>\r\n</ng-template>\r\n',styles:[".wf-task-handler-help-div{font-size:13px;color:#2d2f33;margin-bottom:20px}.wf-task-handler-help-div-submit{margin-bottom:20px}.wf-task-handler-help-text{padding-bottom:8px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}"]}]}],Se.ctorParameters=function(){return[{type:H},{type:P.NotifyService},{type:z},{type:Ae},{type:U.LoadingService},{type:x.MessagerService},{type:S.Injector},{type:S.ChangeDetectorRef}]},Se.propDecorators={buttons:[{type:S.ViewChild,args:["taskExecuteButtons"]}],sysUserHelp:[{type:S.ViewChild,args:[b.SysFarrisLookupComponent]}],urgeHandleComponent:[{type:S.ViewChild,args:[fe]}],cls:[{type:S.HostBinding,args:["class"]}]},Se);function Se(e,t,s,n,i,r,o,a){var c=be.call(this)||this;return c.taskService=e,c.notify=t,c.i18nService=s,c.handlerService=n,c.loadingService=i,c.message=r,c.injector=o,c.cd=a,c.actionEntity=new F,c.comment="",c.ifSelectNode=!1,c.ifSelectUser=!1,c.ifAssignUser=!1,c.ifUrgeType=!1,c.ifShowCommentToMySelf=!1,c.singleSelect=!1,c.selectTargetAble=!1,c.hideComment=!1,c.filter={notGetCurrentUser:!0,notGetStopUser:!0,orderField:"order",withAllOrg:!0,orgId:""},c.selectedUsers=[],c.subject=new C.BehaviorSubject(null),c.submitResult={result:!0,isClose:!0},c.bindingData={},c.selectNodeText=c.i18nService.getValue("task.nextNodeText"),c.commentPlaceHolder=c.i18nService.getValue("static.inputHolder"),c.showAttachment=!0,c.showSign=!0,c.showCommonComment=!0,c.textAreaHeight=84,c.destNodes=[],c.dialogHeight=270,c.dialogHeightBase=66,c.addendum=new K,c.groupIcon='<i class="f-icon f-icon-lookup"></i>',c.assignInfos=[{selectedAssignees:[],assigneeInfo:null,assignees:[],activityName:"",dependency:"",anonymous:!1,anonymousText:null,resolved:!1}],c.ifRegistered=!1,c.billMethodConfigs=[],c.configList=[],c.verifySigned=new G,c.submitDisable=!1,c.addSign={showSignToSign:!1,allowSignToSIgn:!1,showMultiInstanceType:!1,multiInstanceType:[{value:"Parallel",name:c.i18nService.getValue("addSign.parallel")},{value:"Sequential",name:c.i18nService.getValue("addSign.sequential")},{value:"Preempt",name:c.i18nService.getValue("addSign.preempt")}],originMultiInstType:"",curMultiInstType:ge.Parallel.toString()},c.showBackWardConfig={dynamicBackWardRuleAble:!1,enable:!1},c.showUrgeMessageSubject=!1,c.wfContext=new pe,c.cls="",c.POST_MESSAGE_TARGET=window.document.location.origin,c.eventHandler=function(e){c.messageSubject.next(e)},Se.func&&window.removeEventListener("message",Se.func,!1),c.addMessageListener(),c}var we=function ct(){},Ie=function lt(){},xe=function ut(){},ke="SubmitSuccess",Ce="Cancel",Te=function dt(){},Ne=function pt(e,t,s){this.logTime=new Date,this.processCategory=e,this.processDefinitionId=t,this.processDefinitionName=s,this.logTime=new Date},Ue=(Pe.prototype.ngOnInit=function(){},Object.defineProperty(Pe.prototype,"dataId",{set:function(e){if(!e)throw new Error("dataId为空");this._dataId=e},enumerable:!0,configurable:!0}),Object.defineProperty(Pe.prototype,"bizDefKey",{set:function(e){if(!e)throw new Error("流程分类id为空");this.showButtons=!0,this._bizDefKey=e;var t=new we;t.dataId=this._dataId,t.bizDefKey=this._bizDefKey,this.setParam(t)},enumerable:!0,configurable:!0}),Pe.prototype.setParam=function(e){var t=new C.Subject;if(e)return this.payload.id=e.id,this.payload.processDefinitionId=e.processDefinitionId,this.payload.processDefinitionKey=e.processDefinitionKey,this.payload.bizDefKey=e.bizDefKey,this.payload.dataModelId=e.dataModelId,this.payload.dataId=e.dataId,this.payload.name=e.name,this.payload.startUserId=e.startUserId,this.payload.nextFlowNodes=[],this.wfContext.processCategoryId=e.bizDefKey,this.startProcessSimulate(this.payload,t),t.asObservable()},Pe.prototype.startProcessSimulate=function(e,s){var n=this,i=this.loadingService.show();this.taskService.startProcessSimulate(e).subscribe(function(e){if(i.close(),s.next(!0),n.response=e,n.destProcesses=e.procDefs.map(function(e){return{id:e.procDefId,name:e.procDefName+"(v"+e.version+".0)"}}),1===n.destProcesses.length)n.selectedProcessId=n.destProcesses[0].id,n.setNextNode(e),n.processPlaceholder=n.destProcesses[0].name;else{var t=n.getSelectedProcessCache(n.payload.bizDefKey);t&&-1<n.destProcesses.findIndex(function(e){return e.id===t.processDefinitionId})?(n.getDestNodes(t.processDefinitionId),n.processPlaceholder=t.processDefinitionName):n.processPlaceholder=n.i18nService.getValue("task.selectPlaceholder")}},function(e){i.close(),s.error(e),n.taskService.error(e)})},Pe.prototype.selectProcessChange=function(e){this.nodeCombo.onClear(),this.getDestNodes(e.data.id)},Pe.prototype.getDestNodes=function(e){var t=this;this.selectedProcessId=e,this.destNodes=[],this.nodePlaceholder="",this.clearAssignInfos();var s=new we;s.processDefinitionId=this.selectedProcessId,s.dataId=this.payload.dataId;var n=this.loadingService.show();this.taskService.startProcessSimulate(s).subscribe(function(e){n.close(),t.response=e,t.setNextNode(e)},function(e){n.close(),t.taskService.error(e)})},Pe.prototype.selectNodeChange=function(e){var t=this;this.clearAssignInfos(),this.selectedNodeId=e.data.id;var n=e.data.name.split("，");if(this.response.simulationPaths[e.index].nodeInfoList.every(function(e){return!0===e.resolved}))this.setAssignInfo(this.response.simulationPaths[e.index]);else{var i=new we;i.processDefinitionId=this.selectedProcessId,i.dataId=this.payload.dataId,i.nextFlowNodes=[],this.selectedNodeId.split("，").forEach(function(e,t){var s=new Ie;s.activityDefinitionId=e,s.activityDefinitionName=n[t],i.nextFlowNodes.push(s)});var s=this.loadingService.show();this.taskService.startProcessSimulate(i).subscribe(function(e){s.close(),t.setAssignInfo(e.simulationPaths[0])},function(e){s.close(),t.taskService.error(e)})}},Pe.prototype.startProcessSubmit=function(){var i=this;if(this.selectedProcessId)if(this.selectedNodeId)if(this.assignInfos.filter(function(e){return(e.assigneeInfo||e.selectedAssignees.length)&&!e.assignees.length}).length)this.openFromIframe?this.messager.warning(this.i18nService.getValue("task.selectProcessor")):this.notify.warning(this.i18nService.getValue("task.selectProcessor"));else{for(var e=this.selectedNodeId.split("，"),t=0;t<e.length;t++){var s={activityDefinitionId:e[t],activityDefinitionName:this.assignInfos[t].activityName,dependency:this.assignInfos[t].dependency,selectedAssignees:this.assignInfos[t].assigneeInfo?this.assignInfos[t].assignees:[],assigneeInfo:null,resolved:!1,anonymous:!1,anonymousText:""};if(this.response&&this.response.simulationPaths.length&&!this.response.simulationPaths[0].id.startsWith("ParallelGateway")&&1==e.length&&e[t].startsWith("UserActivity")&&this.assignInfos[t].resolved&&!this.assignInfos[t].assigneeInfo&&!this.assignInfos[t].selectedAssignees.length){var n=this.assignInfos[t].activityName+this.i18nService.getValue("startProcess.node")+this.i18nService.getValue("startProcess.noUser");return void(this.openFromIframe?this.messager.warning(n):this.notify.warning(n))}this.payload.nextFlowNodes.push(s)}this.payload.processDefinitionId=this.selectedProcessId,this.submitDisable=!0;var r=this.loadingService.show();this.taskService.startProcess(this.payload).subscribe(function(e){r.close(),i.submitDisable=!1,i.subject.next(!0),i.subjectWithResponse.next(e);var t=i.i18nService.getValue("startProcess.submitSuccess");if(i.openFromIframe?window.parent.gspWfService.eventHandler({data:{type:ke,message:t}}):i.handlerService.handleSubmitMessage(X,i.payload.bizDefKey),!i.openFromIframe&&e.needInteraction){i.notify.info(i.i18nService.getValue("cueWords.select")+e.nextFlowNodes[0].activityDefinitionName+i.i18nService.getValue("cueWords.processor"));var s=new _,n=new F;s.sourceId=e.nextFlowNodes[0].assigneeInfo.workItemId,n.code="AssignUser",n.name=i.i18nService.getValue("cueWords.assignUser"),i.handlerService.execute(s,n).subscribe(function(e){})}i.setSelectedProcessCache()},function(e){r.close(),i.payload.nextFlowNodes=[],i.submitDisable=!1,i.subject.next(!1),i.taskService.error(e)})}else this.openFromIframe?this.messager.warning(this.i18nService.getValue("startProcess.selectNode")):this.notify.warning(this.i18nService.getValue("startProcess.selectNode"));else this.openFromIframe?this.messager.warning(this.i18nService.getValue("startProcess.selectProcess")):this.notify.warning(this.i18nService.getValue("startProcess.selectProcess"))},Pe.prototype.selectProcessClear=function(){this.selectedProcessId="",this.destNodes=[],this.nodePlaceholder="",this.selectedNodeId="",this.clearAssignInfos(),this.response=null},Pe.prototype.selectNodeClear=function(){this.selectedNodeId="",this.clearAssignInfos()},Pe.prototype.afterConfirm=function(e,t){this.assignInfos[t].assignees=e},Pe.prototype.cancel=function(){this.openFromIframe?window.parent.gspWfService.eventHandler({data:{type:Ce,message:""}}):this.subjectCancel.next(!1)},Pe.prototype.getSubject=function(){return this.subject.asObservable()},Pe.prototype.getSubjectWithResponse=function(){return this.subjectWithResponse.asObservable()},Pe.prototype.getSubjectCancel=function(){return this.subjectCancel.asObservable()},Pe.prototype.setNextNode=function(e){this.destNodes=e.simulationPaths&&e.simulationPaths.map(function(e){return{id:e.nodeInfoList.map(function(e){return e.activityDefinitionId}).join("，"),name:e.nodeInfoList.map(function(e){return e.activityDefinitionName}).join("，")}});var t=e.simulationPaths.findIndex(function(e){return e["default"]});-1<t?(this.selectedNodeId=this.destNodes[t].id,this.nodePlaceholder=-1<this.destNodes[t].name.indexOf("，")?e.simulationPaths[t].name:this.destNodes[t].name,this.setAssignInfo(e.simulationPaths[t])):this.nodePlaceholder=this.i18nService.getValue("task.selectPlaceholder")},Pe.prototype.setAssignInfo=function(s){var n=this;this.assignInfos=[],this.selectedNodeId.split("，").forEach(function(t){var e=s.nodeInfoList.find(function(e){return e.activityDefinitionId===t});e?n.assignInfos.push({selectedAssignees:e.selectedAssignees,assigneeInfo:e.assigneeInfo,assignees:e.selectedAssignees.map(function(e){return{id:e.id,name:e.name}}),activityName:e.activityDefinitionName,dependency:e.dependency,anonymous:e.anonymous,anonymousText:e.anonymousText,resolved:e.resolved}):n.assignInfos.push({selectedAssignees:[],assigneeInfo:null,assignees:[],activityName:"",dependency:"",anonymous:!1,anonymousText:"",resolved:!1})})},Pe.prototype.clearAssignInfos=function(){this.assignInfos=[{selectedAssignees:[],assigneeInfo:null,assignees:[],activityName:"",dependency:"",anonymous:!1,anonymousText:"",resolved:!1}]},Pe.prototype.getSelectedProcessCache=function(t){var e=JSON.parse(localStorage.getItem("gspWfStartProcess"));return e&&e.selectedProcessList?e.selectedProcessList.find(function(e){return e.processCategory==t}):undefined},Pe.prototype.setSelectedProcessCache=function(){var t=this.payload.bizDefKey,s=this.payload.processDefinitionId,e=this.destProcesses.find(function(e){return e.id==s}),n=e&&e.name,i=JSON.parse(localStorage.getItem("gspWfStartProcess"));if(i&&i.selectedProcessList)if(-1<(a=i.selectedProcessList).findIndex(function(e){return e.processCategory==t}))a.map(function(e){e.processCategory==t&&(e.processDefinitionId=s,e.processDefinitionName=n,e.logTime=new Date)}),i.selectedProcessList=a,localStorage.setItem("gspWfStartProcess",JSON.stringify(i));else{var r=new Ne(t,s,n);a.push(r),i.selectedProcessList=a,localStorage.setItem("gspWfStartProcess",JSON.stringify(i))}else{var o=new Te,a=[];r=new Ne(t,s,n),a.push(r),o.selectedProcessList=a,localStorage.setItem("gspWfStartProcess",JSON.stringify(o))}},Pe.decorators=[{type:S.Component,args:[{selector:"lib-process-selector",template:'<div style="padding: 10px 20px; overflow: hidden; background-color: white;">\r\n  \x3c!-- 选择流程定义，下拉 --\x3e\r\n  <div class="wf-task-handler-help-div wf-task-handler-help-div-submit">\r\n    <div class="wf-task-handler-help-text">\r\n      {{ "startProcess.title" | translate }}\r\n    </div>\r\n    <div class="d-flex" style="flex: 1;">\r\n      <farris-combo-list style="flex: 1;"\r\n        [data]="destProcesses"\r\n        [editable]="false"\r\n        [textField]="\'name\'"\r\n        [valueField]="\'id\'"\r\n        [idField]="\'id\'"\r\n        [readonly]="destProcesses.length > 1 ? false : true"\r\n        (selectChange)="selectProcessChange($event)"\r\n        (clear)="selectProcessClear()"\r\n        [placeholder]="processPlaceholder"\r\n        [forcePlaceholder]="true"\r\n      >\r\n      </farris-combo-list>\r\n    </div>\r\n  </div>\r\n\r\n  \x3c!-- 下一节点，下拉 --\x3e\r\n  <div class="wf-task-handler-help-div wf-task-handler-help-div-submit">\r\n    <div class="wf-task-handler-help-text">{{ "task.nextNodeText" | translate }}</div>\r\n    <div class="d-flex" style="flex: 1;">\r\n      <farris-combo-list style="flex: 1;"\r\n        #nodeCombo\r\n        [data]="destNodes"\r\n        [editable]="false"\r\n        [textField]="\'name\'"\r\n        [valueField]="\'id\'"\r\n        [idField]="\'id\'"\r\n        [readonly]="destNodes.length > 1 ? false : true"\r\n        (selectChange)="selectNodeChange($event)"\r\n        (clear)="selectNodeClear()"\r\n        [placeholder]="nodePlaceholder"\r\n        [forcePlaceholder]="true"\r\n      >\r\n      </farris-combo-list>\r\n    </div>\r\n  </div>\r\n\r\n  \x3c!-- 办理人员 --\x3e\r\n  <lib-assignee-info *ngFor="let assignInfo of assignInfos; let i = index"\r\n    [assigneeInfo]="assignInfo.assigneeInfo"\r\n    [setAnonymous]="assignInfo.anonymous"\r\n    [setAnonymousText]="assignInfo.anonymousText"\r\n    [selectedAssignees]="assignInfo.selectedAssignees"\r\n    [activityName]="assignInfos.length > 1 ? assignInfo.activityName : \'\'"\r\n    [ifShowBlank]="assignInfos.length > 1 ? false : true"\r\n    [openFromIframe]="openFromIframe"\r\n    [wfContext]="wfContext"\r\n    (afterConfirm)="afterConfirm($event, i)"\r\n  ></lib-assignee-info>\r\n</div>\r\n\r\n\r\n\x3c!-- 弹框显示时，显示按钮 --\x3e\r\n<div *ngIf="showButtons" class="modal-footer" style="float: right; width: 100%;">\r\n  <div *ngIf="showButtons; then buttons"></div>\r\n</div>\r\n\r\n\x3c!-- 按钮 --\x3e\r\n<ng-template #buttons>\r\n  <button type="button" class="btn btn-secondary" (click)="cancel()">\r\n    {{ "static.footCancel" | translate }}\r\n  </button>\r\n  <button type="button" class="btn btn-primary" [disabled]="submitDisable" directive-throttle (throttleClick)="startProcessSubmit()">\r\n    {{ "static.footOk" | translate }}\r\n  </button>\r\n</ng-template>\r\n',styles:[".wf-task-handler-help-div{font-size:13px;color:#2d2f33;margin-bottom:20px}.wf-task-handler-help-div-submit{margin-bottom:20px}.wf-task-handler-help-text{padding-bottom:8px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}"]}]}],Pe.ctorParameters=function(){return[{type:H},{type:U.LoadingService},{type:P.NotifyService},{type:z},{type:x.MessagerService},{type:S.Injector},{type:Ae}]},Pe.propDecorators={nodeCombo:[{type:S.ViewChild,args:["nodeCombo"]}],buttons:[{type:S.ViewChild,args:["buttons"]}],openFromIframe:[{type:S.Input}],dataId:[{type:S.Input}],bizDefKey:[{type:S.Input}]},Pe);function Pe(e,t,s,n,i,r,o){this.taskService=e,this.loadingService=t,this.notify=s,this.i18nService=n,this.messager=i,this.injector=r,this.handlerService=o,this.destProcesses=[],this.destNodes=[],this.assignInfos=[{selectedAssignees:[],assigneeInfo:null,assignees:[],activityName:"",dependency:"",anonymous:!1,anonymousText:null,resolved:!1}],this.payload=new we,this.subject=new C.Subject,this.subjectWithResponse=new C.Subject,this.subjectCancel=new C.Subject,this.submitDisable=!1,this.showButtons=!1,this.curLanguage=localStorage.getItem("languageCode")||"zh-CHS",this.wfContext=new pe,this.openFromIframe=!1}var Ae=(je.prototype.execute=function(e,t){switch(t.code){case"ViewBizLog":this.logService.showByDataId(e.refBizId);break;case"ViewFlowChart":this.flowchartService.viewFlowChart(e.processInstanceId);break;case"ViewExecuteForm":this.openApp(e,t);break;default:this.complete(e,t)}return this.subject.asObservable()},je.prototype.assignByInfo=function(e,t){return(new C.Subject).asObservable()},je.prototype.complete=function(e,t){var s=this,n=this.resolver.resolveComponentFactory(ye).create(this.injector);n.instance.setTask(e),n.instance.setAction(t),n.instance.addPadding();var i={title:t.name?t.name:this.i18nService.getValue("task.title"),width:550,height:n.instance.dialogHeight,showButtons:!0,buttons:n.instance.buttons},r=this.modalService.show(n,i);n.instance.getSubject().subscribe(function(e){e&&e.result&&s.subject.next(!0),e&&e.result&&r.close()})},je.prototype.openApp=function(i,r){var o=this,a=i.sourceId,c=this.loading.show();this.taskService.getAppInfo(a).subscribe(function(e){if(c.close(),e){var t={appType:"menu",funcId:"",appId:"",appEntrance:"",tabId:a,isNewTab:!0},s=new Map;if(e.appId)"1"===e.formType?(s.set("workItemId",a),s.set("procInstId",r.parameters[0].value),s.set("taskState",i.state),s.set("isAssign",i.actions.some(function(e){return"AssignUser"===e.code})),e.parameters.forEach(function(e){return s.set(e.code,e.value)}),t.funcId=e.appId):(t.funcId="WF0120",s.set("taskId",i.id),s.set("taskState",i.state));else{if(!e.url)return void o.notify.info(o.i18nService.getValue("task.notFoundBill"));t.funcId="WF0120",s.set("taskId",i.id),s.set("taskState",i.state)}t.entityParams=s,t.queryStringParams=s;var n=o.loading.show();o.frameworkService.openMenu$(t).subscribe(function(){n.close()})}else o.notify.info(o.i18nService.getValue("task.notFoundBill"))},function(e){c.close(),o.taskService.error(e)})},je.prototype.refreshActions=function(e){return this.taskService.getWorkItemActions(e).pipe(y.switchMap(function(e){return C.of(e.filter(function(e){return"ViewBizLog"!==e.code&&"ViewFlowChart"!==e.code&&"ViewExecuteForm"!==e.code}))}))},je.prototype.executeByProcInstId=function(e,t,s){var n=this,i=new F;i.code=s;var r=new C.Subject;return this.taskService.getTaskByProcInstId(e,t).subscribe(function(e){e?n.execute(e,i).subscribe(function(e){r.next(e)}):n.notify.info(n.i18nService.getValue("task.noTask"))}),r.asObservable()},je.prototype.executeByWorkItemId=function(e,t){var s=new _;return s.sourceId=e,this.execute(s,t)},je.prototype.startProcess=function(n){var i=this,r=new C.Subject,t=this.loading.show();return this.taskService.getTaskCenterConfigByCode($,ie,n.bizDefKey).subscribe(function(e){if(t.close(),e&&"false"===e.currentValue){var s=i.loading.show();i.taskService.startProcessSimulate(n).subscribe(function(e){if(s.close(),e&&!1!==e.needInteraction)i.showStartProcessDialog(n).subscribe(function(e){r.next(e)});else{var t=i.loading.show();i.taskService.startProcess(n).subscribe(function(e){t.close(),r.next(e),i.handleSubmitMessage(X,n.bizDefKey)},function(e){t.close(),r.next(null),i.taskService.error(e)})}},function(e){s.close(),r.next(null),i.taskService.error(e)})}else i.showStartProcessDialog(n).subscribe(function(e){r.next(e)})},function(e){t.close(),i.taskService.error(e)}),r.asObservable()},je.prototype.showStartProcessDialog=function(s){var n=this,i=new C.Subject,r=this.resolver.resolveComponentFactory(Ue).create(this.injector);return r.instance.setParam(s).subscribe(function(){var e={title:n.i18nService.getValue("startProcess.title"),width:520,height:338,showButtons:!0,buttons:r.instance.buttons},t=n.modalService.show(r,e);!0===s.withResponse?(r.instance.getSubjectWithResponse().subscribe(function(e){i.next(e),t.close()}),r.instance.getSubjectCancel().subscribe(function(){t.close()})):(r.instance.getSubject().subscribe(function(e){i.next(e),t.close()}),r.instance.getSubjectCancel().subscribe(function(e){i.next(e),t.close()}))}),i.asObservable()},je.prototype.cancelSubmit=function(e){var t=this,s=new C.Subject,n=this.loading.show();return this.taskService.cancelSubmit(e).subscribe(function(){n.close(),s.next(!0),t.handleSubmitMessage(Z,e.bizDefKey)},function(e){n.close(),s.error(!1),t.taskService.error(e)}),s.asObservable()},je.prototype.submitWithBizDefKey=function(e,t){if(e){if(t){var s=new we;return s.dataId=e,s.bizDefKey=t,s.withResponse=!0,this.startProcess(s)}this.message.error(this.i18nService.getValue("startProcess.bizDefKeyIsNull"))}else this.notify.warning(this.i18nService.getValue("startProcess.dataIdIsNull"))},je.prototype.cancelSubmitWithDataId=function(e,t){if(e){if(t){var s=new xe;return s.dataId=e,s.bizDefKey=t,this.cancelSubmit(s)}this.message.error(this.i18nService.getValue("startProcess.bizDefKeyIsNull"))}else this.notify.warning(this.i18nService.getValue("startProcess.dataIdIsNull"))},je.prototype.batchSubmitWithBizDefKey=function(e,t){if(e&&e.length){if(t){if(1===e.length){var s=new we;return s.bizDefKey=t,s.dataId=e[0],this.startProcess(s)}var n=new C.Subject,i=this.loading.show();return this.batchSubmitNum.successNum=0,this.batchSubmitNum.failedNum=0,this.batchSubmitNum.errorNum=0,this.batchSubmitHelpFunction(E(e),t,function(){i.close(),n.next(!0)}),n.asObservable()}this.message.error(this.i18nService.getValue("startProcess.bizDefKeyIsNull"))}else this.notify.warning(this.i18nService.getValue("startProcess.dataIdIsEmpty"))},je.prototype.batchSubmitHelpFunction=function(t,s,n){var i=this;if(t&&0<t.length){var e=t.shift(),r=new we;r.bizDefKey=s,r.dataId=e,r.variables={simulate:!0},this.taskService.startProcess(r).subscribe(function(e){e.needInteraction?(i.batchSubmitNum.failedNum++,i.batchSubmitHelpFunction(t,s,n)):(r.variables={simulate:!1},i.taskService.startProcess(r).subscribe(function(e){i.batchSubmitNum.successNum++,i.batchSubmitHelpFunction(t,s,n)},function(){i.batchSubmitNum.errorNum++,i.batchSubmitHelpFunction(t,s,n)}))},function(){i.batchSubmitNum.errorNum++,i.batchSubmitHelpFunction(t,s,n)})}else this.showBatchSubmitInfo(this.batchSubmitNum,s),n()},je.prototype.batchCancelSubmitWithDataId=function(e,t){if(e&&e.length){if(t){if(1===e.length)return this.cancelSubmitWithDataId(e[0],t);var s=new C.Subject,n=this.loading.show();return this.batchCancelNum.successNum=0,this.batchCancelNum.errorNum=0,this.batchCancelHelpFunction(E(e),t,function(){n.close(),s.next(!0)}),s.asObservable()}this.message.error(this.i18nService.getValue("startProcess.bizDefKeyIsNull"))}else this.notify.warning(this.i18nService.getValue("startProcess.dataIdIsEmpty"))},je.prototype.batchCancelHelpFunction=function(e,t,s){var n=this;if(e&&e.length){var i=e.shift(),r=new xe;r.dataId=i,r.bizDefKey=t,this.taskService.cancelSubmit(r).subscribe(function(){n.batchCancelNum.successNum++,n.batchCancelHelpFunction(e,t,s)},function(){n.batchCancelNum.errorNum++,n.batchCancelHelpFunction(e,t,s)})}else this.showBatchCancelSubmitInfo(this.batchCancelNum,t),s()},je.prototype.childSubmit=function(e,t,s){if(e&&t){if(s){var n=new we;return n.dataId=e+","+t,n.bizDefKey=s,this.startProcess(n)}this.message.error(this.i18nService.getValue("startProcess.bizDefKeyIsNull"))}else this.notify.warning(this.i18nService.getValue("startProcess.dataIdIsNull"))},je.prototype.childCancelSubmit=function(e,t,s){if(e&&t){if(s){var n=new xe;return n.dataId=e+","+t,n.bizDefKey=s,this.cancelSubmit(n)}this.message.error(this.i18nService.getValue("startProcess.bizDefKeyIsNull"))}else this.notify.warning(this.i18nService.getValue("startProcess.dataIdIsNull"))},je.prototype.childBatchSubmit=function(t,e,s){if(t&&e){if(s){var n=e.map(function(e){return t+","+e});return this.batchSubmitWithBizDefKey(n,s)}this.message.error(this.i18nService.getValue("startProcess.bizDefKeyIsNull"))}else this.notify.warning(this.i18nService.getValue("startProcess.dataIdIsNull"))},je.prototype.childBatchCancelSubmit=function(t,e,s){if(t&&e){if(s){var n=e.map(function(e){return t+","+e});return this.batchCancelSubmitWithDataId(n,s)}this.message.error(this.i18nService.getValue("startProcess.bizDefKeyIsNull"))}else this.notify.warning(this.i18nService.getValue("startProcess.dataIdIsNull"))},je.prototype.showBatchSubmitInfo=function(e,t){var s=this;if(!e.successNum||e.failedNum||e.errorNum){var n="";e.successNum&&(n+=this.i18nService.getValue("batchStartProcess.success")+"【"+e.successNum+"】"+this.i18nService.getValue("batchStartProcess.row")),e.errorNum&&(n+=this.i18nService.getValue("batchStartProcess.error")+"【"+e.errorNum+"】"+this.i18nService.getValue("batchStartProcess.row")),e.failedNum&&(n+=this.i18nService.getValue("batchStartProcess.failed")+"【"+e.failedNum+"】"+this.i18nService.getValue("batchStartProcess.row")),n+=this.i18nService.getValue("batchStartProcess.single"),this.message.show("warning",n,{safeHtml:!1})}else this.taskService.getTaskCenterConfigByCode(X,ie,t).subscribe(function(e){"en"===s.curLanguage&&s.notify.success(JSON.parse(e.currentValue).en),"zh-CHS"===s.curLanguage&&s.notify.success(JSON.parse(e.currentValue).zh_CHS)})},je.prototype.showBatchCancelSubmitInfo=function(e,t){var s=this;if(e.successNum&&!e.errorNum)this.taskService.getTaskCenterConfigByCode(Z,ie,t).subscribe(function(e){"en"===s.curLanguage&&s.notify.success(JSON.parse(e.currentValue).en),"zh-CHS"===s.curLanguage&&s.notify.success(JSON.parse(e.currentValue).zh_CHS)});else{var n="";e.successNum&&(n+=this.i18nService.getValue("startProcess.success")+"【"+e.successNum+"】"+this.i18nService.getValue("startProcess.row")),e.errorNum&&(n+=this.i18nService.getValue("startProcess.failed")+"【"+e.errorNum+"】"+this.i18nService.getValue("startProcess.row")),this.message.show("warning",n,{safeHtml:!1})}},je.prototype.handleSubmitMessage=function(n,e){var i=this,r=this.loading.show();this.taskService.getTaskCenterConfigByCode(n,ie,e).subscribe(function(e){if(r.close(),e&&e.currentValue){var t="",s=JSON.parse(e.currentValue);"zh-CHS"===i.curLanguage&&(t=s.zh_CHS),"en"===i.curLanguage&&(t=s.en),"zh-CHT"===i.curLanguage&&(t=s.zh_CHT),i.notify.success(t)}else n===X&&i.notify.success(i.i18nService.getValue("startProcess.submitSuccess")),n===Z&&i.notify.success(i.i18nService.getValue("startProcess.cancelSubmitSuccess"))},function(e){r.close(),i.taskService.error(e)})},je.prototype.processSimulate=function(){var e=new C.Subject;return window.parent.gspWfEventService.simulate(function(){e.next(!0)}),e.asObservable()},je.prototype.viewFlowChartByDataId=function(e){e?this.flowchartService.viewFlowChartByDataId(e):console.error("查看流程图，表单id为空")},je.prototype.viewFlowChartWithForecast=function(e,t){var s=new p.ForecastProcessPayload;s.bizDefKey=e,s.dataId=t,this.flowchartService.viewProcess(s)},je.decorators=[{type:S.Injectable}],je.ctorParameters=function(){return[{type:d.WfApprovalLogsService},{type:p.WFFlowchartService},{type:S.Injector},{type:S.ComponentFactoryResolver},{type:t.BsModalService},{type:H},{type:P.NotifyService},{type:z},{type:v.FrameworkService},{type:S.ApplicationRef}]},je);function je(e,t,s,n,i,r,o,a,c,l){this.logService=e,this.flowchartService=t,this.injector=s,this.resolver=n,this.modalService=i,this.taskService=r,this.notify=o,this.i18nService=a,this.frameworkService=c,this.appRef=l,this.subject=new C.Subject,this.curLanguage=localStorage.getItem("languageCode")||"zh-CHS",this.batchSubmitNum={successNum:0,failedNum:0,errorNum:0},this.batchCancelNum={successNum:0,errorNum:0},this.loading=this.injector.get(U.LoadingService),this.message=this.injector.get(x.MessagerService)}var De=(Ve.prototype.transform=function(e,t){if(void 0===t&&(t=""),this.i18nService){var s=this.i18nService.getValue(e);return s||t}return t},Ve.decorators=[{type:S.Pipe,args:[{name:"translate"}]}],Ve.ctorParameters=function(){return[{type:z,decorators:[{type:S.Optional}]}]},Ve);function Ve(e){this.i18nService=e}var Ee=(He.prototype.ngOnInit=function(){},He.decorators=[{type:S.Component,args:[{selector:"lib-task-assigninfo",template:"",styles:[""]}]}],He);function He(){}var Me=(Oe.prototype.ngAfterViewInit=function(){var e=this.dataTableEle.nativeElement,t=e&&e.querySelector("div.farris-datatable-container > div > div.farris-table-scorllable-body");t&&(t.style.height="290px")},Oe.prototype.ngOnInit=function(){},Object.defineProperty(Oe.prototype,"assigneeInfo",{set:function(e){if(this.disabled=!1,this.placeholder=null,this.assignUserNgModule=null,this._assigneeInfo=e,this._assigneeInfo){if(this._assigneeInfo.selectAssignee?(this.disabled=!1,this.placeholder=this.i18nService.getValue("task.selectPlaceholder")):(this.disabled=!0,this._assigneeInfo.assigneeUsers&&this._assigneeInfo.assigneeUsers.length?this.placeholder=this.anonymous?this.anonymousText:this._assigneeInfo.assigneeUsers.map(function(e){return e.name}).join():this.placeholder=this.i18nService.getValue("task.noUser")),this.singleSelect=!this._assigneeInfo.multiSelect,this.allowGlobalAssign=this._assigneeInfo.allowGlobalAssign,this._assigneeInfo.organizationScope&&this._assigneeInfo.organizationScope.length){var t=this._assigneeInfo.organizationScope[0];this.filter.orgId=t.id,this.filter.withAllOrg=t.includeChildren}}else this.disabled=!0},enumerable:!0,configurable:!0}),Object.defineProperty(Oe.prototype,"setAnonymous",{set:function(e){this.anonymous=e},enumerable:!0,configurable:!0}),Object.defineProperty(Oe.prototype,"setAnonymousText",{set:function(e){this.anonymousText=e},enumerable:!0,configurable:!0}),Object.defineProperty(Oe.prototype,"selectedAssignees",{set:function(e){this._assigneeInfo||(this.placeholder=null),(this._selectedAssignees=e).length&&(this.placeholder=this.anonymous?this.anonymousText:e.map(function(e){return e.name}).join())},enumerable:!0,configurable:!0}),Oe.prototype.clickAssignUser=function(){this.extendUserHelp&&!this.openFromIframe?this.showExtendUserHelp():this.showSysUserHelp()},Oe.prototype.showExtendUserHelp=function(){var n=this;System["import"](this.extendUserHelpUrl).then(function(e){var t=Object.values(e)[0].create(n.injector),s={singleSelect:n.singleSelect,allowGlobalAssign:n.allowGlobalAssign,assigneeUsers:n._assigneeInfo&&n._assigneeInfo.assigneeUsers&&n._assigneeInfo.assigneeUsers.length?n._assigneeInfo.assigneeUsers:[],filter:n.filter,selectedUsers:n.assignees,wfContext:n.wfContext};t.instance.showHelp(s).subscribe(function(e){var t=e.userList;t&&t.length?(n.assignees=t.map(function(e){return{id:e.id,name:e.name}}),n.assignUserNgModule=n.assignees.map(function(e){return e.name}).join()):(n.assignees=[],n.assignUserNgModule=""),n.afterConfirm.emit(n.assignees),n.cd.detectChanges()},function(e){console.error(e)})},function(e){console.error(e)})},Oe.prototype.showSysUserHelp=function(){var e=this;this._assigneeInfo&&this._assigneeInfo.assigneeUsers&&this._assigneeInfo.assigneeUsers.length?(this.getAssignUsersByIds(),this.myUserHelp.show(),setTimeout(function(){e.cd.detectChanges(),e.openFromIframe&&e.openMyUserHelpOutIframe()},100)):this.allowGlobalAssign&&(this.bindingData={id:this.assignees.map(function(e){return e.id}).join(),name:this.assignees.map(function(e){return e.name}).join()},this.sysUserHelp.showHelp(),setTimeout(function(){e.cd.detectChanges(),e.openFromIframe&&e.beforeOpenSysUserHelpOutIframe()},100))},Oe.prototype.openMyUserHelpOutIframe=function(){var e=this.myUserHelpEle.nativeElement;top.document.body.append(e),window.document.querySelector("body > bs-modal-backdrop").remove();var t=e.firstChild.firstChild;t.style.width="850px",t.style.height="520px",t.style.marginLeft="-425px",t.style.marginTop="-260px"},Oe.prototype.beforeOpenSysUserHelpOutIframe=function(){var e=this;this.sysUserHelp.farrisLookUp.dialog.reSize({width:850,height:520});var t=this.sysUserHelp.farrisLookUp.dialog.el.nativeElement;t.parentElement.removeChild(t),this.sysUserHelp.farrisLookUp.draggable=!1,this.sysUserHelp.farrisLookUp.resizable=!1,this.sysUserHelp.farrisLookUp.showMaxButton=!1,this.sysUserHelp.farrisLookUp.dialogOpened.subscribe(function(){setTimeout(function(){e.openSysUserHelpOutIframe()},200)})},Oe.prototype.openSysUserHelpOutIframe=function(){var e=this.sysUserHelp.farrisLookUp.dialog.el.nativeElement;this.sysUserHelp.farrisLookUp.dialog.reSize({width:850,height:520}),top.document.body.append(e)},Oe.prototype.afterUsersSelect=function(e){e&&(e=this.singleSelect?[e]:e,this.assignees=e.map(function(e){return{id:e.id,name:e.name}}),this.assignUserNgModule=e.map(function(e){return e.name}).join(),this.afterConfirm.emit(this.assignees),this.cd.detectChanges())},Oe.prototype.getAssignUsersByIds=function(){this.originAssignUserList=this._assigneeInfo.assigneeUsers.map(function(e){return{ID:e.id,Name:e.name,Code:e.code,OrgId:e.orgId,OrgName:e.orgNamePath}}),this.searchAssignUserList=this.originAssignUserList},Oe.prototype.myUserHelpSearch=function(e){if(e.value){var t=e.value;this.searchAssignUserList=this.originAssignUserList.filter(function(e){return e.Name&&e.Name.includes(t)||e.Code&&e.Code.includes(t)})}else this.getAssignUsersByIds()},Oe.prototype.myUserHelpAfterSelect=function(){if(this.myUserHelpTable.selections!==undefined){var e=this.singleSelect?[this.myUserHelpTable.selections]:this.myUserHelpTable.selections;this.assignUserNgModule=e.map(function(e){return e.Name}).join(),this.assignees=e.map(function(e){return{id:e.ID,name:e.Name}}),this.afterConfirm.emit(this.assignees),this.cd.detectChanges(),this.myUserHelp.close()}else this.notify.warning(this.i18nService.getValue("static.assignee.noAssignee"))},Oe.prototype.myUserHelpCancel=function(){this.myUserHelp.close()},Oe.prototype.assignUserClear=function(){this.assignees=[],this.assignUserNgModule=null,this.afterConfirm.emit([]),this.bindingData={}},Oe.decorators=[{type:S.Component,args:[{selector:"lib-assignee-info",template:'\x3c!-- 指定参与者（指派） --\x3e\r\n<div\r\n  *ngIf="\r\n    ifShowBlank ||\r\n    _assigneeInfo || (_selectedAssignees && _selectedAssignees.length)\r\n  "\r\n  class="wf-task-handler-help-div"\r\n>\r\n  <div class="wf-task-handler-help-text" title="{{ activityName }}">\r\n    {{ activityName ? activityName : ("task.assignText" | translate) }}\r\n  </div>\r\n  <div\r\n    style="flex: 1"\r\n    title="{{ assignUserNgModule ? assignUserNgModule : placeholder }}"\r\n  >\r\n    <input-group\r\n      [editable]="false"\r\n      [disabled]="disabled"\r\n      [customCls]="\'custom-cls\'"\r\n      [groupText]="groupIcon"\r\n      [placeholder]="placeholder"\r\n      [forcePlaceholder]="true"\r\n      [(value)]="assignUserNgModule"\r\n      (clickHandle)="clickAssignUser()"\r\n      (clear)="assignUserClear()"\r\n    ></input-group>\r\n  </div>\r\n</div>\r\n\r\n\x3c!-- 系统帮助，用于全员指派 --\x3e\r\n<sys-farris-grid-lookup\r\n  #sysUserHelp\r\n  style="display: none"\r\n  [singleSelect]="singleSelect"\r\n  [bindingData]="bindingData"\r\n  [pagination]="true"\r\n  [pageSize]="20"\r\n  [title]="\'static.selectUser\' | translate"\r\n  [sourceType]="\'user\'"\r\n  [filter]="filter"\r\n  [showUserUnitInfo]="true"\r\n  [typeMode]="1"\r\n  (afterConfirm)="afterUsersSelect($event)"\r\n>\r\n</sys-farris-grid-lookup>\r\n\r\n\x3c!-- 指派自己画的帮助 --\x3e\r\n<farris-dialog\r\n  #allUserDialog\r\n  [buttons]="buttonRef"\r\n  [width]="850"\r\n  [height]="520"\r\n  [title]="\'static.selectUser\' | translate"\r\n>\r\n  <div\r\n    class="d-flex flex-column my-data-grid h-100"\r\n    style="padding: 0 14px; overflow: hidden"\r\n  >\r\n    <div class="flex-auto" style="position: relative">\r\n      <farris-datatable\r\n        #allUserTable\r\n        [columns]="columns"\r\n        [data]="searchAssignUserList"\r\n        [showFilterBar]="true"\r\n        [singleSelect]="singleSelect"\r\n        [idField]="\'ID\'"\r\n        [remote]="\'server\'"\r\n        (search)="myUserHelpSearch($event)"\r\n        [pagination]="false"\r\n        [showPageList]="false"\r\n      ></farris-datatable>\r\n    </div>\r\n  </div>\r\n</farris-dialog>\r\n<ng-template #buttonRef>\r\n  <button class="btn btn-secondary" (click)="myUserHelpCancel()">\r\n    {{ "static.footCancel" | translate }}\r\n  </button>\r\n  <button class="btn btn-primary" (click)="myUserHelpAfterSelect()">\r\n    {{ "static.footOk" | translate }}\r\n  </button>\r\n</ng-template>\r\n',styles:[".wf-task-handler-help-div{font-size:13px;color:#2d2f33;margin-bottom:20px}.wf-task-handler-help-div-submit{margin-bottom:20px}.wf-task-handler-help-text{padding-bottom:8px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}"]}]}],Oe.ctorParameters=function(){return[{type:z},{type:P.NotifyService},{type:S.ChangeDetectorRef},{type:H},{type:S.Injector}]},Oe.propDecorators={disabled:[{type:S.Input}],placeholder:[{type:S.Input}],singleSelect:[{type:S.Input}],filter:[{type:S.Input}],ifShowBlank:[{type:S.Input}],openFromIframe:[{type:S.Input}],activityName:[{type:S.Input}],allowGlobalAssign:[{type:S.Input}],wfContext:[{type:S.Input}],myUserHelp:[{type:S.ViewChild,args:["allUserDialog"]}],buttons:[{type:S.ViewChild,args:["taskExecuteButtons"]}],myUserHelpTable:[{type:S.ViewChild,args:["allUserTable"]}],dataTableEle:[{type:S.ViewChild,args:["allUserTable",{read:S.ElementRef}]}],sysUserHelp:[{type:S.ViewChild,args:[b.SysFarrisLookupComponent]}],sysUserHelpEle:[{type:S.ViewChild,args:["sysUserHelp",{read:S.ElementRef}]}],myUserHelpEle:[{type:S.ViewChild,args:["allUserDialog",{read:S.ElementRef}]}],afterConfirm:[{type:S.Output}],assigneeInfo:[{type:S.Input}],setAnonymous:[{type:S.Input}],setAnonymousText:[{type:S.Input}],selectedAssignees:[{type:S.Input}]},Oe);function Oe(e,t,s,n,i){var r=this;this.i18nService=e,this.notify=t,this.cd=s,this.taskService=n,this.injector=i,this.bindingData={},this.myHelpBindingData={},this.assignees=[],this.searchAssignUserList=[],this.anonymous=!1,this.anonymousText="",this.disabled=!1,this.filter={notGetCurrentUser:!1,notGetStopUser:!0,orderField:"order",withAllOrg:!0,orgId:""},this.ifShowBlank=!0,this.openFromIframe=!1,this.afterConfirm=new S.EventEmitter,this.groupIcon='<i class="f-icon f-icon-plus-circle" style="color: #2B87FF"></i>',this.extendUserHelp=!1,this.columns=[{title:this.i18nService.getValue("static.columnName.code"),field:"Code",width:80},{title:this.i18nService.getValue("static.columnName.name"),field:"Name",width:90},{title:this.i18nService.getValue("static.columnName.department"),field:"OrgName",width:180}],this.taskService.getWfUserHelpConfig().subscribe(function(e){e&&e.userHelpConfig&&"true"==e.userHelpConfig.isExtend&&(r.extendUserHelp=!0,r.extendUserHelpUrl=e.userHelpConfig.url+"?v="+(new Date).getTime().toString())},function(e){console.error(e)})}var Fe=(Le.prototype.ngOnInit=function(){var t=this,e=this.subject.pipe(y.throttleTime(this.THROTTLE_TIME));this.click=e.subscribe(function(e){t.throttleClick.emit(e)})},Le.prototype.ngOnDestroy=function(){this.click.unsubscribe()},Le.prototype.onClick=function(e){this.subject.next(e)},Le.decorators=[{type:S.Directive,args:[{selector:"[directive-throttle]"}]}],Le.ctorParameters=function(){return[]},Le.propDecorators={throttleClick:[{type:S.Output}],onClick:[{type:S.HostListener,args:["click",["$event"]]}]},Le);function Le(){this.THROTTLE_TIME=2e3,this.subject=new C.Subject,this.throttleClick=new S.EventEmitter}var Be=function ft(){},ze=function ht(){},Re=function mt(){},We=(_e.newEntity=function(){return{id:H.newId(),message:""}},_e);function _e(){}var qe=(Object.defineProperty(Ke.prototype,"TaskCenterConfig",{set:function(e){var t=e.find(function(e){return e.configCode==Y}),s=e.find(function(e){return e.configCode==ee}),n=e.find(function(e){return e.configCode==Q}),i=e.find(function(e){return e.configCode===ne});window.gspframeworkService.common?this.curUserId=window.gspframeworkService.common.userInfos.get().userId:this.curUserId=window.parent.gspframeworkService.common.userInfos.get().userId,t&&"true"===t.currentValue&&(this.ifShowAttachment=!0),s&&"true"===s.currentValue&&(this.ifShowSign=!0),n&&"false"===n.currentValue&&(this.ifEnableSign=!1),i&&"false"===i.currentValue&&(this.ifCanEditSign=!1),this.ifShowSign&&this.ifEnableSign&&this.getUserSign(this.curUserId)},enumerable:!0,configurable:!0}),Object.defineProperty(Ke.prototype,"value",{get:function(){return this._value},set:function(e){this._value!==e&&(this._value=e,this.onModelChange(e))},enumerable:!0,configurable:!0}),Ke.prototype.ngOnInit=function(){this.commentColumns=[{field:"message",width:100,title:this.i18nService.getValue("comment.static.content"),editor:{type:N.EditorTypes.TEXTBOX,options:{}}},{field:"userId",width:20,title:this.i18nService.getValue("comment.static.type"),template:this.commentTypeCell},{field:"operate",width:20,title:this.i18nService.getValue("comment.static.operate"),template:this.commentOperateCell}],this.loadComments()},Ke.prototype.onEditComment=function(){this.dropDownEl.close(),this.commentDialog.show()},Ke.prototype.loadComments=function(){var t=this;this.taskService.getCommentList().subscribe(function(e){t.commentList=e,t.originCommentList=E(e)})},Ke.prototype.writeValue=function(e){e!==this.value&&(this.value=e)},Ke.prototype.registerOnChange=function(e){this.onModelChange=e},Ke.prototype.registerOnTouched=function(e){this.onModelTouched=e},Ke.prototype.buttonClick=function(e){this.dropDownEl.close(),this.value=e},Ke.prototype.uploadAttachment=function(){var f=this,h=!1;this.uploadDialog.uploadFile(this.processInstanceId,"wf_attachment").then(function(e){var t,s,n,i;try{for(var r=D(e),o=r.next();!o.done;o=r.next()){var a=o.value;h=!1;try{for(var c=D(f.attachmentList),l=c.next();!l.done;l=c.next())if(l.value.fileName===a.fileName){f.messageService.info("包含重复文件"+a.fileName),h=!0;break}}catch(d){n={error:d}}finally{try{l&&!l.done&&(i=c["return"])&&i.call(c)}finally{if(n)throw n.error}}h||f.attachmentList.push(a)}}catch(p){t={error:p}}finally{try{o&&!o.done&&(s=r["return"])&&s.call(r)}finally{if(t)throw t.error}}f.attachment.emit(f.attachmentList);var u=new Be;u.rootId="wf_attachment",u.metadataIdList=[],f.attachmentList.forEach(function(e){u.metadataIdList.push(e.metadataId)}),u.metadataIdList.length&&f.taskService.uploadAttachment(u).subscribe(function(){})})},Ke.prototype.attachmentDelete=function(e){var t={rootId:"wf_attachment",metadataId:e.metadataId,mode:"Formal"},s=this.attachmentList.indexOf(e);-1<s&&this.attachmentList.splice(s,1),this.attachment.emit(this.attachmentList),this.taskService.deleteAttachment(t).subscribe(function(){})},Ke.prototype.imageUrl=function(e){return"/platform/runtime/wf/webapp/mobiletaskcenter/assets/accessory/"+this.taskService.createItem(e)+".svg"},Ke.prototype.showSignDialog=function(){this.signDialog.show(),this.ifEnableSign||this.getUserSign(this.curUserId)},Ke.prototype.clickToDeleteImage=function(){this.signatureImage="",this.signature.emit(null);var t=this.loadingService.show();this.taskService.addTaskCenterConfig(Q,"false").subscribe(function(e){t.close()},function(){t.close()})},Ke.prototype.clickToUseSign=function(){this.ifUseImg=!1,this.ifUseSign=!0;var e=this.signaturePad.canvasDiv.nativeElement.querySelector("canvas");e.height=252,e.width=665},Ke.prototype.clickToUploadImg=function(){this.farrisAvatar.onClick()},Ke.prototype.clickToConfirm=function(){var e;if(this.signaturePad&&this.signaturePad.isDraw?e=this.signaturePad.confirm():this.ifUploadImg&&(e=this.tmpSignatureImage),e)this.uploadSignatureImg(e);else{if(this.tmpSignatureImage&&(this.signatureImage=this.tmpSignatureImage,this.signature.emit(this.originSignId),!this.ifEnableSign)){var t=this.loadingService.show();this.taskService.addTaskCenterConfig(Q,"true").subscribe(function(e){t.close()},function(){t.close()})}this.signDialog.close()}},Ke.prototype.clickToReset=function(){this.ifUseSign=!1,this.ifUseImg=!0,this.signatureImage="",this.tmpSignatureImage="",this.signature.emit("")},Ke.prototype.clickToCancel=function(){this.signDialog.close()},Ke.prototype.imgChange=function(e){this.ifUseImg=!0,this.ifUseSign=!1,this.ifUploadImg=!0;var t=e.base64;this.tmpSignatureImage=t,this.signatureImage=t},Ke.prototype.uploadSignatureImg=function(t){var s=this,e=new ze;e.fileContent=t.split(",")[1],e.filePath=this.curUserId,e.mode="Formal",e.metadata=new Re,e.metadata.id=this.taskService.createNM(),e.metadata.fileName=this.taskService.createNM()+".png",e.metadata.rootId="taskcentersignature",e.metadata.docType="png";var n=this.loadingService.show();this.taskService.uploadSignature(e).subscribe(function(e){n.close(),s.originSignId=e,s.signature.emit(e),s.signatureImage=t,s.signDialog.close()},function(e){n.close(),s.messageService.error("上传签名失败")})},Ke.prototype.getUserSign=function(e){var s=this,n=this.loadingService.show();this.taskService.getUserSign(e).subscribe(function(e){var t;n.close(),e&&e.length&&(t=1==e.length?e[0]:e.filter(function(e){return e&&e.lastModifiedTime}).reduce(function(e,t){return e.lastModifiedTime>t.lastModifiedTime?e:t}),s.signature.emit(t.id),s.signatureImage=s.downloadService.getDownloadUrl(t.id,"taskcentersignature"),s.tmpSignatureImage=s.signatureImage)},function(e){console.error(e),n.close()})},Ke.prototype.add=function(){var e=We.newEntity();e.sortOrder=this.commentList.length+1,this.commentList=this.commentList.concat(e)},Ke.prototype.clickToDeleteComment=function(t){"*"!==t.rowData.userId&&(this.commentList=this.commentList.filter(function(e){return e.id!=t.rowData.id}),this.dataGrid.loadData(this.commentList))},Ke.prototype.save=function(){var t=this;this.dataGrid.endCellEdit(),this.httpSave().subscribe(function(e){t.loadComments(),t.commentDialog.close()})},Ke.prototype.httpSave=function(){var s=this,t="/api/runtime/wf/v1.0/commonComments",e=this.originCommentList.filter(function(e){return"*"!==e.userId}).map(function(e){return e.id}).filter(function(t){return s.commentList.findIndex(function(e){return e.id===t})<0});return C.forkJoin(e.map(function(e){return s.httpSvc["delete"](t+"/"+e,null)}).concat(this.commentList.map(function(e){return s.httpSvc.post(t,e)})))},Ke.prototype.attachmentPreview=function(e){var t={appType:"app",funcId:"",tabName:"文档在线预览",appId:"6ccb476b-f2ba-df8f-6f47-d37d100c56e2",appEntrance:"docviewertab",tabId:(new Date).getTime(),entityParams:{metadataIdList:[e],rootId:"wf_attachment",metadataId:null,viewOptions:{showHeader:!0,showPaging:!0,showThumbnails:!0,showDownload:!0,showSearch:!0,showZoom:!0,showPrint:!0,showSecondaryToolBar:!0}}};window.gspframeworkService.rtf.func.openMenu(t)},Ke.decorators=[{type:S.Component,args:[{selector:"wf-comment",template:'<div\r\n  class="fa-approve-comment fa-approve-common-gutter"\r\n  style="margin-bottom: 20px"\r\n>\r\n  \x3c!-- 输入框 --\x3e\r\n  <div class="fa-approve-comment--content">\r\n    <textarea\r\n      class="form-control content-textarea"\r\n      style="font-size: 13px"\r\n      [(ngModel)]="value"\r\n      [attr.placeholder]="placeholder"\r\n      [style.height.px]="textAreaHeight"\r\n    ></textarea>\r\n  </div>\r\n  \x3c!-- 输入框下方一排按钮 --\x3e\r\n  <div class="fa-approve-comment--footer">\r\n    <div\r\n      *ngIf="showAttachment || showSign || showCommonComment"\r\n      class="approve-comment--text-btns"\r\n    >\r\n      \x3c!-- 常用意见 --\x3e\r\n      <div *ngIf="showCommonComment" class="text-btns-item">\r\n        <span class="f-icon f-icon-message"></span>\r\n        <div fDropdown #dropdownEl="fDropdown">\r\n          <span fDropdownToggle>\r\n            {{ "comment.static.inputLabel" | translate }}\r\n          </span>\r\n          <div class="dropdown-menu" fDropdownMenu>\r\n            <li\r\n              class="dropdown-item"\r\n              *ngFor="let comment of commentList"\r\n              (click)="buttonClick(comment.message)"\r\n            >\r\n              <span>{{ comment.message }}</span>\r\n            </li>\r\n            <div class="dropdown-divider"></div>\r\n            \x3c!-- 意见管理 --\x3e\r\n            <div class="dropdown-item" (click)="onEditComment()">\r\n              <span class="f-icon f-icon-home-setup"></span>\r\n              <span>{{ "comment.static.manage" | translate }}</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      \x3c!-- 上传附件 --\x3e\r\n      <div\r\n        class="text-btns-item"\r\n        *ngIf="ifShowAttachment && showAttachment"\r\n        (click)="uploadAttachment()"\r\n        title="{{ \'comment.attachment.tips\' | translate }}"\r\n      >\r\n        <span class="f-icon f-icon-attachment"></span>\r\n        <span class="text-btns-item--text">\r\n          {{ "comment.static.attachmentUpload" | translate }}\r\n        </span>\r\n      </div>\r\n      \x3c!-- 手写签名 --\x3e\r\n      <div\r\n        class="text-btns-item"\r\n        *ngIf="showSign && ifShowSign && ifCanEditSign"\r\n        title="{{ \'comment.signature.tips\' | translate }}"\r\n        (click)="showSignDialog()"\r\n      >\r\n        <span class="f-icon f-icon-edit"></span>\r\n        <span>{{ "comment.signature.title" | translate }}</span>\r\n      </div>\r\n      \x3c!-- 手写签名预览 --\x3e\r\n      <div\r\n        *ngIf="showSign && ifShowSign && signatureImage"\r\n        class="signatureImage"\r\n      >\r\n        <img [src]="signatureImage" style="width: 70px; height: 26px" />\r\n        <div *ngIf="ifCanEditSign"\r\n          class="attachment-delete"\r\n          (click)="clickToDeleteImage()"\r\n          title="{{ \'comment.signature.disable\' | translate }}"\r\n        >\r\n          <span class="f-icon f-icon-x"></span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    \x3c!-- 附件预览 --\x3e\r\n    <div *ngIf="attachmentList.length > 0">\r\n      <li *ngFor="let attachment of attachmentList">\r\n        <div class="wf-docFile">\r\n          <div><img class="wf-docFileIcon" [src]="imageUrl(attachment)" /></div>\r\n          <div class="wf-docFileInfo">\r\n            <div class="attachment-list">\r\n              <a>{{ attachment.fileName }}</a>\r\n            </div>\r\n            <div\r\n              class="attachment-delete"\r\n              (click)="attachmentDelete(attachment)"\r\n            >\r\n              <span class="f-icon f-icon-close-outline"></span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </li>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n\x3c!-- 常用意见维护 --\x3e\r\n<farris-dialog\r\n  #commentDialog\r\n  [buttons]="formButtonRef"\r\n  [width]="740"\r\n  [height]="440"\r\n  [title]="\'comment.static.title\' | translate"\r\n>\r\n  <div class="task-center-comment-datagrid-div">\r\n    <farris-datagrid\r\n      #dataGrid\r\n      [data]="commentList"\r\n      [columns]="commentColumns"\r\n      [editable]="true"\r\n      [fit]="true"\r\n      [editMode]="\'cell\'"\r\n      [pagination]="false"\r\n      [fitColumns]="true"\r\n      [clickToEdit]="true"\r\n      [beforeEdit]="beforeEdit"\r\n    >\r\n    </farris-datagrid>\r\n  </div>\r\n  <div class="task-comment-add task-comment-add-common" (click)="add()">\r\n    <span class="f-icon f-icon-plus mr-1"></span>\r\n    <span>{{ "comment.static.clickToAdd" | translate }}</span>\r\n  </div>\r\n</farris-dialog>\r\n\r\n\x3c!-- 常用意见维护按钮 --\x3e\r\n<ng-template #formButtonRef>\r\n  <button class="btn btn-primary mr-2" (click)="save()">\r\n    {{ "comment.static.confirm" | translate }}\r\n  </button>\r\n  <button class="btn btn-secondary" (click)="commentDialog.close()">\r\n    {{ "comment.static.cancel" | translate }}\r\n  </button>\r\n</ng-template>\r\n\r\n\x3c!-- 签名弹框 --\x3e\r\n<farris-dialog\r\n  #signDialog\r\n  [buttons]="signButtons"\r\n  [width]="710"\r\n  [height]="420"\r\n  [title]="\'comment.signature.dialogTitle\' | translate"\r\n  [resizable]="false"\r\n  [showMaxButton]="false"\r\n>\r\n  <wf-sign-here\r\n    #wfSignHere\r\n    [title]="\'\'"\r\n    [ngStyle]="!ifUseSign ? { display: \'none\' } : null"\r\n  ></wf-sign-here>\r\n  <div *ngIf="ifUseImg && tmpSignatureImage" class="signature-img-default">\r\n    <img [src]="tmpSignatureImage" style="height: 252px" />\r\n  </div>\r\n  <div *ngIf="ifUseImg && !tmpSignatureImage" class="signature-img-div">\r\n    <div class="signature-img-main">\r\n      <div style="margin-bottom: 28px">\r\n        <img\r\n          src="/platform/runtime/common/web/@gsp-wf/wf-task-handler/assets/img/signIcon.svg?v=20210623"\r\n        />\r\n      </div>\r\n      <div class="signature-img-text">\r\n        <span>{{ "comment.signature.note1" | translate }}</span>\r\n        <span class="signature-text-action" (click)="clickToUseSign()">{{\r\n          "comment.signature.sign" | translate\r\n        }}</span>\r\n        <span>{{ "comment.signature.note2" | translate }}</span>\r\n        <span class="signature-text-action" (click)="clickToUploadImg()">{{\r\n          "comment.signature.upload" | translate\r\n        }}</span>\r\n        <span>{{ "comment.signature.note3" | translate }}</span>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</farris-dialog>\r\n\r\n\x3c!-- 手写签名按钮 --\x3e\r\n<ng-template #signButtons>\r\n  <button class="btn btn-primary mr-2" (click)="clickToConfirm()">\r\n    {{ "comment.signature.ok" | translate }}\r\n  </button>\r\n  <button class="btn btn-secondary mr-2" (click)="clickToReset()">\r\n    {{ "comment.signature.reset" | translate }}\r\n  </button>\r\n  <button class="btn btn-secondary" (click)="clickToCancel()">\r\n    {{ "comment.static.cancel" | translate }}\r\n  </button>\r\n</ng-template>\r\n\r\n\x3c!-- 使用头像组件做图片上传 --\x3e\r\n<farris-avatar\r\n  #farrisAvatar\r\n  (imgChange)="imgChange($event)"\r\n  style="display: none"\r\n></farris-avatar>\r\n\r\n\x3c!-- 常用意见类别 --\x3e\r\n<ng-template #commentTypeCell let-ctx>\r\n  <div>\r\n    <span\r\n      *ngIf="ctx.rowData.userId === \'*\'"\r\n      class="task-comment-type task-comment-type-blue"\r\n      >{{ "comment.static.public" | translate }}</span\r\n    >\r\n    <span\r\n      *ngIf="ctx.rowData.userId !== \'*\'"\r\n      class="task-comment-type task-comment-type-yellow"\r\n      >{{ "comment.static.private" | translate }}</span\r\n    >\r\n  </div>\r\n</ng-template>\r\n\r\n\x3c!-- 常用意见操作 --\x3e\r\n<ng-template #commentOperateCell let-ctx>\r\n  <div\r\n    *ngIf="ctx.rowData.userId !== \'*\'"\r\n    class="btn-link"\r\n    style="padding: 5px 0"\r\n    (click)="clickToDeleteComment(ctx)"\r\n  >\r\n    {{ "comment.static.delete" | translate }}\r\n  </div>\r\n</ng-template>\r\n',providers:[{provide:w.NG_VALUE_ACCESSOR,useExisting:S.forwardRef(function(){return Ke}),multi:!0}],styles:[':host ::ng-deep .dropdown .btn{padding:0}:host ::ng-deep .dropdown .btn-secondary{box-shadow:none}:host ::ng-deep .dropdown .btn-secondary:focus{box-shadow:none}:host ::ng-deep .dropdown .btn-secondary:hover{color:#388fff}.task-center-comment-datagrid-div{display:flex;flex-grow:0;overflow:hidden;height:295px;padding:0 24px}.task-comment-type{padding:2px 6px;border-radius:4px;font-size:12px}.task-comment-type-blue{background:#eef5ff;border:0 solid #aed1ff;color:#5ea4ff}.task-comment-type-yellow{background:#fef5ec;border:0 solid #fad0a1;color:#f5a144}.task-comment-add{display:flex;justify-content:center;align-items:center;margin:0 24px;cursor:pointer;overflow:hidden;font-size:12px;text-align:center;padding:6px;border-radius:4px}.task-comment-add-common{color:#a8adb8;background:#f4f6fc;border:1px dashed #d2d7e2}.task-comment-add:hover{background:rgba(238,245,255,.8);border:1px solid rgba(82,157,255,.4)}.signatureImage:hover .attachment-delete{display:block}.fa-approval-operate-list{display:flex;flex-direction:row;align-items:center}.fa-approval-operate-list .approval-operate--label{position:relative;margin-right:8px;padding:3px 16px;border:1px solid rgba(0,0,0,.15);border-radius:2px;overflow:hidden;cursor:pointer;margin-bottom:0;color:#595959}.fa-approval-operate-list .approval-operate--label .label-title{font-size:14px;line-height:20px;white-space:nowrap}.fa-approval-operate-list .approval-operate--label .label-tip{position:absolute;display:block;right:0;bottom:0;width:14px;height:14px;border:7px solid #dadada;border-top:7px solid transparent;border-left:7px solid transparent}.fa-approval-operate-list .approval-operate--label .label-icon{position:absolute;display:block;right:-3px;bottom:-2px;font-size:12px;color:#fff}.fa-approval-operate-list .approval-operate--label .label-icon::before{content:"\\e118"}.fa-approval-operate-list .approval-operate--radio{display:none}.fa-approval-operate-list .approval-operate--radio:checked~.approval-operate--label{color:#388fff;border-color:#388fff;background:rgba(23,145,255,.05)}.fa-approval-operate-list .approval-operate--radio:checked~.approval-operate--label .label-tip{border-right-color:#388fff;border-bottom-color:#388fff}.fa-dropdown-button{border-color:#f7f7f7;font-size:12px;color:#667580;background:#f7f7f7}.fa-btn-like-dropdown{display:flex;align-items:center}.fa-btn-like-dropdown .like-dropdown--text{margin:0 4px 0 0}.fa-btn-like-dropdown .like-dropdown--icon{color:rgba(0,0,0,.25)}.fa-approve-common-gutter{margin:0 0 12px}.fa-approve-comment .approve-comment--title{display:inline-block;color:#667580;border-radius:4px 4px 0 0;height:26px;padding:0 9px;position:relative;background:#f7f7f7;cursor:pointer}.fa-approve-comment .approve-comment--title:after{content:"";height:100%;position:absolute;right:-10px;top:0;bottom:0;border-right:5px solid transparent;border-left:5px solid #f7f7f7;border-bottom:13px solid #f7f7f7;border-top:13px solid transparent}.fa-approve-comment .approve-comment--title .fa-btn-like-dropdown{font-size:12px;padding:2px 0}.fa-approve-comment .fa-approve-comment--content .content-textarea{border-color:#dcdcdc;border-radius:0 0 2px 2px}.fa-approve-comment .fa-approve-comment--footer{font-size:13px;color:#667580;background:#f7f7f7;align-items:center;padding:5px 0}.fa-approve-comment .approve-comment--text-btns{display:flex;flex-direction:row;padding:0 5px}.fa-approve-comment .approve-comment--text-btns .text-btns-item{display:flex;flex-direction:row;align-items:center;font-size:12px;line-height:18px;color:#667580;margin-right:20px;cursor:pointer}.fa-approve-comment .approve-comment--text-btns .text-btns-item:hover{color:#388fff}.fa-approve-comment .approve-comment--text-btns .text-btns-item .f-icon{margin-right:4px}.fa-approveal-links::after{content:".";display:block;height:0;clear:both;visibility:hidden}.fa-approveal-links .approveal-links--link{font-size:14px;position:relative;padding:0 16px 0 0;display:flex;align-items:center;float:left}.fa-approveal-links .approveal-links--link .link-text{color:rgba(0,0,0,.65);margin:0 8px 0 0}.fa-approveal-links .approveal-links--link+.approveal-links--link{padding-left:16px}.fa-approveal-links .approveal-links--link+.approveal-links--link::before{content:"";position:absolute;width:1px;height:80%;left:0;top:10%;background:#dbdbdb}.fa-btn-group-lg .btn{padding-top:6px;padding-bottom:6px;min-width:100px;text-align:center}.fa-approve-record{padding:0 0 16px;position:relative}.fa-approve-record .fa-approve-record--timeline{position:absolute;width:34px;top:0;bottom:0;z-index:100}.fa-approve-record .fa-approve-record--timeline::after{content:"";position:absolute;width:1px;height:100%;overflow:hidden;left:50%;top:0;z-index:101;border-left:1px dashed #dcdcdc}.fa-approve-record .fa-approve-record--timeline .fa-approve-star{position:relative;z-index:103;margin:20px auto}.fa-approve-record.fa-state-running .fa-approve-record--timeline::after{top:20px}.fa-approve-record:last-child .fa-approve-record--timeline::after{height:20px}.fa-approve-record .fa-approve-record--content{margin:0 0 0 34px;padding:16px 14px;background:#f9f9f9;border-radius:2px}.fa-approve-record .fa-approve-record--content .approve-record--header{margin:0 0 12px;display:flex;align-items:center}.fa-approve-record .fa-approve-record--content .approve-record--header .header--title{margin-bottom:0;color:rgba(0,0,0,.85)}.fa-approve-record .fa-approve-record--content .approve-record--header>*{margin:0 19px 0 0}.fa-approve-record .approve-record--list-item{display:flex;flex-direction:row}.fa-approve-record .approve-record--list-item+.approve-record--list-item{padding-top:8px}.fa-approve-record .approve-record--list-item .list-item--auxiliary{width:30px;margin:0 10px 0 0}.fa-approve-record .approve-record--list-item .list-item--main{flex-grow:1;flex-shrink:1;flex-basis:auto;padding:6px 0 0;background:#f9f9f9}.fa-approve-record .approve-record--list-item .list-item--content{padding:20px 0 0}.fa-approve-record .approve-record--list-item .list-item--content .list-item--info{font-size:12px;margin-bottom:0}.fa-approve-record .approve-record--list-item .list-item--content .list-item--info .info-label{color:rgba(0,0,0,.65)}.fa-approve-record .approve-record--list-item .list-item--content .list-item--info .info-text{color:rgba(0,0,0,.85)}.fa-approve-record .approve-record--list-item .list-item--header{display:flex;align-items:center}.fa-approve-record .approve-record--list-item .list-item--header>*{margin:0 16px 0 0}.fa-approve-record .approve-record--list-item .list-item--header .list-item--info{margin-bottom:0;font-size:12px}.fa-approve-record .approve-record--list-item .list-item--header .list-item--info .info-label{color:rgba(0,0,0,.35)}.fa-approve-record .approve-record--list-item .list-item--header .list-item--info .info-text{color:rgba(0,0,0,.65)}.fa-approve-record .approve-record--list-item .list-item--name{color:#4297fa}.fa-approve-record .approve-record--avatar{width:30px;height:30px;border-radius:15px}.fa-approve-round-bg{margin:4px auto 0;width:30px;height:30px;background:#59a1ff;border-radius:18px;line-height:30px;text-align:center;white-space:nowrap;font-size:12px;overflow:hidden}.fa-approve-round-bg-text{color:#fff}.fa-approve-star{width:14px;height:14px;display:block;background:rgba(56,143,255,.4);border-radius:7px;position:relative}.fa-approve-star::after{content:"";width:8px;height:8px;position:absolute;top:50%;left:50%;margin:-4px 0 0 -4px;border-radius:4px;background:#388fff}.fa-approve-star.bg-warning{background:rgba(245,156,36,.4)!important}.fa-approve-star.bg-warning::after{background:#f59c24}.fa-approve-badge{padding-top:4px;padding-bottom:4px;border-radius:10px}.fa-approve-badge-light{font-size:13px;line-height:20px;padding:0 8px;color:#5f637a;border:1px solid #e6e6e6;background:#f6faff}.fa-approve-link-border{cursor:pointer;display:inline-block;border:1px solid #60a5ff;border-radius:13px;font-size:12px;line-height:16px;color:#388fff;padding:3px 10px;background:#ebf5ff}.fa-approve-link-border:hover{background:#2881ff;color:#fff}.fm-toolbar{flex-direction:row;display:flex}.wf-docFile{flex-shrink:1;flex-grow:1;flex-basis:0;display:flex;flex-direction:row;align-items:flex-start;border-top:1px solid #f8f9fa;border-left:1px solid #f8f9fa}.wf-docFileIcon{margin:0 0 0 4px;width:20px;height:20px;line-height:20px;text-align:center;overflow:hidden;white-space:nowrap;padding:2px}.wf-docFileInfo{flex-shrink:1;flex-grow:1;flex-basis:0;padding:2px 6px 0 9px;margin-left:0}.wf-docFileInfo:hover .attachment-delete{display:block}.wf-docFileSize{font-size:11px;color:#888}.wf-doc-delete{margin:auto;font-size:18px;color:#f8f9fa}li{list-style:none}.attachment-delete{float:right;cursor:pointer;display:none;text-align:right;padding-right:10px}.attachment-delete:hover{color:#4297fa}.attachment-list{float:left;font-size:12px}.signature-img-div{display:flex;justify-content:center;align-items:center;height:100%;background:#fafcfd;border:1px solid #d8dfed;border-radius:8px;margin:0 10px}.signature-img-main{display:flex;flex-direction:column;justify-content:center;align-items:center}.signature-img-text{font-size:13px;color:rgba(106,111,121,.85)}.signature-text-action{color:#529efe;padding:0 2px;cursor:pointer}.signature-img-default{display:flex;justify-content:center;align-items:center;height:inherit}']}]}],Ke.ctorParameters=function(){return[{type:H},{type:T.HttpService},{type:I.UploadDialogService},{type:x.MessagerService},{type:z},{type:U.LoadingService},{type:P.NotifyService}]},Ke.propDecorators={showAttachment:[{type:S.Input}],showSign:[{type:S.Input}],showCommonComment:[{type:S.Input}],comment:[{type:S.Input}],placeholder:[{type:S.Input}],processInstanceId:[{type:S.Input}],textAreaHeight:[{type:S.Input}],TaskCenterConfig:[{type:S.Input}],attachment:[{type:S.Output}],signature:[{type:S.Output}],commentDialog:[{type:S.ViewChild,args:["commentDialog"]}],signDialog:[{type:S.ViewChild,args:["signDialog"]}],dropDownEl:[{type:S.ViewChild,args:["dropdownEl"]}],signaturePad:[{type:S.ViewChild,args:["wfSignHere"]}],farrisAvatar:[{type:S.ViewChild,args:["farrisAvatar"]}],dataGrid:[{type:S.ViewChild,args:["dataGrid"]}],commentTypeCell:[{type:S.ViewChild,args:["commentTypeCell"]}],commentOperateCell:[{type:S.ViewChild,args:["commentOperateCell"]}]},Ke);function Ke(e,t,s,n,i,r,o){this.taskService=e,this.httpSvc=t,this.uploadDialog=s,this.messageService=n,this.i18nService=i,this.loadingService=r,this.notify=o,this.showAttachment=!0,this.showSign=!0,this.showCommonComment=!0,this.placeholder="",this.textAreaHeight=120,this.attachment=new S.EventEmitter,this.signature=new S.EventEmitter,this._value="",this.attachmentList=[],this.ifShowAttachment=!1,this.ifShowSign=!1,this.downloadService=new k.DownloadService,this.ifUseSign=!1,this.ifUseImg=!0,this.ifEnableSign=!0,this.ifUploadImg=!1,this.ifCanEditSign=!0,this.commentList=[],this.originCommentList=[],this.commentColumns=[],this.onModelChange=function(e){},this.onModelTouched=function(e){},this.beforeEdit=function(e){return"*"==e.rowData.userId?C.of(!1):C.of(!0)}}var Ge=(Je.decorators=[{type:S.NgModule,args:[{declarations:[De,ye,Ee,Ue,Me,Fe,qe,fe],imports:[s.CommonModule,w.FormsModule,n.DataTableModule,i.FarrisDialogModule,r.PaginationModule,P.NotifyModule,o.ComboListModule,b.SysManagerUIModule,d.WfApprovalLogsModule,p.UiFlowchartModule,v.CommonSharedModule,U.LoadingModule,f.TaskImplApiModule,x.MessagerModule,a.InputGroupModule,g.WfSignModule,h.AvatarModule,m.FDropdownDirectiveTypeModule,c.DatagridModule,N.DatagridEditorsModule,c.DatagridModule.forRoot(E(N.EditorProviders)),l.FarrisFormsModule,u.SwitchModule],providers:[H,z,Ae,v.FrameworkService,T.SessionService,T.HttpService,T.CacheService,v.FrmEventBus,v.FuncsService],exports:[ye,Ee,Ue],entryComponents:[ye,Ee,Ue]}]}],Je);function Je(){}e.WfTaskHandlerService=Ae,e.WfTaskHandlerModule=Ge,e.TaskExecuteComponent=ye,e.TaskAssigninfoComponent=Ee,e.TaskService=H,e.I18nService=z,e.TranslatePipe=De,e.ProcessSelectorComponent=Ue,e.AssigneeInfoComponent=Me,e.TaskCommentComponent=qe,e.ɵa=fe,e.ɵb=Fe,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=gsp-wf-wf-task-handler.umd.min.js.map