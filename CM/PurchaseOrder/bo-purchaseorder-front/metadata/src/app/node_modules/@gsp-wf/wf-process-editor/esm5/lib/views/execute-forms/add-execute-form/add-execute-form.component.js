/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, ViewChild, TemplateRef } from '@angular/core';
import { ProcessDesignerUIState } from '../../../app/process-designer.uistate';
import { HttpService, SessionService } from '@ecp-caf/caf-common';
import { RtfAppHelpComponent } from '@gsp-sys/rtf-ui';
import { of, Subject, from, forkJoin } from 'rxjs';
import { ServerSideToken, LookupGridComponent } from '@farris/ui-lookup';
import { FormFormatService } from './form-format.service';
import { ExecuteFormModel, TerminalType, ActualParameter } from '../entities/execute-form.entity';
import { DatagridComponent } from '@farris/ui-datagrid';
import { MessagerService } from '@farris/ui-messager';
import { ExecuteForm } from '../entities/execute-form';
import { ProcessDeUtil } from '../../../domain/process-de-util';
import { map } from 'rxjs/operators';
var AddExecuteFormComponent = /** @class */ (function () {
    function AddExecuteFormComponent(state, http, session, message) {
        var _this = this;
        this.state = state;
        this.http = http;
        this.session = session;
        this.message = message;
        this.submit = new Subject();
        this.cancel = new Subject();
        this.forms = new Array();
        // private formTypeCollection = [
        //   { text: '流程嵌表单', value: '0' },
        //   { text: '表单嵌流程', value: '1' },
        // ];
        this.columns = [
            { field: 'code', width: 100, title: '编号' },
            {
                field: 'name', width: 100, title: '名称',
            },
            {
                field: 'tag', width: 80, title: '单据类型',
                formatter: (/**
                 * @param {?} v
                 * @param {?} d
                 * @param {?} i
                 * @return {?}
                 */
                function (v, d, i) {
                    if (d.appId) {
                        return '功能菜单';
                    }
                    else if (d.formFormatId) {
                        return '表单格式';
                    }
                })
            }
            // {
            //   field: 'formType', width: 80, title: '联查类型',
            //   formatter: {
            //     type: 'enum',
            //     options: { valueField: 'value', textField: 'text', data: this.formTypeCollection }
            //   },
            // },
        ];
        // 表单格式显示列
        this.cols = [
            {
                field: 'code', width: 100, title: '单据格式编号', searchField: 'code'
            }, {
                field: 'name', width: 100, title: '单据格式名称', searchField: 'name'
            }
        ];
        this.dataUri = '/api/runtime/wf/v1.0/formFormat/page';
        this.dictPicking = (/**
         * @param {?} arg
         * @return {?}
         */
        function (arg) {
            return of({
                showDialog: true, data: {
                    tab: _this.tab
                }
            });
        });
        this.dictPicked = (/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            /** @type {?} */
            var model = new ExecuteFormModel();
            model.Id = ProcessDeUtil.GenerateElementId();
            model.Name = data.name;
            model.ComponentId = null;
            model.FormType = '0';
            model.formFormatId = data.id;
            model.TerminalType = _this.tab === 'web' ? TerminalType.PC : TerminalType.MOBILE;
            model.ActualParameters = data.urlParameters.map((/**
             * @param {?} p
             * @return {?}
             */
            function (p) {
                /** @type {?} */
                var a = new ActualParameter();
                a.Name = p.code;
                a.Value = p.value;
                return a;
            }));
            _this.submit.next(model);
            return of({ closeDialog: true });
        });
    }
    /**
     * @return {?}
     */
    AddExecuteFormComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.getAllExecuteForms();
    };
    /**
     * @return {?}
     */
    AddExecuteFormComponent.prototype.clickOK = /**
     * @return {?}
     */
    function () {
        if (this.grid.selectedRow) {
            /** @type {?} */
            var form = this.grid.selectedRow.data;
            /** @type {?} */
            var model = new ExecuteFormModel();
            model.Id = ProcessDeUtil.GenerateElementId();
            model.Name = form.name;
            model.ComponentId = form.appId;
            model.FormType = form.formType;
            model.formFormatId = form.formFormatId;
            model.TerminalType = this.tab === 'web' ? TerminalType.PC : TerminalType.MOBILE;
            model.ActualParameters = form.actualParameters.map((/**
             * @param {?} p
             * @return {?}
             */
            function (p) {
                /** @type {?} */
                var a = new ActualParameter();
                a.Name = p.code;
                a.Value = p.value;
                return a;
            }));
            this.submit.next(model);
        }
        else {
            this.message.info('尚未选择表单定义！');
        }
    };
    /**
     * @return {?}
     */
    AddExecuteFormComponent.prototype.clickCancel = /**
     * @return {?}
     */
    function () {
        this.cancel.next();
    };
    /**
     * @return {?}
     */
    AddExecuteFormComponent.prototype.selectOtherFormFormat = /**
     * @return {?}
     */
    function () {
        this.lookUp.showDialog();
    };
    /**
     * @return {?}
     */
    AddExecuteFormComponent.prototype.selectOtherFunc = /**
     * @return {?}
     */
    function () {
        this.appHelper.showHelp(this.session.getUserSessionId());
    };
    /**
     * @param {?} apps
     * @return {?}
     */
    AddExecuteFormComponent.prototype.funcSelected = /**
     * @param {?} apps
     * @return {?}
     */
    function (apps) {
        var _this = this;
        if (apps && apps.length > 0) {
            /** @type {?} */
            var model_1 = new ExecuteFormModel();
            model_1.Id = ProcessDeUtil.GenerateElementId();
            model_1.Name = apps[0].Name;
            model_1.ComponentId = apps[0].Id;
            model_1.FormType = '0';
            model_1.formFormatId = null;
            model_1.TerminalType = this.tab === 'web' ? TerminalType.PC : TerminalType.MOBILE;
            model_1.ActualParameters = [];
            if (apps[0].InvokingConfig['entityParams']) {
                /** @type {?} */
                var paras = JSON.parse(apps[0].InvokingConfig['entityParams']);
                model_1.ActualParameters = paras.map((/**
                 * @param {?} p
                 * @return {?}
                 */
                function (p) { return ({
                    Name: p.name,
                    Value: ''
                }); }));
            }
            setTimeout((/**
             * @return {?}
             */
            function () {
                _this.submit.next(model_1);
            }), 0);
        }
    };
    /**
     * @private
     * @return {?}
     */
    AddExecuteFormComponent.prototype.getAllExecuteForms = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        forkJoin(this.getExecuteForms(), this.getFormFormats()).subscribe((/**
         * @param {?} re
         * @return {?}
         */
        function (re) {
            var e_1, _a;
            if (re[0]) {
                _this.forms = re[0];
            }
            if (re[1] && re[1].length > 0) {
                /** @type {?} */
                var formFormats = re[1];
                var _loop_1 = function (format) {
                    if (_this.forms.findIndex((/**
                     * @param {?} f
                     * @return {?}
                     */
                    function (f) { return f.formFormatId && f.formFormatId === format.id; })) === -1) {
                        /** @type {?} */
                        var executeForm = new ExecuteForm();
                        executeForm.id = ProcessDeUtil.createNM();
                        executeForm.flowFormKey = _this.state.flowFormInfo.flowForm.id;
                        executeForm.appId = null;
                        executeForm.code = format.code;
                        executeForm.name = format.name;
                        executeForm.actualParameters = [];
                        executeForm.isDefault = false;
                        executeForm.formType = '0';
                        executeForm.terminal = 'web';
                        executeForm.formFormatId = format.id;
                        executeForm.sysInit = 0;
                        executeForm.remarks = '';
                        if (format.urlParameters && format.urlParameters.length > 0) {
                            /** @type {?} */
                            var actPList = format.urlParameters.map((/**
                             * @param {?} p
                             * @return {?}
                             */
                            function (p) { return ({
                                code: p.code,
                                name: p.name,
                                value: p.value
                            }); }));
                            executeForm.actualParameters = actPList;
                        }
                        _this.forms.push(executeForm);
                    }
                };
                try {
                    for (var formFormats_1 = tslib_1.__values(formFormats), formFormats_1_1 = formFormats_1.next(); !formFormats_1_1.done; formFormats_1_1 = formFormats_1.next()) {
                        var format = formFormats_1_1.value;
                        _loop_1(format);
                    }
                }
                catch (e_1_1) { e_1 = { error: e_1_1 }; }
                finally {
                    try {
                        if (formFormats_1_1 && !formFormats_1_1.done && (_a = formFormats_1.return)) _a.call(formFormats_1);
                    }
                    finally { if (e_1) throw e_1.error; }
                }
            }
        }));
    };
    /**
     * @private
     * @return {?}
     */
    AddExecuteFormComponent.prototype.getExecuteForms = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.state.flowFormInfo.flowForm.id && this.tab) {
            /** @type {?} */
            var url = "/api/runtime/wf/v1.0/excuteForm?flowFormKey=" + this.state.flowFormInfo.flowForm.id;
            return this.http.get(url).pipe(map((/**
             * @param {?} re
             * @return {?}
             */
            function (re) {
                if (_this.tab === 'web') {
                    return re.filter((/**
                     * @param {?} f
                     * @return {?}
                     */
                    function (f) { return f.terminal.indexOf('web') > -1; }));
                }
                else if (_this.tab === 'mobile') {
                    return re.filter((/**
                     * @param {?} f
                     * @return {?}
                     */
                    function (f) { return f.terminal.indexOf('app') > -1; }));
                }
            })));
        }
        else {
            return from(new Array());
        }
    };
    /**
     * @private
     * @return {?}
     */
    AddExecuteFormComponent.prototype.getFormFormats = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.state.flowFormInfo.flowForm.businessObjectId && this.tab) {
            /** @type {?} */
            var terminal = this.tab === 'web' ? 'PC' : 'Mobile';
            /** @type {?} */
            var url = "/api/runtime/wf/v1.0/formFormat/query?param=";
            /** @type {?} */
            var param = "{\"bizCategory\":\"" + this.state.flowFormInfo.flowForm.businessObjectId + "\",\"terminal\":\"" + terminal + "\"}";
            param = encodeURIComponent(param);
            url += param;
            return this.http.get(url);
        }
        else {
            return from(new Array());
        }
    };
    AddExecuteFormComponent.decorators = [
        { type: Component, args: [{
                    selector: 'lib-add-execute-form',
                    template: "<div class=\"f-page f-page-is-managelist\">\r\n  <!-- <div class=\"f-page-header\">\r\n    <nav class=\"f-page-header-base mt-2 py-0\" style=\"min-height: 2rem;\">\r\n      <div class=\"f-title\">\r\n        <span class=\"f-title-icon f-text-orna-bill\">\r\n          <i class=\"f-icon f-icon-page-title-administer\"></i>\r\n        </span>\r\n        <h4 class=\"f-title-text\">\u8868\u5355\u683C\u5F0F\u5217\u8868</h4>\r\n      </div>\r\n      <div class=\"btn-toolbar btn-group-lg\">\r\n        <button class=\"btn btn-secondary mr-2\" (click)=\"selectOtherFormFormat()\">\r\n          \u5F15\u5165\u8868\u5355\u683C\u5F0F\r\n        </button>\r\n        <button class=\"btn btn-secondary\" (click)=\"selectOtherFunc()\">\r\n          \u5F15\u5165\u529F\u80FD\u83DC\u5355\r\n        </button>\r\n      </div>\r\n    </nav>\r\n  </div> -->\r\n  <div class=\"f-page-main my-0\">\r\n    <div class=\"f-struct-wrapper f-utils-fill-flex-column\">\r\n      <farris-section class=\"f-section-grid f-section-in-managelist p-2\" [showHeader]=\"false\">\r\n        <farris-datagrid class=\"f-component-grid\" [columns]=\"columns\" [data]=\"forms\" #grid\r\n          [idField]=\"'id'\" [showLineNumber]=\"true\" [striped]=\"true\"\r\n          [showCheckbox]=\"false\" [virtualized]=\"true\" [pagination]=\"false\" [fit]=\"true\" [fitColumns]=\"true\">\r\n        </farris-datagrid>\r\n      </farris-section>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<ng-template #iconSelectFooter>\r\n  <button type=\"button\" class=\"btn btn-primary btn-sm mx-2\" (click)=\"clickOK()\">\u786E\u5B9A</button>\r\n  <button type=\"button\" class=\"btn btn-secondary btn-sm\" (click)=\"clickCancel()\">\u53D6\u6D88</button>\r\n</ng-template>\r\n\r\n<app-rtf-app-help #appHelper (afterHelpConfirm)=\"funcSelected($event)\" [isLayeredLoad]=\"true\">\r\n</app-rtf-app-help>\r\n\r\n<!-- \u5355\u636E\u683C\u5F0F\u5E2E\u52A9 -->\r\n<farris-lookup-grid #lookup style=\"display: none;\" [editable]=\"false\" [columns]=\"cols\" [singleSelect]=\"true\"\r\n  [title]=\"'\u5355\u636E\u683C\u5F0F'\" [displayType]=\"'List'\" [uri]=\"dataUri\" [idField]=\"'id'\" [pageIndex]=\"1\" [pageSize]=\"20\"\r\n  [pagination]=\"true\" [valueField]=\"'id'\" [textField]=\"'name'\" [dialogWidth]=\"550\" [dictPicked]=\"dictPicked\"\r\n  [dictPicking]=\"dictPicking\">\r\n</farris-lookup-grid>\r\n",
                    providers: [{ provide: ServerSideToken, useClass: FormFormatService }],
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    AddExecuteFormComponent.ctorParameters = function () { return [
        { type: ProcessDesignerUIState },
        { type: HttpService },
        { type: SessionService },
        { type: MessagerService }
    ]; };
    AddExecuteFormComponent.propDecorators = {
        modalFooter: [{ type: ViewChild, args: ['iconSelectFooter',] }],
        appHelper: [{ type: ViewChild, args: [RtfAppHelpComponent,] }],
        lookUp: [{ type: ViewChild, args: ['lookup',] }],
        grid: [{ type: ViewChild, args: ['grid',] }]
    };
    return AddExecuteFormComponent;
}());
export { AddExecuteFormComponent };
if (false) {
    /** @type {?} */
    AddExecuteFormComponent.prototype.modalFooter;
    /** @type {?} */
    AddExecuteFormComponent.prototype.appHelper;
    /** @type {?} */
    AddExecuteFormComponent.prototype.lookUp;
    /**
     * @type {?}
     * @private
     */
    AddExecuteFormComponent.prototype.grid;
    /** @type {?} */
    AddExecuteFormComponent.prototype.submit;
    /** @type {?} */
    AddExecuteFormComponent.prototype.cancel;
    /** @type {?} */
    AddExecuteFormComponent.prototype.tab;
    /** @type {?} */
    AddExecuteFormComponent.prototype.forms;
    /** @type {?} */
    AddExecuteFormComponent.prototype.columns;
    /** @type {?} */
    AddExecuteFormComponent.prototype.cols;
    /** @type {?} */
    AddExecuteFormComponent.prototype.dataUri;
    /** @type {?} */
    AddExecuteFormComponent.prototype.dictPicking;
    /** @type {?} */
    AddExecuteFormComponent.prototype.dictPicked;
    /**
     * @type {?}
     * @private
     */
    AddExecuteFormComponent.prototype.state;
    /**
     * @type {?}
     * @private
     */
    AddExecuteFormComponent.prototype.http;
    /**
     * @type {?}
     * @private
     */
    AddExecuteFormComponent.prototype.session;
    /**
     * @type {?}
     * @private
     */
    AddExecuteFormComponent.prototype.message;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWRkLWV4ZWN1dGUtZm9ybS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLXdmL3dmLXByb2Nlc3MtZWRpdG9yLyIsInNvdXJjZXMiOlsibGliL3ZpZXdzL2V4ZWN1dGUtZm9ybXMvYWRkLWV4ZWN1dGUtZm9ybS9hZGQtZXhlY3V0ZS1mb3JtLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQThDLFNBQVMsRUFBRSxXQUFXLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFOUcsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sdUNBQXVDLENBQUM7QUFDL0UsT0FBTyxFQUFFLFdBQVcsRUFBRSxjQUFjLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUNsRSxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUV0RCxPQUFPLEVBQUUsRUFBRSxFQUFjLE9BQU8sRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQy9ELE9BQU8sRUFBZ0IsZUFBZSxFQUFFLG1CQUFtQixFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDdkYsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDMUQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLFlBQVksRUFBRSxlQUFlLEVBQUUsTUFBTSxpQ0FBaUMsQ0FBQztBQUNsRyxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN4RCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDdEQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQ3ZELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxpQ0FBaUMsQ0FBQztBQUNoRSxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFckM7SUEyREUsaUNBQ1UsS0FBNkIsRUFDN0Is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O0NBQUEsQUE1TkQsSUE0TkM7U0F0TlksdUJBQXVCOzs7SUFFbEMsOENBQTZEOztJQUM3RCw0Q0FBc0U7O0lBQ3RFLHlDQUF3RDs7Ozs7SUFDeEQsdUNBQW1EOztJQUVuRCx5Q0FBeUM7O0lBQ3pDLHlDQUF1Qjs7SUFFdkIsc0NBQXNCOztJQUV0Qix3Q0FBaUM7O0lBT2pDLDBDQXNCRTs7SUFHRix1Q0FNRTs7SUFFRiwwQ0FBaUQ7O0lBMENqRCw4Q0FNQzs7SUFFRCw2Q0FnQkM7Ozs7O0lBaEVDLHdDQUFxQzs7Ozs7SUFDckMsdUNBQXlCOzs7OztJQUN6QiwwQ0FBK0I7Ozs7O0lBQy9CLDBDQUFnQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBJbmplY3RvciwgQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLCBWaWV3Q2hpbGQsIFRlbXBsYXRlUmVmIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEJzTW9kYWxTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1tb2RhbCc7XHJcbmltcG9ydCB7IFByb2Nlc3NEZXNpZ25lclVJU3RhdGUgfSBmcm9tICcuLi8uLi8uLi9hcHAvcHJvY2Vzcy1kZXNpZ25lci51aXN0YXRlJztcclxuaW1wb3J0IHsgSHR0cFNlcnZpY2UsIFNlc3Npb25TZXJ2aWNlIH0gZnJvbSAnQGVjcC1jYWYvY2FmLWNvbW1vbic7XHJcbmltcG9ydCB7IFJ0ZkFwcEhlbHBDb21wb25lbnQgfSBmcm9tICdAZ3NwLXN5cy9ydGYtdWknO1xyXG5pbXBvcnQgeyBSdGZBcHAgfSBmcm9tICdAZ3NwLXN5cy9ydGYtdWkvbGliL3J0Zi1hcHAtaGVscC9lbnRpdGllcy9ydGYtYXBwJztcclxuaW1wb3J0IHsgb2YsIE9ic2VydmFibGUsIFN1YmplY3QsIGZyb20sIGZvcmtKb2luIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IFBpY2tlZFJlc3VsdCwgU2VydmVyU2lkZVRva2VuLCBMb29rdXBHcmlkQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1sb29rdXAnO1xyXG5pbXBvcnQgeyBGb3JtRm9ybWF0U2VydmljZSB9IGZyb20gJy4vZm9ybS1mb3JtYXQuc2VydmljZSc7XHJcbmltcG9ydCB7IEV4ZWN1dGVGb3JtTW9kZWwsIFRlcm1pbmFsVHlwZSwgQWN0dWFsUGFyYW1ldGVyIH0gZnJvbSAnLi4vZW50aXRpZXMvZXhlY3V0ZS1mb3JtLmVudGl0eSc7XHJcbmltcG9ydCB7IERhdGFncmlkQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1kYXRhZ3JpZCc7XHJcbmltcG9ydCB7IE1lc3NhZ2VyU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbWVzc2FnZXInO1xyXG5pbXBvcnQgeyBFeGVjdXRlRm9ybSB9IGZyb20gJy4uL2VudGl0aWVzL2V4ZWN1dGUtZm9ybSc7XHJcbmltcG9ydCB7IFByb2Nlc3NEZVV0aWwgfSBmcm9tICcuLi8uLi8uLi9kb21haW4vcHJvY2Vzcy1kZS11dGlsJztcclxuaW1wb3J0IHsgbWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdsaWItYWRkLWV4ZWN1dGUtZm9ybScsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL2FkZC1leGVjdXRlLWZvcm0uY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsczogWycuL2FkZC1leGVjdXRlLWZvcm0uY29tcG9uZW50LnNjc3MnXSxcclxuICBwcm92aWRlcnM6IFt7IHByb3ZpZGU6IFNlcnZlclNpZGVUb2tlbiwgdXNlQ2xhc3M6IEZvcm1Gb3JtYXRTZXJ2aWNlIH1dXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBBZGRFeGVjdXRlRm9ybUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XHJcblxyXG4gIEBWaWV3Q2hpbGQoJ2ljb25TZWxlY3RGb290ZXInKSBtb2RhbEZvb3RlcjogVGVtcGxhdGVSZWY8YW55PjtcclxuICBAVmlld0NoaWxkKFJ0ZkFwcEhlbHBDb21wb25lbnQpIHB1YmxpYyBhcHBIZWxwZXI6IFJ0ZkFwcEhlbHBDb21wb25lbnQ7XHJcbiAgQFZpZXdDaGlsZCgnbG9va3VwJykgcHVibGljIGxvb2tVcDogTG9va3VwR3JpZENvbXBvbmVudDtcclxuICBAVmlld0NoaWxkKCdncmlkJykgcHJpdmF0ZSBncmlkOiBEYXRhZ3JpZENvbXBvbmVudDtcclxuXHJcbiAgc3VibWl0ID0gbmV3IFN1YmplY3Q8RXhlY3V0ZUZvcm1Nb2RlbD4oKTtcclxuICBjYW5jZWwgPSBuZXcgU3ViamVjdCgpO1xyXG5cclxuICB0YWI6ICd3ZWInIHwgJ21vYmlsZSc7XHJcblxyXG4gIGZvcm1zID0gbmV3IEFycmF5PEV4ZWN1dGVGb3JtPigpO1xyXG5cclxuICAvLyBwcml2YXRlIGZvcm1UeXBlQ29sbGVjdGlvbiA9IFtcclxuICAvLyAgIHsgdGV4dDogJ+a1geeoi+W1jOihqOWNlScsIHZhbHVlOiAnMCcgfSxcclxuICAvLyAgIHsgdGV4dDogJ+ihqOWNleW1jOa1geeoiycsIHZhbHVlOiAnMScgfSxcclxuICAvLyBdO1xyXG5cclxuICBjb2x1bW5zID0gW1xyXG4gICAgeyBmaWVsZDogJ2NvZGUnLCB3aWR0aDogMTAwLCB0aXRsZTogJ+e8luWPtycgfSxcclxuICAgIHtcclxuICAgICAgZmllbGQ6ICduYW1lJywgd2lkdGg6IDEwMCwgdGl0bGU6ICflkI3np7AnLFxyXG4gICAgfSxcclxuICAgIHtcclxuICAgICAgZmllbGQ6ICd0YWcnLCB3aWR0aDogODAsIHRpdGxlOiAn5Y2V5o2u57G75Z6LJyxcclxuICAgICAgZm9ybWF0dGVyOiAodiwgZCwgaSkgPT4ge1xyXG4gICAgICAgIGlmIChkLmFwcElkKSB7XHJcbiAgICAgICAgICByZXR1cm4gJ+WKn+iDveiPnOWNlSc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChkLmZvcm1Gb3JtYXRJZCkge1xyXG4gICAgICAgICAgcmV0dXJuICfooajljZXmoLzlvI8nO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgLy8ge1xyXG4gICAgLy8gICBmaWVsZDogJ2Zvcm1UeXBlJywgd2lkdGg6IDgwLCB0aXRsZTogJ+iBlOafpeexu+WeiycsXHJcbiAgICAvLyAgIGZvcm1hdHRlcjoge1xyXG4gICAgLy8gICAgIHR5cGU6ICdlbnVtJyxcclxuICAgIC8vICAgICBvcHRpb25zOiB7IHZhbHVlRmllbGQ6ICd2YWx1ZScsIHRleHRGaWVsZDogJ3RleHQnLCBkYXRhOiB0aGlzLmZvcm1UeXBlQ29sbGVjdGlvbiB9XHJcbiAgICAvLyAgIH0sXHJcbiAgICAvLyB9LFxyXG4gIF07XHJcblxyXG4gIC8vIOihqOWNleagvOW8j+aYvuekuuWIl1xyXG4gIGNvbHMgPSBbXHJcbiAgICB7XHJcbiAgICAgIGZpZWxkOiAnY29kZScsIHdpZHRoOiAxMDAsIHRpdGxlOiAn5Y2V5o2u5qC85byP57yW5Y+3Jywgc2VhcmNoRmllbGQ6ICdjb2RlJ1xyXG4gICAgfSwge1xyXG4gICAgICBmaWVsZDogJ25hbWUnLCB3aWR0aDogMTAwLCB0aXRsZTogJ+WNleaNruagvOW8j+WQjeensCcsIHNlYXJjaEZpZWxkOiAnbmFtZSdcclxuICAgIH1cclxuICBdO1xyXG5cclxuICBkYXRhVXJpID0gJy9hcGkvcnVudGltZS93Zi92MS4wL2Zvcm1Gb3JtYXQvcGFnZSc7XHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIHN0YXRlOiBQcm9jZXNzRGVzaWduZXJVSVN0YXRlLFxyXG4gICAgcHJpdmF0ZSBodHRwOiBIdHRwU2VydmljZSxcclxuICAgIHByaXZhdGUgc2Vzc2lvbjogU2Vzc2lvblNlcnZpY2UsXHJcbiAgICBwcml2YXRlIG1lc3NhZ2U6IE1lc3NhZ2VyU2VydmljZVxyXG4gICkgeyB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gICAgdGhpcy5nZXRBbGxFeGVjdXRlRm9ybXMoKTtcclxuICB9XHJcblxyXG4gIGNsaWNrT0soKSB7XHJcbiAgICBpZiAodGhpcy5ncmlkLnNlbGVjdGVkUm93KSB7XHJcbiAgICAgIGNvbnN0IGZvcm06IEV4ZWN1dGVGb3JtID0gdGhpcy5ncmlkLnNlbGVjdGVkUm93LmRhdGE7XHJcbiAgICAgIGNvbnN0IG1vZGVsID0gbmV3IEV4ZWN1dGVGb3JtTW9kZWwoKTtcclxuICAgICAgbW9kZWwuSWQgPSBQcm9jZXNzRGVVdGlsLkdlbmVyYXRlRWxlbWVudElkKCk7XHJcbiAgICAgIG1vZGVsLk5hbWUgPSBmb3JtLm5hbWU7XHJcbiAgICAgIG1vZGVsLkNvbXBvbmVudElkID0gZm9ybS5hcHBJZDtcclxuICAgICAgbW9kZWwuRm9ybVR5cGUgPSBmb3JtLmZvcm1UeXBlO1xyXG4gICAgICBtb2RlbC5mb3JtRm9ybWF0SWQgPSBmb3JtLmZvcm1Gb3JtYXRJZDtcclxuICAgICAgbW9kZWwuVGVybWluYWxUeXBlID0gdGhpcy50YWIgPT09ICd3ZWInID8gVGVybWluYWxUeXBlLlBDIDogVGVybWluYWxUeXBlLk1PQklMRTtcclxuICAgICAgbW9kZWwuQWN0dWFsUGFyYW1ldGVycyA9IGZvcm0uYWN0dWFsUGFyYW1ldGVycy5tYXAocCA9PiB7XHJcbiAgICAgICAgY29uc3QgYSA9IG5ldyBBY3R1YWxQYXJhbWV0ZXIoKTtcclxuICAgICAgICBhLk5hbWUgPSBwLmNvZGU7XHJcbiAgICAgICAgYS5WYWx1ZSA9IHAudmFsdWU7XHJcbiAgICAgICAgcmV0dXJuIGE7XHJcbiAgICAgIH0pO1xyXG4gICAgICB0aGlzLnN1Ym1pdC5uZXh0KG1vZGVsKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMubWVzc2FnZS5pbmZvKCflsJrmnKrpgInmi6nooajljZXlrprkuYnvvIEnKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGNsaWNrQ2FuY2VsKCkge1xyXG4gICAgdGhpcy5jYW5jZWwubmV4dCgpO1xyXG4gIH1cclxuXHJcbiAgc2VsZWN0T3RoZXJGb3JtRm9ybWF0KCkge1xyXG4gICAgdGhpcy5sb29rVXAuc2hvd0RpYWxvZygpO1xyXG4gIH1cclxuXHJcbiAgZGljdFBpY2tpbmcgPSAoYXJnKSA9PiB7XHJcbiAgICByZXR1cm4gb2Yoe1xyXG4gICAgICBzaG93RGlhbG9nOiB0cnVlLCBkYXRhOiB7XHJcbiAgICAgICAgdGFiOiB0aGlzLnRhYlxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGRpY3RQaWNrZWQgPSAoZGF0YTogYW55KTogT2JzZXJ2YWJsZTxQaWNrZWRSZXN1bHQ+ID0+IHtcclxuICAgIGNvbnN0IG1vZGVsID0gbmV3IEV4ZWN1dGVGb3JtTW9kZWwoKTtcclxuICAgIG1vZGVsLklkID0gUHJvY2Vzc0RlVXRpbC5HZW5lcmF0ZUVsZW1lbnRJZCgpO1xyXG4gICAgbW9kZWwuTmFtZSA9IGRhdGEubmFtZTtcclxuICAgIG1vZGVsLkNvbXBvbmVudElkID0gbnVsbDtcclxuICAgIG1vZGVsLkZvcm1UeXBlID0gJzAnO1xyXG4gICAgbW9kZWwuZm9ybUZvcm1hdElkID0gZGF0YS5pZDtcclxuICAgIG1vZGVsLlRlcm1pbmFsVHlwZSA9IHRoaXMudGFiID09PSAnd2ViJyA/IFRlcm1pbmFsVHlwZS5QQyA6IFRlcm1pbmFsVHlwZS5NT0JJTEU7XHJcbiAgICBtb2RlbC5BY3R1YWxQYXJhbWV0ZXJzID0gZGF0YS51cmxQYXJhbWV0ZXJzLm1hcChwID0+IHtcclxuICAgICAgY29uc3QgYSA9IG5ldyBBY3R1YWxQYXJhbWV0ZXIoKTtcclxuICAgICAgYS5OYW1lID0gcC5jb2RlO1xyXG4gICAgICBhLlZhbHVlID0gcC52YWx1ZTtcclxuICAgICAgcmV0dXJuIGE7XHJcbiAgICB9KTtcclxuICAgIHRoaXMuc3VibWl0Lm5leHQobW9kZWwpO1xyXG4gICAgcmV0dXJuIG9mKHsgY2xvc2VEaWFsb2c6IHRydWUgfSk7XHJcbiAgfVxyXG5cclxuICBzZWxlY3RPdGhlckZ1bmMoKSB7XHJcbiAgICB0aGlzLmFwcEhlbHBlci5zaG93SGVscCh0aGlzLnNlc3Npb24uZ2V0VXNlclNlc3Npb25JZCgpKTtcclxuICB9XHJcblxyXG4gIGZ1bmNTZWxlY3RlZChhcHBzOiBSdGZBcHBbXSkge1xyXG4gICAgaWYgKGFwcHMgJiYgYXBwcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGNvbnN0IG1vZGVsID0gbmV3IEV4ZWN1dGVGb3JtTW9kZWwoKTtcclxuICAgICAgbW9kZWwuSWQgPSBQcm9jZXNzRGVVdGlsLkdlbmVyYXRlRWxlbWVudElkKCk7XHJcbiAgICAgIG1vZGVsLk5hbWUgPSBhcHBzWzBdLk5hbWU7XHJcbiAgICAgIG1vZGVsLkNvbXBvbmVudElkID0gYXBwc1swXS5JZDtcclxuICAgICAgbW9kZWwuRm9ybVR5cGUgPSAnMCc7XHJcbiAgICAgIG1vZGVsLmZvcm1Gb3JtYXRJZCA9IG51bGw7XHJcbiAgICAgIG1vZGVsLlRlcm1pbmFsVHlwZSA9IHRoaXMudGFiID09PSAnd2ViJyA/IFRlcm1pbmFsVHlwZS5QQyA6IFRlcm1pbmFsVHlwZS5NT0JJTEU7XHJcbiAgICAgIG1vZGVsLkFjdHVhbFBhcmFtZXRlcnMgPSBbXTtcclxuICAgICAgaWYgKGFwcHNbMF0uSW52b2tpbmdDb25maWdbJ2VudGl0eVBhcmFtcyddKSB7XHJcbiAgICAgICAgY29uc3QgcGFyYXMgPSBKU09OLnBhcnNlKGFwcHNbMF0uSW52b2tpbmdDb25maWdbJ2VudGl0eVBhcmFtcyddKTtcclxuICAgICAgICBtb2RlbC5BY3R1YWxQYXJhbWV0ZXJzID0gcGFyYXMubWFwKHAgPT4gKHtcclxuICAgICAgICAgIE5hbWU6IHAubmFtZSxcclxuICAgICAgICAgIFZhbHVlOiAnJ1xyXG4gICAgICAgIH0pKTtcclxuICAgICAgfVxyXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICB0aGlzLnN1Ym1pdC5uZXh0KG1vZGVsKTtcclxuICAgICAgfSwgMCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldEFsbEV4ZWN1dGVGb3JtcygpIHtcclxuICAgIGZvcmtKb2luKHRoaXMuZ2V0RXhlY3V0ZUZvcm1zKCksIHRoaXMuZ2V0Rm9ybUZvcm1hdHMoKSkuc3Vic2NyaWJlKHJlID0+IHtcclxuICAgICAgaWYgKHJlWzBdKSB7XHJcbiAgICAgICAgdGhpcy5mb3JtcyA9IHJlWzBdO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChyZVsxXSAmJiByZVsxXS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgY29uc3QgZm9ybUZvcm1hdHMgPSByZVsxXTtcclxuICAgICAgICBmb3IgKGNvbnN0IGZvcm1hdCBvZiBmb3JtRm9ybWF0cykge1xyXG4gICAgICAgICAgaWYgKHRoaXMuZm9ybXMuZmluZEluZGV4KGYgPT4gZi5mb3JtRm9ybWF0SWQgJiYgZi5mb3JtRm9ybWF0SWQgPT09IGZvcm1hdC5pZCkgPT09IC0xKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGV4ZWN1dGVGb3JtID0gbmV3IEV4ZWN1dGVGb3JtKCk7XHJcbiAgICAgICAgICAgIGV4ZWN1dGVGb3JtLmlkID0gUHJvY2Vzc0RlVXRpbC5jcmVhdGVOTSgpO1xyXG4gICAgICAgICAgICBleGVjdXRlRm9ybS5mbG93Rm9ybUtleSA9IHRoaXMuc3RhdGUuZmxvd0Zvcm1JbmZvLmZsb3dGb3JtLmlkO1xyXG4gICAgICAgICAgICBleGVjdXRlRm9ybS5hcHBJZCA9IG51bGw7XHJcbiAgICAgICAgICAgIGV4ZWN1dGVGb3JtLmNvZGUgPSBmb3JtYXQuY29kZTtcclxuICAgICAgICAgICAgZXhlY3V0ZUZvcm0ubmFtZSA9IGZvcm1hdC5uYW1lO1xyXG4gICAgICAgICAgICBleGVjdXRlRm9ybS5hY3R1YWxQYXJhbWV0ZXJzID0gW107XHJcbiAgICAgICAgICAgIGV4ZWN1dGVGb3JtLmlzRGVmYXVsdCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBleGVjdXRlRm9ybS5mb3JtVHlwZSA9ICcwJztcclxuICAgICAgICAgICAgZXhlY3V0ZUZvcm0udGVybWluYWwgPSAnd2ViJztcclxuICAgICAgICAgICAgZXhlY3V0ZUZvcm0uZm9ybUZvcm1hdElkID0gZm9ybWF0LmlkO1xyXG4gICAgICAgICAgICBleGVjdXRlRm9ybS5zeXNJbml0ID0gMDtcclxuICAgICAgICAgICAgZXhlY3V0ZUZvcm0ucmVtYXJrcyA9ICcnO1xyXG4gICAgICAgICAgICBpZiAoZm9ybWF0LnVybFBhcmFtZXRlcnMgJiYgZm9ybWF0LnVybFBhcmFtZXRlcnMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgIGNvbnN0IGFjdFBMaXN0ID0gZm9ybWF0LnVybFBhcmFtZXRlcnMubWFwKHAgPT4gKHtcclxuICAgICAgICAgICAgICAgIGNvZGU6IHAuY29kZSxcclxuICAgICAgICAgICAgICAgIG5hbWU6IHAubmFtZSxcclxuICAgICAgICAgICAgICAgIHZhbHVlOiBwLnZhbHVlXHJcbiAgICAgICAgICAgICAgfSkpO1xyXG4gICAgICAgICAgICAgIGV4ZWN1dGVGb3JtLmFjdHVhbFBhcmFtZXRlcnMgPSBhY3RQTGlzdDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmZvcm1zLnB1c2goZXhlY3V0ZUZvcm0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldEV4ZWN1dGVGb3JtcygpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgaWYgKHRoaXMuc3RhdGUuZmxvd0Zvcm1JbmZvLmZsb3dGb3JtLmlkICYmIHRoaXMudGFiKSB7XHJcbiAgICAgIGNvbnN0IHVybCA9IGAvYXBpL3J1bnRpbWUvd2YvdjEuMC9leGN1dGVGb3JtP2Zsb3dGb3JtS2V5PSR7dGhpcy5zdGF0ZS5mbG93Rm9ybUluZm8uZmxvd0Zvcm0uaWR9YDtcclxuICAgICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQodXJsKS5waXBlKFxyXG4gICAgICAgIG1hcCgocmU6IGFueSkgPT4ge1xyXG4gICAgICAgICAgaWYgKHRoaXMudGFiID09PSAnd2ViJykge1xyXG4gICAgICAgICAgICByZXR1cm4gcmUuZmlsdGVyKGYgPT4gZi50ZXJtaW5hbC5pbmRleE9mKCd3ZWInKSA+IC0xKTtcclxuICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy50YWIgPT09ICdtb2JpbGUnKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZS5maWx0ZXIoZiA9PiBmLnRlcm1pbmFsLmluZGV4T2YoJ2FwcCcpID4gLTEpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgICk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gZnJvbShuZXcgQXJyYXkoKSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldEZvcm1Gb3JtYXRzKCk6IE9ic2VydmFibGU8YW55PiAge1xyXG4gICAgaWYgKHRoaXMuc3RhdGUuZmxvd0Zvcm1JbmZvLmZsb3dGb3JtLmJ1c2luZXNzT2JqZWN0SWQgJiYgdGhpcy50YWIpIHtcclxuICAgICAgY29uc3QgdGVybWluYWwgPSB0aGlzLnRhYiA9PT0gJ3dlYicgPyAnUEMnIDogJ01vYmlsZSc7XHJcbiAgICAgIGxldCB1cmwgPSBgL2FwaS9ydW50aW1lL3dmL3YxLjAvZm9ybUZvcm1hdC9xdWVyeT9wYXJhbT1gO1xyXG4gICAgICBsZXQgcGFyYW0gPSBge1wiYml6Q2F0ZWdvcnlcIjpcIiR7dGhpcy5zdGF0ZS5mbG93Rm9ybUluZm8uZmxvd0Zvcm0uYnVzaW5lc3NPYmplY3RJZH1cIixcInRlcm1pbmFsXCI6XCIke3Rlcm1pbmFsfVwifWA7XHJcbiAgICAgIHBhcmFtID0gZW5jb2RlVVJJQ29tcG9uZW50KHBhcmFtKTtcclxuICAgICAgdXJsICs9IHBhcmFtO1xyXG4gICAgICByZXR1cm4gdGhpcy5odHRwLmdldCh1cmwpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIGZyb20obmV3IEFycmF5KCkpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbn1cclxuIl19