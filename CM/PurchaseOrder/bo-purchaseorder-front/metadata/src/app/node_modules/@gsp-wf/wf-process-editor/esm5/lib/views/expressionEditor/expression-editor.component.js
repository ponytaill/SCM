/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, Output, Input, EventEmitter, ViewChild, TemplateRef } from '@angular/core';
import { ExpressionService, ExpressioneditorComponent, ComputeRuleEditorComponent } from '@gsp-svc/expression';
import { ProcessDesignerUIState } from '../../app/process-designer.uistate';
var ExpressionEditorComponent = /** @class */ (function () {
    function ExpressionEditorComponent(expr, designerState) {
        this.expr = expr;
        this.designerState = designerState;
        this.closeModal = new EventEmitter();
        this.submitModal = new EventEmitter();
        this.editorParams = {};
        this.contextEntities = [];
        this.schema = {};
        this.injectName = '';
        this.modalConfig = {
            title: '条件编辑',
            width: 1140,
            height: 520,
            showButtons: true
        };
        if (this.designerState.schemas[0]) {
            this.schema = this.designerState.schemas[0];
            if (this.designerState.schemas[0].entityTypes && this.designerState.schemas[0].entityTypes.length > 0) {
                this.injectName = this.designerState.schemas[0].entityTypes[0].name;
            }
        }
    }
    /**
     * @return {?}
     */
    ExpressionEditorComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var e_1, _a, e_2, _b, e_3, _c, e_4, _d, e_5, _e;
        this.contextEntities = new Array();
        if (this.designerState.procInstContext.length > 0) {
            try {
                for (var _f = tslib_1.__values(this.designerState.procInstContext), _g = _f.next(); !_g.done; _g = _f.next()) {
                    var variable = _g.value;
                    this.contextEntities = this.contextEntities.concat([variable]);
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (_g && !_g.done && (_a = _f.return)) _a.call(_f);
                }
                finally { if (e_1) throw e_1.error; }
            }
        }
        if (this.designerState.formalParameterContext.length > 0) {
            var _loop_1 = function (variable) {
                if (!this_1.contextEntities.some((/**
                 * @param {?} c
                 * @return {?}
                 */
                function (c) { return c.key === variable.key; }))) {
                    this_1.contextEntities = this_1.contextEntities.concat([variable]);
                }
            };
            var this_1 = this;
            try {
                for (var _h = tslib_1.__values(this.designerState.formalParameterContext), _j = _h.next(); !_j.done; _j = _h.next()) {
                    var variable = _j.value;
                    _loop_1(variable);
                }
            }
            catch (e_2_1) { e_2 = { error: e_2_1 }; }
            finally {
                try {
                    if (_j && !_j.done && (_b = _h.return)) _b.call(_h);
                }
                finally { if (e_2) throw e_2.error; }
            }
        }
        if (this.designerState.participantContext.length > 0) {
            var _loop_2 = function (variable) {
                if (!this_2.contextEntities.some((/**
                 * @param {?} c
                 * @return {?}
                 */
                function (c) { return c.key === variable.key; }))) {
                    this_2.contextEntities = this_2.contextEntities.concat([variable]);
                }
            };
            var this_2 = this;
            try {
                for (var _k = tslib_1.__values(this.designerState.participantContext), _l = _k.next(); !_l.done; _l = _k.next()) {
                    var variable = _l.value;
                    _loop_2(variable);
                }
            }
            catch (e_3_1) { e_3 = { error: e_3_1 }; }
            finally {
                try {
                    if (_l && !_l.done && (_c = _k.return)) _c.call(_k);
                }
                finally { if (e_3) throw e_3.error; }
            }
        }
        if (this.designerState.activityComponentContext.length > 0) {
            var _loop_3 = function (variable) {
                if (!this_3.contextEntities.some((/**
                 * @param {?} c
                 * @return {?}
                 */
                function (c) { return c.key === variable.key; }))) {
                    this_3.contextEntities = this_3.contextEntities.concat([variable]);
                }
            };
            var this_3 = this;
            try {
                for (var _m = tslib_1.__values(this.designerState.activityComponentContext), _o = _m.next(); !_o.done; _o = _m.next()) {
                    var variable = _o.value;
                    _loop_3(variable);
                }
            }
            catch (e_4_1) { e_4 = { error: e_4_1 }; }
            finally {
                try {
                    if (_o && !_o.done && (_d = _m.return)) _d.call(_m);
                }
                finally { if (e_4) throw e_4.error; }
            }
        }
        if (this.designerState.processVariableContext.length > 0) {
            var _loop_4 = function (variable) {
                if (!this_4.contextEntities.some((/**
                 * @param {?} c
                 * @return {?}
                 */
                function (c) { return c.key === variable.key; }))) {
                    this_4.contextEntities = this_4.contextEntities.concat([variable]);
                }
            };
            var this_4 = this;
            try {
                for (var _p = tslib_1.__values(this.designerState.processVariableContext), _q = _p.next(); !_q.done; _q = _p.next()) {
                    var variable = _q.value;
                    _loop_4(variable);
                }
            }
            catch (e_5_1) { e_5 = { error: e_5_1 }; }
            finally {
                try {
                    if (_q && !_q.done && (_e = _p.return)) _e.call(_p);
                }
                finally { if (e_5) throw e_5.error; }
            }
        }
    };
    /**
     * @return {?}
     */
    ExpressionEditorComponent.prototype.clickOK = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var result = this.compute.getExpr();
        this.value = this.convertToValue(result.text);
        /** @type {?} */
        var object = { value: this.value, parameters: null };
        this.submitModal.emit(object);
    };
    /**
     * 切换表达式类型（简易表达式<--->高级表达式）
     */
    /**
     * 切换表达式类型（简易表达式<--->高级表达式）
     * @return {?}
     */
    ExpressionEditorComponent.prototype.changeType = /**
     * 切换表达式类型（简易表达式<--->高级表达式）
     * @return {?}
     */
    function () {
        this.compute.changeType();
    };
    /**
     * @return {?}
     */
    ExpressionEditorComponent.prototype.clickCancel = /**
     * @return {?}
     */
    function () {
        this.closeModal.emit();
    };
    /**
     * @private
     * @param {?} val
     * @return {?}
     */
    ExpressionEditorComponent.prototype.convertToValue = /**
     * @private
     * @param {?} val
     * @return {?}
     */
    function (val) {
        if (val) {
            if (val.substring(9, val.length - 2)) {
                return val;
            }
            else {
                return '';
            }
        }
        else {
            return '';
        }
    };
    ExpressionEditorComponent.decorators = [
        { type: Component, args: [{
                    selector: 'app-expression-editor',
                    template: "<app-compute-rule-editor #compute\r\n  [text]=\"value\"\r\n  [advancedContexts]=\"contextEntities\"\r\n  [injectName]=\"injectName\"\r\n  [injectSchemaName]=\"'Schema'\"\r\n  [injectNameInSchema]=\"injectName\"\r\n  [schema]=\"schema\"\r\n  [schemaName]=\"'Schema'\"   >\r\n</app-compute-rule-editor>\r\n\r\n<ng-template #iconSelectFooter>\r\n  <div class=\"btns\">\r\n    <button type=\"button\" class=\"btn btn-primary btn-sm mr-2\" (click)=\"clickOK()\">\u786E\u5B9A</button>\r\n    <button type=\"button\" class=\"btn btn-secondary btn-sm mr-2\" (click)=\"changeType()\">\u5207\u6362\u7C7B\u578B</button>\r\n    <button type=\"button\" class=\"btn btn-secondary btn-sm\" (click)=\"clickCancel()\">\u53D6\u6D88</button>\r\n  </div>\r\n</ng-template>\r\n",
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    ExpressionEditorComponent.ctorParameters = function () { return [
        { type: ExpressionService },
        { type: ProcessDesignerUIState }
    ]; };
    ExpressionEditorComponent.propDecorators = {
        closeModal: [{ type: Output }],
        submitModal: [{ type: Output }],
        value: [{ type: Input }],
        modalFooter: [{ type: ViewChild, args: ['iconSelectFooter',] }],
        editorParams: [{ type: Input }],
        editor: [{ type: ViewChild, args: [ExpressioneditorComponent,] }],
        compute: [{ type: ViewChild, args: ['compute',] }]
    };
    return ExpressionEditorComponent;
}());
export { ExpressionEditorComponent };
if (false) {
    /** @type {?} */
    ExpressionEditorComponent.prototype.closeModal;
    /** @type {?} */
    ExpressionEditorComponent.prototype.submitModal;
    /** @type {?} */
    ExpressionEditorComponent.prototype.value;
    /** @type {?} */
    ExpressionEditorComponent.prototype.modalFooter;
    /** @type {?} */
    ExpressionEditorComponent.prototype.editorParams;
    /** @type {?} */
    ExpressionEditorComponent.prototype.editor;
    /** @type {?} */
    ExpressionEditorComponent.prototype.compute;
    /** @type {?} */
    ExpressionEditorComponent.prototype.contextEntities;
    /** @type {?} */
    ExpressionEditorComponent.prototype.schema;
    /** @type {?} */
    ExpressionEditorComponent.prototype.injectName;
    /** @type {?} */
    ExpressionEditorComponent.prototype.modalConfig;
    /**
     * @type {?}
     * @private
     */
    ExpressionEditorComponent.prototype.expr;
    /** @type {?} */
    ExpressionEditorComponent.prototype.designerState;
}
var ExpressionEditorConverter = /** @class */ (function () {
    function ExpressionEditorConverter() {
    }
    /**
     * @param {?} data
     * @return {?}
     */
    ExpressionEditorConverter.prototype.convertTo = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        if (data) {
            return data;
        }
        else {
            return '（未设置）';
        }
    };
    return ExpressionEditorConverter;
}());
export { ExpressionEditorConverter };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXhwcmVzc2lvbi1lZGl0b3IuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdzcC13Zi93Zi1wcm9jZXNzLWVkaXRvci8iLCJzb3VyY2VzIjpbImxpYi92aWV3cy9leHByZXNzaW9uRWRpdG9yL2V4cHJlc3Npb24tZWRpdG9yLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsTUFBTSxFQUFFLEtBQUssRUFBRSxZQUFZLEVBQUUsU0FBUyxFQUFFLFdBQVcsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN2RyxPQUFPLEVBQUUsaUJBQWlCLEVBQUUseUJBQXlCLEVBQUUsMEJBQTBCLEVBQWdCLE1BQU0scUJBQXFCLENBQUM7QUFDN0gsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sb0NBQW9DLENBQUM7QUFHNUU7SUE2QkUsbUNBQ1UsSUFBdUIsRUFDeEIsYUFBcUM7UUFEcEMsU0FBSSxHQUFKLElBQUksQ0FBbUI7UUFDeEIsa0JBQWEsR0FBYixhQUFhLENBQXdCO1FBekJwQyxlQUFVLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUNyQyxnQkFBVyxHQUFHLElBQUksWUFBWSxFQUFPLENBQUM7UUFNdkMsaUJBQVksR0FBUSxFQUFFLENBQUM7UUFLaEMsb0JBQWUsR0FBRyxFQUFFLENBQUM7UUFFckIsV0FBTSxHQUFRLEVBQUUsQ0FBQztRQUNqQixlQUFVLEdBQUcsRUFBRSxDQUFDO1FBQ2hCLGdCQUFXLEdBQUc7WUFDWixLQUFLLEVBQUUsTUFBTTtZQUNiLEtBQUssRUFBRSxJQUFJO1lBQ1gsTUFBTSxFQUFFLEdBQUc7WUFDWCxXQUFXLEVBQUUsSUFBSTtTQUNsQixDQUFDO1FBTUEsSUFBSSxJQUFJLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRTtZQUNqQyxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLENBQUMs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SSxHQUFHLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxFQUFFO2dCQUNwQyxPQUFPLEdBQUcsQ0FBQzthQUNaO2lCQUFNO2dCQUNMLE9BQU8sRUFBRSxDQUFDO2FBQ1g7U0FDRjthQUFNO1lBQ0wsT0FBTyxFQUFFLENBQUM7U0FDWDtJQUNILENBQUM7O2dCQTFHRixTQUFTLFNBQUM7b0JBQ1QsUUFBUSxFQUFFLHVCQUF1QjtvQkFDakMsZ3dCQUFpRDs7aUJBRWxEOzs7O2dCQVJRLGlCQUFpQjtnQkFDakIsc0JBQXNCOzs7NkJBUzVCLE1BQU07OEJBQ04sTUFBTTt3QkFFTixLQUFLOzhCQUVMLFNBQVMsU0FBQyxrQkFBa0I7K0JBRTVCLEtBQUs7eUJBRUwsU0FBUyxTQUFDLHlCQUF5QjswQkFDbkMsU0FBUyxTQUFDLFNBQVM7O0lBMkZ0QixnQ0FBQztDQUFBLEFBM0dELElBMkdDO1NBdEdZLHlCQUF5Qjs7O0lBQ3BDLCtDQUErQzs7SUFDL0MsZ0RBQWdEOztJQUVoRCwwQ0FBdUI7O0lBRXZCLGdEQUE2RDs7SUFFN0QsaURBQWdDOztJQUVoQywyQ0FBd0U7O0lBQ3hFLDRDQUEwRDs7SUFFMUQsb0RBQXFCOztJQUVyQiwyQ0FBaUI7O0lBQ2pCLCtDQUFnQjs7SUFDaEIsZ0RBS0U7Ozs7O0lBR0EseUNBQStCOztJQUMvQixrREFBNEM7O0FBNkVoRDtJQUNFO0lBQWdCLENBQUM7Ozs7O0lBRWpCLDZDQUFTOzs7O0lBQVQsVUFBVSxJQUFTO1FBQ2pCLElBQUksSUFBSSxFQUFFO1lBQ1IsT0FBTyxJQUFJLENBQUM7U0FDYjthQUFNO1lBQ0wsT0FBTyxPQUFPLENBQUM7U0FDaEI7SUFDSCxDQUFDO0lBQ0gsZ0NBQUM7QUFBRCxDQUFDLEFBVkQsSUFVQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBPdXRwdXQsIElucHV0LCBFdmVudEVtaXR0ZXIsIFZpZXdDaGlsZCwgVGVtcGxhdGVSZWYgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgRXhwcmVzc2lvblNlcnZpY2UsIEV4cHJlc3Npb25lZGl0b3JDb21wb25lbnQsIENvbXB1dGVSdWxlRWRpdG9yQ29tcG9uZW50LCBFeHByRWRpdE1vZGUgfSBmcm9tICdAZ3NwLXN2Yy9leHByZXNzaW9uJztcclxuaW1wb3J0IHsgUHJvY2Vzc0Rlc2lnbmVyVUlTdGF0ZSB9IGZyb20gJy4uLy4uL2FwcC9wcm9jZXNzLWRlc2lnbmVyLnVpc3RhdGUnO1xyXG5pbXBvcnQgeyBUeXBlQ29udmVydGVyIH0gZnJvbSAnQGZhcnJpcy91aS1wcm9wZXJ0eS1wYW5lbCc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ2FwcC1leHByZXNzaW9uLWVkaXRvcicsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL2V4cHJlc3Npb24tZWRpdG9yLmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi9leHByZXNzaW9uLWVkaXRvci5jb21wb25lbnQuY3NzJ10sXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBFeHByZXNzaW9uRWRpdG9yQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuICBAT3V0cHV0KCkgY2xvc2VNb2RhbCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG4gIEBPdXRwdXQoKSBzdWJtaXRNb2RhbCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG5cclxuICBASW5wdXQoKSB2YWx1ZTogc3RyaW5nO1xyXG5cclxuICBAVmlld0NoaWxkKCdpY29uU2VsZWN0Rm9vdGVyJykgbW9kYWxGb290ZXI6IFRlbXBsYXRlUmVmPGFueT47XHJcblxyXG4gIEBJbnB1dCgpIGVkaXRvclBhcmFtczogYW55ID0ge307XHJcblxyXG4gIEBWaWV3Q2hpbGQoRXhwcmVzc2lvbmVkaXRvckNvbXBvbmVudCkgZWRpdG9yOiBFeHByZXNzaW9uZWRpdG9yQ29tcG9uZW50O1xyXG4gIEBWaWV3Q2hpbGQoJ2NvbXB1dGUnKSBjb21wdXRlOiBDb21wdXRlUnVsZUVkaXRvckNvbXBvbmVudDtcclxuXHJcbiAgY29udGV4dEVudGl0aWVzID0gW107XHJcblxyXG4gIHNjaGVtYTogYW55ID0ge307XHJcbiAgaW5qZWN0TmFtZSA9ICcnO1xyXG4gIG1vZGFsQ29uZmlnID0ge1xyXG4gICAgdGl0bGU6ICfmnaHku7bnvJbovpEnLFxyXG4gICAgd2lkdGg6IDExNDAsXHJcbiAgICBoZWlnaHQ6IDUyMCxcclxuICAgIHNob3dCdXR0b25zOiB0cnVlXHJcbiAgfTtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIGV4cHI6IEV4cHJlc3Npb25TZXJ2aWNlLFxyXG4gICAgcHVibGljIGRlc2lnbmVyU3RhdGU6IFByb2Nlc3NEZXNpZ25lclVJU3RhdGVcclxuICApIHtcclxuICAgIGlmICh0aGlzLmRlc2lnbmVyU3RhdGUuc2NoZW1hc1swXSkge1xyXG4gICAgICB0aGlzLnNjaGVtYSA9IHRoaXMuZGVzaWduZXJTdGF0ZS5zY2hlbWFzWzBdO1xyXG4gICAgICBpZiAodGhpcy5kZXNpZ25lclN0YXRlLnNjaGVtYXNbMF0uZW50aXR5VHlwZXMgJiYgdGhpcy5kZXNpZ25lclN0YXRlLnNjaGVtYXNbMF0uZW50aXR5VHlwZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIHRoaXMuaW5qZWN0TmFtZSA9IHRoaXMuZGVzaWduZXJTdGF0ZS5zY2hlbWFzWzBdLmVudGl0eVR5cGVzWzBdLm5hbWU7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gICAgdGhpcy5jb250ZXh0RW50aXRpZXMgPSBuZXcgQXJyYXkoKTtcclxuICAgIGlmICh0aGlzLmRlc2lnbmVyU3RhdGUucHJvY0luc3RDb250ZXh0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgZm9yIChjb25zdCB2YXJpYWJsZSBvZiB0aGlzLmRlc2lnbmVyU3RhdGUucHJvY0luc3RDb250ZXh0KSB7XHJcbiAgICAgICAgdGhpcy5jb250ZXh0RW50aXRpZXMgPSB0aGlzLmNvbnRleHRFbnRpdGllcy5jb25jYXQoW3ZhcmlhYmxlXSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGlmICh0aGlzLmRlc2lnbmVyU3RhdGUuZm9ybWFsUGFyYW1ldGVyQ29udGV4dC5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGZvciAoY29uc3QgdmFyaWFibGUgb2YgdGhpcy5kZXNpZ25lclN0YXRlLmZvcm1hbFBhcmFtZXRlckNvbnRleHQpIHtcclxuICAgICAgICBpZiAoIXRoaXMuY29udGV4dEVudGl0aWVzLnNvbWUoYyA9PiBjLmtleSA9PT0gdmFyaWFibGUua2V5KSkge1xyXG4gICAgICAgICAgdGhpcy5jb250ZXh0RW50aXRpZXMgPSB0aGlzLmNvbnRleHRFbnRpdGllcy5jb25jYXQoW3ZhcmlhYmxlXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5kZXNpZ25lclN0YXRlLnBhcnRpY2lwYW50Q29udGV4dC5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGZvciAoY29uc3QgdmFyaWFibGUgb2YgdGhpcy5kZXNpZ25lclN0YXRlLnBhcnRpY2lwYW50Q29udGV4dCkge1xyXG4gICAgICAgIGlmICghdGhpcy5jb250ZXh0RW50aXRpZXMuc29tZShjID0+IGMua2V5ID09PSB2YXJpYWJsZS5rZXkpKSB7XHJcbiAgICAgICAgICB0aGlzLmNvbnRleHRFbnRpdGllcyA9IHRoaXMuY29udGV4dEVudGl0aWVzLmNvbmNhdChbdmFyaWFibGVdKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGlmICh0aGlzLmRlc2lnbmVyU3RhdGUuYWN0aXZpdHlDb21wb25lbnRDb250ZXh0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgZm9yIChjb25zdCB2YXJpYWJsZSBvZiB0aGlzLmRlc2lnbmVyU3RhdGUuYWN0aXZpdHlDb21wb25lbnRDb250ZXh0KSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmNvbnRleHRFbnRpdGllcy5zb21lKGMgPT4gYy5rZXkgPT09IHZhcmlhYmxlLmtleSkpIHtcclxuICAgICAgICAgIHRoaXMuY29udGV4dEVudGl0aWVzID0gdGhpcy5jb250ZXh0RW50aXRpZXMuY29uY2F0KFt2YXJpYWJsZV0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMuZGVzaWduZXJTdGF0ZS5wcm9jZXNzVmFyaWFibGVDb250ZXh0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgZm9yIChjb25zdCB2YXJpYWJsZSBvZiB0aGlzLmRlc2lnbmVyU3RhdGUucHJvY2Vzc1ZhcmlhYmxlQ29udGV4dCkge1xyXG4gICAgICAgIGlmICghdGhpcy5jb250ZXh0RW50aXRpZXMuc29tZShjID0+IGMua2V5ID09PSB2YXJpYWJsZS5rZXkpKSB7XHJcbiAgICAgICAgICB0aGlzLmNvbnRleHRFbnRpdGllcyA9IHRoaXMuY29udGV4dEVudGl0aWVzLmNvbmNhdChbdmFyaWFibGVdKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIGNsaWNrT0soKSB7XHJcbiAgICBjb25zdCByZXN1bHQgPSB0aGlzLmNvbXB1dGUuZ2V0RXhwcigpO1xyXG4gICAgdGhpcy52YWx1ZSA9IHRoaXMuY29udmVydFRvVmFsdWUocmVzdWx0LnRleHQpO1xyXG4gICAgY29uc3Qgb2JqZWN0ID0geyB2YWx1ZTogdGhpcy52YWx1ZSwgcGFyYW1ldGVyczogbnVsbCB9O1xyXG4gICAgdGhpcy5zdWJtaXRNb2RhbC5lbWl0KG9iamVjdCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDliIfmjaLooajovr7lvI/nsbvlnovvvIjnroDmmJPooajovr7lvI88LS0tPumrmOe6p+ihqOi+vuW8j++8iVxyXG4gICAqL1xyXG4gIGNoYW5nZVR5cGUoKSB7XHJcbiAgICB0aGlzLmNvbXB1dGUuY2hhbmdlVHlwZSgpO1xyXG4gIH1cclxuXHJcbiAgY2xpY2tDYW5jZWwoKSB7XHJcbiAgICB0aGlzLmNsb3NlTW9kYWwuZW1pdCgpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBjb252ZXJ0VG9WYWx1ZSh2YWw6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgICBpZiAodmFsKSB7XHJcbiAgICAgIGlmICh2YWwuc3Vic3RyaW5nKDksIHZhbC5sZW5ndGggLSAyKSkge1xyXG4gICAgICAgIHJldHVybiB2YWw7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gJyc7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcbmV4cG9ydCBjbGFzcyBFeHByZXNzaW9uRWRpdG9yQ29udmVydGVyIGltcGxlbWVudHMgVHlwZUNvbnZlcnRlciB7XHJcbiAgY29uc3RydWN0b3IoKSB7IH1cclxuXHJcbiAgY29udmVydFRvKGRhdGE6IGFueSk6IHN0cmluZyB7XHJcbiAgICBpZiAoZGF0YSkge1xyXG4gICAgICByZXR1cm4gZGF0YTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiAn77yI5pyq6K6+572u77yJJztcclxuICAgIH1cclxuICB9XHJcbn1cclxuIl19