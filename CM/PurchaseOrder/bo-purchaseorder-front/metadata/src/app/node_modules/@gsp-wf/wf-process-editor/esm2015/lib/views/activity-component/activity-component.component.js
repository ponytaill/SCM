/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, HostBinding, Output, EventEmitter, TemplateRef, Input, ViewChild, ComponentFactoryResolver, Injector } from '@angular/core';
import { ActivityComponentRepository } from './activity-component.repository';
import { ActivityComponentUIState } from './activity-component.uistate';
import { ActivityComponentViewModel } from './activity-component.viewmodel';
import { FormBuilder } from '@angular/forms';
import { BizComponentEntity } from '../../domain/entities/biz-component.entity';
import { ActualParameter } from '../../domain/entities/actual-parameter';
import { ProcessDesignerUIState } from '../../app/process-designer.uistate';
import { ExprEditMode, ExpressionService, InjectedType } from '@gsp-svc/expression';
import { SelectMetadataRTComponent } from '@gsp-lcm/metadatart-selector';
import { SessionService } from '@ecp-caf/caf-common';
import { BsModalService } from '@farris/ui-modal';
import { CommonComponentUiRTService } from '@gsp-cmp/ccmp-ui';
import { DatagridComponent } from '@farris/ui-datagrid';
import { of } from 'rxjs';
import { EditorTypes } from '@farris/ui-datagrid-editors';
import { MessagerService } from '@farris/ui-messager';
export class ActivityComponentComponent {
    /**
     * @param {?} uistate
     * @param {?} viewModel
     * @param {?} formBuilder
     * @param {?} designerState
     * @param {?} expr
     * @param {?} resolver
     * @param {?} injector
     * @param {?} sessionSrc
     * @param {?} modalService
     * @param {?} componentService
     * @param {?} repository
     * @param {?} message
     */
    constructor(uistate, viewModel, formBuilder, designerState, expr, resolver, injector, sessionSrc, modalService, componentService, repository, message) {
        this.uistate = uistate;
        this.viewModel = viewModel;
        this.formBuilder = formBuilder;
        this.designerState = designerState;
        this.expr = expr;
        this.resolver = resolver;
        this.injector = injector;
        this.sessionSrc = sessionSrc;
        this.modalService = modalService;
        this.componentService = componentService;
        this.repository = repository;
        this.message = message;
        this.cls = 'farris-main-area flex-column';
        this.closeModal = new EventEmitter();
        this.submitModal = new EventEmitter();
        this.editorParams = {};
        this.modalConfig = {
            title: '构件',
            width: 1000,
            height: 530,
            showButtons: true
        };
        this.columns = [];
        this.paramColumns = [];
        this.paramAfterEdit = (/**
         * @param {?} rowIndex
         * @param {?} rowData
         * @param {?=} column
         * @return {?}
         */
        (rowIndex, rowData, column) => {
            return of(true);
        });
    }
    /**
     * @param {?} cpts
     * @return {?}
     */
    set value(cpts) {
        if (cpts && cpts.length > 0) {
            for (const cpt of cpts) {
                /** @type {?} */
                const bizComponent = new BizComponentEntity(cpt.Name || cpt.name, cpt.MetadataId || cpt.metadataId, cpt.MethodCode || cpt.methodCode);
                bizComponent.executionTime = cpt.Time || cpt.executionTime,
                    bizComponent.id = cpt.Id || cpt.id;
                bizComponent.isForCompensation = cpt.isForCompensation;
                bizComponent.actualParameters = [];
                if ((cpt.ActualParameters && cpt.ActualParameters.length > 0) || (cpt.actualParameters && cpt.actualParameters.length > 0)) {
                    /** @type {?} */
                    const actualParameters = cpt.ActualParameters || cpt.actualParameters;
                    for (const para of actualParameters) {
                        /** @type {?} */
                        const actualParameter = new ActualParameter(para.Name || para.code, para.Name || para.name, para.Value || para.value);
                        bizComponent.actualParameters.push(actualParameter);
                    }
                }
                this.uistate.components.push(bizComponent);
            }
        }
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.location = this.editorParams.location;
        if (this.location === 'activity') {
            this.uistate.executionCollection = this.uistate.activityCollection;
            this.columns = [
                {
                    field: 'name', width: 100, title: '构件名称'
                },
                { field: 'metadataId', width: 100, title: '构件ID' },
                { field: 'methodCode', width: 100, title: '构件方法' },
                {
                    field: 'executionTime', width: 100, title: '执行时机',
                    editor: {
                        type: EditorTypes.COMBOLIST,
                        options: { data: this.uistate.executionCollection, valueField: 'value', textField: 'text', idField: 'value', panelHeight: 'auto' }
                    },
                    formatter: (/**
                     * @param {?} v
                     * @param {?} d
                     * @param {?} i
                     * @return {?}
                     */
                    (v, d, i) => {
                        if (v) {
                            return this.uistate.executionCollection.find((/**
                             * @param {?} item
                             * @return {?}
                             */
                            item => item.value === v)).text;
                        }
                        else {
                            return '';
                        }
                    }),
                    validators: [
                        { type: 'required', messager: '必填' }
                    ]
                },
                {
                    field: 'isForCompensation', width: 50, title: '补偿操作',
                    editor: { type: EditorTypes.SWITCH, options: {} },
                    formatter: { type: 'boolean', options: { trueText: '是', falseText: '否' } }
                }
            ];
        }
        else if (this.location === 'autoActivity') {
            this.columns = [
                {
                    field: 'name', width: 100, title: '构件名称'
                },
                { field: 'metadataId', width: 100, title: '构件ID' },
                { field: 'methodCode', width: 100, title: '构件方法' },
                {
                    field: 'isForCompensation', width: 50, title: '补偿操作',
                    editor: { type: EditorTypes.SWITCH, options: {} },
                    formatter: { type: 'boolean', options: { trueText: '是', falseText: '否' } }
                }
            ];
        }
        else {
            this.columns = [
                {
                    field: 'name', width: 100, title: '构件名称'
                },
                { field: 'metadataId', width: 100, title: '构件ID' },
                { field: 'methodCode', width: 100, title: '构件方法' },
                {
                    field: 'executionTime', width: 100, title: '执行时机',
                    editor: {
                        type: EditorTypes.COMBOLIST,
                        options: { data: this.uistate.executionCollection, valueField: 'value', textField: 'text', idField: 'value', panelHeight: 'auto' }
                    },
                    formatter: (/**
                     * @param {?} v
                     * @param {?} d
                     * @param {?} i
                     * @return {?}
                     */
                    (v, d, i) => {
                        if (v) {
                            return this.uistate.executionCollection.find((/**
                             * @param {?} item
                             * @return {?}
                             */
                            item => item.value === v)).text;
                        }
                        else {
                            return '';
                        }
                    }),
                    validators: [
                        { type: 'required', messager: '必填' }
                    ]
                }
            ];
        }
        if (this.uistate.components && this.uistate.components.length > 0) {
            this.cmplist.selectRow(this.uistate.components[0].id, true);
        }
        this.paramColumns = [
            { field: 'code', width: 50, title: '编号' },
            { field: 'name', width: 50, title: '名称' },
            {
                field: 'value', width: 100, title: '参数值',
                editor: {
                    type: 'input-group',
                    options: {
                        groupText: '<i class="f-icon f-icon-lookup"></i>',
                        editable: false,
                        clickHandle: (/**
                         * @param {?} e
                         * @return {?}
                         */
                        (e) => {
                            e.formControl.setValue(e.instance.value ? e.instance.value : '');
                            this.showExprHelp(e);
                        }),
                        clear: (/**
                         * @param {?} e
                         * @return {?}
                         */
                        (e) => {
                            console.log('clear', e);
                        })
                    }
                }
            }
        ];
        // 选中当前行
        this.repository.subject.subscribe((/**
         * @param {?} cmp
         * @return {?}
         */
        cmp => {
            this.cmplist.loadData(this.uistate.components);
            if (cmp) {
                this.cmplist.selectRow(cmp.id, true);
            }
            else {
                this.uistate.curComponent = null;
            }
        }));
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        if (this.uistate.components && this.uistate.components.length > 0) {
            this.cmplist.selectRow(this.uistate.components[0].id, true);
        }
    }
    /**
     * @return {?}
     */
    deleteRow() {
        this.closeCellEdit();
        this.viewModel.deleteRow();
    }
    /**
     * @return {?}
     */
    moveUp() {
        if (!this.uistate.curComponent) {
            this.message.info('尚未选中构件！');
            return;
        }
        /** @type {?} */
        const curCmpId = this.uistate.curComponent.id;
        /** @type {?} */
        const i = this.uistate.components.findIndex((/**
         * @param {?} c
         * @return {?}
         */
        c => c.id === curCmpId));
        if (i === 0) {
            return;
        }
        this.repository.swapArray(this.uistate.components, i, i - 1);
        this.cmplist.loadData(this.uistate.components);
        this.cmplist.selectRow(curCmpId, true);
    }
    /**
     * @return {?}
     */
    moveDown() {
        if (!this.uistate.curComponent) {
            this.message.info('尚未选中构件！');
            return;
        }
        /** @type {?} */
        const curCmpId = this.uistate.curComponent.id;
        /** @type {?} */
        const i = this.uistate.components.findIndex((/**
         * @param {?} c
         * @return {?}
         */
        c => c.id === curCmpId));
        if (i === this.uistate.components.length - 1) {
            return;
        }
        this.repository.swapArray(this.uistate.components, i, i + 1);
        this.cmplist.loadData(this.uistate.components);
        this.cmplist.selectRow(curCmpId, true);
    }
    /**
     * @return {?}
     */
    clickOK() {
        this.closeCellEdit();
        if (this.validator()) {
            /** @type {?} */
            const object = { value: this.uistate.components, parameters: null };
            this.submitModal.emit(object);
        }
    }
    /**
     * @return {?}
     */
    clickCancel() {
        this.closeModal.emit();
    }
    /**
     * @return {?}
     */
    componentSelect() {
        /** @type {?} */
        const compFactory = this.resolver.resolveComponentFactory(SelectMetadataRTComponent);
        /** @type {?} */
        const compRef = compFactory.create(this.injector);
        compRef.instance.typeList = 'WebServiceComponent'; // 目前只能根据元数据类型过滤，后续添加标签过滤
        compRef.instance.selectedMetadata.subscribe((/**
         * @param {?} $event
         * @return {?}
         */
        ($event) => {
            try {
                /** @type {?} */
                const meta = $event.metadata;
                this.openComponentSelectorNew(meta.id, this.sessionSrc.getUserSessionId());
            }
            catch (_a) {
                console.log('$event', $event);
                throw new Error('获取解析构件出错' + $event);
            }
        }));
        /** @type {?} */
        const modalConfig = {
            title: '构件选择',
            width: 980,
            height: 548,
            showButtons: false
        };
        /** @type {?} */
        const dialog = this.modalService.show(compRef, modalConfig);
        compRef.instance.closeModalEmitter.subscribe((/**
         * @param {?} $event
         * @return {?}
         */
        $event => dialog.close()));
    }
    /**
     * 取数构件帮助new
     * @param {?} metadataId
     * @param {?} sessionId
     * @return {?}
     */
    openComponentSelectorNew(metadataId, sessionId) {
        this.componentService.openSelector(metadataId, sessionId).subscribe((/**
         * @param {?} selectorResult
         * @return {?}
         */
        (selectorResult) => {
            selectorResult.confirmEvent.subscribe((/**
             * @param {?} result
             * @return {?}
             */
            (result) => {
                this.viewModel.componentSelect(result);
            }));
        }));
    }
    /**
     * @param {?} e
     * @return {?}
     */
    showExprHelp(e) {
        if (this.designerState.schemas.length > 0) {
            for (const schema of this.designerState.schemas) {
                this.expr.addSchema('Schema', schema);
            }
            if (this.designerState.schemas[0].entityTypes && this.designerState.schemas[0].entityTypes.length > 0) {
                /** @type {?} */
                const entityType = this.designerState.schemas[0].entityTypes[0];
                this.expr.addInjectedEntity(entityType.name, 'Schema', entityType.name, InjectedType.EntityType);
            }
        }
        /** @type {?} */
        const context = new Array();
        if (this.designerState.procInstContext.length > 0) {
            for (const variable of this.designerState.procInstContext) {
                context.push(variable);
            }
        }
        if (this.designerState.formalParameterContext.length > 0) {
            for (const variable of this.designerState.formalParameterContext) {
                if (!context.some((/**
                 * @param {?} c
                 * @return {?}
                 */
                c => c.key === variable.key))) {
                    context.push(variable);
                }
            }
        }
        if (this.designerState.participantContext.length > 0) {
            for (const variable of this.designerState.participantContext) {
                if (!context.some((/**
                 * @param {?} c
                 * @return {?}
                 */
                c => c.key === variable.key))) {
                    context.push(variable);
                }
            }
        }
        if (this.location === 'activity') {
            for (const variable of this.designerState.activityComponentContext) {
                if (!context.some((/**
                 * @param {?} c
                 * @return {?}
                 */
                c => c.key === variable.key))) {
                    context.push(variable);
                }
            }
        }
        if (this.designerState.processVariableContext.length > 0) {
            for (const variable of this.designerState.processVariableContext) {
                if (!context.some((/**
                 * @param {?} c
                 * @return {?}
                 */
                c => c.key === variable.key))) {
                    context.push(variable);
                }
            }
        }
        if (context.length > 0) {
            for (const v of context) {
                this.expr.addContext(v);
            }
        }
        this.expr.setEditPattern(ExprEditMode.Advanced); // 默认打开高级表达式编辑器
        this.expr.addExpressionText(e.instance.value);
        this.expr.buildExpression().then((/**
         * @param {?} expressioninfo
         * @return {?}
         */
        (expressioninfo) => {
            e.formControl.setValue(expressioninfo);
            e.instance.cd.detectChanges();
        }));
    }
    /**
     * @param {?} data
     * @return {?}
     */
    selectionChange(data) {
        this.uistate.curComponent = data.data;
    }
    /**
     * @private
     * @return {?}
     */
    closeCellEdit() {
        this.cmplist.endCellEdit();
        if (this.paramlist) {
            this.paramlist.endCellEdit();
        }
    }
    /**
     * @private
     * @return {?}
     */
    validator() {
        for (const c of this.uistate.components) {
            if (!c.executionTime && this.location !== 'autoActivity') {
                this.message.warning('构件执行时机不允许为空！');
                return false;
            }
        }
        return true;
    }
}
ActivityComponentComponent.decorators = [
    { type: Component, args: [{
                selector: 'app-activity-component',
                template: "\r\n<div class=\"f-page\">\r\n  <div class=\"f-page-header\">\r\n    <nav class=\"f-page-header-base\">\r\n      <div class=\"f-title\">\r\n        <span class=\"f-title-icon f-text-orna-bill\">\r\n          <i class=\"f-icon f-icon-page-title-administer\"></i>\r\n        </span>\r\n        <h4 class=\"f-title-text\">\u6784\u4EF6\u5217\u8868</h4>\r\n      </div>\r\n      <div class=\"btn-toolbar btn-group-lg\">\r\n        <button class=\"btn btn-primary mr-2\" (click)=\"componentSelect()\">\u65B0\u589E</button>\r\n        <button class=\"btn btn-secondary mr-2\" (click)=\"deleteRow()\">\u5220\u9664</button>\r\n        <button class=\"btn btn-secondary mr-2\" (click)=\"moveUp()\">\u4E0A\u79FB</button>\r\n        <button class=\"btn btn-secondary\" (click)=\"moveDown()\">\u4E0B\u79FB</button>\r\n      </div>\r\n    </nav>\r\n  </div>\r\n  <div class=\"f-page-main f-utils-fill-flex-column h-100\">\r\n    <div class=\"f-utils-fill-flex-column farris-overflow-y-auto h-100\">\r\n      <div [style.height.%]=\"uistate.curComponent?45:100\">\r\n        <farris-datagrid #cmplist [data]=\"uistate.components\" [idField]=\"'id'\" [columns]=\"columns\" [fit]=\"true\"\r\n          [fitColumns]=\"true\" [editable]=\"true\" [editMode]=\"'cell'\" [pagination]=\"false\" [showCheckbox]=\"false\"\r\n          [multiSelect]=\"false\" (selectChanged)=\"selectionChange($event)\" [closeOtherGridEditor]=\"true\">\r\n        </farris-datagrid>\r\n      </div>\r\n      <ng-container *ngIf=\"uistate.curComponent\">\r\n        <farris-tabs class=\"f-utils-fill\" [value]=\"'parameters'\" [contentFill]=\"true\" [autoTitleWidth]=\"true\">\r\n          <farris-tab [title]=\"'\u53C2\u6570\u5217\u8868'\" [id]=\"'parameters'\">\r\n            <ng-template #content>\r\n              <div class=\"f-utils-fill-flex-column h-100\">\r\n                <farris-datagrid #paramlist [data]=\"uistate.curComponent.actualParameters\" \r\n                  [columns]=\"paramColumns\" [idField]=\"'code'\" [fit]=\"true\" [fitColumns]=\"true\" \r\n                  [editable]=\"true\" [editMode]=\"'cell'\" [pagination]=\"false\"\r\n                  [showCheckbox]=\"false\" [multiSelect]=\"false\" [afterEdit]=\"paramAfterEdit\" [closeOtherGridEditor]=\"true\">\r\n                </farris-datagrid>\r\n              </div>\r\n            </ng-template>\r\n          </farris-tab>\r\n        </farris-tabs>\r\n      </ng-container>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n\r\n<ng-template #iconSelectFooter>\r\n  <button type=\"button\" class=\"btn btn-primary btn-sm px-3 mx-2\" (click)=\"clickOK()\">\u786E\u5B9A</button>\r\n  <button type=\"button\" class=\"btn btn-secondary btn-sm px-3\" (click)=\"clickCancel()\">\u53D6\u6D88</button>\r\n</ng-template>\r\n\r\n",
                providers: [ActivityComponentRepository, ActivityComponentUIState, ActivityComponentViewModel],
                styles: [""]
            }] }
];
/** @nocollapse */
ActivityComponentComponent.ctorParameters = () => [
    { type: ActivityComponentUIState },
    { type: ActivityComponentViewModel },
    { type: FormBuilder },
    { type: ProcessDesignerUIState },
    { type: ExpressionService },
    { type: ComponentFactoryResolver },
    { type: Injector },
    { type: SessionService },
    { type: BsModalService },
    { type: CommonComponentUiRTService },
    { type: ActivityComponentRepository },
    { type: MessagerService }
];
ActivityComponentComponent.propDecorators = {
    cls: [{ type: HostBinding, args: ['class',] }],
    closeModal: [{ type: Output }],
    submitModal: [{ type: Output }],
    editorParams: [{ type: Input }],
    modalFooter: [{ type: ViewChild, args: ['iconSelectFooter',] }],
    value: [{ type: Input }],
    cmplist: [{ type: ViewChild, args: ['cmplist',] }],
    paramlist: [{ type: ViewChild, args: ['paramlist',] }]
};
if (false) {
    /** @type {?} */
    ActivityComponentComponent.prototype.cls;
    /** @type {?} */
    ActivityComponentComponent.prototype.closeModal;
    /** @type {?} */
    ActivityComponentComponent.prototype.submitModal;
    /** @type {?} */
    ActivityComponentComponent.prototype.editorParams;
    /** @type {?} */
    ActivityComponentComponent.prototype.modalFooter;
    /** @type {?} */
    ActivityComponentComponent.prototype.modalConfig;
    /** @type {?} */
    ActivityComponentComponent.prototype.cmplist;
    /** @type {?} */
    ActivityComponentComponent.prototype.paramlist;
    /** @type {?} */
    ActivityComponentComponent.prototype.location;
    /** @type {?} */
    ActivityComponentComponent.prototype.columns;
    /** @type {?} */
    ActivityComponentComponent.prototype.paramColumns;
    /** @type {?} */
    ActivityComponentComponent.prototype.paramAfterEdit;
    /** @type {?} */
    ActivityComponentComponent.prototype.uistate;
    /** @type {?} */
    ActivityComponentComponent.prototype.viewModel;
    /**
     * @type {?}
     * @private
     */
    ActivityComponentComponent.prototype.formBuilder;
    /**
     * @type {?}
     * @private
     */
    ActivityComponentComponent.prototype.designerState;
    /**
     * @type {?}
     * @private
     */
    ActivityComponentComponent.prototype.expr;
    /**
     * @type {?}
     * @private
     */
    ActivityComponentComponent.prototype.resolver;
    /**
     * @type {?}
     * @private
     */
    ActivityComponentComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    ActivityComponentComponent.prototype.sessionSrc;
    /**
     * @type {?}
     * @private
     */
    ActivityComponentComponent.prototype.modalService;
    /**
     * @type {?}
     * @private
     */
    ActivityComponentComponent.prototype.componentService;
    /**
     * @type {?}
     * @private
     */
    ActivityComponentComponent.prototype.repository;
    /**
     * @type {?}
     * @private
     */
    ActivityComponentComponent.prototype.message;
}
export class ActivityComponentConverter {
    constructor() { }
    /**
     * @param {?} data
     * @return {?}
     */
    convertTo(data) {
        if (data && data.length > 0) {
            return '（已设置）';
        }
        else {
            return '（未设置）';
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWN0aXZpdHktY29tcG9uZW50LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc3Atd2Yvd2YtcHJvY2Vzcy1lZGl0b3IvIiwic291cmNlcyI6WyJsaWIvdmlld3MvYWN0aXZpdHktY29tcG9uZW50L2FjdGl2aXR5LWNvbXBvbmVudC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsV0FBVyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsV0FBVyxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUUsd0JBQXdCLEVBQUUsUUFBUSxFQUFpQixNQUFNLGVBQWUsQ0FBQztBQUV2SyxPQUFPLEVBQUUsMkJBQTJCLEVBQUUsTUFBTSxpQ0FBaUMsQ0FBQztBQUM5RSxPQUFPLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUN4RSxPQUFPLEVBQUUsMEJBQTBCLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUM1RSxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDN0MsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sNENBQTRDLENBQUM7QUFDaEYsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHdDQUF3QyxDQUFDO0FBQ3pFLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLG9DQUFvQyxDQUFDO0FBRTVFLE9BQU8sRUFBRSxZQUFZLEVBQUUsaUJBQWlCLEVBQUUsWUFBWSxFQUFhLE1BQU0scUJBQXFCLENBQUM7QUFDL0YsT0FBTyxFQUFFLHlCQUF5QixFQUFnQyxNQUFNLDhCQUE4QixDQUFDO0FBQ3ZHLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUNyRCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDbEQsT0FBTyxFQUFrQiwwQkFBMEIsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBRTlFLE9BQU8sRUFBYyxpQkFB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Ozs7O0lBQ3BELGdEQUErQzs7Ozs7SUFDL0MsNkNBQWdDOztBQTRScEMsTUFBTSxPQUFPLDBCQUEwQjtJQUNyQyxnQkFBZ0IsQ0FBQzs7Ozs7SUFFakIsU0FBUyxDQUFDLElBQVc7UUFDbkIsSUFBSSxJQUFJLElBQUksSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDM0IsT0FBTyxPQUFPLENBQUM7U0FDaEI7YUFBTTtZQUNMLE9BQU8sT0FBTyxDQUFDO1NBQ2hCO0lBQ0gsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIEhvc3RCaW5kaW5nLCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgVGVtcGxhdGVSZWYsIElucHV0LCBWaWV3Q2hpbGQsIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciwgSW5qZWN0b3IsIEFmdGVyVmlld0luaXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgVHlwZUNvbnZlcnRlciB9IGZyb20gJ0BmYXJyaXMvdWktcHJvcGVydHktcGFuZWwnO1xyXG5pbXBvcnQgeyBBY3Rpdml0eUNvbXBvbmVudFJlcG9zaXRvcnkgfSBmcm9tICcuL2FjdGl2aXR5LWNvbXBvbmVudC5yZXBvc2l0b3J5JztcclxuaW1wb3J0IHsgQWN0aXZpdHlDb21wb25lbnRVSVN0YXRlIH0gZnJvbSAnLi9hY3Rpdml0eS1jb21wb25lbnQudWlzdGF0ZSc7XHJcbmltcG9ydCB7IEFjdGl2aXR5Q29tcG9uZW50Vmlld01vZGVsIH0gZnJvbSAnLi9hY3Rpdml0eS1jb21wb25lbnQudmlld21vZGVsJztcclxuaW1wb3J0IHsgRm9ybUJ1aWxkZXIgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XHJcbmltcG9ydCB7IEJpekNvbXBvbmVudEVudGl0eSB9IGZyb20gJy4uLy4uL2RvbWFpbi9lbnRpdGllcy9iaXotY29tcG9uZW50LmVudGl0eSc7XHJcbmltcG9ydCB7IEFjdHVhbFBhcmFtZXRlciB9IGZyb20gJy4uLy4uL2RvbWFpbi9lbnRpdGllcy9hY3R1YWwtcGFyYW1ldGVyJztcclxuaW1wb3J0IHsgUHJvY2Vzc0Rlc2lnbmVyVUlTdGF0ZSB9IGZyb20gJy4uLy4uL2FwcC9wcm9jZXNzLWRlc2lnbmVyLnVpc3RhdGUnO1xyXG5cclxuaW1wb3J0IHsgRXhwckVkaXRNb2RlLCBFeHByZXNzaW9uU2VydmljZSwgSW5qZWN0ZWRUeXBlLCBWYXJFbnRpdHkgfSBmcm9tICdAZ3NwLXN2Yy9leHByZXNzaW9uJztcclxuaW1wb3J0IHsgU2VsZWN0TWV0YWRhdGFSVENvbXBvbmVudCwgTWV0YWRhdGE0UmVmRHRvLCBNZXRhZGF0YUR0byB9IGZyb20gJ0Bnc3AtbGNtL21ldGFkYXRhcnQtc2VsZWN0b3InO1xyXG5pbXBvcnQgeyBTZXNzaW9uU2VydmljZSB9IGZyb20gJ0BlY3AtY2FmL2NhZi1jb21tb24nO1xyXG5pbXBvcnQgeyBCc01vZGFsU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbW9kYWwnO1xyXG5pbXBvcnQgeyBTZWxlY3RvclJlc3VsdCwgQ29tbW9uQ29tcG9uZW50VWlSVFNlcnZpY2UgfSBmcm9tICdAZ3NwLWNtcC9jY21wLXVpJztcclxuaW1wb3J0IHsgR3NwQ29tcG9uZW50IH0gZnJvbSAnQGdzcC1jbXAvY29tbW9uLWNvbXBvbmVudCc7XHJcbmltcG9ydCB7IERhdGFDb2x1bW4sIERhdGFncmlkQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1kYXRhZ3JpZCc7XHJcbmltcG9ydCB7IG9mIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IEVkaXRvclR5cGVzIH0gZnJvbSAnQGZhcnJpcy91aS1kYXRhZ3JpZC1lZGl0b3JzJztcclxuaW1wb3J0IHsgTWVzc2FnZXJTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1tZXNzYWdlcic7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ2FwcC1hY3Rpdml0eS1jb21wb25lbnQnLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9hY3Rpdml0eS1jb21wb25lbnQuY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsczogWycuL2FjdGl2aXR5LWNvbXBvbmVudC5jb21wb25lbnQuc2NzcyddLFxyXG4gIHByb3ZpZGVyczogW0FjdGl2aXR5Q29tcG9uZW50UmVwb3NpdG9yeSwgQWN0aXZpdHlDb21wb25lbnRVSVN0YXRlLCBBY3Rpdml0eUNvbXBvbmVudFZpZXdNb2RlbF1cclxufSlcclxuZXhwb3J0IGNsYXNzIEFjdGl2aXR5Q29tcG9uZW50Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0IHtcclxuICBASG9zdEJpbmRpbmcoJ2NsYXNzJylcclxuICBjbHMgPSAnZmFycmlzLW1haW4tYXJlYSBmbGV4LWNvbHVtbic7XHJcbiAgQE91dHB1dCgpIGNsb3NlTW9kYWwgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuICBAT3V0cHV0KCkgc3VibWl0TW9kYWwgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuXHJcbiAgQElucHV0KCkgZWRpdG9yUGFyYW1zOiBhbnkgPSB7fTtcclxuICBAVmlld0NoaWxkKCdpY29uU2VsZWN0Rm9vdGVyJykgbW9kYWxGb290ZXI6IFRlbXBsYXRlUmVmPGFueT47XHJcbiAgbW9kYWxDb25maWcgPSB7XHJcbiAgICB0aXRsZTogJ+aehOS7ticsXHJcbiAgICB3aWR0aDogMTAwMCxcclxuICAgIGhlaWdodDogNTMwLFxyXG4gICAgc2hvd0J1dHRvbnM6IHRydWVcclxuICB9O1xyXG4gIEBJbnB1dCgpXHJcbiAgc2V0IHZhbHVlKGNwdHM6IGFueVtdKSB7XHJcbiAgICBpZiAoY3B0cyAmJiBjcHRzLmxlbmd0aCA+IDApIHtcclxuICAgICAgZm9yIChjb25zdCBjcHQgb2YgY3B0cykge1xyXG4gICAgICAgIGNvbnN0IGJpekNvbXBvbmVudCA9IG5ldyBCaXpDb21wb25lbnRFbnRpdHkoY3B0Lk5hbWUgfHwgY3B0Lm5hbWUsIGNwdC5NZXRhZGF0YUlkIHx8IGNwdC5tZXRhZGF0YUlkLCBjcHQuTWV0aG9kQ29kZSB8fCBjcHQubWV0aG9kQ29kZSk7XHJcbiAgICAgICAgYml6Q29tcG9uZW50LmV4ZWN1dGlvblRpbWUgPSBjcHQuVGltZSB8fCBjcHQuZXhlY3V0aW9uVGltZSxcclxuICAgICAgICBiaXpDb21wb25lbnQuaWQgPSBjcHQuSWQgfHwgY3B0LmlkO1xyXG4gICAgICAgIGJpekNvbXBvbmVudC5pc0ZvckNvbXBlbnNhdGlvbiA9IGNwdC5pc0ZvckNvbXBlbnNhdGlvbjtcclxuICAgICAgICBiaXpDb21wb25lbnQuYWN0dWFsUGFyYW1ldGVycyA9IFtdO1xyXG4gICAgICAgIGlmICgoY3B0LkFjdHVhbFBhcmFtZXRlcnMgJiYgY3B0LkFjdHVhbFBhcmFtZXRlcnMubGVuZ3RoID4gMCkgfHwgKGNwdC5hY3R1YWxQYXJhbWV0ZXJzICYmIGNwdC5hY3R1YWxQYXJhbWV0ZXJzLmxlbmd0aCA+IDApKSB7XHJcbiAgICAgICAgICBjb25zdCBhY3R1YWxQYXJhbWV0ZXJzID0gY3B0LkFjdHVhbFBhcmFtZXRlcnMgfHwgY3B0LmFjdHVhbFBhcmFtZXRlcnM7XHJcbiAgICAgICAgICBmb3IgKGNvbnN0IHBhcmEgb2YgYWN0dWFsUGFyYW1ldGVycykge1xyXG4gICAgICAgICAgICBjb25zdCBhY3R1YWxQYXJhbWV0ZXIgPSBuZXcgQWN0dWFsUGFyYW1ldGVyKHBhcmEuTmFtZSB8fCBwYXJhLmNvZGUsIHBhcmEuTmFtZSB8fCBwYXJhLm5hbWUsIHBhcmEuVmFsdWUgfHwgcGFyYS52YWx1ZSApO1xyXG5cclxuICAgICAgICAgICAgYml6Q29tcG9uZW50LmFjdHVhbFBhcmFtZXRlcnMucHVzaChhY3R1YWxQYXJhbWV0ZXIpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnVpc3RhdGUuY29tcG9uZW50cy5wdXNoKGJpekNvbXBvbmVudCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIEBWaWV3Q2hpbGQoJ2NtcGxpc3QnKSBjbXBsaXN0OiBEYXRhZ3JpZENvbXBvbmVudDtcclxuICBAVmlld0NoaWxkKCdwYXJhbWxpc3QnKSBwYXJhbWxpc3Q6IERhdGFncmlkQ29tcG9uZW50O1xyXG5cclxuXHJcbiAgbG9jYXRpb246ICdhY3Rpdml0eScgfCAncHJvY2VzcycgfCAnYXV0b0FjdGl2aXR5JztcclxuICBjb2x1bW5zID0gW107XHJcbiAgcGFyYW1Db2x1bW5zID0gW107XHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwdWJsaWMgdWlzdGF0ZTogQWN0aXZpdHlDb21wb25lbnRVSVN0YXRlLFxyXG4gICAgcHVibGljIHZpZXdNb2RlbDogQWN0aXZpdHlDb21wb25lbnRWaWV3TW9kZWwsXHJcbiAgICBwcml2YXRlIGZvcm1CdWlsZGVyOiBGb3JtQnVpbGRlcixcclxuICAgIHByaXZhdGUgZGVzaWduZXJTdGF0ZTogUHJvY2Vzc0Rlc2lnbmVyVUlTdGF0ZSxcclxuICAgIHByaXZhdGUgZXhwcjogRXhwcmVzc2lvblNlcnZpY2UsXHJcbiAgICBwcml2YXRlIHJlc29sdmVyOiBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsXHJcbiAgICBwcml2YXRlIGluamVjdG9yOiBJbmplY3RvcixcclxuICAgIHByaXZhdGUgc2Vzc2lvblNyYzogU2Vzc2lvblNlcnZpY2UsXHJcbiAgICBwcml2YXRlIG1vZGFsU2VydmljZTogQnNNb2RhbFNlcnZpY2UsXHJcbiAgICBwcml2YXRlIGNvbXBvbmVudFNlcnZpY2U6IENvbW1vbkNvbXBvbmVudFVpUlRTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSByZXBvc2l0b3J5OiBBY3Rpdml0eUNvbXBvbmVudFJlcG9zaXRvcnksXHJcbiAgICBwcml2YXRlIG1lc3NhZ2U6IE1lc3NhZ2VyU2VydmljZVxyXG4gICkgeyB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gICAgdGhpcy5sb2NhdGlvbiA9IHRoaXMuZWRpdG9yUGFyYW1zLmxvY2F0aW9uO1xyXG4gICAgaWYgKHRoaXMubG9jYXRpb24gPT09ICdhY3Rpdml0eScpIHtcclxuICAgICAgdGhpcy51aXN0YXRlLmV4ZWN1dGlvbkNvbGxlY3Rpb24gPSB0aGlzLnVpc3RhdGUuYWN0aXZpdHlDb2xsZWN0aW9uO1xyXG4gICAgICB0aGlzLmNvbHVtbnMgPSBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgZmllbGQ6ICduYW1lJywgd2lkdGg6IDEwMCwgdGl0bGU6ICfmnoTku7blkI3np7AnXHJcbiAgICAgICAgfSxcclxuICAgICAgICB7IGZpZWxkOiAnbWV0YWRhdGFJZCcsIHdpZHRoOiAxMDAsIHRpdGxlOiAn5p6E5Lu2SUQnIH0sXHJcbiAgICAgICAgeyBmaWVsZDogJ21ldGhvZENvZGUnLCB3aWR0aDogMTAwLCB0aXRsZTogJ+aehOS7tuaWueazlScgfSxcclxuICAgICAgICB7XHJcbiAgICAgICAgICBmaWVsZDogJ2V4ZWN1dGlvblRpbWUnLCB3aWR0aDogMTAwLCB0aXRsZTogJ+aJp+ihjOaXtuacuicsXHJcbiAgICAgICAgICBlZGl0b3I6IHtcclxuICAgICAgICAgICAgdHlwZTogRWRpdG9yVHlwZXMuQ09NQk9MSVNULFxyXG4gICAgICAgICAgICBvcHRpb25zOiB7IGRhdGE6IHRoaXMudWlzdGF0ZS5leGVjdXRpb25Db2xsZWN0aW9uLCB2YWx1ZUZpZWxkOiAndmFsdWUnLCB0ZXh0RmllbGQ6ICd0ZXh0JywgaWRGaWVsZDogJ3ZhbHVlJywgcGFuZWxIZWlnaHQ6ICdhdXRvJyB9XHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgZm9ybWF0dGVyOiAodiwgZCwgaSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAodikge1xyXG4gICAgICAgICAgICAgIHJldHVybiB0aGlzLnVpc3RhdGUuZXhlY3V0aW9uQ29sbGVjdGlvbi5maW5kKGl0ZW0gPT4gaXRlbS52YWx1ZSA9PT0gdikudGV4dDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICByZXR1cm4gJyc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICB2YWxpZGF0b3JzOiBbXHJcbiAgICAgICAgICAgIHsgdHlwZTogJ3JlcXVpcmVkJywgbWVzc2FnZXI6ICflv4XloasnIH1cclxuICAgICAgICAgIF1cclxuICAgICAgICB9LFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIGZpZWxkOiAnaXNGb3JDb21wZW5zYXRpb24nLCB3aWR0aDogNTAsIHRpdGxlOiAn6KGl5YG/5pON5L2cJyxcclxuICAgICAgICAgIGVkaXRvcjogeyB0eXBlOiBFZGl0b3JUeXBlcy5TV0lUQ0gsIG9wdGlvbnM6IHt9IH0sXHJcbiAgICAgICAgICBmb3JtYXR0ZXI6IHsgdHlwZTogJ2Jvb2xlYW4nLCBvcHRpb25zOiB7IHRydWVUZXh0OiAn5pivJywgZmFsc2VUZXh0OiAn5ZCmJyB9IH1cclxuICAgICAgICB9XHJcbiAgICAgIF07XHJcbiAgICB9IGVsc2UgaWYgKHRoaXMubG9jYXRpb24gPT09ICdhdXRvQWN0aXZpdHknKSB7XHJcbiAgICAgIHRoaXMuY29sdW1ucyA9IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICBmaWVsZDogJ25hbWUnLCB3aWR0aDogMTAwLCB0aXRsZTogJ+aehOS7tuWQjeensCdcclxuICAgICAgICB9LFxyXG4gICAgICAgIHsgZmllbGQ6ICdtZXRhZGF0YUlkJywgd2lkdGg6IDEwMCwgdGl0bGU6ICfmnoTku7ZJRCcgfSxcclxuICAgICAgICB7IGZpZWxkOiAnbWV0aG9kQ29kZScsIHdpZHRoOiAxMDAsIHRpdGxlOiAn5p6E5Lu25pa55rOVJyB9LFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIGZpZWxkOiAnaXNGb3JDb21wZW5zYXRpb24nLCB3aWR0aDogNTAsIHRpdGxlOiAn6KGl5YG/5pON5L2cJyxcclxuICAgICAgICAgIGVkaXRvcjogeyB0eXBlOiBFZGl0b3JUeXBlcy5TV0lUQ0gsIG9wdGlvbnM6IHt9IH0sXHJcbiAgICAgICAgICBmb3JtYXR0ZXI6IHsgdHlwZTogJ2Jvb2xlYW4nLCBvcHRpb25zOiB7IHRydWVUZXh0OiAn5pivJywgZmFsc2VUZXh0OiAn5ZCmJyB9IH1cclxuICAgICAgICB9XHJcbiAgICAgIF07XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLmNvbHVtbnMgPSBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgZmllbGQ6ICduYW1lJywgd2lkdGg6IDEwMCwgdGl0bGU6ICfmnoTku7blkI3np7AnXHJcbiAgICAgICAgfSxcclxuICAgICAgICB7IGZpZWxkOiAnbWV0YWRhdGFJZCcsIHdpZHRoOiAxMDAsIHRpdGxlOiAn5p6E5Lu2SUQnIH0sXHJcbiAgICAgICAgeyBmaWVsZDogJ21ldGhvZENvZGUnLCB3aWR0aDogMTAwLCB0aXRsZTogJ+aehOS7tuaWueazlScgfSxcclxuICAgICAgICB7XHJcbiAgICAgICAgICBmaWVsZDogJ2V4ZWN1dGlvblRpbWUnLCB3aWR0aDogMTAwLCB0aXRsZTogJ+aJp+ihjOaXtuacuicsXHJcbiAgICAgICAgICBlZGl0b3I6IHtcclxuICAgICAgICAgICAgdHlwZTogRWRpdG9yVHlwZXMuQ09NQk9MSVNULFxyXG4gICAgICAgICAgICBvcHRpb25zOiB7IGRhdGE6IHRoaXMudWlzdGF0ZS5leGVjdXRpb25Db2xsZWN0aW9uLCB2YWx1ZUZpZWxkOiAndmFsdWUnLCB0ZXh0RmllbGQ6ICd0ZXh0JywgaWRGaWVsZDogJ3ZhbHVlJywgcGFuZWxIZWlnaHQ6ICdhdXRvJyB9XHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgZm9ybWF0dGVyOiAodiwgZCwgaSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAodikge1xyXG4gICAgICAgICAgICAgIHJldHVybiB0aGlzLnVpc3RhdGUuZXhlY3V0aW9uQ29sbGVjdGlvbi5maW5kKGl0ZW0gPT4gaXRlbS52YWx1ZSA9PT0gdikudGV4dDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICByZXR1cm4gJyc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICB2YWxpZGF0b3JzOiBbXHJcbiAgICAgICAgICAgIHsgdHlwZTogJ3JlcXVpcmVkJywgbWVzc2FnZXI6ICflv4XloasnIH1cclxuICAgICAgICAgIF1cclxuICAgICAgICB9XHJcbiAgICAgIF07XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy51aXN0YXRlLmNvbXBvbmVudHMgJiYgdGhpcy51aXN0YXRlLmNvbXBvbmVudHMubGVuZ3RoID4gMCkge1xyXG4gICAgICB0aGlzLmNtcGxpc3Quc2VsZWN0Um93KHRoaXMudWlzdGF0ZS5jb21wb25lbnRzWzBdLmlkLCB0cnVlKTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLnBhcmFtQ29sdW1ucyA9IFtcclxuICAgICAgeyBmaWVsZDogJ2NvZGUnLCB3aWR0aDogNTAsIHRpdGxlOiAn57yW5Y+3JyB9LFxyXG4gICAgICB7IGZpZWxkOiAnbmFtZScsIHdpZHRoOiA1MCwgdGl0bGU6ICflkI3np7AnIH0sXHJcbiAgICAgIHtcclxuICAgICAgICBmaWVsZDogJ3ZhbHVlJywgd2lkdGg6IDEwMCwgdGl0bGU6ICflj4LmlbDlgLwnLFxyXG4gICAgICAgIGVkaXRvcjoge1xyXG4gICAgICAgICAgdHlwZTogJ2lucHV0LWdyb3VwJyxcclxuICAgICAgICAgIG9wdGlvbnM6IHtcclxuICAgICAgICAgICAgZ3JvdXBUZXh0OiAnPGkgY2xhc3M9XCJmLWljb24gZi1pY29uLWxvb2t1cFwiPjwvaT4nLFxyXG4gICAgICAgICAgICBlZGl0YWJsZTogZmFsc2UsXHJcbiAgICAgICAgICAgIGNsaWNrSGFuZGxlOiAoZSkgPT4ge1xyXG4gICAgICAgICAgICAgIGUuZm9ybUNvbnRyb2wuc2V0VmFsdWUoZS5pbnN0YW5jZS52YWx1ZSA/IGUuaW5zdGFuY2UudmFsdWUgOiAnJyk7XHJcbiAgICAgICAgICAgICAgdGhpcy5zaG93RXhwckhlbHAoZSk7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGNsZWFyOiAoZSkgPT4ge1xyXG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdjbGVhcicsIGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICBdO1xyXG4gICAgLy8g6YCJ5Lit5b2T5YmN6KGMXHJcbiAgICB0aGlzLnJlcG9zaXRvcnkuc3ViamVjdC5zdWJzY3JpYmUoY21wID0+IHtcclxuICAgICAgdGhpcy5jbXBsaXN0LmxvYWREYXRhKHRoaXMudWlzdGF0ZS5jb21wb25lbnRzKTtcclxuICAgICAgaWYgKGNtcCkge1xyXG4gICAgICAgIHRoaXMuY21wbGlzdC5zZWxlY3RSb3coY21wLmlkLCB0cnVlKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLnVpc3RhdGUuY3VyQ29tcG9uZW50ID0gbnVsbDtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBuZ0FmdGVyVmlld0luaXQoKSB7XHJcbiAgICBpZiAodGhpcy51aXN0YXRlLmNvbXBvbmVudHMgJiYgdGhpcy51aXN0YXRlLmNvbXBvbmVudHMubGVuZ3RoID4gMCkge1xyXG4gICAgICB0aGlzLmNtcGxpc3Quc2VsZWN0Um93KHRoaXMudWlzdGF0ZS5jb21wb25lbnRzWzBdLmlkLCB0cnVlKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGRlbGV0ZVJvdygpIHtcclxuICAgIHRoaXMuY2xvc2VDZWxsRWRpdCgpO1xyXG5cclxuICAgIHRoaXMudmlld01vZGVsLmRlbGV0ZVJvdygpO1xyXG4gIH1cclxuXHJcbiAgbW92ZVVwKCkge1xyXG4gICAgaWYgKCF0aGlzLnVpc3RhdGUuY3VyQ29tcG9uZW50KSB7XHJcbiAgICAgIHRoaXMubWVzc2FnZS5pbmZvKCflsJrmnKrpgInkuK3mnoTku7bvvIEnKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgY29uc3QgY3VyQ21wSWQ6IHN0cmluZyA9IHRoaXMudWlzdGF0ZS5jdXJDb21wb25lbnQuaWQ7XHJcbiAgICBjb25zdCBpID0gdGhpcy51aXN0YXRlLmNvbXBvbmVudHMuZmluZEluZGV4KGMgPT4gYy5pZCA9PT0gY3VyQ21wSWQpO1xyXG4gICAgaWYgKGkgPT09IDApIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy5yZXBvc2l0b3J5LnN3YXBBcnJheSh0aGlzLnVpc3RhdGUuY29tcG9uZW50cywgaSwgaSAtIDEpO1xyXG5cclxuICAgIHRoaXMuY21wbGlzdC5sb2FkRGF0YSh0aGlzLnVpc3RhdGUuY29tcG9uZW50cyk7XHJcbiAgICB0aGlzLmNtcGxpc3Quc2VsZWN0Um93KGN1ckNtcElkLCB0cnVlKTtcclxuICB9XHJcblxyXG4gIG1vdmVEb3duKCkge1xyXG4gICAgaWYgKCF0aGlzLnVpc3RhdGUuY3VyQ29tcG9uZW50KSB7XHJcbiAgICAgIHRoaXMubWVzc2FnZS5pbmZvKCflsJrmnKrpgInkuK3mnoTku7bvvIEnKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgY29uc3QgY3VyQ21wSWQ6IHN0cmluZyA9IHRoaXMudWlzdGF0ZS5jdXJDb21wb25lbnQuaWQ7XHJcbiAgICBjb25zdCBpID0gdGhpcy51aXN0YXRlLmNvbXBvbmVudHMuZmluZEluZGV4KGMgPT4gYy5pZCA9PT0gY3VyQ21wSWQpO1xyXG4gICAgaWYgKGkgPT09IHRoaXMudWlzdGF0ZS5jb21wb25lbnRzLmxlbmd0aCAtIDEpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy5yZXBvc2l0b3J5LnN3YXBBcnJheSh0aGlzLnVpc3RhdGUuY29tcG9uZW50cywgaSwgaSArIDEpO1xyXG5cclxuICAgIHRoaXMuY21wbGlzdC5sb2FkRGF0YSh0aGlzLnVpc3RhdGUuY29tcG9uZW50cyk7XHJcbiAgICB0aGlzLmNtcGxpc3Quc2VsZWN0Um93KGN1ckNtcElkLCB0cnVlKTtcclxuICB9XHJcblxyXG4gIGNsaWNrT0soKSB7XHJcbiAgICB0aGlzLmNsb3NlQ2VsbEVkaXQoKTtcclxuXHJcbiAgICBpZiAodGhpcy52YWxpZGF0b3IoKSkge1xyXG4gICAgICBjb25zdCBvYmplY3QgPSB7IHZhbHVlOiB0aGlzLnVpc3RhdGUuY29tcG9uZW50cywgcGFyYW1ldGVyczogbnVsbCB9O1xyXG4gICAgICB0aGlzLnN1Ym1pdE1vZGFsLmVtaXQob2JqZWN0KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGNsaWNrQ2FuY2VsKCkge1xyXG4gICAgdGhpcy5jbG9zZU1vZGFsLmVtaXQoKTtcclxuICB9XHJcbiAgY29tcG9uZW50U2VsZWN0KCkge1xyXG4gICAgY29uc3QgY29tcEZhY3RvcnkgPSB0aGlzLnJlc29sdmVyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KFNlbGVjdE1ldGFkYXRhUlRDb21wb25lbnQpO1xyXG4gICAgY29uc3QgY29tcFJlZiA9IGNvbXBGYWN0b3J5LmNyZWF0ZSh0aGlzLmluamVjdG9yKTtcclxuICAgIGNvbXBSZWYuaW5zdGFuY2UudHlwZUxpc3QgPSAnV2ViU2VydmljZUNvbXBvbmVudCc7IC8vIOebruWJjeWPquiDveagueaNruWFg+aVsOaNruexu+Wei+i/h+a7pO+8jOWQjue7rea3u+WKoOagh+etvui/h+a7pFxyXG4gICAgY29tcFJlZi5pbnN0YW5jZS5zZWxlY3RlZE1ldGFkYXRhLnN1YnNjcmliZSgoJGV2ZW50OiBNZXRhZGF0YTRSZWZEdG8pID0+IHtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBjb25zdCBtZXRhOiBNZXRhZGF0YUR0byA9ICRldmVudC5tZXRhZGF0YTtcclxuICAgICAgICB0aGlzLm9wZW5Db21wb25lbnRTZWxlY3Rvck5ldyhtZXRhLmlkLCB0aGlzLnNlc3Npb25TcmMuZ2V0VXNlclNlc3Npb25JZCgpKTtcclxuICAgICAgfSBjYXRjaCB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJyRldmVudCcsICRldmVudCk7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCfojrflj5bop6PmnpDmnoTku7blh7rplJknICsgJGV2ZW50KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgY29uc3QgbW9kYWxDb25maWcgPSB7XHJcbiAgICAgIHRpdGxlOiAn5p6E5Lu26YCJ5oupJyxcclxuICAgICAgd2lkdGg6IDk4MCxcclxuICAgICAgaGVpZ2h0OiA1NDgsXHJcbiAgICAgIHNob3dCdXR0b25zOiBmYWxzZVxyXG4gICAgfTtcclxuICAgIGNvbnN0IGRpYWxvZyA9IHRoaXMubW9kYWxTZXJ2aWNlLnNob3coY29tcFJlZiwgbW9kYWxDb25maWcpO1xyXG4gICAgY29tcFJlZi5pbnN0YW5jZS5jbG9zZU1vZGFsRW1pdHRlci5zdWJzY3JpYmUoJGV2ZW50ID0+IGRpYWxvZy5jbG9zZSgpKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5Y+W5pWw5p6E5Lu25biu5YqpbmV3XHJcbiAgICovXHJcbiAgb3BlbkNvbXBvbmVudFNlbGVjdG9yTmV3KG1ldGFkYXRhSWQ6IHN0cmluZywgc2Vzc2lvbklkOiBzdHJpbmcpIHtcclxuICAgIHRoaXMuY29tcG9uZW50U2VydmljZS5vcGVuU2VsZWN0b3IobWV0YWRhdGFJZCwgc2Vzc2lvbklkKS5zdWJzY3JpYmUoXHJcbiAgICAgIChzZWxlY3RvclJlc3VsdDogU2VsZWN0b3JSZXN1bHQpID0+IHtcclxuICAgICAgICBzZWxlY3RvclJlc3VsdC5jb25maXJtRXZlbnQuc3Vic2NyaWJlKFxyXG4gICAgICAgICAgKHJlc3VsdDogR3NwQ29tcG9uZW50KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMudmlld01vZGVsLmNvbXBvbmVudFNlbGVjdChyZXN1bHQpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG4gIH1cclxuICBzaG93RXhwckhlbHAoZTogYW55KSB7XHJcbiAgICBpZiAodGhpcy5kZXNpZ25lclN0YXRlLnNjaGVtYXMubGVuZ3RoID4gMCkge1xyXG4gICAgICBmb3IgKGNvbnN0IHNjaGVtYSBvZiB0aGlzLmRlc2lnbmVyU3RhdGUuc2NoZW1hcykge1xyXG4gICAgICAgIHRoaXMuZXhwci5hZGRTY2hlbWEoJ1NjaGVtYScsIHNjaGVtYSk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKHRoaXMuZGVzaWduZXJTdGF0ZS5zY2hlbWFzWzBdLmVudGl0eVR5cGVzICYmIHRoaXMuZGVzaWduZXJTdGF0ZS5zY2hlbWFzWzBdLmVudGl0eVR5cGVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICBjb25zdCBlbnRpdHlUeXBlID0gdGhpcy5kZXNpZ25lclN0YXRlLnNjaGVtYXNbMF0uZW50aXR5VHlwZXNbMF07XHJcbiAgICAgICAgdGhpcy5leHByLmFkZEluamVjdGVkRW50aXR5KGVudGl0eVR5cGUubmFtZSwgJ1NjaGVtYScsXHJcbiAgICAgICAgICBlbnRpdHlUeXBlLm5hbWUsIEluamVjdGVkVHlwZS5FbnRpdHlUeXBlKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgY29uc3QgY29udGV4dCA9IG5ldyBBcnJheTxWYXJFbnRpdHk+KCk7XHJcbiAgICBpZiAodGhpcy5kZXNpZ25lclN0YXRlLnByb2NJbnN0Q29udGV4dC5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGZvciAoY29uc3QgdmFyaWFibGUgb2YgdGhpcy5kZXNpZ25lclN0YXRlLnByb2NJbnN0Q29udGV4dCkge1xyXG4gICAgICAgIGNvbnRleHQucHVzaCh2YXJpYWJsZSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGlmICh0aGlzLmRlc2lnbmVyU3RhdGUuZm9ybWFsUGFyYW1ldGVyQ29udGV4dC5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGZvciAoY29uc3QgdmFyaWFibGUgb2YgdGhpcy5kZXNpZ25lclN0YXRlLmZvcm1hbFBhcmFtZXRlckNvbnRleHQpIHtcclxuICAgICAgICBpZiAoIWNvbnRleHQuc29tZShjID0+IGMua2V5ID09PSB2YXJpYWJsZS5rZXkpKSB7XHJcbiAgICAgICAgICBjb250ZXh0LnB1c2godmFyaWFibGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMuZGVzaWduZXJTdGF0ZS5wYXJ0aWNpcGFudENvbnRleHQubGVuZ3RoID4gMCkge1xyXG4gICAgICBmb3IgKGNvbnN0IHZhcmlhYmxlIG9mIHRoaXMuZGVzaWduZXJTdGF0ZS5wYXJ0aWNpcGFudENvbnRleHQpIHtcclxuICAgICAgICBpZiAoIWNvbnRleHQuc29tZShjID0+IGMua2V5ID09PSB2YXJpYWJsZS5rZXkpKSB7XHJcbiAgICAgICAgICBjb250ZXh0LnB1c2godmFyaWFibGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMubG9jYXRpb24gPT09ICdhY3Rpdml0eScpIHtcclxuICAgICAgZm9yIChjb25zdCB2YXJpYWJsZSBvZiB0aGlzLmRlc2lnbmVyU3RhdGUuYWN0aXZpdHlDb21wb25lbnRDb250ZXh0KSB7XHJcbiAgICAgICAgaWYgKCFjb250ZXh0LnNvbWUoYyA9PiBjLmtleSA9PT0gdmFyaWFibGUua2V5KSkge1xyXG4gICAgICAgICAgY29udGV4dC5wdXNoKHZhcmlhYmxlKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGlmICh0aGlzLmRlc2lnbmVyU3RhdGUucHJvY2Vzc1ZhcmlhYmxlQ29udGV4dC5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGZvciAoY29uc3QgdmFyaWFibGUgb2YgdGhpcy5kZXNpZ25lclN0YXRlLnByb2Nlc3NWYXJpYWJsZUNvbnRleHQpIHtcclxuICAgICAgICBpZiAoIWNvbnRleHQuc29tZShjID0+IGMua2V5ID09PSB2YXJpYWJsZS5rZXkpKSB7XHJcbiAgICAgICAgICBjb250ZXh0LnB1c2godmFyaWFibGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKGNvbnRleHQubGVuZ3RoID4gMCkge1xyXG4gICAgICBmb3IgKGNvbnN0IHYgb2YgY29udGV4dCkge1xyXG4gICAgICAgIHRoaXMuZXhwci5hZGRDb250ZXh0KHYpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICB0aGlzLmV4cHIuc2V0RWRpdFBhdHRlcm4oRXhwckVkaXRNb2RlLkFkdmFuY2VkKTsgLy8g6buY6K6k5omT5byA6auY57qn6KGo6L6+5byP57yW6L6R5ZmoXHJcbiAgICB0aGlzLmV4cHIuYWRkRXhwcmVzc2lvblRleHQoZS5pbnN0YW5jZS52YWx1ZSk7XHJcbiAgICB0aGlzLmV4cHIuYnVpbGRFeHByZXNzaW9uKCkudGhlbigoZXhwcmVzc2lvbmluZm86IHN0cmluZykgPT4ge1xyXG4gICAgICBlLmZvcm1Db250cm9sLnNldFZhbHVlKGV4cHJlc3Npb25pbmZvKTtcclxuICAgICAgZS5pbnN0YW5jZS5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICB9KTtcclxuICB9XHJcbiAgc2VsZWN0aW9uQ2hhbmdlKGRhdGE6IGFueSkge1xyXG4gICAgdGhpcy51aXN0YXRlLmN1ckNvbXBvbmVudCA9IGRhdGEuZGF0YTtcclxuICB9XHJcbiAgcGFyYW1BZnRlckVkaXQgPSAocm93SW5kZXg6IG51bWJlciwgcm93RGF0YTogYW55LCBjb2x1bW4/OiBEYXRhQ29sdW1uKSA9PiB7XHJcbiAgICByZXR1cm4gb2YodHJ1ZSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGNsb3NlQ2VsbEVkaXQoKSB7XHJcbiAgICB0aGlzLmNtcGxpc3QuZW5kQ2VsbEVkaXQoKTtcclxuICAgIGlmICh0aGlzLnBhcmFtbGlzdCkge1xyXG4gICAgICB0aGlzLnBhcmFtbGlzdC5lbmRDZWxsRWRpdCgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSB2YWxpZGF0b3IoKTogYm9vbGVhbiB7XHJcbiAgICBmb3IgKGNvbnN0IGMgb2YgdGhpcy51aXN0YXRlLmNvbXBvbmVudHMpIHtcclxuICAgICAgaWYgKCFjLmV4ZWN1dGlvblRpbWUgJiYgdGhpcy5sb2NhdGlvbiAhPT0gJ2F1dG9BY3Rpdml0eScpIHtcclxuICAgICAgICB0aGlzLm1lc3NhZ2Uud2FybmluZygn5p6E5Lu25omn6KGM5pe25py65LiN5YWB6K645Li656m677yBJyk7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBBY3Rpdml0eUNvbXBvbmVudENvbnZlcnRlciBpbXBsZW1lbnRzIFR5cGVDb252ZXJ0ZXIge1xyXG4gIGNvbnN0cnVjdG9yKCkgeyB9XHJcblxyXG4gIGNvbnZlcnRUbyhkYXRhOiBhbnlbXSk6IHN0cmluZyB7XHJcbiAgICBpZiAoZGF0YSAmJiBkYXRhLmxlbmd0aCA+IDApIHtcclxuICAgICAgcmV0dXJuICfvvIjlt7Lorr7nva7vvIknO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuICfvvIjmnKrorr7nva7vvIknO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG4iXX0=