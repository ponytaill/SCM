/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, ViewChild, TemplateRef, ComponentFactoryResolver, Injector } from '@angular/core';
import { EditorTypes } from '@farris/ui-datagrid-editors';
import { workFlowActions, executionTime, FormMethodConfig } from '../entities/form-method-config';
import { HttpService } from '@ecp-caf/caf-common';
import { DialogComponent } from '@farris/ui-dialog';
import { DatagridComponent } from '@farris/ui-datagrid';
import { MessagerService } from '@farris/ui-messager';
import { BsModalService } from '@farris/ui-modal';
import { ParameterSettingComponent } from '../parameter-setting/parameter-setting.component';
export class FormOperationConfigComponent {
    /**
     * @param {?} http
     * @param {?} message
     * @param {?} resolver
     * @param {?} injector
     * @param {?} modalService
     */
    constructor(http, message, resolver, injector, modalService) {
        this.http = http;
        this.message = message;
        this.resolver = resolver;
        this.injector = injector;
        this.modalService = modalService;
        this.operations = new Array();
        this.cols = new Array();
        this.methodCols = [
            { field: 'method', width: 100, title: '方法标识', showTips: true },
            { field: 'methodName', width: 80, title: '方法名称', showTips: true },
            { field: 'description', width: 120, title: '描述', showTips: true }
        ];
        this.formMethods = new Array();
        this.state = 'add';
    }
    /**
     * @param {?} v
     * @return {?}
     */
    set formFormatId(v) {
        this._fromFormatId = v;
        if (this._fromFormatId) {
            this.getFormMethods();
        }
    }
    /**
     * @return {?}
     */
    get formFormatId() {
        return this._fromFormatId;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.cols = [
            {
                field: 'workFlowAction', width: 80, title: '流转方向',
                formatter: {
                    type: 'enum',
                    options: { valueField: 'value', textField: 'text', data: workFlowActions }
                },
                editor: {
                    type: EditorTypes.COMBOLIST,
                    options: { valueField: 'value', textField: 'text', data: workFlowActions, idField: 'value', panelHeight: 'auto', enableClear: false }
                },
                validators: [
                    { type: 'required', messager: '必填' }
                ]
            }, {
                field: 'method', width: 100, title: '表单操作',
                editor: {
                    type: 'input-group',
                    options: {
                        groupText: '<i class="f-icon f-icon-lookup"></i>',
                        editable: false,
                        clickHandle: (/**
                         * @param {?} e
                         * @return {?}
                         */
                        (e) => {
                            e.formControl.setValue(e.instance.value ? e.instance.value : '');
                            this.e = e;
                            this.methodsDialog.show();
                            this.state = 'edit';
                        }),
                        clear: (/**
                         * @param {?} e
                         * @return {?}
                         */
                        (e) => {
                            console.log('clear', e);
                        })
                    }
                },
                formatter: (/**
                 * @param {?} v
                 * @param {?} d
                 * @param {?} i
                 * @return {?}
                 */
                (v, d, i) => {
                    if (v) {
                        /** @type {?} */
                        const m = this.formMethods.find((/**
                         * @param {?} item
                         * @return {?}
                         */
                        item => item.method === v));
                        if (m) {
                            return m.methodName;
                        }
                        else {
                            return '';
                        }
                    }
                    else {
                        return '';
                    }
                }),
                validators: [
                    { type: 'required', messager: '必填' }
                ]
            },
            {
                field: 'executionTime', width: 80, title: '执行时机',
                formatter: {
                    type: 'enum',
                    options: { valueField: 'value', textField: 'text', data: executionTime }
                },
                editor: {
                    type: EditorTypes.COMBOLIST,
                    options: { valueField: 'value', textField: 'text', data: executionTime, idField: 'value', panelHeight: 'auto', enableClear: false }
                },
                validators: [
                    { type: 'required', messager: '必填' }
                ]
            },
            {
                field: 'sortOrder', width: 60, title: '执行顺序',
                editor: {
                    type: EditorTypes.NUMBERBOX, options: {}
                },
                formatter: { type: 'number', options: { precision: 0 } },
                validators: [
                    { type: 'required', messager: '必填' }
                ]
            },
            {
                field: 'methodParameters', width: 80, title: '参数',
                template: this.cell,
                halign: 'center', align: 'center'
            }
        ];
    }
    /**
     * @return {?}
     */
    add() {
        this.methodsDialog.show();
        this.state = 'add';
    }
    /**
     * @return {?}
     */
    delete() {
        if (this.grid.selectedRow) {
            this.operations = this.operations.filter((/**
             * @param {?} o
             * @return {?}
             */
            o => o.id !== this.grid.selectedRow.id));
        }
        else {
            this.message.info('尚未选中表单操作配置！');
        }
    }
    /**
     * @param {?} ctx
     * @return {?}
     */
    editParam(ctx) {
        /** @type {?} */
        const compFactory = this.resolver.resolveComponentFactory(ParameterSettingComponent);
        /** @type {?} */
        const compRef = compFactory.create(this.injector);
        compRef.instance.mode = 'usual';
        compRef.instance.showFormType = false;
        if (ctx.rowData.methodParameters) {
            compRef.instance.parameters = [...ctx.rowData.methodParameters.map((/**
                 * @param {?} p
                 * @return {?}
                 */
                p => Object.assign({}, p)))];
        }
        else {
            compRef.instance.parameters = new Array();
        }
        /** @type {?} */
        const modalConfig = {
            title: '参数设置',
            width: 620,
            height: 400,
            showButtons: true,
            buttons: compRef.instance.modalFooter
        };
        /** @type {?} */
        const dialog = this.modalService.show(compRef, modalConfig);
        compRef.instance.submit.subscribe((/**
         * @param {?} re
         * @return {?}
         */
        re => {
            for (const o of this.operations) {
                if (o.id === ctx.rowData.id) {
                    o.methodParameters = re.parameters;
                }
            }
            dialog.close();
        }));
        compRef.instance.cancel.subscribe((/**
         * @param {?} re
         * @return {?}
         */
        re => {
            dialog.close();
        }));
    }
    /**
     * @return {?}
     */
    methodSelected() {
        if (this.methodGrid.selectedRow) {
            /** @type {?} */
            const data = this.methodGrid.selectedRow.data;
            if (this.state === 'edit') {
                if (this.e) {
                    this.e.formControl.setValue(data.method);
                    this.e.instance.cd.detectChanges();
                    for (const o of this.operations) {
                        if (o.id === data.id) {
                            o.method = data.method;
                            o.sortOrder = data.sortOrder;
                            o.methodParameters = data.methodParameters;
                        }
                    }
                }
            }
            else {
                /** @type {?} */
                const operation = new FormMethodConfig();
                operation.formFormatConfigId = this.formFormatConfigId;
                operation.method = data.method;
                operation.sortOrder = data.sortOrder;
                operation.methodParameters = data.methodParameters;
                this.operations = this.operations.concat([operation]);
            }
            this.methodsDialog.close();
        }
        else {
            this.message.info('尚未选中表单操作！');
        }
    }
    /**
     * @return {?}
     */
    validator() {
        this.grid.endCellEdit();
        for (const o of this.operations) {
            if (!o.method) {
                this.message.info('尚未选择表单操作！');
                return false;
            }
        }
        return true;
    }
    /**
     * @private
     * @return {?}
     */
    getFormMethods() {
        if (this.formFormatId) {
            /** @type {?} */
            const url = `/api/runtime/wf/v1.0/formOperation?formFormatId=${this.formFormatId}`;
            this.http.get(url).subscribe((/**
             * @param {?} re
             * @return {?}
             */
            (re) => {
                if (re) {
                    this.formMethods = re;
                }
            }));
        }
    }
}
FormOperationConfigComponent.decorators = [
    { type: Component, args: [{
                selector: 'lib-form-operation-config',
                template: "<div class=\"f-utils-fill-flex-column h-100\" style=\"background: #FFF;\">\r\n  <farris-datagrid class=\"f-component-grid f-utils-fill\" [columns]=\"cols\" [data]=\"operations\" #grid\r\n    [idField]=\"'id'\" [showLineNumber]=\"true\" [fitColumns]=\"true\" [striped]=\"true\" [showCheckbox]=\"false\"\r\n    [virtualized]=\"true\" [pagination]=\"false\" [useThemes]=\"false\" [fit]=\"true\"\r\n    [editable]=\"true\" [editMode]=\"'cell'\" >\r\n  </farris-datagrid>\r\n  <ng-template #cell let-ctx>\r\n    <a href=\"javascript: void(0);\" title=\"\u53C2\u6570\u8BBE\u7F6E\" (click)=\"editParam(ctx)\">\u8BBE\u7F6E</a>\r\n  </ng-template>\r\n</div>\r\n\r\n<ng-template #buttonRef>\r\n  <button class=\"btn btn-sm btn-primary px-3\" (click)=\"methodSelected()\">\u786E\u5B9A</button>\r\n  <button class=\"btn btn-sm btn-default px-3\" (click)=\"methodsDialog.close()\">\u53D6\u6D88</button>\r\n</ng-template>\r\n<farris-dialog #methodsDialog [buttons]=\"buttonRef\" [width]=\"700\" [height]=\"500\" [title]=\"'\u8868\u5355\u4E8B\u4EF6'\">\r\n  <div class=\"f-page f-page-is-managelist\">\r\n    <div class=\"f-page-main\">\r\n      <div class=\"f-struct-wrapper f-utils-fill-flex-column\">\r\n        <farris-section class=\"f-section-grid f-section-in-managelist p-0\" [showHeader]=\"false\">\r\n          <farris-datagrid class=\"f-component-grid\" [columns]=\"methodCols\" [data]=\"formMethods\" #methodGrid [idField]=\"'id'\"\r\n            [showLineNumber]=\"true\" [striped]=\"true\" [showCheckbox]=\"false\" [virtualized]=\"true\" [pagination]=\"false\"\r\n            [fit]=\"true\" [fitColumns]=\"true\">\r\n          </farris-datagrid>\r\n        </farris-section>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</farris-dialog>\r\n\r\n",
                styles: [""]
            }] }
];
/** @nocollapse */
FormOperationConfigComponent.ctorParameters = () => [
    { type: HttpService },
    { type: MessagerService },
    { type: ComponentFactoryResolver },
    { type: Injector },
    { type: BsModalService }
];
FormOperationConfigComponent.propDecorators = {
    formFormatId: [{ type: Input }],
    formFormatConfigId: [{ type: Input }],
    operations: [{ type: Input }],
    methodsDialog: [{ type: ViewChild, args: ['methodsDialog',] }],
    grid: [{ type: ViewChild, args: ['grid',] }],
    methodGrid: [{ type: ViewChild, args: ['methodGrid',] }],
    cell: [{ type: ViewChild, args: ['cell',] }]
};
if (false) {
    /**
     * @type {?}
     * @private
     */
    FormOperationConfigComponent.prototype._fromFormatId;
    /** @type {?} */
    FormOperationConfigComponent.prototype.formFormatConfigId;
    /** @type {?} */
    FormOperationConfigComponent.prototype.operations;
    /** @type {?} */
    FormOperationConfigComponent.prototype.methodsDialog;
    /** @type {?} */
    FormOperationConfigComponent.prototype.grid;
    /** @type {?} */
    FormOperationConfigComponent.prototype.methodGrid;
    /** @type {?} */
    FormOperationConfigComponent.prototype.cell;
    /** @type {?} */
    FormOperationConfigComponent.prototype.cols;
    /** @type {?} */
    FormOperationConfigComponent.prototype.methodCols;
    /** @type {?} */
    FormOperationConfigComponent.prototype.e;
    /** @type {?} */
    FormOperationConfigComponent.prototype.formMethods;
    /** @type {?} */
    FormOperationConfigComponent.prototype.state;
    /**
     * @type {?}
     * @private
     */
    FormOperationConfigComponent.prototype.http;
    /**
     * @type {?}
     * @private
     */
    FormOperationConfigComponent.prototype.message;
    /**
     * @type {?}
     * @private
     */
    FormOperationConfigComponent.prototype.resolver;
    /**
     * @type {?}
     * @private
     */
    FormOperationConfigComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    FormOperationConfigComponent.prototype.modalService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9ybS1vcGVyYXRpb24tY29uZmlnLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc3Atd2Yvd2YtcHJvY2Vzcy1lZGl0b3IvIiwic291cmNlcyI6WyJsaWIvdmlld3MvZXhlY3V0ZS1mb3Jtcy9mb3JtLW9wZXJhdGlvbi1jb25maWcvZm9ybS1vcGVyYXRpb24tY29uZmlnLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBVSxLQUFLLEVBQUUsU0FBUyxFQUFFLFdBQVcsRUFBRSx3QkFBd0IsRUFBRSxRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDckgsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBQzFELE9BQU8sRUFBRSxlQUFlLEVBQUUsYUFBYSxFQUFFLGdCQUFnQixFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFDbEcsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBRWxELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNwRCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN4RCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDdEQsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQ2xELE9BQU8sRUFBRSx5QkFBeUIsRUFBRSxNQUFNLGtEQUFrRCxDQUFDO0FBTzdGLE1BQU0sT0FBTyw0QkFBNEI7Ozs7Ozs7O0lBaUN2QyxZQUNVLElBQWlCLEVBQ2pCLE9BQXdCLEVBQ3hCLFFBQWtDLEVBQ2xDLFFBQWtCLEVBQ2xCLFlBQTRCO1FBSjVCLFNBQUksR0FBSixJQUFJLENBQWE7UUFDakIsWUFBTyxHQUFQLE9BQU8sQ0FBaUI7UUFDeEIsYUFBUSxHQUFSLFFBQVEsQ0FBMEI7UUFDbEMsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUNsQixpQkFB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Q0FXTCxLQUFLO3lCQUNMLEtBQUs7NEJBRUwsU0FBUyxTQUFDLGVBQWU7bUJBQ3pCLFNBQVMsU0FBQyxNQUFNO3lCQUNoQixTQUFTLFNBQUMsWUFBWTttQkFDdEIsU0FBUyxTQUFDLE1BQU07Ozs7Ozs7SUFsQmpCLHFEQUE4Qjs7SUFZOUIsMERBQW9DOztJQUNwQyxrREFBb0Q7O0lBRXBELHFEQUEyRDs7SUFDM0QsNENBQTJDOztJQUMzQyxrREFBdUQ7O0lBQ3ZELDRDQUEwQzs7SUFFMUMsNENBQW1COztJQUVuQixrREFJRTs7SUFDRix5Q0FBTzs7SUFFUCxtREFBc0M7O0lBQ3RDLDZDQUE4Qjs7Ozs7SUFHNUIsNENBQXlCOzs7OztJQUN6QiwrQ0FBZ0M7Ozs7O0lBQ2hDLGdEQUEwQzs7Ozs7SUFDMUMsZ0RBQTBCOzs7OztJQUMxQixvREFBb0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgSW5wdXQsIFZpZXdDaGlsZCwgVGVtcGxhdGVSZWYsIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciwgSW5qZWN0b3IgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgRWRpdG9yVHlwZXMgfSBmcm9tICdAZmFycmlzL3VpLWRhdGFncmlkLWVkaXRvcnMnO1xyXG5pbXBvcnQgeyB3b3JrRmxvd0FjdGlvbnMsIGV4ZWN1dGlvblRpbWUsIEZvcm1NZXRob2RDb25maWcgfSBmcm9tICcuLi9lbnRpdGllcy9mb3JtLW1ldGhvZC1jb25maWcnO1xyXG5pbXBvcnQgeyBIdHRwU2VydmljZSB9IGZyb20gJ0BlY3AtY2FmL2NhZi1jb21tb24nO1xyXG5pbXBvcnQgeyBGb3JtTWV0aG9kIH0gZnJvbSAnLi4vZW50aXRpZXMvZm9ybS1tZXRob2QnO1xyXG5pbXBvcnQgeyBEaWFsb2dDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLWRpYWxvZyc7XHJcbmltcG9ydCB7IERhdGFncmlkQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1kYXRhZ3JpZCc7XHJcbmltcG9ydCB7IE1lc3NhZ2VyU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbWVzc2FnZXInO1xyXG5pbXBvcnQgeyBCc01vZGFsU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbW9kYWwnO1xyXG5pbXBvcnQgeyBQYXJhbWV0ZXJTZXR0aW5nQ29tcG9uZW50IH0gZnJvbSAnLi4vcGFyYW1ldGVyLXNldHRpbmcvcGFyYW1ldGVyLXNldHRpbmcuY29tcG9uZW50JztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnbGliLWZvcm0tb3BlcmF0aW9uLWNvbmZpZycsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL2Zvcm0tb3BlcmF0aW9uLWNvbmZpZy5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vZm9ybS1vcGVyYXRpb24tY29uZmlnLmNvbXBvbmVudC5zY3NzJ11cclxufSlcclxuZXhwb3J0IGNsYXNzIEZvcm1PcGVyYXRpb25Db25maWdDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG4gIHByaXZhdGUgX2Zyb21Gb3JtYXRJZDogc3RyaW5nO1xyXG4gIEBJbnB1dCgpXHJcbiAgc2V0IGZvcm1Gb3JtYXRJZCh2OiBzdHJpbmcpIHtcclxuICAgIHRoaXMuX2Zyb21Gb3JtYXRJZCA9IHY7XHJcbiAgICBpZiAodGhpcy5fZnJvbUZvcm1hdElkKSB7XHJcbiAgICAgIHRoaXMuZ2V0Rm9ybU1ldGhvZHMoKTtcclxuICAgIH1cclxuICB9XHJcbiAgZ2V0IGZvcm1Gb3JtYXRJZCgpIHtcclxuICAgIHJldHVybiB0aGlzLl9mcm9tRm9ybWF0SWQ7XHJcbiAgfVxyXG5cclxuICBASW5wdXQoKSBmb3JtRm9ybWF0Q29uZmlnSWQ6IHN0cmluZztcclxuICBASW5wdXQoKSBvcGVyYXRpb25zID0gbmV3IEFycmF5PEZvcm1NZXRob2RDb25maWc+KCk7XHJcblxyXG4gIEBWaWV3Q2hpbGQoJ21ldGhvZHNEaWFsb2cnKSBtZXRob2RzRGlhbG9nOiBEaWFsb2dDb21wb25lbnQ7XHJcbiAgQFZpZXdDaGlsZCgnZ3JpZCcpIGdyaWQ6IERhdGFncmlkQ29tcG9uZW50O1xyXG4gIEBWaWV3Q2hpbGQoJ21ldGhvZEdyaWQnKSBtZXRob2RHcmlkOiBEYXRhZ3JpZENvbXBvbmVudDtcclxuICBAVmlld0NoaWxkKCdjZWxsJykgY2VsbDogVGVtcGxhdGVSZWY8YW55PjtcclxuXHJcbiAgY29scyA9IG5ldyBBcnJheSgpO1xyXG5cclxuICBtZXRob2RDb2xzID0gW1xyXG4gICAgeyBmaWVsZDogJ21ldGhvZCcsIHdpZHRoOiAxMDAsIHRpdGxlOiAn5pa55rOV5qCH6K+GJywgc2hvd1RpcHM6IHRydWUgfSxcclxuICAgIHsgZmllbGQ6ICdtZXRob2ROYW1lJywgd2lkdGg6IDgwLCB0aXRsZTogJ+aWueazleWQjeensCcsIHNob3dUaXBzOiB0cnVlIH0sXHJcbiAgICB7IGZpZWxkOiAnZGVzY3JpcHRpb24nLCB3aWR0aDogMTIwLCB0aXRsZTogJ+aPj+i/sCcsIHNob3dUaXBzOiB0cnVlIH1cclxuICBdO1xyXG4gIGU6IGFueTtcclxuXHJcbiAgZm9ybU1ldGhvZHMgPSBuZXcgQXJyYXk8Rm9ybU1ldGhvZD4oKTtcclxuICBzdGF0ZTogJ2FkZCcgfCAnZWRpdCcgPSAnYWRkJztcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIGh0dHA6IEh0dHBTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBtZXNzYWdlOiBNZXNzYWdlclNlcnZpY2UsXHJcbiAgICBwcml2YXRlIHJlc29sdmVyOiBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsXHJcbiAgICBwcml2YXRlIGluamVjdG9yOiBJbmplY3RvcixcclxuICAgIHByaXZhdGUgbW9kYWxTZXJ2aWNlOiBCc01vZGFsU2VydmljZVxyXG4gICkgeyB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gICAgdGhpcy5jb2xzID0gW1xyXG4gICAge1xyXG4gICAgICBmaWVsZDogJ3dvcmtGbG93QWN0aW9uJywgd2lkdGg6IDgwLCB0aXRsZTogJ+a1gei9rOaWueWQkScsXHJcbiAgICAgIGZvcm1hdHRlcjoge1xyXG4gICAgICAgIHR5cGU6ICdlbnVtJyxcclxuICAgICAgICBvcHRpb25zOiB7IHZhbHVlRmllbGQ6ICd2YWx1ZScsIHRleHRGaWVsZDogJ3RleHQnLCBkYXRhOiB3b3JrRmxvd0FjdGlvbnMgfVxyXG4gICAgICB9LFxyXG4gICAgICBlZGl0b3I6IHtcclxuICAgICAgICB0eXBlOiBFZGl0b3JUeXBlcy5DT01CT0xJU1QsXHJcbiAgICAgICAgb3B0aW9uczogeyB2YWx1ZUZpZWxkOiAndmFsdWUnLCB0ZXh0RmllbGQ6ICd0ZXh0JywgZGF0YTogd29ya0Zsb3dBY3Rpb25zLCBpZEZpZWxkOiAndmFsdWUnLCBwYW5lbEhlaWdodDogJ2F1dG8nLCBlbmFibGVDbGVhcjogZmFsc2UgfVxyXG4gICAgICB9LFxyXG4gICAgICB2YWxpZGF0b3JzOiBbXHJcbiAgICAgICAgeyB0eXBlOiAncmVxdWlyZWQnLCBtZXNzYWdlcjogJ+W/heWhqycgfVxyXG4gICAgICBdXHJcbiAgICB9LCB7XHJcbiAgICAgIGZpZWxkOiAnbWV0aG9kJywgd2lkdGg6IDEwMCwgdGl0bGU6ICfooajljZXmk43kvZwnLFxyXG4gICAgICBlZGl0b3I6IHtcclxuICAgICAgICB0eXBlOiAnaW5wdXQtZ3JvdXAnLFxyXG4gICAgICAgIG9wdGlvbnM6IHtcclxuICAgICAgICAgIGdyb3VwVGV4dDogJzxpIGNsYXNzPVwiZi1pY29uIGYtaWNvbi1sb29rdXBcIj48L2k+JyxcclxuICAgICAgICAgIGVkaXRhYmxlOiBmYWxzZSxcclxuICAgICAgICAgIGNsaWNrSGFuZGxlOiAoZSkgPT4ge1xyXG4gICAgICAgICAgICBlLmZvcm1Db250cm9sLnNldFZhbHVlKGUuaW5zdGFuY2UudmFsdWUgPyBlLmluc3RhbmNlLnZhbHVlIDogJycpO1xyXG4gICAgICAgICAgICB0aGlzLmUgPSBlO1xyXG4gICAgICAgICAgICB0aGlzLm1ldGhvZHNEaWFsb2cuc2hvdygpO1xyXG4gICAgICAgICAgICB0aGlzLnN0YXRlID0gJ2VkaXQnO1xyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIGNsZWFyOiAoZSkgPT4ge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnY2xlYXInLCBlKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH0sXHJcbiAgICAgIGZvcm1hdHRlcjogKHYsIGQsIGkpID0+IHtcclxuICAgICAgICBpZiAodikge1xyXG4gICAgICAgICAgY29uc3QgbSA9IHRoaXMuZm9ybU1ldGhvZHMuZmluZChpdGVtID0+IGl0ZW0ubWV0aG9kID09PSB2KTtcclxuICAgICAgICAgIGlmIChtKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBtLm1ldGhvZE5hbWU7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gJyc7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHJldHVybiAnJztcclxuICAgICAgICB9XHJcbiAgICAgIH0sXHJcbiAgICAgIHZhbGlkYXRvcnM6IFtcclxuICAgICAgICB7IHR5cGU6ICdyZXF1aXJlZCcsIG1lc3NhZ2VyOiAn5b+F5aGrJyB9XHJcbiAgICAgIF1cclxuICAgIH0sXHJcbiAgICB7XHJcbiAgICAgIGZpZWxkOiAnZXhlY3V0aW9uVGltZScsIHdpZHRoOiA4MCwgdGl0bGU6ICfmiafooYzml7bmnLonLFxyXG4gICAgICBmb3JtYXR0ZXI6IHtcclxuICAgICAgICB0eXBlOiAnZW51bScsXHJcbiAgICAgICAgb3B0aW9uczogeyB2YWx1ZUZpZWxkOiAndmFsdWUnLCB0ZXh0RmllbGQ6ICd0ZXh0JywgZGF0YTogZXhlY3V0aW9uVGltZSB9XHJcbiAgICAgIH0sXHJcbiAgICAgIGVkaXRvcjoge1xyXG4gICAgICAgIHR5cGU6IEVkaXRvclR5cGVzLkNPTUJPTElTVCxcclxuICAgICAgICBvcHRpb25zOiB7IHZhbHVlRmllbGQ6ICd2YWx1ZScsIHRleHRGaWVsZDogJ3RleHQnLCBkYXRhOiBleGVjdXRpb25UaW1lLCBpZEZpZWxkOiAndmFsdWUnLCBwYW5lbEhlaWdodDogJ2F1dG8nLCBlbmFibGVDbGVhcjogZmFsc2UgfVxyXG4gICAgICB9LFxyXG4gICAgICB2YWxpZGF0b3JzOiBbXHJcbiAgICAgICAgeyB0eXBlOiAncmVxdWlyZWQnLCBtZXNzYWdlcjogJ+W/heWhqycgfVxyXG4gICAgICBdXHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICBmaWVsZDogJ3NvcnRPcmRlcicsIHdpZHRoOiA2MCwgdGl0bGU6ICfmiafooYzpobrluo8nLFxyXG4gICAgICBlZGl0b3I6IHtcclxuICAgICAgICB0eXBlOiBFZGl0b3JUeXBlcy5OVU1CRVJCT1gsIG9wdGlvbnM6IHtcclxuICAgICAgICB9XHJcbiAgICAgIH0sXHJcbiAgICAgIGZvcm1hdHRlcjogeyB0eXBlOiAnbnVtYmVyJywgb3B0aW9uczogeyBwcmVjaXNpb246IDAgfSB9LFxyXG4gICAgICB2YWxpZGF0b3JzOiBbXHJcbiAgICAgICAgeyB0eXBlOiAncmVxdWlyZWQnLCBtZXNzYWdlcjogJ+W/heWhqycgfVxyXG4gICAgICBdXHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICBmaWVsZDogJ21ldGhvZFBhcmFtZXRlcnMnLCB3aWR0aDogODAsIHRpdGxlOiAn5Y+C5pWwJyxcclxuICAgICAgdGVtcGxhdGU6IHRoaXMuY2VsbCxcclxuICAgICAgaGFsaWduOiAnY2VudGVyJywgYWxpZ246ICdjZW50ZXInXHJcbiAgICB9XHJcbiAgXTtcclxuICB9XHJcblxyXG4gIGFkZCgpIHtcclxuICAgIHRoaXMubWV0aG9kc0RpYWxvZy5zaG93KCk7XHJcbiAgICB0aGlzLnN0YXRlID0gJ2FkZCc7XHJcbiAgfVxyXG5cclxuICBkZWxldGUoKSB7XHJcbiAgICBpZiAodGhpcy5ncmlkLnNlbGVjdGVkUm93KSB7XHJcbiAgICAgIHRoaXMub3BlcmF0aW9ucyA9IHRoaXMub3BlcmF0aW9ucy5maWx0ZXIobyA9PiBvLmlkICE9PSB0aGlzLmdyaWQuc2VsZWN0ZWRSb3cuaWQpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5tZXNzYWdlLmluZm8oJ+WwmuacqumAieS4reihqOWNleaTjeS9nOmFjee9ru+8gScpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZWRpdFBhcmFtKGN0eDogYW55KSB7XHJcbiAgICBjb25zdCBjb21wRmFjdG9yeSA9IHRoaXMucmVzb2x2ZXIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoUGFyYW1ldGVyU2V0dGluZ0NvbXBvbmVudCk7XHJcbiAgICBjb25zdCBjb21wUmVmID0gY29tcEZhY3RvcnkuY3JlYXRlKHRoaXMuaW5qZWN0b3IpO1xyXG4gICAgY29tcFJlZi5pbnN0YW5jZS5tb2RlID0gJ3VzdWFsJztcclxuICAgIGNvbXBSZWYuaW5zdGFuY2Uuc2hvd0Zvcm1UeXBlID0gZmFsc2U7XHJcbiAgICBpZiAoY3R4LnJvd0RhdGEubWV0aG9kUGFyYW1ldGVycykge1xyXG4gICAgICBjb21wUmVmLmluc3RhbmNlLnBhcmFtZXRlcnMgPSBbLi4uY3R4LnJvd0RhdGEubWV0aG9kUGFyYW1ldGVycy5tYXAocCA9PiBPYmplY3QuYXNzaWduKHt9LCBwKSldO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY29tcFJlZi5pbnN0YW5jZS5wYXJhbWV0ZXJzID0gbmV3IEFycmF5KCk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgbW9kYWxDb25maWcgPSB7XHJcbiAgICAgIHRpdGxlOiAn5Y+C5pWw6K6+572uJyxcclxuICAgICAgd2lkdGg6IDYyMCxcclxuICAgICAgaGVpZ2h0OiA0MDAsXHJcbiAgICAgIHNob3dCdXR0b25zOiB0cnVlLFxyXG4gICAgICBidXR0b25zOiBjb21wUmVmLmluc3RhbmNlLm1vZGFsRm9vdGVyXHJcbiAgICB9O1xyXG4gICAgY29uc3QgZGlhbG9nID0gdGhpcy5tb2RhbFNlcnZpY2Uuc2hvdyhjb21wUmVmLCBtb2RhbENvbmZpZyk7XHJcblxyXG4gICAgY29tcFJlZi5pbnN0YW5jZS5zdWJtaXQuc3Vic2NyaWJlKHJlID0+IHtcclxuICAgICAgZm9yIChjb25zdCBvIG9mIHRoaXMub3BlcmF0aW9ucykge1xyXG4gICAgICAgIGlmIChvLmlkID09PSBjdHgucm93RGF0YS5pZCkge1xyXG4gICAgICAgICAgby5tZXRob2RQYXJhbWV0ZXJzID0gcmUucGFyYW1ldGVycztcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgZGlhbG9nLmNsb3NlKCk7XHJcbiAgICB9KTtcclxuICAgIGNvbXBSZWYuaW5zdGFuY2UuY2FuY2VsLnN1YnNjcmliZShyZSA9PiB7XHJcbiAgICAgIGRpYWxvZy5jbG9zZSgpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBtZXRob2RTZWxlY3RlZCgpIHtcclxuICAgIGlmICh0aGlzLm1ldGhvZEdyaWQuc2VsZWN0ZWRSb3cpIHtcclxuICAgICAgY29uc3QgZGF0YSA9IHRoaXMubWV0aG9kR3JpZC5zZWxlY3RlZFJvdy5kYXRhO1xyXG4gICAgICBpZiAodGhpcy5zdGF0ZSA9PT0gJ2VkaXQnKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZSkge1xyXG4gICAgICAgICAgdGhpcy5lLmZvcm1Db250cm9sLnNldFZhbHVlKGRhdGEubWV0aG9kKTtcclxuICAgICAgICAgIHRoaXMuZS5pbnN0YW5jZS5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgICBmb3IgKGNvbnN0IG8gb2YgdGhpcy5vcGVyYXRpb25zKSB7XHJcbiAgICAgICAgICAgIGlmIChvLmlkID09PSBkYXRhLmlkKSB7XHJcbiAgICAgICAgICAgICAgby5tZXRob2QgPSBkYXRhLm1ldGhvZDtcclxuICAgICAgICAgICAgICBvLnNvcnRPcmRlciA9IGRhdGEuc29ydE9yZGVyO1xyXG4gICAgICAgICAgICAgIG8ubWV0aG9kUGFyYW1ldGVycyA9IGRhdGEubWV0aG9kUGFyYW1ldGVycztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zdCBvcGVyYXRpb24gPSBuZXcgRm9ybU1ldGhvZENvbmZpZygpO1xyXG4gICAgICAgIG9wZXJhdGlvbi5mb3JtRm9ybWF0Q29uZmlnSWQgPSB0aGlzLmZvcm1Gb3JtYXRDb25maWdJZDtcclxuICAgICAgICBvcGVyYXRpb24ubWV0aG9kID0gZGF0YS5tZXRob2Q7XHJcbiAgICAgICAgb3BlcmF0aW9uLnNvcnRPcmRlciA9IGRhdGEuc29ydE9yZGVyO1xyXG4gICAgICAgIG9wZXJhdGlvbi5tZXRob2RQYXJhbWV0ZXJzID0gZGF0YS5tZXRob2RQYXJhbWV0ZXJzO1xyXG4gICAgICAgIHRoaXMub3BlcmF0aW9ucyA9IHRoaXMub3BlcmF0aW9ucy5jb25jYXQoW29wZXJhdGlvbl0pO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMubWV0aG9kc0RpYWxvZy5jbG9zZSgpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5tZXNzYWdlLmluZm8oJ+WwmuacqumAieS4reihqOWNleaTjeS9nO+8gScpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgdmFsaWRhdG9yKCk6IGJvb2xlYW4ge1xyXG4gICAgdGhpcy5ncmlkLmVuZENlbGxFZGl0KCk7XHJcbiAgICBmb3IgKGNvbnN0IG8gb2YgdGhpcy5vcGVyYXRpb25zKSB7XHJcbiAgICAgIGlmICghby5tZXRob2QpIHtcclxuICAgICAgICB0aGlzLm1lc3NhZ2UuaW5mbygn5bCa5pyq6YCJ5oup6KGo5Y2V5pON5L2c77yBJyk7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0Rm9ybU1ldGhvZHMoKSB7XHJcbiAgICBpZiAodGhpcy5mb3JtRm9ybWF0SWQpIHtcclxuICAgICAgY29uc3QgdXJsID0gYC9hcGkvcnVudGltZS93Zi92MS4wL2Zvcm1PcGVyYXRpb24/Zm9ybUZvcm1hdElkPSR7dGhpcy5mb3JtRm9ybWF0SWR9YDtcclxuICAgICAgdGhpcy5odHRwLmdldCh1cmwpLnN1YnNjcmliZSgocmU6IGFueSkgPT4ge1xyXG4gICAgICAgIGlmIChyZSkge1xyXG4gICAgICAgICAgdGhpcy5mb3JtTWV0aG9kcyA9IHJlO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxufVxyXG4iXX0=