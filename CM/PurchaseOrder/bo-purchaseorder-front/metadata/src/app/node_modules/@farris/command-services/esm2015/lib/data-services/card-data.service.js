import { Injectable, Optional } from '@angular/core';
import { FrameContext } from '@farris/devkit';
import { BefRepositoryUtil } from '@farris/bef';
import { of, empty, EMPTY, from, Subject } from 'rxjs';
import { tap, switchMap, concatMap, last } from 'rxjs/operators';
import { FormLoadingService } from '../form-loading/form-loading.service';
import { LanguageService } from '../languag.service';
import { FormNotifyService } from '../form-notify.service';
import { FormMessageService } from '../form-message.service';
import { FormErrorService } from '../error/form-error.service';
import { EditStateUtil } from './utils/index';
import { FormNotifyStrategyService } from '../form-notify-strategy.service';
import { RuntimeFrameworkService } from '../rtf-service';
import { WEB_FORM_ROUTE_PARAMS_KEY } from '../types';
import { CommandService } from '../command-service';
import { ValidationService } from '../validation.service';
// tslint:disable: no-string-literal
// tslint:disable: max-line-length
/**
 * 卡片仓库服务
 */
class CardDataService {
    /**
     * 构造函数
     */
    constructor(formMessageService, frameContext, loadingService, formNotifyService, languageService, formErrorService, runtimeFrameworkService, commandService) {
        this.formMessageService = formMessageService;
        this.frameContext = frameContext;
        this.loadingService = loadingService;
        this.formNotifyService = formNotifyService;
        this.languageService = languageService;
        this.formErrorService = formErrorService;
        this.runtimeFrameworkService = runtimeFrameworkService;
        this.commandService = commandService;
        if (!languageService) {
            this.languageService = LanguageService.getInstance();
        }
        this.repository = this.frameContext.repository;
        this.bindingData = this.frameContext.bindingData;
    }
    /**
     * 加载数据
     * @param id 主实体id
     * @param enableChildrenPagination 启用子表分页
     */
    load(id) {
        const loadingTimerId = this.loadingService.showLoadingWithDelay(500);
        this.frameContext.appContext.params.set("retrieveing", true);
        this.frameContext.appContext.params.delete('queryChild');
        const get$ = this.repository.getById(id);
        return get$.pipe(tap(() => {
            this.loadingService.hideDelayLoading(loadingTimerId);
        }, (error) => {
            this.loadingService.hideDelayLoading(loadingTimerId);
            this.formErrorService.exception(this.languageService.loadFailed, error);
        }));
    }
    /**
     * 加载前
     * @param id id
     * @param transitionActionParamName 状态迁移动作参数编号
     * @returns
     */
    onLoading(transitionActionParamName) {
        const tabId = this.runtimeFrameworkService && this.runtimeFrameworkService.tabId || null;
        if (!tabId) {
            return;
        }
        let skip = true;
        const listening = this.frameContext.appContext.params.get(tabId) || false;
        transitionActionParamName = transitionActionParamName || 'transitionAction';
        if (!listening) {
            this.frameContext.appContext.params.set(tabId, true);
            this.runtimeFrameworkService.getEntityParam(tabId, (options) => {
                if (skip) {
                    skip = false;
                    return;
                }
                const params = this.parseParams(options);
                if (params && params.sync) {
                    const action = params.action;
                    const id = params.id;
                    const ngCommand = this.frameContext && this.frameContext.viewModel && this.frameContext.viewModel.metadatas && this.frameContext.viewModel.metadatas[action];
                    const actionName = ngCommand.params && ngCommand.params[transitionActionParamName] || null;
                    const formPrimaryValue = this.frameContext.bindingData.list.currentId;
                    const formState = this.frameContext.stateMachine.context.state;
                    let state = null;
                    let stateName;
                    if (!actionName) {
                        // 可能是用户自己配置的命令，没有状态机切换，此时不再判断状态机
                        state = formState;
                    }
                    else {
                        const ngAction = this.frameContext && this.frameContext.stateMachine && this.frameContext.stateMachine.metadatas && this.frameContext.stateMachine.metadatas.actions && this.frameContext.stateMachine.metadatas.actions[actionName];
                        state = ngAction && ngAction.transitTo || formState;
                        stateName = this.frameContext && this.frameContext.stateMachine && this.frameContext.stateMachine.metadatas && this.frameContext.stateMachine.metadatas && this.frameContext.stateMachine.metadatas.states[state] && this.frameContext.stateMachine.metadatas.states[state].name || this.languageService.defaultStateName;
                        if (stateName && stateName.startsWith('{{') && stateName.endsWith('}}')) {
                            const key = stateName.replace('{{', '').replace('}}', '');
                            stateName = this.frameContext.translate.transform(key, null);
                        }
                    }
                    const primaryValueChanged = formPrimaryValue !== id;
                    const stateChanged = formState !== state;
                    if (primaryValueChanged && stateChanged) {
                        // 均发生变化
                        const message = this.languageService.dataAndStateChanged.replace(/\$1/g, stateName);
                        this.showLoadingConfirm(message).pipe(switchMap(() => {
                            return this.resetForm(action);
                        })).subscribe();
                    }
                    else if (primaryValueChanged) {
                        // 主键发生变化
                        this.showLoadingConfirm(this.languageService.dataChanged).pipe(switchMap(() => {
                            return this.resetForm(action);
                        })).subscribe();
                    }
                    else if (stateChanged) {
                        // 状态发生变化
                        const message = this.languageService.stateChanged.replace(/\$1/g, stateName);
                        this.showLoadingConfirm(message).pipe(switchMap(() => {
                            return this.resetForm(action);
                        })).subscribe();
                    }
                    else {
                        // 数据及状态均未发生变化
                        return of(true);
                    }
                }
            }, false);
        }
    }
    /**
     * 新增
     */
    add() {
        const lastModifiedId = this.bindingData.list.currentId;
        const loadingTimerId = this.loadingService.showLoadingWithDelay(500);
        const create$ = this.repository.create();
        return create$.pipe(tap(() => {
            EditStateUtil.setEditState(this.frameContext, lastModifiedId);
            this.loadingService.hideDelayLoading(loadingTimerId);
        }, (error) => {
            this.loadingService.hideDelayLoading(loadingTimerId);
            this.formErrorService.exception(this.languageService.addFailed, error);
        }));
    }
    /**
     * 级联新增
     */
    cascadeAdd() {
        const subject = new Subject();
        // 找到所有viewmodel,拿到了所有的frameContext，可能有组合表单的
        const frameContexts = this.frameContext.appContext.frameContextManager.getFrameContexts();
        // 找到当前frameContext的公共namespace
        const currentNamespace = this.frameContext.getVirtualRootFrameContext().namespace;
        // 拿到当前命令所在frame的表单的所有frameContext
        const currentFormFrameContexts = frameContexts.filter((context) => context.namespace === currentNamespace) || [];
        let bindingPaths = [];
        if (currentFormFrameContexts && currentFormFrameContexts.length > 0) {
            // 找到所有下级frameContext
            const childFrameContexts = currentFormFrameContexts.filter((context) => context.viewModel.bindingPath && context.viewModel.bindingPath !== '/');
            if (childFrameContexts && childFrameContexts.length > 0) {
                const childBindingPaths = childFrameContexts.map((context) => context.viewModel.bindingPath);
                if (childBindingPaths && childBindingPaths.length > 0) {
                    bindingPaths = childBindingPaths.map(path => path.split('/').filter(p => p)).sort((a, b) => a.length - b.length);
                }
            }
        }
        this.loadingService.show();
        this.repository.create().pipe(switchMap((entity) => {
            const rid = entity.primaryValue;
            if (bindingPaths && bindingPaths.length > 0) {
                return from(bindingPaths).pipe(concatMap((bindingPath) => {
                    const fpath = this.getPath(this.frameContext.viewModel, '/' + bindingPath.join('/'), rid);
                    return this.repository.appendByPath(fpath);
                }));
            }
            else {
                return of(entity);
            }
        })).pipe(last()).subscribe(() => {
            this.loadingService.hide();
            subject.next();
        }, (error) => {
            this.loadingService.hide();
            this.formErrorService.exception(this.languageService.addFailed, error);
        });
        return subject;
    }
    /**
     * 编辑（更新数据并标记编辑状态）
     */
    edit(id) {
        const update$ = this.update();
        return update$.pipe(tap(() => {
            const currentId = this.bindingData.list.currentId;
            EditStateUtil.setEditState(this.frameContext, currentId);
        }));
    }
    /**
     * 更新
     * @param id 主实体id
     * @param enableChildrenPagination 启用子表分页
     */
    update(id) {
        // 获取id
        id = this.bindingData.list.currentId;
        if (!id) {
            return empty();
        }
        const loadingTimerId = this.loadingService.showLoadingWithDelay(500);
        const update$ = this.repository.updateById(id);
        this.frameContext.appContext.params.set("retrieveing", true);
        return update$.pipe(tap(() => {
            this.loadingService.hideDelayLoading(loadingTimerId);
        }, error => {
            this.loadingService.hideDelayLoading(loadingTimerId);
            this.formErrorService.exception(this.languageService.updateFailed, error);
        }));
    }
    updateWithoutEmpty() {
        // 获取id
        const id = this.bindingData.list.currentId;
        if (!id) {
            return of(null);
        }
        else {
            return this.update();
        }
    }
    /**
     * 校验当前行是否存在
     * @returns
     */
    checkBeforeUpdate() {
        const bindingList = this.frameContext.bindingData.list;
        const id = bindingList && bindingList.currentId;
        if (!id) {
            this.formNotifyService.warning(this.languageService.noDataExist, { hideTitle: true });
            return EMPTY;
        }
        return of(true);
    }
    /**
     * 已废弃
     * @returns
     */
    updateWithNotify() {
        // 获取id
        const id = this.bindingData.list.currentId;
        if (!id) {
            this.formNotifyService.warning(this.languageService.noDataExist, { hideTitle: true });
            return EMPTY;
        }
        else {
            return this.update();
        }
    }
    /**
     * 加载卡片数据（分页加载子表数据）
     * @deprecated 方法已废弃，请勿使用
     */
    loadPaged(filter, sort) {
        // 获取id
        const id = this.bindingData.list.currentId;
        if (!id) {
            return EMPTY;
        }
        const loadingTimerId = this.loadingService.showLoadingWithDelay(500);
        // this.frameContext.root.params.set('updateWithPaging', true);
        const update$ = of(null); //this.repository.updateEntityById(id, true);
        return update$.pipe(tap(() => {
            this.loadingService.hideDelayLoading(loadingTimerId);
        }, error => {
            this.loadingService.hideDelayLoading(loadingTimerId);
            this.formErrorService.exception(this.languageService.updateFailed, error);
        }));
    }
    /**
     * 保存
     */
    save(successMsg) {
        // 获取当前行
        const id = this.bindingData.list.currentId;
        if (!id) {
            return of(false);
        }
        const loadingTimerId = this.loadingService.showLoadingWithDelay(500);
        const update$ = this.repository.updateChangesById(id);
        const save$ = this.repository.applyChangesById(id);
        const result$ = update$.pipe(
        // update$ => save$
        switchMap((updateResult) => {
            if (updateResult === false) {
                return of(false);
            }
            else {
                return save$;
            }
        }), 
        // 隐藏loading
        tap(() => {
            // 取消新增状态
            EditStateUtil.setEditState(this.frameContext, id);
            this.loadingService.hideDelayLoading(loadingTimerId);
            // this.formNotifyService.info(this.languageService.saveSuccess);
            if (successMsg && successMsg.trim()) {
                let showMessage = true;
                if (successMsg.startsWith('{') && successMsg.endsWith('}')) {
                    try {
                        const options = JSON.parse(successMsg);
                        if (options && options.showMessage === false) {
                            showMessage = false;
                        }
                    }
                    catch (_a) { }
                }
                if (showMessage !== false) {
                    this.formNotifyService.success(successMsg, { hideTitle: true });
                }
            }
            else {
                FormNotifyStrategyService.success(this.formNotifyService, this.languageService.saveSuccess);
            }
            // FormNotifyStrategyService.success(this.formNotifyService, this.languageService.saveSuccess);
        }, error => {
            this.loadingService.hideDelayLoading(loadingTimerId);
            this.formErrorService.exception(this.languageService.saveFailed, error);
        }));
        return result$;
    }
    // #region 取消相关方法
    /**
     * 取消（默认取消）
     */
    cancel() {
        return this.cancelWithCheck();
    }
    /**
     * 还原变更集
     * @description 不带变更检测提示
     */
    revert(options) {
        return this.cancelWithoutCheck(options);
    }
    /**
     * 取消（取消前检查未保存的变更）
     * @summary
     * 1、用户误操作：只需要做个提示就可以了；
     * 2、用户有意取消：点击取消就是要放弃所有变更，这时候询问人家是否要保存或者提示存在变更有点多此一举，确认一把即可。
     * 3、用户误操作：没有变更的情况下直接给取消了，用户会产生恐慌，因为用户有时候并不确定是否有变更，应该也确认一把。
     * @todo
     * 1、由于产品部很多代码误用了该方法，依赖了没有变更的时候直接取消，现在弹窗确认框来，不太合适；
     * 2、产品部需要用cancelWithoutCheck方法代替，目前先给兼容着，待删除。
     */
    cancelWithCheck() {
        // @todel
        const hasUnSavedChanges = BefRepositoryUtil.isExistUnsaveData(this.repository);
        if (!hasUnSavedChanges) {
            return this.cancelChanges();
        }
        // 确认是否取消
        const confirm$ = this.formMessageService.question(this.languageService['cancelWithoutSave']);
        const result$ = confirm$.pipe(switchMap((ifCancel) => {
            if (ifCancel === false) {
                return EMPTY;
            }
            return this.cancelChanges();
        }));
        return result$;
    }
    /**
     * 取消（直接取消，不执行检查）
     */
    cancelWithoutCheck(options) {
        return this.cancelChanges(options);
    }
    /**
     * 取消
     */
    cancelChanges(options) {
        const loadingTimerId = this.loadingService.showLoadingWithDelay(500);
        const cancel$ = this.repository.cancelChanges(options);
        return cancel$.pipe(tap(() => {
            EditStateUtil.setEditState(this.frameContext, '');
            this.loadingService.hideDelayLoading(loadingTimerId);
        }, error => {
            this.loadingService.hideDelayLoading(loadingTimerId);
            this.formErrorService.exception(this.languageService.cancelFailed, error);
        }));
    }
    // #endregion
    /**
     * 重新加载（仅供卡片取消后重新加载数据，其他场景请勿使用）
     */
    reload() {
        const isAdd = EditStateUtil.getAddState(this.frameContext);
        let id;
        if (isAdd === true) {
            id = EditStateUtil.getLastModifiedId(this.frameContext);
        }
        else {
            id = this.bindingData.list.currentId;
        }
        if (!id) {
            this.repository.entityCollection.loadEntities([]);
            return;
        }
        return this.load(id);
    }
    getPath(viewModel, bindingPath, rid) {
        let path = '/' + rid;
        const subPaths = bindingPath.split('/');
        if (subPaths.length > 0) {
            // eg:bindingPath形如/edus/grades,split后是['', 'edus', 'grades']
            // 因此index从1开始
            for (let index = 1; index < subPaths.length - 1; index++) {
                const subPath = subPaths[index];
                const subData = viewModel.bindingData[subPath];
                if (!subData || !subData.currentId) {
                    throw Error(`获取子表完整路径出错，找不到${subData}对应的子表，或对应子表没有当前行。`);
                }
                path += `/${subPath}/${subData.currentId}`;
            }
        }
        path += '/' + subPaths[subPaths.length - 1];
        return path;
    }
    resetForm(action) {
        const validationService = this.frameContext.injector.get(ValidationService, null);
        return this.frameContext.repository.cancelChanges().pipe(switchMap(() => this.commandService.execute(action).pipe(switchMap(() => {
            return validationService && validationService.resetValidation() || of(null);
        }))));
    }
    parseParams(options) {
        if (options && Object.prototype.toString.call(options) === "[object Map]" /* map */) {
            let params = options.get(WEB_FORM_ROUTE_PARAMS_KEY);
            if (params && typeof params === 'string') {
                params = decodeURIComponent(params);
                if (params.startsWith('{') && params.endsWith('}')) {
                    params = JSON.parse(params);
                }
                return {
                    action: params.action,
                    id: params.idToView || params.idToEdit || params.id,
                    sync: params.sync || false
                };
            }
        }
        return null;
    }
    showLoadingConfirm(message) {
        return this.formMessageService.confirm(message).pipe(switchMap((result) => {
            if (result === true) {
                return of(true);
            }
            else {
                return EMPTY;
            }
        }));
    }
}
CardDataService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
CardDataService.ctorParameters = () => [
    { type: FormMessageService },
    { type: FrameContext },
    { type: FormLoadingService },
    { type: FormNotifyService },
    { type: LanguageService, decorators: [{ type: Optional }] },
    { type: FormErrorService },
    { type: RuntimeFrameworkService },
    { type: CommandService }
];
export { CardDataService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FyZC1kYXRhLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2NvbW1hbmQtc2VydmljZXMvIiwic291cmNlcyI6WyJsaWIvZGF0YS1zZXJ2aWNlcy9jYXJkLWRhdGEuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNyRCxPQUFPLEVBQXVCLFlBQVksRUFBYSxNQUFNLGdCQUFnQixDQUFDO0FBQzlFLE9BQU8sRUFBaUIsaUJBQWlCLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFDL0QsT0FBTyxFQUFjLEVBQUUsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFlLElBQUksRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDaEYsT0FBTyxFQUFFLEdBQUcsRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUF1QixJQUFJLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUN0RixPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxzQ0FBc0MsQ0FBQztBQUMxRSxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDckQsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDM0QsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFDN0QsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFDL0QsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUM5QyxPQUFPLEVBQUUseUJBQXlCLEVBQUUsTUFBTSxpQ0FBaUMsQ0FBQztBQUM1RSxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUN6RCxPQUFPLEVBQVkseUJBQXlCLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFDL0QsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FB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M0IsQ0FBQzthQUNIO1NBQ0Y7UUFDRCxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFDTyxrQkFBa0IsQ0FBQyxPQUFlO1FBQ3hDLE9BQU8sSUFBSSxDQUFDLGtCQUFrQixDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQ2xELFNBQVMsQ0FBQyxDQUFDLE1BQWUsRUFBRSxFQUFFO1lBQzVCLElBQUksTUFBTSxLQUFLLElBQUksRUFBRTtnQkFDbkIsT0FBTyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUM7YUFDakI7aUJBQU07Z0JBQ0wsT0FBTyxLQUFLLENBQUM7YUFDZDtRQUNILENBQUMsQ0FBQyxDQUNILENBQUM7SUFDSixDQUFDOzs7WUE3ZkYsVUFBVTs7OztZQWJGLGtCQUFrQjtZQVBHLFlBQVk7WUFJakMsa0JBQWtCO1lBRWxCLGlCQUFpQjtZQURqQixlQUFlLHVCQW9DbkIsUUFBUTtZQWpDSixnQkFBZ0I7WUFHaEIsdUJBQXVCO1lBRXZCLGNBQWM7O0FBc2dCdkIsT0FBTyxFQUFFLGVBQWUsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgT3B0aW9uYWwgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEVudGl0eSwgQmluZGluZ0RhdGEsIEZyYW1lQ29udGV4dCwgVmlld01vZGVsIH0gZnJvbSAnQGZhcnJpcy9kZXZraXQnO1xuaW1wb3J0IHsgQmVmUmVwb3NpdG9yeSwgQmVmUmVwb3NpdG9yeVV0aWwgfSBmcm9tICdAZmFycmlzL2JlZic7XG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBvZiwgZW1wdHksIEVNUFRZLCBjb25jYXQsIHppcCwgZnJvbSwgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgdGFwLCBzd2l0Y2hNYXAsIGNvbmNhdE1hcCwgY29uY2F0QWxsLCB0YWtlTGFzdCwgbGFzdCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IEZvcm1Mb2FkaW5nU2VydmljZSB9IGZyb20gJy4uL2Zvcm0tbG9hZGluZy9mb3JtLWxvYWRpbmcuc2VydmljZSc7XG5pbXBvcnQgeyBMYW5ndWFnZVNlcnZpY2UgfSBmcm9tICcuLi9sYW5ndWFnLnNlcnZpY2UnO1xuaW1wb3J0IHsgRm9ybU5vdGlmeVNlcnZpY2UgfSBmcm9tICcuLi9mb3JtLW5vdGlmeS5zZXJ2aWNlJztcbmltcG9ydCB7IEZvcm1NZXNzYWdlU2VydmljZSB9IGZyb20gJy4uL2Zvcm0tbWVzc2FnZS5zZXJ2aWNlJztcbmltcG9ydCB7IEZvcm1FcnJvclNlcnZpY2UgfSBmcm9tICcuLi9lcnJvci9mb3JtLWVycm9yLnNlcnZpY2UnO1xuaW1wb3J0IHsgRWRpdFN0YXRlVXRpbCB9IGZyb20gJy4vdXRpbHMvaW5kZXgnO1xuaW1wb3J0IHsgRm9ybU5vdGlmeVN0cmF0ZWd5U2VydmljZSB9IGZyb20gJy4uL2Zvcm0tbm90aWZ5LXN0cmF0ZWd5LnNlcnZpY2UnO1xuaW1wb3J0IHsgUnVudGltZUZyYW1ld29ya1NlcnZpY2UgfSBmcm9tICcuLi9ydGYtc2VydmljZSc7XG5pbXBvcnQgeyBEYXRhVHlwZSwgV0VCX0ZPUk1fUk9VVEVfUEFSQU1TX0tFWSB9IGZyb20gJy4uL3R5cGVzJztcbmltcG9ydCB7IENvbW1hbmRTZXJ2aWNlIH0gZnJvbSAnLi4vY29tbWFuZC1zZXJ2aWNlJztcbmltcG9ydCB7IFZhbGlkYXRpb25TZXJ2aWNlIH0gZnJvbSAnLi4vdmFsaWRhdGlvbi5zZXJ2aWNlJztcbi8vIHRzbGludDpkaXNhYmxlOiBuby1zdHJpbmctbGl0ZXJhbFxuLy8gdHNsaW50OmRpc2FibGU6IG1heC1saW5lLWxlbmd0aFxuLyoqXG4gKiDljaHniYfku5PlupPmnI3liqFcbiAqL1xuQEluamVjdGFibGUoKVxuY2xhc3MgQ2FyZERhdGFTZXJ2aWNlIHtcblxuICAvKipcbiAgICog5a6e5L2T5LuT5bqTXG4gICAqL1xuICBwcml2YXRlIHJlcG9zaXRvcnk6IEJlZlJlcG9zaXRvcnk8RW50aXR5PjtcblxuICAvKipcbiAgICog57uR5a6a5pWw5o2uXG4gICAqL1xuICBwcml2YXRlIGJpbmRpbmdEYXRhOiBCaW5kaW5nRGF0YTtcblxuICAvKipcbiAgICog5p6E6YCg5Ye95pWwXG4gICAqL1xuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGZvcm1NZXNzYWdlU2VydmljZTogRm9ybU1lc3NhZ2VTZXJ2aWNlLFxuICAgIHByaXZhdGUgZnJhbWVDb250ZXh0OiBGcmFtZUNvbnRleHQsXG4gICAgcHJpdmF0ZSBsb2FkaW5nU2VydmljZTogRm9ybUxvYWRpbmdTZXJ2aWNlLFxuICAgIHByaXZhdGUgZm9ybU5vdGlmeVNlcnZpY2U6IEZvcm1Ob3RpZnlTZXJ2aWNlLFxuICAgIEBPcHRpb25hbCgpIHByaXZhdGUgbGFuZ3VhZ2VTZXJ2aWNlOiBMYW5ndWFnZVNlcnZpY2UsXG4gICAgcHJpdmF0ZSBmb3JtRXJyb3JTZXJ2aWNlOiBGb3JtRXJyb3JTZXJ2aWNlLFxuICAgIHByaXZhdGUgcnVudGltZUZyYW1ld29ya1NlcnZpY2U6IFJ1bnRpbWVGcmFtZXdvcmtTZXJ2aWNlLFxuICAgIHByaXZhdGUgY29tbWFuZFNlcnZpY2U6IENvbW1hbmRTZXJ2aWNlXG4gICkge1xuICAgIGlmICghbGFuZ3VhZ2VTZXJ2aWNlKSB7XG4gICAgICB0aGlzLmxhbmd1YWdlU2VydmljZSA9IExhbmd1YWdlU2VydmljZS5nZXRJbnN0YW5jZSgpO1xuICAgIH1cbiAgICB0aGlzLnJlcG9zaXRvcnkgPSB0aGlzLmZyYW1lQ29udGV4dC5yZXBvc2l0b3J5IGFzIEJlZlJlcG9zaXRvcnk8RW50aXR5PjtcbiAgICB0aGlzLmJpbmRpbmdEYXRhID0gdGhpcy5mcmFtZUNvbnRleHQuYmluZGluZ0RhdGE7XG4gIH1cblxuICAvKipcbiAgICog5Yqg6L295pWw5o2uXG4gICAqIEBwYXJhbSBpZCDkuLvlrp7kvZNpZFxuICAgKiBAcGFyYW0gZW5hYmxlQ2hpbGRyZW5QYWdpbmF0aW9uIOWQr+eUqOWtkOihqOWIhumhtVxuICAgKi9cbiAgcHVibGljIGxvYWQoaWQ6IHN0cmluZyk6IE9ic2VydmFibGU8RW50aXR5PiB7XG4gICAgY29uc3QgbG9hZGluZ1RpbWVySWQgPSB0aGlzLmxvYWRpbmdTZXJ2aWNlLnNob3dMb2FkaW5nV2l0aERlbGF5KDUwMCk7XG4gICAgdGhpcy5mcmFtZUNvbnRleHQuYXBwQ29udGV4dC5wYXJhbXMuc2V0KFwicmV0cmlldmVpbmdcIiwgdHJ1ZSk7XG4gICAgdGhpcy5mcmFtZUNvbnRleHQuYXBwQ29udGV4dC5wYXJhbXMuZGVsZXRlKCdxdWVyeUNoaWxkJyk7XG4gICAgY29uc3QgZ2V0JCA9IHRoaXMucmVwb3NpdG9yeS5nZXRCeUlkKGlkKTtcbiAgICByZXR1cm4gZ2V0JC5waXBlKFxuICAgICAgdGFwKFxuICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgdGhpcy5sb2FkaW5nU2VydmljZS5oaWRlRGVsYXlMb2FkaW5nKGxvYWRpbmdUaW1lcklkKTtcbiAgICAgICAgfSxcbiAgICAgICAgKGVycm9yOiBhbnkpID0+IHtcbiAgICAgICAgICB0aGlzLmxvYWRpbmdTZXJ2aWNlLmhpZGVEZWxheUxvYWRpbmcobG9hZGluZ1RpbWVySWQpO1xuICAgICAgICAgIHRoaXMuZm9ybUVycm9yU2VydmljZS5leGNlcHRpb24odGhpcy5sYW5ndWFnZVNlcnZpY2UubG9hZEZhaWxlZCwgZXJyb3IpO1xuICAgICAgICB9XG4gICAgICApXG4gICAgKTtcbiAgfVxuICAvKipcbiAgICog5Yqg6L295YmNXG4gICAqIEBwYXJhbSBpZCBpZFxuICAgKiBAcGFyYW0gdHJhbnNpdGlvbkFjdGlvblBhcmFtTmFtZSDnirbmgIHov4Hnp7vliqjkvZzlj4LmlbDnvJblj7dcbiAgICogQHJldHVybnMgXG4gICAqL1xuICBwdWJsaWMgb25Mb2FkaW5nKHRyYW5zaXRpb25BY3Rpb25QYXJhbU5hbWU6IHN0cmluZykge1xuICAgIGNvbnN0IHRhYklkID0gdGhpcy5ydW50aW1lRnJhbWV3b3JrU2VydmljZSAmJiB0aGlzLnJ1bnRpbWVGcmFtZXdvcmtTZXJ2aWNlLnRhYklkIHx8IG51bGw7XG4gICAgaWYgKCF0YWJJZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBsZXQgc2tpcCA9IHRydWU7XG4gICAgY29uc3QgbGlzdGVuaW5nID0gdGhpcy5mcmFtZUNvbnRleHQuYXBwQ29udGV4dC5wYXJhbXMuZ2V0KHRhYklkKSB8fCBmYWxzZTtcbiAgICB0cmFuc2l0aW9uQWN0aW9uUGFyYW1OYW1lID0gdHJhbnNpdGlvbkFjdGlvblBhcmFtTmFtZSB8fCAndHJhbnNpdGlvbkFjdGlvbic7XG4gICAgaWYgKCFsaXN0ZW5pbmcpIHtcbiAgICAgIHRoaXMuZnJhbWVDb250ZXh0LmFwcENvbnRleHQucGFyYW1zLnNldCh0YWJJZCwgdHJ1ZSk7XG4gICAgICB0aGlzLnJ1bnRpbWVGcmFtZXdvcmtTZXJ2aWNlLmdldEVudGl0eVBhcmFtKHRhYklkLCAob3B0aW9uczogYW55KSA9PiB7XG4gICAgICAgIGlmIChza2lwKSB7XG4gICAgICAgICAgc2tpcCA9IGZhbHNlO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBwYXJhbXMgPSB0aGlzLnBhcnNlUGFyYW1zKG9wdGlvbnMpO1xuICAgICAgICBpZiAocGFyYW1zICYmIHBhcmFtcy5zeW5jKSB7XG4gICAgICAgICAgY29uc3QgYWN0aW9uID0gcGFyYW1zLmFjdGlvbjtcbiAgICAgICAgICBjb25zdCBpZCA9IHBhcmFtcy5pZDtcbiAgICAgICAgICBjb25zdCBuZ0NvbW1hbmQgPSB0aGlzLmZyYW1lQ29udGV4dCAmJiB0aGlzLmZyYW1lQ29udGV4dC52aWV3TW9kZWwgJiYgdGhpcy5mcmFtZUNvbnRleHQudmlld01vZGVsLm1ldGFkYXRhcyAmJiB0aGlzLmZyYW1lQ29udGV4dC52aWV3TW9kZWwubWV0YWRhdGFzW2FjdGlvbl07XG4gICAgICAgICAgY29uc3QgYWN0aW9uTmFtZSA9IG5nQ29tbWFuZC5wYXJhbXMgJiYgbmdDb21tYW5kLnBhcmFtc1t0cmFuc2l0aW9uQWN0aW9uUGFyYW1OYW1lXSB8fCBudWxsO1xuICAgICAgICAgIGNvbnN0IGZvcm1QcmltYXJ5VmFsdWUgPSB0aGlzLmZyYW1lQ29udGV4dC5iaW5kaW5nRGF0YS5saXN0LmN1cnJlbnRJZDtcbiAgICAgICAgICBjb25zdCBmb3JtU3RhdGUgPSB0aGlzLmZyYW1lQ29udGV4dC5zdGF0ZU1hY2hpbmUuY29udGV4dC5zdGF0ZTtcbiAgICAgICAgICBsZXQgc3RhdGUgPSBudWxsO1xuICAgICAgICAgIGxldCBzdGF0ZU5hbWU6IHN0cmluZztcbiAgICAgICAgICBpZiAoIWFjdGlvbk5hbWUpIHtcbiAgICAgICAgICAgIC8vIOWPr+iDveaYr+eUqOaIt+iHquW3semFjee9rueahOWRveS7pO+8jOayoeacieeKtuaAgeacuuWIh+aNou+8jOatpOaXtuS4jeWGjeWIpOaWreeKtuaAgeaculxuICAgICAgICAgICAgc3RhdGUgPSBmb3JtU3RhdGU7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgbmdBY3Rpb24gPSB0aGlzLmZyYW1lQ29udGV4dCAmJiB0aGlzLmZyYW1lQ29udGV4dC5zdGF0ZU1hY2hpbmUgJiYgdGhpcy5mcmFtZUNvbnRleHQuc3RhdGVNYWNoaW5lLm1ldGFkYXRhcyAmJiB0aGlzLmZyYW1lQ29udGV4dC5zdGF0ZU1hY2hpbmUubWV0YWRhdGFzLmFjdGlvbnMgJiYgdGhpcy5mcmFtZUNvbnRleHQuc3RhdGVNYWNoaW5lLm1ldGFkYXRhcy5hY3Rpb25zW2FjdGlvbk5hbWVdO1xuICAgICAgICAgICAgc3RhdGUgPSBuZ0FjdGlvbiAmJiBuZ0FjdGlvbi50cmFuc2l0VG8gfHwgZm9ybVN0YXRlO1xuICAgICAgICAgICAgc3RhdGVOYW1lID0gdGhpcy5mcmFtZUNvbnRleHQgJiYgdGhpcy5mcmFtZUNvbnRleHQuc3RhdGVNYWNoaW5lICYmIHRoaXMuZnJhbWVDb250ZXh0LnN0YXRlTWFjaGluZS5tZXRhZGF0YXMgJiYgdGhpcy5mcmFtZUNvbnRleHQuc3RhdGVNYWNoaW5lLm1ldGFkYXRhcyAmJiB0aGlzLmZyYW1lQ29udGV4dC5zdGF0ZU1hY2hpbmUubWV0YWRhdGFzLnN0YXRlc1tzdGF0ZV0gJiYgdGhpcy5mcmFtZUNvbnRleHQuc3RhdGVNYWNoaW5lLm1ldGFkYXRhcy5zdGF0ZXNbc3RhdGVdLm5hbWUgfHwgdGhpcy5sYW5ndWFnZVNlcnZpY2UuZGVmYXVsdFN0YXRlTmFtZTtcbiAgICAgICAgICAgIGlmIChzdGF0ZU5hbWUgJiYgc3RhdGVOYW1lLnN0YXJ0c1dpdGgoJ3t7JykgJiYgc3RhdGVOYW1lLmVuZHNXaXRoKCd9fScpKSB7XG4gICAgICAgICAgICAgIGNvbnN0IGtleSA9IHN0YXRlTmFtZS5yZXBsYWNlKCd7eycsICcnKS5yZXBsYWNlKCd9fScsICcnKTtcbiAgICAgICAgICAgICAgc3RhdGVOYW1lID0gdGhpcy5mcmFtZUNvbnRleHQudHJhbnNsYXRlLnRyYW5zZm9ybShrZXksIG51bGwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCBwcmltYXJ5VmFsdWVDaGFuZ2VkID0gZm9ybVByaW1hcnlWYWx1ZSAhPT0gaWQ7XG4gICAgICAgICAgY29uc3Qgc3RhdGVDaGFuZ2VkID0gZm9ybVN0YXRlICE9PSBzdGF0ZTtcblxuICAgICAgICAgIGlmIChwcmltYXJ5VmFsdWVDaGFuZ2VkICYmIHN0YXRlQ2hhbmdlZCkge1xuICAgICAgICAgICAgLy8g5Z2H5Y+R55Sf5Y+Y5YyWXG4gICAgICAgICAgICBjb25zdCBtZXNzYWdlID0gdGhpcy5sYW5ndWFnZVNlcnZpY2UuZGF0YUFuZFN0YXRlQ2hhbmdlZC5yZXBsYWNlKC9cXCQxL2csIHN0YXRlTmFtZSk7XG4gICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nQ29uZmlybShtZXNzYWdlKS5waXBlKHN3aXRjaE1hcCgoKSA9PiB7XG4gICAgICAgICAgICAgIHJldHVybiB0aGlzLnJlc2V0Rm9ybShhY3Rpb24pO1xuICAgICAgICAgICAgfSkpLnN1YnNjcmliZSgpO1xuICAgICAgICAgIH0gZWxzZSBpZiAocHJpbWFyeVZhbHVlQ2hhbmdlZCkge1xuICAgICAgICAgICAgLy8g5Li76ZSu5Y+R55Sf5Y+Y5YyWXG4gICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nQ29uZmlybSh0aGlzLmxhbmd1YWdlU2VydmljZS5kYXRhQ2hhbmdlZCkucGlwZShzd2l0Y2hNYXAoKCkgPT4ge1xuICAgICAgICAgICAgICByZXR1cm4gdGhpcy5yZXNldEZvcm0oYWN0aW9uKTtcbiAgICAgICAgICAgIH0pKS5zdWJzY3JpYmUoKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKHN0YXRlQ2hhbmdlZCkge1xuICAgICAgICAgICAgLy8g54q25oCB5Y+R55Sf5Y+Y5YyWXG4gICAgICAgICAgICBjb25zdCBtZXNzYWdlID0gdGhpcy5sYW5ndWFnZVNlcnZpY2Uuc3RhdGVDaGFuZ2VkLnJlcGxhY2UoL1xcJDEvZywgc3RhdGVOYW1lKTtcbiAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmdDb25maXJtKG1lc3NhZ2UpLnBpcGUoc3dpdGNoTWFwKCgpID0+IHtcbiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVzZXRGb3JtKGFjdGlvbik7XG4gICAgICAgICAgICB9KSkuc3Vic2NyaWJlKCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIOaVsOaNruWPiueKtuaAgeWdh+acquWPkeeUn+WPmOWMllxuICAgICAgICAgICAgcmV0dXJuIG9mKHRydWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSwgZmFsc2UpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDmlrDlop5cbiAgICovXG4gIHB1YmxpYyBhZGQoKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICBjb25zdCBsYXN0TW9kaWZpZWRJZCA9IHRoaXMuYmluZGluZ0RhdGEubGlzdC5jdXJyZW50SWQ7XG5cbiAgICBjb25zdCBsb2FkaW5nVGltZXJJZCA9IHRoaXMubG9hZGluZ1NlcnZpY2Uuc2hvd0xvYWRpbmdXaXRoRGVsYXkoNTAwKTtcbiAgICBjb25zdCBjcmVhdGUkID0gdGhpcy5yZXBvc2l0b3J5LmNyZWF0ZSgpO1xuICAgIHJldHVybiBjcmVhdGUkLnBpcGUoXG4gICAgICB0YXAoXG4gICAgICAgICgpID0+IHtcbiAgICAgICAgICBFZGl0U3RhdGVVdGlsLnNldEVkaXRTdGF0ZSh0aGlzLmZyYW1lQ29udGV4dCwgbGFzdE1vZGlmaWVkSWQpO1xuICAgICAgICAgIHRoaXMubG9hZGluZ1NlcnZpY2UuaGlkZURlbGF5TG9hZGluZyhsb2FkaW5nVGltZXJJZCk7XG4gICAgICAgIH0sXG4gICAgICAgIChlcnJvcjogYW55KSA9PiB7XG4gICAgICAgICAgdGhpcy5sb2FkaW5nU2VydmljZS5oaWRlRGVsYXlMb2FkaW5nKGxvYWRpbmdUaW1lcklkKTtcbiAgICAgICAgICB0aGlzLmZvcm1FcnJvclNlcnZpY2UuZXhjZXB0aW9uKHRoaXMubGFuZ3VhZ2VTZXJ2aWNlLmFkZEZhaWxlZCwgZXJyb3IpO1xuICAgICAgICB9XG4gICAgICApXG4gICAgKTtcbiAgfVxuICAvKipcbiAgICog57qn6IGU5paw5aKeXG4gICAqL1xuICBwdWJsaWMgY2FzY2FkZUFkZCgpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgIGNvbnN0IHN1YmplY3QgPSBuZXcgU3ViamVjdDxhbnk+KCk7XG4gICAgLy8g5om+5Yiw5omA5pyJdmlld21vZGVsLOaLv+WIsOS6huaJgOacieeahGZyYW1lQ29udGV4dO+8jOWPr+iDveaciee7hOWQiOihqOWNleeahFxuICAgIGNvbnN0IGZyYW1lQ29udGV4dHMgPSB0aGlzLmZyYW1lQ29udGV4dC5hcHBDb250ZXh0LmZyYW1lQ29udGV4dE1hbmFnZXIuZ2V0RnJhbWVDb250ZXh0cygpO1xuICAgIC8vIOaJvuWIsOW9k+WJjWZyYW1lQ29udGV4dOeahOWFrOWFsW5hbWVzcGFjZVxuICAgIGNvbnN0IGN1cnJlbnROYW1lc3BhY2UgPSB0aGlzLmZyYW1lQ29udGV4dC5nZXRWaXJ0dWFsUm9vdEZyYW1lQ29udGV4dCgpLm5hbWVzcGFjZTtcbiAgICAvLyDmi7/liLDlvZPliY3lkb3ku6TmiYDlnKhmcmFtZeeahOihqOWNleeahOaJgOaciWZyYW1lQ29udGV4dFxuICAgIGNvbnN0IGN1cnJlbnRGb3JtRnJhbWVDb250ZXh0cyA9IGZyYW1lQ29udGV4dHMuZmlsdGVyKChjb250ZXh0OiBGcmFtZUNvbnRleHQpID0+IGNvbnRleHQubmFtZXNwYWNlID09PSBjdXJyZW50TmFtZXNwYWNlKSB8fCBbXTtcbiAgICBsZXQgYmluZGluZ1BhdGhzID0gW107XG4gICAgaWYgKGN1cnJlbnRGb3JtRnJhbWVDb250ZXh0cyAmJiBjdXJyZW50Rm9ybUZyYW1lQ29udGV4dHMubGVuZ3RoID4gMCkge1xuICAgICAgLy8g5om+5Yiw5omA5pyJ5LiL57qnZnJhbWVDb250ZXh0XG4gICAgICBjb25zdCBjaGlsZEZyYW1lQ29udGV4dHMgPSBjdXJyZW50Rm9ybUZyYW1lQ29udGV4dHMuZmlsdGVyKChjb250ZXh0OiBGcmFtZUNvbnRleHQpID0+IGNvbnRleHQudmlld01vZGVsLmJpbmRpbmdQYXRoICYmIGNvbnRleHQudmlld01vZGVsLmJpbmRpbmdQYXRoICE9PSAnLycpO1xuICAgICAgaWYgKGNoaWxkRnJhbWVDb250ZXh0cyAmJiBjaGlsZEZyYW1lQ29udGV4dHMubGVuZ3RoID4gMCkge1xuICAgICAgICBjb25zdCBjaGlsZEJpbmRpbmdQYXRocyA9IGNoaWxkRnJhbWVDb250ZXh0cy5tYXAoKGNvbnRleHQ6IEZyYW1lQ29udGV4dCkgPT4gY29udGV4dC52aWV3TW9kZWwuYmluZGluZ1BhdGgpO1xuICAgICAgICBpZiAoY2hpbGRCaW5kaW5nUGF0aHMgJiYgY2hpbGRCaW5kaW5nUGF0aHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIGJpbmRpbmdQYXRocyA9IGNoaWxkQmluZGluZ1BhdGhzLm1hcChwYXRoID0+IHBhdGguc3BsaXQoJy8nKS5maWx0ZXIocCA9PiBwKSkuc29ydCgoYSwgYikgPT4gYS5sZW5ndGggLSBiLmxlbmd0aCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5sb2FkaW5nU2VydmljZS5zaG93KCk7XG4gICAgdGhpcy5yZXBvc2l0b3J5LmNyZWF0ZSgpLnBpcGUoXG4gICAgICBzd2l0Y2hNYXAoKGVudGl0eTogRW50aXR5KSA9PiB7XG4gICAgICAgIGNvbnN0IHJpZCA9IGVudGl0eS5wcmltYXJ5VmFsdWU7XG4gICAgICAgIGlmIChiaW5kaW5nUGF0aHMgJiYgYmluZGluZ1BhdGhzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICByZXR1cm4gZnJvbShiaW5kaW5nUGF0aHMpLnBpcGUoXG4gICAgICAgICAgICBjb25jYXRNYXAoKGJpbmRpbmdQYXRoOiBBcnJheTxhbnk+KSA9PiB7XG4gICAgICAgICAgICAgIGNvbnN0IGZwYXRoID0gdGhpcy5nZXRQYXRoKHRoaXMuZnJhbWVDb250ZXh0LnZpZXdNb2RlbCwgJy8nICsgYmluZGluZ1BhdGguam9pbignLycpLCByaWQpO1xuICAgICAgICAgICAgICByZXR1cm4gdGhpcy5yZXBvc2l0b3J5LmFwcGVuZEJ5UGF0aChmcGF0aCk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIG9mKGVudGl0eSk7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgKS5waXBlKGxhc3QoKSkuc3Vic2NyaWJlKFxuICAgICAgKCkgPT4ge1xuICAgICAgICB0aGlzLmxvYWRpbmdTZXJ2aWNlLmhpZGUoKTtcbiAgICAgICAgc3ViamVjdC5uZXh0KCk7XG4gICAgICB9LFxuICAgICAgKGVycm9yOiBhbnkpID0+IHtcbiAgICAgICAgdGhpcy5sb2FkaW5nU2VydmljZS5oaWRlKCk7XG4gICAgICAgIHRoaXMuZm9ybUVycm9yU2VydmljZS5leGNlcHRpb24odGhpcy5sYW5ndWFnZVNlcnZpY2UuYWRkRmFpbGVkLCBlcnJvcik7XG4gICAgICB9KTtcbiAgICByZXR1cm4gc3ViamVjdDtcbiAgfVxuXG4gIC8qKlxuICAgKiDnvJbovpHvvIjmm7TmlrDmlbDmja7lubbmoIforrDnvJbovpHnirbmgIHvvIlcbiAgICovXG4gIHB1YmxpYyBlZGl0KGlkPzogc3RyaW5nKTogT2JzZXJ2YWJsZTxFbnRpdHk+IHtcbiAgICBjb25zdCB1cGRhdGUkID0gdGhpcy51cGRhdGUoKTtcbiAgICByZXR1cm4gdXBkYXRlJC5waXBlKFxuICAgICAgdGFwKCgpID0+IHtcbiAgICAgICAgY29uc3QgY3VycmVudElkID0gdGhpcy5iaW5kaW5nRGF0YS5saXN0LmN1cnJlbnRJZFxuICAgICAgICBFZGl0U3RhdGVVdGlsLnNldEVkaXRTdGF0ZSh0aGlzLmZyYW1lQ29udGV4dCwgY3VycmVudElkKTtcbiAgICAgIH0pXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDmm7TmlrBcbiAgICogQHBhcmFtIGlkIOS4u+WunuS9k2lkXG4gICAqIEBwYXJhbSBlbmFibGVDaGlsZHJlblBhZ2luYXRpb24g5ZCv55So5a2Q6KGo5YiG6aG1XG4gICAqL1xuICBwdWJsaWMgdXBkYXRlKGlkPzogc3RyaW5nKTogT2JzZXJ2YWJsZTxFbnRpdHk+IHtcbiAgICAvLyDojrflj5ZpZFxuICAgIGlkID0gdGhpcy5iaW5kaW5nRGF0YS5saXN0LmN1cnJlbnRJZCBhcyBzdHJpbmc7XG4gICAgaWYgKCFpZCkge1xuICAgICAgcmV0dXJuIGVtcHR5KCk7XG4gICAgfVxuICAgIGNvbnN0IGxvYWRpbmdUaW1lcklkID0gdGhpcy5sb2FkaW5nU2VydmljZS5zaG93TG9hZGluZ1dpdGhEZWxheSg1MDApO1xuICAgIGNvbnN0IHVwZGF0ZSQgPSB0aGlzLnJlcG9zaXRvcnkudXBkYXRlQnlJZChpZCk7XG4gICAgdGhpcy5mcmFtZUNvbnRleHQuYXBwQ29udGV4dC5wYXJhbXMuc2V0KFwicmV0cmlldmVpbmdcIiwgdHJ1ZSk7XG4gICAgcmV0dXJuIHVwZGF0ZSQucGlwZShcbiAgICAgIHRhcCgoKSA9PiB7XG4gICAgICAgIHRoaXMubG9hZGluZ1NlcnZpY2UuaGlkZURlbGF5TG9hZGluZyhsb2FkaW5nVGltZXJJZCk7XG4gICAgICB9LFxuICAgICAgICBlcnJvciA9PiB7XG4gICAgICAgICAgdGhpcy5sb2FkaW5nU2VydmljZS5oaWRlRGVsYXlMb2FkaW5nKGxvYWRpbmdUaW1lcklkKTtcbiAgICAgICAgICB0aGlzLmZvcm1FcnJvclNlcnZpY2UuZXhjZXB0aW9uKHRoaXMubGFuZ3VhZ2VTZXJ2aWNlLnVwZGF0ZUZhaWxlZCwgZXJyb3IpO1xuICAgICAgICB9XG4gICAgICApXG4gICAgKTtcbiAgfVxuICBwdWJsaWMgdXBkYXRlV2l0aG91dEVtcHR5KCkge1xuICAgIC8vIOiOt+WPlmlkXG4gICAgY29uc3QgaWQgPSB0aGlzLmJpbmRpbmdEYXRhLmxpc3QuY3VycmVudElkIGFzIHN0cmluZztcbiAgICBpZiAoIWlkKSB7XG4gICAgICByZXR1cm4gb2YobnVsbCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB0aGlzLnVwZGF0ZSgpO1xuICAgIH1cbiAgfVxuICAvKipcbiAgICog5qCh6aqM5b2T5YmN6KGM5piv5ZCm5a2Y5ZyoXG4gICAqIEByZXR1cm5zIFxuICAgKi9cbiAgcHVibGljIGNoZWNrQmVmb3JlVXBkYXRlKCk6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xuICAgIGNvbnN0IGJpbmRpbmdMaXN0ID0gdGhpcy5mcmFtZUNvbnRleHQuYmluZGluZ0RhdGEubGlzdDtcbiAgICBjb25zdCBpZCA9IGJpbmRpbmdMaXN0ICYmIGJpbmRpbmdMaXN0LmN1cnJlbnRJZDtcbiAgICBpZiAoIWlkKSB7XG4gICAgICB0aGlzLmZvcm1Ob3RpZnlTZXJ2aWNlLndhcm5pbmcodGhpcy5sYW5ndWFnZVNlcnZpY2Uubm9EYXRhRXhpc3QsIHsgaGlkZVRpdGxlOiB0cnVlIH0pO1xuICAgICAgcmV0dXJuIEVNUFRZO1xuICAgIH1cbiAgICByZXR1cm4gb2YodHJ1ZSk7XG4gIH1cbiAgLyoqXG4gICAqIOW3suW6n+W8g1xuICAgKiBAcmV0dXJucyBcbiAgICovXG4gIHB1YmxpYyB1cGRhdGVXaXRoTm90aWZ5KCkge1xuICAgIC8vIOiOt+WPlmlkXG4gICAgY29uc3QgaWQgPSB0aGlzLmJpbmRpbmdEYXRhLmxpc3QuY3VycmVudElkIGFzIHN0cmluZztcbiAgICBpZiAoIWlkKSB7XG4gICAgICB0aGlzLmZvcm1Ob3RpZnlTZXJ2aWNlLndhcm5pbmcodGhpcy5sYW5ndWFnZVNlcnZpY2Uubm9EYXRhRXhpc3QsIHsgaGlkZVRpdGxlOiB0cnVlIH0pO1xuICAgICAgcmV0dXJuIEVNUFRZO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdGhpcy51cGRhdGUoKTtcbiAgICB9XG4gIH1cbiAgLyoqXG4gICAqIOWKoOi9veWNoeeJh+aVsOaNru+8iOWIhumhteWKoOi9veWtkOihqOaVsOaNru+8iVxuICAgKiBAZGVwcmVjYXRlZCDmlrnms5Xlt7Llup/lvIPvvIzor7fli7/kvb/nlKhcbiAgICovXG4gIHB1YmxpYyBsb2FkUGFnZWQoZmlsdGVyPzogc3RyaW5nLCBzb3J0Pzogc3RyaW5nKSB7XG4gICAgLy8g6I635Y+WaWRcbiAgICBjb25zdCBpZCA9IHRoaXMuYmluZGluZ0RhdGEubGlzdC5jdXJyZW50SWQgYXMgc3RyaW5nO1xuICAgIGlmICghaWQpIHtcbiAgICAgIHJldHVybiBFTVBUWTtcbiAgICB9XG5cbiAgICBjb25zdCBsb2FkaW5nVGltZXJJZCA9IHRoaXMubG9hZGluZ1NlcnZpY2Uuc2hvd0xvYWRpbmdXaXRoRGVsYXkoNTAwKTtcbiAgICAvLyB0aGlzLmZyYW1lQ29udGV4dC5yb290LnBhcmFtcy5zZXQoJ3VwZGF0ZVdpdGhQYWdpbmcnLCB0cnVlKTtcbiAgICBjb25zdCB1cGRhdGUkID0gb2YobnVsbCk7Ly90aGlzLnJlcG9zaXRvcnkudXBkYXRlRW50aXR5QnlJZChpZCwgdHJ1ZSk7XG4gICAgcmV0dXJuIHVwZGF0ZSQucGlwZShcbiAgICAgIHRhcCgoKSA9PiB7XG4gICAgICAgIHRoaXMubG9hZGluZ1NlcnZpY2UuaGlkZURlbGF5TG9hZGluZyhsb2FkaW5nVGltZXJJZCk7XG4gICAgICB9LFxuICAgICAgICBlcnJvciA9PiB7XG4gICAgICAgICAgdGhpcy5sb2FkaW5nU2VydmljZS5oaWRlRGVsYXlMb2FkaW5nKGxvYWRpbmdUaW1lcklkKTtcbiAgICAgICAgICB0aGlzLmZvcm1FcnJvclNlcnZpY2UuZXhjZXB0aW9uKHRoaXMubGFuZ3VhZ2VTZXJ2aWNlLnVwZGF0ZUZhaWxlZCwgZXJyb3IpO1xuICAgICAgICB9XG4gICAgICApXG4gICAgKTtcbiAgfVxuICAvKipcbiAgICog5L+d5a2YXG4gICAqL1xuICBwdWJsaWMgc2F2ZShzdWNjZXNzTXNnPzogc3RyaW5nKTogT2JzZXJ2YWJsZTxib29sZWFuPiB7XG4gICAgLy8g6I635Y+W5b2T5YmN6KGMXG4gICAgY29uc3QgaWQgPSB0aGlzLmJpbmRpbmdEYXRhLmxpc3QuY3VycmVudElkIGFzIHN0cmluZztcbiAgICBpZiAoIWlkKSB7XG4gICAgICByZXR1cm4gb2YoZmFsc2UpO1xuICAgIH1cblxuICAgIGNvbnN0IGxvYWRpbmdUaW1lcklkID0gdGhpcy5sb2FkaW5nU2VydmljZS5zaG93TG9hZGluZ1dpdGhEZWxheSg1MDApO1xuICAgIGNvbnN0IHVwZGF0ZSQgPSB0aGlzLnJlcG9zaXRvcnkudXBkYXRlQ2hhbmdlc0J5SWQoaWQpO1xuICAgIGNvbnN0IHNhdmUkID0gdGhpcy5yZXBvc2l0b3J5LmFwcGx5Q2hhbmdlc0J5SWQoaWQpO1xuICAgIGNvbnN0IHJlc3VsdCQgPSB1cGRhdGUkLnBpcGUoXG5cbiAgICAgIC8vIHVwZGF0ZSQgPT4gc2F2ZSRcbiAgICAgIHN3aXRjaE1hcCgodXBkYXRlUmVzdWx0OiBib29sZWFuKSA9PiB7XG4gICAgICAgIGlmICh1cGRhdGVSZXN1bHQgPT09IGZhbHNlKSB7XG4gICAgICAgICAgcmV0dXJuIG9mKGZhbHNlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gc2F2ZSQ7XG4gICAgICAgIH1cbiAgICAgIH0pLFxuXG4gICAgICAvLyDpmpDol49sb2FkaW5nXG4gICAgICB0YXAoKCkgPT4ge1xuXG4gICAgICAgIC8vIOWPlua2iOaWsOWinueKtuaAgVxuICAgICAgICBFZGl0U3RhdGVVdGlsLnNldEVkaXRTdGF0ZSh0aGlzLmZyYW1lQ29udGV4dCwgaWQpO1xuICAgICAgICB0aGlzLmxvYWRpbmdTZXJ2aWNlLmhpZGVEZWxheUxvYWRpbmcobG9hZGluZ1RpbWVySWQpO1xuICAgICAgICAvLyB0aGlzLmZvcm1Ob3RpZnlTZXJ2aWNlLmluZm8odGhpcy5sYW5ndWFnZVNlcnZpY2Uuc2F2ZVN1Y2Nlc3MpO1xuICAgICAgICBpZiAoc3VjY2Vzc01zZyAmJiBzdWNjZXNzTXNnLnRyaW0oKSkge1xuICAgICAgICAgIGxldCBzaG93TWVzc2FnZTogYm9vbGVhbiA9IHRydWU7XG4gICAgICAgICAgaWYgKHN1Y2Nlc3NNc2cuc3RhcnRzV2l0aCgneycpICYmIHN1Y2Nlc3NNc2cuZW5kc1dpdGgoJ30nKSkge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgY29uc3Qgb3B0aW9ucyA9IEpTT04ucGFyc2Uoc3VjY2Vzc01zZyk7XG4gICAgICAgICAgICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMuc2hvd01lc3NhZ2UgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgc2hvd01lc3NhZ2UgPSBmYWxzZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBjYXRjaCB7IH1cbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHNob3dNZXNzYWdlICE9PSBmYWxzZSkge1xuICAgICAgICAgICAgdGhpcy5mb3JtTm90aWZ5U2VydmljZS5zdWNjZXNzKHN1Y2Nlc3NNc2csIHsgaGlkZVRpdGxlOiB0cnVlIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBGb3JtTm90aWZ5U3RyYXRlZ3lTZXJ2aWNlLnN1Y2Nlc3ModGhpcy5mb3JtTm90aWZ5U2VydmljZSwgdGhpcy5sYW5ndWFnZVNlcnZpY2Uuc2F2ZVN1Y2Nlc3MpO1xuICAgICAgICB9XG4gICAgICAgIC8vIEZvcm1Ob3RpZnlTdHJhdGVneVNlcnZpY2Uuc3VjY2Vzcyh0aGlzLmZvcm1Ob3RpZnlTZXJ2aWNlLCB0aGlzLmxhbmd1YWdlU2VydmljZS5zYXZlU3VjY2Vzcyk7XG4gICAgICB9LFxuICAgICAgICBlcnJvciA9PiB7XG4gICAgICAgICAgdGhpcy5sb2FkaW5nU2VydmljZS5oaWRlRGVsYXlMb2FkaW5nKGxvYWRpbmdUaW1lcklkKTtcbiAgICAgICAgICB0aGlzLmZvcm1FcnJvclNlcnZpY2UuZXhjZXB0aW9uKHRoaXMubGFuZ3VhZ2VTZXJ2aWNlLnNhdmVGYWlsZWQsIGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgKVxuICAgICk7XG5cbiAgICByZXR1cm4gcmVzdWx0JDtcbiAgfVxuXG5cbiAgLy8gI3JlZ2lvbiDlj5bmtojnm7jlhbPmlrnms5VcblxuICAvKipcbiAgICog5Y+W5raI77yI6buY6K6k5Y+W5raI77yJXG4gICAqL1xuICBwdWJsaWMgY2FuY2VsKCk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgcmV0dXJuIHRoaXMuY2FuY2VsV2l0aENoZWNrKCk7XG4gIH1cblxuICAvKipcbiAgICog6L+Y5Y6f5Y+Y5pu06ZuGXG4gICAqIEBkZXNjcmlwdGlvbiDkuI3luKblj5jmm7Tmo4DmtYvmj5DnpLpcbiAgICovXG4gIHB1YmxpYyByZXZlcnQob3B0aW9ucz86IGFueSk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgcmV0dXJuIHRoaXMuY2FuY2VsV2l0aG91dENoZWNrKG9wdGlvbnMpO1xuICB9XG5cbiAgLyoqXG4gICAqIOWPlua2iO+8iOWPlua2iOWJjeajgOafpeacquS/neWtmOeahOWPmOabtO+8iVxuICAgKiBAc3VtbWFyeVxuICAgKiAx44CB55So5oi36K+v5pON5L2c77ya5Y+q6ZyA6KaB5YGa5Liq5o+Q56S65bCx5Y+v5Lul5LqG77ybXG4gICAqIDLjgIHnlKjmiLfmnInmhI/lj5bmtojvvJrngrnlh7vlj5bmtojlsLHmmK/opoHmlL7lvIPmiYDmnInlj5jmm7TvvIzov5nml7blgJnor6Lpl67kurrlrrbmmK/lkKbopoHkv53lrZjmiJbogIXmj5DnpLrlrZjlnKjlj5jmm7TmnInngrnlpJrmraTkuIDkuL7vvIznoa7orqTkuIDmiorljbPlj6/jgIJcbiAgICogM+OAgeeUqOaIt+ivr+aTjeS9nO+8muayoeacieWPmOabtOeahOaDheWGteS4i+ebtOaOpee7meWPlua2iOS6hu+8jOeUqOaIt+S8muS6p+eUn+aBkOaFjO+8jOWboOS4uueUqOaIt+acieaXtuWAmeW5tuS4jeehruWumuaYr+WQpuacieWPmOabtO+8jOW6lOivpeS5n+ehruiupOS4gOaKiuOAglxuICAgKiBAdG9kb1xuICAgKiAx44CB55Sx5LqO5Lqn5ZOB6YOo5b6I5aSa5Luj56CB6K+v55So5LqG6K+l5pa55rOV77yM5L6d6LWW5LqG5rKh5pyJ5Y+Y5pu055qE5pe25YCZ55u05o6l5Y+W5raI77yM546w5Zyo5by556qX56Gu6K6k5qGG5p2l77yM5LiN5aSq5ZCI6YCC77ybXG4gICAqIDLjgIHkuqflk4Hpg6jpnIDopoHnlKhjYW5jZWxXaXRob3V0Q2hlY2vmlrnms5Xku6Pmm7/vvIznm67liY3lhYjnu5nlhbzlrrnnnYDvvIzlvoXliKDpmaTjgIJcbiAgICovXG4gIHB1YmxpYyBjYW5jZWxXaXRoQ2hlY2soKSB7XG5cbiAgICAvLyBAdG9kZWxcbiAgICBjb25zdCBoYXNVblNhdmVkQ2hhbmdlcyA9IEJlZlJlcG9zaXRvcnlVdGlsLmlzRXhpc3RVbnNhdmVEYXRhKHRoaXMucmVwb3NpdG9yeSk7XG4gICAgaWYgKCFoYXNVblNhdmVkQ2hhbmdlcykge1xuICAgICAgcmV0dXJuIHRoaXMuY2FuY2VsQ2hhbmdlcygpO1xuICAgIH1cblxuICAgIC8vIOehruiupOaYr+WQpuWPlua2iFxuICAgIGNvbnN0IGNvbmZpcm0kID0gdGhpcy5mb3JtTWVzc2FnZVNlcnZpY2UucXVlc3Rpb24odGhpcy5sYW5ndWFnZVNlcnZpY2VbJ2NhbmNlbFdpdGhvdXRTYXZlJ10pO1xuICAgIGNvbnN0IHJlc3VsdCQgPSBjb25maXJtJC5waXBlKFxuICAgICAgc3dpdGNoTWFwKChpZkNhbmNlbDogYm9vbGVhbikgPT4ge1xuICAgICAgICBpZiAoaWZDYW5jZWwgPT09IGZhbHNlKSB7XG4gICAgICAgICAgcmV0dXJuIEVNUFRZO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLmNhbmNlbENoYW5nZXMoKTtcbiAgICAgIH0pXG4gICAgKTtcblxuICAgIHJldHVybiByZXN1bHQkO1xuICB9XG5cbiAgLyoqXG4gICAqIOWPlua2iO+8iOebtOaOpeWPlua2iO+8jOS4jeaJp+ihjOajgOafpe+8iVxuICAgKi9cbiAgcHVibGljIGNhbmNlbFdpdGhvdXRDaGVjayhvcHRpb25zPzogYW55KSB7XG4gICAgcmV0dXJuIHRoaXMuY2FuY2VsQ2hhbmdlcyhvcHRpb25zKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDlj5bmtohcbiAgICovXG4gIHByaXZhdGUgY2FuY2VsQ2hhbmdlcyhvcHRpb25zPzogYW55KTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICBjb25zdCBsb2FkaW5nVGltZXJJZCA9IHRoaXMubG9hZGluZ1NlcnZpY2Uuc2hvd0xvYWRpbmdXaXRoRGVsYXkoNTAwKTtcbiAgICBjb25zdCBjYW5jZWwkID0gdGhpcy5yZXBvc2l0b3J5LmNhbmNlbENoYW5nZXMob3B0aW9ucyk7XG4gICAgcmV0dXJuIGNhbmNlbCQucGlwZShcbiAgICAgIHRhcChcbiAgICAgICAgKCkgPT4ge1xuICAgICAgICAgIEVkaXRTdGF0ZVV0aWwuc2V0RWRpdFN0YXRlKHRoaXMuZnJhbWVDb250ZXh0LCAnJyk7XG4gICAgICAgICAgdGhpcy5sb2FkaW5nU2VydmljZS5oaWRlRGVsYXlMb2FkaW5nKGxvYWRpbmdUaW1lcklkKTtcbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3IgPT4ge1xuICAgICAgICAgIHRoaXMubG9hZGluZ1NlcnZpY2UuaGlkZURlbGF5TG9hZGluZyhsb2FkaW5nVGltZXJJZCk7XG4gICAgICAgICAgdGhpcy5mb3JtRXJyb3JTZXJ2aWNlLmV4Y2VwdGlvbih0aGlzLmxhbmd1YWdlU2VydmljZS5jYW5jZWxGYWlsZWQsIGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgKVxuICAgICk7XG4gIH1cblxuICAvLyAjZW5kcmVnaW9uXG5cblxuICAvKipcbiAgICog6YeN5paw5Yqg6L2977yI5LuF5L6b5Y2h54mH5Y+W5raI5ZCO6YeN5paw5Yqg6L295pWw5o2u77yM5YW25LuW5Zy65pmv6K+35Yu/5L2/55So77yJXG4gICAqL1xuICBwdWJsaWMgcmVsb2FkKCkge1xuICAgIGNvbnN0IGlzQWRkID0gRWRpdFN0YXRlVXRpbC5nZXRBZGRTdGF0ZSh0aGlzLmZyYW1lQ29udGV4dCk7XG4gICAgbGV0IGlkO1xuICAgIGlmIChpc0FkZCA9PT0gdHJ1ZSkge1xuICAgICAgaWQgPSBFZGl0U3RhdGVVdGlsLmdldExhc3RNb2RpZmllZElkKHRoaXMuZnJhbWVDb250ZXh0KTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWQgPSB0aGlzLmJpbmRpbmdEYXRhLmxpc3QuY3VycmVudElkIGFzIHN0cmluZztcbiAgICB9XG5cbiAgICBpZiAoIWlkKSB7XG4gICAgICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5sb2FkRW50aXRpZXMoW10pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmxvYWQoaWQpO1xuICB9XG4gIHByaXZhdGUgZ2V0UGF0aCh2aWV3TW9kZWw6IFZpZXdNb2RlbCwgYmluZGluZ1BhdGg6IHN0cmluZywgcmlkOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGxldCBwYXRoID0gJy8nICsgcmlkO1xuXG4gICAgY29uc3Qgc3ViUGF0aHMgPSBiaW5kaW5nUGF0aC5zcGxpdCgnLycpO1xuICAgIGlmIChzdWJQYXRocy5sZW5ndGggPiAwKSB7XG4gICAgICAvLyBlZzpiaW5kaW5nUGF0aOW9ouWmgi9lZHVzL2dyYWRlcyxzcGxpdOWQjuaYr1snJywgJ2VkdXMnLCAnZ3JhZGVzJ11cbiAgICAgIC8vIOWboOatpGluZGV45LuOMeW8gOWni1xuICAgICAgZm9yIChsZXQgaW5kZXggPSAxOyBpbmRleCA8IHN1YlBhdGhzLmxlbmd0aCAtIDE7IGluZGV4KyspIHtcbiAgICAgICAgY29uc3Qgc3ViUGF0aCA9IHN1YlBhdGhzW2luZGV4XTtcbiAgICAgICAgY29uc3Qgc3ViRGF0YSA9IHZpZXdNb2RlbC5iaW5kaW5nRGF0YVtzdWJQYXRoXTtcbiAgICAgICAgaWYgKCFzdWJEYXRhIHx8ICFzdWJEYXRhLmN1cnJlbnRJZCkge1xuICAgICAgICAgIHRocm93IEVycm9yKGDojrflj5blrZDooajlrozmlbTot6/lvoTlh7rplJnvvIzmib7kuI3liLAke3N1YkRhdGF95a+55bqU55qE5a2Q6KGo77yM5oiW5a+55bqU5a2Q6KGo5rKh5pyJ5b2T5YmN6KGM44CCYCk7XG4gICAgICAgIH1cbiAgICAgICAgcGF0aCArPSBgLyR7c3ViUGF0aH0vJHtzdWJEYXRhLmN1cnJlbnRJZH1gO1xuICAgICAgfVxuICAgIH1cbiAgICBwYXRoICs9ICcvJyArIHN1YlBhdGhzW3N1YlBhdGhzLmxlbmd0aCAtIDFdO1xuXG4gICAgcmV0dXJuIHBhdGg7XG4gIH1cbiAgcHJpdmF0ZSByZXNldEZvcm0oYWN0aW9uOiBzdHJpbmcpIHtcbiAgICBjb25zdCB2YWxpZGF0aW9uU2VydmljZSA9IHRoaXMuZnJhbWVDb250ZXh0LmluamVjdG9yLmdldDxWYWxpZGF0aW9uU2VydmljZT4oVmFsaWRhdGlvblNlcnZpY2UsIG51bGwpO1xuICAgIHJldHVybiB0aGlzLmZyYW1lQ29udGV4dC5yZXBvc2l0b3J5LmNhbmNlbENoYW5nZXMoKS5waXBlKFxuICAgICAgc3dpdGNoTWFwKCgpID0+IHRoaXMuY29tbWFuZFNlcnZpY2UuZXhlY3V0ZShhY3Rpb24pLnBpcGUoc3dpdGNoTWFwKCgpID0+IHtcbiAgICAgICAgcmV0dXJuIHZhbGlkYXRpb25TZXJ2aWNlICYmIHZhbGlkYXRpb25TZXJ2aWNlLnJlc2V0VmFsaWRhdGlvbigpIHx8IG9mKG51bGwpO1xuICAgICAgfSkpKSk7XG4gIH1cbiAgcHJpdmF0ZSBwYXJzZVBhcmFtcyhvcHRpb25zOiBhbnkpOiB7IGFjdGlvbjogc3RyaW5nLCBpZDogc3RyaW5nLCBzeW5jOiBib29sZWFuIH0gfCBudWxsIHtcbiAgICBpZiAob3B0aW9ucyAmJiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwob3B0aW9ucykgPT09IERhdGFUeXBlLm1hcCkge1xuICAgICAgbGV0IHBhcmFtcyA9IG9wdGlvbnMuZ2V0KFdFQl9GT1JNX1JPVVRFX1BBUkFNU19LRVkpO1xuICAgICAgaWYgKHBhcmFtcyAmJiB0eXBlb2YgcGFyYW1zID09PSAnc3RyaW5nJykge1xuICAgICAgICBwYXJhbXMgPSBkZWNvZGVVUklDb21wb25lbnQocGFyYW1zKTtcbiAgICAgICAgaWYgKHBhcmFtcy5zdGFydHNXaXRoKCd7JykgJiYgcGFyYW1zLmVuZHNXaXRoKCd9JykpIHtcbiAgICAgICAgICBwYXJhbXMgPSBKU09OLnBhcnNlKHBhcmFtcyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBhY3Rpb246IHBhcmFtcy5hY3Rpb24sXG4gICAgICAgICAgaWQ6IHBhcmFtcy5pZFRvVmlldyB8fCBwYXJhbXMuaWRUb0VkaXQgfHwgcGFyYW1zLmlkLFxuICAgICAgICAgIHN5bmM6IHBhcmFtcy5zeW5jIHx8IGZhbHNlXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG4gIHByaXZhdGUgc2hvd0xvYWRpbmdDb25maXJtKG1lc3NhZ2U6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLmZvcm1NZXNzYWdlU2VydmljZS5jb25maXJtKG1lc3NhZ2UpLnBpcGUoXG4gICAgICBzd2l0Y2hNYXAoKHJlc3VsdDogYm9vbGVhbikgPT4ge1xuICAgICAgICBpZiAocmVzdWx0ID09PSB0cnVlKSB7XG4gICAgICAgICAgcmV0dXJuIG9mKHRydWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBFTVBUWTtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICApO1xuICB9XG59XG5leHBvcnQgeyBDYXJkRGF0YVNlcnZpY2UgfTtcbiJdfQ==