/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Subject, BehaviorSubject } from 'rxjs';
/*
 * @Author: 疯狂秀才(Lucas Huang)
 * @LastEditors: 疯狂秀才(Lucas Huang)
 * @Company: Inspur
 * @Version: v0.1.8
 * @Date: 2018-09-18 16:04:05
 * @LastEditTime: 2019-10-17 13:42:45
 */
import { Component, ElementRef, ViewChild, Renderer2, Output, EventEmitter, Input } from '@angular/core';
import { LOADING_STYLES } from './loading.styles';
import { delay, filter, takeUntil } from 'rxjs/operators';
var LoadingComponent = /** @class */ (function () {
    function LoadingComponent(render, el) {
        this.render = render;
        this.el = el;
        this.showMessage = true;
        this.loadingStyleDom = LOADING_STYLES;
        this._isActive = false;
        this.activeSubject = new BehaviorSubject(false);
        this.message = '';
        this.width = 30;
        /**
         * loading 样式
         */
        this.type = 0;
        this.delay = 300;
        this.closed = new EventEmitter();
        this.activedSubscrition = null;
        this.destroy$ = new Subject();
    }
    Object.defineProperty(LoadingComponent.prototype, "isActive", {
        get: /**
         * @return {?}
         */
        function () {
            return this._isActive;
        },
        set: /**
         * @param {?} val
         * @return {?}
         */
        function (val) {
            this._isActive = val;
            if (this.activeSubject) {
                this.activeSubject.next(val);
            }
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    LoadingComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this_1 = this;
        this.activedSubscrition = this.activeSubject.pipe(takeUntil(this.destroy$)).pipe(filter((/**
         * @param {?} n
         * @return {?}
         */
        function (n) {
            return n;
        })), delay(this.delay)).subscribe((/**
         * @param {?} v
         * @return {?}
         */
        function (v) {
            if (v && _this_1.isActive) {
                // this.animate('f-component-loading fadeIn animated');
                _this_1.render.setStyle(_this_1.loadingContainerEl.nativeElement, 'display', 'block');
                _this_1.render.setStyle(_this_1.loadingBackdrop.nativeElement, 'display', 'block');
                _this_1.setPosition();
            }
        }));
    };
    /**
     * @return {?}
     */
    LoadingComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @return {?}
     */
    LoadingComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.destroy$.next();
        this.destroy$.complete();
        // this.activeSubject.complete();
        // this.activeSubject = null;
        // this.activedSubscrition.unsubscribe();
    };
    /**
     * @return {?}
     */
    LoadingComponent.prototype.close = /**
     * @return {?}
     */
    function () {
        // if (this.loadingBackdrop.nativeElement.parentElement) {
        //     this.render.removeChild(this.el.nativeElement, this.loadingBackdrop.nativeElement);
        // }
        // const waitEle = document.body.querySelector('.farris-loading-backdrop');
        if (this.loadingBackdrop) {
            this.loadingBackdrop.nativeElement.remove();
        }
        this.isActive = false;
        this.render.removeAttribute(this.el.nativeElement, 'class');
        // this.animate('f-component-loading fadeOut animated animated-0.5');
        this.closed.emit(this.isActive);
    };
    /**
     * @private
     * @return {?}
     */
    LoadingComponent.prototype.setPosition = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var containerWidth = this.loadingContainerEl.nativeElement.clientWidth;
        /** @type {?} */
        var containerHeight = this.loadingContainerEl.nativeElement.clientHeight;
        this.render.setStyle(this.loadingContainerEl.nativeElement, 'marginTop', -containerHeight / 2 + 'px');
        this.render.setStyle(this.loadingContainerEl.nativeElement, 'marginLeft', -containerWidth / 2 + 'px');
    };
    /**
     * @private
     * @param {?} animateCls
     * @return {?}
     */
    LoadingComponent.prototype.animate = /**
     * @private
     * @param {?} animateCls
     * @return {?}
     */
    function (animateCls) {
        this.addAnimationEndEvent('webkitAnimationEnd', 'mozAnimationEnd', 'MSAnimationEnd', 'oanimationend', 'animationend');
        this.render.setAttribute(this.el.nativeElement, 'class', animateCls);
    };
    /**
     * @private
     * @param {...?} events
     * @return {?}
     */
    LoadingComponent.prototype.addAnimationEndEvent = /**
     * @private
     * @param {...?} events
     * @return {?}
     */
    function () {
        var events = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            events[_i] = arguments[_i];
        }
        /** @type {?} */
        var _this = this;
        events.forEach((/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            _this.el.nativeElement.addEventListener(e, (/**
             * @return {?}
             */
            function handler() {
                _this.el.nativeElement.removeEventListener(e, handler);
                // _this.render.removeAttribute(_this.el.nativeElement, 'class');
                ['fadeIn', 'fadeOut', 'animated', 'animated-0.5'].forEach((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) {
                    _this.render.removeClass(_this.el.nativeElement, n);
                }));
                _this.closed.emit(_this.isActive);
            }));
        }));
    };
    LoadingComponent.decorators = [
        { type: Component, args: [{
                    selector: 'farris-loading',
                    template: "\n        <div #loadingBackdrop class=\"farris-loading-backdrop loading-wait\" style=\"display: none\"></div>\n        <div #loadingContainerEl class=\"farris-loading\" style=\"display: none\">\n            <div class=\"ng-busy-default-wrapper\">\n                <div class=\"ng-busy-default-sign\" >\n                    <div [style.width]=\"width+ 'px'\" [style.height]=\"width+'px'\" style=\"display: inline-block;margin:4px;\"\n                                [innerHTML]=\"loadingStyleDom[type] | safe: 'html'\"></div>\n                    <div class=\"ng-busy-default-text\" style=\"margin-left:0;\"\n                                 *ngIf=\"showMessage\" [innerHTML]=\"'loading.message' | locale: '' :message | safe: 'html'\"></div>\n                </div>\n            </div>\n        </div>\n    ",
                    styles: [".loading-wait {\n            cursor: wait\n        }\n        .animated-0.5 {\n            -webkit-animation-duration: 0s;\n            animation-duration: 0s;\n        }\n        "]
                }] }
    ];
    /** @nocollapse */
    LoadingComponent.ctorParameters = function () { return [
        { type: Renderer2 },
        { type: ElementRef }
    ]; };
    LoadingComponent.propDecorators = {
        showMessage: [{ type: Input }],
        loadingContainerEl: [{ type: ViewChild, args: ['loadingContainerEl',] }],
        loadingBackdrop: [{ type: ViewChild, args: ['loadingBackdrop',] }],
        closed: [{ type: Output }]
    };
    return LoadingComponent;
}());
export { LoadingComponent };
if (false) {
    /** @type {?} */
    LoadingComponent.prototype.showMessage;
    /** @type {?} */
    LoadingComponent.prototype.loadingStyleDom;
    /** @type {?} */
    LoadingComponent.prototype.id;
    /**
     * @type {?}
     * @private
     */
    LoadingComponent.prototype._isActive;
    /**
     * @type {?}
     * @private
     */
    LoadingComponent.prototype.activeSubject;
    /** @type {?} */
    LoadingComponent.prototype.message;
    /** @type {?} */
    LoadingComponent.prototype.width;
    /**
     * loading 样式
     * @type {?}
     */
    LoadingComponent.prototype.type;
    /** @type {?} */
    LoadingComponent.prototype.delay;
    /** @type {?} */
    LoadingComponent.prototype.loadingContainerEl;
    /** @type {?} */
    LoadingComponent.prototype.loadingBackdrop;
    /** @type {?} */
    LoadingComponent.prototype.closed;
    /** @type {?} */
    LoadingComponent.prototype.activedSubscrition;
    /**
     * @type {?}
     * @private
     */
    LoadingComponent.prototype.destroy$;
    /**
     * @type {?}
     * @private
     */
    LoadingComponent.prototype.render;
    /**
     * @type {?}
     * @private
     */
    LoadingComponent.prototype.el;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9hZGluZy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWxvYWRpbmcvIiwic291cmNlcyI6WyJsaWIvbG9hZGluZy5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBYyxPQUFPLEVBQWdCLGVBQWUsRUFBRSxNQUFNLE1BQU0sQ0FBQzs7Ozs7Ozs7O0FBVTFFLE9BQU8sRUFBRSxTQUFTLEVBQVUsVUFBVSxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQWlCLE1BQU0sRUFBRSxZQUFZLEVBQWEsS0FBSyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNJLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUNsRCxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBMkIsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFHbkY7SUF5REksMEJBQW9CLE1BQWlCLEVBQVUsRUFBYztRQUF6QyxXQUFNLEdBQU4sTUFBTSxDQUFXO1FBQVUsT0FBRSxHQUFGLEVBQUUsQ0FBWTtRQTlCcEQsZ0JBQVcsR0FBRyxJQUFJLENBQUM7UUFDNUIsb0JBQWUsR0FBRyxjQUFjLENBQUM7UUFFekIsY0FBUyxHQUFHLEtBQUssQ0FBQztRQUNsQixrQkFBYSxHQUFHLElBQUksZUFBZSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ25ELFlBQU8sR0FBRyxFQUFFLENBQUM7UUFDYixVQUFLLEdBQUcsRUFBRSxDQUFDOzs7O1FBRVgsU0FBSSxHQUFHLENBQUMsQ0FBQztRQUVULFVBQUssR0FBRyxHQUFHLENBQUM7UUFlRixXQUFNLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUMzQyx1QkFBa0IsR0FBaUIsSUFBSSxDQUFDO1FBRWhDLGFBQVEsR0FBRyxJQUFJLE9BQU8sRUFBRSxDQUFDO0lBR2pDLENBQUM7SUFuQkQsc0JBQUksc0NBQVE7Ozs7UUFBWjtZQUNJLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FB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QUFDO0NBQUEsQUFuSUQsSUFtSUM7U0F6R1ksZ0JBQWdCOzs7SUFDekIsdUNBQTRCOztJQUM1QiwyQ0FBaUM7O0lBQ2pDLDhCQUFXOzs7OztJQUNYLHFDQUEwQjs7Ozs7SUFDMUIseUNBQW1EOztJQUNuRCxtQ0FBYTs7SUFDYixpQ0FBVzs7Ozs7SUFFWCxnQ0FBUzs7SUFFVCxpQ0FBWTs7SUFhWiw4Q0FBZ0U7O0lBQ2hFLDJDQUEwRDs7SUFDMUQsa0NBQTJDOztJQUMzQyw4Q0FBd0M7Ozs7O0lBRXhDLG9DQUFpQzs7Ozs7SUFFckIsa0NBQXlCOzs7OztJQUFFLDhCQUFzQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE9ic2VydmFibGUsIFN1YmplY3QsIFN1YnNjcmlwdGlvbiwgQmVoYXZpb3JTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcbi8qXHJcbiAqIEBBdXRob3I6IOeWr+eLguengOaJjShMdWNhcyBIdWFuZylcclxuICogQExhc3RFZGl0b3JzOiDnlq/ni4Lnp4DmiY0oTHVjYXMgSHVhbmcpXHJcbiAqIEBDb21wYW55OiBJbnNwdXJcclxuICogQFZlcnNpb246IHYwLjEuOFxyXG4gKiBARGF0ZTogMjAxOC0wOS0xOCAxNjowNDowNVxyXG4gKiBATGFzdEVkaXRUaW1lOiAyMDE5LTEwLTE3IDEzOjQyOjQ1XHJcbiAqL1xyXG5cclxuaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIEVsZW1lbnRSZWYsIFZpZXdDaGlsZCwgUmVuZGVyZXIyLCBBZnRlclZpZXdJbml0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgT25EZXN0cm95LCBJbnB1dCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBMT0FESU5HX1NUWUxFUyB9IGZyb20gJy4vbG9hZGluZy5zdHlsZXMnO1xyXG5pbXBvcnQgeyBkZWxheSwgZmlsdGVyLCBkZWJvdW5jZVRpbWUsIHN3aXRjaE1hcCwgdGFrZVVudGlsIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBvZiB9IGZyb20gJ3J4anMnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ2ZhcnJpcy1sb2FkaW5nJyxcclxuICAgIHRlbXBsYXRlOiBgXHJcbiAgICAgICAgPGRpdiAjbG9hZGluZ0JhY2tkcm9wIGNsYXNzPVwiZmFycmlzLWxvYWRpbmctYmFja2Ryb3AgbG9hZGluZy13YWl0XCIgc3R5bGU9XCJkaXNwbGF5OiBub25lXCI+PC9kaXY+XHJcbiAgICAgICAgPGRpdiAjbG9hZGluZ0NvbnRhaW5lckVsIGNsYXNzPVwiZmFycmlzLWxvYWRpbmdcIiBzdHlsZT1cImRpc3BsYXk6IG5vbmVcIj5cclxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cIm5nLWJ1c3ktZGVmYXVsdC13cmFwcGVyXCI+XHJcbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwibmctYnVzeS1kZWZhdWx0LXNpZ25cIiA+XHJcbiAgICAgICAgICAgICAgICAgICAgPGRpdiBbc3R5bGUud2lkdGhdPVwid2lkdGgrICdweCdcIiBbc3R5bGUuaGVpZ2h0XT1cIndpZHRoKydweCdcIiBzdHlsZT1cImRpc3BsYXk6IGlubGluZS1ibG9jazttYXJnaW46NHB4O1wiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW2lubmVySFRNTF09XCJsb2FkaW5nU3R5bGVEb21bdHlwZV0gfCBzYWZlOiAnaHRtbCdcIj48L2Rpdj5cclxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwibmctYnVzeS1kZWZhdWx0LXRleHRcIiBzdHlsZT1cIm1hcmdpbi1sZWZ0OjA7XCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKm5nSWY9XCJzaG93TWVzc2FnZVwiIFtpbm5lckhUTUxdPVwiJ2xvYWRpbmcubWVzc2FnZScgfCBsb2NhbGU6ICcnIDptZXNzYWdlIHwgc2FmZTogJ2h0bWwnXCI+PC9kaXY+XHJcbiAgICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgPC9kaXY+XHJcbiAgICBgLFxyXG4gICAgc3R5bGVzOiBbXHJcbiAgICAgICAgYC5sb2FkaW5nLXdhaXQge1xyXG4gICAgICAgICAgICBjdXJzb3I6IHdhaXRcclxuICAgICAgICB9XHJcbiAgICAgICAgLmFuaW1hdGVkLTAuNSB7XHJcbiAgICAgICAgICAgIC13ZWJraXQtYW5pbWF0aW9uLWR1cmF0aW9uOiAwcztcclxuICAgICAgICAgICAgYW5pbWF0aW9uLWR1cmF0aW9uOiAwcztcclxuICAgICAgICB9XHJcbiAgICAgICAgYFxyXG4gICAgXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgTG9hZGluZ0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCwgT25EZXN0cm95IHtcclxuICAgIEBJbnB1dCgpIHNob3dNZXNzYWdlID0gdHJ1ZTtcclxuICAgIGxvYWRpbmdTdHlsZURvbSA9IExPQURJTkdfU1RZTEVTO1xyXG4gICAgaWQ6IG51bWJlcjtcclxuICAgIHByaXZhdGUgX2lzQWN0aXZlID0gZmFsc2U7XHJcbiAgICBwcml2YXRlIGFjdGl2ZVN1YmplY3QgPSBuZXcgQmVoYXZpb3JTdWJqZWN0KGZhbHNlKTtcclxuICAgIG1lc3NhZ2UgPSAnJztcclxuICAgIHdpZHRoID0gMzA7XHJcbiAgICAvKiogbG9hZGluZyDmoLflvI8gKi9cclxuICAgIHR5cGUgPSAwO1xyXG5cclxuICAgIGRlbGF5ID0gMzAwO1xyXG5cclxuICAgIGdldCBpc0FjdGl2ZSgpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5faXNBY3RpdmU7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IGlzQWN0aXZlKHZhbDogYm9vbGVhbikge1xyXG4gICAgICAgIHRoaXMuX2lzQWN0aXZlID0gdmFsO1xyXG4gICAgICAgIGlmICh0aGlzLmFjdGl2ZVN1YmplY3QpIHtcclxuICAgICAgICAgICAgdGhpcy5hY3RpdmVTdWJqZWN0Lm5leHQodmFsKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgQFZpZXdDaGlsZCgnbG9hZGluZ0NvbnRhaW5lckVsJykgbG9hZGluZ0NvbnRhaW5lckVsOiBFbGVtZW50UmVmO1xyXG4gICAgQFZpZXdDaGlsZCgnbG9hZGluZ0JhY2tkcm9wJykgbG9hZGluZ0JhY2tkcm9wOiBFbGVtZW50UmVmO1xyXG4gICAgQE91dHB1dCgpIGNsb3NlZCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG4gICAgYWN0aXZlZFN1YnNjcml0aW9uOiBTdWJzY3JpcHRpb24gPSBudWxsO1xyXG5cclxuICAgIHByaXZhdGUgZGVzdHJveSQgPSBuZXcgU3ViamVjdCgpO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVuZGVyOiBSZW5kZXJlcjIsIHByaXZhdGUgZWw6IEVsZW1lbnRSZWYpIHtcclxuICAgIH1cclxuXHJcbiAgICBuZ09uSW5pdCgpIHtcclxuICAgICAgICB0aGlzLmFjdGl2ZWRTdWJzY3JpdGlvbiA9IHRoaXMuYWN0aXZlU3ViamVjdC5waXBlKFxyXG4gICAgICAgICAgICB0YWtlVW50aWwodGhpcy5kZXN0cm95JClcclxuICAgICAgICApLnBpcGUoXHJcbiAgICAgICAgICAgIGZpbHRlcigobjogYm9vbGVhbikgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG47XHJcbiAgICAgICAgICAgIH0pLFxyXG4gICAgICAgICAgICBkZWxheSh0aGlzLmRlbGF5KVxyXG4gICAgICAgICkuc3Vic2NyaWJlKHYgPT4ge1xyXG4gICAgICAgICAgICBpZiAodiAmJiB0aGlzLmlzQWN0aXZlKSB7XHJcbiAgICAgICAgICAgICAgICAvLyB0aGlzLmFuaW1hdGUoJ2YtY29tcG9uZW50LWxvYWRpbmcgZmFkZUluIGFuaW1hdGVkJyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5zZXRTdHlsZSh0aGlzLmxvYWRpbmdDb250YWluZXJFbC5uYXRpdmVFbGVtZW50LCAnZGlzcGxheScsICdibG9jaycpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIuc2V0U3R5bGUodGhpcy5sb2FkaW5nQmFja2Ryb3AubmF0aXZlRWxlbWVudCwgJ2Rpc3BsYXknLCAnYmxvY2snKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2V0UG9zaXRpb24oKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkRlc3Ryb3koKSB7XHJcbiAgICAgICAgdGhpcy5kZXN0cm95JC5uZXh0KCk7XHJcbiAgICAgICAgdGhpcy5kZXN0cm95JC5jb21wbGV0ZSgpO1xyXG4gICAgICAgIC8vIHRoaXMuYWN0aXZlU3ViamVjdC5jb21wbGV0ZSgpO1xyXG4gICAgICAgIC8vIHRoaXMuYWN0aXZlU3ViamVjdCA9IG51bGw7XHJcbiAgICAgICAgLy8gdGhpcy5hY3RpdmVkU3Vic2NyaXRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgIH1cclxuXHJcbiAgICBjbG9zZSgpIHtcclxuICAgICAgICAvLyBpZiAodGhpcy5sb2FkaW5nQmFja2Ryb3AubmF0aXZlRWxlbWVudC5wYXJlbnRFbGVtZW50KSB7XHJcbiAgICAgICAgLy8gICAgIHRoaXMucmVuZGVyLnJlbW92ZUNoaWxkKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgdGhpcy5sb2FkaW5nQmFja2Ryb3AubmF0aXZlRWxlbWVudCk7XHJcbiAgICAgICAgLy8gfVxyXG4gICAgICAgIC8vIGNvbnN0IHdhaXRFbGUgPSBkb2N1bWVudC5ib2R5LnF1ZXJ5U2VsZWN0b3IoJy5mYXJyaXMtbG9hZGluZy1iYWNrZHJvcCcpO1xyXG4gICAgICAgIGlmICh0aGlzLmxvYWRpbmdCYWNrZHJvcCkge1xyXG4gICAgICAgICAgICB0aGlzLmxvYWRpbmdCYWNrZHJvcC5uYXRpdmVFbGVtZW50LnJlbW92ZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmlzQWN0aXZlID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5yZW5kZXIucmVtb3ZlQXR0cmlidXRlKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgJ2NsYXNzJyk7XHJcbiAgICAgICAgLy8gdGhpcy5hbmltYXRlKCdmLWNvbXBvbmVudC1sb2FkaW5nIGZhZGVPdXQgYW5pbWF0ZWQgYW5pbWF0ZWQtMC41Jyk7XHJcbiAgICAgICAgdGhpcy5jbG9zZWQuZW1pdCh0aGlzLmlzQWN0aXZlKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNldFBvc2l0aW9uKCkge1xyXG4gICAgICAgIGNvbnN0IGNvbnRhaW5lcldpZHRoID0gdGhpcy5sb2FkaW5nQ29udGFpbmVyRWwubmF0aXZlRWxlbWVudC5jbGllbnRXaWR0aDtcclxuICAgICAgICBjb25zdCBjb250YWluZXJIZWlnaHQgPSB0aGlzLmxvYWRpbmdDb250YWluZXJFbC5uYXRpdmVFbGVtZW50LmNsaWVudEhlaWdodDtcclxuXHJcbiAgICAgICAgdGhpcy5yZW5kZXIuc2V0U3R5bGUodGhpcy5sb2FkaW5nQ29udGFpbmVyRWwubmF0aXZlRWxlbWVudCwgJ21hcmdpblRvcCcsIC1jb250YWluZXJIZWlnaHQgLyAyICsgJ3B4Jyk7XHJcbiAgICAgICAgdGhpcy5yZW5kZXIuc2V0U3R5bGUodGhpcy5sb2FkaW5nQ29udGFpbmVyRWwubmF0aXZlRWxlbWVudCwgJ21hcmdpbkxlZnQnLCAtY29udGFpbmVyV2lkdGggLyAyICsgJ3B4Jyk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBhbmltYXRlKGFuaW1hdGVDbHM6IHN0cmluZykge1xyXG4gICAgICAgIHRoaXMuYWRkQW5pbWF0aW9uRW5kRXZlbnQoJ3dlYmtpdEFuaW1hdGlvbkVuZCcsICdtb3pBbmltYXRpb25FbmQnLCAnTVNBbmltYXRpb25FbmQnLCAnb2FuaW1hdGlvbmVuZCcsICdhbmltYXRpb25lbmQnKTtcclxuICAgICAgICB0aGlzLnJlbmRlci5zZXRBdHRyaWJ1dGUodGhpcy5lbC5uYXRpdmVFbGVtZW50LCAnY2xhc3MnLCBhbmltYXRlQ2xzKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGFkZEFuaW1hdGlvbkVuZEV2ZW50KC4uLmV2ZW50czogc3RyaW5nW10pIHtcclxuICAgICAgICBjb25zdCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgICAgIGV2ZW50cy5mb3JFYWNoKGUgPT4ge1xyXG4gICAgICAgICAgICBfdGhpcy5lbC5uYXRpdmVFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoZSwgZnVuY3Rpb24gaGFuZGxlcigpIHtcclxuICAgICAgICAgICAgICAgIF90aGlzLmVsLm5hdGl2ZUVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihlLCBoYW5kbGVyKTtcclxuICAgICAgICAgICAgICAgIC8vIF90aGlzLnJlbmRlci5yZW1vdmVBdHRyaWJ1dGUoX3RoaXMuZWwubmF0aXZlRWxlbWVudCwgJ2NsYXNzJyk7XHJcbiAgICAgICAgICAgICAgICBbJ2ZhZGVJbicsICdmYWRlT3V0JywgJ2FuaW1hdGVkJywgJ2FuaW1hdGVkLTAuNSddLmZvckVhY2gobiA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMucmVuZGVyLnJlbW92ZUNsYXNzKF90aGlzLmVsLm5hdGl2ZUVsZW1lbnQsIG4pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5jbG9zZWQuZW1pdChfdGhpcy5pc0FjdGl2ZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==