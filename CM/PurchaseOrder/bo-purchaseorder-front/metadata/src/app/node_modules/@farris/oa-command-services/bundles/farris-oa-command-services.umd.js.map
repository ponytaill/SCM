{"version":3,"file":"farris-oa-command-services.umd.js.map","sources":["ng://@farris/oa-command-services/lib/print-web-page/entity.ts","ng://@farris/oa-command-services/lib/print-web-page/print-web-page.service.ts","ng://@farris/oa-command-services/lib/task-center-bridge/entity.ts","ng://@farris/oa-command-services/lib/task-center-bridge/task-center-bridge.service.ts","ng://@farris/oa-command-services/lib/transit-approval/transit-approval.service.ts","ng://@farris/oa-command-services/lib/oa-command-services-module.ts"],"sourcesContent":["\r\nexport enum templateType {\r\n  card = \"card\"\r\n}","import { Injectable } from \"@angular/core\";\r\nimport { MessagerService } from '@farris/ui-messager';\r\nimport { templateType } from \"./entity\";\r\n@Injectable()\r\nexport class PrintWebPageService {\r\n\r\n  private currentTemplate: templateType;\r\n\r\n  constructor(\r\n\r\n    private msgSer: MessagerService\r\n  ) {\r\n    window.onbeforeprint = () => {\r\n      if (this.currentTemplate == templateType.card) {\r\n        const rootLayout = document.getElementById('root-layout');\r\n        const mainContainer = document.getElementById('main-container');\r\n        if (rootLayout && mainContainer) {\r\n          rootLayout.style.display = 'block';\r\n          rootLayout.style.position = 'relative';\r\n          mainContainer.style.display = 'block';\r\n          rootLayout.parentElement.style.position = 'relative';\r\n          document.title = '';\r\n        } else {\r\n          this.msgSer.error('æªæ¾å°æ¨¡æ¿ä¸­å³é®èç¹ï¼è¯·æ£æ¥å½ä»¤ä¼ åä¸­æ¨¡æ¿ç±»åæ¯å¦æ­£ç¡®ã');\r\n        }\r\n      }\r\n    }\r\n    window.onafterprint = () => {\r\n      if (this.currentTemplate == templateType.card) {\r\n        const rootLayout = document.getElementById('root-layout');\r\n        const mainContainer = document.getElementById('main-container');\r\n        if (rootLayout && mainContainer) {\r\n          mainContainer.setAttribute('style', '');\r\n          rootLayout.setAttribute('style', '');\r\n          rootLayout.parentElement.setAttribute('style', '');\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  public printWebPage(tempType: templateType = templateType.card) {\r\n    this.currentTemplate = tempType;\r\n    if (!window.navigator.userAgent.includes('AppleWebKit/')) {\r\n      this.msgSer.prompt('æç¤º', 'ä¸ºä¿è¯æå°ææï¼æ¨èä½¿ç¨è°·æ­æµè§å¨è¿è¡æå°ãæ¯å¦ç»§ç»­æå°ï¼').subscribe((confirmed) => {\r\n        if (confirmed) {\r\n          window.print()\r\n        }\r\n      });\r\n    } else {\r\n      window.print()\r\n    }\r\n  }\r\n\r\n}","\r\nexport enum WFActionType {\r\n  Resubmit = 'Resubmit'\r\n}\r\n\r\n\r\nexport interface Parameter {\r\n  code: string;\r\n  value: string;\r\n}\r\n\r\nexport interface Action {\r\n  code: string;\r\n  parameters: Parameter[];\r\n}\r\n\r\nexport interface WFTask {\r\n  id: string;\r\n  sourceId: string;\r\n  name: string;\r\n  state: string;\r\n  owner: string;\r\n  priority: number;\r\n  categoryId: string;\r\n  submitter: string;\r\n  startTime: string;\r\n  endTime: string;\r\n  processInstanceId: string;\r\n  refBizId: string;\r\n  submitterName: string;\r\n  bizCategory: string;\r\n  activityType: string;\r\n  activityDefinitionId: string;\r\n  activityInstanceId: string;\r\n  fromType: number;\r\n  tenantId: number;\r\n  readTime: string;\r\n  createdTime: string;\r\n  creator: string;\r\n  lastModifiedTime: string;\r\n  lastModifier: string;\r\n  actions: Action[];\r\n}\r\n\r\n\r\n\r\nexport type WFAction = {\r\n  \"code\": WFActionType,\r\n  \"parameters\": [],\r\n  \"id\": \"\",\r\n  \"name\": \"\",\r\n  \"sortOrder\": 13,\r\n  \"typeId\": \"wf\",\r\n  \"isBatchAction\": false,\r\n  \"isPrimaryAction\": false,\r\n  \"isHyperlinkAction\": false,\r\n  \"isCustomizeAction\": false,\r\n  \"terminal\": \"web,app\",\r\n  \"scope\": \"running\",\r\n  \"groupId\": \"complete\",\r\n  \"nameLanguage\": null,\r\n  \"preEvents\": [],\r\n  \"postEvents\": []\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { FrameContext } from '@farris/devkit';\r\nimport { WFAction, WFActionType, WFTask } from './entity';\r\n\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class TaskCenterBridgeService {\r\n\r\n  constructor() { }\r\n\r\n  public initTaskCenterBridge(customerCmds: {}) {\r\n    const bridgeWin = window.parent;\r\n    let frameContext: FrameContext;\r\n    try {\r\n      frameContext = this['context'].frameContext\r\n    } catch (error) {\r\n      throw new Error('can not find frameContex');\r\n    }\r\n\r\n    let slienceSaveTask;\r\n\r\n    try {\r\n      slienceSaveTask = this['context'].frameContext.viewModel.slienceSave1;\r\n    } catch (error) {\r\n      // ä¸å­å¨éé³ä¿å­å½ä»¤\r\n    }\r\n    if (bridgeWin) {\r\n      bridgeWin['taskCenterBeforeLoad'] = (\r\n        actionObj: {\r\n          \"task\": WFTask,\r\n          \"action\": WFAction\r\n        }\r\n      ) => {\r\n        return new Promise((resolve, reject) => {\r\n          const { action } = actionObj;\r\n          if (frameContext.uiState['UIStateInProcess'] == 'Approving' && frameContext.uiState['formConfigId']) {\r\n            slienceSaveTask.call(this).subscribe(() => {\r\n              resolve({\r\n                result: true\r\n              });\r\n            }, () => {\r\n              window.document.body.click()\r\n              resolve({\r\n                result: false\r\n              });\r\n            })\r\n          } else if (action.code == WFActionType.Resubmit && slienceSaveTask) {\r\n            slienceSaveTask.call(this).subscribe(() => {\r\n              resolve({\r\n                result: true\r\n              });\r\n            })\r\n          } else {\r\n            resolve({\r\n              result: true\r\n            });\r\n          }\r\n        })\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Injectable, Injector } from '@angular/core';\r\n// import { StateMachineService } from '@farris/command-services';\r\nimport { FrameContext } from '@farris/devkit';\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\n@Injectable()\r\nexport class TransitApprovalStatus {\r\n    constructor(\r\n        private injetor: Injector\r\n    ) {\r\n        // å ä¸ºæ³¨ä½ç½®çé®é¢ï¼è¿æ ·å­æ¿ä¸å°\r\n        // this.stateMachineSer = this.injetor.get(StateMachineService);\r\n    }\r\n    public switchStatus() {\r\n        const result: BehaviorSubject<string> = new BehaviorSubject('Cancel');\r\n        //  å¤æ­æµç¨ä¼ å  formConfigId\r\n        let frameContext: FrameContext;\r\n        try {\r\n            frameContext = this['context'].frameContext\r\n        } catch (error) {\r\n            throw new Error('can not find frameContex');\r\n        }\r\n        if (frameContext.uiState['UIStateInProcess'] == 'Approving' && frameContext.uiState['formConfigId']) {\r\n            result.next('Edit');\r\n        }\r\n        return result;\r\n    }\r\n}","import { NgModule } from '@angular/core';\r\nimport { PrintWebPageService } from './print-web-page/print-web-page.service';\r\nimport { TaskCenterBridgeService } from './task-center-bridge/task-center-bridge.service';\r\nimport { TransitApprovalStatus } from './transit-approval/transit-approval.service';\r\n\r\n\r\n\r\n@NgModule({\r\n    providers: [\r\n        TaskCenterBridgeService,\r\n        PrintWebPageService,\r\n        TransitApprovalStatus,\r\n    ],\r\n    imports: [\r\n\r\n    ],\r\n    exports: [\r\n\r\n    ],\r\n    entryComponents: [\r\n    ]\r\n})\r\nclass OACommandServicesModule {\r\n    constructor() { }\r\n}\r\n\r\nexport { OACommandServicesModule };\r\n\r\n"],"names":["Injectable","MessagerService","BehaviorSubject","Injector","NgModule"],"mappings":";;;;;;;;;;;;IACA,IAAY,YAAY;QACtB,IAAI,QAAS;MACd;;;;;;;ACHD;QAQE,6BAEU,MAAuB;YAFjC,iBA8BC;YA5BS,WAAM,GAAN,MAAM,CAAiB;YAE/B,MAAM,CAAC,aAAa;;eAAG;gBACrB,IAAI,KAAI,CAAC,eAAe,IAAI,YAAY,CAAC,IAAI,EAAE;;wBACvC,UAAU,GAAG,QAAQ,CAAC,cAAc,CAAC,aAAa,CAAC;;wBACnD,aAAa,GAAG,QAAQ,CAAC,cAAc,CAAC,gBAAgB,CAAC;oBAC/D,IAAI,UAAU,IAAI,aAAa,EAAE;wBAC/B,UAAU,CAAC,KAAK,CAAC,OAAO,GAAG,OAAO,CAAC;wBACnC,UAAU,CAAC,KAAK,CAAC,QAAQ,GAAG,UAAU,CAAC;wBACvC,aAAa,CAAC,KAAK,CAAC,OAAO,GAAG,OAAO,CAAC;wBACtC,UAAU,CAAC,aAAa,CAAC,KAAK,CAAC,QAAQ,GAAG,UAAU,CAAC;wBACrD,QAAQ,CAAC,KAAK,GAAG,EAAE,CAAC;qBACrB;yBAAM;wBACL,KAAI,CAAC,MAAM,CAAC,KAAK,CAAC,8BAA8B,CAAC,CAAC;qBACnD;iBACF;aACF,CAAA,CAAA;YACD,MAAM,CAAC,YAAY;;eAAG;gBACpB,IAAI,KAAI,CAAC,eAAe,IAAI,YAAY,CAAC,IAAI,EAAE;;wBACvC,UAAU,GAAG,QAAQ,CAAC,cAAc,CAAC,aAAa,CAAC;;wBACnD,aAAa,GAAG,QAAQ,CAAC,cAAc,CAAC,gBAAgB,CAAC;oBAC/D,IAAI,UAAU,IAAI,aAAa,EAAE;wBAC/B,aAAa,CAAC,YAAY,CAAC,OAAO,EAAE,EAAE,CAAC,CAAC;wBACxC,UAAU,CAAC,YAAY,CAAC,OAAO,EAAE,EAAE,CAAC,CAAC;wBACrC,UAAU,CAAC,aAAa,CAAC,YAAY,CAAC,OAAO,EAAE,EAAE,CAAC,CAAC;qBACpD;iBACF;aACF,CAAA,CAAA;SACF;;;;;QAEM,0CAAY;;;;YAAnB,UAAoB,QAA0C;gBAA1C,yBAAA;oBAAA,WAAyB,YAAY,CAAC,IAAI;;gBAC5D,IAAI,CAAC,eAAe,GAAG,QAAQ,CAAC;gBAChC,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,SAAS,CAAC,QAAQ,CAAC,cAAc,CAAC,EAAE;oBACxD,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,EAAE,+BAA+B,CAAC,CAAC,SAAS;;;uBAAC,UAAC,SAAS;wBAC5E,IAAI,SAAS,EAAE;4BACb,MAAM,CAAC,KAAK,EAAE,CAAA;yBACf;qBACF,EAAC,CAAC;iBACJ;qBAAM;oBACL,MAAM,CAAC,KAAK,EAAE,CAAA;iBACf;aACF;;oBAhDFA,aAAU;;;;;wBAFFC,0BAAe;;;QAoDxB,0BAAC;KAlDD;;;;;;;;ICFA,IAAY,YAAY;QACtB,QAAQ,YAAa;MACtB;;;;;;;ACHD;QAUE;SAAiB;;;;;QAEV,sDAAoB;;;;YAA3B,UAA4B,YAAgB;gBAA5C,iBAkDC;;oBAjDO,SAAS,GAAG,MAAM,CAAC,MAAM;;oBAC3B,YAA0B;gBAC9B,IAAI;oBACF,YAAY,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC,YAAY,CAAA;iBAC5C;gBAAC,OAAO,KAAK,EAAE;oBACd,MAAM,IAAI,KAAK,CAAC,0BAA0B,CAAC,CAAC;iBAC7C;;oBAEG,eAAe;gBAEnB,IAAI;oBACF,eAAe,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC,YAAY,CAAC,SAAS,CAAC,YAAY,CAAC;iBACvE;gBAAC,OAAO,KAAK,EAAE;;iBAEf;gBACD,IAAI,SAAS,EAAE;oBACb,SAAS,CAAC,sBAAsB,CAAC;;;uBAAG,UAClC,SAGC;wBAED,OAAO,IAAI,OAAO;;;;2BAAC,UAAC,OAAO,EAAE,MAAM;4BACzB,IAAA,yBAAM;4BACd,IAAI,YAAY,CAAC,OAAO,CAAC,kBAAkB,CAAC,IAAI,WAAW,IAAI,YAAY,CAAC,OAAO,CAAC,cAAc,CAAC,EAAE;gCACnG,eAAe,CAAC,IAAI,CAAC,KAAI,CAAC,CAAC,SAAS;;mCAAC;oCACnC,OAAO,CAAC;wCACN,MAAM,EAAE,IAAI;qCACb,CAAC,CAAC;iCACJ;;mCAAE;oCACD,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,EAAE,CAAA;oCAC5B,OAAO,CAAC;wCACN,MAAM,EAAE,KAAK;qCACd,CAAC,CAAC;iCACJ,EAAC,CAAA;6BACH;iCAAM,IAAI,MAAM,CAAC,IAAI,IAAI,YAAY,CAAC,QAAQ,IAAI,eAAe,EAAE;gCAClE,eAAe,CAAC,IAAI,CAAC,KAAI,CAAC,CAAC,SAAS;;mCAAC;oCACnC,OAAO,CAAC;wCACN,MAAM,EAAE,IAAI;qCACb,CAAC,CAAC;iCACJ,EAAC,CAAA;6BACH;iCAAM;gCACL,OAAO,CAAC;oCACN,MAAM,EAAE,IAAI;iCACb,CAAC,CAAC;6BACJ;yBACF,EAAC,CAAA;qBACH,CAAA,CAAA;iBACF;aACF;;oBAzDFD,aAAU,SAAC;wBACV,UAAU,EAAE,MAAM;qBACnB;;;;;sCAPD;KAKA;;;;;;;ACLA;QAOI,+BACY,OAAiB;YAAjB,YAAO,GAAP,OAAO,CAAU;;;SAI5B;;;;QACM,4CAAY;;;YAAnB;;oBACU,MAAM,GAA4B,IAAIE,oBAAe,CAAC,QAAQ,CAAC;;;oBAEjE,YAA0B;gBAC9B,IAAI;oBACA,YAAY,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC,YAAY,CAAA;iBAC9C;gBAAC,OAAO,KAAK,EAAE;oBACZ,MAAM,IAAI,KAAK,CAAC,0BAA0B,CAAC,CAAC;iBAC/C;gBACD,IAAI,YAAY,CAAC,OAAO,CAAC,kBAAkB,CAAC,IAAI,WAAW,IAAI,YAAY,CAAC,OAAO,CAAC,cAAc,CAAC,EAAE;oBACjG,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;iBACvB;gBACD,OAAO,MAAM,CAAC;aACjB;;oBArBJF,aAAU;;;;;wBALUG,WAAQ;;;QA2B7B,4BAAC;KAtBD;;;;;;;ACLA;QAuBI;SAAiB;;oBAhBpBC,WAAQ,SAAC;wBACN,SAAS,EAAE;4BACP,uBAAuB;4BACvB,mBAAmB;4BACnB,qBAAqB;yBACxB;wBACD,OAAO,EAAE,EAER;wBACD,OAAO,EAAE,EAER;wBACD,eAAe,EAAE,EAChB;qBACJ;;;;QAGD,8BAAC;KAjBD;;;;;;;;;;;;;;;;;;;;;;;;;;;"}
