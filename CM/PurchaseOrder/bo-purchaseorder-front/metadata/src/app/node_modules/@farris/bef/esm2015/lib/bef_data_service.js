/**
 * @fileoverview added by tsickle
 * Generated from: lib/bef_data_service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { HttpClient } from '@angular/common/http';
import { of, zip } from 'rxjs';
import { tap, map, switchMap } from 'rxjs/operators';
import { EventBus, AppContext, DataChangeType, DataTypeInfoUtil, ViewModel, ExpressionUtil } from '@farris/devkit';
import { FrameworkSessionService } from './framework_session_service';
import { BefRestService } from './bef_rest_service';
import { BE_SERVER_URI_TOKEN } from './tokens';
import { BefProxyUtil } from './bef_proxy_util';
import { EntityUtil } from './entity_util';
import { BefDataPathUtil } from './bef_data_path_util';
/**
 * Bef数据访问服务
 * \@todo：
 * 1、临时将BefRepository相关代码转移到该类中；
 * 2、进一步明确职责，调整结构
 * @template T
 */
// tslint:disable: no-string-literal
class BefDataService {
    /**
     * 构造函数
     * @param {?} injector
     * @param {?} repository
     */
    constructor(injector, repository) {
        this.injector = injector;
        this.repository = repository;
        /** @type {?} */
        const frmSessionService = injector.get(FrameworkSessionService);
        /** @type {?} */
        const httpClient = injector.get(HttpClient);
        /** @type {?} */
        const serverUri = injector.get(BE_SERVER_URI_TOKEN);
        // 创建BefRestService实例
        /** @type {?} */
        const restBaseUri = `${serverUri}/${this.repository.apiUri}`;
        /** @type {?} */
        const eventBus = injector.get(EventBus);
        this.restService = new BefRestService(httpClient, restBaseUri, frmSessionService, this.repository, eventBus);
        this.appContext = injector.get(AppContext);
    }
    /**
     * BefRest代理
     * @return {?}
     */
    get restProxy() {
        return this.repository.restService.proxy;
    }
    /**
     * 获取实体集合
     * @param {?} filter
     * @param {?} sort
     * @param {?} pageSize
     * @param {?} pageIndex
     * @return {?}
     */
    getList(filter, sort, pageSize, pageIndex) {
        if (pageSize !== 0) {
            pageSize = pageSize || this.repository.entityCollection.pageSize;
            pageIndex = pageIndex || this.repository.entityCollection.pageIndex;
        }
        /** @type {?} */
        const entityFilter = this.buildEntityFilter(filter, sort, pageSize, pageIndex);
        /** @type {?} */
        const requestInfo = this.restService.buildRequestInfo();
        /** @type {?} */
        const filter$ = this.restProxy.extendQuery(entityFilter, requestInfo);
        return filter$.pipe(map((/**
         * @param {?} responseInfo
         * @return {?}
         */
        (responseInfo) => {
            /** @type {?} */
            const queryResult = (/** @type {?} */ (responseInfo.returnValue));
            /** @type {?} */
            const listData = queryResult.result;
            /** @type {?} */
            const entities = [];
            listData.forEach((/**
             * @param {?} data
             * @return {?}
             */
            (data) => {
                /** @type {?} */
                const entity = this.repository.buildEntity(data);
                EntityUtil.appendInitialData(entity, data);
                entities.push(entity);
            }));
            // BindingList r95，分页变更集取消，导致设置分页信息后不会触发变更事件，所以将加载数据放到后面
            /** @type {?} */
            const serverPaginationInfo = (/** @type {?} */ (queryResult.pagination));
            if (!!serverPaginationInfo && Object.keys(serverPaginationInfo).length > 0) {
                const { pageSize, pageIndex, totalCount } = serverPaginationInfo;
                // 处理主表分页信息
                this.repository.entityCollection.updatePaginationInfoByPath('/', { pageIndex, pageSize, totalCount });
            }
            else {
                this.repository.entityCollection.updatePaginationInfoByPath('/', { pageIndex: 1, pageSize: 0, totalCount: entities.length });
            }
            this.repository.entityCollection.loadEntities(entities);
            return entities;
        })));
    }
    /**
     * 过滤数据
     * @param {?} filter 过滤条件
     * @param {?} sort 排序条件
     * @param {?} pageSize 分页大小
     * @param {?} pageIndex 当前分页
     * @return {?}
     */
    filter(filter, sort, pageSize, pageIndex) {
        if (pageSize !== 0) {
            pageSize = pageSize || this.repository.entityCollection.pageSize;
            pageIndex = pageIndex || this.repository.entityCollection.pageIndex;
        }
        /** @type {?} */
        const entityFilter = this.buildEntityFilter(filter, sort, pageSize, pageIndex);
        /** @type {?} */
        const requestInfo = this.restService.buildRequestInfo();
        /** @type {?} */
        const filter$ = this.restProxy.filter(entityFilter, requestInfo);
        return filter$.pipe(map((/**
         * @param {?} responseInfo
         * @return {?}
         */
        (responseInfo) => {
            /** @type {?} */
            const queryResult = (/** @type {?} */ (responseInfo.returnValue));
            /** @type {?} */
            const listData = queryResult.result;
            /** @type {?} */
            const entities = [];
            listData.forEach((/**
             * @param {?} data
             * @return {?}
             */
            (data) => {
                /** @type {?} */
                const entity = this.repository.buildEntity(data);
                EntityUtil.appendInitialData(entity, data);
                entities.push(entity);
            }));
            // BindingList r95，分页变更集取消，导致设置分页信息后不会触发变更事件，所以将加载数据放到后面
            /** @type {?} */
            const serverPaginationInfo = (/** @type {?} */ (queryResult.pagination));
            if (!!serverPaginationInfo && Object.keys(serverPaginationInfo).length > 0) {
                const { pageSize, pageIndex, totalCount } = serverPaginationInfo;
                // 处理主表分页信息
                this.repository.entityCollection.updatePaginationInfoByPath('/', { pageIndex, pageSize, totalCount });
            }
            else {
                this.repository.entityCollection.updatePaginationInfoByPath('/', { pageIndex: 1, pageSize: 0, totalCount: entities.length });
            }
            this.repository.entityCollection.loadEntities(entities);
            return entities;
        })));
    }
    /**
     * 构造EntityFilter
     * @private
     * @param {?} filter
     * @param {?} sort
     * @param {?} pageSize
     * @param {?} pageIndex
     * @return {?}
     */
    buildEntityFilter(filter, sort, pageSize, pageIndex) {
        // @todo：临时兼容老代码，降低改动带来的风险
        if (!filter && !sort && !pageSize && !pageIndex) {
            return null;
        }
        // 纠正最后一个过滤条件的Relation
        if (filter && filter.length > 0) {
            filter[filter.length - 1].Relation = 0;
        }
        /** @type {?} */
        const entityFilter = {
            FilterConditions: filter,
            SortConditions: sort,
            IsUsePagination: pageSize === 0 ? false : true,
            Pagination: {
                PageIndex: pageIndex,
                PageSize: pageSize,
                PageCount: 0,
                TotalCount: 0
            }
        };
        return entityFilter;
    }
    /**
     * 获取单个实体
     * @param {?} id id
     * @return {?}
     */
    getById(id) {
        /** @type {?} */
        const requestInfo = this.restService.buildRequestInfo();
        /** @type {?} */
        const retrieveParam = this.buildRetrieveParam();
        if (retrieveParam) {
            return this.getEntityById(id);
        }
        /** @type {?} */
        const retrieve$ = this.restService.extendRetrieve(id, requestInfo, retrieveParam);
        /** @type {?} */
        const result$ = retrieve$.pipe(map((/**
         * @param {?} responseInfo
         * @return {?}
         */
        (responseInfo) => {
            /** @type {?} */
            const entityData = responseInfo.returnValue;
            /** @type {?} */
            const entity = this.repository.buildEntity(entityData);
            this.repository.entityCollection.loadEntities([entity]);
            return entity;
        })));
        return result$;
    }
    /**
     * @param {?} id
     * @return {?}
     */
    getEntityById(id) {
        // 获取所有分页信息
        /** @type {?} */
        const requestInfo = this.restService.buildRequestInfo();
        // 构造分页信息
        /** @type {?} */
        const retrieveParam = this.buildRetrieveParam();
        /** @type {?} */
        const retrieve$ = this.restService.serviceRetrieve(id, retrieveParam, requestInfo);
        /** @type {?} */
        const result$ = retrieve$.pipe(map((/**
         * @param {?} responseInfo
         * @return {?}
         */
        (responseInfo) => {
            /** @type {?} */
            const returnValue = responseInfo.returnValue || {};
            /** @type {?} */
            const entityData = returnValue.result;
            /** @type {?} */
            const serverPaginationInfo = returnValue.pagination;
            this.updatePagination(serverPaginationInfo);
            /** @type {?} */
            const entity = this.repository.buildEntity(entityData);
            this.repository.entityCollection.loadEntities([entity]);
            return entity;
        })));
        return result$;
    }
    /**
     * ['id:xxx', 'chil1s', 'id:xxx', 'grand1s']
     * 分页查询从表/从从表数据
     * 绑定路径格式为['主表主键:主表主键值','child1s','id:从表主键值']
     * @param {?} paths 通用路径
     * @param {?} pageIndex 页码
     * @param {?} pageSize 分页大小
     * @param {?=} filter 过滤条件
     * @param {?=} sort 排序
     * @return {?}
     */
    queryChild(paths, pageIndex, pageSize, filter, sort) {
        /** @type {?} */
        const requestInfo = this.restService.buildRequestInfo();
        /** @type {?} */
        let nodeCodes = BefDataPathUtil.convertPathsToNodeCodes(paths);
        /** @type {?} */
        const entityCodes = nodeCodes.map((/**
         * @param {?} node
         * @return {?}
         */
        node => node.substring(0, node.length - 1)));
        /** @type {?} */
        let entityName = entityCodes[entityCodes.length - 1];
        // 查询对象可能为从表或从从表
        /** @type {?} */
        const pagination = this.repository.entityCollection.getPaginationConfigByPath(`/${entityName}`);
        const { pageSize: ps = 0 } = pagination || {};
        /** @type {?} */
        const viewModel = this.injector.get(ViewModel, null);
        /** @type {?} */
        let forceQueryChild = false;
        if (viewModel) {
            forceQueryChild = viewModel.frameContext.appContext.params.get('forceQueryChild') || false;
        }
        if (ps == 0 && !forceQueryChild) {
            return of(null);
        }
        /** @type {?} */
        const ids = BefDataPathUtil.convertPathsToIds(paths);
        /** @type {?} */
        const parentId = ids[ids.length - 1];
        /** @type {?} */
        const params = {
            nodeCodes: entityCodes,
            ids,
            pagination: {
                pageIndex,
                pageSize
            },
            requestInfo
        };
        /** @type {?} */
        const request$ = this.restService.queryChild(params);
        return request$.pipe(map((/**
         * @param {?} response
         * @return {?}
         */
        response => {
            /** @type {?} */
            const returnValue = response.returnValue;
            if (!returnValue) {
                return null;
            }
            const { result = [], pagination = {} } = returnValue;
            /** @type {?} */
            const commonPaths = paths.map((/**
             * @param {?} path
             * @param {?} index
             * @return {?}
             */
            (path, index) => {
                if (path.includes(':') && index % 2 === 0) {
                    return path.split(':')[1];
                }
                return path;
            }));
            /** @type {?} */
            const entities = this.repository.entityManager.createEntitiesByPath(`/${commonPaths.join('/')}`, result);
            this.repository.entityCollection.resetEntities(paths, entities);
            // 更新分页信息
            this.repository.entityCollection.setPaginationConfigByPath(`/${entityName}_${parentId}`, pagination);
        })));
    }
    /**
     * 构造子表分页信息
     * @private
     * @return {?}
     */
    buildChildrenPagination() {
        /** @type {?} */
        const paginationInfo = this.repository.entityCollection.getPaginationConfigByPath('/');
        /** @type {?} */
        const childPaginationInfo = {};
        /** @type {?} */
        const childrenEntityCodes = [];
        DataTypeInfoUtil.getChildrenNodeCodes(this.repository.entityTypeInfo, childrenEntityCodes);
        // 实体无子表
        if (!childrenEntityCodes || childrenEntityCodes.length < 1) {
            return null;
        }
        Object.keys(paginationInfo).forEach((/**
         * @param {?} key
         * @return {?}
         */
        key => {
            /** @type {?} */
            const value = paginationInfo[key];
            if (typeof value === 'object') {
                /** @type {?} */
                const entityCode = key && key.includes('_') && key.split('_')[0] || null;
                if (!(entityCode && childrenEntityCodes.includes(`${entityCode}s`))) {
                    childPaginationInfo[key] = value;
                }
            }
        }));
        return childPaginationInfo;
    }
    /**
     * 更新分页配置信息
     * @private
     * @param {?} paginationInfo 服务器分页信息
     * @return {?}
     */
    updatePagination(paginationInfo) {
        if (!paginationInfo) {
            return;
        }
        /** @type {?} */
        let childrenEntityCodes = [];
        DataTypeInfoUtil.getChildrenNodeCodes(this.repository.entityTypeInfo, childrenEntityCodes);
        childrenEntityCodes = childrenEntityCodes.map((/**
         * @param {?} item
         * @return {?}
         */
        item => item.substr(0, item.length - 1)));
        if (!paginationInfo || Object.keys(paginationInfo).length < 1) {
            if (childrenEntityCodes && childrenEntityCodes.length > 0) {
                childrenEntityCodes.forEach((/**
                 * @param {?} nodeCode
                 * @return {?}
                 */
                (nodeCode) => {
                    /** @type {?} */
                    const original = this.repository.entityCollection.getPaginationConfigByPath(`/${nodeCode}`);
                    if (original) {
                        original.pageIndex = 1;
                        original.total = 0;
                        this.repository.entityCollection.setPaginationConfigByPath(`/${nodeCode}`, original);
                    }
                }));
            }
            return;
        }
        Object.keys(paginationInfo).forEach((/**
         * @param {?} key
         * @return {?}
         */
        key => {
            // const entityName = childrenEntityCodes.find(item => key.startsWith(`${item}_`));
            this.repository.entityCollection.setPaginationConfigByPath(`/${key}`, paginationInfo[key]);
        }));
        // childrenEntityCodes.forEach((nodeCode: string) => {
        //   // 确认后端返回的分页信息中是否包含当前实体的分页信息，如果不包含则将index置为1、总条数置为0
        //   // 获取该实体对应到分页信息中key
        //   const key = Object.keys(paginationInfo).find((key: string) => key.startsWith(`${nodeCode}_`));
        //   // 分页中包含当前实体的分页信息
        //   if (key) {
        //     // paginationInfo[key].total = paginationInfo[key].totalCount;
        //     this.repository.entityCollection.setPaginationConfigByPath(`/${key}`, paginationInfo[key]);
        //   } else {
        //     // TODO: 需确认是否必须设置空分页信息
        //     // const original = this.repository.entityCollection.getPaginationConfigByPath(`/${nodeCode}`);
        //     // if (original) {
        //     //   original.pageIndex = 1;
        //     //   original.total = 0;
        //     //   this.repository.entityCollection.setPaginationConfigByPath(`/${nodeCode}`, original);
        //     // }
        //   }
        // });
    }
    /**
     * 构造retrieve分页信息
     * \@description 该请求不需要携带parentIds参数，只有切换从从表时才需要使用添加parentIds参数
     * @private
     * @return {?}
     */
    buildRetrieveParam() {
        /** @type {?} */
        const childPaginationInfo = this.buildChildrenPagination();
        if (!childPaginationInfo || Object.keys(childPaginationInfo).length < 1) {
            return null;
        }
        /** @type {?} */
        const retrieveParam = { filters: {}, parentIds: {} };
        /** @type {?} */
        let childrenEntityCodes = [];
        ExpressionUtil.getChildrenEntityPaths(this.repository.entityTypeInfo, childrenEntityCodes);
        Object.keys(childPaginationInfo).forEach((/**
         * @param {?} typeName
         * @return {?}
         */
        typeName => {
            /** @type {?} */
            const entity = childPaginationInfo[typeName];
            /** @type {?} */
            const pageIndex = entity.pageIndex || 1;
            retrieveParam.filters[typeName] = { pagination: { pageSize: entity.pageSize || 0, pageIndex: pageIndex } };
            // if (this.isChildrenTable(typeName)) {
            //   retrieveParam.parentIds[typeName] = this.getId(typeName, pageIndex);
            // }
        }));
        return retrieveParam;
    }
    /*
      private getId(nodeCode: string, pageIndex: number): string {
        const viewModel = this.injector.get<ViewModel>(ViewModel, null);
        const { pageIndex: originalPageIndex = 1 } = this.repository.entityCollection.getPaginationConfigByPath(`/${nodeCode}`) || {};
        if (pageIndex !== originalPageIndex) {
          return null;
        }
        if (viewModel) {
          const bindingList = viewModel.bindingData.getValue([`${nodeCode}s`]) as BindingList;
          if (bindingList && bindingList.currentId) {
            return bindingList.currentId;
          }
        }
        return null;
      }
      private isChildrenTable(nodeCode: string) {
        let childrenEntityCodes: any[] = [];
        nodeCode += 's';
        ExpressionUtil.getChildrenEntityPaths(this.repository.entityTypeInfo, childrenEntityCodes);
        if (childrenEntityCodes && childrenEntityCodes.length > 0) {
          const index = childrenEntityCodes.findIndex((paths: string[]) => paths.length === 1 && paths[0] === nodeCode);
          return index !== -1;
        }
        return false;
      }*/
    /**
     * 更新并对实体加锁
     * @param {?} id 实体id
     * @return {?}
     */
    editById(id) {
        /** @type {?} */
        const entity = this.repository.entityCollection.getEntityById(id);
        if (!entity) {
            return of(null);
        }
        /** @type {?} */
        const requestInfo = BefProxyUtil.buildRequestInfo(this.repository);
        /** @type {?} */
        const retrieve$ = this.restProxy.edit(id, requestInfo);
        /** @type {?} */
        const result$ = retrieve$.pipe(map((/**
         * @param {?} responseInfo
         * @return {?}
         */
        (responseInfo) => {
            /** @type {?} */
            const entityData = responseInfo.returnValue.data;
            /** @type {?} */
            const entityToUpdate = this.repository.entityCollection.getEntityById(id);
            if (entityToUpdate && entityData) {
                this.reloadEntityData(entityToUpdate, entityData);
            }
            return entityToUpdate;
        })));
        return result$;
    }
    /**
     * 根据id更新实体
     * @param {?} id 实体id
     * @return {?}
     */
    updateById(id) {
        // 如果要更新的实体不存在，返回一个null流；
        // @todo：返回empty()还是null流，为了不影响现有行为，临时返回null流。
        /** @type {?} */
        const entity = this.repository.entityCollection.getEntityById(id);
        if (!entity) {
            return of(null);
        }
        /** @type {?} */
        const requestInfo = this.restService.buildRequestInfo();
        /** @type {?} */
        const retrieveParam = this.buildRetrieveParam();
        if (retrieveParam) {
            return this.updateEntityById(id);
        }
        /** @type {?} */
        const retrieve$ = this.restService.extendRetrieve(id, requestInfo, retrieveParam);
        /** @type {?} */
        const result$ = retrieve$.pipe(map((/**
         * @param {?} responseInfo
         * @return {?}
         */
        (responseInfo) => {
            /** @type {?} */
            const entityData = responseInfo.returnValue;
            /** @type {?} */
            const entityToUpdate = this.repository.entityCollection.getEntityById(id);
            this.reloadEntityData(entityToUpdate, entityData);
            return entityToUpdate;
        })));
        return result$;
    }
    /**
     * 根据id更新实体
     * @param {?} id 实体id
     * @return {?}
     */
    updateEntityById(id) {
        // 获取所有分页信息
        /** @type {?} */
        const requestInfo = this.restService.buildRequestInfo();
        // 构造分页信息
        /** @type {?} */
        const retrieveParam = this.buildRetrieveParam();
        /** @type {?} */
        const retrieve$ = this.restService.serviceRetrieve(id, retrieveParam, requestInfo);
        /** @type {?} */
        const result$ = retrieve$.pipe(map((/**
         * @param {?} responseInfo
         * @return {?}
         */
        (responseInfo) => {
            /** @type {?} */
            const returnValue = responseInfo.returnValue || {};
            /** @type {?} */
            const entityData = returnValue.result;
            /** @type {?} */
            const serverPaginationInfo = returnValue.pagination;
            this.updatePagination(serverPaginationInfo);
            /** @type {?} */
            const entityToUpdate = this.repository.entityCollection.getEntityById(id);
            this.reloadEntityData(entityToUpdate, entityData);
            return entityToUpdate;
        })));
        return result$;
    }
    /**
     * 重新加载实体数据
     * \@todo：
     * 1、根本上应该在重新load数据的时候，只发送根节点的一次Load变更；
     * 2、考虑到稳定性和改动量，暂时采取此过渡方案，重构Entity时彻底解决。
     * @private
     * @param {?} entity
     * @param {?} entityData 要重载的数据
     * @return {?}
     */
    reloadEntityData(entity, entityData) {
        if (!entity) {
            return;
        }
        // 关闭变更检测
        this.appContext.changeDetectionController.detach();
        // retrieve之后已经是最新数据，移除变更
        // entity.load(entityData);
        this.repository.entityCollection.updateEntity(entity, entityData);
        // 重新加载数据不应该产生变更
        entity.changes.splice(0, entity.changes.length);
        // 重新打开变更检测
        this.appContext.changeDetectionController.reattach();
    }
    /**
     * 创建新实体，并加载
     * @param {?=} defaultValue
     * @return {?}
     */
    create(defaultValue) {
        /** @type {?} */
        const requestInfo = this.restService.buildRequestInfo();
        /** @type {?} */
        const result$ = this.restService.create(defaultValue, requestInfo);
        return result$.pipe(map((/**
         * @param {?} responseInfo
         * @return {?}
         */
        (responseInfo) => {
            /** @type {?} */
            const newData = responseInfo.returnValue;
            /** @type {?} */
            const newEntity = this.repository.buildEntity(newData);
            EntityUtil.appendInitialData(newEntity, newData);
            this.repository.entityCollection.loadEntities([newEntity], true);
            // this.repository.dataChangeHistory.addChange({ dataId: newEntity.primaryValue, changeType: DataChangeType.Add });
            return newEntity;
        })));
    }
    /**
     * 追加实体
     * @param {?=} defaultValue
     * @return {?}
     */
    append(defaultValue) {
        /** @type {?} */
        const requestInfo = this.restService.buildRequestInfo();
        /** @type {?} */
        const append$ = this.restService.create(defaultValue, requestInfo);
        return append$.pipe(map((/**
         * @param {?} responseInfo
         * @return {?}
         */
        (responseInfo) => {
            /** @type {?} */
            const newData = responseInfo.returnValue;
            /** @type {?} */
            const newEntity = this.repository.buildEntity(newData);
            this.repository.entityCollection.addEntity(newEntity);
            // this.repository.dataChangeHistory.addChange({ dataId: newEntity.primaryValue, changeType: DataChangeType.Add });
            return newEntity;
        })));
    }
    /**
     * 插入数据
     * @param {?} position 数据插入位置
     * @param {?=} defaultValue 默认值
     * @return {?}
     */
    insert(position, defaultValue) {
        /** @type {?} */
        const requestInfo = this.buildRequestInfo();
        /** @type {?} */
        const insert$ = this.restProxy.create(defaultValue, requestInfo);
        return insert$.pipe(map((/**
         * @param {?} responseInfo
         * @return {?}
         */
        (responseInfo) => {
            /** @type {?} */
            const newData = responseInfo.returnValue;
            /** @type {?} */
            const newEntity = this.repository.buildEntity(newData);
            this.repository.entityCollection.insertEntity(newEntity, position);
            return newEntity;
        })));
    }
    /**
     * 创建子实体，并追加
     * @param {?} fpath 父路径，格式形如：/1/edus（从表）或/1/edus/2/grades（从从表）
     * @return {?}
     */
    appendByPath(fpath) {
        /** @type {?} */
        const requestInfo = this.restService.buildRequestInfo();
        /** @type {?} */
        const append$ = this.restService.createByPath(fpath, requestInfo);
        return append$.pipe(map((/**
         * @param {?} responseInfo
         * @return {?}
         */
        (responseInfo) => {
            /** @type {?} */
            const newData = responseInfo.returnValue;
            /** @type {?} */
            const newEntity = this.repository.entityManager.appendEntityByPath(fpath, newData, newData);
            return newEntity;
        })));
    }
    /**
     * 创建子实体并插入到指定位置
     * @param {?} fpath 父路径
     * @param {?} position 数据插入位置
     * @return {?}
     */
    insertByPath(fpath, position) {
        /** @type {?} */
        const requestInfo = this.buildRequestInfo();
        /** @type {?} */
        const insert$ = this.restProxy.createByPath(fpath, requestInfo);
        return insert$.pipe(map((/**
         * @param {?} responseInfo
         * @return {?}
         */
        (responseInfo) => {
            /** @type {?} */
            const newData = responseInfo.returnValue;
            /** @type {?} */
            const newEntity = this.repository.entityManager.insertEntityByPath(fpath, newData, newData, position);
            return newEntity;
        })));
    }
    /**
     * 根据id删除实体
     * @param {?} id 内码
     * @param {?=} ifSave
     * @return {?}
     */
    removeById(id, ifSave) {
        ifSave = (ifSave === undefined) ? true : ifSave;
        /** @type {?} */
        const requestInfo = BefProxyUtil.buildRequestInfo(this.repository);
        /** @type {?} */
        let delete$;
        if (ifSave) {
            delete$ = this.restProxy.deleteAndSave(id, requestInfo);
            return delete$.pipe(switchMap((/**
             * @return {?}
             */
            () => {
                this.repository.entityCollection.removeEntityById(id);
                return of(true);
            })));
        }
        else {
            delete$ = this.restService.extendDelete(id, requestInfo);
            return delete$.pipe(switchMap((/**
             * @return {?}
             */
            () => {
                this.repository.entityCollection.removeEntityById(id);
                this.repository.dataChangeHistory.addChange({ dataId: id, changeType: DataChangeType.Delete });
                return of(true);
            })));
        }
    }
    /**
     * 删除并保存
     * @param {?} id 要删除的实体id
     * @return {?}
     */
    removeAndSaveById(id) {
        /** @type {?} */
        const requestInfo = BefProxyUtil.buildRequestInfo(this.repository);
        /** @type {?} */
        const delete$ = this.restProxy.deleteAndSave(id, requestInfo);
        /** @type {?} */
        const result$ = delete$.pipe(switchMap((/**
         * @return {?}
         */
        () => {
            this.repository.entityCollection.removeEntityById(id);
            // this.repository.dataChangeHistory.addChange({ dataId: id, changeType: DataChangeType.Delete });
            return of(true);
        })));
        return result$;
    }
    /**
     * 批量删除
     * @param {?} ids
     * @param {?=} ifSave 是否保存
     * @return {?}
     */
    removeByIds(ids, ifSave) {
        ifSave = (ifSave === undefined) ? true : ifSave;
        // 服务器端删除
        /** @type {?} */
        const requestInfo = this.restService.buildRequestInfo();
        /** @type {?} */
        const delete$ = this.restService.extendBatchDelete(ids, requestInfo);
        // 从本地实体集合中移除
        return delete$.pipe(switchMap((/**
         * @return {?}
         */
        () => {
            if (ifSave) {
                // 执行保存
                return this.applyChangesByIdArray(ids).pipe(tap((/**
                 * @param {?} result
                 * @return {?}
                 */
                result => {
                    if (result) {
                        // 从实体集合中删除
                        this.repository.entityCollection.removeEntities((/**
                         * @param {?} value
                         * @return {?}
                         */
                        (value) => {
                            return this.checkEntityValueExists(value, ids);
                        }));
                    }
                })));
            }
            else {
                // 从实体集合中删除
                this.repository.entityCollection.removeEntities((/**
                 * @param {?} value
                 * @return {?}
                 */
                (value) => {
                    return this.checkEntityValueExists(value, ids);
                }));
                if (ids && ids.length > 0) {
                    /** @type {?} */
                    const changes = [];
                    ids.forEach((/**
                     * @param {?} id
                     * @return {?}
                     */
                    id => {
                        changes.push({ dataId: id, changeType: DataChangeType.Delete });
                    }));
                    this.repository.dataChangeHistory.addChanges(changes);
                }
                return of(true);
            }
        })));
    }
    /**
     * 根据ids批量删除实体
     * @param {?} ids ids
     * @param {?} ifSave 是否保存
     * @return {?}
     */
    batchRemove(ids, ifSave) {
        /** @type {?} */
        const requestInfo = this.restService.buildRequestInfo();
        /** @type {?} */
        const delete$ = this.restService.extendBatchDeletion(ids, requestInfo);
        // 从本地实体集合中移除
        return delete$.pipe(switchMap((/**
         * @return {?}
         */
        () => {
            if (ifSave) {
                // 执行保存
                return this.applyChangesByIdArray(ids).pipe(tap((/**
                 * @param {?} result
                 * @return {?}
                 */
                result => {
                    if (result) {
                        // 从实体集合中删除
                        this.removeEntities(ids);
                    }
                })));
            }
            else {
                // 从实体集合中删除
                this.removeEntities(ids);
                this.addBatchRemoveHistory(ids);
                return of(true);
            }
        })));
    }
    /**
     * 添加批量删除记录到变更记录中
     * @private
     * @param {?} ids ids
     * @return {?}
     */
    addBatchRemoveHistory(ids) {
        if (ids && ids.length > 0) {
            /** @type {?} */
            const changes = [];
            ids.forEach((/**
             * @param {?} id
             * @return {?}
             */
            id => {
                changes.push({ dataId: id, changeType: DataChangeType.Delete });
            }));
            this.repository.dataChangeHistory.addChanges(changes);
        }
    }
    /**
     * 从实体仓库中批量移除指定id的数据
     * @private
     * @param {?} ids
     * @return {?}
     */
    removeEntities(ids) {
        this.repository.entityCollection.removeEntities((/**
         * @param {?} value
         * @return {?}
         */
        (value) => {
            return this.checkEntityValueExists(value, ids);
        }));
    }
    /**
     * 检测实体的主键值是否存在于数组中，如果存在返回true
     * @private
     * @param {?} entity
     * @param {?} primaryValueArray
     * @return {?}
     */
    checkEntityValueExists(entity, primaryValueArray) {
        /** @type {?} */
        let isExistInTargetArray = false;
        for (let i = 0; i < primaryValueArray.length; i++) {
            if (entity.primaryValue === primaryValueArray[i]) {
                isExistInTargetArray = true;
                break;
            }
        }
        return isExistInTargetArray;
    }
    /**
     * 删除子级
     * @param {?} fpath
     * @param {?} id   内码
     * @return {?}
     */
    removeByPath(fpath, id) {
        // 服务器端删除
        /** @type {?} */
        const requestInfo = this.restService.buildRequestInfo();
        /** @type {?} */
        const delete$ = this.restService.extendDeletByPath(fpath, id, requestInfo);
        // 从本地实体集合中移除
        return delete$.pipe(map((/**
         * @return {?}
         */
        () => {
            this.repository.entityManager.removeEntityByPath(fpath, id);
            this.repository.dataChangeHistory.addChange({ fpath, dataId: id, changeType: DataChangeType.Delete });
            return true;
        })));
    }
    /**
     * 批量删除子级
     * @param {?} fPath 路径
     * @param {?} ids  子级id集合
     * @return {?}
     */
    batchRemoveByPath(fPath, ids) {
        // 服务器端删除
        /** @type {?} */
        const requestInfo = this.restService.buildRequestInfo();
        /** @type {?} */
        const delete$ = this.restService.batchDeleteByPath(fPath, ids, requestInfo);
        // 从本地实体集合中移除
        return delete$.pipe(map((/**
         * @return {?}
         */
        () => {
            /** @type {?} */
            const idArray = ids.split(',');
            if (idArray.length > 0) {
                idArray.forEach((/**
                 * @param {?} id
                 * @return {?}
                 */
                (id) => {
                    this.repository.entityManager.removeEntityByPath(fPath, id);
                    this.repository.dataChangeHistory.addChange({ fPath, dataId: id, changeType: DataChangeType.Delete });
                }));
            }
            return true;
        })));
    }
    /**
     * 将id对应的实体的变更提交的服务器端
     * @param {?} id
     * @return {?}
     */
    updateChangesById(id) {
        /** @type {?} */
        const entity = this.repository.entityCollection.getEntityById(id);
        // 变更集不存在
        if (!entity.changes) {
            return of(true);
        }
        // 变更集为空
        if (entity.changes.length === 0) {
            return of(true);
        }
        /** @type {?} */
        const changeDetail = this.repository.entityManager.buildEntityChangeDetailById(id);
        /** @type {?} */
        const requestInfo = this.restService.buildRequestInfo();
        /** @type {?} */
        const update$ = this.restService.update(changeDetail, requestInfo);
        /** @type {?} */
        const result$ = update$.pipe(tap((/**
         * @return {?}
         */
        () => {
            this.repository.entityManager.clearEntityChangesById(id);
        })), map((/**
         * @return {?}
         */
        () => {
            return true;
        })));
        return result$;
    }
    /**
     * 提交path对应实体的变更
     * @param {?} path
     * @param {?} id
     * @return {?}
     */
    updateChangesByPath(path, id) {
        throw new Error('Not Implement');
    }
    /**
     * 提交所有变更
     * @return {?}
     */
    updateAllChanges() {
        // 遍历实体，提交变更
        /** @type {?} */
        const updateResults = [];
        /** @type {?} */
        const entities = this.repository.entityCollection.toArray();
        if (entities.length === 0) {
            return of(true);
        }
        entities.forEach((/**
         * @param {?} entity
         * @return {?}
         */
        (entity) => {
            /** @type {?} */
            const updateResult$ = this.updateChangesById(entity.primaryValue);
            updateResults.push(updateResult$);
        }));
        // 串联流
        /** @type {?} */
        const result$ = zip(...updateResults).pipe(map((/**
         * @return {?}
         */
        () => {
            return true;
        })));
        return result$;
    }
    /**
     * 应用变更
     * @return {?}
     */
    applyChanges() {
        /** @type {?} */
        const requestInfo = this.restService.buildRequestInfo();
        /** @type {?} */
        const save$ = this.restService.save(requestInfo);
        /** @type {?} */
        const result$ = save$.pipe(tap((/**
         * @return {?}
         */
        () => {
            this.repository.entityManager.clearAllEntityChanges();
            this.repository.clearAllVariableChanges(requestInfo.variableChange);
            this.repository.dataChangeHistory.clear();
        })), map((/**
         * @return {?}
         */
        () => {
            return true;
        })));
        return result$;
    }
    /**
     * 应用idArray对应数据的变更
     * @param {?} idArray
     * @return {?}
     */
    applyChangesByIdArray(idArray) {
        /** @type {?} */
        const requestInfo = this.restService.buildRequestInfo();
        /** @type {?} */
        const save$ = this.restService.save(requestInfo);
        /** @type {?} */
        const result$ = save$.pipe(tap((/**
         * @return {?}
         */
        () => {
            this.repository.entityManager.clearEntityChangesByArray(idArray);
            this.repository.dataChangeHistory.clearByIds(idArray);
        })), map((/**
         * @return {?}
         */
        () => {
            return true;
        })));
        return result$;
    }
    /**
     * 应用id对应数据的变更
     * @param {?} id
     * @return {?}
     */
    applyChangesById(id) {
        /** @type {?} */
        const requestInfo = this.restService.buildRequestInfo();
        /** @type {?} */
        const save$ = this.restService.save(requestInfo);
        /** @type {?} */
        const result$ = save$.pipe(tap((/**
         * @return {?}
         */
        () => {
            this.repository.entityManager.clearEntityChangesById(id);
            this.repository.dataChangeHistory.clearByIds([id]);
        })), map((/**
         * @return {?}
         */
        () => {
            return true;
        })));
        return result$;
    }
    /**
     * 取消变更
     * @param {?=} options
     * @return {?}
     */
    cancelChanges(options) {
        /** @type {?} */
        const cancel$ = this.restService.cancel(options);
        /** @type {?} */
        const result$ = cancel$.pipe(tap((/**
         * @return {?}
         */
        () => {
            this.repository.entityManager.clearAllEntityChanges();
            this.repository.dataChangeHistory.clear();
        })), map((/**
         * @return {?}
         */
        () => {
            return true;
        })));
        return result$;
    }
    /**
     * 批量新增从表/从从表数据
     * @param {?} path 实体绑定路径，like 1/childs or 1/childs/11/childchilds
     * @param {?} defaultValues 默认实体数据数组
     * @return {?}
     */
    batchAppendByPath(path, defaultValues) {
        /** @type {?} */
        const requestInfo = this.buildRequestInfo();
        /** @type {?} */
        const append$ = this.restProxy.batchAppendByPath(path, defaultValues, requestInfo);
        return append$.pipe(map((/**
         * @param {?} responseInfo
         * @return {?}
         */
        (responseInfo) => {
            /** @type {?} */
            const list = responseInfo.returnValue;
            /** @type {?} */
            const entities = this.repository.entityManager.createEntitiesByPath(path, list);
            /** @type {?} */
            const paths = path.split('/').filter((/**
             * @param {?} p
             * @return {?}
             */
            p => p));
            this.repository.entityManager.appendEntitiesByPath(paths, entities);
            return entities;
        })));
    }
    /**
     * 批量新增主表数据
     * @param {?} defaultValues 默认实体数据数组
     * @return {?}
     */
    batchAppend(defaultValues) {
        /** @type {?} */
        const requestInfo = this.buildRequestInfo();
        /** @type {?} */
        const append$ = this.restProxy.batchAppend(defaultValues, requestInfo);
        return append$.pipe(map((/**
         * @param {?} responseInfo
         * @return {?}
         */
        (responseInfo) => {
            /** @type {?} */
            const list = responseInfo.returnValue;
            /** @type {?} */
            const entities = this.repository.buildEntities(list);
            this.repository.entityCollection.addEntities(entities);
            return entities;
        })));
    }
    /**
     * 构造变更集
     * @return {?}
     */
    buildRequestInfo() {
        /** @type {?} */
        const requestInfo = {
            dataChange: this.repository.entityManager.buildAllEntityChangeDetails(),
            variableChange: this.repository.variableManager.buildChangeDetail()
        };
        return requestInfo;
    }
}
if (false) {
    /**
     * 全局上下文
     * @type {?}
     * @private
     */
    BefDataService.prototype.appContext;
    /**
     * 实体仓库
     * @type {?}
     * @private
     */
    BefDataService.prototype.repository;
    /**
     * RestService实例(请使用restProxy代替)
     * @deprecated
     * @type {?}
     */
    BefDataService.prototype.restService;
    /**
     * @type {?}
     * @private
     */
    BefDataService.prototype.injector;
}
export { BefDataService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmVmX2RhdGFfc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvYmVmLyIsInNvdXJjZXMiOlsibGliL2JlZl9kYXRhX3NlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFPQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDbEQsT0FBTyxFQUFjLEVBQUUsRUFBRSxHQUFHLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDM0MsT0FBTyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFckQsT0FBTyxFQUFVLFFBQVEsRUFBYyxVQUFVLEVBQUUsY0FBYyxFQUFFLGdCQUFnQixFQUFpQixTQUFTLEVBQUUsY0FBYyxFQUFlLE1BQU0sZ0JBQWdCLENBQUM7QUFHbkssT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFDdEUsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQ3BELE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUcvQyxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDaEQsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7Ozs7Ozs7OztBQVF2RCxNQUFNLGNBQWM7Ozs7OztJQTRCbEIsWUFBb0IsUUFBa0IsRUFBRSxVQUE0QjtRQUFoRCxhQUFRLEdBQVIsUUFBUSxDQUFVO1FBQ3BDLElBQUksQ0FBQyxVQUFVLEdBQUcsVUFBVSxDQUFDOztjQUV2QixpQkFBaUIsR0FBRyxRQUFRLENBQUMsR0FBRyxDQUEwQix1QkFBdUIsQ0FBQzs7Y0FDbEYsVUFBVSxHQUFHLFFBQVEsQ0FBQyxHQUFHLENBQWEsVUFBVSxDQUFDOztjQUNqRCxTQUFTLEdBQUcsUUFBUSxDQUFDLEdB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IDIwMTktMDMtMDcgMTY6NTU6MzNcclxuICogQExhc3QgTW9kaWZpZWQgYnk6IGFhbGl6endlbGxcclxuICogQExhc3QgTW9kaWZpZWQgdGltZTogMjAxOS0xMC0wOSAxNjo0NDo1OFxyXG4gKi9cclxuaW1wb3J0IHsgSW5qZWN0YWJsZSwgSW5qZWN0b3IgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgSHR0cENsaWVudCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgb2YsIHppcCB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyB0YXAsIG1hcCwgc3dpdGNoTWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5cclxuaW1wb3J0IHsgRW50aXR5LCBFdmVudEJ1cywgTW9kaWZ5VHlwZSwgQXBwQ29udGV4dCwgRGF0YUNoYW5nZVR5cGUsIERhdGFUeXBlSW5mb1V0aWwsIERhdGFQcm9wR3JvdXAsIFZpZXdNb2RlbCwgRXhwcmVzc2lvblV0aWwsIEJpbmRpbmdMaXN0IH0gZnJvbSAnQGZhcnJpcy9kZXZraXQnO1xyXG5cclxuaW1wb3J0IHsgUmVzcG9uc2VJbmZvLCBRdWVyeVJlc3VsdCwgUGFnaW5hdGlvbiwgUmVxdWVzdEluZm8sIFJldHJpZXZlUGFyYW0gfSBmcm9tICcuL3R5cGVzJztcclxuaW1wb3J0IHsgRnJhbWV3b3JrU2Vzc2lvblNlcnZpY2UgfSBmcm9tICcuL2ZyYW1ld29ya19zZXNzaW9uX3NlcnZpY2UnO1xyXG5pbXBvcnQgeyBCZWZSZXN0U2VydmljZSB9IGZyb20gJy4vYmVmX3Jlc3Rfc2VydmljZSc7XHJcbmltcG9ydCB7IEJFX1NFUlZFUl9VUklfVE9LRU4gfSBmcm9tICcuL3Rva2Vucyc7XHJcbmltcG9ydCB7IEJlZlJlcG9zaXRvcnkgfSBmcm9tICcuL2JlZl9yZXBvc2l0b3J5JztcclxuaW1wb3J0IHsgQmVmUHJveHkgfSBmcm9tICcuL2JlZl9wcm94eSc7XHJcbmltcG9ydCB7IEJlZlByb3h5VXRpbCB9IGZyb20gJy4vYmVmX3Byb3h5X3V0aWwnO1xyXG5pbXBvcnQgeyBFbnRpdHlVdGlsIH0gZnJvbSAnLi9lbnRpdHlfdXRpbCc7XHJcbmltcG9ydCB7IEJlZkRhdGFQYXRoVXRpbCB9IGZyb20gJy4vYmVmX2RhdGFfcGF0aF91dGlsJztcclxuLyoqXHJcbiAqIEJlZuaVsOaNruiuv+mXruacjeWKoVxyXG4gKiBAdG9kb++8mlxyXG4gKiAx44CB5Li05pe25bCGQmVmUmVwb3NpdG9yeeebuOWFs+S7o+eggei9rOenu+WIsOivpeexu+S4re+8m1xyXG4gKiAy44CB6L+b5LiA5q2l5piO56Gu6IGM6LSj77yM6LCD5pW057uT5p6EXHJcbiAqL1xyXG4vLyB0c2xpbnQ6ZGlzYWJsZTogbm8tc3RyaW5nLWxpdGVyYWxcclxuY2xhc3MgQmVmRGF0YVNlcnZpY2U8VCBleHRlbmRzIEVudGl0eT4ge1xyXG5cclxuICAvKipcclxuICAgKiDlhajlsYDkuIrkuIvmlodcclxuICAgKi9cclxuICBwcml2YXRlIGFwcENvbnRleHQ6IEFwcENvbnRleHQ7XHJcblxyXG4gIC8qKlxyXG4gICAqIOWunuS9k+S7k+W6k1xyXG4gICAqL1xyXG4gIHByaXZhdGUgcmVwb3NpdG9yeTogQmVmUmVwb3NpdG9yeTxUPjtcclxuXHJcbiAgLyoqXHJcbiAgICogQmVmUmVzdOS7o+eQhlxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXQgcmVzdFByb3h5KCk6IEJlZlByb3h5IHtcclxuICAgIHJldHVybiB0aGlzLnJlcG9zaXRvcnkucmVzdFNlcnZpY2UucHJveHk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXN0U2VydmljZeWunuS+iyjor7fkvb/nlKhyZXN0UHJveHnku6Pmm78pXHJcbiAgICogQGRlcHJlY2F0ZWRcclxuICAgKi9cclxuICBwdWJsaWMgcmVzdFNlcnZpY2U6IEJlZlJlc3RTZXJ2aWNlO1xyXG5cclxuICAvKipcclxuICAgKiDmnoTpgKDlh73mlbBcclxuICAgKi9cclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGluamVjdG9yOiBJbmplY3RvciwgcmVwb3NpdG9yeTogQmVmUmVwb3NpdG9yeTxUPikge1xyXG4gICAgdGhpcy5yZXBvc2l0b3J5ID0gcmVwb3NpdG9yeTtcclxuXHJcbiAgICBjb25zdCBmcm1TZXNzaW9uU2VydmljZSA9IGluamVjdG9yLmdldDxGcmFtZXdvcmtTZXNzaW9uU2VydmljZT4oRnJhbWV3b3JrU2Vzc2lvblNlcnZpY2UpO1xyXG4gICAgY29uc3QgaHR0cENsaWVudCA9IGluamVjdG9yLmdldDxIdHRwQ2xpZW50PihIdHRwQ2xpZW50KTtcclxuICAgIGNvbnN0IHNlcnZlclVyaSA9IGluamVjdG9yLmdldDxzdHJpbmc+KEJFX1NFUlZFUl9VUklfVE9LRU4pO1xyXG5cclxuICAgIC8vIOWIm+W7ukJlZlJlc3RTZXJ2aWNl5a6e5L6LXHJcbiAgICBjb25zdCByZXN0QmFzZVVyaSA9IGAke3NlcnZlclVyaX0vJHt0aGlzLnJlcG9zaXRvcnkuYXBpVXJpfWA7XHJcblxyXG4gICAgY29uc3QgZXZlbnRCdXM6IEV2ZW50QnVzID0gaW5qZWN0b3IuZ2V0PEV2ZW50QnVzPihFdmVudEJ1cyk7XHJcbiAgICB0aGlzLnJlc3RTZXJ2aWNlID0gbmV3IEJlZlJlc3RTZXJ2aWNlKGh0dHBDbGllbnQsIHJlc3RCYXNlVXJpLCBmcm1TZXNzaW9uU2VydmljZSwgdGhpcy5yZXBvc2l0b3J5LCBldmVudEJ1cyk7XHJcblxyXG4gICAgdGhpcy5hcHBDb250ZXh0ID0gaW5qZWN0b3IuZ2V0PEFwcENvbnRleHQ+KEFwcENvbnRleHQpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+W5a6e5L2T6ZuG5ZCIXHJcbiAgICovXHJcbiAgcHVibGljIGdldExpc3QoZmlsdGVyOiBhbnlbXSwgc29ydDogYW55W10sIHBhZ2VTaXplOiBudW1iZXIgfCBudWxsLCBwYWdlSW5kZXg6IG51bWJlciB8IG51bGwpOiBPYnNlcnZhYmxlPFRbXT4ge1xyXG4gICAgaWYgKHBhZ2VTaXplICE9PSAwKSB7XHJcbiAgICAgIHBhZ2VTaXplID0gcGFnZVNpemUgfHwgdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24ucGFnZVNpemU7XHJcbiAgICAgIHBhZ2VJbmRleCA9IHBhZ2VJbmRleCB8fCB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5wYWdlSW5kZXg7XHJcbiAgICB9XHJcbiAgICBjb25zdCBlbnRpdHlGaWx0ZXIgPSB0aGlzLmJ1aWxkRW50aXR5RmlsdGVyKGZpbHRlciwgc29ydCwgcGFnZVNpemUsIHBhZ2VJbmRleCk7XHJcbiAgICBjb25zdCByZXF1ZXN0SW5mbyA9IHRoaXMucmVzdFNlcnZpY2UuYnVpbGRSZXF1ZXN0SW5mbygpO1xyXG4gICAgY29uc3QgZmlsdGVyJCA9IHRoaXMucmVzdFByb3h5LmV4dGVuZFF1ZXJ5KGVudGl0eUZpbHRlciwgcmVxdWVzdEluZm8pO1xyXG4gICAgcmV0dXJuIGZpbHRlciQucGlwZShcclxuICAgICAgbWFwKChyZXNwb25zZUluZm86IFJlc3BvbnNlSW5mbykgPT4ge1xyXG4gICAgICAgIGNvbnN0IHF1ZXJ5UmVzdWx0ID0gcmVzcG9uc2VJbmZvLnJldHVyblZhbHVlIGFzIFF1ZXJ5UmVzdWx0O1xyXG4gICAgICAgIGNvbnN0IGxpc3REYXRhID0gcXVlcnlSZXN1bHQucmVzdWx0O1xyXG4gICAgICAgIGNvbnN0IGVudGl0aWVzOiBUW10gPSBbXTtcclxuICAgICAgICBsaXN0RGF0YS5mb3JFYWNoKChkYXRhOiBhbnkpID0+IHtcclxuICAgICAgICAgIGNvbnN0IGVudGl0eSA9IHRoaXMucmVwb3NpdG9yeS5idWlsZEVudGl0eShkYXRhKTtcclxuICAgICAgICAgIEVudGl0eVV0aWwuYXBwZW5kSW5pdGlhbERhdGEoZW50aXR5LCBkYXRhKTtcclxuICAgICAgICAgIGVudGl0aWVzLnB1c2goZW50aXR5KTtcclxuICAgICAgICB9KTtcclxuICAgICAgICAvLyBCaW5kaW5nTGlzdCByOTXvvIzliIbpobXlj5jmm7Tpm4blj5bmtojvvIzlr7zoh7Torr7nva7liIbpobXkv6Hmga/lkI7kuI3kvJrop6blj5Hlj5jmm7Tkuovku7bvvIzmiYDku6XlsIbliqDovb3mlbDmja7mlL7liLDlkI7pnaJcclxuICAgICAgICBjb25zdCBzZXJ2ZXJQYWdpbmF0aW9uSW5mbyA9IHF1ZXJ5UmVzdWx0LnBhZ2luYXRpb24gYXMgUGFnaW5hdGlvbjtcclxuICAgICAgICBpZiAoISFzZXJ2ZXJQYWdpbmF0aW9uSW5mbyAmJiBPYmplY3Qua2V5cyhzZXJ2ZXJQYWdpbmF0aW9uSW5mbykubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgY29uc3QgeyBwYWdlU2l6ZSwgcGFnZUluZGV4LCB0b3RhbENvdW50IH0gPSBzZXJ2ZXJQYWdpbmF0aW9uSW5mbztcclxuICAgICAgICAgIC8vIOWkhOeQhuS4u+ihqOWIhumhteS/oeaBr1xyXG4gICAgICAgICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24udXBkYXRlUGFnaW5hdGlvbkluZm9CeVBhdGgoJy8nLCB7IHBhZ2VJbmRleCwgcGFnZVNpemUsIHRvdGFsQ291bnQgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLnVwZGF0ZVBhZ2luYXRpb25JbmZvQnlQYXRoKCcvJywgeyBwYWdlSW5kZXg6IDEsIHBhZ2VTaXplOiAwLCB0b3RhbENvdW50OiBlbnRpdGllcy5sZW5ndGggfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmxvYWRFbnRpdGllcyhlbnRpdGllcyk7XHJcbiAgICAgICAgcmV0dXJuIGVudGl0aWVzO1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6L+H5ruk5pWw5o2uXHJcbiAgICogQHBhcmFtIGZpbHRlciDov4fmu6TmnaHku7ZcclxuICAgKiBAcGFyYW0gc29ydCDmjpLluo/mnaHku7ZcclxuICAgKiBAcGFyYW0gcGFnZVNpemUg5YiG6aG15aSn5bCPXHJcbiAgICogQHBhcmFtIHBhZ2VJbmRleCDlvZPliY3liIbpobVcclxuICAgKi9cclxuICBwdWJsaWMgZmlsdGVyKGZpbHRlcjogYW55W10sIHNvcnQ6IGFueVtdLCBwYWdlU2l6ZTogbnVtYmVyIHwgbnVsbCwgcGFnZUluZGV4OiBudW1iZXIgfCBudWxsKTogT2JzZXJ2YWJsZTxUW10+IHtcclxuICAgIGlmIChwYWdlU2l6ZSAhPT0gMCkge1xyXG4gICAgICBwYWdlU2l6ZSA9IHBhZ2VTaXplIHx8IHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLnBhZ2VTaXplO1xyXG4gICAgICBwYWdlSW5kZXggPSBwYWdlSW5kZXggfHwgdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24ucGFnZUluZGV4O1xyXG4gICAgfVxyXG4gICAgY29uc3QgZW50aXR5RmlsdGVyID0gdGhpcy5idWlsZEVudGl0eUZpbHRlcihmaWx0ZXIsIHNvcnQsIHBhZ2VTaXplLCBwYWdlSW5kZXgpO1xyXG4gICAgY29uc3QgcmVxdWVzdEluZm8gPSB0aGlzLnJlc3RTZXJ2aWNlLmJ1aWxkUmVxdWVzdEluZm8oKTtcclxuICAgIGNvbnN0IGZpbHRlciQgPSB0aGlzLnJlc3RQcm94eS5maWx0ZXIoZW50aXR5RmlsdGVyLCByZXF1ZXN0SW5mbyk7XHJcbiAgICByZXR1cm4gZmlsdGVyJC5waXBlKFxyXG4gICAgICBtYXAoKHJlc3BvbnNlSW5mbzogUmVzcG9uc2VJbmZvKSA9PiB7XHJcbiAgICAgICAgY29uc3QgcXVlcnlSZXN1bHQgPSByZXNwb25zZUluZm8ucmV0dXJuVmFsdWUgYXMgUXVlcnlSZXN1bHQ7XHJcbiAgICAgICAgY29uc3QgbGlzdERhdGEgPSBxdWVyeVJlc3VsdC5yZXN1bHQ7XHJcbiAgICAgICAgY29uc3QgZW50aXRpZXM6IFRbXSA9IFtdO1xyXG4gICAgICAgIGxpc3REYXRhLmZvckVhY2goKGRhdGE6IGFueSkgPT4ge1xyXG4gICAgICAgICAgY29uc3QgZW50aXR5ID0gdGhpcy5yZXBvc2l0b3J5LmJ1aWxkRW50aXR5KGRhdGEpO1xyXG4gICAgICAgICAgRW50aXR5VXRpbC5hcHBlbmRJbml0aWFsRGF0YShlbnRpdHksIGRhdGEpO1xyXG4gICAgICAgICAgZW50aXRpZXMucHVzaChlbnRpdHkpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIC8vIEJpbmRpbmdMaXN0IHI5Ne+8jOWIhumhteWPmOabtOmbhuWPlua2iO+8jOWvvOiHtOiuvue9ruWIhumhteS/oeaBr+WQjuS4jeS8muinpuWPkeWPmOabtOS6i+S7tu+8jOaJgOS7peWwhuWKoOi9veaVsOaNruaUvuWIsOWQjumdolxyXG4gICAgICAgIGNvbnN0IHNlcnZlclBhZ2luYXRpb25JbmZvID0gcXVlcnlSZXN1bHQucGFnaW5hdGlvbiBhcyBQYWdpbmF0aW9uO1xyXG4gICAgICAgIGlmICghIXNlcnZlclBhZ2luYXRpb25JbmZvICYmIE9iamVjdC5rZXlzKHNlcnZlclBhZ2luYXRpb25JbmZvKS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICBjb25zdCB7IHBhZ2VTaXplLCBwYWdlSW5kZXgsIHRvdGFsQ291bnQgfSA9IHNlcnZlclBhZ2luYXRpb25JbmZvO1xyXG4gICAgICAgICAgLy8g5aSE55CG5Li76KGo5YiG6aG15L+h5oGvXHJcbiAgICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi51cGRhdGVQYWdpbmF0aW9uSW5mb0J5UGF0aCgnLycsIHsgcGFnZUluZGV4LCBwYWdlU2l6ZSwgdG90YWxDb3VudCB9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24udXBkYXRlUGFnaW5hdGlvbkluZm9CeVBhdGgoJy8nLCB7IHBhZ2VJbmRleDogMSwgcGFnZVNpemU6IDAsIHRvdGFsQ291bnQ6IGVudGl0aWVzLmxlbmd0aCB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24ubG9hZEVudGl0aWVzKGVudGl0aWVzKTtcclxuICAgICAgICByZXR1cm4gZW50aXRpZXM7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmnoTpgKBFbnRpdHlGaWx0ZXJcclxuICAgKi9cclxuICBwcml2YXRlIGJ1aWxkRW50aXR5RmlsdGVyKGZpbHRlcjogYW55W10sIHNvcnQ6IGFueVtdLCBwYWdlU2l6ZTogbnVtYmVyLCBwYWdlSW5kZXg6IG51bWJlcikge1xyXG4gICAgLy8gQHRvZG/vvJrkuLTml7blhbzlrrnogIHku6PnoIHvvIzpmY3kvY7mlLnliqjluKbmnaXnmoTpo47pmalcclxuICAgIGlmICghZmlsdGVyICYmICFzb3J0ICYmICFwYWdlU2l6ZSAmJiAhcGFnZUluZGV4KSB7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOe6oOato+acgOWQjuS4gOS4qui/h+a7pOadoeS7tueahFJlbGF0aW9uXHJcbiAgICBpZiAoZmlsdGVyICYmIGZpbHRlci5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGZpbHRlcltmaWx0ZXIubGVuZ3RoIC0gMV0uUmVsYXRpb24gPSAwO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGVudGl0eUZpbHRlciA9IHtcclxuICAgICAgRmlsdGVyQ29uZGl0aW9uczogZmlsdGVyLFxyXG4gICAgICBTb3J0Q29uZGl0aW9uczogc29ydCxcclxuICAgICAgSXNVc2VQYWdpbmF0aW9uOiBwYWdlU2l6ZSA9PT0gMCA/IGZhbHNlIDogdHJ1ZSxcclxuICAgICAgUGFnaW5hdGlvbjoge1xyXG4gICAgICAgIFBhZ2VJbmRleDogcGFnZUluZGV4LFxyXG4gICAgICAgIFBhZ2VTaXplOiBwYWdlU2l6ZSxcclxuICAgICAgICBQYWdlQ291bnQ6IDAsXHJcbiAgICAgICAgVG90YWxDb3VudDogMFxyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIGVudGl0eUZpbHRlcjtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6I635Y+W5Y2V5Liq5a6e5L2TXHJcbiAgICogQHBhcmFtIGlkIGlkXHJcbiAgICogQHBhcmFtIGVuYWJsZUNoaWxkcmVuUGFnaW5hdGlvbiBlblxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPFQ+IHtcclxuICAgIGNvbnN0IHJlcXVlc3RJbmZvID0gdGhpcy5yZXN0U2VydmljZS5idWlsZFJlcXVlc3RJbmZvKCk7XHJcbiAgICBjb25zdCByZXRyaWV2ZVBhcmFtID0gdGhpcy5idWlsZFJldHJpZXZlUGFyYW0oKTtcclxuICAgIGlmIChyZXRyaWV2ZVBhcmFtKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLmdldEVudGl0eUJ5SWQoaWQpO1xyXG4gICAgfVxyXG4gICAgY29uc3QgcmV0cmlldmUkID0gdGhpcy5yZXN0U2VydmljZS5leHRlbmRSZXRyaWV2ZShpZCwgcmVxdWVzdEluZm8sIHJldHJpZXZlUGFyYW0pO1xyXG4gICAgY29uc3QgcmVzdWx0JCA9IHJldHJpZXZlJC5waXBlKFxyXG4gICAgICBtYXAoKHJlc3BvbnNlSW5mbzogUmVzcG9uc2VJbmZvKSA9PiB7XHJcbiAgICAgICAgY29uc3QgZW50aXR5RGF0YSA9IHJlc3BvbnNlSW5mby5yZXR1cm5WYWx1ZTtcclxuICAgICAgICBjb25zdCBlbnRpdHkgPSB0aGlzLnJlcG9zaXRvcnkuYnVpbGRFbnRpdHkoZW50aXR5RGF0YSk7XHJcbiAgICAgICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24ubG9hZEVudGl0aWVzKFtlbnRpdHldKTtcclxuICAgICAgICByZXR1cm4gZW50aXR5O1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICAgIHJldHVybiByZXN1bHQkO1xyXG4gIH1cclxuICBwdWJsaWMgZ2V0RW50aXR5QnlJZChpZDogc3RyaW5nKSB7XHJcbiAgICAvLyDojrflj5bmiYDmnInliIbpobXkv6Hmga9cclxuICAgIGNvbnN0IHJlcXVlc3RJbmZvID0gdGhpcy5yZXN0U2VydmljZS5idWlsZFJlcXVlc3RJbmZvKCk7XHJcbiAgICAvLyDmnoTpgKDliIbpobXkv6Hmga9cclxuICAgIGNvbnN0IHJldHJpZXZlUGFyYW0gPSB0aGlzLmJ1aWxkUmV0cmlldmVQYXJhbSgpO1xyXG4gICAgY29uc3QgcmV0cmlldmUkID0gdGhpcy5yZXN0U2VydmljZS5zZXJ2aWNlUmV0cmlldmUoaWQsIHJldHJpZXZlUGFyYW0sIHJlcXVlc3RJbmZvKTtcclxuICAgIGNvbnN0IHJlc3VsdCQgPSByZXRyaWV2ZSQucGlwZShcclxuICAgICAgbWFwKChyZXNwb25zZUluZm86IGFueSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHJldHVyblZhbHVlID0gcmVzcG9uc2VJbmZvLnJldHVyblZhbHVlIHx8IHt9O1xyXG4gICAgICAgIGNvbnN0IGVudGl0eURhdGEgPSByZXR1cm5WYWx1ZS5yZXN1bHQ7XHJcbiAgICAgICAgY29uc3Qgc2VydmVyUGFnaW5hdGlvbkluZm8gPSByZXR1cm5WYWx1ZS5wYWdpbmF0aW9uO1xyXG4gICAgICAgIHRoaXMudXBkYXRlUGFnaW5hdGlvbihzZXJ2ZXJQYWdpbmF0aW9uSW5mbyk7XHJcbiAgICAgICAgY29uc3QgZW50aXR5ID0gdGhpcy5yZXBvc2l0b3J5LmJ1aWxkRW50aXR5KGVudGl0eURhdGEpO1xyXG4gICAgICAgIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmxvYWRFbnRpdGllcyhbZW50aXR5XSk7XHJcbiAgICAgICAgcmV0dXJuIGVudGl0eTtcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgICByZXR1cm4gcmVzdWx0JDtcclxuICB9XHJcbiAgLyoqXHJcbiAgICogWydpZDp4eHgnLCAnY2hpbDFzJywgJ2lkOnh4eCcsICdncmFuZDFzJ11cclxuICAgKiDliIbpobXmn6Xor6Lku47ooagv5LuO5LuO6KGo5pWw5o2uXHJcbiAgICog57uR5a6a6Lev5b6E5qC85byP5Li6WyfkuLvooajkuLvplK465Li76KGo5Li76ZSu5YC8JywnY2hpbGQxcycsJ2lkOuS7juihqOS4u+mUruWAvCddXHJcbiAgICogQHBhcmFtIHBhdGhzIOmAmueUqOi3r+W+hFxyXG4gICAqIEBwYXJhbSBwYWdlSW5kZXgg6aG156CBXHJcbiAgICogQHBhcmFtIHBhZ2VTaXplIOWIhumhteWkp+Wwj1xyXG4gICAqIEBwYXJhbSBmaWx0ZXIg6L+H5ruk5p2h5Lu2XHJcbiAgICogQHBhcmFtIHNvcnQg5o6S5bqPXHJcbiAgICovXHJcbiAgcHVibGljIHF1ZXJ5Q2hpbGQocGF0aHM6IHN0cmluZ1tdLCBwYWdlSW5kZXg6IG51bWJlciwgcGFnZVNpemU6IG51bWJlciwgZmlsdGVyPzogc3RyaW5nLCBzb3J0Pzogc3RyaW5nKSB7XHJcbiAgICBjb25zdCByZXF1ZXN0SW5mbyA9IHRoaXMucmVzdFNlcnZpY2UuYnVpbGRSZXF1ZXN0SW5mbygpO1xyXG4gICAgbGV0IG5vZGVDb2RlcyA9IEJlZkRhdGFQYXRoVXRpbC5jb252ZXJ0UGF0aHNUb05vZGVDb2RlcyhwYXRocyk7XHJcbiAgICBjb25zdCBlbnRpdHlDb2RlcyA9IG5vZGVDb2Rlcy5tYXAobm9kZSA9PiBub2RlLnN1YnN0cmluZygwLCBub2RlLmxlbmd0aCAtIDEpKTtcclxuICAgIGxldCBlbnRpdHlOYW1lID0gZW50aXR5Q29kZXNbZW50aXR5Q29kZXMubGVuZ3RoIC0gMV07XHJcbiAgICAvLyDmn6Xor6Llr7nosaHlj6/og73kuLrku47ooajmiJbku47ku47ooahcclxuICAgIGNvbnN0IHBhZ2luYXRpb24gPSB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5nZXRQYWdpbmF0aW9uQ29uZmlnQnlQYXRoKGAvJHtlbnRpdHlOYW1lfWApO1xyXG4gICAgY29uc3QgeyBwYWdlU2l6ZTogcHMgPSAwIH0gPSBwYWdpbmF0aW9uIHx8IHt9O1xyXG4gICAgY29uc3Qgdmlld01vZGVsID0gdGhpcy5pbmplY3Rvci5nZXQ8Vmlld01vZGVsPihWaWV3TW9kZWwsIG51bGwpO1xyXG4gICAgbGV0IGZvcmNlUXVlcnlDaGlsZCA9IGZhbHNlO1xyXG4gICAgaWYgKHZpZXdNb2RlbCkge1xyXG4gICAgICBmb3JjZVF1ZXJ5Q2hpbGQgPSB2aWV3TW9kZWwuZnJhbWVDb250ZXh0LmFwcENvbnRleHQucGFyYW1zLmdldCgnZm9yY2VRdWVyeUNoaWxkJykgfHwgZmFsc2U7XHJcbiAgICB9XHJcbiAgICBpZiAocHMgPT0gMCAmJiAhZm9yY2VRdWVyeUNoaWxkKSB7XHJcbiAgICAgIHJldHVybiBvZihudWxsKTtcclxuICAgIH1cclxuICAgIGNvbnN0IGlkcyA9IEJlZkRhdGFQYXRoVXRpbC5jb252ZXJ0UGF0aHNUb0lkcyhwYXRocyk7XHJcbiAgICBjb25zdCBwYXJlbnRJZCA9IGlkc1tpZHMubGVuZ3RoIC0gMV07XHJcbiAgICBjb25zdCBwYXJhbXMgPSB7XHJcbiAgICAgIG5vZGVDb2RlczogZW50aXR5Q29kZXMsXHJcbiAgICAgIGlkcyxcclxuICAgICAgcGFnaW5hdGlvbjoge1xyXG4gICAgICAgIHBhZ2VJbmRleCxcclxuICAgICAgICBwYWdlU2l6ZVxyXG4gICAgICB9LFxyXG4gICAgICByZXF1ZXN0SW5mb1xyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCByZXF1ZXN0JCA9IHRoaXMucmVzdFNlcnZpY2UucXVlcnlDaGlsZChwYXJhbXMpO1xyXG4gICAgcmV0dXJuIHJlcXVlc3QkLnBpcGUoXHJcbiAgICAgIG1hcChyZXNwb25zZSA9PiB7XHJcbiAgICAgICAgY29uc3QgcmV0dXJuVmFsdWUgPSByZXNwb25zZS5yZXR1cm5WYWx1ZTtcclxuICAgICAgICBpZiAoIXJldHVyblZhbHVlKSB7XHJcbiAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgeyByZXN1bHQgPSBbXSwgcGFnaW5hdGlvbiA9IHt9IH0gPSByZXR1cm5WYWx1ZTtcclxuICAgICAgICBjb25zdCBjb21tb25QYXRocyA9IHBhdGhzLm1hcCgocGF0aCwgaW5kZXgpID0+IHtcclxuICAgICAgICAgIGlmIChwYXRoLmluY2x1ZGVzKCc6JykgJiYgaW5kZXggJSAyID09PSAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBwYXRoLnNwbGl0KCc6JylbMV07XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICByZXR1cm4gcGF0aDtcclxuICAgICAgICB9KTtcclxuICAgICAgICBjb25zdCBlbnRpdGllcyA9IHRoaXMucmVwb3NpdG9yeS5lbnRpdHlNYW5hZ2VyLmNyZWF0ZUVudGl0aWVzQnlQYXRoKGAvJHtjb21tb25QYXRocy5qb2luKCcvJyl9YCwgcmVzdWx0KTtcclxuICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5yZXNldEVudGl0aWVzKHBhdGhzLCBlbnRpdGllcyk7XHJcbiAgICAgICAgLy8g5pu05paw5YiG6aG15L+h5oGvXHJcbiAgICAgICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24uc2V0UGFnaW5hdGlvbkNvbmZpZ0J5UGF0aChgLyR7ZW50aXR5TmFtZX1fJHtwYXJlbnRJZH1gLCBwYWdpbmF0aW9uKTtcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOaehOmAoOWtkOihqOWIhumhteS/oeaBr1xyXG4gICAqL1xyXG4gIHByaXZhdGUgYnVpbGRDaGlsZHJlblBhZ2luYXRpb24oKSB7XHJcbiAgICBjb25zdCBwYWdpbmF0aW9uSW5mbyA9IHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmdldFBhZ2luYXRpb25Db25maWdCeVBhdGgoJy8nKTtcclxuICAgIGNvbnN0IGNoaWxkUGFnaW5hdGlvbkluZm8gPSB7fTtcclxuICAgIGNvbnN0IGNoaWxkcmVuRW50aXR5Q29kZXMgPSBbXTtcclxuICAgIERhdGFUeXBlSW5mb1V0aWwuZ2V0Q2hpbGRyZW5Ob2RlQ29kZXModGhpcy5yZXBvc2l0b3J5LmVudGl0eVR5cGVJbmZvLCBjaGlsZHJlbkVudGl0eUNvZGVzKTtcclxuICAgIC8vIOWunuS9k+aXoOWtkOihqFxyXG4gICAgaWYgKCFjaGlsZHJlbkVudGl0eUNvZGVzIHx8IGNoaWxkcmVuRW50aXR5Q29kZXMubGVuZ3RoIDwgMSkge1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICAgIE9iamVjdC5rZXlzKHBhZ2luYXRpb25JbmZvKS5mb3JFYWNoKGtleSA9PiB7XHJcbiAgICAgIGNvbnN0IHZhbHVlID0gcGFnaW5hdGlvbkluZm9ba2V5XTtcclxuICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcpIHtcclxuICAgICAgICBjb25zdCBlbnRpdHlDb2RlID0ga2V5ICYmIGtleS5pbmNsdWRlcygnXycpICYmIGtleS5zcGxpdCgnXycpWzBdIHx8IG51bGw7XHJcbiAgICAgICAgaWYgKCEoZW50aXR5Q29kZSAmJiBjaGlsZHJlbkVudGl0eUNvZGVzLmluY2x1ZGVzKGAke2VudGl0eUNvZGV9c2ApKSkge1xyXG4gICAgICAgICAgY2hpbGRQYWdpbmF0aW9uSW5mb1trZXldID0gdmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIHJldHVybiBjaGlsZFBhZ2luYXRpb25JbmZvO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmm7TmlrDliIbpobXphY3nva7kv6Hmga9cclxuICAgKiBAcGFyYW0gcGFnaW5hdGlvbkluZm8g5pyN5Yqh5Zmo5YiG6aG15L+h5oGvXHJcbiAgICovXHJcbiAgcHJpdmF0ZSB1cGRhdGVQYWdpbmF0aW9uKHBhZ2luYXRpb25JbmZvOiBhbnkpIHtcclxuICAgIGlmICghcGFnaW5hdGlvbkluZm8pIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgbGV0IGNoaWxkcmVuRW50aXR5Q29kZXM6IHN0cmluZ1tdID0gW107XHJcbiAgICBEYXRhVHlwZUluZm9VdGlsLmdldENoaWxkcmVuTm9kZUNvZGVzKHRoaXMucmVwb3NpdG9yeS5lbnRpdHlUeXBlSW5mbywgY2hpbGRyZW5FbnRpdHlDb2Rlcyk7XHJcbiAgICBjaGlsZHJlbkVudGl0eUNvZGVzID0gY2hpbGRyZW5FbnRpdHlDb2Rlcy5tYXAoaXRlbSA9PiBpdGVtLnN1YnN0cigwLCBpdGVtLmxlbmd0aCAtIDEpKTtcclxuICAgIGlmICghcGFnaW5hdGlvbkluZm8gfHwgT2JqZWN0LmtleXMocGFnaW5hdGlvbkluZm8pLmxlbmd0aCA8IDEpIHtcclxuICAgICAgaWYgKGNoaWxkcmVuRW50aXR5Q29kZXMgJiYgY2hpbGRyZW5FbnRpdHlDb2Rlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgY2hpbGRyZW5FbnRpdHlDb2Rlcy5mb3JFYWNoKChub2RlQ29kZTogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgICBjb25zdCBvcmlnaW5hbCA9IHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmdldFBhZ2luYXRpb25Db25maWdCeVBhdGgoYC8ke25vZGVDb2RlfWApO1xyXG4gICAgICAgICAgaWYgKG9yaWdpbmFsKSB7XHJcbiAgICAgICAgICAgIG9yaWdpbmFsLnBhZ2VJbmRleCA9IDE7XHJcbiAgICAgICAgICAgIG9yaWdpbmFsLnRvdGFsID0gMDtcclxuICAgICAgICAgICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24uc2V0UGFnaW5hdGlvbkNvbmZpZ0J5UGF0aChgLyR7bm9kZUNvZGV9YCwgb3JpZ2luYWwpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIE9iamVjdC5rZXlzKHBhZ2luYXRpb25JbmZvKS5mb3JFYWNoKGtleSA9PiB7XHJcbiAgICAgIC8vIGNvbnN0IGVudGl0eU5hbWUgPSBjaGlsZHJlbkVudGl0eUNvZGVzLmZpbmQoaXRlbSA9PiBrZXkuc3RhcnRzV2l0aChgJHtpdGVtfV9gKSk7XHJcbiAgICAgIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLnNldFBhZ2luYXRpb25Db25maWdCeVBhdGgoYC8ke2tleX1gLCBwYWdpbmF0aW9uSW5mb1trZXldKTtcclxuICAgIH0pO1xyXG4gICAgLy8gY2hpbGRyZW5FbnRpdHlDb2Rlcy5mb3JFYWNoKChub2RlQ29kZTogc3RyaW5nKSA9PiB7XHJcbiAgICAvLyAgIC8vIOehruiupOWQjuerr+i/lOWbnueahOWIhumhteS/oeaBr+S4reaYr+WQpuWMheWQq+W9k+WJjeWunuS9k+eahOWIhumhteS/oeaBr++8jOWmguaenOS4jeWMheWQq+WImeWwhmluZGV4572u5Li6MeOAgeaAu+adoeaVsOe9ruS4ujBcclxuICAgIC8vICAgLy8g6I635Y+W6K+l5a6e5L2T5a+55bqU5Yiw5YiG6aG15L+h5oGv5Lita2V5XHJcbiAgICAvLyAgIGNvbnN0IGtleSA9IE9iamVjdC5rZXlzKHBhZ2luYXRpb25JbmZvKS5maW5kKChrZXk6IHN0cmluZykgPT4ga2V5LnN0YXJ0c1dpdGgoYCR7bm9kZUNvZGV9X2ApKTtcclxuICAgIC8vICAgLy8g5YiG6aG15Lit5YyF5ZCr5b2T5YmN5a6e5L2T55qE5YiG6aG15L+h5oGvXHJcbiAgICAvLyAgIGlmIChrZXkpIHtcclxuICAgIC8vICAgICAvLyBwYWdpbmF0aW9uSW5mb1trZXldLnRvdGFsID0gcGFnaW5hdGlvbkluZm9ba2V5XS50b3RhbENvdW50O1xyXG4gICAgLy8gICAgIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLnNldFBhZ2luYXRpb25Db25maWdCeVBhdGgoYC8ke2tleX1gLCBwYWdpbmF0aW9uSW5mb1trZXldKTtcclxuICAgIC8vICAgfSBlbHNlIHtcclxuICAgIC8vICAgICAvLyBUT0RPOiDpnIDnoa7orqTmmK/lkKblv4Xpobvorr7nva7nqbrliIbpobXkv6Hmga9cclxuICAgIC8vICAgICAvLyBjb25zdCBvcmlnaW5hbCA9IHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmdldFBhZ2luYXRpb25Db25maWdCeVBhdGgoYC8ke25vZGVDb2RlfWApO1xyXG4gICAgLy8gICAgIC8vIGlmIChvcmlnaW5hbCkge1xyXG4gICAgLy8gICAgIC8vICAgb3JpZ2luYWwucGFnZUluZGV4ID0gMTtcclxuICAgIC8vICAgICAvLyAgIG9yaWdpbmFsLnRvdGFsID0gMDtcclxuICAgIC8vICAgICAvLyAgIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLnNldFBhZ2luYXRpb25Db25maWdCeVBhdGgoYC8ke25vZGVDb2RlfWAsIG9yaWdpbmFsKTtcclxuICAgIC8vICAgICAvLyB9XHJcbiAgICAvLyAgIH1cclxuICAgIC8vIH0pO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmnoTpgKByZXRyaWV2ZeWIhumhteS/oeaBr1xyXG4gICAqIEBkZXNjcmlwdGlvbiDor6Xor7fmsYLkuI3pnIDopoHmkLrluKZwYXJlbnRJZHPlj4LmlbDvvIzlj6rmnInliIfmjaLku47ku47ooajml7bmiY3pnIDopoHkvb/nlKjmt7vliqBwYXJlbnRJZHPlj4LmlbBcclxuICAgKi9cclxuICBwcml2YXRlIGJ1aWxkUmV0cmlldmVQYXJhbSgpIHtcclxuICAgIGNvbnN0IGNoaWxkUGFnaW5hdGlvbkluZm8gPSB0aGlzLmJ1aWxkQ2hpbGRyZW5QYWdpbmF0aW9uKCk7XHJcbiAgICBpZiAoIWNoaWxkUGFnaW5hdGlvbkluZm8gfHwgT2JqZWN0LmtleXMoY2hpbGRQYWdpbmF0aW9uSW5mbykubGVuZ3RoIDwgMSkge1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICAgIGNvbnN0IHJldHJpZXZlUGFyYW06IFJldHJpZXZlUGFyYW0gPSB7IGZpbHRlcnM6IHt9LCBwYXJlbnRJZHM6IHt9IH07XHJcbiAgICBsZXQgY2hpbGRyZW5FbnRpdHlDb2RlczogYW55W10gPSBbXTtcclxuICAgIEV4cHJlc3Npb25VdGlsLmdldENoaWxkcmVuRW50aXR5UGF0aHModGhpcy5yZXBvc2l0b3J5LmVudGl0eVR5cGVJbmZvLCBjaGlsZHJlbkVudGl0eUNvZGVzKTtcclxuICAgIE9iamVjdC5rZXlzKGNoaWxkUGFnaW5hdGlvbkluZm8pLmZvckVhY2godHlwZU5hbWUgPT4ge1xyXG4gICAgICBjb25zdCBlbnRpdHk6IGFueSA9IGNoaWxkUGFnaW5hdGlvbkluZm9bdHlwZU5hbWVdO1xyXG4gICAgICBjb25zdCBwYWdlSW5kZXggPSBlbnRpdHkucGFnZUluZGV4IHx8IDE7XHJcbiAgICAgIHJldHJpZXZlUGFyYW0uZmlsdGVyc1t0eXBlTmFtZV0gPSB7IHBhZ2luYXRpb246IHsgcGFnZVNpemU6IGVudGl0eS5wYWdlU2l6ZSB8fCAwLCBwYWdlSW5kZXg6IHBhZ2VJbmRleCB9IH07XHJcbiAgICAgIC8vIGlmICh0aGlzLmlzQ2hpbGRyZW5UYWJsZSh0eXBlTmFtZSkpIHtcclxuICAgICAgLy8gICByZXRyaWV2ZVBhcmFtLnBhcmVudElkc1t0eXBlTmFtZV0gPSB0aGlzLmdldElkKHR5cGVOYW1lLCBwYWdlSW5kZXgpO1xyXG4gICAgICAvLyB9XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gcmV0cmlldmVQYXJhbTtcclxuICB9XHJcbiAgLypcclxuICBwcml2YXRlIGdldElkKG5vZGVDb2RlOiBzdHJpbmcsIHBhZ2VJbmRleDogbnVtYmVyKTogc3RyaW5nIHtcclxuICAgIGNvbnN0IHZpZXdNb2RlbCA9IHRoaXMuaW5qZWN0b3IuZ2V0PFZpZXdNb2RlbD4oVmlld01vZGVsLCBudWxsKTtcclxuICAgIGNvbnN0IHsgcGFnZUluZGV4OiBvcmlnaW5hbFBhZ2VJbmRleCA9IDEgfSA9IHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmdldFBhZ2luYXRpb25Db25maWdCeVBhdGgoYC8ke25vZGVDb2RlfWApIHx8IHt9O1xyXG4gICAgaWYgKHBhZ2VJbmRleCAhPT0gb3JpZ2luYWxQYWdlSW5kZXgpIHtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcbiAgICBpZiAodmlld01vZGVsKSB7XHJcbiAgICAgIGNvbnN0IGJpbmRpbmdMaXN0ID0gdmlld01vZGVsLmJpbmRpbmdEYXRhLmdldFZhbHVlKFtgJHtub2RlQ29kZX1zYF0pIGFzIEJpbmRpbmdMaXN0O1xyXG4gICAgICBpZiAoYmluZGluZ0xpc3QgJiYgYmluZGluZ0xpc3QuY3VycmVudElkKSB7XHJcbiAgICAgICAgcmV0dXJuIGJpbmRpbmdMaXN0LmN1cnJlbnRJZDtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG4gIHByaXZhdGUgaXNDaGlsZHJlblRhYmxlKG5vZGVDb2RlOiBzdHJpbmcpIHtcclxuICAgIGxldCBjaGlsZHJlbkVudGl0eUNvZGVzOiBhbnlbXSA9IFtdO1xyXG4gICAgbm9kZUNvZGUgKz0gJ3MnO1xyXG4gICAgRXhwcmVzc2lvblV0aWwuZ2V0Q2hpbGRyZW5FbnRpdHlQYXRocyh0aGlzLnJlcG9zaXRvcnkuZW50aXR5VHlwZUluZm8sIGNoaWxkcmVuRW50aXR5Q29kZXMpO1xyXG4gICAgaWYgKGNoaWxkcmVuRW50aXR5Q29kZXMgJiYgY2hpbGRyZW5FbnRpdHlDb2Rlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGNvbnN0IGluZGV4ID0gY2hpbGRyZW5FbnRpdHlDb2Rlcy5maW5kSW5kZXgoKHBhdGhzOiBzdHJpbmdbXSkgPT4gcGF0aHMubGVuZ3RoID09PSAxICYmIHBhdGhzWzBdID09PSBub2RlQ29kZSk7XHJcbiAgICAgIHJldHVybiBpbmRleCAhPT0gLTE7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfSovXHJcbiAgLyoqXHJcbiAgICog5pu05paw5bm25a+55a6e5L2T5Yqg6ZSBXHJcbiAgICogQHBhcmFtIGlkIOWunuS9k2lkXHJcbiAgICovXHJcbiAgcHVibGljIGVkaXRCeUlkKGlkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPFQ+IHtcclxuICAgIGNvbnN0IGVudGl0eSA9IHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmdldEVudGl0eUJ5SWQoaWQpO1xyXG4gICAgaWYgKCFlbnRpdHkpIHtcclxuICAgICAgcmV0dXJuIG9mKG51bGwpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHJlcXVlc3RJbmZvID0gQmVmUHJveHlVdGlsLmJ1aWxkUmVxdWVzdEluZm8odGhpcy5yZXBvc2l0b3J5KTtcclxuICAgIGNvbnN0IHJldHJpZXZlJCA9IHRoaXMucmVzdFByb3h5LmVkaXQoaWQsIHJlcXVlc3RJbmZvKTtcclxuICAgIGNvbnN0IHJlc3VsdCQgPSByZXRyaWV2ZSQucGlwZShcclxuICAgICAgbWFwKChyZXNwb25zZUluZm86IFJlc3BvbnNlSW5mbykgPT4ge1xyXG4gICAgICAgIGNvbnN0IGVudGl0eURhdGEgPSByZXNwb25zZUluZm8ucmV0dXJuVmFsdWUuZGF0YTtcclxuICAgICAgICBjb25zdCBlbnRpdHlUb1VwZGF0ZSA9IHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmdldEVudGl0eUJ5SWQoaWQpO1xyXG4gICAgICAgIGlmIChlbnRpdHlUb1VwZGF0ZSAmJiBlbnRpdHlEYXRhKSB7XHJcbiAgICAgICAgICB0aGlzLnJlbG9hZEVudGl0eURhdGEoZW50aXR5VG9VcGRhdGUsIGVudGl0eURhdGEpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZW50aXR5VG9VcGRhdGU7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gICAgcmV0dXJuIHJlc3VsdCQ7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmoLnmja5pZOabtOaWsOWunuS9k1xyXG4gICAqIEBwYXJhbSBpZCDlrp7kvZNpZFxyXG4gICAqL1xyXG4gIHB1YmxpYyB1cGRhdGVCeUlkKGlkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPFQ+IHtcclxuICAgIC8vIOWmguaenOimgeabtOaWsOeahOWunuS9k+S4jeWtmOWcqO+8jOi/lOWbnuS4gOS4qm51bGzmtYHvvJtcclxuICAgIC8vIEB0b2Rv77ya6L+U5ZueZW1wdHkoKei/mOaYr251bGzmtYHvvIzkuLrkuobkuI3lvbHlk43njrDmnInooYzkuLrvvIzkuLTml7bov5Tlm55udWxs5rWB44CCXHJcbiAgICBjb25zdCBlbnRpdHkgPSB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5nZXRFbnRpdHlCeUlkKGlkKTtcclxuICAgIGlmICghZW50aXR5KSB7XHJcbiAgICAgIHJldHVybiBvZihudWxsKTtcclxuICAgIH1cclxuICAgIGNvbnN0IHJlcXVlc3RJbmZvID0gdGhpcy5yZXN0U2VydmljZS5idWlsZFJlcXVlc3RJbmZvKCk7XHJcbiAgICBjb25zdCByZXRyaWV2ZVBhcmFtID0gdGhpcy5idWlsZFJldHJpZXZlUGFyYW0oKTtcclxuICAgIGlmIChyZXRyaWV2ZVBhcmFtKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLnVwZGF0ZUVudGl0eUJ5SWQoaWQpO1xyXG4gICAgfVxyXG4gICAgY29uc3QgcmV0cmlldmUkID0gdGhpcy5yZXN0U2VydmljZS5leHRlbmRSZXRyaWV2ZShpZCwgcmVxdWVzdEluZm8sIHJldHJpZXZlUGFyYW0pO1xyXG4gICAgY29uc3QgcmVzdWx0JCA9IHJldHJpZXZlJC5waXBlKFxyXG4gICAgICBtYXAoKHJlc3BvbnNlSW5mbzogUmVzcG9uc2VJbmZvKSA9PiB7XHJcbiAgICAgICAgY29uc3QgZW50aXR5RGF0YSA9IHJlc3BvbnNlSW5mby5yZXR1cm5WYWx1ZTtcclxuICAgICAgICBjb25zdCBlbnRpdHlUb1VwZGF0ZSA9IHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmdldEVudGl0eUJ5SWQoaWQpO1xyXG4gICAgICAgIHRoaXMucmVsb2FkRW50aXR5RGF0YShlbnRpdHlUb1VwZGF0ZSwgZW50aXR5RGF0YSk7XHJcbiAgICAgICAgcmV0dXJuIGVudGl0eVRvVXBkYXRlO1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICAgIHJldHVybiByZXN1bHQkO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmoLnmja5pZOabtOaWsOWunuS9k1xyXG4gICAqIEBwYXJhbSBpZCDlrp7kvZNpZFxyXG4gICAqL1xyXG4gIHB1YmxpYyB1cGRhdGVFbnRpdHlCeUlkKGlkOiBzdHJpbmcpIHtcclxuICAgIC8vIOiOt+WPluaJgOacieWIhumhteS/oeaBr1xyXG4gICAgY29uc3QgcmVxdWVzdEluZm8gPSB0aGlzLnJlc3RTZXJ2aWNlLmJ1aWxkUmVxdWVzdEluZm8oKTtcclxuICAgIC8vIOaehOmAoOWIhumhteS/oeaBr1xyXG4gICAgY29uc3QgcmV0cmlldmVQYXJhbSA9IHRoaXMuYnVpbGRSZXRyaWV2ZVBhcmFtKCk7XHJcbiAgICBjb25zdCByZXRyaWV2ZSQgPSB0aGlzLnJlc3RTZXJ2aWNlLnNlcnZpY2VSZXRyaWV2ZShpZCwgcmV0cmlldmVQYXJhbSwgcmVxdWVzdEluZm8pO1xyXG4gICAgY29uc3QgcmVzdWx0JCA9IHJldHJpZXZlJC5waXBlKFxyXG4gICAgICBtYXAoKHJlc3BvbnNlSW5mbzogYW55KSA9PiB7XHJcbiAgICAgICAgY29uc3QgcmV0dXJuVmFsdWUgPSByZXNwb25zZUluZm8ucmV0dXJuVmFsdWUgfHwge307XHJcbiAgICAgICAgY29uc3QgZW50aXR5RGF0YSA9IHJldHVyblZhbHVlLnJlc3VsdDtcclxuICAgICAgICBjb25zdCBzZXJ2ZXJQYWdpbmF0aW9uSW5mbyA9IHJldHVyblZhbHVlLnBhZ2luYXRpb247XHJcbiAgICAgICAgdGhpcy51cGRhdGVQYWdpbmF0aW9uKHNlcnZlclBhZ2luYXRpb25JbmZvKTtcclxuICAgICAgICBjb25zdCBlbnRpdHlUb1VwZGF0ZSA9IHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmdldEVudGl0eUJ5SWQoaWQpO1xyXG4gICAgICAgIHRoaXMucmVsb2FkRW50aXR5RGF0YShlbnRpdHlUb1VwZGF0ZSwgZW50aXR5RGF0YSk7XHJcbiAgICAgICAgcmV0dXJuIGVudGl0eVRvVXBkYXRlO1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICAgIHJldHVybiByZXN1bHQkO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDph43mlrDliqDovb3lrp7kvZPmlbDmja5cclxuICAgKiBAcGFyYW0gaWQg6KaB6YeN6L2955qE5a6e5L2TaWRcclxuICAgKiBAcGFyYW0gZW50aXR5RGF0YSDopoHph43ovb3nmoTmlbDmja5cclxuICAgKiBAdG9kb++8mlxyXG4gICAqIDHjgIHmoLnmnKzkuIrlupTor6XlnKjph43mlrBsb2Fk5pWw5o2u55qE5pe25YCZ77yM5Y+q5Y+R6YCB5qC56IqC54K555qE5LiA5qyhTG9hZOWPmOabtO+8m1xyXG4gICAqIDLjgIHogIPomZHliLDnqLPlrprmgKflkozmlLnliqjph4/vvIzmmoLml7bph4flj5bmraTov4fmuKHmlrnmoYjvvIzph43mnoRFbnRpdHnml7blvbvlupXop6PlhrPjgIJcclxuICAgKi9cclxuICBwcml2YXRlIHJlbG9hZEVudGl0eURhdGEoZW50aXR5OiBFbnRpdHksIGVudGl0eURhdGE6IGFueSk6IHZvaWQge1xyXG4gICAgaWYgKCFlbnRpdHkpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgLy8g5YWz6Zet5Y+Y5pu05qOA5rWLXHJcbiAgICB0aGlzLmFwcENvbnRleHQuY2hhbmdlRGV0ZWN0aW9uQ29udHJvbGxlci5kZXRhY2goKTtcclxuICAgIC8vIHJldHJpZXZl5LmL5ZCO5bey57uP5piv5pyA5paw5pWw5o2u77yM56e76Zmk5Y+Y5pu0XHJcbiAgICAvLyBlbnRpdHkubG9hZChlbnRpdHlEYXRhKTtcclxuICAgIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLnVwZGF0ZUVudGl0eShlbnRpdHksIGVudGl0eURhdGEpO1xyXG4gICAgLy8g6YeN5paw5Yqg6L295pWw5o2u5LiN5bqU6K+l5Lqn55Sf5Y+Y5pu0XHJcbiAgICBlbnRpdHkuY2hhbmdlcy5zcGxpY2UoMCwgZW50aXR5LmNoYW5nZXMubGVuZ3RoKTtcclxuICAgIC8vIOmHjeaWsOaJk+W8gOWPmOabtOajgOa1i1xyXG4gICAgdGhpcy5hcHBDb250ZXh0LmNoYW5nZURldGVjdGlvbkNvbnRyb2xsZXIucmVhdHRhY2goKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWIm+W7uuaWsOWunuS9k++8jOW5tuWKoOi9vVxyXG4gICAqL1xyXG4gIHB1YmxpYyBjcmVhdGUoZGVmYXVsdFZhbHVlPzogYW55KSB7XHJcbiAgICBjb25zdCByZXF1ZXN0SW5mbyA9IHRoaXMucmVzdFNlcnZpY2UuYnVpbGRSZXF1ZXN0SW5mbygpO1xyXG4gICAgY29uc3QgcmVzdWx0JCA9IHRoaXMucmVzdFNlcnZpY2UuY3JlYXRlKGRlZmF1bHRWYWx1ZSwgcmVxdWVzdEluZm8pO1xyXG4gICAgcmV0dXJuIHJlc3VsdCQucGlwZShcclxuICAgICAgbWFwKChyZXNwb25zZUluZm86IFJlc3BvbnNlSW5mbykgPT4ge1xyXG4gICAgICAgIGNvbnN0IG5ld0RhdGEgPSByZXNwb25zZUluZm8ucmV0dXJuVmFsdWU7XHJcbiAgICAgICAgY29uc3QgbmV3RW50aXR5ID0gdGhpcy5yZXBvc2l0b3J5LmJ1aWxkRW50aXR5KG5ld0RhdGEpO1xyXG4gICAgICAgIEVudGl0eVV0aWwuYXBwZW5kSW5pdGlhbERhdGEobmV3RW50aXR5LCBuZXdEYXRhKTtcclxuICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5sb2FkRW50aXRpZXMoW25ld0VudGl0eV0sIHRydWUpO1xyXG4gICAgICAgIC8vIHRoaXMucmVwb3NpdG9yeS5kYXRhQ2hhbmdlSGlzdG9yeS5hZGRDaGFuZ2UoeyBkYXRhSWQ6IG5ld0VudGl0eS5wcmltYXJ5VmFsdWUsIGNoYW5nZVR5cGU6IERhdGFDaGFuZ2VUeXBlLkFkZCB9KTtcclxuICAgICAgICByZXR1cm4gbmV3RW50aXR5O1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOi/veWKoOWunuS9k1xyXG4gICAqL1xyXG4gIHB1YmxpYyBhcHBlbmQoZGVmYXVsdFZhbHVlPzogYW55KTogT2JzZXJ2YWJsZTxUPiB7XHJcbiAgICBjb25zdCByZXF1ZXN0SW5mbyA9IHRoaXMucmVzdFNlcnZpY2UuYnVpbGRSZXF1ZXN0SW5mbygpO1xyXG4gICAgY29uc3QgYXBwZW5kJCA9IHRoaXMucmVzdFNlcnZpY2UuY3JlYXRlKGRlZmF1bHRWYWx1ZSwgcmVxdWVzdEluZm8pO1xyXG4gICAgcmV0dXJuIGFwcGVuZCQucGlwZShcclxuICAgICAgbWFwKChyZXNwb25zZUluZm86IFJlc3BvbnNlSW5mbykgPT4ge1xyXG4gICAgICAgIGNvbnN0IG5ld0RhdGEgPSByZXNwb25zZUluZm8ucmV0dXJuVmFsdWU7XHJcbiAgICAgICAgY29uc3QgbmV3RW50aXR5ID0gdGhpcy5yZXBvc2l0b3J5LmJ1aWxkRW50aXR5KG5ld0RhdGEpO1xyXG4gICAgICAgIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmFkZEVudGl0eShuZXdFbnRpdHkpO1xyXG4gICAgICAgIC8vIHRoaXMucmVwb3NpdG9yeS5kYXRhQ2hhbmdlSGlzdG9yeS5hZGRDaGFuZ2UoeyBkYXRhSWQ6IG5ld0VudGl0eS5wcmltYXJ5VmFsdWUsIGNoYW5nZVR5cGU6IERhdGFDaGFuZ2VUeXBlLkFkZCB9KTtcclxuICAgICAgICByZXR1cm4gbmV3RW50aXR5O1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5o+S5YWl5pWw5o2uXHJcbiAgICogQHBhcmFtIHBvc2l0aW9uIOaVsOaNruaPkuWFpeS9jee9rlxyXG4gICAqIEBwYXJhbSBkZWZhdWx0VmFsdWUg6buY6K6k5YC8XHJcbiAgICovXHJcbiAgcHVibGljIGluc2VydChwb3NpdGlvbjogMSB8IC0xLCBkZWZhdWx0VmFsdWU/OiBhbnkpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgY29uc3QgcmVxdWVzdEluZm8gPSB0aGlzLmJ1aWxkUmVxdWVzdEluZm8oKTtcclxuICAgIGNvbnN0IGluc2VydCQgPSB0aGlzLnJlc3RQcm94eS5jcmVhdGUoZGVmYXVsdFZhbHVlLCByZXF1ZXN0SW5mbyk7XHJcbiAgICByZXR1cm4gaW5zZXJ0JC5waXBlKFxyXG4gICAgICBtYXAoKHJlc3BvbnNlSW5mbzogUmVzcG9uc2VJbmZvKSA9PiB7XHJcbiAgICAgICAgY29uc3QgbmV3RGF0YSA9IHJlc3BvbnNlSW5mby5yZXR1cm5WYWx1ZTtcclxuICAgICAgICBjb25zdCBuZXdFbnRpdHkgPSB0aGlzLnJlcG9zaXRvcnkuYnVpbGRFbnRpdHkobmV3RGF0YSk7XHJcbiAgICAgICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24uaW5zZXJ0RW50aXR5KG5ld0VudGl0eSwgcG9zaXRpb24pO1xyXG4gICAgICAgIHJldHVybiBuZXdFbnRpdHk7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Yib5bu65a2Q5a6e5L2T77yM5bm26L+95YqgXHJcbiAgICogQHBhcmFtIGZwYXRoIOeItui3r+W+hO+8jOagvOW8j+W9ouWmgu+8mi8xL2VkdXPvvIjku47ooajvvInmiJYvMS9lZHVzLzIvZ3JhZGVz77yI5LuO5LuO6KGo77yJXHJcbiAgICovXHJcbiAgcHVibGljIGFwcGVuZEJ5UGF0aChmcGF0aDogc3RyaW5nKTogT2JzZXJ2YWJsZTxFbnRpdHk+IHtcclxuICAgIGNvbnN0IHJlcXVlc3RJbmZvID0gdGhpcy5yZXN0U2VydmljZS5idWlsZFJlcXVlc3RJbmZvKCk7XHJcbiAgICBjb25zdCBhcHBlbmQkID0gdGhpcy5yZXN0U2VydmljZS5jcmVhdGVCeVBhdGgoZnBhdGgsIHJlcXVlc3RJbmZvKTtcclxuICAgIHJldHVybiBhcHBlbmQkLnBpcGUoXHJcbiAgICAgIG1hcCgocmVzcG9uc2VJbmZvOiBSZXNwb25zZUluZm8pID0+IHtcclxuICAgICAgICBjb25zdCBuZXdEYXRhID0gcmVzcG9uc2VJbmZvLnJldHVyblZhbHVlO1xyXG4gICAgICAgIGNvbnN0IG5ld0VudGl0eSA9IHRoaXMucmVwb3NpdG9yeS5lbnRpdHlNYW5hZ2VyLmFwcGVuZEVudGl0eUJ5UGF0aChmcGF0aCwgbmV3RGF0YSwgbmV3RGF0YSk7XHJcbiAgICAgICAgcmV0dXJuIG5ld0VudGl0eTtcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWIm+W7uuWtkOWunuS9k+W5tuaPkuWFpeWIsOaMh+WumuS9jee9rlxyXG4gICAqIEBwYXJhbSBmcGF0aCDniLbot6/lvoRcclxuICAgKiBAcGFyYW0gcG9zaXRpb24g5pWw5o2u5o+S5YWl5L2N572uXHJcbiAgICovXHJcbiAgcHVibGljIGluc2VydEJ5UGF0aChmcGF0aDogc3RyaW5nLCBwb3NpdGlvbjogMSB8IC0xKSB7XHJcbiAgICBjb25zdCByZXF1ZXN0SW5mbyA9IHRoaXMuYnVpbGRSZXF1ZXN0SW5mbygpO1xyXG4gICAgY29uc3QgaW5zZXJ0JCA9IHRoaXMucmVzdFByb3h5LmNyZWF0ZUJ5UGF0aChmcGF0aCwgcmVxdWVzdEluZm8pO1xyXG4gICAgcmV0dXJuIGluc2VydCQucGlwZShcclxuICAgICAgbWFwKChyZXNwb25zZUluZm86IFJlc3BvbnNlSW5mbykgPT4ge1xyXG4gICAgICAgIGNvbnN0IG5ld0RhdGEgPSByZXNwb25zZUluZm8ucmV0dXJuVmFsdWU7XHJcbiAgICAgICAgY29uc3QgbmV3RW50aXR5ID0gdGhpcy5yZXBvc2l0b3J5LmVudGl0eU1hbmFnZXIuaW5zZXJ0RW50aXR5QnlQYXRoKGZwYXRoLCBuZXdEYXRhLCBuZXdEYXRhLCBwb3NpdGlvbik7XHJcbiAgICAgICAgcmV0dXJuIG5ld0VudGl0eTtcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmoLnmja5pZOWIoOmZpOWunuS9k1xyXG4gICAqIEBwYXJhbSBpZCDlhoXnoIFcclxuICAgKi9cclxuICBwdWJsaWMgcmVtb3ZlQnlJZChpZDogc3RyaW5nLCBpZlNhdmU/OiBib29sZWFuKTogT2JzZXJ2YWJsZTxib29sZWFuPiB7XHJcbiAgICBpZlNhdmUgPSAoaWZTYXZlID09PSB1bmRlZmluZWQpID8gdHJ1ZSA6IGlmU2F2ZTtcclxuICAgIGNvbnN0IHJlcXVlc3RJbmZvID0gQmVmUHJveHlVdGlsLmJ1aWxkUmVxdWVzdEluZm8odGhpcy5yZXBvc2l0b3J5KTtcclxuICAgIGxldCBkZWxldGUkO1xyXG4gICAgaWYgKGlmU2F2ZSkge1xyXG4gICAgICBkZWxldGUkID0gdGhpcy5yZXN0UHJveHkuZGVsZXRlQW5kU2F2ZShpZCwgcmVxdWVzdEluZm8pO1xyXG4gICAgICByZXR1cm4gZGVsZXRlJC5waXBlKFxyXG4gICAgICAgIHN3aXRjaE1hcCgoKSA9PiB7XHJcbiAgICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5yZW1vdmVFbnRpdHlCeUlkKGlkKTtcclxuICAgICAgICAgIHJldHVybiBvZih0cnVlKTtcclxuICAgICAgICB9KVxyXG4gICAgICApO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgZGVsZXRlJCA9IHRoaXMucmVzdFNlcnZpY2UuZXh0ZW5kRGVsZXRlKGlkLCByZXF1ZXN0SW5mbyk7XHJcbiAgICAgIHJldHVybiBkZWxldGUkLnBpcGUoXHJcbiAgICAgICAgc3dpdGNoTWFwKCgpID0+IHtcclxuICAgICAgICAgIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLnJlbW92ZUVudGl0eUJ5SWQoaWQpO1xyXG4gICAgICAgICAgdGhpcy5yZXBvc2l0b3J5LmRhdGFDaGFuZ2VIaXN0b3J5LmFkZENoYW5nZSh7IGRhdGFJZDogaWQsIGNoYW5nZVR5cGU6IERhdGFDaGFuZ2VUeXBlLkRlbGV0ZSB9KTtcclxuICAgICAgICAgIHJldHVybiBvZih0cnVlKTtcclxuICAgICAgICB9KVxyXG4gICAgICApO1xyXG4gICAgfVxyXG5cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWIoOmZpOW5tuS/neWtmFxyXG4gICAqIEBwYXJhbSBpZCDopoHliKDpmaTnmoTlrp7kvZNpZFxyXG4gICAqL1xyXG4gIHB1YmxpYyByZW1vdmVBbmRTYXZlQnlJZChpZDogc3RyaW5nKSB7XHJcbiAgICBjb25zdCByZXF1ZXN0SW5mbyA9IEJlZlByb3h5VXRpbC5idWlsZFJlcXVlc3RJbmZvKHRoaXMucmVwb3NpdG9yeSk7XHJcbiAgICBjb25zdCBkZWxldGUkID0gdGhpcy5yZXN0UHJveHkuZGVsZXRlQW5kU2F2ZShpZCwgcmVxdWVzdEluZm8pO1xyXG4gICAgY29uc3QgcmVzdWx0JCA9IGRlbGV0ZSQucGlwZShcclxuICAgICAgc3dpdGNoTWFwKCgpID0+IHtcclxuICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5yZW1vdmVFbnRpdHlCeUlkKGlkKTtcclxuICAgICAgICAvLyB0aGlzLnJlcG9zaXRvcnkuZGF0YUNoYW5nZUhpc3RvcnkuYWRkQ2hhbmdlKHsgZGF0YUlkOiBpZCwgY2hhbmdlVHlwZTogRGF0YUNoYW5nZVR5cGUuRGVsZXRlIH0pO1xyXG4gICAgICAgIHJldHVybiBvZih0cnVlKTtcclxuICAgICAgfSlcclxuICAgICk7XHJcblxyXG4gICAgcmV0dXJuIHJlc3VsdCQ7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmibnph4/liKDpmaRcclxuICAgKiBAcGFyYW0gaWQg5YaF56CBXHJcbiAgICogQHBhcmFtIGlmU2F2ZSDmmK/lkKbkv53lrZhcclxuICAgKi9cclxuICBwdWJsaWMgcmVtb3ZlQnlJZHMoaWRzOiBzdHJpbmdbXSwgaWZTYXZlPzogYm9vbGVhbik6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xyXG4gICAgaWZTYXZlID0gKGlmU2F2ZSA9PT0gdW5kZWZpbmVkKSA/IHRydWUgOiBpZlNhdmU7XHJcbiAgICAvLyDmnI3liqHlmajnq6/liKDpmaRcclxuICAgIGNvbnN0IHJlcXVlc3RJbmZvID0gdGhpcy5yZXN0U2VydmljZS5idWlsZFJlcXVlc3RJbmZvKCk7XHJcbiAgICBjb25zdCBkZWxldGUkID0gdGhpcy5yZXN0U2VydmljZS5leHRlbmRCYXRjaERlbGV0ZShpZHMsIHJlcXVlc3RJbmZvKTtcclxuXHJcbiAgICAvLyDku47mnKzlnLDlrp7kvZPpm4blkIjkuK3np7vpmaRcclxuICAgIHJldHVybiBkZWxldGUkLnBpcGUoXHJcbiAgICAgIHN3aXRjaE1hcCgoKSA9PiB7XHJcbiAgICAgICAgaWYgKGlmU2F2ZSkge1xyXG4gICAgICAgICAgLy8g5omn6KGM5L+d5a2YXHJcbiAgICAgICAgICByZXR1cm4gdGhpcy5hcHBseUNoYW5nZXNCeUlkQXJyYXkoaWRzKS5waXBlKFxyXG4gICAgICAgICAgICB0YXAocmVzdWx0ID0+IHtcclxuICAgICAgICAgICAgICBpZiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAvLyDku47lrp7kvZPpm4blkIjkuK3liKDpmaRcclxuICAgICAgICAgICAgICAgIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLnJlbW92ZUVudGl0aWVzKFxyXG4gICAgICAgICAgICAgICAgICAodmFsdWUpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jaGVja0VudGl0eVZhbHVlRXhpc3RzKHZhbHVlLCBpZHMpO1xyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIC8vIOS7juWunuS9k+mbhuWQiOS4reWIoOmZpFxyXG4gICAgICAgICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24ucmVtb3ZlRW50aXRpZXMoXHJcbiAgICAgICAgICAgICh2YWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICAgIHJldHVybiB0aGlzLmNoZWNrRW50aXR5VmFsdWVFeGlzdHModmFsdWUsIGlkcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICk7XHJcbiAgICAgICAgICBpZiAoaWRzICYmIGlkcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNoYW5nZXMgPSBbXTtcclxuICAgICAgICAgICAgaWRzLmZvckVhY2goaWQgPT4ge1xyXG4gICAgICAgICAgICAgIGNoYW5nZXMucHVzaCh7IGRhdGFJZDogaWQsIGNoYW5nZVR5cGU6IERhdGFDaGFuZ2VUeXBlLkRlbGV0ZSB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHRoaXMucmVwb3NpdG9yeS5kYXRhQ2hhbmdlSGlzdG9yeS5hZGRDaGFuZ2VzKGNoYW5nZXMpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOagueaNrmlkc+aJuemHj+WIoOmZpOWunuS9k1xyXG4gICAqIEBwYXJhbSBpZHMgaWRzXHJcbiAgICogQHBhcmFtIGlmU2F2ZSDmmK/lkKbkv53lrZhcclxuICAgKi9cclxuICBwdWJsaWMgYmF0Y2hSZW1vdmUoaWRzOiBzdHJpbmdbXSwgaWZTYXZlOiBib29sZWFuKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IHJlcXVlc3RJbmZvID0gdGhpcy5yZXN0U2VydmljZS5idWlsZFJlcXVlc3RJbmZvKCk7XHJcbiAgICBjb25zdCBkZWxldGUkID0gdGhpcy5yZXN0U2VydmljZS5leHRlbmRCYXRjaERlbGV0aW9uKGlkcywgcmVxdWVzdEluZm8pO1xyXG4gICAgLy8g5LuO5pys5Zyw5a6e5L2T6ZuG5ZCI5Lit56e76ZmkXHJcbiAgICByZXR1cm4gZGVsZXRlJC5waXBlKFxyXG4gICAgICBzd2l0Y2hNYXAoKCkgPT4ge1xyXG4gICAgICAgIGlmIChpZlNhdmUpIHtcclxuICAgICAgICAgIC8vIOaJp+ihjOS/neWtmFxyXG4gICAgICAgICAgcmV0dXJuIHRoaXMuYXBwbHlDaGFuZ2VzQnlJZEFycmF5KGlkcykucGlwZShcclxuICAgICAgICAgICAgdGFwKHJlc3VsdCA9PiB7XHJcbiAgICAgICAgICAgICAgaWYgKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgLy8g5LuO5a6e5L2T6ZuG5ZCI5Lit5Yig6ZmkXHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZUVudGl0aWVzKGlkcyk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgLy8g5LuO5a6e5L2T6ZuG5ZCI5Lit5Yig6ZmkXHJcbiAgICAgICAgICB0aGlzLnJlbW92ZUVudGl0aWVzKGlkcyk7XHJcbiAgICAgICAgICB0aGlzLmFkZEJhdGNoUmVtb3ZlSGlzdG9yeShpZHMpO1xyXG4gICAgICAgICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOa3u+WKoOaJuemHj+WIoOmZpOiusOW9leWIsOWPmOabtOiusOW9leS4rVxyXG4gICAqIEBwYXJhbSBpZHMgaWRzXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBhZGRCYXRjaFJlbW92ZUhpc3RvcnkoaWRzOiBzdHJpbmdbXSkge1xyXG4gICAgaWYgKGlkcyAmJiBpZHMubGVuZ3RoID4gMCkge1xyXG4gICAgICBjb25zdCBjaGFuZ2VzID0gW107XHJcbiAgICAgIGlkcy5mb3JFYWNoKGlkID0+IHtcclxuICAgICAgICBjaGFuZ2VzLnB1c2goeyBkYXRhSWQ6IGlkLCBjaGFuZ2VUeXBlOiBEYXRhQ2hhbmdlVHlwZS5EZWxldGUgfSk7XHJcbiAgICAgIH0pO1xyXG4gICAgICB0aGlzLnJlcG9zaXRvcnkuZGF0YUNoYW5nZUhpc3RvcnkuYWRkQ2hhbmdlcyhjaGFuZ2VzKTtcclxuICAgIH1cclxuICB9XHJcbiAgLyoqXHJcbiAgICog5LuO5a6e5L2T5LuT5bqT5Lit5om56YeP56e76Zmk5oyH5a6aaWTnmoTmlbDmja5cclxuICAgKiBAcGFyYW0gaWRzIFxyXG4gICAqL1xyXG4gIHByaXZhdGUgcmVtb3ZlRW50aXRpZXMoaWRzOiBzdHJpbmdbXSkge1xyXG4gICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24ucmVtb3ZlRW50aXRpZXMoXHJcbiAgICAgICh2YWx1ZSkgPT4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNoZWNrRW50aXR5VmFsdWVFeGlzdHModmFsdWUsIGlkcyk7XHJcbiAgICAgIH1cclxuICAgICk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOajgOa1i+WunuS9k+eahOS4u+mUruWAvOaYr+WQpuWtmOWcqOS6juaVsOe7hOS4re+8jOWmguaenOWtmOWcqOi/lOWbnnRydWVcclxuICAgKiBAcGFyYW0gYXJyYXkg5b6F6YGN5Y6G5pWw57uEXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBjaGVja0VudGl0eVZhbHVlRXhpc3RzKGVudGl0eTogRW50aXR5LCBwcmltYXJ5VmFsdWVBcnJheTogYW55W10pOiBib29sZWFuIHtcclxuICAgIGxldCBpc0V4aXN0SW5UYXJnZXRBcnJheSA9IGZhbHNlO1xyXG5cclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcHJpbWFyeVZhbHVlQXJyYXkubGVuZ3RoOyBpKyspIHtcclxuICAgICAgaWYgKGVudGl0eS5wcmltYXJ5VmFsdWUgPT09IHByaW1hcnlWYWx1ZUFycmF5W2ldKSB7XHJcbiAgICAgICAgaXNFeGlzdEluVGFyZ2V0QXJyYXkgPSB0cnVlO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGlzRXhpc3RJblRhcmdldEFycmF5O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Yig6Zmk5a2Q57qnXHJcbiAgICogQHBhcmFtIHBhdGgg6Lev5b6EXHJcbiAgICogQHBhcmFtIGlkICAg5YaF56CBXHJcbiAgICovXHJcbiAgcHVibGljIHJlbW92ZUJ5UGF0aChmcGF0aDogc3RyaW5nLCBpZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxib29sZWFuPiB7XHJcblxyXG4gICAgLy8g5pyN5Yqh5Zmo56uv5Yig6ZmkXHJcbiAgICBjb25zdCByZXF1ZXN0SW5mbyA9IHRoaXMucmVzdFNlcnZpY2UuYnVpbGRSZXF1ZXN0SW5mbygpO1xyXG4gICAgY29uc3QgZGVsZXRlJCA9IHRoaXMucmVzdFNlcnZpY2UuZXh0ZW5kRGVsZXRCeVBhdGgoZnBhdGgsIGlkLCByZXF1ZXN0SW5mbyk7XHJcblxyXG4gICAgLy8g5LuO5pys5Zyw5a6e5L2T6ZuG5ZCI5Lit56e76ZmkXHJcbiAgICByZXR1cm4gZGVsZXRlJC5waXBlKFxyXG4gICAgICBtYXAoKCkgPT4ge1xyXG4gICAgICAgIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlNYW5hZ2VyLnJlbW92ZUVudGl0eUJ5UGF0aChmcGF0aCwgaWQpO1xyXG4gICAgICAgIHRoaXMucmVwb3NpdG9yeS5kYXRhQ2hhbmdlSGlzdG9yeS5hZGRDaGFuZ2UoeyBmcGF0aCwgZGF0YUlkOiBpZCwgY2hhbmdlVHlwZTogRGF0YUNoYW5nZVR5cGUuRGVsZXRlIH0pO1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaJuemHj+WIoOmZpOWtkOe6p1xyXG4gICAqIEBwYXJhbSBmUGF0aCDot6/lvoRcclxuICAgKiBAcGFyYW0gaWRzICDlrZDnuqdpZOmbhuWQiFxyXG4gICAqL1xyXG4gIHB1YmxpYyBiYXRjaFJlbW92ZUJ5UGF0aChmUGF0aDogc3RyaW5nLCBpZHM6IHN0cmluZyk6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xyXG5cclxuICAgIC8vIOacjeWKoeWZqOerr+WIoOmZpFxyXG4gICAgY29uc3QgcmVxdWVzdEluZm8gPSB0aGlzLnJlc3RTZXJ2aWNlLmJ1aWxkUmVxdWVzdEluZm8oKTtcclxuICAgIGNvbnN0IGRlbGV0ZSQgPSB0aGlzLnJlc3RTZXJ2aWNlLmJhdGNoRGVsZXRlQnlQYXRoKGZQYXRoLCBpZHMsIHJlcXVlc3RJbmZvKTtcclxuXHJcbiAgICAvLyDku47mnKzlnLDlrp7kvZPpm4blkIjkuK3np7vpmaRcclxuICAgIHJldHVybiBkZWxldGUkLnBpcGUoXHJcbiAgICAgIG1hcCgoKSA9PiB7XHJcbiAgICAgICAgY29uc3QgaWRBcnJheSA9IGlkcy5zcGxpdCgnLCcpO1xyXG4gICAgICAgIGlmIChpZEFycmF5Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgIGlkQXJyYXkuZm9yRWFjaCgoaWQpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eU1hbmFnZXIucmVtb3ZlRW50aXR5QnlQYXRoKGZQYXRoLCBpZCk7XHJcbiAgICAgICAgICAgIHRoaXMucmVwb3NpdG9yeS5kYXRhQ2hhbmdlSGlzdG9yeS5hZGRDaGFuZ2UoeyBmUGF0aCwgZGF0YUlkOiBpZCwgY2hhbmdlVHlwZTogRGF0YUNoYW5nZVR5cGUuRGVsZXRlIH0pO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWwhmlk5a+55bqU55qE5a6e5L2T55qE5Y+Y5pu05o+Q5Lqk55qE5pyN5Yqh5Zmo56uvXHJcbiAgICovXHJcbiAgcHVibGljIHVwZGF0ZUNoYW5nZXNCeUlkKGlkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGJvb2xlYW4+IHtcclxuICAgIGNvbnN0IGVudGl0eSA9IHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmdldEVudGl0eUJ5SWQoaWQpO1xyXG5cclxuICAgIC8vIOWPmOabtOmbhuS4jeWtmOWcqFxyXG4gICAgaWYgKCFlbnRpdHkuY2hhbmdlcykge1xyXG4gICAgICByZXR1cm4gb2YodHJ1ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5Y+Y5pu06ZuG5Li656m6XHJcbiAgICBpZiAoZW50aXR5LmNoYW5nZXMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIHJldHVybiBvZih0cnVlKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBjaGFuZ2VEZXRhaWwgPSB0aGlzLnJlcG9zaXRvcnkuZW50aXR5TWFuYWdlci5idWlsZEVudGl0eUNoYW5nZURldGFpbEJ5SWQoaWQpO1xyXG4gICAgY29uc3QgcmVxdWVzdEluZm8gPSB0aGlzLnJlc3RTZXJ2aWNlLmJ1aWxkUmVxdWVzdEluZm8oKTtcclxuXHJcbiAgICBjb25zdCB1cGRhdGUkID0gdGhpcy5yZXN0U2VydmljZS51cGRhdGUoY2hhbmdlRGV0YWlsLCByZXF1ZXN0SW5mbyk7XHJcbiAgICBjb25zdCByZXN1bHQkID0gdXBkYXRlJC5waXBlKFxyXG4gICAgICB0YXAoKCkgPT4ge1xyXG4gICAgICAgIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlNYW5hZ2VyLmNsZWFyRW50aXR5Q2hhbmdlc0J5SWQoaWQpO1xyXG4gICAgICB9KSxcclxuICAgICAgbWFwKCgpID0+IHtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgICByZXR1cm4gcmVzdWx0JDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaPkOS6pHBhdGjlr7nlupTlrp7kvZPnmoTlj5jmm7RcclxuICAgKi9cclxuICBwdWJsaWMgdXBkYXRlQ2hhbmdlc0J5UGF0aChwYXRoOiBzdHJpbmcsIGlkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKCdOb3QgSW1wbGVtZW50Jyk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmj5DkuqTmiYDmnInlj5jmm7RcclxuICAgKi9cclxuICBwdWJsaWMgdXBkYXRlQWxsQ2hhbmdlcygpOiBPYnNlcnZhYmxlPGJvb2xlYW4+IHtcclxuXHJcbiAgICAvLyDpgY3ljoblrp7kvZPvvIzmj5DkuqTlj5jmm7RcclxuICAgIGNvbnN0IHVwZGF0ZVJlc3VsdHM6IE9ic2VydmFibGU8Ym9vbGVhbj5bXSA9IFtdO1xyXG4gICAgY29uc3QgZW50aXRpZXM6IEVudGl0eVtdID0gdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24udG9BcnJheSgpO1xyXG4gICAgaWYgKGVudGl0aWVzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICByZXR1cm4gb2YodHJ1ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgZW50aXRpZXMuZm9yRWFjaCgoZW50aXR5OiBFbnRpdHkpID0+IHtcclxuICAgICAgY29uc3QgdXBkYXRlUmVzdWx0JCA9IHRoaXMudXBkYXRlQ2hhbmdlc0J5SWQoZW50aXR5LnByaW1hcnlWYWx1ZSk7XHJcbiAgICAgIHVwZGF0ZVJlc3VsdHMucHVzaCh1cGRhdGVSZXN1bHQkKTtcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIOS4suiBlOa1gVxyXG4gICAgY29uc3QgcmVzdWx0JCA9IHppcCguLi51cGRhdGVSZXN1bHRzKS5waXBlKFxyXG4gICAgICBtYXAoKCkgPT4ge1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuXHJcbiAgICByZXR1cm4gcmVzdWx0JDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOW6lOeUqOWPmOabtFxyXG4gICAqL1xyXG4gIHB1YmxpYyBhcHBseUNoYW5nZXMoKTogT2JzZXJ2YWJsZTxib29sZWFuPiB7XHJcbiAgICBjb25zdCByZXF1ZXN0SW5mbyA9IHRoaXMucmVzdFNlcnZpY2UuYnVpbGRSZXF1ZXN0SW5mbygpO1xyXG4gICAgY29uc3Qgc2F2ZSQgPSB0aGlzLnJlc3RTZXJ2aWNlLnNhdmUocmVxdWVzdEluZm8pO1xyXG4gICAgY29uc3QgcmVzdWx0JCA9IHNhdmUkLnBpcGUoXHJcbiAgICAgIHRhcCgoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eU1hbmFnZXIuY2xlYXJBbGxFbnRpdHlDaGFuZ2VzKCk7XHJcbiAgICAgICAgdGhpcy5yZXBvc2l0b3J5LmNsZWFyQWxsVmFyaWFibGVDaGFuZ2VzKHJlcXVlc3RJbmZvLnZhcmlhYmxlQ2hhbmdlKTtcclxuICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZGF0YUNoYW5nZUhpc3RvcnkuY2xlYXIoKTtcclxuICAgICAgfSksXHJcbiAgICAgIG1hcCgoKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG5cclxuICAgIHJldHVybiByZXN1bHQkO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5bqU55SoaWRBcnJheeWvueW6lOaVsOaNrueahOWPmOabtFxyXG4gICAqL1xyXG4gIHB1YmxpYyBhcHBseUNoYW5nZXNCeUlkQXJyYXkoaWRBcnJheTogc3RyaW5nW10pOiBPYnNlcnZhYmxlPGJvb2xlYW4+IHtcclxuICAgIGNvbnN0IHJlcXVlc3RJbmZvID0gdGhpcy5yZXN0U2VydmljZS5idWlsZFJlcXVlc3RJbmZvKCk7XHJcbiAgICBjb25zdCBzYXZlJCA9IHRoaXMucmVzdFNlcnZpY2Uuc2F2ZShyZXF1ZXN0SW5mbyk7XHJcbiAgICBjb25zdCByZXN1bHQkID0gc2F2ZSQucGlwZShcclxuICAgICAgdGFwKCgpID0+IHtcclxuICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5TWFuYWdlci5jbGVhckVudGl0eUNoYW5nZXNCeUFycmF5KGlkQXJyYXkpO1xyXG4gICAgICAgIHRoaXMucmVwb3NpdG9yeS5kYXRhQ2hhbmdlSGlzdG9yeS5jbGVhckJ5SWRzKGlkQXJyYXkpO1xyXG4gICAgICB9KSxcclxuICAgICAgbWFwKCgpID0+IHtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgfSlcclxuICAgICk7XHJcblxyXG4gICAgcmV0dXJuIHJlc3VsdCQ7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlupTnlKhpZOWvueW6lOaVsOaNrueahOWPmOabtFxyXG4gICAqL1xyXG4gIHB1YmxpYyBhcHBseUNoYW5nZXNCeUlkKGlkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGJvb2xlYW4+IHtcclxuICAgIGNvbnN0IHJlcXVlc3RJbmZvID0gdGhpcy5yZXN0U2VydmljZS5idWlsZFJlcXVlc3RJbmZvKCk7XHJcbiAgICBjb25zdCBzYXZlJCA9IHRoaXMucmVzdFNlcnZpY2Uuc2F2ZShyZXF1ZXN0SW5mbyk7XHJcbiAgICBjb25zdCByZXN1bHQkID0gc2F2ZSQucGlwZShcclxuICAgICAgdGFwKCgpID0+IHtcclxuICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5TWFuYWdlci5jbGVhckVudGl0eUNoYW5nZXNCeUlkKGlkKTtcclxuICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZGF0YUNoYW5nZUhpc3RvcnkuY2xlYXJCeUlkcyhbaWRdKTtcclxuICAgICAgfSksXHJcbiAgICAgIG1hcCgoKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG5cclxuICAgIHJldHVybiByZXN1bHQkO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Y+W5raI5Y+Y5pu0XHJcbiAgICovXHJcbiAgcHVibGljIGNhbmNlbENoYW5nZXMob3B0aW9ucz86IGFueSk6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xyXG4gICAgY29uc3QgY2FuY2VsJCA9IHRoaXMucmVzdFNlcnZpY2UuY2FuY2VsKG9wdGlvbnMpO1xyXG4gICAgY29uc3QgcmVzdWx0JCA9IGNhbmNlbCQucGlwZShcclxuICAgICAgdGFwKCgpID0+IHtcclxuICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5TWFuYWdlci5jbGVhckFsbEVudGl0eUNoYW5nZXMoKTtcclxuICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZGF0YUNoYW5nZUhpc3RvcnkuY2xlYXIoKTtcclxuICAgICAgfSksXHJcbiAgICAgIG1hcCgoKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gICAgcmV0dXJuIHJlc3VsdCQ7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmibnph4/mlrDlop7ku47ooagv5LuO5LuO6KGo5pWw5o2uXHJcbiAgICogQHBhcmFtIHBhdGgg5a6e5L2T57uR5a6a6Lev5b6E77yMbGlrZSAxL2NoaWxkcyBvciAxL2NoaWxkcy8xMS9jaGlsZGNoaWxkc1xyXG4gICAqIEBwYXJhbSBkZWZhdWx0VmFsdWVzIOm7mOiupOWunuS9k+aVsOaNruaVsOe7hFxyXG4gICAqL1xyXG4gIHB1YmxpYyBiYXRjaEFwcGVuZEJ5UGF0aChwYXRoOiBzdHJpbmcsIGRlZmF1bHRWYWx1ZXM6IEFycmF5PGFueT4pOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgY29uc3QgcmVxdWVzdEluZm8gPSB0aGlzLmJ1aWxkUmVxdWVzdEluZm8oKTtcclxuICAgIGNvbnN0IGFwcGVuZCQgPSB0aGlzLnJlc3RQcm94eS5iYXRjaEFwcGVuZEJ5UGF0aChwYXRoLCBkZWZhdWx0VmFsdWVzLCByZXF1ZXN0SW5mbyk7XHJcbiAgICByZXR1cm4gYXBwZW5kJC5waXBlKFxyXG4gICAgICBtYXAoKHJlc3BvbnNlSW5mbzogUmVzcG9uc2VJbmZvKSA9PiB7XHJcbiAgICAgICAgY29uc3QgbGlzdCA9IHJlc3BvbnNlSW5mby5yZXR1cm5WYWx1ZTtcclxuICAgICAgICBjb25zdCBlbnRpdGllcyA9IHRoaXMucmVwb3NpdG9yeS5lbnRpdHlNYW5hZ2VyLmNyZWF0ZUVudGl0aWVzQnlQYXRoKHBhdGgsIGxpc3QpO1xyXG4gICAgICAgIGNvbnN0IHBhdGhzID0gcGF0aC5zcGxpdCgnLycpLmZpbHRlcihwID0+IHApO1xyXG4gICAgICAgIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlNYW5hZ2VyLmFwcGVuZEVudGl0aWVzQnlQYXRoKHBhdGhzLCBlbnRpdGllcyk7XHJcbiAgICAgICAgcmV0dXJuIGVudGl0aWVzO1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5om56YeP5paw5aKe5Li76KGo5pWw5o2uXHJcbiAgICogQHBhcmFtIGRlZmF1bHRWYWx1ZXMg6buY6K6k5a6e5L2T5pWw5o2u5pWw57uEXHJcbiAgICovXHJcbiAgcHVibGljIGJhdGNoQXBwZW5kKGRlZmF1bHRWYWx1ZXM6IEFycmF5PGFueT4pOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgY29uc3QgcmVxdWVzdEluZm8gPSB0aGlzLmJ1aWxkUmVxdWVzdEluZm8oKTtcclxuICAgIGNvbnN0IGFwcGVuZCQgPSB0aGlzLnJlc3RQcm94eS5iYXRjaEFwcGVuZChkZWZhdWx0VmFsdWVzLCByZXF1ZXN0SW5mbyk7XHJcbiAgICByZXR1cm4gYXBwZW5kJC5waXBlKFxyXG4gICAgICBtYXAoKHJlc3BvbnNlSW5mbzogUmVzcG9uc2VJbmZvKSA9PiB7XHJcbiAgICAgICAgY29uc3QgbGlzdCA9IHJlc3BvbnNlSW5mby5yZXR1cm5WYWx1ZTtcclxuICAgICAgICBjb25zdCBlbnRpdGllcyA9IHRoaXMucmVwb3NpdG9yeS5idWlsZEVudGl0aWVzKGxpc3QpO1xyXG4gICAgICAgIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmFkZEVudGl0aWVzKGVudGl0aWVzKTtcclxuICAgICAgICByZXR1cm4gZW50aXRpZXM7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmnoTpgKDlj5jmm7Tpm4ZcclxuICAgKi9cclxuICBwdWJsaWMgYnVpbGRSZXF1ZXN0SW5mbygpOiBSZXF1ZXN0SW5mbyB7XHJcbiAgICBjb25zdCByZXF1ZXN0SW5mbzogUmVxdWVzdEluZm8gPSB7XHJcbiAgICAgIGRhdGFDaGFuZ2U6IHRoaXMucmVwb3NpdG9yeS5lbnRpdHlNYW5hZ2VyLmJ1aWxkQWxsRW50aXR5Q2hhbmdlRGV0YWlscygpLFxyXG4gICAgICB2YXJpYWJsZUNoYW5nZTogdGhpcy5yZXBvc2l0b3J5LnZhcmlhYmxlTWFuYWdlci5idWlsZENoYW5nZURldGFpbCgpXHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIHJlcXVlc3RJbmZvO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IHsgQmVmRGF0YVNlcnZpY2UgfTtcclxuIl19