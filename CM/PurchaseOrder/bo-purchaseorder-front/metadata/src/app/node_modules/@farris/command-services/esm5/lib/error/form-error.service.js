import { Injectable, Optional } from '@angular/core';
import { HttpErrorResponse } from '@angular/common/http';
import { FormMessageService } from '../form-message.service';
import { LanguageService } from '../languag.service';
import { HttpUtil, HttpStatusType } from '../util/http';
/**
 * 表单错误提示服务
 * @description 统一处理前后端异常
 */
var FormErrorService = /** @class */ (function () {
    function FormErrorService(msgService, languageService) {
        this.msgService = msgService;
        this.languageService = languageService;
    }
    /**
     * 异常路由方法
     */
    FormErrorService.prototype.exception = function (message, error) {
        // 针对session失效做特殊处理
        if (error && error.hasOwnProperty('expired') && error['expired'] === true) {
            return;
        }
        if (error && this.isHttpErrorResponse(error)) {
            this.httpErrorHandler(error);
        }
        else {
            // todo: 细化异常处理后，继续拆解该方法
            this.commonErrorHandler(message);
        }
    };
    /**
     * http请求异常处理器
     */
    FormErrorService.prototype.httpErrorHandler = function (httpError) {
        if (!httpError) {
            return;
        }
        var statusType = HttpUtil.getHttpStatusType(httpError.status);
        switch (statusType) {
            case HttpStatusType.ClientError:
                if (httpError.status === 401) {
                    this.msgService.http401Error(httpError);
                    break;
                }
                this.msgService.httpErrorInClient(httpError);
                break;
            case HttpStatusType.ServerError:
                this.msgService.httpErrorInServer(httpError);
                break;
            default:
                throw new Error('Get invalid status code when using httpErrorHandler method.');
        }
    };
    FormErrorService.prototype.commonErrorHandler = function (errorMsg) {
        if (!errorMsg) {
            return;
        }
        this.msgService.error(errorMsg);
    };
    /**
     * httpErrorResponse like
     * @param error 异常
     */
    FormErrorService.prototype.isHttpErrorResponse = function (error) {
        if (!error) {
            return false;
        }
        if (typeof error !== 'object') {
            return false;
        }
        if (error.name === 'HttpErrorResponse' && error.hasOwnProperty('status') && error.hasOwnProperty('error')) {
            return true;
        }
        if (error instanceof HttpErrorResponse) {
            return true;
        }
        return false;
    };
    FormErrorService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    FormErrorService.ctorParameters = function () { return [
        { type: FormMessageService },
        { type: LanguageService, decorators: [{ type: Optional }] }
    ]; };
    return FormErrorService;
}());
export { FormErrorService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9ybS1lcnJvci5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9jb21tYW5kLXNlcnZpY2VzLyIsInNvdXJjZXMiOlsibGliL2Vycm9yL2Zvcm0tZXJyb3Iuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNyRCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUV6RCxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUM3RCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDckQsT0FBTyxFQUFFLFFBQVEsRUFBRSxjQUFjLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFFeEQ7OztHQUdHO0FBQ0g7SUFHRSwwQkFDVSxVQUE4QixFQUNsQixlQUFnQztRQUQ1QyxlQUFVLEdBQVYsVUFBVSxDQUFvQjtRQUNsQixvQkFBZSxHQUFmLGVBQWUsQ0FBaUI7SUFFdEQsQ0FBQztJQUVEOztPQUVHO0lBQ0ksb0NBQVMsR0FBaEIsVUFBaUIsT0FBZSxFQUFFLEtBQVU7UUFDMUMsbUJBQW1CO1FBQ25CLElBQUksS0FBSyxJQUFJLEtBQUssQ0FBQyxjQUFjLENBQUMsU0FBUyxDQUFDLElBQUksS0FBSyxDQUFDLFNBQVMsQ0FBQyxLQUFLLElBQUksRUFBRTtZQUN6RSxPQUFPO1NBQ1I7UUFDRCxJQUFJLEtBQUssSUFBSSxJQUFJLENBQUMsbUJBQW1CLENBQUMsS0FBSyxDQUFDLEVBQUU7WUFDNUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLEtBQUssQ0FBQyxDQUFDO1NBQzlCO2FBQU07WUFFTCx3QkFBd0I7WUFDeEIsSUFBSSxDQUFDLGtCQUFrQixDQUFDLE9BQU8sQ0FBQyxDQUFDO1NBQ2xDO0lBQ0gsQ0FBQztJQUVEOztPQUVHO0lBQ0ksMkNBQWdCLEdBQXZCLFVBQXdCLFNBQTRCO1FBQ2xELElBQUksQ0FBQyxTQUFTLEVBQUU7WUFDZCxPQUFPO1NBQ1I7UUFFRCxJQUFNLFVBQVUsR0FBRyxRQUFRLENBQUMsaUJBQWlCLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBRWhFLFFBQVEsVUFBVSxFQUFFO1lBQ2xCLEtBQUssY0FBYyxDQUFDLFdBQVc7Z0JBQzdCLElBQUksU0FBUyxDQUFDLE1BQU0sS0FBSyxHQUFHLEVBQUU7b0JBQzVCLElBQUksQ0FBQyxVQUFVLENBQUMsWUFBWSxDQUFDLFNBQVMsQ0FBQyxDQUFDO29CQUN4QyxNQUFNO2lCQUNQO2dCQUVELElBQUksQ0FBQyxVQUFVLENBQUMsaUJBQWlCLENBQUMsU0FBUyxDQUFDLENBQUM7Z0JBQzdDLE1BQU07WUFDUixLQUFLLGNBQWMsQ0FBQyxXQUFXO2dCQUM3QixJQUFJLENBQUMsVUFBVSxDQUFDLGlCQUFpQixDQUFDLFNBQVMsQ0FBQyxDQUFDO2dCQUM3QyxNQUFNO1lBQ1I7Z0JBQ0UsTUFBTSxJQUFJLEtBQUssQ0FBQyw2REFBNkQsQ0FBQyxDQUFDO1NBQ2xGO0lBQ0gsQ0FBQztJQUVPLDZDQUFrQixHQUExQixVQUEyQixRQUFnQjtRQUN6QyxJQUFJLENBQUMsUUFBUSxFQUFFO1lBQ2IsT0FBTztTQUNSO1FBQ0QsSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDbEMsQ0FBQztJQUNEOzs7T0FHRztJQUNLLDhDQUFtQixHQUEzQixVQUE0QixLQUFLO1FBQy9CLElBQUksQ0FBQyxLQUFLLEVBQUU7WUFDVixPQUFPLEtBQUssQ0FBQztTQUNkO1FBQ0QsSUFBSSxPQUFPLEtBQUssS0FBSyxRQUFRLEVBQUU7WUFDN0IsT0FBTyxLQUFLLENBQUM7U0FDZDtRQUNELElBQUksS0FBSyxDQUFDLElBQUksS0FBSyxtQkFBbUIsSUFBSSxLQUFLLENBQUMsY0FBYyxDQUFDLFFBQVEsQ0FBQyxJQUFJLEtBQUssQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLEVBQUU7WUFDekcsT0FBTyxJQUFJLENBQUM7U0FDYjtRQUNELElBQUksS0FBSyxZQUFZLGlCQUFpQixFQUFFO1lBQ3RDLE9BQU8sSUFBSSxDQUFDO1NBQ2I7UUFDRCxPQUFPLEtBQUssQ0FBQztJQUNmLENBQUM7O2dCQTdFRixVQUFVOzs7O2dCQVJGLGtCQUFrQjtnQkFDbEIsZUFBZSx1QkFZbkIsUUFBUTs7SUF5RWIsdUJBQUM7Q0FBQSxBQTlFRCxJQThFQztBQUVELE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgT3B0aW9uYWwgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEh0dHBFcnJvclJlc3BvbnNlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuXG5pbXBvcnQgeyBGb3JtTWVzc2FnZVNlcnZpY2UgfSBmcm9tICcuLi9mb3JtLW1lc3NhZ2Uuc2VydmljZSc7XG5pbXBvcnQgeyBMYW5ndWFnZVNlcnZpY2UgfSBmcm9tICcuLi9sYW5ndWFnLnNlcnZpY2UnO1xuaW1wb3J0IHsgSHR0cFV0aWwsIEh0dHBTdGF0dXNUeXBlIH0gZnJvbSAnLi4vdXRpbC9odHRwJztcblxuLyoqXG4gKiDooajljZXplJnor6/mj5DnpLrmnI3liqFcbiAqIEBkZXNjcmlwdGlvbiDnu5/kuIDlpITnkIbliY3lkI7nq6/lvILluLhcbiAqL1xuQEluamVjdGFibGUoKVxuY2xhc3MgRm9ybUVycm9yU2VydmljZSB7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBtc2dTZXJ2aWNlOiBGb3JtTWVzc2FnZVNlcnZpY2UsXG4gICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSBsYW5ndWFnZVNlcnZpY2U6IExhbmd1YWdlU2VydmljZVxuICApIHtcbiAgfVxuXG4gIC8qKlxuICAgKiDlvILluLjot6/nlLHmlrnms5VcbiAgICovXG4gIHB1YmxpYyBleGNlcHRpb24obWVzc2FnZTogc3RyaW5nLCBlcnJvcjogYW55KSB7XG4gICAgLy8g6ZKI5a+5c2Vzc2lvbuWkseaViOWBmueJueauiuWkhOeQhlxuICAgIGlmIChlcnJvciAmJiBlcnJvci5oYXNPd25Qcm9wZXJ0eSgnZXhwaXJlZCcpICYmIGVycm9yWydleHBpcmVkJ10gPT09IHRydWUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGVycm9yICYmIHRoaXMuaXNIdHRwRXJyb3JSZXNwb25zZShlcnJvcikpIHtcbiAgICAgIHRoaXMuaHR0cEVycm9ySGFuZGxlcihlcnJvcik7XG4gICAgfSBlbHNlIHtcblxuICAgICAgLy8gdG9kbzog57uG5YyW5byC5bi45aSE55CG5ZCO77yM57un57ut5ouG6Kej6K+l5pa55rOVXG4gICAgICB0aGlzLmNvbW1vbkVycm9ySGFuZGxlcihtZXNzYWdlKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogaHR0cOivt+axguW8guW4uOWkhOeQhuWZqFxuICAgKi9cbiAgcHVibGljIGh0dHBFcnJvckhhbmRsZXIoaHR0cEVycm9yOiBIdHRwRXJyb3JSZXNwb25zZSk6IHZvaWQge1xuICAgIGlmICghaHR0cEVycm9yKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3Qgc3RhdHVzVHlwZSA9IEh0dHBVdGlsLmdldEh0dHBTdGF0dXNUeXBlKGh0dHBFcnJvci5zdGF0dXMpO1xuXG4gICAgc3dpdGNoIChzdGF0dXNUeXBlKSB7XG4gICAgICBjYXNlIEh0dHBTdGF0dXNUeXBlLkNsaWVudEVycm9yOlxuICAgICAgICBpZiAoaHR0cEVycm9yLnN0YXR1cyA9PT0gNDAxKSB7XG4gICAgICAgICAgdGhpcy5tc2dTZXJ2aWNlLmh0dHA0MDFFcnJvcihodHRwRXJyb3IpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5tc2dTZXJ2aWNlLmh0dHBFcnJvckluQ2xpZW50KGh0dHBFcnJvcik7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBIdHRwU3RhdHVzVHlwZS5TZXJ2ZXJFcnJvcjpcbiAgICAgICAgdGhpcy5tc2dTZXJ2aWNlLmh0dHBFcnJvckluU2VydmVyKGh0dHBFcnJvcik7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdHZXQgaW52YWxpZCBzdGF0dXMgY29kZSB3aGVuIHVzaW5nIGh0dHBFcnJvckhhbmRsZXIgbWV0aG9kLicpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY29tbW9uRXJyb3JIYW5kbGVyKGVycm9yTXNnOiBzdHJpbmcpOiB2b2lkIHtcbiAgICBpZiAoIWVycm9yTXNnKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMubXNnU2VydmljZS5lcnJvcihlcnJvck1zZyk7XG4gIH1cbiAgLyoqXG4gICAqIGh0dHBFcnJvclJlc3BvbnNlIGxpa2VcbiAgICogQHBhcmFtIGVycm9yIOW8guW4uFxuICAgKi9cbiAgcHJpdmF0ZSBpc0h0dHBFcnJvclJlc3BvbnNlKGVycm9yKSB7XG4gICAgaWYgKCFlcnJvcikge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIGVycm9yICE9PSAnb2JqZWN0Jykge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpZiAoZXJyb3IubmFtZSA9PT0gJ0h0dHBFcnJvclJlc3BvbnNlJyAmJiBlcnJvci5oYXNPd25Qcm9wZXJ0eSgnc3RhdHVzJykgJiYgZXJyb3IuaGFzT3duUHJvcGVydHkoJ2Vycm9yJykpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBIdHRwRXJyb3JSZXNwb25zZSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufVxuXG5leHBvcnQgeyBGb3JtRXJyb3JTZXJ2aWNlIH07XG5cbiJdfQ==