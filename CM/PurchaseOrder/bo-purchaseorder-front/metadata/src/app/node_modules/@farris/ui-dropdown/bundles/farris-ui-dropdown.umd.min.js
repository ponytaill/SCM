!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("rxjs"),require("@farris/ui-common"),require("@angular/core"),require("@angular/common")):"function"==typeof define&&define.amd?define("@farris/ui-dropdown",["exports","rxjs","@farris/ui-common","@angular/core","@angular/common"],t):t((e.farris=e.farris||{},e.farris["ui-dropdown"]={}),e.rxjs,e.uiCommon,e.ng.core,e.ng.common)}(this,function(e,i,n,o,t){"use strict";var s=(Object.defineProperty(r.prototype,"forceState",{set:function(e){e&&e.length&&this.close()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"openState",{set:function(e){this._internalOpen=e[0],this.isOpenState.next(e[0])},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"placement",{get:function(){return this._placement},set:function(e){if(e&&e!==this._placement){var t=this._getClsName(e),n=this._getClsName(this._placement);this.render.removeClass(this._seflEl,n),this.render.addClass(this._seflEl,t),this._placement=e}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isOpen",{get:function(){return this._internalOpen},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"submenuCls",{get:function(){return this.isSubDP},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"dropdownCls",{get:function(){return!this.isSubDP},enumerable:!0,configurable:!0}),r.prototype.ngOnInit=function(){},r.prototype.getNativeElement=function(){return this._seflEl},r.prototype.bindDocumentEvents=function(){this.documentClickEventListener=this.onDocumentClick.bind(this),document.addEventListener("click",this.documentClickEventListener),this.selfDefineEventListener=this.onSelfDefineHandler.bind(this),this._seflEl.addEventListener("selfClose",this.selfDefineEventListener)},r.prototype.onSelfDefineHandler=function(){this.close()},r.prototype.unbindDocumentEvents=function(){this.documentClickEventListener&&(document.removeEventListener("click",this.documentClickEventListener),this.documentClickEventListener=null),this.selfDefineEventListener&&(this._seflEl.removeEventListener("selfClose",this.selfDefineEventListener),this.selfDefineEventListener=null)},r.prototype.onDocumentClick=function(e){this._internalOpen&&(2===e.button||this.isEventFromToggle(e)||this.close())},r.prototype.needToCalculate=function(){return this.autoRectify&&this._calculateMenu},r.prototype.resetCalculate=function(e){this._calculateMenu=e},r.prototype.open=function(){this._internalOpen||(this.closeSiblingDropdowns(),this._calculateMenu=!0,this.render.addClass(this._seflEl,"show"),this.isOpenState.next(!0),this.dpChangeEvent.emit(!0),this.bindDocumentEvents())},r.prototype.close=function(){this._internalOpen&&(this._calculateMenu=!1,this.render.removeClass(this._seflEl,"show"),this.isOpenState.next(!1),this.dpChangeEvent.emit(!1),this.unbindDocumentEvents())},r.prototype.toggle=function(){this._internalOpen?this.close():this.open()},r.prototype.getOpenState=function(){return this.isOpenState},r.prototype.ngOnDestroy=function(){this.isOpenState.unsubscribe(),this.unbindDocumentEvents();var e=this.menuEls.get(this._seflEl);e&&e.length&&e.forEach(function(e){e.remove()})},r.prototype.closeSiblingDropdowns=function(){var e=this._seflEl.parentNode;if(e&&-1<e.className.indexOf("dropdown-menu")){var t=e.querySelectorAll("[fDropdown]");if(t&&1<t.length)for(var n=0;n<t.length;n++)t[n].className.indexOf("show")&&this.compatibleDispatchEvent(t[n],"selfClose")}},r.prototype.compatibleDispatchEvent=function(e,t){var n;"function"==typeof Event?n=new Event(t):(n=document.createEvent("Event")).initEvent(t,!1,!1),e.dispatchEvent(n)},r.prototype._getClsName=function(e){var t="";switch(e){case"top-right":case"top":t="dropup";break;case"top-left":t="dropup-left";break;case"left-bottom":case"left":t="dropleft";break;case"left-top":t="dropleft-up";break;case"right-bottom":case"right":t="dropright";break;case"right-top":t="dropright-up";break;case"bottom-left":t="dropdown-left";break;case"bottom-right":t="dropdown";break;default:t="dropdown"}return t},r.prototype.isEventFromToggle=function(e){return this.toggleElement&&this.toggleElement.contains(e.target)},r.prototype.getRectifyReferenceEl=function(){var e=window.innerWidth,t=window.innerHeight;return this.rectifyReference&&(e=this.rectifyReference.getBoundingClientRect().right),this.rectifyReferenceV&&(e=this.rectifyReference.getBoundingClientRect().bottom),{width:e,height:t}},r.prototype.appendMenuEl=function(e){var t=this.menuEls.get(e)||[];t.push(e),this.menuEls.set(this._seflEl,t)},r.decorators=[{type:o.Directive,args:[{selector:"[fDropdown]",exportAs:"fDropdown"}]}],r.ctorParameters=function(){return[{type:o.ElementRef},{type:o.Renderer2}]},r.propDecorators={rectifyReference:[{type:o.Input}],rectifyReferenceV:[{type:o.Input}],autoRectify:[{type:o.Input}],forceState:[{type:o.Input,args:["forceState"]}],openState:[{type:o.Input,args:["open"]}],dpChangeEvent:[{type:o.Output}],isSubDP:[{type:o.Input}],placement:[{type:o.Input,args:["placement"]}],submenuCls:[{type:o.HostBinding,args:["class.dropdown-submenu"]}],dropdownCls:[{type:o.HostBinding,args:["class.dropdown"]}]},r);function r(e,t){var n=this;this.elementRef=e,this.render=t,this._internalOpen=!1,this._calculateMenu=!1,this.autoRectify=!1,this.dpChangeEvent=new o.EventEmitter,this._placement="bottom",this.isSubDP=!1,this.isOpenState=new i.Subject,this.menuEls=new WeakMap,this._seflEl=this.elementRef.nativeElement,this.isOpenState.subscribe(function(e){n._internalOpen!==e&&(n._internalOpen=e,n._internalOpen?n.render.addClass(n._seflEl,"show"):n.render.removeClass(n._seflEl,"show"))})}var l=(p.prototype.ngAfterViewChecked=function(){},p.prototype.getRealPlacement=function(e){var t="bottom-right";switch(e){case"top":t="top-right";break;case"left":t="left-bottom";break;case"right":t="right-bottom";break;case"bottom":t="bottom-right";break;default:t=e}return t},p.prototype.ngOnDestroy=function(){},p.prototype.openStateChange=function(){var e=this;this.dpIsOpen?this.elementRef.nativeElement.className.indexOf("show")<0&&(document.body.style.overflow="hidden",this.elementRef.nativeElement.style.visibility="hidden",this.elementRef.nativeElement.className+=" show",this.dropdown.needToCalculate()&&(this._docRect=this.dropdown.getRectifyReferenceEl()),setTimeout(function(){e.changeDirection(),document.body.style.overflow="",e.elementRef.nativeElement.style.visibility="visible"},0)):(-1<this.elementRef.nativeElement.className.indexOf("show")&&(this.elementRef.nativeElement.className=this.elementRef.nativeElement.className.replace(" show"," "),this.elementRef.nativeElement.style.cssText=""),this.dropdown._internalOpen=!1)},p.prototype.changeDirection=function(){this.setMenuPanelPosition()},p.prototype.issubMenu=function(){var e=this.dropdown.getNativeElement();return-1<e.className.indexOf("dropdown-submenu")||e.closest(".dropdown-submenu")},p.prototype.setMenuPanelPosition=function(){var e=this.dropdown.getNativeElement(),t=e.getBoundingClientRect(),n=t.height,i=t.left,o=t.top,s=t.width,r=this.elementRef.nativeElement.getBoundingClientRect(),l=r.width,p=r.height,a=o+n,c=i;if(window.innerHeight-o-n<p&&(a=o-p),window.innerWidth-i-s<l&&(c=i-l+s),this.issubMenu()){var d=window.innerWidth-i-e.offsetWidth,u=this.elementRef.nativeElement;if(u.offsetWidth>d){var h=16-e.offsetWidth;u.style.left=h+"px"}if(window.innerHeight-u.getBoundingClientRect().top<u.offsetHeight){var f=window.innerHeight-o-u.offsetHeight-10;u.style.top=f+"px"}}else document.body.append(this.elementRef.nativeElement),this.dropdown.appendMenuEl(this.elementRef.nativeElement),this.elementRef.nativeElement.style.cssText="position:fixed;bottom:unset;left:"+c+"px !important;top:"+a+"px !important;right: unset;z-index: 100000;"},p.decorators=[{type:o.Directive,args:[{selector:"[fDropdownMenu]"}]}],p.ctorParameters=function(){return[{type:o.ElementRef},{type:s}]},p.propDecorators={showDropdownMenu:[{type:o.HostBinding,args:["class.dropdown-menu"]}],dpIsOpen:[{type:o.Input}]},p);function p(e,t){var i=this;this.elementRef=e,this.dropdown=t,this._docRect={width:0,height:0},this.showDropdownMenu=!0,this.dpIsOpen=!1,this.overLayService=null,this.overLayService=new n.OverLayHiddenService,this.dropdown.getOpenState().subscribe(function(e){var t=i.dropdown.getNativeElement();i.dpIsOpen=i.dropdown.isOpen,i.dpIsOpen?i.overLayService.registerMouseEvent(t,function(e){var t=e.target,n=Array.from(t.classList||[]);-1<t.className.indexOf("dropdown-toggle")||t.closest(".dropdown-item")||n.includes("dropdown-item")||(i.dpIsOpen=!1,i.openStateChange())}):i.overLayService.destory(t),i.openStateChange()})}var a=(Object.defineProperty(c.prototype,"dpDisabled",{set:function(e){this._disabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"disableCls",{get:function(){return this._disabled},enumerable:!0,configurable:!0}),c.prototype.onclick=function(e){this._disabled||(this.dropdown.isSubDP&&e.stopImmediatePropagation(),this.dropdown.toggle())},c.decorators=[{type:o.Directive,args:[{selector:"[fDropdownToggle]"}]}],c.ctorParameters=function(){return[{type:s},{type:o.ElementRef}]},c.propDecorators={dpDisabled:[{type:o.Input}],disableCls:[{type:o.HostBinding,args:["class.disabled"]}],haspopup:[{type:o.HostBinding,args:["attr.aria-haspopup"]}],onclick:[{type:o.HostListener,args:["click",["$event"]]}]},c);function c(e,t){var n=this;this.dropdown=e,this.elementRef=t,this._disabled=!1,this.haspopup=!0,this.nativeEle=null,e.toggleElement=t.nativeElement,this.nativeEle=t.nativeElement,this.dropdown.getOpenState().subscribe(function(e){n.dropdown.isSubDP&&n.dropdown.isOpen?n.nativeEle.className.indexOf("active")<0&&(n.nativeEle.className+=" active"):-1<n.nativeEle.className.indexOf("active")&&(n.nativeEle.className=n.nativeEle.className.replace(" active"," "))})}var d=[s,l,a],u=(h.decorators=[{type:o.NgModule,args:[{imports:[n.FarrisCommonModule],declarations:d,exports:d}]}],h);function h(){}var f=(Object.defineProperty(m.prototype,"width",{get:function(){return this._width},set:function(e){this._width=this.resolveSize(e)},enumerable:!0,configurable:!0}),m.prototype.ngOnInit=function(){this.menu=this.el.nativeElement.querySelector(".dropdown-menu")},m.prototype.ngAfterViewInit=function(){},m.prototype.ngOnDestroy=function(){this.globalListenFunc&&this.globalListenFunc()},m.prototype.showDropMenu=function(e){var t=this;this.hover||(e&&e.stopPropagation(),this.show=!this.show,this.visibleChange.emit(),this.globalListenFunc=this.renderer.listen("document","click",function(){t.closeDropMenu()}),this.hideOnClick||(this.menuListenFunc=this.renderer.listen(this.menu,"click",function(e){e.stopPropagation()})))},m.prototype.closeDropMenu=function(){this.hover||(this.show=!1,this.visibleChange.emit(),this.globalListenFunc&&this.globalListenFunc(),this.menuListenFunc&&this.menuListenFunc())},m.prototype.hoverDropdown=function(){this.hover&&(this.show=!this.show,this.visibleChange.emit())},m.prototype.selectItem=function(e){this.select.emit(e)},m.prototype.leftButtonClick=function(){this.leftClick.emit()},m.prototype.resolveSize=function(e){var t=/px|em|rem|pt|%/;return t.test(e)?""+parseInt(e,10)+e.match(t)[0]:e+"px"},m.decorators=[{type:o.Component,args:[{selector:"farris-dropdown",template:'\n        <div\n            class="farris-dropdown btn-group"\n            [class.dropup]="position === \'top\'"\n            [class.dropdown]="position === \'bottom\'"\n            [class.dropleft]="position === \'left\'"\n            [class.dropright]="position === \'right\'"\n            [style.width]="width"\n        >\n            <span\n                [class.btn]="!nest"\n                [class.dropdown-item]="nest"\n                [class.btn-lg]="size === \'large\'"\n                [class.btn-sm]="size === \'small\'"\n                [class.btn-primary]="type === \'primary\'"\n                [class.btn-success]="type === \'success\'"\n                [class.btn-warning]="type === \'warning\'"\n                [class.btn-danger]="type === \'danger\'"\n                [class.btn-info]="type === \'info\'"\n                (click)="leftButtonClick()"\n                style="width:100%"\n                *ngIf="splitButton"\n                >{{ title }}</span\n            >\n            <span\n                class="dropdown-toggle"\n                [class.btn]="!nest"\n                [class.dropdown-item]="nest"\n                [class.dropdown-toggle-split]="splitButton"\n                [class.btn-lg]="size === \'large\'"\n                [class.btn-sm]="size === \'small\'"\n                [class.btn-primary]="type === \'primary\'"\n                [class.btn-success]="type === \'success\'"\n                [class.btn-warning]="type === \'warning\'"\n                [class.btn-danger]="type === \'danger\'"\n                [class.btn-info]="type === \'info\'"\n                [class.btn-secondary]="type === \'secondary\'"\n                (click)="showDropMenu($event)"\n                (mouseenter)="hoverDropdown()"\n                (mouseleave)="hoverDropdown()"\n                style="width:100%"\n            >\n                <span class="sr-only" *ngIf="splitButton"></span>\n                {{ splitButton ? \'\' : title }}\n            </span>\n            <div class="dropdown-menu" [class.show]="show">\n                <ng-template [ngTemplateOutlet]="dropdownTempl"></ng-template>\n                <farris-dropdown-item\n                    *ngFor="let item of model"\n                    [model]="item"\n                    (select)="selectItem($event)"\n                >\n                </farris-dropdown-item>\n            </div>\n        </div>\n    '}]}],m.ctorParameters=function(){return[{type:o.ElementRef},{type:o.Renderer2}]},m.propDecorators={nest:[{type:o.Input}],width:[{type:o.Input}],title:[{type:o.Input}],hover:[{type:o.Input}],size:[{type:o.Input}],type:[{type:o.Input}],hideOnClick:[{type:o.Input,args:["hide-on-click"]}],splitButton:[{type:o.Input,args:["split-button"]}],position:[{type:o.Input}],model:[{type:o.Input}],dropdownTempl:[{type:o.ContentChild,args:["dropdownTempl"]}],leftClick:[{type:o.Output,args:["left-click"]}],select:[{type:o.Output}],visibleChange:[{type:o.Output,args:["visible-change"]}]},m);function m(e,t){this.el=e,this.renderer=t,this.type="primary",this.hideOnClick=!0,this.splitButton=!1,this.position="bottom",this.model=[{label:"项目一",value:"asdasd"},{label:"项目二",value:"asdasd"},{label:"项目三",value:"asdasd"}],this.leftClick=new o.EventEmitter,this.select=new o.EventEmitter,this.visibleChange=new o.EventEmitter,this.show=!1}var g=(y.prototype.selectItem=function(){this.model.disabled||this.select.emit(this.model)},y.decorators=[{type:o.Component,args:[{selector:"farris-dropdown-item",template:'\n        <div class="dropdown-divider" *ngIf="model.divide"></div>\n        <a\n            class="dropdown-item"\n            [class.active]="model.active"\n            [class.disabled]="model.disabled"\n            href="javascript:void(0)"\n            (click)="selectItem()"\n            >{{ model.label }}</a\n        >\n    '}]}],y.propDecorators={model:[{type:o.Input}],select:[{type:o.Output}]},y);function y(){this.select=new o.EventEmitter}var v=(b.decorators=[{type:o.NgModule,args:[{imports:[t.CommonModule],declarations:[f,g],exports:[f,g]}]}],b);function b(){}e.FDropdownDirectiveTypeModule=u,e.FDropdownMenuDirective=l,e.FDropdownToggleDirective=a,e.FDropdownDirective=s,e.FarrisDropdownComponent=f,e.FarrisDropdownItemComponent=g,e.FarrisDropdownModule=v,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=farris-ui-dropdown.umd.min.js.map