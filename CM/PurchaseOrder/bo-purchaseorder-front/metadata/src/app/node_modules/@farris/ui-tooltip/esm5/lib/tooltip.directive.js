/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Directive, Input, ElementRef, Renderer2, ViewContainerRef, ComponentFactoryResolver, } from "@angular/core";
import { OverLayHiddenService } from "@farris/ui-common";
import { TooltipComponent } from "./tooltip-component/tooltip.component";
var FarrisTooltipDirective = /** @class */ (function () {
    function FarrisTooltipDirective(el, render, viewContainerRef, resolver) {
        this.el = el;
        this.render = render;
        this.viewContainerRef = viewContainerRef;
        this.resolver = resolver;
        this.tooltipEnable = true;
        /* 提示文本 */
        this.text = "";
        // 提示框样式
        this.tipCls = "";
        // 提示框宽度
        this.tipWidth = "";
        /* 位置 */
        this.placement = "top";
        this.triggerMode = "hover";
        this.showTip = true;
        this.delay = 0;
        // 是否绑定了事件
        this.hasBindEvent = false;
        this.delayTimer = null;
        /* 生成提示组件 */
        this.componentFactory = this.resolver.resolveComponentFactory(TooltipComponent);
        this.overLayService = new OverLayHiddenService();
    }
    Object.defineProperty(FarrisTooltipDirective.prototype, "enableTooltip", {
        get: /**
         * @return {?}
         */
        function () {
            return this.tooltipEnable;
        },
        // 5月7日追加这种写法，控制禁用、启用
        // 原来的时候value是空字符串
        set: 
        // 5月7日追加这种写法，控制禁用、启用
        // 原来的时候value是空字符串
        /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            if (typeof value == "string" && value == "") {
                this.enableOrDisable(true);
            }
            else {
                this.enableOrDisable(value);
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FarrisTooltipDirective.prototype, "trigger", {
        get: /**
         * @return {?}
         */
        function () {
            return this.triggerMode;
        },
        /* 触发方式 */
        set: /* 触发方式 */
        /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            if (value) {
                if (value !== this.triggerMode) {
                    this.triggerMode = value;
                    this.unbindEvent();
                    this.bindEvent();
                }
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FarrisTooltipDirective.prototype, "disable", {
        get: /**
         * @return {?}
         */
        function () {
            return !this.tooltipEnable;
        },
        /* 禁用---跟其他控件的属性容易冲突，逐渐废弃。
         * 比如按钮可以设置禁用不触发点击，但想给出点击提示，这样就冲突了
         */
        set: /* 禁用---跟其他控件的属性容易冲突，逐渐废弃。
             * 比如按钮可以设置禁用不触发点击，但想给出点击提示，这样就冲突了
             */
        /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this.enableOrDisable(!value);
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    FarrisTooltipDirective.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.bindEvent();
    };
    /**
     * @return {?}
     */
    FarrisTooltipDirective.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () { };
    /**
     * @return {?}
     */
    FarrisTooltipDirective.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.unbindEvent();
        this.removeTooltip();
        this.overLayService.destory(this.el.nativeElement);
        this.overLayService = null;
    };
    /**
     * @private
     * @param {?} value
     * @return {?}
     */
    FarrisTooltipDirective.prototype.enableOrDisable = /**
     * @private
     * @param {?} value
     * @return {?}
     */
    function (value) {
        this.tooltipEnable = value;
        if (this.tooltipEnable) {
            this.bindEvent();
        }
        else {
            this.unbindEvent();
        }
    };
    /**
     * @return {?}
     */
    FarrisTooltipDirective.prototype.bindEvent = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (!this.tooltipEnable) {
            return;
        }
        // 是否已绑定事件
        if (this.hasBindEvent) {
            return;
        }
        if (this.trigger === "click") {
            // 鼠标点击
            this.clickEvent = this.render.listen(this.el.nativeElement, "click", (/**
             * @param {?} e
             * @return {?}
             */
            function (e) {
                e.stopPropagation();
                _this.appendTooltip();
                _this.clickOutEvent = _this.render.listen(document, "click", (/**
                 * @return {?}
                 */
                function () {
                    _this.removeTooltip();
                    _this.clickOutEvent();
                }));
            }));
        }
        else if (this.trigger === "focus") {
            // 聚焦
            // @Todo 需要把input等组件和普通组件分开
            this.focusDownEvent = this.render.listen(this.el.nativeElement, "mousedown", (/**
             * @param {?} e
             * @return {?}
             */
            function (e) {
                e.preventDefault();
                _this.appendTooltip();
            }));
            this.focusUpEvent = this.render.listen(this.el.nativeElement, "mouseup", (/**
             * @param {?} e
             * @return {?}
             */
            function (e) {
                e.stopPropagation();
                _this.removeTooltip();
            }));
        }
        else {
            // 鼠标移动上去
            this.mouseenterEvent = this.render.listen(this.el.nativeElement, "mouseenter", (/**
             * @param {?} e
             * @return {?}
             */
            function (e) {
                e.stopPropagation();
                if (_this.delay) {
                    if (_this.delayTimer) {
                        clearTimeout(_this.delayTimer);
                    }
                    _this.delayTimer = setTimeout((/**
                     * @return {?}
                     */
                    function () {
                        _this.appendTooltip();
                        clearTimeout(_this.delayTimer);
                    }), _this.delay);
                }
                else {
                    _this.appendTooltip();
                }
            }));
            this.mouseleaveEvent = this.render.listen(this.el.nativeElement, "mouseleave", (/**
             * @param {?} e
             * @return {?}
             */
            function (e) {
                e.stopPropagation();
                if (_this.delayTimer) {
                    clearTimeout(_this.delayTimer);
                }
                _this.removeTooltip();
            }));
        }
        this.hasBindEvent = true;
    };
    /* 解绑事件 */
    /* 解绑事件 */
    /**
     * @return {?}
     */
    FarrisTooltipDirective.prototype.unbindEvent = /* 解绑事件 */
    /**
     * @return {?}
     */
    function () {
        // 鼠标移上去
        if (this.mouseenterEvent) {
            this.mouseenterEvent();
        }
        if (this.mouseleaveEvent) {
            this.mouseleaveEvent();
        }
        if (this.clickEvent) {
            this.clickEvent();
        }
        if (this.clickOutEvent) {
            this.clickOutEvent();
        }
        if (this.focusDownEvent) {
            this.focusDownEvent();
        }
        if (this.focusUpEvent) {
            this.focusUpEvent();
        }
        this.hasBindEvent = false;
    };
    /* body  移除tooltip */
    /* body  移除tooltip */
    /**
     * @return {?}
     */
    FarrisTooltipDirective.prototype.removeTooltip = /* body  移除tooltip */
    /**
     * @return {?}
     */
    function () {
        if (this.tooltip) {
            this.render.removeChild(document.body, this.tooltip.el.nativeElement);
            this._componentRef.changeDetectorRef.markForCheck();
            this._componentRef.changeDetectorRef.detectChanges();
            this._componentRef.destroy();
            this.viewContainerRef.clear();
            this.tooltip = null;
            this._componentRef = null;
            this.overLayService.destory(this.el.nativeElement);
        }
    };
    /**
     * @private
     * @return {?}
     */
    FarrisTooltipDirective.prototype.appendTooltip = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        if (!this.showTip)
            return;
        this.generateTooltip();
        this.updateViewProps(this.placement, this.content, this.el.nativeElement.getBoundingClientRect(), this.getReferencePosition());
        this.overLayService.registerMouseEvent(this.el.nativeElement, (/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            _this.removeTooltip();
        }));
    };
    /* 更新tooltip组件属性 */
    /* 更新tooltip组件属性 */
    /**
     * @private
     * @param {?} placement
     * @param {?} content
     * @param {?} hostBoundingClientRect
     * @param {?} referenceBoundingRect
     * @return {?}
     */
    FarrisTooltipDirective.prototype.updateViewProps = /* 更新tooltip组件属性 */
    /**
     * @private
     * @param {?} placement
     * @param {?} content
     * @param {?} hostBoundingClientRect
     * @param {?} referenceBoundingRect
     * @return {?}
     */
    function (placement, content, hostBoundingClientRect, referenceBoundingRect) {
        this.tooltip.placement = placement;
        this.tooltip.content = content;
        this.tooltip.hostBoundingClientRect = hostBoundingClientRect;
        this.tooltip.tipCls = this.tipCls;
        this.tooltip.tipWidth = this.tipWidth;
        this.tooltip.referenceBoundingRect = referenceBoundingRect;
        this._componentRef.changeDetectorRef.markForCheck();
        this._componentRef.changeDetectorRef.detectChanges();
    };
    /* 构造tooltip结构 */
    /* 构造tooltip结构 */
    /**
     * @private
     * @return {?}
     */
    FarrisTooltipDirective.prototype.generateTooltip = /* 构造tooltip结构 */
    /**
     * @private
     * @return {?}
     */
    function () {
        this._componentRef = this.viewContainerRef.createComponent(this.componentFactory);
        this.tooltip = this._componentRef.instance;
        // 父元素中移除  添加到body中
        this.render.removeChild(this.render.parentNode(this.el.nativeElement), this.tooltip.el.nativeElement);
        this.render.appendChild(document.body, this.tooltip.el.nativeElement);
    };
    /**
     * 确认参照的边界
     */
    /**
     * 确认参照的边界
     * @private
     * @return {?}
     */
    FarrisTooltipDirective.prototype.getReferencePosition = /**
     * 确认参照的边界
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var rRight = document.documentElement.clientWidth;
        /** @type {?} */
        var rBottom = document.documentElement.clientHeight;
        /** @type {?} */
        var rTop = 0;
        /** @type {?} */
        var rLeft = 0;
        // 横向参照
        if (this.rectifyReferenceH) {
            /** @type {?} */
            var rectifyReferenceHEl = this.getRectifyReferenceElement(this.rectifyReferenceH);
            rRight = rectifyReferenceHEl.getBoundingClientRect().right;
            rLeft = rectifyReferenceHEl.getBoundingClientRect().left;
        }
        // 纵向参照
        if (this.rectifyReferenceV) {
            /** @type {?} */
            var rectifyReferenceVEl = this.getRectifyReferenceElement(this.rectifyReferenceV);
            rBottom = rectifyReferenceVEl.getBoundingClientRect().bottom;
            rTop = rectifyReferenceVEl.getBoundingClientRect().top;
        }
        return { top: rTop, left: rLeft, right: rRight, bottom: rBottom };
    };
    /**
     * 获取纠正元素
     */
    /**
     * 获取纠正元素
     * @private
     * @param {?} referenceEl
     * @return {?}
     */
    FarrisTooltipDirective.prototype.getRectifyReferenceElement = /**
     * 获取纠正元素
     * @private
     * @param {?} referenceEl
     * @return {?}
     */
    function (referenceEl) {
        if (referenceEl instanceof ElementRef) {
            return referenceEl.nativeElement;
        }
        else if (typeof referenceEl == "string") {
            return document.querySelector((/** @type {?} */ (referenceEl)));
        }
        return referenceEl;
    };
    FarrisTooltipDirective.decorators = [
        { type: Directive, args: [{
                    selector: "[farrisTooltip]",
                },] }
    ];
    /** @nocollapse */
    FarrisTooltipDirective.ctorParameters = function () { return [
        { type: ElementRef },
        { type: Renderer2 },
        { type: ViewContainerRef },
        { type: ComponentFactoryResolver }
    ]; };
    FarrisTooltipDirective.propDecorators = {
        enableTooltip: [{ type: Input, args: ["farrisTooltip",] }],
        text: [{ type: Input }],
        tipCls: [{ type: Input }],
        tipWidth: [{ type: Input }],
        placement: [{ type: Input }],
        trigger: [{ type: Input }],
        disable: [{ type: Input }],
        showTip: [{ type: Input }],
        rectifyReferenceH: [{ type: Input }],
        rectifyReferenceV: [{ type: Input }],
        delay: [{ type: Input }],
        content: [{ type: Input }]
    };
    return FarrisTooltipDirective;
}());
export { FarrisTooltipDirective };
if (false) {
    /**
     * @type {?}
     * @private
     */
    FarrisTooltipDirective.prototype.tooltipEnable;
    /**
     * @type {?}
     * @private
     */
    FarrisTooltipDirective.prototype._componentRef;
    /** @type {?} */
    FarrisTooltipDirective.prototype.text;
    /** @type {?} */
    FarrisTooltipDirective.prototype.tipCls;
    /** @type {?} */
    FarrisTooltipDirective.prototype.tipWidth;
    /** @type {?} */
    FarrisTooltipDirective.prototype.placement;
    /**
     * @type {?}
     * @private
     */
    FarrisTooltipDirective.prototype.triggerMode;
    /** @type {?} */
    FarrisTooltipDirective.prototype.showTip;
    /** @type {?} */
    FarrisTooltipDirective.prototype.rectifyReferenceH;
    /** @type {?} */
    FarrisTooltipDirective.prototype.rectifyReferenceV;
    /** @type {?} */
    FarrisTooltipDirective.prototype.delay;
    /** @type {?} */
    FarrisTooltipDirective.prototype.content;
    /** @type {?} */
    FarrisTooltipDirective.prototype.mouseenterEvent;
    /** @type {?} */
    FarrisTooltipDirective.prototype.mouseleaveEvent;
    /** @type {?} */
    FarrisTooltipDirective.prototype.clickEvent;
    /** @type {?} */
    FarrisTooltipDirective.prototype.clickOutEvent;
    /** @type {?} */
    FarrisTooltipDirective.prototype.focusDownEvent;
    /** @type {?} */
    FarrisTooltipDirective.prototype.focusUpEvent;
    /** @type {?} */
    FarrisTooltipDirective.prototype.docBody;
    /**
     * @type {?}
     * @private
     */
    FarrisTooltipDirective.prototype.hasBindEvent;
    /**
     * @type {?}
     * @private
     */
    FarrisTooltipDirective.prototype.delayTimer;
    /** @type {?} */
    FarrisTooltipDirective.prototype.componentFactory;
    /** @type {?} */
    FarrisTooltipDirective.prototype.tooltipRef;
    /** @type {?} */
    FarrisTooltipDirective.prototype.tooltip;
    /** @type {?} */
    FarrisTooltipDirective.prototype.overLayService;
    /**
     * @type {?}
     * @private
     */
    FarrisTooltipDirective.prototype.el;
    /**
     * @type {?}
     * @private
     */
    FarrisTooltipDirective.prototype.render;
    /**
     * @type {?}
     * @private
     */
    FarrisTooltipDirective.prototype.viewContainerRef;
    /**
     * @type {?}
     * @private
     */
    FarrisTooltipDirective.prototype.resolver;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9vbHRpcC5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLXRvb2x0aXAvIiwic291cmNlcyI6WyJsaWIvdG9vbHRpcC5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFFSCxTQUFTLEVBQ1QsS0FBSyxFQUNMLFVBQVUsRUFFVixTQUFTLEVBSVQsZ0JBQWdCLEVBQ2hCLHdCQUF3QixHQUczQixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUN6RCxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSx1Q0FBdUMsQ0FBQztBQUN6RTtJQXVGSSxnQ0FDWSxFQUFjLEVBQ2QsTUFBaUIsRUFDakIsZ0JBQWtDLEVBQ2xDLFFBQWtDO1FBSGxDLE9BQUUsR0FBRixFQUFFLENBQVk7UUFDZCxXQUFNLEdBQU4sTUFBTSxDQUFXO1FBQ2pCLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7UUFDbEMsYUFBUSxHQUFSLFFBQVEsQ0FBMEI7UUFyRnRDLGtCQUFhLEdBQVksSUFBSSxDQUFDOztRQWdCN0IsU0FBSSxHQUFHLEVBQUUsQ0FBQzs7UUFFVixXQUFNLEdBQUcsRUFBRSxDQUFDOztRQUVaLGFBQVEsR0FBRyxFQUFFLENBQUM7O1FBRWQsY0FBUyxHQUFHLEtBQUssQ0FBQztRQUVuQixnQkFBVyxHQUFHLE9BQU8sQ0FBQztRQTJCckIsWUFBTyxHQUFZLElBQUksQ0FBQztRQU14QixVQUFLLEdBQUcsQ0FBQyxDQUFDOztRQWFYLGlCQUFZLEdBQUcsS0FBSyxDQUFDO1FBRXJCLGVBQVUsR0FBRyxJQUFJLENBQUM7O1FBRzFCLHFCQUFnQixHQUNaLElBQUksQ0FBQyxRQUFRLENBQUMsdUJBQXVCLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztRQVd4RCxJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksb0JBQW9CLEVBQUUsQ0FBQztJQUNyRCxDQUFDO0lBcEZELHNCQUNJLGlEQUFhOzs7O1FBT2pCO1lBQ0ksT0FBTyxJQUFJLENBQUMsYUFBYSxDQUFDO1FBQzlCLENBQUM7UUFaRCxxQkFBcUI7UUFDckIsa0JBQWtCOzs7Ozs7OztRQUNsQixVQUNrQixLQUFVO1lBQ3hCLElBQUksT0FBTyxLQUFLLElBQUksUUFBUSxJQUFJLEtBQUssSUFBSSxFQUFFLEVBQUU7Z0JBQ3pDLElBQUksQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLENBQUM7YUFDOUI7aUJBQU07Z0JBQ0gsSUFBSSxDQUFDLGVBQWUsQ0FBQyxLQUFLLENBQUMsQ0FBQzthQUMvQjtRQUNMLENBQUM7OztPQUFBO0lBZUQsc0JBQ0ksMkNBQU87Ozs7UUFTWDtZQUNJLE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQztRQUM1QixDQUFDO1FBYkQsVUFBVTs7Ozs7O1FBQ1YsVUFDWSxLQUFLO1lBQ2IsSUFBSSxLQUFLLEVBQUU7Z0JBQ1AsSUFBSSxLQUFLLEtBQUssSUFBSSxDQUFDLFdBQVcsRUFBRTtvQkFDNUIsSUFBSSxDQUFDLFdBQVcsR0FBRyxLQUFLLENBQUM7b0JBQ3pCLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztvQkFDbkIsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO2lCQUNwQjthQUNKO1FBQ0wsQ0FBQzs7O09BQUE7SUFRRCxzQkFDSSwyQ0FBTzs7OztRQUdYO1lBQ0ksT0FBTyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUM7UUFDL0IsQ0FBQztRQVREOztXQUVHOzs7Ozs7OztRQUNILFVBQ1ksS0FBSztZQUNiLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNqQyxDQUFDOzs7T0FBQTs7OztJQTRDRCx5Q0FBUTs7O0lBQVI7UUFDSSxJQUFJLENBQUMsU0FBUyxFQUFFLENBQUM7SUFDckIsQ0FBQzs7OztJQUVELGdEQUFlOzs7SUFBZixjQUF5QixDQUFDOzs7O0lBRTFCLDRDQUFXOzs7SUFBWDtRQUNJLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUNuQixJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7UUFFckIsSUFBSSxDQUFDLGNBQWMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxhQUFhLENBQUMsQ0FBQztRQUNuRCxJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQztJQUMvQixDQUFDOzs7Ozs7SUFDTyxnREFBZTs7Ozs7SUFBdkIsVUFBd0IsS0FBSztRQUN6QixJQUFJLENBQUMsYUFBYSxHQUFHLEtBQUssQ0FBQztRQUMzQixJQUFJLElBQUksQ0FBQyxhQUFhLEVBQUU7WUFDcEIsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO1NBQ3BCO2FBQU07WUFDSCxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7U0FDdEI7SUFDTCxDQUFDOzs7O0lBRUQsMENBQVM7OztJQUFUO1FBQUEsaUJBOEVDO1FBN0VHLElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYSxFQUFFO1lBQ3JCLE9BQU87U0FDVjtRQUNELFVBQVU7UUFDVixJQUFJLElBQUksQ0FBQyxZQUFZLEVBQUU7WUFDbkIsT0FBTztTQUNWO1FBQ0QsSUFBSSxJQUFJLENBQUMsT0FBTyxLQUFLLE9BQU8sRUFBRTtZQUMxQixPQUFPO1lBQ1AsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FDaEMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxhQUFhLEVBQ3JCLE9BQU87Ozs7WUFDUCxVQUFDLENBQWE7Z0JBQ1YsQ0FBQyxDQUFDLGVBQWUsRUFBRSxDQUFDO2dCQUNwQixLQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7Z0JBQ3JCLEtBQUksQ0FBQyxhQUFhLEdBQUcsS0FBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQ25DLFFBQVEsRUFDUixPQUFPOzs7Z0JBQ1A7b0JBQ0ksS0FBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO29CQUNyQixLQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7Z0JBQ3pCLENBQUMsRUFDSixDQUFDO1lBQ04sQ0FBQyxFQUNKLENBQUM7U0FDTDthQUFNLElBQUksSUFBSSxDQUFDLE9BQU8sS0FBSyxPQUFPLEVBQUU7WUFDakMsS0FBSztZQUNMLDJCQUEyQjtZQUMzQixJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUNwQyxJQUFJLENBQUMsRUFBRSxDQUFDLGFBQWEsRUFDckIsV0FBVzs7OztZQUNYLFVBQUMsQ0FBYTtnQkFDVixDQUFDLENBQUMsY0FBYyxFQUFFLENBQUM7Z0JBQ25CLEtBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztZQUN6QixDQUFDLEVBQ0osQ0FBQztZQUNGLElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQ2xDLElBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxFQUNyQixTQUFTOzs7O1lBQ1QsVUFBQyxDQUFhO2dCQUNWLENBQUMsQ0FBQyxlQUFlLEVBQUUsQ0FBQztnQkFDcEIsS0FBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1lBQ3pCLENBQUMsRUFDSixDQUFDO1NBQ0w7YUFBTTtZQUNILFNBQVM7WUFDVCxJQUFJLENBQUMsZUFBZSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUNyQyxJQUFJLENBQUMsRUFBRSxDQUFDLGFBQWEsRUFDckIsWUFBWTs7OztZQUNaLFVBQUMsQ0FBYTtnQkFDVixDQUFDLENBQUMsZUFBZSxFQUFFLENBQUM7Z0JBQ3BCLElBQUksS0FBSSxDQUFDLEtBQUssRUFBRTtvQkFDWixJQUFJLEtBQUksQ0FBQyxVQUFVLEVBQUU7d0JBQ2pCLFlBQVksQ0FBQyxLQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7cUJBQ2pDO29CQUNELEtBQUksQ0FBQyxVQUFVLEdBQUcsVUFBVTs7O29CQUFDO3dCQUN6QixLQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7d0JBQ3JCLFlBQVksQ0FBQyxLQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7b0JBQ2xDLENBQUMsR0FBRSxLQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7aUJBQ2xCO3FCQUFNO29CQUNILEtBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztpQkFDeEI7WUFDTCxDQUFDLEVBQ0osQ0FBQztZQUNGLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQ3JDLElBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxFQUNyQixZQUFZOzs7O1lBQ1osVUFBQyxDQUFhO2dCQUNWLENBQUMsQ0FBQyxlQUFlLEVBQUUsQ0FBQztnQkFDcEIsSUFBSSxLQUFJLENBQUMsVUFBVSxFQUFFO29CQUNqQixZQUFZLENBQUMsS0FBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO2lCQUNqQztnQkFDRCxLQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7WUFDekIsQ0FBQyxFQUNKLENBQUM7U0FDTDtRQUNELElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDO0lBQzdCLENBQUM7SUFFRCxVQUFVOzs7OztJQUNWLDRDQUFXOzs7O0lBQVg7UUFDSSxRQUFRO1FBQ1IsSUFBSSxJQUFJLENBQUMsZUFBZSxFQUFFO1lBQ3RCLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztTQUMxQjtRQUNELElBQUksSUFBSSxDQUFDLGVBQWUsRUFBRTtZQUN0QixJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7U0FDMUI7UUFDRCxJQUFJLElBQUksQ0FBQyxVQUFVLEVBQUU7WUFDakIsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO1NBQ3JCO1FBQ0QsSUFBSSxJQUFJLENBQUMsYUFBYSxFQUFFO1lBQ3BCLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztTQUN4QjtRQUNELElBQUksSUFBSSxDQUFDLGNBQWMsRUFBRTtZQUNyQixJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7U0FDekI7UUFDRCxJQUFJLElBQUksQ0FBQyxZQUFZLEVBQUU7WUFDbkIsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO1NBQ3ZCO1FBQ0QsSUFBSSxDQUFDLFlBQVksR0FBRyxLQUFLLENBQUM7SUFDOUIsQ0FBQztJQUVELHFCQUFxQjs7Ozs7SUFDckIsOENBQWE7Ozs7SUFBYjtRQUNJLElBQUksSUFBSSxDQUFDLE9BQU8sRUFBRTtZQUNkLElBQUksQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUNuQixRQUFRLENBQUMsSUFBSSxFQUNiLElBQUksQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLGFBQWEsQ0FDaEMsQ0FBQztZQUNGLElBQUksQ0FBQyxhQUFhLENBQUMsaUJBQWlCLENBQUMsWUFBWSxFQUFFLENBQUM7WUFDcEQsSUFBSSxDQUFDLGFBQWEsQ0FBQyxpQkFBaUIsQ0FBQyxhQUFhLEVBQUUsQ0FBQztZQUNyRCxJQUFJLENBQUMsYUFBYSxDQUFDLE9BQU8sRUFBRSxDQUFDO1lBQzdCLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUM5QixJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQztZQUNwQixJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQztZQUUxQixJQUFJLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1NBQ3REO0lBQ0wsQ0FBQzs7Ozs7SUFFTyw4Q0FBYTs7OztJQUFyQjtRQUFBLGlCQWFDO1FBWkcsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPO1lBQUUsT0FBTztRQUMxQixJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7UUFDdkIsSUFBSSxDQUFDLGVBQWUsQ0FDaEIsSUFBSSxDQUFDLFNBQVMsRUFDZCxJQUFJLENBQUMsT0FBTyxFQUNaLElBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxDQUFDLHFCQUFxQixFQUFFLEVBQzdDLElBQUksQ0FBQyxvQkFBb0IsRUFBRSxDQUM5QixDQUFDO1FBRUYsSUFBSSxDQUFDLGNBQWMsQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLGFBQWE7Ozs7UUFBRSxVQUFDLENBQWE7WUFDeEUsS0FBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQ3pCLENBQUMsRUFBQyxDQUFDO0lBQ1AsQ0FBQztJQUVELG1CQUFtQjs7Ozs7Ozs7OztJQUNYLGdEQUFlOzs7Ozs7Ozs7SUFBdkIsVUFDSSxTQUFpQixFQUNqQixPQUFrQyxFQUNsQyxzQkFBOEIsRUFDOUIscUJBQXFCO1FBRXJCLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxHQUFHLFNBQVMsQ0FBQztRQUNuQyxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7UUFDL0IsSUFBSSxDQUFDLE9BQU8sQ0FBQyxzQkFBc0IsR0FBRyxzQkFBc0IsQ0FBQztRQUM3RCxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDO1FBQ2xDLElBQUksQ0FBQyxPQUFPLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUM7UUFDdEMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxxQkFBcUIsR0FBRyxxQkFBcUIsQ0FBQztRQUMzRCxJQUFJLENBQUMsYUFBYSxDQUFDLGlCQUFpQixDQUFDLFlBQVksRUFBRSxDQUFDO1FBQ3BELElBQUksQ0FBQyxhQUFhLENBQUMsaUJBQWlCLENBQUMsYUFBYSxFQUFFLENBQUM7SUFDekQsQ0FBQztJQUVELGlCQUFpQjs7Ozs7O0lBQ1QsZ0RBQWU7Ozs7O0lBQXZCO1FBQ0ksSUFBSSxDQUFDLGFBQWEsR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsZUFBZSxDQUN0RCxJQUFJLENBQUMsZ0JBQWdCLENBQ3hCLENBQUM7UUFDRixJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDO1FBQzNDLG1CQUFtQjtRQUNuQixJQUFJLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FDbkIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxhQUFhLENBQUMsRUFDN0MsSUFBSSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsYUFBYSxDQUNoQyxDQUFDO1FBQ0YsSUFBSSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxhQUFhLENBQUMsQ0FBQztJQUMxRSxDQUFDO0lBRUQ7O09BRUc7Ozs7OztJQUNLLHFEQUFvQjs7Ozs7SUFBNUI7O1lBQ1EsTUFBTSxHQUFHLFFBQVEsQ0FBQyxlQUFlLENBQUMsV0FBVzs7WUFDN0MsT0FBTyxHQUFHLFFBQVEsQ0FBQyxlQUFlLENBQUMsWUFBWTs7WUFDL0MsSUFBSSxHQUFHLENBQUM7O1lBQ1IsS0FBSyxHQUFHLENBQUM7UUFDYixPQUFPO1FBQ1AsSUFBSSxJQUFJLENBQUMsaUJBQWlCLEVBQUU7O2dCQUNwQixtQkFBbUIsR0FBRyxJQUFJLENBQUMsMEJBQTBCLENBQ3JELElBQUksQ0FBQyxpQkFBaUIsQ0FDekI7WUFDRCxNQUFNLEdBQUcsbUJBQW1CLENBQUMscUJBQXFCLEVBQUUsQ0FBQyxLQUFLLENBQUM7WUFDM0QsS0FBSyxHQUFHLG1CQUFtQixDQUFDLHFCQUFxQixFQUFFLENBQUMsSUFBSSxDQUFDO1NBQzVEO1FBQ0QsT0FBTztRQUNQLElBQUksSUFBSSxDQUFDLGlCQUFpQixFQUFFOztnQkFDcEIsbUJBQW1CLEdBQUcsSUFBSSxDQUFDLDBCQUEwQixDQUNyRCxJQUFJLENBQUMsaUJBQWlCLENBQ3pCO1lBQ0QsT0FBTyxHQUFHLG1CQUFtQixDQUFDLHFCQUFxQixFQUFFLENBQUMsTUFBTSxDQUFDO1lBQzdELElBQUksR0FBRyxtQkFBbUIsQ0FBQyxxQkFBcUIsRUFBRSxDQUFDLEdBQUcsQ0FBQztTQUMxRDtRQUNELE9BQU8sRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLENBQUM7SUFDdEUsQ0FBQztJQUNEOztPQUVHOzs7Ozs7O0lBQ0ssMkRBQTBCOzs7Ozs7SUFBbEMsVUFBbUMsV0FBVztRQUMxQyxJQUFJLFdBQVcsWUFBWSxVQUFVLEVBQUU7WUFDbkMsT0FBTyxXQUFXLENBQUMsYUFBYSxDQUFDO1NBQ3BDO2FBQU0sSUFBSSxPQUFPLFdBQVcsSUFBSSxRQUFRLEVBQUU7WUFDdkMsT0FBTyxRQUFRLENBQUMsYUFBYSxDQUFDLG1CQUFBLFdBQVcsRUFBVSxDQUFDLENBQUM7U0FDeEQ7UUFDRCxPQUFPLFdBQVcsQ0FBQztJQUN2QixDQUFDOztnQkFsVUosU0FBUyxTQUFDO29CQUNQLFFBQVEsRUFBRSxpQkFBaUI7aUJBQzlCOzs7O2dCQWZHLFVBQVU7Z0JBRVYsU0FBUztnQkFJVCxnQkFBZ0I7Z0JBQ2hCLHdCQUF3Qjs7O2dDQWdCdkIsS0FBSyxTQUFDLGVBQWU7dUJBWXJCLEtBQUs7eUJBRUwsS0FBSzsyQkFFTCxLQUFLOzRCQUVMLEtBQUs7MEJBSUwsS0FBSzswQkFpQkwsS0FBSzswQkFRTCxLQUFLO29DQUVMLEtBQUs7b0NBRUwsS0FBSzt3QkFFTCxLQUFLOzBCQUdMLEtBQUs7O0lBaVFWLDZCQUFDO0NBQUEsQUFuVUQsSUFtVUM7U0FoVVksc0JBQXNCOzs7Ozs7SUFHL0IsK0NBQXNDOzs7OztJQUN0QywrQ0FBc0Q7O0lBZXRELHNDQUFtQjs7SUFFbkIsd0NBQXFCOztJQUVyQiwwQ0FBdUI7O0lBRXZCLDJDQUEyQjs7Ozs7SUFFM0IsNkNBQThCOztJQTJCOUIseUNBQWlDOztJQUVqQyxtREFBMEQ7O0lBRTFELG1EQUEwRDs7SUFFMUQsdUNBQW1COztJQUduQix5Q0FBNEM7O0lBRTVDLGlEQUFxQjs7SUFDckIsaURBQXFCOztJQUNyQiw0Q0FBZ0I7O0lBQ2hCLCtDQUFtQjs7SUFDbkIsZ0RBQW9COztJQUNwQiw4Q0FBa0I7O0lBQ2xCLHlDQUFhOzs7OztJQUViLDhDQUE2Qjs7Ozs7SUFFN0IsNENBQTBCOztJQUcxQixrREFDNEQ7O0lBRTVELDRDQUFnQjs7SUFDaEIseUNBQTBCOztJQUMxQixnREFBcUM7Ozs7O0lBRWpDLG9DQUFzQjs7Ozs7SUFDdEIsd0NBQXlCOzs7OztJQUN6QixrREFBMEM7Ozs7O0lBQzFDLDBDQUEwQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgICBPbkluaXQsXHJcbiAgICBEaXJlY3RpdmUsXHJcbiAgICBJbnB1dCxcclxuICAgIEVsZW1lbnRSZWYsXHJcbiAgICBBZnRlclZpZXdJbml0LFxyXG4gICAgUmVuZGVyZXIyLFxyXG4gICAgT25EZXN0cm95LFxyXG4gICAgVGVtcGxhdGVSZWYsXHJcbiAgICBDb21wb25lbnRGYWN0b3J5LFxyXG4gICAgVmlld0NvbnRhaW5lclJlZixcclxuICAgIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcclxuICAgIE5nWm9uZSxcclxuICAgIENvbXBvbmVudFJlZixcclxufSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xyXG5pbXBvcnQgeyBPdmVyTGF5SGlkZGVuU2VydmljZSB9IGZyb20gXCJAZmFycmlzL3VpLWNvbW1vblwiO1xyXG5pbXBvcnQgeyBUb29sdGlwQ29tcG9uZW50IH0gZnJvbSBcIi4vdG9vbHRpcC1jb21wb25lbnQvdG9vbHRpcC5jb21wb25lbnRcIjtcclxuQERpcmVjdGl2ZSh7XHJcbiAgICBzZWxlY3RvcjogXCJbZmFycmlzVG9vbHRpcF1cIixcclxufSlcclxuZXhwb3J0IGNsYXNzIEZhcnJpc1Rvb2x0aXBEaXJlY3RpdmVcclxuICAgIGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3lcclxue1xyXG4gICAgcHJpdmF0ZSB0b29sdGlwRW5hYmxlOiBib29sZWFuID0gdHJ1ZTtcclxuICAgIHByaXZhdGUgX2NvbXBvbmVudFJlZjogQ29tcG9uZW50UmVmPFRvb2x0aXBDb21wb25lbnQ+O1xyXG4gICAgLy8gNeaciDfml6Xov73liqDov5nnp43lhpnms5XvvIzmjqfliLbnpoHnlKjjgIHlkK/nlKhcclxuICAgIC8vIOWOn+adpeeahOaXtuWAmXZhbHVl5piv56m65a2X56ym5LiyXHJcbiAgICBASW5wdXQoXCJmYXJyaXNUb29sdGlwXCIpXHJcbiAgICBzZXQgZW5hYmxlVG9vbHRpcCh2YWx1ZTogYW55KSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PSBcInN0cmluZ1wiICYmIHZhbHVlID09IFwiXCIpIHtcclxuICAgICAgICAgICAgdGhpcy5lbmFibGVPckRpc2FibGUodHJ1ZSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5lbmFibGVPckRpc2FibGUodmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGdldCBlbmFibGVUb29sdGlwKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnRvb2x0aXBFbmFibGU7XHJcbiAgICB9XHJcbiAgICAvKiDmj5DnpLrmlofmnKwgKi9cclxuICAgIEBJbnB1dCgpIHRleHQgPSBcIlwiO1xyXG4gICAgLy8g5o+Q56S65qGG5qC35byPXHJcbiAgICBASW5wdXQoKSB0aXBDbHMgPSBcIlwiO1xyXG4gICAgLy8g5o+Q56S65qGG5a695bqmXHJcbiAgICBASW5wdXQoKSB0aXBXaWR0aCA9IFwiXCI7XHJcbiAgICAvKiDkvY3nva4gKi9cclxuICAgIEBJbnB1dCgpIHBsYWNlbWVudCA9IFwidG9wXCI7XHJcblxyXG4gICAgcHJpdmF0ZSB0cmlnZ2VyTW9kZSA9IFwiaG92ZXJcIjtcclxuICAgIC8qIOinpuWPkeaWueW8jyAqL1xyXG4gICAgQElucHV0KClcclxuICAgIHNldCB0cmlnZ2VyKHZhbHVlKSB7XHJcbiAgICAgICAgaWYgKHZhbHVlKSB7XHJcbiAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gdGhpcy50cmlnZ2VyTW9kZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyTW9kZSA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy51bmJpbmRFdmVudCgpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5iaW5kRXZlbnQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGdldCB0cmlnZ2VyKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnRyaWdnZXJNb2RlO1xyXG4gICAgfVxyXG5cclxuICAgIC8qIOemgeeUqC0tLei3n+WFtuS7luaOp+S7tueahOWxnuaAp+WuueaYk+WGsueqge+8jOmAkOa4kOW6n+W8g+OAglxyXG4gICAgICog5q+U5aaC5oyJ6ZKu5Y+v5Lul6K6+572u56aB55So5LiN6Kem5Y+R54K55Ye777yM5L2G5oOz57uZ5Ye654K55Ye75o+Q56S677yM6L+Z5qC35bCx5Yay56qB5LqGXHJcbiAgICAgKi9cclxuICAgIEBJbnB1dCgpXHJcbiAgICBzZXQgZGlzYWJsZSh2YWx1ZSkge1xyXG4gICAgICAgIHRoaXMuZW5hYmxlT3JEaXNhYmxlKCF2YWx1ZSk7XHJcbiAgICB9XHJcbiAgICBnZXQgZGlzYWJsZSgpIHtcclxuICAgICAgICByZXR1cm4gIXRoaXMudG9vbHRpcEVuYWJsZTtcclxuICAgIH1cclxuXHJcbiAgICBASW5wdXQoKSBzaG93VGlwOiBib29sZWFuID0gdHJ1ZTtcclxuICAgIC8vIOaoquWQkee6oOato+eahOWPgueFp1xyXG4gICAgQElucHV0KCkgcmVjdGlmeVJlZmVyZW5jZUg6IEVsZW1lbnQgfCBFbGVtZW50UmVmIHwgc3RyaW5nO1xyXG4gICAgLy8g57q15ZCR57qg5q2j55qE5Y+C54WnXHJcbiAgICBASW5wdXQoKSByZWN0aWZ5UmVmZXJlbmNlVjogRWxlbWVudCB8IEVsZW1lbnRSZWYgfCBzdHJpbmc7XHJcblxyXG4gICAgQElucHV0KCkgZGVsYXkgPSAwO1xyXG5cclxuICAgIC8qIOWGheWuueaooeadvyAqL1xyXG4gICAgQElucHV0KCkgY29udGVudDogc3RyaW5nIHwgVGVtcGxhdGVSZWY8YW55PjtcclxuXHJcbiAgICBtb3VzZWVudGVyRXZlbnQ6IGFueTtcclxuICAgIG1vdXNlbGVhdmVFdmVudDogYW55O1xyXG4gICAgY2xpY2tFdmVudDogYW55O1xyXG4gICAgY2xpY2tPdXRFdmVudDogYW55O1xyXG4gICAgZm9jdXNEb3duRXZlbnQ6IGFueTtcclxuICAgIGZvY3VzVXBFdmVudDogYW55O1xyXG4gICAgZG9jQm9keTogYW55O1xyXG4gICAgLy8g5piv5ZCm57uR5a6a5LqG5LqL5Lu2XHJcbiAgICBwcml2YXRlIGhhc0JpbmRFdmVudCA9IGZhbHNlO1xyXG5cclxuICAgIHByaXZhdGUgZGVsYXlUaW1lciA9IG51bGw7XHJcblxyXG4gICAgLyog55Sf5oiQ5o+Q56S657uE5Lu2ICovXHJcbiAgICBjb21wb25lbnRGYWN0b3J5OiBDb21wb25lbnRGYWN0b3J5PFRvb2x0aXBDb21wb25lbnQ+ID1cclxuICAgICAgICB0aGlzLnJlc29sdmVyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KFRvb2x0aXBDb21wb25lbnQpO1xyXG5cclxuICAgIHRvb2x0aXBSZWY6IGFueTtcclxuICAgIHRvb2x0aXA6IFRvb2x0aXBDb21wb25lbnQ7XHJcbiAgICBvdmVyTGF5U2VydmljZTogT3ZlckxheUhpZGRlblNlcnZpY2U7XHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwcml2YXRlIGVsOiBFbGVtZW50UmVmLFxyXG4gICAgICAgIHByaXZhdGUgcmVuZGVyOiBSZW5kZXJlcjIsXHJcbiAgICAgICAgcHJpdmF0ZSB2aWV3Q29udGFpbmVyUmVmOiBWaWV3Q29udGFpbmVyUmVmLFxyXG4gICAgICAgIHByaXZhdGUgcmVzb2x2ZXI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlclxyXG4gICAgKSB7XHJcbiAgICAgICAgdGhpcy5vdmVyTGF5U2VydmljZSA9IG5ldyBPdmVyTGF5SGlkZGVuU2VydmljZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCkge1xyXG4gICAgICAgIHRoaXMuYmluZEV2ZW50KCk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge31cclxuXHJcbiAgICBuZ09uRGVzdHJveSgpIHtcclxuICAgICAgICB0aGlzLnVuYmluZEV2ZW50KCk7XHJcbiAgICAgICAgdGhpcy5yZW1vdmVUb29sdGlwKCk7XHJcblxyXG4gICAgICAgIHRoaXMub3ZlckxheVNlcnZpY2UuZGVzdG9yeSh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQpO1xyXG4gICAgICAgIHRoaXMub3ZlckxheVNlcnZpY2UgPSBudWxsO1xyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSBlbmFibGVPckRpc2FibGUodmFsdWUpIHtcclxuICAgICAgICB0aGlzLnRvb2x0aXBFbmFibGUgPSB2YWx1ZTtcclxuICAgICAgICBpZiAodGhpcy50b29sdGlwRW5hYmxlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYmluZEV2ZW50KCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy51bmJpbmRFdmVudCgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBiaW5kRXZlbnQoKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLnRvb2x0aXBFbmFibGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyDmmK/lkKblt7Lnu5Hlrprkuovku7ZcclxuICAgICAgICBpZiAodGhpcy5oYXNCaW5kRXZlbnQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy50cmlnZ2VyID09PSBcImNsaWNrXCIpIHtcclxuICAgICAgICAgICAgLy8g6byg5qCH54K55Ye7XHJcbiAgICAgICAgICAgIHRoaXMuY2xpY2tFdmVudCA9IHRoaXMucmVuZGVyLmxpc3RlbihcclxuICAgICAgICAgICAgICAgIHRoaXMuZWwubmF0aXZlRWxlbWVudCxcclxuICAgICAgICAgICAgICAgIFwiY2xpY2tcIixcclxuICAgICAgICAgICAgICAgIChlOiBNb3VzZUV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFwcGVuZFRvb2x0aXAoKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsaWNrT3V0RXZlbnQgPSB0aGlzLnJlbmRlci5saXN0ZW4oXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcImNsaWNrXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlVG9vbHRpcCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGlja091dEV2ZW50KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy50cmlnZ2VyID09PSBcImZvY3VzXCIpIHtcclxuICAgICAgICAgICAgLy8g6IGa54SmXHJcbiAgICAgICAgICAgIC8vIEBUb2RvIOmcgOimgeaKimlucHV0562J57uE5Lu25ZKM5pmu6YCa57uE5Lu25YiG5byAXHJcbiAgICAgICAgICAgIHRoaXMuZm9jdXNEb3duRXZlbnQgPSB0aGlzLnJlbmRlci5saXN0ZW4oXHJcbiAgICAgICAgICAgICAgICB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsXHJcbiAgICAgICAgICAgICAgICBcIm1vdXNlZG93blwiLFxyXG4gICAgICAgICAgICAgICAgKGU6IE1vdXNlRXZlbnQpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHBlbmRUb29sdGlwKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIHRoaXMuZm9jdXNVcEV2ZW50ID0gdGhpcy5yZW5kZXIubGlzdGVuKFxyXG4gICAgICAgICAgICAgICAgdGhpcy5lbC5uYXRpdmVFbGVtZW50LFxyXG4gICAgICAgICAgICAgICAgXCJtb3VzZXVwXCIsXHJcbiAgICAgICAgICAgICAgICAoZTogTW91c2VFdmVudCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVUb29sdGlwKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8g6byg5qCH56e75Yqo5LiK5Y67XHJcbiAgICAgICAgICAgIHRoaXMubW91c2VlbnRlckV2ZW50ID0gdGhpcy5yZW5kZXIubGlzdGVuKFxyXG4gICAgICAgICAgICAgICAgdGhpcy5lbC5uYXRpdmVFbGVtZW50LFxyXG4gICAgICAgICAgICAgICAgXCJtb3VzZWVudGVyXCIsXHJcbiAgICAgICAgICAgICAgICAoZTogTW91c2VFdmVudCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZGVsYXkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZGVsYXlUaW1lcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuZGVsYXlUaW1lcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kZWxheVRpbWVyID0gc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFwcGVuZFRvb2x0aXAoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLmRlbGF5VGltZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LCB0aGlzLmRlbGF5KTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFwcGVuZFRvb2x0aXAoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIHRoaXMubW91c2VsZWF2ZUV2ZW50ID0gdGhpcy5yZW5kZXIubGlzdGVuKFxyXG4gICAgICAgICAgICAgICAgdGhpcy5lbC5uYXRpdmVFbGVtZW50LFxyXG4gICAgICAgICAgICAgICAgXCJtb3VzZWxlYXZlXCIsXHJcbiAgICAgICAgICAgICAgICAoZTogTW91c2VFdmVudCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZGVsYXlUaW1lcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5kZWxheVRpbWVyKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVUb29sdGlwKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaGFzQmluZEV2ZW50ID0gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICAvKiDop6Pnu5Hkuovku7YgKi9cclxuICAgIHVuYmluZEV2ZW50KCkge1xyXG4gICAgICAgIC8vIOm8oOagh+enu+S4iuWOu1xyXG4gICAgICAgIGlmICh0aGlzLm1vdXNlZW50ZXJFdmVudCkge1xyXG4gICAgICAgICAgICB0aGlzLm1vdXNlZW50ZXJFdmVudCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5tb3VzZWxlYXZlRXZlbnQpIHtcclxuICAgICAgICAgICAgdGhpcy5tb3VzZWxlYXZlRXZlbnQoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuY2xpY2tFdmVudCkge1xyXG4gICAgICAgICAgICB0aGlzLmNsaWNrRXZlbnQoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuY2xpY2tPdXRFdmVudCkge1xyXG4gICAgICAgICAgICB0aGlzLmNsaWNrT3V0RXZlbnQoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuZm9jdXNEb3duRXZlbnQpIHtcclxuICAgICAgICAgICAgdGhpcy5mb2N1c0Rvd25FdmVudCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5mb2N1c1VwRXZlbnQpIHtcclxuICAgICAgICAgICAgdGhpcy5mb2N1c1VwRXZlbnQoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5oYXNCaW5kRXZlbnQgPSBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICAvKiBib2R5ICDnp7vpmaR0b29sdGlwICovXHJcbiAgICByZW1vdmVUb29sdGlwKCkge1xyXG4gICAgICAgIGlmICh0aGlzLnRvb2x0aXApIHtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXIucmVtb3ZlQ2hpbGQoXHJcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LFxyXG4gICAgICAgICAgICAgICAgdGhpcy50b29sdGlwLmVsLm5hdGl2ZUVsZW1lbnRcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgdGhpcy5fY29tcG9uZW50UmVmLmNoYW5nZURldGVjdG9yUmVmLm1hcmtGb3JDaGVjaygpO1xyXG4gICAgICAgICAgICB0aGlzLl9jb21wb25lbnRSZWYuY2hhbmdlRGV0ZWN0b3JSZWYuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgICAgICB0aGlzLl9jb21wb25lbnRSZWYuZGVzdHJveSgpO1xyXG4gICAgICAgICAgICB0aGlzLnZpZXdDb250YWluZXJSZWYuY2xlYXIoKTtcclxuICAgICAgICAgICAgdGhpcy50b29sdGlwID0gbnVsbDtcclxuICAgICAgICAgICAgdGhpcy5fY29tcG9uZW50UmVmID0gbnVsbDtcclxuXHJcbiAgICAgICAgICAgIHRoaXMub3ZlckxheVNlcnZpY2UuZGVzdG9yeSh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGFwcGVuZFRvb2x0aXAoKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLnNob3dUaXApIHJldHVybjtcclxuICAgICAgICB0aGlzLmdlbmVyYXRlVG9vbHRpcCgpO1xyXG4gICAgICAgIHRoaXMudXBkYXRlVmlld1Byb3BzKFxyXG4gICAgICAgICAgICB0aGlzLnBsYWNlbWVudCxcclxuICAgICAgICAgICAgdGhpcy5jb250ZW50LFxyXG4gICAgICAgICAgICB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksXHJcbiAgICAgICAgICAgIHRoaXMuZ2V0UmVmZXJlbmNlUG9zaXRpb24oKVxyXG4gICAgICAgICk7XHJcblxyXG4gICAgICAgIHRoaXMub3ZlckxheVNlcnZpY2UucmVnaXN0ZXJNb3VzZUV2ZW50KHRoaXMuZWwubmF0aXZlRWxlbWVudCwgKGU6IE1vdXNlRXZlbnQpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5yZW1vdmVUb29sdGlwKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyog5pu05pawdG9vbHRpcOe7hOS7tuWxnuaApyAqL1xyXG4gICAgcHJpdmF0ZSB1cGRhdGVWaWV3UHJvcHMoXHJcbiAgICAgICAgcGxhY2VtZW50OiBzdHJpbmcsXHJcbiAgICAgICAgY29udGVudDogc3RyaW5nIHwgVGVtcGxhdGVSZWY8YW55PixcclxuICAgICAgICBob3N0Qm91bmRpbmdDbGllbnRSZWN0OiBvYmplY3QsXHJcbiAgICAgICAgcmVmZXJlbmNlQm91bmRpbmdSZWN0XHJcbiAgICApIHtcclxuICAgICAgICB0aGlzLnRvb2x0aXAucGxhY2VtZW50ID0gcGxhY2VtZW50O1xyXG4gICAgICAgIHRoaXMudG9vbHRpcC5jb250ZW50ID0gY29udGVudDtcclxuICAgICAgICB0aGlzLnRvb2x0aXAuaG9zdEJvdW5kaW5nQ2xpZW50UmVjdCA9IGhvc3RCb3VuZGluZ0NsaWVudFJlY3Q7XHJcbiAgICAgICAgdGhpcy50b29sdGlwLnRpcENscyA9IHRoaXMudGlwQ2xzO1xyXG4gICAgICAgIHRoaXMudG9vbHRpcC50aXBXaWR0aCA9IHRoaXMudGlwV2lkdGg7XHJcbiAgICAgICAgdGhpcy50b29sdGlwLnJlZmVyZW5jZUJvdW5kaW5nUmVjdCA9IHJlZmVyZW5jZUJvdW5kaW5nUmVjdDtcclxuICAgICAgICB0aGlzLl9jb21wb25lbnRSZWYuY2hhbmdlRGV0ZWN0b3JSZWYubWFya0ZvckNoZWNrKCk7XHJcbiAgICAgICAgdGhpcy5fY29tcG9uZW50UmVmLmNoYW5nZURldGVjdG9yUmVmLmRldGVjdENoYW5nZXMoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKiDmnoTpgKB0b29sdGlw57uT5p6EICovXHJcbiAgICBwcml2YXRlIGdlbmVyYXRlVG9vbHRpcCgpIHtcclxuICAgICAgICB0aGlzLl9jb21wb25lbnRSZWYgPSB0aGlzLnZpZXdDb250YWluZXJSZWYuY3JlYXRlQ29tcG9uZW50KFxyXG4gICAgICAgICAgICB0aGlzLmNvbXBvbmVudEZhY3RvcnlcclxuICAgICAgICApO1xyXG4gICAgICAgIHRoaXMudG9vbHRpcCA9IHRoaXMuX2NvbXBvbmVudFJlZi5pbnN0YW5jZTtcclxuICAgICAgICAvLyDniLblhYPntKDkuK3np7vpmaQgIOa3u+WKoOWIsGJvZHnkuK1cclxuICAgICAgICB0aGlzLnJlbmRlci5yZW1vdmVDaGlsZChcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXIucGFyZW50Tm9kZSh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQpLFxyXG4gICAgICAgICAgICB0aGlzLnRvb2x0aXAuZWwubmF0aXZlRWxlbWVudFxyXG4gICAgICAgICk7XHJcbiAgICAgICAgdGhpcy5yZW5kZXIuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuYm9keSwgdGhpcy50b29sdGlwLmVsLm5hdGl2ZUVsZW1lbnQpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog56Gu6K6k5Y+C54Wn55qE6L6555WMXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgZ2V0UmVmZXJlbmNlUG9zaXRpb24oKSB7XHJcbiAgICAgICAgbGV0IHJSaWdodCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aDtcclxuICAgICAgICBsZXQgckJvdHRvbSA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQ7XHJcbiAgICAgICAgbGV0IHJUb3AgPSAwO1xyXG4gICAgICAgIGxldCByTGVmdCA9IDA7XHJcbiAgICAgICAgLy8g5qiq5ZCR5Y+C54WnXHJcbiAgICAgICAgaWYgKHRoaXMucmVjdGlmeVJlZmVyZW5jZUgpIHtcclxuICAgICAgICAgICAgbGV0IHJlY3RpZnlSZWZlcmVuY2VIRWwgPSB0aGlzLmdldFJlY3RpZnlSZWZlcmVuY2VFbGVtZW50KFxyXG4gICAgICAgICAgICAgICAgdGhpcy5yZWN0aWZ5UmVmZXJlbmNlSFxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgICByUmlnaHQgPSByZWN0aWZ5UmVmZXJlbmNlSEVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnJpZ2h0O1xyXG4gICAgICAgICAgICByTGVmdCA9IHJlY3RpZnlSZWZlcmVuY2VIRWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkubGVmdDtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8g57q15ZCR5Y+C54WnXHJcbiAgICAgICAgaWYgKHRoaXMucmVjdGlmeVJlZmVyZW5jZVYpIHtcclxuICAgICAgICAgICAgbGV0IHJlY3RpZnlSZWZlcmVuY2VWRWwgPSB0aGlzLmdldFJlY3RpZnlSZWZlcmVuY2VFbGVtZW50KFxyXG4gICAgICAgICAgICAgICAgdGhpcy5yZWN0aWZ5UmVmZXJlbmNlVlxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgICByQm90dG9tID0gcmVjdGlmeVJlZmVyZW5jZVZFbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5ib3R0b207XHJcbiAgICAgICAgICAgIHJUb3AgPSByZWN0aWZ5UmVmZXJlbmNlVkVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHsgdG9wOiByVG9wLCBsZWZ0OiByTGVmdCwgcmlnaHQ6IHJSaWdodCwgYm90dG9tOiByQm90dG9tIH07XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOiOt+WPlue6oOato+WFg+e0oFxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGdldFJlY3RpZnlSZWZlcmVuY2VFbGVtZW50KHJlZmVyZW5jZUVsKSB7XHJcbiAgICAgICAgaWYgKHJlZmVyZW5jZUVsIGluc3RhbmNlb2YgRWxlbWVudFJlZikge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVmZXJlbmNlRWwubmF0aXZlRWxlbWVudDtcclxuICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiByZWZlcmVuY2VFbCA9PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHJlZmVyZW5jZUVsIGFzIHN0cmluZyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZWZlcmVuY2VFbDtcclxuICAgIH1cclxufVxyXG4iXX0=