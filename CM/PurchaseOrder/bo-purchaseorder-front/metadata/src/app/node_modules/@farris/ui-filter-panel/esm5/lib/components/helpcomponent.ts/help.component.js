/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, Output, EventEmitter, Injector } from '@angular/core';
// import { ServerSideToken } from '@farris/ui-lookup';
// import { LookupHttpBeQueryService } from './service/Lookup-http.service';
import { of } from 'rxjs';
import { cloneDeep } from 'lodash-es';
var PanelHelpComponent = /** @class */ (function () {
    function PanelHelpComponent(injector) {
        var _this = this;
        this.injector = injector;
        this.searchHandle = new EventEmitter();
        this.submitChange = new EventEmitter();
        this.onSearch = (/**
         * @return {?}
         */
        function () {
            _this.searchHandle.emit();
            return of(true);
        });
    }
    Object.defineProperty(PanelHelpComponent.prototype, "item", {
        get: /**
         * @return {?}
         */
        function () {
            return this._item;
        },
        set: /**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            this._item = data;
            if (this._item.placeHolder) {
                this.placeholder = this._item.placeHolder;
            }
            if (!this._item.hasOwnProperty('value')) {
                this._item.value = {
                    value: [],
                    valueField: '',
                    textValue: ''
                };
            }
            this.getHelpBindingInfo();
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    PanelHelpComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        // if(this.item.control && this.item.control.hasOwnProperty('placeholder')){
        //     this.placeholder = this.item.control.placeholder;
        // }
        // this.getHelpBindingInfo();
    };
    /**
     * @param {?} selectedItem
     * @return {?}
     */
    PanelHelpComponent.prototype.selectedDataHandler = /**
     * @param {?} selectedItem
     * @return {?}
     */
    function (selectedItem) {
        /** @type {?} */
        var helpValue = (this._item.value);
        helpValue.value = this.singleSelect ? [selectedItem] : selectedItem; // 单选返回对象，多选返回数组
        helpValue.valueField = this.valueField;
        helpValue.textValue = this.getTextValue(this.textField, helpValue.value);
        this.textValue = helpValue.textValue;
        this._item.valueText = this._item.value.textValue;
        this.setSubmitChange();
        this.searchHandle.emit();
    };
    /**
     * @return {?}
     */
    PanelHelpComponent.prototype.getHelpBindingInfo = /**
     * @return {?}
     */
    function () {
        if (this._item && this._item.control) {
            /** @type {?} */
            var helpOpts = this._item.control;
            this.uri = helpOpts.uri;
            this.title = helpOpts.title;
            this.textField = helpOpts.textField;
            this.valueField = helpOpts.valueField;
            this.idField = helpOpts.idField;
            this.mapFields = helpOpts.mapFields;
            this.context = helpOpts.context;
            this.preEventCmd = helpOpts.preEventCmd;
            this.postEventCmd = helpOpts.postEventCmd;
            this.singleSelect = helpOpts.singleSelect;
            this.enableFullTree = helpOpts.enableFullTree;
            this.loadTreeDataType = helpOpts.loadTreeDataType;
            this.expandLevel = helpOpts.expandLevel;
            this.enableCascade = helpOpts.enableCascade;
            this.helpId = helpOpts.helpId;
            /** @type {?} */
            var helpValue = (this._item.value);
            // if (helpValue && helpValue.value) {
            //     // this.textValue = (this.item.value as HelpValue).value[this.textField];
            //     this.textValue = HelpValue.getPropValue(helpValue.value, this.textField.split('.'));
            // }
            this.displayType = helpOpts.displayType;
            if (helpValue.textValue == 'help-text-value-null') { // 旧数据兼容
                this.textValue = helpValue.getTextValue(this.textField);
            }
            else {
                this.textValue = helpValue.textValue;
            }
        }
        this.setSubmitChange();
    };
    /**
     * @param {?} data
     * @return {?}
     */
    PanelHelpComponent.prototype.clearData = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        (this._item.value).clearValue();
        this.setSubmitChange();
        this.searchHandle.emit();
    };
    /**
     * @param {?} helpItem
     * @param {?} args
     * @return {?}
     */
    PanelHelpComponent.prototype.getPropValue = /**
     * @param {?} helpItem
     * @param {?} args
     * @return {?}
     */
    function (helpItem, args) {
        if (args.length > 1) {
            /** @type {?} */
            var arg = args.shift();
            return helpItem[arg] ? this.getPropValue(helpItem[arg], args) : null;
        }
        return helpItem[args[0]];
    };
    /**
     * @param {?} textField
     * @param {?} value
     * @return {?}
     */
    PanelHelpComponent.prototype.getTextValue = /**
     * @param {?} textField
     * @param {?} value
     * @return {?}
     */
    function (textField, value) {
        var _this = this;
        /** @type {?} */
        var args = textField.split('.');
        /** @type {?} */
        var textArr = value.map((/**
         * @param {?} helpItem
         * @return {?}
         */
        function (helpItem) { return _this.getPropValue(helpItem, cloneDeep(args)); }));
        return textArr && textArr.length ? textArr.join(',') : '';
    };
    /**
     * @return {?}
     */
    PanelHelpComponent.prototype.setSubmitChange = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var val = this._item.value;
        if (Object.keys(val).length < 0 || !val.value || !val.valueField) {
            this.submitChange.emit(false);
        }
        else {
            this.submitChange.emit(true);
        }
    };
    PanelHelpComponent.decorators = [
        { type: Component, args: [{
                    selector: 'panel-filter-help',
                    template: "<farris-lookup-grid  \r\n    [uri]=\"uri\"\r\n    [title]=\"title\"\r\n    [idField]=\"idField\" \r\n    [textField]=\"textField\" \r\n    [valueField]=\"valueField\" \r\n    [(ngModel)]=\"textValue\"\r\n    [displayType]=\"displayType\"\r\n    [editable]=\"false\"\r\n    (clear)=\"clearData($event)\"\r\n    (selectedData)=\"selectedDataHandler($event)\"\r\n    [placeholder]=\"placeholder\"\r\n    [mapFields]=\"mapFields\"\r\n    [dictPicking]=\"preEventCmd\"\r\n    [dictPicked]=\"postEventCmd\"\r\n    [context]=\"context\"\r\n    [enableFullTree]=\"enableFullTree\"\r\n    [loadTreeDataType]=\"loadTreeDataType\"\r\n    [singleSelect]=\"singleSelect\"\r\n    [expandLevel]=\"expandLevel\"\r\n    [enableCascade]=\"enableCascade\"\r\n>\r\n</farris-lookup-grid>"
                    // providers: [{ provide: ServerSideToken, useClass: LookupHttpBeQueryService }]
                }] }
    ];
    /** @nocollapse */
    PanelHelpComponent.ctorParameters = function () { return [
        { type: Injector }
    ]; };
    PanelHelpComponent.propDecorators = {
        item: [{ type: Input }],
        searchHandle: [{ type: Output }],
        submitChange: [{ type: Output }]
    };
    return PanelHelpComponent;
}());
export { PanelHelpComponent };
if (false) {
    /** @type {?} */
    PanelHelpComponent.prototype._item;
    /** @type {?} */
    PanelHelpComponent.prototype.searchHandle;
    /** @type {?} */
    PanelHelpComponent.prototype.submitChange;
    /** @type {?} */
    PanelHelpComponent.prototype.uri;
    /** @type {?} */
    PanelHelpComponent.prototype.textField;
    /** @type {?} */
    PanelHelpComponent.prototype.idField;
    /** @type {?} */
    PanelHelpComponent.prototype.valueField;
    /** @type {?} */
    PanelHelpComponent.prototype.textValue;
    /** @type {?} */
    PanelHelpComponent.prototype.displayType;
    /** @type {?} */
    PanelHelpComponent.prototype.mapFields;
    /** @type {?} */
    PanelHelpComponent.prototype.context;
    /** @type {?} */
    PanelHelpComponent.prototype.preEventCmd;
    /** @type {?} */
    PanelHelpComponent.prototype.postEventCmd;
    /** @type {?} */
    PanelHelpComponent.prototype.enableFullTree;
    /** @type {?} */
    PanelHelpComponent.prototype.loadTreeDataType;
    /** @type {?} */
    PanelHelpComponent.prototype.singleSelect;
    /** @type {?} */
    PanelHelpComponent.prototype.expandLevel;
    /** @type {?} */
    PanelHelpComponent.prototype.enableCascade;
    /** @type {?} */
    PanelHelpComponent.prototype.placeholder;
    /** @type {?} */
    PanelHelpComponent.prototype.helpId;
    /** @type {?} */
    PanelHelpComponent.prototype.title;
    /** @type {?} */
    PanelHelpComponent.prototype.onSearch;
    /**
     * @type {?}
     * @private
     */
    PanelHelpComponent.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGVscC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWZpbHRlci1wYW5lbC8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2hlbHBjb21wb25lbnQudHMvaGVscC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFVLE1BQU0sRUFBRSxZQUFZLEVBQUUsUUFBUSxFQUFFLE1BQU0sZUFBZSxDQUFDOzs7QUFJekYsT0FBTyxFQUFFLEVBQUUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMxQixPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBRXRDO0lBb0RJLDRCQUFvQixRQUFrQjtRQUF0QyxpQkFBMkM7UUFBdkIsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQXRCNUIsaUJBQVksR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBQ2xDLGlCQUFZLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQTRFNUMsYUFBUTs7O1FBQUc7WUFDUCxLQUFJLENBQUMsWUFBWSxDQUFDLElBQUksRUFBRSxDQUFDO1lBQ3pCLE9BQU8sRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3BCLENBQUMsRUFBQTtJQTFEeUMsQ0FBQztJQXpDM0Msc0JBQ0ksb0NBQUk7Ozs7UUFEUjtZQUVJLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQztRQUN0QixDQUFDOzs7OztRQUNELFVBQVMsSUFBSTtZQUNULElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDO1lBQ2xCLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxXQUFXLEVBQUU7Z0JBQ3hCLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUM7YUFDN0M7WUFDRCxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLEVBQUU7Z0JBQ3JDLElBQUks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O0lBMURXLHNDQUEwQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQsIE9uSW5pdCwgT3V0cHV0LCBFdmVudEVtaXR0ZXIsIEluamVjdG9yIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcblxyXG4vLyBpbXBvcnQgeyBTZXJ2ZXJTaWRlVG9rZW4gfSBmcm9tICdAZmFycmlzL3VpLWxvb2t1cCc7XHJcbi8vIGltcG9ydCB7IExvb2t1cEh0dHBCZVF1ZXJ5U2VydmljZSB9IGZyb20gJy4vc2VydmljZS9Mb29rdXAtaHR0cC5zZXJ2aWNlJztcclxuaW1wb3J0IHsgb2YgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgY2xvbmVEZWVwIH0gZnJvbSAnbG9kYXNoLWVzJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdwYW5lbC1maWx0ZXItaGVscCcsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vaGVscC5jb21wb25lbnQuaHRtbCdcclxuICAgIC8vIHByb3ZpZGVyczogW3sgcHJvdmlkZTogU2VydmVyU2lkZVRva2VuLCB1c2VDbGFzczogTG9va3VwSHR0cEJlUXVlcnlTZXJ2aWNlIH1dXHJcbn0pXHJcblxyXG5leHBvcnQgY2xhc3MgUGFuZWxIZWxwQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuXHJcbiAgICAvLyBASW5wdXQoKSBpdGVtOmFueTtcclxuXHJcbiAgICBfaXRlbTogYW55O1xyXG4gICAgQElucHV0KClcclxuICAgIGdldCBpdGVtKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9pdGVtO1xyXG4gICAgfVxyXG4gICAgc2V0IGl0ZW0oZGF0YSkge1xyXG4gICAgICAgIHRoaXMuX2l0ZW0gPSBkYXRhO1xyXG4gICAgICAgIGlmICh0aGlzLl9pdGVtLnBsYWNlSG9sZGVyKSB7XHJcbiAgICAgICAgICAgIHRoaXMucGxhY2Vob2xkZXIgPSB0aGlzLl9pdGVtLnBsYWNlSG9sZGVyO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIXRoaXMuX2l0ZW0uaGFzT3duUHJvcGVydHkoJ3ZhbHVlJykpIHtcclxuICAgICAgICAgICAgdGhpcy5faXRlbS52YWx1ZSA9IHtcclxuICAgICAgICAgICAgICAgIHZhbHVlOiBbXSxcclxuICAgICAgICAgICAgICAgIHZhbHVlRmllbGQ6ICcnLFxyXG4gICAgICAgICAgICAgICAgdGV4dFZhbHVlOiAnJ1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmdldEhlbHBCaW5kaW5nSW5mbygpO1xyXG4gICAgfVxyXG5cclxuICAgIEBPdXRwdXQoKSBzZWFyY2hIYW5kbGUgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgICBAT3V0cHV0KCkgc3VibWl0Q2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG5cclxuICAgIHVyaTogc3RyaW5nO1xyXG4gICAgdGV4dEZpZWxkOiBzdHJpbmc7XHJcbiAgICBpZEZpZWxkOiBzdHJpbmc7XHJcbiAgICB2YWx1ZUZpZWxkOiBhbnk7XHJcbiAgICB0ZXh0VmFsdWU6IGFueTtcclxuICAgIGRpc3BsYXlUeXBlO1xyXG4gICAgbWFwRmllbGRzOiBhbnk7XHJcbiAgICBjb250ZXh0OiBhbnk7XHJcbiAgICBwcmVFdmVudENtZDogYW55O1xyXG4gICAgcG9zdEV2ZW50Q21kOiBhbnk7XHJcbiAgICBlbmFibGVGdWxsVHJlZTogYm9vbGVhbjtcclxuICAgIGxvYWRUcmVlRGF0YVR5cGU6ICdkZWZhdWx0JyB8ICdsb2FkYWxsJyB8ICdsYXllcmxvYWQnO1xyXG4gICAgc2luZ2xlU2VsZWN0OiBib29sZWFuO1xyXG4gICAgZXhwYW5kTGV2ZWw6IG51bWJlcjtcclxuICAgIGVuYWJsZUNhc2NhZGU6IGJvb2xlYW47XHJcbiAgICBwbGFjZWhvbGRlcjogc3RyaW5nO1xyXG4gICAgaGVscElkOiBzdHJpbmc7XHJcbiAgICB0aXRsZTogc3RyaW5nO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yKSB7IH1cclxuXHJcbiAgICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgICAgICAvLyBpZih0aGlzLml0ZW0uY29udHJvbCAmJiB0aGlzLml0ZW0uY29udHJvbC5oYXNPd25Qcm9wZXJ0eSgncGxhY2Vob2xkZXInKSl7XHJcbiAgICAgICAgLy8gICAgIHRoaXMucGxhY2Vob2xkZXIgPSB0aGlzLml0ZW0uY29udHJvbC5wbGFjZWhvbGRlcjtcclxuICAgICAgICAvLyB9XHJcbiAgICAgICAgLy8gdGhpcy5nZXRIZWxwQmluZGluZ0luZm8oKTtcclxuICAgIH1cclxuXHJcbiAgICBzZWxlY3RlZERhdGFIYW5kbGVyKHNlbGVjdGVkSXRlbTogYW55KSB7XHJcbiAgICAgICAgY29uc3QgaGVscFZhbHVlID0gKHRoaXMuX2l0ZW0udmFsdWUpO1xyXG4gICAgICAgIGhlbHBWYWx1ZS52YWx1ZSA9IHRoaXMuc2luZ2xlU2VsZWN0ID8gW3NlbGVjdGVkSXRlbV0gOiBzZWxlY3RlZEl0ZW07IC8vIOWNlemAiei/lOWbnuWvueixoe+8jOWkmumAiei/lOWbnuaVsOe7hFxyXG4gICAgICAgIGhlbHBWYWx1ZS52YWx1ZUZpZWxkID0gdGhpcy52YWx1ZUZpZWxkO1xyXG4gICAgICAgIGhlbHBWYWx1ZS50ZXh0VmFsdWUgPSB0aGlzLmdldFRleHRWYWx1ZSh0aGlzLnRleHRGaWVsZCwgaGVscFZhbHVlLnZhbHVlKTtcclxuICAgICAgICB0aGlzLnRleHRWYWx1ZSA9IGhlbHBWYWx1ZS50ZXh0VmFsdWU7XHJcbiAgICAgICAgdGhpcy5faXRlbS52YWx1ZVRleHQgPSB0aGlzLl9pdGVtLnZhbHVlLnRleHRWYWx1ZTtcclxuICAgICAgICB0aGlzLnNldFN1Ym1pdENoYW5nZSgpO1xyXG4gICAgICAgIHRoaXMuc2VhcmNoSGFuZGxlLmVtaXQoKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRIZWxwQmluZGluZ0luZm8oKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX2l0ZW0gJiYgdGhpcy5faXRlbS5jb250cm9sKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGhlbHBPcHRzID0gdGhpcy5faXRlbS5jb250cm9sO1xyXG4gICAgICAgICAgICB0aGlzLnVyaSA9IGhlbHBPcHRzLnVyaTtcclxuICAgICAgICAgICAgdGhpcy50aXRsZSA9IGhlbHBPcHRzLnRpdGxlO1xyXG4gICAgICAgICAgICB0aGlzLnRleHRGaWVsZCA9IGhlbHBPcHRzLnRleHRGaWVsZDtcclxuICAgICAgICAgICAgdGhpcy52YWx1ZUZpZWxkID0gaGVscE9wdHMudmFsdWVGaWVsZDtcclxuICAgICAgICAgICAgdGhpcy5pZEZpZWxkID0gaGVscE9wdHMuaWRGaWVsZDtcclxuICAgICAgICAgICAgdGhpcy5tYXBGaWVsZHMgPSBoZWxwT3B0cy5tYXBGaWVsZHM7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGV4dCA9IGhlbHBPcHRzLmNvbnRleHQ7XHJcbiAgICAgICAgICAgIHRoaXMucHJlRXZlbnRDbWQgPSBoZWxwT3B0cy5wcmVFdmVudENtZDtcclxuICAgICAgICAgICAgdGhpcy5wb3N0RXZlbnRDbWQgPSBoZWxwT3B0cy5wb3N0RXZlbnRDbWQ7XHJcbiAgICAgICAgICAgIHRoaXMuc2luZ2xlU2VsZWN0ID0gaGVscE9wdHMuc2luZ2xlU2VsZWN0O1xyXG4gICAgICAgICAgICB0aGlzLmVuYWJsZUZ1bGxUcmVlID0gaGVscE9wdHMuZW5hYmxlRnVsbFRyZWU7XHJcbiAgICAgICAgICAgIHRoaXMubG9hZFRyZWVEYXRhVHlwZSA9IGhlbHBPcHRzLmxvYWRUcmVlRGF0YVR5cGU7XHJcbiAgICAgICAgICAgIHRoaXMuZXhwYW5kTGV2ZWwgPSBoZWxwT3B0cy5leHBhbmRMZXZlbDtcclxuICAgICAgICAgICAgdGhpcy5lbmFibGVDYXNjYWRlID0gaGVscE9wdHMuZW5hYmxlQ2FzY2FkZTtcclxuICAgICAgICAgICAgdGhpcy5oZWxwSWQgPSBoZWxwT3B0cy5oZWxwSWQ7XHJcbiAgICAgICAgICAgIGNvbnN0IGhlbHBWYWx1ZSA9ICh0aGlzLl9pdGVtLnZhbHVlKTtcclxuICAgICAgICAgICAgLy8gaWYgKGhlbHBWYWx1ZSAmJiBoZWxwVmFsdWUudmFsdWUpIHtcclxuICAgICAgICAgICAgLy8gICAgIC8vIHRoaXMudGV4dFZhbHVlID0gKHRoaXMuaXRlbS52YWx1ZSBhcyBIZWxwVmFsdWUpLnZhbHVlW3RoaXMudGV4dEZpZWxkXTtcclxuICAgICAgICAgICAgLy8gICAgIHRoaXMudGV4dFZhbHVlID0gSGVscFZhbHVlLmdldFByb3BWYWx1ZShoZWxwVmFsdWUudmFsdWUsIHRoaXMudGV4dEZpZWxkLnNwbGl0KCcuJykpO1xyXG4gICAgICAgICAgICAvLyB9XHJcbiAgICAgICAgICAgIHRoaXMuZGlzcGxheVR5cGUgPSBoZWxwT3B0cy5kaXNwbGF5VHlwZTtcclxuICAgICAgICAgICAgaWYgKGhlbHBWYWx1ZS50ZXh0VmFsdWUgPT0gJ2hlbHAtdGV4dC12YWx1ZS1udWxsJykgey8vIOaXp+aVsOaNruWFvOWuuVxyXG4gICAgICAgICAgICAgICAgdGhpcy50ZXh0VmFsdWUgPSBoZWxwVmFsdWUuZ2V0VGV4dFZhbHVlKHRoaXMudGV4dEZpZWxkKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudGV4dFZhbHVlID0gaGVscFZhbHVlLnRleHRWYWx1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zZXRTdWJtaXRDaGFuZ2UoKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgb25TZWFyY2ggPSAoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5zZWFyY2hIYW5kbGUuZW1pdCgpO1xyXG4gICAgICAgIHJldHVybiBvZih0cnVlKTtcclxuICAgIH1cclxuXHJcbiAgICBjbGVhckRhdGEoZGF0YTogYW55KSB7XHJcbiAgICAgICAgKHRoaXMuX2l0ZW0udmFsdWUpLmNsZWFyVmFsdWUoKTtcclxuICAgICAgICB0aGlzLnNldFN1Ym1pdENoYW5nZSgpO1xyXG4gICAgICAgIHRoaXMuc2VhcmNoSGFuZGxlLmVtaXQoKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRQcm9wVmFsdWUoaGVscEl0ZW06IGFueSwgYXJnczogQXJyYXk8c3RyaW5nPik6IGFueSB7XHJcbiAgICAgICAgaWYgKGFyZ3MubGVuZ3RoID4gMSkge1xyXG4gICAgICAgICAgICBjb25zdCBhcmcgPSBhcmdzLnNoaWZ0KCk7XHJcbiAgICAgICAgICAgIHJldHVybiBoZWxwSXRlbVthcmddID8gdGhpcy5nZXRQcm9wVmFsdWUoaGVscEl0ZW1bYXJnXSwgYXJncykgOiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gaGVscEl0ZW1bYXJnc1swXV07XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0VGV4dFZhbHVlKHRleHRGaWVsZDogc3RyaW5nLCB2YWx1ZSk6IHN0cmluZyB7XHJcbiAgICAgICAgY29uc3QgYXJncyA9IHRleHRGaWVsZC5zcGxpdCgnLicpO1xyXG4gICAgICAgIGNvbnN0IHRleHRBcnIgPSB2YWx1ZS5tYXAoaGVscEl0ZW0gPT4gdGhpcy5nZXRQcm9wVmFsdWUoaGVscEl0ZW0sIGNsb25lRGVlcChhcmdzKSkpO1xyXG4gICAgICAgIHJldHVybiB0ZXh0QXJyICYmIHRleHRBcnIubGVuZ3RoID8gdGV4dEFyci5qb2luKCcsJykgOiAnJztcclxuICAgIH1cclxuXHJcbiAgICBzZXRTdWJtaXRDaGFuZ2UoKSB7XHJcbiAgICAgICAgY29uc3QgdmFsID0gdGhpcy5faXRlbS52YWx1ZTtcclxuICAgICAgICBpZiAoT2JqZWN0LmtleXModmFsKS5sZW5ndGggPCAwIHx8ICF2YWwudmFsdWUgfHwgIXZhbC52YWx1ZUZpZWxkKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc3VibWl0Q2hhbmdlLmVtaXQoZmFsc2UpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuc3VibWl0Q2hhbmdlLmVtaXQodHJ1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxufVxyXG4iXX0=