/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { ChangeDetectorRef } from '@angular/core';
/*
* @Author: 疯狂秀才(lucas huang)
* @Date: 2018-11-23 08:33:37
 * @LastEditors: 疯狂秀才(Lucas Huang)
 * @LastEditTime: 2019-10-17 16:38:53
* @Company: Inspur
* @Version: v0.0.1
*/
import { Component, Input, Output, EventEmitter, ViewChild, TemplateRef, Injector, ComponentFactoryResolver, ElementRef, forwardRef, HostListener, HostBinding } from '@angular/core';
import { cloneDeep } from 'lodash-es';
import { LookupComponent } from '@farris/ui-lookup';
import { BsModalService } from '@farris/ui-modal';
import { SortEditorComponent } from './sort-editor.component';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { LocaleService } from '@farris/ui-locale';
import { CommonUtils } from '@farris/ui-common';
/**
 * @record
 */
export function SORT_FIELD_EDITOR() { }
if (false) {
    /** @type {?} */
    SORT_FIELD_EDITOR.prototype.type;
    /** @type {?|undefined} */
    SORT_FIELD_EDITOR.prototype.options;
}
/** @type {?} */
export var SORTER_LOOKUPGRID_VALUE_ACCESSOR = {
    provide: NG_VALUE_ACCESSOR,
    useExisting: forwardRef((/**
     * @return {?}
     */
    function () { return SorterComponent; })),
    multi: true
};
var SorterComponent = /** @class */ (function (_super) {
    tslib_1.__extends(SorterComponent, _super);
    function SorterComponent(injector, cfr, modalService, el) {
        var _this = _super.call(this, injector, el) || this;
        _this.cfr = cfr;
        _this.modalService = modalService;
        _this.el = el;
        _this.hostCls = 'f-cmp-inputgroup';
        _this.text = '';
        _this.conditions = [];
        _this.originalData = [];
        _this.columns = [];
        _this.fieldEditor = { type: 'select', options: {} };
        _this.returnType = 'object';
        _this.openDialog = new EventEmitter();
        _this.enableClear = true;
        _this.cd = null;
        _this.showClearButton = false;
        _this.commonUtils = null;
        _this.localeService = _this.injector.get(LocaleService);
        _this.cd = _this.injector.get(ChangeDetectorRef, null);
        _this.commonUtils = _this.injector.get(CommonUtils, null) || new CommonUtils();
        return _this;
    }
    /**
     * @return {?}
     */
    SorterComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () { };
    /**
     * @return {?}
     */
    SorterComponent.prototype.onmouseover = /**
     * @return {?}
     */
    function () {
        this.showClearButton = true;
    };
    /**
     * @return {?}
     */
    SorterComponent.prototype.onmouseleave = /**
     * @return {?}
     */
    function () {
        this.showClearButton = false;
    };
    /**
     * @return {?}
     */
    SorterComponent.prototype.showDialog = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (!this.disabled) {
            if (this.fieldEditor && this.fieldEditor.type === 'combo-tree') {
                this.fieldEditor.options = this.fieldEditor.options || {};
                if (this.fieldEditor.options.autoWidth === undefined) {
                    this.fieldEditor.options.autoWidth = true;
                }
                if (!this.fieldEditor.options.columns) {
                    this.fieldEditor.options.columns = [{ field: 'label', title: 'label', width: 100 }];
                }
                if (!this.fieldEditor.options.textField) {
                    this.fieldEditor.options.textField = 'label';
                }
                if (!this.fieldEditor.options.idField) {
                    this.fieldEditor.options.idField = 'value';
                }
            }
            /** @type {?} */
            var sortEditorFactory = this.cfr.resolveComponentFactory(SortEditorComponent);
            this.sortEditorRef = sortEditorFactory.create(this.injector);
            this.sortEditorRef.instance.columns = this.columns;
            this.sortEditorRef.instance.conditions = this.conditions;
            this.originalData = cloneDeep(this.conditions);
            this.dlgRef = this.modalService.show(this.sortEditorRef, {
                width: 500, height: 400,
                title: this.localeService.getValue('sortEditor.title'),
                enableScroll: false,
                minHeight: 298, minWidth: 498, iconCls: 'f-icon f-icon-col-defaultsort',
                buttons: this.btnRef,
                showMaxButton: false, buttonAlign: 'right',
                // dialogFooterStyles: { background: '#F4F6F9' },
                initialState: {
                    fieldEditor: this.fieldEditor
                }
            });
            this.sortEditorRef.instance.height = this.dlgRef.dialog.instance.getContainerSize().height;
            this.dlgRef.dialog.instance.resized.subscribe((/**
             * @param {?} size
             * @return {?}
             */
            function (size) {
                _this.sortEditorRef.instance.height = size.containerHeight;
            }));
            this.sortEditorRef.instance.sortsChanged.subscribe((/**
             * @param {?} e
             * @return {?}
             */
            function (e) {
                _this.conditions = e.data;
            }));
            this.sortEditorRef.changeDetectorRef.detectChanges();
            this.dlgRef.dialog.changeDetectorRef.reattach();
            this.openDialog.emit();
        }
    };
    /**
     * @param {?} val
     * @return {?}
     */
    SorterComponent.prototype.writeValue = /**
     * @param {?} val
     * @return {?}
     */
    function (val) {
        if (val) {
            if (typeof val === 'string') {
                val = JSON.parse(val);
            }
            this.conditions = val || [];
            this.text = this.commonUtils.buildSortString(val);
        }
    };
    /**
     * @return {?}
     */
    SorterComponent.prototype.save = /**
     * @return {?}
     */
    function () {
        if (this.conditions.length) {
            this.conditions = this.conditions.filter((/**
             * @param {?} c
             * @return {?}
             */
            function (c) { return c.sortField; }));
            this.text = this.commonUtils.buildSortString(this.conditions);
        }
        else {
            this.text = '';
        }
        this.closeDialog();
        if (this.cd) {
            this.cd.detectChanges();
        }
    };
    /**
     * @return {?}
     */
    SorterComponent.prototype.cancel = /**
     * @return {?}
     */
    function () {
        this.conditions = this.originalData;
        this.closeDialog();
    };
    /**
     * @return {?}
     */
    SorterComponent.prototype.closeDialog = /**
     * @return {?}
     */
    function () {
        this.updateModel();
        this.sortEditorRef = null;
        this.dlgRef.close();
    };
    /**
     * @return {?}
     */
    SorterComponent.prototype.clear = /**
     * @return {?}
     */
    function () {
        this.text = '';
        this.conditions = [];
        this.updateModel();
    };
    /**
     * @private
     * @return {?}
     */
    SorterComponent.prototype.updateModel = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var v = this.conditions;
        if (this.returnType === 'string') {
            v = JSON.stringify(this.conditions);
        }
        this.onModelChange(v);
        this.onModelTouched(v);
    };
    SorterComponent.decorators = [
        { type: Component, args: [{
                    selector: 'sorter',
                    template: "\n    <div class=\"input-group\">\n        <input class=\"form-control\" [value]=\"text\" #txtbox\n            [readonly]=\"!editable || readonly\"\n            [class.f-state-disabled] = \"disabled\"\n            [class.f-state-readonly] = \"readonly\"\n            [class.f-state-editable] = \"!editable\"\n            [disabled]=\"disabled\"/>\n        <div class=\"input-group-append\" *ngIf=\"!readonly && !disabled\">\n            <span *ngIf=\"showClearButton && enableClear\" class=\"input-group-text input-group-clear\" (click)=\"clear()\">\n                <i class=\"f-icon modal_close\"></i>\n            </span>\n            <span class=\"f-select input-group-text\"  (click)=\"showDialog()\">\n                <i class=\"f-icon f-icon-lookup\"></i>\n            </span>\n        </div>\n    </div>\n\n    <ng-template #defaultButtonRef>\n        <button class=\"btn btn-outline-secondary\" (click)=\"cancel()\"> {{ 'sortEditor.cancel'| locale }} </button>&nbsp;\n        <button class=\"btn btn-primary\" (click)=\"save()\"> {{ 'sortEditor.ok'| locale }} </button>\n    </ng-template>\n    ",
                    providers: [
                        SORTER_LOOKUPGRID_VALUE_ACCESSOR
                    ],
                    styles: ["\n        .lookup-clear { cursor: pointer; background: #fff!important;}\n        .lookup-clear:hover { background: #e9ecef!important;}\n        "]
                }] }
    ];
    /** @nocollapse */
    SorterComponent.ctorParameters = function () { return [
        { type: Injector },
        { type: ComponentFactoryResolver },
        { type: BsModalService },
        { type: ElementRef }
    ]; };
    SorterComponent.propDecorators = {
        hostCls: [{ type: HostBinding, args: ['class',] }],
        columns: [{ type: Input }],
        fieldEditor: [{ type: Input }],
        returnType: [{ type: Input }],
        openDialog: [{ type: Output }],
        btnRef: [{ type: ViewChild, args: ['defaultButtonRef',] }],
        textbox: [{ type: ViewChild, args: ['txtbox',] }],
        enableClear: [{ type: Input }],
        onmouseover: [{ type: HostListener, args: ['mouseover',] }],
        onmouseleave: [{ type: HostListener, args: ['mouseleave',] }]
    };
    return SorterComponent;
}(LookupComponent));
export { SorterComponent };
if (false) {
    /** @type {?} */
    SorterComponent.prototype.hostCls;
    /** @type {?} */
    SorterComponent.prototype.text;
    /** @type {?} */
    SorterComponent.prototype.conditions;
    /** @type {?} */
    SorterComponent.prototype.originalData;
    /** @type {?} */
    SorterComponent.prototype.columns;
    /** @type {?} */
    SorterComponent.prototype.fieldEditor;
    /** @type {?} */
    SorterComponent.prototype.returnType;
    /** @type {?} */
    SorterComponent.prototype.openDialog;
    /** @type {?} */
    SorterComponent.prototype.btnRef;
    /** @type {?} */
    SorterComponent.prototype.textbox;
    /** @type {?} */
    SorterComponent.prototype.enableClear;
    /** @type {?} */
    SorterComponent.prototype.dlgRef;
    /** @type {?} */
    SorterComponent.prototype.sortEditorRef;
    /** @type {?} */
    SorterComponent.prototype.cd;
    /** @type {?} */
    SorterComponent.prototype.showClearButton;
    /** @type {?} */
    SorterComponent.prototype.localeService;
    /** @type {?} */
    SorterComponent.prototype.commonUtils;
    /**
     * @type {?}
     * @private
     */
    SorterComponent.prototype.cfr;
    /**
     * @type {?}
     * @private
     */
    SorterComponent.prototype.modalService;
    /** @type {?} */
    SorterComponent.prototype.el;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic29ydC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLXNvcnQtZWRpdG9yLyIsInNvdXJjZXMiOlsibGliL3NvcnQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sZUFBZSxDQUFDOzs7Ozs7Ozs7QUFVbEQsT0FBTyxFQUFFLFNBQVMsRUFBVSxLQUFLLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBRSxTQUFTLEVBQUUsV0FBVyxFQUM3RCxRQUFRLEVBQUUsd0JBQXdCLEVBQUUsVUFBVSxFQUFFLFVBQVUsRUFBRSxZQUFZLEVBQUUsV0FBVyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQy9ILE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFDdEMsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBRXBELE9BQU8sRUFBYyxjQUFjLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUM5RCxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUM5RCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNuRCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDbEQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLG1CQUFtQixDQUFDOzs7O0FBQ2hELHVDQUdDOzs7SUFGRyxpQ0FBeUM7O0lBQ3pDLG9DQUFjOzs7QUFFbEIsTUFBTSxLQUFPLGdDQUFnQyxHQUFRO0lBQ2pELE9BQU8sRUFBRSxpQkFBaUI7SUFDMUIsV0FBVyxFQUFFLFVBQVU7OztJQUFDLGNBQU0sT0FBQSxlQUFlLEVBQWYsQ0FBZSxFQUFDO0lBQzlDLEtBQUssRUFBRSxJQUFJO0NBQ2Q7QUFFRDtJQW9DcUMsMkNBQWU7SUFxQmhELHlCQUNJLFFBQWtCLEVBQVUsR0FBNkIsRUFDakQsWUFBNEIsRUFBUyxF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Z0JBckRpQixRQUFRO2dCQUFFLHdCQUF3QjtnQkFJL0IsY0FBYztnQkFKbUIsVUFBVTs7OzBCQXlEM0QsV0FBVyxTQUFDLE9BQU87MEJBS25CLEtBQUs7OEJBQ0wsS0FBSzs2QkFDTCxLQUFLOzZCQUNMLE1BQU07eUJBQ04sU0FBUyxTQUFDLGtCQUFrQjswQkFDNUIsU0FBUyxTQUFDLFFBQVE7OEJBQ2xCLEtBQUs7OEJBbUJMLFlBQVksU0FBQyxXQUFXOytCQUt4QixZQUFZLFNBQUMsWUFBWTs7SUFzSDlCLHNCQUFDO0NBQUEsQUEvTEQsQ0FvQ3FDLGVBQWUsR0EySm5EO1NBM0pZLGVBQWU7OztJQUV4QixrQ0FBbUQ7O0lBRW5ELCtCQUFVOztJQUNWLHFDQUFpQzs7SUFDakMsdUNBQW1DOztJQUNuQyxrQ0FBd0Q7O0lBQ3hELHNDQUF5RTs7SUFDekUscUNBQW9EOztJQUNwRCxxQ0FBMEM7O0lBQzFDLGlDQUF3RDs7SUFDeEQsa0NBQThDOztJQUM5QyxzQ0FBNEI7O0lBQzVCLGlDQUFtQjs7SUFDbkIsd0NBQWlEOztJQUNqRCw2QkFBNkI7O0lBRTdCLDBDQUF3Qjs7SUFDeEIsd0NBQTZCOztJQUM3QixzQ0FBZ0M7Ozs7O0lBRVIsOEJBQXFDOzs7OztJQUN6RCx1Q0FBb0M7O0lBQUUsNkJBQXFCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ2hhbmdlRGV0ZWN0b3JSZWYgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuLypcclxuKiBAQXV0aG9yOiDnlq/ni4Lnp4DmiY0obHVjYXMgaHVhbmcpXHJcbiogQERhdGU6IDIwMTgtMTEtMjMgMDg6MzM6MzdcclxuICogQExhc3RFZGl0b3JzOiDnlq/ni4Lnp4DmiY0oTHVjYXMgSHVhbmcpXHJcbiAqIEBMYXN0RWRpdFRpbWU6IDIwMTktMTAtMTcgMTY6Mzg6NTNcclxuKiBAQ29tcGFueTogSW5zcHVyXHJcbiogQFZlcnNpb246IHYwLjAuMVxyXG4qL1xyXG5cclxuaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIElucHV0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgVmlld0NoaWxkLCBUZW1wbGF0ZVJlZixcclxuICAgIENvbXBvbmVudFJlZiwgSW5qZWN0b3IsIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciwgRWxlbWVudFJlZiwgZm9yd2FyZFJlZiwgSG9zdExpc3RlbmVyLCBIb3N0QmluZGluZyB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBjbG9uZURlZXAgfSBmcm9tICdsb2Rhc2gtZXMnO1xyXG5pbXBvcnQgeyBMb29rdXBDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLWxvb2t1cCc7XHJcbmltcG9ydCB7IFNvcnRDb25kaXRpb24sIFNvcnRUeXBlIH0gZnJvbSAnQGZhcnJpcy91aS1jb21tb24vdHlwZXMnO1xyXG5pbXBvcnQgeyBCc01vZGFsUmVmLCBCc01vZGFsU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbW9kYWwnO1xyXG5pbXBvcnQgeyBTb3J0RWRpdG9yQ29tcG9uZW50IH0gZnJvbSAnLi9zb3J0LWVkaXRvci5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBOR19WQUxVRV9BQ0NFU1NPUiB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcclxuaW1wb3J0IHsgTG9jYWxlU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbG9jYWxlJztcclxuaW1wb3J0IHsgQ29tbW9uVXRpbHMgfSBmcm9tICdAZmFycmlzL3VpLWNvbW1vbic7XHJcbmV4cG9ydCBpbnRlcmZhY2UgU09SVF9GSUVMRF9FRElUT1Ige1xyXG4gICAgdHlwZTogJ3NlbGVjdCcgfCAnY29tYm8tdHJlZScgfCAnbG9va3VwJztcclxuICAgIG9wdGlvbnM/OiBhbnk7XHJcbn1cclxuZXhwb3J0IGNvbnN0IFNPUlRFUl9MT09LVVBHUklEX1ZBTFVFX0FDQ0VTU09SOiBhbnkgPSB7XHJcbiAgICBwcm92aWRlOiBOR19WQUxVRV9BQ0NFU1NPUixcclxuICAgIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IFNvcnRlckNvbXBvbmVudCksXHJcbiAgICBtdWx0aTogdHJ1ZVxyXG59O1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ3NvcnRlcicsXHJcbiAgICB0ZW1wbGF0ZTogYFxyXG4gICAgPGRpdiBjbGFzcz1cImlucHV0LWdyb3VwXCI+XHJcbiAgICAgICAgPGlucHV0IGNsYXNzPVwiZm9ybS1jb250cm9sXCIgW3ZhbHVlXT1cInRleHRcIiAjdHh0Ym94XHJcbiAgICAgICAgICAgIFtyZWFkb25seV09XCIhZWRpdGFibGUgfHwgcmVhZG9ubHlcIlxyXG4gICAgICAgICAgICBbY2xhc3MuZi1zdGF0ZS1kaXNhYmxlZF0gPSBcImRpc2FibGVkXCJcclxuICAgICAgICAgICAgW2NsYXNzLmYtc3RhdGUtcmVhZG9ubHldID0gXCJyZWFkb25seVwiXHJcbiAgICAgICAgICAgIFtjbGFzcy5mLXN0YXRlLWVkaXRhYmxlXSA9IFwiIWVkaXRhYmxlXCJcclxuICAgICAgICAgICAgW2Rpc2FibGVkXT1cImRpc2FibGVkXCIvPlxyXG4gICAgICAgIDxkaXYgY2xhc3M9XCJpbnB1dC1ncm91cC1hcHBlbmRcIiAqbmdJZj1cIiFyZWFkb25seSAmJiAhZGlzYWJsZWRcIj5cclxuICAgICAgICAgICAgPHNwYW4gKm5nSWY9XCJzaG93Q2xlYXJCdXR0b24gJiYgZW5hYmxlQ2xlYXJcIiBjbGFzcz1cImlucHV0LWdyb3VwLXRleHQgaW5wdXQtZ3JvdXAtY2xlYXJcIiAoY2xpY2spPVwiY2xlYXIoKVwiPlxyXG4gICAgICAgICAgICAgICAgPGkgY2xhc3M9XCJmLWljb24gbW9kYWxfY2xvc2VcIj48L2k+XHJcbiAgICAgICAgICAgIDwvc3Bhbj5cclxuICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJmLXNlbGVjdCBpbnB1dC1ncm91cC10ZXh0XCIgIChjbGljayk9XCJzaG93RGlhbG9nKClcIj5cclxuICAgICAgICAgICAgICAgIDxpIGNsYXNzPVwiZi1pY29uIGYtaWNvbi1sb29rdXBcIj48L2k+XHJcbiAgICAgICAgICAgIDwvc3Bhbj5cclxuICAgICAgICA8L2Rpdj5cclxuICAgIDwvZGl2PlxyXG5cclxuICAgIDxuZy10ZW1wbGF0ZSAjZGVmYXVsdEJ1dHRvblJlZj5cclxuICAgICAgICA8YnV0dG9uIGNsYXNzPVwiYnRuIGJ0bi1vdXRsaW5lLXNlY29uZGFyeVwiIChjbGljayk9XCJjYW5jZWwoKVwiPiB7eyAnc29ydEVkaXRvci5jYW5jZWwnfCBsb2NhbGUgfX0gPC9idXR0b24+Jm5ic3A7XHJcbiAgICAgICAgPGJ1dHRvbiBjbGFzcz1cImJ0biBidG4tcHJpbWFyeVwiIChjbGljayk9XCJzYXZlKClcIj4ge3sgJ3NvcnRFZGl0b3Iub2snfCBsb2NhbGUgfX0gPC9idXR0b24+XHJcbiAgICA8L25nLXRlbXBsYXRlPlxyXG4gICAgYCxcclxuICAgIHByb3ZpZGVyczogW1xyXG4gICAgICAgIFNPUlRFUl9MT09LVVBHUklEX1ZBTFVFX0FDQ0VTU09SXHJcbiAgICBdLFxyXG4gICAgc3R5bGVzOiBbXHJcbiAgICAgICAgYFxyXG4gICAgICAgIC5sb29rdXAtY2xlYXIgeyBjdXJzb3I6IHBvaW50ZXI7IGJhY2tncm91bmQ6ICNmZmYhaW1wb3J0YW50O31cclxuICAgICAgICAubG9va3VwLWNsZWFyOmhvdmVyIHsgYmFja2dyb3VuZDogI2U5ZWNlZiFpbXBvcnRhbnQ7fVxyXG4gICAgICAgIGBcclxuICAgIF1cclxufSlcclxuXHJcbmV4cG9ydCBjbGFzcyBTb3J0ZXJDb21wb25lbnQgZXh0ZW5kcyBMb29rdXBDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG5cclxuICAgIEBIb3N0QmluZGluZygnY2xhc3MnKSBob3N0Q2xzID0gJ2YtY21wLWlucHV0Z3JvdXAnO1xyXG5cclxuICAgIHRleHQgPSAnJztcclxuICAgIGNvbmRpdGlvbnM6IFNvcnRDb25kaXRpb25bXSA9IFtdO1xyXG4gICAgb3JpZ2luYWxEYXRhOiBTb3J0Q29uZGl0aW9uW10gPSBbXTtcclxuICAgIEBJbnB1dCgpIGNvbHVtbnM6IHtsYWJlbDogc3RyaW5nLCB2YWx1ZTogc3RyaW5nfVtdID0gW107XHJcbiAgICBASW5wdXQoKSBmaWVsZEVkaXRvcjogU09SVF9GSUVMRF9FRElUT1IgPSB7IHR5cGU6ICdzZWxlY3QnLCBvcHRpb25zOiB7fX07XHJcbiAgICBASW5wdXQoKSByZXR1cm5UeXBlOiAnb2JqZWN0JyB8ICdzdHJpbmcnID0gJ29iamVjdCc7XHJcbiAgICBAT3V0cHV0KCkgb3BlbkRpYWxvZyA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIEBWaWV3Q2hpbGQoJ2RlZmF1bHRCdXR0b25SZWYnKSBidG5SZWY6IFRlbXBsYXRlUmVmPGFueT47XHJcbiAgICBAVmlld0NoaWxkKCd0eHRib3gnKSB0ZXh0Ym94OiBFbGVtZW50UmVmPGFueT47XHJcbiAgICBASW5wdXQoKSBlbmFibGVDbGVhciA9IHRydWU7XHJcbiAgICBkbGdSZWY6IEJzTW9kYWxSZWY7XHJcbiAgICBzb3J0RWRpdG9yUmVmOiBDb21wb25lbnRSZWY8U29ydEVkaXRvckNvbXBvbmVudD47XHJcbiAgICBjZDogQ2hhbmdlRGV0ZWN0b3JSZWYgPSBudWxsO1xyXG5cclxuICAgIHNob3dDbGVhckJ1dHRvbiA9IGZhbHNlO1xyXG4gICAgbG9jYWxlU2VydmljZTogTG9jYWxlU2VydmljZTtcclxuICAgIGNvbW1vblV0aWxzOiBDb21tb25VdGlscyA9IG51bGw7XHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBpbmplY3RvcjogSW5qZWN0b3IsIHByaXZhdGUgY2ZyOiBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsXHJcbiAgICAgICAgcHJpdmF0ZSBtb2RhbFNlcnZpY2U6IEJzTW9kYWxTZXJ2aWNlLCBwdWJsaWMgZWw6IEVsZW1lbnRSZWYpIHtcclxuICAgICAgICBzdXBlcihpbmplY3RvciwgZWwpO1xyXG4gICAgICAgIHRoaXMubG9jYWxlU2VydmljZSA9IHRoaXMuaW5qZWN0b3IuZ2V0KExvY2FsZVNlcnZpY2UpO1xyXG4gICAgICAgIHRoaXMuY2QgPSB0aGlzLmluamVjdG9yLmdldChDaGFuZ2VEZXRlY3RvclJlZiwgbnVsbCk7XHJcbiAgICAgICAgdGhpcy5jb21tb25VdGlscyA9IHRoaXMuaW5qZWN0b3IuZ2V0KENvbW1vblV0aWxzLCBudWxsKSB8fCBuZXcgQ29tbW9uVXRpbHMoKTtcclxuICAgIH1cclxuXHJcbiAgICBuZ09uSW5pdCgpIHsgfVxyXG5cclxuICAgIEBIb3N0TGlzdGVuZXIoJ21vdXNlb3ZlcicpXHJcbiAgICBvbm1vdXNlb3ZlcigpIHtcclxuICAgICAgICB0aGlzLnNob3dDbGVhckJ1dHRvbiA9IHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgQEhvc3RMaXN0ZW5lcignbW91c2VsZWF2ZScpXHJcbiAgICBvbm1vdXNlbGVhdmUoKSB7XHJcbiAgICAgICAgdGhpcy5zaG93Q2xlYXJCdXR0b24gPSBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBzaG93RGlhbG9nKCkge1xyXG4gICAgICAgIGlmICghdGhpcy5kaXNhYmxlZCkge1xyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuZmllbGRFZGl0b3IgJiYgdGhpcy5maWVsZEVkaXRvci50eXBlID09PSAnY29tYm8tdHJlZScpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZmllbGRFZGl0b3Iub3B0aW9ucyA9IHRoaXMuZmllbGRFZGl0b3Iub3B0aW9ucyB8fCB7fTtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmZpZWxkRWRpdG9yLm9wdGlvbnMuYXV0b1dpZHRoID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmZpZWxkRWRpdG9yLm9wdGlvbnMuYXV0b1dpZHRoID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuZmllbGRFZGl0b3Iub3B0aW9ucy5jb2x1bW5zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5maWVsZEVkaXRvci5vcHRpb25zLmNvbHVtbnMgPSBbIHsgZmllbGQ6ICdsYWJlbCcsIHRpdGxlOiAnbGFiZWwnLCB3aWR0aDogMTAwIH0gXTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuZmllbGRFZGl0b3Iub3B0aW9ucy50ZXh0RmllbGQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmZpZWxkRWRpdG9yLm9wdGlvbnMudGV4dEZpZWxkID0gJ2xhYmVsJztcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuZmllbGRFZGl0b3Iub3B0aW9ucy5pZEZpZWxkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5maWVsZEVkaXRvci5vcHRpb25zLmlkRmllbGQgPSAndmFsdWUnO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgY29uc3Qgc29ydEVkaXRvckZhY3RvcnkgPSB0aGlzLmNmci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShTb3J0RWRpdG9yQ29tcG9uZW50KTtcclxuICAgICAgICAgICAgdGhpcy5zb3J0RWRpdG9yUmVmID0gc29ydEVkaXRvckZhY3RvcnkuY3JlYXRlKHRoaXMuaW5qZWN0b3IpO1xyXG4gICAgICAgICAgICB0aGlzLnNvcnRFZGl0b3JSZWYuaW5zdGFuY2UuY29sdW1ucyA9IHRoaXMuY29sdW1ucztcclxuICAgICAgICAgICAgdGhpcy5zb3J0RWRpdG9yUmVmLmluc3RhbmNlLmNvbmRpdGlvbnMgPSB0aGlzLmNvbmRpdGlvbnM7XHJcbiAgICAgICAgICAgIHRoaXMub3JpZ2luYWxEYXRhID0gY2xvbmVEZWVwKHRoaXMuY29uZGl0aW9ucyk7XHJcbiAgICAgICAgICAgIHRoaXMuZGxnUmVmID0gdGhpcy5tb2RhbFNlcnZpY2Uuc2hvdyh0aGlzLnNvcnRFZGl0b3JSZWYsIHtcclxuICAgICAgICAgICAgICAgIHdpZHRoOiA1MDAsIGhlaWdodDogNDAwLFxyXG4gICAgICAgICAgICAgICAgdGl0bGU6IHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZSgnc29ydEVkaXRvci50aXRsZScpLFxyXG4gICAgICAgICAgICAgICAgZW5hYmxlU2Nyb2xsOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIG1pbkhlaWdodDogMjk4LCBtaW5XaWR0aDogNDk4LCBpY29uQ2xzOiAnZi1pY29uIGYtaWNvbi1jb2wtZGVmYXVsdHNvcnQnLFxyXG4gICAgICAgICAgICAgICAgYnV0dG9uczogdGhpcy5idG5SZWYsXHJcbiAgICAgICAgICAgICAgICBzaG93TWF4QnV0dG9uOiBmYWxzZSwgYnV0dG9uQWxpZ246ICdyaWdodCcsXHJcbiAgICAgICAgICAgICAgICAvLyBkaWFsb2dGb290ZXJTdHlsZXM6IHsgYmFja2dyb3VuZDogJyNGNEY2RjknIH0sXHJcbiAgICAgICAgICAgICAgICBpbml0aWFsU3RhdGU6IHtcclxuICAgICAgICAgICAgICAgICAgICBmaWVsZEVkaXRvcjogdGhpcy5maWVsZEVkaXRvclxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuc29ydEVkaXRvclJlZi5pbnN0YW5jZS5oZWlnaHQgPSB0aGlzLmRsZ1JlZi5kaWFsb2cuaW5zdGFuY2UuZ2V0Q29udGFpbmVyU2l6ZSgpLmhlaWdodDtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuZGxnUmVmLmRpYWxvZy5pbnN0YW5jZS5yZXNpemVkLnN1YnNjcmliZSggc2l6ZSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNvcnRFZGl0b3JSZWYuaW5zdGFuY2UuaGVpZ2h0ID0gc2l6ZS5jb250YWluZXJIZWlnaHQ7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5zb3J0RWRpdG9yUmVmLmluc3RhbmNlLnNvcnRzQ2hhbmdlZC5zdWJzY3JpYmUoIChlOiB7YWN0aW9uOiBzdHJpbmcsIGRhdGE6IGFueVtdfSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jb25kaXRpb25zID0gZS5kYXRhO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuc29ydEVkaXRvclJlZi5jaGFuZ2VEZXRlY3RvclJlZi5kZXRlY3RDaGFuZ2VzKCk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmRsZ1JlZi5kaWFsb2cuY2hhbmdlRGV0ZWN0b3JSZWYucmVhdHRhY2goKTtcclxuICAgICAgICAgICAgdGhpcy5vcGVuRGlhbG9nLmVtaXQoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgd3JpdGVWYWx1ZSh2YWw6IGFueSkge1xyXG4gICAgICAgIGlmICh2YWwpIHtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWwgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgICAgICB2YWwgPSBKU09OLnBhcnNlKHZhbCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMuY29uZGl0aW9ucyA9IHZhbCB8fCBbXTtcclxuICAgICAgICAgICAgdGhpcy50ZXh0ID0gdGhpcy5jb21tb25VdGlscy5idWlsZFNvcnRTdHJpbmcodmFsKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc2F2ZSgpIHtcclxuICAgICAgICBpZiAodGhpcy5jb25kaXRpb25zLmxlbmd0aCkge1xyXG4gICAgICAgICAgICB0aGlzLmNvbmRpdGlvbnMgPSB0aGlzLmNvbmRpdGlvbnMuZmlsdGVyKGMgPT4gYy5zb3J0RmllbGQpO1xyXG4gICAgICAgICAgICB0aGlzLnRleHQgPSB0aGlzLmNvbW1vblV0aWxzLmJ1aWxkU29ydFN0cmluZyh0aGlzLmNvbmRpdGlvbnMpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMudGV4dCA9ICcnO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5jbG9zZURpYWxvZygpO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5jZCkge1xyXG4gICAgICAgICAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY2FuY2VsKCkge1xyXG4gICAgICAgIHRoaXMuY29uZGl0aW9ucyA9IHRoaXMub3JpZ2luYWxEYXRhO1xyXG4gICAgICAgIHRoaXMuY2xvc2VEaWFsb2coKTtcclxuICAgIH1cclxuXHJcbiAgICBjbG9zZURpYWxvZygpIHtcclxuICAgICAgICB0aGlzLnVwZGF0ZU1vZGVsKCk7XHJcbiAgICAgICAgdGhpcy5zb3J0RWRpdG9yUmVmID0gbnVsbDtcclxuICAgICAgICB0aGlzLmRsZ1JlZi5jbG9zZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIGNsZWFyKCkge1xyXG4gICAgICAgIHRoaXMudGV4dCA9ICcnO1xyXG4gICAgICAgIHRoaXMuY29uZGl0aW9ucyA9IFtdO1xyXG4gICAgICAgIHRoaXMudXBkYXRlTW9kZWwoKTtcclxuICAgIH1cclxuXHJcblxyXG5cclxuICAgIHByaXZhdGUgdXBkYXRlTW9kZWwoKSB7XHJcbiAgICAgICAgbGV0IHY6IGFueSA9IHRoaXMuY29uZGl0aW9ucztcclxuICAgICAgICBpZiAodGhpcy5yZXR1cm5UeXBlID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICB2ID0gSlNPTi5zdHJpbmdpZnkodGhpcy5jb25kaXRpb25zKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMub25Nb2RlbENoYW5nZSh2KTtcclxuICAgICAgICB0aGlzLm9uTW9kZWxUb3VjaGVkKHYpO1xyXG4gICAgfVxyXG5cclxufVxyXG4iXX0=