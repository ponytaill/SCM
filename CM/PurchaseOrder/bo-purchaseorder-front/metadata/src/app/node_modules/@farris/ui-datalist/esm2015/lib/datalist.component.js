/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, Directive, TemplateRef, ContentChild, ElementRef, HostBinding, ViewEncapsulation, Output, EventEmitter, ChangeDetectionStrategy, ViewChild } from '@angular/core';
import { DataListFacadeService } from './core/datalist-facade.service';
export class DataListItemTemplateDirective {
    /**
     * @param {?} template
     */
    constructor(template) {
        this.template = template;
    }
}
DataListItemTemplateDirective.decorators = [
    { type: Directive, args: [{
                selector: '[list-item-tmp]'
            },] }
];
/** @nocollapse */
DataListItemTemplateDirective.ctorParameters = () => [
    { type: TemplateRef }
];
if (false) {
    /** @type {?} */
    DataListItemTemplateDirective.prototype.template;
}
export class DatalistComponent {
    /**
     * @param {?} el
     * @param {?} store
     */
    constructor(el, store) {
        this.el = el;
        this.store = store;
        this.cls = true;
        this.fit = true;
        this.width = 300;
        this.height = 400;
        this.multiSelect = false;
        this.disabled = false;
        this.showHeader = false;
        this.showCheckBox = false;
        this.headerHeight = 40;
        this.enableCancelSelected = true;
        /**
         * 分隔符，默认为 ,
         */
        this.separator = ',';
        this.selected = new EventEmitter();
        this.unSelected = new EventEmitter();
        this.selectedValuesChange = new EventEmitter();
        this.scrollbarHeight$ = this.store.containerHeight$;
        // tslint:disable-next-line:variable-name
        this._options$ = this.store.options$;
        this.data$ = this.store.data$;
    }
    /**
     * @return {?}
     */
    get fluid() {
        return this._height === 'auto' ? false : this.fit;
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (changes && changes.data && !changes.data.isFirstChange()) {
            this.initCtrlState();
        }
        if (changes.selectedValues && !changes.selectedValues.isFirstChange()) {
            if (this.selectedValues !== '' && this.selectedValues !== undefined && this.selectedValues !== null) {
                this.store.setSelections(this.selectedValues, this.separator);
            }
            else {
                this.clearSelections();
            }
        }
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this._height = this.height;
        this.initCtrlState();
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        setTimeout((/**
         * @return {?}
         */
        () => {
            if (this.selectedValues && this.height !== 'auto') {
                /** @type {?} */
                let val = this.selectedValues;
                if (this.selectedValues.indexOf(this.separator) > -1) {
                    val = this.selectedValues.indexOf(this.separator)[0];
                }
                /** @type {?} */
                const index = this.data.findIndex((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => n[this.idField] == val));
                /** @type {?} */
                const ulEl = this.el.nativeElement.querySelector('ul.list-group');
                if (ulEl.children[index]) {
                    ulEl.children[index].scrollIntoView({ block: 'nearest' });
                }
            }
        }), 10);
    }
    /**
     * @private
     * @return {?}
     */
    loadData() {
        if (this.data) {
            this.store.loadData(this.data, this.selectedValues, this.separator);
        }
    }
    /**
     * @private
     * @return {?}
     */
    initCtrlState() {
        const { title, textField, fit, idField, valueField, width, height, multiSelect, disabled, headerHeight, separator } = Object.assign({}, this);
        this.store.initState({
            title,
            textField,
            valueField,
            fit,
            idField,
            width,
            height,
            multiSelect,
            disabled,
            headerHeight,
            separator
        });
        this.loadData();
    }
    /**
     * @return {?}
     */
    clearSelections() {
        this.store.clearSelections();
    }
    /**
     * @return {?}
     */
    resize() {
        if (this.fit) {
            /** @type {?} */
            const container = this.el.nativeElement.parentElement;
            /** @type {?} */
            const width = container.offsetWidth;
            /** @type {?} */
            const height = container.offsetHeight;
            this.store.updateContainerSize(width, height);
        }
    }
    /**
     * @private
     * @return {?}
     */
    updateSelectValues() {
        this.selectedValues = this.store.getSelections().map((/**
         * @param {?} item
         * @return {?}
         */
        item => {
            return item[this.valueField];
        })).join(this.separator);
        this.selectedValuesChange.emit(this.selectedValues);
    }
    /**
     * @param {?} event
     * @param {?} index
     * @param {?} item
     * @return {?}
     */
    onSelectHandler(event, index, item) {
        event.stopPropagation();
        if (this.disabled) {
            return false;
        }
        const { data } = Object.assign({}, item);
        if (!this.store.isSelect(item.id)) {
            this.store.selectItem(data, index);
            this.updateSelectValues();
            this.selected.emit({ index, data });
        }
        else {
            if (this.enableCancelSelected) {
                this.store.unSelectItem(data);
                this.updateSelectValues();
                this.unSelected.emit({ index, data });
            }
        }
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onCheckedChange($event) {
        const { index, row, originalEvent } = $event;
        this.onSelectHandler(originalEvent, index, row);
    }
    /**
     * @param {?} item
     * @return {?}
     */
    isChecked(item) {
        /** @type {?} */
        let val = this.selectedValues;
        if (this.selectedValues === null && this.selectedValues === undefined) {
            val = '';
        }
        if (typeof val === 'boolean') {
            val = '' + val;
        }
        if (val) {
            /** @type {?} */
            let _vals = [];
            if (this.multiSelect) {
                _vals = val.split(this.separator);
            }
            else {
                _vals = [val];
            }
            return _vals.some((/**
             * @param {?} v
             * @return {?}
             */
            v => v == '' + item.data[this.valueField]));
        }
        return false;
    }
    /**
     * @param {?} item
     * @return {?}
     */
    isSelected(item) {
        return this.isChecked(item);
    }
    /**
     * @return {?}
     */
    selectAll() {
        this.selectedValues = this.data.map((/**
         * @param {?} item
         * @return {?}
         */
        item => item[this.valueField])).join(this.separator);
        this.store.selectAll();
    }
    /**
     * @return {?}
     */
    unSelectAll() {
        this.selectedValues = '';
        this.store.clearSelections();
    }
}
DatalistComponent.decorators = [
    { type: Component, args: [{
                selector: 'farris-datalist',
                template: "<div *ngIf=\"_options$ | async as opts\" class=\"card\" [style.width.%]=\"100\" [style.height]=\"opts.height === 'auto' ? 'auto' : opts.height + 'px'\" style=\"min-height: 10px;\">\r\n    <div class=\"card-header\" *ngIf=\"opts.showHeader\">\r\n        {{ opts.title }}\r\n    </div>\r\n    <!-- <perfect-scrollbar #ps *ngIf=\"opts.height && opts.height !== 'auto'\" [style.width.%]=\"100\" [style.height.px]=\"scrollbarHeight$ | async\"> -->\r\n    <div *ngIf=\"opts.height && opts.height !== 'auto' && (data$ | async).length > 0\" style=\"overflow: auto;\" [style.width.%]=\"100\" [style.height.px]=\"scrollbarHeight$ | async\">\r\n        <ul class=\"list-group list-group-flush\">\r\n            <li style=\"cursor: default;\" [farrist-datalist-item]=\"item\" [style.height.px]=\"itemHeight\"\r\n                [class.active]=\"store.isSelect(item.id)\" class=\"list-group-item list-group-item-action\"\r\n                *ngFor=\"let item of data$ | async; let i = index\" title=\"{{item.data[textField]}}\" (click)=\"onSelectHandler( $event, i, item)\">\r\n                <dl-checkbox *ngIf=\"multiSelect\" [checked]=\"isChecked(item)\" [index]=\"i\" [row]=\"item\"\r\n                    (checkedChange)=\"onCheckedChange($event)\"></dl-checkbox>\r\n                <ng-container *ngIf=\"!itemTemplate\">\r\n                    <span class=\"f-datalist-item-text\">{{ item.data[textField] }}</span>\r\n                </ng-container>\r\n                <ng-container *ngIf=\"itemTemplate\" [ngTemplateOutlet]=\"itemTemplate\"\r\n                    [ngTemplateOutletContext]=\"{ data: item, index: i }\">\r\n                </ng-container>\r\n            </li>\r\n        </ul>\r\n    </div>\r\n    <!-- </perfect-scrollbar> -->\r\n    <div *ngIf=\"opts.height === 'auto' && (data$ | async).length > 0\" >\r\n        <ul class=\"list-group list-group-flush\">\r\n            <li style=\"cursor: default;\" [farrist-datalist-item]=\"item\" [style.height.px]=\"itemHeight\"\r\n                [class.active]=\"isSelected(item)\" class=\"list-group-item list-group-item-action\"\r\n                *ngFor=\"let item of data$ | async; let i = index\" title=\"{{item.data[textField]}}\" (click)=\"onSelectHandler( $event, i, item)\">\r\n                <dl-checkbox *ngIf=\"multiSelect\" [checked]=\"isChecked(item)\" [index]=\"i\" [row]=\"item\"\r\n                    (checkedChange)=\"onCheckedChange($event)\"></dl-checkbox>\r\n                <ng-container *ngIf=\"!itemTemplate\">\r\n                    <span class=\"f-datalist-item-text\">{{ item.data[textField] }}</span>\r\n                </ng-container>\r\n                <ng-container *ngIf=\"itemTemplate\" [ngTemplateOutlet]=\"itemTemplate\"\r\n                    [ngTemplateOutletContext]=\"{ data: item, index: i }\">\r\n                </ng-container>\r\n            </li>\r\n        </ul>\r\n    </div>\r\n    <div *ngIf=\"(data$ | async).length === 0\" style=\"height: 200px;\">\r\n        <div class=\"f-table-norecords-content\">\u6682\u65E0\u6570\u636E</div>\r\n    </div>\r\n</div>",
                providers: [DataListFacadeService],
                encapsulation: ViewEncapsulation.None,
                changeDetection: ChangeDetectionStrategy.OnPush,
                styles: [`
            .ps__rail-x,
            .ps__rail-y {
                z-index: 9;
            }
            .norecords-content {
                height: 8.125rem;
                padding: 7.8125rem 0 0;
                width: 100%;
                text-align: center;
                font-size: 1rem;
                color: rgba(0,0,0,.25);
                background: url(imgs/table-norecords.png) top center no-repeat;
                margin: -4.0625rem 0 0 -.625rem;
                line-height: 2.5rem;
            }
        `]
            }] }
];
/** @nocollapse */
DatalistComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: DataListFacadeService }
];
DatalistComponent.propDecorators = {
    cls: [{ type: HostBinding, args: ['class.f-datalist',] }],
    fluid: [{ type: HostBinding, args: ['class.farris-main-area',] }],
    itemHeight: [{ type: Input }],
    title: [{ type: Input }],
    data: [{ type: Input }],
    textField: [{ type: Input }],
    valueField: [{ type: Input }],
    idField: [{ type: Input }],
    fit: [{ type: Input }],
    width: [{ type: Input }],
    height: [{ type: Input }],
    multiSelect: [{ type: Input }],
    disabled: [{ type: Input }],
    showHeader: [{ type: Input }],
    showCheckBox: [{ type: Input }],
    headerHeight: [{ type: Input }],
    selectedValues: [{ type: Input }],
    enableCancelSelected: [{ type: Input }],
    separator: [{ type: Input }],
    itemTemplate: [{ type: ContentChild, args: [DataListItemTemplateDirective, { read: TemplateRef },] }],
    selected: [{ type: Output }],
    unSelected: [{ type: Output }],
    selectedValuesChange: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    DatalistComponent.prototype.cls;
    /** @type {?} */
    DatalistComponent.prototype.itemHeight;
    /** @type {?} */
    DatalistComponent.prototype.title;
    /** @type {?} */
    DatalistComponent.prototype.data;
    /** @type {?} */
    DatalistComponent.prototype.textField;
    /** @type {?} */
    DatalistComponent.prototype.valueField;
    /** @type {?} */
    DatalistComponent.prototype.idField;
    /** @type {?} */
    DatalistComponent.prototype.fit;
    /** @type {?} */
    DatalistComponent.prototype.width;
    /** @type {?} */
    DatalistComponent.prototype.height;
    /** @type {?} */
    DatalistComponent.prototype.multiSelect;
    /** @type {?} */
    DatalistComponent.prototype.disabled;
    /** @type {?} */
    DatalistComponent.prototype.showHeader;
    /** @type {?} */
    DatalistComponent.prototype.showCheckBox;
    /** @type {?} */
    DatalistComponent.prototype.headerHeight;
    /** @type {?} */
    DatalistComponent.prototype.selectedValues;
    /** @type {?} */
    DatalistComponent.prototype.enableCancelSelected;
    /**
     * 分隔符，默认为 ,
     * @type {?}
     */
    DatalistComponent.prototype.separator;
    /** @type {?} */
    DatalistComponent.prototype.itemTemplate;
    /** @type {?} */
    DatalistComponent.prototype.selected;
    /** @type {?} */
    DatalistComponent.prototype.unSelected;
    /** @type {?} */
    DatalistComponent.prototype.selectedValuesChange;
    /** @type {?} */
    DatalistComponent.prototype.scrollbarHeight$;
    /** @type {?} */
    DatalistComponent.prototype._options$;
    /** @type {?} */
    DatalistComponent.prototype.data$;
    /**
     * @type {?}
     * @private
     */
    DatalistComponent.prototype._height;
    /** @type {?} */
    DatalistComponent.prototype.el;
    /** @type {?} */
    DatalistComponent.prototype.store;
}
export class DataListItemComponentDirective {
    /**
     * @param {?} el
     */
    constructor(el) {
        this.el = el;
    }
    /**
     * @return {?}
     */
    ngOnInit() { }
}
DataListItemComponentDirective.decorators = [
    { type: Directive, args: [{
                // tslint:disable-next-line:directive-selector
                selector: '[farrist-datalist-item]'
            },] }
];
/** @nocollapse */
DataListItemComponentDirective.ctorParameters = () => [
    { type: ElementRef }
];
DataListItemComponentDirective.propDecorators = {
    data: [{ type: Input, args: ['farrist-datalist-item',] }]
};
if (false) {
    /** @type {?} */
    DataListItemComponentDirective.prototype.data;
    /**
     * @type {?}
     * @private
     */
    DataListItemComponentDirective.prototype.el;
}
/**
 * 表体checkbox 组件
 */
export class DataListCheckboxComponent {
    constructor() {
        this.checkedChange = new EventEmitter();
    }
    /**
     * @return {?}
     */
    ngOnInit() { }
    /**
     * @param {?} event
     * @return {?}
     */
    handleClick(event) {
        this.checked = !this.checked;
        this.checkedChange.emit({ originalEvent: event, index: this.index, row: this.row, state: this.checked });
        event.stopPropagation();
    }
}
DataListCheckboxComponent.decorators = [
    { type: Component, args: [{
                // tslint:disable-next-line:component-selector
                selector: 'dl-checkbox',
                template: `
        <div class="custom-control custom-checkbox  custom-control-inline dl-checkbox">
            <input type="checkbox" #chk class="custom-control-input" [disabled]="disabled" [checked]="checked" />
            <label class="custom-control-label" (click)="handleClick($event)"></label>
        </div>
    `,
                styles: [`
            :host .custom-checkbox {
                opacity: 1;
                float: none;
                margin: 0;
                vertical-align: top;
                padding-right: 0px;
            }
        `]
            }] }
];
/** @nocollapse */
DataListCheckboxComponent.ctorParameters = () => [];
DataListCheckboxComponent.propDecorators = {
    checked: [{ type: Input }],
    disabled: [{ type: Input }],
    index: [{ type: Input }],
    row: [{ type: Input }],
    checkedChange: [{ type: Output }],
    chk: [{ type: ViewChild, args: ['chk',] }]
};
if (false) {
    /** @type {?} */
    DataListCheckboxComponent.prototype.checked;
    /** @type {?} */
    DataListCheckboxComponent.prototype.disabled;
    /** @type {?} */
    DataListCheckboxComponent.prototype.index;
    /** @type {?} */
    DataListCheckboxComponent.prototype.row;
    /** @type {?} */
    DataListCheckboxComponent.prototype.checkedChange;
    /** @type {?} */
    DataListCheckboxComponent.prototype.chk;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YWxpc3QuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1kYXRhbGlzdC8iLCJzb3VyY2VzIjpbImxpYi9kYXRhbGlzdC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFDSCxTQUFTLEVBRVQsS0FBSyxFQUNMLFNBQVMsRUFDVCxXQUFXLEVBQ1gsWUFBWSxFQUNaLFVBQVUsRUFDVixXQUFXLEVBRVgsaUJBQWlCLEVBQ2pCLE1BQU0sRUFDTixZQUFZLEVBQ1osdUJBQXVCLEVBR3ZCLFNBQVMsRUFDWixNQUFNLGVBQWUsQ0FBQztBQUV2QixPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQU12RSxNQUFNLE9BQU8sNkJBQTZCOzs7O0lBQ3RDLFlBQW1CLFFBQTBCO1FBQTFCLGFBQVEsR0FBUixRQUFRLENBQWtCO0lBQUcsQ0FBQzs7O1lBSnBELFNBQVMsU0FBQztnQkFDUCxRQUFRLEVBQUUsaUJBQWlCO2FBQzlCOzs7O1lBbkJHLFdBQVc7Ozs7SUFxQkMsaURBQWlDOztBQTZCakQsTUFBTSxPQUFPLGlCQUFpQjs7Ozs7SUFzQzFCLFlBQW1CLEVBQWMsRUFBUyxLQUE0QjtRQUFuRCxPQUFFLEdBQUYsRUFBRSxDQUFZO1FBQVMsVUFBSyxHQUFMLEtBQUssQ0FBdUI7UUFyQ3JDLFFBQUcsR0FBRyxJQUFJLENBQUM7UUFjbkMsUUFBRyxHQUFHLElBQUksQ0FBQztRQUNYLFVBQUssR0FBRyxHQUFHLENBQUM7UUFDWixXQUFNLEdBQW9CLEdBQUcsQ0FBQztRQUM5QixnQkFBVyxHQUFHLEtBQUssQ0FBQztRQUNwQixhQUFRLEdBQUcsS0FBSyxDQUFDO1FBQ2pCLGVBQVUsR0FBRyxLQUFLLENBQUM7UUFDbkIsaUJBQVksR0FBRyxLQUFLLENBQUM7UUFDckIsaUJBQVksR0FBRyxFQUFFLENBQUM7UUFFbEIseUJBQW9CLEdBQUcsSUFBSSxDQUFDOzs7O1FBRTVCLGNBQVMs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Iiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICAgIENvbXBvbmVudCxcclxuICAgIE9uSW5pdCxcclxuICAgIElucHV0LFxyXG4gICAgRGlyZWN0aXZlLFxyXG4gICAgVGVtcGxhdGVSZWYsXHJcbiAgICBDb250ZW50Q2hpbGQsXHJcbiAgICBFbGVtZW50UmVmLFxyXG4gICAgSG9zdEJpbmRpbmcsXHJcbiAgICBBZnRlclZpZXdJbml0LFxyXG4gICAgVmlld0VuY2Fwc3VsYXRpb24sXHJcbiAgICBPdXRwdXQsXHJcbiAgICBFdmVudEVtaXR0ZXIsXHJcbiAgICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcclxuICAgIFNpbXBsZUNoYW5nZXMsXHJcbiAgICBPbkNoYW5nZXMsXHJcbiAgICBWaWV3Q2hpbGRcclxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgRmFycmlzRGF0YUl0ZW0gfSBmcm9tICdAZmFycmlzL3VpLWNvbW1vbic7XHJcbmltcG9ydCB7IERhdGFMaXN0RmFjYWRlU2VydmljZSB9IGZyb20gJy4vY29yZS9kYXRhbGlzdC1mYWNhZGUuc2VydmljZSc7XHJcbmltcG9ydCB7IFNlbGVjdEl0ZW0gfSBmcm9tICcuL2NvcmUvdHlwZXMnO1xyXG5cclxuQERpcmVjdGl2ZSh7XHJcbiAgICBzZWxlY3RvcjogJ1tsaXN0LWl0ZW0tdG1wXSdcclxufSlcclxuZXhwb3J0IGNsYXNzIERhdGFMaXN0SXRlbVRlbXBsYXRlRGlyZWN0aXZlIHtcclxuICAgIGNvbnN0cnVjdG9yKHB1YmxpYyB0ZW1wbGF0ZTogVGVtcGxhdGVSZWY8YW55Pikge31cclxufVxyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ2ZhcnJpcy1kYXRhbGlzdCcsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vZGF0YWxpc3QuY29tcG9uZW50Lmh0bWwnLFxyXG4gICAgc3R5bGVzOiBbXHJcbiAgICAgICAgYFxyXG4gICAgICAgICAgICAucHNfX3JhaWwteCxcclxuICAgICAgICAgICAgLnBzX19yYWlsLXkge1xyXG4gICAgICAgICAgICAgICAgei1pbmRleDogOTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAubm9yZWNvcmRzLWNvbnRlbnQge1xyXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiA4LjEyNXJlbTtcclxuICAgICAgICAgICAgICAgIHBhZGRpbmc6IDcuODEyNXJlbSAwIDA7XHJcbiAgICAgICAgICAgICAgICB3aWR0aDogMTAwJTtcclxuICAgICAgICAgICAgICAgIHRleHQtYWxpZ246IGNlbnRlcjtcclxuICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogMXJlbTtcclxuICAgICAgICAgICAgICAgIGNvbG9yOiByZ2JhKDAsMCwwLC4yNSk7XHJcbiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiB1cmwoaW1ncy90YWJsZS1ub3JlY29yZHMucG5nKSB0b3AgY2VudGVyIG5vLXJlcGVhdDtcclxuICAgICAgICAgICAgICAgIG1hcmdpbjogLTQuMDYyNXJlbSAwIDAgLS42MjVyZW07XHJcbiAgICAgICAgICAgICAgICBsaW5lLWhlaWdodDogMi41cmVtO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgYFxyXG4gICAgXSxcclxuICAgIHByb3ZpZGVyczogW0RhdGFMaXN0RmFjYWRlU2VydmljZV0sXHJcbiAgICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lLFxyXG4gICAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2hcclxufSlcclxuZXhwb3J0IGNsYXNzIERhdGFsaXN0Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMsIEFmdGVyVmlld0luaXQge1xyXG4gICAgQEhvc3RCaW5kaW5nKCdjbGFzcy5mLWRhdGFsaXN0JykgY2xzID0gdHJ1ZTtcclxuXHJcbiAgICBASG9zdEJpbmRpbmcoJ2NsYXNzLmZhcnJpcy1tYWluLWFyZWEnKVxyXG4gICAgZ2V0IGZsdWlkKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9oZWlnaHQgPT09ICdhdXRvJyA/IGZhbHNlIDogdGhpcy5maXQ7XHJcbiAgICB9XHJcblxyXG4gICAgQElucHV0KCkgaXRlbUhlaWdodDogbnVtYmVyO1xyXG5cclxuICAgIEBJbnB1dCgpIHRpdGxlOiBzdHJpbmc7XHJcbiAgICBASW5wdXQoKSBkYXRhOiBhbnk7XHJcbiAgICBASW5wdXQoKSB0ZXh0RmllbGQ6IHN0cmluZztcclxuICAgIEBJbnB1dCgpIHZhbHVlRmllbGQ6IHN0cmluZztcclxuICAgIEBJbnB1dCgpIGlkRmllbGQ6IHN0cmluZztcclxuICAgIEBJbnB1dCgpIGZpdCA9IHRydWU7XHJcbiAgICBASW5wdXQoKSB3aWR0aCA9IDMwMDtcclxuICAgIEBJbnB1dCgpIGhlaWdodDogbnVtYmVyIHwgc3RyaW5nID0gNDAwO1xyXG4gICAgQElucHV0KCkgbXVsdGlTZWxlY3QgPSBmYWxzZTtcclxuICAgIEBJbnB1dCgpIGRpc2FibGVkID0gZmFsc2U7XHJcbiAgICBASW5wdXQoKSBzaG93SGVhZGVyID0gZmFsc2U7XHJcbiAgICBASW5wdXQoKSBzaG93Q2hlY2tCb3ggPSBmYWxzZTtcclxuICAgIEBJbnB1dCgpIGhlYWRlckhlaWdodCA9IDQwO1xyXG4gICAgQElucHV0KCkgc2VsZWN0ZWRWYWx1ZXM6IHN0cmluZztcclxuICAgIEBJbnB1dCgpIGVuYWJsZUNhbmNlbFNlbGVjdGVkID0gdHJ1ZTtcclxuICAgIC8qKiDliIbpmpTnrKbvvIzpu5jorqTkuLogLCAqL1xyXG4gICAgQElucHV0KCkgc2VwYXJhdG9yID0gJywnO1xyXG4gICAgQENvbnRlbnRDaGlsZChEYXRhTGlzdEl0ZW1UZW1wbGF0ZURpcmVjdGl2ZSwgeyByZWFkOiBUZW1wbGF0ZVJlZiB9KSBpdGVtVGVtcGxhdGU6IFRlbXBsYXRlUmVmPGFueT47XHJcblxyXG4gICAgQE91dHB1dCgpIHNlbGVjdGVkID0gbmV3IEV2ZW50RW1pdHRlcjxTZWxlY3RJdGVtPigpO1xyXG4gICAgQE91dHB1dCgpIHVuU2VsZWN0ZWQgPSBuZXcgRXZlbnRFbWl0dGVyPFNlbGVjdEl0ZW0+KCk7XHJcbiAgICBAT3V0cHV0KCkgc2VsZWN0ZWRWYWx1ZXNDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcblxyXG4gICAgc2Nyb2xsYmFySGVpZ2h0JCA9IHRoaXMuc3RvcmUuY29udGFpbmVySGVpZ2h0JDtcclxuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTp2YXJpYWJsZS1uYW1lXHJcbiAgICBfb3B0aW9ucyQgPSB0aGlzLnN0b3JlLm9wdGlvbnMkO1xyXG4gICAgZGF0YSQgPSB0aGlzLnN0b3JlLmRhdGEkO1xyXG4gICAgcHJpdmF0ZSBfaGVpZ2h0OiBhbnk7XHJcbiAgICBjb25zdHJ1Y3RvcihwdWJsaWMgZWw6IEVsZW1lbnRSZWYsIHB1YmxpYyBzdG9yZTogRGF0YUxpc3RGYWNhZGVTZXJ2aWNlKSB7fVxyXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xyXG4gICAgICAgIGlmIChjaGFuZ2VzICYmIGNoYW5nZXMuZGF0YSAmJiAhY2hhbmdlcy5kYXRhLmlzRmlyc3RDaGFuZ2UoKSkge1xyXG4gICAgICAgICAgICB0aGlzLmluaXRDdHJsU3RhdGUoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChjaGFuZ2VzLnNlbGVjdGVkVmFsdWVzICYmICFjaGFuZ2VzLnNlbGVjdGVkVmFsdWVzLmlzRmlyc3RDaGFuZ2UoKSkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5zZWxlY3RlZFZhbHVlcyAhPT0gJycgJiYgdGhpcy5zZWxlY3RlZFZhbHVlcyAhPT0gdW5kZWZpbmVkICYmIHRoaXMuc2VsZWN0ZWRWYWx1ZXMgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc3RvcmUuc2V0U2VsZWN0aW9ucyh0aGlzLnNlbGVjdGVkVmFsdWVzLCB0aGlzLnNlcGFyYXRvcik7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsZWFyU2VsZWN0aW9ucygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuICAgIG5nT25Jbml0KCkge1xyXG4gICAgICAgIHRoaXMuX2hlaWdodCA9IHRoaXMuaGVpZ2h0O1xyXG4gICAgICAgIHRoaXMuaW5pdEN0cmxTdGF0ZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcclxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRWYWx1ZXMgJiYgdGhpcy5oZWlnaHQgIT09ICdhdXRvJykge1xyXG5cclxuICAgICAgICAgICAgICAgIGxldCB2YWwgPSB0aGlzLnNlbGVjdGVkVmFsdWVzO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRWYWx1ZXMuaW5kZXhPZih0aGlzLnNlcGFyYXRvcikgPiAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhbCA9IHRoaXMuc2VsZWN0ZWRWYWx1ZXMuaW5kZXhPZih0aGlzLnNlcGFyYXRvcilbMF07XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLmRhdGEuZmluZEluZGV4KG4gPT4gblt0aGlzLmlkRmllbGRdID09IHZhbCk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB1bEVsID0gdGhpcy5lbC5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ3VsLmxpc3QtZ3JvdXAnKTtcclxuICAgICAgICAgICAgICAgIGlmICh1bEVsLmNoaWxkcmVuW2luZGV4XSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHVsRWwuY2hpbGRyZW5baW5kZXhdLnNjcm9sbEludG9WaWV3KHtibG9jazogJ25lYXJlc3QnfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LCAxMCk7XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIGxvYWREYXRhKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmRhdGEpIHtcclxuICAgICAgICAgICAgdGhpcy5zdG9yZS5sb2FkRGF0YSh0aGlzLmRhdGEsIHRoaXMuc2VsZWN0ZWRWYWx1ZXMsIHRoaXMuc2VwYXJhdG9yKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBpbml0Q3RybFN0YXRlKCkge1xyXG4gICAgICAgIGNvbnN0IHsgdGl0bGUsIHRleHRGaWVsZCwgZml0LCBpZEZpZWxkLCB2YWx1ZUZpZWxkLCB3aWR0aCwgaGVpZ2h0LCBtdWx0aVNlbGVjdCwgZGlzYWJsZWQsIGhlYWRlckhlaWdodCwgc2VwYXJhdG9yIH0gPSB7XHJcbiAgICAgICAgICAgIC4uLnRoaXNcclxuICAgICAgICB9O1xyXG4gICAgICAgIHRoaXMuc3RvcmUuaW5pdFN0YXRlKHtcclxuICAgICAgICAgICAgdGl0bGUsXHJcbiAgICAgICAgICAgIHRleHRGaWVsZCxcclxuICAgICAgICAgICAgdmFsdWVGaWVsZCxcclxuICAgICAgICAgICAgZml0LFxyXG4gICAgICAgICAgICBpZEZpZWxkLFxyXG4gICAgICAgICAgICB3aWR0aCxcclxuICAgICAgICAgICAgaGVpZ2h0LFxyXG4gICAgICAgICAgICBtdWx0aVNlbGVjdCxcclxuICAgICAgICAgICAgZGlzYWJsZWQsXHJcbiAgICAgICAgICAgIGhlYWRlckhlaWdodCxcclxuICAgICAgICAgICAgc2VwYXJhdG9yXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMubG9hZERhdGEoKTtcclxuICAgIH1cclxuXHJcbiAgICBjbGVhclNlbGVjdGlvbnMoKSB7XHJcbiAgICAgICAgdGhpcy5zdG9yZS5jbGVhclNlbGVjdGlvbnMoKTtcclxuICAgIH1cclxuXHJcbiAgICByZXNpemUoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZml0KSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IHRoaXMuZWwubmF0aXZlRWxlbWVudC5wYXJlbnRFbGVtZW50O1xyXG4gICAgICAgICAgICBjb25zdCB3aWR0aCA9IGNvbnRhaW5lci5vZmZzZXRXaWR0aDtcclxuICAgICAgICAgICAgY29uc3QgaGVpZ2h0ID0gY29udGFpbmVyLm9mZnNldEhlaWdodDtcclxuICAgICAgICAgICAgdGhpcy5zdG9yZS51cGRhdGVDb250YWluZXJTaXplKHdpZHRoLCBoZWlnaHQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHVwZGF0ZVNlbGVjdFZhbHVlcygpIHtcclxuICAgICAgICB0aGlzLnNlbGVjdGVkVmFsdWVzID0gdGhpcy5zdG9yZS5nZXRTZWxlY3Rpb25zKCkubWFwKGl0ZW0gPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gaXRlbVt0aGlzLnZhbHVlRmllbGRdO1xyXG4gICAgICAgIH0pLmpvaW4odGhpcy5zZXBhcmF0b3IpO1xyXG4gICAgICAgIHRoaXMuc2VsZWN0ZWRWYWx1ZXNDaGFuZ2UuZW1pdCh0aGlzLnNlbGVjdGVkVmFsdWVzKTtcclxuICAgIH1cclxuXHJcbiAgICBvblNlbGVjdEhhbmRsZXIoZXZlbnQ6IEV2ZW50LCBpbmRleDogbnVtYmVyLCBpdGVtOiBGYXJyaXNEYXRhSXRlbSkge1xyXG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgIGlmICh0aGlzLmRpc2FibGVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgeyBkYXRhIH0gPSB7IC4uLml0ZW0gfTtcclxuXHJcbiAgICAgICAgaWYgKCF0aGlzLnN0b3JlLmlzU2VsZWN0KGl0ZW0uaWQpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc3RvcmUuc2VsZWN0SXRlbShkYXRhLCBpbmRleCk7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlU2VsZWN0VmFsdWVzKCk7XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWQuZW1pdCh7IGluZGV4LCBkYXRhIH0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmVuYWJsZUNhbmNlbFNlbGVjdGVkKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnN0b3JlLnVuU2VsZWN0SXRlbShkYXRhKTtcclxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlU2VsZWN0VmFsdWVzKCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnVuU2VsZWN0ZWQuZW1pdCh7IGluZGV4LCBkYXRhIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgb25DaGVja2VkQ2hhbmdlKCRldmVudCkge1xyXG4gICAgICAgIGNvbnN0IHsgaW5kZXgsIHJvdywgb3JpZ2luYWxFdmVudCB9ID0gJGV2ZW50O1xyXG4gICAgICAgIHRoaXMub25TZWxlY3RIYW5kbGVyKG9yaWdpbmFsRXZlbnQsIGluZGV4LCByb3cpO1xyXG4gICAgfVxyXG4gICAgaXNDaGVja2VkKGl0ZW06IEZhcnJpc0RhdGFJdGVtKSB7XHJcbiAgICAgICAgbGV0IHZhbCA9IHRoaXMuc2VsZWN0ZWRWYWx1ZXM7XHJcbiAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRWYWx1ZXMgPT09IG51bGwgJiYgdGhpcy5zZWxlY3RlZFZhbHVlcyA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHZhbCA9ICcnO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHR5cGVvZiB2YWwgPT09ICdib29sZWFuJykge1xyXG4gICAgICAgICAgICB2YWwgPSAnJyArIHZhbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh2YWwpIHtcclxuICAgICAgICAgICAgbGV0IF92YWxzID0gW107XHJcbiAgICAgICAgICAgIGlmICh0aGlzLm11bHRpU2VsZWN0KSB7XHJcbiAgICAgICAgICAgICAgICBfdmFscyA9IHZhbC5zcGxpdCh0aGlzLnNlcGFyYXRvcik7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBfdmFscyA9IFt2YWxdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBfdmFscy5zb21lKCB2ID0+IHYgPT0gICcnICsgaXRlbS5kYXRhW3RoaXMudmFsdWVGaWVsZF0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgaXNTZWxlY3RlZChpdGVtOiBGYXJyaXNEYXRhSXRlbSkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmlzQ2hlY2tlZChpdGVtKTtcclxuICAgIH1cclxuXHJcbiAgICBzZWxlY3RBbGwoKSB7XHJcbiAgICAgICAgdGhpcy5zZWxlY3RlZFZhbHVlcyA9IHRoaXMuZGF0YS5tYXAoaXRlbSA9PiBpdGVtW3RoaXMudmFsdWVGaWVsZF0pLmpvaW4odGhpcy5zZXBhcmF0b3IpO1xyXG4gICAgICAgIHRoaXMuc3RvcmUuc2VsZWN0QWxsKCk7XHJcbiAgICB9XHJcblxyXG4gICAgdW5TZWxlY3RBbGwoKSB7XHJcbiAgICAgICAgdGhpcy5zZWxlY3RlZFZhbHVlcyA9ICcnO1xyXG4gICAgICAgIHRoaXMuc3RvcmUuY2xlYXJTZWxlY3Rpb25zKCk7XHJcbiAgICB9XHJcbn1cclxuXHJcbkBEaXJlY3RpdmUoe1xyXG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOmRpcmVjdGl2ZS1zZWxlY3RvclxyXG4gICAgc2VsZWN0b3I6ICdbZmFycmlzdC1kYXRhbGlzdC1pdGVtXSdcclxufSlcclxuZXhwb3J0IGNsYXNzIERhdGFMaXN0SXRlbUNvbXBvbmVudERpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uSW5pdCB7XHJcbiAgICBASW5wdXQoJ2ZhcnJpc3QtZGF0YWxpc3QtaXRlbScpIGRhdGE6IEZhcnJpc0RhdGFJdGVtO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgZWw6IEVsZW1lbnRSZWYpIHt9XHJcbiAgICBuZ09uSW5pdCgpIHt9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiDooajkvZNjaGVja2JveCDnu4Tku7ZcclxuICovXHJcbkBDb21wb25lbnQoe1xyXG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOmNvbXBvbmVudC1zZWxlY3RvclxyXG4gICAgc2VsZWN0b3I6ICdkbC1jaGVja2JveCcsXHJcbiAgICB0ZW1wbGF0ZTogYFxyXG4gICAgICAgIDxkaXYgY2xhc3M9XCJjdXN0b20tY29udHJvbCBjdXN0b20tY2hlY2tib3ggIGN1c3RvbS1jb250cm9sLWlubGluZSBkbC1jaGVja2JveFwiPlxyXG4gICAgICAgICAgICA8aW5wdXQgdHlwZT1cImNoZWNrYm94XCIgI2NoayBjbGFzcz1cImN1c3RvbS1jb250cm9sLWlucHV0XCIgW2Rpc2FibGVkXT1cImRpc2FibGVkXCIgW2NoZWNrZWRdPVwiY2hlY2tlZFwiIC8+XHJcbiAgICAgICAgICAgIDxsYWJlbCBjbGFzcz1cImN1c3RvbS1jb250cm9sLWxhYmVsXCIgKGNsaWNrKT1cImhhbmRsZUNsaWNrKCRldmVudClcIj48L2xhYmVsPlxyXG4gICAgICAgIDwvZGl2PlxyXG4gICAgYCxcclxuICAgIHN0eWxlczogW1xyXG4gICAgICAgIGBcclxuICAgICAgICAgICAgOmhvc3QgLmN1c3RvbS1jaGVja2JveCB7XHJcbiAgICAgICAgICAgICAgICBvcGFjaXR5OiAxO1xyXG4gICAgICAgICAgICAgICAgZmxvYXQ6IG5vbmU7XHJcbiAgICAgICAgICAgICAgICBtYXJnaW46IDA7XHJcbiAgICAgICAgICAgICAgICB2ZXJ0aWNhbC1hbGlnbjogdG9wO1xyXG4gICAgICAgICAgICAgICAgcGFkZGluZy1yaWdodDogMHB4O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgYFxyXG4gICAgXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgRGF0YUxpc3RDaGVja2JveENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XHJcbiAgICBASW5wdXQoKSBjaGVja2VkOiBib29sZWFuO1xyXG4gICAgQElucHV0KCkgZGlzYWJsZWQ6IGJvb2xlYW47XHJcbiAgICBASW5wdXQoKSBpbmRleDogbnVtYmVyO1xyXG4gICAgQElucHV0KCkgcm93OiBhbnk7XHJcbiAgICBAT3V0cHV0KCkgY2hlY2tlZENoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuXHJcbiAgICBAVmlld0NoaWxkKCdjaGsnKSBjaGs6IEVsZW1lbnRSZWY7XHJcblxyXG4gICAgY29uc3RydWN0b3IoKSB7fVxyXG5cclxuICAgIG5nT25Jbml0KCkge31cclxuXHJcbiAgICBoYW5kbGVDbGljayhldmVudCkge1xyXG4gICAgICAgIHRoaXMuY2hlY2tlZCA9ICF0aGlzLmNoZWNrZWQ7XHJcbiAgICAgICAgdGhpcy5jaGVja2VkQ2hhbmdlLmVtaXQoeyBvcmlnaW5hbEV2ZW50OiBldmVudCwgaW5kZXg6IHRoaXMuaW5kZXgsIHJvdzogdGhpcy5yb3csIHN0YXRlOiB0aGlzLmNoZWNrZWQgfSk7XHJcbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICB9XHJcbn1cclxuIl19