/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Injectable } from '@angular/core';
import { ColumnFormatService } from '@farris/ui-common/column';
import * as i0 from "@angular/core";
var CommonUtils = /** @class */ (function () {
    function CommonUtils() {
        this.cfs = null;
        if (!this.cfs) {
            this.cfs = new ColumnFormatService(null, null);
        }
    }
    /**
     * 获取对象中指定字段的值。 field: 可以为带有层级结构的路径，如： user.firstName | name 等
     * data: 获取字段的数据源，一般为JSON对象
     * safe: 为true, 将html字符进行转码输出，默认为 false
     */
    /**
     * 获取对象中指定字段的值。 field: 可以为带有层级结构的路径，如： user.firstName | name 等
     * data: 获取字段的数据源，一般为JSON对象
     * safe: 为true, 将html字符进行转码输出，默认为 false
     * @param {?} field
     * @param {?} data
     * @param {?=} safe
     * @return {?}
     */
    CommonUtils.prototype.getValue = /**
     * 获取对象中指定字段的值。 field: 可以为带有层级结构的路径，如： user.firstName | name 等
     * data: 获取字段的数据源，一般为JSON对象
     * safe: 为true, 将html字符进行转码输出，默认为 false
     * @param {?} field
     * @param {?} data
     * @param {?=} safe
     * @return {?}
     */
    function (field, data, safe) {
        if (safe === void 0) { safe = false; }
        if (!data) {
            return '';
        }
        /** @type {?} */
        var resultVal = '';
        if (field.indexOf('.') === -1 && data.hasOwnProperty(field)) {
            resultVal = data[field];
        }
        else {
            resultVal = field.split('.').reduce((/**
             * @param {?} obj
             * @param {?} key
             * @return {?}
             */
            function (obj, key) {
                if (obj) {
                    return obj[key];
                }
                else {
                    return null;
                }
            }), data);
        }
        if (safe) {
            return this.formatterValue(resultVal);
        }
        else {
            return resultVal;
        }
    };
    /**
     * 更新指定对象中某个字段的值
     * @param obj 被更新对象
     * @param field 被更新字段
     * @param val 新值
     * @param nest 是否为嵌套，默认为 true
     */
    /**
     * 更新指定对象中某个字段的值
     * @param {?} obj 被更新对象
     * @param {?} field 被更新字段
     * @param {?} val 新值
     * @param {?=} nest 是否为嵌套，默认为 true
     * @return {?}
     */
    CommonUtils.prototype.setValue = /**
     * 更新指定对象中某个字段的值
     * @param {?} obj 被更新对象
     * @param {?} field 被更新字段
     * @param {?} val 新值
     * @param {?=} nest 是否为嵌套，默认为 true
     * @return {?}
     */
    function (obj, field, val, nest) {
        if (nest === void 0) { nest = true; }
        if (field) {
            if (field.indexOf('.') > -1 && nest) {
                /** @type {?} */
                var lastObj_1 = null;
                /** @type {?} */
                var _fields = field.split('.');
                _fields.reduce((/**
                 * @param {?} c
                 * @param {?} p
                 * @return {?}
                 */
                function (c, p) {
                    lastObj_1 = c;
                    return c[p];
                }), obj);
                if (lastObj_1) {
                    lastObj_1[_fields.pop()] = val;
                }
            }
            else {
                obj[field] = val;
            }
        }
    };
    /**
     * @param {?} value
     * @param {?} enumData
     * @param {?} valueField
     * @return {?}
     */
    CommonUtils.prototype.getEnumItem = /**
     * @param {?} value
     * @param {?} enumData
     * @param {?} valueField
     * @return {?}
     */
    function (value, enumData, valueField) {
        /** @type {?} */
        var item = enumData.find((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n[valueField] == value; }));
        return item;
    };
    /**
     * @private
     * @param {?} value
     * @param {?} col
     * @return {?}
     */
    CommonUtils.prototype._getEnumTitleFromColumn = /**
     * @private
     * @param {?} value
     * @param {?} col
     * @return {?}
     */
    function (value, col) {
        /** @type {?} */
        var _col = (/** @type {?} */ (col));
        /** @type {?} */
        var formatter = (/** @type {?} */ (_col.formatter));
        if (formatter && typeof formatter === 'object') {
            if (formatter.type === 'enum' && formatter.options) {
                return this.getEnumTitleFromColumnOptions(value, formatter.options);
            }
        }
        return value;
    };
    /**
     * @param {?} col
     * @param {?} data
     * @return {?}
     */
    CommonUtils.prototype.getEnumTitle = /**
     * @param {?} col
     * @param {?} data
     * @return {?}
     */
    function (col, data) {
        /** @type {?} */
        var val = this.getValue(col.field, data);
        return this._getEnumTitleFromColumn(val, col);
    };
    /**
     * @param {?} value
     * @param {?} opts
     * @return {?}
     */
    CommonUtils.prototype.getEnumTitleFromColumnOptions = /**
     * @param {?} value
     * @param {?} opts
     * @return {?}
     */
    function (value, opts) {
        var data = opts.data, valueField = opts.valueField, textField = opts.textField;
        /** @type {?} */
        var item = this.getEnumItem(value, data, valueField);
        if (item) {
            return item[textField];
        }
        else {
            return value;
        }
    };
    /**
     * @param {?} str
     * @return {?}
     */
    CommonUtils.prototype.escapeHtml = /**
     * @param {?} str
     * @return {?}
     */
    function (str) {
        if (str === null || str === undefined) {
            return '';
        }
        return str
            .replace(/&/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;')
            .replace(/\"/g, '&quot;')
            .replace(/\'/g, '&#39;')
            .replace(/\//g, '&#x2F;');
    };
    /**
     * @param {?} str
     * @return {?}
     */
    CommonUtils.prototype.unescapeHtml = /**
     * @param {?} str
     * @return {?}
     */
    function (str) {
        if (str === null || str === undefined) {
            return '';
        }
        return str
            .replace(/&amp;/g, '&')
            .replace(/&lt;/g, '<')
            .replace(/&gt;/g, '>')
            .replace(/&quot;/g, '"')
            .replace(/&#39;/g, '\'')
            .replace(/&#x2F;/g, '/');
    };
    /**
     * @private
     * @param {?} val
     * @return {?}
     */
    CommonUtils.prototype.formatterValue = /**
     * @private
     * @param {?} val
     * @return {?}
     */
    function (val) {
        if (val === null || val === undefined || val === '') {
            return '';
        }
        if (typeof val === 'string') {
            return this.escapeHtml(val);
        }
        return val;
    };
    /** 获取字符串在页面中的真实宽度 */
    /**
     * 获取字符串在页面中的真实宽度
     * @param {?} txt
     * @param {?} font
     * @return {?}
     */
    CommonUtils.prototype.getTextWidth = /**
     * 获取字符串在页面中的真实宽度
     * @param {?} txt
     * @param {?} font
     * @return {?}
     */
    function (txt, font) {
        // const frag = document.createDocumentFragment();
        /** @type {?} */
        var canvas = document.createElement('canvas');
        /** @type {?} */
        var context = canvas.getContext('2d');
        context.font = font;
        /** @type {?} */
        var metrics = context.measureText(txt);
        return Math.round(metrics.width);
    };
    /**
     * @param {?} id
     * @return {?}
     */
    CommonUtils.prototype.removeStyleSheet = /**
     * @param {?} id
     * @return {?}
     */
    function (id) {
        /** @type {?} */
        var styleElement = document.querySelector('#' + id);
        if (styleElement) {
            styleElement.remove();
        }
    };
    /**
     * @param {?} styleSheetId
     * @return {?}
     */
    CommonUtils.prototype.createStyleSheet = /**
     * @param {?} styleSheetId
     * @return {?}
     */
    function (styleSheetId) {
        /** @type {?} */
        var htmlHead = document.querySelector('head');
        /** @type {?} */
        var styleEleId = styleSheetId;
        /** @type {?} */
        var styleElement = null;
        if (document.querySelector('#' + styleEleId)) {
            styleElement = document.querySelector('#' + styleEleId);
            styleElement.innerText = '';
        }
        else {
            styleElement = document.createElement('style');
            styleElement.id = styleEleId;
            htmlHead.appendChild(styleElement);
        }
        return styleElement;
    };
    /**
     * @param {?} styleSheetId
     * @return {?}
     */
    CommonUtils.prototype.getStyleSheet = /**
     * @param {?} styleSheetId
     * @return {?}
     */
    function (styleSheetId) {
        var e_1, _a;
        /** @type {?} */
        var styleSheets = (/** @type {?} */ (document.styleSheets));
        /** @type {?} */
        var styleSheet = null;
        try {
            for (var styleSheets_1 = tslib_1.__values(styleSheets), styleSheets_1_1 = styleSheets_1.next(); !styleSheets_1_1.done; styleSheets_1_1 = styleSheets_1.next()) {
                var stylesheet = styleSheets_1_1.value;
                if ((stylesheet.ownerNode || stylesheet['owningElement']).id === styleSheetId) {
                    styleSheet = stylesheet;
                    break;
                }
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (styleSheets_1_1 && !styleSheets_1_1.done && (_a = styleSheets_1.return)) _a.call(styleSheets_1);
            }
            finally { if (e_1) throw e_1.error; }
        }
        return styleSheet;
    };
    /**
     * @param {?} rules
     * @param {?} styleSheet
     * @return {?}
     */
    CommonUtils.prototype.appendCssRules = /**
     * @param {?} rules
     * @param {?} styleSheet
     * @return {?}
     */
    function (rules, styleSheet) {
        var e_2, _a;
        try {
            for (var rules_1 = tslib_1.__values(rules), rules_1_1 = rules_1.next(); !rules_1_1.done; rules_1_1 = rules_1.next()) {
                var rule = rules_1_1.value;
                /** @type {?} */
                var ruleName = rule.slice(0, rule.indexOf('{'));
                /** @type {?} */
                var removedCssRule = this.removeCssRule(ruleName, styleSheet);
                if (styleSheet.addRule) {
                    /** @type {?} */
                    var cssText = '';
                    if (removedCssRule) {
                        cssText += removedCssRule.cssText.slice(removedCssRule.cssText.indexOf('{') + 1, removedCssRule.cssText.indexOf('}'));
                    }
                    cssText += rule.slice(rule.indexOf('{') + 1, rule.indexOf('}')).replace(/"/g, '').replace(/,/g, ';') + ';';
                    styleSheet.addRule(ruleName, cssText, 0);
                }
                else {
                    styleSheet.insertRule(rule, 0);
                }
            }
        }
        catch (e_2_1) { e_2 = { error: e_2_1 }; }
        finally {
            try {
                if (rules_1_1 && !rules_1_1.done && (_a = rules_1.return)) _a.call(rules_1);
            }
            finally { if (e_2) throw e_2.error; }
        }
    };
    /**
     * @param {?} ruleName
     * @param {?} styleSheet
     * @return {?}
     */
    CommonUtils.prototype.getCssRule = /**
     * @param {?} ruleName
     * @param {?} styleSheet
     * @return {?}
     */
    function (ruleName, styleSheet) {
        var e_3, _a;
        /** @type {?} */
        var cssRules = (/** @type {?} */ ((styleSheet.cssRules || styleSheet.rules)));
        /** @type {?} */
        var r = null;
        try {
            for (var cssRules_1 = tslib_1.__values(cssRules), cssRules_1_1 = cssRules_1.next(); !cssRules_1_1.done; cssRules_1_1 = cssRules_1.next()) {
                var rule = cssRules_1_1.value;
                if (rule.selectorText == ruleName) {
                    r = rule;
                }
            }
        }
        catch (e_3_1) { e_3 = { error: e_3_1 }; }
        finally {
            try {
                if (cssRules_1_1 && !cssRules_1_1.done && (_a = cssRules_1.return)) _a.call(cssRules_1);
            }
            finally { if (e_3) throw e_3.error; }
        }
        return r;
    };
    /**
     * @param {?} ruleName
     * @param {?} styleSheet
     * @return {?}
     */
    CommonUtils.prototype.removeCssRule = /**
     * @param {?} ruleName
     * @param {?} styleSheet
     * @return {?}
     */
    function (ruleName, styleSheet) {
        /** @type {?} */
        var cssRules = (/** @type {?} */ ((styleSheet.cssRules || styleSheet.rules)));
        /** @type {?} */
        var ii = 0;
        /** @type {?} */
        var cssRule = false;
        do {
            cssRule = cssRules[ii];
            if (cssRule) {
                if (cssRule.selectorText.toLowerCase() == ruleName.toLowerCase()) {
                    if (styleSheet.cssRules) {
                        styleSheet.deleteRule(ii);
                    }
                    else {
                        styleSheet.removeRule(ii);
                    }
                    return cssRule;
                }
            }
            ii++;
        } while (cssRule);
    };
    /**
     * @param {?} val
     * @return {?}
     */
    CommonUtils.prototype.isNullOrUndefined = /**
     * @param {?} val
     * @return {?}
     */
    function (val) {
        return val === null || val === undefined;
    };
    /**
     * @return {?}
     */
    CommonUtils.prototype.isIE = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var uA = window.navigator.userAgent;
        return /msie\s|trident\/|edge\//i.test(uA) && !!('uniqueID' in document || 'documentMode' in document || ('ActiveXObject' in window) || 'MSInputMethodContext' in window);
    };
    /**
     * @param {?} sorts
     * @return {?}
     */
    CommonUtils.prototype.buildSortString = /**
     * @param {?} sorts
     * @return {?}
     */
    function (sorts) {
        return this.cfs.buildSortString(sorts);
    };
    /**
     * @param {?} conditions
     * @return {?}
     */
    CommonUtils.prototype.buildSqlWhere = /**
     * @param {?} conditions
     * @return {?}
     */
    function (conditions) {
        return this.cfs.buildSqlWhere(conditions);
    };
    /**
     * @return {?}
     */
    CommonUtils.prototype.getBrowserType = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var ua = navigator.userAgent.toLowerCase();
        // 获取用户端信息
        /** @type {?} */
        var info = {
            ie: /msie/.test(ua) && !/opera/.test(ua),
            //  匹配IE浏览器
            op: /opera/.test(ua),
            //  匹配Opera浏览器
            sa: /version.*safari/.test(ua),
            // 匹配Safari浏览器
            ch: /chrome/.test(ua),
            //  匹配Chrome浏览器
            ff: /gecko/.test(ua) && !/webkit/.test(ua) // 匹配Firefox浏览器
        };
        return info;
    };
    /**
     * @return {?}
     */
    CommonUtils.prototype.getFFVer = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var ua = navigator.userAgent;
        /** @type {?} */
        var b = ua.indexOf('Firefox/');
        if (b < 0) {
            return 0;
        }
        return parseFloat(ua.substring(b + 8, ua.lastIndexOf('\.')));
    };
    CommonUtils.decorators = [
        { type: Injectable, args: [{
                    providedIn: 'root'
                },] }
    ];
    /** @nocollapse */
    CommonUtils.ctorParameters = function () { return []; };
    /** @nocollapse */ CommonUtils.ngInjectableDef = i0.defineInjectable({ factory: function CommonUtils_Factory() { return new CommonUtils(); }, token: CommonUtils, providedIn: "root" });
    return CommonUtils;
}());
export { CommonUtils };
if (false) {
    /**
     * @type {?}
     * @private
     */
    CommonUtils.prototype.cfs;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tbW9uLnV0aWxzLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1jb21tb24vIiwic291cmNlcyI6WyJsaWIvY29tbW9uLnV0aWxzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBWSxNQUFNLGVBQWUsQ0FBQztBQUNyRCxPQUFPLEVBQWtELG1CQUFtQixFQUFFLE1BQU0sMEJBQTBCLENBQUM7O0FBRS9HO0lBS0k7UUFEUSxRQUFHLEdBQXdCLElBQUksQ0FBQztRQUVwQyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRTtZQUNYLElBQUksQ0FBQyxHQUFHLEdBQUcsSUFBSSxtQkFBbUIsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7U0FDbEQ7SUFDTCxDQUFDO0lBRUQ7Ozs7T0FJRzs7Ozs7Ozs7OztJQUNILDhCQUFROzs7Ozs7Ozs7SUFBUixVQUFTLEtBQWEsRUFBRSxJQUFTLEVBQUUsSUFBWTtRQUFaLHFCQUFBLEVBQUEsWUFBWTtRQUMzQyxJQUFJLENBQUMsSUFBSSxFQUFFO1lBQ1AsT0FBUSxFQUFFLENBQUM7U0FDZDs7WUFDRyxTQUFTLEdBQUcsRUFBRTtRQUNsQixJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksSUFBSSxDQUFDLGNBQWMsQ0FBQyxLQUFLLENBQUMsRUFBRTtZQUN6RCxTQUFTLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1NBQzNCO2FBQU07WUFDSCxTQUFTLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxNQUFNOzs7OztZQUFDLFVBQUMsR0FBRyxFQUFFLEdBQUc7Z0JBQ3pDLElBQUksR0FBRyxFQUFFO29CQUNMLE9BQU8sR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO2lCQUNuQjtxQkFBTTtvQkFDSCxPQUFPLElBQUksQ0FBQztpQkFDZjtZQUNMLENBQUMsR0FBRSxJQUFJ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QUUsSUFBSSxDQUFDLEVBQUUsQ0FBQzs7WUFDM0MsRUFBRSxFQUFHLE9BQU8sQ0FBRSxJQUFJLENBQUMsRUFBRSxDQUFDOztZQUN0QixFQUFFLEVBQUcsaUJBQWlCLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQzs7WUFDL0IsRUFBRSxFQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDOztZQUN0QixFQUFFLEVBQUcsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUUsZUFBZTtTQUMvRDtRQUVELE9BQU8sSUFBSSxDQUFDO0lBQ2hCLENBQUM7Ozs7SUFHRCw4QkFBUTs7O0lBQVI7O1lBQ1UsRUFBRSxHQUFHLFNBQVMsQ0FBQyxTQUFTOztZQUN4QixDQUFDLEdBQUcsRUFBRSxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUM7UUFDaEMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFO1lBQ1AsT0FBTyxDQUFDLENBQUM7U0FDWjtRQUNELE9BQU8sVUFBVSxDQUFFLEVBQUUsQ0FBQyxTQUFTLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNsRSxDQUFDOztnQkEvUUosVUFBVSxTQUFDO29CQUNSLFVBQVUsRUFBRSxNQUFNO2lCQUNyQjs7Ozs7c0JBTEQ7Q0FxUkMsQUFsUkQsSUFrUkM7U0EvUVksV0FBVzs7Ozs7O0lBQ3BCLDBCQUF3QyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIE9wdGlvbmFsIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IERhdGFDb2x1bW4sIENvbHVtbkZvcm1hdHRlciwgRW51bUZvcm1hdE9wdGlvbnMsIENvbHVtbkZvcm1hdFNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWNvbW1vbi9jb2x1bW4nO1xyXG5cclxuQEluamVjdGFibGUoe1xyXG4gICAgcHJvdmlkZWRJbjogJ3Jvb3QnXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBDb21tb25VdGlscyB7XHJcbiAgICBwcml2YXRlIGNmczogQ29sdW1uRm9ybWF0U2VydmljZSA9IG51bGw7XHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICBpZiAoIXRoaXMuY2ZzKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2ZzID0gbmV3IENvbHVtbkZvcm1hdFNlcnZpY2UobnVsbCwgbnVsbCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6I635Y+W5a+56LGh5Lit5oyH5a6a5a2X5q6155qE5YC844CCIGZpZWxkOiDlj6/ku6XkuLrluKbmnInlsYLnuqfnu5PmnoTnmoTot6/lvoTvvIzlpoLvvJogdXNlci5maXJzdE5hbWUgfCBuYW1lIOetiVxyXG4gICAgICogZGF0YTog6I635Y+W5a2X5q6155qE5pWw5o2u5rqQ77yM5LiA6Iis5Li6SlNPTuWvueixoVxyXG4gICAgICogc2FmZTog5Li6dHJ1ZSwg5bCGaHRtbOWtl+espui/m+ihjOi9rOeggei+k+WHuu+8jOm7mOiupOS4uiBmYWxzZVxyXG4gICAgICovXHJcbiAgICBnZXRWYWx1ZShmaWVsZDogc3RyaW5nLCBkYXRhOiBhbnksIHNhZmUgPSBmYWxzZSkge1xyXG4gICAgICAgIGlmICghZGF0YSkge1xyXG4gICAgICAgICAgICByZXR1cm4gICcnO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgcmVzdWx0VmFsID0gJyc7XHJcbiAgICAgICAgaWYgKGZpZWxkLmluZGV4T2YoJy4nKSA9PT0gLTEgJiYgZGF0YS5oYXNPd25Qcm9wZXJ0eShmaWVsZCkpIHtcclxuICAgICAgICAgICAgcmVzdWx0VmFsID0gZGF0YVtmaWVsZF07XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmVzdWx0VmFsID0gZmllbGQuc3BsaXQoJy4nKS5yZWR1Y2UoKG9iaiwga2V5KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAob2JqKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9ialtrZXldO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgZGF0YSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoc2FmZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5mb3JtYXR0ZXJWYWx1ZShyZXN1bHRWYWwpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHRWYWw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5pu05paw5oyH5a6a5a+56LGh5Lit5p+Q5Liq5a2X5q6155qE5YC8XHJcbiAgICAgKiBAcGFyYW0gb2JqIOiiq+abtOaWsOWvueixoVxyXG4gICAgICogQHBhcmFtIGZpZWxkIOiiq+abtOaWsOWtl+autVxyXG4gICAgICogQHBhcmFtIHZhbCDmlrDlgLxcclxuICAgICAqIEBwYXJhbSBuZXN0IOaYr+WQpuS4uuW1jOWll++8jOm7mOiupOS4uiB0cnVlXHJcbiAgICAgKi9cclxuICAgIHNldFZhbHVlKG9iajogeyBba2V5OiBzdHJpbmddOiBhbnkgfSwgZmllbGQ6IHN0cmluZywgdmFsOiBhbnksIG5lc3QgPSB0cnVlKSB7XHJcbiAgICAgICAgaWYgKGZpZWxkKSB7XHJcbiAgICAgICAgICAgIGlmIChmaWVsZC5pbmRleE9mKCcuJykgPiAtMSAmJiBuZXN0KSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgbGFzdE9iaiA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBfZmllbGRzID0gZmllbGQuc3BsaXQoJy4nKTtcclxuICAgICAgICAgICAgICAgIF9maWVsZHMucmVkdWNlKCAoYywgcCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGxhc3RPYmogPSBjO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjW3BdO1xyXG4gICAgICAgICAgICAgICAgfSwgb2JqKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAobGFzdE9iaikge1xyXG4gICAgICAgICAgICAgICAgICAgIGxhc3RPYmpbX2ZpZWxkcy5wb3AoKV0gPSB2YWw7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBvYmpbZmllbGRdID0gdmFsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldEVudW1JdGVtKHZhbHVlOiBhbnksIGVudW1EYXRhOiBhbnlbXSwgdmFsdWVGaWVsZCkge1xyXG4gICAgICAgIGNvbnN0IGl0ZW0gPSBlbnVtRGF0YS5maW5kKG4gPT4gblt2YWx1ZUZpZWxkXSA9PSB2YWx1ZSk7XHJcbiAgICAgICAgcmV0dXJuIGl0ZW07XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfZ2V0RW51bVRpdGxlRnJvbUNvbHVtbih2YWx1ZTogYW55LCBjb2w6IGFueSkge1xyXG4gICAgICAgIGNvbnN0IF9jb2wgPSBjb2wgYXMgRGF0YUNvbHVtbjtcclxuICAgICAgICBjb25zdCBmb3JtYXR0ZXIgPSBfY29sLmZvcm1hdHRlciBhcyBDb2x1bW5Gb3JtYXR0ZXI7XHJcbiAgICAgICAgaWYgKGZvcm1hdHRlciAmJiB0eXBlb2YgZm9ybWF0dGVyID09PSAnb2JqZWN0Jykge1xyXG4gICAgICAgICAgICBpZiAoZm9ybWF0dGVyLnR5cGUgPT09ICdlbnVtJyAmJiBmb3JtYXR0ZXIub3B0aW9ucykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0RW51bVRpdGxlRnJvbUNvbHVtbk9wdGlvbnModmFsdWUsIGZvcm1hdHRlci5vcHRpb25zKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0RW51bVRpdGxlKGNvbDogRGF0YUNvbHVtbiwgZGF0YTogYW55ICkge1xyXG4gICAgICAgIGNvbnN0IHZhbCA9IHRoaXMuZ2V0VmFsdWUoY29sLmZpZWxkLCBkYXRhKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5fZ2V0RW51bVRpdGxlRnJvbUNvbHVtbih2YWwsIGNvbCk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0RW51bVRpdGxlRnJvbUNvbHVtbk9wdGlvbnModmFsdWU6IGFueSwgb3B0czogYW55KSB7XHJcbiAgICAgICAgY29uc3QgeyBkYXRhLCB2YWx1ZUZpZWxkLCB0ZXh0RmllbGQgfSA9IG9wdHM7XHJcbiAgICAgICAgY29uc3QgaXRlbSA9IHRoaXMuZ2V0RW51bUl0ZW0odmFsdWUsIGRhdGEsIHZhbHVlRmllbGQpO1xyXG4gICAgICAgIGlmIChpdGVtKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBpdGVtW3RleHRGaWVsZF07XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBlc2NhcGVIdG1sKHN0cikge1xyXG4gICAgICAgIGlmIChzdHIgPT09IG51bGwgfHwgc3RyID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuICAnJztcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHN0clxyXG4gICAgICAgIC5yZXBsYWNlKC8mL2csICcmYW1wOycpXHJcbiAgICAgICAgLnJlcGxhY2UoLzwvZywgJyZsdDsnKVxyXG4gICAgICAgIC5yZXBsYWNlKC8+L2csICcmZ3Q7JylcclxuICAgICAgICAucmVwbGFjZSgvXFxcIi9nLCAnJnF1b3Q7JylcclxuICAgICAgICAucmVwbGFjZSgvXFwnL2csICcmIzM5OycpXHJcbiAgICAgICAgLnJlcGxhY2UoL1xcLy9nLCAnJiN4MkY7Jyk7XHJcbiAgICB9XHJcblxyXG4gICAgdW5lc2NhcGVIdG1sKHN0cikge1xyXG4gICAgICAgIGlmIChzdHIgPT09IG51bGwgfHwgc3RyID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuICAnJztcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHN0clxyXG4gICAgICAgIC5yZXBsYWNlKC8mYW1wOy9nLCAnJicpXHJcbiAgICAgICAgLnJlcGxhY2UoLyZsdDsvZywgJzwnKVxyXG4gICAgICAgIC5yZXBsYWNlKC8mZ3Q7L2csICc+JylcclxuICAgICAgICAucmVwbGFjZSgvJnF1b3Q7L2csICdcIicpXHJcbiAgICAgICAgLnJlcGxhY2UoLyYjMzk7L2csICdcXCcnKVxyXG4gICAgICAgIC5yZXBsYWNlKC8mI3gyRjsvZywgJy8nKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgcHJpdmF0ZSBmb3JtYXR0ZXJWYWx1ZSh2YWw6IGFueSkge1xyXG4gICAgICAgIGlmICh2YWwgPT09IG51bGwgfHwgdmFsID09PSB1bmRlZmluZWQgfHwgdmFsID09PSAnJykge1xyXG4gICAgICAgICAgICByZXR1cm4gJyc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodHlwZW9mIHZhbCA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZXNjYXBlSHRtbCh2YWwpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHZhbDtcclxuICAgIH1cclxuXHJcbiAgICAvKiog6I635Y+W5a2X56ym5Liy5Zyo6aG16Z2i5Lit55qE55yf5a6e5a695bqmICovXHJcbiAgICBnZXRUZXh0V2lkdGgodHh0OiBzdHJpbmcsIGZvbnQpIHtcclxuICAgICAgICAvLyBjb25zdCBmcmFnID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xyXG4gICAgICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpO1xyXG4gICAgICAgIGNvbnN0IGNvbnRleHQgPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcclxuICAgICAgICBjb250ZXh0LmZvbnQgPSBmb250O1xyXG4gICAgICAgIGNvbnN0IG1ldHJpY3MgPSBjb250ZXh0Lm1lYXN1cmVUZXh0KHR4dCk7XHJcbiAgICAgICAgcmV0dXJuIE1hdGgucm91bmQobWV0cmljcy53aWR0aCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVtb3ZlU3R5bGVTaGVldChpZDogc3RyaW5nKSB7XHJcbiAgICAgICAgY29uc3Qgc3R5bGVFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignIycgKyBpZCk7XHJcbiAgICAgICAgaWYgKHN0eWxlRWxlbWVudCkge1xyXG4gICAgICAgICAgICBzdHlsZUVsZW1lbnQucmVtb3ZlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZVN0eWxlU2hlZXQoc3R5bGVTaGVldElkOiBzdHJpbmcpOiBIVE1MU3R5bGVFbGVtZW50IHtcclxuICAgICAgICBjb25zdCBodG1sSGVhZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2hlYWQnKTtcclxuXHJcbiAgICAgICAgY29uc3Qgc3R5bGVFbGVJZCA9IHN0eWxlU2hlZXRJZDtcclxuICAgICAgICBsZXQgc3R5bGVFbGVtZW50ID0gbnVsbDtcclxuICAgICAgICBpZiAoZG9jdW1lbnQucXVlcnlTZWxlY3RvcignIycgKyBzdHlsZUVsZUlkKSkge1xyXG4gICAgICAgICAgICBzdHlsZUVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjJyArIHN0eWxlRWxlSWQpO1xyXG4gICAgICAgICAgICBzdHlsZUVsZW1lbnQuaW5uZXJUZXh0ID0gJyc7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgc3R5bGVFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3R5bGUnKTtcclxuICAgICAgICAgICAgc3R5bGVFbGVtZW50LmlkID0gc3R5bGVFbGVJZDtcclxuICAgICAgICAgICAgaHRtbEhlYWQuYXBwZW5kQ2hpbGQoc3R5bGVFbGVtZW50KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBzdHlsZUVsZW1lbnQ7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0U3R5bGVTaGVldChzdHlsZVNoZWV0SWQpIHtcclxuICAgICAgICBjb25zdCBzdHlsZVNoZWV0cyA9IGRvY3VtZW50LnN0eWxlU2hlZXRzIGFzIGFueTtcclxuICAgICAgICBsZXQgc3R5bGVTaGVldCA9IG51bGw7XHJcbiAgICAgICAgZm9yIChjb25zdCBzdHlsZXNoZWV0IG9mIHN0eWxlU2hlZXRzKSB7XHJcbiAgICAgICAgICAgIGlmICgoc3R5bGVzaGVldC5vd25lck5vZGUgfHwgc3R5bGVzaGVldFsnb3duaW5nRWxlbWVudCddKS5pZCA9PT0gc3R5bGVTaGVldElkKSB7XHJcbiAgICAgICAgICAgICAgICBzdHlsZVNoZWV0ID0gc3R5bGVzaGVldDtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gc3R5bGVTaGVldDtcclxuICAgIH1cclxuXHJcbiAgICBhcHBlbmRDc3NSdWxlcyhydWxlczogc3RyaW5nW10sIHN0eWxlU2hlZXQpIHtcclxuICAgICAgICBmb3IgKGNvbnN0IHJ1bGUgb2YgcnVsZXMpIHtcclxuICAgICAgICAgICAgY29uc3QgcnVsZU5hbWUgPSBydWxlLnNsaWNlKDAsIHJ1bGUuaW5kZXhPZigneycpKTtcclxuICAgICAgICAgICAgY29uc3QgcmVtb3ZlZENzc1J1bGUgPSB0aGlzLnJlbW92ZUNzc1J1bGUocnVsZU5hbWUsIHN0eWxlU2hlZXQpO1xyXG4gICAgICAgICAgICBpZiAoc3R5bGVTaGVldC5hZGRSdWxlKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgY3NzVGV4dCA9ICcnO1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlbW92ZWRDc3NSdWxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY3NzVGV4dCArPSByZW1vdmVkQ3NzUnVsZS5jc3NUZXh0LnNsaWNlKHJlbW92ZWRDc3NSdWxlLmNzc1RleHQuaW5kZXhPZigneycpICsgMSwgcmVtb3ZlZENzc1J1bGUuY3NzVGV4dC5pbmRleE9mKCd9JykpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY3NzVGV4dCArPSBydWxlLnNsaWNlKHJ1bGUuaW5kZXhPZigneycpICsgMSwgcnVsZS5pbmRleE9mKCd9JykpLnJlcGxhY2UoL1wiL2csICcnKS5yZXBsYWNlKC8sL2csICc7JykgKyAnOyc7XHJcbiAgICAgICAgICAgICAgICBzdHlsZVNoZWV0LmFkZFJ1bGUocnVsZU5hbWUsIGNzc1RleHQsIDApO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgc3R5bGVTaGVldC5pbnNlcnRSdWxlKHJ1bGUsIDApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldENzc1J1bGUocnVsZU5hbWU6IHN0cmluZywgc3R5bGVTaGVldCkge1xyXG4gICAgICAgIGNvbnN0IGNzc1J1bGVzID0gKHN0eWxlU2hlZXQuY3NzUnVsZXMgfHwgc3R5bGVTaGVldC5ydWxlcykgYXMgYW55O1xyXG4gICAgICAgIGxldCByID0gbnVsbDtcclxuICAgICAgICBmb3IgKGNvbnN0IHJ1bGUgb2YgY3NzUnVsZXMpIHtcclxuICAgICAgICAgICAgaWYgKHJ1bGUuc2VsZWN0b3JUZXh0ID09IHJ1bGVOYW1lKSB7XHJcbiAgICAgICAgICAgICAgICByID0gcnVsZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHI7XHJcbiAgICB9XHJcblxyXG4gICAgcmVtb3ZlQ3NzUnVsZShydWxlTmFtZTogc3RyaW5nLCBzdHlsZVNoZWV0ICkge1xyXG4gICAgICAgIGNvbnN0IGNzc1J1bGVzID0gKHN0eWxlU2hlZXQuY3NzUnVsZXMgfHwgc3R5bGVTaGVldC5ydWxlcykgYXMgYW55O1xyXG4gICAgICAgIGxldCBpaSA9IDA7XHJcbiAgICAgICAgbGV0IGNzc1J1bGU6IGFueSA9IGZhbHNlO1xyXG4gICAgICAgIGRvIHtcclxuICAgICAgICAgICAgY3NzUnVsZSA9IGNzc1J1bGVzW2lpXTtcclxuICAgICAgICAgICAgaWYgKGNzc1J1bGUpIHtcclxuICAgICAgICAgICAgICAgIGlmIChjc3NSdWxlLnNlbGVjdG9yVGV4dC50b0xvd2VyQ2FzZSgpID09IHJ1bGVOYW1lLnRvTG93ZXJDYXNlKCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc3R5bGVTaGVldC5jc3NSdWxlcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHlsZVNoZWV0LmRlbGV0ZVJ1bGUoaWkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlU2hlZXQucmVtb3ZlUnVsZShpaSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3NzUnVsZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpaSsrO1xyXG4gICAgICAgIH0gd2hpbGUgKGNzc1J1bGUpO1xyXG4gICAgfVxyXG5cclxuICAgIGlzTnVsbE9yVW5kZWZpbmVkKHZhbDogYW55KSB7XHJcbiAgICAgICAgcmV0dXJuIHZhbCA9PT0gbnVsbCB8fCB2YWwgPT09IHVuZGVmaW5lZDtcclxuICAgIH1cclxuXHJcbiAgICBpc0lFKCkge1xyXG4gICAgICAgIGNvbnN0IHVBID0gd2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQ7XHJcbiAgICAgICAgcmV0dXJuIC9tc2llXFxzfHRyaWRlbnRcXC98ZWRnZVxcLy9pLnRlc3QodUEpICYmICEhKCd1bmlxdWVJRCcgaW4gZG9jdW1lbnQgfHwgJ2RvY3VtZW50TW9kZScgaW4gZG9jdW1lbnQgfHwgKCdBY3RpdmVYT2JqZWN0JyBpbiB3aW5kb3cpIHx8ICdNU0lucHV0TWV0aG9kQ29udGV4dCcgaW4gd2luZG93KTtcclxuICAgIH1cclxuXHJcbiAgICBidWlsZFNvcnRTdHJpbmcoc29ydHM6IGFueVtdKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jZnMuYnVpbGRTb3J0U3RyaW5nKHNvcnRzKTtcclxuICAgIH1cclxuXHJcbiAgICBidWlsZFNxbFdoZXJlKGNvbmRpdGlvbnM6IGFueVtdKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jZnMuYnVpbGRTcWxXaGVyZShjb25kaXRpb25zKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRCcm93c2VyVHlwZSgpIHtcclxuICAgICAgICBjb25zdCB1YSA9IG5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKTsgIC8vIOiOt+WPlueUqOaIt+err+S/oeaBr1xyXG4gICAgICAgIGNvbnN0IGluZm8gPSB7XHJcbiAgICAgICAgICAgIGllIDogL21zaWUvIC50ZXN0KHVhKSAmJiAhL29wZXJhLyAudGVzdCh1YSksICAvLyAg5Yy56YWNSUXmtY/op4jlmahcclxuICAgICAgICAgICAgb3AgOiAvb3BlcmEvIC50ZXN0KHVhKSwgIC8vICDljLnphY1PcGVyYea1j+iniOWZqFxyXG4gICAgICAgICAgICBzYSA6IC92ZXJzaW9uLipzYWZhcmkvLnRlc3QodWEpLCAgLy8g5Yy56YWNU2FmYXJp5rWP6KeI5ZmoXHJcbiAgICAgICAgICAgIGNoIDogL2Nocm9tZS8udGVzdCh1YSksICAvLyAg5Yy56YWNQ2hyb21l5rWP6KeI5ZmoXHJcbiAgICAgICAgICAgIGZmIDogL2dlY2tvLy50ZXN0KHVhKSAmJiAhL3dlYmtpdC8udGVzdCh1YSkgIC8vIOWMuemFjUZpcmVmb3jmtY/op4jlmahcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4gaW5mbztcclxuICAgIH1cclxuXHJcblxyXG4gICAgZ2V0RkZWZXIoKSB7XHJcbiAgICAgICAgY29uc3QgdWEgPSBuYXZpZ2F0b3IudXNlckFnZW50O1xyXG4gICAgICAgIGNvbnN0IGIgPSB1YS5pbmRleE9mKCdGaXJlZm94LycpO1xyXG4gICAgICAgIGlmIChiIDwgMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHBhcnNlRmxvYXQgKHVhLnN1YnN0cmluZyhiICsgOCwgdWEubGFzdEluZGV4T2YoJ1xcLicpKSk7XHJcbiAgICB9XHJcblxyXG5cclxufVxyXG4iXX0=