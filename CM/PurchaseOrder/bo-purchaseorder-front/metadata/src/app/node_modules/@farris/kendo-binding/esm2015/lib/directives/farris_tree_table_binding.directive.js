/*
 * @Author: aalizzwell
 * @Date: 2020-02-27 11:33:41
 * @Last Modified by: aalizzwell
 * @Last Modified time: 2020-02-27 11:34:16
 */
// tslint:disable: no-string-literal
import { Directive, Input, HostListener, Output, EventEmitter } from '@angular/core';
import { FrameContext, ChangeType } from '@farris/devkit';
import { TreeTableComponent } from '@farris/ui-treetable';
import { Subject } from 'rxjs';
import { debounceTime } from 'rxjs/operators';
import { FarrisTreetableFormatService } from '../format/index';
import { TreeNodeBuilderFactory } from './tree_table_node_builder/tree_node_builder_factory';
/**
 * 树表格绑定指令
 */
class FarrisTreeTableBindingDirective {
    /**
     * 构造函数
     */
    constructor(treeTable, treetableFormatSer, frameContext) {
        this.treeTable = treeTable;
        this.treetableFormatSer = treetableFormatSer;
        this.frameContext = frameContext;
        this.renderSubject = new Subject();
        /**
         * 启用节点分页
         */
        // @Input('enableNodePagination')
        // public enableNodePagination: boolean;
        /**
         * 节点分页大小
         */
        this.nodePageSize = 100;
        /* 设置行样式 */
        this.rowClass = new EventEmitter();
        /* 设置列样式 */
        this.cellClass = new EventEmitter();
        this._PROP = null;
        this.listeners = [];
        this.storage = [];
        this.viewModel.uiState.setPropertyValue('ids', this.treeTable.checkValues);
        this.renderSubject.pipe(debounceTime(500)).subscribe(() => {
            this.bindData();
        });
    }
    /**
     * 绑定数据
     */
    get bindingData() {
        return this.frameContext.bindingData;
    }
    /**
     * 绑定数据列表
     */
    get bindingList() {
        // @todo：只支持主表，没有处理bindingPath
        return this.bindingData.list;
    }
    get prop() {
        return this._PROP;
    }
    set prop(value) {
        this._PROP = value;
    }
    /**
     * 获取当前vm
     */
    get viewModel() {
        return this.frameContext.viewModel;
    }
    /**
     * 指令初始化
     */
    ngOnInit() {
        // 将分级码信息保存到root-component，而非整个表单的app-context
        const virtualRootFrameContext = this.frameContext.getVirtualRootFrameContext();
        virtualRootFrameContext.setParam('hierarchyInfoKey', this.hierarchyInfoKey);
        this.bindData();
        this.bindingData.changes.subscribe((change) => {
            if (change && (change.type === ChangeType.ValueChanged || change.type === ChangeType.PaginationInfoChange)) {
                this.renderSubject.next(change);
            }
            else {
                this.bindData();
            }
            // 设置当前行
            const currentId = this.bindingList.currentId;
            if (!this.frameContext.bindingData.rowSelectedEventSuspend && currentId) {
                this.setSelectedIdToTree(this.bindingList.currentId);
            }
            this.updateCheckedRows(change);
        });
        // 设置 树表 格式化
        this.treetableFormatSer.setFormat(this.treeTable);
        /* 行样式 */
        this.rowClass.emit(this.treeTable);
        /* 列样式  单元格样式 */
        this.cellClass.emit(this.treeTable);
        this.setComponentRef();
        this.setNodePaginationInfo();
        this.registerEvent();
    }
    /**
     * 指令输入变更
     */
    ngOnChanges(changes) {
    }
    registerEvent() {
        this.treeTable.columnSorted.subscribe((event) => {
            const { sortName = null, sortOrder = null } = event;
            const remoteSort = this.treeTable.remoteSort;
            if (remoteSort === false) {
                if (sortName && sortOrder) {
                    this.bindingList.sortBy(sortName, sortOrder);
                }
            }
            this.bindData();
        });
    }
    /**
     * 收集树组件实例
     */
    setComponentRef() {
        const appContext = this.viewModel && this.viewModel.frameContext && this.viewModel.frameContext.getFormAppContext();
        const frameId = this.viewModel && this.viewModel.frameContext && this.viewModel.frameContext.frameId;
        const id = this.treeTable && this.treeTable.el.nativeElement.id || null;
        // 如果frameId不存在或treetable没有id属性，说明不符合使用场景
        if (!frameId || !id) {
            return;
        }
        const map = appContext && appContext.componentRefs && appContext.componentRefs.get(frameId) || new Map();
        appContext && appContext.componentRefs && appContext.componentRefs.set(frameId, map.set(id, this.treeTable));
    }
    setNodePaginationInfo() {
        if (this.frameContext) {
            const enableNodePagination = this.treeTable.paginationForChildren || false; //this.enableNodePagination || false;
            this.frameContext.params.set('enableNodePagination', enableNodePagination);
            const nodePageSize = this.nodePageSize || 0;
            this.frameContext.params.set('nodePageSize', nodePageSize);
        }
    }
    /**
     * 绑定数据
     */
    bindData() {
        const oldTreeNodes = this.treeTable.data;
        const treeNodesData = this.bindingList.toJSON({ ignoreMultiLangInput: true });
        // if (!this.shouldComponentUpdate(treeNodesData)) {
        //   return;
        // }
        this.prop = treeNodesData;
        let treeNodes = [];
        if (!!treeNodesData && treeNodesData.length > 0) {
            const hierarchyInfo = treeNodesData[0][this.hierarchyInfoKey];
            let builder = this.builder;
            if (!builder) {
                this.builder = TreeNodeBuilderFactory.getBuilder(hierarchyInfo);
                builder = this.builder;
            }
            // 服务器返回的分级节点信息匹配不到现有工厂里面的任何一种情况。确认新加的builder已经在工厂中注册
            if (builder == null) {
                throw new Error('TreeTable builder is null!');
            }
            let expandLevel = -1;
            const treeExpandLevel = this.treeTable['expandLevel'];
            if (typeof treeExpandLevel !== 'undefined') {
                expandLevel = treeExpandLevel;
            }
            const virtualRootFrameContext = this.frameContext.getVirtualRootFrameContext();
            const nodesShouldExpand = (virtualRootFrameContext.params.get('_DEVKIT_expandRowIds') || '').split(',') || [];
            const context = {
                expandLevel,
                addTreeLoadCompleteListener: this.addTreeLoadCompleteListener.bind(this),
                component: this.treeTable,
                storage: this.storage,
                nodesShouldExpand: nodesShouldExpand,
                frameContext: this.frameContext,
            };
            //if (!this.treeNodesBuilder) {
            this.treeNodesBuilder = new builder(treeNodesData, oldTreeNodes, this.bindingList.primaryKey, this.hierarchyInfoKey, context);
            //}
            // this.treeNodesBuilder.updateTreeNode(treeNodesData, oldTreeNodes);
            treeNodes = this.treeNodesBuilder.build();
        }
        this.treeTable.data = treeNodes;
        // 设置分页信息
        this.updatePageInfo(this.treeTable);
        this.onTreeLoadComplete();
    }
    onTreeLoadComplete() {
        if (this.listeners && this.listeners.length > 0) {
            this.listeners.forEach(listener => {
                listener();
            });
        }
    }
    addTreeLoadCompleteListener(listener) {
        this.listeners.push(listener);
    }
    shouldComponentUpdate(newProp) {
        if (JSON.stringify(this.prop) === JSON.stringify(newProp)) {
            return false;
        }
        return true;
    }
    /**
     * 从树组件上获取选中行的id
     */
    getSelectedIdFromTree() {
        const selectedRow = this.treeTable.selectedRow;
        return selectedRow ? selectedRow.data['id'] : null;
    }
    /**
     * 设置TreeTable的当前行
     */
    setSelectedIdToTree(selectedId) {
        if (!selectedId) {
            return;
        }
        // 如果新的currentId和树上的selectedId不一致，重置树的当前行
        const oldSelectedId = this.getSelectedIdFromTree();
        const nodePageChanged = this.frameContext.params.get('_NODE_PAGE_CHANGED_') || false;
        if (!oldSelectedId && nodePageChanged) {
            this.frameContext.params.delete('_NODE_PAGE_CHANGED_');
            return;
        }
        if (oldSelectedId !== selectedId) {
            this.treeTable.clearSelections();
            this.treeTable.selectNode(selectedId);
        }
    }
    /**
     * 设置BindingList的CurrentId
     */
    setCurrentIdToBindingList(selectedId) {
        const oldCurrentId = this.bindingData.list.currentId;
        // 单选模式下将当前行设置到ids
        if (!this.treeTable.multiSelect) {
            this.setChecks(selectedId);
            this.setCheckedRows([selectedId]);
        }
        if (oldCurrentId === selectedId) {
            return;
        }
        this.bindingData.list.setCurrentId(selectedId, true);
    }
    updateCheckedRows(changes) {
        if (changes.type === ChangeType.Load) {
            this.setCheckedRows();
        }
        else if (changes.type === ChangeType.ValueChanged || changes.type === ChangeType.Remove) {
            const ids = this.getChecks();
            if (changes.id && ids.includes(changes.id)) {
                this.setCheckedRows();
            }
        }
    }
    /**
     * 更新勾选行数据
     */
    setCheckedRows(ids) {
        if (typeof ids === 'undefined') {
            ids = this.viewModel.uiState['ids'] || [];
        }
        if (!Array.isArray(ids)) {
            return;
        }
        const list = this.bindingList.toJSON();
        const rows = this.viewModel.uiState['rows'] || new Map();
        const result = new Map();
        ids.forEach((id) => {
            const item = list.find(item => item[this.bindingList.primaryKey] === id);
            const otherPageItem = rows.get(id);
            if (item) {
                result.set(id, item);
            }
            else if (otherPageItem) {
                result.set(id, otherPageItem);
            }
        });
        this.viewModel.uiState.setPropertyValue('rows', result);
    }
    /**
     * 设置ids变量
     * @param idOrIds id or ids
     */
    setChecks(idOrIds) {
        if (typeof idOrIds === 'string') {
            idOrIds = idOrIds.split(',').filter(p => p);
        }
        this.viewModel.uiState.setPropertyValue('ids', idOrIds);
    }
    /**
     * 获取勾选行id数组
     * @returns
     */
    getChecks() {
        return this.viewModel.uiState['ids'] || [];
    }
    /**
     * 获取分页信息
     */
    getPagingInfo() {
        const bindingPath = this.viewModel.bindingPath;
        const bindingData = this.viewModel.bindingData;
        let pagingInfo = bindingData.pagingInfo;
        if (bindingPath === '/') {
            return pagingInfo;
        }
        else {
            const bindingPaths = bindingPath.substr(1).split('/').filter(item => !!item && item.length > 0).map(item => {
                return item.substring(0, item.length - 1);
            });
            bindingPaths.forEach(path => {
                pagingInfo = pagingInfo && pagingInfo[path];
            });
            return pagingInfo;
        }
    }
    updatePageInfo(treeTable) {
        const { pageIndex, pageSize, total } = this.getPagingInfo();
        if (pageSize === 0) {
            treeTable.pagination = false;
            return;
        }
        treeTable.pagination = true;
        treeTable.updatePageInfo({ pageIndex, pageSize, total });
    }
    //#region 组件事件
    /**
     * 行切换
     */
    selectionChangeHandler(event) {
        if (event && event.node && event.node.hasOwnProperty('data')) {
            const idField = this.treeTable.idField;
            const id = event.node.data[idField];
            this.setCurrentIdToBindingList(id);
        }
    }
    /**
     * 勾选节点发生变化
     * @param event event
     */
    checkValuesChange(event) {
        // this.viewModel.uiState.setPropertyValue('ids', this.treeTable.checkValues);
        this.setChecks(this.treeTable.checkValues);
        this.setCheckedRows();
    }
    /**
     * 将被展开的节点设置为当前行
     */
    expandHandler(event) {
        const selectedId = event.data['id'];
        const virtualRootFrameContext = this.frameContext.getVirtualRootFrameContext();
        // 展开时不再选中
        // this.setSelectedIdToTree(selectedId);
        const expandNodes = virtualRootFrameContext.getParam('TREE_LATEST_EXPANDED_ID') || [];
        expandNodes.push(selectedId);
        virtualRootFrameContext.setParam('TREE_LATEST_EXPANDED_ID', expandNodes);
    }
    onPageChanged(event) {
        let { pageSize = 20, pageIndex = 1 } = event || {};
        if (pageIndex < 1) {
            pageIndex = 1;
        }
        const skip = (pageIndex - 1) * pageSize;
        this.bindingData.setPagingInfo(skip, pageSize, this.bindingData.bindingPath);
    }
    onPageSizeChanged(event) {
        const pageSize = event ? event : 20;
        const skip = 0;
        this.bindingData.setPagingInfo(skip, pageSize, this.bindingData.bindingPath);
    }
    /**
     * 节点页码切换事件
     * @param event event
     */
    onNodePageChanged(event) {
        const { pageIndex = 1, pageSize = this.nodePageSize, node = {} } = event;
        const id = node && node.id || null;
        if (id) {
            const virtualRootFrameContext = this.frameContext.getVirtualRootFrameContext();
            const expandNodes = virtualRootFrameContext.getParam('TREE_LATEST_EXPANDED_ID') || [];
            expandNodes.push(id);
            virtualRootFrameContext.setParam('TREE_LATEST_EXPANDED_ID', expandNodes);
            this.frameContext.params.set(`_NODE_${id}_PAGE_INDEX_`, pageIndex);
            this.frameContext.params.set(`_RELOAD_CHILDREN_`, true);
            this.frameContext.params.set('_NODE_PAGE_CHANGED_', true);
        }
    }
}
FarrisTreeTableBindingDirective.decorators = [
    { type: Directive, args: [{
                selector: '[farrisTreeTableBinding]'
            },] }
];
/** @nocollapse */
FarrisTreeTableBindingDirective.ctorParameters = () => [
    { type: TreeTableComponent },
    { type: FarrisTreetableFormatService },
    { type: FrameContext }
];
FarrisTreeTableBindingDirective.propDecorators = {
    hierarchyInfoKey: [{ type: Input, args: ['farrisHierarchyInfoKey',] }],
    rowClassName: [{ type: Input }],
    cellClassName: [{ type: Input }],
    nodePageSize: [{ type: Input, args: ['nodePageSize',] }],
    rowClass: [{ type: Output }],
    cellClass: [{ type: Output }],
    selectionChangeHandler: [{ type: HostListener, args: ['nodeSelected', ['$event'],] }],
    checkValuesChange: [{ type: HostListener, args: ['checkValuesChange', ['$event'],] }],
    expandHandler: [{ type: HostListener, args: ['expand', ['$event'],] }],
    onPageChanged: [{ type: HostListener, args: ['pageChanged', ['$event'],] }],
    onPageSizeChanged: [{ type: HostListener, args: ['pageSizeChanged', ['$event'],] }],
    onNodePageChanged: [{ type: HostListener, args: ['childsPageChanged', ['$event'],] }]
};
export { FarrisTreeTableBindingDirective };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmFycmlzX3RyZWVfdGFibGVfYmluZGluZy5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2tlbmRvLWJpbmRpbmcvIiwic291cmNlcyI6WyJsaWIvZGlyZWN0aXZlcy9mYXJyaXNfdHJlZV90YWJsZV9iaW5kaW5nLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7R0FLRztBQUNILG9DQUFvQztBQUVwQyxPQUFPLEVBQUUsU0FBUyxFQUFvQyxLQUFLLEVBQUUsWUFBWSxFQUFRLE1BQU0sRUFBRSxZQUFZLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDN0gsT0FBTyxFQUE0QixZQUFZLEVBQVUsVUFBVSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDNUYsT0FBTyxFQUFFLGtCQUFrQixFQUFZLE1BQU0sc0JBQXNCLENBQUM7QUFDcEUsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMvQixPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDOUMsT0FBTyxFQUFFLDRCQUE0QixFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDL0QsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0scURBQXFELENBQUM7QUFFN0Y7O0dBRUc7QUFDSCxNQUdNLCtCQUErQjtJQXVFbkM7O09BRUc7SUFDSCxZQUNVLFNBQTZCLEVBQzdCLGtCQUFnRCxFQUNoRCxZQUEwQjtRQUYxQixjQUFTLEdBQVQsU0FBUyxDQUFvQjtRQUM3Qix1QkFBa0IsR0FBbEIsa0JBQWtCLENBQThCO1FBQ2hELGlCQUFZLEdBQVosWUFBWSxDQUFjO1FBeEU1QixrQkFBYSxHQUFpQixJQUFJLE9BQU8sRUFBTyxDQUFDO1FBaUJ6RDs7V0FFRztRQUNILGlDQUFpQztRQUNqQyx3Q0FBd0M7UUFDeEM7O1dBRUc7UUFFSSxpQkFBWSxHQUFXLEdBQUcsQ0FBQztRQWtCbEMsV0FBVztRQUVYLGFBQVEsR0FBc0IsSUFBSSxZQUFZLEVB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WUFDbkUsSUFBSSxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLG1CQUFtQixFQUFFLElBQUksQ0FBQyxDQUFDO1lBQ3hELElBQUksQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxxQkFBcUIsRUFBRSxJQUFJLENBQUMsQ0FBQztTQUMzRDtJQUNILENBQUM7OztZQTNhRixTQUFTLFNBQUM7Z0JBQ1QsUUFBUSxFQUFFLDBCQUEwQjthQUNyQzs7OztZQVhRLGtCQUFrQjtZQUdsQiw0QkFBNEI7WUFKRixZQUFZOzs7K0JBeUI1QyxLQUFLLFNBQUMsd0JBQXdCOzJCQUk5QixLQUFLOzRCQUlMLEtBQUs7MkJBVUwsS0FBSyxTQUFDLGNBQWM7dUJBb0JwQixNQUFNO3dCQUlOLE1BQU07cUNBbVROLFlBQVksU0FBQyxjQUFjLEVBQUUsQ0FBQyxRQUFRLENBQUM7Z0NBWXZDLFlBQVksU0FBQyxtQkFBbUIsRUFBRSxDQUFDLFFBQVEsQ0FBQzs0QkFTNUMsWUFBWSxTQUFDLFFBQVEsRUFBRSxDQUFDLFFBQVEsQ0FBQzs0QkFVakMsWUFBWSxTQUFDLGFBQWEsRUFBRSxDQUFDLFFBQVEsQ0FBQztnQ0FTdEMsWUFBWSxTQUFDLGlCQUFpQixFQUFFLENBQUMsUUFBUSxDQUFDO2dDQVUxQyxZQUFZLFNBQUMsbUJBQW1CLEVBQUUsQ0FBQyxRQUFRLENBQUM7O0FBaUIvQyxPQUFPLEVBQUUsK0JBQStCLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXHJcbiAqIEBBdXRob3I6IGFhbGl6endlbGwgXHJcbiAqIEBEYXRlOiAyMDIwLTAyLTI3IDExOjMzOjQxIFxyXG4gKiBATGFzdCBNb2RpZmllZCBieTogYWFsaXp6d2VsbFxyXG4gKiBATGFzdCBNb2RpZmllZCB0aW1lOiAyMDIwLTAyLTI3IDExOjM0OjE2XHJcbiAqL1xyXG4vLyB0c2xpbnQ6ZGlzYWJsZTogbm8tc3RyaW5nLWxpdGVyYWxcclxuXHJcbmltcG9ydCB7IERpcmVjdGl2ZSwgT25Jbml0LCBPbkNoYW5nZXMsIFNpbXBsZUNoYW5nZXMsIElucHV0LCBIb3N0TGlzdGVuZXIsIFR5cGUsIE91dHB1dCwgRXZlbnRFbWl0dGVyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEJpbmRpbmdEYXRhLCBCaW5kaW5nTGlzdCwgRnJhbWVDb250ZXh0LCBDaGFuZ2UsIENoYW5nZVR5cGUgfSBmcm9tICdAZmFycmlzL2RldmtpdCc7XHJcbmltcG9ydCB7IFRyZWVUYWJsZUNvbXBvbmVudCwgVHJlZU5vZGUgfSBmcm9tICdAZmFycmlzL3VpLXRyZWV0YWJsZSc7XHJcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgZGVib3VuY2VUaW1lIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBGYXJyaXNUcmVldGFibGVGb3JtYXRTZXJ2aWNlIH0gZnJvbSAnLi4vZm9ybWF0L2luZGV4JztcclxuaW1wb3J0IHsgVHJlZU5vZGVCdWlsZGVyRmFjdG9yeSB9IGZyb20gJy4vdHJlZV90YWJsZV9ub2RlX2J1aWxkZXIvdHJlZV9ub2RlX2J1aWxkZXJfZmFjdG9yeSc7XHJcblxyXG4vKipcclxuICog5qCR6KGo5qC857uR5a6a5oyH5LukXHJcbiAqL1xyXG5ARGlyZWN0aXZlKHtcclxuICBzZWxlY3RvcjogJ1tmYXJyaXNUcmVlVGFibGVCaW5kaW5nXSdcclxufSlcclxuY2xhc3MgRmFycmlzVHJlZVRhYmxlQmluZGluZ0RpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzIHtcclxuICAvKipcclxuICAgKiDmoJHlrZjlgqjnqbrpl7RcclxuICAgKi9cclxuICBwcml2YXRlIHN0b3JhZ2U6IGFueTtcclxuICBwcml2YXRlIHJlbmRlclN1YmplY3Q6IFN1YmplY3Q8YW55PiA9IG5ldyBTdWJqZWN0PGFueT4oKTtcclxuICBwcml2YXRlIGJ1aWxkZXI6IFR5cGU8YW55PjtcclxuICBwcml2YXRlIHRyZWVOb2Rlc0J1aWxkZXI6IGFueTtcclxuICAvKipcclxuICAgKiDliIbnuqfnoIHkv6Hmga/nmoRrZXlcclxuICAgKi9cclxuICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IG5vLWlucHV0LXJlbmFtZVxyXG4gIEBJbnB1dCgnZmFycmlzSGllcmFyY2h5SW5mb0tleScpXHJcbiAgcHVibGljIGhpZXJhcmNoeUluZm9LZXk6IHN0cmluZztcclxuXHJcbiAgLyog6KGM5qC35byPICovXHJcbiAgQElucHV0KClcclxuICByb3dDbGFzc05hbWU6IChjb250ZXh0OiBhbnkpID0+IGFueTtcclxuXHJcbiAgLyog5YiX5ZKM5Y2V5YWD5qC85qC35byPICovXHJcbiAgQElucHV0KClcclxuICBjZWxsQ2xhc3NOYW1lOiAoZGF0YTogYW55LCBmaWVsZDogYW55KSA9PiBhbnk7XHJcbiAgLyoqXHJcbiAgICog5ZCv55So6IqC54K55YiG6aG1XHJcbiAgICovXHJcbiAgLy8gQElucHV0KCdlbmFibGVOb2RlUGFnaW5hdGlvbicpXHJcbiAgLy8gcHVibGljIGVuYWJsZU5vZGVQYWdpbmF0aW9uOiBib29sZWFuO1xyXG4gIC8qKlxyXG4gICAqIOiKgueCueWIhumhteWkp+Wwj1xyXG4gICAqL1xyXG4gIEBJbnB1dCgnbm9kZVBhZ2VTaXplJylcclxuICBwdWJsaWMgbm9kZVBhZ2VTaXplOiBudW1iZXIgPSAxMDA7XHJcbiAgLyoqXHJcbiAgICog57uR5a6a5pWw5o2uXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXQgYmluZGluZ0RhdGEoKTogQmluZGluZ0RhdGEge1xyXG4gICAgcmV0dXJuIHRoaXMuZnJhbWVDb250ZXh0LmJpbmRpbmdEYXRhO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog57uR5a6a5pWw5o2u5YiX6KGoXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXQgYmluZGluZ0xpc3QoKTogQmluZGluZ0xpc3Qge1xyXG5cclxuICAgIC8vIEB0b2Rv77ya5Y+q5pSv5oyB5Li76KGo77yM5rKh5pyJ5aSE55CGYmluZGluZ1BhdGhcclxuICAgIHJldHVybiB0aGlzLmJpbmRpbmdEYXRhLmxpc3Q7XHJcbiAgfVxyXG5cclxuXHJcbiAgLyog6K6+572u6KGM5qC35byPICovXHJcbiAgQE91dHB1dCgpXHJcbiAgcm93Q2xhc3M6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcblxyXG4gIC8qIOiuvue9ruWIl+agt+W8jyAqL1xyXG4gIEBPdXRwdXQoKVxyXG4gIGNlbGxDbGFzczogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuXHJcbiAgcHJpdmF0ZSBfUFJPUDogYW55ID0gbnVsbDtcclxuICBwcml2YXRlIGxpc3RlbmVyczogYW55W107XHJcbiAgcHJpdmF0ZSBnZXQgcHJvcCgpIHtcclxuICAgIHJldHVybiB0aGlzLl9QUk9QO1xyXG4gIH1cclxuICBwcml2YXRlIHNldCBwcm9wKHZhbHVlKSB7XHJcbiAgICB0aGlzLl9QUk9QID0gdmFsdWU7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluW9k+WJjXZtXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXQgdmlld01vZGVsKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuZnJhbWVDb250ZXh0LnZpZXdNb2RlbDtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5p6E6YCg5Ye95pWwXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIHRyZWVUYWJsZTogVHJlZVRhYmxlQ29tcG9uZW50LFxyXG4gICAgcHJpdmF0ZSB0cmVldGFibGVGb3JtYXRTZXI6IEZhcnJpc1RyZWV0YWJsZUZvcm1hdFNlcnZpY2UsXHJcbiAgICBwcml2YXRlIGZyYW1lQ29udGV4dDogRnJhbWVDb250ZXh0XHJcbiAgKSB7XHJcbiAgICB0aGlzLmxpc3RlbmVycyA9IFtdO1xyXG4gICAgdGhpcy5zdG9yYWdlID0gW107XHJcbiAgICB0aGlzLnZpZXdNb2RlbC51aVN0YXRlLnNldFByb3BlcnR5VmFsdWUoJ2lkcycsIHRoaXMudHJlZVRhYmxlLmNoZWNrVmFsdWVzKTtcclxuICAgIHRoaXMucmVuZGVyU3ViamVjdC5waXBlKFxyXG4gICAgICBkZWJvdW5jZVRpbWUoNTAwKVxyXG4gICAgKS5zdWJzY3JpYmUoKCkgPT4ge1xyXG4gICAgICB0aGlzLmJpbmREYXRhKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmjIfku6TliJ3lp4vljJZcclxuICAgKi9cclxuICBuZ09uSW5pdCgpIHtcclxuICAgIC8vIOWwhuWIhue6p+eggeS/oeaBr+S/neWtmOWIsHJvb3QtY29tcG9uZW5077yM6ICM6Z2e5pW05Liq6KGo5Y2V55qEYXBwLWNvbnRleHRcclxuICAgIGNvbnN0IHZpcnR1YWxSb290RnJhbWVDb250ZXh0ID0gdGhpcy5mcmFtZUNvbnRleHQuZ2V0VmlydHVhbFJvb3RGcmFtZUNvbnRleHQoKTtcclxuICAgIHZpcnR1YWxSb290RnJhbWVDb250ZXh0LnNldFBhcmFtKCdoaWVyYXJjaHlJbmZvS2V5JywgdGhpcy5oaWVyYXJjaHlJbmZvS2V5KTtcclxuICAgIHRoaXMuYmluZERhdGEoKTtcclxuICAgIHRoaXMuYmluZGluZ0RhdGEuY2hhbmdlcy5zdWJzY3JpYmUoKGNoYW5nZTogQ2hhbmdlKSA9PiB7XHJcbiAgICAgIGlmIChjaGFuZ2UgJiYgKGNoYW5nZS50eXBlID09PSBDaGFuZ2VUeXBlLlZhbHVlQ2hhbmdlZCB8fCBjaGFuZ2UudHlwZSA9PT0gQ2hhbmdlVHlwZS5QYWdpbmF0aW9uSW5mb0NoYW5nZSkpIHtcclxuICAgICAgICB0aGlzLnJlbmRlclN1YmplY3QubmV4dChjaGFuZ2UpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMuYmluZERhdGEoKTtcclxuICAgICAgfVxyXG4gICAgICAvLyDorr7nva7lvZPliY3ooYxcclxuICAgICAgY29uc3QgY3VycmVudElkID0gdGhpcy5iaW5kaW5nTGlzdC5jdXJyZW50SWQ7XHJcbiAgICAgIGlmICghdGhpcy5mcmFtZUNvbnRleHQuYmluZGluZ0RhdGEucm93U2VsZWN0ZWRFdmVudFN1c3BlbmQgJiYgY3VycmVudElkKSB7XHJcbiAgICAgICAgdGhpcy5zZXRTZWxlY3RlZElkVG9UcmVlKHRoaXMuYmluZGluZ0xpc3QuY3VycmVudElkKTtcclxuICAgICAgfVxyXG4gICAgICB0aGlzLnVwZGF0ZUNoZWNrZWRSb3dzKGNoYW5nZSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyDorr7nva4g5qCR6KGoIOagvOW8j+WMllxyXG4gICAgdGhpcy50cmVldGFibGVGb3JtYXRTZXIuc2V0Rm9ybWF0KHRoaXMudHJlZVRhYmxlKTtcclxuXHJcbiAgICAvKiDooYzmoLflvI8gKi9cclxuICAgIHRoaXMucm93Q2xhc3MuZW1pdCh0aGlzLnRyZWVUYWJsZSk7XHJcblxyXG4gICAgLyog5YiX5qC35byPICDljZXlhYPmoLzmoLflvI8gKi9cclxuICAgIHRoaXMuY2VsbENsYXNzLmVtaXQodGhpcy50cmVlVGFibGUpO1xyXG4gICAgdGhpcy5zZXRDb21wb25lbnRSZWYoKTtcclxuICAgIHRoaXMuc2V0Tm9kZVBhZ2luYXRpb25JbmZvKCk7XHJcbiAgICB0aGlzLnJlZ2lzdGVyRXZlbnQoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaMh+S7pOi+k+WFpeWPmOabtFxyXG4gICAqL1xyXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcclxuICB9XHJcbiAgcHJpdmF0ZSByZWdpc3RlckV2ZW50KCkge1xyXG4gICAgdGhpcy50cmVlVGFibGUuY29sdW1uU29ydGVkLnN1YnNjcmliZSgoZXZlbnQ6IHsgc29ydE5hbWU6IHN0cmluZywgc29ydE9yZGVyOiBzdHJpbmcgfSkgPT4ge1xyXG4gICAgICBjb25zdCB7IHNvcnROYW1lID0gbnVsbCwgc29ydE9yZGVyID0gbnVsbCB9ID0gZXZlbnQ7XHJcbiAgICAgIGNvbnN0IHJlbW90ZVNvcnQgPSB0aGlzLnRyZWVUYWJsZS5yZW1vdGVTb3J0O1xyXG4gICAgICBpZiAocmVtb3RlU29ydCA9PT0gZmFsc2UpIHtcclxuICAgICAgICBpZiAoc29ydE5hbWUgJiYgc29ydE9yZGVyKSB7XHJcbiAgICAgICAgICB0aGlzLmJpbmRpbmdMaXN0LnNvcnRCeShzb3J0TmFtZSwgc29ydE9yZGVyKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5iaW5kRGF0YSgpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOaUtumbhuagkee7hOS7tuWunuS+i1xyXG4gICAqL1xyXG4gIHByaXZhdGUgc2V0Q29tcG9uZW50UmVmKCkge1xyXG4gICAgY29uc3QgYXBwQ29udGV4dCA9IHRoaXMudmlld01vZGVsICYmIHRoaXMudmlld01vZGVsLmZyYW1lQ29udGV4dCAmJiB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQuZ2V0Rm9ybUFwcENvbnRleHQoKTtcclxuICAgIGNvbnN0IGZyYW1lSWQgPSB0aGlzLnZpZXdNb2RlbCAmJiB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQgJiYgdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LmZyYW1lSWQ7XHJcbiAgICBjb25zdCBpZCA9IHRoaXMudHJlZVRhYmxlICYmIHRoaXMudHJlZVRhYmxlLmVsLm5hdGl2ZUVsZW1lbnQuaWQgfHwgbnVsbDtcclxuICAgIC8vIOWmguaenGZyYW1lSWTkuI3lrZjlnKjmiJZ0cmVldGFibGXmsqHmnIlpZOWxnuaAp++8jOivtOaYjuS4jeespuWQiOS9v+eUqOWcuuaZr1xyXG4gICAgaWYgKCFmcmFtZUlkIHx8ICFpZCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBjb25zdCBtYXAgPSBhcHBDb250ZXh0ICYmIGFwcENvbnRleHQuY29tcG9uZW50UmVmcyAmJiBhcHBDb250ZXh0LmNvbXBvbmVudFJlZnMuZ2V0KGZyYW1lSWQpIHx8IG5ldyBNYXA8c3RyaW5nLCBhbnk+KCk7XHJcbiAgICBhcHBDb250ZXh0ICYmIGFwcENvbnRleHQuY29tcG9uZW50UmVmcyAmJiBhcHBDb250ZXh0LmNvbXBvbmVudFJlZnMuc2V0KGZyYW1lSWQsIG1hcC5zZXQoaWQsIHRoaXMudHJlZVRhYmxlKSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHNldE5vZGVQYWdpbmF0aW9uSW5mbygpIHtcclxuICAgIGlmICh0aGlzLmZyYW1lQ29udGV4dCkge1xyXG4gICAgICBjb25zdCBlbmFibGVOb2RlUGFnaW5hdGlvbiA9IHRoaXMudHJlZVRhYmxlLnBhZ2luYXRpb25Gb3JDaGlsZHJlbiB8fCBmYWxzZTsvL3RoaXMuZW5hYmxlTm9kZVBhZ2luYXRpb24gfHwgZmFsc2U7XHJcbiAgICAgIHRoaXMuZnJhbWVDb250ZXh0LnBhcmFtcy5zZXQoJ2VuYWJsZU5vZGVQYWdpbmF0aW9uJywgZW5hYmxlTm9kZVBhZ2luYXRpb24pO1xyXG4gICAgICBjb25zdCBub2RlUGFnZVNpemUgPSB0aGlzLm5vZGVQYWdlU2l6ZSB8fCAwO1xyXG4gICAgICB0aGlzLmZyYW1lQ29udGV4dC5wYXJhbXMuc2V0KCdub2RlUGFnZVNpemUnLCBub2RlUGFnZVNpemUpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog57uR5a6a5pWw5o2uXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBiaW5kRGF0YSgpIHtcclxuICAgIGNvbnN0IG9sZFRyZWVOb2RlcyA9IHRoaXMudHJlZVRhYmxlLmRhdGE7XHJcbiAgICBjb25zdCB0cmVlTm9kZXNEYXRhID0gdGhpcy5iaW5kaW5nTGlzdC50b0pTT04oeyBpZ25vcmVNdWx0aUxhbmdJbnB1dDogdHJ1ZSB9KTtcclxuICAgIC8vIGlmICghdGhpcy5zaG91bGRDb21wb25lbnRVcGRhdGUodHJlZU5vZGVzRGF0YSkpIHtcclxuICAgIC8vICAgcmV0dXJuO1xyXG4gICAgLy8gfVxyXG4gICAgdGhpcy5wcm9wID0gdHJlZU5vZGVzRGF0YTtcclxuXHJcbiAgICBsZXQgdHJlZU5vZGVzOiBUcmVlTm9kZVtdID0gW107XHJcbiAgICBpZiAoISF0cmVlTm9kZXNEYXRhICYmIHRyZWVOb2Rlc0RhdGEubGVuZ3RoID4gMCkge1xyXG4gICAgICBjb25zdCBoaWVyYXJjaHlJbmZvID0gdHJlZU5vZGVzRGF0YVswXVt0aGlzLmhpZXJhcmNoeUluZm9LZXldO1xyXG4gICAgICBsZXQgYnVpbGRlcjogVHlwZTxhbnk+ID0gdGhpcy5idWlsZGVyO1xyXG4gICAgICBpZiAoIWJ1aWxkZXIpIHtcclxuICAgICAgICB0aGlzLmJ1aWxkZXIgPSBUcmVlTm9kZUJ1aWxkZXJGYWN0b3J5LmdldEJ1aWxkZXIoaGllcmFyY2h5SW5mbyk7XHJcbiAgICAgICAgYnVpbGRlciA9IHRoaXMuYnVpbGRlcjtcclxuICAgICAgfVxyXG4gICAgICAvLyDmnI3liqHlmajov5Tlm57nmoTliIbnuqfoioLngrnkv6Hmga/ljLnphY3kuI3liLDnjrDmnInlt6XljoLph4zpnaLnmoTku7vkvZXkuIDnp43mg4XlhrXjgILnoa7orqTmlrDliqDnmoRidWlsZGVy5bey57uP5Zyo5bel5Y6C5Lit5rOo5YaMXHJcbiAgICAgIGlmIChidWlsZGVyID09IG51bGwpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RyZWVUYWJsZSBidWlsZGVyIGlzIG51bGwhJyk7XHJcbiAgICAgIH1cclxuICAgICAgbGV0IGV4cGFuZExldmVsID0gLTE7XHJcbiAgICAgIGNvbnN0IHRyZWVFeHBhbmRMZXZlbCA9IHRoaXMudHJlZVRhYmxlWydleHBhbmRMZXZlbCddO1xyXG4gICAgICBpZiAodHlwZW9mIHRyZWVFeHBhbmRMZXZlbCAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgICBleHBhbmRMZXZlbCA9IHRyZWVFeHBhbmRMZXZlbDtcclxuICAgICAgfVxyXG4gICAgICBjb25zdCB2aXJ0dWFsUm9vdEZyYW1lQ29udGV4dCA9IHRoaXMuZnJhbWVDb250ZXh0LmdldFZpcnR1YWxSb290RnJhbWVDb250ZXh0KCk7XHJcbiAgICAgIGNvbnN0IG5vZGVzU2hvdWxkRXhwYW5kID0gKHZpcnR1YWxSb290RnJhbWVDb250ZXh0LnBhcmFtcy5nZXQoJ19ERVZLSVRfZXhwYW5kUm93SWRzJykgfHwgJycpLnNwbGl0KCcsJykgfHwgW107XHJcbiAgICAgIGNvbnN0IGNvbnRleHQgPSB7XHJcbiAgICAgICAgZXhwYW5kTGV2ZWwsXHJcbiAgICAgICAgYWRkVHJlZUxvYWRDb21wbGV0ZUxpc3RlbmVyOiB0aGlzLmFkZFRyZWVMb2FkQ29tcGxldGVMaXN0ZW5lci5iaW5kKHRoaXMpLFxyXG4gICAgICAgIGNvbXBvbmVudDogdGhpcy50cmVlVGFibGUsXHJcbiAgICAgICAgc3RvcmFnZTogdGhpcy5zdG9yYWdlLFxyXG4gICAgICAgIG5vZGVzU2hvdWxkRXhwYW5kOiBub2Rlc1Nob3VsZEV4cGFuZCxcclxuICAgICAgICBmcmFtZUNvbnRleHQ6IHRoaXMuZnJhbWVDb250ZXh0LFxyXG4gICAgICB9O1xyXG4gICAgICAvL2lmICghdGhpcy50cmVlTm9kZXNCdWlsZGVyKSB7XHJcbiAgICAgIHRoaXMudHJlZU5vZGVzQnVpbGRlciA9IG5ldyBidWlsZGVyKFxyXG4gICAgICAgIHRyZWVOb2Rlc0RhdGEsIG9sZFRyZWVOb2RlcyxcclxuICAgICAgICB0aGlzLmJpbmRpbmdMaXN0LnByaW1hcnlLZXksIHRoaXMuaGllcmFyY2h5SW5mb0tleSwgY29udGV4dFxyXG4gICAgICApO1xyXG4gICAgICAvL31cclxuICAgICAgLy8gdGhpcy50cmVlTm9kZXNCdWlsZGVyLnVwZGF0ZVRyZWVOb2RlKHRyZWVOb2Rlc0RhdGEsIG9sZFRyZWVOb2Rlcyk7XHJcbiAgICAgIHRyZWVOb2RlcyA9IHRoaXMudHJlZU5vZGVzQnVpbGRlci5idWlsZCgpO1xyXG4gICAgfVxyXG4gICAgdGhpcy50cmVlVGFibGUuZGF0YSA9IHRyZWVOb2RlcztcclxuICAgIC8vIOiuvue9ruWIhumhteS/oeaBr1xyXG4gICAgdGhpcy51cGRhdGVQYWdlSW5mbyh0aGlzLnRyZWVUYWJsZSk7XHJcbiAgICB0aGlzLm9uVHJlZUxvYWRDb21wbGV0ZSgpO1xyXG4gIH1cclxuICBwcml2YXRlIG9uVHJlZUxvYWRDb21wbGV0ZSgpIHtcclxuICAgIGlmICh0aGlzLmxpc3RlbmVycyAmJiB0aGlzLmxpc3RlbmVycy5sZW5ndGggPiAwKSB7XHJcbiAgICAgIHRoaXMubGlzdGVuZXJzLmZvckVhY2gobGlzdGVuZXIgPT4ge1xyXG4gICAgICAgIGxpc3RlbmVyKCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuICBwcml2YXRlIGFkZFRyZWVMb2FkQ29tcGxldGVMaXN0ZW5lcihsaXN0ZW5lcjogYW55KSB7XHJcbiAgICB0aGlzLmxpc3RlbmVycy5wdXNoKGxpc3RlbmVyKTtcclxuICB9XHJcbiAgcHJpdmF0ZSBzaG91bGRDb21wb25lbnRVcGRhdGUobmV3UHJvcDogYW55KSB7XHJcbiAgICBpZiAoSlNPTi5zdHJpbmdpZnkodGhpcy5wcm9wKSA9PT0gSlNPTi5zdHJpbmdpZnkobmV3UHJvcCkpIHtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRydWU7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOS7juagkee7hOS7tuS4iuiOt+WPlumAieS4reihjOeahGlkXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXRTZWxlY3RlZElkRnJvbVRyZWUoKTogc3RyaW5nIHtcclxuICAgIGNvbnN0IHNlbGVjdGVkUm93ID0gdGhpcy50cmVlVGFibGUuc2VsZWN0ZWRSb3c7XHJcbiAgICByZXR1cm4gc2VsZWN0ZWRSb3cgPyBzZWxlY3RlZFJvdy5kYXRhWydpZCddIDogbnVsbDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiuvue9rlRyZWVUYWJsZeeahOW9k+WJjeihjFxyXG4gICAqL1xyXG4gIHByaXZhdGUgc2V0U2VsZWN0ZWRJZFRvVHJlZShzZWxlY3RlZElkOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgIGlmICghc2VsZWN0ZWRJZCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICAvLyDlpoLmnpzmlrDnmoRjdXJyZW50SWTlkozmoJHkuIrnmoRzZWxlY3RlZElk5LiN5LiA6Ie077yM6YeN572u5qCR55qE5b2T5YmN6KGMXHJcbiAgICBjb25zdCBvbGRTZWxlY3RlZElkID0gdGhpcy5nZXRTZWxlY3RlZElkRnJvbVRyZWUoKTtcclxuICAgIGNvbnN0IG5vZGVQYWdlQ2hhbmdlZCA9IHRoaXMuZnJhbWVDb250ZXh0LnBhcmFtcy5nZXQoJ19OT0RFX1BBR0VfQ0hBTkdFRF8nKSB8fCBmYWxzZTtcclxuICAgIGlmICghb2xkU2VsZWN0ZWRJZCAmJiBub2RlUGFnZUNoYW5nZWQpIHtcclxuICAgICAgdGhpcy5mcmFtZUNvbnRleHQucGFyYW1zLmRlbGV0ZSgnX05PREVfUEFHRV9DSEFOR0VEXycpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAob2xkU2VsZWN0ZWRJZCAhPT0gc2VsZWN0ZWRJZCkge1xyXG4gICAgICB0aGlzLnRyZWVUYWJsZS5jbGVhclNlbGVjdGlvbnMoKTtcclxuICAgICAgdGhpcy50cmVlVGFibGUuc2VsZWN0Tm9kZShzZWxlY3RlZElkKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiuvue9rkJpbmRpbmdMaXN055qEQ3VycmVudElkXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzZXRDdXJyZW50SWRUb0JpbmRpbmdMaXN0KHNlbGVjdGVkSWQ6IHN0cmluZyk6IHZvaWQge1xyXG4gICAgY29uc3Qgb2xkQ3VycmVudElkID0gdGhpcy5iaW5kaW5nRGF0YS5saXN0LmN1cnJlbnRJZDtcclxuICAgIC8vIOWNlemAieaooeW8j+S4i+WwhuW9k+WJjeihjOiuvue9ruWIsGlkc1xyXG4gICAgaWYgKCF0aGlzLnRyZWVUYWJsZS5tdWx0aVNlbGVjdCkge1xyXG4gICAgICB0aGlzLnNldENoZWNrcyhzZWxlY3RlZElkKTtcclxuICAgICAgdGhpcy5zZXRDaGVja2VkUm93cyhbc2VsZWN0ZWRJZF0pO1xyXG4gICAgfVxyXG4gICAgaWYgKG9sZEN1cnJlbnRJZCA9PT0gc2VsZWN0ZWRJZCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB0aGlzLmJpbmRpbmdEYXRhLmxpc3Quc2V0Q3VycmVudElkKHNlbGVjdGVkSWQsIHRydWUpO1xyXG4gIH1cclxuICBwcml2YXRlIHVwZGF0ZUNoZWNrZWRSb3dzKGNoYW5nZXM6IENoYW5nZSkge1xyXG4gICAgaWYgKGNoYW5nZXMudHlwZSA9PT0gQ2hhbmdlVHlwZS5Mb2FkKSB7XHJcbiAgICAgIHRoaXMuc2V0Q2hlY2tlZFJvd3MoKTtcclxuICAgIH0gZWxzZSBpZiAoY2hhbmdlcy50eXBlID09PSBDaGFuZ2VUeXBlLlZhbHVlQ2hhbmdlZCB8fCBjaGFuZ2VzLnR5cGUgPT09IENoYW5nZVR5cGUuUmVtb3ZlKSB7XHJcbiAgICAgIGNvbnN0IGlkcyA9IHRoaXMuZ2V0Q2hlY2tzKCk7XHJcbiAgICAgIGlmIChjaGFuZ2VzLmlkICYmIGlkcy5pbmNsdWRlcyhjaGFuZ2VzLmlkKSkge1xyXG4gICAgICAgIHRoaXMuc2V0Q2hlY2tlZFJvd3MoKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuICAvKipcclxuICAgKiDmm7TmlrDli77pgInooYzmlbDmja5cclxuICAgKi9cclxuICBwcm90ZWN0ZWQgc2V0Q2hlY2tlZFJvd3MoaWRzPzogc3RyaW5nW10pIHtcclxuICAgIGlmICh0eXBlb2YgaWRzID09PSAndW5kZWZpbmVkJykge1xyXG4gICAgICBpZHMgPSB0aGlzLnZpZXdNb2RlbC51aVN0YXRlWydpZHMnXSB8fCBbXTtcclxuICAgIH1cclxuICAgIGlmICghQXJyYXkuaXNBcnJheShpZHMpKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGNvbnN0IGxpc3QgPSB0aGlzLmJpbmRpbmdMaXN0LnRvSlNPTigpO1xyXG4gICAgY29uc3Qgcm93czogTWFwPHN0cmluZywgYW55PiA9IHRoaXMudmlld01vZGVsLnVpU3RhdGVbJ3Jvd3MnXSB8fCBuZXcgTWFwPHN0cmluZywgYW55PigpO1xyXG5cclxuICAgIGNvbnN0IHJlc3VsdCA9IG5ldyBNYXA8c3RyaW5nLCBhbnk+KCk7XHJcbiAgICBpZHMuZm9yRWFjaCgoaWQ6IGFueSkgPT4ge1xyXG4gICAgICBjb25zdCBpdGVtID0gbGlzdC5maW5kKGl0ZW0gPT4gaXRlbVt0aGlzLmJpbmRpbmdMaXN0LnByaW1hcnlLZXldID09PSBpZCk7XHJcbiAgICAgIGNvbnN0IG90aGVyUGFnZUl0ZW0gPSByb3dzLmdldChpZCk7XHJcbiAgICAgIGlmIChpdGVtKSB7XHJcbiAgICAgICAgcmVzdWx0LnNldChpZCwgaXRlbSk7XHJcbiAgICAgIH0gZWxzZSBpZiAob3RoZXJQYWdlSXRlbSkge1xyXG4gICAgICAgIHJlc3VsdC5zZXQoaWQsIG90aGVyUGFnZUl0ZW0pO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIHRoaXMudmlld01vZGVsLnVpU3RhdGUuc2V0UHJvcGVydHlWYWx1ZSgncm93cycsIHJlc3VsdCk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiuvue9rmlkc+WPmOmHj1xyXG4gICAqIEBwYXJhbSBpZE9ySWRzIGlkIG9yIGlkc1xyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBzZXRDaGVja3MoaWRPcklkczogc3RyaW5nIHwgc3RyaW5nW10pIHtcclxuICAgIGlmICh0eXBlb2YgaWRPcklkcyA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgaWRPcklkcyA9IGlkT3JJZHMuc3BsaXQoJywnKS5maWx0ZXIocCA9PiBwKTtcclxuICAgIH1cclxuICAgIHRoaXMudmlld01vZGVsLnVpU3RhdGUuc2V0UHJvcGVydHlWYWx1ZSgnaWRzJywgaWRPcklkcyk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluWLvumAieihjGlk5pWw57uEXHJcbiAgICogQHJldHVybnMgXHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIGdldENoZWNrcygpOiBzdHJpbmdbXSB7XHJcbiAgICByZXR1cm4gdGhpcy52aWV3TW9kZWwudWlTdGF0ZVsnaWRzJ10gfHwgW107XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluWIhumhteS/oeaBr1xyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0UGFnaW5nSW5mbygpIHtcclxuICAgIGNvbnN0IGJpbmRpbmdQYXRoID0gdGhpcy52aWV3TW9kZWwuYmluZGluZ1BhdGg7XHJcbiAgICBjb25zdCBiaW5kaW5nRGF0YSA9IHRoaXMudmlld01vZGVsLmJpbmRpbmdEYXRhO1xyXG4gICAgbGV0IHBhZ2luZ0luZm8gPSBiaW5kaW5nRGF0YS5wYWdpbmdJbmZvO1xyXG4gICAgaWYgKGJpbmRpbmdQYXRoID09PSAnLycpIHtcclxuICAgICAgcmV0dXJuIHBhZ2luZ0luZm87XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zdCBiaW5kaW5nUGF0aHMgPSBiaW5kaW5nUGF0aC5zdWJzdHIoMSkuc3BsaXQoJy8nKS5maWx0ZXIoaXRlbSA9PiAhIWl0ZW0gJiYgaXRlbS5sZW5ndGggPiAwKS5tYXAoaXRlbSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIGl0ZW0uc3Vic3RyaW5nKDAsIGl0ZW0ubGVuZ3RoIC0gMSk7XHJcbiAgICAgIH0pO1xyXG4gICAgICBiaW5kaW5nUGF0aHMuZm9yRWFjaChwYXRoID0+IHtcclxuICAgICAgICBwYWdpbmdJbmZvID0gcGFnaW5nSW5mbyAmJiBwYWdpbmdJbmZvW3BhdGhdO1xyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuIHBhZ2luZ0luZm87XHJcbiAgICB9XHJcbiAgfVxyXG4gIHByaXZhdGUgdXBkYXRlUGFnZUluZm8odHJlZVRhYmxlOiBUcmVlVGFibGVDb21wb25lbnQpIHtcclxuICAgIGNvbnN0IHsgcGFnZUluZGV4LCBwYWdlU2l6ZSwgdG90YWwgfSA9IHRoaXMuZ2V0UGFnaW5nSW5mbygpO1xyXG4gICAgaWYgKHBhZ2VTaXplID09PSAwKSB7XHJcbiAgICAgIHRyZWVUYWJsZS5wYWdpbmF0aW9uID0gZmFsc2U7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHRyZWVUYWJsZS5wYWdpbmF0aW9uID0gdHJ1ZTtcclxuICAgIHRyZWVUYWJsZS51cGRhdGVQYWdlSW5mbyh7IHBhZ2VJbmRleCwgcGFnZVNpemUsIHRvdGFsIH0pO1xyXG4gIH1cclxuICAvLyNyZWdpb24g57uE5Lu25LqL5Lu2XHJcbiAgLyoqXHJcbiAgICog6KGM5YiH5o2iXHJcbiAgICovXHJcbiAgQEhvc3RMaXN0ZW5lcignbm9kZVNlbGVjdGVkJywgWyckZXZlbnQnXSlcclxuICBwdWJsaWMgc2VsZWN0aW9uQ2hhbmdlSGFuZGxlcihldmVudDogYW55KSB7XHJcbiAgICBpZiAoZXZlbnQgJiYgZXZlbnQubm9kZSAmJiBldmVudC5ub2RlLmhhc093blByb3BlcnR5KCdkYXRhJykpIHtcclxuICAgICAgY29uc3QgaWRGaWVsZCA9IHRoaXMudHJlZVRhYmxlLmlkRmllbGQ7XHJcbiAgICAgIGNvbnN0IGlkID0gZXZlbnQubm9kZS5kYXRhW2lkRmllbGRdO1xyXG4gICAgICB0aGlzLnNldEN1cnJlbnRJZFRvQmluZGluZ0xpc3QoaWQpO1xyXG4gICAgfVxyXG4gIH1cclxuICAvKipcclxuICAgKiDli77pgInoioLngrnlj5HnlJ/lj5jljJZcclxuICAgKiBAcGFyYW0gZXZlbnQgZXZlbnRcclxuICAgKi9cclxuICBASG9zdExpc3RlbmVyKCdjaGVja1ZhbHVlc0NoYW5nZScsIFsnJGV2ZW50J10pXHJcbiAgcHVibGljIGNoZWNrVmFsdWVzQ2hhbmdlKGV2ZW50OiBhbnkpIHtcclxuICAgIC8vIHRoaXMudmlld01vZGVsLnVpU3RhdGUuc2V0UHJvcGVydHlWYWx1ZSgnaWRzJywgdGhpcy50cmVlVGFibGUuY2hlY2tWYWx1ZXMpO1xyXG4gICAgdGhpcy5zZXRDaGVja3ModGhpcy50cmVlVGFibGUuY2hlY2tWYWx1ZXMpO1xyXG4gICAgdGhpcy5zZXRDaGVja2VkUm93cygpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDlsIbooqvlsZXlvIDnmoToioLngrnorr7nva7kuLrlvZPliY3ooYxcclxuICAgKi9cclxuICBASG9zdExpc3RlbmVyKCdleHBhbmQnLCBbJyRldmVudCddKVxyXG4gIHB1YmxpYyBleHBhbmRIYW5kbGVyKGV2ZW50OiBhbnkpIHtcclxuICAgIGNvbnN0IHNlbGVjdGVkSWQgPSBldmVudC5kYXRhWydpZCddO1xyXG4gICAgY29uc3QgdmlydHVhbFJvb3RGcmFtZUNvbnRleHQgPSB0aGlzLmZyYW1lQ29udGV4dC5nZXRWaXJ0dWFsUm9vdEZyYW1lQ29udGV4dCgpO1xyXG4gICAgLy8g5bGV5byA5pe25LiN5YaN6YCJ5LitXHJcbiAgICAvLyB0aGlzLnNldFNlbGVjdGVkSWRUb1RyZWUoc2VsZWN0ZWRJZCk7XHJcbiAgICBjb25zdCBleHBhbmROb2RlcyA9IHZpcnR1YWxSb290RnJhbWVDb250ZXh0LmdldFBhcmFtKCdUUkVFX0xBVEVTVF9FWFBBTkRFRF9JRCcpIHx8IFtdO1xyXG4gICAgZXhwYW5kTm9kZXMucHVzaChzZWxlY3RlZElkKTtcclxuICAgIHZpcnR1YWxSb290RnJhbWVDb250ZXh0LnNldFBhcmFtKCdUUkVFX0xBVEVTVF9FWFBBTkRFRF9JRCcsIGV4cGFuZE5vZGVzKTtcclxuICB9XHJcbiAgQEhvc3RMaXN0ZW5lcigncGFnZUNoYW5nZWQnLCBbJyRldmVudCddKVxyXG4gIHB1YmxpYyBvblBhZ2VDaGFuZ2VkKGV2ZW50OiBhbnkpIHtcclxuICAgIGxldCB7IHBhZ2VTaXplID0gMjAsIHBhZ2VJbmRleCA9IDEgfSA9IGV2ZW50IHx8IHt9O1xyXG4gICAgaWYgKHBhZ2VJbmRleCA8IDEpIHtcclxuICAgICAgcGFnZUluZGV4ID0gMTtcclxuICAgIH1cclxuICAgIGNvbnN0IHNraXAgPSAocGFnZUluZGV4IC0gMSkgKiBwYWdlU2l6ZTtcclxuICAgIHRoaXMuYmluZGluZ0RhdGEuc2V0UGFnaW5nSW5mbyhza2lwLCBwYWdlU2l6ZSwgdGhpcy5iaW5kaW5nRGF0YS5iaW5kaW5nUGF0aCk7XHJcbiAgfVxyXG4gIEBIb3N0TGlzdGVuZXIoJ3BhZ2VTaXplQ2hhbmdlZCcsIFsnJGV2ZW50J10pXHJcbiAgcHVibGljIG9uUGFnZVNpemVDaGFuZ2VkKGV2ZW50OiBhbnkpIHtcclxuICAgIGNvbnN0IHBhZ2VTaXplID0gZXZlbnQgPyBldmVudCA6IDIwO1xyXG4gICAgY29uc3Qgc2tpcCA9IDA7XHJcbiAgICB0aGlzLmJpbmRpbmdEYXRhLnNldFBhZ2luZ0luZm8oc2tpcCwgcGFnZVNpemUsIHRoaXMuYmluZGluZ0RhdGEuYmluZGluZ1BhdGgpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDoioLngrnpobXnoIHliIfmjaLkuovku7ZcclxuICAgKiBAcGFyYW0gZXZlbnQgZXZlbnRcclxuICAgKi9cclxuICBASG9zdExpc3RlbmVyKCdjaGlsZHNQYWdlQ2hhbmdlZCcsIFsnJGV2ZW50J10pXHJcbiAgcHVibGljIG9uTm9kZVBhZ2VDaGFuZ2VkKGV2ZW50OiBhbnkpIHtcclxuICAgIGNvbnN0IHsgcGFnZUluZGV4ID0gMSwgcGFnZVNpemUgPSB0aGlzLm5vZGVQYWdlU2l6ZSwgbm9kZSA9IHt9IH0gPSBldmVudDtcclxuICAgIGNvbnN0IGlkID0gbm9kZSAmJiBub2RlLmlkIHx8IG51bGw7XHJcbiAgICBpZiAoaWQpIHtcclxuICAgICAgY29uc3QgdmlydHVhbFJvb3RGcmFtZUNvbnRleHQgPSB0aGlzLmZyYW1lQ29udGV4dC5nZXRWaXJ0dWFsUm9vdEZyYW1lQ29udGV4dCgpO1xyXG4gICAgICBjb25zdCBleHBhbmROb2RlcyA9IHZpcnR1YWxSb290RnJhbWVDb250ZXh0LmdldFBhcmFtKCdUUkVFX0xBVEVTVF9FWFBBTkRFRF9JRCcpIHx8IFtdO1xyXG4gICAgICBleHBhbmROb2Rlcy5wdXNoKGlkKTtcclxuICAgICAgdmlydHVhbFJvb3RGcmFtZUNvbnRleHQuc2V0UGFyYW0oJ1RSRUVfTEFURVNUX0VYUEFOREVEX0lEJywgZXhwYW5kTm9kZXMpO1xyXG4gICAgICB0aGlzLmZyYW1lQ29udGV4dC5wYXJhbXMuc2V0KGBfTk9ERV8ke2lkfV9QQUdFX0lOREVYX2AsIHBhZ2VJbmRleCk7XHJcbiAgICAgIHRoaXMuZnJhbWVDb250ZXh0LnBhcmFtcy5zZXQoYF9SRUxPQURfQ0hJTERSRU5fYCwgdHJ1ZSk7XHJcbiAgICAgIHRoaXMuZnJhbWVDb250ZXh0LnBhcmFtcy5zZXQoJ19OT0RFX1BBR0VfQ0hBTkdFRF8nLCB0cnVlKTtcclxuICAgIH1cclxuICB9XHJcbiAgLy8jZW5kcmVnaW9uXHJcbn1cclxuXHJcbmV4cG9ydCB7IEZhcnJpc1RyZWVUYWJsZUJpbmRpbmdEaXJlY3RpdmUgfTtcclxuIl19