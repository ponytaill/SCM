import * as tslib_1 from "tslib";
import { Injectable, Injector } from '@angular/core';
import { ViewModel, Repository, Entity, AppContext, EntityList } from '@farris/devkit';
import { from, EMPTY, concat, of, Subject } from 'rxjs';
import { concatMap, catchError, tap, switchMap, last, map, delay } from 'rxjs/operators';
import { BatchEditDialogService } from '@farris/ui-batch-edit-dialog';
import { DateTimeHelperService } from '@farris/ui-common/date';
import { ComponentManagerService } from './component-manager.service';
import { FormLoadingService } from './form-loading/form-loading.service';
import { LanguageService } from './languag.service';
import { FormNotifyService } from './form-notify.service';
// tslint:disable: max-line-length
/**
 * 批量编辑服务
 */
var BatchEditService = /** @class */ (function () {
    function BatchEditService(injector, componentManagerService, viewModel, repository, batchEditDialogService, dateService, languageService, formNotifyService) {
        var _this = this;
        this.injector = injector;
        this.componentManagerService = componentManagerService;
        this.viewModel = viewModel;
        this.repository = repository;
        this.batchEditDialogService = batchEditDialogService;
        this.dateService = dateService;
        this.languageService = languageService;
        this.formNotifyService = formNotifyService;
        this.formLoadingService = this.injector.get(FormLoadingService, null);
        if (!this.languageService) {
            this.languageService = LanguageService.getInstance();
        }
        if (!this.formNotifyService) {
            this.formNotifyService = this.injector.get(FormNotifyService, null);
        }
        this.onHelpClose = new Subject();
        this.onHelpClose.subscribe(function (result) {
            var _a = result || {}, _b = _a.frameId, frameId = _b === void 0 ? '' : _b, _c = _a.mapFields, mapFields = _c === void 0 ? '' : _c, _d = _a.data, data = _d === void 0 ? [] : _d;
            _this.onHelpCloseHandler(frameId, mapFields, data);
        });
    }
    /**
     * 打开批量编辑对话框
     * @param frameId frameId
     */
    BatchEditService.prototype.openBatchEditDialog = function (frameId) {
        var _this = this;
        if (!frameId) {
            throw new Error('frameId is required.');
        }
        if (this.batchEditDialogService) {
            var columns = [];
            if (this.viewModel) {
                var gridFrameContext = this.viewModel.frameContext.root.appContext.frameContextManager.getFrameContextById(frameId);
                var gridViewModel = gridFrameContext.viewModel;
                if (gridViewModel && gridViewModel.hasOwnProperty('dataGridColumnsName')) {
                    // tslint:disable-next-line: no-string-literal
                    var gridColumnsAttrName = gridViewModel['dataGridColumnsName'];
                    columns = gridViewModel[gridColumnsAttrName];
                }
                else if (gridViewModel && gridViewModel.hasOwnProperty('dataGridColumns')) {
                    columns = gridViewModel['dataGridColumns'];
                }
                var ids_1 = gridViewModel.uiState['ids'] || [];
                if (!ids_1 || ids_1.length < 1) {
                    this.formNotifyService.warning(this.languageService.plsCheckBatchEditRows, { hideTitle: true });
                    return EMPTY;
                }
                var dialogRef_1 = this.batchEditDialogService.batchEdit(columns, {
                    rows: ids_1.length,
                    onConfirm: function (inputs) {
                        if (Array.isArray(ids_1) && ids_1.length > 0) {
                            // console.log('openBatchEditDialog', inputs);
                            var appContext = _this.viewModel.frameContext.appContext;
                            appContext.changeDetectionController.detach();
                            inputs.forEach(function (input) {
                                _this.updateBindingData(input, ids_1);
                            });
                            appContext.changeDetectionController.reattach();
                        }
                        dialogRef_1.close();
                    }
                });
            }
        }
    };
    /**
     * 打开隐藏帮助
     * @param helpId 帮助id
     */
    BatchEditService.prototype.openHiddenHelp = function (helpId) {
        if (!helpId) {
            throw new Error('Argument error,helpId can`t be empty');
        }
        var componentManagerService = this.componentManagerService.getControl(helpId);
        if (componentManagerService) {
            componentManagerService.showDialog();
        }
        else {
            throw new Error("the component which id is " + helpId + " can't be found!");
        }
    };
    /**
     * 清空帮助勾选（只能挂载到帮助前事件）
     */
    BatchEditService.prototype.clearHelpSelections = function () {
        var self = this;
        var helpElement = self.context && self.context.eventParam && self.context.eventParam.instance || null;
        if (helpElement) {
            helpElement.displayValue = '';
        }
    };
    /**
     * 勾选当前行
     * @param frameId frameId
     * @param mapFields 字段映射
     * @param primaryKeyValue 帮助主键字段
     */
    BatchEditService.prototype.checkCurrentRow = function (frameId, mapFields, primaryKeyValue) {
        var self = this;
        var helpElement = self.context && self.context.eventParam && self.context.eventParam.instance || null;
        if (!primaryKeyValue) {
            primaryKeyValue = 'id';
        }
        var mappings = JSON.parse(mapFields);
        if (helpElement) {
            frameId = frameId || this.viewModel.frameContext.frameId;
            if (frameId) {
                var frameContext = this.getFrameContextById(frameId);
                if (frameContext) {
                    var bindingPath = frameContext.viewModel.bindingPath;
                    if (bindingPath) {
                        var bindingPaths = bindingPath.split('/').filter(function (p) { return p; });
                        var bindingList = frameContext.bindingData.getValue(bindingPaths);
                        var currentRow = bindingList.currentItem;
                        var path = mappings[primaryKeyValue];
                        if (path) {
                            var value = this.getValueByPath(currentRow, path);
                            helpElement.displayValue = value;
                        }
                    }
                }
            }
        }
    };
    /**
     * 以帮助勾选数据作为依据，批量新增主表数据
     * @param frameId 主表所在frame的id
     * @param mapFields 帮助字段与主表字段映射
     * @description 以帮助勾选数据作为依据，批量新增主表数据
     */
    BatchEditService.prototype.batchAppend = function (frameId, mapFields) {
        var _this = this;
        var self = this;
        var result = self.context && self.context.eventParam || [];
        if (!mapFields) {
            throw new Error('mapFields can`t be empty.');
        }
        if (result && Array.isArray(result) && result.length > 0) {
            var mappings_1 = JSON.parse(mapFields);
            // 不是bindingPath则按frameId处理
            var bindingPath = '/';
            var appContext = this.injector.get(AppContext, null);
            if (appContext) {
                var frameContext = appContext.frameContextManager.getFrameContextById(frameId);
                if (frameContext) {
                    bindingPath = frameContext.viewModel.bindingPath || '/';
                }
                else {
                    throw new Error('frameId is invalid!');
                }
            }
            var defaultValues_1 = [];
            result.forEach(function (item) {
                var defaultValue = {};
                Object.keys(mappings_1).forEach(function (prop) {
                    var value = _this.getValueByPath(item, prop);
                    var fields = mappings_1[prop];
                    var groups = fields.split(',').filter(function (p) { return p; });
                    groups.forEach(function (group) {
                        var paths = group.split('.').filter(function (p) { return p; });
                        _this.setValueByPath(defaultValue, paths.join('.'), value);
                    });
                });
                defaultValues_1.push(defaultValue);
            });
            this.formLoadingService.show();
            return this.repository.batchAppend(defaultValues_1).pipe(tap(function () { return _this.formLoadingService.hide(); }), map(function () { return true; }));
        }
        return of(true);
    };
    /**
     * 以帮助勾选数据作为依据，批量新增从表/从从表
     * @param frameId 从表/从从表所在frame的id
     * @param mapFields 帮助字段与从表/从从表字段映射
     * @description 以帮助勾选数据作为依据，批量新增从表/从从表
     */
    BatchEditService.prototype.batchAppendByPathBasedOnHelpSelections = function (frameId, mapFields) {
        var _this = this;
        var self = this;
        var result = self.context && self.context.eventParam || [];
        if (!mapFields) {
            throw new Error('mapFields can`t be empty.');
        }
        if (result && Array.isArray(result) && result.length > 0) {
            var mappings_2 = JSON.parse(mapFields);
            // 不是bindingPath则按frameId处理
            var bindingPath = '/';
            var appContext = this.injector.get(AppContext, null);
            if (appContext) {
                var frameContext = appContext.frameContextManager.getFrameContextById(frameId);
                if (frameContext) {
                    bindingPath = frameContext.viewModel.bindingPath || '/';
                }
                else {
                    throw new Error('frameId is invalid!');
                }
            }
            var defaultValues_2 = [];
            result.forEach(function (item) {
                var defaultValue = {};
                Object.keys(mappings_2).forEach(function (prop) {
                    var value = _this.getValueByPath(item, prop);
                    var fields = mappings_2[prop];
                    var groups = fields.split(',').filter(function (p) { return p; });
                    groups.forEach(function (group) {
                        var paths = group.split('.').filter(function (p) { return p; });
                        _this.setValueByPath(defaultValue, paths.join('.'), value);
                    });
                });
                defaultValues_2.push(defaultValue);
            });
            this.formLoadingService.show();
            var path = this.buildPath(bindingPath, this.viewModel.bindingData.list.currentId);
            return this.repository.batchAppendByPath(path, defaultValues_2).pipe(tap(function () { return _this.formLoadingService.hide(); }), map(function () { return true; }));
        }
        return of(true);
    };
    /**
     * 行内帮助多选批量新增或替换子表数据
     * @param frameId frameId, optional,为空时使用命令执行时所在的上下文
     * @param mapFields 字段映射
     * @returns
     */
    BatchEditService.prototype.batchAppendBasedOnRowHelpSelections = function (frameId, mapFields) {
        var _this = this;
        var self = this;
        var result = self.context && self.context.eventParam || [];
        if (!mapFields) {
            return of(true);
        }
        var mappings = JSON.parse(mapFields);
        if (!mappings || !mappings.hasOwnProperty('id')) {
            return of(true);
        }
        frameId = frameId || this.viewModel.frameContext.frameId;
        if (!frameId) {
            return of(true);
        }
        var frameContext = this.getFrameContextById(frameId);
        if (!frameContext) {
            return of(true);
        }
        setTimeout(function () {
            _this.endEdit(frameContext).subscribe(function () {
                if (result && Array.isArray(result) && result.length > 0) {
                    var bindingPath_1 = frameContext.viewModel.bindingPath || '/';
                    var bindingPaths_1 = bindingPath_1.split('/').filter(function (p) { return p; });
                    var defaultValues_3 = [];
                    // 获取当前行
                    var bindingList_1 = frameContext.bindingData.getValue(bindingPaths_1);
                    var currentRow = bindingList_1.currentItem;
                    var currentRowId = bindingList_1.currentId;
                    var currentEntity = _this.getEntityByPath(frameContext, bindingPaths_1, currentRowId);
                    var headItem = result[0];
                    // 如果仅勾选一条，则应替换当前行的映射
                    if (result.length === 1) {
                        _this.mappingRow(headItem, mappings, currentEntity, bindingPath_1);
                        return of(true);
                    }
                    else {
                        var idMapField = mappings['id'];
                        var sourceItemId_1 = _this.getValueByPath(currentEntity, idMapField);
                        // 如果当前行没有映射或勾选结果中找不到当前行的映射
                        if (!sourceItemId_1 || result.findIndex(function (item) { return item[bindingList_1.primaryKey] === sourceItemId_1; }) === -1) {
                            // 重新映射当前行
                            _this.mappingRow(headItem, mappings, currentEntity, bindingPath_1);
                            result = result.slice(1);
                        }
                        else if (sourceItemId_1) {
                            var index = result.findIndex(function (item) { return item[bindingList_1.primaryKey] === sourceItemId_1; });
                            // 重新映射当前行
                            _this.mappingRow(result[index], mappings, currentEntity, bindingPath_1);
                            result.splice(index, 1);
                        }
                        // 当前行处理完成
                        // 处理未映射的行
                        var emptyRows_1 = bindingList_1.toArray().filter(function (bindingObject) {
                            var id = _this.getValueByPath(bindingObject, mappings[bindingList_1.primaryKey]);
                            return !id;
                        });
                        if (emptyRows_1 && emptyRows_1.length > 0) {
                            var rows = result;
                            if (result.length > emptyRows_1.length) {
                                rows = result.slice(0, emptyRows_1.length);
                                result = result.slice(emptyRows_1.length);
                            }
                            else {
                                result = [];
                            }
                            rows.forEach(function (item, index) {
                                var targetItem = emptyRows_1[index];
                                var entity = _this.getEntityByPath(frameContext, bindingPaths_1, targetItem.primaryKeyValue);
                                _this.mappingRow(item, mappings, entity, bindingPath_1);
                            });
                        }
                        // 处理剩余勾选
                        result.forEach(function (item) {
                            var defaultValue = {};
                            Object.keys(mappings).forEach(function (prop) {
                                var value = _this.getValueByPath(item, prop);
                                var fields = mappings[prop];
                                var groups = fields.split(',').filter(function (p) { return p; });
                                groups.forEach(function (group) {
                                    var paths = group.split('.').filter(function (p) { return p; });
                                    _this.setValueByPath(defaultValue, paths.join('.'), value);
                                });
                            });
                            defaultValues_3.push(defaultValue);
                        });
                        if (defaultValues_3.length > 0) {
                            _this.formLoadingService.show();
                            var path = _this.buildPath(bindingPath_1, _this.viewModel.bindingData.list.currentId);
                            _this.repository.batchAppendByPath(path, defaultValues_3).pipe(tap(function () { return _this.formLoadingService.hide(); })).subscribe();
                        }
                    }
                }
            });
        }, 100);
        return of(true);
    };
    /**
     * 复制主表数据
     * @param id 要复制的数据id
     * @param fields 要复制的字段
     * @description 仅支持复制主表数据
     * @deprecated 该方法已被废弃，请使用clone方法替代。
     */
    BatchEditService.prototype.copy = function (id) {
        var _this = this;
        if (!id) {
            this.formNotifyService.warning(this.languageService.plsSelectCopyData, { hideTitle: true });
            return EMPTY;
        }
        var befRepository = this.repository;
        var baseUri = befRepository.restService.baseUri;
        var url = baseUri + "/service/copymainobjvoaction";
        var requestInfo = befRepository.restService.buildRequestInfo();
        var body = {
            requestInfo: requestInfo,
            dataID: id
        };
        var options = {
            body: body
        };
        this.formLoadingService.show();
        return befRepository.proxy.request(url, 'PUT', null, options).pipe(tap(function () {
            _this.formLoadingService.hide();
        }), map(function (responseInfo) {
            var returnValue = responseInfo.returnValue;
            var entity = _this.repository.buildEntity(returnValue);
            _this.repository.entityCollection.addEntity(entity);
            return entity;
        }));
    };
    /**
     * 复制数据（支持主表、从表、从从表）
     * @param id 要复制的行
     * @param path 请求路径
     * @returns
     */
    BatchEditService.prototype.clone = function (id, path) {
        var _this = this;
        if (!id) {
            this.formNotifyService.warning(this.languageService.plsSelectCopyData, { hideTitle: true });
            return EMPTY;
        }
        if (!path) {
            this.formNotifyService.warning(this.languageService.pathIsRequired, { hideTitle: true });
            return EMPTY;
        }
        if (!path.startsWith('/')) {
            path = '/' + path;
        }
        path = path.toLowerCase();
        var bindingPath = this.viewModel.bindingPath;
        var befRepository = this.repository;
        var baseUri = befRepository.restService.baseUri;
        var url = "" + baseUri + path;
        var requestInfo = befRepository.restService.buildRequestInfo();
        var ids = this.buildIds(bindingPath);
        ids.push(id);
        var body = {
            requestInfo: requestInfo,
            dataID: ids.join(',')
        };
        var options = {
            body: body
        };
        this.formLoadingService.show();
        return befRepository.proxy.request(url, 'PUT', null, options).pipe(tap(function () {
            _this.formLoadingService.hide();
        }), map(function (responseInfo) {
            var returnValue = responseInfo.returnValue;
            var entity = null;
            if (bindingPath.split('/').filter(function (p) { return p; }).length === 0) {
                entity = _this.repository.buildEntity(returnValue);
                _this.repository.entityCollection.addEntity(entity, true);
            }
            else {
                var fpath = _this.buildPath(bindingPath, _this.viewModel.bindingData.list.currentId);
                entity = befRepository.entityManager.appendEntityByPath(fpath, returnValue, returnValue, true);
            }
            return entity;
        }));
    };
    //#region 旧的实现
    /**
     * 复制行
     * @param frameId frameId
     * @param ignoreFields 复制时忽略字段
     * @param repeat 重复复制次数，默认为1
     */
    BatchEditService.prototype.copyRow = function (frameId, ignoreFields, repeat) {
        var _this = this;
        if (repeat === void 0) { repeat = 1; }
        if (typeof repeat !== 'number') {
            repeat = parseInt(repeat, 10);
        }
        if (repeat < 1) {
            throw new Error('ArgumentError: repeat must >= 1');
        }
        // 获取当前行
        var frameContext = this.viewModel.frameContext.appContext.frameContextManager.getFrameContextById(frameId);
        var primaryValue = frameContext.bindingData.list.currentId;
        var bindingPath = frameContext.viewModel.bindingPath || '/';
        var bindingData = null;
        var currentItem = null;
        if (bindingPath === '/') {
            // 主表直接取当前行
            currentItem = frameContext.bindingData.list.currentItem;
        }
        else {
            // 取从表/从从表当前行
            var paths = bindingPath.split('/').filter(function (p) { return p; });
            currentItem = frameContext.bindingData.getValue(paths).currentItem;
        }
        bindingData = currentItem.toJSON();
        if (!currentItem.primaryKeyValue) {
            if (this.formNotifyService) {
                this.formNotifyService.warning(this.languageService.plsSelectCopyData, { hideTitle: true });
            }
            return EMPTY;
        }
        var ignoreFieldsArray = ignoreFields.split(',').filter(function (item) { return item; });
        var sources = new Array(repeat);
        return from(sources).pipe(concatMap(function () {
            var action$ = null;
            if (bindingPath !== '/') {
                var fullPath = _this.buildPath(bindingPath, primaryValue);
                action$ = _this.repository.appendByPath(fullPath);
            }
            else {
                action$ = _this.repository.append();
            }
            return action$.pipe(tap(function (entity) {
                // 修正实体主键
                bindingData[entity.primaryKey] = entity.primaryValue;
                // 忽略指定字段
                ignoreFieldsArray.forEach(function (field) {
                    var extractedFields = field.split('.').filter(function (item) { return item; });
                    if (extractedFields.length === 1) {
                        delete bindingData[field];
                    }
                    var parent = extractedFields.slice(0, -1).reduce(function (prev, current, index) {
                        return prev[current];
                    }, bindingData);
                    delete parent[extractedFields[extractedFields.length - 1]];
                });
                bindingData = Object.assign({}, entity.toJSON(), bindingData);
                entity.load(bindingData, { loadChild: false });
            }), catchError(function () {
                return EMPTY;
            }));
        }));
    };
    /**
     * 增量多选帮助批量赋值帮助后事件
     * @param frameId frameId
     * @param mapFields 字段映射
     * @param associatedField 关联字段
     */
    BatchEditService.prototype.afterIncrementalSelectHelpClose = function (frameId, mapFields, associatedField) {
        var _this = this;
        var self = this;
        var result = self.context && self.context.eventParam || [];
        // tslint:disable-next-line: max-line-length
        // const mapping = '{"id":"userRef.userRef", "name":"name", "sex":"sex","age":"userRef.userRef_Age","address":"userRef.userRef_Address","birthday":"userRef.userRef_Birthday","height":"userRef.userRef_Height","isMarried":"userRef.userRef_IsMarried"}';
        if (!associatedField) {
            throw new Error('associated field can`t be empty.');
        }
        if (!mapFields) {
            throw new Error('mapFields can`t be empty.');
        }
        var mappings = JSON.parse(mapFields);
        var foreignKey = associatedField;
        // 将选择人员保存到uistate中
        var rootFrameContext = this.viewModel.frameContext.root;
        // 不是bindingPath则按frameId处理
        var bindingPath = '/';
        var appContext = this.injector.get(AppContext, null);
        if (appContext) {
            var frameContext = appContext.frameContextManager.getFrameContextById(frameId);
            if (frameContext) {
                bindingPath = frameContext.viewModel.bindingPath || '/';
            }
            else {
                throw new Error('frameId is invalid!');
            }
        }
        // tslint:disable-next-line: no-string-literal
        rootFrameContext.uiState['selections'] = result;
        if (result && Array.isArray(result)) {
            // 根据bindingPath获取bindingdata中现有数据
            var bindingPaths = bindingPath.split('/').filter(function (item) { return item; });
            var currentData_1 = this.viewModel.bindingData.getValue(bindingPaths);
            var currentDataArray_1 = currentData_1.toArray();
            // 找到result中有，但bindingData中没有的，为待新增项
            var appends = [];
            result.reduce(function (prev, item) {
                var itemId = item && item[currentData_1.primaryKey] || null;
                var isExist = currentDataArray_1.find(function (bindingObject) { return bindingObject[foreignKey][foreignKey] === itemId; });
                if (!isExist) {
                    prev.push(item);
                }
                return prev;
            }, appends);
            // 找到bindingData中有，result中没有的，为待删除项
            var removes = [];
            currentDataArray_1.reduce(function (results, item) {
                var index = result.findIndex(function (selectItem) { return selectItem[currentData_1.primaryKey] === item[foreignKey][foreignKey]; });
                if (index === -1) {
                    results.push(item.primaryKeyValue);
                }
                return results;
            }, removes);
            // console.log('addItems', appends, 'removeItems', removes);
            // 调用后端接口新增数据
            var addAction$ = from(appends).pipe(concatMap(function (item) {
                var path = _this.buildPath(bindingPath, _this.viewModel.bindingData.list.currentId);
                return _this.repository.appendByPath(path).pipe(tap(function (entity) {
                    Object.keys(mappings).forEach(function (prop) {
                        var value = _this.getValueByPath(item, prop);
                        var fields = mappings[prop];
                        var groups = fields.split(',').filter(function (p) { return p; });
                        groups.forEach(function (group) {
                            var paths = group.split('.').filter(function (p) { return p; });
                            _this.setValueByPath(entity, paths.join('.'), value);
                        });
                    });
                }), catchError(function () {
                    return EMPTY;
                }));
            }));
            var removeAction$ = from(removes).pipe(concatMap(function (item) {
                var path = _this.buildPath(bindingPath, _this.viewModel.bindingData.list.currentId);
                return _this.repository.removeByPath(path, item).pipe(tap(function () {
                    var befRepository = _this.repository;
                    befRepository.entityManager.removeEntityByPath(path, item);
                }), catchError(function () {
                    return EMPTY;
                }));
            }));
            if (!appends && !removes || appends && appends.length < 1 && removes && removes.length < 1) {
                return of(true);
            }
            return concat(addAction$, removeAction$).pipe(catchError(function () { return EMPTY; }));
        }
        return of(true);
    };
    // todo:模拟用户操作，待后端接口支持主表批量新增后重写
    /**
     * 多选帮助批量赋值帮助前事件
     */
    BatchEditService.prototype.beforeMultiSelectHelpOpen = function () {
        return this.clearHelpSelections();
    };
    /**
     * 多选帮助批量赋值帮助后事件
     * @param frameId 绑定路径
     * @param mapFields 字段映射
     * @param commandFrameId 回调命令所在frameId
     * @param commandName 回调命令
     * @deprecated 模拟用户操作，待批量赋值支持主表后废弃
     */
    BatchEditService.prototype.afterMultiSelectHelpClose = function (frameId, mapFields, commandFrameId, commandName) {
        var self = this;
        var result = self.context && self.context.eventParam || [];
        if (result && Array.isArray(result)) {
            // 调用后端接口新增数据
            if (!result || result.length < 1) {
                return of(true);
            }
            this.onHelpClose.next({ frameId: frameId, mapFields: mapFields, data: result, commandFrameId: commandFrameId, commandName: commandName });
            return of(true);
        }
        return of(true);
    };
    /**
      * 帮助关闭后处理器
      * @param frameId frameid
      * @param mapFields mapFields
      * @param result 帮助数据结果
      */
    BatchEditService.prototype.onHelpCloseHandler = function (frameId, mapFields, result) {
        var _this = this;
        if (!mapFields) {
            throw new Error('mapFields can`t be empty.');
        }
        var mappings = JSON.parse(mapFields);
        // 不是bindingPath则按frameId处理
        var bindingPath = '/';
        var appContext = this.injector.get(AppContext, null);
        if (appContext) {
            var frameContext = appContext.frameContextManager.getFrameContextById(frameId);
            if (frameContext) {
                bindingPath = frameContext.viewModel.bindingPath || '/';
            }
            else {
                throw new Error('frameId is invalid!');
            }
        }
        // 将选择人员保存到uistate中
        var rootFrameContext = this.viewModel.frameContext.root;
        var befRepository = this.repository;
        var bindingPaths = bindingPath.split('/').filter(function (p) { return p; });
        // tslint:disable-next-line: no-string-literal
        rootFrameContext.uiState['selections'] = result;
        if (result && Array.isArray(result)) {
            var addAction$ = from(result).pipe(concatMap(function (item) {
                var requestInfo = befRepository.restService.buildRequestInfo();
                if (bindingPaths.length > 0) {
                    var path_1 = _this.buildPath(bindingPath, _this.viewModel.bindingData.list.currentId);
                    return befRepository.restService.createByPath(path_1, requestInfo).pipe(tap(function (responseInfo) {
                        var data = responseInfo.returnValue;
                        var newEntity = befRepository.entityManager.appendEntityByPath(path_1, data, data);
                        Object.keys(mappings).forEach(function (prop) {
                            var value = _this.getValueByPath(item, prop);
                            var fields = mappings[prop];
                            var groups = fields.split(',').filter(function (p) { return p; });
                            groups.forEach(function (group) {
                                var paths = group.split('.').filter(function (p) { return p; });
                                _this.setValueByPath(newEntity, paths.join('.'), value);
                            });
                        });
                        return newEntity;
                    }));
                }
                else {
                    return befRepository.restService.create(null, requestInfo).pipe(tap(function (responseInfo) {
                        var data = responseInfo.returnValue;
                        var newEntity = _this.repository.buildEntity(data);
                        Object.keys(mappings).forEach(function (prop) {
                            var value = _this.getValueByPath(item, prop);
                            var fields = mappings[prop];
                            var groups = fields.split(',').filter(function (p) { return p; });
                            groups.forEach(function (group) {
                                var paths = group.split('.').filter(function (p) { return p; });
                                _this.setValueByPath(newEntity, paths.join('.'), value);
                            });
                        });
                        _this.repository.entityCollection.addEntity(newEntity);
                        return newEntity;
                    }));
                }
            }));
            // const formLoadingService = this.injector.get<FormLoadingService>(FormLoadingService, null);
            if (this.formLoadingService) {
                this.suspendFrameContextEvent(frameId);
                this.formLoadingService.show();
                this.formLoadingService.setSuspend(true);
            }
            return addAction$.pipe(last()).pipe(switchMap(function () {
                var primaryValue = _this.viewModel.bindingData.list.currentId;
                if (primaryValue) {
                    return befRepository.updateChangesById(primaryValue);
                }
                else {
                    return of(null);
                }
            })).subscribe(function () {
                if (_this.formLoadingService) {
                    _this.resumeFrameContextEvent(frameId);
                    _this.formLoadingService.setSuspend(false);
                    _this.formLoadingService.hide();
                }
            }, function () {
                if (_this.formLoadingService) {
                    _this.resumeFrameContextEvent(frameId);
                    _this.formLoadingService.setSuspend(false);
                    _this.formLoadingService.hide();
                }
            });
        }
        return of(null);
    };
    BatchEditService.prototype.suspendFrameContextEvent = function (frameId) {
        var appContext = this.injector.get(AppContext, null);
        if (appContext) {
            var frameContext = appContext.frameContextManager.getFrameContextById(frameId);
            frameContext.suspend = true;
        }
    };
    BatchEditService.prototype.resumeFrameContextEvent = function (frameId) {
        var appContext = this.injector.get(AppContext, null);
        if (appContext) {
            var frameContext = appContext.frameContextManager.getFrameContextById(frameId);
            frameContext.suspend = false;
            frameContext.appContext.messagePipe.next('bindData');
        }
    };
    //#endregion
    BatchEditService.prototype.setValueByPath = function (target, path, value) {
        if (target) {
            var paths = path.split('.');
            if (paths.length <= 1) {
                target[path] = value;
            }
            else {
                paths.slice(0, -1).reduce(function (prev, path) {
                    if (!(prev.hasOwnProperty(path) || prev['__proto__'].hasOwnProperty(path))) {
                        prev[path] = {};
                    }
                    return prev[path];
                }, target)[paths[paths.length - 1]] = value;
            }
        }
    };
    BatchEditService.prototype.getValueByPath = function (target, path) {
        var paths = path.split('.');
        if (paths.length < 1) {
            return;
        }
        if (paths.length === 1) {
            return target[path];
        }
        var result = null;
        paths.forEach(function (prop, index) {
            if (index === 0) {
                result = target && target[prop] || null;
            }
            else {
                result = result && result[prop] || null;
            }
        });
        return result;
    };
    /**
     * 构造子表路径
     * @param bindingPath 绑定路径
     * @param id id
     */
    BatchEditService.prototype.buildPath = function (bindingPath, id) {
        var path = '/' + id;
        var subPaths = bindingPath.split('/');
        if (subPaths.length > 0) {
            // eg:bindingPath形如/edus/grades,split后是['', 'edus', 'grades']
            // 因此index从1开始
            for (var index = 1; index < subPaths.length - 1; index++) {
                var subPath = subPaths[index];
                var subData = this.viewModel.bindingData[subPath];
                if (!subData || !subData.currentId) {
                    throw Error("\u83B7\u53D6\u5B50\u8868\u5B8C\u6574\u8DEF\u5F84\u51FA\u9519\uFF0C\u627E\u4E0D\u5230" + subData + "\u5BF9\u5E94\u7684\u5B50\u8868\uFF0C\u6216\u5BF9\u5E94\u5B50\u8868\u6CA1\u6709\u5F53\u524D\u884C\u3002");
                }
                path += "/" + subPath + "/" + subData.currentId;
            }
        }
        path += '/' + subPaths[subPaths.length - 1];
        return path;
    };
    /**
     * 获取绑定路径的当前行数组
     * @param bindingPath bindingPath
     * @returns
     */
    BatchEditService.prototype.buildIds = function (bindingPath) {
        var _this = this;
        var bindingPaths = bindingPath.split('/').filter(function (p) { return p; });
        var primaryValue = this.viewModel.bindingData.list.currentId;
        var result = [];
        var paths = [];
        if (bindingPaths.length > 0) {
            result.push(primaryValue);
            // 从表或从从表要复制的行不一定是当前行，用户可以指定
            bindingPaths.pop();
            bindingPaths.forEach(function (path) {
                paths.push(path);
                var bindingList = _this.viewModel.bindingData.getValue(paths);
                if (bindingList) {
                    result.push(bindingList.currentId);
                }
            });
        }
        return result;
    };
    BatchEditService.prototype.updateBindingData = function (input, ids) {
        var _a = input || {}, _b = _a.controlType, controlType = _b === void 0 ? null : _b, _c = _a.value, value = _c === void 0 ? null : _c, _d = _a.options, options = _d === void 0 ? {} : _d, _e = _a.dataType, dataType = _e === void 0 ? null : _e;
        if (controlType) {
            // 对帮助做特殊处理
            if (controlType === 'lookup' || controlType === 'combo-lookup') {
                var mapFields = options.mapFields;
                this.updateLookupField(ids, value, mapFields);
            }
            else {
                this.updateSimpleField(ids, value, input);
            }
        }
    };
    BatchEditService.prototype.updateSimpleField = function (ids, value, column) {
        var _this = this;
        if (!column) {
            return;
        }
        var currentColumnType = column.dataType;
        // 存在行编辑器
        var result = value;
        if (currentColumnType === 'date') {
            var dateStr = this.dateService.formatTo(value, 'yyyy-MM-dd');
            if (!dateStr) {
                dateStr = '0001-01-01T00:00:00';
            }
            result = dateStr;
        }
        else if (currentColumnType === 'number') {
            result = Number(value) || 0;
        }
        var field = column.field;
        ids.forEach(function (id) {
            _this.updateBindingList(id, field, result);
        });
    };
    BatchEditService.prototype.updateLookupField = function (ids, helpData, mapFields) {
        var _this = this;
        if (!mapFields) {
            return;
        }
        var helpFields = Object.keys(mapFields);
        var idIndex = helpFields.findIndex(function (item) { return item === 'id'; });
        if (helpFields.includes('id') && idIndex !== 0) {
            helpFields.splice(idIndex, 1);
            helpFields = tslib_1.__spread(['id'], helpFields);
        }
        helpFields.forEach(function (helpField) {
            var helpValue = '';
            if (helpData) {
                if (helpData instanceof Array) {
                    helpValue = helpData.map(function (item) {
                        return _this.getValue(helpField, item);
                    }).join(',');
                }
                else {
                    helpValue = _this.getValue(helpField, helpData);
                }
            }
            ids.forEach(function (id) {
                _this.updateBindingList(id, mapFields[helpField], helpValue);
            });
        });
    };
    BatchEditService.prototype.updateBindingList = function (primaryValue, propertyName, value) {
        var viewModel = this.viewModel || null;
        if (!viewModel || !propertyName) {
            return;
        }
        // 更新主表部分行的字段
        var propertyNames = propertyName.split('.').filter(function (item) { return item; });
        var bindingObject = this.bindingList.findById(primaryValue);
        if (propertyNames.length < 2) {
            bindingObject.setValue(propertyName, value, true, true);
        }
        else {
            var targetBindingObject_1 = null;
            var fpaths = propertyNames.slice(0, propertyNames.length - 1);
            var targetPropertyName = propertyNames[propertyNames.length - 1];
            fpaths.forEach(function (prop) {
                targetBindingObject_1 = targetBindingObject_1 && targetBindingObject_1[prop] || bindingObject[prop];
            });
            // todo:需要添加值变化事件
            targetBindingObject_1.setValue(targetPropertyName, value, true, true);
        }
    };
    BatchEditService.prototype.getBindingPathArray = function () {
        var path = this.viewModel.bindingPath;
        if (path) {
            return path.split('/').filter(function (n) { return n !== ''; });
        }
        return [];
    };
    BatchEditService.prototype.getValue = function (f, data) {
        var val = '';
        if (f.indexOf('.') === -1) {
            val = data[f];
        }
        else {
            val = f.split('.').reduce(function (a, b) {
                return a[b];
            }, data);
        }
        return val;
    };
    Object.defineProperty(BatchEditService.prototype, "bindingList", {
        get: function () {
            // 根实体
            if (this.viewModel.bindingPath === '/' || !this.viewModel.bindingPath) {
                return this.viewModel.bindingData.list;
            }
            // 子实体
            var bindingPath = this.viewModel.bindingPath.substr(1);
            bindingPath = bindingPath[0].toLowerCase() + bindingPath.substring(1, bindingPath.length);
            var paths = bindingPath.split('/');
            var filteredPaths = paths.filter(function (part) {
                return part !== '';
            });
            return this.viewModel.bindingData.getValue(filteredPaths);
        },
        enumerable: true,
        configurable: true
    });
    /**
     * 根据映射将数据赋值给bindingData
     * @param data
     * @param mapFields
     * @param bindingData
     */
    BatchEditService.prototype.mappingRow = function (data, mapFields, entity, bindingPath) {
        var _this = this;
        Object.keys(mapFields).forEach(function (prop) {
            var value = _this.getValueByPath(data, prop);
            var fields = mapFields[prop];
            var groups = fields.split(',').filter(function (p) { return p; });
            groups.forEach(function (group) {
                var paths = group.split('.').filter(function (p) { return p; });
                _this.setValueByPath(entity, paths.join('.'), value);
            });
        });
    };
    /**
     * 通过frameId获取对应的组件上下文
     * @param frameId frameId
     * @returns
     */
    BatchEditService.prototype.getFrameContextById = function (frameId) {
        if (!frameId) {
            return null;
        }
        var appContext = this.injector.get(AppContext, null);
        var frameContext = null;
        if (appContext) {
            frameContext = appContext.frameContextManager.getFrameContextById(frameId);
        }
        return frameContext;
    };
    BatchEditService.prototype.getEntityByPath = function (frameContext, bindingPaths, currentId) {
        bindingPaths = tslib_1.__spread(bindingPaths);
        var id = frameContext.bindingData.list.currentId;
        var entity = frameContext.repository.entityCollection.getEntityById(id);
        var item = entity;
        var paths = [];
        var tailPath = bindingPaths.pop();
        var parent = bindingPaths.reduce(function (object, path) {
            paths.push(path);
            if (object && (object.hasOwnProperty(path) || object['__proto__'].hasOwnProperty(path))) {
                var value = object[path];
                if (value && value instanceof EntityList) {
                    var bindingList = frameContext.bindingData.getValue(paths);
                    var currentItemId = bindingList.currentId;
                    return value.get(currentItemId);
                }
                else {
                    return value;
                }
            }
            else {
                return null;
            }
        }, item);
        if (parent instanceof Entity) {
            var list = parent[tailPath];
            if (list) {
                return list.get(currentId);
            }
            else {
                throw new Error("\u65E0\u6548\u7684bindingPath.");
            }
        }
        else {
            throw new Error("\u65E0\u6548\u7684bindingPath.");
        }
    };
    BatchEditService.prototype.endEdit = function (frameContext) {
        var appContext = frameContext && frameContext.getFormAppContext();
        return of(null).pipe(tap(function () {
            if (appContext) {
                appContext.messagePipe.next({ type: 'endEdit' });
            }
        }), 
        // todo: 不应该使用delay，应该串流
        delay(5));
    };
    BatchEditService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    BatchEditService.ctorParameters = function () { return [
        { type: Injector },
        { type: ComponentManagerService },
        { type: ViewModel },
        { type: Repository },
        { type: BatchEditDialogService },
        { type: DateTimeHelperService },
        { type: LanguageService },
        { type: FormNotifyService }
    ]; };
    return BatchEditService;
}());
export { BatchEditService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmF0Y2gtZWRpdC5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9jb21tYW5kLXNlcnZpY2VzLyIsInNvdXJjZXMiOlsibGliL2JhdGNoLWVkaXQuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQVksTUFBTSxlQUFlLENBQUM7QUFDL0QsT0FBTyxFQUFlLFNBQVMsRUFBaUIsVUFBVSxFQUFFLE1BQU0sRUFBNkIsVUFBVSxFQUFpRCxVQUFVLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUM3TCxPQUFPLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsRUFBRSxFQUFFLE9BQU8sRUFBYyxNQUFNLE1BQU0sQ0FBQztBQUNwRSxPQUFPLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFekYsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFDdEUsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDL0QsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFDdEUsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0scUNBQXFDLENBQUM7QUFDekUsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ3BELE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBRTFELGtDQUFrQztBQUNsQzs7R0FFRztBQUNIO0lBSUUsMEJBQ1UsUUFBa0IsRUFDbEIsdUJBQWdELEVBQ2hELFNBQW9CLEVBQ3BCLFVBQTJCLEVBQzNCLHNCQUE4QyxFQUM5QyxXQUFrQyxFQUNsQyxlQUFnQyxFQUNoQyxpQkFBb0M7UUFSOUMsaUJBc0JDO1FBckJTLGFBQVEs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Q0gsQ0FBQyxDQUFDO1FBQ0Ysd0JBQXdCO1FBQ3hCLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FDVCxDQUFDO0lBQ0osQ0FBQzs7Z0JBei9CRixVQUFVOzs7O2dCQWhCVSxRQUFRO2dCQU9wQix1QkFBdUI7Z0JBTlYsU0FBUztnQkFBaUIsVUFBVTtnQkFJakQsc0JBQXNCO2dCQUN0QixxQkFBcUI7Z0JBR3JCLGVBQWU7Z0JBQ2YsaUJBQWlCOztJQWdnQzFCLHVCQUFDO0NBQUEsQUExL0JELElBMC9CQztTQXovQlksZ0JBQWdCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgSW5qZWN0b3IsIE9wdGlvbmFsIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBCaW5kaW5nTGlzdCwgVmlld01vZGVsLCBCaW5kaW5nT2JqZWN0LCBSZXBvc2l0b3J5LCBFbnRpdHksIEZyYW1lQ29udGV4dCwgQmluZGluZ0RhdGEsIEFwcENvbnRleHQsIEJpbmRpbmdQcm9wZXJ0eSwgRGF0YVR5cGVJbmZvLCBjcmVhdGVFbnRpdGllcywgRW50aXR5TGlzdCB9IGZyb20gJ0BmYXJyaXMvZGV2a2l0JztcbmltcG9ydCB7IGZyb20sIEVNUFRZLCBjb25jYXQsIG9mLCBTdWJqZWN0LCBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBjb25jYXRNYXAsIGNhdGNoRXJyb3IsIHRhcCwgc3dpdGNoTWFwLCBsYXN0LCBtYXAsIGRlbGF5IH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgQmVmUmVwb3NpdG9yeSwgUmVzcG9uc2VJbmZvIH0gZnJvbSAnQGZhcnJpcy9iZWYnO1xuaW1wb3J0IHsgQmF0Y2hFZGl0RGlhbG9nU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktYmF0Y2gtZWRpdC1kaWFsb2cnO1xuaW1wb3J0IHsgRGF0ZVRpbWVIZWxwZXJTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1jb21tb24vZGF0ZSc7XG5pbXBvcnQgeyBDb21wb25lbnRNYW5hZ2VyU2VydmljZSB9IGZyb20gJy4vY29tcG9uZW50LW1hbmFnZXIuc2VydmljZSc7XG5pbXBvcnQgeyBGb3JtTG9hZGluZ1NlcnZpY2UgfSBmcm9tICcuL2Zvcm0tbG9hZGluZy9mb3JtLWxvYWRpbmcuc2VydmljZSc7XG5pbXBvcnQgeyBMYW5ndWFnZVNlcnZpY2UgfSBmcm9tICcuL2xhbmd1YWcuc2VydmljZSc7XG5pbXBvcnQgeyBGb3JtTm90aWZ5U2VydmljZSB9IGZyb20gJy4vZm9ybS1ub3RpZnkuc2VydmljZSc7XG5cbi8vIHRzbGludDpkaXNhYmxlOiBtYXgtbGluZS1sZW5ndGhcbi8qKlxuICog5om56YeP57yW6L6R5pyN5YqhXG4gKi9cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBCYXRjaEVkaXRTZXJ2aWNlIHtcbiAgcHJpdmF0ZSBmb3JtTG9hZGluZ1NlcnZpY2U6IEZvcm1Mb2FkaW5nU2VydmljZTtcbiAgcHJpdmF0ZSBvbkhlbHBDbG9zZTogU3ViamVjdDxhbnk+O1xuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGluamVjdG9yOiBJbmplY3RvcixcbiAgICBwcml2YXRlIGNvbXBvbmVudE1hbmFnZXJTZXJ2aWNlOiBDb21wb25lbnRNYW5hZ2VyU2VydmljZSxcbiAgICBwcml2YXRlIHZpZXdNb2RlbDogVmlld01vZGVsLFxuICAgIHByaXZhdGUgcmVwb3NpdG9yeTogUmVwb3NpdG9yeTxhbnk+LFxuICAgIHByaXZhdGUgYmF0Y2hFZGl0RGlhbG9nU2VydmljZTogQmF0Y2hFZGl0RGlhbG9nU2VydmljZSxcbiAgICBwcml2YXRlIGRhdGVTZXJ2aWNlOiBEYXRlVGltZUhlbHBlclNlcnZpY2UsXG4gICAgcHJpdmF0ZSBsYW5ndWFnZVNlcnZpY2U6IExhbmd1YWdlU2VydmljZSxcbiAgICBwcml2YXRlIGZvcm1Ob3RpZnlTZXJ2aWNlOiBGb3JtTm90aWZ5U2VydmljZVxuICApIHtcbiAgICB0aGlzLmZvcm1Mb2FkaW5nU2VydmljZSA9IHRoaXMuaW5qZWN0b3IuZ2V0PEZvcm1Mb2FkaW5nU2VydmljZT4oRm9ybUxvYWRpbmdTZXJ2aWNlLCBudWxsKTtcbiAgICBpZiAoIXRoaXMubGFuZ3VhZ2VTZXJ2aWNlKSB7XG4gICAgICB0aGlzLmxhbmd1YWdlU2VydmljZSA9IExhbmd1YWdlU2VydmljZS5nZXRJbnN0YW5jZSgpO1xuICAgIH1cbiAgICBpZiAoIXRoaXMuZm9ybU5vdGlmeVNlcnZpY2UpIHtcbiAgICAgIHRoaXMuZm9ybU5vdGlmeVNlcnZpY2UgPSB0aGlzLmluamVjdG9yLmdldDxGb3JtTm90aWZ5U2VydmljZT4oRm9ybU5vdGlmeVNlcnZpY2UsIG51bGwpO1xuICAgIH1cbiAgICB0aGlzLm9uSGVscENsb3NlID0gbmV3IFN1YmplY3Q8YW55PigpO1xuICAgIHRoaXMub25IZWxwQ2xvc2Uuc3Vic2NyaWJlKHJlc3VsdCA9PiB7XG4gICAgICBjb25zdCB7IGZyYW1lSWQgPSAnJywgbWFwRmllbGRzID0gJycsIGRhdGEgPSBbXSB9ID0gcmVzdWx0IHx8IHt9O1xuICAgICAgdGhpcy5vbkhlbHBDbG9zZUhhbmRsZXIoZnJhbWVJZCwgbWFwRmllbGRzLCBkYXRhKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiDmiZPlvIDmibnph4/nvJbovpHlr7nor53moYZcbiAgICogQHBhcmFtIGZyYW1lSWQgZnJhbWVJZFxuICAgKi9cbiAgcHVibGljIG9wZW5CYXRjaEVkaXREaWFsb2coZnJhbWVJZDogc3RyaW5nKSB7XG4gICAgaWYgKCFmcmFtZUlkKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ZyYW1lSWQgaXMgcmVxdWlyZWQuJyk7XG4gICAgfVxuICAgIGlmICh0aGlzLmJhdGNoRWRpdERpYWxvZ1NlcnZpY2UpIHtcbiAgICAgIGxldCBjb2x1bW5zID0gW107XG4gICAgICBpZiAodGhpcy52aWV3TW9kZWwpIHtcbiAgICAgICAgY29uc3QgZ3JpZEZyYW1lQ29udGV4dDogRnJhbWVDb250ZXh0ID0gdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LnJvb3QuYXBwQ29udGV4dC5mcmFtZUNvbnRleHRNYW5hZ2VyLmdldEZyYW1lQ29udGV4dEJ5SWQoZnJhbWVJZCk7XG4gICAgICAgIGNvbnN0IGdyaWRWaWV3TW9kZWwgPSBncmlkRnJhbWVDb250ZXh0LnZpZXdNb2RlbDtcbiAgICAgICAgaWYgKGdyaWRWaWV3TW9kZWwgJiYgZ3JpZFZpZXdNb2RlbC5oYXNPd25Qcm9wZXJ0eSgnZGF0YUdyaWRDb2x1bW5zTmFtZScpKSB7XG4gICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBuby1zdHJpbmctbGl0ZXJhbFxuICAgICAgICAgIGNvbnN0IGdyaWRDb2x1bW5zQXR0ck5hbWUgPSBncmlkVmlld01vZGVsWydkYXRhR3JpZENvbHVtbnNOYW1lJ107XG4gICAgICAgICAgY29sdW1ucyA9IGdyaWRWaWV3TW9kZWxbZ3JpZENvbHVtbnNBdHRyTmFtZV07XG4gICAgICAgIH0gZWxzZSBpZiAoZ3JpZFZpZXdNb2RlbCAmJiBncmlkVmlld01vZGVsLmhhc093blByb3BlcnR5KCdkYXRhR3JpZENvbHVtbnMnKSkge1xuICAgICAgICAgIGNvbHVtbnMgPSBncmlkVmlld01vZGVsWydkYXRhR3JpZENvbHVtbnMnXTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBpZHM6IHN0cmluZ1tdID0gZ3JpZFZpZXdNb2RlbC51aVN0YXRlWydpZHMnXSB8fCBbXTtcbiAgICAgICAgaWYgKCFpZHMgfHwgaWRzLmxlbmd0aCA8IDEpIHtcbiAgICAgICAgICB0aGlzLmZvcm1Ob3RpZnlTZXJ2aWNlLndhcm5pbmcodGhpcy5sYW5ndWFnZVNlcnZpY2UucGxzQ2hlY2tCYXRjaEVkaXRSb3dzLCB7IGhpZGVUaXRsZTogdHJ1ZSB9KTtcbiAgICAgICAgICByZXR1cm4gRU1QVFk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZGlhbG9nUmVmOiBhbnkgPSB0aGlzLmJhdGNoRWRpdERpYWxvZ1NlcnZpY2UuYmF0Y2hFZGl0KGNvbHVtbnMsIHtcbiAgICAgICAgICByb3dzOiBpZHMubGVuZ3RoLFxuICAgICAgICAgIG9uQ29uZmlybTogKGlucHV0czogQXJyYXk8YW55PikgPT4ge1xuICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoaWRzKSAmJiBpZHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnb3BlbkJhdGNoRWRpdERpYWxvZycsIGlucHV0cyk7XG4gICAgICAgICAgICAgIGNvbnN0IGFwcENvbnRleHQgPSB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQuYXBwQ29udGV4dDtcbiAgICAgICAgICAgICAgYXBwQ29udGV4dC5jaGFuZ2VEZXRlY3Rpb25Db250cm9sbGVyLmRldGFjaCgpO1xuICAgICAgICAgICAgICBpbnB1dHMuZm9yRWFjaChpbnB1dCA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVCaW5kaW5nRGF0YShpbnB1dCwgaWRzKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIGFwcENvbnRleHQuY2hhbmdlRGV0ZWN0aW9uQ29udHJvbGxlci5yZWF0dGFjaCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZGlhbG9nUmVmLmNsb3NlKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgLyoqXG4gICAqIOaJk+W8gOmakOiXj+W4ruWKqVxuICAgKiBAcGFyYW0gaGVscElkIOW4ruWKqWlkXG4gICAqL1xuICBwdWJsaWMgb3BlbkhpZGRlbkhlbHAoaGVscElkOiBzdHJpbmcpIHtcbiAgICBpZiAoIWhlbHBJZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdBcmd1bWVudCBlcnJvcixoZWxwSWQgY2FuYHQgYmUgZW1wdHknKTtcbiAgICB9XG4gICAgY29uc3QgY29tcG9uZW50TWFuYWdlclNlcnZpY2UgPSB0aGlzLmNvbXBvbmVudE1hbmFnZXJTZXJ2aWNlLmdldENvbnRyb2woaGVscElkKTtcbiAgICBpZiAoY29tcG9uZW50TWFuYWdlclNlcnZpY2UpIHtcbiAgICAgIGNvbXBvbmVudE1hbmFnZXJTZXJ2aWNlLnNob3dEaWFsb2coKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGB0aGUgY29tcG9uZW50IHdoaWNoIGlkIGlzICR7aGVscElkfSBjYW4ndCBiZSBmb3VuZCFgKTtcbiAgICB9XG4gIH1cbiAgLyoqXG4gICAqIOa4heepuuW4ruWKqeWLvumAie+8iOWPquiDveaMgui9veWIsOW4ruWKqeWJjeS6i+S7tu+8iVxuICAgKi9cbiAgcHVibGljIGNsZWFySGVscFNlbGVjdGlvbnMoKSB7XG4gICAgY29uc3Qgc2VsZjogYW55ID0gdGhpcztcbiAgICBjb25zdCBoZWxwRWxlbWVudCA9IHNlbGYuY29udGV4dCAmJiBzZWxmLmNvbnRleHQuZXZlbnRQYXJhbSAmJiBzZWxmLmNvbnRleHQuZXZlbnRQYXJhbS5pbnN0YW5jZSB8fCBudWxsO1xuICAgIGlmIChoZWxwRWxlbWVudCkge1xuICAgICAgaGVscEVsZW1lbnQuZGlzcGxheVZhbHVlID0gJyc7XG4gICAgfVxuICB9XG4gIC8qKlxuICAgKiDli77pgInlvZPliY3ooYxcbiAgICogQHBhcmFtIGZyYW1lSWQgZnJhbWVJZFxuICAgKiBAcGFyYW0gbWFwRmllbGRzIOWtl+auteaYoOWwhFxuICAgKiBAcGFyYW0gcHJpbWFyeUtleVZhbHVlIOW4ruWKqeS4u+mUruWtl+autVxuICAgKi9cbiAgcHVibGljIGNoZWNrQ3VycmVudFJvdyhmcmFtZUlkOiBzdHJpbmcsIG1hcEZpZWxkczogc3RyaW5nLCBwcmltYXJ5S2V5VmFsdWU6IHN0cmluZykge1xuICAgIGNvbnN0IHNlbGY6IGFueSA9IHRoaXM7XG4gICAgY29uc3QgaGVscEVsZW1lbnQgPSBzZWxmLmNvbnRleHQgJiYgc2VsZi5jb250ZXh0LmV2ZW50UGFyYW0gJiYgc2VsZi5jb250ZXh0LmV2ZW50UGFyYW0uaW5zdGFuY2UgfHwgbnVsbDtcbiAgICBpZiAoIXByaW1hcnlLZXlWYWx1ZSkge1xuICAgICAgcHJpbWFyeUtleVZhbHVlID0gJ2lkJztcbiAgICB9XG4gICAgY29uc3QgbWFwcGluZ3MgPSBKU09OLnBhcnNlKG1hcEZpZWxkcyk7XG4gICAgaWYgKGhlbHBFbGVtZW50KSB7XG4gICAgICBmcmFtZUlkID0gZnJhbWVJZCB8fCB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQuZnJhbWVJZDtcbiAgICAgIGlmIChmcmFtZUlkKSB7XG4gICAgICAgIGNvbnN0IGZyYW1lQ29udGV4dCA9IHRoaXMuZ2V0RnJhbWVDb250ZXh0QnlJZChmcmFtZUlkKTtcbiAgICAgICAgaWYgKGZyYW1lQ29udGV4dCkge1xuICAgICAgICAgIGNvbnN0IGJpbmRpbmdQYXRoID0gZnJhbWVDb250ZXh0LnZpZXdNb2RlbC5iaW5kaW5nUGF0aDtcbiAgICAgICAgICBpZiAoYmluZGluZ1BhdGgpIHtcbiAgICAgICAgICAgIGNvbnN0IGJpbmRpbmdQYXRocyA9IGJpbmRpbmdQYXRoLnNwbGl0KCcvJykuZmlsdGVyKHAgPT4gcCk7XG4gICAgICAgICAgICBjb25zdCBiaW5kaW5nTGlzdCA9IGZyYW1lQ29udGV4dC5iaW5kaW5nRGF0YS5nZXRWYWx1ZShiaW5kaW5nUGF0aHMpIGFzIEJpbmRpbmdMaXN0O1xuICAgICAgICAgICAgY29uc3QgY3VycmVudFJvdyA9IGJpbmRpbmdMaXN0LmN1cnJlbnRJdGVtO1xuICAgICAgICAgICAgY29uc3QgcGF0aCA9IG1hcHBpbmdzW3ByaW1hcnlLZXlWYWx1ZV07XG4gICAgICAgICAgICBpZiAocGF0aCkge1xuICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHRoaXMuZ2V0VmFsdWVCeVBhdGgoY3VycmVudFJvdywgcGF0aCk7XG4gICAgICAgICAgICAgIGhlbHBFbGVtZW50LmRpc3BsYXlWYWx1ZSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuICAvKipcbiAgICog5Lul5biu5Yqp5Yu+6YCJ5pWw5o2u5L2c5Li65L6d5o2u77yM5om56YeP5paw5aKe5Li76KGo5pWw5o2uXG4gICAqIEBwYXJhbSBmcmFtZUlkIOS4u+ihqOaJgOWcqGZyYW1l55qEaWRcbiAgICogQHBhcmFtIG1hcEZpZWxkcyDluK7liqnlrZfmrrXkuI7kuLvooajlrZfmrrXmmKDlsIRcbiAgICogQGRlc2NyaXB0aW9uIOS7peW4ruWKqeWLvumAieaVsOaNruS9nOS4uuS+neaNru+8jOaJuemHj+aWsOWinuS4u+ihqOaVsOaNrlxuICAgKi9cbiAgcHVibGljIGJhdGNoQXBwZW5kKGZyYW1lSWQ6IHN0cmluZywgbWFwRmllbGRzOiBzdHJpbmcpIHtcbiAgICBjb25zdCBzZWxmOiBhbnkgPSB0aGlzO1xuICAgIGNvbnN0IHJlc3VsdCA9IHNlbGYuY29udGV4dCAmJiBzZWxmLmNvbnRleHQuZXZlbnRQYXJhbSB8fCBbXTtcbiAgICBpZiAoIW1hcEZpZWxkcykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdtYXBGaWVsZHMgY2FuYHQgYmUgZW1wdHkuJyk7XG4gICAgfVxuICAgIGlmIChyZXN1bHQgJiYgQXJyYXkuaXNBcnJheShyZXN1bHQpICYmIHJlc3VsdC5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zdCBtYXBwaW5ncyA9IEpTT04ucGFyc2UobWFwRmllbGRzKTtcbiAgICAgIC8vIOS4jeaYr2JpbmRpbmdQYXRo5YiZ5oyJZnJhbWVJZOWkhOeQhlxuICAgICAgbGV0IGJpbmRpbmdQYXRoID0gJy8nO1xuICAgICAgY29uc3QgYXBwQ29udGV4dCA9IHRoaXMuaW5qZWN0b3IuZ2V0PEFwcENvbnRleHQ+KEFwcENvbnRleHQsIG51bGwpO1xuICAgICAgaWYgKGFwcENvbnRleHQpIHtcbiAgICAgICAgY29uc3QgZnJhbWVDb250ZXh0ID0gYXBwQ29udGV4dC5mcmFtZUNvbnRleHRNYW5hZ2VyLmdldEZyYW1lQ29udGV4dEJ5SWQoZnJhbWVJZCk7XG4gICAgICAgIGlmIChmcmFtZUNvbnRleHQpIHtcbiAgICAgICAgICBiaW5kaW5nUGF0aCA9IGZyYW1lQ29udGV4dC52aWV3TW9kZWwuYmluZGluZ1BhdGggfHwgJy8nO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignZnJhbWVJZCBpcyBpbnZhbGlkIScpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBjb25zdCBkZWZhdWx0VmFsdWVzID0gW107XG4gICAgICByZXN1bHQuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgICBjb25zdCBkZWZhdWx0VmFsdWUgPSB7fTtcbiAgICAgICAgT2JqZWN0LmtleXMobWFwcGluZ3MpLmZvckVhY2goKHByb3A6IHN0cmluZykgPT4ge1xuICAgICAgICAgIGNvbnN0IHZhbHVlID0gdGhpcy5nZXRWYWx1ZUJ5UGF0aChpdGVtLCBwcm9wKTtcbiAgICAgICAgICBjb25zdCBmaWVsZHMgPSBtYXBwaW5nc1twcm9wXTtcbiAgICAgICAgICBjb25zdCBncm91cHM6IGFueVtdID0gZmllbGRzLnNwbGl0KCcsJykuZmlsdGVyKHAgPT4gcCk7XG4gICAgICAgICAgZ3JvdXBzLmZvckVhY2goZ3JvdXAgPT4ge1xuICAgICAgICAgICAgY29uc3QgcGF0aHMgPSBncm91cC5zcGxpdCgnLicpLmZpbHRlcihwID0+IHApO1xuICAgICAgICAgICAgdGhpcy5zZXRWYWx1ZUJ5UGF0aChkZWZhdWx0VmFsdWUsIHBhdGhzLmpvaW4oJy4nKSwgdmFsdWUpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgZGVmYXVsdFZhbHVlcy5wdXNoKGRlZmF1bHRWYWx1ZSk7XG4gICAgICB9KTtcbiAgICAgIHRoaXMuZm9ybUxvYWRpbmdTZXJ2aWNlLnNob3coKTtcbiAgICAgIHJldHVybiB0aGlzLnJlcG9zaXRvcnkuYmF0Y2hBcHBlbmQoZGVmYXVsdFZhbHVlcykucGlwZShcbiAgICAgICAgdGFwKCgpID0+IHRoaXMuZm9ybUxvYWRpbmdTZXJ2aWNlLmhpZGUoKSksXG4gICAgICAgIG1hcCgoKSA9PiB0cnVlKVxuICAgICAgKTtcbiAgICB9XG4gICAgcmV0dXJuIG9mKHRydWUpO1xuICB9XG4gIC8qKlxuICAgKiDku6XluK7liqnli77pgInmlbDmja7kvZzkuLrkvp3mja7vvIzmibnph4/mlrDlop7ku47ooagv5LuO5LuO6KGoXG4gICAqIEBwYXJhbSBmcmFtZUlkIOS7juihqC/ku47ku47ooajmiYDlnKhmcmFtZeeahGlkXG4gICAqIEBwYXJhbSBtYXBGaWVsZHMg5biu5Yqp5a2X5q615LiO5LuO6KGoL+S7juS7juihqOWtl+auteaYoOWwhFxuICAgKiBAZGVzY3JpcHRpb24g5Lul5biu5Yqp5Yu+6YCJ5pWw5o2u5L2c5Li65L6d5o2u77yM5om56YeP5paw5aKe5LuO6KGoL+S7juS7juihqFxuICAgKi9cbiAgcHVibGljIGJhdGNoQXBwZW5kQnlQYXRoQmFzZWRPbkhlbHBTZWxlY3Rpb25zKGZyYW1lSWQ6IHN0cmluZywgbWFwRmllbGRzOiBzdHJpbmcpIHtcbiAgICBjb25zdCBzZWxmOiBhbnkgPSB0aGlzO1xuICAgIGNvbnN0IHJlc3VsdCA9IHNlbGYuY29udGV4dCAmJiBzZWxmLmNvbnRleHQuZXZlbnRQYXJhbSB8fCBbXTtcbiAgICBpZiAoIW1hcEZpZWxkcykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdtYXBGaWVsZHMgY2FuYHQgYmUgZW1wdHkuJyk7XG4gICAgfVxuICAgIGlmIChyZXN1bHQgJiYgQXJyYXkuaXNBcnJheShyZXN1bHQpICYmIHJlc3VsdC5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zdCBtYXBwaW5ncyA9IEpTT04ucGFyc2UobWFwRmllbGRzKTtcbiAgICAgIC8vIOS4jeaYr2JpbmRpbmdQYXRo5YiZ5oyJZnJhbWVJZOWkhOeQhlxuICAgICAgbGV0IGJpbmRpbmdQYXRoID0gJy8nO1xuICAgICAgY29uc3QgYXBwQ29udGV4dCA9IHRoaXMuaW5qZWN0b3IuZ2V0PEFwcENvbnRleHQ+KEFwcENvbnRleHQsIG51bGwpO1xuICAgICAgaWYgKGFwcENvbnRleHQpIHtcbiAgICAgICAgY29uc3QgZnJhbWVDb250ZXh0ID0gYXBwQ29udGV4dC5mcmFtZUNvbnRleHRNYW5hZ2VyLmdldEZyYW1lQ29udGV4dEJ5SWQoZnJhbWVJZCk7XG4gICAgICAgIGlmIChmcmFtZUNvbnRleHQpIHtcbiAgICAgICAgICBiaW5kaW5nUGF0aCA9IGZyYW1lQ29udGV4dC52aWV3TW9kZWwuYmluZGluZ1BhdGggfHwgJy8nO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignZnJhbWVJZCBpcyBpbnZhbGlkIScpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBjb25zdCBkZWZhdWx0VmFsdWVzID0gW107XG4gICAgICByZXN1bHQuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgICBjb25zdCBkZWZhdWx0VmFsdWUgPSB7fTtcbiAgICAgICAgT2JqZWN0LmtleXMobWFwcGluZ3MpLmZvckVhY2goKHByb3A6IHN0cmluZykgPT4ge1xuICAgICAgICAgIGNvbnN0IHZhbHVlID0gdGhpcy5nZXRWYWx1ZUJ5UGF0aChpdGVtLCBwcm9wKTtcbiAgICAgICAgICBjb25zdCBmaWVsZHMgPSBtYXBwaW5nc1twcm9wXTtcbiAgICAgICAgICBjb25zdCBncm91cHM6IGFueVtdID0gZmllbGRzLnNwbGl0KCcsJykuZmlsdGVyKHAgPT4gcCk7XG4gICAgICAgICAgZ3JvdXBzLmZvckVhY2goZ3JvdXAgPT4ge1xuICAgICAgICAgICAgY29uc3QgcGF0aHMgPSBncm91cC5zcGxpdCgnLicpLmZpbHRlcihwID0+IHApO1xuICAgICAgICAgICAgdGhpcy5zZXRWYWx1ZUJ5UGF0aChkZWZhdWx0VmFsdWUsIHBhdGhzLmpvaW4oJy4nKSwgdmFsdWUpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgZGVmYXVsdFZhbHVlcy5wdXNoKGRlZmF1bHRWYWx1ZSk7XG4gICAgICB9KTtcbiAgICAgIHRoaXMuZm9ybUxvYWRpbmdTZXJ2aWNlLnNob3coKTtcbiAgICAgIGNvbnN0IHBhdGggPSB0aGlzLmJ1aWxkUGF0aChiaW5kaW5nUGF0aCwgdGhpcy52aWV3TW9kZWwuYmluZGluZ0RhdGEubGlzdC5jdXJyZW50SWQpO1xuICAgICAgcmV0dXJuIHRoaXMucmVwb3NpdG9yeS5iYXRjaEFwcGVuZEJ5UGF0aChwYXRoLCBkZWZhdWx0VmFsdWVzKS5waXBlKFxuICAgICAgICB0YXAoKCkgPT4gdGhpcy5mb3JtTG9hZGluZ1NlcnZpY2UuaGlkZSgpKSxcbiAgICAgICAgbWFwKCgpID0+IHRydWUpXG4gICAgICApO1xuICAgIH1cbiAgICByZXR1cm4gb2YodHJ1ZSk7XG4gIH1cbiAgLyoqXG4gICAqIOihjOWGheW4ruWKqeWkmumAieaJuemHj+aWsOWinuaIluabv+aNouWtkOihqOaVsOaNrlxuICAgKiBAcGFyYW0gZnJhbWVJZCBmcmFtZUlkLCBvcHRpb25hbCzkuLrnqbrml7bkvb/nlKjlkb3ku6TmiafooYzml7bmiYDlnKjnmoTkuIrkuIvmlodcbiAgICogQHBhcmFtIG1hcEZpZWxkcyDlrZfmrrXmmKDlsIRcbiAgICogQHJldHVybnMgXG4gICAqL1xuICBwdWJsaWMgYmF0Y2hBcHBlbmRCYXNlZE9uUm93SGVscFNlbGVjdGlvbnMoZnJhbWVJZDogc3RyaW5nLCBtYXBGaWVsZHM6IHN0cmluZykge1xuICAgIGNvbnN0IHNlbGY6IGFueSA9IHRoaXM7XG4gICAgbGV0IHJlc3VsdDogYW55W10gPSBzZWxmLmNvbnRleHQgJiYgc2VsZi5jb250ZXh0LmV2ZW50UGFyYW0gfHwgW107XG4gICAgaWYgKCFtYXBGaWVsZHMpIHtcbiAgICAgIHJldHVybiBvZih0cnVlKTtcbiAgICB9XG4gICAgY29uc3QgbWFwcGluZ3MgPSBKU09OLnBhcnNlKG1hcEZpZWxkcyk7XG4gICAgaWYgKCFtYXBwaW5ncyB8fCAhbWFwcGluZ3MuaGFzT3duUHJvcGVydHkoJ2lkJykpIHtcbiAgICAgIHJldHVybiBvZih0cnVlKTtcbiAgICB9XG4gICAgZnJhbWVJZCA9IGZyYW1lSWQgfHwgdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LmZyYW1lSWQ7XG4gICAgaWYgKCFmcmFtZUlkKSB7XG4gICAgICByZXR1cm4gb2YodHJ1ZSk7XG4gICAgfVxuICAgIGNvbnN0IGZyYW1lQ29udGV4dCA9IHRoaXMuZ2V0RnJhbWVDb250ZXh0QnlJZChmcmFtZUlkKTtcbiAgICBpZiAoIWZyYW1lQ29udGV4dCkge1xuICAgICAgcmV0dXJuIG9mKHRydWUpO1xuICAgIH1cbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHRoaXMuZW5kRWRpdChmcmFtZUNvbnRleHQpLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgIGlmIChyZXN1bHQgJiYgQXJyYXkuaXNBcnJheShyZXN1bHQpICYmIHJlc3VsdC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgY29uc3QgYmluZGluZ1BhdGggPSBmcmFtZUNvbnRleHQudmlld01vZGVsLmJpbmRpbmdQYXRoIHx8ICcvJztcbiAgICAgICAgICBjb25zdCBiaW5kaW5nUGF0aHMgPSBiaW5kaW5nUGF0aC5zcGxpdCgnLycpLmZpbHRlcihwID0+IHApO1xuICAgICAgICAgIGNvbnN0IGRlZmF1bHRWYWx1ZXMgPSBbXTtcbiAgICAgICAgICAvLyDojrflj5blvZPliY3ooYxcbiAgICAgICAgICBjb25zdCBiaW5kaW5nTGlzdDogQmluZGluZ0xpc3QgPSBmcmFtZUNvbnRleHQuYmluZGluZ0RhdGEuZ2V0VmFsdWUoYmluZGluZ1BhdGhzKSBhcyBCaW5kaW5nTGlzdDtcbiAgICAgICAgICBjb25zdCBjdXJyZW50Um93ID0gYmluZGluZ0xpc3QuY3VycmVudEl0ZW07XG4gICAgICAgICAgY29uc3QgY3VycmVudFJvd0lkID0gYmluZGluZ0xpc3QuY3VycmVudElkO1xuICAgICAgICAgIGNvbnN0IGN1cnJlbnRFbnRpdHkgPSB0aGlzLmdldEVudGl0eUJ5UGF0aChmcmFtZUNvbnRleHQsIGJpbmRpbmdQYXRocywgY3VycmVudFJvd0lkKTtcbiAgICAgICAgICBjb25zdCBoZWFkSXRlbSA9IHJlc3VsdFswXTtcbiAgICAgICAgICAvLyDlpoLmnpzku4Xli77pgInkuIDmnaHvvIzliJnlupTmm7/mjaLlvZPliY3ooYznmoTmmKDlsIRcbiAgICAgICAgICBpZiAocmVzdWx0Lmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgdGhpcy5tYXBwaW5nUm93KGhlYWRJdGVtLCBtYXBwaW5ncywgY3VycmVudEVudGl0eSwgYmluZGluZ1BhdGgpO1xuICAgICAgICAgICAgcmV0dXJuIG9mKHRydWUpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBpZE1hcEZpZWxkID0gbWFwcGluZ3NbJ2lkJ107XG4gICAgICAgICAgICBjb25zdCBzb3VyY2VJdGVtSWQgPSB0aGlzLmdldFZhbHVlQnlQYXRoKGN1cnJlbnRFbnRpdHksIGlkTWFwRmllbGQpO1xuICAgICAgICAgICAgLy8g5aaC5p6c5b2T5YmN6KGM5rKh5pyJ5pig5bCE5oiW5Yu+6YCJ57uT5p6c5Lit5om+5LiN5Yiw5b2T5YmN6KGM55qE5pig5bCEXG4gICAgICAgICAgICBpZiAoIXNvdXJjZUl0ZW1JZCB8fCByZXN1bHQuZmluZEluZGV4KGl0ZW0gPT4gaXRlbVtiaW5kaW5nTGlzdC5wcmltYXJ5S2V5XSA9PT0gc291cmNlSXRlbUlkKSA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgLy8g6YeN5paw5pig5bCE5b2T5YmN6KGMXG4gICAgICAgICAgICAgIHRoaXMubWFwcGluZ1JvdyhoZWFkSXRlbSwgbWFwcGluZ3MsIGN1cnJlbnRFbnRpdHksIGJpbmRpbmdQYXRoKTtcbiAgICAgICAgICAgICAgcmVzdWx0ID0gcmVzdWx0LnNsaWNlKDEpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChzb3VyY2VJdGVtSWQpIHtcbiAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSByZXN1bHQuZmluZEluZGV4KGl0ZW0gPT4gaXRlbVtiaW5kaW5nTGlzdC5wcmltYXJ5S2V5XSA9PT0gc291cmNlSXRlbUlkKTtcbiAgICAgICAgICAgICAgLy8g6YeN5paw5pig5bCE5b2T5YmN6KGMXG4gICAgICAgICAgICAgIHRoaXMubWFwcGluZ1JvdyhyZXN1bHRbaW5kZXhdLCBtYXBwaW5ncywgY3VycmVudEVudGl0eSwgYmluZGluZ1BhdGgpO1xuICAgICAgICAgICAgICByZXN1bHQuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIOW9k+WJjeihjOWkhOeQhuWujOaIkFxuICAgICAgICAgICAgLy8g5aSE55CG5pyq5pig5bCE55qE6KGMXG4gICAgICAgICAgICBjb25zdCBlbXB0eVJvd3MgPSBiaW5kaW5nTGlzdC50b0FycmF5KCkuZmlsdGVyKGJpbmRpbmdPYmplY3QgPT4ge1xuICAgICAgICAgICAgICBjb25zdCBpZCA9IHRoaXMuZ2V0VmFsdWVCeVBhdGgoYmluZGluZ09iamVjdCwgbWFwcGluZ3NbYmluZGluZ0xpc3QucHJpbWFyeUtleV0pO1xuICAgICAgICAgICAgICByZXR1cm4gIWlkO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAoZW1wdHlSb3dzICYmIGVtcHR5Um93cy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgIGxldCByb3dzID0gcmVzdWx0O1xuICAgICAgICAgICAgICBpZiAocmVzdWx0Lmxlbmd0aCA+IGVtcHR5Um93cy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICByb3dzID0gcmVzdWx0LnNsaWNlKDAsIGVtcHR5Um93cy5sZW5ndGgpO1xuICAgICAgICAgICAgICAgIHJlc3VsdCA9IHJlc3VsdC5zbGljZShlbXB0eVJvd3MubGVuZ3RoKTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBbXTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICByb3dzLmZvckVhY2goKGl0ZW0sIGluZGV4KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0SXRlbSA9IGVtcHR5Um93c1tpbmRleF07XG4gICAgICAgICAgICAgICAgY29uc3QgZW50aXR5ID0gdGhpcy5nZXRFbnRpdHlCeVBhdGgoZnJhbWVDb250ZXh0LCBiaW5kaW5nUGF0aHMsIHRhcmdldEl0ZW0ucHJpbWFyeUtleVZhbHVlKTtcbiAgICAgICAgICAgICAgICB0aGlzLm1hcHBpbmdSb3coaXRlbSwgbWFwcGluZ3MsIGVudGl0eSwgYmluZGluZ1BhdGgpO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIOWkhOeQhuWJqeS9meWLvumAiVxuICAgICAgICAgICAgcmVzdWx0LmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgICAgICAgICAgY29uc3QgZGVmYXVsdFZhbHVlID0ge307XG4gICAgICAgICAgICAgIE9iamVjdC5rZXlzKG1hcHBpbmdzKS5mb3JFYWNoKChwcm9wOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHRoaXMuZ2V0VmFsdWVCeVBhdGgoaXRlbSwgcHJvcCk7XG4gICAgICAgICAgICAgICAgY29uc3QgZmllbGRzID0gbWFwcGluZ3NbcHJvcF07XG4gICAgICAgICAgICAgICAgY29uc3QgZ3JvdXBzOiBhbnlbXSA9IGZpZWxkcy5zcGxpdCgnLCcpLmZpbHRlcihwID0+IHApO1xuICAgICAgICAgICAgICAgIGdyb3Vwcy5mb3JFYWNoKGdyb3VwID0+IHtcbiAgICAgICAgICAgICAgICAgIGNvbnN0IHBhdGhzID0gZ3JvdXAuc3BsaXQoJy4nKS5maWx0ZXIocCA9PiBwKTtcbiAgICAgICAgICAgICAgICAgIHRoaXMuc2V0VmFsdWVCeVBhdGgoZGVmYXVsdFZhbHVlLCBwYXRocy5qb2luKCcuJyksIHZhbHVlKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIGRlZmF1bHRWYWx1ZXMucHVzaChkZWZhdWx0VmFsdWUpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAoZGVmYXVsdFZhbHVlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgIHRoaXMuZm9ybUxvYWRpbmdTZXJ2aWNlLnNob3coKTtcbiAgICAgICAgICAgICAgY29uc3QgcGF0aCA9IHRoaXMuYnVpbGRQYXRoKGJpbmRpbmdQYXRoLCB0aGlzLnZpZXdNb2RlbC5iaW5kaW5nRGF0YS5saXN0LmN1cnJlbnRJZCk7XG4gICAgICAgICAgICAgIHRoaXMucmVwb3NpdG9yeS5iYXRjaEFwcGVuZEJ5UGF0aChwYXRoLCBkZWZhdWx0VmFsdWVzKS5waXBlKFxuICAgICAgICAgICAgICAgIHRhcCgoKSA9PiB0aGlzLmZvcm1Mb2FkaW5nU2VydmljZS5oaWRlKCkpXG4gICAgICAgICAgICAgICkuc3Vic2NyaWJlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9LCAxMDApO1xuICAgIHJldHVybiBvZih0cnVlKTtcbiAgfVxuICAvKipcbiAgICog5aSN5Yi25Li76KGo5pWw5o2uXG4gICAqIEBwYXJhbSBpZCDopoHlpI3liLbnmoTmlbDmja5pZFxuICAgKiBAcGFyYW0gZmllbGRzIOimgeWkjeWItueahOWtl+autVxuICAgKiBAZGVzY3JpcHRpb24g5LuF5pSv5oyB5aSN5Yi25Li76KGo5pWw5o2uXG4gICAqIEBkZXByZWNhdGVkIOivpeaWueazleW3suiiq+W6n+W8g++8jOivt+S9v+eUqGNsb25l5pa55rOV5pu/5Luj44CCXG4gICAqL1xuICBwdWJsaWMgY29weShpZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICBpZiAoIWlkKSB7XG4gICAgICB0aGlzLmZvcm1Ob3RpZnlTZXJ2aWNlLndhcm5pbmcodGhpcy5sYW5ndWFnZVNlcnZpY2UucGxzU2VsZWN0Q29weURhdGEsIHsgaGlkZVRpdGxlOiB0cnVlIH0pO1xuICAgICAgcmV0dXJuIEVNUFRZO1xuICAgIH1cblxuICAgIGNvbnN0IGJlZlJlcG9zaXRvcnkgPSB0aGlzLnJlcG9zaXRvcnkgYXMgQmVmUmVwb3NpdG9yeTxhbnk+O1xuICAgIGNvbnN0IGJhc2VVcmkgPSBiZWZSZXBvc2l0b3J5LnJlc3RTZXJ2aWNlLmJhc2VVcmk7XG4gICAgY29uc3QgdXJsID0gYCR7YmFzZVVyaX0vc2VydmljZS9jb3B5bWFpbm9ianZvYWN0aW9uYDtcbiAgICBjb25zdCByZXF1ZXN0SW5mbyA9IGJlZlJlcG9zaXRvcnkucmVzdFNlcnZpY2UuYnVpbGRSZXF1ZXN0SW5mbygpO1xuICAgIGNvbnN0IGJvZHkgPSB7XG4gICAgICByZXF1ZXN0SW5mbyxcbiAgICAgIGRhdGFJRDogaWRcbiAgICB9O1xuICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICBib2R5XG4gICAgfTtcbiAgICB0aGlzLmZvcm1Mb2FkaW5nU2VydmljZS5zaG93KCk7XG4gICAgcmV0dXJuIGJlZlJlcG9zaXRvcnkucHJveHkucmVxdWVzdCh1cmwsICdQVVQnLCBudWxsLCBvcHRpb25zKS5waXBlKFxuICAgICAgdGFwKCgpID0+IHtcbiAgICAgICAgdGhpcy5mb3JtTG9hZGluZ1NlcnZpY2UuaGlkZSgpO1xuICAgICAgfSksXG4gICAgICBtYXAoKHJlc3BvbnNlSW5mbzogUmVzcG9uc2VJbmZvKSA9PiB7XG4gICAgICAgIGNvbnN0IHJldHVyblZhbHVlID0gcmVzcG9uc2VJbmZvLnJldHVyblZhbHVlO1xuICAgICAgICBjb25zdCBlbnRpdHkgPSB0aGlzLnJlcG9zaXRvcnkuYnVpbGRFbnRpdHkocmV0dXJuVmFsdWUpO1xuICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5hZGRFbnRpdHkoZW50aXR5KTtcbiAgICAgICAgcmV0dXJuIGVudGl0eTtcbiAgICAgIH0pLFxuICAgICk7XG4gIH1cbiAgLyoqXG4gICAqIOWkjeWItuaVsOaNru+8iOaUr+aMgeS4u+ihqOOAgeS7juihqOOAgeS7juS7juihqO+8iVxuICAgKiBAcGFyYW0gaWQg6KaB5aSN5Yi255qE6KGMXG4gICAqIEBwYXJhbSBwYXRoIOivt+axgui3r+W+hFxuICAgKiBAcmV0dXJucyBcbiAgICovXG4gIHB1YmxpYyBjbG9uZShpZDogc3RyaW5nLCBwYXRoOiBzdHJpbmcpIHtcbiAgICBpZiAoIWlkKSB7XG4gICAgICB0aGlzLmZvcm1Ob3RpZnlTZXJ2aWNlLndhcm5pbmcodGhpcy5sYW5ndWFnZVNlcnZpY2UucGxzU2VsZWN0Q29weURhdGEsIHsgaGlkZVRpdGxlOiB0cnVlIH0pO1xuICAgICAgcmV0dXJuIEVNUFRZO1xuICAgIH1cbiAgICBpZiAoIXBhdGgpIHtcbiAgICAgIHRoaXMuZm9ybU5vdGlmeVNlcnZpY2Uud2FybmluZyh0aGlzLmxhbmd1YWdlU2VydmljZS5wYXRoSXNSZXF1aXJlZCwgeyBoaWRlVGl0bGU6IHRydWUgfSk7XG4gICAgICByZXR1cm4gRU1QVFk7XG4gICAgfVxuICAgIGlmICghcGF0aC5zdGFydHNXaXRoKCcvJykpIHtcbiAgICAgIHBhdGggPSAnLycgKyBwYXRoO1xuICAgIH1cbiAgICBwYXRoID0gcGF0aC50b0xvd2VyQ2FzZSgpO1xuICAgIGNvbnN0IGJpbmRpbmdQYXRoID0gdGhpcy52aWV3TW9kZWwuYmluZGluZ1BhdGg7XG4gICAgY29uc3QgYmVmUmVwb3NpdG9yeSA9IHRoaXMucmVwb3NpdG9yeSBhcyBCZWZSZXBvc2l0b3J5PGFueT47XG4gICAgY29uc3QgYmFzZVVyaSA9IGJlZlJlcG9zaXRvcnkucmVzdFNlcnZpY2UuYmFzZVVyaTtcbiAgICBjb25zdCB1cmwgPSBgJHtiYXNlVXJpfSR7cGF0aH1gO1xuICAgIGNvbnN0IHJlcXVlc3RJbmZvID0gYmVmUmVwb3NpdG9yeS5yZXN0U2VydmljZS5idWlsZFJlcXVlc3RJbmZvKCk7XG4gICAgY29uc3QgaWRzID0gdGhpcy5idWlsZElkcyhiaW5kaW5nUGF0aCk7XG4gICAgaWRzLnB1c2goaWQpO1xuICAgIGNvbnN0IGJvZHkgPSB7XG4gICAgICByZXF1ZXN0SW5mbyxcbiAgICAgIGRhdGFJRDogaWRzLmpvaW4oJywnKVxuICAgIH07XG4gICAgY29uc3Qgb3B0aW9ucyA9IHtcbiAgICAgIGJvZHlcbiAgICB9O1xuICAgIHRoaXMuZm9ybUxvYWRpbmdTZXJ2aWNlLnNob3coKTtcbiAgICByZXR1cm4gYmVmUmVwb3NpdG9yeS5wcm94eS5yZXF1ZXN0KHVybCwgJ1BVVCcsIG51bGwsIG9wdGlvbnMpLnBpcGUoXG4gICAgICB0YXAoKCkgPT4ge1xuICAgICAgICB0aGlzLmZvcm1Mb2FkaW5nU2VydmljZS5oaWRlKCk7XG4gICAgICB9KSxcbiAgICAgIG1hcCgocmVzcG9uc2VJbmZvOiBSZXNwb25zZUluZm8pID0+IHtcbiAgICAgICAgY29uc3QgcmV0dXJuVmFsdWUgPSByZXNwb25zZUluZm8ucmV0dXJuVmFsdWU7XG4gICAgICAgIGxldCBlbnRpdHkgPSBudWxsO1xuICAgICAgICBpZiAoYmluZGluZ1BhdGguc3BsaXQoJy8nKS5maWx0ZXIocCA9PiBwKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICBlbnRpdHkgPSB0aGlzLnJlcG9zaXRvcnkuYnVpbGRFbnRpdHkocmV0dXJuVmFsdWUpO1xuICAgICAgICAgIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmFkZEVudGl0eShlbnRpdHksIHRydWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnN0IGZwYXRoID0gdGhpcy5idWlsZFBhdGgoYmluZGluZ1BhdGgsIHRoaXMudmlld01vZGVsLmJpbmRpbmdEYXRhLmxpc3QuY3VycmVudElkKTtcbiAgICAgICAgICBlbnRpdHkgPSBiZWZSZXBvc2l0b3J5LmVudGl0eU1hbmFnZXIuYXBwZW5kRW50aXR5QnlQYXRoKGZwYXRoLCByZXR1cm5WYWx1ZSwgcmV0dXJuVmFsdWUsIHRydWUpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlbnRpdHk7XG4gICAgICB9KSxcbiAgICApO1xuICB9XG5cbiAgLy8jcmVnaW9uIOaXp+eahOWunueOsFxuXG4gIC8qKlxuICAgKiDlpI3liLbooYxcbiAgICogQHBhcmFtIGZyYW1lSWQgZnJhbWVJZFxuICAgKiBAcGFyYW0gaWdub3JlRmllbGRzIOWkjeWItuaXtuW/veeVpeWtl+autVxuICAgKiBAcGFyYW0gcmVwZWF0IOmHjeWkjeWkjeWItuasoeaVsO+8jOm7mOiupOS4ujFcbiAgICovXG4gIHB1YmxpYyBjb3B5Um93KGZyYW1lSWQ6IHN0cmluZywgaWdub3JlRmllbGRzOiBzdHJpbmcsIHJlcGVhdDogbnVtYmVyID0gMSkge1xuICAgIGlmICh0eXBlb2YgcmVwZWF0ICE9PSAnbnVtYmVyJykge1xuICAgICAgcmVwZWF0ID0gcGFyc2VJbnQocmVwZWF0LCAxMCk7XG4gICAgfVxuICAgIGlmIChyZXBlYXQgPCAxKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0FyZ3VtZW50RXJyb3I6IHJlcGVhdCBtdXN0ID49IDEnKTtcbiAgICB9XG4gICAgLy8g6I635Y+W5b2T5YmN6KGMXG4gICAgY29uc3QgZnJhbWVDb250ZXh0ID0gdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LmFwcENvbnRleHQuZnJhbWVDb250ZXh0TWFuYWdlci5nZXRGcmFtZUNvbnRleHRCeUlkKGZyYW1lSWQpO1xuICAgIGNvbnN0IHByaW1hcnlWYWx1ZSA9IGZyYW1lQ29udGV4dC5iaW5kaW5nRGF0YS5saXN0LmN1cnJlbnRJZDtcbiAgICBjb25zdCBiaW5kaW5nUGF0aCA9IGZyYW1lQ29udGV4dC52aWV3TW9kZWwuYmluZGluZ1BhdGggfHwgJy8nO1xuICAgIGxldCBiaW5kaW5nRGF0YSA9IG51bGw7XG4gICAgbGV0IGN1cnJlbnRJdGVtOiBCaW5kaW5nT2JqZWN0ID0gbnVsbDtcbiAgICBpZiAoYmluZGluZ1BhdGggPT09ICcvJykge1xuICAgICAgLy8g5Li76KGo55u05o6l5Y+W5b2T5YmN6KGMXG4gICAgICBjdXJyZW50SXRlbSA9IGZyYW1lQ29udGV4dC5iaW5kaW5nRGF0YS5saXN0LmN1cnJlbnRJdGVtO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyDlj5bku47ooagv5LuO5LuO6KGo5b2T5YmN6KGMXG4gICAgICBjb25zdCBwYXRocyA9IGJpbmRpbmdQYXRoLnNwbGl0KCcvJykuZmlsdGVyKHAgPT4gcCk7XG4gICAgICBjdXJyZW50SXRlbSA9IChmcmFtZUNvbnRleHQuYmluZGluZ0RhdGEuZ2V0VmFsdWUocGF0aHMpIGFzIEJpbmRpbmdMaXN0KS5jdXJyZW50SXRlbTtcbiAgICB9XG4gICAgYmluZGluZ0RhdGEgPSBjdXJyZW50SXRlbS50b0pTT04oKTtcbiAgICBpZiAoIWN1cnJlbnRJdGVtLnByaW1hcnlLZXlWYWx1ZSkge1xuICAgICAgaWYgKHRoaXMuZm9ybU5vdGlmeVNlcnZpY2UpIHtcbiAgICAgICAgdGhpcy5mb3JtTm90aWZ5U2VydmljZS53YXJuaW5nKHRoaXMubGFuZ3VhZ2VTZXJ2aWNlLnBsc1NlbGVjdENvcHlEYXRhLCB7IGhpZGVUaXRsZTogdHJ1ZSB9KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBFTVBUWTtcbiAgICB9XG4gICAgY29uc3QgaWdub3JlRmllbGRzQXJyYXkgPSBpZ25vcmVGaWVsZHMuc3BsaXQoJywnKS5maWx0ZXIoaXRlbSA9PiBpdGVtKTtcblxuICAgIGNvbnN0IHNvdXJjZXMgPSBuZXcgQXJyYXkocmVwZWF0KTtcbiAgICByZXR1cm4gZnJvbShzb3VyY2VzKS5waXBlKFxuICAgICAgY29uY2F0TWFwKCgpID0+IHtcbiAgICAgICAgbGV0IGFjdGlvbiQgPSBudWxsO1xuICAgICAgICBpZiAoYmluZGluZ1BhdGggIT09ICcvJykge1xuICAgICAgICAgIGNvbnN0IGZ1bGxQYXRoID0gdGhpcy5idWlsZFBhdGgoYmluZGluZ1BhdGgsIHByaW1hcnlWYWx1ZSk7XG4gICAgICAgICAgYWN0aW9uJCA9IHRoaXMucmVwb3NpdG9yeS5hcHBlbmRCeVBhdGgoZnVsbFBhdGgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGFjdGlvbiQgPSB0aGlzLnJlcG9zaXRvcnkuYXBwZW5kKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGFjdGlvbiQucGlwZShcbiAgICAgICAgICB0YXAoKGVudGl0eTogRW50aXR5KSA9PiB7XG4gICAgICAgICAgICAvLyDkv67mraPlrp7kvZPkuLvplK5cbiAgICAgICAgICAgIGJpbmRpbmdEYXRhW2VudGl0eS5wcmltYXJ5S2V5XSA9IGVudGl0eS5wcmltYXJ5VmFsdWU7XG4gICAgICAgICAgICAvLyDlv73nlaXmjIflrprlrZfmrrVcbiAgICAgICAgICAgIGlnbm9yZUZpZWxkc0FycmF5LmZvckVhY2goKGZpZWxkOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgICAgY29uc3QgZXh0cmFjdGVkRmllbGRzID0gZmllbGQuc3BsaXQoJy4nKS5maWx0ZXIoaXRlbSA9PiBpdGVtKTtcbiAgICAgICAgICAgICAgaWYgKGV4dHJhY3RlZEZpZWxkcy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgICAgICBkZWxldGUgYmluZGluZ0RhdGFbZmllbGRdO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGNvbnN0IHBhcmVudCA9IGV4dHJhY3RlZEZpZWxkcy5zbGljZSgwLCAtMSkucmVkdWNlKChwcmV2LCBjdXJyZW50LCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBwcmV2W2N1cnJlbnRdO1xuICAgICAgICAgICAgICB9LCBiaW5kaW5nRGF0YSk7XG4gICAgICAgICAgICAgIGRlbGV0ZSBwYXJlbnRbZXh0cmFjdGVkRmllbGRzW2V4dHJhY3RlZEZpZWxkcy5sZW5ndGggLSAxXV07XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGJpbmRpbmdEYXRhID0gT2JqZWN0LmFzc2lnbih7fSwgZW50aXR5LnRvSlNPTigpLCBiaW5kaW5nRGF0YSk7XG4gICAgICAgICAgICBlbnRpdHkubG9hZChiaW5kaW5nRGF0YSwgeyBsb2FkQ2hpbGQ6IGZhbHNlIH0pO1xuICAgICAgICAgIH0pLFxuICAgICAgICAgIGNhdGNoRXJyb3IoKCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIEVNUFRZO1xuICAgICAgICAgIH0pXG4gICAgICAgICk7XG4gICAgICB9KVxuICAgICk7XG4gIH1cbiAgLyoqXG4gICAqIOWinumHj+WkmumAieW4ruWKqeaJuemHj+i1i+WAvOW4ruWKqeWQjuS6i+S7tlxuICAgKiBAcGFyYW0gZnJhbWVJZCBmcmFtZUlkXG4gICAqIEBwYXJhbSBtYXBGaWVsZHMg5a2X5q615pig5bCEXG4gICAqIEBwYXJhbSBhc3NvY2lhdGVkRmllbGQg5YWz6IGU5a2X5q61XG4gICAqL1xuICBwdWJsaWMgYWZ0ZXJJbmNyZW1lbnRhbFNlbGVjdEhlbHBDbG9zZShmcmFtZUlkOiBzdHJpbmcsIG1hcEZpZWxkczogc3RyaW5nLCBhc3NvY2lhdGVkRmllbGQ6IHN0cmluZykge1xuICAgIGNvbnN0IHNlbGY6IGFueSA9IHRoaXM7XG4gICAgY29uc3QgcmVzdWx0ID0gc2VsZi5jb250ZXh0ICYmIHNlbGYuY29udGV4dC5ldmVudFBhcmFtIHx8IFtdO1xuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogbWF4LWxpbmUtbGVuZ3RoXG4gICAgLy8gY29uc3QgbWFwcGluZyA9ICd7XCJpZFwiOlwidXNlclJlZi51c2VyUmVmXCIsIFwibmFtZVwiOlwibmFtZVwiLCBcInNleFwiOlwic2V4XCIsXCJhZ2VcIjpcInVzZXJSZWYudXNlclJlZl9BZ2VcIixcImFkZHJlc3NcIjpcInVzZXJSZWYudXNlclJlZl9BZGRyZXNzXCIsXCJiaXJ0aGRheVwiOlwidXNlclJlZi51c2VyUmVmX0JpcnRoZGF5XCIsXCJoZWlnaHRcIjpcInVzZXJSZWYudXNlclJlZl9IZWlnaHRcIixcImlzTWFycmllZFwiOlwidXNlclJlZi51c2VyUmVmX0lzTWFycmllZFwifSc7XG4gICAgaWYgKCFhc3NvY2lhdGVkRmllbGQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignYXNzb2NpYXRlZCBmaWVsZCBjYW5gdCBiZSBlbXB0eS4nKTtcbiAgICB9XG4gICAgaWYgKCFtYXBGaWVsZHMpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignbWFwRmllbGRzIGNhbmB0IGJlIGVtcHR5LicpO1xuICAgIH1cbiAgICBjb25zdCBtYXBwaW5ncyA9IEpTT04ucGFyc2UobWFwRmllbGRzKTtcbiAgICBjb25zdCBmb3JlaWduS2V5ID0gYXNzb2NpYXRlZEZpZWxkO1xuICAgIC8vIOWwhumAieaLqeS6uuWRmOS/neWtmOWIsHVpc3RhdGXkuK1cbiAgICBjb25zdCByb290RnJhbWVDb250ZXh0ID0gdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LnJvb3Q7XG4gICAgLy8g5LiN5pivYmluZGluZ1BhdGjliJnmjIlmcmFtZUlk5aSE55CGXG4gICAgbGV0IGJpbmRpbmdQYXRoID0gJy8nO1xuICAgIGNvbnN0IGFwcENvbnRleHQgPSB0aGlzLmluamVjdG9yLmdldDxBcHBDb250ZXh0PihBcHBDb250ZXh0LCBudWxsKTtcbiAgICBpZiAoYXBwQ29udGV4dCkge1xuICAgICAgY29uc3QgZnJhbWVDb250ZXh0ID0gYXBwQ29udGV4dC5mcmFtZUNvbnRleHRNYW5hZ2VyLmdldEZyYW1lQ29udGV4dEJ5SWQoZnJhbWVJZCk7XG4gICAgICBpZiAoZnJhbWVDb250ZXh0KSB7XG4gICAgICAgIGJpbmRpbmdQYXRoID0gZnJhbWVDb250ZXh0LnZpZXdNb2RlbC5iaW5kaW5nUGF0aCB8fCAnLyc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ZyYW1lSWQgaXMgaW52YWxpZCEnKTtcbiAgICAgIH1cbiAgICB9XG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBuby1zdHJpbmctbGl0ZXJhbFxuICAgIHJvb3RGcmFtZUNvbnRleHQudWlTdGF0ZVsnc2VsZWN0aW9ucyddID0gcmVzdWx0O1xuICAgIGlmIChyZXN1bHQgJiYgQXJyYXkuaXNBcnJheShyZXN1bHQpKSB7XG4gICAgICAvLyDmoLnmja5iaW5kaW5nUGF0aOiOt+WPlmJpbmRpbmdkYXRh5Lit546w5pyJ5pWw5o2uXG4gICAgICBjb25zdCBiaW5kaW5nUGF0aHMgPSBiaW5kaW5nUGF0aC5zcGxpdCgnLycpLmZpbHRlcihpdGVtID0+IGl0ZW0pO1xuICAgICAgY29uc3QgY3VycmVudERhdGE6IEJpbmRpbmdMaXN0ID0gdGhpcy52aWV3TW9kZWwuYmluZGluZ0RhdGEuZ2V0VmFsdWUoYmluZGluZ1BhdGhzKTtcbiAgICAgIGNvbnN0IGN1cnJlbnREYXRhQXJyYXkgPSBjdXJyZW50RGF0YS50b0FycmF5KCk7XG4gICAgICAvLyDmib7liLByZXN1bHTkuK3mnInvvIzkvYZiaW5kaW5nRGF0YeS4reayoeacieeahO+8jOS4uuW+heaWsOWinumhuVxuICAgICAgY29uc3QgYXBwZW5kcyA9IFtdO1xuICAgICAgcmVzdWx0LnJlZHVjZSgocHJldjogQXJyYXk8YW55PiwgaXRlbSkgPT4ge1xuICAgICAgICBjb25zdCBpdGVtSWQgPSBpdGVtICYmIGl0ZW1bY3VycmVudERhdGEucHJpbWFyeUtleV0gfHwgbnVsbDtcbiAgICAgICAgY29uc3QgaXNFeGlzdCA9IGN1cnJlbnREYXRhQXJyYXkuZmluZCgoYmluZGluZ09iamVjdDogQmluZGluZ09iamVjdCkgPT4gYmluZGluZ09iamVjdFtmb3JlaWduS2V5XVtmb3JlaWduS2V5XSA9PT0gaXRlbUlkKTtcbiAgICAgICAgaWYgKCFpc0V4aXN0KSB7XG4gICAgICAgICAgcHJldi5wdXNoKGl0ZW0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBwcmV2O1xuICAgICAgfSwgYXBwZW5kcyk7XG5cbiAgICAgIC8vIOaJvuWIsGJpbmRpbmdEYXRh5Lit5pyJ77yMcmVzdWx05Lit5rKh5pyJ55qE77yM5Li65b6F5Yig6Zmk6aG5XG4gICAgICBjb25zdCByZW1vdmVzID0gW107XG4gICAgICBjdXJyZW50RGF0YUFycmF5LnJlZHVjZSgocmVzdWx0czogYW55LCBpdGVtOiBCaW5kaW5nT2JqZWN0KSA9PiB7XG4gICAgICAgIGNvbnN0IGluZGV4ID0gcmVzdWx0LmZpbmRJbmRleChzZWxlY3RJdGVtID0+IHNlbGVjdEl0ZW1bY3VycmVudERhdGEucHJpbWFyeUtleV0gPT09IGl0ZW1bZm9yZWlnbktleV1bZm9yZWlnbktleV0pO1xuICAgICAgICBpZiAoaW5kZXggPT09IC0xKSB7XG4gICAgICAgICAgcmVzdWx0cy5wdXNoKGl0ZW0ucHJpbWFyeUtleVZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzdWx0cztcbiAgICAgIH0sIHJlbW92ZXMpO1xuXG4gICAgICAvLyBjb25zb2xlLmxvZygnYWRkSXRlbXMnLCBhcHBlbmRzLCAncmVtb3ZlSXRlbXMnLCByZW1vdmVzKTtcbiAgICAgIC8vIOiwg+eUqOWQjuerr+aOpeWPo+aWsOWinuaVsOaNrlxuICAgICAgY29uc3QgYWRkQWN0aW9uJCA9IGZyb20oYXBwZW5kcykucGlwZShcbiAgICAgICAgY29uY2F0TWFwKGl0ZW0gPT4ge1xuICAgICAgICAgIGNvbnN0IHBhdGggPSB0aGlzLmJ1aWxkUGF0aChiaW5kaW5nUGF0aCwgdGhpcy52aWV3TW9kZWwuYmluZGluZ0RhdGEubGlzdC5jdXJyZW50SWQpO1xuICAgICAgICAgIHJldHVybiB0aGlzLnJlcG9zaXRvcnkuYXBwZW5kQnlQYXRoKHBhdGgpLnBpcGUoXG4gICAgICAgICAgICB0YXAoKGVudGl0eTogRW50aXR5KSA9PiB7XG4gICAgICAgICAgICAgIE9iamVjdC5rZXlzKG1hcHBpbmdzKS5mb3JFYWNoKHByb3AgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gdGhpcy5nZXRWYWx1ZUJ5UGF0aChpdGVtLCBwcm9wKTtcbiAgICAgICAgICAgICAgICBjb25zdCBmaWVsZHMgPSBtYXBwaW5nc1twcm9wXTtcbiAgICAgICAgICAgICAgICBjb25zdCBncm91cHM6IGFueVtdID0gZmllbGRzLnNwbGl0KCcsJykuZmlsdGVyKHAgPT4gcCk7XG4gICAgICAgICAgICAgICAgZ3JvdXBzLmZvckVhY2goZ3JvdXAgPT4ge1xuICAgICAgICAgICAgICAgICAgY29uc3QgcGF0aHMgPSBncm91cC5zcGxpdCgnLicpLmZpbHRlcihwID0+IHApO1xuICAgICAgICAgICAgICAgICAgdGhpcy5zZXRWYWx1ZUJ5UGF0aChlbnRpdHksIHBhdGhzLmpvaW4oJy4nKSwgdmFsdWUpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgY2F0Y2hFcnJvcigoKSA9PiB7XG4gICAgICAgICAgICAgIHJldHVybiBFTVBUWTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgKTtcbiAgICAgICAgfSlcbiAgICAgICk7XG5cbiAgICAgIGNvbnN0IHJlbW92ZUFjdGlvbiQgPSBmcm9tKHJlbW92ZXMpLnBpcGUoXG4gICAgICAgIGNvbmNhdE1hcChpdGVtID0+IHtcbiAgICAgICAgICBjb25zdCBwYXRoID0gdGhpcy5idWlsZFBhdGgoYmluZGluZ1BhdGgsIHRoaXMudmlld01vZGVsLmJpbmRpbmdEYXRhLmxpc3QuY3VycmVudElkKTtcbiAgICAgICAgICByZXR1cm4gdGhpcy5yZXBvc2l0b3J5LnJlbW92ZUJ5UGF0aChwYXRoLCBpdGVtKS5waXBlKFxuICAgICAgICAgICAgdGFwKCgpID0+IHtcbiAgICAgICAgICAgICAgY29uc3QgYmVmUmVwb3NpdG9yeTogQmVmUmVwb3NpdG9yeTxhbnk+ID0gdGhpcy5yZXBvc2l0b3J5IGFzIEJlZlJlcG9zaXRvcnk8YW55PjtcbiAgICAgICAgICAgICAgYmVmUmVwb3NpdG9yeS5lbnRpdHlNYW5hZ2VyLnJlbW92ZUVudGl0eUJ5UGF0aChwYXRoLCBpdGVtKTtcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgY2F0Y2hFcnJvcigoKSA9PiB7XG4gICAgICAgICAgICAgIHJldHVybiBFTVBUWTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgKTtcbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgICBpZiAoIWFwcGVuZHMgJiYgIXJlbW92ZXMgfHwgYXBwZW5kcyAmJiBhcHBlbmRzLmxlbmd0aCA8IDEgJiYgcmVtb3ZlcyAmJiByZW1vdmVzLmxlbmd0aCA8IDEpIHtcbiAgICAgICAgcmV0dXJuIG9mKHRydWUpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGNvbmNhdChhZGRBY3Rpb24kLCByZW1vdmVBY3Rpb24kKS5waXBlKFxuICAgICAgICBjYXRjaEVycm9yKCgpID0+IEVNUFRZKVxuICAgICAgKTtcbiAgICB9XG4gICAgcmV0dXJuIG9mKHRydWUpO1xuICB9XG4gIC8vIHRvZG865qih5ouf55So5oi35pON5L2c77yM5b6F5ZCO56uv5o6l5Y+j5pSv5oyB5Li76KGo5om56YeP5paw5aKe5ZCO6YeN5YaZXG4gIC8qKlxuICAgKiDlpJrpgInluK7liqnmibnph4/otYvlgLzluK7liqnliY3kuovku7ZcbiAgICovXG4gIHB1YmxpYyBiZWZvcmVNdWx0aVNlbGVjdEhlbHBPcGVuKCkge1xuICAgIHJldHVybiB0aGlzLmNsZWFySGVscFNlbGVjdGlvbnMoKTtcbiAgfVxuICAvKipcbiAgICog5aSa6YCJ5biu5Yqp5om56YeP6LWL5YC85biu5Yqp5ZCO5LqL5Lu2XG4gICAqIEBwYXJhbSBmcmFtZUlkIOe7keWumui3r+W+hFxuICAgKiBAcGFyYW0gbWFwRmllbGRzIOWtl+auteaYoOWwhFxuICAgKiBAcGFyYW0gY29tbWFuZEZyYW1lSWQg5Zue6LCD5ZG95Luk5omA5ZyoZnJhbWVJZFxuICAgKiBAcGFyYW0gY29tbWFuZE5hbWUg5Zue6LCD5ZG95LukXG4gICAqIEBkZXByZWNhdGVkIOaooeaLn+eUqOaIt+aTjeS9nO+8jOW+heaJuemHj+i1i+WAvOaUr+aMgeS4u+ihqOWQjuW6n+W8g1xuICAgKi9cbiAgcHVibGljIGFmdGVyTXVsdGlTZWxlY3RIZWxwQ2xvc2UoZnJhbWVJZDogc3RyaW5nLCBtYXBGaWVsZHM6IHN0cmluZywgY29tbWFuZEZyYW1lSWQ/OiBzdHJpbmcsIGNvbW1hbmROYW1lPzogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2VsZjogYW55ID0gdGhpcztcbiAgICBjb25zdCByZXN1bHQgPSBzZWxmLmNvbnRleHQgJiYgc2VsZi5jb250ZXh0LmV2ZW50UGFyYW0gfHwgW107XG4gICAgaWYgKHJlc3VsdCAmJiBBcnJheS5pc0FycmF5KHJlc3VsdCkpIHtcbiAgICAgIC8vIOiwg+eUqOWQjuerr+aOpeWPo+aWsOWinuaVsOaNrlxuICAgICAgaWYgKCFyZXN1bHQgfHwgcmVzdWx0Lmxlbmd0aCA8IDEpIHtcbiAgICAgICAgcmV0dXJuIG9mKHRydWUpO1xuICAgICAgfVxuICAgICAgdGhpcy5vbkhlbHBDbG9zZS5uZXh0KHsgZnJhbWVJZCwgbWFwRmllbGRzLCBkYXRhOiByZXN1bHQsIGNvbW1hbmRGcmFtZUlkLCBjb21tYW5kTmFtZSB9KTtcbiAgICAgIHJldHVybiBvZih0cnVlKTtcbiAgICB9XG4gICAgcmV0dXJuIG9mKHRydWUpO1xuICB9XG4gIC8qKlxuICAgICog5biu5Yqp5YWz6Zet5ZCO5aSE55CG5ZmoXG4gICAgKiBAcGFyYW0gZnJhbWVJZCBmcmFtZWlkXG4gICAgKiBAcGFyYW0gbWFwRmllbGRzIG1hcEZpZWxkc1xuICAgICogQHBhcmFtIHJlc3VsdCDluK7liqnmlbDmja7nu5PmnpxcbiAgICAqL1xuICBwcml2YXRlIG9uSGVscENsb3NlSGFuZGxlcihmcmFtZUlkOiBzdHJpbmcsIG1hcEZpZWxkczogc3RyaW5nLCByZXN1bHQ6IGFueVtdKSB7XG4gICAgaWYgKCFtYXBGaWVsZHMpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignbWFwRmllbGRzIGNhbmB0IGJlIGVtcHR5LicpO1xuICAgIH1cbiAgICBjb25zdCBtYXBwaW5ncyA9IEpTT04ucGFyc2UobWFwRmllbGRzKTtcbiAgICAvLyDkuI3mmK9iaW5kaW5nUGF0aOWImeaMiWZyYW1lSWTlpITnkIZcbiAgICBsZXQgYmluZGluZ1BhdGggPSAnLyc7XG4gICAgY29uc3QgYXBwQ29udGV4dCA9IHRoaXMuaW5qZWN0b3IuZ2V0PEFwcENvbnRleHQ+KEFwcENvbnRleHQsIG51bGwpO1xuICAgIGlmIChhcHBDb250ZXh0KSB7XG4gICAgICBjb25zdCBmcmFtZUNvbnRleHQgPSBhcHBDb250ZXh0LmZyYW1lQ29udGV4dE1hbmFnZXIuZ2V0RnJhbWVDb250ZXh0QnlJZChmcmFtZUlkKTtcbiAgICAgIGlmIChmcmFtZUNvbnRleHQpIHtcbiAgICAgICAgYmluZGluZ1BhdGggPSBmcmFtZUNvbnRleHQudmlld01vZGVsLmJpbmRpbmdQYXRoIHx8ICcvJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignZnJhbWVJZCBpcyBpbnZhbGlkIScpO1xuICAgICAgfVxuICAgIH1cbiAgICAvLyDlsIbpgInmi6nkurrlkZjkv53lrZjliLB1aXN0YXRl5LitXG4gICAgY29uc3Qgcm9vdEZyYW1lQ29udGV4dCA9IHRoaXMudmlld01vZGVsLmZyYW1lQ29udGV4dC5yb290O1xuICAgIGNvbnN0IGJlZlJlcG9zaXRvcnkgPSB0aGlzLnJlcG9zaXRvcnkgYXMgQmVmUmVwb3NpdG9yeTxhbnk+O1xuICAgIGNvbnN0IGJpbmRpbmdQYXRocyA9IGJpbmRpbmdQYXRoLnNwbGl0KCcvJykuZmlsdGVyKHAgPT4gcCk7XG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBuby1zdHJpbmctbGl0ZXJhbFxuICAgIHJvb3RGcmFtZUNvbnRleHQudWlTdGF0ZVsnc2VsZWN0aW9ucyddID0gcmVzdWx0O1xuICAgIGlmIChyZXN1bHQgJiYgQXJyYXkuaXNBcnJheShyZXN1bHQpKSB7XG4gICAgICBjb25zdCBhZGRBY3Rpb24kID0gZnJvbShyZXN1bHQpLnBpcGUoXG4gICAgICAgIGNvbmNhdE1hcChpdGVtID0+IHtcbiAgICAgICAgICBjb25zdCByZXF1ZXN0SW5mbyA9IGJlZlJlcG9zaXRvcnkucmVzdFNlcnZpY2UuYnVpbGRSZXF1ZXN0SW5mbygpO1xuICAgICAgICAgIGlmIChiaW5kaW5nUGF0aHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgY29uc3QgcGF0aCA9IHRoaXMuYnVpbGRQYXRoKGJpbmRpbmdQYXRoLCB0aGlzLnZpZXdNb2RlbC5iaW5kaW5nRGF0YS5saXN0LmN1cnJlbnRJZCk7XG4gICAgICAgICAgICByZXR1cm4gYmVmUmVwb3NpdG9yeS5yZXN0U2VydmljZS5jcmVhdGVCeVBhdGgocGF0aCwgcmVxdWVzdEluZm8pLnBpcGUoXG4gICAgICAgICAgICAgIHRhcCgocmVzcG9uc2VJbmZvOiBSZXNwb25zZUluZm8pID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gcmVzcG9uc2VJbmZvLnJldHVyblZhbHVlO1xuICAgICAgICAgICAgICAgIGNvbnN0IG5ld0VudGl0eSA9IGJlZlJlcG9zaXRvcnkuZW50aXR5TWFuYWdlci5hcHBlbmRFbnRpdHlCeVBhdGgocGF0aCwgZGF0YSwgZGF0YSk7XG4gICAgICAgICAgICAgICAgT2JqZWN0LmtleXMobWFwcGluZ3MpLmZvckVhY2gocHJvcCA9PiB7XG4gICAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHRoaXMuZ2V0VmFsdWVCeVBhdGgoaXRlbSwgcHJvcCk7XG4gICAgICAgICAgICAgICAgICBjb25zdCBmaWVsZHMgPSBtYXBwaW5nc1twcm9wXTtcbiAgICAgICAgICAgICAgICAgIGNvbnN0IGdyb3VwczogYW55W10gPSBmaWVsZHMuc3BsaXQoJywnKS5maWx0ZXIocCA9PiBwKTtcbiAgICAgICAgICAgICAgICAgIGdyb3Vwcy5mb3JFYWNoKGdyb3VwID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcGF0aHMgPSBncm91cC5zcGxpdCgnLicpLmZpbHRlcihwID0+IHApO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFZhbHVlQnlQYXRoKG5ld0VudGl0eSwgcGF0aHMuam9pbignLicpLCB2YWx1ZSk7XG4gICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3RW50aXR5O1xuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGJlZlJlcG9zaXRvcnkucmVzdFNlcnZpY2UuY3JlYXRlKG51bGwsIHJlcXVlc3RJbmZvKS5waXBlKFxuICAgICAgICAgICAgICB0YXAoKHJlc3BvbnNlSW5mbzogUmVzcG9uc2VJbmZvKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IHJlc3BvbnNlSW5mby5yZXR1cm5WYWx1ZTtcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdFbnRpdHkgPSB0aGlzLnJlcG9zaXRvcnkuYnVpbGRFbnRpdHkoZGF0YSk7XG4gICAgICAgICAgICAgICAgT2JqZWN0LmtleXMobWFwcGluZ3MpLmZvckVhY2gocHJvcCA9PiB7XG4gICAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHRoaXMuZ2V0VmFsdWVCeVBhdGgoaXRlbSwgcHJvcCk7XG4gICAgICAgICAgICAgICAgICBjb25zdCBmaWVsZHMgPSBtYXBwaW5nc1twcm9wXTtcbiAgICAgICAgICAgICAgICAgIGNvbnN0IGdyb3VwczogYW55W10gPSBmaWVsZHMuc3BsaXQoJywnKS5maWx0ZXIocCA9PiBwKTtcbiAgICAgICAgICAgICAgICAgIGdyb3Vwcy5mb3JFYWNoKGdyb3VwID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcGF0aHMgPSBncm91cC5zcGxpdCgnLicpLmZpbHRlcihwID0+IHApO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFZhbHVlQnlQYXRoKG5ld0VudGl0eSwgcGF0aHMuam9pbignLicpLCB2YWx1ZSk7XG4gICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5hZGRFbnRpdHkobmV3RW50aXR5KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3RW50aXR5O1xuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICApO1xuICAgICAgLy8gY29uc3QgZm9ybUxvYWRpbmdTZXJ2aWNlID0gdGhpcy5pbmplY3Rvci5nZXQ8Rm9ybUxvYWRpbmdTZXJ2aWNlPihGb3JtTG9hZGluZ1NlcnZpY2UsIG51bGwpO1xuICAgICAgaWYgKHRoaXMuZm9ybUxvYWRpbmdTZXJ2aWNlKSB7XG4gICAgICAgIHRoaXMuc3VzcGVuZEZyYW1lQ29udGV4dEV2ZW50KGZyYW1lSWQpO1xuICAgICAgICB0aGlzLmZvcm1Mb2FkaW5nU2VydmljZS5zaG93KCk7XG4gICAgICAgIHRoaXMuZm9ybUxvYWRpbmdTZXJ2aWNlLnNldFN1c3BlbmQodHJ1ZSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gYWRkQWN0aW9uJC5waXBlKFxuICAgICAgICBsYXN0KCksXG4gICAgICApLnBpcGUoXG4gICAgICAgIHN3aXRjaE1hcCgoKSA9PiB7XG4gICAgICAgICAgY29uc3QgcHJpbWFyeVZhbHVlID0gdGhpcy52aWV3TW9kZWwuYmluZGluZ0RhdGEubGlzdC5jdXJyZW50SWQ7XG4gICAgICAgICAgaWYgKHByaW1hcnlWYWx1ZSkge1xuICAgICAgICAgICAgcmV0dXJuIGJlZlJlcG9zaXRvcnkudXBkYXRlQ2hhbmdlc0J5SWQocHJpbWFyeVZhbHVlKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIG9mKG51bGwpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICkuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgaWYgKHRoaXMuZm9ybUxvYWRpbmdTZXJ2aWNlKSB7XG4gICAgICAgICAgdGhpcy5yZXN1bWVGcmFtZUNvbnRleHRFdmVudChmcmFtZUlkKTtcbiAgICAgICAgICB0aGlzLmZvcm1Mb2FkaW5nU2VydmljZS5zZXRTdXNwZW5kKGZhbHNlKTtcbiAgICAgICAgICB0aGlzLmZvcm1Mb2FkaW5nU2VydmljZS5oaWRlKCk7XG4gICAgICAgIH1cbiAgICAgIH0sICgpID0+IHtcbiAgICAgICAgaWYgKHRoaXMuZm9ybUxvYWRpbmdTZXJ2aWNlKSB7XG4gICAgICAgICAgdGhpcy5yZXN1bWVGcmFtZUNvbnRleHRFdmVudChmcmFtZUlkKTtcbiAgICAgICAgICB0aGlzLmZvcm1Mb2FkaW5nU2VydmljZS5zZXRTdXNwZW5kKGZhbHNlKTtcbiAgICAgICAgICB0aGlzLmZvcm1Mb2FkaW5nU2VydmljZS5oaWRlKCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gb2YobnVsbCk7XG4gIH1cbiAgcHJpdmF0ZSBzdXNwZW5kRnJhbWVDb250ZXh0RXZlbnQoZnJhbWVJZDogc3RyaW5nKSB7XG4gICAgY29uc3QgYXBwQ29udGV4dCA9IHRoaXMuaW5qZWN0b3IuZ2V0PEFwcENvbnRleHQ+KEFwcENvbnRleHQsIG51bGwpO1xuICAgIGlmIChhcHBDb250ZXh0KSB7XG4gICAgICBjb25zdCBmcmFtZUNvbnRleHQgPSBhcHBDb250ZXh0LmZyYW1lQ29udGV4dE1hbmFnZXIuZ2V0RnJhbWVDb250ZXh0QnlJZChmcmFtZUlkKTtcbiAgICAgIGZyYW1lQ29udGV4dC5zdXNwZW5kID0gdHJ1ZTtcbiAgICB9XG4gIH1cbiAgcHJpdmF0ZSByZXN1bWVGcmFtZUNvbnRleHRFdmVudChmcmFtZUlkOiBzdHJpbmcpIHtcbiAgICBjb25zdCBhcHBDb250ZXh0ID0gdGhpcy5pbmplY3Rvci5nZXQ8QXBwQ29udGV4dD4oQXBwQ29udGV4dCwgbnVsbCk7XG4gICAgaWYgKGFwcENvbnRleHQpIHtcbiAgICAgIGNvbnN0IGZyYW1lQ29udGV4dCA9IGFwcENvbnRleHQuZnJhbWVDb250ZXh0TWFuYWdlci5nZXRGcmFtZUNvbnRleHRCeUlkKGZyYW1lSWQpO1xuICAgICAgZnJhbWVDb250ZXh0LnN1c3BlbmQgPSBmYWxzZTtcbiAgICAgIGZyYW1lQ29udGV4dC5hcHBDb250ZXh0Lm1lc3NhZ2VQaXBlLm5leHQoJ2JpbmREYXRhJyk7XG4gICAgfVxuICB9XG5cbiAgLy8jZW5kcmVnaW9uXG4gIHByaXZhdGUgc2V0VmFsdWVCeVBhdGgodGFyZ2V0OiBvYmplY3QsIHBhdGg6IHN0cmluZywgdmFsdWU6IGFueSkge1xuICAgIGlmICh0YXJnZXQpIHtcbiAgICAgIGNvbnN0IHBhdGhzID0gcGF0aC5zcGxpdCgnLicpO1xuICAgICAgaWYgKHBhdGhzLmxlbmd0aCA8PSAxKSB7XG4gICAgICAgIHRhcmdldFtwYXRoXSA9IHZhbHVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcGF0aHMuc2xpY2UoMCwgLTEpLnJlZHVjZSgocHJldiwgcGF0aCkgPT4ge1xuICAgICAgICAgIGlmICghKHByZXYuaGFzT3duUHJvcGVydHkocGF0aCkgfHwgcHJldlsnX19wcm90b19fJ10uaGFzT3duUHJvcGVydHkocGF0aCkpKSB7XG4gICAgICAgICAgICBwcmV2W3BhdGhdID0ge307XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBwcmV2W3BhdGhdO1xuICAgICAgICB9LCB0YXJnZXQpW3BhdGhzW3BhdGhzLmxlbmd0aCAtIDFdXSA9IHZhbHVlO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBwcml2YXRlIGdldFZhbHVlQnlQYXRoKHRhcmdldDogb2JqZWN0LCBwYXRoOiBzdHJpbmcpIHtcbiAgICBjb25zdCBwYXRocyA9IHBhdGguc3BsaXQoJy4nKTtcbiAgICBpZiAocGF0aHMubGVuZ3RoIDwgMSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAocGF0aHMubGVuZ3RoID09PSAxKSB7XG4gICAgICByZXR1cm4gdGFyZ2V0W3BhdGhdO1xuICAgIH1cbiAgICBsZXQgcmVzdWx0ID0gbnVsbDtcbiAgICBwYXRocy5mb3JFYWNoKChwcm9wLCBpbmRleCkgPT4ge1xuICAgICAgaWYgKGluZGV4ID09PSAwKSB7XG4gICAgICAgIHJlc3VsdCA9IHRhcmdldCAmJiB0YXJnZXRbcHJvcF0gfHwgbnVsbDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiByZXN1bHRbcHJvcF0gfHwgbnVsbDtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG4gIC8qKlxuICAgKiDmnoTpgKDlrZDooajot6/lvoRcbiAgICogQHBhcmFtIGJpbmRpbmdQYXRoIOe7keWumui3r+W+hFxuICAgKiBAcGFyYW0gaWQgaWRcbiAgICovXG4gIHByaXZhdGUgYnVpbGRQYXRoKGJpbmRpbmdQYXRoOiBzdHJpbmcsIGlkOiBhbnkpIHtcbiAgICBsZXQgcGF0aCA9ICcvJyArIGlkO1xuICAgIGNvbnN0IHN1YlBhdGhzID0gYmluZGluZ1BhdGguc3BsaXQoJy8nKTtcbiAgICBpZiAoc3ViUGF0aHMubGVuZ3RoID4gMCkge1xuICAgICAgLy8gZWc6YmluZGluZ1BhdGjlvaLlpoIvZWR1cy9ncmFkZXMsc3BsaXTlkI7mmK9bJycsICdlZHVzJywgJ2dyYWRlcyddXG4gICAgICAvLyDlm6DmraRpbmRleOS7jjHlvIDlp4tcbiAgICAgIGZvciAobGV0IGluZGV4ID0gMTsgaW5kZXggPCBzdWJQYXRocy5sZW5ndGggLSAxOyBpbmRleCsrKSB7XG4gICAgICAgIGNvbnN0IHN1YlBhdGggPSBzdWJQYXRoc1tpbmRleF07XG4gICAgICAgIGNvbnN0IHN1YkRhdGEgPSB0aGlzLnZpZXdNb2RlbC5iaW5kaW5nRGF0YVtzdWJQYXRoXTtcbiAgICAgICAgaWYgKCFzdWJEYXRhIHx8ICFzdWJEYXRhLmN1cnJlbnRJZCkge1xuICAgICAgICAgIHRocm93IEVycm9yKGDojrflj5blrZDooajlrozmlbTot6/lvoTlh7rplJnvvIzmib7kuI3liLAke3N1YkRhdGF95a+55bqU55qE5a2Q6KGo77yM5oiW5a+55bqU5a2Q6KGo5rKh5pyJ5b2T5YmN6KGM44CCYCk7XG4gICAgICAgIH1cbiAgICAgICAgcGF0aCArPSBgLyR7c3ViUGF0aH0vJHtzdWJEYXRhLmN1cnJlbnRJZH1gO1xuICAgICAgfVxuICAgIH1cbiAgICBwYXRoICs9ICcvJyArIHN1YlBhdGhzW3N1YlBhdGhzLmxlbmd0aCAtIDFdO1xuXG4gICAgcmV0dXJuIHBhdGg7XG4gIH1cbiAgLyoqXG4gICAqIOiOt+WPlue7keWumui3r+W+hOeahOW9k+WJjeihjOaVsOe7hFxuICAgKiBAcGFyYW0gYmluZGluZ1BhdGggYmluZGluZ1BhdGhcbiAgICogQHJldHVybnMgXG4gICAqL1xuICBwcml2YXRlIGJ1aWxkSWRzKGJpbmRpbmdQYXRoOiBzdHJpbmcpOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgYmluZGluZ1BhdGhzID0gYmluZGluZ1BhdGguc3BsaXQoJy8nKS5maWx0ZXIocCA9PiBwKTtcbiAgICBjb25zdCBwcmltYXJ5VmFsdWUgPSB0aGlzLnZpZXdNb2RlbC5iaW5kaW5nRGF0YS5saXN0LmN1cnJlbnRJZDtcbiAgICBjb25zdCByZXN1bHQgPSBbXTtcbiAgICBjb25zdCBwYXRocyA9IFtdO1xuICAgIGlmIChiaW5kaW5nUGF0aHMubGVuZ3RoID4gMCkge1xuICAgICAgcmVzdWx0LnB1c2gocHJpbWFyeVZhbHVlKTtcbiAgICAgIC8vIOS7juihqOaIluS7juS7juihqOimgeWkjeWItueahOihjOS4jeS4gOWumuaYr+W9k+WJjeihjO+8jOeUqOaIt+WPr+S7peaMh+WumlxuICAgICAgYmluZGluZ1BhdGhzLnBvcCgpO1xuICAgICAgYmluZGluZ1BhdGhzLmZvckVhY2goKHBhdGg6IHN0cmluZykgPT4ge1xuICAgICAgICBwYXRocy5wdXNoKHBhdGgpO1xuICAgICAgICBjb25zdCBiaW5kaW5nTGlzdCA9IHRoaXMudmlld01vZGVsLmJpbmRpbmdEYXRhLmdldFZhbHVlKHBhdGhzKSBhcyBCaW5kaW5nTGlzdDtcbiAgICAgICAgaWYgKGJpbmRpbmdMaXN0KSB7XG4gICAgICAgICAgcmVzdWx0LnB1c2goYmluZGluZ0xpc3QuY3VycmVudElkKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cbiAgcHJpdmF0ZSB1cGRhdGVCaW5kaW5nRGF0YShpbnB1dDogYW55LCBpZHM6IEFycmF5PGFueT4pIHtcbiAgICBjb25zdCB7IGNvbnRyb2xUeXBlID0gbnVsbCwgdmFsdWUgPSBudWxsLCBvcHRpb25zID0ge30sIGRhdGFUeXBlID0gbnVsbCB9ID0gaW5wdXQgfHwge307XG4gICAgaWYgKGNvbnRyb2xUeXBlKSB7XG4gICAgICAvLyDlr7nluK7liqnlgZrnibnmrorlpITnkIZcbiAgICAgIGlmIChjb250cm9sVHlwZSA9PT0gJ2xvb2t1cCcgfHwgY29udHJvbFR5cGUgPT09ICdjb21iby1sb29rdXAnKSB7XG4gICAgICAgIGNvbnN0IG1hcEZpZWxkcyA9IG9wdGlvbnMubWFwRmllbGRzO1xuICAgICAgICB0aGlzLnVwZGF0ZUxvb2t1cEZpZWxkKGlkcywgdmFsdWUsIG1hcEZpZWxkcyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnVwZGF0ZVNpbXBsZUZpZWxkKGlkcywgdmFsdWUsIGlucHV0KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcHJpdmF0ZSB1cGRhdGVTaW1wbGVGaWVsZChpZHM6IEFycmF5PGFueT4sIHZhbHVlOiBhbnksIGNvbHVtbjogYW55KSB7XG4gICAgaWYgKCFjb2x1bW4pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgY3VycmVudENvbHVtblR5cGUgPSBjb2x1bW4uZGF0YVR5cGU7XG4gICAgLy8g5a2Y5Zyo6KGM57yW6L6R5ZmoXG4gICAgbGV0IHJlc3VsdCA9IHZhbHVlO1xuICAgIGlmIChjdXJyZW50Q29sdW1uVHlwZSA9PT0gJ2RhdGUnKSB7XG4gICAgICBsZXQgZGF0ZVN0ciA9IHRoaXMuZGF0ZVNlcnZpY2UuZm9ybWF0VG8odmFsdWUsICd5eXl5LU1NLWRkJyk7XG4gICAgICBpZiAoIWRhdGVTdHIpIHtcbiAgICAgICAgZGF0ZVN0ciA9ICcwMDAxLTAxLTAxVDAwOjAwOjAwJztcbiAgICAgIH1cbiAgICAgIHJlc3VsdCA9IGRhdGVTdHI7XG4gICAgfSBlbHNlIGlmIChjdXJyZW50Q29sdW1uVHlwZSA9PT0gJ251bWJlcicpIHtcbiAgICAgIHJlc3VsdCA9IE51bWJlcih2YWx1ZSkgfHwgMDtcbiAgICB9XG4gICAgY29uc3QgZmllbGQgPSBjb2x1bW4uZmllbGQ7XG4gICAgaWRzLmZvckVhY2goaWQgPT4ge1xuICAgICAgdGhpcy51cGRhdGVCaW5kaW5nTGlzdChpZCwgZmllbGQsIHJlc3VsdCk7XG4gICAgfSk7XG4gIH1cbiAgcHJpdmF0ZSB1cGRhdGVMb29rdXBGaWVsZChpZHM6IEFycmF5PGFueT4sIGhlbHBEYXRhOiBhbnksIG1hcEZpZWxkczogYW55KSB7XG4gICAgaWYgKCFtYXBGaWVsZHMpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgbGV0IGhlbHBGaWVsZHMgPSBPYmplY3Qua2V5cyhtYXBGaWVsZHMpO1xuICAgIGNvbnN0IGlkSW5kZXggPSBoZWxwRmllbGRzLmZpbmRJbmRleChpdGVtID0+IGl0ZW0gPT09ICdpZCcpO1xuICAgIGlmIChoZWxwRmllbGRzLmluY2x1ZGVzKCdpZCcpICYmIGlkSW5kZXggIT09IDApIHtcbiAgICAgIGhlbHBGaWVsZHMuc3BsaWNlKGlkSW5kZXgsIDEpO1xuICAgICAgaGVscEZpZWxkcyA9IFsnaWQnLCAuLi5oZWxwRmllbGRzXTtcbiAgICB9XG4gICAgaGVscEZpZWxkcy5mb3JFYWNoKChoZWxwRmllbGQ6IGFueSkgPT4ge1xuICAgICAgbGV0IGhlbHBWYWx1ZTogYW55ID0gJyc7XG4gICAgICBpZiAoaGVscERhdGEpIHtcbiAgICAgICAgaWYgKGhlbHBEYXRhIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgICAgICBoZWxwVmFsdWUgPSBoZWxwRGF0YS5tYXAoKGl0ZW06IGFueSkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VmFsdWUoaGVscEZpZWxkLCBpdGVtKTtcbiAgICAgICAgICB9KS5qb2luKCcsJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaGVscFZhbHVlID0gdGhpcy5nZXRWYWx1ZShoZWxwRmllbGQsIGhlbHBEYXRhKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWRzLmZvckVhY2goaWQgPT4ge1xuICAgICAgICB0aGlzLnVwZGF0ZUJpbmRpbmdMaXN0KGlkLCBtYXBGaWVsZHNbaGVscEZpZWxkXSwgaGVscFZhbHVlKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG4gIHByaXZhdGUgdXBkYXRlQmluZGluZ0xpc3QocHJpbWFyeVZhbHVlOiBhbnksIHByb3BlcnR5TmFtZTogc3RyaW5nLCB2YWx1ZTogYW55KSB7XG4gICAgY29uc3Qgdmlld01vZGVsID0gdGhpcy52aWV3TW9kZWwgfHwgbnVsbDtcbiAgICBpZiAoIXZpZXdNb2RlbCB8fCAhcHJvcGVydHlOYW1lKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIC8vIOabtOaWsOS4u+ihqOmDqOWIhuihjOeahOWtl+autVxuICAgIGNvbnN0IHByb3BlcnR5TmFtZXMgPSBwcm9wZXJ0eU5hbWUuc3BsaXQoJy4nKS5maWx0ZXIoaXRlbSA9PiBpdGVtKTtcbiAgICBjb25zdCBiaW5kaW5nT2JqZWN0ID0gdGhpcy5iaW5kaW5nTGlzdC5maW5kQnlJZChwcmltYXJ5VmFsdWUpO1xuXG4gICAgaWYgKHByb3BlcnR5TmFtZXMubGVuZ3RoIDwgMikge1xuICAgICAgYmluZGluZ09iamVjdC5zZXRWYWx1ZShwcm9wZXJ0eU5hbWUsIHZhbHVlLCB0cnVlLCB0cnVlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbGV0IHRhcmdldEJpbmRpbmdPYmplY3QgPSBudWxsO1xuICAgICAgY29uc3QgZnBhdGhzID0gcHJvcGVydHlOYW1lcy5zbGljZSgwLCBwcm9wZXJ0eU5hbWVzLmxlbmd0aCAtIDEpO1xuICAgICAgY29uc3QgdGFyZ2V0UHJvcGVydHlOYW1lID0gcHJvcGVydHlOYW1lc1twcm9wZXJ0eU5hbWVzLmxlbmd0aCAtIDFdO1xuICAgICAgZnBhdGhzLmZvckVhY2gocHJvcCA9PiB7XG4gICAgICAgIHRhcmdldEJpbmRpbmdPYmplY3QgPSB0YXJnZXRCaW5kaW5nT2JqZWN0ICYmIHRhcmdldEJpbmRpbmdPYmplY3RbcHJvcF0gfHwgYmluZGluZ09iamVjdFtwcm9wXTtcbiAgICAgIH0pO1xuICAgICAgLy8gdG9kbzrpnIDopoHmt7vliqDlgLzlj5jljJbkuovku7ZcbiAgICAgIHRhcmdldEJpbmRpbmdPYmplY3Quc2V0VmFsdWUodGFyZ2V0UHJvcGVydHlOYW1lLCB2YWx1ZSwgdHJ1ZSwgdHJ1ZSk7XG4gICAgfVxuICB9XG4gIHByaXZhdGUgZ2V0QmluZGluZ1BhdGhBcnJheSgpOiBhbnlbXSB7XG4gICAgY29uc3QgcGF0aCA9IHRoaXMudmlld01vZGVsLmJpbmRpbmdQYXRoO1xuICAgIGlmIChwYXRoKSB7XG4gICAgICByZXR1cm4gcGF0aC5zcGxpdCgnLycpLmZpbHRlcihuID0+IG4gIT09ICcnKTtcbiAgICB9XG4gICAgcmV0dXJuIFtdO1xuICB9XG4gIHByaXZhdGUgZ2V0VmFsdWUoZjogc3RyaW5nLCBkYXRhOiBhbnkpIHtcbiAgICBsZXQgdmFsID0gJyc7XG4gICAgaWYgKGYuaW5kZXhPZignLicpID09PSAtMSkge1xuICAgICAgdmFsID0gZGF0YVtmXTtcbiAgICB9IGVsc2Uge1xuICAgICAgdmFsID0gZi5zcGxpdCgnLicpLnJlZHVjZSgoYSwgYikgPT4ge1xuICAgICAgICByZXR1cm4gYVtiXTtcbiAgICAgIH0sIGRhdGEpO1xuICAgIH1cblxuICAgIHJldHVybiB2YWw7XG4gIH1cbiAgcHJvdGVjdGVkIGdldCBiaW5kaW5nTGlzdCgpOiBCaW5kaW5nTGlzdCB7XG4gICAgLy8g5qC55a6e5L2TXG4gICAgaWYgKHRoaXMudmlld01vZGVsLmJpbmRpbmdQYXRoID09PSAnLycgfHwgIXRoaXMudmlld01vZGVsLmJpbmRpbmdQYXRoKSB7XG4gICAgICByZXR1cm4gdGhpcy52aWV3TW9kZWwuYmluZGluZ0RhdGEubGlzdDtcbiAgICB9XG4gICAgLy8g5a2Q5a6e5L2TXG4gICAgbGV0IGJpbmRpbmdQYXRoID0gdGhpcy52aWV3TW9kZWwuYmluZGluZ1BhdGguc3Vic3RyKDEpO1xuICAgIGJpbmRpbmdQYXRoID0gYmluZGluZ1BhdGhbMF0udG9Mb3dlckNhc2UoKSArIGJpbmRpbmdQYXRoLnN1YnN0cmluZygxLCBiaW5kaW5nUGF0aC5sZW5ndGgpO1xuICAgIGNvbnN0IHBhdGhzID0gYmluZGluZ1BhdGguc3BsaXQoJy8nKTtcblxuICAgIGNvbnN0IGZpbHRlcmVkUGF0aHMgPSBwYXRocy5maWx0ZXIoKHBhcnQ6IHN0cmluZykgPT4ge1xuICAgICAgcmV0dXJuIHBhcnQgIT09ICcnO1xuICAgIH0pO1xuICAgIHJldHVybiB0aGlzLnZpZXdNb2RlbC5iaW5kaW5nRGF0YS5nZXRWYWx1ZShmaWx0ZXJlZFBhdGhzKTtcbiAgfVxuICAvKipcbiAgICog5qC55o2u5pig5bCE5bCG5pWw5o2u6LWL5YC857uZYmluZGluZ0RhdGFcbiAgICogQHBhcmFtIGRhdGEgXG4gICAqIEBwYXJhbSBtYXBGaWVsZHMgXG4gICAqIEBwYXJhbSBiaW5kaW5nRGF0YSBcbiAgICovXG4gIHByaXZhdGUgbWFwcGluZ1JvdyhkYXRhOiBhbnksIG1hcEZpZWxkczogYW55LCBlbnRpdHk6IEVudGl0eSwgYmluZGluZ1BhdGg6IHN0cmluZykge1xuICAgIE9iamVjdC5rZXlzKG1hcEZpZWxkcykuZm9yRWFjaCgocHJvcDogc3RyaW5nKSA9PiB7XG4gICAgICBjb25zdCB2YWx1ZSA9IHRoaXMuZ2V0VmFsdWVCeVBhdGgoZGF0YSwgcHJvcCk7XG4gICAgICBjb25zdCBmaWVsZHMgPSBtYXBGaWVsZHNbcHJvcF07XG4gICAgICBjb25zdCBncm91cHM6IGFueVtdID0gZmllbGRzLnNwbGl0KCcsJykuZmlsdGVyKHAgPT4gcCk7XG4gICAgICBncm91cHMuZm9yRWFjaChncm91cCA9PiB7XG4gICAgICAgIGNvbnN0IHBhdGhzID0gZ3JvdXAuc3BsaXQoJy4nKS5maWx0ZXIocCA9PiBwKTtcbiAgICAgICAgdGhpcy5zZXRWYWx1ZUJ5UGF0aChlbnRpdHksIHBhdGhzLmpvaW4oJy4nKSwgdmFsdWUpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cbiAgLyoqXG4gICAqIOmAmui/h2ZyYW1lSWTojrflj5blr7nlupTnmoTnu4Tku7bkuIrkuIvmlodcbiAgICogQHBhcmFtIGZyYW1lSWQgZnJhbWVJZFxuICAgKiBAcmV0dXJucyBcbiAgICovXG4gIHByaXZhdGUgZ2V0RnJhbWVDb250ZXh0QnlJZChmcmFtZUlkOiBzdHJpbmcpOiBGcmFtZUNvbnRleHQgfCBudWxsIHtcbiAgICBpZiAoIWZyYW1lSWQpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCBhcHBDb250ZXh0ID0gdGhpcy5pbmplY3Rvci5nZXQ8QXBwQ29udGV4dD4oQXBwQ29udGV4dCwgbnVsbCk7XG4gICAgbGV0IGZyYW1lQ29udGV4dDogRnJhbWVDb250ZXh0ID0gbnVsbDtcbiAgICBpZiAoYXBwQ29udGV4dCkge1xuICAgICAgZnJhbWVDb250ZXh0ID0gYXBwQ29udGV4dC5mcmFtZUNvbnRleHRNYW5hZ2VyLmdldEZyYW1lQ29udGV4dEJ5SWQoZnJhbWVJZCk7XG4gICAgfVxuICAgIHJldHVybiBmcmFtZUNvbnRleHQ7XG4gIH1cbiAgcHJpdmF0ZSBnZXRFbnRpdHlCeVBhdGgoZnJhbWVDb250ZXh0OiBGcmFtZUNvbnRleHQsIGJpbmRpbmdQYXRoczogYW55W10sIGN1cnJlbnRJZDogc3RyaW5nKSB7XG4gICAgYmluZGluZ1BhdGhzID0gWy4uLmJpbmRpbmdQYXRoc107XG4gICAgY29uc3QgaWQgPSBmcmFtZUNvbnRleHQuYmluZGluZ0RhdGEubGlzdC5jdXJyZW50SWQ7XG4gICAgY29uc3QgZW50aXR5OiBFbnRpdHkgPSBmcmFtZUNvbnRleHQucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmdldEVudGl0eUJ5SWQoaWQpIGFzIEVudGl0eTtcbiAgICBsZXQgaXRlbTogRW50aXR5ID0gZW50aXR5O1xuICAgIGNvbnN0IHBhdGhzID0gW107XG4gICAgY29uc3QgdGFpbFBhdGggPSBiaW5kaW5nUGF0aHMucG9wKCk7XG4gICAgY29uc3QgcGFyZW50ID0gYmluZGluZ1BhdGhzLnJlZHVjZSgob2JqZWN0OiBFbnRpdHksIHBhdGg6IHN0cmluZykgPT4ge1xuICAgICAgcGF0aHMucHVzaChwYXRoKTtcbiAgICAgIGlmIChvYmplY3QgJiYgKG9iamVjdC5oYXNPd25Qcm9wZXJ0eShwYXRoKSB8fCBvYmplY3RbJ19fcHJvdG9fXyddLmhhc093blByb3BlcnR5KHBhdGgpKSkge1xuICAgICAgICBjb25zdCB2YWx1ZSA9IG9iamVjdFtwYXRoXTtcbiAgICAgICAgaWYgKHZhbHVlICYmIHZhbHVlIGluc3RhbmNlb2YgRW50aXR5TGlzdCkge1xuICAgICAgICAgIGNvbnN0IGJpbmRpbmdMaXN0ID0gZnJhbWVDb250ZXh0LmJpbmRpbmdEYXRhLmdldFZhbHVlKHBhdGhzKSBhcyBCaW5kaW5nTGlzdDtcbiAgICAgICAgICBjb25zdCBjdXJyZW50SXRlbUlkID0gYmluZGluZ0xpc3QuY3VycmVudElkO1xuICAgICAgICAgIHJldHVybiB2YWx1ZS5nZXQoY3VycmVudEl0ZW1JZCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICB9LCBpdGVtKTtcbiAgICBpZiAocGFyZW50IGluc3RhbmNlb2YgRW50aXR5KSB7XG4gICAgICBjb25zdCBsaXN0ID0gcGFyZW50W3RhaWxQYXRoXSBhcyBFbnRpdHlMaXN0PGFueT47XG4gICAgICBpZiAobGlzdCkge1xuICAgICAgICByZXR1cm4gbGlzdC5nZXQoY3VycmVudElkKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihg5peg5pWI55qEYmluZGluZ1BhdGguYCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihg5peg5pWI55qEYmluZGluZ1BhdGguYCk7XG4gICAgfVxuICB9XG4gIHByaXZhdGUgZW5kRWRpdChmcmFtZUNvbnRleHQ6IEZyYW1lQ29udGV4dCkge1xuICAgIGNvbnN0IGFwcENvbnRleHQ6IEFwcENvbnRleHQgPSBmcmFtZUNvbnRleHQgJiYgZnJhbWVDb250ZXh0LmdldEZvcm1BcHBDb250ZXh0KCk7XG4gICAgcmV0dXJuIG9mKG51bGwpLnBpcGUoXG4gICAgICB0YXAoKCkgPT4ge1xuICAgICAgICBpZiAoYXBwQ29udGV4dCkge1xuICAgICAgICAgIGFwcENvbnRleHQubWVzc2FnZVBpcGUubmV4dCh7IHR5cGU6ICdlbmRFZGl0JyB9KTtcbiAgICAgICAgfVxuICAgICAgfSksXG4gICAgICAvLyB0b2RvOiDkuI3lupTor6Xkvb/nlKhkZWxhee+8jOW6lOivpeS4sua1gVxuICAgICAgZGVsYXkoNSlcbiAgICApO1xuICB9XG59XG4iXX0=