/**
 * @fileoverview added by tsickle
 * Generated from: lib/controlcomponent/smarthelp/smarthelp.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, Output, EventEmitter, ViewChild } from '@angular/core';
import { SolutionService } from '../../service/solution.service';
import { LookupGridComponent } from '@farris/ui-lookup';
import { of } from 'rxjs';
var SolutionSmartHelpComponent = /** @class */ (function () {
    function SolutionSmartHelpComponent(solutionService) {
        var _this = this;
        this.solutionService = solutionService;
        /**
         * 某个字段发生值变化事件时，需要同步清空的字段，可能不是当前字段
         */
        this.changeFields = [];
        this.conditionChange = new EventEmitter();
        this.mappingEmitter = new EventEmitter();
        /**
         * 每页记录数
         */
        this.pageSize = 20;
        /**
         * 可用分页记录数列表
         */
        this.pageList = [10, 20, 30, 50, 100];
        this.onBeforeOpen = (/**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var t = (/** @type {?} */ (_this.item.value));
            if (t && t.value) {
                /** @type {?} */
                var ids = t.value.map((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return n[_this.idField || 'id']; })).join(',');
                _this.lookup.displayValue = ids;
            }
            return of(true);
        });
    }
    /**
     * @return {?}
     */
    SolutionSmartHelpComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.getSmartHelpBindingInfo();
        this.testId = this.solutionService.getGuid();
        this.placeholder = (this.item.placeHolder) ? (this.item.placeHolder) : (this.item.control.placeholder);
        this.lookup.textChanged.subscribe((/**
         * @param {?} v
         * @return {?}
         */
        function (v) {
            _this.textChangedHandler(v);
        }));
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    SolutionSmartHelpComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        var _this = this;
        this.getSmartHelpBindingInfo();
        if (changes['changeFields'] && changes['changeFields'].currentValue && !changes['changeFields'].firstChange) {
            /** @type {?} */
            var isChange = changes['changeFields'].currentValue.some((/**
             * @param {?} field
             * @return {?}
             */
            function (field) { return field == _this.item.fieldCode; }));
            if (isChange) {
                this.textValue = ((/** @type {?} */ (this.item.value))).textValue;
            }
        }
    };
    //ITEM：
    //control: SmartHelpContol {uri: "WuLiao.wOrgId", textField: "name", valueField: "code", mapFields: {}, idField: "id"}
    // fieldCode: "wOrgId"
    // fieldName: "所属机构"
    // id: "WuLiao.wOrgId"
    // value: SmartHelpValue {valueField: null, value: null}
    // valueType: 0
    //ITEM：
    //control: SmartHelpContol {uri: "WuLiao.wOrgId", textField: "name", valueField: "code", mapFields: {}, idField: "id"}
    // fieldCode: "wOrgId"
    // fieldName: "所属机构"
    // id: "WuLiao.wOrgId"
    // value: SmartHelpValue {valueField: null, value: null}
    // valueType: 0
    /**
     * @return {?}
     */
    SolutionSmartHelpComponent.prototype.getSmartHelpBindingInfo = 
    //ITEM：
    //control: SmartHelpContol {uri: "WuLiao.wOrgId", textField: "name", valueField: "code", mapFields: {}, idField: "id"}
    // fieldCode: "wOrgId"
    // fieldName: "所属机构"
    // id: "WuLiao.wOrgId"
    // value: SmartHelpValue {valueField: null, value: null}
    // valueType: 0
    /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var smartHelpControl = ((/** @type {?} */ (this.item.control)));
        this.uri = smartHelpControl.uri;
        this.textField = smartHelpControl.textField;
        this.idField = smartHelpControl.idField;
        this.valueField = smartHelpControl.valueField;
        this.displayType = smartHelpControl.displayType;
        this.mapFields = smartHelpControl.mapFields;
        this.context = smartHelpControl.context;
        this.preEventCmd = smartHelpControl.preEventCmd;
        this.postEventCmd = smartHelpControl.postEventCmd;
        this.enableFullTree = smartHelpControl.enableFullTree;
        this.loadTreeDataType = smartHelpControl.loadTreeDataType;
        this.singleSelect = smartHelpControl.singleSelect === false ? false : true;
        this.expandLevel = smartHelpControl.expandLevel;
        this.enableCascade = smartHelpControl.enableCascade;
        // 标题
        this.dialogTitle = smartHelpControl.dialogTitle ? smartHelpControl.dialogTitle : '';
        // 宽度
        this.dialogWidth = smartHelpControl.panelWidth;
        // 高度
        this.dialogHeight = smartHelpControl.panelHeight;
        /** @type {?} */
        var smartHelpValue = ((/** @type {?} */ (this.item.value)));
        if (smartHelpValue.textValue == 'help-text-value-null') { //旧数据兼容
            this.textValue = smartHelpValue.getTextValue(this.textField);
        }
        else {
            this.textValue = smartHelpValue.textValue;
        }
        this.nosearch = smartHelpControl.nosearch; //默认false
        this.displayFields = smartHelpControl.displayFields ? smartHelpControl.displayFields : '';
        this.displayTextSeparator = smartHelpControl.displayTextSeparator ? smartHelpControl.displayTextSeparator : '_';
        this.editable = smartHelpControl.editable;
        this.clearFields = smartHelpControl.clearFields;
        if (smartHelpControl.hasOwnProperty('pageSize') && smartHelpControl.pageSize) {
            this.pageSize = smartHelpControl.pageSize;
        }
        if (smartHelpControl.hasOwnProperty('pageList') && smartHelpControl.pageList) {
            this.pageList = smartHelpControl.pageList.split(",").map((/**
             * @param {?} item
             * @return {?}
             */
            function (item) { return parseInt(item); }));
        }
    };
    /**
     * @param {?} data
     * @return {?}
     */
    SolutionSmartHelpComponent.prototype.clearData = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        ((/** @type {?} */ (this.item.value))).clearValue();
        if (this.item.control.clear) {
            this.item.control.clear();
        }
        this.conditionChange.emit();
    };
    /**
     * @param {?} field
     * @return {?}
     */
    SolutionSmartHelpComponent.prototype.getConditionItemTitle = /**
     * @param {?} field
     * @return {?}
     */
    function (field) {
        return this.solutionService.getConditionItemTitle(field);
    };
    /**
     * selectedItem
     * code: "code02"
        id: "id02"
        name: "机构02"
        version: "2019-10-21T00:00:00"
    */
    /**
     * selectedItem
     * code: "code02"
     * id: "id02"
     * name: "机构02"
     * version: "2019-10-21T00:00:00"
     * @param {?} data
     * @return {?}
     */
    SolutionSmartHelpComponent.prototype.textChangedHandler = /**
     * selectedItem
     * code: "code02"
     * id: "id02"
     * name: "机构02"
     * version: "2019-10-21T00:00:00"
     * @param {?} data
     * @return {?}
     */
    function (data) {
        if (this.item && this.item.value) {
            /** @type {?} */
            var helpValue = ((/** @type {?} */ (this.item.value)));
            helpValue.value = [data];
            helpValue.textValue = data;
            helpValue.isInputText = true;
            // this.textValue = helpValue.textValue;
            this.conditionChange.emit();
        }
    };
    /**
     * @param {?} selectedItem
     * @return {?}
     */
    SolutionSmartHelpComponent.prototype.selectedDataHandler = /**
     * @param {?} selectedItem
     * @return {?}
     */
    function (selectedItem) {
        //选择时触发
        /** @type {?} */
        var helpValue = ((/** @type {?} */ (this.item.value)));
        helpValue.value = this.singleSelect ? [selectedItem] : selectedItem; //单选返回对象，多选返回数组
        helpValue.valueField = this.valueField;
        helpValue.textValue = this.textValue;
        helpValue.isInputText = false;
        this.conditionChange.emit();
    };
    SolutionSmartHelpComponent.decorators = [
        { type: Component, args: [{
                    selector: 'app-solution-smarthelp',
                    template: "<div class=\"farris-group-wrap\" id=\"{{item.id}}\" >\r\n    <div class=\"form-group farris-form-group common-group\" [ngClass]=\"{'q-state-readonly':item.readonly}\">\r\n        <label class=\"col-form-label\" title=\"{{getConditionItemTitle(item)}}\">\r\n            <span class=\"farris-label-info text-danger\" *ngIf=\"item.control.isRequired()\">*</span>\r\n            <span class=\"farris-label-text\">{{item.fieldName}}</span>\r\n        </label>\r\n        <div class=\"farris-input-wrap\">\r\n            <farris-lookup-grid #lookup\r\n                id=\"{{testId}}\"                \r\n                [clear-fields]=\"clearFields\"\r\n                [uri]=\"uri\"\r\n                [placeholder]=\"placeholder\"\r\n                [(ngModel)]=\"textValue\"\r\n                [textField]=\"textField\"\r\n                [valueField]=\"valueField\"\r\n                [idField]=\"idField\"\r\n                [mapFields]=\"mapFields\"\r\n                [displayType]=\"displayType\"\r\n                [title]=\"dialogTitle\"\r\n                [dialogWidth]=\"dialogWidth\"\r\n                [dialogHeight]=\"dialogHeight\"\r\n                [context]=\"context\"\r\n                [dictPicking]=\"preEventCmd\"\r\n                [dictPicked]=\"postEventCmd\"\r\n                [enableFullTree]=\"enableFullTree\"\r\n                [loadTreeDataType]=\"loadTreeDataType\"\r\n                [singleSelect]=\"singleSelect\"\r\n                [expandLevel]=\"expandLevel\"\r\n                [enableCascade]=\"enableCascade\"\r\n                [readonly]=\"item.readonly\"\r\n                [nosearch]=\"nosearch\"\r\n                [beforeOpen]=\"onBeforeOpen\"\r\n                [displayFields]=\"displayFields\"\r\n                [displayTextSeparator]=\"displayTextSeparator\"\r\n                [editable]=\"editable\"\r\n                [pageSize]=\"pageSize\"\r\n                [pageList]=\"pageList\"\r\n                [useFavorite]=\"true\"\r\n                (selectedData)=\"selectedDataHandler($event)\"\r\n                (clear)=\"clearData($event)\"\r\n            >\r\n        </farris-lookup-grid>\r\n        <!-- [singleSelect]=\"true\" -->\r\n        </div>\r\n\r\n    </div>\r\n</div>"
                }] }
    ];
    /** @nocollapse */
    SolutionSmartHelpComponent.ctorParameters = function () { return [
        { type: SolutionService }
    ]; };
    SolutionSmartHelpComponent.propDecorators = {
        item: [{ type: Input }],
        changeFields: [{ type: Input }],
        conditionChange: [{ type: Output, args: ['conditionChange',] }],
        mappingEmitter: [{ type: Output, args: ['helpMapping',] }],
        lookup: [{ type: ViewChild, args: ['lookup',] }]
    };
    return SolutionSmartHelpComponent;
}());
export { SolutionSmartHelpComponent };
if (false) {
    /**
     * QueryCondition类型
     * @type {?}
     */
    SolutionSmartHelpComponent.prototype.item;
    /**
     * 某个字段发生值变化事件时，需要同步清空的字段，可能不是当前字段
     * @type {?}
     */
    SolutionSmartHelpComponent.prototype.changeFields;
    /** @type {?} */
    SolutionSmartHelpComponent.prototype.conditionChange;
    /** @type {?} */
    SolutionSmartHelpComponent.prototype.mappingEmitter;
    /** @type {?} */
    SolutionSmartHelpComponent.prototype.lookup;
    /** @type {?} */
    SolutionSmartHelpComponent.prototype.uri;
    /** @type {?} */
    SolutionSmartHelpComponent.prototype.textField;
    /** @type {?} */
    SolutionSmartHelpComponent.prototype.mapFields;
    /** @type {?} */
    SolutionSmartHelpComponent.prototype.idField;
    /** @type {?} */
    SolutionSmartHelpComponent.prototype.valueField;
    /** @type {?} */
    SolutionSmartHelpComponent.prototype.textValue;
    /** @type {?} */
    SolutionSmartHelpComponent.prototype.displayType;
    /** @type {?} */
    SolutionSmartHelpComponent.prototype.context;
    /** @type {?} */
    SolutionSmartHelpComponent.prototype.preEventCmd;
    /** @type {?} */
    SolutionSmartHelpComponent.prototype.postEventCmd;
    /** @type {?} */
    SolutionSmartHelpComponent.prototype.loadTreeDataType;
    /** @type {?} */
    SolutionSmartHelpComponent.prototype.enableFullTree;
    /** @type {?} */
    SolutionSmartHelpComponent.prototype.singleSelect;
    /** @type {?} */
    SolutionSmartHelpComponent.prototype.expandLevel;
    /** @type {?} */
    SolutionSmartHelpComponent.prototype.enableCascade;
    /** @type {?} */
    SolutionSmartHelpComponent.prototype.testId;
    /** @type {?} */
    SolutionSmartHelpComponent.prototype.placeholder;
    /** @type {?} */
    SolutionSmartHelpComponent.prototype.nosearch;
    /** @type {?} */
    SolutionSmartHelpComponent.prototype.displayFields;
    /** @type {?} */
    SolutionSmartHelpComponent.prototype.displayTextSeparator;
    /** @type {?} */
    SolutionSmartHelpComponent.prototype.editable;
    /** @type {?} */
    SolutionSmartHelpComponent.prototype.clearFields;
    /** @type {?} */
    SolutionSmartHelpComponent.prototype.dialogTitle;
    /** @type {?} */
    SolutionSmartHelpComponent.prototype.dialogWidth;
    /** @type {?} */
    SolutionSmartHelpComponent.prototype.dialogHeight;
    /**
     * 每页记录数
     * @type {?}
     */
    SolutionSmartHelpComponent.prototype.pageSize;
    /**
     * 可用分页记录数列表
     * @type {?}
     */
    SolutionSmartHelpComponent.prototype.pageList;
    /** @type {?} */
    SolutionSmartHelpComponent.prototype.onBeforeOpen;
    /**
     * @type {?}
     * @private
     */
    SolutionSmartHelpComponent.prototype.solutionService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic21hcnRoZWxwLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvY29tcG9uZW50LXF1ZXJ5Y29uZGl0aW9uLyIsInNvdXJjZXMiOlsibGliL2NvbnRyb2xjb21wb25lbnQvc21hcnRoZWxwL3NtYXJ0aGVscC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBcUIsTUFBTSxFQUFFLFlBQVksRUFBWSxTQUFTLEVBQWlCLE1BQU0sZUFBZSxDQUFDO0FBTTlILE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUNqRSxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUN4RCxPQUFPLEVBQUUsRUFBRSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBRTFCO0lBd0RJLG9DQUFvQixlQUFnQztRQUFwRCxpQkFBeUQ7UUFBckMsb0JBQWUsR0FBZixlQUFlLENBQWlCOzs7O1FBekMzQyxpQkFBWSxHQUFrQixFQUFFLENBQUM7UUFFZixvQkFBZSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFFekMsbUJBQWMsR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDOzs7O1FBaUMzRCxhQUFRLEdBQVcsRUFBRSxDQUFDOzs7O1FBRXRCLGFBQVEsR0FBa0IsQ0FBQyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsR0FBRyxDQUFDLENBQUM7UUF3RWhELGlCQUFZOzs7UUFBRzs7Z0JBQ0wsQ0FBQyxHQUFHLG1CQUFBLEtBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFrQjtZQUMzQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsS0FBSyxFQUFFOztvQkFDUixHQUFHLEdBQUcsQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHOzs7O2dCQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLEtBQUksQ0FBQyxPQUFPLElB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QThLQztTQXpLWSwwQkFBMEI7Ozs7OztJQUtuQywwQ0FBbUI7Ozs7O0lBS25CLGtEQUEwQzs7SUFFMUMscURBQWdFOztJQUVoRSxvREFBMkQ7O0lBRTNELDRDQUFpRDs7SUFFakQseUNBQVk7O0lBQ1osK0NBQWtCOztJQUNsQiwrQ0FBZTs7SUFDZiw2Q0FBYTs7SUFDYixnREFBZ0I7O0lBQ2hCLCtDQUFlOztJQUNmLGlEQUFpQjs7SUFDakIsNkNBQWE7O0lBQ2IsaURBQWlCOztJQUNqQixrREFBa0I7O0lBQ2xCLHNEQUF5Qjs7SUFDekIsb0RBQXdCOztJQUN4QixrREFBc0I7O0lBQ3RCLGlEQUFvQjs7SUFDcEIsbURBQXVCOztJQUN2Qiw0Q0FBZTs7SUFDZixpREFBb0I7O0lBQ3BCLDhDQUFrQjs7SUFDbEIsbURBQXNCOztJQUN0QiwwREFBNkI7O0lBQzdCLDhDQUFrQjs7SUFDbEIsaURBQW9COztJQUVwQixpREFBb0I7O0lBRXBCLGlEQUFvQjs7SUFFcEIsa0RBQXFCOzs7OztJQUVyQiw4Q0FBc0I7Ozs7O0lBRXRCLDhDQUFnRDs7SUF3RWhELGtEQVFDOzs7OztJQTlFVyxxREFBd0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBPbkluaXQsIE9uQ2hhbmdlcywgT3V0cHV0LCBFdmVudEVtaXR0ZXIsIEluamVjdG9yLCBWaWV3Q2hpbGQsIFNpbXBsZUNoYW5nZXMgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgUXVlcnlDb25kaXRpb24gfSBmcm9tICcuLi8uLi9lbnRpdHkvcXVlcnljb25kaXRpb24nO1xyXG5pbXBvcnQgeyBDb250cm9sVHlwZSB9IGZyb20gJy4uLy4uL2VudGl0eS9jb250cm9sdHlwZSc7XHJcbmltcG9ydCB7IFNtYXJ0SGVscENvbnRvbCB9IGZyb20gJy4uLy4uL2VudGl0eS9jb250cm9sdHlwZS9zbWFydGhlbHAvc21hcnRoZWxwY29udHJvbCc7XHJcbmltcG9ydCB7IElDb250cm9sIH0gZnJvbSAnLi4vLi4vZW50aXR5L2NvbnRyb2x0eXBlL2ljb250cm9sJztcclxuaW1wb3J0IHsgU21hcnRIZWxwVmFsdWUgfSBmcm9tICcuLi8uLi9lbnRpdHkvY29uZGl0aW9udmFsdWUvc21hcnRoZWxwdmFsdWUnO1xyXG5pbXBvcnQgeyBTb2x1dGlvblNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlL3NvbHV0aW9uLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBMb29rdXBHcmlkQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1sb29rdXAnO1xyXG5pbXBvcnQgeyBvZiB9IGZyb20gJ3J4anMnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ2FwcC1zb2x1dGlvbi1zbWFydGhlbHAnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcuL3NtYXJ0aGVscC5jb21wb25lbnQuaHRtbCcsXHJcbn0pXHJcblxyXG5leHBvcnQgY2xhc3MgU29sdXRpb25TbWFydEhlbHBDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcyB7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBRdWVyeUNvbmRpdGlvbuexu+Wei1xyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSBpdGVtOiBhbnk7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmn5DkuKrlrZfmrrXlj5HnlJ/lgLzlj5jljJbkuovku7bml7bvvIzpnIDopoHlkIzmraXmuIXnqbrnmoTlrZfmrrXvvIzlj6/og73kuI3mmK/lvZPliY3lrZfmrrVcclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgY2hhbmdlRmllbGRzOiBBcnJheTxzdHJpbmc+ID0gW107XHJcblxyXG4gICAgQE91dHB1dCgnY29uZGl0aW9uQ2hhbmdlJykgY29uZGl0aW9uQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG5cclxuICAgIEBPdXRwdXQoJ2hlbHBNYXBwaW5nJykgbWFwcGluZ0VtaXR0ZXIgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcblxyXG4gICAgQFZpZXdDaGlsZCgnbG9va3VwJykgbG9va3VwOiBMb29rdXBHcmlkQ29tcG9uZW50O1xyXG5cclxuICAgIHVyaTogc3RyaW5nO1xyXG4gICAgdGV4dEZpZWxkOiBzdHJpbmc7XHJcbiAgICBtYXBGaWVsZHM6IGFueTtcclxuICAgIGlkRmllbGQ6IGFueTtcclxuICAgIHZhbHVlRmllbGQ6IGFueTtcclxuICAgIHRleHRWYWx1ZTogYW55O1xyXG4gICAgZGlzcGxheVR5cGU6IGFueTtcclxuICAgIGNvbnRleHQ6IGFueTtcclxuICAgIHByZUV2ZW50Q21kOiBhbnk7XHJcbiAgICBwb3N0RXZlbnRDbWQ6IGFueTtcclxuICAgIGxvYWRUcmVlRGF0YVR5cGU6IHN0cmluZztcclxuICAgIGVuYWJsZUZ1bGxUcmVlOiBib29sZWFuO1xyXG4gICAgc2luZ2xlU2VsZWN0OiBib29sZWFuO1xyXG4gICAgZXhwYW5kTGV2ZWw6IG51bWJlcjtcclxuICAgIGVuYWJsZUNhc2NhZGU6IGJvb2xlYW47XHJcbiAgICB0ZXN0SWQ6IHN0cmluZztcclxuICAgIHBsYWNlaG9sZGVyOiBzdHJpbmc7XHJcbiAgICBub3NlYXJjaDogYm9vbGVhbjtcclxuICAgIGRpc3BsYXlGaWVsZHM6IHN0cmluZztcclxuICAgIGRpc3BsYXlUZXh0U2VwYXJhdG9yOiBzdHJpbmc7XHJcbiAgICBlZGl0YWJsZTogYm9vbGVhbjtcclxuICAgIGNsZWFyRmllbGRzOiBzdHJpbmc7XHJcbiAgICAvLyDmoIfpophcclxuICAgIGRpYWxvZ1RpdGxlOiBzdHJpbmc7XHJcbiAgICAvLyDlrr3luqZcclxuICAgIGRpYWxvZ1dpZHRoOiBudW1iZXI7XHJcbiAgICAvLyDpq5jluqZcclxuICAgIGRpYWxvZ0hlaWdodDogbnVtYmVyO1xyXG4gICAgLyoqIOavj+mhteiusOW9leaVsCAqL1xyXG4gICAgcGFnZVNpemU6IG51bWJlciA9IDIwO1xyXG4gICAgLyoqIOWPr+eUqOWIhumhteiusOW9leaVsOWIl+ihqCAqL1xyXG4gICAgcGFnZUxpc3Q6IEFycmF5PG51bWJlcj4gPSBbMTAsIDIwLCAzMCwgNTAsIDEwMF07XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBzb2x1dGlvblNlcnZpY2U6IFNvbHV0aW9uU2VydmljZSkgeyB9XHJcblxyXG4gICAgbmdPbkluaXQoKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5nZXRTbWFydEhlbHBCaW5kaW5nSW5mbygpO1xyXG4gICAgICAgIHRoaXMudGVzdElkID0gdGhpcy5zb2x1dGlvblNlcnZpY2UuZ2V0R3VpZCgpO1xyXG4gICAgICAgIHRoaXMucGxhY2Vob2xkZXIgPSAodGhpcy5pdGVtLnBsYWNlSG9sZGVyKSA/ICh0aGlzLml0ZW0ucGxhY2VIb2xkZXIpIDogKHRoaXMuaXRlbS5jb250cm9sLnBsYWNlaG9sZGVyKTtcclxuXHJcbiAgICAgICAgdGhpcy5sb29rdXAudGV4dENoYW5nZWQuc3Vic2NyaWJlKCh2KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMudGV4dENoYW5nZWRIYW5kbGVyKHYpO1xyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuZ2V0U21hcnRIZWxwQmluZGluZ0luZm8oKTtcclxuICAgICAgICBpZiAoY2hhbmdlc1snY2hhbmdlRmllbGRzJ10gJiYgY2hhbmdlc1snY2hhbmdlRmllbGRzJ10uY3VycmVudFZhbHVlICYmICFjaGFuZ2VzWydjaGFuZ2VGaWVsZHMnXS5maXJzdENoYW5nZSkge1xyXG4gICAgICAgICAgICBjb25zdCBpc0NoYW5nZSA9IGNoYW5nZXNbJ2NoYW5nZUZpZWxkcyddLmN1cnJlbnRWYWx1ZS5zb21lKGZpZWxkID0+IGZpZWxkID09IHRoaXMuaXRlbS5maWVsZENvZGUpO1xyXG4gICAgICAgICAgICBpZiAoaXNDaGFuZ2UpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudGV4dFZhbHVlID0gKHRoaXMuaXRlbS52YWx1ZSBhcyBTbWFydEhlbHBWYWx1ZSkudGV4dFZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vSVRFTe+8mlxyXG4gICAgLy9jb250cm9sOiBTbWFydEhlbHBDb250b2wge3VyaTogXCJXdUxpYW8ud09yZ0lkXCIsIHRleHRGaWVsZDogXCJuYW1lXCIsIHZhbHVlRmllbGQ6IFwiY29kZVwiLCBtYXBGaWVsZHM6IHt9LCBpZEZpZWxkOiBcImlkXCJ9XHJcbiAgICAvLyBmaWVsZENvZGU6IFwid09yZ0lkXCJcclxuICAgIC8vIGZpZWxkTmFtZTogXCLmiYDlsZ7mnLrmnoRcIlxyXG4gICAgLy8gaWQ6IFwiV3VMaWFvLndPcmdJZFwiXHJcbiAgICAvLyB2YWx1ZTogU21hcnRIZWxwVmFsdWUge3ZhbHVlRmllbGQ6IG51bGwsIHZhbHVlOiBudWxsfVxyXG4gICAgLy8gdmFsdWVUeXBlOiAwXHJcbiAgICBnZXRTbWFydEhlbHBCaW5kaW5nSW5mbygpIHtcclxuICAgICAgICBjb25zdCBzbWFydEhlbHBDb250cm9sID0gKHRoaXMuaXRlbS5jb250cm9sIGFzIFNtYXJ0SGVscENvbnRvbCk7XHJcbiAgICAgICAgdGhpcy51cmkgPSBzbWFydEhlbHBDb250cm9sLnVyaTtcclxuICAgICAgICB0aGlzLnRleHRGaWVsZCA9IHNtYXJ0SGVscENvbnRyb2wudGV4dEZpZWxkO1xyXG4gICAgICAgIHRoaXMuaWRGaWVsZCA9IHNtYXJ0SGVscENvbnRyb2wuaWRGaWVsZDtcclxuICAgICAgICB0aGlzLnZhbHVlRmllbGQgPSBzbWFydEhlbHBDb250cm9sLnZhbHVlRmllbGQ7XHJcbiAgICAgICAgdGhpcy5kaXNwbGF5VHlwZSA9IHNtYXJ0SGVscENvbnRyb2wuZGlzcGxheVR5cGU7XHJcbiAgICAgICAgdGhpcy5tYXBGaWVsZHMgPSBzbWFydEhlbHBDb250cm9sLm1hcEZpZWxkcztcclxuICAgICAgICB0aGlzLmNvbnRleHQgPSBzbWFydEhlbHBDb250cm9sLmNvbnRleHQ7XHJcbiAgICAgICAgdGhpcy5wcmVFdmVudENtZCA9IHNtYXJ0SGVscENvbnRyb2wucHJlRXZlbnRDbWQ7XHJcbiAgICAgICAgdGhpcy5wb3N0RXZlbnRDbWQgPSBzbWFydEhlbHBDb250cm9sLnBvc3RFdmVudENtZDtcclxuICAgICAgICB0aGlzLmVuYWJsZUZ1bGxUcmVlID0gc21hcnRIZWxwQ29udHJvbC5lbmFibGVGdWxsVHJlZTtcclxuICAgICAgICB0aGlzLmxvYWRUcmVlRGF0YVR5cGUgPSBzbWFydEhlbHBDb250cm9sLmxvYWRUcmVlRGF0YVR5cGU7XHJcbiAgICAgICAgdGhpcy5zaW5nbGVTZWxlY3QgPSBzbWFydEhlbHBDb250cm9sLnNpbmdsZVNlbGVjdCA9PT0gZmFsc2UgPyBmYWxzZSA6IHRydWU7XHJcbiAgICAgICAgdGhpcy5leHBhbmRMZXZlbCA9IHNtYXJ0SGVscENvbnRyb2wuZXhwYW5kTGV2ZWw7XHJcbiAgICAgICAgdGhpcy5lbmFibGVDYXNjYWRlID0gc21hcnRIZWxwQ29udHJvbC5lbmFibGVDYXNjYWRlO1xyXG4gICAgICAgIC8vIOagh+mimFxyXG4gICAgICAgIHRoaXMuZGlhbG9nVGl0bGUgPSBzbWFydEhlbHBDb250cm9sLmRpYWxvZ1RpdGxlP3NtYXJ0SGVscENvbnRyb2wuZGlhbG9nVGl0bGU6Jyc7XHJcbiAgICAgICAgLy8g5a695bqmXHJcbiAgICAgICAgdGhpcy5kaWFsb2dXaWR0aCA9IHNtYXJ0SGVscENvbnRyb2wucGFuZWxXaWR0aDtcclxuICAgICAgICAvLyDpq5jluqZcclxuICAgICAgICB0aGlzLmRpYWxvZ0hlaWdodCA9IHNtYXJ0SGVscENvbnRyb2wucGFuZWxIZWlnaHQ7XHJcbiAgICAgICAgY29uc3Qgc21hcnRIZWxwVmFsdWUgPSAodGhpcy5pdGVtLnZhbHVlIGFzIFNtYXJ0SGVscFZhbHVlKTtcclxuICAgICAgICBpZiAoc21hcnRIZWxwVmFsdWUudGV4dFZhbHVlID09ICdoZWxwLXRleHQtdmFsdWUtbnVsbCcpIHsvL+aXp+aVsOaNruWFvOWuuVxyXG4gICAgICAgICAgICB0aGlzLnRleHRWYWx1ZSA9IHNtYXJ0SGVscFZhbHVlLmdldFRleHRWYWx1ZSh0aGlzLnRleHRGaWVsZCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy50ZXh0VmFsdWUgPSBzbWFydEhlbHBWYWx1ZS50ZXh0VmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMubm9zZWFyY2ggPSBzbWFydEhlbHBDb250cm9sLm5vc2VhcmNoOy8v6buY6K6kZmFsc2VcclxuICAgICAgICB0aGlzLmRpc3BsYXlGaWVsZHMgPSBzbWFydEhlbHBDb250cm9sLmRpc3BsYXlGaWVsZHMgPyBzbWFydEhlbHBDb250cm9sLmRpc3BsYXlGaWVsZHMgOiAnJztcclxuICAgICAgICB0aGlzLmRpc3BsYXlUZXh0U2VwYXJhdG9yID0gc21hcnRIZWxwQ29udHJvbC5kaXNwbGF5VGV4dFNlcGFyYXRvciA/IHNtYXJ0SGVscENvbnRyb2wuZGlzcGxheVRleHRTZXBhcmF0b3IgOiAnXyc7XHJcbiAgICAgICAgdGhpcy5lZGl0YWJsZSA9IHNtYXJ0SGVscENvbnRyb2wuZWRpdGFibGU7XHJcbiAgICAgICAgdGhpcy5jbGVhckZpZWxkcyA9IHNtYXJ0SGVscENvbnRyb2wuY2xlYXJGaWVsZHM7XHJcbiAgICAgICAgaWYgKHNtYXJ0SGVscENvbnRyb2wuaGFzT3duUHJvcGVydHkoJ3BhZ2VTaXplJykgJiYgc21hcnRIZWxwQ29udHJvbC5wYWdlU2l6ZSkge1xyXG4gICAgICAgICAgICB0aGlzLnBhZ2VTaXplID0gc21hcnRIZWxwQ29udHJvbC5wYWdlU2l6ZVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoc21hcnRIZWxwQ29udHJvbC5oYXNPd25Qcm9wZXJ0eSgncGFnZUxpc3QnKSAmJiBzbWFydEhlbHBDb250cm9sLnBhZ2VMaXN0KSB7XHJcbiAgICAgICAgICAgIHRoaXMucGFnZUxpc3QgPSBzbWFydEhlbHBDb250cm9sLnBhZ2VMaXN0LnNwbGl0KFwiLFwiKS5tYXAoaXRlbSA9PiB7IHJldHVybiBwYXJzZUludChpdGVtKTsgfSlcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgb25CZWZvcmVPcGVuID0gKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLml0ZW0udmFsdWUgYXMgU21hcnRIZWxwVmFsdWU7XHJcbiAgICAgICAgaWYgKHQgJiYgdC52YWx1ZSkge1xyXG4gICAgICAgICAgICBjb25zdCBpZHMgPSB0LnZhbHVlLm1hcChuID0+IG5bdGhpcy5pZEZpZWxkIHx8ICdpZCddKS5qb2luKCcsJyk7XHJcbiAgICAgICAgICAgIHRoaXMubG9va3VwLmRpc3BsYXlWYWx1ZSA9IGlkcztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBvZih0cnVlKTtcclxuICAgIH1cclxuXHJcbiAgICBjbGVhckRhdGEoZGF0YTogYW55KSB7XHJcbiAgICAgICAgKHRoaXMuaXRlbS52YWx1ZSBhcyBTbWFydEhlbHBWYWx1ZSkuY2xlYXJWYWx1ZSgpO1xyXG4gICAgICAgIGlmICh0aGlzLml0ZW0uY29udHJvbC5jbGVhcikge1xyXG4gICAgICAgICAgICB0aGlzLml0ZW0uY29udHJvbC5jbGVhcigpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmNvbmRpdGlvbkNoYW5nZS5lbWl0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0Q29uZGl0aW9uSXRlbVRpdGxlKGZpZWxkOiBRdWVyeUNvbmRpdGlvbikge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnNvbHV0aW9uU2VydmljZS5nZXRDb25kaXRpb25JdGVtVGl0bGUoZmllbGQpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogc2VsZWN0ZWRJdGVtXHJcbiAgICAgKiBjb2RlOiBcImNvZGUwMlwiXHJcbiAgICAgICAgaWQ6IFwiaWQwMlwiXHJcbiAgICAgICAgbmFtZTogXCLmnLrmnoQwMlwiXHJcbiAgICAgICAgdmVyc2lvbjogXCIyMDE5LTEwLTIxVDAwOjAwOjAwXCJcclxuICAgICovXHJcbiAgICB0ZXh0Q2hhbmdlZEhhbmRsZXIoZGF0YTogc3RyaW5nKSB7Ly/miYvlt6XovpPlhaXml7bop6blj5FcclxuICAgICAgICBpZiAodGhpcy5pdGVtICYmIHRoaXMuaXRlbS52YWx1ZSkge1xyXG4gICAgICAgICAgICBjb25zdCBoZWxwVmFsdWUgPSAodGhpcy5pdGVtLnZhbHVlIGFzIFNtYXJ0SGVscFZhbHVlKTtcclxuICAgICAgICAgICAgaGVscFZhbHVlLnZhbHVlID0gW2RhdGFdO1xyXG4gICAgICAgICAgICBoZWxwVmFsdWUudGV4dFZhbHVlID0gZGF0YTtcclxuICAgICAgICAgICAgaGVscFZhbHVlLmlzSW5wdXRUZXh0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgLy8gdGhpcy50ZXh0VmFsdWUgPSBoZWxwVmFsdWUudGV4dFZhbHVlO1xyXG4gICAgICAgICAgICB0aGlzLmNvbmRpdGlvbkNoYW5nZS5lbWl0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHNlbGVjdGVkRGF0YUhhbmRsZXIoc2VsZWN0ZWRJdGVtOiBhbnkpIHsvL+mAieaLqeaXtuinpuWPkVxyXG4gICAgICAgIGNvbnN0IGhlbHBWYWx1ZSA9ICh0aGlzLml0ZW0udmFsdWUgYXMgU21hcnRIZWxwVmFsdWUpO1xyXG4gICAgICAgIGhlbHBWYWx1ZS52YWx1ZSA9IHRoaXMuc2luZ2xlU2VsZWN0ID8gW3NlbGVjdGVkSXRlbV0gOiBzZWxlY3RlZEl0ZW07Ly/ljZXpgInov5Tlm57lr7nosaHvvIzlpJrpgInov5Tlm57mlbDnu4RcclxuICAgICAgICBoZWxwVmFsdWUudmFsdWVGaWVsZCA9IHRoaXMudmFsdWVGaWVsZDtcclxuICAgICAgICBoZWxwVmFsdWUudGV4dFZhbHVlID0gdGhpcy50ZXh0VmFsdWU7XHJcbiAgICAgICAgaGVscFZhbHVlLmlzSW5wdXRUZXh0ID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5jb25kaXRpb25DaGFuZ2UuZW1pdCgpO1xyXG4gICAgfVxyXG59Il19