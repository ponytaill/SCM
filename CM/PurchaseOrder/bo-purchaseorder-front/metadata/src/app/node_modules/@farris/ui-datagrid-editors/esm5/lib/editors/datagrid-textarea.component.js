/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
/*
 * @Author: 疯狂秀才(Lucas Huang)
 * @Date: 2019-08-14 11:44:30
 * @LastEditors: 疯狂秀才(Lucas Huang)
 * @LastEditTime: 2019-10-14 13:15:49
 * @QQ: 1055818239
 * @Version: v0.0.1
 */
import { Component, ElementRef, ViewChild, Renderer2, NgZone, Injector } from '@angular/core';
import { MessagerService } from '@farris/ui-messager';
import { EventManager } from '@angular/platform-browser';
import { BsModalService } from '@farris/ui-modal';
import { TextareaWordcountDirective } from '@farris/ui-forms';
import { DatagridBaseEditorDirective } from '../datagrid-base-editor.directive';
var DatagridTextareaComponent = /** @class */ (function (_super) {
    tslib_1.__extends(DatagridTextareaComponent, _super);
    function DatagridTextareaComponent(render, el, ngzone, injector) {
        var _this = _super.call(this, render, el, injector) || this;
        _this.ngzone = ngzone;
        _this.injector = injector;
        _this.altEnterHandler = null;
        _this.modalService = _this.injector.get(BsModalService);
        _this.messagerService = _this.injector.get(MessagerService);
        _this.eventManager = _this.injector.get(EventManager);
        return _this;
    }
    /**
     * @return {?}
     */
    DatagridTextareaComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        _super.prototype.ngOnInit.call(this);
        if (!this.dg.nowrap) {
            this.render.setStyle(this.instance.nativeElement, 'height', this.height + "px");
        }
        this.inputElement = this.instance.nativeElement;
        this.ngzone.runOutsideAngular((/**
         * @return {?}
         */
        function () {
            _this.inputClickHandler = _this.render.listen(_this.instance.nativeElement, 'click', (/**
             * @param {?} e
             * @return {?}
             */
            function (e) {
                e.stopPropagation();
                return false;
            }));
        }));
        this.bindEventHandler();
    };
    /**
     * @return {?}
     */
    DatagridTextareaComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        if (this.instance) {
            this.inputClickHandler();
            if (this.altEnterHandler) {
                this.altEnterHandler();
            }
        }
    };
    /**
     * @private
     * @return {?}
     */
    DatagridTextareaComponent.prototype.bindEventHandler = /**
     * @private
     * @return {?}
     */
    function () {
        this.altEnterHandler = this.eventManager.addEventListener(this.inputElement, 'keydown.alt.enter', (/**
         * @param {?} event
         * @return {?}
         */
        function (event) {
            /** @type {?} */
            var target = ((/** @type {?} */ (event.target)));
            /** @type {?} */
            var val = target.value + '\n';
            target.value = val;
            event.preventDefault();
            event.stopPropagation();
            return false;
        }));
    };
    /**
     * @return {?}
     */
    DatagridTextareaComponent.prototype.showDialog = /**
     * @return {?}
     */
    function () {
        var _this = this;
        var _a = this.options, dialogWidth = _a.dialogWidth, dialogHeight = _a.dialogHeight;
        /** @type {?} */
        var opts = {
            width: dialogWidth || 500,
            height: dialogHeight || 400,
            showFontSize: true,
            enableWordCount: this.options.enableWordCount,
            countType: this.options.countType,
            maxLength: this.options.maxLength
        };
        this.messagerService.prompt2(this.column.title, this.formControl.value, opts).subscribe((/**
         * @param {?} v
         * @return {?}
         */
        function (v) {
            if (v) {
                _this.formControl.setValue(v);
            }
            _this.inputElement.focus();
            if (!_this.options.onlyShowInDialog && _this.wordcountref) {
                _this.wordcountref.updateWordsCount();
            }
        }));
    };
    DatagridTextareaComponent.decorators = [
        { type: Component, args: [{
                    selector: 'grid-editor-textarea',
                    template: "\n    <div [formGroup]=\"group\" class=\"f-datagrid-cell-formgroup farris-group-auto\" style=\"position:relative\">\n        <datagrid-tooltip [control]=\"formControl\" [tooltipPosition]=\"'top-left'\" [message]=\"errorMessage\">\n            <textarea #input class=\"form-control\"\n                style=\"height:100%;resize:none;min-height:auto;\"\n                [formControlName]=\"column.field\"\n                [word-count]=\"options?.enableWordCount\"\n                [countType]=\"options?.countType\"\n                #wordcount=\"WordCountRef\"\n                [onlyShowInDialog]=\"options?.onlyShowInDialog\"\n                maxlength=\"{{options?.maxLength}}\"></textarea>\n        </datagrid-tooltip>\n        <span class=\"f-icon modal_maximize\" title=\"\u5F39\u51FA\u7A97\u53E3\u8FDB\u884C\u7F16\u8F91\" *ngIf=\"options?.editType && options?.editType !== 'default'\"\n             style=\"position: absolute;top: 2px;right: 2px; cursor:pointer\" (click)=\"showDialog()\"></span>\n    </div>\n    "
                }] }
    ];
    /** @nocollapse */
    DatagridTextareaComponent.ctorParameters = function () { return [
        { type: Renderer2 },
        { type: ElementRef },
        { type: NgZone },
        { type: Injector }
    ]; };
    DatagridTextareaComponent.propDecorators = {
        instance: [{ type: ViewChild, args: ['input',] }],
        wordcountref: [{ type: ViewChild, args: ['wordcount',] }]
    };
    return DatagridTextareaComponent;
}(DatagridBaseEditorDirective));
export { DatagridTextareaComponent };
if (false) {
    /** @type {?} */
    DatagridTextareaComponent.prototype.instance;
    /** @type {?} */
    DatagridTextareaComponent.prototype.wordcountref;
    /**
     * @type {?}
     * @private
     */
    DatagridTextareaComponent.prototype.inputClickHandler;
    /**
     * @type {?}
     * @private
     */
    DatagridTextareaComponent.prototype.modalService;
    /**
     * @type {?}
     * @private
     */
    DatagridTextareaComponent.prototype.messagerService;
    /**
     * @type {?}
     * @private
     */
    DatagridTextareaComponent.prototype.eventManager;
    /**
     * @type {?}
     * @private
     */
    DatagridTextareaComponent.prototype.altEnterHandler;
    /**
     * @type {?}
     * @private
     */
    DatagridTextareaComponent.prototype.ngzone;
    /** @type {?} */
    DatagridTextareaComponent.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YWdyaWQtdGV4dGFyZWEuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1kYXRhZ3JpZC1lZGl0b3JzLyIsInNvdXJjZXMiOlsibGliL2VkaXRvcnMvZGF0YWdyaWQtdGV4dGFyZWEuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFRQSxPQUFPLEVBQUUsU0FBUyxFQUFpQixVQUFVLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxNQUFNLEVBQWEsUUFBUSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3hILE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN0RCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDekQsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQ2xELE9BQU8sRUFBRSwwQkFBMEIsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQzlELE9BQU8sRUFBRSwyQkFBMkIsRUFBRSxNQUFNLG1DQUFtQyxDQUFDO0FBRWhGO0lBbUIrQyxxREFBMkI7SUFTdEUsbUNBQ1EsTUFBaUIsRUFBRSxFQUFjLEVBQVUsTUFBYyxFQUFTLFFBQWtCO1FBRDVGLFlBR0ksa0JBQU0sTUFBTSxFQUFFLEVBQUUsRUFBRSxRQUFRLENBQUMsU0FJOUI7UUFOa0QsWUFBTSxHQUFOLE1BQU0sQ0FBUTtRQUFTLGNBQVEsR0FBUixRQUFRLENBQVU7UUFGcEYscUJBQWUsR0FBRyxJQUFJLENBQUM7UUFLM0IsS0FBSSxDQUFDLFlBQVksR0FBRyxLQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxjQUFjLENBQUMsQ0FBQztRQUN0RCxLQUFJLENBQUMsZUFBZSxHQUFHLEtBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLGVBQWUsQ0FBQyxDQUFDO1FBQzFELEtBQUksQ0FBQyxZQUFZLEdBQUcsS0FBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENB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Q3hDO1FBQ0wsQ0FBQyxFQUFDLENBQUM7SUFDUCxDQUFDOztnQkFqR0osU0FBUyxTQUFDO29CQUNQLFFBQVEsRUFBRSxzQkFBc0I7b0JBQ2hDLFFBQVEsRUFBRSw0L0JBZVQ7aUJBQ0o7Ozs7Z0JBekJ5RCxTQUFTO2dCQUFoQyxVQUFVO2dCQUF3QixNQUFNO2dCQUFhLFFBQVE7OzsyQkEyQjNGLFNBQVMsU0FBQyxPQUFPOytCQUNqQixTQUFTLFNBQUMsV0FBVzs7SUErRTFCLGdDQUFDO0NBQUEsQUFwR0QsQ0FtQitDLDJCQUEyQixHQWlGekU7U0FqRlkseUJBQXlCOzs7SUFDbEMsNkNBQXlDOztJQUN6QyxpREFBaUU7Ozs7O0lBQ2pFLHNEQUErQjs7Ozs7SUFDL0IsaURBQXFDOzs7OztJQUNyQyxvREFBeUM7Ozs7O0lBQ3pDLGlEQUFtQzs7Ozs7SUFFbkMsb0RBQStCOzs7OztJQUVZLDJDQUFzQjs7SUFBRSw2Q0FBeUIiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxyXG4gKiBAQXV0aG9yOiDnlq/ni4Lnp4DmiY0oTHVjYXMgSHVhbmcpXHJcbiAqIEBEYXRlOiAyMDE5LTA4LTE0IDExOjQ0OjMwXHJcbiAqIEBMYXN0RWRpdG9yczog55av54uC56eA5omNKEx1Y2FzIEh1YW5nKVxyXG4gKiBATGFzdEVkaXRUaW1lOiAyMDE5LTEwLTE0IDEzOjE1OjQ5XHJcbiAqIEBRUTogMTA1NTgxODIzOVxyXG4gKiBAVmVyc2lvbjogdjAuMC4xXHJcbiAqL1xyXG5pbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgSW5wdXQsIEVsZW1lbnRSZWYsIFZpZXdDaGlsZCwgUmVuZGVyZXIyLCBOZ1pvbmUsIE9uRGVzdHJveSwgSW5qZWN0b3IgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgTWVzc2FnZXJTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1tZXNzYWdlcic7XHJcbmltcG9ydCB7IEV2ZW50TWFuYWdlciB9IGZyb20gJ0Bhbmd1bGFyL3BsYXRmb3JtLWJyb3dzZXInO1xyXG5pbXBvcnQgeyBCc01vZGFsU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbW9kYWwnO1xyXG5pbXBvcnQgeyBUZXh0YXJlYVdvcmRjb3VudERpcmVjdGl2ZSB9IGZyb20gJ0BmYXJyaXMvdWktZm9ybXMnO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZEJhc2VFZGl0b3JEaXJlY3RpdmUgfSBmcm9tICcuLi9kYXRhZ3JpZC1iYXNlLWVkaXRvci5kaXJlY3RpdmUnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ2dyaWQtZWRpdG9yLXRleHRhcmVhJyxcclxuICAgIHRlbXBsYXRlOiBgXHJcbiAgICA8ZGl2IFtmb3JtR3JvdXBdPVwiZ3JvdXBcIiBjbGFzcz1cImYtZGF0YWdyaWQtY2VsbC1mb3JtZ3JvdXAgZmFycmlzLWdyb3VwLWF1dG9cIiBzdHlsZT1cInBvc2l0aW9uOnJlbGF0aXZlXCI+XHJcbiAgICAgICAgPGRhdGFncmlkLXRvb2x0aXAgW2NvbnRyb2xdPVwiZm9ybUNvbnRyb2xcIiBbdG9vbHRpcFBvc2l0aW9uXT1cIid0b3AtbGVmdCdcIiBbbWVzc2FnZV09XCJlcnJvck1lc3NhZ2VcIj5cclxuICAgICAgICAgICAgPHRleHRhcmVhICNpbnB1dCBjbGFzcz1cImZvcm0tY29udHJvbFwiXHJcbiAgICAgICAgICAgICAgICBzdHlsZT1cImhlaWdodDoxMDAlO3Jlc2l6ZTpub25lO21pbi1oZWlnaHQ6YXV0bztcIlxyXG4gICAgICAgICAgICAgICAgW2Zvcm1Db250cm9sTmFtZV09XCJjb2x1bW4uZmllbGRcIlxyXG4gICAgICAgICAgICAgICAgW3dvcmQtY291bnRdPVwib3B0aW9ucz8uZW5hYmxlV29yZENvdW50XCJcclxuICAgICAgICAgICAgICAgIFtjb3VudFR5cGVdPVwib3B0aW9ucz8uY291bnRUeXBlXCJcclxuICAgICAgICAgICAgICAgICN3b3JkY291bnQ9XCJXb3JkQ291bnRSZWZcIlxyXG4gICAgICAgICAgICAgICAgW29ubHlTaG93SW5EaWFsb2ddPVwib3B0aW9ucz8ub25seVNob3dJbkRpYWxvZ1wiXHJcbiAgICAgICAgICAgICAgICBtYXhsZW5ndGg9XCJ7e29wdGlvbnM/Lm1heExlbmd0aH19XCI+PC90ZXh0YXJlYT5cclxuICAgICAgICA8L2RhdGFncmlkLXRvb2x0aXA+XHJcbiAgICAgICAgPHNwYW4gY2xhc3M9XCJmLWljb24gbW9kYWxfbWF4aW1pemVcIiB0aXRsZT1cIuW8ueWHuueql+WPo+i/m+ihjOe8lui+kVwiICpuZ0lmPVwib3B0aW9ucz8uZWRpdFR5cGUgJiYgb3B0aW9ucz8uZWRpdFR5cGUgIT09ICdkZWZhdWx0J1wiXHJcbiAgICAgICAgICAgICBzdHlsZT1cInBvc2l0aW9uOiBhYnNvbHV0ZTt0b3A6IDJweDtyaWdodDogMnB4OyBjdXJzb3I6cG9pbnRlclwiIChjbGljayk9XCJzaG93RGlhbG9nKClcIj48L3NwYW4+XHJcbiAgICA8L2Rpdj5cclxuICAgIGBcclxufSlcclxuZXhwb3J0IGNsYXNzIERhdGFncmlkVGV4dGFyZWFDb21wb25lbnQgZXh0ZW5kcyBEYXRhZ3JpZEJhc2VFZGl0b3JEaXJlY3RpdmUgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSB7XHJcbiAgICBAVmlld0NoaWxkKCdpbnB1dCcpIGluc3RhbmNlOiBFbGVtZW50UmVmO1xyXG4gICAgQFZpZXdDaGlsZCgnd29yZGNvdW50Jykgd29yZGNvdW50cmVmOiBUZXh0YXJlYVdvcmRjb3VudERpcmVjdGl2ZTtcclxuICAgIHByaXZhdGUgaW5wdXRDbGlja0hhbmRsZXI6IGFueTtcclxuICAgIHByaXZhdGUgbW9kYWxTZXJ2aWNlOiBCc01vZGFsU2VydmljZTtcclxuICAgIHByaXZhdGUgbWVzc2FnZXJTZXJ2aWNlOiBNZXNzYWdlclNlcnZpY2U7XHJcbiAgICBwcml2YXRlIGV2ZW50TWFuYWdlcjogRXZlbnRNYW5hZ2VyO1xyXG5cclxuICAgIHByaXZhdGUgYWx0RW50ZXJIYW5kbGVyID0gbnVsbDtcclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgICAgICByZW5kZXI6IFJlbmRlcmVyMiwgZWw6IEVsZW1lbnRSZWYsIHByaXZhdGUgbmd6b25lOiBOZ1pvbmUsIHB1YmxpYyBpbmplY3RvcjogSW5qZWN0b3JcclxuICAgICAgICAgICApIHtcclxuICAgICAgICBzdXBlcihyZW5kZXIsIGVsLCBpbmplY3Rvcik7XHJcbiAgICAgICAgdGhpcy5tb2RhbFNlcnZpY2UgPSB0aGlzLmluamVjdG9yLmdldChCc01vZGFsU2VydmljZSk7XHJcbiAgICAgICAgdGhpcy5tZXNzYWdlclNlcnZpY2UgPSB0aGlzLmluamVjdG9yLmdldChNZXNzYWdlclNlcnZpY2UpO1xyXG4gICAgICAgIHRoaXMuZXZlbnRNYW5hZ2VyID0gdGhpcy5pbmplY3Rvci5nZXQoRXZlbnRNYW5hZ2VyKTtcclxuICAgIH1cclxuXHJcbiAgICBuZ09uSW5pdCgpIHtcclxuICAgICAgICBzdXBlci5uZ09uSW5pdCgpO1xyXG4gICAgICAgIGlmICghdGhpcy5kZy5ub3dyYXApIHtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXIuc2V0U3R5bGUodGhpcy5pbnN0YW5jZS5uYXRpdmVFbGVtZW50LCAnaGVpZ2h0JywgYCR7dGhpcy5oZWlnaHR9cHhgKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5pbnB1dEVsZW1lbnQgPSB0aGlzLmluc3RhbmNlLm5hdGl2ZUVsZW1lbnQ7XHJcbiAgICAgICAgdGhpcy5uZ3pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoICgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5pbnB1dENsaWNrSGFuZGxlciA9IHRoaXMucmVuZGVyLmxpc3Rlbih0aGlzLmluc3RhbmNlLm5hdGl2ZUVsZW1lbnQsICdjbGljaycsIChlOiBNb3VzZUV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGhpcy5iaW5kRXZlbnRIYW5kbGVyKCk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkRlc3Ryb3koKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuaW5zdGFuY2UpIHtcclxuICAgICAgICAgICAgdGhpcy5pbnB1dENsaWNrSGFuZGxlcigpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuYWx0RW50ZXJIYW5kbGVyKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFsdEVudGVySGFuZGxlcigpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgYmluZEV2ZW50SGFuZGxlcigpIHtcclxuICAgICAgICB0aGlzLmFsdEVudGVySGFuZGxlciA9IHRoaXMuZXZlbnRNYW5hZ2VyLmFkZEV2ZW50TGlzdGVuZXIodGhpcy5pbnB1dEVsZW1lbnQsICdrZXlkb3duLmFsdC5lbnRlcicsXHJcbiAgICAgICAgKGV2ZW50OiBLZXlib2FyZEV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRhcmdldCA9IChldmVudC50YXJnZXQgYXMgYW55KTtcclxuICAgICAgICAgICAgY29uc3QgdmFsID0gdGFyZ2V0LnZhbHVlICsgJ1xcbic7XHJcbiAgICAgICAgICAgIHRhcmdldC52YWx1ZSA9IHZhbDtcclxuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBzaG93RGlhbG9nKCkge1xyXG5cclxuICAgICAgICBjb25zdCB7IGRpYWxvZ1dpZHRoLCBkaWFsb2dIZWlnaHQgfSA9IHRoaXMub3B0aW9ucztcclxuICAgICAgICBjb25zdCBvcHRzID0ge1xyXG4gICAgICAgICAgICB3aWR0aDogZGlhbG9nV2lkdGggfHwgNTAwLFxyXG4gICAgICAgICAgICBoZWlnaHQ6IGRpYWxvZ0hlaWdodCB8fCA0MDAsXHJcbiAgICAgICAgICAgIHNob3dGb250U2l6ZTogdHJ1ZSxcclxuICAgICAgICAgICAgZW5hYmxlV29yZENvdW50OiB0aGlzLm9wdGlvbnMuZW5hYmxlV29yZENvdW50LFxyXG4gICAgICAgICAgICBjb3VudFR5cGU6IHRoaXMub3B0aW9ucy5jb3VudFR5cGUsXHJcbiAgICAgICAgICAgIG1heExlbmd0aDogdGhpcy5vcHRpb25zLm1heExlbmd0aFxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHRoaXMubWVzc2FnZXJTZXJ2aWNlLnByb21wdDIodGhpcy5jb2x1bW4udGl0bGUsIHRoaXMuZm9ybUNvbnRyb2wudmFsdWUsIG9wdHMpLnN1YnNjcmliZSh2ID0+IHtcclxuICAgICAgICAgICAgaWYgKHYpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZm9ybUNvbnRyb2wuc2V0VmFsdWUodik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5pbnB1dEVsZW1lbnQuZm9jdXMoKTtcclxuXHJcbiAgICAgICAgICAgIGlmICghdGhpcy5vcHRpb25zLm9ubHlTaG93SW5EaWFsb2cgJiYgdGhpcy53b3JkY291bnRyZWYpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMud29yZGNvdW50cmVmLnVwZGF0ZVdvcmRzQ291bnQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuXHJcbn1cclxuIl19