/**
 * 绑定对象工厂相关定义
 * @author Witt<jiwt@inspur.com>
 */
import { PropertyUtil } from './property_util';
import { BindingPropertyType } from './binding_property';
import { BindingObject } from './binding_object';
import { BindingListFactory } from './binding_list_factory';
/**
 * BindingObject工厂用于创建一个空的BindingObject对象，并对其属性进行扩展。
 *
 * **扩展属性处理**
 *
 * 对于要扩展的属性（BindingProperty）有三种处理：
 * - 普通属性：初始化为一个undefined，并包装get、set方法，通过set方法监听变更；
 * - 对象属性：初始化为一个空的BindingObject对象，并监听子对象的变更；
 * - 列表属性：初始化为一个空的BindingList对象，并监听子列表的变更；
 *
 * **示例代码**
 *
 * ```ts
 *  const empProperties = PropertyUtil.getProperties(EmpEntity);
 * const empBindingObject = BindingObjectFactory.create(properties);
 * ```
 */
var BindingObjectFactory = /** @class */ (function () {
    function BindingObjectFactory() {
    }
    /**
     * 创建BindingObject实例
     * @param properties 要扩展的属性集合
     * @returns 带扩展属性的空BindingObject对象
     * @
     */
    BindingObjectFactory.create = function (properties) {
        var object = new BindingObject(properties);
        this.extendProperties(object, properties);
        return object;
    };
    BindingObjectFactory.createDynamicBindingObject = function (data) {
        var properties = PropertyUtil.getDynamicProperties(data);
        var object = new BindingObject(properties);
        this.extendProperties(object, properties);
        return object;
    };
    /**
     * 扩展属性绑定对象的属性
     * @param object     要扩展的绑定对象
     * @param properties 绑定属性集合
     */
    BindingObjectFactory.extendProperties = function (object, properties) {
        var _this = this;
        // 扩展BindingObject属性
        properties.forEach(function (property) {
            if (property.type === BindingPropertyType.List) {
                _this.extendListProperty(object, property);
            }
            else if (property.type === BindingPropertyType.Object) {
                _this.extendObjectProperty(object, property);
            }
            else if (property.type === BindingPropertyType.Dynamic) {
                _this.extendDynamicObjectProperty(object, property);
            }
            else {
                _this.extendPlainProperty(object, property);
            }
        });
    };
    /**
     * 扩展列表类型的绑定属性
     * @param object     要扩展的绑定对象
     * @param properties 列表类型的绑定属性集合
     */
    BindingObjectFactory.extendListProperty = function (object, property) {
        var propertyName = property.name;
        var childListProperties = PropertyUtil.getProperties(property.entityType);
        var childList = BindingListFactory.create(childListProperties);
        // 指定子List的parent、监听子List的changes事件
        childList.parent = object;
        childList.changes.subscribe(function (change) {
            change.path.unshift(propertyName);
            object.changes.next(change);
        });
        // 将子的BindingList实例赋值给当前属性
        Object.defineProperty(object, propertyName, {
            value: childList
        });
    };
    /**
     * 扩展对象类型的绑定属性
     * @param object     要扩展的绑定对象
     * @param properties 对象类型的绑定属性集合
     */
    BindingObjectFactory.extendObjectProperty = function (object, property) {
        var propertyName = property.name;
        var childObjectProperties = PropertyUtil.getProperties(property.entityType);
        var childObject = this.create(childObjectProperties);
        // 指定子Object的parent、监听子Object的changes事件
        childObject.parent = object;
        childObject.changes.subscribe(function (change) {
            change.path.unshift(propertyName);
            object.changes.next(change);
        });
        Object.defineProperty(object, propertyName, {
            value: childObject
        });
    };
    BindingObjectFactory.extendDynamicObjectProperty = function (object, property) {
        var propertyName = property.name;
        object[propertyName] = null;
    };
    BindingObjectFactory.attachDynamicObjectProperty = function (object, propertyName, dynamicObject) {
        dynamicObject.parent = object;
        dynamicObject.changes.subscribe(function (change) {
            change.path.unshift(propertyName);
            object.changes.next(change);
        });
        Object.defineProperty(object, propertyName, {
            value: dynamicObject
        });
    };
    /**
     * 扩展简单类型的绑定属性
     * @param object     要扩展的绑定对象
     * @param properties 简单类型的绑定属性集合
     */
    BindingObjectFactory.extendPlainProperty = function (object, property) {
        var propertyName = property.name;
        Object.defineProperty(object, propertyName, {
            get: function () {
                return object.getValue(propertyName);
            },
            set: function (value) {
                var oldValue = object.getValue(propertyName);
                if (value === oldValue) {
                    return;
                }
                object.setValue(propertyName, value, true, true);
            }
        });
    };
    return BindingObjectFactory;
}());
export { BindingObjectFactory };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmluZGluZ19vYmplY3RfZmFjdG9yeS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvbW9iaWxlLWRldmtpdC8iLCJzb3VyY2VzIjpbImxpYi9iaW5kaW5nLWRhdGEvYmluZGluZ19vYmplY3RfZmFjdG9yeS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0dBR0c7QUFHSCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDL0MsT0FBTyxFQUFtQixtQkFBbUIsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQzFFLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUNqRCxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUU1RDs7Ozs7Ozs7Ozs7Ozs7OztHQWdCRztBQUNIO0lBQUE7SUE0SEEsQ0FBQztJQTFIQzs7Ozs7T0FLRztJQUNJLDJCQUFNLEdBQWIsVUFBYyxVQUE2QjtRQUN6QyxJQUFNLE1BQU0sR0FBRyxJQUFJLGFBQWEsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUM3QyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxFQUFFLFVBQVUsQ0FBQyxDQUFDO1FBQzFDLE9BQU8sTUFBTSxDQUFDO0lBQ2hCLENBQUM7SUFFTSwrQ0FBMEIsR0FBakMsVUFBa0MsSUFBUztRQUN6QyxJQUFNLFVBQVUsR0FBRyxZQUFZLENBQUMsb0JBQW9CLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDM0QsSUFBTSxNQUFNLEdBQUcsSUFBSSxhQUFhLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDN0MsSUFBSSxDQUFDLGdCQUFnQixDQUFDLE1BQU0sRUFBRSxVQUFVLENBQUMsQ0FBQztRQUMxQyxPQUFPLE1BQU0sQ0FBQztJQUNoQixDQUFDO0lBRUQ7Ozs7T0FJRztJQUNJLHFDQUFnQixHQUF2QixVQUF3QixNQUFxQixFQUFFLFVBQTZCO1FBQTVFLGlCQWNDO1FBWkMsb0JBQW9CO1FBQ3BCLFVBQVUsQ0FB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YztZQUM3QyxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUNsQyxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUM5QixDQUFDLENBQUMsQ0FBQztRQUNILE1BQU0sQ0FBQyxjQUFjLENBQUMsTUFBTSxFQUFFLFlBQVksRUFBRTtZQUMxQyxLQUFLLEVBQUUsYUFBYTtTQUNyQixDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQ7Ozs7T0FJRztJQUNJLHdDQUFtQixHQUExQixVQUEyQixNQUFxQixFQUFFLFFBQXlCO1FBQ3pFLElBQU0sWUFBWSxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUM7UUFDbkMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxNQUFNLEVBQUUsWUFBWSxFQUFFO1lBQzFDLEdBQUcsRUFBRTtnQkFDSCxPQUFPLE1BQU0sQ0FBQyxRQUFRLENBQUMsWUFBWSxDQUFDLENBQUM7WUFDdkMsQ0FBQztZQUNELEdBQUcsRUFBRSxVQUFDLEtBQVU7Z0JBQ2QsSUFBTSxRQUFRLEdBQUcsTUFBTSxDQUFDLFFBQVEsQ0FBQyxZQUFZLENBQUMsQ0FBQztnQkFDL0MsSUFBSSxLQUFLLEtBQUssUUFBUSxFQUFFO29CQUN0QixPQUFPO2lCQUNSO2dCQUNELE1BQU0sQ0FBQyxRQUFRLENBQUMsWUFBWSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7WUFDbkQsQ0FBQztTQUNGLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFSCwyQkFBQztBQUFELENBQUMsQUE1SEQsSUE0SEM7QUFFRCxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiDnu5Hlrprlr7nosaHlt6XljoLnm7jlhbPlrprkuYlcclxuICogQGF1dGhvciBXaXR0PGppd3RAaW5zcHVyLmNvbT5cclxuICovXHJcblxyXG5pbXBvcnQgeyBDaGFuZ2UgfSBmcm9tICcuL2NoYW5nZXMnO1xyXG5pbXBvcnQgeyBQcm9wZXJ0eVV0aWwgfSBmcm9tICcuL3Byb3BlcnR5X3V0aWwnO1xyXG5pbXBvcnQgeyBCaW5kaW5nUHJvcGVydHksIEJpbmRpbmdQcm9wZXJ0eVR5cGUgfSBmcm9tICcuL2JpbmRpbmdfcHJvcGVydHknO1xyXG5pbXBvcnQgeyBCaW5kaW5nT2JqZWN0IH0gZnJvbSAnLi9iaW5kaW5nX29iamVjdCc7XHJcbmltcG9ydCB7IEJpbmRpbmdMaXN0RmFjdG9yeSB9IGZyb20gJy4vYmluZGluZ19saXN0X2ZhY3RvcnknO1xyXG5cclxuLyoqXHJcbiAqIEJpbmRpbmdPYmplY3Tlt6XljoLnlKjkuo7liJvlu7rkuIDkuKrnqbrnmoRCaW5kaW5nT2JqZWN05a+56LGh77yM5bm25a+55YW25bGe5oCn6L+b6KGM5omp5bGV44CCXHJcbiAqXHJcbiAqICoq5omp5bGV5bGe5oCn5aSE55CGKipcclxuICpcclxuICog5a+55LqO6KaB5omp5bGV55qE5bGe5oCn77yIQmluZGluZ1Byb3BlcnR577yJ5pyJ5LiJ56eN5aSE55CG77yaXHJcbiAqIC0g5pmu6YCa5bGe5oCn77ya5Yid5aeL5YyW5Li65LiA5LiqdW5kZWZpbmVk77yM5bm25YyF6KOFZ2V044CBc2V05pa55rOV77yM6YCa6L+Hc2V05pa55rOV55uR5ZCs5Y+Y5pu077ybXHJcbiAqIC0g5a+56LGh5bGe5oCn77ya5Yid5aeL5YyW5Li65LiA5Liq56m655qEQmluZGluZ09iamVjdOWvueixoe+8jOW5tuebkeWQrOWtkOWvueixoeeahOWPmOabtO+8m1xyXG4gKiAtIOWIl+ihqOWxnuaAp++8muWIneWni+WMluS4uuS4gOS4quepuueahEJpbmRpbmdMaXN05a+56LGh77yM5bm255uR5ZCs5a2Q5YiX6KGo55qE5Y+Y5pu077ybXHJcbiAqXHJcbiAqICoq56S65L6L5Luj56CBKipcclxuICpcclxuICogYGBgdHNcclxuICogIGNvbnN0IGVtcFByb3BlcnRpZXMgPSBQcm9wZXJ0eVV0aWwuZ2V0UHJvcGVydGllcyhFbXBFbnRpdHkpO1xyXG4gKiBjb25zdCBlbXBCaW5kaW5nT2JqZWN0ID0gQmluZGluZ09iamVjdEZhY3RvcnkuY3JlYXRlKHByb3BlcnRpZXMpO1xyXG4gKiBgYGBcclxuICovXHJcbmNsYXNzIEJpbmRpbmdPYmplY3RGYWN0b3J5IHtcclxuXHJcbiAgLyoqXHJcbiAgICog5Yib5bu6QmluZGluZ09iamVjdOWunuS+i1xyXG4gICAqIEBwYXJhbSBwcm9wZXJ0aWVzIOimgeaJqeWxleeahOWxnuaAp+mbhuWQiFxyXG4gICAqIEByZXR1cm5zIOW4puaJqeWxleWxnuaAp+eahOepukJpbmRpbmdPYmplY3Tlr7nosaFcclxuICAgKiBAXHJcbiAgICovXHJcbiAgc3RhdGljIGNyZWF0ZShwcm9wZXJ0aWVzOiBCaW5kaW5nUHJvcGVydHlbXSk6IEJpbmRpbmdPYmplY3Qge1xyXG4gICAgY29uc3Qgb2JqZWN0ID0gbmV3IEJpbmRpbmdPYmplY3QocHJvcGVydGllcyk7XHJcbiAgICB0aGlzLmV4dGVuZFByb3BlcnRpZXMob2JqZWN0LCBwcm9wZXJ0aWVzKTtcclxuICAgIHJldHVybiBvYmplY3Q7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgY3JlYXRlRHluYW1pY0JpbmRpbmdPYmplY3QoZGF0YTogYW55KTogQmluZGluZ09iamVjdCB7XHJcbiAgICBjb25zdCBwcm9wZXJ0aWVzID0gUHJvcGVydHlVdGlsLmdldER5bmFtaWNQcm9wZXJ0aWVzKGRhdGEpO1xyXG4gICAgY29uc3Qgb2JqZWN0ID0gbmV3IEJpbmRpbmdPYmplY3QocHJvcGVydGllcyk7XHJcbiAgICB0aGlzLmV4dGVuZFByb3BlcnRpZXMob2JqZWN0LCBwcm9wZXJ0aWVzKTtcclxuICAgIHJldHVybiBvYmplY3Q7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmianlsZXlsZ7mgKfnu5Hlrprlr7nosaHnmoTlsZ7mgKdcclxuICAgKiBAcGFyYW0gb2JqZWN0ICAgICDopoHmianlsZXnmoTnu5Hlrprlr7nosaFcclxuICAgKiBAcGFyYW0gcHJvcGVydGllcyDnu5HlrprlsZ7mgKfpm4blkIhcclxuICAgKi9cclxuICBzdGF0aWMgZXh0ZW5kUHJvcGVydGllcyhvYmplY3Q6IEJpbmRpbmdPYmplY3QsIHByb3BlcnRpZXM6IEJpbmRpbmdQcm9wZXJ0eVtdKTogdm9pZCB7XHJcblxyXG4gICAgLy8g5omp5bGVQmluZGluZ09iamVjdOWxnuaAp1xyXG4gICAgcHJvcGVydGllcy5mb3JFYWNoKChwcm9wZXJ0eTogQmluZGluZ1Byb3BlcnR5KSA9PiB7XHJcbiAgICAgIGlmIChwcm9wZXJ0eS50eXBlID09PSBCaW5kaW5nUHJvcGVydHlUeXBlLkxpc3QpIHtcclxuICAgICAgICB0aGlzLmV4dGVuZExpc3RQcm9wZXJ0eShvYmplY3QsIHByb3BlcnR5KTtcclxuICAgICAgfSBlbHNlIGlmIChwcm9wZXJ0eS50eXBlID09PSBCaW5kaW5nUHJvcGVydHlUeXBlLk9iamVjdCkge1xyXG4gICAgICAgIHRoaXMuZXh0ZW5kT2JqZWN0UHJvcGVydHkob2JqZWN0LCBwcm9wZXJ0eSk7XHJcbiAgICAgIH0gZWxzZSBpZiAocHJvcGVydHkudHlwZSA9PT0gQmluZGluZ1Byb3BlcnR5VHlwZS5EeW5hbWljKSB7XHJcbiAgICAgICAgdGhpcy5leHRlbmREeW5hbWljT2JqZWN0UHJvcGVydHkob2JqZWN0LCBwcm9wZXJ0eSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5leHRlbmRQbGFpblByb3BlcnR5KG9iamVjdCwgcHJvcGVydHkpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaJqeWxleWIl+ihqOexu+Wei+eahOe7keWumuWxnuaAp1xyXG4gICAqIEBwYXJhbSBvYmplY3QgICAgIOimgeaJqeWxleeahOe7keWumuWvueixoVxyXG4gICAqIEBwYXJhbSBwcm9wZXJ0aWVzIOWIl+ihqOexu+Wei+eahOe7keWumuWxnuaAp+mbhuWQiFxyXG4gICAqL1xyXG4gIHN0YXRpYyBleHRlbmRMaXN0UHJvcGVydHkob2JqZWN0OiBCaW5kaW5nT2JqZWN0LCBwcm9wZXJ0eTogQmluZGluZ1Byb3BlcnR5KTogdm9pZCB7XHJcbiAgICBjb25zdCBwcm9wZXJ0eU5hbWUgPSBwcm9wZXJ0eS5uYW1lO1xyXG4gICAgY29uc3QgY2hpbGRMaXN0UHJvcGVydGllcyA9IFByb3BlcnR5VXRpbC5nZXRQcm9wZXJ0aWVzKHByb3BlcnR5LmVudGl0eVR5cGUpO1xyXG4gICAgY29uc3QgY2hpbGRMaXN0ID0gQmluZGluZ0xpc3RGYWN0b3J5LmNyZWF0ZShjaGlsZExpc3RQcm9wZXJ0aWVzKTtcclxuXHJcbiAgICAvLyDmjIflrprlrZBMaXN055qEcGFyZW5044CB55uR5ZCs5a2QTGlzdOeahGNoYW5nZXPkuovku7ZcclxuICAgIGNoaWxkTGlzdC5wYXJlbnQgPSBvYmplY3Q7XHJcbiAgICBjaGlsZExpc3QuY2hhbmdlcy5zdWJzY3JpYmUoKGNoYW5nZTogQ2hhbmdlKSA9PiB7XHJcbiAgICAgIGNoYW5nZS5wYXRoLnVuc2hpZnQocHJvcGVydHlOYW1lKTtcclxuICAgICAgb2JqZWN0LmNoYW5nZXMubmV4dChjaGFuZ2UpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgLy8g5bCG5a2Q55qEQmluZGluZ0xpc3Tlrp7kvovotYvlgLznu5nlvZPliY3lsZ7mgKdcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmplY3QsIHByb3BlcnR5TmFtZSwge1xyXG4gICAgICB2YWx1ZTogY2hpbGRMaXN0XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaJqeWxleWvueixoeexu+Wei+eahOe7keWumuWxnuaAp1xyXG4gICAqIEBwYXJhbSBvYmplY3QgICAgIOimgeaJqeWxleeahOe7keWumuWvueixoVxyXG4gICAqIEBwYXJhbSBwcm9wZXJ0aWVzIOWvueixoeexu+Wei+eahOe7keWumuWxnuaAp+mbhuWQiFxyXG4gICAqL1xyXG4gIHN0YXRpYyBleHRlbmRPYmplY3RQcm9wZXJ0eShvYmplY3Q6IEJpbmRpbmdPYmplY3QsIHByb3BlcnR5OiBCaW5kaW5nUHJvcGVydHkpOiB2b2lkIHtcclxuICAgIGNvbnN0IHByb3BlcnR5TmFtZSA9IHByb3BlcnR5Lm5hbWU7XHJcbiAgICBjb25zdCBjaGlsZE9iamVjdFByb3BlcnRpZXMgPSBQcm9wZXJ0eVV0aWwuZ2V0UHJvcGVydGllcyhwcm9wZXJ0eS5lbnRpdHlUeXBlKTtcclxuICAgIGNvbnN0IGNoaWxkT2JqZWN0ID0gdGhpcy5jcmVhdGUoY2hpbGRPYmplY3RQcm9wZXJ0aWVzKTtcclxuXHJcbiAgICAvLyDmjIflrprlrZBPYmplY3TnmoRwYXJlbnTjgIHnm5HlkKzlrZBPYmplY3TnmoRjaGFuZ2Vz5LqL5Lu2XHJcbiAgICBjaGlsZE9iamVjdC5wYXJlbnQgPSBvYmplY3Q7XHJcbiAgICBjaGlsZE9iamVjdC5jaGFuZ2VzLnN1YnNjcmliZSgoY2hhbmdlOiBDaGFuZ2UpID0+IHtcclxuICAgICAgY2hhbmdlLnBhdGgudW5zaGlmdChwcm9wZXJ0eU5hbWUpO1xyXG4gICAgICBvYmplY3QuY2hhbmdlcy5uZXh0KGNoYW5nZSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqZWN0LCBwcm9wZXJ0eU5hbWUsIHtcclxuICAgICAgdmFsdWU6IGNoaWxkT2JqZWN0XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBleHRlbmREeW5hbWljT2JqZWN0UHJvcGVydHkob2JqZWN0OiBCaW5kaW5nT2JqZWN0LCBwcm9wZXJ0eTogQmluZGluZ1Byb3BlcnR5KTogdm9pZCB7XHJcbiAgICBjb25zdCBwcm9wZXJ0eU5hbWUgPSBwcm9wZXJ0eS5uYW1lO1xyXG4gICAgb2JqZWN0W3Byb3BlcnR5TmFtZV0gPSBudWxsO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIGF0dGFjaER5bmFtaWNPYmplY3RQcm9wZXJ0eShvYmplY3Q6IEJpbmRpbmdPYmplY3QsIHByb3BlcnR5TmFtZTogc3RyaW5nLCBkeW5hbWljT2JqZWN0OiBCaW5kaW5nT2JqZWN0KSB7XHJcbiAgICBkeW5hbWljT2JqZWN0LnBhcmVudCA9IG9iamVjdDtcclxuICAgIGR5bmFtaWNPYmplY3QuY2hhbmdlcy5zdWJzY3JpYmUoKGNoYW5nZTogQ2hhbmdlKSA9PiB7XHJcbiAgICAgIGNoYW5nZS5wYXRoLnVuc2hpZnQocHJvcGVydHlOYW1lKTtcclxuICAgICAgb2JqZWN0LmNoYW5nZXMubmV4dChjaGFuZ2UpO1xyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqZWN0LCBwcm9wZXJ0eU5hbWUsIHtcclxuICAgICAgdmFsdWU6IGR5bmFtaWNPYmplY3RcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5omp5bGV566A5Y2V57G75Z6L55qE57uR5a6a5bGe5oCnXHJcbiAgICogQHBhcmFtIG9iamVjdCAgICAg6KaB5omp5bGV55qE57uR5a6a5a+56LGhXHJcbiAgICogQHBhcmFtIHByb3BlcnRpZXMg566A5Y2V57G75Z6L55qE57uR5a6a5bGe5oCn6ZuG5ZCIXHJcbiAgICovXHJcbiAgc3RhdGljIGV4dGVuZFBsYWluUHJvcGVydHkob2JqZWN0OiBCaW5kaW5nT2JqZWN0LCBwcm9wZXJ0eTogQmluZGluZ1Byb3BlcnR5KTogdm9pZCB7XHJcbiAgICBjb25zdCBwcm9wZXJ0eU5hbWUgPSBwcm9wZXJ0eS5uYW1lO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iamVjdCwgcHJvcGVydHlOYW1lLCB7XHJcbiAgICAgIGdldDogKCkgPT4ge1xyXG4gICAgICAgIHJldHVybiBvYmplY3QuZ2V0VmFsdWUocHJvcGVydHlOYW1lKTtcclxuICAgICAgfSxcclxuICAgICAgc2V0OiAodmFsdWU6IGFueSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IG9sZFZhbHVlID0gb2JqZWN0LmdldFZhbHVlKHByb3BlcnR5TmFtZSk7XHJcbiAgICAgICAgaWYgKHZhbHVlID09PSBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBvYmplY3Quc2V0VmFsdWUocHJvcGVydHlOYW1lLCB2YWx1ZSwgdHJ1ZSwgdHJ1ZSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbn1cclxuXHJcbmV4cG9ydCB7IEJpbmRpbmdPYmplY3RGYWN0b3J5IH07XHJcbiJdfQ==