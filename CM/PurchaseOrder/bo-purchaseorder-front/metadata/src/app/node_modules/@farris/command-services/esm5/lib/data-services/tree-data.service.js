import * as tslib_1 from "tslib";
import { Injectable, Optional } from '@angular/core';
import { of, empty, EMPTY } from 'rxjs';
import { tap, switchMap, concatMap } from 'rxjs/operators';
import { FrameContext, FieldMetadataUtil } from '@farris/devkit';
import { BefRepositoryUtil } from '@farris/bef';
import { FormLoadingService } from '../form-loading/form-loading.service';
import { FormNotifyService } from '../form-notify.service';
import { LanguageService } from '../languag.service';
import { FormMessageService } from '../form-message.service';
import { FormErrorService } from '../error/form-error.service';
import { BaseDataService } from './base-data.service';
import { TreeUtilFactory } from './tree-table/util/tree-util-factory';
import { TreeRepositoryFactory } from './tree-table/repository/tree-repository-factory';
// tslint:disable: no-string-literal
/**
 * 树数据服务
 */
var TreeDataService = /** @class */ (function (_super) {
    tslib_1.__extends(TreeDataService, _super);
    /**
     * 构造函数
     */
    function TreeDataService(frameContext, messageService, loadingService, notifyService, errorService, languageService) {
        var _this = _super.call(this, frameContext) || this;
        _this.messageService = messageService;
        _this.loadingService = loadingService;
        _this.notifyService = notifyService;
        _this.errorService = errorService;
        _this.languageService = languageService;
        if (!languageService) {
            _this.languageService = LanguageService.getInstance();
        }
        return _this;
    }
    Object.defineProperty(TreeDataService.prototype, "hierarchyInfoKey", {
        /**
         * 分级信息字段名
         */
        get: function () {
            return this.virtualRootFrameContext.getParam('hierarchyInfoKey');
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TreeDataService.prototype, "virtualRootFrameContext", {
        get: function () {
            return this.frameContext.getVirtualRootFrameContext();
        },
        enumerable: true,
        configurable: true
    });
    /**
     * 加载数据
     */
    TreeDataService.prototype.load = function (filters, sorts) {
        var _this = this;
        var filtersArray = this.parseConditions(filters);
        var sortsArray = this.parseConditions(sorts);
        var correctSelectedNode = this.repository.entityCollection.count() === 0;
        var loadingTimerId = this.loadingService.showLoadingWithDelay(500);
        var query$ = this.repository.getEntities(filtersArray, sortsArray, null, null);
        return query$.pipe(tap(function () {
            // 纠正选中节点
            if (correctSelectedNode === true) {
                var hierarchyType = _this.getHierarchyType();
                var treeNodeUtil = TreeUtilFactory.getInstance(hierarchyType);
                if (treeNodeUtil !== null) {
                    treeNodeUtil.selectFirstRootNode(_this.bindingData, _this.hierarchyInfoKey);
                }
            }
            _this.loadingService.hideDelayLoading(loadingTimerId);
        }, function (error) {
            _this.loadingService.hideDelayLoading(loadingTimerId);
            _this.errorService.exception(_this.languageService.loadFailed, error);
        }));
    };
    /**
     * 分层加载数据
     */
    TreeDataService.prototype.loadByLevel = function (filters, sorts, frozenCurrentRow) {
        var _this = this;
        this.setLoadByLevelState(filters, sorts);
        var filtersArray = this.parseConditions(filters);
        var sortsArray = this.parseConditions(sorts);
        // const parentId = this.bindingData.list.currentId;
        var parentId = this.getIdToExpand();
        var correctSelectedNode = this.repository.entityCollection.count() === 0;
        if (frozenCurrentRow === undefined) {
            frozenCurrentRow = false;
        }
        if (typeof frozenCurrentRow !== 'boolean') {
            frozenCurrentRow = frozenCurrentRow === 'true' ? true : false;
        }
        var hierarchyType = this.getHierarchyType();
        var repository = TreeRepositoryFactory.getInstance(hierarchyType);
        if (repository === null) {
            return empty();
        }
        var loadingTimerId = this.loadingService.showLoadingWithDelay(500);
        // 构造分页信息
        var pagination = this.buildPaginationInfo(parentId);
        var reload = this.frameContext.params.get('_RELOAD_CHILDREN_') || false;
        var query$ = repository.loadByParentId(this.repository, this.hierarchyInfoKey, parentId, filtersArray, sortsArray, frozenCurrentRow, pagination, this.frameContext, reload);
        return query$.pipe(tap(function (entities) {
            _this.frameContext.params.delete('_RELOAD_CHILDREN_');
            // 纠正选中节点
            if (correctSelectedNode === true) {
                var treeNodeUtil = TreeUtilFactory.getInstance(hierarchyType);
                if (treeNodeUtil !== null) {
                    treeNodeUtil.selectFirstRootNode(_this.bindingData, _this.hierarchyInfoKey);
                }
            }
            var currentRowId = _this.bindingData.list.currentItem.primaryKeyValue;
            if (frozenCurrentRow) {
                // 如果上一次选中行为本次加载数据中的一条，则应该重新选中该行
                var containsCurrentRow = entities.find(function (item) { return item.primaryValue === currentRowId; });
                if (containsCurrentRow) {
                    _this.setCurrentId(currentRowId);
                }
                // 原来的当前行不在已经加载的数据中，如展开到第三级，将第三级的某行设为当前行，全部收起，展开第一级
                if (!_this.repository.entityCollection.getEntityById(currentRowId)) {
                    var firstChildId = entities && Array.isArray(entities) && entities.length > 0 && entities[0].primaryValue || null;
                    if (firstChildId) {
                        _this.setCurrentId(firstChildId);
                    }
                }
            }
            _this.loadingService.hideDelayLoading(loadingTimerId);
        }, function (error) {
            _this.loadingService.hideDelayLoading(loadingTimerId);
            _this.errorService.exception(_this.languageService.loadFailed, error);
        }));
    };
    /**
     * 加载完整树
     * @param virtualPropertyName 虚拟字段
     * @param fullTreeType 是否是完整树加载 0：完整树 1：部分树
     * @param loadType 是否分级加载 0：全部加载 1：分级加载
     * @param filter 过滤条件
     * @param frozenCurrentRow 冻结当前行
     */
    TreeDataService.prototype.loadFullTree = function (virtualPropertyName, fullTreeType, loadType, filters, frozenCurrentRow) {
        var _this = this;
        if (typeof fullTreeType !== 'string') {
            throw new Error('ArgumentError: fullTreeType 不能为空且必须为字符串。');
        }
        if (typeof loadType !== 'string') {
            throw new Error('ArgumentError: loadType 不能为空且必须为字符串。');
        }
        if (frozenCurrentRow === undefined) {
            frozenCurrentRow = false;
        }
        if (typeof frozenCurrentRow !== 'boolean') {
            frozenCurrentRow = frozenCurrentRow === 'true' ? true : false;
        }
        var virtualRootFrameContext = this.virtualRootFrameContext;
        // 还原上次设置的结果集
        virtualRootFrameContext.params.delete('_DEVKIT_expandRowIds');
        virtualRootFrameContext.params.delete('_DEVKIT_selectedRowId');
        virtualRootFrameContext.uiState.setPropertyValue('__DEVKIT__selectedRow', null);
        var filtersArray = this.parseConditions(filters);
        var parentId = this.getIdToExpand();
        var correctSelectedNode = this.repository.entityCollection.count() === 0;
        var hierarchyType = this.getHierarchyType();
        var repository = TreeRepositoryFactory.getInstance(hierarchyType);
        if (repository === null) {
            return EMPTY;
        }
        var loadingTimerId = this.loadingService.showLoadingWithDelay(500);
        var context = {
            frameContext: this.frameContext,
            frozenCurrentRow: frozenCurrentRow
        };
        // tslint:disable-next-line: max-line-length
        var query$ = repository.loadFullTree(this.repository, this.hierarchyInfoKey, parentId, virtualPropertyName, fullTreeType, loadType, filtersArray, context);
        return query$.pipe(tap(function (entities) {
            var selectedRowId = virtualRootFrameContext.params.get('_DEVKIT_selectedRowId');
            // 纠正选中节点
            if (correctSelectedNode === true || !selectedRowId) {
                var treeNodeUtil = TreeUtilFactory.getInstance(hierarchyType);
                if (treeNodeUtil !== null) {
                    treeNodeUtil.selectFirstRootNode(_this.bindingData, _this.hierarchyInfoKey);
                }
            }
            var currentRowId = _this.bindingData.list.currentItem.primaryKeyValue;
            if (frozenCurrentRow) {
                // 如果上一次选中行为本次加载数据中的一条，则应该重新选中该行
                var containsCurrentRow = entities.find(function (item) { return item.primaryValue === currentRowId; });
                if (containsCurrentRow) {
                    _this.setCurrentId(currentRowId);
                }
                // 原来的当前行不在已经加载的数据中，如展开到第三级，将第三级的某行设为当前行，全部收起，展开第一级
                if (!_this.repository.entityCollection.getEntityById(currentRowId) && entities && entities.length > 0) {
                    var firstChildId = entities && Array.isArray(entities) && entities.length > 0 && entities[0].primaryValue || null;
                    if (firstChildId) {
                        _this.setCurrentId(firstChildId);
                    }
                }
            }
            _this.loadingService.hideDelayLoading(loadingTimerId);
        }, function (error) {
            _this.loadingService.hideDelayLoading(loadingTimerId);
            _this.errorService.exception(_this.languageService.loadFailed, error);
        }));
    };
    /**
     * 获取最新展开的节点
     */
    TreeDataService.prototype.getIdToExpand = function () {
        var expandNodes = this.virtualRootFrameContext.getParam('TREE_LATEST_EXPANDED_ID') || [];
        var idToExpand = expandNodes.pop();
        this.virtualRootFrameContext.setParam('TREE_LATEST_EXPANDED_ID', expandNodes);
        return idToExpand;
    };
    /**
     * 设置最新展开的节点
     */
    TreeDataService.prototype.setIdToExpand = function (idToExpand) {
        var expandNodes = this.virtualRootFrameContext.getParam('TREE_LATEST_EXPANDED_ID') || [];
        expandNodes.push(idToExpand);
        this.virtualRootFrameContext.setParam('TREE_LATEST_EXPANDED_ID', expandNodes);
    };
    /**
     * 解析过滤条件
     */
    TreeDataService.prototype.parseConditions = function (conditions) {
        var conditionsString = (!conditions || conditions === '') ? '[]' : conditions;
        return JSON.parse(conditionsString);
    };
    /**
     * 新增同级
     */
    TreeDataService.prototype.addSibling = function (id) {
        var _this = this;
        // 设计时id的获取改为从命令参数上获取，但设计时没有参数必填检查，
        // 如果打开表单保存了（即更新了最新的命令构件），但没有配置该参数，可能会传递过来一个空值，
        // 为了兼容此情况，使用当前行id作为id的值
        id = id ? id : this.bindingData.list.currentId;
        // 参数检查
        if (!id || id === 'undefined') {
            id = '';
        }
        // 记录最近一次修改的数据id
        var lastModifiedId = this.bindingData.list.currentId;
        // 获取分级方式
        var hierarchyType = this.getHierarchyType();
        // 执行取数
        var loadingTimerId = this.loadingService.showLoadingWithDelay(500);
        var repository = TreeRepositoryFactory.getInstance(hierarchyType);
        if (!repository) {
            // 错误的分级码
            throw new Error(this.languageService['errorHierarchyKey']);
        }
        var result$ = repository.addSibling(this.repository, id);
        return result$.pipe(tap(function () {
            _this.virtualRootFrameContext.setParam('IS_ADD', true);
            _this.virtualRootFrameContext.setParam('LAST_MODIFIED_ID', lastModifiedId);
            _this.loadingService.hideDelayLoading(loadingTimerId);
        }, function (error) {
            _this.loadingService.hideDelayLoading(loadingTimerId);
            _this.errorService.exception(_this.languageService.addSiblingFailed, error);
        }));
    };
    /**
     * 新增下级
     */
    TreeDataService.prototype.addChild = function (id) {
        var _this = this;
        // 原因同addSibling的修改
        id = id ? id : this.bindingData.list.currentId;
        // 参数检查
        if (!id) {
            // 请选择父节点
            this.notifyService.warning(this.languageService['plsSelectParentNode'], { hideTitle: true });
            return empty();
        }
        // 记录最近一次修改的数据id
        var lastModifiedId = this.bindingData.list.currentId;
        // 获取分级方式
        var hierarchyType = this.getHierarchyType();
        // 执行取数
        var loadingTimerId = this.loadingService.showLoadingWithDelay(500);
        // 新增的时候，要展开父节点
        this.setIdToExpand(id);
        var reloadChild$ = this.reloadByLevel();
        var repository = TreeRepositoryFactory.getInstance(hierarchyType);
        if (!repository) {
            throw new Error(this.languageService['errorHierarchyKey']);
        }
        var addChild$ = repository.addChild(this.repository, id);
        var result$ = reloadChild$.pipe(switchMap(function () {
            return addChild$;
        }), tap(function () {
            _this.virtualRootFrameContext.setParam('IS_ADD', true);
            _this.virtualRootFrameContext.setParam('LAST_MODIFIED_ID', lastModifiedId);
            _this.loadingService.hideDelayLoading(loadingTimerId);
        }, function (error) {
            _this.loadingService.hideDelayLoading(loadingTimerId);
            _this.errorService.exception(_this.languageService.addChildFailed, error);
        }));
        return result$;
    };
    /**
     * 批量保存
     */
    TreeDataService.prototype.save = function () {
        var _this = this;
        if (this.messagePipe) {
            this.messagePipe.next({ messageType: 'save' });
        }
        var loadingTimerId = this.loadingService.showLoadingWithDelay(500);
        var save$ = this.repository.applyChanges();
        var result$ = save$.pipe(tap(function () {
            _this.loadingService.hideDelayLoading(loadingTimerId);
            _this.notifyService.success(_this.languageService.saveSuccess, { hideTitle: true });
        }, function (error) {
            _this.loadingService.hideDelayLoading(loadingTimerId);
            _this.errorService.exception(_this.languageService.multiSaveFailed, error);
        }));
        return result$;
    };
    /**
     * 删除
     */
    TreeDataService.prototype.remove = function (id, successMsg) {
        var _this = this;
        // 原因同addSibling
        id = id ? id : this.bindingData.list.currentId;
        // 参数检查
        if (!id) {
            this.notifyService.warning(this.languageService['plsSelectDeleteData'], { hideTitle: true });
            return empty();
        }
        // 存在子节点不允许删除
        var treeNodesData = this.repository.entityCollection.toJSON();
        var hierarchyType = this.getHierarchyType();
        var treeNodeUtil = TreeUtilFactory.getInstance(hierarchyType);
        if (treeNodeUtil === null) {
            return empty();
        }
        if (treeNodeUtil.hasChildNodes(treeNodesData, this.hierarchyInfoKey, id) === true) {
            this.notifyService.warning(this.languageService['deleteChildFirst'], { hideTitle: true });
            return empty();
        }
        // 确认删除
        var action$ = this.messageService.question(this.languageService.confirmDeletion);
        return action$.pipe(concatMap(function (result) {
            if (!result) {
                return empty();
            }
            // 获取删除后要设置的节点id
            var nextNodeId = treeNodeUtil.getNextNodeId(treeNodesData, _this.hierarchyInfoKey, id);
            // 执行删除
            var loadingTimerId = _this.loadingService.showLoadingWithDelay(500);
            var remove$ = _this.frameContext.repository.removeById(id);
            return remove$.pipe(tap(function () {
                // 设置选中节点
                treeNodeUtil.selectedNode(_this.bindingData, _this.hierarchyInfoKey, nextNodeId);
                _this.loadingService.hideDelayLoading(loadingTimerId);
                if (successMsg && successMsg.trim()) {
                    _this.notifyService.success(successMsg, { hideTitle: true });
                }
                else {
                    _this.notifyService.success(_this.languageService.deleteSuccess, { hideTitle: true });
                }
                // this.notifyService.success(this.languageService.deleteSuccess, { hideTitle: true });
            }, function (error) {
                _this.loadingService.hideDelayLoading(loadingTimerId);
                _this.errorService.exception(_this.languageService.deleteFailed, error);
            }));
        }));
    };
    /**
     * 取消时检测未保存记录
     */
    TreeDataService.prototype.cancel = function () {
        var _this = this;
        // 没有变更时直接取消
        // const cardDataService = this.frameContext.injector.get<CardDataService>(CardDataService);
        var befRepository = this.repository;
        var hasUnsavedData = BefRepositoryUtil.isExistUnsaveData(befRepository);
        if (!hasUnsavedData) {
            return this._cancel();
        }
        var confirmResult$ = this.messageService.question(this.languageService['cancelWithoutSave']).pipe(switchMap(function (ifCancel) {
            if (ifCancel === false) {
                return EMPTY;
            }
            return _this._cancel();
        }));
        return confirmResult$;
    };
    /**
     * 构造分页信息
     * @param parentId parentId
     * @returns
     */
    TreeDataService.prototype.buildPaginationInfo = function (parentId) {
        var pagination = { pageIndex: 0, pageSize: 0 };
        var enableNodePagination = this.frameContext.params.get('enableNodePagination');
        if (!parentId) {
            // 一级分页
            var pageSize = this.repository.entityCollection.pageSize || 0;
            var pageIndex = this.repository.entityCollection.pageIndex || 0;
            // 启用了一级分页
            if (pageSize !== 0) {
                pagination.pageSize = pageSize;
                pagination.pageIndex = pageIndex;
            }
        }
        else {
            // 如果未启用节点分页或当前为顶级节点加载，则不处理节点分页
            if (enableNodePagination) {
                var nodePageSize = this.frameContext.params.get('nodePageSize') || 0;
                var nodePageIndex = this.frameContext.params.get("_NODE_" + parentId + "_PAGE_INDEX_");
                if (!nodePageIndex) {
                    this.frameContext.params.set("_NODE_" + parentId + "_PAGE_INDEX_", 1);
                    nodePageIndex = 1;
                }
                pagination.pageIndex = nodePageIndex;
                pagination.pageSize = nodePageSize;
            }
        }
        return pagination;
    };
    /**
     * 取消变更
     */
    TreeDataService.prototype._cancel = function () {
        var _this = this;
        var loadingTimerId = this.loadingService.showLoadingWithDelay(500);
        var cancel$ = this.repository.cancelChanges();
        return cancel$.pipe(switchMap(function () {
            var isAdd = _this.virtualRootFrameContext.getParam('IS_ADD');
            var lastModifiedId = _this.virtualRootFrameContext.getParam('LAST_MODIFIED_ID');
            var currentId = _this.bindingData.list.currentId;
            if (isAdd === true) {
                _this.repository.entityCollection.removeEntityById(currentId);
                // 重置编辑状态
                _this.virtualRootFrameContext.setParam('IS_ADD', false);
                if (lastModifiedId) {
                    setTimeout(function () {
                        _this.bindingData.list.setCurrentId(lastModifiedId, true, true);
                    }, 0);
                }
                return of(null);
            }
            else {
                return _this.repository.updateById(currentId);
            }
        }), tap(function () {
            _this.loadingService.hideDelayLoading(loadingTimerId);
        }, function (error) {
            _this.loadingService.hideDelayLoading(loadingTimerId);
            _this.errorService.exception(_this.languageService.cancelFailed, error);
        }));
    };
    /**
     * 检查是否存在下级节点（内部方法，请勿使用）
     */
    TreeDataService.prototype.hasChildNodes = function (id, treeNodesData) {
        var treeNodeUtil = this.getTreeNodeUtil();
        if (treeNodeUtil.hasChildNodes(treeNodesData, this.hierarchyInfoKey, id) === true) {
            return true;
        }
        return false;
    };
    /**
     * 计算删除后的当前节点id（内部方法，请勿使用）
     */
    TreeDataService.prototype.getNextNodeIdAfterRemoving = function (idToRemove, treeNodesData) {
        var treeNodeUtil = this.getTreeNodeUtil();
        var nextNodeId = treeNodeUtil.getNextNodeId(treeNodesData, this.hierarchyInfoKey, idToRemove);
        return nextNodeId;
    };
    /**
     * 设置删除后的当前节点节点（内部方法，请勿使用）
     */
    TreeDataService.prototype.setNextNodeAfterRemoving = function (nextNodeId) {
        var treeNodeUtil = this.getTreeNodeUtil();
        treeNodeUtil.selectedNode(this.bindingData, this.hierarchyInfoKey, nextNodeId);
    };
    /**
     * 设置树的当前行(给完整树使用)
     * @param id id
     */
    TreeDataService.prototype.setCurrentId = function (id) {
        id = id || this.frameContext.getVirtualRootFrameContext().uiState['__DEVKIT__selectedRow'] || this.bindingData.list.currentItem.primaryKeyValue;
        this.frameContext.bindingData.list.setCurrentId(id, true, true, true);
    };
    /**
     * 选中树的第一个节点
     */
    TreeDataService.prototype.selectFirstRow = function () {
        var hierarchyType = this.getHierarchyType();
        var treeNodeUtil = TreeUtilFactory.getInstance(hierarchyType);
        if (treeNodeUtil !== null) {
            treeNodeUtil.selectFirstRootNode(this.bindingData, this.hierarchyInfoKey);
        }
    };
    /**
     * 获取树节点工具类实例
     */
    TreeDataService.prototype.getTreeNodeUtil = function () {
        var hierarchyType = this.getHierarchyType();
        var treeNodeUtil = TreeUtilFactory.getInstance(hierarchyType);
        if (treeNodeUtil === null) {
            throw new Error("\u4E0D\u652F\u6301" + hierarchyType + "\u7C7B\u578B\u7684\u5206\u7EA7");
        }
        return treeNodeUtil;
    };
    /**
     * 记录加载状态
     * @todo：待删除
     */
    TreeDataService.prototype.setLoadByLevelState = function (filters, sorts) {
        // @todo：临时处理
        this.virtualRootFrameContext.setParam('isLoadTreeByLevel', true);
        this.virtualRootFrameContext.setParam('loadTreeByLevelFilter', filters);
        this.virtualRootFrameContext.setParam('loadTreeByLevelSort', sorts);
    };
    /**
     * 展开当前节点
     * @todo：待删除
     */
    TreeDataService.prototype.reloadByLevel = function () {
        var isLoadByLevel = this.virtualRootFrameContext.getParam('isLoadTreeByLevel');
        if (isLoadByLevel === true) {
            var filters = this.virtualRootFrameContext.getParam('loadTreeByLevelFilter');
            var sorts = this.virtualRootFrameContext.getParam('loadTreeByLevelSort');
            return this.loadByLevel(filters, sorts);
        }
        return of([]);
    };
    TreeDataService.prototype.getHierarchyType = function () {
        var ngObjects = FieldMetadataUtil.getNgObjects(this.repository.entityType);
        var hierarchyInfoNgObjectInfo = ngObjects[this.hierarchyInfoKey];
        var hierarchyType = 'path'; // 分级码默认为path，兼容原表单
        if (hierarchyInfoNgObjectInfo.hasOwnProperty('hierarchyType') && hierarchyInfoNgObjectInfo['hierarchyType'] != null) {
            hierarchyType = hierarchyInfoNgObjectInfo['hierarchyType'];
        }
        if (hierarchyType == null || hierarchyType.length < 1) {
            // '分级码配置信息错误'
            throw new Error(this.languageService['incorrectHierarchyConfig']);
        }
        return hierarchyType;
    };
    Object.defineProperty(TreeDataService.prototype, "messagePipe", {
        /**
         * 获取根组件消息管道
         */
        get: function () {
            if (this.frameContext) {
                var appContext = this.frameContext.getFormAppContext() || null;
                if (appContext) {
                    return appContext.messagePipe || null;
                }
            }
            return null;
        },
        enumerable: true,
        configurable: true
    });
    TreeDataService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    TreeDataService.ctorParameters = function () { return [
        { type: FrameContext },
        { type: FormMessageService },
        { type: FormLoadingService },
        { type: FormNotifyService },
        { type: FormErrorService },
        { type: LanguageService, decorators: [{ type: Optional }] }
    ]; };
    return TreeDataService;
}(BaseDataService));
export { TreeDataService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJlZS1kYXRhLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2NvbW1hbmQtc2VydmljZXMvIiwic291cmNlcyI6WyJsaWIvZGF0YS1zZXJ2aWNlcy90cmVlLWRhdGEuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDckQsT0FBTyxFQUFjLEVBQUUsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ3BELE9BQU8sRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRTNELE9BQU8sRUFBVSxZQUFZLEVBQUUsaUJBQWlCLEVBQW1CLE1BQU0sZ0JBQWdCLENBQUM7QUFDMUYsT0FBTyxFQUFpQixpQkFBaUIsRUFBRSxNQUFNLGFBQWEsQ0FBQztBQUUvRCxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxzQ0FBc0MsQ0FBQztBQUMxRSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUMzRCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDckQsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFDN0QsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFFL0QsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBRXRELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQ0FBcUMsQ0FBQztBQUN0RSxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSxpREFBaUQsQ0FBQztBQUN4RixvQ0FBb0M7QUFFcEM7O0dBRUc7QUFDSDtJQUM4QiwyQ0FBZTtJQVkzQzs7T0FFRztJQUNILHlCQUNFLFlBQTBCLEVBQ2xCLGNBQWtDLEVBQ2xDLGNBQWtDLEVBQ2xDLGFBQWdD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QUMsQ0FBQyxtQkFBbUI7UUFDL0MsSUFBSSx5QkFBeUIsQ0FBQyxjQUFjLENBQUMsZUFBZSxDQUFDLElBQUkseUJBQXlCLENBQUMsZUFBZSxDQUFDLElBQUksSUFBSSxFQUFFO1lBQ25ILGFBQWEsR0FBRyx5QkFBeUIsQ0FBQyxlQUFlLENBQVcsQ0FBQztTQUN0RTtRQUNELElBQUksYUFBYSxJQUFJLElBQUksSUFBSSxhQUFhLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUNyRCxjQUFjO1lBQ2QsTUFBTSxJQUFJLEtBQUssQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLDBCQUEwQixDQUFDLENBQUMsQ0FBQztTQUNuRTtRQUNELE9BQU8sYUFBYSxDQUFDO0lBQ3ZCLENBQUM7SUFJRCxzQkFBWSx3Q0FBVztRQUh2Qjs7V0FFRzthQUNIO1lBQ0UsSUFBSSxJQUFJLENBQUMsWUFBWSxFQUFFO2dCQUNyQixJQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLGlCQUFpQixFQUFFLElBQUksSUFBSSxDQUFDO2dCQUNqRSxJQUFJLFVBQVUsRUFBRTtvQkFDZCxPQUFPLFVBQVUsQ0FBQyxXQUFXLElBQUksSUFBSSxDQUFDO2lCQUN2QzthQUNGO1lBQ0QsT0FBTyxJQUFJLENBQUM7UUFDZCxDQUFDOzs7T0FBQTs7Z0JBbm1CRixVQUFVOzs7O2dCQWxCTSxZQUFZO2dCQU1wQixrQkFBa0I7Z0JBSGxCLGtCQUFrQjtnQkFDbEIsaUJBQWlCO2dCQUdqQixnQkFBZ0I7Z0JBRmhCLGVBQWUsdUJBbUNuQixRQUFROztJQThrQmIsc0JBQUM7Q0FBQSxBQXBtQkQsQ0FDOEIsZUFBZSxHQW1tQjVDO0FBQ0QsT0FBTyxFQUFFLGVBQWUsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgT3B0aW9uYWwgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE9ic2VydmFibGUsIG9mLCBlbXB0eSwgRU1QVFkgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IHRhcCwgc3dpdGNoTWFwLCBjb25jYXRNYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbmltcG9ydCB7IEVudGl0eSwgRnJhbWVDb250ZXh0LCBGaWVsZE1ldGFkYXRhVXRpbCwgTmdGaWVsZFByb3BlcnR5IH0gZnJvbSAnQGZhcnJpcy9kZXZraXQnO1xuaW1wb3J0IHsgQmVmUmVwb3NpdG9yeSwgQmVmUmVwb3NpdG9yeVV0aWwgfSBmcm9tICdAZmFycmlzL2JlZic7XG5cbmltcG9ydCB7IEZvcm1Mb2FkaW5nU2VydmljZSB9IGZyb20gJy4uL2Zvcm0tbG9hZGluZy9mb3JtLWxvYWRpbmcuc2VydmljZSc7XG5pbXBvcnQgeyBGb3JtTm90aWZ5U2VydmljZSB9IGZyb20gJy4uL2Zvcm0tbm90aWZ5LnNlcnZpY2UnO1xuaW1wb3J0IHsgTGFuZ3VhZ2VTZXJ2aWNlIH0gZnJvbSAnLi4vbGFuZ3VhZy5zZXJ2aWNlJztcbmltcG9ydCB7IEZvcm1NZXNzYWdlU2VydmljZSB9IGZyb20gJy4uL2Zvcm0tbWVzc2FnZS5zZXJ2aWNlJztcbmltcG9ydCB7IEZvcm1FcnJvclNlcnZpY2UgfSBmcm9tICcuLi9lcnJvci9mb3JtLWVycm9yLnNlcnZpY2UnO1xuXG5pbXBvcnQgeyBCYXNlRGF0YVNlcnZpY2UgfSBmcm9tICcuL2Jhc2UtZGF0YS5zZXJ2aWNlJztcbmltcG9ydCB7IEVkaXRTdGF0ZVV0aWwgfSBmcm9tICcuL3V0aWxzL2luZGV4JztcbmltcG9ydCB7IFRyZWVVdGlsRmFjdG9yeSB9IGZyb20gJy4vdHJlZS10YWJsZS91dGlsL3RyZWUtdXRpbC1mYWN0b3J5JztcbmltcG9ydCB7IFRyZWVSZXBvc2l0b3J5RmFjdG9yeSB9IGZyb20gJy4vdHJlZS10YWJsZS9yZXBvc2l0b3J5L3RyZWUtcmVwb3NpdG9yeS1mYWN0b3J5Jztcbi8vIHRzbGludDpkaXNhYmxlOiBuby1zdHJpbmctbGl0ZXJhbFxuXG4vKipcbiAqIOagkeaVsOaNruacjeWKoVxuICovXG5ASW5qZWN0YWJsZSgpXG5jbGFzcyBUcmVlRGF0YVNlcnZpY2UgZXh0ZW5kcyBCYXNlRGF0YVNlcnZpY2Uge1xuXG4gIC8qKlxuICAgKiDliIbnuqfkv6Hmga/lrZfmrrXlkI1cbiAgICovXG4gIHByaXZhdGUgZ2V0IGhpZXJhcmNoeUluZm9LZXkoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy52aXJ0dWFsUm9vdEZyYW1lQ29udGV4dC5nZXRQYXJhbSgnaGllcmFyY2h5SW5mb0tleScpO1xuICB9XG4gIHByaXZhdGUgZ2V0IHZpcnR1YWxSb290RnJhbWVDb250ZXh0KCkge1xuICAgIHJldHVybiB0aGlzLmZyYW1lQ29udGV4dC5nZXRWaXJ0dWFsUm9vdEZyYW1lQ29udGV4dCgpO1xuICB9XG5cbiAgLyoqXG4gICAqIOaehOmAoOWHveaVsFxuICAgKi9cbiAgY29uc3RydWN0b3IoXG4gICAgZnJhbWVDb250ZXh0OiBGcmFtZUNvbnRleHQsXG4gICAgcHJpdmF0ZSBtZXNzYWdlU2VydmljZTogRm9ybU1lc3NhZ2VTZXJ2aWNlLFxuICAgIHByaXZhdGUgbG9hZGluZ1NlcnZpY2U6IEZvcm1Mb2FkaW5nU2VydmljZSxcbiAgICBwcml2YXRlIG5vdGlmeVNlcnZpY2U6IEZvcm1Ob3RpZnlTZXJ2aWNlLFxuICAgIHByaXZhdGUgZXJyb3JTZXJ2aWNlOiBGb3JtRXJyb3JTZXJ2aWNlLFxuICAgIEBPcHRpb25hbCgpIHByaXZhdGUgbGFuZ3VhZ2VTZXJ2aWNlOiBMYW5ndWFnZVNlcnZpY2VcbiAgKSB7XG4gICAgc3VwZXIoZnJhbWVDb250ZXh0KTtcbiAgICBpZiAoIWxhbmd1YWdlU2VydmljZSkge1xuICAgICAgdGhpcy5sYW5ndWFnZVNlcnZpY2UgPSBMYW5ndWFnZVNlcnZpY2UuZ2V0SW5zdGFuY2UoKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog5Yqg6L295pWw5o2uXG4gICAqL1xuICBwdWJsaWMgbG9hZChmaWx0ZXJzPzogc3RyaW5nLCBzb3J0cz86IHN0cmluZyk6IE9ic2VydmFibGU8RW50aXR5W10+IHtcbiAgICBjb25zdCBmaWx0ZXJzQXJyYXkgPSB0aGlzLnBhcnNlQ29uZGl0aW9ucyhmaWx0ZXJzKTtcbiAgICBjb25zdCBzb3J0c0FycmF5ID0gdGhpcy5wYXJzZUNvbmRpdGlvbnMoc29ydHMpO1xuICAgIGNvbnN0IGNvcnJlY3RTZWxlY3RlZE5vZGUgPSB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5jb3VudCgpID09PSAwO1xuXG4gICAgY29uc3QgbG9hZGluZ1RpbWVySWQgPSB0aGlzLmxvYWRpbmdTZXJ2aWNlLnNob3dMb2FkaW5nV2l0aERlbGF5KDUwMCk7XG4gICAgY29uc3QgcXVlcnkkID0gdGhpcy5yZXBvc2l0b3J5LmdldEVudGl0aWVzKGZpbHRlcnNBcnJheSwgc29ydHNBcnJheSwgbnVsbCwgbnVsbCk7XG4gICAgcmV0dXJuIHF1ZXJ5JC5waXBlKFxuICAgICAgdGFwKFxuICAgICAgICAoKSA9PiB7XG5cbiAgICAgICAgICAvLyDnuqDmraPpgInkuK3oioLngrlcbiAgICAgICAgICBpZiAoY29ycmVjdFNlbGVjdGVkTm9kZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgY29uc3QgaGllcmFyY2h5VHlwZSA9IHRoaXMuZ2V0SGllcmFyY2h5VHlwZSgpO1xuICAgICAgICAgICAgY29uc3QgdHJlZU5vZGVVdGlsID0gVHJlZVV0aWxGYWN0b3J5LmdldEluc3RhbmNlKGhpZXJhcmNoeVR5cGUpO1xuICAgICAgICAgICAgaWYgKHRyZWVOb2RlVXRpbCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICB0cmVlTm9kZVV0aWwuc2VsZWN0Rmlyc3RSb290Tm9kZSh0aGlzLmJpbmRpbmdEYXRhLCB0aGlzLmhpZXJhcmNoeUluZm9LZXkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICAgIHRoaXMubG9hZGluZ1NlcnZpY2UuaGlkZURlbGF5TG9hZGluZyhsb2FkaW5nVGltZXJJZCk7XG4gICAgICAgIH0sXG4gICAgICAgIChlcnJvcjogYW55KSA9PiB7XG4gICAgICAgICAgdGhpcy5sb2FkaW5nU2VydmljZS5oaWRlRGVsYXlMb2FkaW5nKGxvYWRpbmdUaW1lcklkKTtcbiAgICAgICAgICB0aGlzLmVycm9yU2VydmljZS5leGNlcHRpb24odGhpcy5sYW5ndWFnZVNlcnZpY2UubG9hZEZhaWxlZCwgZXJyb3IpO1xuICAgICAgICB9XG4gICAgICApXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDliIblsYLliqDovb3mlbDmja5cbiAgICovXG4gIHB1YmxpYyBsb2FkQnlMZXZlbChmaWx0ZXJzPzogc3RyaW5nLCBzb3J0cz86IHN0cmluZywgZnJvemVuQ3VycmVudFJvdz86IGJvb2xlYW4gfCBzdHJpbmcpOiBPYnNlcnZhYmxlPEVudGl0eVtdPiB7XG4gICAgdGhpcy5zZXRMb2FkQnlMZXZlbFN0YXRlKGZpbHRlcnMsIHNvcnRzKTtcbiAgICBjb25zdCBmaWx0ZXJzQXJyYXkgPSB0aGlzLnBhcnNlQ29uZGl0aW9ucyhmaWx0ZXJzKTtcbiAgICBjb25zdCBzb3J0c0FycmF5ID0gdGhpcy5wYXJzZUNvbmRpdGlvbnMoc29ydHMpO1xuICAgIC8vIGNvbnN0IHBhcmVudElkID0gdGhpcy5iaW5kaW5nRGF0YS5saXN0LmN1cnJlbnRJZDtcbiAgICBjb25zdCBwYXJlbnRJZCA9IHRoaXMuZ2V0SWRUb0V4cGFuZCgpO1xuICAgIGNvbnN0IGNvcnJlY3RTZWxlY3RlZE5vZGUgPSB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5jb3VudCgpID09PSAwO1xuICAgIGlmIChmcm96ZW5DdXJyZW50Um93ID09PSB1bmRlZmluZWQpIHtcbiAgICAgIGZyb3plbkN1cnJlbnRSb3cgPSBmYWxzZTtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBmcm96ZW5DdXJyZW50Um93ICE9PSAnYm9vbGVhbicpIHtcbiAgICAgIGZyb3plbkN1cnJlbnRSb3cgPSBmcm96ZW5DdXJyZW50Um93ID09PSAndHJ1ZScgPyB0cnVlIDogZmFsc2U7XG4gICAgfVxuICAgIGNvbnN0IGhpZXJhcmNoeVR5cGUgPSB0aGlzLmdldEhpZXJhcmNoeVR5cGUoKTtcbiAgICBjb25zdCByZXBvc2l0b3J5ID0gVHJlZVJlcG9zaXRvcnlGYWN0b3J5LmdldEluc3RhbmNlKGhpZXJhcmNoeVR5cGUpO1xuXG4gICAgaWYgKHJlcG9zaXRvcnkgPT09IG51bGwpIHtcbiAgICAgIHJldHVybiBlbXB0eSgpO1xuICAgIH1cbiAgICBjb25zdCBsb2FkaW5nVGltZXJJZCA9IHRoaXMubG9hZGluZ1NlcnZpY2Uuc2hvd0xvYWRpbmdXaXRoRGVsYXkoNTAwKTtcbiAgICAvLyDmnoTpgKDliIbpobXkv6Hmga9cbiAgICBjb25zdCBwYWdpbmF0aW9uID0gdGhpcy5idWlsZFBhZ2luYXRpb25JbmZvKHBhcmVudElkKTtcbiAgICBjb25zdCByZWxvYWQgPSB0aGlzLmZyYW1lQ29udGV4dC5wYXJhbXMuZ2V0KCdfUkVMT0FEX0NISUxEUkVOXycpIHx8IGZhbHNlO1xuICAgIGNvbnN0IHF1ZXJ5JCA9IHJlcG9zaXRvcnkubG9hZEJ5UGFyZW50SWQodGhpcy5yZXBvc2l0b3J5LCB0aGlzLmhpZXJhcmNoeUluZm9LZXksIHBhcmVudElkLCBmaWx0ZXJzQXJyYXksIHNvcnRzQXJyYXksIGZyb3plbkN1cnJlbnRSb3csIHBhZ2luYXRpb24sIHRoaXMuZnJhbWVDb250ZXh0LCByZWxvYWQpO1xuICAgIHJldHVybiBxdWVyeSQucGlwZShcbiAgICAgIHRhcChcbiAgICAgICAgKGVudGl0aWVzOiBFbnRpdHlbXSkgPT4ge1xuICAgICAgICAgIHRoaXMuZnJhbWVDb250ZXh0LnBhcmFtcy5kZWxldGUoJ19SRUxPQURfQ0hJTERSRU5fJyk7XG4gICAgICAgICAgLy8g57qg5q2j6YCJ5Lit6IqC54K5XG4gICAgICAgICAgaWYgKGNvcnJlY3RTZWxlY3RlZE5vZGUgPT09IHRydWUpIHtcbiAgICAgICAgICAgIGNvbnN0IHRyZWVOb2RlVXRpbCA9IFRyZWVVdGlsRmFjdG9yeS5nZXRJbnN0YW5jZShoaWVyYXJjaHlUeXBlKTtcbiAgICAgICAgICAgIGlmICh0cmVlTm9kZVV0aWwgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgdHJlZU5vZGVVdGlsLnNlbGVjdEZpcnN0Um9vdE5vZGUodGhpcy5iaW5kaW5nRGF0YSwgdGhpcy5oaWVyYXJjaHlJbmZvS2V5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3QgY3VycmVudFJvd0lkID0gdGhpcy5iaW5kaW5nRGF0YS5saXN0LmN1cnJlbnRJdGVtLnByaW1hcnlLZXlWYWx1ZTtcbiAgICAgICAgICBpZiAoZnJvemVuQ3VycmVudFJvdykge1xuICAgICAgICAgICAgLy8g5aaC5p6c5LiK5LiA5qyh6YCJ5Lit6KGM5Li65pys5qyh5Yqg6L295pWw5o2u5Lit55qE5LiA5p2h77yM5YiZ5bqU6K+l6YeN5paw6YCJ5Lit6K+l6KGMXG4gICAgICAgICAgICBjb25zdCBjb250YWluc0N1cnJlbnRSb3cgPSBlbnRpdGllcy5maW5kKGl0ZW0gPT4gaXRlbS5wcmltYXJ5VmFsdWUgPT09IGN1cnJlbnRSb3dJZCk7XG4gICAgICAgICAgICBpZiAoY29udGFpbnNDdXJyZW50Um93KSB7XG4gICAgICAgICAgICAgIHRoaXMuc2V0Q3VycmVudElkKGN1cnJlbnRSb3dJZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyDljp/mnaXnmoTlvZPliY3ooYzkuI3lnKjlt7Lnu4/liqDovb3nmoTmlbDmja7kuK3vvIzlpoLlsZXlvIDliLDnrKzkuInnuqfvvIzlsIbnrKzkuInnuqfnmoTmn5DooYzorr7kuLrlvZPliY3ooYzvvIzlhajpg6jmlLbotbfvvIzlsZXlvIDnrKzkuIDnuqdcbiAgICAgICAgICAgIGlmICghdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24uZ2V0RW50aXR5QnlJZChjdXJyZW50Um93SWQpKSB7XG4gICAgICAgICAgICAgIGNvbnN0IGZpcnN0Q2hpbGRJZCA9IGVudGl0aWVzICYmIEFycmF5LmlzQXJyYXkoZW50aXRpZXMpICYmIGVudGl0aWVzLmxlbmd0aCA+IDAgJiYgZW50aXRpZXNbMF0ucHJpbWFyeVZhbHVlIHx8IG51bGw7XG4gICAgICAgICAgICAgIGlmIChmaXJzdENoaWxkSWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldEN1cnJlbnRJZChmaXJzdENoaWxkSWQpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMubG9hZGluZ1NlcnZpY2UuaGlkZURlbGF5TG9hZGluZyhsb2FkaW5nVGltZXJJZCk7XG4gICAgICAgIH0sXG4gICAgICAgIGVycm9yID0+IHtcbiAgICAgICAgICB0aGlzLmxvYWRpbmdTZXJ2aWNlLmhpZGVEZWxheUxvYWRpbmcobG9hZGluZ1RpbWVySWQpO1xuICAgICAgICAgIHRoaXMuZXJyb3JTZXJ2aWNlLmV4Y2VwdGlvbih0aGlzLmxhbmd1YWdlU2VydmljZS5sb2FkRmFpbGVkLCBlcnJvcik7XG4gICAgICAgIH1cbiAgICAgIClcbiAgICApO1xuICB9XG4gIC8qKlxuICAgKiDliqDovb3lrozmlbTmoJFcbiAgICogQHBhcmFtIHZpcnR1YWxQcm9wZXJ0eU5hbWUg6Jma5ouf5a2X5q61XG4gICAqIEBwYXJhbSBmdWxsVHJlZVR5cGUg5piv5ZCm5piv5a6M5pW05qCR5Yqg6L29IDDvvJrlrozmlbTmoJEgMe+8mumDqOWIhuagkVxuICAgKiBAcGFyYW0gbG9hZFR5cGUg5piv5ZCm5YiG57qn5Yqg6L29IDDvvJrlhajpg6jliqDovb0gMe+8muWIhue6p+WKoOi9vVxuICAgKiBAcGFyYW0gZmlsdGVyIOi/h+a7pOadoeS7tlxuICAgKiBAcGFyYW0gZnJvemVuQ3VycmVudFJvdyDlhrvnu5PlvZPliY3ooYxcbiAgICovXG4gIHB1YmxpYyBsb2FkRnVsbFRyZWUodmlydHVhbFByb3BlcnR5TmFtZTogc3RyaW5nLCBmdWxsVHJlZVR5cGU6IHN0cmluZywgbG9hZFR5cGU6IHN0cmluZywgZmlsdGVyczogc3RyaW5nLCBmcm96ZW5DdXJyZW50Um93PzogYm9vbGVhbiB8IHN0cmluZyk6IE9ic2VydmFibGU8RW50aXR5W10+IHtcbiAgICBpZiAodHlwZW9mIGZ1bGxUcmVlVHlwZSAhPT0gJ3N0cmluZycpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignQXJndW1lbnRFcnJvcjogZnVsbFRyZWVUeXBlIOS4jeiDveS4uuepuuS4lOW/hemhu+S4uuWtl+espuS4suOAgicpO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIGxvYWRUeXBlICE9PSAnc3RyaW5nJykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdBcmd1bWVudEVycm9yOiBsb2FkVHlwZSDkuI3og73kuLrnqbrkuJTlv4XpobvkuLrlrZfnrKbkuLLjgIInKTtcbiAgICB9XG4gICAgaWYgKGZyb3plbkN1cnJlbnRSb3cgPT09IHVuZGVmaW5lZCkge1xuICAgICAgZnJvemVuQ3VycmVudFJvdyA9IGZhbHNlO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIGZyb3plbkN1cnJlbnRSb3cgIT09ICdib29sZWFuJykge1xuICAgICAgZnJvemVuQ3VycmVudFJvdyA9IGZyb3plbkN1cnJlbnRSb3cgPT09ICd0cnVlJyA/IHRydWUgOiBmYWxzZTtcbiAgICB9XG4gICAgY29uc3QgdmlydHVhbFJvb3RGcmFtZUNvbnRleHQgPSB0aGlzLnZpcnR1YWxSb290RnJhbWVDb250ZXh0O1xuICAgIC8vIOi/mOWOn+S4iuasoeiuvue9rueahOe7k+aenOmbhlxuICAgIHZpcnR1YWxSb290RnJhbWVDb250ZXh0LnBhcmFtcy5kZWxldGUoJ19ERVZLSVRfZXhwYW5kUm93SWRzJyk7XG4gICAgdmlydHVhbFJvb3RGcmFtZUNvbnRleHQucGFyYW1zLmRlbGV0ZSgnX0RFVktJVF9zZWxlY3RlZFJvd0lkJyk7XG4gICAgdmlydHVhbFJvb3RGcmFtZUNvbnRleHQudWlTdGF0ZS5zZXRQcm9wZXJ0eVZhbHVlKCdfX0RFVktJVF9fc2VsZWN0ZWRSb3cnLCBudWxsKTtcbiAgICBjb25zdCBmaWx0ZXJzQXJyYXkgPSB0aGlzLnBhcnNlQ29uZGl0aW9ucyhmaWx0ZXJzKTtcbiAgICBjb25zdCBwYXJlbnRJZCA9IHRoaXMuZ2V0SWRUb0V4cGFuZCgpO1xuICAgIGNvbnN0IGNvcnJlY3RTZWxlY3RlZE5vZGUgPSB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5jb3VudCgpID09PSAwO1xuICAgIGNvbnN0IGhpZXJhcmNoeVR5cGUgPSB0aGlzLmdldEhpZXJhcmNoeVR5cGUoKTtcbiAgICBjb25zdCByZXBvc2l0b3J5ID0gVHJlZVJlcG9zaXRvcnlGYWN0b3J5LmdldEluc3RhbmNlKGhpZXJhcmNoeVR5cGUpO1xuXG4gICAgaWYgKHJlcG9zaXRvcnkgPT09IG51bGwpIHtcbiAgICAgIHJldHVybiBFTVBUWTtcbiAgICB9XG4gICAgY29uc3QgbG9hZGluZ1RpbWVySWQgPSB0aGlzLmxvYWRpbmdTZXJ2aWNlLnNob3dMb2FkaW5nV2l0aERlbGF5KDUwMCk7XG4gICAgY29uc3QgY29udGV4dCA9IHtcbiAgICAgIGZyYW1lQ29udGV4dDogdGhpcy5mcmFtZUNvbnRleHQsXG4gICAgICBmcm96ZW5DdXJyZW50Um93XG4gICAgfTtcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IG1heC1saW5lLWxlbmd0aFxuICAgIGNvbnN0IHF1ZXJ5JCA9IHJlcG9zaXRvcnkubG9hZEZ1bGxUcmVlKHRoaXMucmVwb3NpdG9yeSwgdGhpcy5oaWVyYXJjaHlJbmZvS2V5LCBwYXJlbnRJZCwgdmlydHVhbFByb3BlcnR5TmFtZSwgZnVsbFRyZWVUeXBlLCBsb2FkVHlwZSwgZmlsdGVyc0FycmF5LCBjb250ZXh0KTtcbiAgICByZXR1cm4gcXVlcnkkLnBpcGUoXG4gICAgICB0YXAoXG4gICAgICAgIChlbnRpdGllczogRW50aXR5W10pID0+IHtcbiAgICAgICAgICBjb25zdCBzZWxlY3RlZFJvd0lkID0gdmlydHVhbFJvb3RGcmFtZUNvbnRleHQucGFyYW1zLmdldCgnX0RFVktJVF9zZWxlY3RlZFJvd0lkJyk7XG4gICAgICAgICAgLy8g57qg5q2j6YCJ5Lit6IqC54K5XG4gICAgICAgICAgaWYgKGNvcnJlY3RTZWxlY3RlZE5vZGUgPT09IHRydWUgfHwgIXNlbGVjdGVkUm93SWQpIHtcbiAgICAgICAgICAgIGNvbnN0IHRyZWVOb2RlVXRpbCA9IFRyZWVVdGlsRmFjdG9yeS5nZXRJbnN0YW5jZShoaWVyYXJjaHlUeXBlKTtcbiAgICAgICAgICAgIGlmICh0cmVlTm9kZVV0aWwgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgdHJlZU5vZGVVdGlsLnNlbGVjdEZpcnN0Um9vdE5vZGUodGhpcy5iaW5kaW5nRGF0YSwgdGhpcy5oaWVyYXJjaHlJbmZvS2V5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3QgY3VycmVudFJvd0lkID0gdGhpcy5iaW5kaW5nRGF0YS5saXN0LmN1cnJlbnRJdGVtLnByaW1hcnlLZXlWYWx1ZTtcbiAgICAgICAgICBpZiAoZnJvemVuQ3VycmVudFJvdykge1xuICAgICAgICAgICAgLy8g5aaC5p6c5LiK5LiA5qyh6YCJ5Lit6KGM5Li65pys5qyh5Yqg6L295pWw5o2u5Lit55qE5LiA5p2h77yM5YiZ5bqU6K+l6YeN5paw6YCJ5Lit6K+l6KGMXG4gICAgICAgICAgICBjb25zdCBjb250YWluc0N1cnJlbnRSb3cgPSBlbnRpdGllcy5maW5kKGl0ZW0gPT4gaXRlbS5wcmltYXJ5VmFsdWUgPT09IGN1cnJlbnRSb3dJZCk7XG4gICAgICAgICAgICBpZiAoY29udGFpbnNDdXJyZW50Um93KSB7XG4gICAgICAgICAgICAgIHRoaXMuc2V0Q3VycmVudElkKGN1cnJlbnRSb3dJZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyDljp/mnaXnmoTlvZPliY3ooYzkuI3lnKjlt7Lnu4/liqDovb3nmoTmlbDmja7kuK3vvIzlpoLlsZXlvIDliLDnrKzkuInnuqfvvIzlsIbnrKzkuInnuqfnmoTmn5DooYzorr7kuLrlvZPliY3ooYzvvIzlhajpg6jmlLbotbfvvIzlsZXlvIDnrKzkuIDnuqdcbiAgICAgICAgICAgIGlmICghdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24uZ2V0RW50aXR5QnlJZChjdXJyZW50Um93SWQpICYmIGVudGl0aWVzICYmIGVudGl0aWVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgY29uc3QgZmlyc3RDaGlsZElkID0gZW50aXRpZXMgJiYgQXJyYXkuaXNBcnJheShlbnRpdGllcykgJiYgZW50aXRpZXMubGVuZ3RoID4gMCAmJiBlbnRpdGllc1swXS5wcmltYXJ5VmFsdWUgfHwgbnVsbDtcbiAgICAgICAgICAgICAgaWYgKGZpcnN0Q2hpbGRJZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0Q3VycmVudElkKGZpcnN0Q2hpbGRJZCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5sb2FkaW5nU2VydmljZS5oaWRlRGVsYXlMb2FkaW5nKGxvYWRpbmdUaW1lcklkKTtcbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3IgPT4ge1xuICAgICAgICAgIHRoaXMubG9hZGluZ1NlcnZpY2UuaGlkZURlbGF5TG9hZGluZyhsb2FkaW5nVGltZXJJZCk7XG4gICAgICAgICAgdGhpcy5lcnJvclNlcnZpY2UuZXhjZXB0aW9uKHRoaXMubGFuZ3VhZ2VTZXJ2aWNlLmxvYWRGYWlsZWQsIGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgKVxuICAgICk7XG4gIH1cbiAgLyoqXG4gICAqIOiOt+WPluacgOaWsOWxleW8gOeahOiKgueCuVxuICAgKi9cbiAgcHVibGljIGdldElkVG9FeHBhbmQoKSB7XG4gICAgY29uc3QgZXhwYW5kTm9kZXMgPSB0aGlzLnZpcnR1YWxSb290RnJhbWVDb250ZXh0LmdldFBhcmFtKCdUUkVFX0xBVEVTVF9FWFBBTkRFRF9JRCcpIHx8IFtdO1xuICAgIGNvbnN0IGlkVG9FeHBhbmQgPSBleHBhbmROb2Rlcy5wb3AoKTtcbiAgICB0aGlzLnZpcnR1YWxSb290RnJhbWVDb250ZXh0LnNldFBhcmFtKCdUUkVFX0xBVEVTVF9FWFBBTkRFRF9JRCcsIGV4cGFuZE5vZGVzKTtcbiAgICByZXR1cm4gaWRUb0V4cGFuZDtcbiAgfVxuXG4gIC8qKlxuICAgKiDorr7nva7mnIDmlrDlsZXlvIDnmoToioLngrlcbiAgICovXG4gIHB1YmxpYyBzZXRJZFRvRXhwYW5kKGlkVG9FeHBhbmQ6IHN0cmluZyk6IHZvaWQge1xuICAgIGNvbnN0IGV4cGFuZE5vZGVzID0gdGhpcy52aXJ0dWFsUm9vdEZyYW1lQ29udGV4dC5nZXRQYXJhbSgnVFJFRV9MQVRFU1RfRVhQQU5ERURfSUQnKSB8fCBbXTtcbiAgICBleHBhbmROb2Rlcy5wdXNoKGlkVG9FeHBhbmQpO1xuICAgIHRoaXMudmlydHVhbFJvb3RGcmFtZUNvbnRleHQuc2V0UGFyYW0oJ1RSRUVfTEFURVNUX0VYUEFOREVEX0lEJywgZXhwYW5kTm9kZXMpO1xuICB9XG5cbiAgLyoqXG4gICAqIOino+aekOi/h+a7pOadoeS7tlxuICAgKi9cbiAgcHVibGljIHBhcnNlQ29uZGl0aW9ucyhjb25kaXRpb25zPzogc3RyaW5nKTogYW55W10ge1xuICAgIGNvbnN0IGNvbmRpdGlvbnNTdHJpbmcgPSAoIWNvbmRpdGlvbnMgfHwgY29uZGl0aW9ucyA9PT0gJycpID8gJ1tdJyA6IGNvbmRpdGlvbnM7XG4gICAgcmV0dXJuIEpTT04ucGFyc2UoY29uZGl0aW9uc1N0cmluZyk7XG4gIH1cblxuICAvKipcbiAgICog5paw5aKe5ZCM57qnXG4gICAqL1xuICBwdWJsaWMgYWRkU2libGluZyhpZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcblxuICAgIC8vIOiuvuiuoeaXtmlk55qE6I635Y+W5pS55Li65LuO5ZG95Luk5Y+C5pWw5LiK6I635Y+W77yM5L2G6K6+6K6h5pe25rKh5pyJ5Y+C5pWw5b+F5aGr5qOA5p+l77yMXG4gICAgLy8g5aaC5p6c5omT5byA6KGo5Y2V5L+d5a2Y5LqG77yI5Y2z5pu05paw5LqG5pyA5paw55qE5ZG95Luk5p6E5Lu277yJ77yM5L2G5rKh5pyJ6YWN572u6K+l5Y+C5pWw77yM5Y+v6IO95Lya5Lyg6YCS6L+H5p2l5LiA5Liq56m65YC877yMXG4gICAgLy8g5Li65LqG5YW85a655q2k5oOF5Ya177yM5L2/55So5b2T5YmN6KGMaWTkvZzkuLppZOeahOWAvFxuICAgIGlkID0gaWQgPyBpZCA6IHRoaXMuYmluZGluZ0RhdGEubGlzdC5jdXJyZW50SWQ7XG5cbiAgICAvLyDlj4LmlbDmo4Dmn6VcbiAgICBpZiAoIWlkIHx8IGlkID09PSAndW5kZWZpbmVkJykge1xuICAgICAgaWQgPSAnJztcbiAgICB9XG5cbiAgICAvLyDorrDlvZXmnIDov5HkuIDmrKHkv67mlLnnmoTmlbDmja5pZFxuICAgIGNvbnN0IGxhc3RNb2RpZmllZElkID0gdGhpcy5iaW5kaW5nRGF0YS5saXN0LmN1cnJlbnRJZDtcbiAgICAvLyDojrflj5bliIbnuqfmlrnlvI9cbiAgICBjb25zdCBoaWVyYXJjaHlUeXBlOiBzdHJpbmcgPSB0aGlzLmdldEhpZXJhcmNoeVR5cGUoKTtcbiAgICAvLyDmiafooYzlj5bmlbBcbiAgICBjb25zdCBsb2FkaW5nVGltZXJJZCA9IHRoaXMubG9hZGluZ1NlcnZpY2Uuc2hvd0xvYWRpbmdXaXRoRGVsYXkoNTAwKTtcbiAgICBjb25zdCByZXBvc2l0b3J5ID0gVHJlZVJlcG9zaXRvcnlGYWN0b3J5LmdldEluc3RhbmNlKGhpZXJhcmNoeVR5cGUpO1xuICAgIGlmICghcmVwb3NpdG9yeSkge1xuICAgICAgLy8g6ZSZ6K+v55qE5YiG57qn56CBXG4gICAgICB0aHJvdyBuZXcgRXJyb3IodGhpcy5sYW5ndWFnZVNlcnZpY2VbJ2Vycm9ySGllcmFyY2h5S2V5J10pO1xuICAgIH1cbiAgICBjb25zdCByZXN1bHQkID0gcmVwb3NpdG9yeS5hZGRTaWJsaW5nKHRoaXMucmVwb3NpdG9yeSwgaWQpO1xuICAgIHJldHVybiByZXN1bHQkLnBpcGUoXG4gICAgICB0YXAoXG4gICAgICAgICgpID0+IHtcbiAgICAgICAgICB0aGlzLnZpcnR1YWxSb290RnJhbWVDb250ZXh0LnNldFBhcmFtKCdJU19BREQnLCB0cnVlKTtcbiAgICAgICAgICB0aGlzLnZpcnR1YWxSb290RnJhbWVDb250ZXh0LnNldFBhcmFtKCdMQVNUX01PRElGSUVEX0lEJywgbGFzdE1vZGlmaWVkSWQpO1xuICAgICAgICAgIHRoaXMubG9hZGluZ1NlcnZpY2UuaGlkZURlbGF5TG9hZGluZyhsb2FkaW5nVGltZXJJZCk7XG4gICAgICAgIH0sXG4gICAgICAgIGVycm9yID0+IHtcbiAgICAgICAgICB0aGlzLmxvYWRpbmdTZXJ2aWNlLmhpZGVEZWxheUxvYWRpbmcobG9hZGluZ1RpbWVySWQpO1xuICAgICAgICAgIHRoaXMuZXJyb3JTZXJ2aWNlLmV4Y2VwdGlvbih0aGlzLmxhbmd1YWdlU2VydmljZS5hZGRTaWJsaW5nRmFpbGVkLCBlcnJvcik7XG4gICAgICAgIH1cbiAgICAgIClcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIOaWsOWinuS4i+e6p1xuICAgKi9cbiAgcHVibGljIGFkZENoaWxkKGlkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xuXG4gICAgLy8g5Y6f5Zug5ZCMYWRkU2libGluZ+eahOS/ruaUuVxuICAgIGlkID0gaWQgPyBpZCA6IHRoaXMuYmluZGluZ0RhdGEubGlzdC5jdXJyZW50SWQ7XG5cbiAgICAvLyDlj4LmlbDmo4Dmn6VcbiAgICBpZiAoIWlkKSB7XG4gICAgICAvLyDor7fpgInmi6nniLboioLngrlcbiAgICAgIHRoaXMubm90aWZ5U2VydmljZS53YXJuaW5nKHRoaXMubGFuZ3VhZ2VTZXJ2aWNlWydwbHNTZWxlY3RQYXJlbnROb2RlJ10sIHsgaGlkZVRpdGxlOiB0cnVlIH0pO1xuICAgICAgcmV0dXJuIGVtcHR5KCk7XG4gICAgfVxuXG4gICAgLy8g6K6w5b2V5pyA6L+R5LiA5qyh5L+u5pS555qE5pWw5o2uaWRcbiAgICBjb25zdCBsYXN0TW9kaWZpZWRJZCA9IHRoaXMuYmluZGluZ0RhdGEubGlzdC5jdXJyZW50SWQ7XG4gICAgLy8g6I635Y+W5YiG57qn5pa55byPXG4gICAgY29uc3QgaGllcmFyY2h5VHlwZSA9IHRoaXMuZ2V0SGllcmFyY2h5VHlwZSgpO1xuICAgIC8vIOaJp+ihjOWPluaVsFxuICAgIGNvbnN0IGxvYWRpbmdUaW1lcklkID0gdGhpcy5sb2FkaW5nU2VydmljZS5zaG93TG9hZGluZ1dpdGhEZWxheSg1MDApO1xuXG4gICAgLy8g5paw5aKe55qE5pe25YCZ77yM6KaB5bGV5byA54i26IqC54K5XG4gICAgdGhpcy5zZXRJZFRvRXhwYW5kKGlkKTtcbiAgICBjb25zdCByZWxvYWRDaGlsZCQgPSB0aGlzLnJlbG9hZEJ5TGV2ZWwoKTtcblxuICAgIGNvbnN0IHJlcG9zaXRvcnkgPSBUcmVlUmVwb3NpdG9yeUZhY3RvcnkuZ2V0SW5zdGFuY2UoaGllcmFyY2h5VHlwZSk7XG4gICAgaWYgKCFyZXBvc2l0b3J5KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IodGhpcy5sYW5ndWFnZVNlcnZpY2VbJ2Vycm9ySGllcmFyY2h5S2V5J10pO1xuICAgIH1cbiAgICBjb25zdCBhZGRDaGlsZCQgPSByZXBvc2l0b3J5LmFkZENoaWxkKHRoaXMucmVwb3NpdG9yeSwgaWQpO1xuICAgIGNvbnN0IHJlc3VsdCQgPSByZWxvYWRDaGlsZCQucGlwZShcbiAgICAgIHN3aXRjaE1hcCgoKSA9PiB7XG4gICAgICAgIHJldHVybiBhZGRDaGlsZCQ7XG4gICAgICB9KSxcbiAgICAgIHRhcChcbiAgICAgICAgKCkgPT4ge1xuICAgICAgICAgIHRoaXMudmlydHVhbFJvb3RGcmFtZUNvbnRleHQuc2V0UGFyYW0oJ0lTX0FERCcsIHRydWUpO1xuICAgICAgICAgIHRoaXMudmlydHVhbFJvb3RGcmFtZUNvbnRleHQuc2V0UGFyYW0oJ0xBU1RfTU9ESUZJRURfSUQnLCBsYXN0TW9kaWZpZWRJZCk7XG4gICAgICAgICAgdGhpcy5sb2FkaW5nU2VydmljZS5oaWRlRGVsYXlMb2FkaW5nKGxvYWRpbmdUaW1lcklkKTtcbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3IgPT4ge1xuICAgICAgICAgIHRoaXMubG9hZGluZ1NlcnZpY2UuaGlkZURlbGF5TG9hZGluZyhsb2FkaW5nVGltZXJJZCk7XG4gICAgICAgICAgdGhpcy5lcnJvclNlcnZpY2UuZXhjZXB0aW9uKHRoaXMubGFuZ3VhZ2VTZXJ2aWNlLmFkZENoaWxkRmFpbGVkLCBlcnJvcik7XG4gICAgICAgIH1cbiAgICAgIClcbiAgICApO1xuICAgIHJldHVybiByZXN1bHQkO1xuICB9XG4gIC8qKlxuICAgKiDmibnph4/kv53lrZhcbiAgICovXG4gIHB1YmxpYyBzYXZlKCk6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xuICAgIGlmICh0aGlzLm1lc3NhZ2VQaXBlKSB7XG4gICAgICB0aGlzLm1lc3NhZ2VQaXBlLm5leHQoeyBtZXNzYWdlVHlwZTogJ3NhdmUnIH0pO1xuICAgIH1cbiAgICBjb25zdCBsb2FkaW5nVGltZXJJZCA9IHRoaXMubG9hZGluZ1NlcnZpY2Uuc2hvd0xvYWRpbmdXaXRoRGVsYXkoNTAwKTtcbiAgICBjb25zdCBzYXZlJCA9IHRoaXMucmVwb3NpdG9yeS5hcHBseUNoYW5nZXMoKTtcbiAgICBjb25zdCByZXN1bHQkID0gc2F2ZSQucGlwZShcbiAgICAgIHRhcChcbiAgICAgICAgKCkgPT4ge1xuICAgICAgICAgIHRoaXMubG9hZGluZ1NlcnZpY2UuaGlkZURlbGF5TG9hZGluZyhsb2FkaW5nVGltZXJJZCk7XG4gICAgICAgICAgdGhpcy5ub3RpZnlTZXJ2aWNlLnN1Y2Nlc3ModGhpcy5sYW5ndWFnZVNlcnZpY2Uuc2F2ZVN1Y2Nlc3MsIHsgaGlkZVRpdGxlOiB0cnVlIH0pO1xuICAgICAgICB9LFxuICAgICAgICBlcnJvciA9PiB7XG4gICAgICAgICAgdGhpcy5sb2FkaW5nU2VydmljZS5oaWRlRGVsYXlMb2FkaW5nKGxvYWRpbmdUaW1lcklkKTtcbiAgICAgICAgICB0aGlzLmVycm9yU2VydmljZS5leGNlcHRpb24odGhpcy5sYW5ndWFnZVNlcnZpY2UubXVsdGlTYXZlRmFpbGVkLCBlcnJvcik7XG4gICAgICAgIH1cbiAgICAgIClcbiAgICApO1xuICAgIHJldHVybiByZXN1bHQkO1xuICB9XG4gIC8qKlxuICAgKiDliKDpmaRcbiAgICovXG4gIHB1YmxpYyByZW1vdmUoaWQ6IHN0cmluZywgc3VjY2Vzc01zZz86IHN0cmluZyk6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xuXG4gICAgLy8g5Y6f5Zug5ZCMYWRkU2libGluZ1xuICAgIGlkID0gaWQgPyBpZCA6IHRoaXMuYmluZGluZ0RhdGEubGlzdC5jdXJyZW50SWQ7XG5cbiAgICAvLyDlj4LmlbDmo4Dmn6VcbiAgICBpZiAoIWlkKSB7XG4gICAgICB0aGlzLm5vdGlmeVNlcnZpY2Uud2FybmluZyh0aGlzLmxhbmd1YWdlU2VydmljZVsncGxzU2VsZWN0RGVsZXRlRGF0YSddLCB7IGhpZGVUaXRsZTogdHJ1ZSB9KTtcbiAgICAgIHJldHVybiBlbXB0eSgpO1xuICAgIH1cblxuICAgIC8vIOWtmOWcqOWtkOiKgueCueS4jeWFgeiuuOWIoOmZpFxuICAgIGNvbnN0IHRyZWVOb2Rlc0RhdGEgPSB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi50b0pTT04oKTtcbiAgICBjb25zdCBoaWVyYXJjaHlUeXBlID0gdGhpcy5nZXRIaWVyYXJjaHlUeXBlKCk7XG4gICAgY29uc3QgdHJlZU5vZGVVdGlsID0gVHJlZVV0aWxGYWN0b3J5LmdldEluc3RhbmNlKGhpZXJhcmNoeVR5cGUpO1xuICAgIGlmICh0cmVlTm9kZVV0aWwgPT09IG51bGwpIHtcbiAgICAgIHJldHVybiBlbXB0eSgpO1xuICAgIH1cbiAgICBpZiAodHJlZU5vZGVVdGlsLmhhc0NoaWxkTm9kZXModHJlZU5vZGVzRGF0YSwgdGhpcy5oaWVyYXJjaHlJbmZvS2V5LCBpZCkgPT09IHRydWUpIHtcbiAgICAgIHRoaXMubm90aWZ5U2VydmljZS53YXJuaW5nKHRoaXMubGFuZ3VhZ2VTZXJ2aWNlWydkZWxldGVDaGlsZEZpcnN0J10sIHsgaGlkZVRpdGxlOiB0cnVlIH0pO1xuICAgICAgcmV0dXJuIGVtcHR5KCk7XG4gICAgfVxuXG4gICAgLy8g56Gu6K6k5Yig6ZmkXG4gICAgY29uc3QgYWN0aW9uJCA9IHRoaXMubWVzc2FnZVNlcnZpY2UucXVlc3Rpb24odGhpcy5sYW5ndWFnZVNlcnZpY2UuY29uZmlybURlbGV0aW9uKTtcbiAgICByZXR1cm4gYWN0aW9uJC5waXBlKFxuICAgICAgY29uY2F0TWFwKHJlc3VsdCA9PiB7XG4gICAgICAgIGlmICghcmVzdWx0KSB7XG4gICAgICAgICAgcmV0dXJuIGVtcHR5KCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyDojrflj5bliKDpmaTlkI7opoHorr7nva7nmoToioLngrlpZFxuICAgICAgICBjb25zdCBuZXh0Tm9kZUlkID0gdHJlZU5vZGVVdGlsLmdldE5leHROb2RlSWQodHJlZU5vZGVzRGF0YSwgdGhpcy5oaWVyYXJjaHlJbmZvS2V5LCBpZCk7XG5cbiAgICAgICAgLy8g5omn6KGM5Yig6ZmkXG4gICAgICAgIGNvbnN0IGxvYWRpbmdUaW1lcklkID0gdGhpcy5sb2FkaW5nU2VydmljZS5zaG93TG9hZGluZ1dpdGhEZWxheSg1MDApO1xuICAgICAgICBjb25zdCByZW1vdmUkID0gdGhpcy5mcmFtZUNvbnRleHQucmVwb3NpdG9yeS5yZW1vdmVCeUlkKGlkKTtcbiAgICAgICAgcmV0dXJuIHJlbW92ZSQucGlwZShcbiAgICAgICAgICB0YXAoKCkgPT4ge1xuXG4gICAgICAgICAgICAvLyDorr7nva7pgInkuK3oioLngrlcbiAgICAgICAgICAgIHRyZWVOb2RlVXRpbC5zZWxlY3RlZE5vZGUodGhpcy5iaW5kaW5nRGF0YSwgdGhpcy5oaWVyYXJjaHlJbmZvS2V5LCBuZXh0Tm9kZUlkKTtcblxuICAgICAgICAgICAgdGhpcy5sb2FkaW5nU2VydmljZS5oaWRlRGVsYXlMb2FkaW5nKGxvYWRpbmdUaW1lcklkKTtcbiAgICAgICAgICAgIGlmIChzdWNjZXNzTXNnICYmIHN1Y2Nlc3NNc2cudHJpbSgpKSB7XG4gICAgICAgICAgICAgIHRoaXMubm90aWZ5U2VydmljZS5zdWNjZXNzKHN1Y2Nlc3NNc2csIHsgaGlkZVRpdGxlOiB0cnVlIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdGhpcy5ub3RpZnlTZXJ2aWNlLnN1Y2Nlc3ModGhpcy5sYW5ndWFnZVNlcnZpY2UuZGVsZXRlU3VjY2VzcywgeyBoaWRlVGl0bGU6IHRydWUgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyB0aGlzLm5vdGlmeVNlcnZpY2Uuc3VjY2Vzcyh0aGlzLmxhbmd1YWdlU2VydmljZS5kZWxldGVTdWNjZXNzLCB7IGhpZGVUaXRsZTogdHJ1ZSB9KTtcbiAgICAgICAgICB9LFxuICAgICAgICAgICAgZXJyb3IgPT4ge1xuICAgICAgICAgICAgICB0aGlzLmxvYWRpbmdTZXJ2aWNlLmhpZGVEZWxheUxvYWRpbmcobG9hZGluZ1RpbWVySWQpO1xuICAgICAgICAgICAgICB0aGlzLmVycm9yU2VydmljZS5leGNlcHRpb24odGhpcy5sYW5ndWFnZVNlcnZpY2UuZGVsZXRlRmFpbGVkLCBlcnJvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgKVxuICAgICAgICApO1xuICAgICAgfSlcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIOWPlua2iOaXtuajgOa1i+acquS/neWtmOiusOW9lVxuICAgKi9cbiAgcHVibGljIGNhbmNlbCgpOiBPYnNlcnZhYmxlPGFueT4ge1xuXG4gICAgLy8g5rKh5pyJ5Y+Y5pu05pe255u05o6l5Y+W5raIXG4gICAgLy8gY29uc3QgY2FyZERhdGFTZXJ2aWNlID0gdGhpcy5mcmFtZUNvbnRleHQuaW5qZWN0b3IuZ2V0PENhcmREYXRhU2VydmljZT4oQ2FyZERhdGFTZXJ2aWNlKTtcbiAgICBjb25zdCBiZWZSZXBvc2l0b3J5ID0gdGhpcy5yZXBvc2l0b3J5IGFzIEJlZlJlcG9zaXRvcnk8YW55PjtcbiAgICBjb25zdCBoYXNVbnNhdmVkRGF0YSA9IEJlZlJlcG9zaXRvcnlVdGlsLmlzRXhpc3RVbnNhdmVEYXRhKGJlZlJlcG9zaXRvcnkpO1xuICAgIGlmICghaGFzVW5zYXZlZERhdGEpIHtcbiAgICAgIHJldHVybiB0aGlzLl9jYW5jZWwoKTtcbiAgICB9XG5cbiAgICBjb25zdCBjb25maXJtUmVzdWx0JCA9IHRoaXMubWVzc2FnZVNlcnZpY2UucXVlc3Rpb24odGhpcy5sYW5ndWFnZVNlcnZpY2VbJ2NhbmNlbFdpdGhvdXRTYXZlJ10pLnBpcGUoXG4gICAgICBzd2l0Y2hNYXAoKGlmQ2FuY2VsOiBib29sZWFuKSA9PiB7XG4gICAgICAgIGlmIChpZkNhbmNlbCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICByZXR1cm4gRU1QVFk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuX2NhbmNlbCgpO1xuICAgICAgfSlcbiAgICApO1xuICAgIHJldHVybiBjb25maXJtUmVzdWx0JDtcbiAgfVxuICAvKipcbiAgICog5p6E6YCg5YiG6aG15L+h5oGvXG4gICAqIEBwYXJhbSBwYXJlbnRJZCBwYXJlbnRJZFxuICAgKiBAcmV0dXJucyBcbiAgICovXG4gIHByaXZhdGUgYnVpbGRQYWdpbmF0aW9uSW5mbyhwYXJlbnRJZDogYW55KSB7XG4gICAgY29uc3QgcGFnaW5hdGlvbjogYW55ID0geyBwYWdlSW5kZXg6IDAsIHBhZ2VTaXplOiAwIH07XG4gICAgY29uc3QgZW5hYmxlTm9kZVBhZ2luYXRpb24gPSB0aGlzLmZyYW1lQ29udGV4dC5wYXJhbXMuZ2V0KCdlbmFibGVOb2RlUGFnaW5hdGlvbicpO1xuICAgIGlmICghcGFyZW50SWQpIHtcbiAgICAgIC8vIOS4gOe6p+WIhumhtVxuICAgICAgY29uc3QgcGFnZVNpemUgPSB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5wYWdlU2l6ZSB8fCAwO1xuICAgICAgY29uc3QgcGFnZUluZGV4ID0gdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24ucGFnZUluZGV4IHx8IDA7XG4gICAgICAvLyDlkK/nlKjkuobkuIDnuqfliIbpobVcbiAgICAgIGlmIChwYWdlU2l6ZSAhPT0gMCkge1xuICAgICAgICBwYWdpbmF0aW9uLnBhZ2VTaXplID0gcGFnZVNpemU7XG4gICAgICAgIHBhZ2luYXRpb24ucGFnZUluZGV4ID0gcGFnZUluZGV4O1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyDlpoLmnpzmnKrlkK/nlKjoioLngrnliIbpobXmiJblvZPliY3kuLrpobbnuqfoioLngrnliqDovb3vvIzliJnkuI3lpITnkIboioLngrnliIbpobVcbiAgICAgIGlmIChlbmFibGVOb2RlUGFnaW5hdGlvbikge1xuICAgICAgICBjb25zdCBub2RlUGFnZVNpemUgPSB0aGlzLmZyYW1lQ29udGV4dC5wYXJhbXMuZ2V0KCdub2RlUGFnZVNpemUnKSB8fCAwO1xuICAgICAgICBsZXQgbm9kZVBhZ2VJbmRleCA9IHRoaXMuZnJhbWVDb250ZXh0LnBhcmFtcy5nZXQoYF9OT0RFXyR7cGFyZW50SWR9X1BBR0VfSU5ERVhfYCk7XG4gICAgICAgIGlmICghbm9kZVBhZ2VJbmRleCkge1xuICAgICAgICAgIHRoaXMuZnJhbWVDb250ZXh0LnBhcmFtcy5zZXQoYF9OT0RFXyR7cGFyZW50SWR9X1BBR0VfSU5ERVhfYCwgMSk7XG4gICAgICAgICAgbm9kZVBhZ2VJbmRleCA9IDE7XG4gICAgICAgIH1cbiAgICAgICAgcGFnaW5hdGlvbi5wYWdlSW5kZXggPSBub2RlUGFnZUluZGV4O1xuICAgICAgICBwYWdpbmF0aW9uLnBhZ2VTaXplID0gbm9kZVBhZ2VTaXplO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcGFnaW5hdGlvbjtcbiAgfVxuXG4gIC8qKlxuICAgKiDlj5bmtojlj5jmm7RcbiAgICovXG4gIHByaXZhdGUgX2NhbmNlbCgpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgIGNvbnN0IGxvYWRpbmdUaW1lcklkID0gdGhpcy5sb2FkaW5nU2VydmljZS5zaG93TG9hZGluZ1dpdGhEZWxheSg1MDApO1xuICAgIGNvbnN0IGNhbmNlbCQgPSB0aGlzLnJlcG9zaXRvcnkuY2FuY2VsQ2hhbmdlcygpO1xuICAgIHJldHVybiBjYW5jZWwkLnBpcGUoXG4gICAgICBzd2l0Y2hNYXAoKCkgPT4ge1xuICAgICAgICBjb25zdCBpc0FkZCA9IHRoaXMudmlydHVhbFJvb3RGcmFtZUNvbnRleHQuZ2V0UGFyYW0oJ0lTX0FERCcpO1xuICAgICAgICBjb25zdCBsYXN0TW9kaWZpZWRJZCA9IHRoaXMudmlydHVhbFJvb3RGcmFtZUNvbnRleHQuZ2V0UGFyYW0oJ0xBU1RfTU9ESUZJRURfSUQnKTtcbiAgICAgICAgY29uc3QgY3VycmVudElkID0gdGhpcy5iaW5kaW5nRGF0YS5saXN0LmN1cnJlbnRJZDtcblxuICAgICAgICBpZiAoaXNBZGQgPT09IHRydWUpIHtcbiAgICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5yZW1vdmVFbnRpdHlCeUlkKGN1cnJlbnRJZCk7XG5cbiAgICAgICAgICAvLyDph43nva7nvJbovpHnirbmgIFcbiAgICAgICAgICB0aGlzLnZpcnR1YWxSb290RnJhbWVDb250ZXh0LnNldFBhcmFtKCdJU19BREQnLCBmYWxzZSk7XG4gICAgICAgICAgaWYgKGxhc3RNb2RpZmllZElkKSB7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgdGhpcy5iaW5kaW5nRGF0YS5saXN0LnNldEN1cnJlbnRJZChsYXN0TW9kaWZpZWRJZCwgdHJ1ZSwgdHJ1ZSk7XG4gICAgICAgICAgICB9LCAwKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIG9mKG51bGwpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiB0aGlzLnJlcG9zaXRvcnkudXBkYXRlQnlJZChjdXJyZW50SWQpO1xuICAgICAgICB9XG4gICAgICB9KSxcbiAgICAgIHRhcChcbiAgICAgICAgKCkgPT4ge1xuICAgICAgICAgIHRoaXMubG9hZGluZ1NlcnZpY2UuaGlkZURlbGF5TG9hZGluZyhsb2FkaW5nVGltZXJJZCk7XG4gICAgICAgIH0sXG4gICAgICAgIChlcnJvcjogYW55KSA9PiB7XG4gICAgICAgICAgdGhpcy5sb2FkaW5nU2VydmljZS5oaWRlRGVsYXlMb2FkaW5nKGxvYWRpbmdUaW1lcklkKTtcbiAgICAgICAgICB0aGlzLmVycm9yU2VydmljZS5leGNlcHRpb24odGhpcy5sYW5ndWFnZVNlcnZpY2UuY2FuY2VsRmFpbGVkLCBlcnJvcik7XG4gICAgICAgIH1cbiAgICAgIClcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIOajgOafpeaYr+WQpuWtmOWcqOS4i+e6p+iKgueCue+8iOWGhemDqOaWueazle+8jOivt+WLv+S9v+eUqO+8iVxuICAgKi9cbiAgcHVibGljIGhhc0NoaWxkTm9kZXMoaWQ6IHN0cmluZywgdHJlZU5vZGVzRGF0YTogYW55W10pOiBib29sZWFuIHtcbiAgICBjb25zdCB0cmVlTm9kZVV0aWwgPSB0aGlzLmdldFRyZWVOb2RlVXRpbCgpO1xuICAgIGlmICh0cmVlTm9kZVV0aWwuaGFzQ2hpbGROb2Rlcyh0cmVlTm9kZXNEYXRhLCB0aGlzLmhpZXJhcmNoeUluZm9LZXksIGlkKSA9PT0gdHJ1ZSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIC8qKlxuICAgKiDorqHnrpfliKDpmaTlkI7nmoTlvZPliY3oioLngrlpZO+8iOWGhemDqOaWueazle+8jOivt+WLv+S9v+eUqO+8iVxuICAgKi9cbiAgcHVibGljIGdldE5leHROb2RlSWRBZnRlclJlbW92aW5nKGlkVG9SZW1vdmU6IHN0cmluZywgdHJlZU5vZGVzRGF0YTogYW55W10pOiBzdHJpbmcge1xuICAgIGNvbnN0IHRyZWVOb2RlVXRpbCA9IHRoaXMuZ2V0VHJlZU5vZGVVdGlsKCk7XG4gICAgY29uc3QgbmV4dE5vZGVJZCA9IHRyZWVOb2RlVXRpbC5nZXROZXh0Tm9kZUlkKHRyZWVOb2Rlc0RhdGEsIHRoaXMuaGllcmFyY2h5SW5mb0tleSwgaWRUb1JlbW92ZSk7XG4gICAgcmV0dXJuIG5leHROb2RlSWQ7XG4gIH1cblxuICAvKipcbiAgICog6K6+572u5Yig6Zmk5ZCO55qE5b2T5YmN6IqC54K56IqC54K577yI5YaF6YOo5pa55rOV77yM6K+35Yu/5L2/55So77yJXG4gICAqL1xuICBwdWJsaWMgc2V0TmV4dE5vZGVBZnRlclJlbW92aW5nKG5leHROb2RlSWQ6IHN0cmluZyk6IHZvaWQge1xuICAgIGNvbnN0IHRyZWVOb2RlVXRpbCA9IHRoaXMuZ2V0VHJlZU5vZGVVdGlsKCk7XG4gICAgdHJlZU5vZGVVdGlsLnNlbGVjdGVkTm9kZSh0aGlzLmJpbmRpbmdEYXRhLCB0aGlzLmhpZXJhcmNoeUluZm9LZXksIG5leHROb2RlSWQpO1xuICB9XG4gIC8qKlxuICAgKiDorr7nva7moJHnmoTlvZPliY3ooYwo57uZ5a6M5pW05qCR5L2/55SoKVxuICAgKiBAcGFyYW0gaWQgaWRcbiAgICovXG4gIHB1YmxpYyBzZXRDdXJyZW50SWQoaWQ6IHN0cmluZykge1xuICAgIGlkID0gaWQgfHwgdGhpcy5mcmFtZUNvbnRleHQuZ2V0VmlydHVhbFJvb3RGcmFtZUNvbnRleHQoKS51aVN0YXRlWydfX0RFVktJVF9fc2VsZWN0ZWRSb3cnXSB8fCB0aGlzLmJpbmRpbmdEYXRhLmxpc3QuY3VycmVudEl0ZW0ucHJpbWFyeUtleVZhbHVlO1xuICAgIHRoaXMuZnJhbWVDb250ZXh0LmJpbmRpbmdEYXRhLmxpc3Quc2V0Q3VycmVudElkKGlkLCB0cnVlLCB0cnVlLCB0cnVlKTtcbiAgfVxuICAvKipcbiAgICog6YCJ5Lit5qCR55qE56ys5LiA5Liq6IqC54K5XG4gICAqL1xuICBwdWJsaWMgc2VsZWN0Rmlyc3RSb3coKSB7XG4gICAgY29uc3QgaGllcmFyY2h5VHlwZSA9IHRoaXMuZ2V0SGllcmFyY2h5VHlwZSgpO1xuICAgIGNvbnN0IHRyZWVOb2RlVXRpbCA9IFRyZWVVdGlsRmFjdG9yeS5nZXRJbnN0YW5jZShoaWVyYXJjaHlUeXBlKTtcbiAgICBpZiAodHJlZU5vZGVVdGlsICE9PSBudWxsKSB7XG4gICAgICB0cmVlTm9kZVV0aWwuc2VsZWN0Rmlyc3RSb290Tm9kZSh0aGlzLmJpbmRpbmdEYXRhLCB0aGlzLmhpZXJhcmNoeUluZm9LZXkpO1xuICAgIH1cbiAgfVxuICAvKipcbiAgICog6I635Y+W5qCR6IqC54K55bel5YW357G75a6e5L6LXG4gICAqL1xuICBwcml2YXRlIGdldFRyZWVOb2RlVXRpbCgpOiBhbnkge1xuICAgIGNvbnN0IGhpZXJhcmNoeVR5cGUgPSB0aGlzLmdldEhpZXJhcmNoeVR5cGUoKTtcbiAgICBjb25zdCB0cmVlTm9kZVV0aWwgPSBUcmVlVXRpbEZhY3RvcnkuZ2V0SW5zdGFuY2UoaGllcmFyY2h5VHlwZSk7XG4gICAgaWYgKHRyZWVOb2RlVXRpbCA9PT0gbnVsbCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGDkuI3mlK/mjIEke2hpZXJhcmNoeVR5cGV957G75Z6L55qE5YiG57qnYCk7XG4gICAgfVxuICAgIHJldHVybiB0cmVlTm9kZVV0aWw7XG4gIH1cblxuXG5cbiAgLyoqXG4gICAqIOiusOW9leWKoOi9veeKtuaAgVxuICAgKiBAdG9kb++8muW+heWIoOmZpFxuICAgKi9cbiAgcHJpdmF0ZSBzZXRMb2FkQnlMZXZlbFN0YXRlKGZpbHRlcnM6IHN0cmluZywgc29ydHM6IHN0cmluZykge1xuXG4gICAgLy8gQHRvZG/vvJrkuLTml7blpITnkIZcbiAgICB0aGlzLnZpcnR1YWxSb290RnJhbWVDb250ZXh0LnNldFBhcmFtKCdpc0xvYWRUcmVlQnlMZXZlbCcsIHRydWUpO1xuICAgIHRoaXMudmlydHVhbFJvb3RGcmFtZUNvbnRleHQuc2V0UGFyYW0oJ2xvYWRUcmVlQnlMZXZlbEZpbHRlcicsIGZpbHRlcnMpO1xuICAgIHRoaXMudmlydHVhbFJvb3RGcmFtZUNvbnRleHQuc2V0UGFyYW0oJ2xvYWRUcmVlQnlMZXZlbFNvcnQnLCBzb3J0cyk7XG4gIH1cblxuICAvKipcbiAgICog5bGV5byA5b2T5YmN6IqC54K5XG4gICAqIEB0b2Rv77ya5b6F5Yig6ZmkXG4gICAqL1xuICBwcml2YXRlIHJlbG9hZEJ5TGV2ZWwoKTogT2JzZXJ2YWJsZTxFbnRpdHlbXT4ge1xuICAgIGNvbnN0IGlzTG9hZEJ5TGV2ZWwgPSB0aGlzLnZpcnR1YWxSb290RnJhbWVDb250ZXh0LmdldFBhcmFtKCdpc0xvYWRUcmVlQnlMZXZlbCcpO1xuICAgIGlmIChpc0xvYWRCeUxldmVsID09PSB0cnVlKSB7XG4gICAgICBjb25zdCBmaWx0ZXJzID0gdGhpcy52aXJ0dWFsUm9vdEZyYW1lQ29udGV4dC5nZXRQYXJhbSgnbG9hZFRyZWVCeUxldmVsRmlsdGVyJyk7XG4gICAgICBjb25zdCBzb3J0cyA9IHRoaXMudmlydHVhbFJvb3RGcmFtZUNvbnRleHQuZ2V0UGFyYW0oJ2xvYWRUcmVlQnlMZXZlbFNvcnQnKTtcbiAgICAgIHJldHVybiB0aGlzLmxvYWRCeUxldmVsKGZpbHRlcnMsIHNvcnRzKTtcbiAgICB9XG4gICAgcmV0dXJuIG9mKFtdKTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0SGllcmFyY2h5VHlwZSgpIHtcbiAgICBjb25zdCBuZ09iamVjdHMgPSBGaWVsZE1ldGFkYXRhVXRpbC5nZXROZ09iamVjdHModGhpcy5yZXBvc2l0b3J5LmVudGl0eVR5cGUpO1xuICAgIGNvbnN0IGhpZXJhcmNoeUluZm9OZ09iamVjdEluZm8gPSBuZ09iamVjdHNbdGhpcy5oaWVyYXJjaHlJbmZvS2V5XTtcbiAgICBsZXQgaGllcmFyY2h5VHlwZSA9ICdwYXRoJzsgLy8g5YiG57qn56CB6buY6K6k5Li6cGF0aO+8jOWFvOWuueWOn+ihqOWNlVxuICAgIGlmIChoaWVyYXJjaHlJbmZvTmdPYmplY3RJbmZvLmhhc093blByb3BlcnR5KCdoaWVyYXJjaHlUeXBlJykgJiYgaGllcmFyY2h5SW5mb05nT2JqZWN0SW5mb1snaGllcmFyY2h5VHlwZSddICE9IG51bGwpIHtcbiAgICAgIGhpZXJhcmNoeVR5cGUgPSBoaWVyYXJjaHlJbmZvTmdPYmplY3RJbmZvWydoaWVyYXJjaHlUeXBlJ10gYXMgc3RyaW5nO1xuICAgIH1cbiAgICBpZiAoaGllcmFyY2h5VHlwZSA9PSBudWxsIHx8IGhpZXJhcmNoeVR5cGUubGVuZ3RoIDwgMSkge1xuICAgICAgLy8gJ+WIhue6p+eggemFjee9ruS/oeaBr+mUmeivrydcbiAgICAgIHRocm93IG5ldyBFcnJvcih0aGlzLmxhbmd1YWdlU2VydmljZVsnaW5jb3JyZWN0SGllcmFyY2h5Q29uZmlnJ10pO1xuICAgIH1cbiAgICByZXR1cm4gaGllcmFyY2h5VHlwZTtcbiAgfVxuICAvKipcbiAgICog6I635Y+W5qC557uE5Lu25raI5oGv566h6YGTXG4gICAqL1xuICBwcml2YXRlIGdldCBtZXNzYWdlUGlwZSgpIHtcbiAgICBpZiAodGhpcy5mcmFtZUNvbnRleHQpIHtcbiAgICAgIGNvbnN0IGFwcENvbnRleHQgPSB0aGlzLmZyYW1lQ29udGV4dC5nZXRGb3JtQXBwQ29udGV4dCgpIHx8IG51bGw7XG4gICAgICBpZiAoYXBwQ29udGV4dCkge1xuICAgICAgICByZXR1cm4gYXBwQ29udGV4dC5tZXNzYWdlUGlwZSB8fCBudWxsO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufVxuZXhwb3J0IHsgVHJlZURhdGFTZXJ2aWNlIH07XG4iXX0=