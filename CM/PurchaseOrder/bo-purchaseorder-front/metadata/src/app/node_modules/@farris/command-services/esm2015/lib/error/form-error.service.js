import { Injectable, Optional } from '@angular/core';
import { HttpErrorResponse } from '@angular/common/http';
import { FormMessageService } from '../form-message.service';
import { LanguageService } from '../languag.service';
import { HttpUtil, HttpStatusType } from '../util/http';
/**
 * 表单错误提示服务
 * @description 统一处理前后端异常
 */
class FormErrorService {
    constructor(msgService, languageService) {
        this.msgService = msgService;
        this.languageService = languageService;
    }
    /**
     * 异常路由方法
     */
    exception(message, error) {
        // 针对session失效做特殊处理
        if (error && error.hasOwnProperty('expired') && error['expired'] === true) {
            return;
        }
        if (error && this.isHttpErrorResponse(error)) {
            this.httpErrorHandler(error);
        }
        else {
            // todo: 细化异常处理后，继续拆解该方法
            this.commonErrorHandler(message);
        }
    }
    /**
     * http请求异常处理器
     */
    httpErrorHandler(httpError) {
        if (!httpError) {
            return;
        }
        const statusType = HttpUtil.getHttpStatusType(httpError.status);
        switch (statusType) {
            case HttpStatusType.ClientError:
                if (httpError.status === 401) {
                    this.msgService.http401Error(httpError);
                    break;
                }
                this.msgService.httpErrorInClient(httpError);
                break;
            case HttpStatusType.ServerError:
                this.msgService.httpErrorInServer(httpError);
                break;
            default:
                throw new Error('Get invalid status code when using httpErrorHandler method.');
        }
    }
    commonErrorHandler(errorMsg) {
        if (!errorMsg) {
            return;
        }
        this.msgService.error(errorMsg);
    }
    /**
     * httpErrorResponse like
     * @param error 异常
     */
    isHttpErrorResponse(error) {
        if (!error) {
            return false;
        }
        if (typeof error !== 'object') {
            return false;
        }
        if (error.name === 'HttpErrorResponse' && error.hasOwnProperty('status') && error.hasOwnProperty('error')) {
            return true;
        }
        if (error instanceof HttpErrorResponse) {
            return true;
        }
        return false;
    }
}
FormErrorService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
FormErrorService.ctorParameters = () => [
    { type: FormMessageService },
    { type: LanguageService, decorators: [{ type: Optional }] }
];
export { FormErrorService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9ybS1lcnJvci5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9jb21tYW5kLXNlcnZpY2VzLyIsInNvdXJjZXMiOlsibGliL2Vycm9yL2Zvcm0tZXJyb3Iuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNyRCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUV6RCxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUM3RCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDckQsT0FBTyxFQUFFLFFBQVEsRUFBRSxjQUFjLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFFeEQ7OztHQUdHO0FBQ0gsTUFDTSxnQkFBZ0I7SUFFcEIsWUFDVSxVQUE4QixFQUNsQixlQUFnQztRQUQ1QyxlQUFVLEdBQVYsVUFBVSxDQUFvQjtRQUNsQixvQkFBZSxHQUFmLGVBQWUsQ0FBaUI7SUFFdEQsQ0FBQztJQUVEOztPQUVHO0lBQ0ksU0FBUyxDQUFDLE9BQWUsRUFBRSxLQUFVO1FBQzFDLG1CQUFtQjtRQUNuQixJQUFJLEtBQUssSUFBSSxLQUFLLENBQUMsY0FBYyxDQUFDLFNBQVMsQ0FBQyxJQUFJLEtBQUssQ0FBQyxTQUFTLENBQUMsS0FBSyxJQUFJLEVBQUU7WUFDekUsT0FBTztTQUNSO1FBQ0QsSUFBSSxLQUFLLElBQUksSUFBSSxDQUFDLG1CQUFtQixDQUFDLEtBQUssQ0FBQyxFQUFFO1lBQzVDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLENBQUMsQ0FBQztTQUM5QjthQUFNO1lBRUwsd0JBQXdCO1lBQ3hCLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxPQUFPLENBQUMsQ0FBQztTQUNsQztJQUNILENBQUM7SUFFRDs7T0FFRztJQUNJLGdCQUFnQixDQUFDLFNBQTRCO1FBQ2xELElBQUksQ0FBQyxTQUFTLEVBQUU7WUFDZCxPQUFPO1NBQ1I7UUFFRCxNQUFNLFVBQVUsR0FBRyxRQUFRLENBQUMsaUJBQWlCLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBRWhFLFFBQVEsVUFBVSxFQUFFO1lBQ2xCLEtBQUssY0FBYyxDQUFDLFdBQVc7Z0JBQzdCLElBQUksU0FBUyxDQUFDLE1BQU0sS0FBSyxHQUFHLEVBQUU7b0JBQzVCLElBQUksQ0FBQyxVQUFVLENBQUMsWUFBWSxDQUFDLFNBQVMsQ0FBQyxDQUFDO29CQUN4QyxNQUFNO2lCQUNQO2dCQUVELElBQUksQ0FBQyxVQUFVLENBQUMsaUJBQWlCLENBQUMsU0FBUyxDQUFDLENBQUM7Z0JBQzdDLE1BQU07WUFDUixLQUFLLGNBQWMsQ0FBQyxXQUFXO2dCQUM3QixJQUFJLENBQUMsVUFBVSxDQUFDLGlCQUFpQixDQUFDLFNBQVMsQ0FBQyxDQUFDO2dCQUM3QyxNQUFNO1lBQ1I7Z0JBQ0UsTUFBTSxJQUFJLEtBQUssQ0FBQyw2REFBNkQsQ0FBQyxDQUFDO1NBQ2xGO0lBQ0gsQ0FBQztJQUVPLGtCQUFrQixDQUFDLFFBQWdCO1FBQ3pDLElBQUksQ0FBQyxRQUFRLEVBQUU7WUFDYixPQUFPO1NBQ1I7UUFDRCxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUNsQyxDQUFDO0lBQ0Q7OztPQUdHO0lBQ0ssbUJBQW1CLENBQUMsS0FBSztRQUMvQixJQUFJLENBQUMsS0FBSyxFQUFFO1lBQ1YsT0FBTyxLQUFLLENBQUM7U0FDZDtRQUNELElBQUksT0FBTyxLQUFLLEtBQUssUUFBUSxFQUFFO1lBQzdCLE9BQU8sS0FBSyxDQUFDO1NBQ2Q7UUFDRCxJQUFJLEtBQUssQ0FBQyxJQUFJLEtBQUssbUJBQW1CLElBQUksS0FBSyxDQUFDLGNBQWMsQ0FBQyxRQUFRLENBQUMsSUFBSSxLQUFLLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FBQyxFQUFFO1lBQ3pHLE9BQU8sSUFBSSxDQUFDO1NBQ2I7UUFDRCxJQUFJLEtBQUssWUFBWSxpQkFBaUIsRUFBRTtZQUN0QyxPQUFPLElBQUksQ0FBQztTQUNiO1FBQ0QsT0FBTyxLQUFLLENBQUM7SUFDZixDQUFDOzs7WUE3RUYsVUFBVTs7OztZQVJGLGtCQUFrQjtZQUNsQixlQUFlLHVCQVluQixRQUFROztBQTJFYixPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIE9wdGlvbmFsIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBIdHRwRXJyb3JSZXNwb25zZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcblxuaW1wb3J0IHsgRm9ybU1lc3NhZ2VTZXJ2aWNlIH0gZnJvbSAnLi4vZm9ybS1tZXNzYWdlLnNlcnZpY2UnO1xuaW1wb3J0IHsgTGFuZ3VhZ2VTZXJ2aWNlIH0gZnJvbSAnLi4vbGFuZ3VhZy5zZXJ2aWNlJztcbmltcG9ydCB7IEh0dHBVdGlsLCBIdHRwU3RhdHVzVHlwZSB9IGZyb20gJy4uL3V0aWwvaHR0cCc7XG5cbi8qKlxuICog6KGo5Y2V6ZSZ6K+v5o+Q56S65pyN5YqhXG4gKiBAZGVzY3JpcHRpb24g57uf5LiA5aSE55CG5YmN5ZCO56uv5byC5bi4XG4gKi9cbkBJbmplY3RhYmxlKClcbmNsYXNzIEZvcm1FcnJvclNlcnZpY2Uge1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgbXNnU2VydmljZTogRm9ybU1lc3NhZ2VTZXJ2aWNlLFxuICAgIEBPcHRpb25hbCgpIHByaXZhdGUgbGFuZ3VhZ2VTZXJ2aWNlOiBMYW5ndWFnZVNlcnZpY2VcbiAgKSB7XG4gIH1cblxuICAvKipcbiAgICog5byC5bi46Lev55Sx5pa55rOVXG4gICAqL1xuICBwdWJsaWMgZXhjZXB0aW9uKG1lc3NhZ2U6IHN0cmluZywgZXJyb3I6IGFueSkge1xuICAgIC8vIOmSiOWvuXNlc3Npb27lpLHmlYjlgZrnibnmrorlpITnkIZcbiAgICBpZiAoZXJyb3IgJiYgZXJyb3IuaGFzT3duUHJvcGVydHkoJ2V4cGlyZWQnKSAmJiBlcnJvclsnZXhwaXJlZCddID09PSB0cnVlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChlcnJvciAmJiB0aGlzLmlzSHR0cEVycm9yUmVzcG9uc2UoZXJyb3IpKSB7XG4gICAgICB0aGlzLmh0dHBFcnJvckhhbmRsZXIoZXJyb3IpO1xuICAgIH0gZWxzZSB7XG5cbiAgICAgIC8vIHRvZG86IOe7huWMluW8guW4uOWkhOeQhuWQju+8jOe7p+e7reaLhuino+ivpeaWueazlVxuICAgICAgdGhpcy5jb21tb25FcnJvckhhbmRsZXIobWVzc2FnZSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIGh0dHDor7fmsYLlvILluLjlpITnkIblmahcbiAgICovXG4gIHB1YmxpYyBodHRwRXJyb3JIYW5kbGVyKGh0dHBFcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpOiB2b2lkIHtcbiAgICBpZiAoIWh0dHBFcnJvcikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IHN0YXR1c1R5cGUgPSBIdHRwVXRpbC5nZXRIdHRwU3RhdHVzVHlwZShodHRwRXJyb3Iuc3RhdHVzKTtcblxuICAgIHN3aXRjaCAoc3RhdHVzVHlwZSkge1xuICAgICAgY2FzZSBIdHRwU3RhdHVzVHlwZS5DbGllbnRFcnJvcjpcbiAgICAgICAgaWYgKGh0dHBFcnJvci5zdGF0dXMgPT09IDQwMSkge1xuICAgICAgICAgIHRoaXMubXNnU2VydmljZS5odHRwNDAxRXJyb3IoaHR0cEVycm9yKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMubXNnU2VydmljZS5odHRwRXJyb3JJbkNsaWVudChodHRwRXJyb3IpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgSHR0cFN0YXR1c1R5cGUuU2VydmVyRXJyb3I6XG4gICAgICAgIHRoaXMubXNnU2VydmljZS5odHRwRXJyb3JJblNlcnZlcihodHRwRXJyb3IpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignR2V0IGludmFsaWQgc3RhdHVzIGNvZGUgd2hlbiB1c2luZyBodHRwRXJyb3JIYW5kbGVyIG1ldGhvZC4nKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNvbW1vbkVycm9ySGFuZGxlcihlcnJvck1zZzogc3RyaW5nKTogdm9pZCB7XG4gICAgaWYgKCFlcnJvck1zZykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLm1zZ1NlcnZpY2UuZXJyb3IoZXJyb3JNc2cpO1xuICB9XG4gIC8qKlxuICAgKiBodHRwRXJyb3JSZXNwb25zZSBsaWtlXG4gICAqIEBwYXJhbSBlcnJvciDlvILluLhcbiAgICovXG4gIHByaXZhdGUgaXNIdHRwRXJyb3JSZXNwb25zZShlcnJvcikge1xuICAgIGlmICghZXJyb3IpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBlcnJvciAhPT0gJ29iamVjdCcpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgaWYgKGVycm9yLm5hbWUgPT09ICdIdHRwRXJyb3JSZXNwb25zZScgJiYgZXJyb3IuaGFzT3duUHJvcGVydHkoJ3N0YXR1cycpICYmIGVycm9yLmhhc093blByb3BlcnR5KCdlcnJvcicpKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKGVycm9yIGluc3RhbmNlb2YgSHR0cEVycm9yUmVzcG9uc2UpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn1cblxuZXhwb3J0IHsgRm9ybUVycm9yU2VydmljZSB9O1xuXG4iXX0=