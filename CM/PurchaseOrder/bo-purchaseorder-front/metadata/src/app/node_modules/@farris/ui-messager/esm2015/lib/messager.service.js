/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*
 * @Author: 疯狂秀才(Lucas Huang)
 * @LastEditors: 疯狂秀才(Lucas Huang)
 * @Company: Inspur
 * @Version: v0.0.15
 * @Date: 2019-04-02 11:48:08
 * @LastEditTime: 2019-10-26 16:38:34
 */
import { Injectable, Injector, NgZone } from '@angular/core';
import { Subject, of } from 'rxjs';
import { BsModalService } from '@farris/ui-modal';
import { MessagerDefaultConfig, MESSAGER_DEFAULT_CONFIG } from './messager.config';
import { MessagerComponent } from './messager.component';
import { LocaleService } from '@farris/ui-locale';
export class MessagerService {
    /**
     * @param {?} bsModalService
     * @param {?} injector
     */
    constructor(bsModalService, injector) {
        this.bsModalService = bsModalService;
        this.injector = injector;
        this.version = '0.0.15';
        this.currentId = -1;
        this.modals = [];
        this.defaultMessagerConfig = null;
        /** @type {?} */
        const config = this.injector.get(MESSAGER_DEFAULT_CONFIG) || MessagerDefaultConfig;
        this.defaultMessagerConfig = Object.assign({}, MessagerDefaultConfig, config);
        this.ngZone = this.injector.get(NgZone);
        this.localeService = this.injector.get(LocaleService);
    }
    /**
     * @return {?}
     */
    get okText() {
        return this.localeService.getValue('messager.ok');
    }
    /**
     * @return {?}
     */
    get cancelText() {
        return this.localeService.getValue('messager.cancel');
    }
    /**
     * @return {?}
     */
    get yesText() {
        return this.localeService.getValue('messager.yes');
    }
    /**
     * @return {?}
     */
    get noText() {
        return this.localeService.getValue('messager.no');
    }
    /**
     * @return {?}
     */
    get titleText() {
        return this.localeService.getValue('messager.title');
    }
    /**
     * @return {?}
     */
    get errorTitle() {
        return this.localeService.getValue('messager.errorTitle');
    }
    /**
     * @param {?} str
     * @return {?}
     */
    escapeHtml(str) {
        if (str === null || str === undefined) {
            return '';
        }
        return str
            .replace(/&/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;')
            .replace(/\"/g, '&quot;')
            .replace(/\'/g, '&#39;')
            .replace(/\//g, '&#x2F;');
    }
    /**
     * 显示信息提示框
     * @param {?} msgtype 消息类别
     * @param {?} message 提示消息一
     * @param {?=} opts 参数 提供属性 fitContent:true支持自动适应宽度
     * @param {?=} submsg 提示消息二级
     * @return {?}
     */
    show(msgtype, message, opts, submsg = '') {
        if (document.activeElement) {
            ((/** @type {?} */ (document.activeElement))).blur();
        }
        /** @type {?} */
        const modalHeight = 180;
        /** @type {?} */
        let defaultOpts = {
            safeHtml: true,
            title: this.titleText,
            width: 390,
            height: modalHeight,
            showButtons: false,
            showMaxButton: false,
            resizable: false,
            initialState: {
                okText: this.okText,
                okHandle: (/**
                 * @return {?}
                 */
                () => {
                    this.close();
                })
            },
            class: 'modal-message ' + (msgtype ? 'modal-message-type-' + msgtype : ''),
            showHeader: false,
        };
        defaultOpts = Object.assign({}, this.defaultMessagerConfig, defaultOpts);
        /** @type {?} */
        let extendOpts = {};
        switch (msgtype) {
            case 'prompt':
                // 弹出对话类型
                extendOpts = { showHeader: true, modalHeight: 260 };
                break;
            case 'error':
                // 错误
                extendOpts = { title: this.errorTitle, width: 446, showHeader: true, showMaxButton: true, fitContent: true };
                break;
            case 'exception':
                extendOpts = { safeHtml: false, title: this.errorTitle, width: 446, showHeader: true, fitContent: true };
                break;
            default:
                // 默认其他
                extendOpts = { width: submsg ? 446 : 390, fitContent: true };
        }
        Object.assign(defaultOpts, extendOpts);
        if (opts) {
            Object.assign(defaultOpts, opts);
        }
        if (message && defaultOpts.safeHtml) {
            message = this.escapeHtml(message);
        }
        Object.assign(defaultOpts.initialState, {
            type: msgtype,
            message,
            msg: submsg,
            exception: opts && opts['exception'] ? opts['exception'] : null,
            showLines: opts && opts['showLines'] ? opts['showLines'] : 3,
            readonly: opts && opts['readonly'] ? opts['readonly'] : false
        });
        if (defaultOpts['buttons'] && defaultOpts['buttons'].length) {
            if (!defaultOpts.initialState['buttons'] || !defaultOpts.initialState['buttons'].length) {
                defaultOpts.initialState['buttons'] = defaultOpts['buttons'];
            }
        }
        /** @type {?} */
        const _modal = this.bsModalService.show(MessagerComponent, defaultOpts);
        // _modal.content.buttons = defaultOpts['buttons'] || [];
        this.confirmSubject = new Subject();
        if (this.modals.length > 0) {
            /** @type {?} */
            const modalContainerComponent = _modal.dialog;
            modalContainerComponent.instance.isShown = true;
            modalContainerComponent.instance.moveTo(15 * this.modals.length, 15 * this.modals.length);
        }
        this.ngZone.runOutsideAngular((/**
         * @return {?}
         */
        () => {
            // 第1个按钮获取焦点
            setTimeout((/**
             * @return {?}
             */
            () => {
                /** @type {?} */
                const btnOk = _modal.content.btnOkEl ? _modal.content.btnOkEl.nativeElement : null;
                if (btnOk) {
                    btnOk['focus']();
                }
                else {
                    /** @type {?} */
                    const btns = _modal.dialog.location.nativeElement.querySelectorAll('.modal-footer button');
                    if (btns.length) {
                        btns.item(0)['focus']();
                    }
                }
            }));
        }));
        this.msgMgr(_modal);
        return _modal;
    }
    /**
     * @private
     * @param {?} ref
     * @return {?}
     */
    msgMgr(ref) {
        /** @type {?} */
        const id = this.bsModalService.getModalsCount() + 1000;
        if (this.modals.length === 0) {
            this.modals.push({ id, ref });
        }
        else {
            if (!this.getModalById(id)) {
                this.modals.push({ id, ref });
            }
            else {
                this.getModalById(id).ref = ref;
            }
        }
        /** @type {?} */
        const cmp = this.getModalCmp();
        cmp.closed.subscribe((/**
         * @param {?} level
         * @return {?}
         */
        (level) => {
            this.removeMessager(id);
            this.confirmSubject.unsubscribe();
        }));
        this.currentId = id;
    }
    /**
     * @param {?} message
     * @param {?} okCallback
     * @param {?=} cancelCallback
     * @param {?=} msg
     * @param {?=} fitContent
     * @return {?}
     */
    question(message, okCallback, cancelCallback, msg, fitContent = true) {
        /** @type {?} */
        const questionDlg = this.show('question', message, {
            initialState: {
                okText: this.yesText,
                okHandle: (/**
                 * @return {?}
                 */
                () => {
                    questionDlg.close();
                    if (okCallback) {
                        okCallback();
                    }
                }),
                cancelText: this.noText,
                cancelHandle: (/**
                 * @return {?}
                 */
                () => {
                    questionDlg.close();
                    if (cancelCallback) {
                        cancelCallback();
                    }
                })
            },
            fitContent
        }, msg);
        return questionDlg;
    }
    /**
     * @param {?} messager
     * @param {?} btns
     * @param {?=} msg
     * @param {?=} fitContent
     * @return {?}
     */
    question2(messager, btns, msg, fitContent = true) {
        return this.show('question', messager, {
            initialState: {
                buttons: btns
            },
            fitContent
        }, msg);
    }
    /**
     * 2020年3月7日因为textarea高度在不同浏览器下不一样，固定高度可能会出现滚动条
     * @param {?} title 标题
     * @param {?=} msg 信息
     * @param {?=} fitContent 自适应内容
     * @return {?}
     */
    prompt(title, msg, fitContent = true) {
        /** @type {?} */
        const promptSubject = new Subject();
        /** @type {?} */
        const dlg = this.show('prompt', msg, {
            title,
            initialState: {
                okText: this.okText,
                okHandle: (/**
                 * @return {?}
                 */
                () => {
                    /** @type {?} */
                    const mc = (/** @type {?} */ (dlg.content));
                    dlg.close();
                    promptSubject.next(mc.promptText.nativeElement.value);
                }),
                cancelText: this.cancelText,
                cancelHandle: (/**
                 * @return {?}
                 */
                () => {
                    dlg.close();
                    promptSubject.next(false);
                })
            },
            fitContent,
            closed: (/**
             * @return {?}
             */
            () => {
                promptSubject.unsubscribe();
            })
        }, msg);
        return promptSubject;
    }
    /**
     * @param {?} title
     * @param {?=} msg
     * @param {?=} opts
     * @return {?}
     */
    prompt2(title, msg, opts) {
        /** @type {?} */
        const promptSubject = new Subject();
        /** @type {?} */
        const _opts = {
            showOkButton: true,
            showCloseButton: true,
            showFontSize: false,
            fontSize: 18,
            readonly: false,
            saveSize: false,
            closeWhenever: true
        };
        if (!opts) {
            opts = _opts;
        }
        else {
            opts = Object.assign(_opts, opts);
        }
        /** @type {?} */
        const _dialogOpts = {
            title,
            initialState: {
                showOkButton: opts.showOkButton === undefined ? true : opts.showOkButton,
                showCancelButton: opts.showCancelButton === undefined ? true : opts.showCancelButton,
                okText: this.okText,
                okHandle: (/**
                 * @return {?}
                 */
                () => {
                    /** @type {?} */
                    const mc = (/** @type {?} */ (dlg.content));
                    /** @type {?} */
                    const val = mc.promptText.nativeElement.value;
                    if (opts.closeWhenever) {
                        dlg.close();
                        promptSubject.next(val);
                    }
                    else {
                        promptSubject.next({ val, dlg });
                    }
                }),
                cancelText: this.cancelText,
                cancelHandle: (/**
                 * @return {?}
                 */
                () => {
                    dlg.close();
                    promptSubject.next(false);
                }),
                showFontSize: opts.showFontSize,
                fontSize: opts.fontSize || 18,
                enableWordCount: !!opts.enableWordCount,
                countType: opts.countType || 'length',
                maxLength: opts.maxLength,
                inputType: opts.inputType || 'textarea',
                placeholder: opts.placeholder || ''
            },
            fitContent: false,
            showMaxButton: true,
            resizable: true,
            class: '',
            closed: (/**
             * @return {?}
             */
            () => {
                promptSubject.unsubscribe();
            }),
            opened: (/**
             * @return {?}
             */
            () => {
                if (opts.inputType !== 'textarea') {
                    return;
                }
                else {
                    setTimeout((/**
                     * @return {?}
                     */
                    () => {
                        /** @type {?} */
                        const textareaEle = dlg.content.promptText.nativeElement;
                        textareaEle.closest('section').style.padding = '15px';
                        textareaEle.style.resize = 'none';
                        textareaEle.style.height = '100%';
                        if (opts.readonly) {
                            textareaEle.readOnly = true;
                        }
                    }));
                }
            }),
            beforeClose: (/**
             * @param {?} modalRef
             * @return {?}
             */
            (modalRef) => {
                if (opts.saveSize && !dlg.dialog.instance.isMax) {
                    /** @type {?} */
                    const data = { fontSize: dlg.content.fontSize, width: modalRef.config.width, height: modalRef.config.height };
                    this.saveTextAreaSizeInfo(data);
                }
                return of(true);
            })
        };
        /** @type {?} */
        let dialogOpts = _dialogOpts;
        if (opts) {
            dialogOpts = Object.assign(dialogOpts, opts);
        }
        /** @type {?} */
        const dlg = this.show('prompt', msg, dialogOpts, msg);
        if (opts.inputType && dlg.content.promptText) {
            dlg.content.promptText.nativeElement.focus();
        }
        return promptSubject;
    }
    /**
     * @return {?}
     */
    getKeyString() {
        // 一台终端共用一个配置
        // 保留最后一次的设置，
        // 保存窗口大小，字体大小
        return 'IGIX-FARRIS-UI-TEXTAREA-ZOOM-SETTINGS';
    }
    /**
     * @private
     * @param {?} data
     * @return {?}
     */
    saveTextAreaSizeInfo(data) {
        if (window.localStorage) {
            /** @type {?} */
            const key = this.getKeyString();
            localStorage.setItem(key, JSON.stringify(data));
        }
    }
    /**
     * @param {?} message
     * @param {?=} msg
     * @param {?=} fitContent
     * @return {?}
     */
    confirm(message, msg, fitContent = true) {
        /** @type {?} */
        const confirmSubject = new Subject();
        /** @type {?} */
        const confirmDlg = this.show('question', message, {
            initialState: {
                okText: this.okText,
                okHandle: (/**
                 * @return {?}
                 */
                () => {
                    confirmDlg.close();
                    confirmSubject.next(true);
                }),
                cancelText: this.cancelText,
                cancelHandle: (/**
                 * @return {?}
                 */
                () => {
                    confirmDlg.close();
                    confirmSubject.next(false);
                })
            },
            fitContent,
            closed: (/**
             * @return {?}
             */
            () => {
                confirmSubject.unsubscribe();
            })
        }, msg);
        return confirmSubject.asObservable();
    }
    /**
     * @param {?} message
     * @param {?=} callback
     * @param {?=} msg
     * @param {?=} fitContent
     * @return {?}
     */
    info(message, callback, msg, fitContent = true) {
        /** @type {?} */
        const infoDlg = this.show('info', message, {
            initialState: {
                okText: this.okText,
                okHandle: (/**
                 * @return {?}
                 */
                () => {
                    infoDlg.close();
                    if (callback) {
                        callback();
                    }
                })
            },
            fitContent
        }, msg);
        return infoDlg;
    }
    /**
     * 操作成功提示，
     * message: 提示信息
     * msg: 2级信息
     * fitCountent: 默认为true
     * callback: 确定事件回调
     * @param {?} message
     * @param {?=} msg
     * @param {?=} fitContent
     * @param {?=} callback
     * @return {?}
     */
    success(message, msg, fitContent = true, callback = null) {
        /** @type {?} */
        const successDlg = this.show('success', message, {
            initialState: {
                okText: this.okText,
                okHandle: (/**
                 * @return {?}
                 */
                () => {
                    successDlg.close();
                    if (callback) {
                        callback();
                    }
                })
            },
            fitContent
        }, msg);
        return successDlg;
    }
    /**
     * 提示错误信息，
     * message: 提示信息
     * msg: 2级信息
     * fitCountent: 默认为true
     * callback: 确定事件回调
     * @param {?} message
     * @param {?=} msg
     * @param {?=} fitContent
     * @param {?=} callback
     * @param {?=} safeHtml
     * @return {?}
     */
    error(message, msg, fitContent = true, callback = null, safeHtml = true) {
        /** @type {?} */
        const errorDlg = this.show('error', message, {
            safeHtml,
            initialState: {
                okText: this.okText,
                okHandle: (/**
                 * @return {?}
                 */
                () => {
                    errorDlg.close();
                    if (callback) {
                        callback();
                    }
                })
            },
            fitContent
        }, msg);
        return errorDlg;
    }
    /**
     * @param {?} message
     * @param {?=} msg
     * @param {?=} fitContent
     * @param {?=} callback
     * @return {?}
     */
    warning(message, msg, fitContent = true, callback = null) {
        /** @type {?} */
        const warningDlg = this.show('warning', message, {
            initialState: {
                okText: this.okText,
                okHandle: (/**
                 * @return {?}
                 */
                () => {
                    warningDlg.close();
                    if (callback) {
                        callback();
                    }
                })
            },
            fitContent
        }, msg);
        return warningDlg;
    }
    /**
     * @param {?} type
     * @param {?} title
     * @param {?=} message
     * @param {?=} callback
     * @return {?}
     */
    showHtmlMsg(type, title, message, callback = null) {
        /** @type {?} */
        const msgDlg = this.show(type, title, {
            safeHtml: false,
            initialState: {
                okText: this.okText,
                okHandle: (/**
                 * @return {?}
                 */
                () => {
                    msgDlg.close();
                    if (callback) {
                        callback();
                    }
                })
            },
            fitContent: true
        }, message);
        return msgDlg;
    }
    /**
     * @private
     * @return {?}
     */
    close() {
        if (this.modals.length) {
            /** @type {?} */
            const msgbox = this.getModalById(this.currentId);
            if (msgbox) {
                msgbox.ref.close();
            }
        }
    }
    /**
     * @private
     * @param {?} id
     * @return {?}
     */
    getModalById(id) {
        return this.modals.find((/**
         * @param {?} item
         * @return {?}
         */
        item => item.id === id));
    }
    /**
     * @private
     * @return {?}
     */
    getModalCmp() {
        return this.bsModalService.getCurrentModalContainer().instance;
    }
    /**
     * @private
     * @param {?} id
     * @return {?}
     */
    removeMessager(id) {
        this.modals = this.modals.filter((/**
         * @param {?} n
         * @return {?}
         */
        n => n.id !== id));
        if (!this.modals.length) {
            this.currentId = -1;
        }
        else {
            this.currentId = this.modals[this.modals.length - 1].id;
        }
    }
}
MessagerService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
MessagerService.ctorParameters = () => [
    { type: BsModalService },
    { type: Injector }
];
if (false) {
    /** @type {?} */
    MessagerService.prototype.version;
    /** @type {?} */
    MessagerService.prototype.currentId;
    /** @type {?} */
    MessagerService.prototype.modals;
    /**
     * @type {?}
     * @private
     */
    MessagerService.prototype.defaultMessagerConfig;
    /**
     * @type {?}
     * @private
     */
    MessagerService.prototype.confirmSubject;
    /**
     * @type {?}
     * @private
     */
    MessagerService.prototype.ngZone;
    /**
     * @type {?}
     * @private
     */
    MessagerService.prototype.localeService;
    /**
     * @type {?}
     * @private
     */
    MessagerService.prototype.bsModalService;
    /**
     * @type {?}
     * @private
     */
    MessagerService.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWVzc2FnZXIuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktbWVzc2FnZXIvIiwic291cmNlcyI6WyJsaWIvbWVzc2FnZXIuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFVQSxPQUFPLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDN0QsT0FBTyxFQUFFLE9BQU8sRUFBYyxFQUFFLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDL0MsT0FBTyxFQUFFLGNBQWMsRUFBNEIsTUFBTSxrQkFBa0IsQ0FBQztBQUM1RSxPQUFPLEVBQWtCLHFCQUFxQixFQUFFLHVCQUF1QixFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDbkcsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDekQsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBS2xELE1BQU0sT0FBTyxlQUFlOzs7OztJQVd4QixZQUFvQixjQUE4QixFQUFVLFFBQWtCO1FBQTFELG1CQUFjLEdBQWQsY0FBYyxDQUFnQjtRQUFVLGFBQVEsR0FBUixRQUFRLENBQVU7UUFWOUUsWUFBTyxHQUFHLFFBQVEsQ0FBQztRQUNuQixjQUFTLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDZixXQUFNLEdBQXNDLEVBQUUsQ0FBQztRQUN2QywwQkFBcUIsR0FBbUIsSUFBSSxDQUFDOztjQVEzQyxNQUFNLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsdUJBQXVCLENBQUMsSUFBSSxxQkFBcUI7UUFDbEYsSUFBSSxDQUFDLHFCQUFxQixHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLHFCQUFxQixFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBQzlFLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENB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SUFFekIseUNBQXNDOzs7OztJQUFFLG1DQUEwQiIsInNvdXJjZXNDb250ZW50IjpbIlxyXG4vKlxyXG4gKiBAQXV0aG9yOiDnlq/ni4Lnp4DmiY0oTHVjYXMgSHVhbmcpXHJcbiAqIEBMYXN0RWRpdG9yczog55av54uC56eA5omNKEx1Y2FzIEh1YW5nKVxyXG4gKiBAQ29tcGFueTogSW5zcHVyXHJcbiAqIEBWZXJzaW9uOiB2MC4wLjE1XHJcbiAqIEBEYXRlOiAyMDE5LTA0LTAyIDExOjQ4OjA4XHJcbiAqIEBMYXN0RWRpdFRpbWU6IDIwMTktMTAtMjYgMTY6Mzg6MzRcclxuICovXHJcblxyXG5pbXBvcnQgeyBJbmplY3RhYmxlLCBJbmplY3RvciwgTmdab25lIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFN1YmplY3QsIE9ic2VydmFibGUsIG9mIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IEJzTW9kYWxTZXJ2aWNlLCBCc01vZGFsUmVmLCBEaWFsb2dCdXR0b24gfSBmcm9tICdAZmFycmlzL3VpLW1vZGFsJztcclxuaW1wb3J0IHsgTWVzc2FnZXJDb25maWcsIE1lc3NhZ2VyRGVmYXVsdENvbmZpZywgTUVTU0FHRVJfREVGQVVMVF9DT05GSUcgfSBmcm9tICcuL21lc3NhZ2VyLmNvbmZpZyc7XHJcbmltcG9ydCB7IE1lc3NhZ2VyQ29tcG9uZW50IH0gZnJvbSAnLi9tZXNzYWdlci5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBMb2NhbGVTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1sb2NhbGUnO1xyXG5pbXBvcnQgeyB1bmVzY2FwZUlkZW50aWZpZXIgfSBmcm9tICdAYW5ndWxhci9jb21waWxlcic7XHJcblxyXG5cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgTWVzc2FnZXJTZXJ2aWNlIHtcclxuICAgIHZlcnNpb24gPSAnMC4wLjE1JztcclxuICAgIGN1cnJlbnRJZCA9IC0xO1xyXG4gICAgbW9kYWxzOiB7IGlkOiBudW1iZXI7IHJlZjogQnNNb2RhbFJlZiB9W10gPSBbXTtcclxuICAgIHByaXZhdGUgZGVmYXVsdE1lc3NhZ2VyQ29uZmlnOiBNZXNzYWdlckNvbmZpZyA9IG51bGw7XHJcblxyXG4gICAgcHJpdmF0ZSBjb25maXJtU3ViamVjdDtcclxuICAgIHByaXZhdGUgbmdab25lOiBOZ1pvbmU7XHJcblxyXG4gICAgcHJpdmF0ZSBsb2NhbGVTZXJ2aWNlOiBMb2NhbGVTZXJ2aWNlO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgYnNNb2RhbFNlcnZpY2U6IEJzTW9kYWxTZXJ2aWNlLCBwcml2YXRlIGluamVjdG9yOiBJbmplY3Rvcikge1xyXG4gICAgICAgIGNvbnN0IGNvbmZpZyA9IHRoaXMuaW5qZWN0b3IuZ2V0KE1FU1NBR0VSX0RFRkFVTFRfQ09ORklHKSB8fCBNZXNzYWdlckRlZmF1bHRDb25maWc7XHJcbiAgICAgICAgdGhpcy5kZWZhdWx0TWVzc2FnZXJDb25maWcgPSBPYmplY3QuYXNzaWduKHt9LCBNZXNzYWdlckRlZmF1bHRDb25maWcsIGNvbmZpZyk7XHJcbiAgICAgICAgdGhpcy5uZ1pvbmUgPSB0aGlzLmluamVjdG9yLmdldChOZ1pvbmUpO1xyXG4gICAgICAgIHRoaXMubG9jYWxlU2VydmljZSA9IHRoaXMuaW5qZWN0b3IuZ2V0KExvY2FsZVNlcnZpY2UpO1xyXG4gICAgfVxyXG4gICAgZ2V0IG9rVGV4dCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKCdtZXNzYWdlci5vaycpO1xyXG4gICAgfVxyXG4gICAgZ2V0IGNhbmNlbFRleHQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZSgnbWVzc2FnZXIuY2FuY2VsJyk7XHJcbiAgICB9XHJcbiAgICBnZXQgeWVzVGV4dCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKCdtZXNzYWdlci55ZXMnKTtcclxuICAgIH1cclxuICAgIGdldCBub1RleHQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZSgnbWVzc2FnZXIubm8nKTtcclxuICAgIH1cclxuICAgIGdldCB0aXRsZVRleHQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZSgnbWVzc2FnZXIudGl0bGUnKTtcclxuICAgIH1cclxuICAgIGdldCBlcnJvclRpdGxlKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmxvY2FsZVNlcnZpY2UuZ2V0VmFsdWUoJ21lc3NhZ2VyLmVycm9yVGl0bGUnKTtcclxuICAgIH1cclxuXHJcbiAgICBlc2NhcGVIdG1sKHN0cikge1xyXG4gICAgICAgIGlmIChzdHIgPT09IG51bGwgfHwgc3RyID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gc3RyXHJcbiAgICAgICAgICAgIC5yZXBsYWNlKC8mL2csICcmYW1wOycpXHJcbiAgICAgICAgICAgIC5yZXBsYWNlKC88L2csICcmbHQ7JylcclxuICAgICAgICAgICAgLnJlcGxhY2UoLz4vZywgJyZndDsnKVxyXG4gICAgICAgICAgICAucmVwbGFjZSgvXFxcIi9nLCAnJnF1b3Q7JylcclxuICAgICAgICAgICAgLnJlcGxhY2UoL1xcJy9nLCAnJiMzOTsnKVxyXG4gICAgICAgICAgICAucmVwbGFjZSgvXFwvL2csICcmI3gyRjsnKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOaYvuekuuS/oeaBr+aPkOekuuahhlxyXG4gICAgICogQHBhcmFtIG1zZ3R5cGUg5raI5oGv57G75YirXHJcbiAgICAgKiBAcGFyYW0gbWVzc2FnZSDmj5DnpLrmtojmga/kuIBcclxuICAgICAqIEBwYXJhbSBvcHRzIOWPguaVsCDmj5DkvpvlsZ7mgKcgZml0Q29udGVudDp0cnVl5pSv5oyB6Ieq5Yqo6YCC5bqU5a695bqmXHJcbiAgICAgKiBAcGFyYW0gc3VibXNnIOaPkOekuua2iOaBr+S6jOe6p1xyXG4gICAgICovXHJcbiAgICBzaG93KG1zZ3R5cGU6IHN0cmluZywgbWVzc2FnZTogc3RyaW5nLCBvcHRzPzoge30sIHN1Ym1zZyA9ICcnKSB7XHJcbiAgICAgICAgaWYgKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQpIHtcclxuICAgICAgICAgICAgKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgYXMgYW55KS5ibHVyKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IG1vZGFsSGVpZ2h0ID0gMTgwO1xyXG4gICAgICAgIGxldCBkZWZhdWx0T3B0cyA9IHtcclxuICAgICAgICAgICAgc2FmZUh0bWw6IHRydWUsXHJcbiAgICAgICAgICAgIHRpdGxlOiB0aGlzLnRpdGxlVGV4dCxcclxuICAgICAgICAgICAgd2lkdGg6IDM5MCxcclxuICAgICAgICAgICAgaGVpZ2h0OiBtb2RhbEhlaWdodCxcclxuICAgICAgICAgICAgc2hvd0J1dHRvbnM6IGZhbHNlLFxyXG4gICAgICAgICAgICBzaG93TWF4QnV0dG9uOiBmYWxzZSxcclxuICAgICAgICAgICAgcmVzaXphYmxlOiBmYWxzZSxcclxuICAgICAgICAgICAgaW5pdGlhbFN0YXRlOiB7XHJcbiAgICAgICAgICAgICAgICBva1RleHQ6IHRoaXMub2tUZXh0LFxyXG4gICAgICAgICAgICAgICAgb2tIYW5kbGU6ICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGNsYXNzOiAnbW9kYWwtbWVzc2FnZSAnICsgKG1zZ3R5cGUgPyAnbW9kYWwtbWVzc2FnZS10eXBlLScgKyBtc2d0eXBlIDogJycpLFxyXG4gICAgICAgICAgICBzaG93SGVhZGVyOiBmYWxzZSxcclxuICAgICAgICB9O1xyXG4gICAgICAgIGRlZmF1bHRPcHRzID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5kZWZhdWx0TWVzc2FnZXJDb25maWcsIGRlZmF1bHRPcHRzKTtcclxuICAgICAgICBsZXQgZXh0ZW5kT3B0cyA9IHt9O1xyXG5cclxuICAgICAgICBzd2l0Y2ggKG1zZ3R5cGUpIHtcclxuICAgICAgICAgICAgY2FzZSAncHJvbXB0JzpcclxuICAgICAgICAgICAgICAgIC8vIOW8ueWHuuWvueivneexu+Wei1xyXG4gICAgICAgICAgICAgICAgZXh0ZW5kT3B0cyA9IHsgc2hvd0hlYWRlcjogdHJ1ZSwgbW9kYWxIZWlnaHQ6IDI2MCB9O1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ2Vycm9yJzpcclxuICAgICAgICAgICAgICAgIC8vIOmUmeivr1xyXG4gICAgICAgICAgICAgICAgZXh0ZW5kT3B0cyA9IHsgdGl0bGU6IHRoaXMuZXJyb3JUaXRsZSwgd2lkdGg6IDQ0Niwgc2hvd0hlYWRlcjogdHJ1ZSwgc2hvd01heEJ1dHRvbjogdHJ1ZSwgZml0Q29udGVudDogdHJ1ZSB9O1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ2V4Y2VwdGlvbic6XHJcbiAgICAgICAgICAgICAgICBleHRlbmRPcHRzID0geyBzYWZlSHRtbDogZmFsc2UsIHRpdGxlOiB0aGlzLmVycm9yVGl0bGUsIHdpZHRoOiA0NDYsIHNob3dIZWFkZXI6IHRydWUsIGZpdENvbnRlbnQ6IHRydWUgfTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgLy8g6buY6K6k5YW25LuWXHJcbiAgICAgICAgICAgICAgICBleHRlbmRPcHRzID0geyB3aWR0aDogc3VibXNnID8gNDQ2IDogMzkwLCBmaXRDb250ZW50OiB0cnVlIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIE9iamVjdC5hc3NpZ24oZGVmYXVsdE9wdHMsIGV4dGVuZE9wdHMpO1xyXG4gICAgICAgIGlmIChvcHRzKSB7XHJcbiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oZGVmYXVsdE9wdHMsIG9wdHMpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKG1lc3NhZ2UgJiYgZGVmYXVsdE9wdHMuc2FmZUh0bWwpIHtcclxuICAgICAgICAgICAgbWVzc2FnZSA9IHRoaXMuZXNjYXBlSHRtbChtZXNzYWdlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIE9iamVjdC5hc3NpZ24oZGVmYXVsdE9wdHMuaW5pdGlhbFN0YXRlLCB7XHJcbiAgICAgICAgICAgIHR5cGU6IG1zZ3R5cGUsXHJcbiAgICAgICAgICAgIG1lc3NhZ2UsXHJcbiAgICAgICAgICAgIG1zZzogc3VibXNnLFxyXG4gICAgICAgICAgICBleGNlcHRpb246IG9wdHMgJiYgb3B0c1snZXhjZXB0aW9uJ10gPyBvcHRzWydleGNlcHRpb24nXSA6IG51bGwsXHJcbiAgICAgICAgICAgIHNob3dMaW5lczogb3B0cyAmJiBvcHRzWydzaG93TGluZXMnXSA/IG9wdHNbJ3Nob3dMaW5lcyddIDogMyxcclxuICAgICAgICAgICAgcmVhZG9ubHk6IG9wdHMgJiYgb3B0c1sncmVhZG9ubHknXSA/IG9wdHNbJ3JlYWRvbmx5J10gOiBmYWxzZVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpZiAoZGVmYXVsdE9wdHNbJ2J1dHRvbnMnXSAmJiBkZWZhdWx0T3B0c1snYnV0dG9ucyddLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBpZiAoIWRlZmF1bHRPcHRzLmluaXRpYWxTdGF0ZVsnYnV0dG9ucyddIHx8ICFkZWZhdWx0T3B0cy5pbml0aWFsU3RhdGVbJ2J1dHRvbnMnXS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIGRlZmF1bHRPcHRzLmluaXRpYWxTdGF0ZVsnYnV0dG9ucyddID0gZGVmYXVsdE9wdHNbJ2J1dHRvbnMnXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBfbW9kYWwgPSB0aGlzLmJzTW9kYWxTZXJ2aWNlLnNob3coTWVzc2FnZXJDb21wb25lbnQsIGRlZmF1bHRPcHRzKTtcclxuICAgICAgICAvLyBfbW9kYWwuY29udGVudC5idXR0b25zID0gZGVmYXVsdE9wdHNbJ2J1dHRvbnMnXSB8fCBbXTtcclxuICAgICAgICB0aGlzLmNvbmZpcm1TdWJqZWN0ID0gbmV3IFN1YmplY3Q8Ym9vbGVhbj4oKTtcclxuICAgICAgICBpZiAodGhpcy5tb2RhbHMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBjb25zdCBtb2RhbENvbnRhaW5lckNvbXBvbmVudCA9IF9tb2RhbC5kaWFsb2c7XHJcbiAgICAgICAgICAgIG1vZGFsQ29udGFpbmVyQ29tcG9uZW50Lmluc3RhbmNlLmlzU2hvd24gPSB0cnVlO1xyXG4gICAgICAgICAgICBtb2RhbENvbnRhaW5lckNvbXBvbmVudC5pbnN0YW5jZS5tb3ZlVG8oXHJcbiAgICAgICAgICAgICAgICAxNSAqIHRoaXMubW9kYWxzLmxlbmd0aCxcclxuICAgICAgICAgICAgICAgIDE1ICogdGhpcy5tb2RhbHMubGVuZ3RoXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XHJcbiAgICAgICAgICAgIC8vIOesrDHkuKrmjInpkq7ojrflj5bnhKbngrlcclxuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBidG5PayA9IF9tb2RhbC5jb250ZW50LmJ0bk9rRWwgPyBfbW9kYWwuY29udGVudC5idG5Pa0VsLm5hdGl2ZUVsZW1lbnQgOiBudWxsO1xyXG4gICAgICAgICAgICAgICAgaWYgKGJ0bk9rKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYnRuT2tbJ2ZvY3VzJ10oKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYnRucyA9IF9tb2RhbC5kaWFsb2cubG9jYXRpb24ubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKCcubW9kYWwtZm9vdGVyIGJ1dHRvbicpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChidG5zLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBidG5zLml0ZW0oMClbJ2ZvY3VzJ10oKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLm1zZ01ncihfbW9kYWwpO1xyXG4gICAgICAgIHJldHVybiBfbW9kYWw7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBtc2dNZ3IocmVmOiBCc01vZGFsUmVmKSB7XHJcbiAgICAgICAgY29uc3QgaWQgPSB0aGlzLmJzTW9kYWxTZXJ2aWNlLmdldE1vZGFsc0NvdW50KCkgKyAxMDAwO1xyXG4gICAgICAgIGlmICh0aGlzLm1vZGFscy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgdGhpcy5tb2RhbHMucHVzaCh7IGlkLCByZWYgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLmdldE1vZGFsQnlJZChpZCkpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubW9kYWxzLnB1c2goeyBpZCwgcmVmIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5nZXRNb2RhbEJ5SWQoaWQpLnJlZiA9IHJlZjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgY21wID0gdGhpcy5nZXRNb2RhbENtcCgpO1xyXG5cclxuICAgICAgICBjbXAuY2xvc2VkLnN1YnNjcmliZSgobGV2ZWw6IG51bWJlcikgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnJlbW92ZU1lc3NhZ2VyKGlkKTtcclxuICAgICAgICAgICAgdGhpcy5jb25maXJtU3ViamVjdC51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLmN1cnJlbnRJZCA9IGlkO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBxdWVzdGlvbihtZXNzYWdlOiBzdHJpbmcsIG9rQ2FsbGJhY2s6ICgpID0+IHZvaWQsIGNhbmNlbENhbGxiYWNrPzogKCkgPT4gdm9pZCwgbXNnPzogc3RyaW5nLCBmaXRDb250ZW50ID0gdHJ1ZSkge1xyXG4gICAgICAgIGNvbnN0IHF1ZXN0aW9uRGxnID0gdGhpcy5zaG93KCdxdWVzdGlvbicsIG1lc3NhZ2UsIHtcclxuICAgICAgICAgICAgaW5pdGlhbFN0YXRlOiB7XHJcbiAgICAgICAgICAgICAgICBva1RleHQ6IHRoaXMueWVzVGV4dCxcclxuICAgICAgICAgICAgICAgIG9rSGFuZGxlOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcXVlc3Rpb25EbGcuY2xvc2UoKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAob2tDYWxsYmFjaykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBva0NhbGxiYWNrKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGNhbmNlbFRleHQ6IHRoaXMubm9UZXh0LFxyXG4gICAgICAgICAgICAgICAgY2FuY2VsSGFuZGxlOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcXVlc3Rpb25EbGcuY2xvc2UoKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY2FuY2VsQ2FsbGJhY2spIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FuY2VsQ2FsbGJhY2soKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGZpdENvbnRlbnRcclxuICAgICAgICB9LCBtc2cpO1xyXG4gICAgICAgIHJldHVybiBxdWVzdGlvbkRsZztcclxuICAgIH1cclxuXHJcbiAgICBxdWVzdGlvbjIobWVzc2FnZXI6IHN0cmluZywgYnRuczogRGlhbG9nQnV0dG9uW10sIG1zZz86IHN0cmluZywgZml0Q29udGVudCA9IHRydWUpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5zaG93KCdxdWVzdGlvbicsIG1lc3NhZ2VyLCB7XHJcbiAgICAgICAgICAgIGluaXRpYWxTdGF0ZToge1xyXG4gICAgICAgICAgICAgICAgYnV0dG9uczogYnRuc1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBmaXRDb250ZW50XHJcbiAgICAgICAgfSwgbXNnKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogMjAyMOW5tDPmnIg35pel5Zug5Li6dGV4dGFyZWHpq5jluqblnKjkuI3lkIzmtY/op4jlmajkuIvkuI3kuIDmoLfvvIzlm7rlrprpq5jluqblj6/og73kvJrlh7rnjrDmu5rliqjmnaFcclxuICAgICAqIEBwYXJhbSB0aXRsZSDmoIfpophcclxuICAgICAqIEBwYXJhbSBtc2cg5L+h5oGvXHJcbiAgICAgKiBAcGFyYW0gZml0Q29udGVudCDoh6rpgILlupTlhoXlrrlcclxuICAgICAqL1xyXG4gICAgcHJvbXB0KHRpdGxlOiBzdHJpbmcsIG1zZz86IHN0cmluZywgZml0Q29udGVudCA9IHRydWUpIHtcclxuICAgICAgICBjb25zdCBwcm9tcHRTdWJqZWN0ID0gbmV3IFN1YmplY3QoKTtcclxuICAgICAgICBjb25zdCBkbGcgPSB0aGlzLnNob3coJ3Byb21wdCcsIG1zZywge1xyXG4gICAgICAgICAgICB0aXRsZSxcclxuICAgICAgICAgICAgaW5pdGlhbFN0YXRlOiB7XHJcbiAgICAgICAgICAgICAgICBva1RleHQ6IHRoaXMub2tUZXh0LFxyXG4gICAgICAgICAgICAgICAgb2tIYW5kbGU6ICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBtYyA9IGRsZy5jb250ZW50IGFzIE1lc3NhZ2VyQ29tcG9uZW50O1xyXG4gICAgICAgICAgICAgICAgICAgIGRsZy5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHByb21wdFN1YmplY3QubmV4dChtYy5wcm9tcHRUZXh0Lm5hdGl2ZUVsZW1lbnQudmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGNhbmNlbFRleHQ6IHRoaXMuY2FuY2VsVGV4dCxcclxuICAgICAgICAgICAgICAgIGNhbmNlbEhhbmRsZTogKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGRsZy5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHByb21wdFN1YmplY3QubmV4dChmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGZpdENvbnRlbnQsXHJcbiAgICAgICAgICAgIGNsb3NlZDogKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcHJvbXB0U3ViamVjdC51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSwgbXNnKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHByb21wdFN1YmplY3Q7XHJcbiAgICB9XHJcblxyXG4gICAgcHJvbXB0Mih0aXRsZTogc3RyaW5nLCBtc2c/OiBzdHJpbmcsIG9wdHM/OiBhbnkpIHtcclxuICAgICAgICBjb25zdCBwcm9tcHRTdWJqZWN0ID0gbmV3IFN1YmplY3QoKTtcclxuXHJcbiAgICAgICAgY29uc3QgX29wdHMgPSB7XHJcbiAgICAgICAgICAgIHNob3dPa0J1dHRvbjogdHJ1ZSxcclxuICAgICAgICAgICAgc2hvd0Nsb3NlQnV0dG9uOiB0cnVlLFxyXG4gICAgICAgICAgICBzaG93Rm9udFNpemU6IGZhbHNlLFxyXG4gICAgICAgICAgICBmb250U2l6ZTogMTgsXHJcbiAgICAgICAgICAgIHJlYWRvbmx5OiBmYWxzZSxcclxuICAgICAgICAgICAgc2F2ZVNpemU6IGZhbHNlLFxyXG4gICAgICAgICAgICBjbG9zZVdoZW5ldmVyOiB0cnVlXHJcbiAgICAgICAgfTtcclxuICAgICAgICBpZiAoIW9wdHMpIHtcclxuICAgICAgICAgICAgb3B0cyA9IF9vcHRzO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIG9wdHMgPSBPYmplY3QuYXNzaWduKF9vcHRzLCBvcHRzKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IF9kaWFsb2dPcHRzID0ge1xyXG4gICAgICAgICAgICB0aXRsZSxcclxuICAgICAgICAgICAgaW5pdGlhbFN0YXRlOiB7XHJcbiAgICAgICAgICAgICAgICBzaG93T2tCdXR0b246IG9wdHMuc2hvd09rQnV0dG9uID09PSB1bmRlZmluZWQgPyB0cnVlIDogb3B0cy5zaG93T2tCdXR0b24sXHJcbiAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBvcHRzLnNob3dDYW5jZWxCdXR0b24gPT09IHVuZGVmaW5lZCA/IHRydWUgOiBvcHRzLnNob3dDYW5jZWxCdXR0b24sXHJcbiAgICAgICAgICAgICAgICBva1RleHQ6IHRoaXMub2tUZXh0LFxyXG4gICAgICAgICAgICAgICAgb2tIYW5kbGU6ICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBtYyA9IGRsZy5jb250ZW50IGFzIE1lc3NhZ2VyQ29tcG9uZW50O1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbCA9IG1jLnByb21wdFRleHQubmF0aXZlRWxlbWVudC52YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAob3B0cy5jbG9zZVdoZW5ldmVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRsZy5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9tcHRTdWJqZWN0Lm5leHQodmFsKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9tcHRTdWJqZWN0Lm5leHQoe3ZhbCwgZGxnIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBjYW5jZWxUZXh0OiB0aGlzLmNhbmNlbFRleHQsXHJcbiAgICAgICAgICAgICAgICBjYW5jZWxIYW5kbGU6ICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBkbGcuY2xvc2UoKTtcclxuICAgICAgICAgICAgICAgICAgICBwcm9tcHRTdWJqZWN0Lm5leHQoZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHNob3dGb250U2l6ZTogb3B0cy5zaG93Rm9udFNpemUsXHJcbiAgICAgICAgICAgICAgICBmb250U2l6ZTogb3B0cy5mb250U2l6ZSB8fCAxOCxcclxuICAgICAgICAgICAgICAgIGVuYWJsZVdvcmRDb3VudDogISFvcHRzLmVuYWJsZVdvcmRDb3VudCxcclxuICAgICAgICAgICAgICAgIGNvdW50VHlwZTogb3B0cy5jb3VudFR5cGUgfHwgJ2xlbmd0aCcsXHJcbiAgICAgICAgICAgICAgICBtYXhMZW5ndGg6IG9wdHMubWF4TGVuZ3RoLFxyXG4gICAgICAgICAgICAgICAgaW5wdXRUeXBlOiBvcHRzLmlucHV0VHlwZSB8fCAndGV4dGFyZWEnLFxyXG4gICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI6IG9wdHMucGxhY2Vob2xkZXIgfHwgJydcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgZml0Q29udGVudDogZmFsc2UsXHJcbiAgICAgICAgICAgIHNob3dNYXhCdXR0b246IHRydWUsXHJcbiAgICAgICAgICAgIHJlc2l6YWJsZTogdHJ1ZSxcclxuICAgICAgICAgICAgY2xhc3M6ICcnLFxyXG4gICAgICAgICAgICBjbG9zZWQ6ICgpID0+IHtcclxuICAgICAgICAgICAgICAgIHByb21wdFN1YmplY3QudW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgb3BlbmVkOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAob3B0cy5pbnB1dFR5cGUgIT09ICd0ZXh0YXJlYScpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0ZXh0YXJlYUVsZSA9IGRsZy5jb250ZW50LnByb21wdFRleHQubmF0aXZlRWxlbWVudDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dGFyZWFFbGUuY2xvc2VzdCgnc2VjdGlvbicpLnN0eWxlLnBhZGRpbmcgPSAnMTVweCc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHRhcmVhRWxlLnN0eWxlLnJlc2l6ZSA9ICdub25lJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dGFyZWFFbGUuc3R5bGUuaGVpZ2h0ID0gJzEwMCUnO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wdHMucmVhZG9ubHkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHRhcmVhRWxlLnJlYWRPbmx5ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBiZWZvcmVDbG9zZTogKG1vZGFsUmVmOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChvcHRzLnNhdmVTaXplICYmICFkbGcuZGlhbG9nLmluc3RhbmNlLmlzTWF4KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IHsgZm9udFNpemU6IGRsZy5jb250ZW50LmZvbnRTaXplLCB3aWR0aDogbW9kYWxSZWYuY29uZmlnLndpZHRoLCBoZWlnaHQ6IG1vZGFsUmVmLmNvbmZpZy5oZWlnaHQgfTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNhdmVUZXh0QXJlYVNpemVJbmZvKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICBsZXQgZGlhbG9nT3B0cyA9IF9kaWFsb2dPcHRzO1xyXG4gICAgICAgIGlmIChvcHRzKSB7XHJcbiAgICAgICAgICAgIGRpYWxvZ09wdHMgPSBPYmplY3QuYXNzaWduKGRpYWxvZ09wdHMsIG9wdHMpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgZGxnID0gdGhpcy5zaG93KCdwcm9tcHQnLCBtc2csIGRpYWxvZ09wdHMsIG1zZyk7XHJcblxyXG4gICAgICAgIGlmIChvcHRzLmlucHV0VHlwZSAmJiAgZGxnLmNvbnRlbnQucHJvbXB0VGV4dCkge1xyXG4gICAgICAgICAgICBkbGcuY29udGVudC5wcm9tcHRUZXh0Lm5hdGl2ZUVsZW1lbnQuZm9jdXMoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBwcm9tcHRTdWJqZWN0O1xyXG4gICAgfVxyXG5cclxuICAgIGdldEtleVN0cmluZygpIHtcclxuICAgICAgICAvLyDkuIDlj7Dnu4jnq6/lhbHnlKjkuIDkuKrphY3nva5cclxuICAgICAgICAvLyDkv53nlZnmnIDlkI7kuIDmrKHnmoTorr7nva7vvIxcclxuICAgICAgICAvLyDkv53lrZjnqpflj6PlpKflsI/vvIzlrZfkvZPlpKflsI9cclxuICAgICAgICByZXR1cm4gJ0lHSVgtRkFSUklTLVVJLVRFWFRBUkVBLVpPT00tU0VUVElOR1MnO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2F2ZVRleHRBcmVhU2l6ZUluZm8oZGF0YSkge1xyXG4gICAgICAgIGlmICh3aW5kb3cubG9jYWxTdG9yYWdlKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGtleSA9IHRoaXMuZ2V0S2V5U3RyaW5nKCk7XHJcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGtleSwgSlNPTi5zdHJpbmdpZnkoZGF0YSkpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjb25maXJtKG1lc3NhZ2U6IHN0cmluZywgbXNnPzogc3RyaW5nLCBmaXRDb250ZW50ID0gdHJ1ZSk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICAgICAgY29uc3QgY29uZmlybVN1YmplY3QgPSBuZXcgU3ViamVjdCgpO1xyXG4gICAgICAgIGNvbnN0IGNvbmZpcm1EbGcgPSB0aGlzLnNob3coJ3F1ZXN0aW9uJywgbWVzc2FnZSwge1xyXG4gICAgICAgICAgICBpbml0aWFsU3RhdGU6IHtcclxuICAgICAgICAgICAgICAgIG9rVGV4dDogdGhpcy5va1RleHQsXHJcbiAgICAgICAgICAgICAgICBva0hhbmRsZTogKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpcm1EbGcuY2xvc2UoKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25maXJtU3ViamVjdC5uZXh0KHRydWUpO1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGNhbmNlbFRleHQ6IHRoaXMuY2FuY2VsVGV4dCxcclxuICAgICAgICAgICAgICAgIGNhbmNlbEhhbmRsZTogKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpcm1EbGcuY2xvc2UoKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25maXJtU3ViamVjdC5uZXh0KGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgZml0Q29udGVudCxcclxuICAgICAgICAgICAgY2xvc2VkOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25maXJtU3ViamVjdC51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSwgbXNnKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGNvbmZpcm1TdWJqZWN0LmFzT2JzZXJ2YWJsZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIGluZm8obWVzc2FnZTogc3RyaW5nLCBjYWxsYmFjaz86ICgpID0+IHZvaWQsIG1zZz86IHN0cmluZywgZml0Q29udGVudCA9IHRydWUpIHtcclxuICAgICAgICBjb25zdCBpbmZvRGxnID0gdGhpcy5zaG93KCdpbmZvJywgbWVzc2FnZSwge1xyXG4gICAgICAgICAgICBpbml0aWFsU3RhdGU6IHtcclxuICAgICAgICAgICAgICAgIG9rVGV4dDogdGhpcy5va1RleHQsXHJcbiAgICAgICAgICAgICAgICBva0hhbmRsZTogKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGluZm9EbGcuY2xvc2UoKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGZpdENvbnRlbnRcclxuICAgICAgICB9LCBtc2cpO1xyXG4gICAgICAgIHJldHVybiBpbmZvRGxnO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICAvKiog5pON5L2c5oiQ5Yqf5o+Q56S677yMXHJcbiAgICAgKiBtZXNzYWdlOiDmj5DnpLrkv6Hmga9cclxuICAgICAqIG1zZzogMue6p+S/oeaBr1xyXG4gICAgICogZml0Q291bnRlbnQ6IOm7mOiupOS4unRydWVcclxuICAgICAqIGNhbGxiYWNrOiDnoa7lrprkuovku7blm57osINcclxuICAgICAqL1xyXG4gICAgc3VjY2VzcyhtZXNzYWdlOiBzdHJpbmcsIG1zZz86IHN0cmluZywgZml0Q29udGVudCA9IHRydWUsIGNhbGxiYWNrOiAoKSA9PiB2b2lkID0gbnVsbCkge1xyXG4gICAgICAgIGNvbnN0IHN1Y2Nlc3NEbGcgPSB0aGlzLnNob3coJ3N1Y2Nlc3MnLCBtZXNzYWdlLCB7XHJcbiAgICAgICAgICAgIGluaXRpYWxTdGF0ZToge1xyXG4gICAgICAgICAgICAgICAgb2tUZXh0OiB0aGlzLm9rVGV4dCxcclxuICAgICAgICAgICAgICAgIG9rSGFuZGxlOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3VjY2Vzc0RsZy5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgZml0Q29udGVudFxyXG4gICAgICAgIH0sIG1zZyk7XHJcblxyXG4gICAgICAgIHJldHVybiBzdWNjZXNzRGxnO1xyXG4gICAgfVxyXG4gICAgLyoqIOaPkOekuumUmeivr+S/oeaBr++8jFxyXG4gICAgICogbWVzc2FnZTog5o+Q56S65L+h5oGvXHJcbiAgICAgKiBtc2c6IDLnuqfkv6Hmga9cclxuICAgICAqIGZpdENvdW50ZW50OiDpu5jorqTkuLp0cnVlXHJcbiAgICAgKiBjYWxsYmFjazog56Gu5a6a5LqL5Lu25Zue6LCDXHJcbiAgICAgKi9cclxuICAgIGVycm9yKG1lc3NhZ2U6IHN0cmluZywgbXNnPzogc3RyaW5nLCBmaXRDb250ZW50ID0gdHJ1ZSwgY2FsbGJhY2s6ICgpID0+IHZvaWQgPSBudWxsLCBzYWZlSHRtbCA9IHRydWUpIHtcclxuICAgICAgICBjb25zdCBlcnJvckRsZyA9IHRoaXMuc2hvdygnZXJyb3InLCBtZXNzYWdlLCB7XHJcbiAgICAgICAgICAgIHNhZmVIdG1sLFxyXG4gICAgICAgICAgICBpbml0aWFsU3RhdGU6IHtcclxuICAgICAgICAgICAgICAgIG9rVGV4dDogdGhpcy5va1RleHQsXHJcbiAgICAgICAgICAgICAgICBva0hhbmRsZTogKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGVycm9yRGxnLmNsb3NlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBmaXRDb250ZW50XHJcbiAgICAgICAgfSwgbXNnKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGVycm9yRGxnO1xyXG4gICAgfVxyXG5cclxuICAgIHdhcm5pbmcobWVzc2FnZTogc3RyaW5nLCBtc2c/OiBzdHJpbmcsIGZpdENvbnRlbnQgPSB0cnVlLCBjYWxsYmFjazogKCkgPT4gdm9pZCA9IG51bGwpIHtcclxuICAgICAgICBjb25zdCB3YXJuaW5nRGxnID0gdGhpcy5zaG93KCd3YXJuaW5nJywgbWVzc2FnZSwge1xyXG4gICAgICAgICAgICBpbml0aWFsU3RhdGU6IHtcclxuICAgICAgICAgICAgICAgIG9rVGV4dDogdGhpcy5va1RleHQsXHJcbiAgICAgICAgICAgICAgICBva0hhbmRsZTogKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHdhcm5pbmdEbGcuY2xvc2UoKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGZpdENvbnRlbnRcclxuICAgICAgICB9LCBtc2cpO1xyXG4gICAgICAgIHJldHVybiB3YXJuaW5nRGxnO1xyXG4gICAgfVxyXG5cclxuICAgIHNob3dIdG1sTXNnKHR5cGU6ICd3YXJuaW5nJ3wgJ2luZm8nfCdlcnJvcid8J3N1Y2Nlc3MnLCB0aXRsZTogc3RyaW5nLCBtZXNzYWdlPzogc3RyaW5nLCBjYWxsYmFjazooKSA9PiB2b2lkID0gbnVsbCkge1xyXG4gICAgICAgIGNvbnN0IG1zZ0RsZyA9IHRoaXMuc2hvdyh0eXBlLCB0aXRsZSwge1xyXG4gICAgICAgICAgICBzYWZlSHRtbDogZmFsc2UsXHJcbiAgICAgICAgICAgIGluaXRpYWxTdGF0ZToge1xyXG4gICAgICAgICAgICAgICAgb2tUZXh0OiB0aGlzLm9rVGV4dCxcclxuICAgICAgICAgICAgICAgIG9rSGFuZGxlOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbXNnRGxnLmNsb3NlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBmaXRDb250ZW50OiB0cnVlXHJcbiAgICAgICAgfSwgbWVzc2FnZSk7XHJcbiAgICAgICAgcmV0dXJuIG1zZ0RsZztcclxuICAgIH1cclxuXHJcblxyXG4gICAgcHJpdmF0ZSBjbG9zZSgpIHtcclxuICAgICAgICBpZiAodGhpcy5tb2RhbHMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1zZ2JveCA9IHRoaXMuZ2V0TW9kYWxCeUlkKHRoaXMuY3VycmVudElkKTtcclxuICAgICAgICAgICAgaWYgKG1zZ2JveCkge1xyXG4gICAgICAgICAgICAgICAgbXNnYm94LnJlZi5jbG9zZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0TW9kYWxCeUlkKGlkOiBudW1iZXIpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5tb2RhbHMuZmluZChpdGVtID0+IGl0ZW0uaWQgPT09IGlkKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldE1vZGFsQ21wKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmJzTW9kYWxTZXJ2aWNlLmdldEN1cnJlbnRNb2RhbENvbnRhaW5lcigpLmluc3RhbmNlO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgcmVtb3ZlTWVzc2FnZXIoaWQpIHtcclxuICAgICAgICB0aGlzLm1vZGFscyA9IHRoaXMubW9kYWxzLmZpbHRlcihuID0+IG4uaWQgIT09IGlkKTtcclxuICAgICAgICBpZiAoIXRoaXMubW9kYWxzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRJZCA9IC0xO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuY3VycmVudElkID0gdGhpcy5tb2RhbHNbdGhpcy5tb2RhbHMubGVuZ3RoIC0gMV0uaWQ7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiJdfQ==