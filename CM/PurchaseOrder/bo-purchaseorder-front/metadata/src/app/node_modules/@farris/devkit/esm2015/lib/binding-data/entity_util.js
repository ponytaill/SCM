import { PARENT_CLASS, FieldMetadataUtil } from '../entity/index';
import { ModifyType } from '../changeset/index';
import { ChangeType } from './changes';
import { BindingPropertyType } from './binding_property';
import { BindingObjectFactory } from './binding_object_factory';
import { Form } from '../form/index';
import { takeUntil } from 'rxjs/operators';
/**
 * 实体操作工具类
 */
class EntityUtil {
    /**
     * 将entity的数据加载到bindingObject中，并保持两者同步。
     * @param entity        实体对象
     * @param bindingObject 绑定对象
     */
    static loadEntity(entity, bindingObject) {
        // 遍历bindingObject的properties进行赋值
        bindingObject.properties.forEach((property) => {
            const propertyName = property.name;
            if (property.type === BindingPropertyType.List) {
                this.loadEntityList(entity[propertyName] || entity[PARENT_CLASS], bindingObject[propertyName]);
            }
            else if (property.type === BindingPropertyType.Object) {
                if (entity && entity[propertyName] && this.isEffectiveField(entity, propertyName)) {
                    this.loadEntity(entity[propertyName], bindingObject[propertyName]);
                }
            }
            else if (property.type === BindingPropertyType.Dynamic) {
                if (entity && entity[propertyName]) {
                    const dynamicObject = BindingObjectFactory.createDynamicBindingObject(entity[propertyName].data);
                    BindingObjectFactory.attachDynamicObjectProperty(bindingObject, propertyName, dynamicObject);
                    this.loadEntity(entity[propertyName], bindingObject[propertyName]);
                }
            }
            else {
                if (this.isEffectiveField(entity, propertyName)) {
                    const value = entity[propertyName];
                    bindingObject.setValue(propertyName, value, false, false);
                }
            }
        });
        this.setUpEntityPipeline(entity, bindingObject);
    }
    /**
     * 建立entity和bindingObject之间的关联
     * @param entity        实体对象
     * @param bindingObject 绑定对象
     */
    static setUpEntityPipeline(entity, bindingObject) {
        if (!entity || !bindingObject) {
            return;
        }
        // 监听entity变更
        entity.onValueChanged.pipe(takeUntil(entity.unsubscribe)).subscribe((modification) => {
            if (modification.type !== ModifyType.ValueChange || modification.path.length === 0) {
                return;
            }
            const propertyName = modification.path[modification.path.length - 1];
            const primaryKeyPath = modification.path[modification.path.length - 2];
            // 验证主键是否匹配
            // 存在主键并且主键不是id时才检查（值对象、关联对象不检查）
            if (bindingObject.primaryKey && bindingObject.primaryKey === 'id') {
                const primaryKey = bindingObject.primaryKey;
                const primaryKeyValue = bindingObject.getValue(primaryKey);
                if (primaryKeyPath !== `${primaryKey}:${primaryKeyValue}`) {
                    return;
                }
            }
            // TODO:修复动态列不触发变更的问题，临时方案，应该有单独的dynamicBindingObject类
            if (modification.dynamic) {
                if (bindingObject['__original__']) {
                    return;
                }
                const value = modification.value;
                const target = bindingObject[propertyName];
                if (!target) {
                    return;
                }
                Object.keys(value).forEach((key) => {
                    if (target.getValue(key) === value[key]) {
                        return;
                    }
                    target.setValue(key, value[key], true, false);
                });
            }
            else {
                // 值没有发生变化，不再设置
                // TODO: 通过bindingObject修改entity属性值时，entity总会触发一个变更回来，如果不截获这个重复的变更，会导致重复或死循环
                if (bindingObject.getValue(propertyName) === modification.value) {
                    return;
                }
                bindingObject.setValue(propertyName, modification.value, true, false, modification.errors);
            }
        });
        // 监听bindingObject变更
        bindingObject.viewChanges.pipe(takeUntil(bindingObject.unsubscribe)).subscribe((viewChange) => {
            const value = viewChange.value;
            const propertyName = viewChange.path[0];
            let pathPrefix = '';
            const pathData = entity.getPaths();
            const paths = pathData.path;
            let id = bindingObject['id'];
            bindingObject['__original__'] = true;
            // if (pathData.isUdt) {
            // grid中udt没有id，从父级中取出id，以便存放验证信息
            const getParentId = (target) => {
                let parentId = '';
                const findId = (item) => {
                    if (item && item && item['id']) {
                        parentId = item['id'];
                        return;
                    }
                    else if (item['parent']) {
                        findId(item['parent']);
                    }
                };
                findId(target);
                return parentId;
            };
            id = getParentId(bindingObject);
            // if (pathData.isGrid) {
            //   // grid 将从表主字段去除
            //   paths.pop();
            // }
            if (paths.length) {
                pathPrefix = paths.join('.') + '.';
            }
            // }
            const controlProp = pathPrefix + propertyName;
            // 调用实体验证，并将错误信息合并到formControl上
            const entityValidate = (callback) => {
                const enableValidate = Object.values(Form.insMap).find(item => item && item.enableValidate);
                if (!enableValidate) {
                    if (typeof callback === 'function') {
                        callback(null);
                    }
                    return;
                }
                entity.validateFromUtilSync(propertyName, value, result => {
                    const errorObj = {};
                    if (result.errors && result.errors.length > 0) {
                        result.errors.forEach((error) => {
                            if (error.constraints) {
                                Object.keys(error.constraints).forEach(key => {
                                    errorObj[key] = {
                                        value: value,
                                        name: error.constraints[key],
                                        error: error
                                    };
                                });
                            }
                        });
                    }
                    // 先设置实体验证信息，再设置form验证信息，然后在form.isFormValid内部整合实体验证form验证信息
                    Form.updateErrors(controlProp, errorObj, id, value, pathData.isGrid);
                    const formErrors = viewChange['errors'] || {};
                    const mergedErrors = Object.assign({}, formErrors, errorObj);
                    let validateError = null;
                    if (Object.keys(mergedErrors).length > 0) {
                        validateError = { [propertyName]: mergedErrors };
                    }
                    if (typeof (callback) === 'function') {
                        callback(validateError);
                    }
                }, viewChange.context);
            };
            // 不是主键值字段时，要先检查主键是否存在，并且主键是否相等（防止后代变更冒泡上来）
            // 非主键属性变更时，要先检查主键是否匹配（如果主键也修改了，要求先修改主键再修改其他值）
            if (bindingObject.primaryKey) {
                const primaryKey = bindingObject.primaryKey;
                if (propertyName !== primaryKey) {
                    if (!entity[primaryKey] || entity[primaryKey] !== bindingObject[primaryKey]) {
                        entityValidate();
                        return;
                    }
                }
                else if (entity[propertyName] !== value) {
                    // todo: 因异步校验未结束实体主键没有被赋值，导致实体其他属性无法赋值，待后续前端校验重构时去掉
                    entity[propertyName] = value;
                    entityValidate();
                    return;
                }
            }
            // 如果BindingObject上的属性值和Entity上对应属性值一样，则不再设置
            if (entity[propertyName] === value) {
                entityValidate();
                return;
            }
            // 调用表单验证,通过后调用实体验证
            // bingdingObject变化后，先调用实体上的验证，通过后再设置实体的变动
            entityValidate((errors) => {
                entity.errors = errors;
                entity[propertyName] = value;
            });
        });
    }
    /**
     * 将entityList中的Entity对象转换为BindingObject对象，加载到bindingList中，并保持entityList和bindingList同步。
     * @param entityList  实体列表
     * @param bindingList 绑定列表
     */
    static loadEntityList(entityList, bindingList) {
        this.loadEntities(entityList.items, bindingList);
        this.setUpEntityListPipeline(entityList, bindingList);
    }
    /**
     * 建立entityList和bindingList之间的关联
     * @param entityList  实体列表
     * @param bindingList 绑定列表
     */
    static setUpEntityListPipeline(entityList, bindingList) {
        entityList.onListChanged.subscribe((modification) => {
            const target = modification['target'];
            if (target && target !== entityList) {
                return;
            }
            switch (modification.type) {
                // 添加实体
                case ModifyType.Add:
                case ModifyType.Clone:
                    {
                        const entitiesToAdd = modification.value;
                        if (entitiesToAdd.length === 0) {
                            return;
                        }
                        // 检查父id是否一致，冒泡导致的变更不处理
                        const paths = modification.path;
                        const parentPath = paths[paths.length - 2];
                        const parentId = bindingList.parent.primaryKeyValue;
                        if (parentPath.indexOf(parentId) === -1) {
                            return;
                        }
                        this.appendEntities(modification.value, bindingList, modification.type === ModifyType.Clone);
                    }
                    break;
                case ModifyType.Insert:
                    {
                        // 检查父id是否一致，冒泡导致的变更不处理
                        const paths = modification.path;
                        const parentPath = paths[paths.length - 2];
                        const parentId = bindingList.parent.primaryKeyValue;
                        const position = modification.position;
                        if (parentPath.indexOf(parentId) === -1) {
                            return;
                        }
                        this.insertEntity(modification.value[0], bindingList, position);
                    }
                    break;
                // 删除实体
                case ModifyType.Remove:
                    {
                        // 检查父id是否一致，冒泡导致的变更不处理
                        const paths = modification.path;
                        const parentPath = paths[paths.length - 2];
                        const parentId = bindingList.parent.primaryKeyValue;
                        if (parentPath.indexOf(parentId) === -1) {
                            return;
                        }
                        // 删除实体（value格式待商榷，目前value的格式为 { primaryKey: primaryValue}）
                        const id = modification.value[bindingList.primaryKey];
                        bindingList.removeByIds([id]);
                        // this.removeEntities(<Entity[]>modification.value, bindingList);
                    }
                    break;
                // 加载实体
                case ModifyType.Load:
                    // 检查父id是否一致，冒泡导致的变更不处理
                    const paths = modification.path;
                    const parentPath = paths[paths.length - 2];
                    const parentId = bindingList.parent.primaryKeyValue;
                    if (parentPath.indexOf(parentId) === -1) {
                        return;
                    }
                    const entities = modification.value;
                    this.loadEntities(entities, bindingList);
                    break;
                default:
                    break;
            }
        });
    }
    /**
     * 监听repository变化，保持repository和bindingList同步。
     * @param repository  实体仓库
     * @param bindingList 绑定列表
     */
    static loadRepository(repository, bindingList) {
        // 初次加载
        const entities = Array.from(repository.entityCollection.toArray());
        this.loadEntities(entities, bindingList);
        // 监听变化
        repository.entityCollectionChange.pipe(takeUntil(repository.destroy$)).subscribe((modification) => {
            switch (modification.type) {
                case ModifyType.Load:
                    bindingList.clear(true);
                    this.loadEntities(modification.value, bindingList, modification.entityCreate);
                    break;
                case ModifyType.Add:
                case ModifyType.Clone:
                    this.appendEntities(modification.value, bindingList, modification.type === ModifyType.Clone);
                    break;
                case ModifyType.AddData:
                    this.addData(modification.value, bindingList);
                    break;
                case ModifyType.Insert:
                    this.insertEntity(modification.value, bindingList, modification.position);
                    break;
                case ModifyType.Remove:
                    this.removeEntities(modification.value, bindingList);
                    break;
                case ModifyType.RemoveData:
                    this.removeData(modification.value, bindingList);
                    break;
                case ModifyType.PaginationInfoChange:
                    // 分页信息无需同步到bindingList，放到bindingData即可。保留此处只是为了兼容产品部可能使用bindingList上分页信息的场景
                    bindingList.paginationInfo = modification.value;
                    break;
                default:
                    break;
            }
        });
        // 监听BindingList数据变化
        bindingList.changes.pipe(takeUntil(bindingList.destroy$)).subscribe((change) => {
            if (change.type === ChangeType.PaginationInfoChange) {
                const entityCollection = repository.entityCollection;
                // const entityTypeName = entityCollection.entityTypeName;
                // const original = entityCollection.paginationInfo[entityTypeName];
                // const entityPaginationInfo = Object.assign({}, original, change.value);
                entityCollection.paginationInfo = Object.assign({}, entityCollection.paginationInfo, change.value);
            }
        });
    }
    /**
     * 将entities中的Entity对象转换为BindingObject对象，并加载到bindingList中
     * @param entities    实体数组
     * @param bindingList 绑定列表
     */
    static loadEntities(entities, bindingList, entityCreate = false) {
        const bindingObjects = this.createBindingObjects(entities, bindingList);
        bindingList.load(bindingObjects, entityCreate);
    }
    /**
     * 将entities中的Entity对象转换为BIndingObject对象，并追加到bindingList中
     * @param entities    实体数组
     * @param bindingList 绑定列表
     */
    static appendEntities(entities, bindingList, isCloned = false) {
        const bindingObjects = this.createBindingObjects(entities, bindingList);
        bindingList.append(bindingObjects, isCloned);
    }
    /**
     * 是否是有效的字段
     * @param entity 实体
     * @param propertyName 字段
     * @returns
     */
    static isEffectiveField(entity, propertyName) {
        if (!entity || !propertyName) {
            return false;
        }
        propertyName = propertyName.toLowerCase();
        if (entity['__farris_effective_fields__']) {
            return entity['__farris_effective_fields__'].includes(propertyName);
        }
        if (entity['farris_effective_fields'] && typeof entity['farris_effective_fields'] === 'string') {
            const effectiveFields = entity['farris_effective_fields'].split(',').filter(p => p).map(item => item.toLowerCase());
            entity['__farris_effective_fields__'] = effectiveFields;
            return effectiveFields.includes(propertyName);
        }
        return true;
    }
    /**
     * 增加实体数据（不切换当前行）
     * @param entities
     * @param bindingList
     */
    static addData(entities, bindingList) {
        const bindingObjects = this.createBindingObjects(entities, bindingList);
        bindingList.addData(bindingObjects);
    }
    static insertEntity(entity, bindingList, position) {
        const bindingObject = this.createBindingObject(entity, bindingList);
        bindingList.insert(bindingObject, position);
    }
    /**
     * 从bindingList移除entities对应的BindingObject对象
     * @param entities    实体数组
     * @param bindingList 绑定列表
     */
    static removeEntities(entities, bindingList) {
        if (entities === null || entities.length === 0) {
            return;
        }
        // 归集要删除的id数组
        const primaryKey = bindingList.primaryKey;
        const ids = [];
        entities.forEach((entity) => {
            ids.push(entity[primaryKey]);
        });
        bindingList.removeByIds(ids);
    }
    static removeData(entities, bindingList) {
        if (entities === null || entities.length === 0) {
            return;
        }
        // 归集要删除的id数组
        const primaryKey = bindingList.primaryKey;
        const ids = [];
        entities.forEach((entity) => {
            ids.push(entity[primaryKey]);
        });
        bindingList.removeDataByIds(ids);
    }
    /**
     * 将entities中的Entity对象转换为BindingObject对象
     * @param entities    实体数组
     * @param bindingList 绑定列表
     */
    static createBindingObjects(entities, bindingList) {
        if (entities === null || entities.length === 0) {
            return [];
        }
        const bindingObjects = [];
        entities.forEach((entity) => {
            const bindingObject = BindingObjectFactory.create(bindingList.properties);
            bindingObject['_ENTITY_'] = entity;
            this.loadEntity(entity, bindingObject);
            // // 为bindingObject设置默认值initialData属性
            // if (entity['initialData']) {
            //   bindingObject['initialData'] = entity['initialData'];
            // }
            bindingObjects.push(bindingObject);
        });
        return bindingObjects;
    }
    static createBindingObject(entity, bindingList) {
        const bindingObject = BindingObjectFactory.create(bindingList.properties);
        this.loadEntity(entity, bindingObject);
        return bindingObject;
    }
    static watchReposiroty(repository, bindingData) {
        // reposiroty => bindingData
        repository.entityCollectionChange.subscribe((modification) => {
            switch (modification.type) {
                case ModifyType.PaginationInfoChange:
                    bindingData.pagingInfo = modification.value;
                    break;
                default:
                    break;
            }
        });
    }
    /**
     * 查找属性的类型
     * @param entityType 实体类型
     * @param targetPropName 属性名称
     * @return 属性信息，包含属性类型（NgField、NgObject、NgList）和属性对应的实体类型（当NgField类型时为null）
     */
    static getPropInfo(entityType, targetPropName) {
        let propType;
        let propEntityType;
        // NgField
        const ngFieldProperties = FieldMetadataUtil.getNgFields(entityType);
        Object.keys(ngFieldProperties).forEach((propName) => {
            if (propName === targetPropName) {
                propType = 'NgField';
                propEntityType = null;
            }
        });
        // NgObject
        const ngObjectProperties = FieldMetadataUtil.getNgObjects(entityType);
        Object.keys(ngObjectProperties).forEach((propName) => {
            if (propName === targetPropName) {
                propType = 'NgObject';
                propEntityType = ngObjectProperties[propName].type;
            }
        });
        // NgList
        const ngListProperties = FieldMetadataUtil.getNgList(entityType);
        Object.keys(ngListProperties).forEach((propName) => {
            if (propName === targetPropName) {
                propType = 'NgList';
                propEntityType = ngListProperties[propName].type;
            }
        });
        const ngDynamicProperties = FieldMetadataUtil.getNgDynamic(entityType);
        Object.keys(ngDynamicProperties).forEach((propName) => {
            if (propName === targetPropName) {
                propType = 'NgDynamic';
                propEntityType = ngDynamicProperties[propName].type;
            }
        });
        return { propType, propEntityType };
    }
    /**
     * 获取实体的主键名
     * @param entityType 实体类型
     */
    static getPrimaryKey(entityType) {
        const primaryNgFiledProp = FieldMetadataUtil.getPrimaryFieldMetadata(entityType);
        if (primaryNgFiledProp) {
            return primaryNgFiledProp.dataField;
        }
        else {
            return '';
        }
    }
    /**
     * 是否为对象属性
     */
    static isObjectProp(entityType, targetPropName) {
        let isObjectProp = false;
        const ngObjectProperties = FieldMetadataUtil.getNgObjects(entityType);
        Object.keys(ngObjectProperties).forEach((propName) => {
            if (propName === targetPropName) {
                isObjectProp = true;
            }
        });
        return isObjectProp;
    }
    /**
     * 检查是否是动态列属性
     */
    static isDynamicProp(entityType, targetPropName) {
        let isDynamicProp = false;
        const ngDynamicProperties = FieldMetadataUtil.getNgDynamic(entityType);
        Object.keys(ngDynamicProperties).forEach((propName) => {
            if (propName === targetPropName) {
                isDynamicProp = true;
            }
        });
        return isDynamicProp;
    }
    /**
     * 为实体增加initialData属性
     * @param entity 实体实例
     * @param initialData 默认值对象
     */
    static appendInitialData(entity, initialData) {
        const data = Object.assign({}, initialData);
        delete data.id;
        delete data.parentID;
        entity['initialData'] = data;
    }
}
export { EntityUtil };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW50aXR5X3V0aWwuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2RldmtpdC8iLCJzb3VyY2VzIjpbImxpYi9iaW5kaW5nLWRhdGEvZW50aXR5X3V0aWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFzQixZQUFZLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUN0RixPQUFPLEVBQWdCLFVBQVUsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQzlELE9BQU8sRUFBc0IsVUFBVSxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBRzNELE9BQU8sRUFBbUIsbUJBQW1CLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUMxRSxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUNoRSxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBR3JDLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUUzQzs7R0FFRztBQUNILE1BQU0sVUFBVTtJQUVkOzs7O09BSUc7SUFDSCxNQUFNLENBQUMsVUFBVSxDQUFDLE1BQWMsRUFBRSxhQUE0QjtRQUM1RCxpQ0FBaUM7UUFDakMsYUFBYSxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxRQUF5QixFQUFFLEVBQUU7WUFDN0QsTUFBTSxZQUFZLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQztZQUNuQyxJQUFJLFFBQVEsQ0FBQyxJQUFJLEtBQUssbUJBQW1CLENBQUMsSUFBSSxFQUFFO2dCQUM5QyxJQUFJLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsSUFBSSxNQUFNLENBQUMsWUFBWSxDQUFDLEVBQUUsYUFBYSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUM7YUFDaEc7aUJBQU0sSUFBSSxRQUFRLENBQUMsSUFBSSxLQUFLLG1CQUFtQixDQUFDLE1BQU0sRUFBRTtnQkFDdkQsSUFBSSxNQUFNLElBQUksTUFBTSxDQUFD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QyxhQUFhLENBQUMsVUFBZSxFQUFFLGNBQXNCO1FBQzFELElBQUksYUFBYSxHQUFHLEtBQUssQ0FBQztRQUMxQixNQUFNLG1CQUFtQixHQUFHLGlCQUFpQixDQUFDLFlBQVksQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUN2RSxNQUFNLENBQUMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsUUFBZ0IsRUFBRSxFQUFFO1lBQzVELElBQUksUUFBUSxLQUFLLGNBQWMsRUFBRTtnQkFDL0IsYUFBYSxHQUFHLElBQUksQ0FBQzthQUN0QjtRQUNILENBQUMsQ0FBQyxDQUFDO1FBQ0gsT0FBTyxhQUFhLENBQUM7SUFDdkIsQ0FBQztJQUVEOzs7O09BSUc7SUFDSCxNQUFNLENBQUMsaUJBQWlCLENBQUMsTUFBTSxFQUFFLFdBQVc7UUFDMUMsTUFBTSxJQUFJLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsV0FBVyxDQUFDLENBQUM7UUFDNUMsT0FBTyxJQUFJLENBQUMsRUFBRSxDQUFDO1FBQ2YsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDO1FBQ3JCLE1BQU0sQ0FBQyxhQUFhLENBQUMsR0FBRyxJQUFJLENBQUM7SUFDL0IsQ0FBQztDQUNGO0FBRUQsT0FBTyxFQUFFLFVBQVUsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUmVwb3NpdG9yeSB9IGZyb20gJy4uL3JlcG9zaXRvcnkvaW5kZXgnO1xyXG5pbXBvcnQgeyBFbnRpdHksIEVudGl0eUxpc3QsIFBBUkVOVF9DTEFTUywgRmllbGRNZXRhZGF0YVV0aWwgfSBmcm9tICcuLi9lbnRpdHkvaW5kZXgnO1xyXG5pbXBvcnQgeyBNb2RpZmljYXRpb24sIE1vZGlmeVR5cGUgfSBmcm9tICcuLi9jaGFuZ2VzZXQvaW5kZXgnO1xyXG5pbXBvcnQgeyBWaWV3Q2hhbmdlLCBDaGFuZ2UsIENoYW5nZVR5cGUgfSBmcm9tICcuL2NoYW5nZXMnO1xyXG5pbXBvcnQgeyBCaW5kaW5nTGlzdCB9IGZyb20gJy4vYmluZGluZ19saXN0JztcclxuaW1wb3J0IHsgQmluZGluZ09iamVjdCB9IGZyb20gJy4vYmluZGluZ19vYmplY3QnO1xyXG5pbXBvcnQgeyBCaW5kaW5nUHJvcGVydHksIEJpbmRpbmdQcm9wZXJ0eVR5cGUgfSBmcm9tICcuL2JpbmRpbmdfcHJvcGVydHknO1xyXG5pbXBvcnQgeyBCaW5kaW5nT2JqZWN0RmFjdG9yeSB9IGZyb20gJy4vYmluZGluZ19vYmplY3RfZmFjdG9yeSc7XHJcbmltcG9ydCB7IEZvcm0gfSBmcm9tICcuLi9mb3JtL2luZGV4JztcclxuaW1wb3J0IHsgUGFnaW5hdGlvbiB9IGZyb20gJy4uL2NvcmUnO1xyXG5pbXBvcnQgeyBCaW5kaW5nRGF0YSB9IGZyb20gJy4vYmluZGluZ19kYXRhJztcclxuaW1wb3J0IHsgdGFrZVVudGlsIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5cclxuLyoqXHJcbiAqIOWunuS9k+aTjeS9nOW3peWFt+exu1xyXG4gKi9cclxuY2xhc3MgRW50aXR5VXRpbCB7XHJcblxyXG4gIC8qKlxyXG4gICAqIOWwhmVudGl0eeeahOaVsOaNruWKoOi9veWIsGJpbmRpbmdPYmplY3TkuK3vvIzlubbkv53mjIHkuKTogIXlkIzmraXjgIJcclxuICAgKiBAcGFyYW0gZW50aXR5ICAgICAgICDlrp7kvZPlr7nosaFcclxuICAgKiBAcGFyYW0gYmluZGluZ09iamVjdCDnu5Hlrprlr7nosaFcclxuICAgKi9cclxuICBzdGF0aWMgbG9hZEVudGl0eShlbnRpdHk6IEVudGl0eSwgYmluZGluZ09iamVjdDogQmluZGluZ09iamVjdCkge1xyXG4gICAgLy8g6YGN5Y6GYmluZGluZ09iamVjdOeahHByb3BlcnRpZXPov5vooYzotYvlgLxcclxuICAgIGJpbmRpbmdPYmplY3QucHJvcGVydGllcy5mb3JFYWNoKChwcm9wZXJ0eTogQmluZGluZ1Byb3BlcnR5KSA9PiB7XHJcbiAgICAgIGNvbnN0IHByb3BlcnR5TmFtZSA9IHByb3BlcnR5Lm5hbWU7XHJcbiAgICAgIGlmIChwcm9wZXJ0eS50eXBlID09PSBCaW5kaW5nUHJvcGVydHlUeXBlLkxpc3QpIHtcclxuICAgICAgICB0aGlzLmxvYWRFbnRpdHlMaXN0KGVudGl0eVtwcm9wZXJ0eU5hbWVdIHx8IGVudGl0eVtQQVJFTlRfQ0xBU1NdLCBiaW5kaW5nT2JqZWN0W3Byb3BlcnR5TmFtZV0pO1xyXG4gICAgICB9IGVsc2UgaWYgKHByb3BlcnR5LnR5cGUgPT09IEJpbmRpbmdQcm9wZXJ0eVR5cGUuT2JqZWN0KSB7XHJcbiAgICAgICAgaWYgKGVudGl0eSAmJiBlbnRpdHlbcHJvcGVydHlOYW1lXSAmJiB0aGlzLmlzRWZmZWN0aXZlRmllbGQoZW50aXR5LCBwcm9wZXJ0eU5hbWUpKSB7XHJcbiAgICAgICAgICB0aGlzLmxvYWRFbnRpdHkoZW50aXR5W3Byb3BlcnR5TmFtZV0sIGJpbmRpbmdPYmplY3RbcHJvcGVydHlOYW1lXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2UgaWYgKHByb3BlcnR5LnR5cGUgPT09IEJpbmRpbmdQcm9wZXJ0eVR5cGUuRHluYW1pYykge1xyXG4gICAgICAgIGlmIChlbnRpdHkgJiYgZW50aXR5W3Byb3BlcnR5TmFtZV0pIHtcclxuICAgICAgICAgIGNvbnN0IGR5bmFtaWNPYmplY3QgPSBCaW5kaW5nT2JqZWN0RmFjdG9yeS5jcmVhdGVEeW5hbWljQmluZGluZ09iamVjdChlbnRpdHlbcHJvcGVydHlOYW1lXS5kYXRhKTtcclxuICAgICAgICAgIEJpbmRpbmdPYmplY3RGYWN0b3J5LmF0dGFjaER5bmFtaWNPYmplY3RQcm9wZXJ0eShiaW5kaW5nT2JqZWN0LCBwcm9wZXJ0eU5hbWUsIGR5bmFtaWNPYmplY3QpO1xyXG4gICAgICAgICAgdGhpcy5sb2FkRW50aXR5KGVudGl0eVtwcm9wZXJ0eU5hbWVdLCBiaW5kaW5nT2JqZWN0W3Byb3BlcnR5TmFtZV0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBpZiAodGhpcy5pc0VmZmVjdGl2ZUZpZWxkKGVudGl0eSwgcHJvcGVydHlOYW1lKSkge1xyXG4gICAgICAgICAgY29uc3QgdmFsdWUgPSBlbnRpdHlbcHJvcGVydHlOYW1lXTtcclxuICAgICAgICAgIGJpbmRpbmdPYmplY3Quc2V0VmFsdWUocHJvcGVydHlOYW1lLCB2YWx1ZSwgZmFsc2UsIGZhbHNlKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIHRoaXMuc2V0VXBFbnRpdHlQaXBlbGluZShlbnRpdHksIGJpbmRpbmdPYmplY3QpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5bu656uLZW50aXR55ZKMYmluZGluZ09iamVjdOS5i+mXtOeahOWFs+iBlFxyXG4gICAqIEBwYXJhbSBlbnRpdHkgICAgICAgIOWunuS9k+WvueixoVxyXG4gICAqIEBwYXJhbSBiaW5kaW5nT2JqZWN0IOe7keWumuWvueixoVxyXG4gICAqL1xyXG4gIHN0YXRpYyBzZXRVcEVudGl0eVBpcGVsaW5lKGVudGl0eTogRW50aXR5LCBiaW5kaW5nT2JqZWN0OiBCaW5kaW5nT2JqZWN0KSB7XHJcbiAgICBpZiAoIWVudGl0eSB8fCAhYmluZGluZ09iamVjdCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICAvLyDnm5HlkKxlbnRpdHnlj5jmm7RcclxuICAgIGVudGl0eS5vblZhbHVlQ2hhbmdlZC5waXBlKHRha2VVbnRpbChlbnRpdHkudW5zdWJzY3JpYmUpKS5zdWJzY3JpYmUoKG1vZGlmaWNhdGlvbjogTW9kaWZpY2F0aW9uKSA9PiB7XHJcbiAgICAgIGlmIChtb2RpZmljYXRpb24udHlwZSAhPT0gTW9kaWZ5VHlwZS5WYWx1ZUNoYW5nZSB8fCBtb2RpZmljYXRpb24ucGF0aC5sZW5ndGggPT09IDApIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgICAgY29uc3QgcHJvcGVydHlOYW1lID0gbW9kaWZpY2F0aW9uLnBhdGhbbW9kaWZpY2F0aW9uLnBhdGgubGVuZ3RoIC0gMV07XHJcbiAgICAgIGNvbnN0IHByaW1hcnlLZXlQYXRoID0gbW9kaWZpY2F0aW9uLnBhdGhbbW9kaWZpY2F0aW9uLnBhdGgubGVuZ3RoIC0gMl07XHJcblxyXG4gICAgICAvLyDpqozor4HkuLvplK7mmK/lkKbljLnphY1cclxuICAgICAgLy8g5a2Y5Zyo5Li76ZSu5bm25LiU5Li76ZSu5LiN5pivaWTml7bmiY3mo4Dmn6XvvIjlgLzlr7nosaHjgIHlhbPogZTlr7nosaHkuI3mo4Dmn6XvvIlcclxuICAgICAgaWYgKGJpbmRpbmdPYmplY3QucHJpbWFyeUtleSAmJiBiaW5kaW5nT2JqZWN0LnByaW1hcnlLZXkgPT09ICdpZCcpIHtcclxuICAgICAgICBjb25zdCBwcmltYXJ5S2V5ID0gYmluZGluZ09iamVjdC5wcmltYXJ5S2V5O1xyXG4gICAgICAgIGNvbnN0IHByaW1hcnlLZXlWYWx1ZSA9IGJpbmRpbmdPYmplY3QuZ2V0VmFsdWUocHJpbWFyeUtleSk7XHJcbiAgICAgICAgaWYgKHByaW1hcnlLZXlQYXRoICE9PSBgJHtwcmltYXJ5S2V5fToke3ByaW1hcnlLZXlWYWx1ZX1gKSB7XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIC8vIFRPRE865L+u5aSN5Yqo5oCB5YiX5LiN6Kem5Y+R5Y+Y5pu055qE6Zeu6aKY77yM5Li05pe25pa55qGI77yM5bqU6K+l5pyJ5Y2V54us55qEZHluYW1pY0JpbmRpbmdPYmplY3TnsbtcclxuICAgICAgaWYgKG1vZGlmaWNhdGlvbi5keW5hbWljKSB7XHJcbiAgICAgICAgaWYgKGJpbmRpbmdPYmplY3RbJ19fb3JpZ2luYWxfXyddKSB7XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHZhbHVlID0gbW9kaWZpY2F0aW9uLnZhbHVlO1xyXG4gICAgICAgIGNvbnN0IHRhcmdldCA9IGJpbmRpbmdPYmplY3RbcHJvcGVydHlOYW1lXTtcclxuICAgICAgICBpZiAoIXRhcmdldCkge1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBPYmplY3Qua2V5cyh2YWx1ZSkuZm9yRWFjaCgoa2V5OiBzdHJpbmcpID0+IHtcclxuICAgICAgICAgIGlmICh0YXJnZXQuZ2V0VmFsdWUoa2V5KSA9PT0gdmFsdWVba2V5XSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICB0YXJnZXQuc2V0VmFsdWUoa2V5LCB2YWx1ZVtrZXldLCB0cnVlLCBmYWxzZSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8g5YC85rKh5pyJ5Y+R55Sf5Y+Y5YyW77yM5LiN5YaN6K6+572uXHJcbiAgICAgICAgLy8gVE9ETzog6YCa6L+HYmluZGluZ09iamVjdOS/ruaUuWVudGl0eeWxnuaAp+WAvOaXtu+8jGVudGl0eeaAu+S8muinpuWPkeS4gOS4quWPmOabtOWbnuadpe+8jOWmguaenOS4jeaIquiOt+i/meS4qumHjeWkjeeahOWPmOabtO+8jOS8muWvvOiHtOmHjeWkjeaIluatu+W+queOr1xyXG4gICAgICAgIGlmIChiaW5kaW5nT2JqZWN0LmdldFZhbHVlKHByb3BlcnR5TmFtZSkgPT09IG1vZGlmaWNhdGlvbi52YWx1ZSkge1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBiaW5kaW5nT2JqZWN0LnNldFZhbHVlKHByb3BlcnR5TmFtZSwgbW9kaWZpY2F0aW9uLnZhbHVlLCB0cnVlLCBmYWxzZSwgbW9kaWZpY2F0aW9uLmVycm9ycyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICB9KTtcclxuICAgIC8vIOebkeWQrGJpbmRpbmdPYmplY3Tlj5jmm7RcclxuICAgIGJpbmRpbmdPYmplY3Qudmlld0NoYW5nZXMucGlwZSh0YWtlVW50aWwoYmluZGluZ09iamVjdC51bnN1YnNjcmliZSkpLnN1YnNjcmliZSgodmlld0NoYW5nZTogVmlld0NoYW5nZSkgPT4ge1xyXG4gICAgICBjb25zdCB2YWx1ZSA9IHZpZXdDaGFuZ2UudmFsdWU7XHJcbiAgICAgIGNvbnN0IHByb3BlcnR5TmFtZSA9IHZpZXdDaGFuZ2UucGF0aFswXTtcclxuXHJcbiAgICAgIGxldCBwYXRoUHJlZml4ID0gJyc7XHJcbiAgICAgIGNvbnN0IHBhdGhEYXRhID0gZW50aXR5LmdldFBhdGhzKCk7XHJcbiAgICAgIGNvbnN0IHBhdGhzID0gcGF0aERhdGEucGF0aDtcclxuICAgICAgbGV0IGlkID0gYmluZGluZ09iamVjdFsnaWQnXTtcclxuICAgICAgYmluZGluZ09iamVjdFsnX19vcmlnaW5hbF9fJ10gPSB0cnVlO1xyXG4gICAgICAvLyBpZiAocGF0aERhdGEuaXNVZHQpIHtcclxuICAgICAgLy8gZ3JpZOS4rXVkdOayoeaciWlk77yM5LuO54i257qn5Lit5Y+W5Ye6aWTvvIzku6Xkvr/lrZjmlL7pqozor4Hkv6Hmga9cclxuICAgICAgY29uc3QgZ2V0UGFyZW50SWQgPSAodGFyZ2V0OiBhbnkpID0+IHtcclxuICAgICAgICBsZXQgcGFyZW50SWQgPSAnJztcclxuICAgICAgICBjb25zdCBmaW5kSWQgPSAoaXRlbTogYW55KSA9PiB7XHJcbiAgICAgICAgICBpZiAoaXRlbSAmJiBpdGVtICYmIGl0ZW1bJ2lkJ10pIHtcclxuICAgICAgICAgICAgcGFyZW50SWQgPSBpdGVtWydpZCddO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICB9IGVsc2UgaWYgKGl0ZW1bJ3BhcmVudCddKSB7XHJcbiAgICAgICAgICAgIGZpbmRJZChpdGVtWydwYXJlbnQnXSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICBmaW5kSWQodGFyZ2V0KTtcclxuICAgICAgICByZXR1cm4gcGFyZW50SWQ7XHJcbiAgICAgIH07XHJcbiAgICAgIGlkID0gZ2V0UGFyZW50SWQoYmluZGluZ09iamVjdCk7XHJcbiAgICAgIC8vIGlmIChwYXRoRGF0YS5pc0dyaWQpIHtcclxuICAgICAgLy8gICAvLyBncmlkIOWwhuS7juihqOS4u+Wtl+auteWOu+mZpFxyXG4gICAgICAvLyAgIHBhdGhzLnBvcCgpO1xyXG4gICAgICAvLyB9XHJcbiAgICAgIGlmIChwYXRocy5sZW5ndGgpIHtcclxuICAgICAgICBwYXRoUHJlZml4ID0gcGF0aHMuam9pbignLicpICsgJy4nO1xyXG4gICAgICB9XHJcbiAgICAgIC8vIH1cclxuICAgICAgY29uc3QgY29udHJvbFByb3AgPSBwYXRoUHJlZml4ICsgcHJvcGVydHlOYW1lO1xyXG4gICAgICAvLyDosIPnlKjlrp7kvZPpqozor4HvvIzlubblsIbplJnor6/kv6Hmga/lkIjlubbliLBmb3JtQ29udHJvbOS4ilxyXG4gICAgICBjb25zdCBlbnRpdHlWYWxpZGF0ZSA9IChjYWxsYmFjaz86IChlcnJvcjogYW55KSA9PiB2b2lkKSA9PiB7XHJcbiAgICAgICAgY29uc3QgZW5hYmxlVmFsaWRhdGUgPSBPYmplY3QudmFsdWVzKEZvcm0uaW5zTWFwKS5maW5kKGl0ZW0gPT4gaXRlbSAmJiBpdGVtLmVuYWJsZVZhbGlkYXRlKTtcclxuICAgICAgICBpZiAoIWVuYWJsZVZhbGlkYXRlKSB7XHJcbiAgICAgICAgICBpZiAodHlwZW9mIGNhbGxiYWNrID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgIGNhbGxiYWNrKG51bGwpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbnRpdHkudmFsaWRhdGVGcm9tVXRpbFN5bmMocHJvcGVydHlOYW1lLCB2YWx1ZSwgcmVzdWx0ID0+IHtcclxuICAgICAgICAgIGNvbnN0IGVycm9yT2JqID0ge307XHJcbiAgICAgICAgICBpZiAocmVzdWx0LmVycm9ycyAmJiByZXN1bHQuZXJyb3JzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgcmVzdWx0LmVycm9ycy5mb3JFYWNoKChlcnJvcjogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgaWYgKGVycm9yLmNvbnN0cmFpbnRzKSB7XHJcbiAgICAgICAgICAgICAgICBPYmplY3Qua2V5cyhlcnJvci5jb25zdHJhaW50cykuZm9yRWFjaChrZXkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICBlcnJvck9ialtrZXldID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZSxcclxuICAgICAgICAgICAgICAgICAgICBuYW1lOiBlcnJvci5jb25zdHJhaW50c1trZXldLFxyXG4gICAgICAgICAgICAgICAgICAgIGVycm9yOiBlcnJvclxyXG4gICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIC8vIOWFiOiuvue9ruWunuS9k+mqjOivgeS/oeaBr++8jOWGjeiuvue9rmZvcm3pqozor4Hkv6Hmga/vvIznhLblkI7lnKhmb3JtLmlzRm9ybVZhbGlk5YaF6YOo5pW05ZCI5a6e5L2T6aqM6K+BZm9ybemqjOivgeS/oeaBr1xyXG4gICAgICAgICAgRm9ybS51cGRhdGVFcnJvcnMoY29udHJvbFByb3AsIGVycm9yT2JqLCBpZCwgdmFsdWUsIHBhdGhEYXRhLmlzR3JpZCk7XHJcbiAgICAgICAgICBjb25zdCBmb3JtRXJyb3JzID0gdmlld0NoYW5nZVsnZXJyb3JzJ10gfHwge307XHJcbiAgICAgICAgICBjb25zdCBtZXJnZWRFcnJvcnMgPSBPYmplY3QuYXNzaWduKHt9LCBmb3JtRXJyb3JzLCBlcnJvck9iaik7XHJcbiAgICAgICAgICBsZXQgdmFsaWRhdGVFcnJvciA9IG51bGw7XHJcbiAgICAgICAgICBpZiAoT2JqZWN0LmtleXMobWVyZ2VkRXJyb3JzKS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIHZhbGlkYXRlRXJyb3IgPSB7IFtwcm9wZXJ0eU5hbWVdOiBtZXJnZWRFcnJvcnMgfTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGlmICh0eXBlb2YgKGNhbGxiYWNrKSA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICBjYWxsYmFjayh2YWxpZGF0ZUVycm9yKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9LCB2aWV3Q2hhbmdlLmNvbnRleHQpO1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgLy8g5LiN5piv5Li76ZSu5YC85a2X5q615pe277yM6KaB5YWI5qOA5p+l5Li76ZSu5piv5ZCm5a2Y5Zyo77yM5bm25LiU5Li76ZSu5piv5ZCm55u4562J77yI6Ziy5q2i5ZCO5Luj5Y+Y5pu05YaS5rOh5LiK5p2l77yJXHJcbiAgICAgIC8vIOmdnuS4u+mUruWxnuaAp+WPmOabtOaXtu+8jOimgeWFiOajgOafpeS4u+mUruaYr+WQpuWMuemFje+8iOWmguaenOS4u+mUruS5n+S/ruaUueS6hu+8jOimgeaxguWFiOS/ruaUueS4u+mUruWGjeS/ruaUueWFtuS7luWAvO+8iVxyXG4gICAgICBpZiAoYmluZGluZ09iamVjdC5wcmltYXJ5S2V5KSB7XHJcbiAgICAgICAgY29uc3QgcHJpbWFyeUtleSA9IGJpbmRpbmdPYmplY3QucHJpbWFyeUtleTtcclxuICAgICAgICBpZiAocHJvcGVydHlOYW1lICE9PSBwcmltYXJ5S2V5KSB7XHJcbiAgICAgICAgICBpZiAoIWVudGl0eVtwcmltYXJ5S2V5XSB8fCBlbnRpdHlbcHJpbWFyeUtleV0gIT09IGJpbmRpbmdPYmplY3RbcHJpbWFyeUtleV0pIHtcclxuICAgICAgICAgICAgZW50aXR5VmFsaWRhdGUoKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSBpZiAoZW50aXR5W3Byb3BlcnR5TmFtZV0gIT09IHZhbHVlKSB7XHJcbiAgICAgICAgICAvLyB0b2RvOiDlm6DlvILmraXmoKHpqozmnKrnu5PmnZ/lrp7kvZPkuLvplK7msqHmnInooqvotYvlgLzvvIzlr7zoh7Tlrp7kvZPlhbbku5blsZ7mgKfml6Dms5XotYvlgLzvvIzlvoXlkI7nu63liY3nq6/moKHpqozph43mnoTml7bljrvmjolcclxuICAgICAgICAgIGVudGl0eVtwcm9wZXJ0eU5hbWVdID0gdmFsdWU7XHJcbiAgICAgICAgICBlbnRpdHlWYWxpZGF0ZSgpO1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgLy8g5aaC5p6cQmluZGluZ09iamVjdOS4iueahOWxnuaAp+WAvOWSjEVudGl0eeS4iuWvueW6lOWxnuaAp+WAvOS4gOagt++8jOWImeS4jeWGjeiuvue9rlxyXG4gICAgICBpZiAoZW50aXR5W3Byb3BlcnR5TmFtZV0gPT09IHZhbHVlKSB7XHJcbiAgICAgICAgZW50aXR5VmFsaWRhdGUoKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIOiwg+eUqOihqOWNlemqjOivgSzpgJrov4flkI7osIPnlKjlrp7kvZPpqozor4FcclxuICAgICAgLy8gYmluZ2RpbmdPYmplY3Tlj5jljJblkI7vvIzlhYjosIPnlKjlrp7kvZPkuIrnmoTpqozor4HvvIzpgJrov4flkI7lho3orr7nva7lrp7kvZPnmoTlj5jliqhcclxuICAgICAgZW50aXR5VmFsaWRhdGUoKGVycm9yczogYW55KSA9PiB7XHJcbiAgICAgICAgZW50aXR5LmVycm9ycyA9IGVycm9ycztcclxuICAgICAgICBlbnRpdHlbcHJvcGVydHlOYW1lXSA9IHZhbHVlO1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5bCGZW50aXR5TGlzdOS4reeahEVudGl0eeWvueixoei9rOaNouS4ukJpbmRpbmdPYmplY3Tlr7nosaHvvIzliqDovb3liLBiaW5kaW5nTGlzdOS4re+8jOW5tuS/neaMgWVudGl0eUxpc3TlkoxiaW5kaW5nTGlzdOWQjOatpeOAglxyXG4gICAqIEBwYXJhbSBlbnRpdHlMaXN0ICDlrp7kvZPliJfooahcclxuICAgKiBAcGFyYW0gYmluZGluZ0xpc3Qg57uR5a6a5YiX6KGoXHJcbiAgICovXHJcbiAgc3RhdGljIGxvYWRFbnRpdHlMaXN0KGVudGl0eUxpc3Q6IEVudGl0eUxpc3Q8YW55PiwgYmluZGluZ0xpc3Q6IEJpbmRpbmdMaXN0KSB7XHJcbiAgICB0aGlzLmxvYWRFbnRpdGllcyhlbnRpdHlMaXN0Lml0ZW1zLCBiaW5kaW5nTGlzdCk7XHJcbiAgICB0aGlzLnNldFVwRW50aXR5TGlzdFBpcGVsaW5lKGVudGl0eUxpc3QsIGJpbmRpbmdMaXN0KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOW7uueri2VudGl0eUxpc3TlkoxiaW5kaW5nTGlzdOS5i+mXtOeahOWFs+iBlFxyXG4gICAqIEBwYXJhbSBlbnRpdHlMaXN0ICDlrp7kvZPliJfooahcclxuICAgKiBAcGFyYW0gYmluZGluZ0xpc3Qg57uR5a6a5YiX6KGoXHJcbiAgICovXHJcbiAgc3RhdGljIHNldFVwRW50aXR5TGlzdFBpcGVsaW5lKGVudGl0eUxpc3Q6IEVudGl0eUxpc3Q8YW55PiwgYmluZGluZ0xpc3Q6IEJpbmRpbmdMaXN0KSB7XHJcbiAgICBlbnRpdHlMaXN0Lm9uTGlzdENoYW5nZWQuc3Vic2NyaWJlKChtb2RpZmljYXRpb246IE1vZGlmaWNhdGlvbikgPT4ge1xyXG4gICAgICBjb25zdCB0YXJnZXQgPSBtb2RpZmljYXRpb25bJ3RhcmdldCddO1xyXG4gICAgICBpZiAodGFyZ2V0ICYmIHRhcmdldCAhPT0gZW50aXR5TGlzdCkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICBzd2l0Y2ggKG1vZGlmaWNhdGlvbi50eXBlKSB7XHJcbiAgICAgICAgLy8g5re75Yqg5a6e5L2TXHJcbiAgICAgICAgY2FzZSBNb2RpZnlUeXBlLkFkZDpcclxuICAgICAgICBjYXNlIE1vZGlmeVR5cGUuQ2xvbmU6XHJcbiAgICAgICAgICB7XHJcbiAgICAgICAgICAgIGNvbnN0IGVudGl0aWVzVG9BZGQgPSA8RW50aXR5W10+bW9kaWZpY2F0aW9uLnZhbHVlO1xyXG4gICAgICAgICAgICBpZiAoZW50aXRpZXNUb0FkZC5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8g5qOA5p+l54i2aWTmmK/lkKbkuIDoh7TvvIzlhpLms6Hlr7zoh7TnmoTlj5jmm7TkuI3lpITnkIZcclxuICAgICAgICAgICAgY29uc3QgcGF0aHMgPSBtb2RpZmljYXRpb24ucGF0aDtcclxuICAgICAgICAgICAgY29uc3QgcGFyZW50UGF0aCA9IHBhdGhzW3BhdGhzLmxlbmd0aCAtIDJdO1xyXG4gICAgICAgICAgICBjb25zdCBwYXJlbnRJZCA9IGJpbmRpbmdMaXN0LnBhcmVudC5wcmltYXJ5S2V5VmFsdWU7XHJcbiAgICAgICAgICAgIGlmIChwYXJlbnRQYXRoLmluZGV4T2YocGFyZW50SWQpID09PSAtMSkge1xyXG4gICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5hcHBlbmRFbnRpdGllcyg8RW50aXR5W10+bW9kaWZpY2F0aW9uLnZhbHVlLCBiaW5kaW5nTGlzdCwgbW9kaWZpY2F0aW9uLnR5cGUgPT09IE1vZGlmeVR5cGUuQ2xvbmUpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBNb2RpZnlUeXBlLkluc2VydDpcclxuICAgICAgICAgIHtcclxuICAgICAgICAgICAgLy8g5qOA5p+l54i2aWTmmK/lkKbkuIDoh7TvvIzlhpLms6Hlr7zoh7TnmoTlj5jmm7TkuI3lpITnkIZcclxuICAgICAgICAgICAgY29uc3QgcGF0aHMgPSBtb2RpZmljYXRpb24ucGF0aDtcclxuICAgICAgICAgICAgY29uc3QgcGFyZW50UGF0aCA9IHBhdGhzW3BhdGhzLmxlbmd0aCAtIDJdO1xyXG4gICAgICAgICAgICBjb25zdCBwYXJlbnRJZCA9IGJpbmRpbmdMaXN0LnBhcmVudC5wcmltYXJ5S2V5VmFsdWU7XHJcbiAgICAgICAgICAgIGNvbnN0IHBvc2l0aW9uID0gbW9kaWZpY2F0aW9uLnBvc2l0aW9uO1xyXG4gICAgICAgICAgICBpZiAocGFyZW50UGF0aC5pbmRleE9mKHBhcmVudElkKSA9PT0gLTEpIHtcclxuICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5pbnNlcnRFbnRpdHkobW9kaWZpY2F0aW9uLnZhbHVlWzBdLCBiaW5kaW5nTGlzdCwgcG9zaXRpb24pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgLy8g5Yig6Zmk5a6e5L2TXHJcbiAgICAgICAgY2FzZSBNb2RpZnlUeXBlLlJlbW92ZTpcclxuICAgICAgICAgIHtcclxuICAgICAgICAgICAgLy8g5qOA5p+l54i2aWTmmK/lkKbkuIDoh7TvvIzlhpLms6Hlr7zoh7TnmoTlj5jmm7TkuI3lpITnkIZcclxuICAgICAgICAgICAgY29uc3QgcGF0aHMgPSBtb2RpZmljYXRpb24ucGF0aDtcclxuICAgICAgICAgICAgY29uc3QgcGFyZW50UGF0aCA9IHBhdGhzW3BhdGhzLmxlbmd0aCAtIDJdO1xyXG4gICAgICAgICAgICBjb25zdCBwYXJlbnRJZCA9IGJpbmRpbmdMaXN0LnBhcmVudC5wcmltYXJ5S2V5VmFsdWU7XHJcbiAgICAgICAgICAgIGlmIChwYXJlbnRQYXRoLmluZGV4T2YocGFyZW50SWQpID09PSAtMSkge1xyXG4gICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyDliKDpmaTlrp7kvZPvvIh2YWx1ZeagvOW8j+W+heWVhuamt++8jOebruWJjXZhbHVl55qE5qC85byP5Li6IHsgcHJpbWFyeUtleTogcHJpbWFyeVZhbHVlfe+8iVxyXG4gICAgICAgICAgICBjb25zdCBpZCA9IG1vZGlmaWNhdGlvbi52YWx1ZVtiaW5kaW5nTGlzdC5wcmltYXJ5S2V5XTtcclxuICAgICAgICAgICAgYmluZGluZ0xpc3QucmVtb3ZlQnlJZHMoW2lkXSk7XHJcbiAgICAgICAgICAgIC8vIHRoaXMucmVtb3ZlRW50aXRpZXMoPEVudGl0eVtdPm1vZGlmaWNhdGlvbi52YWx1ZSwgYmluZGluZ0xpc3QpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgIC8vIOWKoOi9veWunuS9k1xyXG4gICAgICAgIGNhc2UgTW9kaWZ5VHlwZS5Mb2FkOlxyXG4gICAgICAgICAgLy8g5qOA5p+l54i2aWTmmK/lkKbkuIDoh7TvvIzlhpLms6Hlr7zoh7TnmoTlj5jmm7TkuI3lpITnkIZcclxuICAgICAgICAgIGNvbnN0IHBhdGhzID0gbW9kaWZpY2F0aW9uLnBhdGg7XHJcbiAgICAgICAgICBjb25zdCBwYXJlbnRQYXRoID0gcGF0aHNbcGF0aHMubGVuZ3RoIC0gMl07XHJcbiAgICAgICAgICBjb25zdCBwYXJlbnRJZCA9IGJpbmRpbmdMaXN0LnBhcmVudC5wcmltYXJ5S2V5VmFsdWU7XHJcbiAgICAgICAgICBpZiAocGFyZW50UGF0aC5pbmRleE9mKHBhcmVudElkKSA9PT0gLTEpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgY29uc3QgZW50aXRpZXMgPSBtb2RpZmljYXRpb24udmFsdWU7XHJcbiAgICAgICAgICB0aGlzLmxvYWRFbnRpdGllcyhlbnRpdGllcywgYmluZGluZ0xpc3QpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOebkeWQrHJlcG9zaXRvcnnlj5jljJbvvIzkv53mjIFyZXBvc2l0b3J55ZKMYmluZGluZ0xpc3TlkIzmraXjgIJcclxuICAgKiBAcGFyYW0gcmVwb3NpdG9yeSAg5a6e5L2T5LuT5bqTXHJcbiAgICogQHBhcmFtIGJpbmRpbmdMaXN0IOe7keWumuWIl+ihqFxyXG4gICAqL1xyXG4gIHN0YXRpYyBsb2FkUmVwb3NpdG9yeShyZXBvc2l0b3J5OiBSZXBvc2l0b3J5PGFueT4sIGJpbmRpbmdMaXN0OiBCaW5kaW5nTGlzdCkge1xyXG4gICAgLy8g5Yid5qyh5Yqg6L29XHJcbiAgICBjb25zdCBlbnRpdGllcyA9IEFycmF5LmZyb20ocmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLnRvQXJyYXkoKSk7XHJcbiAgICB0aGlzLmxvYWRFbnRpdGllcyhlbnRpdGllcywgYmluZGluZ0xpc3QpO1xyXG5cclxuICAgIC8vIOebkeWQrOWPmOWMllxyXG4gICAgcmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uQ2hhbmdlLnBpcGUodGFrZVVudGlsKHJlcG9zaXRvcnkuZGVzdHJveSQpKS5zdWJzY3JpYmUoKG1vZGlmaWNhdGlvbjogTW9kaWZpY2F0aW9uKSA9PiB7XHJcbiAgICAgIHN3aXRjaCAobW9kaWZpY2F0aW9uLnR5cGUpIHtcclxuICAgICAgICBjYXNlIE1vZGlmeVR5cGUuTG9hZDpcclxuICAgICAgICAgIGJpbmRpbmdMaXN0LmNsZWFyKHRydWUpO1xyXG4gICAgICAgICAgdGhpcy5sb2FkRW50aXRpZXMoPEVudGl0eVtdPm1vZGlmaWNhdGlvbi52YWx1ZSwgYmluZGluZ0xpc3QsIG1vZGlmaWNhdGlvbi5lbnRpdHlDcmVhdGUpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBNb2RpZnlUeXBlLkFkZDpcclxuICAgICAgICBjYXNlIE1vZGlmeVR5cGUuQ2xvbmU6XHJcbiAgICAgICAgICB0aGlzLmFwcGVuZEVudGl0aWVzKDxFbnRpdHlbXT5tb2RpZmljYXRpb24udmFsdWUsIGJpbmRpbmdMaXN0LCBtb2RpZmljYXRpb24udHlwZSA9PT0gTW9kaWZ5VHlwZS5DbG9uZSk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIE1vZGlmeVR5cGUuQWRkRGF0YTpcclxuICAgICAgICAgIHRoaXMuYWRkRGF0YSg8RW50aXR5W10+bW9kaWZpY2F0aW9uLnZhbHVlLCBiaW5kaW5nTGlzdCk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIE1vZGlmeVR5cGUuSW5zZXJ0OlxyXG4gICAgICAgICAgdGhpcy5pbnNlcnRFbnRpdHkobW9kaWZpY2F0aW9uLnZhbHVlLCBiaW5kaW5nTGlzdCwgbW9kaWZpY2F0aW9uLnBvc2l0aW9uKTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgTW9kaWZ5VHlwZS5SZW1vdmU6XHJcbiAgICAgICAgICB0aGlzLnJlbW92ZUVudGl0aWVzKDxFbnRpdHlbXT5tb2RpZmljYXRpb24udmFsdWUsIGJpbmRpbmdMaXN0KTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgTW9kaWZ5VHlwZS5SZW1vdmVEYXRhOlxyXG4gICAgICAgICAgdGhpcy5yZW1vdmVEYXRhKDxFbnRpdHlbXT5tb2RpZmljYXRpb24udmFsdWUsIGJpbmRpbmdMaXN0KTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgTW9kaWZ5VHlwZS5QYWdpbmF0aW9uSW5mb0NoYW5nZTpcclxuICAgICAgICAgIC8vIOWIhumhteS/oeaBr+aXoOmcgOWQjOatpeWIsGJpbmRpbmdMaXN077yM5pS+5YiwYmluZGluZ0RhdGHljbPlj6/jgILkv53nlZnmraTlpITlj6rmmK/kuLrkuoblhbzlrrnkuqflk4Hpg6jlj6/og73kvb/nlKhiaW5kaW5nTGlzdOS4iuWIhumhteS/oeaBr+eahOWcuuaZr1xyXG4gICAgICAgICAgYmluZGluZ0xpc3QucGFnaW5hdGlvbkluZm8gPSA8UGFnaW5hdGlvbj5tb2RpZmljYXRpb24udmFsdWU7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIC8vIOebkeWQrEJpbmRpbmdMaXN05pWw5o2u5Y+Y5YyWXHJcbiAgICBiaW5kaW5nTGlzdC5jaGFuZ2VzLnBpcGUodGFrZVVudGlsKGJpbmRpbmdMaXN0LmRlc3Ryb3kkKSkuc3Vic2NyaWJlKChjaGFuZ2U6IENoYW5nZSkgPT4ge1xyXG4gICAgICBpZiAoY2hhbmdlLnR5cGUgPT09IENoYW5nZVR5cGUuUGFnaW5hdGlvbkluZm9DaGFuZ2UpIHtcclxuICAgICAgICBjb25zdCBlbnRpdHlDb2xsZWN0aW9uID0gcmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uO1xyXG4gICAgICAgIC8vIGNvbnN0IGVudGl0eVR5cGVOYW1lID0gZW50aXR5Q29sbGVjdGlvbi5lbnRpdHlUeXBlTmFtZTtcclxuICAgICAgICAvLyBjb25zdCBvcmlnaW5hbCA9IGVudGl0eUNvbGxlY3Rpb24ucGFnaW5hdGlvbkluZm9bZW50aXR5VHlwZU5hbWVdO1xyXG4gICAgICAgIC8vIGNvbnN0IGVudGl0eVBhZ2luYXRpb25JbmZvID0gT2JqZWN0LmFzc2lnbih7fSwgb3JpZ2luYWwsIGNoYW5nZS52YWx1ZSk7XHJcbiAgICAgICAgZW50aXR5Q29sbGVjdGlvbi5wYWdpbmF0aW9uSW5mbyA9IE9iamVjdC5hc3NpZ24oe30sIGVudGl0eUNvbGxlY3Rpb24ucGFnaW5hdGlvbkluZm8sIGNoYW5nZS52YWx1ZSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5bCGZW50aXRpZXPkuK3nmoRFbnRpdHnlr7nosaHovazmjaLkuLpCaW5kaW5nT2JqZWN05a+56LGh77yM5bm25Yqg6L295YiwYmluZGluZ0xpc3TkuK1cclxuICAgKiBAcGFyYW0gZW50aXRpZXMgICAg5a6e5L2T5pWw57uEXHJcbiAgICogQHBhcmFtIGJpbmRpbmdMaXN0IOe7keWumuWIl+ihqFxyXG4gICAqL1xyXG4gIHN0YXRpYyBsb2FkRW50aXRpZXMoZW50aXRpZXM6IEVudGl0eVtdLCBiaW5kaW5nTGlzdDogQmluZGluZ0xpc3QsIGVudGl0eUNyZWF0ZTogYm9vbGVhbiA9IGZhbHNlKSB7XHJcbiAgICBjb25zdCBiaW5kaW5nT2JqZWN0cyA9IHRoaXMuY3JlYXRlQmluZGluZ09iamVjdHMoZW50aXRpZXMsIGJpbmRpbmdMaXN0KTtcclxuICAgIGJpbmRpbmdMaXN0LmxvYWQoYmluZGluZ09iamVjdHMsIGVudGl0eUNyZWF0ZSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlsIZlbnRpdGllc+S4reeahEVudGl0eeWvueixoei9rOaNouS4ukJJbmRpbmdPYmplY3Tlr7nosaHvvIzlubbov73liqDliLBiaW5kaW5nTGlzdOS4rVxyXG4gICAqIEBwYXJhbSBlbnRpdGllcyAgICDlrp7kvZPmlbDnu4RcclxuICAgKiBAcGFyYW0gYmluZGluZ0xpc3Qg57uR5a6a5YiX6KGoXHJcbiAgICovXHJcbiAgc3RhdGljIGFwcGVuZEVudGl0aWVzKGVudGl0aWVzOiBFbnRpdHlbXSwgYmluZGluZ0xpc3Q6IEJpbmRpbmdMaXN0LCBpc0Nsb25lZDogYm9vbGVhbiA9IGZhbHNlKSB7XHJcbiAgICBjb25zdCBiaW5kaW5nT2JqZWN0cyA9IHRoaXMuY3JlYXRlQmluZGluZ09iamVjdHMoZW50aXRpZXMsIGJpbmRpbmdMaXN0KTtcclxuICAgIGJpbmRpbmdMaXN0LmFwcGVuZChiaW5kaW5nT2JqZWN0cywgaXNDbG9uZWQpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmmK/lkKbmmK/mnInmlYjnmoTlrZfmrrVcclxuICAgKiBAcGFyYW0gZW50aXR5IOWunuS9k1xyXG4gICAqIEBwYXJhbSBwcm9wZXJ0eU5hbWUg5a2X5q61XHJcbiAgICogQHJldHVybnMgXHJcbiAgICovXHJcbiAgc3RhdGljIGlzRWZmZWN0aXZlRmllbGQoZW50aXR5OiBFbnRpdHksIHByb3BlcnR5TmFtZTogc3RyaW5nKSB7XHJcbiAgICBpZiAoIWVudGl0eSB8fCAhcHJvcGVydHlOYW1lKSB7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICAgIHByb3BlcnR5TmFtZSA9IHByb3BlcnR5TmFtZS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgaWYgKGVudGl0eVsnX19mYXJyaXNfZWZmZWN0aXZlX2ZpZWxkc19fJ10pIHtcclxuICAgICAgcmV0dXJuIGVudGl0eVsnX19mYXJyaXNfZWZmZWN0aXZlX2ZpZWxkc19fJ10uaW5jbHVkZXMocHJvcGVydHlOYW1lKTtcclxuICAgIH1cclxuICAgIGlmIChlbnRpdHlbJ2ZhcnJpc19lZmZlY3RpdmVfZmllbGRzJ10gJiYgdHlwZW9mIGVudGl0eVsnZmFycmlzX2VmZmVjdGl2ZV9maWVsZHMnXSA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgY29uc3QgZWZmZWN0aXZlRmllbGRzID0gZW50aXR5WydmYXJyaXNfZWZmZWN0aXZlX2ZpZWxkcyddLnNwbGl0KCcsJykuZmlsdGVyKHAgPT4gcCkubWFwKGl0ZW0gPT4gaXRlbS50b0xvd2VyQ2FzZSgpKTtcclxuICAgICAgZW50aXR5WydfX2ZhcnJpc19lZmZlY3RpdmVfZmllbGRzX18nXSA9IGVmZmVjdGl2ZUZpZWxkcztcclxuICAgICAgcmV0dXJuIGVmZmVjdGl2ZUZpZWxkcy5pbmNsdWRlcyhwcm9wZXJ0eU5hbWUpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRydWU7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWinuWKoOWunuS9k+aVsOaNru+8iOS4jeWIh+aNouW9k+WJjeihjO+8iVxyXG4gICAqIEBwYXJhbSBlbnRpdGllcyBcclxuICAgKiBAcGFyYW0gYmluZGluZ0xpc3QgXHJcbiAgICovXHJcbiAgc3RhdGljIGFkZERhdGEoZW50aXRpZXM6IEVudGl0eVtdLCBiaW5kaW5nTGlzdDogQmluZGluZ0xpc3QpIHtcclxuICAgIGNvbnN0IGJpbmRpbmdPYmplY3RzID0gdGhpcy5jcmVhdGVCaW5kaW5nT2JqZWN0cyhlbnRpdGllcywgYmluZGluZ0xpc3QpO1xyXG4gICAgYmluZGluZ0xpc3QuYWRkRGF0YShiaW5kaW5nT2JqZWN0cyk7XHJcbiAgfVxyXG4gIHN0YXRpYyBpbnNlcnRFbnRpdHkoZW50aXR5OiBFbnRpdHksIGJpbmRpbmdMaXN0OiBCaW5kaW5nTGlzdCwgcG9zaXRpb246IC0xIHwgMSkge1xyXG4gICAgY29uc3QgYmluZGluZ09iamVjdCA9IHRoaXMuY3JlYXRlQmluZGluZ09iamVjdChlbnRpdHksIGJpbmRpbmdMaXN0KTtcclxuICAgIGJpbmRpbmdMaXN0Lmluc2VydChiaW5kaW5nT2JqZWN0LCBwb3NpdGlvbik7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOS7jmJpbmRpbmdMaXN056e76ZmkZW50aXRpZXPlr7nlupTnmoRCaW5kaW5nT2JqZWN05a+56LGhXHJcbiAgICogQHBhcmFtIGVudGl0aWVzICAgIOWunuS9k+aVsOe7hFxyXG4gICAqIEBwYXJhbSBiaW5kaW5nTGlzdCDnu5HlrprliJfooahcclxuICAgKi9cclxuICBzdGF0aWMgcmVtb3ZlRW50aXRpZXMoZW50aXRpZXM6IEVudGl0eVtdLCBiaW5kaW5nTGlzdDogQmluZGluZ0xpc3QpIHtcclxuICAgIGlmIChlbnRpdGllcyA9PT0gbnVsbCB8fCBlbnRpdGllcy5sZW5ndGggPT09IDApIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOW9kumbhuimgeWIoOmZpOeahGlk5pWw57uEXHJcbiAgICBjb25zdCBwcmltYXJ5S2V5ID0gYmluZGluZ0xpc3QucHJpbWFyeUtleTtcclxuICAgIGNvbnN0IGlkcyA9IFtdO1xyXG4gICAgZW50aXRpZXMuZm9yRWFjaCgoZW50aXR5OiBFbnRpdHkpID0+IHtcclxuICAgICAgaWRzLnB1c2goZW50aXR5W3ByaW1hcnlLZXldKTtcclxuICAgIH0pO1xyXG4gICAgYmluZGluZ0xpc3QucmVtb3ZlQnlJZHMoaWRzKTtcclxuICB9XHJcbiAgc3RhdGljIHJlbW92ZURhdGEoZW50aXRpZXM6IEVudGl0eVtdLCBiaW5kaW5nTGlzdDogQmluZGluZ0xpc3QpIHtcclxuICAgIGlmIChlbnRpdGllcyA9PT0gbnVsbCB8fCBlbnRpdGllcy5sZW5ndGggPT09IDApIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgLy8g5b2S6ZuG6KaB5Yig6Zmk55qEaWTmlbDnu4RcclxuICAgIGNvbnN0IHByaW1hcnlLZXkgPSBiaW5kaW5nTGlzdC5wcmltYXJ5S2V5O1xyXG4gICAgY29uc3QgaWRzID0gW107XHJcbiAgICBlbnRpdGllcy5mb3JFYWNoKChlbnRpdHk6IEVudGl0eSkgPT4ge1xyXG4gICAgICBpZHMucHVzaChlbnRpdHlbcHJpbWFyeUtleV0pO1xyXG4gICAgfSk7XHJcbiAgICBiaW5kaW5nTGlzdC5yZW1vdmVEYXRhQnlJZHMoaWRzKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5bCGZW50aXRpZXPkuK3nmoRFbnRpdHnlr7nosaHovazmjaLkuLpCaW5kaW5nT2JqZWN05a+56LGhXHJcbiAgICogQHBhcmFtIGVudGl0aWVzICAgIOWunuS9k+aVsOe7hFxyXG4gICAqIEBwYXJhbSBiaW5kaW5nTGlzdCDnu5HlrprliJfooahcclxuICAgKi9cclxuICBzdGF0aWMgY3JlYXRlQmluZGluZ09iamVjdHMoZW50aXRpZXM6IEVudGl0eVtdLCBiaW5kaW5nTGlzdDogQmluZGluZ0xpc3QpIHtcclxuICAgIGlmIChlbnRpdGllcyA9PT0gbnVsbCB8fCBlbnRpdGllcy5sZW5ndGggPT09IDApIHtcclxuICAgICAgcmV0dXJuIFtdO1xyXG4gICAgfVxyXG4gICAgY29uc3QgYmluZGluZ09iamVjdHMgPSBbXTtcclxuICAgIGVudGl0aWVzLmZvckVhY2goKGVudGl0eTogRW50aXR5KSA9PiB7XHJcbiAgICAgIGNvbnN0IGJpbmRpbmdPYmplY3QgPSBCaW5kaW5nT2JqZWN0RmFjdG9yeS5jcmVhdGUoYmluZGluZ0xpc3QucHJvcGVydGllcyk7XHJcbiAgICAgIGJpbmRpbmdPYmplY3RbJ19FTlRJVFlfJ10gPSBlbnRpdHk7XHJcbiAgICAgIHRoaXMubG9hZEVudGl0eShlbnRpdHksIGJpbmRpbmdPYmplY3QpO1xyXG5cclxuICAgICAgLy8gLy8g5Li6YmluZGluZ09iamVjdOiuvue9rum7mOiupOWAvGluaXRpYWxEYXRh5bGe5oCnXHJcbiAgICAgIC8vIGlmIChlbnRpdHlbJ2luaXRpYWxEYXRhJ10pIHtcclxuICAgICAgLy8gICBiaW5kaW5nT2JqZWN0Wydpbml0aWFsRGF0YSddID0gZW50aXR5Wydpbml0aWFsRGF0YSddO1xyXG4gICAgICAvLyB9XHJcbiAgICAgIGJpbmRpbmdPYmplY3RzLnB1c2goYmluZGluZ09iamVjdCk7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiBiaW5kaW5nT2JqZWN0cztcclxuICB9XHJcbiAgc3RhdGljIGNyZWF0ZUJpbmRpbmdPYmplY3QoZW50aXR5OiBFbnRpdHksIGJpbmRpbmdMaXN0OiBCaW5kaW5nTGlzdCkge1xyXG4gICAgY29uc3QgYmluZGluZ09iamVjdCA9IEJpbmRpbmdPYmplY3RGYWN0b3J5LmNyZWF0ZShiaW5kaW5nTGlzdC5wcm9wZXJ0aWVzKTtcclxuICAgIHRoaXMubG9hZEVudGl0eShlbnRpdHksIGJpbmRpbmdPYmplY3QpO1xyXG4gICAgcmV0dXJuIGJpbmRpbmdPYmplY3Q7XHJcbiAgfVxyXG4gIHB1YmxpYyBzdGF0aWMgd2F0Y2hSZXBvc2lyb3R5KHJlcG9zaXRvcnk6IFJlcG9zaXRvcnk8YW55PiwgYmluZGluZ0RhdGE6IEJpbmRpbmdEYXRhKSB7XHJcbiAgICAvLyByZXBvc2lyb3R5ID0+IGJpbmRpbmdEYXRhXHJcbiAgICByZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb25DaGFuZ2Uuc3Vic2NyaWJlKChtb2RpZmljYXRpb246IE1vZGlmaWNhdGlvbikgPT4ge1xyXG4gICAgICBzd2l0Y2ggKG1vZGlmaWNhdGlvbi50eXBlKSB7XHJcbiAgICAgICAgY2FzZSBNb2RpZnlUeXBlLlBhZ2luYXRpb25JbmZvQ2hhbmdlOlxyXG4gICAgICAgICAgYmluZGluZ0RhdGEucGFnaW5nSW5mbyA9IG1vZGlmaWNhdGlvbi52YWx1ZTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOafpeaJvuWxnuaAp+eahOexu+Wei1xyXG4gICAqIEBwYXJhbSBlbnRpdHlUeXBlIOWunuS9k+exu+Wei1xyXG4gICAqIEBwYXJhbSB0YXJnZXRQcm9wTmFtZSDlsZ7mgKflkI3np7BcclxuICAgKiBAcmV0dXJuIOWxnuaAp+S/oeaBr++8jOWMheWQq+WxnuaAp+exu+Wei++8iE5nRmllbGTjgIFOZ09iamVjdOOAgU5nTGlzdO+8ieWSjOWxnuaAp+WvueW6lOeahOWunuS9k+exu+Wei++8iOW9k05nRmllbGTnsbvlnovml7bkuLpudWxs77yJXHJcbiAgICovXHJcbiAgc3RhdGljIGdldFByb3BJbmZvKGVudGl0eVR5cGU6IGFueSwgdGFyZ2V0UHJvcE5hbWU6IHN0cmluZyk6IHsgcHJvcFR5cGU6IHN0cmluZywgcHJvcEVudGl0eVR5cGU6IGFueSB9IHtcclxuXHJcbiAgICBsZXQgcHJvcFR5cGU6IHN0cmluZztcclxuICAgIGxldCBwcm9wRW50aXR5VHlwZTogYW55O1xyXG5cclxuICAgIC8vIE5nRmllbGRcclxuICAgIGNvbnN0IG5nRmllbGRQcm9wZXJ0aWVzID0gRmllbGRNZXRhZGF0YVV0aWwuZ2V0TmdGaWVsZHMoZW50aXR5VHlwZSk7XHJcbiAgICBPYmplY3Qua2V5cyhuZ0ZpZWxkUHJvcGVydGllcykuZm9yRWFjaCgocHJvcE5hbWU6IHN0cmluZykgPT4ge1xyXG4gICAgICBpZiAocHJvcE5hbWUgPT09IHRhcmdldFByb3BOYW1lKSB7XHJcbiAgICAgICAgcHJvcFR5cGUgPSAnTmdGaWVsZCc7XHJcbiAgICAgICAgcHJvcEVudGl0eVR5cGUgPSBudWxsO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBOZ09iamVjdFxyXG4gICAgY29uc3QgbmdPYmplY3RQcm9wZXJ0aWVzID0gRmllbGRNZXRhZGF0YVV0aWwuZ2V0TmdPYmplY3RzKGVudGl0eVR5cGUpO1xyXG4gICAgT2JqZWN0LmtleXMobmdPYmplY3RQcm9wZXJ0aWVzKS5mb3JFYWNoKChwcm9wTmFtZTogc3RyaW5nKSA9PiB7XHJcbiAgICAgIGlmIChwcm9wTmFtZSA9PT0gdGFyZ2V0UHJvcE5hbWUpIHtcclxuICAgICAgICBwcm9wVHlwZSA9ICdOZ09iamVjdCc7XHJcbiAgICAgICAgcHJvcEVudGl0eVR5cGUgPSBuZ09iamVjdFByb3BlcnRpZXNbcHJvcE5hbWVdLnR5cGU7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIC8vIE5nTGlzdFxyXG4gICAgY29uc3QgbmdMaXN0UHJvcGVydGllcyA9IEZpZWxkTWV0YWRhdGFVdGlsLmdldE5nTGlzdChlbnRpdHlUeXBlKTtcclxuICAgIE9iamVjdC5rZXlzKG5nTGlzdFByb3BlcnRpZXMpLmZvckVhY2goKHByb3BOYW1lOiBzdHJpbmcpID0+IHtcclxuICAgICAgaWYgKHByb3BOYW1lID09PSB0YXJnZXRQcm9wTmFtZSkge1xyXG4gICAgICAgIHByb3BUeXBlID0gJ05nTGlzdCc7XHJcbiAgICAgICAgcHJvcEVudGl0eVR5cGUgPSBuZ0xpc3RQcm9wZXJ0aWVzW3Byb3BOYW1lXS50eXBlO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBjb25zdCBuZ0R5bmFtaWNQcm9wZXJ0aWVzID0gRmllbGRNZXRhZGF0YVV0aWwuZ2V0TmdEeW5hbWljKGVudGl0eVR5cGUpO1xyXG4gICAgT2JqZWN0LmtleXMobmdEeW5hbWljUHJvcGVydGllcykuZm9yRWFjaCgocHJvcE5hbWU6IHN0cmluZykgPT4ge1xyXG4gICAgICBpZiAocHJvcE5hbWUgPT09IHRhcmdldFByb3BOYW1lKSB7XHJcbiAgICAgICAgcHJvcFR5cGUgPSAnTmdEeW5hbWljJztcclxuICAgICAgICBwcm9wRW50aXR5VHlwZSA9IG5nRHluYW1pY1Byb3BlcnRpZXNbcHJvcE5hbWVdLnR5cGU7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiB7IHByb3BUeXBlLCBwcm9wRW50aXR5VHlwZSB9O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+W5a6e5L2T55qE5Li76ZSu5ZCNXHJcbiAgICogQHBhcmFtIGVudGl0eVR5cGUg5a6e5L2T57G75Z6LXHJcbiAgICovXHJcbiAgc3RhdGljIGdldFByaW1hcnlLZXkoZW50aXR5VHlwZTogYW55KSB7XHJcbiAgICBjb25zdCBwcmltYXJ5TmdGaWxlZFByb3AgPSBGaWVsZE1ldGFkYXRhVXRpbC5nZXRQcmltYXJ5RmllbGRNZXRhZGF0YShlbnRpdHlUeXBlKTtcclxuICAgIGlmIChwcmltYXJ5TmdGaWxlZFByb3ApIHtcclxuICAgICAgcmV0dXJuIHByaW1hcnlOZ0ZpbGVkUHJvcC5kYXRhRmllbGQ7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gJyc7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmmK/lkKbkuLrlr7nosaHlsZ7mgKdcclxuICAgKi9cclxuICBzdGF0aWMgaXNPYmplY3RQcm9wKGVudGl0eVR5cGU6IGFueSwgdGFyZ2V0UHJvcE5hbWU6IHN0cmluZywpIHtcclxuICAgIGxldCBpc09iamVjdFByb3AgPSBmYWxzZTtcclxuICAgIGNvbnN0IG5nT2JqZWN0UHJvcGVydGllcyA9IEZpZWxkTWV0YWRhdGFVdGlsLmdldE5nT2JqZWN0cyhlbnRpdHlUeXBlKTtcclxuICAgIE9iamVjdC5rZXlzKG5nT2JqZWN0UHJvcGVydGllcykuZm9yRWFjaCgocHJvcE5hbWU6IHN0cmluZykgPT4ge1xyXG4gICAgICBpZiAocHJvcE5hbWUgPT09IHRhcmdldFByb3BOYW1lKSB7XHJcbiAgICAgICAgaXNPYmplY3RQcm9wID0gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gaXNPYmplY3RQcm9wO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5qOA5p+l5piv5ZCm5piv5Yqo5oCB5YiX5bGe5oCnXHJcbiAgICovXHJcbiAgc3RhdGljIGlzRHluYW1pY1Byb3AoZW50aXR5VHlwZTogYW55LCB0YXJnZXRQcm9wTmFtZTogc3RyaW5nKSB7XHJcbiAgICBsZXQgaXNEeW5hbWljUHJvcCA9IGZhbHNlO1xyXG4gICAgY29uc3QgbmdEeW5hbWljUHJvcGVydGllcyA9IEZpZWxkTWV0YWRhdGFVdGlsLmdldE5nRHluYW1pYyhlbnRpdHlUeXBlKTtcclxuICAgIE9iamVjdC5rZXlzKG5nRHluYW1pY1Byb3BlcnRpZXMpLmZvckVhY2goKHByb3BOYW1lOiBzdHJpbmcpID0+IHtcclxuICAgICAgaWYgKHByb3BOYW1lID09PSB0YXJnZXRQcm9wTmFtZSkge1xyXG4gICAgICAgIGlzRHluYW1pY1Byb3AgPSB0cnVlO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIHJldHVybiBpc0R5bmFtaWNQcm9wO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Li65a6e5L2T5aKe5YqgaW5pdGlhbERhdGHlsZ7mgKdcclxuICAgKiBAcGFyYW0gZW50aXR5IOWunuS9k+WunuS+i1xyXG4gICAqIEBwYXJhbSBpbml0aWFsRGF0YSDpu5jorqTlgLzlr7nosaFcclxuICAgKi9cclxuICBzdGF0aWMgYXBwZW5kSW5pdGlhbERhdGEoZW50aXR5LCBpbml0aWFsRGF0YSkge1xyXG4gICAgY29uc3QgZGF0YSA9IE9iamVjdC5hc3NpZ24oe30sIGluaXRpYWxEYXRhKTtcclxuICAgIGRlbGV0ZSBkYXRhLmlkO1xyXG4gICAgZGVsZXRlIGRhdGEucGFyZW50SUQ7XHJcbiAgICBlbnRpdHlbJ2luaXRpYWxEYXRhJ10gPSBkYXRhO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IHsgRW50aXR5VXRpbCB9O1xyXG4iXX0=