/**
 * @fileoverview added by tsickle
 * Generated from: lib/solutionmanager/solutionmanager.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ViewChild, TemplateRef, Output, EventEmitter } from '@angular/core';
import { FormBuilder } from '@angular/forms';
import { EditService } from '../service/edit.service';
import { NotifyService } from '@farris/ui-notify';
import { LocaleService } from '@farris/ui-locale';
import { DialogComponent } from '@farris/ui-dialog';
import { DatagridComponent } from '@farris/ui-datagrid';
import { cloneDeep } from 'lodash-es';
export class SolutionManangerComponent {
    /**
     * @param {?} formBuilder
     * @param {?} editService
     * @param {?} notify
     * @param {?} localeService
     */
    constructor(formBuilder, editService, notify, localeService) {
        this.formBuilder = formBuilder;
        this.editService = editService;
        this.notify = notify;
        this.localeService = localeService;
        this.cancelEmitter = new EventEmitter();
        this.confirmEmitter = new EventEmitter();
        // @Input()
        // currentDefaultQuerySolutionId: string;
        // @Input()
        this.querySolutions = new Array();
        this.deletedQuerySolutionIds = new Array();
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.columns = [
            { field: 'code', width: 272, title: this.localeService.getValue('querySolution.manageDialog.name') },
            { field: 'isSystem', width: 110, title: this.localeService.getValue('querySolution.manageDialog.property'), formatter: this.getSolutionProperty.bind(this), halign: 'center', align: 'center' },
            { field: 'isDefault', width: 70, title: this.localeService.getValue('querySolution.manageDialog.default'), template: this.checkCell, halign: 'center', align: 'center' },
            { width: 70, title: this.localeService.getValue('querySolution.manageDialog.operation'), template: this.optCell, halign: 'center', align: 'center' }
        ];
        this.title = this.localeService.getValue('querySolution.container.manage');
    }
    /**
     * @param {?} querySolutions
     * @return {?}
     */
    show(querySolutions) {
        if (querySolutions) {
            this.listData = this.findSolutionsWithoutSys(querySolutions);
            this.querySolutions = querySolutions;
        }
        this.checkedSolution = this.querySolutions.find((/**
         * @param {?} vo
         * @return {?}
         */
        vo => vo.isDefault));
        this.deletedQuerySolutionIds = [];
        // this.checkedSolution = undefined;
        this.dialog.show();
    }
    /**
     * @param {?} value
     * @return {?}
     */
    getSolutionProperty(value) {
        return value ? this.localeService.getValue("querySolution.manageDialog.system") : this.localeService.getValue("querySolution.manageDialog.personal");
    }
    /**
     * @param {?} querySolutions
     * @return {?}
     */
    findSolutionsWithoutSys(querySolutions) {
        /** @type {?} */
        const result = [];
        querySolutions.forEach((/**
         * @param {?} qs
         * @return {?}
         */
        qs => {
            if (!qs.isSystem)
                result.push(qs);
        }));
        return result;
    }
    /**
     * @param {?} dataItem
     * @return {?}
     */
    delelteSolution(dataItem) {
        this.deletedQuerySolutionIds.push(dataItem.id);
        if (this.checkedSolution && dataItem.id == this.checkedSolution.id) {
            this.checkedSolution = null;
        }
        //当checkedSolution不存在，直接删除
        for (let i = 0; i < this.querySolutions.length; i++) {
            if (dataItem.id == this.querySolutions[i].id) {
                this.querySolutions.splice(i, 1);
                break;
            }
        }
        this.listData = this.findSolutionsWithoutSys(this.querySolutions);
    }
    /**
     * @param {?} checked
     * @param {?} dataItem
     * @return {?}
     */
    setDefault(checked, dataItem) {
        if (checked) { //if checked，设置当前vo为默认，其他设为非默认
            this.checkedSolution = dataItem;
            //key point！
            // this.currentDefaultQuerySolutionId = dataItem.id;
            this.querySolutions = this.querySolutions.map((/**
             * @param {?} vo
             * @return {?}
             */
            vo => {
                if (vo.id == dataItem.id) {
                    vo.isDefault = true;
                }
                else {
                    vo.isDefault = false;
                }
                return vo;
            }));
        }
        else { //if unchecked, 设置当前vo为非默认，其余vo不变; 没有checkedSolution时
            if (dataItem.id == this.checkedSolution.id) {
                this.checkedSolution = null;
                // this.currentDefaultQuerySolutionId = '';
                this.querySolutions = this.querySolutions.map((/**
                 * @param {?} vo
                 * @return {?}
                 */
                vo => {
                    if (vo.id == dataItem.id) {
                        vo.isDefault = false;
                    }
                    return vo;
                }));
            }
        }
        this.listData = this.findSolutionsWithoutSys(this.querySolutions);
        this.list.refresh();
    }
    /**
     * @return {?}
     */
    cancel() {
        this.dialog.close();
    }
    /**
     * @return {?}
     */
    confirm() {
        /** @type {?} */
        let obj = new Object();
        obj['deletedQuerySolutionIds'] = this.deletedQuerySolutionIds;
        obj['newDefaultQuerySolution'] = cloneDeep(this.checkedSolution);
        obj['updatedQuerySolutionVos'] = cloneDeep(this.querySolutions);
        // obj['currentDefaultQuerySolutionId'] = this.currentDefaultQuerySolutionId;
        if (this.deletedQuerySolutionIds.length > 0 || this.checkedSolution && this.checkedSolution.id) {
            obj['validator'] = true;
        }
        else {
            obj['validator'] = false;
        }
        this.confirmEmitter.emit(obj);
        this.dialog.close();
    }
}
SolutionManangerComponent.decorators = [
    { type: Component, args: [{
                selector: 'app-solutionmanager',
                template: "<farris-dialog #dialog [buttons]=\"manangerbuttonRef\" [width]=\"550\" [height]=\"570\" [title]=\"title\">\r\n    <div class=\"solutionmanager-inner\">\r\n        <farris-datagrid #list [columns]=\"columns\" [data]=\"listData\" [pagination]=\"false\" [fit]=\"true\"></farris-datagrid>\r\n    </div>\r\n    <ng-template #optCell let-ctx>\r\n        <span class=\"f-icon f-icon-yxs_delete solutionmanager-grid-delete\" (click)=\"delelteSolution(ctx.rowData)\"></span>\r\n     </ng-template>\r\n     <ng-template #checkCell let-ctx>\r\n        <div class=\"custom-control custom-radio f-checkradio-single\" style=\"padding-top: 3px;\">\r\n            <input class=\"custom-control-input\" id=\"radio-{{ctx.rowData.id}}\" type=\"radio\" (click)=\"setDefault($event.target.checked, ctx.rowData)\" [checked]=\"ctx.rowData.isDefault\"/>\r\n            <label class=\"custom-control-label\" for=\"radio-{{ctx.rowData.id}}\"></label>\r\n        </div>\r\n     </ng-template>\r\n</farris-dialog>\r\n<ng-template #manangerbuttonRef>\r\n    <button class=\"btn btn-primary\" (click)=\"confirm()\">{{'querySolution.manageDialog.confirm' | locale}}</button>\r\n    <button class=\"btn btn-secondary\" (click)=\"cancel()\">{{'querySolution.manageDialog.cancel' | locale}}</button>\r\n</ng-template>",
                providers: [EditService],
                styles: [""]
            }] }
];
/** @nocollapse */
SolutionManangerComponent.ctorParameters = () => [
    { type: FormBuilder },
    { type: EditService },
    { type: NotifyService },
    { type: LocaleService }
];
SolutionManangerComponent.propDecorators = {
    cancelEmitter: [{ type: Output }],
    confirmEmitter: [{ type: Output }],
    dialog: [{ type: ViewChild, args: ['dialog',] }],
    optCell: [{ type: ViewChild, args: ['optCell',] }],
    checkCell: [{ type: ViewChild, args: ['checkCell',] }],
    list: [{ type: ViewChild, args: ['list',] }]
};
if (false) {
    /** @type {?} */
    SolutionManangerComponent.prototype.cancelEmitter;
    /** @type {?} */
    SolutionManangerComponent.prototype.confirmEmitter;
    /** @type {?} */
    SolutionManangerComponent.prototype.querySolutions;
    /** @type {?} */
    SolutionManangerComponent.prototype.deletedQuerySolutionIds;
    /** @type {?} */
    SolutionManangerComponent.prototype.checkedSolution;
    /** @type {?} */
    SolutionManangerComponent.prototype.listData;
    /** @type {?} */
    SolutionManangerComponent.prototype.dialog;
    /** @type {?} */
    SolutionManangerComponent.prototype.optCell;
    /** @type {?} */
    SolutionManangerComponent.prototype.checkCell;
    /** @type {?} */
    SolutionManangerComponent.prototype.list;
    /** @type {?} */
    SolutionManangerComponent.prototype.columns;
    /** @type {?} */
    SolutionManangerComponent.prototype.title;
    /**
     * @type {?}
     * @private
     */
    SolutionManangerComponent.prototype.formBuilder;
    /**
     * @type {?}
     * @private
     */
    SolutionManangerComponent.prototype.editService;
    /**
     * @type {?}
     * @private
     */
    SolutionManangerComponent.prototype.notify;
    /**
     * @type {?}
     * @private
     */
    SolutionManangerComponent.prototype.localeService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic29sdXRpb25tYW5hZ2VyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc3AtY21wL3F1ZXJ5c29sdXRpb24vIiwic291cmNlcyI6WyJsaWIvc29sdXRpb25tYW5hZ2VyL3NvbHV0aW9ubWFuYWdlci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLFNBQVMsRUFBRSxXQUFXLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBUSxNQUFNLGVBQWUsQ0FBQztBQUN0RyxPQUFPLEVBQWEsV0FBVyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDeEQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBQ3RELE9BQU8sRUFBRSxhQUFhLEVBQWlCLE1BQU0sbUJBQW1CLENBQUM7QUFFakUsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNwRCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN4RCxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBT3RDLE1BQU0sT0FBTyx5QkFBeUI7Ozs7Ozs7SUFzQmxDLFlBQW9CLFdBQXdCLEVBQVUsV0FBd0IsRUFBVSxNQUFxQixFQUFVLGFBQTRCO1FBQS9ILGdCQUFXLEdBQVgsV0FBVyxDQUFhO1FBQVUsZ0JBQVcsR0FBWCxXQUFXLENBQWE7UUFBVSxXQUFNLEdBQU4sTUFBTSxDQUFlO1FBQVUsa0JBQWEsR0FBYixhQUFhLENBQWU7UUFwQnpJLGtCQUFhLEdBQXNCLElBQUksWUFBWSxFQUFPLENBQUM7UUFDM0QsbUJBQWMsR0FBc0IsSUFBSSxZQUFZLEVBQU8sQ0FBQzs7OztRQUt0RSxtQkFBYyxHQUEyQixJQUFJLEtBQUssRUFBbUIsQ0FBQztRQUV0RSw0QkFBdUIsR0FBa0IsSUFBSSxLQUFL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U0FBUyxTQUFDO2dCQUNQLFFBQVEsRUFBRSxxQkFBcUI7Z0JBQy9CLCt3Q0FBK0M7Z0JBRS9DLFNBQVMsRUFBRSxDQUFDLFdBQVcsQ0FBQzs7YUFDM0I7Ozs7WUFibUIsV0FBVztZQUN0QixXQUFXO1lBQ1gsYUFBYTtZQUViLGFBQWE7Ozs0QkFZakIsTUFBTTs2QkFDTixNQUFNO3FCQVdOLFNBQVMsU0FBQyxRQUFRO3NCQUVsQixTQUFTLFNBQUMsU0FBUzt3QkFDbkIsU0FBUyxTQUFDLFdBQVc7bUJBQ3JCLFNBQVMsU0FBQyxNQUFNOzs7O0lBaEJqQixrREFBcUU7O0lBQ3JFLG1EQUFzRTs7SUFLdEUsbURBQXNFOztJQUV0RSw0REFBNkQ7O0lBQzdELG9EQUFpQzs7SUFDakMsNkNBQTRCOztJQUU1QiwyQ0FBNkM7O0lBRTdDLDRDQUFnRDs7SUFDaEQsOENBQW9EOztJQUNwRCx5Q0FBMkM7O0lBQzNDLDRDQUFvQjs7SUFDcEIsMENBQWM7Ozs7O0lBRUYsZ0RBQWdDOzs7OztJQUFFLGdEQUFnQzs7Ozs7SUFBRSwyQ0FBNkI7Ozs7O0lBQUUsa0RBQW9DIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIFZpZXdDaGlsZCwgVGVtcGxhdGVSZWYsIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBJbnB1dH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEZvcm1Hcm91cCwgRm9ybUJ1aWxkZXIgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XHJcbmltcG9ydCB7IEVkaXRTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZS9lZGl0LnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBOb3RpZnlTZXJ2aWNlLCBOb3RpZnlPcHRpb25zIH0gZnJvbSAnQGZhcnJpcy91aS1ub3RpZnknO1xyXG5pbXBvcnQgeyBRdWVyeVNvbHV0aW9uVm8gfSBmcm9tICdAZmFycmlzL2NvbXBvbmVudC1xdWVyeWNvbmRpdGlvbic7XHJcbmltcG9ydCB7IExvY2FsZVNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWxvY2FsZSc7XHJcbmltcG9ydCB7IERpYWxvZ0NvbXBvbmVudCB9IGZyb20gJ0BmYXJyaXMvdWktZGlhbG9nJztcclxuaW1wb3J0IHsgRGF0YWdyaWRDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLWRhdGFncmlkJztcclxuaW1wb3J0IHsgY2xvbmVEZWVwIH0gZnJvbSAnbG9kYXNoLWVzJztcclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ2FwcC1zb2x1dGlvbm1hbmFnZXInLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcuL3NvbHV0aW9ubWFuYWdlci5jb21wb25lbnQuaHRtbCcsXHJcbiAgICBzdHlsZVVybHM6IFsnLi9zb2x1dGlvbm1hbmFnZXIuY29tcG9uZW50LmNzcyddLFxyXG4gICAgcHJvdmlkZXJzOiBbRWRpdFNlcnZpY2VdXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBTb2x1dGlvbk1hbmFuZ2VyQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuXHJcbiAgICBAT3V0cHV0KCkgY2FuY2VsRW1pdHRlcjogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuICAgIEBPdXRwdXQoKSBjb25maXJtRW1pdHRlcjogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuICAgIFxyXG4gICAgLy8gQElucHV0KClcclxuICAgIC8vIGN1cnJlbnREZWZhdWx0UXVlcnlTb2x1dGlvbklkOiBzdHJpbmc7XHJcbiAgICAvLyBASW5wdXQoKVxyXG4gICAgcXVlcnlTb2x1dGlvbnM6IEFycmF5PFF1ZXJ5U29sdXRpb25Wbz4gPSBuZXcgQXJyYXk8UXVlcnlTb2x1dGlvblZvPigpO1xyXG5cclxuICAgIGRlbGV0ZWRRdWVyeVNvbHV0aW9uSWRzOiBBcnJheTxTdHJpbmc+ID0gbmV3IEFycmF5PFN0cmluZz4oKTtcclxuICAgIGNoZWNrZWRTb2x1dGlvbjogUXVlcnlTb2x1dGlvblZvO1xyXG4gICAgbGlzdERhdGE6IFF1ZXJ5U29sdXRpb25Wb1tdO1xyXG5cclxuICAgIEBWaWV3Q2hpbGQoJ2RpYWxvZycpIGRpYWxvZzogRGlhbG9nQ29tcG9uZW50O1xyXG4gICAgLy8g6I635Y+W5a6a5LmJ55qE5Y2V5YWD5qC85qih5p2/XHJcbiAgICBAVmlld0NoaWxkKCdvcHRDZWxsJykgb3B0Q2VsbDogVGVtcGxhdGVSZWY8YW55PjtcclxuICAgIEBWaWV3Q2hpbGQoJ2NoZWNrQ2VsbCcpIGNoZWNrQ2VsbDogVGVtcGxhdGVSZWY8YW55PjtcclxuICAgIEBWaWV3Q2hpbGQoJ2xpc3QnKSBsaXN0OiBEYXRhZ3JpZENvbXBvbmVudDtcclxuICAgIGNvbHVtbnM6IEFycmF5PGFueT47XHJcbiAgICB0aXRsZTogc3RyaW5nO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgZm9ybUJ1aWxkZXI6IEZvcm1CdWlsZGVyLCBwcml2YXRlIGVkaXRTZXJ2aWNlOiBFZGl0U2VydmljZSwgcHJpdmF0ZSBub3RpZnk6IE5vdGlmeVNlcnZpY2UsIHByaXZhdGUgbG9jYWxlU2VydmljZTogTG9jYWxlU2VydmljZSkgeyB9XHJcblxyXG5cclxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xyXG5cclxuICAgICAgICB0aGlzLmNvbHVtbnMgPSBbXHJcbiAgICAgICAgICAgIHsgZmllbGQ6ICdjb2RlJywgd2lkdGg6IDI3MiwgdGl0bGU6IHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZSgncXVlcnlTb2x1dGlvbi5tYW5hZ2VEaWFsb2cubmFtZScpfSxcclxuICAgICAgICAgICAgeyBmaWVsZDogJ2lzU3lzdGVtJywgd2lkdGg6IDExMCwgdGl0bGU6IHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZSgncXVlcnlTb2x1dGlvbi5tYW5hZ2VEaWFsb2cucHJvcGVydHknKSwgZm9ybWF0dGVyOiB0aGlzLmdldFNvbHV0aW9uUHJvcGVydHkuYmluZCh0aGlzKSwgaGFsaWduOiAnY2VudGVyJywgYWxpZ246ICdjZW50ZXInfSxcclxuICAgICAgICAgICAgeyBmaWVsZDogJ2lzRGVmYXVsdCcsIHdpZHRoOiA3MCwgdGl0bGU6IHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZSgncXVlcnlTb2x1dGlvbi5tYW5hZ2VEaWFsb2cuZGVmYXVsdCcpLCB0ZW1wbGF0ZTogdGhpcy5jaGVja0NlbGwsIGhhbGlnbjogJ2NlbnRlcicsIGFsaWduOiAnY2VudGVyJ30sXHJcbiAgICAgICAgICAgIHsgd2lkdGg6IDcwLCB0aXRsZTogdGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKCdxdWVyeVNvbHV0aW9uLm1hbmFnZURpYWxvZy5vcGVyYXRpb24nKSwgdGVtcGxhdGU6IHRoaXMub3B0Q2VsbCwgaGFsaWduOiAnY2VudGVyJywgYWxpZ246ICdjZW50ZXInfVxyXG4gICAgICAgIF07XHJcbiAgICAgICAgdGhpcy50aXRsZSA9IHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZSgncXVlcnlTb2x1dGlvbi5jb250YWluZXIubWFuYWdlJyk7XHJcbiAgICB9XHJcblxyXG4gICAgc2hvdyhxdWVyeVNvbHV0aW9uczogUXVlcnlTb2x1dGlvblZvW10pe1xyXG4gICAgICAgIGlmKHF1ZXJ5U29sdXRpb25zKXtcclxuICAgICAgICAgICAgdGhpcy5saXN0RGF0YSA9IHRoaXMuZmluZFNvbHV0aW9uc1dpdGhvdXRTeXMocXVlcnlTb2x1dGlvbnMpO1xyXG4gICAgICAgICAgICB0aGlzLnF1ZXJ5U29sdXRpb25zID0gcXVlcnlTb2x1dGlvbnM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuY2hlY2tlZFNvbHV0aW9uID0gdGhpcy5xdWVyeVNvbHV0aW9ucy5maW5kKHZvID0+IHZvLmlzRGVmYXVsdCk7XHJcblxyXG4gICAgICAgIHRoaXMuZGVsZXRlZFF1ZXJ5U29sdXRpb25JZHMgPSBbXTtcclxuICAgICAgICAvLyB0aGlzLmNoZWNrZWRTb2x1dGlvbiA9IHVuZGVmaW5lZDtcclxuICAgICAgICB0aGlzLmRpYWxvZy5zaG93KCk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0U29sdXRpb25Qcm9wZXJ0eSh2YWx1ZTogYm9vbGVhbikge1xyXG4gICAgICAgIHJldHVybiB2YWx1ZSA/IHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZShcInF1ZXJ5U29sdXRpb24ubWFuYWdlRGlhbG9nLnN5c3RlbVwiKSA6IHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZShcInF1ZXJ5U29sdXRpb24ubWFuYWdlRGlhbG9nLnBlcnNvbmFsXCIpO1xyXG4gICAgfVxyXG5cclxuICAgIGZpbmRTb2x1dGlvbnNXaXRob3V0U3lzKHF1ZXJ5U29sdXRpb25zOiBRdWVyeVNvbHV0aW9uVm9bXSk6IFF1ZXJ5U29sdXRpb25Wb1tde1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdDogUXVlcnlTb2x1dGlvblZvW10gPSBbXTtcclxuICAgICAgICBxdWVyeVNvbHV0aW9ucy5mb3JFYWNoKHFzID0+IHtcclxuICAgICAgICAgICAgaWYoIXFzLmlzU3lzdGVtKVxyXG4gICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gocXMpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9XHJcblxyXG4gICAgZGVsZWx0ZVNvbHV0aW9uKGRhdGFJdGVtOiBRdWVyeVNvbHV0aW9uVm8pIHtcclxuICAgICAgICB0aGlzLmRlbGV0ZWRRdWVyeVNvbHV0aW9uSWRzLnB1c2goZGF0YUl0ZW0uaWQpO1xyXG4gICAgICAgIGlmICh0aGlzLmNoZWNrZWRTb2x1dGlvbiAmJiBkYXRhSXRlbS5pZCA9PSB0aGlzLmNoZWNrZWRTb2x1dGlvbi5pZCkge1xyXG4gICAgICAgICAgICB0aGlzLmNoZWNrZWRTb2x1dGlvbiA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8v5b2TY2hlY2tlZFNvbHV0aW9u5LiN5a2Y5Zyo77yM55u05o6l5Yig6ZmkXHJcbiAgICAgICAgZm9yKGxldCBpPTA7IGk8dGhpcy5xdWVyeVNvbHV0aW9ucy5sZW5ndGg7IGkrKyl7XHJcbiAgICAgICAgICAgIGlmKGRhdGFJdGVtLmlkID09IHRoaXMucXVlcnlTb2x1dGlvbnNbaV0uaWQpe1xyXG4gICAgICAgICAgICAgICAgdGhpcy5xdWVyeVNvbHV0aW9ucy5zcGxpY2UoaSwgMSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmxpc3REYXRhID0gdGhpcy5maW5kU29sdXRpb25zV2l0aG91dFN5cyh0aGlzLnF1ZXJ5U29sdXRpb25zKTtcclxuICAgIH1cclxuXHJcbiAgICBzZXREZWZhdWx0KGNoZWNrZWQ6IGJvb2xlYW4sIGRhdGFJdGVtOiBRdWVyeVNvbHV0aW9uVm8pIHtcclxuICAgICAgICBpZiAoY2hlY2tlZCkgey8vaWYgY2hlY2tlZO+8jOiuvue9ruW9k+WJjXZv5Li66buY6K6k77yM5YW25LuW6K6+5Li66Z2e6buY6K6kXHJcbiAgICAgICAgICAgIHRoaXMuY2hlY2tlZFNvbHV0aW9uID0gZGF0YUl0ZW07XHJcbiAgICAgICAgICAgIC8va2V5IHBvaW5077yBXHJcbiAgICAgICAgICAgIC8vIHRoaXMuY3VycmVudERlZmF1bHRRdWVyeVNvbHV0aW9uSWQgPSBkYXRhSXRlbS5pZDtcclxuICAgICAgICAgICAgdGhpcy5xdWVyeVNvbHV0aW9ucyA9IHRoaXMucXVlcnlTb2x1dGlvbnMubWFwKHZvID0+IHtcclxuICAgICAgICAgICAgICAgIGlmKHZvLmlkID09IGRhdGFJdGVtLmlkKXtcclxuICAgICAgICAgICAgICAgICAgICB2by5pc0RlZmF1bHQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgdm8uaXNEZWZhdWx0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdm87XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHsvL2lmIHVuY2hlY2tlZCwg6K6+572u5b2T5YmNdm/kuLrpnZ7pu5jorqTvvIzlhbbkvZl2b+S4jeWPmDsg5rKh5pyJY2hlY2tlZFNvbHV0aW9u5pe2XHJcbiAgICAgICAgICAgIGlmIChkYXRhSXRlbS5pZCA9PSB0aGlzLmNoZWNrZWRTb2x1dGlvbi5pZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jaGVja2VkU29sdXRpb24gPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgLy8gdGhpcy5jdXJyZW50RGVmYXVsdFF1ZXJ5U29sdXRpb25JZCA9ICcnO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5xdWVyeVNvbHV0aW9ucyA9IHRoaXMucXVlcnlTb2x1dGlvbnMubWFwKHZvID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZih2by5pZCA9PSBkYXRhSXRlbS5pZCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZvLmlzRGVmYXVsdCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdm87XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmxpc3REYXRhID0gdGhpcy5maW5kU29sdXRpb25zV2l0aG91dFN5cyh0aGlzLnF1ZXJ5U29sdXRpb25zKTtcclxuICAgICAgICB0aGlzLmxpc3QucmVmcmVzaCgpO1xyXG4gICAgfVxyXG5cclxuICAgIGNhbmNlbCgpIHtcclxuICAgICAgICB0aGlzLmRpYWxvZy5jbG9zZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbmZpcm0oKSB7XHJcbiAgICAgICAgbGV0IG9iaiA9IG5ldyBPYmplY3QoKTtcclxuICAgICAgICBcclxuICAgICAgICBvYmpbJ2RlbGV0ZWRRdWVyeVNvbHV0aW9uSWRzJ10gPSB0aGlzLmRlbGV0ZWRRdWVyeVNvbHV0aW9uSWRzO1xyXG4gICAgICAgIG9ialsnbmV3RGVmYXVsdFF1ZXJ5U29sdXRpb24nXSA9IGNsb25lRGVlcCh0aGlzLmNoZWNrZWRTb2x1dGlvbik7XHJcbiAgICAgICAgb2JqWyd1cGRhdGVkUXVlcnlTb2x1dGlvblZvcyddID0gY2xvbmVEZWVwKHRoaXMucXVlcnlTb2x1dGlvbnMpO1xyXG4gICAgICAgIC8vIG9ialsnY3VycmVudERlZmF1bHRRdWVyeVNvbHV0aW9uSWQnXSA9IHRoaXMuY3VycmVudERlZmF1bHRRdWVyeVNvbHV0aW9uSWQ7XHJcblxyXG4gICAgICAgIGlmKHRoaXMuZGVsZXRlZFF1ZXJ5U29sdXRpb25JZHMubGVuZ3RoID4gMCB8fCB0aGlzLmNoZWNrZWRTb2x1dGlvbiAmJiB0aGlzLmNoZWNrZWRTb2x1dGlvbi5pZCl7XHJcbiAgICAgICAgICAgIG9ialsndmFsaWRhdG9yJ10gPSB0cnVlO1xyXG4gICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICBvYmpbJ3ZhbGlkYXRvciddID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuY29uZmlybUVtaXR0ZXIuZW1pdChvYmopO1xyXG4gICAgICAgIHRoaXMuZGlhbG9nLmNsb3NlKCk7XHJcbiAgICB9XHJcbn1cclxuIl19