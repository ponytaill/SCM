/**
 * @fileoverview added by tsickle
 * Generated from: lib/solutionmanager/solutionmanager.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ViewChild, TemplateRef, Output, EventEmitter } from '@angular/core';
import { FormBuilder } from '@angular/forms';
import { EditService } from '../service/edit.service';
import { NotifyService } from '@farris/ui-notify';
import { LocaleService } from '@farris/ui-locale';
import { DialogComponent } from '@farris/ui-dialog';
import { DatagridComponent } from '@farris/ui-datagrid';
import { cloneDeep } from 'lodash-es';
var SolutionManangerComponent = /** @class */ (function () {
    function SolutionManangerComponent(formBuilder, editService, notify, localeService) {
        this.formBuilder = formBuilder;
        this.editService = editService;
        this.notify = notify;
        this.localeService = localeService;
        this.cancelEmitter = new EventEmitter();
        this.confirmEmitter = new EventEmitter();
        // @Input()
        // currentDefaultQuerySolutionId: string;
        // @Input()
        this.querySolutions = new Array();
        this.deletedQuerySolutionIds = new Array();
    }
    /**
     * @return {?}
     */
    SolutionManangerComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.columns = [
            { field: 'code', width: 272, title: this.localeService.getValue('querySolution.manageDialog.name') },
            { field: 'isSystem', width: 110, title: this.localeService.getValue('querySolution.manageDialog.property'), formatter: this.getSolutionProperty.bind(this), halign: 'center', align: 'center' },
            { field: 'isDefault', width: 70, title: this.localeService.getValue('querySolution.manageDialog.default'), template: this.checkCell, halign: 'center', align: 'center' },
            { width: 70, title: this.localeService.getValue('querySolution.manageDialog.operation'), template: this.optCell, halign: 'center', align: 'center' }
        ];
        this.title = this.localeService.getValue('querySolution.container.manage');
    };
    /**
     * @param {?} querySolutions
     * @return {?}
     */
    SolutionManangerComponent.prototype.show = /**
     * @param {?} querySolutions
     * @return {?}
     */
    function (querySolutions) {
        if (querySolutions) {
            this.listData = this.findSolutionsWithoutSys(querySolutions);
            this.querySolutions = querySolutions;
        }
        this.checkedSolution = this.querySolutions.find((/**
         * @param {?} vo
         * @return {?}
         */
        function (vo) { return vo.isDefault; }));
        this.deletedQuerySolutionIds = [];
        // this.checkedSolution = undefined;
        this.dialog.show();
    };
    /**
     * @param {?} value
     * @return {?}
     */
    SolutionManangerComponent.prototype.getSolutionProperty = /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        return value ? this.localeService.getValue("querySolution.manageDialog.system") : this.localeService.getValue("querySolution.manageDialog.personal");
    };
    /**
     * @param {?} querySolutions
     * @return {?}
     */
    SolutionManangerComponent.prototype.findSolutionsWithoutSys = /**
     * @param {?} querySolutions
     * @return {?}
     */
    function (querySolutions) {
        /** @type {?} */
        var result = [];
        querySolutions.forEach((/**
         * @param {?} qs
         * @return {?}
         */
        function (qs) {
            if (!qs.isSystem)
                result.push(qs);
        }));
        return result;
    };
    /**
     * @param {?} dataItem
     * @return {?}
     */
    SolutionManangerComponent.prototype.delelteSolution = /**
     * @param {?} dataItem
     * @return {?}
     */
    function (dataItem) {
        this.deletedQuerySolutionIds.push(dataItem.id);
        if (this.checkedSolution && dataItem.id == this.checkedSolution.id) {
            this.checkedSolution = null;
        }
        //当checkedSolution不存在，直接删除
        for (var i = 0; i < this.querySolutions.length; i++) {
            if (dataItem.id == this.querySolutions[i].id) {
                this.querySolutions.splice(i, 1);
                break;
            }
        }
        this.listData = this.findSolutionsWithoutSys(this.querySolutions);
    };
    /**
     * @param {?} checked
     * @param {?} dataItem
     * @return {?}
     */
    SolutionManangerComponent.prototype.setDefault = /**
     * @param {?} checked
     * @param {?} dataItem
     * @return {?}
     */
    function (checked, dataItem) {
        if (checked) { //if checked，设置当前vo为默认，其他设为非默认
            this.checkedSolution = dataItem;
            //key point！
            // this.currentDefaultQuerySolutionId = dataItem.id;
            this.querySolutions = this.querySolutions.map((/**
             * @param {?} vo
             * @return {?}
             */
            function (vo) {
                if (vo.id == dataItem.id) {
                    vo.isDefault = true;
                }
                else {
                    vo.isDefault = false;
                }
                return vo;
            }));
        }
        else { //if unchecked, 设置当前vo为非默认，其余vo不变; 没有checkedSolution时
            if (dataItem.id == this.checkedSolution.id) {
                this.checkedSolution = null;
                // this.currentDefaultQuerySolutionId = '';
                this.querySolutions = this.querySolutions.map((/**
                 * @param {?} vo
                 * @return {?}
                 */
                function (vo) {
                    if (vo.id == dataItem.id) {
                        vo.isDefault = false;
                    }
                    return vo;
                }));
            }
        }
        this.listData = this.findSolutionsWithoutSys(this.querySolutions);
        this.list.refresh();
    };
    /**
     * @return {?}
     */
    SolutionManangerComponent.prototype.cancel = /**
     * @return {?}
     */
    function () {
        this.dialog.close();
    };
    /**
     * @return {?}
     */
    SolutionManangerComponent.prototype.confirm = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var obj = new Object();
        obj['deletedQuerySolutionIds'] = this.deletedQuerySolutionIds;
        obj['newDefaultQuerySolution'] = cloneDeep(this.checkedSolution);
        obj['updatedQuerySolutionVos'] = cloneDeep(this.querySolutions);
        // obj['currentDefaultQuerySolutionId'] = this.currentDefaultQuerySolutionId;
        if (this.deletedQuerySolutionIds.length > 0 || this.checkedSolution && this.checkedSolution.id) {
            obj['validator'] = true;
        }
        else {
            obj['validator'] = false;
        }
        this.confirmEmitter.emit(obj);
        this.dialog.close();
    };
    SolutionManangerComponent.decorators = [
        { type: Component, args: [{
                    selector: 'app-solutionmanager',
                    template: "<farris-dialog #dialog [buttons]=\"manangerbuttonRef\" [width]=\"550\" [height]=\"570\" [title]=\"title\">\r\n    <div class=\"solutionmanager-inner\">\r\n        <farris-datagrid #list [columns]=\"columns\" [data]=\"listData\" [pagination]=\"false\" [fit]=\"true\"></farris-datagrid>\r\n    </div>\r\n    <ng-template #optCell let-ctx>\r\n        <span class=\"f-icon f-icon-yxs_delete solutionmanager-grid-delete\" (click)=\"delelteSolution(ctx.rowData)\"></span>\r\n     </ng-template>\r\n     <ng-template #checkCell let-ctx>\r\n        <div class=\"custom-control custom-radio f-checkradio-single\" style=\"padding-top: 3px;\">\r\n            <input class=\"custom-control-input\" id=\"radio-{{ctx.rowData.id}}\" type=\"radio\" (click)=\"setDefault($event.target.checked, ctx.rowData)\" [checked]=\"ctx.rowData.isDefault\"/>\r\n            <label class=\"custom-control-label\" for=\"radio-{{ctx.rowData.id}}\"></label>\r\n        </div>\r\n     </ng-template>\r\n</farris-dialog>\r\n<ng-template #manangerbuttonRef>\r\n    <button class=\"btn btn-primary\" (click)=\"confirm()\">{{'querySolution.manageDialog.confirm' | locale}}</button>\r\n    <button class=\"btn btn-secondary\" (click)=\"cancel()\">{{'querySolution.manageDialog.cancel' | locale}}</button>\r\n</ng-template>",
                    providers: [EditService],
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    SolutionManangerComponent.ctorParameters = function () { return [
        { type: FormBuilder },
        { type: EditService },
        { type: NotifyService },
        { type: LocaleService }
    ]; };
    SolutionManangerComponent.propDecorators = {
        cancelEmitter: [{ type: Output }],
        confirmEmitter: [{ type: Output }],
        dialog: [{ type: ViewChild, args: ['dialog',] }],
        optCell: [{ type: ViewChild, args: ['optCell',] }],
        checkCell: [{ type: ViewChild, args: ['checkCell',] }],
        list: [{ type: ViewChild, args: ['list',] }]
    };
    return SolutionManangerComponent;
}());
export { SolutionManangerComponent };
if (false) {
    /** @type {?} */
    SolutionManangerComponent.prototype.cancelEmitter;
    /** @type {?} */
    SolutionManangerComponent.prototype.confirmEmitter;
    /** @type {?} */
    SolutionManangerComponent.prototype.querySolutions;
    /** @type {?} */
    SolutionManangerComponent.prototype.deletedQuerySolutionIds;
    /** @type {?} */
    SolutionManangerComponent.prototype.checkedSolution;
    /** @type {?} */
    SolutionManangerComponent.prototype.listData;
    /** @type {?} */
    SolutionManangerComponent.prototype.dialog;
    /** @type {?} */
    SolutionManangerComponent.prototype.optCell;
    /** @type {?} */
    SolutionManangerComponent.prototype.checkCell;
    /** @type {?} */
    SolutionManangerComponent.prototype.list;
    /** @type {?} */
    SolutionManangerComponent.prototype.columns;
    /** @type {?} */
    SolutionManangerComponent.prototype.title;
    /**
     * @type {?}
     * @private
     */
    SolutionManangerComponent.prototype.formBuilder;
    /**
     * @type {?}
     * @private
     */
    SolutionManangerComponent.prototype.editService;
    /**
     * @type {?}
     * @private
     */
    SolutionManangerComponent.prototype.notify;
    /**
     * @type {?}
     * @private
     */
    SolutionManangerComponent.prototype.localeService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic29sdXRpb25tYW5hZ2VyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc3AtY21wL3F1ZXJ5c29sdXRpb24vIiwic291cmNlcyI6WyJsaWIvc29sdXRpb25tYW5hZ2VyL3NvbHV0aW9ubWFuYWdlci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLFNBQVMsRUFBRSxXQUFXLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBUSxNQUFNLGVBQWUsQ0FBQztBQUN0RyxPQUFPLEVBQWEsV0FBVyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDeEQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBQ3RELE9BQU8sRUFBRSxhQUFhLEVBQWlCLE1BQU0sbUJBQW1CLENBQUM7QUFFakUsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNwRCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN4RCxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBQ3RDO0lBNEJJLG1DQUFvQixXQUF3QixFQUFVLFdBQXdCLEVBQVUsTUFBcUIsRUFBVSxhQUE0QjtRQUEvSCxnQkFBVyxHQUFYLFdBQVcsQ0FBYTtRQUFVLGdCQUFXLEdBQVgsV0FBVyxDQUFhO1FBQVUsV0FBTSxHQUFOLE1BQU0sQ0FBZTtRQUFVLGtCQUFhLEdBQWIsYUFBYSxDQUFlO1FBcEJ6SSxrQkFBYSxHQUFzQixJQUFJLFlBQVksRUFBTyxDQUFDO1FBQzNELG1CQUFjLEdBQXNCLElBQUksWUFBWSxFQUFPLENBQUM7Ozs7UUFLdEUsbUJBQWMsR0FBMkIsSUFBSSxLQUFLLEVBQW1CLENBQUM7UUFFdEUsNEJBQXVCLEdBQWtCLElBQUksS0FBSyxFQUFVLENBQUM7SUFZMEYsQ0FBQzs7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LE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQztJQUN4QixDQUFDOztnQkFuSUosU0FBUyxTQUFDO29CQUNQLFFBQVEsRUFBRSxxQkFBcUI7b0JBQy9CLCt3Q0FBK0M7b0JBRS9DLFNBQVMsRUFBRSxDQUFDLFdBQVcsQ0FBQzs7aUJBQzNCOzs7O2dCQWJtQixXQUFXO2dCQUN0QixXQUFXO2dCQUNYLGFBQWE7Z0JBRWIsYUFBYTs7O2dDQVlqQixNQUFNO2lDQUNOLE1BQU07eUJBV04sU0FBUyxTQUFDLFFBQVE7MEJBRWxCLFNBQVMsU0FBQyxTQUFTOzRCQUNuQixTQUFTLFNBQUMsV0FBVzt1QkFDckIsU0FBUyxTQUFDLE1BQU07O0lBNEdyQixnQ0FBQztDQUFBLEFBcElELElBb0lDO1NBOUhZLHlCQUF5Qjs7O0lBRWxDLGtEQUFxRTs7SUFDckUsbURBQXNFOztJQUt0RSxtREFBc0U7O0lBRXRFLDREQUE2RDs7SUFDN0Qsb0RBQWlDOztJQUNqQyw2Q0FBNEI7O0lBRTVCLDJDQUE2Qzs7SUFFN0MsNENBQWdEOztJQUNoRCw4Q0FBb0Q7O0lBQ3BELHlDQUEyQzs7SUFDM0MsNENBQW9COztJQUNwQiwwQ0FBYzs7Ozs7SUFFRixnREFBZ0M7Ozs7O0lBQUUsZ0RBQWdDOzs7OztJQUFFLDJDQUE2Qjs7Ozs7SUFBRSxrREFBb0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgVmlld0NoaWxkLCBUZW1wbGF0ZVJlZiwgT3V0cHV0LCBFdmVudEVtaXR0ZXIsIElucHV0fSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgRm9ybUdyb3VwLCBGb3JtQnVpbGRlciB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcclxuaW1wb3J0IHsgRWRpdFNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlL2VkaXQuc2VydmljZSc7XHJcbmltcG9ydCB7IE5vdGlmeVNlcnZpY2UsIE5vdGlmeU9wdGlvbnMgfSBmcm9tICdAZmFycmlzL3VpLW5vdGlmeSc7XHJcbmltcG9ydCB7IFF1ZXJ5U29sdXRpb25WbyB9IGZyb20gJ0BmYXJyaXMvY29tcG9uZW50LXF1ZXJ5Y29uZGl0aW9uJztcclxuaW1wb3J0IHsgTG9jYWxlU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbG9jYWxlJztcclxuaW1wb3J0IHsgRGlhbG9nQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1kaWFsb2cnO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZENvbXBvbmVudCB9IGZyb20gJ0BmYXJyaXMvdWktZGF0YWdyaWQnO1xyXG5pbXBvcnQgeyBjbG9uZURlZXAgfSBmcm9tICdsb2Rhc2gtZXMnO1xyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAnYXBwLXNvbHV0aW9ubWFuYWdlcicsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vc29sdXRpb25tYW5hZ2VyLmNvbXBvbmVudC5odG1sJyxcclxuICAgIHN0eWxlVXJsczogWycuL3NvbHV0aW9ubWFuYWdlci5jb21wb25lbnQuY3NzJ10sXHJcbiAgICBwcm92aWRlcnM6IFtFZGl0U2VydmljZV1cclxufSlcclxuZXhwb3J0IGNsYXNzIFNvbHV0aW9uTWFuYW5nZXJDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG5cclxuICAgIEBPdXRwdXQoKSBjYW5jZWxFbWl0dGVyOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG4gICAgQE91dHB1dCgpIGNvbmZpcm1FbWl0dGVyOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG4gICAgXHJcbiAgICAvLyBASW5wdXQoKVxyXG4gICAgLy8gY3VycmVudERlZmF1bHRRdWVyeVNvbHV0aW9uSWQ6IHN0cmluZztcclxuICAgIC8vIEBJbnB1dCgpXHJcbiAgICBxdWVyeVNvbHV0aW9uczogQXJyYXk8UXVlcnlTb2x1dGlvblZvPiA9IG5ldyBBcnJheTxRdWVyeVNvbHV0aW9uVm8+KCk7XHJcblxyXG4gICAgZGVsZXRlZFF1ZXJ5U29sdXRpb25JZHM6IEFycmF5PFN0cmluZz4gPSBuZXcgQXJyYXk8U3RyaW5nPigpO1xyXG4gICAgY2hlY2tlZFNvbHV0aW9uOiBRdWVyeVNvbHV0aW9uVm87XHJcbiAgICBsaXN0RGF0YTogUXVlcnlTb2x1dGlvblZvW107XHJcblxyXG4gICAgQFZpZXdDaGlsZCgnZGlhbG9nJykgZGlhbG9nOiBEaWFsb2dDb21wb25lbnQ7XHJcbiAgICAvLyDojrflj5blrprkuYnnmoTljZXlhYPmoLzmqKHmnb9cclxuICAgIEBWaWV3Q2hpbGQoJ29wdENlbGwnKSBvcHRDZWxsOiBUZW1wbGF0ZVJlZjxhbnk+O1xyXG4gICAgQFZpZXdDaGlsZCgnY2hlY2tDZWxsJykgY2hlY2tDZWxsOiBUZW1wbGF0ZVJlZjxhbnk+O1xyXG4gICAgQFZpZXdDaGlsZCgnbGlzdCcpIGxpc3Q6IERhdGFncmlkQ29tcG9uZW50O1xyXG4gICAgY29sdW1uczogQXJyYXk8YW55PjtcclxuICAgIHRpdGxlOiBzdHJpbmc7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBmb3JtQnVpbGRlcjogRm9ybUJ1aWxkZXIsIHByaXZhdGUgZWRpdFNlcnZpY2U6IEVkaXRTZXJ2aWNlLCBwcml2YXRlIG5vdGlmeTogTm90aWZ5U2VydmljZSwgcHJpdmF0ZSBsb2NhbGVTZXJ2aWNlOiBMb2NhbGVTZXJ2aWNlKSB7IH1cclxuXHJcblxyXG4gICAgbmdPbkluaXQoKTogdm9pZCB7XHJcblxyXG4gICAgICAgIHRoaXMuY29sdW1ucyA9IFtcclxuICAgICAgICAgICAgeyBmaWVsZDogJ2NvZGUnLCB3aWR0aDogMjcyLCB0aXRsZTogdGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKCdxdWVyeVNvbHV0aW9uLm1hbmFnZURpYWxvZy5uYW1lJyl9LFxyXG4gICAgICAgICAgICB7IGZpZWxkOiAnaXNTeXN0ZW0nLCB3aWR0aDogMTEwLCB0aXRsZTogdGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKCdxdWVyeVNvbHV0aW9uLm1hbmFnZURpYWxvZy5wcm9wZXJ0eScpLCBmb3JtYXR0ZXI6IHRoaXMuZ2V0U29sdXRpb25Qcm9wZXJ0eS5iaW5kKHRoaXMpLCBoYWxpZ246ICdjZW50ZXInLCBhbGlnbjogJ2NlbnRlcid9LFxyXG4gICAgICAgICAgICB7IGZpZWxkOiAnaXNEZWZhdWx0Jywgd2lkdGg6IDcwLCB0aXRsZTogdGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKCdxdWVyeVNvbHV0aW9uLm1hbmFnZURpYWxvZy5kZWZhdWx0JyksIHRlbXBsYXRlOiB0aGlzLmNoZWNrQ2VsbCwgaGFsaWduOiAnY2VudGVyJywgYWxpZ246ICdjZW50ZXInfSxcclxuICAgICAgICAgICAgeyB3aWR0aDogNzAsIHRpdGxlOiB0aGlzLmxvY2FsZVNlcnZpY2UuZ2V0VmFsdWUoJ3F1ZXJ5U29sdXRpb24ubWFuYWdlRGlhbG9nLm9wZXJhdGlvbicpLCB0ZW1wbGF0ZTogdGhpcy5vcHRDZWxsLCBoYWxpZ246ICdjZW50ZXInLCBhbGlnbjogJ2NlbnRlcid9XHJcbiAgICAgICAgXTtcclxuICAgICAgICB0aGlzLnRpdGxlID0gdGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKCdxdWVyeVNvbHV0aW9uLmNvbnRhaW5lci5tYW5hZ2UnKTtcclxuICAgIH1cclxuXHJcbiAgICBzaG93KHF1ZXJ5U29sdXRpb25zOiBRdWVyeVNvbHV0aW9uVm9bXSl7XHJcbiAgICAgICAgaWYocXVlcnlTb2x1dGlvbnMpe1xyXG4gICAgICAgICAgICB0aGlzLmxpc3REYXRhID0gdGhpcy5maW5kU29sdXRpb25zV2l0aG91dFN5cyhxdWVyeVNvbHV0aW9ucyk7XHJcbiAgICAgICAgICAgIHRoaXMucXVlcnlTb2x1dGlvbnMgPSBxdWVyeVNvbHV0aW9ucztcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jaGVja2VkU29sdXRpb24gPSB0aGlzLnF1ZXJ5U29sdXRpb25zLmZpbmQodm8gPT4gdm8uaXNEZWZhdWx0KTtcclxuXHJcbiAgICAgICAgdGhpcy5kZWxldGVkUXVlcnlTb2x1dGlvbklkcyA9IFtdO1xyXG4gICAgICAgIC8vIHRoaXMuY2hlY2tlZFNvbHV0aW9uID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIHRoaXMuZGlhbG9nLnNob3coKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRTb2x1dGlvblByb3BlcnR5KHZhbHVlOiBib29sZWFuKSB7XHJcbiAgICAgICAgcmV0dXJuIHZhbHVlID8gdGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKFwicXVlcnlTb2x1dGlvbi5tYW5hZ2VEaWFsb2cuc3lzdGVtXCIpIDogdGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKFwicXVlcnlTb2x1dGlvbi5tYW5hZ2VEaWFsb2cucGVyc29uYWxcIik7XHJcbiAgICB9XHJcblxyXG4gICAgZmluZFNvbHV0aW9uc1dpdGhvdXRTeXMocXVlcnlTb2x1dGlvbnM6IFF1ZXJ5U29sdXRpb25Wb1tdKTogUXVlcnlTb2x1dGlvblZvW117XHJcbiAgICAgICAgY29uc3QgcmVzdWx0OiBRdWVyeVNvbHV0aW9uVm9bXSA9IFtdO1xyXG4gICAgICAgIHF1ZXJ5U29sdXRpb25zLmZvckVhY2gocXMgPT4ge1xyXG4gICAgICAgICAgICBpZighcXMuaXNTeXN0ZW0pXHJcbiAgICAgICAgICAgICAgICByZXN1bHQucHVzaChxcyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH1cclxuXHJcbiAgICBkZWxlbHRlU29sdXRpb24oZGF0YUl0ZW06IFF1ZXJ5U29sdXRpb25Wbykge1xyXG4gICAgICAgIHRoaXMuZGVsZXRlZFF1ZXJ5U29sdXRpb25JZHMucHVzaChkYXRhSXRlbS5pZCk7XHJcbiAgICAgICAgaWYgKHRoaXMuY2hlY2tlZFNvbHV0aW9uICYmIGRhdGFJdGVtLmlkID09IHRoaXMuY2hlY2tlZFNvbHV0aW9uLmlkKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2hlY2tlZFNvbHV0aW9uID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy/lvZNjaGVja2VkU29sdXRpb27kuI3lrZjlnKjvvIznm7TmjqXliKDpmaRcclxuICAgICAgICBmb3IobGV0IGk9MDsgaTx0aGlzLnF1ZXJ5U29sdXRpb25zLmxlbmd0aDsgaSsrKXtcclxuICAgICAgICAgICAgaWYoZGF0YUl0ZW0uaWQgPT0gdGhpcy5xdWVyeVNvbHV0aW9uc1tpXS5pZCl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnF1ZXJ5U29sdXRpb25zLnNwbGljZShpLCAxKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMubGlzdERhdGEgPSB0aGlzLmZpbmRTb2x1dGlvbnNXaXRob3V0U3lzKHRoaXMucXVlcnlTb2x1dGlvbnMpO1xyXG4gICAgfVxyXG5cclxuICAgIHNldERlZmF1bHQoY2hlY2tlZDogYm9vbGVhbiwgZGF0YUl0ZW06IFF1ZXJ5U29sdXRpb25Wbykge1xyXG4gICAgICAgIGlmIChjaGVja2VkKSB7Ly9pZiBjaGVja2Vk77yM6K6+572u5b2T5YmNdm/kuLrpu5jorqTvvIzlhbbku5borr7kuLrpnZ7pu5jorqRcclxuICAgICAgICAgICAgdGhpcy5jaGVja2VkU29sdXRpb24gPSBkYXRhSXRlbTtcclxuICAgICAgICAgICAgLy9rZXkgcG9pbnTvvIFcclxuICAgICAgICAgICAgLy8gdGhpcy5jdXJyZW50RGVmYXVsdFF1ZXJ5U29sdXRpb25JZCA9IGRhdGFJdGVtLmlkO1xyXG4gICAgICAgICAgICB0aGlzLnF1ZXJ5U29sdXRpb25zID0gdGhpcy5xdWVyeVNvbHV0aW9ucy5tYXAodm8gPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYodm8uaWQgPT0gZGF0YUl0ZW0uaWQpe1xyXG4gICAgICAgICAgICAgICAgICAgIHZvLmlzRGVmYXVsdCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICB2by5pc0RlZmF1bHQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiB2bztcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Ugey8vaWYgdW5jaGVja2VkLCDorr7nva7lvZPliY12b+S4uumdnum7mOiupO+8jOWFtuS9mXZv5LiN5Y+YOyDmsqHmnIljaGVja2VkU29sdXRpb27ml7ZcclxuICAgICAgICAgICAgaWYgKGRhdGFJdGVtLmlkID09IHRoaXMuY2hlY2tlZFNvbHV0aW9uLmlkKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNoZWNrZWRTb2x1dGlvbiA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAvLyB0aGlzLmN1cnJlbnREZWZhdWx0UXVlcnlTb2x1dGlvbklkID0gJyc7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnF1ZXJ5U29sdXRpb25zID0gdGhpcy5xdWVyeVNvbHV0aW9ucy5tYXAodm8gPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKHZvLmlkID09IGRhdGFJdGVtLmlkKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm8uaXNEZWZhdWx0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB2bztcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMubGlzdERhdGEgPSB0aGlzLmZpbmRTb2x1dGlvbnNXaXRob3V0U3lzKHRoaXMucXVlcnlTb2x1dGlvbnMpO1xyXG4gICAgICAgIHRoaXMubGlzdC5yZWZyZXNoKCk7XHJcbiAgICB9XHJcblxyXG4gICAgY2FuY2VsKCkge1xyXG4gICAgICAgIHRoaXMuZGlhbG9nLmNsb3NlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uZmlybSgpIHtcclxuICAgICAgICBsZXQgb2JqID0gbmV3IE9iamVjdCgpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIG9ialsnZGVsZXRlZFF1ZXJ5U29sdXRpb25JZHMnXSA9IHRoaXMuZGVsZXRlZFF1ZXJ5U29sdXRpb25JZHM7XHJcbiAgICAgICAgb2JqWyduZXdEZWZhdWx0UXVlcnlTb2x1dGlvbiddID0gY2xvbmVEZWVwKHRoaXMuY2hlY2tlZFNvbHV0aW9uKTtcclxuICAgICAgICBvYmpbJ3VwZGF0ZWRRdWVyeVNvbHV0aW9uVm9zJ10gPSBjbG9uZURlZXAodGhpcy5xdWVyeVNvbHV0aW9ucyk7XHJcbiAgICAgICAgLy8gb2JqWydjdXJyZW50RGVmYXVsdFF1ZXJ5U29sdXRpb25JZCddID0gdGhpcy5jdXJyZW50RGVmYXVsdFF1ZXJ5U29sdXRpb25JZDtcclxuXHJcbiAgICAgICAgaWYodGhpcy5kZWxldGVkUXVlcnlTb2x1dGlvbklkcy5sZW5ndGggPiAwIHx8IHRoaXMuY2hlY2tlZFNvbHV0aW9uICYmIHRoaXMuY2hlY2tlZFNvbHV0aW9uLmlkKXtcclxuICAgICAgICAgICAgb2JqWyd2YWxpZGF0b3InXSA9IHRydWU7XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIG9ialsndmFsaWRhdG9yJ10gPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jb25maXJtRW1pdHRlci5lbWl0KG9iaik7XHJcbiAgICAgICAgdGhpcy5kaWFsb2cuY2xvc2UoKTtcclxuICAgIH1cclxufVxyXG4iXX0=