import * as tslib_1 from "tslib";
import * as ValidatorJS from 'validator';
import { ValidationTypes } from './validation_types';
import { ValidationExecutor } from './validation_executor';
import { ValidationUtils } from './validation_utils';
import { DateUtil } from '../../utils/date_util';
import { TranslateService } from '../../i18n/translate_service';
import { BigNumber } from 'bignumber.js';
/**
 * 校验实体实例对象数据
 */
var Validator = /** @class */ (function () {
    function Validator() {
        this.validatorJs = ValidatorJS.default;
    }
    /**
     * 验证实例对象中数据是否合法
     * @param object 待校验的实例对象
     * @param propertyName 待校验实例对象属性名称，为空则验证实例对象中所有带有验证规则的属性
     */
    // tslint:disable-next-line: max-line-length
    Validator.prototype.validate = function (object, propertyName, value, externalRules, index, frameContext) {
        var _this = this;
        var validationErrors = [];
        var executor = new ValidationExecutor(this);
        executor.execute(object, value, validationErrors, propertyName, index, externalRules, null, frameContext);
        return Promise.all(executor.awaitingPromises).then(function () {
            var errors = executor.stripEmptyErrors(validationErrors);
            _this.sortValidationErrors(errors);
            return _this.buildErrors(errors);
        });
    };
    /**
     * 校验信息排序（为了兼容树形表）
     * @param validationErrors 验证信息数组
     */
    Validator.prototype.sortValidationErrors = function (validationErrors) {
        var _this = this;
        // 如果存在无序号的信息则不排序
        var sortable = true;
        validationErrors.forEach(function (info) {
            if (info.children && info.children.length > 1) {
                _this.sortValidationErrors(info.children);
            }
            if (typeof info.index !== "number") {
                sortable = false;
            }
        });
        if (sortable) {
            validationErrors.sort(function (a, b) { return a.index - b.index; });
        }
    };
    /**
     * 执行校验
     * @param object
     * @param propertyName
     * @param value
     * @param externalRules
     * @param index
     * @param frameContext
     * @param ignoreAsyncValidateRules
     * @returns
     */
    Validator.prototype.verify = function (object, propertyName, value, externalRules, index, frameContext, ignoreAsyncValidateRules) {
        var _this = this;
        if (ignoreAsyncValidateRules === void 0) { ignoreAsyncValidateRules = false; }
        var validationErrors = [];
        var executor = new ValidationExecutor(this);
        executor.execute(object, value, validationErrors, propertyName, index, externalRules, null, frameContext);
        if (executor.awaitingPromises && executor.awaitingPromises.length > 0 && ignoreAsyncValidateRules === false) {
            return Promise.all(executor.awaitingPromises).then(function () {
                var errors = executor.stripEmptyErrors(validationErrors);
                var result = _this.buildErrors(errors);
                return result;
            });
        }
        else {
            var errors = executor.stripEmptyErrors(validationErrors);
            return this.buildErrors(errors);
        }
    };
    /**
     * 验证实体属性元数据中设置的校验规则是否合法
     * @param object 实例对象
     * @param value 待校验的值
     * @param validateRule 验证规则
     */
    Validator.prototype.validateValueByMetadata = function (object, value, validateRule, isMultLanguageField, currentRowId) {
        var _a;
        var validType = validateRule.type;
        var constraintsToValidate = [];
        if (validateRule.constraints) {
            constraintsToValidate = validateRule.constraints.map(function (param) {
                if (typeof param === 'function') {
                    return param(object, value);
                }
                return param;
            });
        }
        else {
            validateRule.constraints = [];
        }
        if (ValidationTypes.isValidType(validType)) {
            if (validType === ValidationTypes.MAXVALUE) {
                var rule = constraintsToValidate[0];
                if (this.isDateString(value) || this.isDate(value) || this.isDateString(rule) || this.isDate(rule)) {
                    // 如果日期值不存在，则不判断大小
                    if (!value) {
                        return true;
                    }
                    if (value.indexOf('~') !== -1) {
                        // 不对日期区间进行校验
                        return true;
                    }
                    return this[ValidationTypes.MAX_DATE](DateUtil.parse(value), isMultLanguageField, new Date(constraintsToValidate[0]));
                }
                else {
                    return this[ValidationTypes.MAXVALUE](value, isMultLanguageField, constraintsToValidate[0]);
                }
            }
            else if (validType === ValidationTypes.MINVALUE) {
                // 如果是null或undefined，直接返回true
                if (constraintsToValidate[0] === null || constraintsToValidate[0] === undefined) {
                    return true;
                }
                if (this.isDateString(value) || this.isDate(value)) {
                    if (constraintsToValidate[0] === 0) {
                        return true;
                    }
                    return this[ValidationTypes.MIN_DATE](DateUtil.parse(value), isMultLanguageField, DateUtil.parse(constraintsToValidate[0]));
                }
                else if (this.isNumber(value)) {
                    return this[ValidationTypes.MIN](value, isMultLanguageField, constraintsToValidate[0]);
                }
            }
            else {
                return this[validType].apply(this, tslib_1.__spread([value, isMultLanguageField], constraintsToValidate));
            }
        }
        else {
            if (typeof validateRule.eval === 'function') {
                var bindingPath = validateRule.bindingPath;
                var bindingPaths = bindingPath.split('/').filter(function (p) { return p; });
                var fieldName = validateRule.field;
                if (bindingPaths.length !== 0) {
                    var prefix = bindingPaths.join('/');
                    fieldName = prefix + "/" + fieldName.split('.').filter(function (p) { return p; }).join('/');
                }
                var options = { patch: (_a = {}, _a[fieldName] = value, _a) };
                options.currentRows = [];
                var parentEntityListPaths = object && typeof object['getEntityListPath'] === 'function' && object.getEntityListPath();
                if (parentEntityListPaths.length === 4) {
                    var childrenList = parentEntityListPaths.slice(1, 3).reverse();
                    options.currentRows.push({ bindingPath: childrenList[1], primaryValue: childrenList[0].split(':')[1] });
                }
                if (currentRowId) {
                    if (validateRule.bindingPath.split('/').filter(function (p) { return p; }).length !== 0) {
                        var primaryValue = object && typeof object['getMainEntityPrimaryValue'] === 'function' && object.getMainEntityPrimaryValue();
                        options.currentRows.push({ bindingPath: '/', primaryValue: primaryValue });
                    }
                    options.currentRow = { bindingPath: validateRule.bindingPath, primaryValue: currentRowId };
                }
                else {
                    var primaryValue = object && typeof object['getMainEntityPrimaryValue'] === 'function' && object.getMainEntityPrimaryValue();
                    options.currentRows.push({ bindingPath: '/', primaryValue: primaryValue });
                }
                var result = validateRule.eval(options);
                if (validateRule.type === "require" /* Require */) {
                    var isValid = this.required(value, isMultLanguageField);
                    if (result) {
                        return isValid;
                    }
                    else {
                        return true;
                    }
                }
                else {
                    return result;
                }
            }
        }
        return true;
    };
    Validator.prototype.buildErrors = function (errors) {
        var msg = new Set(ValidationUtils.createDetailedErrorMessage(errors));
        var newMsg = [];
        msg.forEach(function (v) {
            newMsg.push(v);
        });
        return {
            isValid: errors.length === 0,
            errors: errors,
            message: newMsg.join('')
        };
    };
    /** 自定义验证 */
    Validator.prototype.customValidation = function (value, comparison) {
        return comparison;
    };
    Validator.prototype.isEmptyValue = function (value) {
        var result = value === '' || value === null || value === undefined
            || value === '0001-01-01' || value === '0001-01-01 00:00:00' || value === '0001-01-01T00:00:00';
        return result;
    };
    /** 必填项 */
    Validator.prototype.required = function (value, isMultLanguageField) {
        if (isMultLanguageField) {
            var currentLanguage = TranslateService.getCurrentLanguage();
            if (Object.keys(value).length < 1) {
                return false;
            }
            // 如果能够获取到当前语言，那么当前语言对应的输入不能为空
            if (currentLanguage) {
                return !!value[currentLanguage];
            }
            // 如果当前语言为空，那么必填要求至少有一个输入
            // const allEmpty = Object.values(value).every((v: any) => !v || v.length < 1); // .filter((v: any) => !v || v.length < 1);
            // if (allEmpty) {
            //   return false;
            // }
            return true;
        }
        if (typeof value === 'object' && value !== null) {
            if (!Object.keys(value).length) {
                return false;
            }
            value = Object.values(value)[0];
        }
        // tslint:disable: max-line-length
        return value !== '' && value !== null && value !== undefined
            && value !== '0001-01-01' && value !== '0001-01-01 00:00:00' && value !== '0001-01-01T00:00:00';
    };
    /** 判断两个值是否相等 */
    Validator.prototype.equals = function (value, comparison) {
        return value === comparison;
    };
    /**
     * 检查 value 是否不等于参照值
     * @param value 要检查的值
     * @param comparison 对比参照值
     */
    Validator.prototype.notEquals = function (value, comparison) {
        return value !== comparison;
    };
    /**
     * 判断value 是否为数字
     * @param value 要检查的值
     * @param options 验证选项
     */
    Validator.prototype.isNumber = function (value, options) {
        if (options === void 0) { options = {}; }
        if (value === Infinity || value === -Infinity) {
            return options.allowInfinity;
        }
        if (Number.isNaN(value)) {
            return options.allowNaN;
        }
        return Number.isFinite(value);
    };
    /** 判断value是否为整数 */
    Validator.prototype.isInt = function (value) {
        return Number.isInteger(value);
    };
    /** 是否为浮点类型 */
    Validator.prototype.isFloat = function (value) {
        if (this.isNumber(value) || this.isNumberString(value)) {
            return this.validatorJs.isFloat(value);
        }
        return false;
    };
    /**
     * 检查给定的value 是否布尔值
     */
    Validator.prototype.isBoolean = function (value) {
        return value instanceof Boolean || typeof value === 'boolean';
    };
    /**
     * 检查给定的value 是否为字符串
     */
    Validator.prototype.isString = function (value) {
        return value instanceof String || typeof value === 'string';
    };
    /**
     * 检查给定的value 是否为日期
     */
    Validator.prototype.isDate = function (value) {
        return value instanceof Date && !isNaN(value.getTime());
    };
    /**
     * 检查给定的value 是否为日期字符串
     */
    Validator.prototype.isDateString = function (value) {
        var regex = /\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])(T|\s?)?(([0-2]\d:[0-5]\d)?(:[0-5]\d(?:\.\d+)))?(?:Z|\+[0-2]\d(?:\:[0-5]\d)?)?/g;
        return this.isString(value) && regex.test(value) && this.validatorJs.toDate(value);
    };
    /** 判断value 的长度是否在允许的最小值 和最大值之间 */
    Validator.prototype.length = function (value, min, max, isMultLanguageField) {
        return typeof value === 'string' && this.validatorJs.isLength(value, min, max);
    };
    /**
     * 检查给定的value的长度是否符合设定的最小值
     * @param value 待检查的字符串
     * @param min 最小长度
     */
    Validator.prototype.minLength = function (value, isMultLanguageField, min) {
        if (isMultLanguageField) {
            // const currentLanguage = TranslateService.getCurrentLanguage();
            if (typeof value === 'object') {
                var hasInvalidLangs = Object.values(value).filter(function (v) { return v && v.length < min; });
                if (hasInvalidLangs && hasInvalidLangs.length > 0) {
                    return false;
                }
            }
            // if (currentLanguage) {
            //   return value[currentLanguage] ? value[currentLanguage].length > min : true;
            // }
            // 如果无法获取当前语言，则只要有一种语言的输入长度大于最小长度即可。
            // const hasValidLangs = Object.values(value).filter((v: any) => v && v.length > min);
            // if (hasValidLangs.length > 0) {
            //   return true;
            // }
            // return false;
            return true;
        }
        if (value && typeof value !== 'string') {
            value = value.toString();
        }
        return !value || (typeof value === 'string' && this.length(value, min));
    };
    /**
     * 检查给定的value的长度是否符合设定的最大值
     * @param value 待检查的字符串
     * @param max 最大长度
     */
    Validator.prototype.maxLength = function (value, isMultLanguageField, max) {
        if (isMultLanguageField) {
            // const currentLanguage = TranslateService.getCurrentLanguage();
            // if (currentLanguage) {
            //   return value[currentLanguage] ? value[currentLanguage].length < max : true;
            // }
            if (typeof value === 'object') {
                var hasInvalidLangs = Object.values(value).filter(function (v) { return v && v.length > max; });
                if (hasInvalidLangs.length > 0) {
                    return false;
                }
            }
            return true;
        }
        if (typeof value === 'object') {
            for (var key in value) {
                if (value.hasOwnProperty(key)) {
                    var element = value[key];
                    if (typeof element === 'string' && !this.length(value[key], 0, max)) {
                        return false;
                    }
                }
            }
            return true;
        }
        if (value && typeof value !== 'string') {
            value = value.toString();
        }
        return !value || (typeof value === 'string' && this.length(value, 0, max));
    };
    /** 检查value的值是否在 最大值与最小值之间 */
    Validator.prototype.range = function (value, isMultLanguageField, min, max) {
        return typeof value === 'number' && this.isNumber(min) && this.isNumber(max) && value >= min && value <= max;
    };
    /**
     * 日期类型的值是否在某个区间
     * @param value value
     * @param min 最小值
     * @param max 最大值
     */
    Validator.prototype.dateRange = function (value, isMultLanguageField, rule, type) {
        // 2010~2020|04~05|03 11:00:00~05 12:00:00
        if (!value) {
            return true;
        }
        if (type === 'maxValue' || type === 'maxDate') {
            if (this.isYearRange(value) || this.isMonthOrDayRange(value)) {
                return this.maxValue(parseInt(this.getRangeValue(value, 1)), isMultLanguageField, parseInt(rule.split(' ')[0]));
            }
            else if (this.isDayTimeRange(value)) {
                return true;
            }
        }
        else if (type === 'minValue' || type === 'minDate') {
            if (this.isYearRange(value) || this.isMonthOrDayRange(value)) {
                return this.maxValue(parseInt(this.getRangeValue(value, 0)), isMultLanguageField, parseInt(rule.split(' ')[0]));
            }
            else if (this.isDayTimeRange(value)) {
                return true;
            }
        }
        return false;
    };
    Validator.prototype.getRangeValue = function (value, position, splitor) {
        if (splitor === void 0) { splitor = '~'; }
        return value.split(splitor)[position];
    };
    Validator.prototype.isDateRange = function (value) {
        if (typeof value !== 'string') {
            value = value.toString();
        }
        return /(\d{4}|\d{2})/.test(value);
    };
    /**
     * 是否年度区间
     * @param value value
     */
    Validator.prototype.isYearRange = function (value) {
        if (typeof value !== 'string') {
            value = value.toString();
        }
        return /^\d{4}~\d{4}$/.test(value);
    };
    /**
     * 是否为年月区间
     * @param value value
     */
    Validator.prototype.isYearMonthRange = function (value) {
        if (typeof value !== 'string') {
            value = value.toString();
        }
        return /^\d{4}-\d{2}~\d{4}-\d{2}$/.test(value);
    };
    /**
     * 是否为月或天的区间
     * @param value value
     */
    Validator.prototype.isMonthOrDayRange = function (value) {
        if (typeof value !== 'string') {
            value = value.toString();
        }
        return /^[0|1|2|3]\d{1}~[0|1|2|3]\d{1}$/.test(value);
    };
    /**
     * 是否为天+时间的区间
     * @param value value
     */
    Validator.prototype.isDayTimeRange = function (value) {
        if (typeof value !== 'string') {
            value = value.toString();
        }
        return /^[0|1|2|3]\d{1} \d{2}:\d{2}:\d{2}~[0|1|2|3]\d{1} \d{2}:\d{2}:\d{2}$/.test(value);
    };
    /**
     * Checks if the first number is greater than second.
     */
    Validator.prototype.min = function (num, isMultLanguageField, min) {
        return typeof num === 'number' && typeof min === 'number' && num >= min;
    };
    /**
     * 最小值验证
     */
    Validator.prototype.minValue = function (num, isMultLanguageField, min) {
        // 如果值不存在，则不进行最小值的判断
        if (num === null || num === undefined) {
            return true;
        }
        // 按照大数处理
        if (typeof num === 'string' && num.match(/^(-?\d+)(\.\d+)?$/g)) {
            var value = new BigNumber(num);
            var maxValue = new BigNumber(min);
            return value.isGreaterThanOrEqualTo(maxValue);
        }
        return typeof num === 'number' && typeof min === 'number' && num >= min;
    };
    /**
     * Checks if the first number is less than second.
     */
    Validator.prototype.max = function (num, isMultLanguageField, max) {
        // 如果值不存在，则不进行最小值的判断
        if (num === null || num === undefined) {
            return true;
        }
        return typeof num === 'number' && typeof max === 'number' && num <= max;
    };
    /**
     * 最大值验证
     */
    Validator.prototype.maxValue = function (num, isMultLanguageField, max) {
        // 如果值不存在，则不进行最小值的判断
        if (num === null || num === undefined) {
            return true;
        }
        // 按照大数处理
        if (typeof num === 'string' && num.match(/^(-?\d+)(\.\d+)?$/g)) {
            var value = new BigNumber(num);
            var maxValue = new BigNumber(max);
            return value.isLessThanOrEqualTo(maxValue);
        }
        return typeof num === 'number' && typeof max === 'number' && num <= max;
    };
    /**
     * Checks if the value is a date that's after the specified date.
     */
    Validator.prototype.minDate = function (date, isMultLanguageField, minDate) {
        if (!date) {
            return true;
        }
        return date && date.getTime() >= minDate.getTime();
    };
    /**
     * Checks if the value is a date that's before the specified date.
     */
    Validator.prototype.maxDate = function (date, isMultLanguageField, maxDate) {
        // 如果值不存在，则不进行最小值的判断
        if (date === null || date === undefined) {
            return true;
        }
        return date && date.getTime() <= maxDate.getTime();
    };
    /**
     * Checks if a string is a boolean.
     * If given value is not a string, then it returns false.
     */
    Validator.prototype.isBooleanString = function (value) {
        return typeof value === 'string' && this.validatorJs.isBoolean(value);
    };
    /**
     * Checks if the string is numeric.
     * If given value is not a string, then it returns false.
     */
    Validator.prototype.isNumberString = function (value) {
        return typeof value === 'string' && this.validatorJs.isNumeric(value);
    };
    /**
     * Checks if the string contains the seed.
     * If given value is not a string, then it returns false.
     */
    Validator.prototype.contains = function (value, isMultLanguageField, seed) {
        return typeof value === 'string' && this.validatorJs.contains(value, seed);
    };
    /**
     * Checks if the string does not contain the seed.
     * If given value is not a string, then it returns false.
     */
    Validator.prototype.notContains = function (value, isMultLanguageField, seed) {
        return typeof value === 'string' && !this.validatorJs.contains(value, seed);
    };
    /**
     * Checks if the string is an email.
     * If given value is not a string, then it returns false.
     */
    Validator.prototype.isEmail = function (value) {
        return typeof value === 'string' && this.validatorJs.isEmail(value);
    };
    /**
     * Checks if the string is valid JSON (note: uses JSON.parse).
     * If given value is not a string, then it returns false.
     */
    Validator.prototype.isJSON = function (value) {
        return typeof value === 'string' && this.validatorJs.isJSON(value);
    };
    /**
     * Checks if the string is lowercase.
     * If given value is not a string, then it returns false.
     */
    Validator.prototype.isLowercase = function (value) {
        return typeof value === 'string' && this.validatorJs.isLowercase(value);
    };
    /**
     * Checks if the string is uppercase.
     * If given value is not a string, then it returns false.
     */
    Validator.prototype.isUppercase = function (value) {
        return typeof value === 'string' && this.validatorJs.isUppercase(value);
    };
    /**
     * 验证字符串是否包含非法字符
     * @param value 验证的字符串
     * @param someChars 非法字符。如：#￥%@$
     */
    Validator.prototype.exclude = function (value, isMultLanguageField, someChars) {
        var _this = this;
        var arrChar = someChars.split('');
        var counter = 0;
        arrChar.forEach(function (val) {
            if (_this.contains(value, isMultLanguageField, val)) {
                counter++;
            }
        });
        return counter === 0;
    };
    /**
     * 自定义正则验证
     * @param value 待验证的字符串
     * @param pattern 正则表达式
     */
    Validator.prototype.matches = function (value, isMultLanguageField, pattern) {
        value = (value === null || value === undefined) ? '' : value.toString();
        if (value === '') {
            return true;
        }
        return this.validatorJs.matches(value, pattern);
    };
    return Validator;
}());
export { Validator };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmFsaWRhdG9yLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9kZXZraXQvIiwic291cmNlcyI6WyJsaWIvZW50aXR5L3ZhbGlkYXRvci92YWxpZGF0b3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sS0FBSyxXQUFXLE1BQU0sV0FBVyxDQUFDO0FBRXpDLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUdyRCxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUMzRCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDckQsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQ2pELE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBQ2hFLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFJekM7O0dBRUc7QUFDSDtJQUNFO1FBRVEsZ0JBQVcsR0FBRyxXQUFXLENBQUMsT0FBTyxDQUFDO0lBRjFCLENBQUM7SUFHakI7Ozs7T0FJRztJQUNILDRDQUE0QztJQUM1Qyw0QkFBUSxHQUFSLFVBQVMsTUFBUyxFQUFFLFlBQXFCLEVBQUUsS0FBTSxFQUFFLGFBQTJDLEVBQUUsS0FBYyxFQUFFLFlBQTJCO1FBQTNJLGlCQVNDO1FBUkMsSUFBTSxnQkFBZ0IsR0FBc0IsRUFBRSxDQUFDO1FBQy9DLElBQU0sUUFBUSxHQUFHLElBQUksa0JBQWtCLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDOUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUUsS0FBSyxFQUFFLGdCQUFnQixFQUFFLFlBQVksRUFBRSxLQUFLLEVBQUUsYUFBYSxFQUFFLElBQUksRUFBRSxZQUFZLENBQUMsQ0FBQztRQUMxRyxPQUFPLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLGdCQUFnQixDQUFDLENBQUMsSUFBSSxDQUFDO1lBQ2pELElB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QkFBbUIsRUFBRSxHQUFHLENBQUMsRUFBRTtnQkFDbEQsT0FBTyxFQUFFLENBQUM7YUFDWDtRQUNILENBQUMsQ0FBQyxDQUFDO1FBRUgsT0FBTyxPQUFPLEtBQUssQ0FBQyxDQUFDO0lBQ3ZCLENBQUM7SUFFRDs7OztPQUlHO0lBQ0gsMkJBQU8sR0FBUCxVQUFRLEtBQWEsRUFBRSxtQkFBNEIsRUFBRSxPQUFZO1FBQy9ELEtBQUssR0FBRyxDQUFDLEtBQUssS0FBSyxJQUFJLElBQUksS0FBSyxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUN4RSxJQUFJLEtBQUssS0FBSyxFQUFFLEVBQUU7WUFDaEIsT0FBTyxJQUFJLENBQUM7U0FDYjtRQUNELE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQ2xELENBQUM7SUFDSCxnQkFBQztBQUFELENBQUMsQUExbEJELElBMGxCQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIFZhbGlkYXRvckpTIGZyb20gJ3ZhbGlkYXRvcic7XHJcbmltcG9ydCB7IFZhbGlkYXRlUnVsZSwgSXNOdW1iZXJPcHRpb25zLCBWYWxpZGF0aW9uUmVzdWx0IH0gZnJvbSAnLi90eXBlcyc7XHJcbmltcG9ydCB7IFZhbGlkYXRpb25UeXBlcyB9IGZyb20gJy4vdmFsaWRhdGlvbl90eXBlcyc7XHJcbmltcG9ydCB7IFZhbGlkYXRpb25FcnJvciB9IGZyb20gJy4vdmFsaWRhdGlvbl9lcnJvcic7XHJcbmltcG9ydCB7IEVudGl0eSB9IGZyb20gJy4uL2VudGl0eSc7XHJcbmltcG9ydCB7IFZhbGlkYXRpb25FeGVjdXRvciB9IGZyb20gJy4vdmFsaWRhdGlvbl9leGVjdXRvcic7XHJcbmltcG9ydCB7IFZhbGlkYXRpb25VdGlscyB9IGZyb20gJy4vdmFsaWRhdGlvbl91dGlscyc7XHJcbmltcG9ydCB7IERhdGVVdGlsIH0gZnJvbSAnLi4vLi4vdXRpbHMvZGF0ZV91dGlsJztcclxuaW1wb3J0IHsgVHJhbnNsYXRlU2VydmljZSB9IGZyb20gJy4uLy4uL2kxOG4vdHJhbnNsYXRlX3NlcnZpY2UnO1xyXG5pbXBvcnQgeyBCaWdOdW1iZXIgfSBmcm9tICdiaWdudW1iZXIuanMnO1xyXG5pbXBvcnQgeyBSdWxlVHlwZSB9IGZyb20gJy4uLy4uL2Zvcm0vaW5kZXgnO1xyXG5pbXBvcnQgeyBGcmFtZUNvbnRleHQgfSBmcm9tICcuLi8uLi9mcmFtZS9pbmRleCc7XHJcblxyXG4vKipcclxuICog5qCh6aqM5a6e5L2T5a6e5L6L5a+56LGh5pWw5o2uXHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgVmFsaWRhdG9yPFQgZXh0ZW5kcyBFbnRpdHk+IHtcclxuICBjb25zdHJ1Y3RvcigpIHsgfVxyXG5cclxuICBwcml2YXRlIHZhbGlkYXRvckpzID0gVmFsaWRhdG9ySlMuZGVmYXVsdDtcclxuICAvKipcclxuICAgKiDpqozor4Hlrp7kvovlr7nosaHkuK3mlbDmja7mmK/lkKblkIjms5VcclxuICAgKiBAcGFyYW0gb2JqZWN0IOW+heagoemqjOeahOWunuS+i+WvueixoVxyXG4gICAqIEBwYXJhbSBwcm9wZXJ0eU5hbWUg5b6F5qCh6aqM5a6e5L6L5a+56LGh5bGe5oCn5ZCN56ew77yM5Li656m65YiZ6aqM6K+B5a6e5L6L5a+56LGh5Lit5omA5pyJ5bim5pyJ6aqM6K+B6KeE5YiZ55qE5bGe5oCnXHJcbiAgICovXHJcbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBtYXgtbGluZS1sZW5ndGhcclxuICB2YWxpZGF0ZShvYmplY3Q6IFQsIHByb3BlcnR5TmFtZT86IHN0cmluZywgdmFsdWU/LCBleHRlcm5hbFJ1bGVzPzogTWFwPHN0cmluZywgVmFsaWRhdGVSdWxlW10+LCBpbmRleD86IG51bWJlciwgZnJhbWVDb250ZXh0PzogRnJhbWVDb250ZXh0KTogUHJvbWlzZTxWYWxpZGF0aW9uUmVzdWx0PiB7XHJcbiAgICBjb25zdCB2YWxpZGF0aW9uRXJyb3JzOiBWYWxpZGF0aW9uRXJyb3JbXSA9IFtdO1xyXG4gICAgY29uc3QgZXhlY3V0b3IgPSBuZXcgVmFsaWRhdGlvbkV4ZWN1dG9yKHRoaXMpO1xyXG4gICAgZXhlY3V0b3IuZXhlY3V0ZShvYmplY3QsIHZhbHVlLCB2YWxpZGF0aW9uRXJyb3JzLCBwcm9wZXJ0eU5hbWUsIGluZGV4LCBleHRlcm5hbFJ1bGVzLCBudWxsLCBmcmFtZUNvbnRleHQpO1xyXG4gICAgcmV0dXJuIFByb21pc2UuYWxsKGV4ZWN1dG9yLmF3YWl0aW5nUHJvbWlzZXMpLnRoZW4oKCkgPT4ge1xyXG4gICAgICBjb25zdCBlcnJvcnMgPSBleGVjdXRvci5zdHJpcEVtcHR5RXJyb3JzKHZhbGlkYXRpb25FcnJvcnMpO1xyXG4gICAgICB0aGlzLnNvcnRWYWxpZGF0aW9uRXJyb3JzKGVycm9ycyk7XHJcbiAgICAgIHJldHVybiB0aGlzLmJ1aWxkRXJyb3JzKGVycm9ycyk7XHJcbiAgICB9KTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5qCh6aqM5L+h5oGv5o6S5bqP77yI5Li65LqG5YW85a655qCR5b2i6KGo77yJXHJcbiAgICogQHBhcmFtIHZhbGlkYXRpb25FcnJvcnMg6aqM6K+B5L+h5oGv5pWw57uEXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzb3J0VmFsaWRhdGlvbkVycm9ycyh2YWxpZGF0aW9uRXJyb3JzOiBWYWxpZGF0aW9uRXJyb3JbXSkge1xyXG4gICAgLy8g5aaC5p6c5a2Y5Zyo5peg5bqP5Y+355qE5L+h5oGv5YiZ5LiN5o6S5bqPXHJcbiAgICBsZXQgc29ydGFibGU6IGJvb2xlYW4gPSB0cnVlO1xyXG4gICAgdmFsaWRhdGlvbkVycm9ycy5mb3JFYWNoKGluZm8gPT4ge1xyXG4gICAgICBpZiAoaW5mby5jaGlsZHJlbiAmJiBpbmZvLmNoaWxkcmVuLmxlbmd0aCA+IDEpIHtcclxuICAgICAgICB0aGlzLnNvcnRWYWxpZGF0aW9uRXJyb3JzKGluZm8uY2hpbGRyZW4pO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICh0eXBlb2YgaW5mby5pbmRleCAhPT0gXCJudW1iZXJcIikge1xyXG4gICAgICAgIHNvcnRhYmxlID0gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgaWYgKHNvcnRhYmxlKSB7XHJcbiAgICAgIHZhbGlkYXRpb25FcnJvcnMuc29ydCgoYSwgYikgPT4gYS5pbmRleCAtIGIuaW5kZXgpO1xyXG4gICAgfVxyXG4gIH1cclxuICAvKipcclxuICAgKiDmiafooYzmoKHpqoxcclxuICAgKiBAcGFyYW0gb2JqZWN0IFxyXG4gICAqIEBwYXJhbSBwcm9wZXJ0eU5hbWUgXHJcbiAgICogQHBhcmFtIHZhbHVlIFxyXG4gICAqIEBwYXJhbSBleHRlcm5hbFJ1bGVzIFxyXG4gICAqIEBwYXJhbSBpbmRleCBcclxuICAgKiBAcGFyYW0gZnJhbWVDb250ZXh0IFxyXG4gICAqIEBwYXJhbSBpZ25vcmVBc3luY1ZhbGlkYXRlUnVsZXNcclxuICAgKiBAcmV0dXJucyBcclxuICAgKi9cclxuICBwdWJsaWMgdmVyaWZ5KG9iamVjdDogVCwgcHJvcGVydHlOYW1lPzogc3RyaW5nLCB2YWx1ZT8sIGV4dGVybmFsUnVsZXM/OiBNYXA8c3RyaW5nLCBWYWxpZGF0ZVJ1bGVbXT4sIGluZGV4PzogbnVtYmVyLCBmcmFtZUNvbnRleHQ/OiBGcmFtZUNvbnRleHQsIGlnbm9yZUFzeW5jVmFsaWRhdGVSdWxlczogYm9vbGVhbiA9IGZhbHNlKTogUHJvbWlzZTxWYWxpZGF0aW9uUmVzdWx0PiB8IHsgaXNWYWxpZDogYm9vbGVhbiwgZXJyb3JzOiBhbnksIG1lc3NhZ2U6IHN0cmluZyB9IHtcclxuICAgIGNvbnN0IHZhbGlkYXRpb25FcnJvcnM6IFZhbGlkYXRpb25FcnJvcltdID0gW107XHJcbiAgICBjb25zdCBleGVjdXRvciA9IG5ldyBWYWxpZGF0aW9uRXhlY3V0b3IodGhpcyk7XHJcbiAgICBleGVjdXRvci5leGVjdXRlKG9iamVjdCwgdmFsdWUsIHZhbGlkYXRpb25FcnJvcnMsIHByb3BlcnR5TmFtZSwgaW5kZXgsIGV4dGVybmFsUnVsZXMsIG51bGwsIGZyYW1lQ29udGV4dCk7XHJcbiAgICBpZiAoZXhlY3V0b3IuYXdhaXRpbmdQcm9taXNlcyAmJiBleGVjdXRvci5hd2FpdGluZ1Byb21pc2VzLmxlbmd0aCA+IDAgJiYgaWdub3JlQXN5bmNWYWxpZGF0ZVJ1bGVzID09PSBmYWxzZSkge1xyXG4gICAgICByZXR1cm4gUHJvbWlzZS5hbGwoZXhlY3V0b3IuYXdhaXRpbmdQcm9taXNlcykudGhlbigoKSA9PiB7XHJcbiAgICAgICAgY29uc3QgZXJyb3JzID0gZXhlY3V0b3Iuc3RyaXBFbXB0eUVycm9ycyh2YWxpZGF0aW9uRXJyb3JzKTtcclxuICAgICAgICBjb25zdCByZXN1bHQgPSB0aGlzLmJ1aWxkRXJyb3JzKGVycm9ycyk7XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgfSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zdCBlcnJvcnMgPSBleGVjdXRvci5zdHJpcEVtcHR5RXJyb3JzKHZhbGlkYXRpb25FcnJvcnMpO1xyXG4gICAgICByZXR1cm4gdGhpcy5idWlsZEVycm9ycyhlcnJvcnMpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6aqM6K+B5a6e5L2T5bGe5oCn5YWD5pWw5o2u5Lit6K6+572u55qE5qCh6aqM6KeE5YiZ5piv5ZCm5ZCI5rOVXHJcbiAgICogQHBhcmFtIG9iamVjdCDlrp7kvovlr7nosaFcclxuICAgKiBAcGFyYW0gdmFsdWUg5b6F5qCh6aqM55qE5YC8XHJcbiAgICogQHBhcmFtIHZhbGlkYXRlUnVsZSDpqozor4Hop4TliJlcclxuICAgKi9cclxuICB2YWxpZGF0ZVZhbHVlQnlNZXRhZGF0YShvYmplY3Q6IGFueSwgdmFsdWU6IGFueSwgdmFsaWRhdGVSdWxlOiBWYWxpZGF0ZVJ1bGUsIGlzTXVsdExhbmd1YWdlRmllbGQ/OiBib29sZWFuLCBjdXJyZW50Um93SWQ/OiBzdHJpbmcpOiBib29sZWFuIHwgYW55IHtcclxuICAgIGNvbnN0IHZhbGlkVHlwZSA9IHZhbGlkYXRlUnVsZS50eXBlO1xyXG4gICAgbGV0IGNvbnN0cmFpbnRzVG9WYWxpZGF0ZSA9IFtdO1xyXG4gICAgaWYgKHZhbGlkYXRlUnVsZS5jb25zdHJhaW50cykge1xyXG4gICAgICBjb25zdHJhaW50c1RvVmFsaWRhdGUgPSB2YWxpZGF0ZVJ1bGUuY29uc3RyYWludHMubWFwKHBhcmFtID0+IHtcclxuICAgICAgICBpZiAodHlwZW9mIHBhcmFtID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICByZXR1cm4gcGFyYW0ob2JqZWN0LCB2YWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBwYXJhbTtcclxuICAgICAgfSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB2YWxpZGF0ZVJ1bGUuY29uc3RyYWludHMgPSBbXTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoVmFsaWRhdGlvblR5cGVzLmlzVmFsaWRUeXBlKHZhbGlkVHlwZSkpIHtcclxuICAgICAgaWYgKHZhbGlkVHlwZSA9PT0gVmFsaWRhdGlvblR5cGVzLk1BWFZBTFVFKSB7XHJcbiAgICAgICAgY29uc3QgcnVsZSA9IGNvbnN0cmFpbnRzVG9WYWxpZGF0ZVswXTtcclxuICAgICAgICBpZiAodGhpcy5pc0RhdGVTdHJpbmcodmFsdWUpIHx8IHRoaXMuaXNEYXRlKHZhbHVlKSB8fCB0aGlzLmlzRGF0ZVN0cmluZyhydWxlKSB8fCB0aGlzLmlzRGF0ZShydWxlKSkge1xyXG4gICAgICAgICAgLy8g5aaC5p6c5pel5pyf5YC85LiN5a2Y5Zyo77yM5YiZ5LiN5Yik5pat5aSn5bCPXHJcbiAgICAgICAgICBpZiAoIXZhbHVlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgaWYgKHZhbHVlLmluZGV4T2YoJ34nKSAhPT0gLTEpIHtcclxuICAgICAgICAgICAgLy8g5LiN5a+55pel5pyf5Yy66Ze06L+b6KGM5qCh6aqMXHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgcmV0dXJuIHRoaXNbVmFsaWRhdGlvblR5cGVzLk1BWF9EQVRFXShEYXRlVXRpbC5wYXJzZSh2YWx1ZSksIGlzTXVsdExhbmd1YWdlRmllbGQsIG5ldyBEYXRlKGNvbnN0cmFpbnRzVG9WYWxpZGF0ZVswXSkpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByZXR1cm4gdGhpc1tWYWxpZGF0aW9uVHlwZXMuTUFYVkFMVUVdKHZhbHVlLCBpc011bHRMYW5ndWFnZUZpZWxkLCBjb25zdHJhaW50c1RvVmFsaWRhdGVbMF0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIGlmICh2YWxpZFR5cGUgPT09IFZhbGlkYXRpb25UeXBlcy5NSU5WQUxVRSkge1xyXG4gICAgICAgIC8vIOWmguaenOaYr251bGzmiJZ1bmRlZmluZWTvvIznm7TmjqXov5Tlm550cnVlXHJcbiAgICAgICAgaWYgKGNvbnN0cmFpbnRzVG9WYWxpZGF0ZVswXSA9PT0gbnVsbCB8fCBjb25zdHJhaW50c1RvVmFsaWRhdGVbMF0gPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmlzRGF0ZVN0cmluZyh2YWx1ZSkgfHwgdGhpcy5pc0RhdGUodmFsdWUpKSB7XHJcbiAgICAgICAgICBpZiAoY29uc3RyYWludHNUb1ZhbGlkYXRlWzBdID09PSAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgcmV0dXJuIHRoaXNbVmFsaWRhdGlvblR5cGVzLk1JTl9EQVRFXShEYXRlVXRpbC5wYXJzZSh2YWx1ZSksIGlzTXVsdExhbmd1YWdlRmllbGQsIERhdGVVdGlsLnBhcnNlKGNvbnN0cmFpbnRzVG9WYWxpZGF0ZVswXSkpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5pc051bWJlcih2YWx1ZSkpIHtcclxuICAgICAgICAgIHJldHVybiB0aGlzW1ZhbGlkYXRpb25UeXBlcy5NSU5dKHZhbHVlLCBpc011bHRMYW5ndWFnZUZpZWxkLCBjb25zdHJhaW50c1RvVmFsaWRhdGVbMF0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXR1cm4gdGhpc1t2YWxpZFR5cGVdKHZhbHVlLCBpc011bHRMYW5ndWFnZUZpZWxkLCAuLi5jb25zdHJhaW50c1RvVmFsaWRhdGUpO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBpZiAodHlwZW9mIHZhbGlkYXRlUnVsZS5ldmFsID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgY29uc3QgYmluZGluZ1BhdGggPSB2YWxpZGF0ZVJ1bGUuYmluZGluZ1BhdGg7XHJcbiAgICAgICAgY29uc3QgYmluZGluZ1BhdGhzID0gYmluZGluZ1BhdGguc3BsaXQoJy8nKS5maWx0ZXIocCA9PiBwKTtcclxuICAgICAgICBsZXQgZmllbGROYW1lID0gdmFsaWRhdGVSdWxlLmZpZWxkO1xyXG4gICAgICAgIGlmIChiaW5kaW5nUGF0aHMubGVuZ3RoICE9PSAwKSB7XHJcbiAgICAgICAgICBjb25zdCBwcmVmaXggPSBiaW5kaW5nUGF0aHMuam9pbignLycpO1xyXG4gICAgICAgICAgZmllbGROYW1lID0gYCR7cHJlZml4fS8ke2ZpZWxkTmFtZS5zcGxpdCgnLicpLmZpbHRlcihwID0+IHApLmpvaW4oJy8nKX1gO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBvcHRpb25zOiBhbnkgPSB7IHBhdGNoOiB7IFtmaWVsZE5hbWVdOiB2YWx1ZSB9IH07XHJcbiAgICAgICAgb3B0aW9ucy5jdXJyZW50Um93cyA9IFtdO1xyXG4gICAgICAgIGNvbnN0IHBhcmVudEVudGl0eUxpc3RQYXRoczogc3RyaW5nW10gPSBvYmplY3QgJiYgdHlwZW9mIG9iamVjdFsnZ2V0RW50aXR5TGlzdFBhdGgnXSA9PT0gJ2Z1bmN0aW9uJyAmJiBvYmplY3QuZ2V0RW50aXR5TGlzdFBhdGgoKTtcclxuICAgICAgICBpZiAocGFyZW50RW50aXR5TGlzdFBhdGhzLmxlbmd0aCA9PT0gNCkge1xyXG4gICAgICAgICAgY29uc3QgY2hpbGRyZW5MaXN0ID0gcGFyZW50RW50aXR5TGlzdFBhdGhzLnNsaWNlKDEsIDMpLnJldmVyc2UoKTtcclxuICAgICAgICAgIG9wdGlvbnMuY3VycmVudFJvd3MucHVzaCh7IGJpbmRpbmdQYXRoOiBjaGlsZHJlbkxpc3RbMV0sIHByaW1hcnlWYWx1ZTogY2hpbGRyZW5MaXN0WzBdLnNwbGl0KCc6JylbMV0gfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChjdXJyZW50Um93SWQpIHtcclxuICAgICAgICAgIGlmICh2YWxpZGF0ZVJ1bGUuYmluZGluZ1BhdGguc3BsaXQoJy8nKS5maWx0ZXIocCA9PiBwKS5sZW5ndGggIT09IDApIHtcclxuICAgICAgICAgICAgY29uc3QgcHJpbWFyeVZhbHVlID0gb2JqZWN0ICYmIHR5cGVvZiBvYmplY3RbJ2dldE1haW5FbnRpdHlQcmltYXJ5VmFsdWUnXSA9PT0gJ2Z1bmN0aW9uJyAmJiBvYmplY3QuZ2V0TWFpbkVudGl0eVByaW1hcnlWYWx1ZSgpO1xyXG4gICAgICAgICAgICBvcHRpb25zLmN1cnJlbnRSb3dzLnB1c2goeyBiaW5kaW5nUGF0aDogJy8nLCBwcmltYXJ5VmFsdWU6IHByaW1hcnlWYWx1ZSB9KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIG9wdGlvbnMuY3VycmVudFJvdyA9IHsgYmluZGluZ1BhdGg6IHZhbGlkYXRlUnVsZS5iaW5kaW5nUGF0aCwgcHJpbWFyeVZhbHVlOiBjdXJyZW50Um93SWQgfTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgY29uc3QgcHJpbWFyeVZhbHVlID0gb2JqZWN0ICYmIHR5cGVvZiBvYmplY3RbJ2dldE1haW5FbnRpdHlQcmltYXJ5VmFsdWUnXSA9PT0gJ2Z1bmN0aW9uJyAmJiBvYmplY3QuZ2V0TWFpbkVudGl0eVByaW1hcnlWYWx1ZSgpO1xyXG4gICAgICAgICAgb3B0aW9ucy5jdXJyZW50Um93cy5wdXNoKHsgYmluZGluZ1BhdGg6ICcvJywgcHJpbWFyeVZhbHVlOiBwcmltYXJ5VmFsdWUgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCByZXN1bHQgPSB2YWxpZGF0ZVJ1bGUuZXZhbChvcHRpb25zKTtcclxuICAgICAgICBpZiAodmFsaWRhdGVSdWxlLnR5cGUgPT09IFJ1bGVUeXBlLlJlcXVpcmUpIHtcclxuICAgICAgICAgIGNvbnN0IGlzVmFsaWQgPSB0aGlzLnJlcXVpcmVkKHZhbHVlLCBpc011bHRMYW5ndWFnZUZpZWxkKTtcclxuICAgICAgICAgIGlmIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGlzVmFsaWQ7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcbiAgcHJpdmF0ZSBidWlsZEVycm9ycyhlcnJvcnM6IFZhbGlkYXRpb25FcnJvcltdKSB7XHJcbiAgICBjb25zdCBtc2cgPSBuZXcgU2V0KFZhbGlkYXRpb25VdGlscy5jcmVhdGVEZXRhaWxlZEVycm9yTWVzc2FnZShlcnJvcnMpKTtcclxuICAgIGNvbnN0IG5ld01zZyA9IFtdO1xyXG4gICAgbXNnLmZvckVhY2godiA9PiB7XHJcbiAgICAgIG5ld01zZy5wdXNoKHYpO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBpc1ZhbGlkOiBlcnJvcnMubGVuZ3RoID09PSAwLFxyXG4gICAgICBlcnJvcnMsXHJcbiAgICAgIG1lc3NhZ2U6IG5ld01zZy5qb2luKCcnKVxyXG4gICAgfTtcclxuICB9XHJcbiAgLyoqIOiHquWumuS5iemqjOivgSAqL1xyXG4gIGN1c3RvbVZhbGlkYXRpb24odmFsdWUsIGNvbXBhcmlzb246IGJvb2xlYW4pOiBib29sZWFuIHtcclxuICAgIHJldHVybiBjb21wYXJpc29uO1xyXG4gIH1cclxuICBwcml2YXRlIGlzRW1wdHlWYWx1ZSh2YWx1ZTogYW55KSB7XHJcbiAgICBjb25zdCByZXN1bHQgPSB2YWx1ZSA9PT0gJycgfHwgdmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZFxyXG4gICAgICB8fCB2YWx1ZSA9PT0gJzAwMDEtMDEtMDEnIHx8IHZhbHVlID09PSAnMDAwMS0wMS0wMSAwMDowMDowMCcgfHwgdmFsdWUgPT09ICcwMDAxLTAxLTAxVDAwOjAwOjAwJztcclxuICAgIHJldHVybiByZXN1bHQ7XHJcbiAgfVxyXG4gIC8qKiDlv4XloavpobkgKi9cclxuICByZXF1aXJlZCh2YWx1ZTogYW55LCBpc011bHRMYW5ndWFnZUZpZWxkPzogYm9vbGVhbik6IGJvb2xlYW4ge1xyXG4gICAgaWYgKGlzTXVsdExhbmd1YWdlRmllbGQpIHtcclxuICAgICAgY29uc3QgY3VycmVudExhbmd1YWdlID0gVHJhbnNsYXRlU2VydmljZS5nZXRDdXJyZW50TGFuZ3VhZ2UoKTtcclxuICAgICAgaWYgKE9iamVjdC5rZXlzKHZhbHVlKS5sZW5ndGggPCAxKSB7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICAgIC8vIOWmguaenOiDveWkn+iOt+WPluWIsOW9k+WJjeivreiogO+8jOmCo+S5iOW9k+WJjeivreiogOWvueW6lOeahOi+k+WFpeS4jeiDveS4uuepulxyXG4gICAgICBpZiAoY3VycmVudExhbmd1YWdlKSB7XHJcbiAgICAgICAgcmV0dXJuICEhdmFsdWVbY3VycmVudExhbmd1YWdlXTtcclxuICAgICAgfVxyXG4gICAgICAvLyDlpoLmnpzlvZPliY3or63oqIDkuLrnqbrvvIzpgqPkuYjlv4XloavopoHmsYLoh7PlsJHmnInkuIDkuKrovpPlhaVcclxuICAgICAgLy8gY29uc3QgYWxsRW1wdHkgPSBPYmplY3QudmFsdWVzKHZhbHVlKS5ldmVyeSgodjogYW55KSA9PiAhdiB8fCB2Lmxlbmd0aCA8IDEpOyAvLyAuZmlsdGVyKCh2OiBhbnkpID0+ICF2IHx8IHYubGVuZ3RoIDwgMSk7XHJcbiAgICAgIC8vIGlmIChhbGxFbXB0eSkge1xyXG4gICAgICAvLyAgIHJldHVybiBmYWxzZTtcclxuICAgICAgLy8gfVxyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICE9PSBudWxsKSB7XHJcbiAgICAgIGlmICghT2JqZWN0LmtleXModmFsdWUpLmxlbmd0aCkge1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgfVxyXG4gICAgICB2YWx1ZSA9IE9iamVjdC52YWx1ZXModmFsdWUpWzBdO1xyXG4gICAgfVxyXG4gICAgLy8gdHNsaW50OmRpc2FibGU6IG1heC1saW5lLWxlbmd0aFxyXG4gICAgcmV0dXJuIHZhbHVlICE9PSAnJyAmJiB2YWx1ZSAhPT0gbnVsbCAmJiB2YWx1ZSAhPT0gdW5kZWZpbmVkXHJcbiAgICAgICYmIHZhbHVlICE9PSAnMDAwMS0wMS0wMScgJiYgdmFsdWUgIT09ICcwMDAxLTAxLTAxIDAwOjAwOjAwJyAmJiB2YWx1ZSAhPT0gJzAwMDEtMDEtMDFUMDA6MDA6MDAnO1xyXG4gIH1cclxuXHJcbiAgLyoqIOWIpOaWreS4pOS4quWAvOaYr+WQpuebuOetiSAqL1xyXG4gIGVxdWFscyh2YWx1ZTogYW55LCBjb21wYXJpc29uOiBhbnkpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB2YWx1ZSA9PT0gY29tcGFyaXNvbjtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOajgOafpSB2YWx1ZSDmmK/lkKbkuI3nrYnkuo7lj4LnhaflgLxcclxuICAgKiBAcGFyYW0gdmFsdWUg6KaB5qOA5p+l55qE5YC8XHJcbiAgICogQHBhcmFtIGNvbXBhcmlzb24g5a+55q+U5Y+C54Wn5YC8XHJcbiAgICovXHJcbiAgbm90RXF1YWxzKHZhbHVlOiBhbnksIGNvbXBhcmlzb246IGFueSk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHZhbHVlICE9PSBjb21wYXJpc29uO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Yik5patdmFsdWUg5piv5ZCm5Li65pWw5a2XXHJcbiAgICogQHBhcmFtIHZhbHVlIOimgeajgOafpeeahOWAvFxyXG4gICAqIEBwYXJhbSBvcHRpb25zIOmqjOivgemAiemhuVxyXG4gICAqL1xyXG4gIGlzTnVtYmVyKHZhbHVlOiBhbnksIG9wdGlvbnM6IElzTnVtYmVyT3B0aW9ucyA9IHt9KTogYm9vbGVhbiB7XHJcbiAgICBpZiAodmFsdWUgPT09IEluZmluaXR5IHx8IHZhbHVlID09PSAtSW5maW5pdHkpIHtcclxuICAgICAgcmV0dXJuIG9wdGlvbnMuYWxsb3dJbmZpbml0eTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoTnVtYmVyLmlzTmFOKHZhbHVlKSkge1xyXG4gICAgICByZXR1cm4gb3B0aW9ucy5hbGxvd05hTjtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gTnVtYmVyLmlzRmluaXRlKHZhbHVlKTtcclxuICB9XHJcblxyXG4gIC8qKiDliKTmlq12YWx1ZeaYr+WQpuS4uuaVtOaVsCAqL1xyXG4gIGlzSW50KHZhbHVlOiBudW1iZXIpIHtcclxuICAgIHJldHVybiBOdW1iZXIuaXNJbnRlZ2VyKHZhbHVlKTtcclxuICB9XHJcblxyXG4gIC8qKiDmmK/lkKbkuLrmta7ngrnnsbvlnosgKi9cclxuICBpc0Zsb2F0KHZhbHVlOiBhbnkpOiBib29sZWFuIHtcclxuICAgIGlmICh0aGlzLmlzTnVtYmVyKHZhbHVlKSB8fCB0aGlzLmlzTnVtYmVyU3RyaW5nKHZhbHVlKSkge1xyXG4gICAgICByZXR1cm4gdGhpcy52YWxpZGF0b3JKcy5pc0Zsb2F0KHZhbHVlKTtcclxuICAgIH1cclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOajgOafpee7meWumueahHZhbHVlIOaYr+WQpuW4g+WwlOWAvFxyXG4gICAqL1xyXG4gIGlzQm9vbGVhbih2YWx1ZTogYW55KTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBCb29sZWFuIHx8IHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5qOA5p+l57uZ5a6a55qEdmFsdWUg5piv5ZCm5Li65a2X56ym5LiyXHJcbiAgICovXHJcbiAgaXNTdHJpbmcodmFsdWU6IGFueSk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgU3RyaW5nIHx8IHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZyc7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmo4Dmn6Xnu5nlrprnmoR2YWx1ZSDmmK/lkKbkuLrml6XmnJ9cclxuICAgKi9cclxuICBpc0RhdGUodmFsdWU6IGFueSk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgRGF0ZSAmJiAhaXNOYU4odmFsdWUuZ2V0VGltZSgpKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOajgOafpee7meWumueahHZhbHVlIOaYr+WQpuS4uuaXpeacn+Wtl+espuS4slxyXG4gICAqL1xyXG4gIGlzRGF0ZVN0cmluZyh2YWx1ZTogYW55KTogYm9vbGVhbiB7XHJcbiAgICBjb25zdCByZWdleCA9IC9cXGR7NH0tKDBbMS05XXwxWzAtMl0pLSgwWzEtOV18WzEtMl1bMC05XXwzWzAtMV0pKFR8XFxzPyk/KChbMC0yXVxcZDpbMC01XVxcZCk/KDpbMC01XVxcZCg/OlxcLlxcZCspKSk/KD86WnxcXCtbMC0yXVxcZCg/OlxcOlswLTVdXFxkKT8pPy9nO1xyXG4gICAgcmV0dXJuIHRoaXMuaXNTdHJpbmcodmFsdWUpICYmIHJlZ2V4LnRlc3QodmFsdWUpICYmIHRoaXMudmFsaWRhdG9ySnMudG9EYXRlKHZhbHVlKTtcclxuICB9XHJcblxyXG4gIC8qKiDliKTmlq12YWx1ZSDnmoTplb/luqbmmK/lkKblnKjlhYHorrjnmoTmnIDlsI/lgLwg5ZKM5pyA5aSn5YC85LmL6Ze0ICovXHJcbiAgbGVuZ3RoKHZhbHVlOiBhbnksIG1pbjogbnVtYmVyLCBtYXg/OiBudW1iZXIsIGlzTXVsdExhbmd1YWdlRmllbGQ/OiBib29sZWFuKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJyAmJiB0aGlzLnZhbGlkYXRvckpzLmlzTGVuZ3RoKHZhbHVlLCBtaW4sIG1heCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmo4Dmn6Xnu5nlrprnmoR2YWx1ZeeahOmVv+W6puaYr+WQpuespuWQiOiuvuWumueahOacgOWwj+WAvFxyXG4gICAqIEBwYXJhbSB2YWx1ZSDlvoXmo4Dmn6XnmoTlrZfnrKbkuLJcclxuICAgKiBAcGFyYW0gbWluIOacgOWwj+mVv+W6plxyXG4gICAqL1xyXG4gIG1pbkxlbmd0aCh2YWx1ZTogYW55LCBpc011bHRMYW5ndWFnZUZpZWxkOiBib29sZWFuLCBtaW46IG51bWJlcik6IGJvb2xlYW4ge1xyXG4gICAgaWYgKGlzTXVsdExhbmd1YWdlRmllbGQpIHtcclxuICAgICAgLy8gY29uc3QgY3VycmVudExhbmd1YWdlID0gVHJhbnNsYXRlU2VydmljZS5nZXRDdXJyZW50TGFuZ3VhZ2UoKTtcclxuICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcpIHtcclxuICAgICAgICBjb25zdCBoYXNJbnZhbGlkTGFuZ3MgPSBPYmplY3QudmFsdWVzKHZhbHVlKS5maWx0ZXIoKHY6IGFueSkgPT4gdiAmJiB2Lmxlbmd0aCA8IG1pbik7XHJcbiAgICAgICAgaWYgKGhhc0ludmFsaWRMYW5ncyAmJiBoYXNJbnZhbGlkTGFuZ3MubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICAvLyBpZiAoY3VycmVudExhbmd1YWdlKSB7XHJcbiAgICAgIC8vICAgcmV0dXJuIHZhbHVlW2N1cnJlbnRMYW5ndWFnZV0gPyB2YWx1ZVtjdXJyZW50TGFuZ3VhZ2VdLmxlbmd0aCA+IG1pbiA6IHRydWU7XHJcbiAgICAgIC8vIH1cclxuICAgICAgLy8g5aaC5p6c5peg5rOV6I635Y+W5b2T5YmN6K+t6KiA77yM5YiZ5Y+q6KaB5pyJ5LiA56eN6K+t6KiA55qE6L6T5YWl6ZW/5bqm5aSn5LqO5pyA5bCP6ZW/5bqm5Y2z5Y+v44CCXHJcbiAgICAgIC8vIGNvbnN0IGhhc1ZhbGlkTGFuZ3MgPSBPYmplY3QudmFsdWVzKHZhbHVlKS5maWx0ZXIoKHY6IGFueSkgPT4gdiAmJiB2Lmxlbmd0aCA+IG1pbik7XHJcbiAgICAgIC8vIGlmIChoYXNWYWxpZExhbmdzLmxlbmd0aCA+IDApIHtcclxuICAgICAgLy8gICByZXR1cm4gdHJ1ZTtcclxuICAgICAgLy8gfVxyXG4gICAgICAvLyByZXR1cm4gZmFsc2U7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG4gICAgaWYgKHZhbHVlICYmIHR5cGVvZiB2YWx1ZSAhPT0gJ3N0cmluZycpIHtcclxuICAgICAgdmFsdWUgPSB2YWx1ZS50b1N0cmluZygpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuICF2YWx1ZSB8fCAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJyAmJiB0aGlzLmxlbmd0aCh2YWx1ZSwgbWluKSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmo4Dmn6Xnu5nlrprnmoR2YWx1ZeeahOmVv+W6puaYr+WQpuespuWQiOiuvuWumueahOacgOWkp+WAvFxyXG4gICAqIEBwYXJhbSB2YWx1ZSDlvoXmo4Dmn6XnmoTlrZfnrKbkuLJcclxuICAgKiBAcGFyYW0gbWF4IOacgOWkp+mVv+W6plxyXG4gICAqL1xyXG4gIG1heExlbmd0aCh2YWx1ZTogYW55LCBpc011bHRMYW5ndWFnZUZpZWxkOiBib29sZWFuLCBtYXg6IG51bWJlcik6IGJvb2xlYW4ge1xyXG4gICAgaWYgKGlzTXVsdExhbmd1YWdlRmllbGQpIHtcclxuICAgICAgLy8gY29uc3QgY3VycmVudExhbmd1YWdlID0gVHJhbnNsYXRlU2VydmljZS5nZXRDdXJyZW50TGFuZ3VhZ2UoKTtcclxuICAgICAgLy8gaWYgKGN1cnJlbnRMYW5ndWFnZSkge1xyXG4gICAgICAvLyAgIHJldHVybiB2YWx1ZVtjdXJyZW50TGFuZ3VhZ2VdID8gdmFsdWVbY3VycmVudExhbmd1YWdlXS5sZW5ndGggPCBtYXggOiB0cnVlO1xyXG4gICAgICAvLyB9XHJcbiAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnKSB7XHJcbiAgICAgICAgY29uc3QgaGFzSW52YWxpZExhbmdzID0gT2JqZWN0LnZhbHVlcyh2YWx1ZSkuZmlsdGVyKCh2OiBhbnkpID0+IHYgJiYgdi5sZW5ndGggPiBtYXgpO1xyXG4gICAgICAgIGlmIChoYXNJbnZhbGlkTGFuZ3MubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnKSB7XHJcbiAgICAgIGZvciAoY29uc3Qga2V5IGluIHZhbHVlKSB7XHJcbiAgICAgICAgaWYgKHZhbHVlLmhhc093blByb3BlcnR5KGtleSkpIHtcclxuICAgICAgICAgIGNvbnN0IGVsZW1lbnQgPSB2YWx1ZVtrZXldO1xyXG4gICAgICAgICAgaWYgKHR5cGVvZiBlbGVtZW50ID09PSAnc3RyaW5nJyAmJiAhdGhpcy5sZW5ndGgodmFsdWVba2V5XSwgMCwgbWF4KSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG4gICAgaWYgKHZhbHVlICYmIHR5cGVvZiB2YWx1ZSAhPT0gJ3N0cmluZycpIHtcclxuICAgICAgdmFsdWUgPSB2YWx1ZS50b1N0cmluZygpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuICF2YWx1ZSB8fCAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJyAmJiB0aGlzLmxlbmd0aCh2YWx1ZSwgMCwgbWF4KSk7XHJcbiAgfVxyXG5cclxuICAvKiog5qOA5p+ldmFsdWXnmoTlgLzmmK/lkKblnKgg5pyA5aSn5YC85LiO5pyA5bCP5YC85LmL6Ze0ICovXHJcbiAgcmFuZ2UodmFsdWU6IG51bWJlciwgaXNNdWx0TGFuZ3VhZ2VGaWVsZDogYm9vbGVhbiwgbWluOiBudW1iZXIsIG1heDogbnVtYmVyKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJyAmJiB0aGlzLmlzTnVtYmVyKG1pbikgJiYgdGhpcy5pc051bWJlcihtYXgpICYmIHZhbHVlID49IG1pbiAmJiB2YWx1ZSA8PSBtYXg7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOaXpeacn+exu+Wei+eahOWAvOaYr+WQpuWcqOafkOS4quWMuumXtFxyXG4gICAqIEBwYXJhbSB2YWx1ZSB2YWx1ZVxyXG4gICAqIEBwYXJhbSBtaW4g5pyA5bCP5YC8XHJcbiAgICogQHBhcmFtIG1heCDmnIDlpKflgLxcclxuICAgKi9cclxuICBkYXRlUmFuZ2UodmFsdWU6IGFueSwgaXNNdWx0TGFuZ3VhZ2VGaWVsZDogYm9vbGVhbiwgcnVsZTogc3RyaW5nLCB0eXBlOiBzdHJpbmcpIHtcclxuICAgIC8vIDIwMTB+MjAyMHwwNH4wNXwwMyAxMTowMDowMH4wNSAxMjowMDowMFxyXG4gICAgaWYgKCF2YWx1ZSkge1xyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuICAgIGlmICh0eXBlID09PSAnbWF4VmFsdWUnIHx8IHR5cGUgPT09ICdtYXhEYXRlJykge1xyXG4gICAgICBpZiAodGhpcy5pc1llYXJSYW5nZSh2YWx1ZSkgfHwgdGhpcy5pc01vbnRoT3JEYXlSYW5nZSh2YWx1ZSkpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5tYXhWYWx1ZShwYXJzZUludCh0aGlzLmdldFJhbmdlVmFsdWUodmFsdWUsIDEpKSwgaXNNdWx0TGFuZ3VhZ2VGaWVsZCwgcGFyc2VJbnQocnVsZS5zcGxpdCgnICcpWzBdKSk7XHJcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5pc0RheVRpbWVSYW5nZSh2YWx1ZSkpIHtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIGlmICh0eXBlID09PSAnbWluVmFsdWUnIHx8IHR5cGUgPT09ICdtaW5EYXRlJykge1xyXG4gICAgICBpZiAodGhpcy5pc1llYXJSYW5nZSh2YWx1ZSkgfHwgdGhpcy5pc01vbnRoT3JEYXlSYW5nZSh2YWx1ZSkpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5tYXhWYWx1ZShwYXJzZUludCh0aGlzLmdldFJhbmdlVmFsdWUodmFsdWUsIDApKSwgaXNNdWx0TGFuZ3VhZ2VGaWVsZCwgcGFyc2VJbnQocnVsZS5zcGxpdCgnICcpWzBdKSk7XHJcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5pc0RheVRpbWVSYW5nZSh2YWx1ZSkpIHtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxuICBwcml2YXRlIGdldFJhbmdlVmFsdWUodmFsdWU6IHN0cmluZywgcG9zaXRpb246IDAgfCAxLCBzcGxpdG9yID0gJ34nKSB7XHJcbiAgICByZXR1cm4gdmFsdWUuc3BsaXQoc3BsaXRvcilbcG9zaXRpb25dO1xyXG4gIH1cclxuICBwcml2YXRlIGlzRGF0ZVJhbmdlKHZhbHVlOiBhbnkpIHtcclxuICAgIGlmICh0eXBlb2YgdmFsdWUgIT09ICdzdHJpbmcnKSB7XHJcbiAgICAgIHZhbHVlID0gdmFsdWUudG9TdHJpbmcoKTtcclxuICAgIH1cclxuICAgIHJldHVybiAvKFxcZHs0fXxcXGR7Mn0pLy50ZXN0KHZhbHVlKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5piv5ZCm5bm05bqm5Yy66Ze0XHJcbiAgICogQHBhcmFtIHZhbHVlIHZhbHVlXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBpc1llYXJSYW5nZSh2YWx1ZTogYW55KSB7XHJcbiAgICBpZiAodHlwZW9mIHZhbHVlICE9PSAnc3RyaW5nJykge1xyXG4gICAgICB2YWx1ZSA9IHZhbHVlLnRvU3RyaW5nKCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gL15cXGR7NH1+XFxkezR9JC8udGVzdCh2YWx1ZSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOaYr+WQpuS4uuW5tOaciOWMuumXtFxyXG4gICAqIEBwYXJhbSB2YWx1ZSB2YWx1ZVxyXG4gICAqL1xyXG4gIHByaXZhdGUgaXNZZWFyTW9udGhSYW5nZSh2YWx1ZTogYW55KSB7XHJcbiAgICBpZiAodHlwZW9mIHZhbHVlICE9PSAnc3RyaW5nJykge1xyXG4gICAgICB2YWx1ZSA9IHZhbHVlLnRvU3RyaW5nKCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gL15cXGR7NH0tXFxkezJ9flxcZHs0fS1cXGR7Mn0kLy50ZXN0KHZhbHVlKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5piv5ZCm5Li65pyI5oiW5aSp55qE5Yy66Ze0XHJcbiAgICogQHBhcmFtIHZhbHVlIHZhbHVlXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBpc01vbnRoT3JEYXlSYW5nZSh2YWx1ZTogYW55KSB7XHJcbiAgICBpZiAodHlwZW9mIHZhbHVlICE9PSAnc3RyaW5nJykge1xyXG4gICAgICB2YWx1ZSA9IHZhbHVlLnRvU3RyaW5nKCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gL15bMHwxfDJ8M11cXGR7MX1+WzB8MXwyfDNdXFxkezF9JC8udGVzdCh2YWx1ZSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOaYr+WQpuS4uuWkqSvml7bpl7TnmoTljLrpl7RcclxuICAgKiBAcGFyYW0gdmFsdWUgdmFsdWVcclxuICAgKi9cclxuICBwcml2YXRlIGlzRGF5VGltZVJhbmdlKHZhbHVlOiBhbnkpIHtcclxuICAgIGlmICh0eXBlb2YgdmFsdWUgIT09ICdzdHJpbmcnKSB7XHJcbiAgICAgIHZhbHVlID0gdmFsdWUudG9TdHJpbmcoKTtcclxuICAgIH1cclxuICAgIHJldHVybiAvXlswfDF8MnwzXVxcZHsxfSBcXGR7Mn06XFxkezJ9OlxcZHsyfX5bMHwxfDJ8M11cXGR7MX0gXFxkezJ9OlxcZHsyfTpcXGR7Mn0kLy50ZXN0KHZhbHVlKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENoZWNrcyBpZiB0aGUgZmlyc3QgbnVtYmVyIGlzIGdyZWF0ZXIgdGhhbiBzZWNvbmQuXHJcbiAgICovXHJcbiAgbWluKG51bTogbnVtYmVyLCBpc011bHRMYW5ndWFnZUZpZWxkOiBib29sZWFuLCBtaW46IG51bWJlcik6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHR5cGVvZiBudW0gPT09ICdudW1iZXInICYmIHR5cGVvZiBtaW4gPT09ICdudW1iZXInICYmIG51bSA+PSBtaW47XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmnIDlsI/lgLzpqozor4FcclxuICAgKi9cclxuICBtaW5WYWx1ZShudW06IG51bWJlciB8IHN0cmluZywgaXNNdWx0TGFuZ3VhZ2VGaWVsZDogYm9vbGVhbiwgbWluOiBudW1iZXIpOiBib29sZWFuIHtcclxuICAgIC8vIOWmguaenOWAvOS4jeWtmOWcqO+8jOWImeS4jei/m+ihjOacgOWwj+WAvOeahOWIpOaWrVxyXG4gICAgaWYgKG51bSA9PT0gbnVsbCB8fCBudW0gPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuICAgIC8vIOaMieeFp+Wkp+aVsOWkhOeQhlxyXG4gICAgaWYgKHR5cGVvZiBudW0gPT09ICdzdHJpbmcnICYmIG51bS5tYXRjaCgvXigtP1xcZCspKFxcLlxcZCspPyQvZykpIHtcclxuICAgICAgY29uc3QgdmFsdWUgPSBuZXcgQmlnTnVtYmVyKG51bSk7XHJcbiAgICAgIGNvbnN0IG1heFZhbHVlID0gbmV3IEJpZ051bWJlcihtaW4pO1xyXG4gICAgICByZXR1cm4gdmFsdWUuaXNHcmVhdGVyVGhhbk9yRXF1YWxUbyhtYXhWYWx1ZSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdHlwZW9mIG51bSA9PT0gJ251bWJlcicgJiYgdHlwZW9mIG1pbiA9PT0gJ251bWJlcicgJiYgbnVtID49IG1pbjtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENoZWNrcyBpZiB0aGUgZmlyc3QgbnVtYmVyIGlzIGxlc3MgdGhhbiBzZWNvbmQuXHJcbiAgICovXHJcbiAgbWF4KG51bTogbnVtYmVyLCBpc011bHRMYW5ndWFnZUZpZWxkOiBib29sZWFuLCBtYXg6IG51bWJlcik6IGJvb2xlYW4ge1xyXG4gICAgLy8g5aaC5p6c5YC85LiN5a2Y5Zyo77yM5YiZ5LiN6L+b6KGM5pyA5bCP5YC855qE5Yik5patXHJcbiAgICBpZiAobnVtID09PSBudWxsIHx8IG51bSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHR5cGVvZiBudW0gPT09ICdudW1iZXInICYmIHR5cGVvZiBtYXggPT09ICdudW1iZXInICYmIG51bSA8PSBtYXg7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmnIDlpKflgLzpqozor4FcclxuICAgKi9cclxuICBtYXhWYWx1ZShudW06IG51bWJlciB8IHN0cmluZywgaXNNdWx0TGFuZ3VhZ2VGaWVsZDogYm9vbGVhbiwgbWF4OiBudW1iZXIpOiBib29sZWFuIHtcclxuICAgIC8vIOWmguaenOWAvOS4jeWtmOWcqO+8jOWImeS4jei/m+ihjOacgOWwj+WAvOeahOWIpOaWrVxyXG4gICAgaWYgKG51bSA9PT0gbnVsbCB8fCBudW0gPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuICAgIC8vIOaMieeFp+Wkp+aVsOWkhOeQhlxyXG4gICAgaWYgKHR5cGVvZiBudW0gPT09ICdzdHJpbmcnICYmIG51bS5tYXRjaCgvXigtP1xcZCspKFxcLlxcZCspPyQvZykpIHtcclxuICAgICAgY29uc3QgdmFsdWUgPSBuZXcgQmlnTnVtYmVyKG51bSk7XHJcbiAgICAgIGNvbnN0IG1heFZhbHVlID0gbmV3IEJpZ051bWJlcihtYXgpO1xyXG4gICAgICByZXR1cm4gdmFsdWUuaXNMZXNzVGhhbk9yRXF1YWxUbyhtYXhWYWx1ZSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdHlwZW9mIG51bSA9PT0gJ251bWJlcicgJiYgdHlwZW9mIG1heCA9PT0gJ251bWJlcicgJiYgbnVtIDw9IG1heDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENoZWNrcyBpZiB0aGUgdmFsdWUgaXMgYSBkYXRlIHRoYXQncyBhZnRlciB0aGUgc3BlY2lmaWVkIGRhdGUuXHJcbiAgICovXHJcbiAgbWluRGF0ZShkYXRlOiBEYXRlLCBpc011bHRMYW5ndWFnZUZpZWxkOiBib29sZWFuLCBtaW5EYXRlOiBEYXRlKTogYm9vbGVhbiB7XHJcbiAgICBpZiAoIWRhdGUpIHtcclxuICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZGF0ZSAmJiBkYXRlLmdldFRpbWUoKSA+PSBtaW5EYXRlLmdldFRpbWUoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENoZWNrcyBpZiB0aGUgdmFsdWUgaXMgYSBkYXRlIHRoYXQncyBiZWZvcmUgdGhlIHNwZWNpZmllZCBkYXRlLlxyXG4gICAqL1xyXG4gIG1heERhdGUoZGF0ZTogRGF0ZSwgaXNNdWx0TGFuZ3VhZ2VGaWVsZDogYm9vbGVhbiwgbWF4RGF0ZTogRGF0ZSk6IGJvb2xlYW4ge1xyXG4gICAgLy8g5aaC5p6c5YC85LiN5a2Y5Zyo77yM5YiZ5LiN6L+b6KGM5pyA5bCP5YC855qE5Yik5patXHJcbiAgICBpZiAoZGF0ZSA9PT0gbnVsbCB8fCBkYXRlID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZGF0ZSAmJiBkYXRlLmdldFRpbWUoKSA8PSBtYXhEYXRlLmdldFRpbWUoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENoZWNrcyBpZiBhIHN0cmluZyBpcyBhIGJvb2xlYW4uXHJcbiAgICogSWYgZ2l2ZW4gdmFsdWUgaXMgbm90IGEgc3RyaW5nLCB0aGVuIGl0IHJldHVybnMgZmFsc2UuXHJcbiAgICovXHJcbiAgaXNCb29sZWFuU3RyaW5nKHZhbHVlOiBzdHJpbmcpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnICYmIHRoaXMudmFsaWRhdG9ySnMuaXNCb29sZWFuKHZhbHVlKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENoZWNrcyBpZiB0aGUgc3RyaW5nIGlzIG51bWVyaWMuXHJcbiAgICogSWYgZ2l2ZW4gdmFsdWUgaXMgbm90IGEgc3RyaW5nLCB0aGVuIGl0IHJldHVybnMgZmFsc2UuXHJcbiAgICovXHJcbiAgaXNOdW1iZXJTdHJpbmcodmFsdWU6IHN0cmluZyk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycgJiYgdGhpcy52YWxpZGF0b3JKcy5pc051bWVyaWModmFsdWUpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ2hlY2tzIGlmIHRoZSBzdHJpbmcgY29udGFpbnMgdGhlIHNlZWQuXHJcbiAgICogSWYgZ2l2ZW4gdmFsdWUgaXMgbm90IGEgc3RyaW5nLCB0aGVuIGl0IHJldHVybnMgZmFsc2UuXHJcbiAgICovXHJcbiAgY29udGFpbnModmFsdWU6IHN0cmluZywgaXNNdWx0TGFuZ3VhZ2VGaWVsZDogYm9vbGVhbiwgc2VlZDogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJyAmJiB0aGlzLnZhbGlkYXRvckpzLmNvbnRhaW5zKHZhbHVlLCBzZWVkKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENoZWNrcyBpZiB0aGUgc3RyaW5nIGRvZXMgbm90IGNvbnRhaW4gdGhlIHNlZWQuXHJcbiAgICogSWYgZ2l2ZW4gdmFsdWUgaXMgbm90IGEgc3RyaW5nLCB0aGVuIGl0IHJldHVybnMgZmFsc2UuXHJcbiAgICovXHJcbiAgbm90Q29udGFpbnModmFsdWU6IHN0cmluZywgaXNNdWx0TGFuZ3VhZ2VGaWVsZDogYm9vbGVhbiwgc2VlZDogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJyAmJiAhdGhpcy52YWxpZGF0b3JKcy5jb250YWlucyh2YWx1ZSwgc2VlZCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDaGVja3MgaWYgdGhlIHN0cmluZyBpcyBhbiBlbWFpbC5cclxuICAgKiBJZiBnaXZlbiB2YWx1ZSBpcyBub3QgYSBzdHJpbmcsIHRoZW4gaXQgcmV0dXJucyBmYWxzZS5cclxuICAgKi9cclxuICBpc0VtYWlsKHZhbHVlOiBzdHJpbmcpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnICYmIHRoaXMudmFsaWRhdG9ySnMuaXNFbWFpbCh2YWx1ZSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDaGVja3MgaWYgdGhlIHN0cmluZyBpcyB2YWxpZCBKU09OIChub3RlOiB1c2VzIEpTT04ucGFyc2UpLlxyXG4gICAqIElmIGdpdmVuIHZhbHVlIGlzIG5vdCBhIHN0cmluZywgdGhlbiBpdCByZXR1cm5zIGZhbHNlLlxyXG4gICAqL1xyXG4gIGlzSlNPTih2YWx1ZTogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJyAmJiB0aGlzLnZhbGlkYXRvckpzLmlzSlNPTih2YWx1ZSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDaGVja3MgaWYgdGhlIHN0cmluZyBpcyBsb3dlcmNhc2UuXHJcbiAgICogSWYgZ2l2ZW4gdmFsdWUgaXMgbm90IGEgc3RyaW5nLCB0aGVuIGl0IHJldHVybnMgZmFsc2UuXHJcbiAgICovXHJcbiAgaXNMb3dlcmNhc2UodmFsdWU6IHN0cmluZyk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycgJiYgdGhpcy52YWxpZGF0b3JKcy5pc0xvd2VyY2FzZSh2YWx1ZSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDaGVja3MgaWYgdGhlIHN0cmluZyBpcyB1cHBlcmNhc2UuXHJcbiAgICogSWYgZ2l2ZW4gdmFsdWUgaXMgbm90IGEgc3RyaW5nLCB0aGVuIGl0IHJldHVybnMgZmFsc2UuXHJcbiAgICovXHJcbiAgaXNVcHBlcmNhc2UodmFsdWU6IHN0cmluZyk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycgJiYgdGhpcy52YWxpZGF0b3JKcy5pc1VwcGVyY2FzZSh2YWx1ZSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDpqozor4HlrZfnrKbkuLLmmK/lkKbljIXlkKvpnZ7ms5XlrZfnrKZcclxuICAgKiBAcGFyYW0gdmFsdWUg6aqM6K+B55qE5a2X56ym5LiyXHJcbiAgICogQHBhcmFtIHNvbWVDaGFycyDpnZ7ms5XlrZfnrKbjgILlpoLvvJoj77+lJUAkXHJcbiAgICovXHJcbiAgZXhjbHVkZSh2YWx1ZTogc3RyaW5nLCBpc011bHRMYW5ndWFnZUZpZWxkOiBib29sZWFuLCBzb21lQ2hhcnM6IHN0cmluZyk6IGJvb2xlYW4ge1xyXG4gICAgY29uc3QgYXJyQ2hhciA9IHNvbWVDaGFycy5zcGxpdCgnJyk7XHJcbiAgICBsZXQgY291bnRlciA9IDA7XHJcbiAgICBhcnJDaGFyLmZvckVhY2godmFsID0+IHtcclxuICAgICAgaWYgKHRoaXMuY29udGFpbnModmFsdWUsIGlzTXVsdExhbmd1YWdlRmllbGQsIHZhbCkpIHtcclxuICAgICAgICBjb3VudGVyKys7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiBjb3VudGVyID09PSAwO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6Ieq5a6a5LmJ5q2j5YiZ6aqM6K+BXHJcbiAgICogQHBhcmFtIHZhbHVlIOW+hemqjOivgeeahOWtl+espuS4slxyXG4gICAqIEBwYXJhbSBwYXR0ZXJuIOato+WImeihqOi+vuW8j1xyXG4gICAqL1xyXG4gIG1hdGNoZXModmFsdWU6IHN0cmluZywgaXNNdWx0TGFuZ3VhZ2VGaWVsZDogYm9vbGVhbiwgcGF0dGVybjogYW55KTogYm9vbGVhbiB7XHJcbiAgICB2YWx1ZSA9ICh2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkKSA/ICcnIDogdmFsdWUudG9TdHJpbmcoKTtcclxuICAgIGlmICh2YWx1ZSA9PT0gJycpIHtcclxuICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGhpcy52YWxpZGF0b3JKcy5tYXRjaGVzKHZhbHVlLCBwYXR0ZXJuKTtcclxuICB9XHJcbn1cclxuIl19