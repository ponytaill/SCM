/*
 * @Author: aalizzwell
 * @Date: 2019-08-02 15:31:34
 * @Last Modified by: aalizzwell
 * @Last Modified time: 2020-03-03 09:33:43
 */
import { Injectable, Optional, Injector, ComponentFactoryResolver, ReflectiveInjector } from '@angular/core';
import { Router, ActivatedRoute } from '@angular/router';
import { RuntimeFrameworkService } from './rtf-service';
import { AppType } from '@gsp-sys/rtf-common';
import { MenuStateService } from './menu-state.service';
import { NavigationEventService } from './navigation-event.service';
import { QuerystringService } from './querystring';
import { FrameContext, TranslateToken } from '@farris/devkit';
import { FEPageModalService } from '@farris/extend-page-modal';
import lodash from 'lodash-es';
import { FarrisFormService } from './farris-form.service';
import { LanguageService } from './languag.service';
import { map, switchMap } from 'rxjs/operators';
import { EMPTY, of } from 'rxjs';
import { FormNotifyService } from './form-notify.service';
// tslint:disable: no-string-literal max-line-length
var APP_CONTEXT_MANAGER = 'DEVKIT_APP_CONTEXT_MANAGER';
/**
 * 导航服务
 * @scope FormModule
 */
var NavigationService = /** @class */ (function () {
    function NavigationService(runtimeFrameworkService, menuStateService, navigationEventService, querystringService, frameContext, injector, languageService
    // @Optional() private pageModalService: FEPageModalService,
    // @Optional() private farrisFormService: FarrisFormService,
    // @Optional() private languageService: LanguageService
    ) {
        this.runtimeFrameworkService = runtimeFrameworkService;
        this.menuStateService = menuStateService;
        this.navigationEventService = navigationEventService;
        this.querystringService = querystringService;
        this.frameContext = frameContext;
        this.injector = injector;
        this.languageService = languageService;
        // appId不同于tabId，每次表单实例化时都会重新生成
        var appId = this.formAppContext && this.formAppContext.ApplicationId;
        var tabId = this.querystrings.tabId || this.querystrings.funcId || this.querystrings.appId;
        // 已经编译的表单，使用appId记录hash
        if (appId) {
            var appContextManager = window[APP_CONTEXT_MANAGER] || new Map();
            if (appContextManager && !appContextManager.has(appId)) {
                appContextManager.set(appId, { hash: window.location.hash });
                window[APP_CONTEXT_MANAGER] = appContextManager;
            }
        }
        if (tabId) {
            var formEventServices = window['formEventServices'] || new Map();
            // tabId、appId都存在时，使用appId替换tabId
            if (appId) {
                tabId = appId;
            }
            if (formEventServices && formEventServices.has(tabId)) {
                this.navigationEventService = formEventServices.get(tabId);
            }
            else {
                this.navigationEventService.registerEvent();
                formEventServices.set(tabId, this.navigationEventService);
                this.navigationEventService.frameContext = this.frameContext;
                window['formEventServices'] = formEventServices;
            }
            this.registerDestroyEvent(tabId);
        }
        if (!languageService) {
            this.languageService = new LanguageService();
        }
    }
    Object.defineProperty(NavigationService.prototype, "context", {
        set: function (context) {
            this.navigationEventService['context'] = context;
            this['commandContext'] = context;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NavigationService.prototype, "formAppContext", {
        /**
         * 获取整个表单的appcontext（除module上的appcontext）
         */
        get: function () {
            if (this.frameContext) {
                var appContext = this.frameContext.appContext;
                // tslint:disable-next-line: max-line-length
                while (appContext && appContext.parent && appContext.parent.injector && appContext.parent.injector.get(FrameContext, null) !== null) {
                    appContext = appContext.parent;
                }
                return appContext;
            }
            return null;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NavigationService.prototype, "querystrings", {
        get: function () {
            var hash = window.location.hash;
            var appId = this.formAppContext && this.formAppContext.ApplicationId;
            if (appId) {
                var appContextManager = window[APP_CONTEXT_MANAGER];
                var appContext = appContextManager && appContextManager.get(appId);
                hash = appContext && appContext.hash || hash;
            }
            var params = this.querystringService.parse(hash);
            if (params) {
                params.formToken = this.runtimeFrameworkService.formToken;
            }
            return params;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NavigationService.prototype, "formNotifyService", {
        /**
         * 提示服务
         */
        get: function () {
            return this.injector && this.injector.get(FormNotifyService, null);
        },
        enumerable: true,
        configurable: true
    });
    /**
     * 注册销毁事件
     * @param tabId
     */
    NavigationService.prototype.registerDestroyEvent = function (tabId) {
        var _this = this;
        if (this.frameContext && this.frameContext.destorySignal) {
            this.frameContext.destorySignal.subscribe(function () {
                _this.navigationEventService = null;
            });
        }
        if (this.frameContext && this.frameContext.appContext && this.frameContext.appContext.destorySignal) {
            this.frameContext.appContext.destorySignal.subscribe(function () {
                var formEventServices = window['formEventServices'];
                if (formEventServices) {
                    formEventServices.delete(tabId);
                }
                var appContextManager = window[APP_CONTEXT_MANAGER];
                if (appContextManager) {
                    appContextManager.delete(tabId);
                }
            });
        }
    };
    // #region 接口
    /**
     * 打开菜单
     * @param tabId 根据TabId决定打开新标签页或定位之前打开的标签页
     * @param funcId 菜单Id
     * @param params 参数
     * @param reload 是否重新刷新
     * @param enableRefresh 启用数据刷新
     * @param tabName tab标题
     * @param destructuring 是否解构参数
     */
    NavigationService.prototype.openMenu = function (tabId, funcId, params, reload, enableRefresh, tabName, destructuring) {
        if (!funcId && this.formNotifyService) {
            this.formNotifyService.warning(this.languageService.appOrFuncIdRequired, { hideTitle: true });
            return EMPTY;
        }
        if (tabName) {
            tabName = this.translate(tabName);
        }
        var queryStringParams = this.buildParamMap(params);
        destructuring = this.convertToBoolean(destructuring, false);
        if (destructuring === true) {
            queryStringParams = this.buildParam(params);
        }
        var paramsMap = this.buildParamMap(params);
        var currentTabId = this.querystrings.tabId || this.querystrings.funcId || this.querystrings.appId;
        var options = {
            tabId: tabId,
            funcId: funcId,
            appType: AppType.Menu,
            queryStringParams: queryStringParams,
            entityParams: paramsMap,
            appId: undefined,
            appEntrance: undefined,
            isReload: reload,
            tabName: tabName || null
        };
        // 启用数据刷新参数为true或者没有定义，则按刷新处理
        // 没有传递该参数或该参数为空，则认为按照之前的逻辑处理，默认刷新
        // null false "false" "true" undefined
        enableRefresh = this.convertToBoolean(enableRefresh, true);
        if (enableRefresh === true) {
            this.menuStateService.addMenuState(currentTabId, tabId);
        }
        this.runtimeFrameworkService.openMenu(options);
    };
    /**
     * 打开菜单（流）
     * @param tabId 根据TabId决定打开新标签页或定位之前打开的标签页
     * @param funcId 菜单Id
     * @param params 参数
     * @param reload 是否重新刷新
     * @param enableRefresh 启用数据刷新
     * @param destructuring 解构参数
     */
    NavigationService.prototype.openMenu$ = function (tabId, funcId, params, reload, enableRefresh, tabName, destructuring) {
        if (!funcId && this.formNotifyService) {
            this.formNotifyService.warning(this.languageService.appOrFuncIdRequired, { hideTitle: true });
            return EMPTY;
        }
        if (tabName) {
            tabName = this.translate(tabName);
        }
        var queryStringParams = this.buildParamMap(params);
        destructuring = this.convertToBoolean(destructuring, false);
        if (destructuring === true) {
            queryStringParams = this.buildParam(params);
        }
        var paramsMap = this.buildParamMap(params);
        var currentTabId = this.querystrings.tabId || this.querystrings.funcId || this.querystrings.appId;
        var options = {
            tabId: tabId,
            funcId: funcId,
            appType: AppType.Menu,
            queryStringParams: queryStringParams,
            entityParams: paramsMap,
            appId: undefined,
            appEntrance: undefined,
            isReload: reload,
            tabName: tabName || null
        };
        // 启用数据刷新参数为true或者没有定义，则按刷新处理
        enableRefresh = this.convertToBoolean(enableRefresh, true);
        if (enableRefresh === true) {
            this.menuStateService.addMenuState(currentTabId, tabId);
        }
        return this.runtimeFrameworkService.openMenu$(options);
    };
    /**
     * 打开菜单(带维度)
     * @param tabId 根据TabId决定打开新标签页或定位之前打开的标签页
     * @param funcId 菜单Id
     * @param params 参数
     * @param reload 是否重新刷新
     * @param enableRefresh 启用数据刷新
     * @param dim1 dim1
     * @param dim2 dim2
     * @param destructuring 解构参数
     */
    NavigationService.prototype.openMenuWithDimension = function (tabId, funcId, params, enableRefresh, dim1, dim2, tabName, metadataId, destructuring) {
        if (!funcId && this.formNotifyService) {
            this.formNotifyService.warning(this.languageService.appOrFuncIdRequired, { hideTitle: true });
            return EMPTY;
        }
        if (tabName) {
            tabName = this.translate(tabName);
        }
        if (metadataId === undefined || metadataId === null) {
            metadataId = '';
        }
        var queryStringParams = this.buildParamMap(params);
        destructuring = this.convertToBoolean(destructuring, false);
        if (destructuring === true) {
            queryStringParams = this.buildParam(params);
        }
        var paramsMap = this.buildParamMap(params);
        queryStringParams.set('dim1', dim1 ? dim1 : 'public');
        queryStringParams.set('dim2', dim2 ? dim2 : 'public');
        queryStringParams.set('metadataId', metadataId);
        queryStringParams.set('isRtc', '1');
        queryStringParams.set('isRootMetadata', 'true');
        var currentTabId = this.querystrings.tabId || this.querystrings.funcId || this.querystrings.appId;
        var options = {
            tabId: tabId,
            funcId: funcId,
            appType: AppType.Menu,
            queryStringParams: queryStringParams,
            entityParams: paramsMap,
            appId: undefined,
            appEntrance: undefined,
            isReload: false,
            tabName: tabName || null
        };
        // 启用数据刷新参数为true或者没有定义，则按刷新处理
        // 没有传递该参数或该参数为空，则认为按照之前的逻辑处理，默认刷新
        // null false "false" "true" undefined
        enableRefresh = this.convertToBoolean(enableRefresh, true);
        if (enableRefresh === true) {
            this.menuStateService.addMenuState(currentTabId, tabId);
        }
        this.runtimeFrameworkService.openMenu(options);
    };
    /**
     * 打开应用
     * @param tabId tabId 根据TabId决定打开新标签页或定位之前打开的标签页
     * @param appId 应用Id
     * @param appEntrance 应用入口
     * @param params 参数
     * @param reload 是否重新刷新
     * @param tabName tab标题
     * @param enableRefresh 启用数据刷新
     * @param destructuring 解构参数
     */
    NavigationService.prototype.openApp = function (tabId, appId, appEntrance, params, reload, tabName, enableRefresh, destructuring) {
        if (!appId && this.formNotifyService) {
            this.formNotifyService.warning(this.languageService.appOrFuncIdRequired, { hideTitle: true });
            return EMPTY;
        }
        if (tabName) {
            tabName = this.translate(tabName);
        }
        var queryStringParams = this.buildParamMap(params);
        destructuring = this.convertToBoolean(destructuring, false);
        if (destructuring === true) {
            queryStringParams = this.buildParam(params);
        }
        var paramsMap = this.buildParamMap(params);
        var currentTabId = this.querystrings.tabId || this.querystrings.funcId || this.querystrings.appId;
        var options = {
            tabId: tabId,
            appId: appId,
            appEntrance: appEntrance,
            funcId: undefined,
            appType: AppType.App,
            queryStringParams: queryStringParams,
            entityParams: paramsMap,
            isReload: reload,
            tabName: tabName || null
        };
        enableRefresh = this.convertToBoolean(enableRefresh, true);
        if (enableRefresh === true) {
            this.menuStateService.addMenuState(currentTabId, tabId);
        }
        this.runtimeFrameworkService.openMenu(options);
    };
    /**
     * 打开应用(流式)
     * @param tabId tabId 根据TabId决定打开新标签页或定位之前打开的标签页
     * @param appId 应用Id
     * @param appEntrance 应用入口
     * @param params 参数
     * @param reload 是否重新刷新
     * @param tabName tab标题
     * @param enableRefresh 启用数据刷新
     * @param destructuring 解构参数
     */
    NavigationService.prototype.openApp$ = function (tabId, appId, appEntrance, params, reload, tabName, enableRefresh, destructuring) {
        if (!appId && this.formNotifyService) {
            this.formNotifyService.warning(this.languageService.appOrFuncIdRequired, { hideTitle: true });
            return EMPTY;
        }
        if (tabName) {
            tabName = this.translate(tabName);
        }
        var queryStringParams = this.buildParamMap(params);
        destructuring = this.convertToBoolean(destructuring, false);
        if (destructuring === true) {
            queryStringParams = this.buildParam(params);
        }
        var paramsMap = this.buildParamMap(params);
        var currentTabId = this.querystrings.tabId || this.querystrings.funcId || this.querystrings.appId;
        var options = {
            tabId: tabId,
            appId: appId,
            appEntrance: appEntrance,
            funcId: undefined,
            appType: AppType.App,
            queryStringParams: queryStringParams,
            entityParams: paramsMap,
            isReload: reload,
            tabName: tabName || null
        };
        enableRefresh = this.convertToBoolean(enableRefresh, true);
        if (enableRefresh === true) {
            this.menuStateService.addMenuState(currentTabId, tabId);
        }
        return this.runtimeFrameworkService.openMenu$(options);
    };
    /**
     * 关闭
     * @param onCloseing 关闭前事件处理器
     */
    NavigationService.prototype.close = function () {
        var options = this.querystrings;
        var _a = this.findDialog(), isInDialog = _a.isDialogComponent, rootComponent = _a.rootComponent;
        if (isInDialog) {
            var modalRef = this.get(rootComponent, 'dialogRef');
            modalRef['close']();
            return;
        }
        options.token = options.formToken;
        this.runtimeFrameworkService.beforeCloseMenu(options);
    };
    /**
     * 强制关闭
     */
    NavigationService.prototype.destory = function () {
        var options = this.querystrings;
        options.token = options.formToken;
        this.runtimeFrameworkService.closeMenu(options);
    };
    /**
     *
     * @param params params
     * @deprecated 待废弃，与buildParamMap重复
     */
    NavigationService.prototype.parseParams = function (params) {
        if (typeof params === 'undefined' || params === null || (typeof params === 'string' && params.length < 1)) {
            params = {};
        }
        var paramMap = new Map();
        if (typeof params === 'object') {
            params = JSON.stringify(params);
        }
        params = window['encodeURIComponent'](params);
        paramMap.set('WEB_FORM_ROUTE_PARAMS', params);
        return paramMap;
    };
    /**
     * 注册事件监听器
     * @param eventType 事件类型 onTabClosed
     * @param handler 处理器
     * @returns string 返回事件标识
     */
    NavigationService.prototype.addEventListener = function (eventType, handler) {
        return this.navigationEventService.addEventListener(eventType, handler);
    };
    /**
     * 移除事件监听器
     * @param eventType 事件类型 onTabClosed | onTabCloseing
     * @param key 事件标识
     */
    NavigationService.prototype.removeEventListener = function (eventType, key) {
        return this.navigationEventService.removeEventListener(eventType, key);
    };
    /**
     * 清空事件监听器
     * @param eventType 事件类型
     */
    NavigationService.prototype.clearEventListener = function (eventType) {
        this.navigationEventService.clearEventListener(eventType);
    };
    /**
     * 以弹框、侧边栏或新标签页方式打开表单
     * @param mode 打开方式，支持`modal`弹窗、`sidebar`侧边栏、`tab`新标签页
     * @param modalId 弹窗id，如果mode=`modal`且没有url，
     * @param configs 弹窗配置
     * @param url 远端表单url
     * @param tabId 标签页id，modal=tab时必填
     * @param tabType 标签页类型，`menu` 或`app`
     * @param funcOrAppId 菜单或应用id
     * @param appEntrance 应用入口
     * @param params 参数
     * @param tabName 新标签页名称
     * @param enableRefresh 启用启动刷新
     * @param destructuring 是否解构
     */
    NavigationService.prototype.open = function (mode, modalId, url, configs, tabId, tabType, funcOrAppId, appEntrance, params, tabName, enableRefresh, destructuring) {
        var pageModalService = this.injector.get(FEPageModalService, null);
        if (!pageModalService) {
            throw new Error('get FEPageModalService failed.');
        }
        // 校验参数是否合法
        if (!mode) {
            throw new Error('[NavigationService]->open,mode参数不能为空！');
        }
        if (mode === 'modal' || mode === 'sidebar') {
            if (!modalId && !url) {
                throw new Error('弹窗及侧边栏模式时弹窗容器id和表单路径不能同时为空！');
            }
            if (modalId && url) {
                throw new Error('弹窗及侧边栏模式时弹窗容器id和表单路径不能同时存在！');
            }
            var uiStateConfig = this.getObjectTypeConfig(params);
            var modalConfig = this.buildConfigs(configs);
            if (mode === 'sidebar') {
                modalConfig.dialogType = mode;
            }
            var pageModalRef = null;
            if (modalId) {
                var farrisFormService = this.injector.get(FarrisFormService, null);
                if (!farrisFormService) {
                    return;
                }
                var componentType = farrisFormService.getControls(modalId);
                var componentRef = this.createComponentRef(componentType, uiStateConfig);
                pageModalRef = pageModalService.show(componentRef, modalConfig);
            }
            else if (url) {
                pageModalRef = pageModalService.showByUrl(url, modalConfig);
            }
            if (pageModalRef && !!pageModalRef.content) {
                pageModalRef.content.isDialogRootComponent = true;
                pageModalRef.content.dialogRef = pageModalRef;
                var header = pageModalRef.dialog && pageModalRef.dialog.instance && pageModalRef.dialog.instance.el && pageModalRef.dialog.instance.el.nativeElement && pageModalRef.dialog.instance.el.nativeElement.querySelector(".f-page-header");
                if (header && pageModalRef.dialog.instance.draggbar) {
                    pageModalRef.dialog.instance.draggbar.handle = header;
                    header.style.cursor = 'move';
                }
            }
        }
        else if (mode === 'tab') {
            if (!tabId || !tabType || !funcOrAppId) {
                if (this.formNotifyService) {
                    this.formNotifyService.warning(this.languageService.appOrFuncIdRequired, { hideTitle: true });
                }
                throw new Error('新标签模式时标签页id、标签类型、菜单或应用id均不能为空！');
            }
            if (tabType === 'app' && !appEntrance) {
                throw new Error('以应用方式打开时入口应用不能为空！');
            }
            if (tabType == 'app') {
                this.openApp(tabId, funcOrAppId, appEntrance, params, false, tabName, enableRefresh, destructuring);
            }
            else if (tabType === 'menu') {
                this.openMenu(tabId, funcOrAppId, params, false, enableRefresh, tabName, destructuring);
            }
        }
        else {
            throw new Error('不支持的模式！');
        }
        // this.pageModalService.
    };
    /**
     * in app navigate
     * @param commands commands
     */
    // public navigate(commands: any[]);
    /**
     * in app navigate
     * @param commands commands
     * @param options options
     * @description options:{ relativeTo: this.activatedRoute, queryParams:{a:1,b:2},etc:...}
     */
    NavigationService.prototype.navigate = function (commands, options) {
        var router = this.injector && this.injector.get(Router, null);
        var activatedRoute = this.injector && this.injector.get(ActivatedRoute, null);
        var queryParams = lodash.merge({}, this.querystrings, options && options.queryParams || {});
        if (options && options.hasOwnProperty('queryParams')) {
            delete options.queryParams;
        }
        var extras = lodash.merge({ skipLocationChange: false, relativeTo: activatedRoute, queryParams: queryParams }, options || {});
        if (router) {
            return router.navigate(commands, extras);
        }
        else {
            return null;
        }
    };
    // #endregion
    // #region 私有方法
    /**
     * 封装路由参数
     * @param params 参数
     * @param options 配置参数
     */
    NavigationService.prototype.buildParamMap = function (params, options) {
        if (typeof params === 'undefined' || params === null || (typeof params === 'string' && params.length < 1)) {
            params = {};
        }
        var paramMap = new Map();
        if (options && Object.keys(options).length > 0) {
            if (typeof params !== 'object') {
                params = JSON.parse(params);
            }
            params = lodash.merge(params, options);
        }
        if (typeof params === 'object') {
            params = JSON.stringify(params);
        }
        var currentTabId = this.querystrings.tabId || this.querystrings.funcId || this.querystrings.appId;
        params = window['encodeURIComponent'](params);
        paramMap.set('WEB_FORM_ROUTE_PARAMS', params);
        paramMap.set('WEB_FORM_ROUTER_PARENT_ID', currentTabId);
        return paramMap;
    };
    NavigationService.prototype.buildParam = function (params, options) {
        if (typeof params === 'undefined' || params === null || (typeof params === 'string' && params.length < 1)) {
            params = {};
        }
        var paramMap = new Map();
        if (options && Object.keys(options).length > 0) {
            if (typeof params !== 'object') {
                params = JSON.parse(params);
            }
            params = lodash.merge(params, options);
        }
        if (typeof params !== 'object') {
            params = JSON.parse(params);
        }
        Object.keys(params).forEach(function (key) {
            paramMap.set(key, params[key]);
        });
        var currentTabId = this.querystrings.tabId || this.querystrings.funcId || this.querystrings.appId;
        params = window['encodeURIComponent'](params);
        paramMap.set('WEB_FORM_ROUTE_PARAMS', params);
        paramMap.set('WEB_FORM_ROUTER_PARENT_ID', currentTabId);
        return paramMap;
    };
    /**
     * 查找弹窗组件
     */
    NavigationService.prototype.findDialog = function () {
        var frameContext = this.get(this, 'commandContext.frameContext');
        var isDialogComponent = this.get(frameContext, 'frameComponent.isDialogRootComponent', false);
        var parentFrameContext = this.get(frameContext, 'parent');
        while (parentFrameContext != null && !isDialogComponent) {
            frameContext = this.get(frameContext, 'parent');
            parentFrameContext = this.get(parentFrameContext, 'parent');
            isDialogComponent = this.get(frameContext, 'frameComponent.isDialogRootComponent', false);
        }
        var rootComponent = this.get(frameContext, 'frameComponent');
        return { isDialogComponent: isDialogComponent, rootComponent: rootComponent };
    };
    /**
     * loadsh get
     * @param object 对象
     * @param path 路径
     * @param defaultVal 默认值
     */
    NavigationService.prototype.get = function (object, path, defaultVal) {
        if (defaultVal === void 0) { defaultVal = null; }
        var PATH = Array.isArray(path)
            ? path
            : path.split('.').filter(function (i) { return i.length; });
        if (!PATH.length) {
            return object === undefined ? defaultVal : object;
        }
        if (object === null || object === undefined || typeof (object[PATH[0]]) === 'undefined') {
            return defaultVal;
        }
        return this.get(object[PATH.shift()], PATH, defaultVal);
    };
    NavigationService.prototype.convertToBoolean = function (value, defaultVal) {
        if (defaultVal === void 0) { defaultVal = false; }
        if (typeof value === 'undefined' || value === null) {
            value = defaultVal;
        }
        if (typeof value === 'string') {
            value = value || String(defaultVal);
            value = value === 'true' ? true : false;
        }
        return value;
    };
    /**
     * 翻译资源项
     * @param key 资源项key
     */
    NavigationService.prototype.translate = function (key) {
        var translateService = this.injector && this.injector.get(TranslateToken, null) || null;
        if (translateService && key && key.startsWith('{{') && key.endsWith('}}')) {
            key = key.replace('{{', '').replace('}}', '').trim();
            return translateService.transform(key, null);
        }
        return key;
    };
    // #endregion
    //#region 弹窗相关方法
    NavigationService.prototype.buildConfigs = function (config) {
        var _this = this;
        var languageService = this.injector.get(LanguageService, null);
        if (!languageService) {
            languageService = LanguageService.getInstance();
        }
        var defaultConfigs = {
            title: languageService && languageService.defaultDialogTitle || '',
            width: 800,
            height: 500,
            showButtons: false
        };
        var objectTypeConfig = this.getObjectTypeConfig(config);
        var configs = Object.assign(defaultConfigs, objectTypeConfig);
        var onClosingHandler = configs.beforeClose;
        var refresh = configs['refresh'] || {};
        var refreshCommandName = refresh && refresh.commandName || null;
        var refreshFrameId = refresh && refresh.frameId || null;
        // tslint:disable: no-string-literal
        var cancelChanges = configs['cancelChanges'] || false;
        configs.beforeClose = function (ref) {
            if (!!onClosingHandler && typeof onClosingHandler === 'function') {
                return onClosingHandler(ref).pipe(switchMap(function (result) {
                    if (result) {
                        if (cancelChanges) {
                            return _this.cancelChanges(ref).pipe(switchMap(function () { return _this.refreshForm(refreshCommandName, refreshFrameId); }));
                        }
                    }
                    return of(result);
                }));
            }
            else {
                if (cancelChanges) {
                    return _this.cancelChanges(ref).pipe(switchMap(function () { return _this.refreshForm(refreshCommandName, refreshFrameId); }));
                }
                else {
                    return of(true);
                }
            }
        };
        return configs;
    };
    NavigationService.prototype.getObjectTypeConfig = function (config) {
        var objectTypeConfig;
        if (typeof config === 'undefined') {
            config = {};
        }
        if (typeof config === 'string') {
            if (config.length) {
                try {
                    objectTypeConfig = JSON.parse(config);
                }
                catch (_a) {
                    throw new Error(config + '不是合法的json字符串');
                }
            }
            else {
                objectTypeConfig = {};
            }
        }
        else if (typeof config === 'object') {
            objectTypeConfig = Object.assign({}, config);
        }
        else {
            throw new Error('填写对象格式或json字符串');
        }
        return objectTypeConfig;
    };
    /**
     * 取消服务器变更集
     */
    NavigationService.prototype.cancelChanges = function (ref) {
        if (ref && ref.modalRef && ref.modalRef.content) {
            var component = ref.modalRef.content;
            if (component && component.context) {
                var repository = component.context.repository || null;
                if (repository) {
                    return repository.cancelChanges().pipe(switchMap(function () { return of(true); }));
                }
            }
        }
        return of(true);
    };
    NavigationService.prototype.refreshForm = function (refreshCommandName, refreshFrameId) {
        if (refreshCommandName && refreshFrameId) {
            var frameContext = this.frameContext.appContext.frameContextManager.getFrameContextById(refreshFrameId);
            if (frameContext) {
                var viewModel = frameContext.viewModel;
                return viewModel[refreshCommandName]().pipe(map(function () { return true; }));
            }
        }
        return of(true);
    };
    NavigationService.prototype.createComponentRef = function (componentType, uiStateObject) {
        var componentRef;
        var frameContext = this.getFrameContext();
        var componentFactoryResolver = this.getComponentFactoryResolver();
        if (frameContext && componentFactoryResolver) {
            var contentCmptFactory = componentFactoryResolver.resolveComponentFactory(componentType);
            var modalContentInjector = ReflectiveInjector.resolveAndCreate([], frameContext.injector);
            componentRef = contentCmptFactory.create(modalContentInjector);
            if (componentRef && componentRef.instance && componentRef.instance.viewModel && componentRef.instance.viewModel.uiState) {
                if (typeof uiStateObject === 'object' && Object.keys(uiStateObject).length) {
                    Object.keys(uiStateObject).forEach(function (item) {
                        componentRef.instance.viewModel.uiState.setPropertyValue(item, uiStateObject[item]);
                    });
                }
                // 附加isDialog参数
                componentRef.instance.viewModel.uiState.setPropertyValue('DEVKIT_DIALOG', true);
            }
        }
        return componentRef;
    };
    /**
     * 兼容旧弹窗，获取frameContext
     */
    NavigationService.prototype.getFrameContext = function () {
        if (this.frameContext) {
            return this.frameContext;
        }
        if (this['context'] && this['context']['frameContext']) {
            return this['context']['frameContext'];
        }
        return null;
    };
    /**
     * 兼容旧弹窗，获取ComponentFactoryResolver
     */
    NavigationService.prototype.getComponentFactoryResolver = function () {
        var frameContext = this.getFrameContext();
        var componentFactoryResolver;
        if (frameContext) {
            componentFactoryResolver = frameContext.injector.get(ComponentFactoryResolver);
        }
        return componentFactoryResolver;
    };
    NavigationService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    NavigationService.ctorParameters = function () { return [
        { type: RuntimeFrameworkService },
        { type: MenuStateService },
        { type: NavigationEventService },
        { type: QuerystringService },
        { type: FrameContext, decorators: [{ type: Optional }] },
        { type: Injector, decorators: [{ type: Optional }] },
        { type: LanguageService, decorators: [{ type: Optional }] }
    ]; };
    return NavigationService;
}());
export { NavigationService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmF2aWdhdGlvbi5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9jb21tYW5kLXNlcnZpY2VzLyIsInNvdXJjZXMiOlsibGliL25hdmlnYXRpb24uc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7R0FLRztBQUNILE9BQU8sRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSx3QkFBd0IsRUFBRSxrQkFBa0IsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUM3RyxPQUFPLEVBQUUsTUFBTSxFQUFFLGNBQWMsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ3pELE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN4RCxPQUFPLEVBQWMsT0FBTyxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDMUQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDeEQsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDcEUsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ25ELE9BQU8sRUFBRSxZQUFZLEVBQUUsY0FBYyxFQUE2QixNQUFNLGdCQUFnQixDQUFDO0FBQ3pGLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQy9ELE9BQU8sTUFBTSxNQUFNLFdBQVcsQ0FBQztBQUMvQixPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUMxRCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDcEQsT0FBTyxFQUFFLEdBQUcsRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNoRCxPQUFPLEVBQUUsS0FBSyxFQUFjLEVBQUUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUM3QyxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUUxRCxvREFB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T0FBTyxZQUFZLENBQUM7SUFDdEIsQ0FBQztJQUNEOztPQUVHO0lBQ0ssMkNBQWUsR0FBdkI7UUFDRSxJQUFJLElBQUksQ0FBQyxZQUFZLEVBQUU7WUFDckIsT0FBTyxJQUFJLENBQUMsWUFBWSxDQUFBO1NBQ3pCO1FBQ0QsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxFQUFFO1lBQ3RELE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxDQUFDO1NBQ3hDO1FBQ0QsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBQ0Q7O09BRUc7SUFDSyx1REFBMkIsR0FBbkM7UUFDRSxJQUFNLFlBQVksR0FBRyxJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7UUFDNUMsSUFBSSx3QkFBNkIsQ0FBQztRQUNsQyxJQUFJLFlBQVksRUFBRTtZQUNoQix3QkFBd0IsR0FBRyxZQUFZLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDO1NBQ2hGO1FBQ0QsT0FBTyx3QkFBd0IsQ0FBQztJQUNsQyxDQUFDOztnQkFwdkJGLFVBQVU7Ozs7Z0JBcEJGLHVCQUF1QjtnQkFFdkIsZ0JBQWdCO2dCQUNoQixzQkFBc0I7Z0JBQ3RCLGtCQUFrQjtnQkFDbEIsWUFBWSx1QkFzQmhCLFFBQVE7Z0JBN0JrQixRQUFRLHVCQThCbEMsUUFBUTtnQkFuQkosZUFBZSx1QkFvQm5CLFFBQVE7O0lBNnVCYix3QkFBQztDQUFBLEFBdHZCRCxJQXN2QkM7U0FydkJZLGlCQUFpQiIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBAQXV0aG9yOiBhYWxpenp3ZWxsXG4gKiBARGF0ZTogMjAxOS0wOC0wMiAxNTozMTozNFxuICogQExhc3QgTW9kaWZpZWQgYnk6IGFhbGl6endlbGxcbiAqIEBMYXN0IE1vZGlmaWVkIHRpbWU6IDIwMjAtMDMtMDMgMDk6MzM6NDNcbiAqL1xuaW1wb3J0IHsgSW5qZWN0YWJsZSwgT3B0aW9uYWwsIEluamVjdG9yLCBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsIFJlZmxlY3RpdmVJbmplY3RvciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgUm91dGVyLCBBY3RpdmF0ZWRSb3V0ZSB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XG5pbXBvcnQgeyBSdW50aW1lRnJhbWV3b3JrU2VydmljZSB9IGZyb20gJy4vcnRmLXNlcnZpY2UnO1xuaW1wb3J0IHsgQXBwT3B0aW9ucywgQXBwVHlwZSB9IGZyb20gJ0Bnc3Atc3lzL3J0Zi1jb21tb24nO1xuaW1wb3J0IHsgTWVudVN0YXRlU2VydmljZSB9IGZyb20gJy4vbWVudS1zdGF0ZS5zZXJ2aWNlJztcbmltcG9ydCB7IE5hdmlnYXRpb25FdmVudFNlcnZpY2UgfSBmcm9tICcuL25hdmlnYXRpb24tZXZlbnQuc2VydmljZSc7XG5pbXBvcnQgeyBRdWVyeXN0cmluZ1NlcnZpY2UgfSBmcm9tICcuL3F1ZXJ5c3RyaW5nJztcbmltcG9ydCB7IEZyYW1lQ29udGV4dCwgVHJhbnNsYXRlVG9rZW4sIFRyYW5zbGF0ZSwgRnJhbWVDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL2RldmtpdCc7XG5pbXBvcnQgeyBGRVBhZ2VNb2RhbFNlcnZpY2UgfSBmcm9tICdAZmFycmlzL2V4dGVuZC1wYWdlLW1vZGFsJztcbmltcG9ydCBsb2Rhc2ggZnJvbSAnbG9kYXNoLWVzJztcbmltcG9ydCB7IEZhcnJpc0Zvcm1TZXJ2aWNlIH0gZnJvbSAnLi9mYXJyaXMtZm9ybS5zZXJ2aWNlJztcbmltcG9ydCB7IExhbmd1YWdlU2VydmljZSB9IGZyb20gJy4vbGFuZ3VhZy5zZXJ2aWNlJztcbmltcG9ydCB7IG1hcCwgc3dpdGNoTWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgRU1QVFksIE9ic2VydmFibGUsIG9mIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBGb3JtTm90aWZ5U2VydmljZSB9IGZyb20gJy4vZm9ybS1ub3RpZnkuc2VydmljZSc7XG5kZWNsYXJlIGNvbnN0IFN5c3RlbTogYW55O1xuLy8gdHNsaW50OmRpc2FibGU6IG5vLXN0cmluZy1saXRlcmFsIG1heC1saW5lLWxlbmd0aFxuY29uc3QgQVBQX0NPTlRFWFRfTUFOQUdFUiA9ICdERVZLSVRfQVBQX0NPTlRFWFRfTUFOQUdFUic7XG4vKipcbiAqIOWvvOiIquacjeWKoVxuICogQHNjb3BlIEZvcm1Nb2R1bGVcbiAqL1xuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIE5hdmlnYXRpb25TZXJ2aWNlIHtcbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBydW50aW1lRnJhbWV3b3JrU2VydmljZTogUnVudGltZUZyYW1ld29ya1NlcnZpY2UsXG4gICAgcHJpdmF0ZSBtZW51U3RhdGVTZXJ2aWNlOiBNZW51U3RhdGVTZXJ2aWNlLFxuICAgIHByaXZhdGUgbmF2aWdhdGlvbkV2ZW50U2VydmljZTogTmF2aWdhdGlvbkV2ZW50U2VydmljZSxcbiAgICBwcml2YXRlIHF1ZXJ5c3RyaW5nU2VydmljZTogUXVlcnlzdHJpbmdTZXJ2aWNlLFxuICAgIEBPcHRpb25hbCgpIHByaXZhdGUgZnJhbWVDb250ZXh0OiBGcmFtZUNvbnRleHQsXG4gICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IsXG4gICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSBsYW5ndWFnZVNlcnZpY2U6IExhbmd1YWdlU2VydmljZVxuICAgIC8vIEBPcHRpb25hbCgpIHByaXZhdGUgcGFnZU1vZGFsU2VydmljZTogRkVQYWdlTW9kYWxTZXJ2aWNlLFxuICAgIC8vIEBPcHRpb25hbCgpIHByaXZhdGUgZmFycmlzRm9ybVNlcnZpY2U6IEZhcnJpc0Zvcm1TZXJ2aWNlLFxuICAgIC8vIEBPcHRpb25hbCgpIHByaXZhdGUgbGFuZ3VhZ2VTZXJ2aWNlOiBMYW5ndWFnZVNlcnZpY2VcbiAgKSB7XG4gICAgLy8gYXBwSWTkuI3lkIzkuo50YWJJZO+8jOavj+asoeihqOWNleWunuS+i+WMluaXtumDveS8mumHjeaWsOeUn+aIkFxuICAgIGNvbnN0IGFwcElkID0gdGhpcy5mb3JtQXBwQ29udGV4dCAmJiB0aGlzLmZvcm1BcHBDb250ZXh0LkFwcGxpY2F0aW9uSWQ7XG4gICAgbGV0IHRhYklkID0gdGhpcy5xdWVyeXN0cmluZ3MudGFiSWQgfHwgdGhpcy5xdWVyeXN0cmluZ3MuZnVuY0lkIHx8IHRoaXMucXVlcnlzdHJpbmdzLmFwcElkO1xuICAgIC8vIOW3sue7j+e8luivkeeahOihqOWNle+8jOS9v+eUqGFwcElk6K6w5b2VaGFzaFxuICAgIGlmIChhcHBJZCkge1xuICAgICAgY29uc3QgYXBwQ29udGV4dE1hbmFnZXIgPSB3aW5kb3dbQVBQX0NPTlRFWFRfTUFOQUdFUl0gfHwgbmV3IE1hcDxzdHJpbmcsIGFueT4oKTtcbiAgICAgIGlmIChhcHBDb250ZXh0TWFuYWdlciAmJiAhYXBwQ29udGV4dE1hbmFnZXIuaGFzKGFwcElkKSkge1xuICAgICAgICBhcHBDb250ZXh0TWFuYWdlci5zZXQoYXBwSWQsIHsgaGFzaDogd2luZG93LmxvY2F0aW9uLmhhc2ggfSk7XG4gICAgICAgIHdpbmRvd1tBUFBfQ09OVEVYVF9NQU5BR0VSXSA9IGFwcENvbnRleHRNYW5hZ2VyO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAodGFiSWQpIHtcbiAgICAgIGNvbnN0IGZvcm1FdmVudFNlcnZpY2VzOiBNYXA8c3RyaW5nLCBhbnk+ID0gd2luZG93Wydmb3JtRXZlbnRTZXJ2aWNlcyddIHx8IG5ldyBNYXA8c3RyaW5nLCBhbnk+KCk7XG4gICAgICAvLyB0YWJJZOOAgWFwcElk6YO95a2Y5Zyo5pe277yM5L2/55SoYXBwSWTmm7/mjaJ0YWJJZFxuICAgICAgaWYgKGFwcElkKSB7XG4gICAgICAgIHRhYklkID0gYXBwSWQ7XG4gICAgICB9XG4gICAgICBpZiAoZm9ybUV2ZW50U2VydmljZXMgJiYgZm9ybUV2ZW50U2VydmljZXMuaGFzKHRhYklkKSkge1xuICAgICAgICB0aGlzLm5hdmlnYXRpb25FdmVudFNlcnZpY2UgPSBmb3JtRXZlbnRTZXJ2aWNlcy5nZXQodGFiSWQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5uYXZpZ2F0aW9uRXZlbnRTZXJ2aWNlLnJlZ2lzdGVyRXZlbnQoKTtcbiAgICAgICAgZm9ybUV2ZW50U2VydmljZXMuc2V0KHRhYklkLCB0aGlzLm5hdmlnYXRpb25FdmVudFNlcnZpY2UpO1xuICAgICAgICB0aGlzLm5hdmlnYXRpb25FdmVudFNlcnZpY2UuZnJhbWVDb250ZXh0ID0gdGhpcy5mcmFtZUNvbnRleHQ7XG4gICAgICAgIHdpbmRvd1snZm9ybUV2ZW50U2VydmljZXMnXSA9IGZvcm1FdmVudFNlcnZpY2VzO1xuICAgICAgfVxuICAgICAgdGhpcy5yZWdpc3RlckRlc3Ryb3lFdmVudCh0YWJJZCk7XG4gICAgfVxuICAgIGlmICghbGFuZ3VhZ2VTZXJ2aWNlKSB7XG4gICAgICB0aGlzLmxhbmd1YWdlU2VydmljZSA9IG5ldyBMYW5ndWFnZVNlcnZpY2UoKTtcbiAgICB9XG4gIH1cbiAgcHVibGljIHNldCBjb250ZXh0KGNvbnRleHQpIHtcbiAgICB0aGlzLm5hdmlnYXRpb25FdmVudFNlcnZpY2VbJ2NvbnRleHQnXSA9IGNvbnRleHQ7XG4gICAgdGhpc1snY29tbWFuZENvbnRleHQnXSA9IGNvbnRleHQ7XG4gIH1cbiAgLyoqXG4gICAqIOiOt+WPluaVtOS4quihqOWNleeahGFwcGNvbnRleHTvvIjpmaRtb2R1bGXkuIrnmoRhcHBjb250ZXh077yJXG4gICAqL1xuICBwcml2YXRlIGdldCBmb3JtQXBwQ29udGV4dCgpIHtcbiAgICBpZiAodGhpcy5mcmFtZUNvbnRleHQpIHtcbiAgICAgIGxldCBhcHBDb250ZXh0ID0gdGhpcy5mcmFtZUNvbnRleHQuYXBwQ29udGV4dDtcbiAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogbWF4LWxpbmUtbGVuZ3RoXG4gICAgICB3aGlsZSAoYXBwQ29udGV4dCAmJiBhcHBDb250ZXh0LnBhcmVudCAmJiBhcHBDb250ZXh0LnBhcmVudC5pbmplY3RvciAmJiBhcHBDb250ZXh0LnBhcmVudC5pbmplY3Rvci5nZXQoRnJhbWVDb250ZXh0LCBudWxsKSAhPT0gbnVsbCkge1xuICAgICAgICBhcHBDb250ZXh0ID0gYXBwQ29udGV4dC5wYXJlbnQ7XG4gICAgICB9XG4gICAgICByZXR1cm4gYXBwQ29udGV4dDtcbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgcHJpdmF0ZSBnZXQgcXVlcnlzdHJpbmdzKCkge1xuICAgIGxldCBoYXNoID0gd2luZG93LmxvY2F0aW9uLmhhc2g7XG4gICAgY29uc3QgYXBwSWQgPSB0aGlzLmZvcm1BcHBDb250ZXh0ICYmIHRoaXMuZm9ybUFwcENvbnRleHQuQXBwbGljYXRpb25JZDtcbiAgICBpZiAoYXBwSWQpIHtcbiAgICAgIGNvbnN0IGFwcENvbnRleHRNYW5hZ2VyID0gd2luZG93W0FQUF9DT05URVhUX01BTkFHRVJdO1xuICAgICAgY29uc3QgYXBwQ29udGV4dCA9IGFwcENvbnRleHRNYW5hZ2VyICYmIGFwcENvbnRleHRNYW5hZ2VyLmdldChhcHBJZCk7XG4gICAgICBoYXNoID0gYXBwQ29udGV4dCAmJiBhcHBDb250ZXh0Lmhhc2ggfHwgaGFzaDtcbiAgICB9XG4gICAgY29uc3QgcGFyYW1zID0gdGhpcy5xdWVyeXN0cmluZ1NlcnZpY2UucGFyc2UoaGFzaCk7XG4gICAgaWYgKHBhcmFtcykge1xuICAgICAgcGFyYW1zLmZvcm1Ub2tlbiA9IHRoaXMucnVudGltZUZyYW1ld29ya1NlcnZpY2UuZm9ybVRva2VuO1xuICAgIH1cbiAgICByZXR1cm4gcGFyYW1zO1xuICB9XG4gIC8qKlxuICAgKiDmj5DnpLrmnI3liqFcbiAgICovXG4gIHByaXZhdGUgZ2V0IGZvcm1Ob3RpZnlTZXJ2aWNlKCkge1xuICAgIHJldHVybiB0aGlzLmluamVjdG9yICYmIHRoaXMuaW5qZWN0b3IuZ2V0PEZvcm1Ob3RpZnlTZXJ2aWNlPihGb3JtTm90aWZ5U2VydmljZSwgbnVsbCk7XG4gIH1cbiAgLyoqXG4gICAqIOazqOWGjOmUgOavgeS6i+S7tlxuICAgKiBAcGFyYW0gdGFiSWQgXG4gICAqL1xuICBwcml2YXRlIHJlZ2lzdGVyRGVzdHJveUV2ZW50KHRhYklkOiBzdHJpbmcpIHtcbiAgICBpZiAodGhpcy5mcmFtZUNvbnRleHQgJiYgdGhpcy5mcmFtZUNvbnRleHQuZGVzdG9yeVNpZ25hbCkge1xuICAgICAgdGhpcy5mcmFtZUNvbnRleHQuZGVzdG9yeVNpZ25hbC5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICB0aGlzLm5hdmlnYXRpb25FdmVudFNlcnZpY2UgPSBudWxsO1xuICAgICAgfSk7XG4gICAgfVxuICAgIGlmICh0aGlzLmZyYW1lQ29udGV4dCAmJiB0aGlzLmZyYW1lQ29udGV4dC5hcHBDb250ZXh0ICYmIHRoaXMuZnJhbWVDb250ZXh0LmFwcENvbnRleHQuZGVzdG9yeVNpZ25hbCkge1xuICAgICAgdGhpcy5mcmFtZUNvbnRleHQuYXBwQ29udGV4dC5kZXN0b3J5U2lnbmFsLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgIGNvbnN0IGZvcm1FdmVudFNlcnZpY2VzID0gd2luZG93Wydmb3JtRXZlbnRTZXJ2aWNlcyddIGFzIE1hcDxzdHJpbmcsIGFueT47XG4gICAgICAgIGlmIChmb3JtRXZlbnRTZXJ2aWNlcykge1xuICAgICAgICAgIGZvcm1FdmVudFNlcnZpY2VzLmRlbGV0ZSh0YWJJZCk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgYXBwQ29udGV4dE1hbmFnZXIgPSB3aW5kb3dbQVBQX0NPTlRFWFRfTUFOQUdFUl0gYXMgTWFwPHN0cmluZywgYW55PjtcbiAgICAgICAgaWYgKGFwcENvbnRleHRNYW5hZ2VyKSB7XG4gICAgICAgICAgYXBwQ29udGV4dE1hbmFnZXIuZGVsZXRlKHRhYklkKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9XG4gIC8vICNyZWdpb24g5o6l5Y+jXG5cbiAgLyoqXG4gICAqIOaJk+W8gOiPnOWNlVxuICAgKiBAcGFyYW0gdGFiSWQg5qC55o2uVGFiSWTlhrPlrprmiZPlvIDmlrDmoIfnrb7pobXmiJblrprkvY3kuYvliY3miZPlvIDnmoTmoIfnrb7pobVcbiAgICogQHBhcmFtIGZ1bmNJZCDoj5zljZVJZFxuICAgKiBAcGFyYW0gcGFyYW1zIOWPguaVsFxuICAgKiBAcGFyYW0gcmVsb2FkIOaYr+WQpumHjeaWsOWIt+aWsFxuICAgKiBAcGFyYW0gZW5hYmxlUmVmcmVzaCDlkK/nlKjmlbDmja7liLfmlrBcbiAgICogQHBhcmFtIHRhYk5hbWUgdGFi5qCH6aKYXG4gICAqIEBwYXJhbSBkZXN0cnVjdHVyaW5nIOaYr+WQpuino+aehOWPguaVsFxuICAgKi9cbiAgcHVibGljIG9wZW5NZW51KHRhYklkOiBzdHJpbmcsIGZ1bmNJZDogc3RyaW5nLCBwYXJhbXM6IGFueSwgcmVsb2FkPzogYm9vbGVhbiwgZW5hYmxlUmVmcmVzaD86IGFueSwgdGFiTmFtZT86IHN0cmluZywgZGVzdHJ1Y3R1cmluZz86IGFueSkge1xuICAgIGlmICghZnVuY0lkICYmIHRoaXMuZm9ybU5vdGlmeVNlcnZpY2UpIHtcbiAgICAgIHRoaXMuZm9ybU5vdGlmeVNlcnZpY2Uud2FybmluZyh0aGlzLmxhbmd1YWdlU2VydmljZS5hcHBPckZ1bmNJZFJlcXVpcmVkLCB7IGhpZGVUaXRsZTogdHJ1ZSB9KTtcbiAgICAgIHJldHVybiBFTVBUWTtcbiAgICB9XG4gICAgaWYgKHRhYk5hbWUpIHtcbiAgICAgIHRhYk5hbWUgPSB0aGlzLnRyYW5zbGF0ZSh0YWJOYW1lKTtcbiAgICB9XG5cbiAgICBsZXQgcXVlcnlTdHJpbmdQYXJhbXMgPSB0aGlzLmJ1aWxkUGFyYW1NYXAocGFyYW1zKTtcbiAgICBkZXN0cnVjdHVyaW5nID0gdGhpcy5jb252ZXJ0VG9Cb29sZWFuKGRlc3RydWN0dXJpbmcsIGZhbHNlKTtcbiAgICBpZiAoZGVzdHJ1Y3R1cmluZyA9PT0gdHJ1ZSkge1xuICAgICAgcXVlcnlTdHJpbmdQYXJhbXMgPSB0aGlzLmJ1aWxkUGFyYW0ocGFyYW1zKTtcbiAgICB9XG4gICAgY29uc3QgcGFyYW1zTWFwID0gdGhpcy5idWlsZFBhcmFtTWFwKHBhcmFtcyk7XG4gICAgY29uc3QgY3VycmVudFRhYklkID0gdGhpcy5xdWVyeXN0cmluZ3MudGFiSWQgfHwgdGhpcy5xdWVyeXN0cmluZ3MuZnVuY0lkIHx8IHRoaXMucXVlcnlzdHJpbmdzLmFwcElkO1xuICAgIGNvbnN0IG9wdGlvbnM6IEFwcE9wdGlvbnMgPSB7XG4gICAgICB0YWJJZCxcbiAgICAgIGZ1bmNJZCxcbiAgICAgIGFwcFR5cGU6IEFwcFR5cGUuTWVudSxcbiAgICAgIHF1ZXJ5U3RyaW5nUGFyYW1zOiBxdWVyeVN0cmluZ1BhcmFtcyxcbiAgICAgIGVudGl0eVBhcmFtczogcGFyYW1zTWFwLFxuICAgICAgYXBwSWQ6IHVuZGVmaW5lZCxcbiAgICAgIGFwcEVudHJhbmNlOiB1bmRlZmluZWQsXG4gICAgICBpc1JlbG9hZDogcmVsb2FkLFxuICAgICAgdGFiTmFtZTogdGFiTmFtZSB8fCBudWxsXG4gICAgfTtcbiAgICAvLyDlkK/nlKjmlbDmja7liLfmlrDlj4LmlbDkuLp0cnVl5oiW6ICF5rKh5pyJ5a6a5LmJ77yM5YiZ5oyJ5Yi35paw5aSE55CGXG4gICAgLy8g5rKh5pyJ5Lyg6YCS6K+l5Y+C5pWw5oiW6K+l5Y+C5pWw5Li656m677yM5YiZ6K6k5Li65oyJ54Wn5LmL5YmN55qE6YC76L6R5aSE55CG77yM6buY6K6k5Yi35pawXG4gICAgLy8gbnVsbCBmYWxzZSBcImZhbHNlXCIgXCJ0cnVlXCIgdW5kZWZpbmVkXG4gICAgZW5hYmxlUmVmcmVzaCA9IHRoaXMuY29udmVydFRvQm9vbGVhbihlbmFibGVSZWZyZXNoLCB0cnVlKTtcbiAgICBpZiAoZW5hYmxlUmVmcmVzaCA9PT0gdHJ1ZSkge1xuICAgICAgdGhpcy5tZW51U3RhdGVTZXJ2aWNlLmFkZE1lbnVTdGF0ZShjdXJyZW50VGFiSWQsIHRhYklkKTtcbiAgICB9XG4gICAgdGhpcy5ydW50aW1lRnJhbWV3b3JrU2VydmljZS5vcGVuTWVudShvcHRpb25zKTtcbiAgfVxuICAvKipcbiAgICog5omT5byA6I+c5Y2V77yI5rWB77yJXG4gICAqIEBwYXJhbSB0YWJJZCDmoLnmja5UYWJJZOWGs+WumuaJk+W8gOaWsOagh+etvumhteaIluWumuS9jeS5i+WJjeaJk+W8gOeahOagh+etvumhtVxuICAgKiBAcGFyYW0gZnVuY0lkIOiPnOWNlUlkXG4gICAqIEBwYXJhbSBwYXJhbXMg5Y+C5pWwXG4gICAqIEBwYXJhbSByZWxvYWQg5piv5ZCm6YeN5paw5Yi35pawXG4gICAqIEBwYXJhbSBlbmFibGVSZWZyZXNoIOWQr+eUqOaVsOaNruWIt+aWsFxuICAgKiBAcGFyYW0gZGVzdHJ1Y3R1cmluZyDop6PmnoTlj4LmlbBcbiAgICovXG4gIHB1YmxpYyBvcGVuTWVudSQodGFiSWQ6IHN0cmluZywgZnVuY0lkOiBzdHJpbmcsIHBhcmFtczogYW55LCByZWxvYWQ/OiBib29sZWFuLCBlbmFibGVSZWZyZXNoPzogYW55LCB0YWJOYW1lPzogc3RyaW5nLCBkZXN0cnVjdHVyaW5nPzogYW55KSB7XG4gICAgaWYgKCFmdW5jSWQgJiYgdGhpcy5mb3JtTm90aWZ5U2VydmljZSkge1xuICAgICAgdGhpcy5mb3JtTm90aWZ5U2VydmljZS53YXJuaW5nKHRoaXMubGFuZ3VhZ2VTZXJ2aWNlLmFwcE9yRnVuY0lkUmVxdWlyZWQsIHsgaGlkZVRpdGxlOiB0cnVlIH0pO1xuICAgICAgcmV0dXJuIEVNUFRZO1xuICAgIH1cbiAgICBpZiAodGFiTmFtZSkge1xuICAgICAgdGFiTmFtZSA9IHRoaXMudHJhbnNsYXRlKHRhYk5hbWUpO1xuICAgIH1cbiAgICBsZXQgcXVlcnlTdHJpbmdQYXJhbXMgPSB0aGlzLmJ1aWxkUGFyYW1NYXAocGFyYW1zKTtcbiAgICBkZXN0cnVjdHVyaW5nID0gdGhpcy5jb252ZXJ0VG9Cb29sZWFuKGRlc3RydWN0dXJpbmcsIGZhbHNlKTtcbiAgICBpZiAoZGVzdHJ1Y3R1cmluZyA9PT0gdHJ1ZSkge1xuICAgICAgcXVlcnlTdHJpbmdQYXJhbXMgPSB0aGlzLmJ1aWxkUGFyYW0ocGFyYW1zKTtcbiAgICB9XG4gICAgY29uc3QgcGFyYW1zTWFwID0gdGhpcy5idWlsZFBhcmFtTWFwKHBhcmFtcyk7XG4gICAgY29uc3QgY3VycmVudFRhYklkID0gdGhpcy5xdWVyeXN0cmluZ3MudGFiSWQgfHwgdGhpcy5xdWVyeXN0cmluZ3MuZnVuY0lkIHx8IHRoaXMucXVlcnlzdHJpbmdzLmFwcElkO1xuICAgIGNvbnN0IG9wdGlvbnM6IEFwcE9wdGlvbnMgPSB7XG4gICAgICB0YWJJZCxcbiAgICAgIGZ1bmNJZCxcbiAgICAgIGFwcFR5cGU6IEFwcFR5cGUuTWVudSxcbiAgICAgIHF1ZXJ5U3RyaW5nUGFyYW1zOiBxdWVyeVN0cmluZ1BhcmFtcyxcbiAgICAgIGVudGl0eVBhcmFtczogcGFyYW1zTWFwLFxuICAgICAgYXBwSWQ6IHVuZGVmaW5lZCxcbiAgICAgIGFwcEVudHJhbmNlOiB1bmRlZmluZWQsXG4gICAgICBpc1JlbG9hZDogcmVsb2FkLFxuICAgICAgdGFiTmFtZTogdGFiTmFtZSB8fCBudWxsXG4gICAgfTtcbiAgICAvLyDlkK/nlKjmlbDmja7liLfmlrDlj4LmlbDkuLp0cnVl5oiW6ICF5rKh5pyJ5a6a5LmJ77yM5YiZ5oyJ5Yi35paw5aSE55CGXG4gICAgZW5hYmxlUmVmcmVzaCA9IHRoaXMuY29udmVydFRvQm9vbGVhbihlbmFibGVSZWZyZXNoLCB0cnVlKTtcbiAgICBpZiAoZW5hYmxlUmVmcmVzaCA9PT0gdHJ1ZSkge1xuICAgICAgdGhpcy5tZW51U3RhdGVTZXJ2aWNlLmFkZE1lbnVTdGF0ZShjdXJyZW50VGFiSWQsIHRhYklkKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMucnVudGltZUZyYW1ld29ya1NlcnZpY2Uub3Blbk1lbnUkKG9wdGlvbnMpO1xuICB9XG4gIC8qKlxuICAgKiDmiZPlvIDoj5zljZUo5bim57u05bqmKVxuICAgKiBAcGFyYW0gdGFiSWQg5qC55o2uVGFiSWTlhrPlrprmiZPlvIDmlrDmoIfnrb7pobXmiJblrprkvY3kuYvliY3miZPlvIDnmoTmoIfnrb7pobVcbiAgICogQHBhcmFtIGZ1bmNJZCDoj5zljZVJZFxuICAgKiBAcGFyYW0gcGFyYW1zIOWPguaVsFxuICAgKiBAcGFyYW0gcmVsb2FkIOaYr+WQpumHjeaWsOWIt+aWsFxuICAgKiBAcGFyYW0gZW5hYmxlUmVmcmVzaCDlkK/nlKjmlbDmja7liLfmlrBcbiAgICogQHBhcmFtIGRpbTEgZGltMVxuICAgKiBAcGFyYW0gZGltMiBkaW0yXG4gICAqIEBwYXJhbSBkZXN0cnVjdHVyaW5nIOino+aehOWPguaVsFxuICAgKi9cbiAgcHVibGljIG9wZW5NZW51V2l0aERpbWVuc2lvbih0YWJJZDogc3RyaW5nLCBmdW5jSWQ6IHN0cmluZywgcGFyYW1zOiBhbnksIGVuYWJsZVJlZnJlc2g/OiBhbnksIGRpbTE/OiBhbnksIGRpbTI/OiBhbnksIHRhYk5hbWU/OiBzdHJpbmcsIG1ldGFkYXRhSWQ/OiBzdHJpbmcsIGRlc3RydWN0dXJpbmc/OiBhbnkpIHtcbiAgICBpZiAoIWZ1bmNJZCAmJiB0aGlzLmZvcm1Ob3RpZnlTZXJ2aWNlKSB7XG4gICAgICB0aGlzLmZvcm1Ob3RpZnlTZXJ2aWNlLndhcm5pbmcodGhpcy5sYW5ndWFnZVNlcnZpY2UuYXBwT3JGdW5jSWRSZXF1aXJlZCwgeyBoaWRlVGl0bGU6IHRydWUgfSk7XG4gICAgICByZXR1cm4gRU1QVFk7XG4gICAgfVxuICAgIGlmICh0YWJOYW1lKSB7XG4gICAgICB0YWJOYW1lID0gdGhpcy50cmFuc2xhdGUodGFiTmFtZSk7XG4gICAgfVxuICAgIGlmIChtZXRhZGF0YUlkID09PSB1bmRlZmluZWQgfHwgbWV0YWRhdGFJZCA9PT0gbnVsbCkge1xuICAgICAgbWV0YWRhdGFJZCA9ICcnO1xuICAgIH1cbiAgICBsZXQgcXVlcnlTdHJpbmdQYXJhbXMgPSB0aGlzLmJ1aWxkUGFyYW1NYXAocGFyYW1zKTtcbiAgICBkZXN0cnVjdHVyaW5nID0gdGhpcy5jb252ZXJ0VG9Cb29sZWFuKGRlc3RydWN0dXJpbmcsIGZhbHNlKTtcbiAgICBpZiAoZGVzdHJ1Y3R1cmluZyA9PT0gdHJ1ZSkge1xuICAgICAgcXVlcnlTdHJpbmdQYXJhbXMgPSB0aGlzLmJ1aWxkUGFyYW0ocGFyYW1zKTtcbiAgICB9XG5cbiAgICBjb25zdCBwYXJhbXNNYXAgPSB0aGlzLmJ1aWxkUGFyYW1NYXAocGFyYW1zKTtcbiAgICBxdWVyeVN0cmluZ1BhcmFtcy5zZXQoJ2RpbTEnLCBkaW0xID8gZGltMSA6ICdwdWJsaWMnKTtcbiAgICBxdWVyeVN0cmluZ1BhcmFtcy5zZXQoJ2RpbTInLCBkaW0yID8gZGltMiA6ICdwdWJsaWMnKTtcbiAgICBxdWVyeVN0cmluZ1BhcmFtcy5zZXQoJ21ldGFkYXRhSWQnLCBtZXRhZGF0YUlkKTtcbiAgICBxdWVyeVN0cmluZ1BhcmFtcy5zZXQoJ2lzUnRjJywgJzEnKTtcbiAgICBxdWVyeVN0cmluZ1BhcmFtcy5zZXQoJ2lzUm9vdE1ldGFkYXRhJywgJ3RydWUnKTtcbiAgICBjb25zdCBjdXJyZW50VGFiSWQgPSB0aGlzLnF1ZXJ5c3RyaW5ncy50YWJJZCB8fCB0aGlzLnF1ZXJ5c3RyaW5ncy5mdW5jSWQgfHwgdGhpcy5xdWVyeXN0cmluZ3MuYXBwSWQ7XG4gICAgY29uc3Qgb3B0aW9uczogQXBwT3B0aW9ucyA9IHtcbiAgICAgIHRhYklkLFxuICAgICAgZnVuY0lkLFxuICAgICAgYXBwVHlwZTogQXBwVHlwZS5NZW51LFxuICAgICAgcXVlcnlTdHJpbmdQYXJhbXM6IHF1ZXJ5U3RyaW5nUGFyYW1zLFxuICAgICAgZW50aXR5UGFyYW1zOiBwYXJhbXNNYXAsXG4gICAgICBhcHBJZDogdW5kZWZpbmVkLFxuICAgICAgYXBwRW50cmFuY2U6IHVuZGVmaW5lZCxcbiAgICAgIGlzUmVsb2FkOiBmYWxzZSxcbiAgICAgIHRhYk5hbWU6IHRhYk5hbWUgfHwgbnVsbFxuICAgIH07XG4gICAgLy8g5ZCv55So5pWw5o2u5Yi35paw5Y+C5pWw5Li6dHJ1ZeaIluiAheayoeacieWumuS5ie+8jOWImeaMieWIt+aWsOWkhOeQhlxuICAgIC8vIOayoeacieS8oOmAkuivpeWPguaVsOaIluivpeWPguaVsOS4uuepuu+8jOWImeiupOS4uuaMieeFp+S5i+WJjeeahOmAu+i+keWkhOeQhu+8jOm7mOiupOWIt+aWsFxuICAgIC8vIG51bGwgZmFsc2UgXCJmYWxzZVwiIFwidHJ1ZVwiIHVuZGVmaW5lZFxuICAgIGVuYWJsZVJlZnJlc2ggPSB0aGlzLmNvbnZlcnRUb0Jvb2xlYW4oZW5hYmxlUmVmcmVzaCwgdHJ1ZSk7XG4gICAgaWYgKGVuYWJsZVJlZnJlc2ggPT09IHRydWUpIHtcbiAgICAgIHRoaXMubWVudVN0YXRlU2VydmljZS5hZGRNZW51U3RhdGUoY3VycmVudFRhYklkLCB0YWJJZCk7XG4gICAgfVxuICAgIHRoaXMucnVudGltZUZyYW1ld29ya1NlcnZpY2Uub3Blbk1lbnUob3B0aW9ucyk7XG4gIH1cbiAgLyoqXG4gICAqIOaJk+W8gOW6lOeUqFxuICAgKiBAcGFyYW0gdGFiSWQgdGFiSWQg5qC55o2uVGFiSWTlhrPlrprmiZPlvIDmlrDmoIfnrb7pobXmiJblrprkvY3kuYvliY3miZPlvIDnmoTmoIfnrb7pobVcbiAgICogQHBhcmFtIGFwcElkIOW6lOeUqElkXG4gICAqIEBwYXJhbSBhcHBFbnRyYW5jZSDlupTnlKjlhaXlj6NcbiAgICogQHBhcmFtIHBhcmFtcyDlj4LmlbBcbiAgICogQHBhcmFtIHJlbG9hZCDmmK/lkKbph43mlrDliLfmlrBcbiAgICogQHBhcmFtIHRhYk5hbWUgdGFi5qCH6aKYXG4gICAqIEBwYXJhbSBlbmFibGVSZWZyZXNoIOWQr+eUqOaVsOaNruWIt+aWsFxuICAgKiBAcGFyYW0gZGVzdHJ1Y3R1cmluZyDop6PmnoTlj4LmlbBcbiAgICovXG5cbiAgcHVibGljIG9wZW5BcHAodGFiSWQ6IHN0cmluZywgYXBwSWQ6IHN0cmluZywgYXBwRW50cmFuY2U6IHN0cmluZywgcGFyYW1zOiBhbnksIHJlbG9hZD86IGJvb2xlYW4sIHRhYk5hbWU/OiBzdHJpbmcsIGVuYWJsZVJlZnJlc2g/OiBhbnksIGRlc3RydWN0dXJpbmc/OiBhbnkpIHtcbiAgICBpZiAoIWFwcElkICYmIHRoaXMuZm9ybU5vdGlmeVNlcnZpY2UpIHtcbiAgICAgIHRoaXMuZm9ybU5vdGlmeVNlcnZpY2Uud2FybmluZyh0aGlzLmxhbmd1YWdlU2VydmljZS5hcHBPckZ1bmNJZFJlcXVpcmVkLCB7IGhpZGVUaXRsZTogdHJ1ZSB9KTtcbiAgICAgIHJldHVybiBFTVBUWTtcbiAgICB9XG4gICAgaWYgKHRhYk5hbWUpIHtcbiAgICAgIHRhYk5hbWUgPSB0aGlzLnRyYW5zbGF0ZSh0YWJOYW1lKTtcbiAgICB9XG4gICAgbGV0IHF1ZXJ5U3RyaW5nUGFyYW1zID0gdGhpcy5idWlsZFBhcmFtTWFwKHBhcmFtcyk7XG4gICAgZGVzdHJ1Y3R1cmluZyA9IHRoaXMuY29udmVydFRvQm9vbGVhbihkZXN0cnVjdHVyaW5nLCBmYWxzZSk7XG4gICAgaWYgKGRlc3RydWN0dXJpbmcgPT09IHRydWUpIHtcbiAgICAgIHF1ZXJ5U3RyaW5nUGFyYW1zID0gdGhpcy5idWlsZFBhcmFtKHBhcmFtcyk7XG4gICAgfVxuICAgIGNvbnN0IHBhcmFtc01hcCA9IHRoaXMuYnVpbGRQYXJhbU1hcChwYXJhbXMpO1xuICAgIGNvbnN0IGN1cnJlbnRUYWJJZCA9IHRoaXMucXVlcnlzdHJpbmdzLnRhYklkIHx8IHRoaXMucXVlcnlzdHJpbmdzLmZ1bmNJZCB8fCB0aGlzLnF1ZXJ5c3RyaW5ncy5hcHBJZDtcbiAgICBjb25zdCBvcHRpb25zOiBBcHBPcHRpb25zID0ge1xuICAgICAgdGFiSWQsXG4gICAgICBhcHBJZCxcbiAgICAgIGFwcEVudHJhbmNlLFxuICAgICAgZnVuY0lkOiB1bmRlZmluZWQsXG4gICAgICBhcHBUeXBlOiBBcHBUeXBlLkFwcCxcbiAgICAgIHF1ZXJ5U3RyaW5nUGFyYW1zOiBxdWVyeVN0cmluZ1BhcmFtcyxcbiAgICAgIGVudGl0eVBhcmFtczogcGFyYW1zTWFwLFxuICAgICAgaXNSZWxvYWQ6IHJlbG9hZCxcbiAgICAgIHRhYk5hbWU6IHRhYk5hbWUgfHwgbnVsbFxuICAgIH07XG4gICAgZW5hYmxlUmVmcmVzaCA9IHRoaXMuY29udmVydFRvQm9vbGVhbihlbmFibGVSZWZyZXNoLCB0cnVlKTtcbiAgICBpZiAoZW5hYmxlUmVmcmVzaCA9PT0gdHJ1ZSkge1xuICAgICAgdGhpcy5tZW51U3RhdGVTZXJ2aWNlLmFkZE1lbnVTdGF0ZShjdXJyZW50VGFiSWQsIHRhYklkKTtcbiAgICB9XG4gICAgdGhpcy5ydW50aW1lRnJhbWV3b3JrU2VydmljZS5vcGVuTWVudShvcHRpb25zKTtcbiAgfVxuICAvKipcbiAgICog5omT5byA5bqU55SoKOa1geW8jylcbiAgICogQHBhcmFtIHRhYklkIHRhYklkIOagueaNrlRhYklk5Yaz5a6a5omT5byA5paw5qCH562+6aG15oiW5a6a5L2N5LmL5YmN5omT5byA55qE5qCH562+6aG1XG4gICAqIEBwYXJhbSBhcHBJZCDlupTnlKhJZFxuICAgKiBAcGFyYW0gYXBwRW50cmFuY2Ug5bqU55So5YWl5Y+jXG4gICAqIEBwYXJhbSBwYXJhbXMg5Y+C5pWwXG4gICAqIEBwYXJhbSByZWxvYWQg5piv5ZCm6YeN5paw5Yi35pawXG4gICAqIEBwYXJhbSB0YWJOYW1lIHRhYuagh+mimFxuICAgKiBAcGFyYW0gZW5hYmxlUmVmcmVzaCDlkK/nlKjmlbDmja7liLfmlrBcbiAgICogQHBhcmFtIGRlc3RydWN0dXJpbmcg6Kej5p6E5Y+C5pWwXG4gICAqL1xuICBwdWJsaWMgb3BlbkFwcCQodGFiSWQ6IHN0cmluZywgYXBwSWQ6IHN0cmluZywgYXBwRW50cmFuY2U6IHN0cmluZywgcGFyYW1zOiBhbnksIHJlbG9hZD86IGJvb2xlYW4sIHRhYk5hbWU/OiBzdHJpbmcsIGVuYWJsZVJlZnJlc2g/OiBhbnksIGRlc3RydWN0dXJpbmc/OiBhbnkpIHtcbiAgICBpZiAoIWFwcElkICYmIHRoaXMuZm9ybU5vdGlmeVNlcnZpY2UpIHtcbiAgICAgIHRoaXMuZm9ybU5vdGlmeVNlcnZpY2Uud2FybmluZyh0aGlzLmxhbmd1YWdlU2VydmljZS5hcHBPckZ1bmNJZFJlcXVpcmVkLCB7IGhpZGVUaXRsZTogdHJ1ZSB9KTtcbiAgICAgIHJldHVybiBFTVBUWTtcbiAgICB9XG4gICAgaWYgKHRhYk5hbWUpIHtcbiAgICAgIHRhYk5hbWUgPSB0aGlzLnRyYW5zbGF0ZSh0YWJOYW1lKTtcbiAgICB9XG4gICAgbGV0IHF1ZXJ5U3RyaW5nUGFyYW1zID0gdGhpcy5idWlsZFBhcmFtTWFwKHBhcmFtcyk7XG4gICAgZGVzdHJ1Y3R1cmluZyA9IHRoaXMuY29udmVydFRvQm9vbGVhbihkZXN0cnVjdHVyaW5nLCBmYWxzZSk7XG4gICAgaWYgKGRlc3RydWN0dXJpbmcgPT09IHRydWUpIHtcbiAgICAgIHF1ZXJ5U3RyaW5nUGFyYW1zID0gdGhpcy5idWlsZFBhcmFtKHBhcmFtcyk7XG4gICAgfVxuICAgIGNvbnN0IHBhcmFtc01hcCA9IHRoaXMuYnVpbGRQYXJhbU1hcChwYXJhbXMpO1xuICAgIGNvbnN0IGN1cnJlbnRUYWJJZCA9IHRoaXMucXVlcnlzdHJpbmdzLnRhYklkIHx8IHRoaXMucXVlcnlzdHJpbmdzLmZ1bmNJZCB8fCB0aGlzLnF1ZXJ5c3RyaW5ncy5hcHBJZDtcbiAgICBjb25zdCBvcHRpb25zOiBBcHBPcHRpb25zID0ge1xuICAgICAgdGFiSWQsXG4gICAgICBhcHBJZCxcbiAgICAgIGFwcEVudHJhbmNlLFxuICAgICAgZnVuY0lkOiB1bmRlZmluZWQsXG4gICAgICBhcHBUeXBlOiBBcHBUeXBlLkFwcCxcbiAgICAgIHF1ZXJ5U3RyaW5nUGFyYW1zOiBxdWVyeVN0cmluZ1BhcmFtcyxcbiAgICAgIGVudGl0eVBhcmFtczogcGFyYW1zTWFwLFxuICAgICAgaXNSZWxvYWQ6IHJlbG9hZCxcbiAgICAgIHRhYk5hbWU6IHRhYk5hbWUgfHwgbnVsbFxuICAgIH07XG4gICAgZW5hYmxlUmVmcmVzaCA9IHRoaXMuY29udmVydFRvQm9vbGVhbihlbmFibGVSZWZyZXNoLCB0cnVlKTtcbiAgICBpZiAoZW5hYmxlUmVmcmVzaCA9PT0gdHJ1ZSkge1xuICAgICAgdGhpcy5tZW51U3RhdGVTZXJ2aWNlLmFkZE1lbnVTdGF0ZShjdXJyZW50VGFiSWQsIHRhYklkKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMucnVudGltZUZyYW1ld29ya1NlcnZpY2Uub3Blbk1lbnUkKG9wdGlvbnMpO1xuICB9XG4gIC8qKlxuICAgKiDlhbPpl61cbiAgICogQHBhcmFtIG9uQ2xvc2Vpbmcg5YWz6Zet5YmN5LqL5Lu25aSE55CG5ZmoXG4gICAqL1xuICBwdWJsaWMgY2xvc2UoKSB7XG4gICAgY29uc3Qgb3B0aW9ucyA9IHRoaXMucXVlcnlzdHJpbmdzO1xuICAgIGNvbnN0IHsgaXNEaWFsb2dDb21wb25lbnQ6IGlzSW5EaWFsb2csIHJvb3RDb21wb25lbnQgfSA9IHRoaXMuZmluZERpYWxvZygpO1xuICAgIGlmIChpc0luRGlhbG9nKSB7XG4gICAgICBjb25zdCBtb2RhbFJlZiA9IHRoaXMuZ2V0KHJvb3RDb21wb25lbnQsICdkaWFsb2dSZWYnKTtcbiAgICAgIG1vZGFsUmVmWydjbG9zZSddKCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIG9wdGlvbnMudG9rZW4gPSBvcHRpb25zLmZvcm1Ub2tlbjtcbiAgICB0aGlzLnJ1bnRpbWVGcmFtZXdvcmtTZXJ2aWNlLmJlZm9yZUNsb3NlTWVudShvcHRpb25zKTtcbiAgfVxuICAvKipcbiAgICog5by65Yi25YWz6ZetXG4gICAqL1xuICBwdWJsaWMgZGVzdG9yeSgpIHtcbiAgICBjb25zdCBvcHRpb25zID0gdGhpcy5xdWVyeXN0cmluZ3M7XG4gICAgb3B0aW9ucy50b2tlbiA9IG9wdGlvbnMuZm9ybVRva2VuO1xuICAgIHRoaXMucnVudGltZUZyYW1ld29ya1NlcnZpY2UuY2xvc2VNZW51KG9wdGlvbnMpO1xuICB9XG4gIC8qKlxuICAgKiBcbiAgICogQHBhcmFtIHBhcmFtcyBwYXJhbXNcbiAgICogQGRlcHJlY2F0ZWQg5b6F5bqf5byD77yM5LiOYnVpbGRQYXJhbU1hcOmHjeWkjVxuICAgKi9cbiAgcHJpdmF0ZSBwYXJzZVBhcmFtcyhwYXJhbXM6IGFueSkge1xuICAgIGlmICh0eXBlb2YgcGFyYW1zID09PSAndW5kZWZpbmVkJyB8fCBwYXJhbXMgPT09IG51bGwgfHwgKHR5cGVvZiBwYXJhbXMgPT09ICdzdHJpbmcnICYmIHBhcmFtcy5sZW5ndGggPCAxKSkge1xuICAgICAgcGFyYW1zID0ge307XG4gICAgfVxuICAgIGNvbnN0IHBhcmFtTWFwID0gbmV3IE1hcDxzdHJpbmcsIGFueT4oKTtcbiAgICBpZiAodHlwZW9mIHBhcmFtcyA9PT0gJ29iamVjdCcpIHtcbiAgICAgIHBhcmFtcyA9IEpTT04uc3RyaW5naWZ5KHBhcmFtcyk7XG4gICAgfVxuICAgIHBhcmFtcyA9IHdpbmRvd1snZW5jb2RlVVJJQ29tcG9uZW50J10ocGFyYW1zKTtcbiAgICBwYXJhbU1hcC5zZXQoJ1dFQl9GT1JNX1JPVVRFX1BBUkFNUycsIHBhcmFtcyk7XG4gICAgcmV0dXJuIHBhcmFtTWFwO1xuICB9XG4gIC8qKlxuICAgKiDms6jlhozkuovku7bnm5HlkKzlmahcbiAgICogQHBhcmFtIGV2ZW50VHlwZSDkuovku7bnsbvlnosgb25UYWJDbG9zZWRcbiAgICogQHBhcmFtIGhhbmRsZXIg5aSE55CG5ZmoXG4gICAqIEByZXR1cm5zIHN0cmluZyDov5Tlm57kuovku7bmoIfor4ZcbiAgICovXG4gIHB1YmxpYyBhZGRFdmVudExpc3RlbmVyKGV2ZW50VHlwZTogc3RyaW5nLCBoYW5kbGVyOiAob3B0aW9uczogQXBwT3B0aW9ucykgPT4gYW55KTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5uYXZpZ2F0aW9uRXZlbnRTZXJ2aWNlLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnRUeXBlLCBoYW5kbGVyKTtcbiAgfVxuICAvKipcbiAgICog56e76Zmk5LqL5Lu255uR5ZCs5ZmoXG4gICAqIEBwYXJhbSBldmVudFR5cGUg5LqL5Lu257G75Z6LIG9uVGFiQ2xvc2VkIHwgb25UYWJDbG9zZWluZ1xuICAgKiBAcGFyYW0ga2V5IOS6i+S7tuagh+ivhlxuICAgKi9cbiAgcHVibGljIHJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnRUeXBlOiBzdHJpbmcsIGtleTogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMubmF2aWdhdGlvbkV2ZW50U2VydmljZS5yZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50VHlwZSwga2V5KTtcbiAgfVxuICAvKipcbiAgICog5riF56m65LqL5Lu255uR5ZCs5ZmoXG4gICAqIEBwYXJhbSBldmVudFR5cGUg5LqL5Lu257G75Z6LXG4gICAqL1xuICBwdWJsaWMgY2xlYXJFdmVudExpc3RlbmVyKGV2ZW50VHlwZTogc3RyaW5nKTogdm9pZCB7XG4gICAgdGhpcy5uYXZpZ2F0aW9uRXZlbnRTZXJ2aWNlLmNsZWFyRXZlbnRMaXN0ZW5lcihldmVudFR5cGUpO1xuICB9XG4gIC8qKlxuICAgKiDku6XlvLnmoYbjgIHkvqfovrnmoI/miJbmlrDmoIfnrb7pobXmlrnlvI/miZPlvIDooajljZVcbiAgICogQHBhcmFtIG1vZGUg5omT5byA5pa55byP77yM5pSv5oyBYG1vZGFsYOW8ueeql+OAgWBzaWRlYmFyYOS+p+i+ueagj+OAgWB0YWJg5paw5qCH562+6aG1XG4gICAqIEBwYXJhbSBtb2RhbElkIOW8ueeql2lk77yM5aaC5p6cbW9kZT1gbW9kYWxg5LiU5rKh5pyJdXJs77yMXG4gICAqIEBwYXJhbSBjb25maWdzIOW8ueeql+mFjee9rlxuICAgKiBAcGFyYW0gdXJsIOi/nOerr+ihqOWNlXVybFxuICAgKiBAcGFyYW0gdGFiSWQg5qCH562+6aG1aWTvvIxtb2RhbD10YWLml7blv4XloatcbiAgICogQHBhcmFtIHRhYlR5cGUg5qCH562+6aG157G75Z6L77yMYG1lbnVgIOaIlmBhcHBgXG4gICAqIEBwYXJhbSBmdW5jT3JBcHBJZCDoj5zljZXmiJblupTnlKhpZFxuICAgKiBAcGFyYW0gYXBwRW50cmFuY2Ug5bqU55So5YWl5Y+jXG4gICAqIEBwYXJhbSBwYXJhbXMg5Y+C5pWwXG4gICAqIEBwYXJhbSB0YWJOYW1lIOaWsOagh+etvumhteWQjeensFxuICAgKiBAcGFyYW0gZW5hYmxlUmVmcmVzaCDlkK/nlKjlkK/liqjliLfmlrBcbiAgICogQHBhcmFtIGRlc3RydWN0dXJpbmcg5piv5ZCm6Kej5p6EXG4gICAqL1xuICBwdWJsaWMgb3Blbihtb2RlOiAnbW9kYWwnIHwgJ3NpZGViYXInIHwgJ3RhYicsIG1vZGFsSWQ/OiBzdHJpbmcsIHVybD86IHN0cmluZywgY29uZmlncz86IGFueSwgdGFiSWQ/OiBzdHJpbmcsIHRhYlR5cGU/OiAnbWVudScgfCAnYXBwJywgZnVuY09yQXBwSWQ/OiBzdHJpbmcsIGFwcEVudHJhbmNlPzogc3RyaW5nLCBwYXJhbXM/OiBhbnksIHRhYk5hbWU/OiBzdHJpbmcsIGVuYWJsZVJlZnJlc2g/OiBhbnksIGRlc3RydWN0dXJpbmc/OiBhbnkpIHtcbiAgICBjb25zdCBwYWdlTW9kYWxTZXJ2aWNlID0gdGhpcy5pbmplY3Rvci5nZXQ8RkVQYWdlTW9kYWxTZXJ2aWNlPihGRVBhZ2VNb2RhbFNlcnZpY2UsIG51bGwpO1xuICAgIGlmICghcGFnZU1vZGFsU2VydmljZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdnZXQgRkVQYWdlTW9kYWxTZXJ2aWNlIGZhaWxlZC4nKTtcbiAgICB9XG4gICAgLy8g5qCh6aqM5Y+C5pWw5piv5ZCm5ZCI5rOVXG4gICAgaWYgKCFtb2RlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1tOYXZpZ2F0aW9uU2VydmljZV0tPm9wZW4sbW9kZeWPguaVsOS4jeiDveS4uuepuu+8gScpO1xuICAgIH1cbiAgICBpZiAobW9kZSA9PT0gJ21vZGFsJyB8fCBtb2RlID09PSAnc2lkZWJhcicpIHtcbiAgICAgIGlmICghbW9kYWxJZCAmJiAhdXJsKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcign5by556qX5Y+K5L6n6L655qCP5qih5byP5pe25by556qX5a655ZmoaWTlkozooajljZXot6/lvoTkuI3og73lkIzml7bkuLrnqbrvvIEnKTtcbiAgICAgIH1cbiAgICAgIGlmIChtb2RhbElkICYmIHVybCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ+W8ueeql+WPiuS+p+i+ueagj+aooeW8j+aXtuW8ueeql+WuueWZqGlk5ZKM6KGo5Y2V6Lev5b6E5LiN6IO95ZCM5pe25a2Y5Zyo77yBJyk7XG4gICAgICB9XG4gICAgICBjb25zdCB1aVN0YXRlQ29uZmlnID0gdGhpcy5nZXRPYmplY3RUeXBlQ29uZmlnKHBhcmFtcyk7XG4gICAgICBjb25zdCBtb2RhbENvbmZpZyA9IHRoaXMuYnVpbGRDb25maWdzKGNvbmZpZ3MpO1xuICAgICAgaWYgKG1vZGUgPT09ICdzaWRlYmFyJykge1xuICAgICAgICBtb2RhbENvbmZpZy5kaWFsb2dUeXBlID0gbW9kZTtcbiAgICAgIH1cbiAgICAgIGxldCBwYWdlTW9kYWxSZWYgPSBudWxsO1xuICAgICAgaWYgKG1vZGFsSWQpIHtcbiAgICAgICAgY29uc3QgZmFycmlzRm9ybVNlcnZpY2UgPSB0aGlzLmluamVjdG9yLmdldDxGYXJyaXNGb3JtU2VydmljZT4oRmFycmlzRm9ybVNlcnZpY2UsIG51bGwpO1xuICAgICAgICBpZiAoIWZhcnJpc0Zvcm1TZXJ2aWNlKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGxldCBjb21wb25lbnRUeXBlID0gZmFycmlzRm9ybVNlcnZpY2UuZ2V0Q29udHJvbHMobW9kYWxJZCk7XG4gICAgICAgIGNvbnN0IGNvbXBvbmVudFJlZiA9IHRoaXMuY3JlYXRlQ29tcG9uZW50UmVmKGNvbXBvbmVudFR5cGUsIHVpU3RhdGVDb25maWcpO1xuICAgICAgICBwYWdlTW9kYWxSZWYgPSBwYWdlTW9kYWxTZXJ2aWNlLnNob3coY29tcG9uZW50UmVmLCBtb2RhbENvbmZpZyk7XG4gICAgICB9IGVsc2UgaWYgKHVybCkge1xuICAgICAgICBwYWdlTW9kYWxSZWYgPSBwYWdlTW9kYWxTZXJ2aWNlLnNob3dCeVVybCh1cmwsIG1vZGFsQ29uZmlnKTtcbiAgICAgIH1cbiAgICAgIGlmIChwYWdlTW9kYWxSZWYgJiYgISFwYWdlTW9kYWxSZWYuY29udGVudCkge1xuICAgICAgICBwYWdlTW9kYWxSZWYuY29udGVudC5pc0RpYWxvZ1Jvb3RDb21wb25lbnQgPSB0cnVlO1xuICAgICAgICBwYWdlTW9kYWxSZWYuY29udGVudC5kaWFsb2dSZWYgPSBwYWdlTW9kYWxSZWY7XG4gICAgICAgIGNvbnN0IGhlYWRlciA9IHBhZ2VNb2RhbFJlZi5kaWFsb2cgJiYgcGFnZU1vZGFsUmVmLmRpYWxvZy5pbnN0YW5jZSAmJiBwYWdlTW9kYWxSZWYuZGlhbG9nLmluc3RhbmNlLmVsICYmIHBhZ2VNb2RhbFJlZi5kaWFsb2cuaW5zdGFuY2UuZWwubmF0aXZlRWxlbWVudCAmJiBwYWdlTW9kYWxSZWYuZGlhbG9nLmluc3RhbmNlLmVsLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5mLXBhZ2UtaGVhZGVyXCIpO1xuICAgICAgICBpZiAoaGVhZGVyICYmIHBhZ2VNb2RhbFJlZi5kaWFsb2cuaW5zdGFuY2UuZHJhZ2diYXIpIHtcbiAgICAgICAgICBwYWdlTW9kYWxSZWYuZGlhbG9nLmluc3RhbmNlLmRyYWdnYmFyLmhhbmRsZSA9IGhlYWRlcjtcbiAgICAgICAgICBoZWFkZXIuc3R5bGUuY3Vyc29yID0gJ21vdmUnO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChtb2RlID09PSAndGFiJykge1xuICAgICAgaWYgKCF0YWJJZCB8fCAhdGFiVHlwZSB8fCAhZnVuY09yQXBwSWQpIHtcbiAgICAgICAgaWYgKHRoaXMuZm9ybU5vdGlmeVNlcnZpY2UpIHtcbiAgICAgICAgICB0aGlzLmZvcm1Ob3RpZnlTZXJ2aWNlLndhcm5pbmcodGhpcy5sYW5ndWFnZVNlcnZpY2UuYXBwT3JGdW5jSWRSZXF1aXJlZCwgeyBoaWRlVGl0bGU6IHRydWUgfSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCfmlrDmoIfnrb7mqKHlvI/ml7bmoIfnrb7pobVpZOOAgeagh+etvuexu+Wei+OAgeiPnOWNleaIluW6lOeUqGlk5Z2H5LiN6IO95Li656m677yBJyk7XG4gICAgICB9XG4gICAgICBpZiAodGFiVHlwZSA9PT0gJ2FwcCcgJiYgIWFwcEVudHJhbmNlKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcign5Lul5bqU55So5pa55byP5omT5byA5pe25YWl5Y+j5bqU55So5LiN6IO95Li656m677yBJyk7XG4gICAgICB9XG4gICAgICBpZiAodGFiVHlwZSA9PSAnYXBwJykge1xuICAgICAgICB0aGlzLm9wZW5BcHAodGFiSWQsIGZ1bmNPckFwcElkLCBhcHBFbnRyYW5jZSwgcGFyYW1zLCBmYWxzZSwgdGFiTmFtZSwgZW5hYmxlUmVmcmVzaCwgZGVzdHJ1Y3R1cmluZyk7XG4gICAgICB9IGVsc2UgaWYgKHRhYlR5cGUgPT09ICdtZW51Jykge1xuICAgICAgICB0aGlzLm9wZW5NZW51KHRhYklkLCBmdW5jT3JBcHBJZCwgcGFyYW1zLCBmYWxzZSwgZW5hYmxlUmVmcmVzaCwgdGFiTmFtZSwgZGVzdHJ1Y3R1cmluZyk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcign5LiN5pSv5oyB55qE5qih5byP77yBJyk7XG4gICAgfVxuICAgIC8vIHRoaXMucGFnZU1vZGFsU2VydmljZS5cbiAgfVxuICAvKipcbiAgICogaW4gYXBwIG5hdmlnYXRlXG4gICAqIEBwYXJhbSBjb21tYW5kcyBjb21tYW5kc1xuICAgKi9cbiAgLy8gcHVibGljIG5hdmlnYXRlKGNvbW1hbmRzOiBhbnlbXSk7XG4gIC8qKlxuICAgKiBpbiBhcHAgbmF2aWdhdGVcbiAgICogQHBhcmFtIGNvbW1hbmRzIGNvbW1hbmRzXG4gICAqIEBwYXJhbSBvcHRpb25zIG9wdGlvbnNcbiAgICogQGRlc2NyaXB0aW9uIG9wdGlvbnM6eyByZWxhdGl2ZVRvOiB0aGlzLmFjdGl2YXRlZFJvdXRlLCBxdWVyeVBhcmFtczp7YToxLGI6Mn0sZXRjOi4uLn1cbiAgICovXG4gIHB1YmxpYyBuYXZpZ2F0ZShjb21tYW5kczogYW55W10sIG9wdGlvbnM/OiBhbnkpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBjb25zdCByb3V0ZXIgPSB0aGlzLmluamVjdG9yICYmIHRoaXMuaW5qZWN0b3IuZ2V0PFJvdXRlcj4oUm91dGVyLCBudWxsKTtcbiAgICBjb25zdCBhY3RpdmF0ZWRSb3V0ZSA9IHRoaXMuaW5qZWN0b3IgJiYgdGhpcy5pbmplY3Rvci5nZXQ8QWN0aXZhdGVkUm91dGU+KEFjdGl2YXRlZFJvdXRlLCBudWxsKTtcbiAgICBjb25zdCBxdWVyeVBhcmFtcyA9IGxvZGFzaC5tZXJnZSh7fSwgdGhpcy5xdWVyeXN0cmluZ3MsIG9wdGlvbnMgJiYgb3B0aW9ucy5xdWVyeVBhcmFtcyB8fCB7fSk7XG4gICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5oYXNPd25Qcm9wZXJ0eSgncXVlcnlQYXJhbXMnKSkge1xuICAgICAgZGVsZXRlIG9wdGlvbnMucXVlcnlQYXJhbXM7XG4gICAgfVxuICAgIGNvbnN0IGV4dHJhcyA9IGxvZGFzaC5tZXJnZSh7IHNraXBMb2NhdGlvbkNoYW5nZTogZmFsc2UsIHJlbGF0aXZlVG86IGFjdGl2YXRlZFJvdXRlLCBxdWVyeVBhcmFtcyB9LCBvcHRpb25zIHx8IHt9KTtcbiAgICBpZiAocm91dGVyKSB7XG4gICAgICByZXR1cm4gcm91dGVyLm5hdmlnYXRlKGNvbW1hbmRzLCBleHRyYXMpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH1cbiAgLy8gI2VuZHJlZ2lvblxuXG4gIC8vICNyZWdpb24g56eB5pyJ5pa55rOVXG5cbiAgLyoqXG4gICAqIOWwgeijhei3r+eUseWPguaVsFxuICAgKiBAcGFyYW0gcGFyYW1zIOWPguaVsFxuICAgKiBAcGFyYW0gb3B0aW9ucyDphY3nva7lj4LmlbBcbiAgICovXG4gIHByaXZhdGUgYnVpbGRQYXJhbU1hcChwYXJhbXM6IGFueSwgb3B0aW9ucz86IGFueSk6IE1hcDxzdHJpbmcsIHN0cmluZz4ge1xuICAgIGlmICh0eXBlb2YgcGFyYW1zID09PSAndW5kZWZpbmVkJyB8fCBwYXJhbXMgPT09IG51bGwgfHwgKHR5cGVvZiBwYXJhbXMgPT09ICdzdHJpbmcnICYmIHBhcmFtcy5sZW5ndGggPCAxKSkge1xuICAgICAgcGFyYW1zID0ge307XG4gICAgfVxuICAgIGNvbnN0IHBhcmFtTWFwID0gbmV3IE1hcDxzdHJpbmcsIGFueT4oKTtcbiAgICBpZiAob3B0aW9ucyAmJiBPYmplY3Qua2V5cyhvcHRpb25zKS5sZW5ndGggPiAwKSB7XG4gICAgICBpZiAodHlwZW9mIHBhcmFtcyAhPT0gJ29iamVjdCcpIHtcbiAgICAgICAgcGFyYW1zID0gSlNPTi5wYXJzZShwYXJhbXMpO1xuICAgICAgfVxuICAgICAgcGFyYW1zID0gbG9kYXNoLm1lcmdlKHBhcmFtcywgb3B0aW9ucyk7XG4gICAgfVxuICAgIGlmICh0eXBlb2YgcGFyYW1zID09PSAnb2JqZWN0Jykge1xuICAgICAgcGFyYW1zID0gSlNPTi5zdHJpbmdpZnkocGFyYW1zKTtcbiAgICB9XG4gICAgY29uc3QgY3VycmVudFRhYklkID0gdGhpcy5xdWVyeXN0cmluZ3MudGFiSWQgfHwgdGhpcy5xdWVyeXN0cmluZ3MuZnVuY0lkIHx8IHRoaXMucXVlcnlzdHJpbmdzLmFwcElkO1xuICAgIHBhcmFtcyA9IHdpbmRvd1snZW5jb2RlVVJJQ29tcG9uZW50J10ocGFyYW1zKTtcbiAgICBwYXJhbU1hcC5zZXQoJ1dFQl9GT1JNX1JPVVRFX1BBUkFNUycsIHBhcmFtcyk7XG4gICAgcGFyYW1NYXAuc2V0KCdXRUJfRk9STV9ST1VURVJfUEFSRU5UX0lEJywgY3VycmVudFRhYklkKTtcbiAgICByZXR1cm4gcGFyYW1NYXA7XG4gIH1cbiAgcHJpdmF0ZSBidWlsZFBhcmFtKHBhcmFtcywgb3B0aW9ucz86IGFueSk6IE1hcDxzdHJpbmcsIHN0cmluZz4ge1xuICAgIGlmICh0eXBlb2YgcGFyYW1zID09PSAndW5kZWZpbmVkJyB8fCBwYXJhbXMgPT09IG51bGwgfHwgKHR5cGVvZiBwYXJhbXMgPT09ICdzdHJpbmcnICYmIHBhcmFtcy5sZW5ndGggPCAxKSkge1xuICAgICAgcGFyYW1zID0ge307XG4gICAgfVxuICAgIGNvbnN0IHBhcmFtTWFwID0gbmV3IE1hcDxzdHJpbmcsIGFueT4oKTtcbiAgICBpZiAob3B0aW9ucyAmJiBPYmplY3Qua2V5cyhvcHRpb25zKS5sZW5ndGggPiAwKSB7XG4gICAgICBpZiAodHlwZW9mIHBhcmFtcyAhPT0gJ29iamVjdCcpIHtcbiAgICAgICAgcGFyYW1zID0gSlNPTi5wYXJzZShwYXJhbXMpO1xuICAgICAgfVxuICAgICAgcGFyYW1zID0gbG9kYXNoLm1lcmdlKHBhcmFtcywgb3B0aW9ucyk7XG4gICAgfVxuICAgIGlmICh0eXBlb2YgcGFyYW1zICE9PSAnb2JqZWN0Jykge1xuICAgICAgcGFyYW1zID0gSlNPTi5wYXJzZShwYXJhbXMpO1xuICAgIH1cbiAgICBPYmplY3Qua2V5cyhwYXJhbXMpLmZvckVhY2goa2V5ID0+IHtcbiAgICAgIHBhcmFtTWFwLnNldChrZXksIHBhcmFtc1trZXldKTtcbiAgICB9KTtcbiAgICBjb25zdCBjdXJyZW50VGFiSWQgPSB0aGlzLnF1ZXJ5c3RyaW5ncy50YWJJZCB8fCB0aGlzLnF1ZXJ5c3RyaW5ncy5mdW5jSWQgfHwgdGhpcy5xdWVyeXN0cmluZ3MuYXBwSWQ7XG4gICAgcGFyYW1zID0gd2luZG93WydlbmNvZGVVUklDb21wb25lbnQnXShwYXJhbXMpO1xuICAgIHBhcmFtTWFwLnNldCgnV0VCX0ZPUk1fUk9VVEVfUEFSQU1TJywgcGFyYW1zKTtcbiAgICBwYXJhbU1hcC5zZXQoJ1dFQl9GT1JNX1JPVVRFUl9QQVJFTlRfSUQnLCBjdXJyZW50VGFiSWQpO1xuICAgIHJldHVybiBwYXJhbU1hcDtcbiAgfVxuICAvKipcbiAgICog5p+l5om+5by556qX57uE5Lu2XG4gICAqL1xuICBwcml2YXRlIGZpbmREaWFsb2coKSB7XG4gICAgbGV0IGZyYW1lQ29udGV4dCA9IHRoaXMuZ2V0KHRoaXMsICdjb21tYW5kQ29udGV4dC5mcmFtZUNvbnRleHQnKTtcbiAgICBsZXQgaXNEaWFsb2dDb21wb25lbnQgPSB0aGlzLmdldChmcmFtZUNvbnRleHQsICdmcmFtZUNvbXBvbmVudC5pc0RpYWxvZ1Jvb3RDb21wb25lbnQnLCBmYWxzZSk7XG5cbiAgICBsZXQgcGFyZW50RnJhbWVDb250ZXh0ID0gdGhpcy5nZXQoZnJhbWVDb250ZXh0LCAncGFyZW50Jyk7XG4gICAgd2hpbGUgKHBhcmVudEZyYW1lQ29udGV4dCAhPSBudWxsICYmICFpc0RpYWxvZ0NvbXBvbmVudCkge1xuICAgICAgZnJhbWVDb250ZXh0ID0gdGhpcy5nZXQoZnJhbWVDb250ZXh0LCAncGFyZW50Jyk7XG4gICAgICBwYXJlbnRGcmFtZUNvbnRleHQgPSB0aGlzLmdldChwYXJlbnRGcmFtZUNvbnRleHQsICdwYXJlbnQnKTtcbiAgICAgIGlzRGlhbG9nQ29tcG9uZW50ID0gdGhpcy5nZXQoZnJhbWVDb250ZXh0LCAnZnJhbWVDb21wb25lbnQuaXNEaWFsb2dSb290Q29tcG9uZW50JywgZmFsc2UpO1xuICAgIH1cbiAgICBjb25zdCByb290Q29tcG9uZW50ID0gdGhpcy5nZXQoZnJhbWVDb250ZXh0LCAnZnJhbWVDb21wb25lbnQnKTtcbiAgICByZXR1cm4geyBpc0RpYWxvZ0NvbXBvbmVudCwgcm9vdENvbXBvbmVudCB9O1xuICB9XG5cbiAgLyoqXG4gICAqIGxvYWRzaCBnZXRcbiAgICogQHBhcmFtIG9iamVjdCDlr7nosaFcbiAgICogQHBhcmFtIHBhdGgg6Lev5b6EXG4gICAqIEBwYXJhbSBkZWZhdWx0VmFsIOm7mOiupOWAvFxuICAgKi9cbiAgcHJpdmF0ZSBnZXQob2JqZWN0OiBhbnksIHBhdGg6IEFycmF5PHN0cmluZz4gfCBzdHJpbmcsIGRlZmF1bHRWYWw6IGFueSA9IG51bGwpIHtcbiAgICBjb25zdCBQQVRIID0gQXJyYXkuaXNBcnJheShwYXRoKVxuICAgICAgPyBwYXRoXG4gICAgICA6IHBhdGguc3BsaXQoJy4nKS5maWx0ZXIoaSA9PiBpLmxlbmd0aCk7XG4gICAgaWYgKCFQQVRILmxlbmd0aCkge1xuICAgICAgcmV0dXJuIG9iamVjdCA9PT0gdW5kZWZpbmVkID8gZGVmYXVsdFZhbCA6IG9iamVjdDtcbiAgICB9XG5cbiAgICBpZiAob2JqZWN0ID09PSBudWxsIHx8IG9iamVjdCA9PT0gdW5kZWZpbmVkIHx8IHR5cGVvZiAob2JqZWN0W1BBVEhbMF1dKSA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIHJldHVybiBkZWZhdWx0VmFsO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmdldChvYmplY3RbUEFUSC5zaGlmdCgpXSwgUEFUSCwgZGVmYXVsdFZhbCk7XG4gIH1cbiAgcHJpdmF0ZSBjb252ZXJ0VG9Cb29sZWFuKHZhbHVlOiBhbnksIGRlZmF1bHRWYWw6IGJvb2xlYW4gPSBmYWxzZSkge1xuICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICd1bmRlZmluZWQnIHx8IHZhbHVlID09PSBudWxsKSB7XG4gICAgICB2YWx1ZSA9IGRlZmF1bHRWYWw7XG4gICAgfVxuICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICB2YWx1ZSA9IHZhbHVlIHx8IFN0cmluZyhkZWZhdWx0VmFsKTtcbiAgICAgIHZhbHVlID0gdmFsdWUgPT09ICd0cnVlJyA/IHRydWUgOiBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG4gIC8qKlxuICAgKiDnv7vor5HotYTmupDpoblcbiAgICogQHBhcmFtIGtleSDotYTmupDpoblrZXlcbiAgICovXG4gIHByaXZhdGUgdHJhbnNsYXRlKGtleTogc3RyaW5nKSB7XG4gICAgY29uc3QgdHJhbnNsYXRlU2VydmljZSA9IHRoaXMuaW5qZWN0b3IgJiYgdGhpcy5pbmplY3Rvci5nZXQ8VHJhbnNsYXRlPihUcmFuc2xhdGVUb2tlbiwgbnVsbCkgfHwgbnVsbDtcbiAgICBpZiAodHJhbnNsYXRlU2VydmljZSAmJiBrZXkgJiYga2V5LnN0YXJ0c1dpdGgoJ3t7JykgJiYga2V5LmVuZHNXaXRoKCd9fScpKSB7XG4gICAgICBrZXkgPSBrZXkucmVwbGFjZSgne3snLCAnJykucmVwbGFjZSgnfX0nLCAnJykudHJpbSgpO1xuICAgICAgcmV0dXJuIHRyYW5zbGF0ZVNlcnZpY2UudHJhbnNmb3JtKGtleSwgbnVsbCk7XG4gICAgfVxuICAgIHJldHVybiBrZXk7XG4gIH1cbiAgLy8gI2VuZHJlZ2lvblxuXG4gIC8vI3JlZ2lvbiDlvLnnqpfnm7jlhbPmlrnms5VcbiAgcHJpdmF0ZSBidWlsZENvbmZpZ3MoY29uZmlnOiBhbnkpOiB7IFtwcm9wOiBzdHJpbmddOiBhbnkgfSB7XG4gICAgbGV0IGxhbmd1YWdlU2VydmljZSA9IHRoaXMuaW5qZWN0b3IuZ2V0PExhbmd1YWdlU2VydmljZT4oTGFuZ3VhZ2VTZXJ2aWNlLCBudWxsKTtcbiAgICBpZiAoIWxhbmd1YWdlU2VydmljZSkge1xuICAgICAgbGFuZ3VhZ2VTZXJ2aWNlID0gTGFuZ3VhZ2VTZXJ2aWNlLmdldEluc3RhbmNlKCk7XG4gICAgfVxuXG4gICAgY29uc3QgZGVmYXVsdENvbmZpZ3M6IGFueSA9IHtcbiAgICAgIHRpdGxlOiBsYW5ndWFnZVNlcnZpY2UgJiYgbGFuZ3VhZ2VTZXJ2aWNlLmRlZmF1bHREaWFsb2dUaXRsZSB8fCAnJyxcbiAgICAgIHdpZHRoOiA4MDAsXG4gICAgICBoZWlnaHQ6IDUwMCxcbiAgICAgIHNob3dCdXR0b25zOiBmYWxzZVxuICAgIH07XG4gICAgY29uc3Qgb2JqZWN0VHlwZUNvbmZpZyA9IHRoaXMuZ2V0T2JqZWN0VHlwZUNvbmZpZyhjb25maWcpO1xuICAgIGNvbnN0IGNvbmZpZ3MgPSBPYmplY3QuYXNzaWduKGRlZmF1bHRDb25maWdzLCBvYmplY3RUeXBlQ29uZmlnKTtcbiAgICBjb25zdCBvbkNsb3NpbmdIYW5kbGVyID0gY29uZmlncy5iZWZvcmVDbG9zZTtcbiAgICBjb25zdCByZWZyZXNoID0gY29uZmlnc1sncmVmcmVzaCddIHx8IHt9O1xuICAgIGNvbnN0IHJlZnJlc2hDb21tYW5kTmFtZSA9IHJlZnJlc2ggJiYgcmVmcmVzaC5jb21tYW5kTmFtZSB8fCBudWxsO1xuICAgIGNvbnN0IHJlZnJlc2hGcmFtZUlkID0gcmVmcmVzaCAmJiByZWZyZXNoLmZyYW1lSWQgfHwgbnVsbDtcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZTogbm8tc3RyaW5nLWxpdGVyYWxcbiAgICBjb25zdCBjYW5jZWxDaGFuZ2VzID0gY29uZmlnc1snY2FuY2VsQ2hhbmdlcyddIHx8IGZhbHNlO1xuICAgIGNvbmZpZ3MuYmVmb3JlQ2xvc2UgPSAocmVmKSA9PiB7XG4gICAgICBpZiAoISFvbkNsb3NpbmdIYW5kbGVyICYmIHR5cGVvZiBvbkNsb3NpbmdIYW5kbGVyID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIHJldHVybiBvbkNsb3NpbmdIYW5kbGVyKHJlZikucGlwZShcbiAgICAgICAgICBzd2l0Y2hNYXAocmVzdWx0ID0+IHtcbiAgICAgICAgICAgIGlmIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgaWYgKGNhbmNlbENoYW5nZXMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jYW5jZWxDaGFuZ2VzKHJlZikucGlwZShcbiAgICAgICAgICAgICAgICAgIHN3aXRjaE1hcCgoKSA9PiB0aGlzLnJlZnJlc2hGb3JtKHJlZnJlc2hDb21tYW5kTmFtZSwgcmVmcmVzaEZyYW1lSWQpKVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBvZihyZXN1bHQpO1xuICAgICAgICAgIH0pXG4gICAgICAgICk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoY2FuY2VsQ2hhbmdlcykge1xuICAgICAgICAgIHJldHVybiB0aGlzLmNhbmNlbENoYW5nZXMocmVmKS5waXBlKFxuICAgICAgICAgICAgc3dpdGNoTWFwKCgpID0+IHRoaXMucmVmcmVzaEZvcm0ocmVmcmVzaENvbW1hbmROYW1lLCByZWZyZXNoRnJhbWVJZCkpXG4gICAgICAgICAgKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gb2YodHJ1ZSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgIH07XG4gICAgcmV0dXJuIGNvbmZpZ3M7XG4gIH1cbiAgcHJpdmF0ZSBnZXRPYmplY3RUeXBlQ29uZmlnKGNvbmZpZzogYW55KSB7XG4gICAgbGV0IG9iamVjdFR5cGVDb25maWc6IGFueVxuICAgIGlmICh0eXBlb2YgY29uZmlnID09PSAndW5kZWZpbmVkJykge1xuICAgICAgY29uZmlnID0ge307XG4gICAgfVxuICAgIGlmICh0eXBlb2YgY29uZmlnID09PSAnc3RyaW5nJykge1xuICAgICAgaWYgKGNvbmZpZy5sZW5ndGgpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBvYmplY3RUeXBlQ29uZmlnID0gSlNPTi5wYXJzZShjb25maWcpO1xuICAgICAgICB9IGNhdGNoIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoY29uZmlnICsgJ+S4jeaYr+WQiOazleeahGpzb27lrZfnrKbkuLInKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgb2JqZWN0VHlwZUNvbmZpZyA9IHt9O1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAodHlwZW9mIGNvbmZpZyA9PT0gJ29iamVjdCcpIHtcbiAgICAgIG9iamVjdFR5cGVDb25maWcgPSBPYmplY3QuYXNzaWduKHt9LCBjb25maWcpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ+Whq+WGmeWvueixoeagvOW8j+aIlmpzb27lrZfnrKbkuLInKTtcbiAgICB9XG4gICAgcmV0dXJuIG9iamVjdFR5cGVDb25maWc7XG4gIH1cbiAgLyoqXG4gICAqIOWPlua2iOacjeWKoeWZqOWPmOabtOmbhlxuICAgKi9cbiAgcHJpdmF0ZSBjYW5jZWxDaGFuZ2VzKHJlZjogYW55KTogT2JzZXJ2YWJsZTxib29sZWFuPiB7XG4gICAgaWYgKHJlZiAmJiByZWYubW9kYWxSZWYgJiYgcmVmLm1vZGFsUmVmLmNvbnRlbnQpIHtcbiAgICAgIGNvbnN0IGNvbXBvbmVudDogRnJhbWVDb21wb25lbnQgPSByZWYubW9kYWxSZWYuY29udGVudCBhcyBGcmFtZUNvbXBvbmVudDtcbiAgICAgIGlmIChjb21wb25lbnQgJiYgY29tcG9uZW50LmNvbnRleHQpIHtcbiAgICAgICAgY29uc3QgcmVwb3NpdG9yeSA9IGNvbXBvbmVudC5jb250ZXh0LnJlcG9zaXRvcnkgfHwgbnVsbDtcbiAgICAgICAgaWYgKHJlcG9zaXRvcnkpIHtcbiAgICAgICAgICByZXR1cm4gcmVwb3NpdG9yeS5jYW5jZWxDaGFuZ2VzKCkucGlwZShzd2l0Y2hNYXAoKCkgPT4gb2YodHJ1ZSkpKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gb2YodHJ1ZSk7XG4gIH1cbiAgcHJpdmF0ZSByZWZyZXNoRm9ybShyZWZyZXNoQ29tbWFuZE5hbWU6IHN0cmluZywgcmVmcmVzaEZyYW1lSWQ6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgaWYgKHJlZnJlc2hDb21tYW5kTmFtZSAmJiByZWZyZXNoRnJhbWVJZCkge1xuICAgICAgY29uc3QgZnJhbWVDb250ZXh0ID0gdGhpcy5mcmFtZUNvbnRleHQuYXBwQ29udGV4dC5mcmFtZUNvbnRleHRNYW5hZ2VyLmdldEZyYW1lQ29udGV4dEJ5SWQocmVmcmVzaEZyYW1lSWQpO1xuICAgICAgaWYgKGZyYW1lQ29udGV4dCkge1xuICAgICAgICBjb25zdCB2aWV3TW9kZWwgPSBmcmFtZUNvbnRleHQudmlld01vZGVsO1xuICAgICAgICByZXR1cm4gdmlld01vZGVsW3JlZnJlc2hDb21tYW5kTmFtZV0oKS5waXBlKFxuICAgICAgICAgIG1hcCgoKSA9PiB0cnVlKVxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gb2YodHJ1ZSk7XG4gIH1cbiAgcHJpdmF0ZSBjcmVhdGVDb21wb25lbnRSZWYoY29tcG9uZW50VHlwZTogYW55LCB1aVN0YXRlT2JqZWN0OiBhbnkpIHtcbiAgICBsZXQgY29tcG9uZW50UmVmOiBhbnk7XG4gICAgY29uc3QgZnJhbWVDb250ZXh0ID0gdGhpcy5nZXRGcmFtZUNvbnRleHQoKTtcbiAgICBjb25zdCBjb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIgPSB0aGlzLmdldENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcigpO1xuICAgIGlmIChmcmFtZUNvbnRleHQgJiYgY29tcG9uZW50RmFjdG9yeVJlc29sdmVyKSB7XG4gICAgICBjb25zdCBjb250ZW50Q21wdEZhY3RvcnkgPSBjb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoY29tcG9uZW50VHlwZSk7XG4gICAgICBjb25zdCBtb2RhbENvbnRlbnRJbmplY3RvciA9IFJlZmxlY3RpdmVJbmplY3Rvci5yZXNvbHZlQW5kQ3JlYXRlKFtdLCBmcmFtZUNvbnRleHQuaW5qZWN0b3IpO1xuICAgICAgY29tcG9uZW50UmVmID0gY29udGVudENtcHRGYWN0b3J5LmNyZWF0ZShtb2RhbENvbnRlbnRJbmplY3Rvcik7XG4gICAgICBpZiAoY29tcG9uZW50UmVmICYmIGNvbXBvbmVudFJlZi5pbnN0YW5jZSAmJiBjb21wb25lbnRSZWYuaW5zdGFuY2Uudmlld01vZGVsICYmIGNvbXBvbmVudFJlZi5pbnN0YW5jZS52aWV3TW9kZWwudWlTdGF0ZSkge1xuICAgICAgICBpZiAodHlwZW9mIHVpU3RhdGVPYmplY3QgPT09ICdvYmplY3QnICYmIE9iamVjdC5rZXlzKHVpU3RhdGVPYmplY3QpLmxlbmd0aCkge1xuICAgICAgICAgIE9iamVjdC5rZXlzKHVpU3RhdGVPYmplY3QpLmZvckVhY2goaXRlbSA9PiB7XG4gICAgICAgICAgICBjb21wb25lbnRSZWYuaW5zdGFuY2Uudmlld01vZGVsLnVpU3RhdGUuc2V0UHJvcGVydHlWYWx1ZShpdGVtLCB1aVN0YXRlT2JqZWN0W2l0ZW1dKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICAvLyDpmYTliqBpc0RpYWxvZ+WPguaVsFxuICAgICAgICBjb21wb25lbnRSZWYuaW5zdGFuY2Uudmlld01vZGVsLnVpU3RhdGUuc2V0UHJvcGVydHlWYWx1ZSgnREVWS0lUX0RJQUxPRycsIHRydWUpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gY29tcG9uZW50UmVmO1xuICB9XG4gIC8qKlxuICAgKiDlhbzlrrnml6flvLnnqpfvvIzojrflj5ZmcmFtZUNvbnRleHRcbiAgICovXG4gIHByaXZhdGUgZ2V0RnJhbWVDb250ZXh0KCkge1xuICAgIGlmICh0aGlzLmZyYW1lQ29udGV4dCkge1xuICAgICAgcmV0dXJuIHRoaXMuZnJhbWVDb250ZXh0XG4gICAgfVxuICAgIGlmICh0aGlzWydjb250ZXh0J10gJiYgdGhpc1snY29udGV4dCddWydmcmFtZUNvbnRleHQnXSkge1xuICAgICAgcmV0dXJuIHRoaXNbJ2NvbnRleHQnXVsnZnJhbWVDb250ZXh0J107XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG4gIC8qKlxuICAgKiDlhbzlrrnml6flvLnnqpfvvIzojrflj5ZDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXJcbiAgICovXG4gIHByaXZhdGUgZ2V0Q29tcG9uZW50RmFjdG9yeVJlc29sdmVyKCkge1xuICAgIGNvbnN0IGZyYW1lQ29udGV4dCA9IHRoaXMuZ2V0RnJhbWVDb250ZXh0KCk7XG4gICAgbGV0IGNvbXBvbmVudEZhY3RvcnlSZXNvbHZlcjogYW55O1xuICAgIGlmIChmcmFtZUNvbnRleHQpIHtcbiAgICAgIGNvbXBvbmVudEZhY3RvcnlSZXNvbHZlciA9IGZyYW1lQ29udGV4dC5pbmplY3Rvci5nZXQoQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyKTtcbiAgICB9XG4gICAgcmV0dXJuIGNvbXBvbmVudEZhY3RvcnlSZXNvbHZlcjtcbiAgfVxuICAvLyNlbmRyZWdpb25cbn1cbiJdfQ==