/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
export class ImageDrop {
    /**
     * @param {?} quill
     * @param {?=} options
     * @param {?=} ngZone
     */
    constructor(quill, options = {}, ngZone) {
        this.ngZone = ngZone;
        // save the quill reference
        this.quill = quill;
        // bind handlers to this instance
        this.handleDrop = this.handleDrop.bind(this);
        this.handlePaste = this.handlePaste.bind(this);
        // listen for drop and paste events
        this.quill.root.addEventListener('drop', this.handleDrop, false);
        this.quill.root.addEventListener('paste', this.handlePaste, false);
    }
    /**
     * @param {?} evt
     * @return {?}
     */
    handleDrop(evt) {
        evt.preventDefault();
        if (evt.dataTransfer &&
            evt.dataTransfer.files &&
            evt.dataTransfer.files.length) {
            if (document.caretRangeFromPoint) {
                /** @type {?} */
                const selection = document.getSelection();
                /** @type {?} */
                const range = document.caretRangeFromPoint(evt.clientX, evt.clientY);
                if (selection && range) {
                    selection.setBaseAndExtent(range.startContainer, range.startOffset, range.startContainer, range.startOffset);
                }
            }
            this.readFiles(evt.dataTransfer.files, this.insert.bind(this));
        }
    }
    /**
     * @param {?} evt
     * @return {?}
     */
    handlePaste(evt) {
        if (evt.clipboardData &&
            evt.clipboardData.items &&
            evt.clipboardData.items.length) {
            this.readFiles(evt.clipboardData.items, (/**
             * @param {?} dataUrl
             * @return {?}
             */
            dataUrl => {
                /** @type {?} */
                const selection = this.quill.getSelection();
                if (selection) {
                    // we must be in a browser that supports pasting (like Firefox)
                    // so it has already been placed into the editor
                }
                else {
                    // otherwise we wait until after the paste when this.quill.getSelection()
                    // will return a valid index
                    this.ngZone.runOutsideAngular((/**
                     * @return {?}
                     */
                    () => {
                        setTimeout((/**
                         * @return {?}
                         */
                        () => this.insert(dataUrl)), 0);
                    }));
                }
            }));
        }
    }
    /**
     * @param {?} dataUrl
     * @return {?}
     */
    insert(dataUrl) {
        /** @type {?} */
        const index = (this.quill.getSelection() || {}).index || this.quill.getLength();
        this.quill.insertEmbed(index, 'image', dataUrl, 'user');
    }
    /**
     * @param {?} files
     * @param {?} callback
     * @return {?}
     */
    readFiles(files, callback) {
        // check each file for an image
        [].forEach.call(files, (/**
         * @param {?} file
         * @return {?}
         */
        file => {
            if (!file.type.match(/^image\/(gif|jpe?g|a?png|svg|webp|bmp|vnd\.microsoft\.icon)/i)) {
                // file is not an image
                // Note that some file formats such as psd start with image/* but are not readable
                return;
            }
            // set up file reader
            /** @type {?} */
            const reader = new FileReader();
            reader.onload = (/**
             * @param {?} evt
             * @return {?}
             */
            (evt) => {
                callback(evt.target.result);
            });
            // read the clipboard item or file
            /** @type {?} */
            const blob = file.getAsFile ? file.getAsFile() : file;
            if (blob instanceof Blob) {
                reader.readAsDataURL(blob);
            }
        }));
    }
}
if (false) {
    /** @type {?} */
    ImageDrop.prototype.quill;
    /**
     * @type {?}
     * @private
     */
    ImageDrop.prototype.ngZone;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW1hZ2UtZHJvcC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktaHRtbC1lZGl0b3IvIiwic291cmNlcyI6WyJsaWIvaW1hZ2UtZHJvcC1tb2R1bGUvaW1hZ2UtZHJvcC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQ0EsTUFBTSxPQUFPLFNBQVM7Ozs7OztJQUVsQixZQUFZLEtBQUssRUFBRSxPQUFPLEdBQUcsRUFBRSxFQUFVLE1BQWM7UUFBZCxXQUFNLEdBQU4sTUFBTSxDQUFRO1FBQ25ELDJCQUEyQjtRQUMzQixJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztRQUNuQixpQ0FBaUM7UUFDakMsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUM3QyxJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQy9DLG1DQUFtQztRQUNuQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLFVBQVUsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUNqRSxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLFdBQVcsRUFBRSxLQUFLLENBQUMsQ0FBQztJQUN2RSxDQUFDOzs7OztJQUVELFVBQVUsQ0FBQyxHQUFHO1FBQ1YsR0FBRyxDQUFDLGNBQWMsRUFBRSxDQUFDO1FBQ3JCLElBQ0ksR0FBRyxDQUFDLFlBQVk7WUFDaEIsR0FBRyxDQUFDLFlBQVksQ0FBQyxLQUFLO1lBQ3RCLEdBQUcsQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFDL0I7WUFDRSxJQUFJLFFBQVEsQ0FBQyxtQkFBbUIsRUFBRTs7c0JBQ3hCLFNBQVMsR0FBRyxRQUFRLENBQUMsWUFBWSxFQUFFOztzQkFDbkMsS0FBSyxHQUFHLFFBQVEsQ0FBQyxtQkFBbUIsQ0FDdEMsR0FBRyxDQUFDLE9BQU8sRUFDWCxHQUFHLENBQUMsT0FBTyxDQUNkO2dCQUNELElBQUksU0FBUyxJQUFJLEtBQUssRUFBRTtvQkFDcEIsU0FBUyxDQUFDLGdCQUFnQixDQUN0QixLQUFLLENBQUMsY0FBYyxFQUNwQixLQUFLLENBQUMsV0FBVyxFQUNqQixLQUFLLENBQUMsY0FBYyxFQUNwQixLQUFLLENBQUMsV0FBVyxDQUNwQixDQUFDO2lCQUNMO2FBQ0o7WUFDRCxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7U0FDbEU7SUFDTCxDQUFDOzs7OztJQUVELFdBQVcsQ0FBQyxHQUFHO1FBQ1gsSUFDSSxHQUFHLENBQUMsYUFBYTtZQUNqQixHQUFHLENBQUMsYUFBYSxDQUFDLEtBQUs7WUFDdkIsR0FBRyxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsTUFBTSxFQUNoQztZQUNFLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQyxLQUFLOzs7O1lBQUUsT0FBTyxDQUFDLEVBQUU7O3NCQUN4QyxTQUFTLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxZQUFZLEVBQUU7Z0JBQzNDLElBQUksU0FBUyxFQUFFO29CQUNYLCtEQUErRDtvQkFDL0QsZ0RBQWdEO2lCQUNuRDtxQkFBTTtvQkFDSCx5RUFBeUU7b0JBQ3pFLDRCQUE0QjtvQkFDNUIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxpQkFBaUI7OztvQkFBQyxHQUFHLEVBQUU7d0JBQy9CLFVBQVU7Ozt3QkFBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxHQUFFLENBQUMsQ0FBQyxDQUFDO29CQUM5QyxDQUFDLEVBQUMsQ0FBQztpQkFDTjtZQUNMLENBQUMsRUFBQyxDQUFDO1NBQ047SUFDTCxDQUFDOzs7OztJQUVELE1BQU0sQ0FBQyxPQUFPOztjQUNKLEtBQUssR0FDUCxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsWUFBWSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsS0FBSyxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsU0FBUyxFQUFFO1FBQ3JFLElBQUksQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDLEtBQUssRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQzVELENBQUM7Ozs7OztJQUVELFNBQVMsQ0FBQyxLQUFLLEVBQUUsUUFBUTtRQUNyQiwrQkFBK0I7UUFDL0IsRUFBRSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsS0FBSzs7OztRQUFFLElBQUksQ0FBQyxFQUFFO1lBQzFCLElBQ0ksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FDWiw4REFBOEQsQ0FDakUsRUFDSDtnQkFDRSx1QkFBdUI7Z0JBQ3ZCLGtGQUFrRjtnQkFDbEYsT0FBTzthQUNWOzs7a0JBRUssTUFBTSxHQUFHLElBQUksVUFBVSxFQUFFO1lBQy9CLE1BQU0sQ0FBQyxNQUFNOzs7O1lBQUcsQ0FBQyxHQUFRLEVBQUUsRUFBRTtnQkFDekIsUUFBUSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDaEMsQ0FBQyxDQUFBLENBQUM7OztrQkFFSSxJQUFJLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJO1lBQ3JELElBQUksSUFBSSxZQUFZLElBQUksRUFBRTtnQkFDdEIsTUFBTSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsQ0FBQzthQUM5QjtRQUNMLENBQUMsRUFBQyxDQUFDO0lBQ1AsQ0FBQztDQUNKOzs7SUExRkcsMEJBQVc7Ozs7O0lBQ3NCLDJCQUFzQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5nWm9uZSB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XHJcbmV4cG9ydCBjbGFzcyBJbWFnZURyb3Age1xyXG4gICAgcXVpbGw6IGFueTtcclxuICAgIGNvbnN0cnVjdG9yKHF1aWxsLCBvcHRpb25zID0ge30sIHByaXZhdGUgbmdab25lOiBOZ1pvbmUpIHtcclxuICAgICAgICAvLyBzYXZlIHRoZSBxdWlsbCByZWZlcmVuY2VcclxuICAgICAgICB0aGlzLnF1aWxsID0gcXVpbGw7XHJcbiAgICAgICAgLy8gYmluZCBoYW5kbGVycyB0byB0aGlzIGluc3RhbmNlXHJcbiAgICAgICAgdGhpcy5oYW5kbGVEcm9wID0gdGhpcy5oYW5kbGVEcm9wLmJpbmQodGhpcyk7XHJcbiAgICAgICAgdGhpcy5oYW5kbGVQYXN0ZSA9IHRoaXMuaGFuZGxlUGFzdGUuYmluZCh0aGlzKTtcclxuICAgICAgICAvLyBsaXN0ZW4gZm9yIGRyb3AgYW5kIHBhc3RlIGV2ZW50c1xyXG4gICAgICAgIHRoaXMucXVpbGwucm9vdC5hZGRFdmVudExpc3RlbmVyKCdkcm9wJywgdGhpcy5oYW5kbGVEcm9wLCBmYWxzZSk7XHJcbiAgICAgICAgdGhpcy5xdWlsbC5yb290LmFkZEV2ZW50TGlzdGVuZXIoJ3Bhc3RlJywgdGhpcy5oYW5kbGVQYXN0ZSwgZmFsc2UpO1xyXG4gICAgfVxyXG5cclxuICAgIGhhbmRsZURyb3AoZXZ0KSB7XHJcbiAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgaWYgKFxyXG4gICAgICAgICAgICBldnQuZGF0YVRyYW5zZmVyICYmXHJcbiAgICAgICAgICAgIGV2dC5kYXRhVHJhbnNmZXIuZmlsZXMgJiZcclxuICAgICAgICAgICAgZXZ0LmRhdGFUcmFuc2Zlci5maWxlcy5sZW5ndGhcclxuICAgICAgICApIHtcclxuICAgICAgICAgICAgaWYgKGRvY3VtZW50LmNhcmV0UmFuZ2VGcm9tUG9pbnQpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGlvbiA9IGRvY3VtZW50LmdldFNlbGVjdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcmFuZ2UgPSBkb2N1bWVudC5jYXJldFJhbmdlRnJvbVBvaW50KFxyXG4gICAgICAgICAgICAgICAgICAgIGV2dC5jbGllbnRYLFxyXG4gICAgICAgICAgICAgICAgICAgIGV2dC5jbGllbnRZXHJcbiAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgaWYgKHNlbGVjdGlvbiAmJiByYW5nZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGlvbi5zZXRCYXNlQW5kRXh0ZW50KFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByYW5nZS5zdGFydENvbnRhaW5lcixcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmFuZ2Uuc3RhcnRPZmZzZXQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJhbmdlLnN0YXJ0Q29udGFpbmVyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByYW5nZS5zdGFydE9mZnNldFxyXG4gICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5yZWFkRmlsZXMoZXZ0LmRhdGFUcmFuc2Zlci5maWxlcywgdGhpcy5pbnNlcnQuYmluZCh0aGlzKSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGhhbmRsZVBhc3RlKGV2dCkge1xyXG4gICAgICAgIGlmIChcclxuICAgICAgICAgICAgZXZ0LmNsaXBib2FyZERhdGEgJiZcclxuICAgICAgICAgICAgZXZ0LmNsaXBib2FyZERhdGEuaXRlbXMgJiZcclxuICAgICAgICAgICAgZXZ0LmNsaXBib2FyZERhdGEuaXRlbXMubGVuZ3RoXHJcbiAgICAgICAgKSB7XHJcbiAgICAgICAgICAgIHRoaXMucmVhZEZpbGVzKGV2dC5jbGlwYm9hcmREYXRhLml0ZW1zLCBkYXRhVXJsID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGlvbiA9IHRoaXMucXVpbGwuZ2V0U2VsZWN0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoc2VsZWN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gd2UgbXVzdCBiZSBpbiBhIGJyb3dzZXIgdGhhdCBzdXBwb3J0cyBwYXN0aW5nIChsaWtlIEZpcmVmb3gpXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gc28gaXQgaGFzIGFscmVhZHkgYmVlbiBwbGFjZWQgaW50byB0aGUgZWRpdG9yXHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIG90aGVyd2lzZSB3ZSB3YWl0IHVudGlsIGFmdGVyIHRoZSBwYXN0ZSB3aGVuIHRoaXMucXVpbGwuZ2V0U2VsZWN0aW9uKClcclxuICAgICAgICAgICAgICAgICAgICAvLyB3aWxsIHJldHVybiBhIHZhbGlkIGluZGV4XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMuaW5zZXJ0KGRhdGFVcmwpLCAwKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGluc2VydChkYXRhVXJsKSB7XHJcbiAgICAgICAgY29uc3QgaW5kZXggPVxyXG4gICAgICAgICAgICAodGhpcy5xdWlsbC5nZXRTZWxlY3Rpb24oKSB8fCB7fSkuaW5kZXggfHwgdGhpcy5xdWlsbC5nZXRMZW5ndGgoKTtcclxuICAgICAgICB0aGlzLnF1aWxsLmluc2VydEVtYmVkKGluZGV4LCAnaW1hZ2UnLCBkYXRhVXJsLCAndXNlcicpO1xyXG4gICAgfVxyXG5cclxuICAgIHJlYWRGaWxlcyhmaWxlcywgY2FsbGJhY2spIHtcclxuICAgICAgICAvLyBjaGVjayBlYWNoIGZpbGUgZm9yIGFuIGltYWdlXHJcbiAgICAgICAgW10uZm9yRWFjaC5jYWxsKGZpbGVzLCBmaWxlID0+IHtcclxuICAgICAgICAgICAgaWYgKFxyXG4gICAgICAgICAgICAgICAgIWZpbGUudHlwZS5tYXRjaChcclxuICAgICAgICAgICAgICAgICAgICAvXmltYWdlXFwvKGdpZnxqcGU/Z3xhP3BuZ3xzdmd8d2VicHxibXB8dm5kXFwubWljcm9zb2Z0XFwuaWNvbikvaVxyXG4gICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICApIHtcclxuICAgICAgICAgICAgICAgIC8vIGZpbGUgaXMgbm90IGFuIGltYWdlXHJcbiAgICAgICAgICAgICAgICAvLyBOb3RlIHRoYXQgc29tZSBmaWxlIGZvcm1hdHMgc3VjaCBhcyBwc2Qgc3RhcnQgd2l0aCBpbWFnZS8qIGJ1dCBhcmUgbm90IHJlYWRhYmxlXHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gc2V0IHVwIGZpbGUgcmVhZGVyXHJcbiAgICAgICAgICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XHJcbiAgICAgICAgICAgIHJlYWRlci5vbmxvYWQgPSAoZXZ0OiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGV2dC50YXJnZXQucmVzdWx0KTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgLy8gcmVhZCB0aGUgY2xpcGJvYXJkIGl0ZW0gb3IgZmlsZVxyXG4gICAgICAgICAgICBjb25zdCBibG9iID0gZmlsZS5nZXRBc0ZpbGUgPyBmaWxlLmdldEFzRmlsZSgpIDogZmlsZTtcclxuICAgICAgICAgICAgaWYgKGJsb2IgaW5zdGFuY2VvZiBCbG9iKSB7XHJcbiAgICAgICAgICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChibG9iKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==