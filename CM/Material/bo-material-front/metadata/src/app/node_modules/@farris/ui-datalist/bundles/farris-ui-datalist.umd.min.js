!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("rxjs/operators"),require("@farris/ui-common"),require("@farris/ui-perfect-scrollbar"),require("@angular/core")):"function"==typeof define&&define.amd?define("@farris/ui-datalist",["exports","rxjs/operators","@farris/ui-common","@farris/ui-perfect-scrollbar","@angular/core"],t):t((e.farris=e.farris||{},e.farris["ui-datalist"]={}),e.rxjs.operators,e.uiCommon,e.uiPerfectScrollbar,e.ng.core)}(this,function(e,t,i,n,a){"use strict";var r=(s.decorators=[{type:a.Injectable,args:[{providedIn:"root"}]}],s.ctorParameters=function(){return[]},s.ngInjectableDef=a.defineInjectable({factory:function(){return new s},token:s,providedIn:"root"}),s);function s(){}var o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};var l,p=function(){return(p=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var a in t=arguments[i])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},c={title:"",data:[],textField:"",idField:"id",fit:!0,width:300,height:400,multiSelect:!1,showHeader:!1,headerHeight:40,disabled:!1,containerHeight:360,selections:[]},d=(function C(e,t){function i(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}(h,l=i.BaseDataFacadeService),h.prototype.updateContainerSize=function(e,t){var i=t;this._state.showHeader&&(i=t-this._state.headerHeight),this.updateState({containerHeight:i,width:e,height:t})},h.decorators=[{type:a.Injectable}],h.ctorParameters=function(){return[]},h);function h(){var e=l.call(this,c)||this;return e.containerHeight$=e.state$.pipe(t.map(function(e){return e.containerHeight})),e.options$=e.state$,e}var u=(g.decorators=[{type:a.Directive,args:[{selector:"[list-item-tmp]"}]}],g.ctorParameters=function(){return[{type:a.TemplateRef}]},g);function g(e){this.template=e}var f=(Object.defineProperty(m.prototype,"fluid",{get:function(){return"auto"!==this._height&&this.fit},enumerable:!0,configurable:!0}),m.prototype.ngOnChanges=function(e){e&&e.data&&!e.data.isFirstChange()&&this.initCtrlState(),e.selectedValues&&!e.selectedValues.isFirstChange()&&(""!==this.selectedValues&&this.selectedValues!==undefined&&null!==this.selectedValues?this.store.setSelections(this.selectedValues,this.separator):this.clearSelections())},m.prototype.ngOnInit=function(){this._height=this.height,this.initCtrlState()},m.prototype.ngAfterViewInit=function(){var n=this;setTimeout(function(){if(n.selectedValues&&"auto"!==n.height){var t=n.selectedValues;-1<n.selectedValues.indexOf(n.separator)&&(t=n.selectedValues.indexOf(n.separator)[0]);var e=n.data.findIndex(function(e){return e[n.idField]==t}),i=n.el.nativeElement.querySelector("ul.list-group");i.children[e]&&i.children[e].scrollIntoView({block:"nearest"})}},10)},m.prototype.loadData=function(){this.data&&this.store.loadData(this.data,this.selectedValues,this.separator)},m.prototype.initCtrlState=function(){var e=p({},this),t=e.title,i=e.textField,n=e.fit,a=e.idField,r=e.valueField,s=e.width,o=e.height,l=e.multiSelect,c=e.disabled,d=e.headerHeight,h=e.separator;this.store.initState({title:t,textField:i,valueField:r,fit:n,idField:a,width:s,height:o,multiSelect:l,disabled:c,headerHeight:d,separator:h}),this.loadData()},m.prototype.clearSelections=function(){this.store.clearSelections()},m.prototype.resize=function(){if(this.fit){var e=this.el.nativeElement.parentElement,t=e.offsetWidth,i=e.offsetHeight;this.store.updateContainerSize(t,i)}},m.prototype.updateSelectValues=function(){var t=this;this.selectedValues=this.store.getSelections().map(function(e){return e[t.valueField]}).join(this.separator),this.selectedValuesChange.emit(this.selectedValues)},m.prototype.onSelectHandler=function(e,t,i){if(e.stopPropagation(),this.disabled)return!1;var n=p({},i).data;this.store.isSelect(i.id)?this.enableCancelSelected&&(this.store.unSelectItem(n),this.updateSelectValues(),this.unSelected.emit({index:t,data:n})):(this.store.selectItem(n,t),this.updateSelectValues(),this.selected.emit({index:t,data:n}))},m.prototype.onCheckedChange=function(e){var t=e.index,i=e.row,n=e.originalEvent;this.onSelectHandler(n,t,i)},m.prototype.isChecked=function(t){var i=this,e=this.selectedValues;return null===this.selectedValues&&this.selectedValues===undefined&&(e=""),"boolean"==typeof e&&(e=""+e),!!e&&(this.multiSelect?e.split(this.separator):[e]).some(function(e){return e==""+t.data[i.valueField]})},m.prototype.isSelected=function(e){return this.isChecked(e)},m.prototype.selectAll=function(){var t=this;this.selectedValues=this.data.map(function(e){return e[t.valueField]}).join(this.separator),this.store.selectAll()},m.prototype.unSelectAll=function(){this.selectedValues="",this.store.clearSelections()},m.decorators=[{type:a.Component,args:[{selector:"farris-datalist",template:'<div *ngIf="_options$ | async as opts" class="card" [style.width.%]="100" [style.height]="opts.height === \'auto\' ? \'auto\' : opts.height + \'px\'" style="min-height: 10px;">\r\n    <div class="card-header" *ngIf="opts.showHeader">\r\n        {{ opts.title }}\r\n    </div>\r\n    \x3c!-- <perfect-scrollbar #ps *ngIf="opts.height && opts.height !== \'auto\'" [style.width.%]="100" [style.height.px]="scrollbarHeight$ | async"> --\x3e\r\n    <div *ngIf="opts.height && opts.height !== \'auto\' && (data$ | async).length > 0" style="overflow: auto;" [style.width.%]="100" [style.height.px]="scrollbarHeight$ | async">\r\n        <ul class="list-group list-group-flush">\r\n            <li style="cursor: default;" [farrist-datalist-item]="item" [style.height.px]="itemHeight"\r\n                [class.active]="store.isSelect(item.id)" class="list-group-item list-group-item-action"\r\n                *ngFor="let item of data$ | async; let i = index" title="{{item.data[textField]}}" (click)="onSelectHandler( $event, i, item)">\r\n                <dl-checkbox *ngIf="multiSelect" [checked]="isChecked(item)" [index]="i" [row]="item"\r\n                    (checkedChange)="onCheckedChange($event)"></dl-checkbox>\r\n                <ng-container *ngIf="!itemTemplate">\r\n                    <span class="f-datalist-item-text">{{ item.data[textField] }}</span>\r\n                </ng-container>\r\n                <ng-container *ngIf="itemTemplate" [ngTemplateOutlet]="itemTemplate"\r\n                    [ngTemplateOutletContext]="{ data: item, index: i }">\r\n                </ng-container>\r\n            </li>\r\n        </ul>\r\n    </div>\r\n    \x3c!-- </perfect-scrollbar> --\x3e\r\n    <div *ngIf="opts.height === \'auto\' && (data$ | async).length > 0" >\r\n        <ul class="list-group list-group-flush">\r\n            <li style="cursor: default;" [farrist-datalist-item]="item" [style.height.px]="itemHeight"\r\n                [class.active]="isSelected(item)" class="list-group-item list-group-item-action"\r\n                *ngFor="let item of data$ | async; let i = index" title="{{item.data[textField]}}" (click)="onSelectHandler( $event, i, item)">\r\n                <dl-checkbox *ngIf="multiSelect" [checked]="isChecked(item)" [index]="i" [row]="item"\r\n                    (checkedChange)="onCheckedChange($event)"></dl-checkbox>\r\n                <ng-container *ngIf="!itemTemplate">\r\n                    <span class="f-datalist-item-text">{{ item.data[textField] }}</span>\r\n                </ng-container>\r\n                <ng-container *ngIf="itemTemplate" [ngTemplateOutlet]="itemTemplate"\r\n                    [ngTemplateOutletContext]="{ data: item, index: i }">\r\n                </ng-container>\r\n            </li>\r\n        </ul>\r\n    </div>\r\n    <div *ngIf="(data$ | async).length === 0" style="height: 200px;">\r\n        <div class="f-table-norecords-content">暂无数据</div>\r\n    </div>\r\n</div>',providers:[d],encapsulation:a.ViewEncapsulation.None,changeDetection:a.ChangeDetectionStrategy.OnPush,styles:["\n            .ps__rail-x,\n            .ps__rail-y {\n                z-index: 9;\n            }\n            .norecords-content {\n                height: 8.125rem;\n                padding: 7.8125rem 0 0;\n                width: 100%;\n                text-align: center;\n                font-size: 1rem;\n                color: rgba(0,0,0,.25);\n                background: url(imgs/table-norecords.png) top center no-repeat;\n                margin: -4.0625rem 0 0 -.625rem;\n                line-height: 2.5rem;\n            }\n        "]}]}],m.ctorParameters=function(){return[{type:a.ElementRef},{type:d}]},m.propDecorators={cls:[{type:a.HostBinding,args:["class.f-datalist"]}],fluid:[{type:a.HostBinding,args:["class.farris-main-area"]}],itemHeight:[{type:a.Input}],title:[{type:a.Input}],data:[{type:a.Input}],textField:[{type:a.Input}],valueField:[{type:a.Input}],idField:[{type:a.Input}],fit:[{type:a.Input}],width:[{type:a.Input}],height:[{type:a.Input}],multiSelect:[{type:a.Input}],disabled:[{type:a.Input}],showHeader:[{type:a.Input}],showCheckBox:[{type:a.Input}],headerHeight:[{type:a.Input}],selectedValues:[{type:a.Input}],enableCancelSelected:[{type:a.Input}],separator:[{type:a.Input}],itemTemplate:[{type:a.ContentChild,args:[u,{read:a.TemplateRef}]}],selected:[{type:a.Output}],unSelected:[{type:a.Output}],selectedValuesChange:[{type:a.Output}]},m);function m(e,t){this.el=e,this.store=t,this.cls=!0,this.fit=!0,this.width=300,this.height=400,this.multiSelect=!1,this.disabled=!1,this.showHeader=!1,this.showCheckBox=!1,this.headerHeight=40,this.enableCancelSelected=!0,this.separator=",",this.selected=new a.EventEmitter,this.unSelected=new a.EventEmitter,this.selectedValuesChange=new a.EventEmitter,this.scrollbarHeight$=this.store.containerHeight$,this._options$=this.store.options$,this.data$=this.store.data$}var y=(v.prototype.ngOnInit=function(){},v.decorators=[{type:a.Directive,args:[{selector:"[farrist-datalist-item]"}]}],v.ctorParameters=function(){return[{type:a.ElementRef}]},v.propDecorators={data:[{type:a.Input,args:["farrist-datalist-item"]}]},v);function v(e){this.el=e}var x=(b.prototype.ngOnInit=function(){},b.prototype.handleClick=function(e){this.checked=!this.checked,this.checkedChange.emit({originalEvent:e,index:this.index,row:this.row,state:this.checked}),e.stopPropagation()},b.decorators=[{type:a.Component,args:[{selector:"dl-checkbox",template:'\n        <div class="custom-control custom-checkbox  custom-control-inline dl-checkbox">\n            <input type="checkbox" #chk class="custom-control-input" [disabled]="disabled" [checked]="checked" />\n            <label class="custom-control-label" (click)="handleClick($event)"></label>\n        </div>\n    ',styles:["\n            :host .custom-checkbox {\n                opacity: 1;\n                float: none;\n                margin: 0;\n                vertical-align: top;\n                padding-right: 0px;\n            }\n        "]}]}],b.ctorParameters=function(){return[]},b.propDecorators={checked:[{type:a.Input}],disabled:[{type:a.Input}],index:[{type:a.Input}],row:[{type:a.Input}],checkedChange:[{type:a.Output}],chk:[{type:a.ViewChild,args:["chk"]}]},b);function b(){this.checkedChange=new a.EventEmitter}var I=(S.decorators=[{type:a.NgModule,args:[{declarations:[f,u,y,x],imports:[n.PerfectScrollbarModule],exports:[f,u,y,x]}]}],S);function S(){}e.DatalistService=r,e.DataListItemTemplateDirective=u,e.DatalistComponent=f,e.DataListItemComponentDirective=y,e.DataListCheckboxComponent=x,e.DatalistModule=I,e.DataListFacadeService=d,e.defaultDataState=c,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=farris-ui-datalist.umd.min.js.map