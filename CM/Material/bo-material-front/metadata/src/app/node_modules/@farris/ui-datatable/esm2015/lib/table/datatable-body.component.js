/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { LocaleService } from '@farris/ui-locale';
/*
 * @Author: 疯狂秀才(Lucas Huang)
 * @Date: 2019-08-14 13:53:03
 * @LastEditors: 疯狂秀才(Lucas Huang)
 * @LastEditTime: 2019-10-01 15:02:29
 * @QQ: 1055818239
 * @Version: v0.0.1
 */
import { Component, Input, Output, Optional, ElementRef, Renderer2, EventEmitter, Directive, HostListener, Injector } from '@angular/core';
import { convertColumns } from '../datatable-column';
import { DataTableService } from '../datatable.service';
import { DataTableComponent } from '../datatable.component';
import { ColumnFormatService } from '@farris/ui-common/column';
import { CommonUtils } from '@farris/ui-common';
export class DTDblClickRowDirective {
    /**
     * @param {?} el
     * @param {?} dt
     */
    constructor(el, dt) {
        this.el = el;
        this.dt = dt;
    }
    /**
     * @return {?}
     */
    ngOnInit() { }
    /**
     * @param {?} event
     * @return {?}
     */
    ondblclick(event) {
        if (this.row) {
            this.dt.rowDblClick.emit(this.row);
        }
        event.stopPropagation();
    }
}
DTDblClickRowDirective.decorators = [
    { type: Directive, args: [{
                selector: '[dblclick]'
            },] }
];
/** @nocollapse */
DTDblClickRowDirective.ctorParameters = () => [
    { type: ElementRef },
    { type: DataTableComponent, decorators: [{ type: Optional }] }
];
DTDblClickRowDirective.propDecorators = {
    row: [{ type: Input, args: ['dblclick',] }],
    ondblclick: [{ type: HostListener, args: ['dblclick', ['$event'],] }]
};
if (false) {
    /** @type {?} */
    DTDblClickRowDirective.prototype.row;
    /** @type {?} */
    DTDblClickRowDirective.prototype.el;
    /** @type {?} */
    DTDblClickRowDirective.prototype.dt;
}
export class DataTableBodyComponent {
    /**
     * @param {?} el
     * @param {?} dataService
     * @param {?} render
     * @param {?} dt
     * @param {?} colFormatSer
     * @param {?} utils
     * @param {?} injector
     */
    constructor(el, dataService, render, dt, colFormatSer, utils, injector) {
        this.el = el;
        this.dataService = dataService;
        this.render = render;
        this.dt = dt;
        this.colFormatSer = colFormatSer;
        this.utils = utils;
        this.injector = injector;
        this.rows = [];
        this.rowDblClick = new EventEmitter();
        this.selectRow = new EventEmitter();
        this.cellEdit = new EventEmitter();
        this.cellClick = new EventEmitter();
        this.lastRowIndex = 0;
        this.lastColumnIndex = 0;
        this.edit = {};
        this.className = {};
        this.isRowTempl = false;
        this.selectedRowIndex = -1;
        this._selections = {};
        this.emptyMessage = '暂无数据';
        this.localeService = this.injector.get(LocaleService);
    }
    // 已选择的行 默认为空
    /**
     * @param {?} v
     * @return {?}
     */
    set selections(v) {
        this._selections = v || {};
        this.dt.updateCheckboxState(this.rows);
    }
    /**
     * @return {?}
     */
    get selections() {
        if (!this._selections) {
            return;
        }
        /** @type {?} */
        const keys = Object.keys(this._selections);
        if (keys.length) {
            if (this.dt.singleSelect) {
                return this._selections;
            }
            else {
                return keys.map((/**
                 * @param {?} k
                 * @return {?}
                 */
                k => this._selections[k]));
            }
        }
        return undefined;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.dataService.selectedAll.subscribe((/**
         * @param {?} allChecked
         * @return {?}
         */
        allChecked => {
            /** @type {?} */
            const idfield = this.idField();
            this.rows.forEach((/**
             * @param {?} row
             * @return {?}
             */
            row => {
                if (allChecked) {
                    this._selections[row[idfield]] = row;
                }
                else {
                    delete this._selections[row[idfield]];
                }
            }));
        }));
        if (this.rows) {
            this.isRowTempl = this.rows.some((/**
             * @param {?} row
             * @return {?}
             */
            row => {
                return row.hasOwnProperty('rowTempl');
            }));
        }
        if (this.fixed === 'left') {
            this.columns = convertColumns(this.columns, 'left');
        }
        if (this.fixed === 'right') {
            this.columns = convertColumns(this.columns, 'right');
        }
        this.emptyMessage = this.localeService.getValue('datagrid.emptyMessage');
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        this._rows = this.el.nativeElement.querySelectorAll('tr');
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (changes.rows && !changes.rows.isFirstChange()) {
            if (!this.dt.singleSelect) {
                /** @type {?} */
                const _rows = changes.rows.currentValue || [];
                /** @type {?} */
                const checkedRows = _rows.map((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => {
                    return this.isSelected(n) ? n : 0;
                })).filter((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => n));
                if (!_rows.length) {
                    this.dataService.updateCheckAllStatus.next(0);
                    return;
                }
                /** @type {?} */
                const idfield = this.idField();
                /** @type {?} */
                let checkTotal = 0;
                _rows.forEach((/**
                 * @param {?} element
                 * @return {?}
                 */
                element => {
                    if (checkedRows.find((/**
                     * @param {?} n
                     * @return {?}
                     */
                    n => n[idfield] === element[idfield]))) {
                        checkTotal += 1;
                    }
                }));
                if (_rows.length === checkTotal) {
                    this.dataService.updateCheckAllStatus.next(1);
                }
                else {
                    if (checkedRows.length === 0) {
                        this.dataService.updateCheckAllStatus.next(0);
                    }
                    else {
                        this.dataService.updateCheckAllStatus.next(2);
                    }
                }
            }
        }
    }
    /**
     * 获取对象中指定字段的值。 field: 可以为带有层级结构的路径，如： user.firstName | name 等
     * @param {?} field
     * @param {?} data
     * @return {?}
     */
    getValue(field, data) {
        if (field.indexOf('.') === -1) {
            return data[field];
        }
        else {
            return (field.split('.').reduce((/**
             * @param {?} obj
             * @param {?} key
             * @return {?}
             */
            (obj, key) => {
                return obj[key];
            }), data) || '');
        }
    }
    /**
     * @param {?} event
     * @param {?} index
     * @param {?} data
     * @return {?}
     */
    selectedRow(event, index, data) {
        if (event) {
            event.stopPropagation();
            event.preventDefault();
        }
        /** @type {?} */
        let isSelected = false;
        /** @type {?} */
        const idfield = this.idField();
        if (this.dt.singleSelect) {
            if (this.selectedRowIndex !== index || !this._selections || this._selections[idfield] !== data[idfield]) {
                this.selectedRowIndex = index;
                this._selections = data;
                isSelected = true;
                this.dataService.selectedRow.next({
                    rowIndex: index,
                    rowData: data
                });
            }
            else {
                if (!this.dt.keepSelect) {
                    this.selectedRowIndex = -1;
                    this._selections = undefined;
                    isSelected = false;
                    this.dataService.unSelectedRow.next({
                        rowIndex: index,
                        rowData: data
                    });
                }
                else {
                    isSelected = true;
                }
            }
        }
        else {
            if (this.isSelected(data)) {
                delete this._selections[data[idfield]];
                isSelected = false;
                this.dataService.unSelectedRow.next({
                    rowIndex: index,
                    rowData: data
                });
            }
            else {
                this._selections[data[this.idField()]] = data;
                isSelected = true;
                this.dataService.selectedRow.next({
                    rowIndex: index,
                    rowData: data
                });
            }
        }
        if (isSelected) {
            this.dt.selectedRow.emit({ data, index });
            // 兼容
            this.dt.selectRows.emit({ data, index });
        }
        else {
            this.dt.unSelectRow.emit({ data, index });
        }
    }
    /**
     * @param {?} event
     * @param {?} index
     * @param {?} data
     * @return {?}
     */
    onChecked(event, index, data) {
        /** @type {?} */
        const state = event.checked;
        /** @type {?} */
        const idfield = this.dt.idField;
        if (state) {
            this._selections[data[idfield]] = data;
            this.dataService.selectedRow.next({
                rowIndex: index,
                rowData: data
            });
            this.dt.selectedRow.emit({ data, index });
            // 兼容
            this.dt.selectRows.emit({ data, index });
        }
        else {
            delete this._selections[data[idfield]];
            this.dataService.unSelectedRow.next({
                rowIndex: index,
                rowData: data
            });
            this.dt.unSelectRow.emit({ data, index });
        }
        event.originalEvent.stopPropagation();
    }
    /**
     * @private
     * @return {?}
     */
    idField() {
        return this.dt.idField;
    }
    /**
     * @param {?} row
     * @param {?=} tr
     * @return {?}
     */
    isSelected(row, tr) {
        /** @type {?} */
        const idfield = this.idField();
        if (this._selections) {
            if (this.dt.singleSelect) {
                return this._selections[idfield] === row[idfield];
            }
            else {
                return this._selections[row[idfield]] !== undefined;
            }
        }
        return false;
    }
    /**
     * @param {?} field
     * @param {?} data
     * @param {?} formatter
     * @return {?}
     */
    formatData(field, data, formatter) {
        /** @type {?} */
        const value = this.utils.getValue(field, data, true);
        return this.colFormatSer.format(value, data, formatter);
    }
    // 添加自定义设置列 单元格类样式
    /**
     * @param {?} value
     * @param {?} col
     * @return {?}
     */
    getTdClassName(value, col) {
        /** @type {?} */
        const tempClassName = {};
        // 列类的样式
        if (col.className &&
            Object.prototype.toString.call(col.className) === '[object String]') {
            tempClassName[col.className] = true;
        }
        if (this.cellClassName && this.cellClassName(value, col)) {
            tempClassName[this.cellClassName(value, col)] = true;
        }
        return tempClassName;
    }
    /**
     * @param {?} row
     * @param {?} index
     * @return {?}
     */
    createRowClassName(row, index) {
        return this.rowClassName ? this.rowClassName(row, index) : '';
    }
    /**
     * @param {?} event
     * @param {?} col
     * @param {?} row
     * @return {?}
     */
    onCellClick(event, col, row) {
        this.cellClick.emit({ event, col, row });
    }
    /**
     * @param {?} row
     * @param {?} index
     * @return {?}
     */
    renderRowStyle(row, index) {
        if (this.dt.rowStyler) {
            return this.dt.rowStyler({ data: row, index });
        }
        return '';
    }
    /**
     * @param {?} val
     * @param {?} row
     * @param {?} index
     * @param {?} col
     * @return {?}
     */
    renderCellStyle(val, row, index, col) {
        if (this.dt.cellStyler) {
            return this.dt.cellStyler({ value: val, data: row, index, col, field: col.field });
        }
        return '';
    }
}
DataTableBodyComponent.decorators = [
    { type: Component, args: [{
                selector: 'datatable-body',
                template: `
        <table
            class="table"
            [class.table-sm]="size === 'small'"
            [class.table-hover]="dt.hover"
            [class.table-striped]="striped"
            [class.table-bordered]="bordered"
            [class.f-table-norecords]="!rows || !rows.length"
        >
            <colgroup>
                <col class="dt-checkbox-cell" *ngIf="!dt.singleSelect" />
                <col
                    *ngFor="let col of columns"
                    [style.width]="col.width + 'px'"
                />
            </colgroup>

            <tbody class="ui-table-tbody" *ngIf="rows && rows.length">
                <tr
                    *ngFor="let row of rows; trackBy: dt.trackByRows; let rowIndex = index"
                    [ngClass]="createRowClassName(row, rowIndex)"
                    (click)="selectedRow($event, rowIndex, row)"
                    [class.selected]="isSelected(row, tr)" #tr
                    [dblclick]="row"
                    [ngStyle]="renderRowStyle(row, rowIndex)"
                >
                    <td class="dt-checkbox-cell" *ngIf="!dt.singleSelect">
                        <dt-checkbox
                            [checked]="isSelected(row, tr)"
                            (checkedChange)="onChecked($event, rowIndex, row)"
                        ></dt-checkbox>
                    </td>
                    <td
                        [ngClass]="getTdClassName(row[col.field], col)"
                        *ngFor="let col of columns; let colIndex = index"
                        [style.textAlign]="col.align || 'left'"
                        [ngStyle]="renderCellStyle(utils.getValue(col.field, row), row, rowIndex, col)"
                        (click)="onCellClick($event, col, row)"
                        [class.datatable-fixed-right]="col['fixed'] === 'right'"
                    >
                        <ng-container *ngIf="!col.cellTempl; else cellTemp">
                            <span *ngIf="col.formatter" [innerHTML]="formatData(col.field, row, col.formatter) | safe:'html'" ></span>
                            <span *ngIf="!col.formatter" [title]="utils.getValue(col.field, row)"
                             [innerHTML]="utils.getValue(col.field, row, true)"></span>
                        </ng-container>
                        <ng-template
                            #cellTemp
                            [ngTemplateOutlet]="col.cellTempl"
                            [ngTemplateOutletContext]="{
                                $implicit: row,
                                rowIndex: rowIndex,
                                value: row[col.field]
                            }"
                        ></ng-template>
                    </td>
                </tr>
            </tbody>

            <tbody class="ui-table-tbody" *ngIf="!rows || !rows.length">
                <tr class="f-table-norecords-row">
                    <td [attr.align]="'center'"
                        class="farris-treetable-emptydata"
                        [attr.colspan]="columns.length"
                    >
                        <div
                            class="f-table-norecords-content"
                            [innerHTML]="emptyMessage | safe: 'html'"
                        ></div>
                    </td>
                </tr>
            </tbody>
        </table>
    `,
                styles: [`
            .table td:focus-within {
                box-shadow: inset 0 0 0 2px rgba(0, 0, 0, 0.13);
            }
            .table td div {
                width: 100%;
                height: 100%;
            }
            .table td input {
                width: 100%;
                height: 100%;
                font-family: auto;
                line-height: 1;
                font-size: 13px;
            }
            .table td input:focus {
                border: 0;
            }
            input[type='checkbox']:focus {
                outline: none;
            }

            .ui-table-tbody .datatable-fixed-right {
                right: 0;
                position: sticky;
                background-color: white;
            }

            .ui-table-tbody tr:hover:not(.selected) td.datatable-fixed-right {
                background-color: #EDF5FF;
            }

            .table-hover tbody tr:hover:not(.selected) {
                background-color: #EDF5FF;
            }

            .ui-table-tbody tr.selected td.datatable-fixed-right {
                background-color: #DAE9FF;
            }

            .f-table-norecords-row:hover {
                background-color: #0000!important;
                cursor: default!important;
            }
        `]
            }] }
];
/** @nocollapse */
DataTableBodyComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: DataTableService },
    { type: Renderer2 },
    { type: DataTableComponent, decorators: [{ type: Optional }] },
    { type: ColumnFormatService },
    { type: CommonUtils },
    { type: Injector }
];
DataTableBodyComponent.propDecorators = {
    size: [{ type: Input }],
    hover: [{ type: Input }],
    bordered: [{ type: Input }],
    striped: [{ type: Input }],
    columns: [{ type: Input }],
    fixed: [{ type: Input }],
    rows: [{ type: Input }],
    rowClassName: [{ type: Input }],
    cellClassName: [{ type: Input }],
    rowDblClick: [{ type: Output }],
    selectRow: [{ type: Output }],
    cellEdit: [{ type: Output }],
    cellClick: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    DataTableBodyComponent.prototype.size;
    /** @type {?} */
    DataTableBodyComponent.prototype.hover;
    /** @type {?} */
    DataTableBodyComponent.prototype.bordered;
    /** @type {?} */
    DataTableBodyComponent.prototype.striped;
    /** @type {?} */
    DataTableBodyComponent.prototype.columns;
    /** @type {?} */
    DataTableBodyComponent.prototype.fixed;
    /** @type {?} */
    DataTableBodyComponent.prototype.rows;
    /** @type {?} */
    DataTableBodyComponent.prototype.rowClassName;
    /** @type {?} */
    DataTableBodyComponent.prototype.cellClassName;
    /** @type {?} */
    DataTableBodyComponent.prototype.rowDblClick;
    /** @type {?} */
    DataTableBodyComponent.prototype.selectRow;
    /** @type {?} */
    DataTableBodyComponent.prototype.cellEdit;
    /** @type {?} */
    DataTableBodyComponent.prototype.cellClick;
    /** @type {?} */
    DataTableBodyComponent.prototype.lastRowIndex;
    /** @type {?} */
    DataTableBodyComponent.prototype.lastColumnIndex;
    /** @type {?} */
    DataTableBodyComponent.prototype.boxShadow;
    /** @type {?} */
    DataTableBodyComponent.prototype._rows;
    /** @type {?} */
    DataTableBodyComponent.prototype.edit;
    /** @type {?} */
    DataTableBodyComponent.prototype.className;
    /** @type {?} */
    DataTableBodyComponent.prototype.isRowTempl;
    /** @type {?} */
    DataTableBodyComponent.prototype.selectedRowIndex;
    /** @type {?} */
    DataTableBodyComponent.prototype._selections;
    /** @type {?} */
    DataTableBodyComponent.prototype.emptyMessage;
    /**
     * @type {?}
     * @private
     */
    DataTableBodyComponent.prototype.localeService;
    /** @type {?} */
    DataTableBodyComponent.prototype.el;
    /**
     * @type {?}
     * @private
     */
    DataTableBodyComponent.prototype.dataService;
    /**
     * @type {?}
     * @private
     */
    DataTableBodyComponent.prototype.render;
    /** @type {?} */
    DataTableBodyComponent.prototype.dt;
    /** @type {?} */
    DataTableBodyComponent.prototype.colFormatSer;
    /** @type {?} */
    DataTableBodyComponent.prototype.utils;
    /**
     * @type {?}
     * @private
     */
    DataTableBodyComponent.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YXRhYmxlLWJvZHkuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1kYXRhdGFibGUvIiwic291cmNlcyI6WyJsaWIvdGFibGUvZGF0YXRhYmxlLWJvZHkuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7Ozs7Ozs7OztBQVNsRCxPQUFPLEVBQ0gsU0FBUyxFQUVULEtBQUssRUFDTCxNQUFNLEVBQ04sUUFBUSxFQUNSLFVBQVUsRUFDVixTQUFTLEVBRVQsWUFBWSxFQUNaLFNBQVMsRUFDVCxZQUFZLEVBRVosUUFBUSxFQUdYLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUNyRCxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUN4RCxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUM1RCxPQUFPLEVBQUUsbUJBQW1CLEVBQWMsTUFBTSwwQkFBMEIsQ0FBQztBQUMzRSxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFLaEQsTUFBTSxPQUFPLHNCQUFzQjs7Ozs7SUFFL0IsWUFDVyxFQUFjLEVBQ0YsRUFBc0I7UUFEbEMsT0FBRSxHQUFGLEVBQUUsQ0FBWTtRQUNGLE9BQUUsR0FBRixFQUFFLENBQW9CO0lBQzFDLENBQUM7Ozs7SUFFSixRQUFRLEtBQUksQ0FBQzs7Ozs7SUFHYixVQUFVLENBQUMsS0FBWTtRQUNuQixJQUFJLElBQUksQ0FBQyxHQUFHLEVBQUU7WUFDVixJQUFJLENBQUMsRUFBRSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1NBQ3RDO1FBRUQsS0FBSyxDQUFDLGVBQWUsRUFBRSxDQUFDO0lBQzVCLENBQUM7OztZQW5CSixTQUFTLFNB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Qiw2Q0FBcUM7Ozs7O0lBQ3JDLHdDQUF5Qjs7SUFDekIsb0NBQXlDOztJQUN6Qyw4Q0FBd0M7O0lBQ3hDLHVDQUF5Qjs7Ozs7SUFDekIsMENBQTBCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTG9jYWxlU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbG9jYWxlJztcclxuLypcclxuICogQEF1dGhvcjog55av54uC56eA5omNKEx1Y2FzIEh1YW5nKVxyXG4gKiBARGF0ZTogMjAxOS0wOC0xNCAxMzo1MzowM1xyXG4gKiBATGFzdEVkaXRvcnM6IOeWr+eLguengOaJjShMdWNhcyBIdWFuZylcclxuICogQExhc3RFZGl0VGltZTogMjAxOS0xMC0wMSAxNTowMjoyOVxyXG4gKiBAUVE6IDEwNTU4MTgyMzlcclxuICogQFZlcnNpb246IHYwLjAuMVxyXG4gKi9cclxuaW1wb3J0IHtcclxuICAgIENvbXBvbmVudCxcclxuICAgIE9uSW5pdCxcclxuICAgIElucHV0LFxyXG4gICAgT3V0cHV0LFxyXG4gICAgT3B0aW9uYWwsXHJcbiAgICBFbGVtZW50UmVmLFxyXG4gICAgUmVuZGVyZXIyLFxyXG4gICAgQWZ0ZXJWaWV3SW5pdCxcclxuICAgIEV2ZW50RW1pdHRlcixcclxuICAgIERpcmVjdGl2ZSxcclxuICAgIEhvc3RMaXN0ZW5lcixcclxuICAgIFNraXBTZWxmLFxyXG4gICAgSW5qZWN0b3IsXHJcbiAgICBPbkNoYW5nZXMsXHJcbiAgICBTaW1wbGVDaGFuZ2VzXHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IGNvbnZlcnRDb2x1bW5zIH0gZnJvbSAnLi4vZGF0YXRhYmxlLWNvbHVtbic7XHJcbmltcG9ydCB7IERhdGFUYWJsZVNlcnZpY2UgfSBmcm9tICcuLi9kYXRhdGFibGUuc2VydmljZSc7XHJcbmltcG9ydCB7IERhdGFUYWJsZUNvbXBvbmVudCB9IGZyb20gJy4uL2RhdGF0YWJsZS5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBDb2x1bW5Gb3JtYXRTZXJ2aWNlLCBEYXRhQ29sdW1uIH0gZnJvbSAnQGZhcnJpcy91aS1jb21tb24vY29sdW1uJztcclxuaW1wb3J0IHsgQ29tbW9uVXRpbHMgfSBmcm9tICdAZmFycmlzL3VpLWNvbW1vbic7XHJcblxyXG5ARGlyZWN0aXZlKHtcclxuICAgIHNlbGVjdG9yOiAnW2RibGNsaWNrXSdcclxufSlcclxuZXhwb3J0IGNsYXNzIERURGJsQ2xpY2tSb3dEaXJlY3RpdmUgaW1wbGVtZW50cyBPbkluaXQge1xyXG4gICAgQElucHV0KCdkYmxjbGljaycpIHJvdztcclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIHB1YmxpYyBlbDogRWxlbWVudFJlZixcclxuICAgICAgICBAT3B0aW9uYWwoKSBwdWJsaWMgZHQ6IERhdGFUYWJsZUNvbXBvbmVudFxyXG4gICAgKSB7fVxyXG5cclxuICAgIG5nT25Jbml0KCkge31cclxuXHJcbiAgICBASG9zdExpc3RlbmVyKCdkYmxjbGljaycsIFsnJGV2ZW50J10pXHJcbiAgICBvbmRibGNsaWNrKGV2ZW50OiBFdmVudCkge1xyXG4gICAgICAgIGlmICh0aGlzLnJvdykge1xyXG4gICAgICAgICAgICB0aGlzLmR0LnJvd0RibENsaWNrLmVtaXQodGhpcy5yb3cpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICB9XHJcbn1cclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdkYXRhdGFibGUtYm9keScsXHJcbiAgICB0ZW1wbGF0ZTogYFxyXG4gICAgICAgIDx0YWJsZVxyXG4gICAgICAgICAgICBjbGFzcz1cInRhYmxlXCJcclxuICAgICAgICAgICAgW2NsYXNzLnRhYmxlLXNtXT1cInNpemUgPT09ICdzbWFsbCdcIlxyXG4gICAgICAgICAgICBbY2xhc3MudGFibGUtaG92ZXJdPVwiZHQuaG92ZXJcIlxyXG4gICAgICAgICAgICBbY2xhc3MudGFibGUtc3RyaXBlZF09XCJzdHJpcGVkXCJcclxuICAgICAgICAgICAgW2NsYXNzLnRhYmxlLWJvcmRlcmVkXT1cImJvcmRlcmVkXCJcclxuICAgICAgICAgICAgW2NsYXNzLmYtdGFibGUtbm9yZWNvcmRzXT1cIiFyb3dzIHx8ICFyb3dzLmxlbmd0aFwiXHJcbiAgICAgICAgPlxyXG4gICAgICAgICAgICA8Y29sZ3JvdXA+XHJcbiAgICAgICAgICAgICAgICA8Y29sIGNsYXNzPVwiZHQtY2hlY2tib3gtY2VsbFwiICpuZ0lmPVwiIWR0LnNpbmdsZVNlbGVjdFwiIC8+XHJcbiAgICAgICAgICAgICAgICA8Y29sXHJcbiAgICAgICAgICAgICAgICAgICAgKm5nRm9yPVwibGV0IGNvbCBvZiBjb2x1bW5zXCJcclxuICAgICAgICAgICAgICAgICAgICBbc3R5bGUud2lkdGhdPVwiY29sLndpZHRoICsgJ3B4J1wiXHJcbiAgICAgICAgICAgICAgICAvPlxyXG4gICAgICAgICAgICA8L2NvbGdyb3VwPlxyXG5cclxuICAgICAgICAgICAgPHRib2R5IGNsYXNzPVwidWktdGFibGUtdGJvZHlcIiAqbmdJZj1cInJvd3MgJiYgcm93cy5sZW5ndGhcIj5cclxuICAgICAgICAgICAgICAgIDx0clxyXG4gICAgICAgICAgICAgICAgICAgICpuZ0Zvcj1cImxldCByb3cgb2Ygcm93czsgdHJhY2tCeTogZHQudHJhY2tCeVJvd3M7IGxldCByb3dJbmRleCA9IGluZGV4XCJcclxuICAgICAgICAgICAgICAgICAgICBbbmdDbGFzc109XCJjcmVhdGVSb3dDbGFzc05hbWUocm93LCByb3dJbmRleClcIlxyXG4gICAgICAgICAgICAgICAgICAgIChjbGljayk9XCJzZWxlY3RlZFJvdygkZXZlbnQsIHJvd0luZGV4LCByb3cpXCJcclxuICAgICAgICAgICAgICAgICAgICBbY2xhc3Muc2VsZWN0ZWRdPVwiaXNTZWxlY3RlZChyb3csIHRyKVwiICN0clxyXG4gICAgICAgICAgICAgICAgICAgIFtkYmxjbGlja109XCJyb3dcIlxyXG4gICAgICAgICAgICAgICAgICAgIFtuZ1N0eWxlXT1cInJlbmRlclJvd1N0eWxlKHJvdywgcm93SW5kZXgpXCJcclxuICAgICAgICAgICAgICAgID5cclxuICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9XCJkdC1jaGVja2JveC1jZWxsXCIgKm5nSWY9XCIhZHQuc2luZ2xlU2VsZWN0XCI+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDxkdC1jaGVja2JveFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgW2NoZWNrZWRdPVwiaXNTZWxlY3RlZChyb3csIHRyKVwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoY2hlY2tlZENoYW5nZSk9XCJvbkNoZWNrZWQoJGV2ZW50LCByb3dJbmRleCwgcm93KVwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgID48L2R0LWNoZWNrYm94PlxyXG4gICAgICAgICAgICAgICAgICAgIDwvdGQ+XHJcbiAgICAgICAgICAgICAgICAgICAgPHRkXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFtuZ0NsYXNzXT1cImdldFRkQ2xhc3NOYW1lKHJvd1tjb2wuZmllbGRdLCBjb2wpXCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgKm5nRm9yPVwibGV0IGNvbCBvZiBjb2x1bW5zOyBsZXQgY29sSW5kZXggPSBpbmRleFwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFtzdHlsZS50ZXh0QWxpZ25dPVwiY29sLmFsaWduIHx8ICdsZWZ0J1wiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFtuZ1N0eWxlXT1cInJlbmRlckNlbGxTdHlsZSh1dGlscy5nZXRWYWx1ZShjb2wuZmllbGQsIHJvdyksIHJvdywgcm93SW5kZXgsIGNvbClcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAoY2xpY2spPVwib25DZWxsQ2xpY2soJGV2ZW50LCBjb2wsIHJvdylcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBbY2xhc3MuZGF0YXRhYmxlLWZpeGVkLXJpZ2h0XT1cImNvbFsnZml4ZWQnXSA9PT0gJ3JpZ2h0J1wiXHJcbiAgICAgICAgICAgICAgICAgICAgPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICA8bmctY29udGFpbmVyICpuZ0lmPVwiIWNvbC5jZWxsVGVtcGw7IGVsc2UgY2VsbFRlbXBcIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuICpuZ0lmPVwiY29sLmZvcm1hdHRlclwiIFtpbm5lckhUTUxdPVwiZm9ybWF0RGF0YShjb2wuZmllbGQsIHJvdywgY29sLmZvcm1hdHRlcikgfCBzYWZlOidodG1sJ1wiID48L3NwYW4+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiAqbmdJZj1cIiFjb2wuZm9ybWF0dGVyXCIgW3RpdGxlXT1cInV0aWxzLmdldFZhbHVlKGNvbC5maWVsZCwgcm93KVwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW2lubmVySFRNTF09XCJ1dGlscy5nZXRWYWx1ZShjb2wuZmllbGQsIHJvdywgdHJ1ZSlcIj48L3NwYW4+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDwvbmctY29udGFpbmVyPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICA8bmctdGVtcGxhdGVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICNjZWxsVGVtcFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgW25nVGVtcGxhdGVPdXRsZXRdPVwiY29sLmNlbGxUZW1wbFwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbbmdUZW1wbGF0ZU91dGxldENvbnRleHRdPVwie1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRpbXBsaWNpdDogcm93LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvd0luZGV4OiByb3dJbmRleCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogcm93W2NvbC5maWVsZF1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICA+PC9uZy10ZW1wbGF0ZT5cclxuICAgICAgICAgICAgICAgICAgICA8L3RkPlxyXG4gICAgICAgICAgICAgICAgPC90cj5cclxuICAgICAgICAgICAgPC90Ym9keT5cclxuXHJcbiAgICAgICAgICAgIDx0Ym9keSBjbGFzcz1cInVpLXRhYmxlLXRib2R5XCIgKm5nSWY9XCIhcm93cyB8fCAhcm93cy5sZW5ndGhcIj5cclxuICAgICAgICAgICAgICAgIDx0ciBjbGFzcz1cImYtdGFibGUtbm9yZWNvcmRzLXJvd1wiPlxyXG4gICAgICAgICAgICAgICAgICAgIDx0ZCBbYXR0ci5hbGlnbl09XCInY2VudGVyJ1wiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzPVwiZmFycmlzLXRyZWV0YWJsZS1lbXB0eWRhdGFcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBbYXR0ci5jb2xzcGFuXT1cImNvbHVtbnMubGVuZ3RoXCJcclxuICAgICAgICAgICAgICAgICAgICA+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXZcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzPVwiZi10YWJsZS1ub3JlY29yZHMtY29udGVudFwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbaW5uZXJIVE1MXT1cImVtcHR5TWVzc2FnZSB8IHNhZmU6ICdodG1sJ1wiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgID48L2Rpdj5cclxuICAgICAgICAgICAgICAgICAgICA8L3RkPlxyXG4gICAgICAgICAgICAgICAgPC90cj5cclxuICAgICAgICAgICAgPC90Ym9keT5cclxuICAgICAgICA8L3RhYmxlPlxyXG4gICAgYCxcclxuICAgIHN0eWxlczogW1xyXG4gICAgICAgIGBcclxuICAgICAgICAgICAgLnRhYmxlIHRkOmZvY3VzLXdpdGhpbiB7XHJcbiAgICAgICAgICAgICAgICBib3gtc2hhZG93OiBpbnNldCAwIDAgMCAycHggcmdiYSgwLCAwLCAwLCAwLjEzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAudGFibGUgdGQgZGl2IHtcclxuICAgICAgICAgICAgICAgIHdpZHRoOiAxMDAlO1xyXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiAxMDAlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC50YWJsZSB0ZCBpbnB1dCB7XHJcbiAgICAgICAgICAgICAgICB3aWR0aDogMTAwJTtcclxuICAgICAgICAgICAgICAgIGhlaWdodDogMTAwJTtcclxuICAgICAgICAgICAgICAgIGZvbnQtZmFtaWx5OiBhdXRvO1xyXG4gICAgICAgICAgICAgICAgbGluZS1oZWlnaHQ6IDE7XHJcbiAgICAgICAgICAgICAgICBmb250LXNpemU6IDEzcHg7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLnRhYmxlIHRkIGlucHV0OmZvY3VzIHtcclxuICAgICAgICAgICAgICAgIGJvcmRlcjogMDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpbnB1dFt0eXBlPSdjaGVja2JveCddOmZvY3VzIHtcclxuICAgICAgICAgICAgICAgIG91dGxpbmU6IG5vbmU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC51aS10YWJsZS10Ym9keSAuZGF0YXRhYmxlLWZpeGVkLXJpZ2h0IHtcclxuICAgICAgICAgICAgICAgIHJpZ2h0OiAwO1xyXG4gICAgICAgICAgICAgICAgcG9zaXRpb246IHN0aWNreTtcclxuICAgICAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6IHdoaXRlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAudWktdGFibGUtdGJvZHkgdHI6aG92ZXI6bm90KC5zZWxlY3RlZCkgdGQuZGF0YXRhYmxlLWZpeGVkLXJpZ2h0IHtcclxuICAgICAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICNFREY1RkY7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC50YWJsZS1ob3ZlciB0Ym9keSB0cjpob3Zlcjpub3QoLnNlbGVjdGVkKSB7XHJcbiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjRURGNUZGO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAudWktdGFibGUtdGJvZHkgdHIuc2VsZWN0ZWQgdGQuZGF0YXRhYmxlLWZpeGVkLXJpZ2h0IHtcclxuICAgICAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICNEQUU5RkY7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC5mLXRhYmxlLW5vcmVjb3Jkcy1yb3c6aG92ZXIge1xyXG4gICAgICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogIzAwMDAhaW1wb3J0YW50O1xyXG4gICAgICAgICAgICAgICAgY3Vyc29yOiBkZWZhdWx0IWltcG9ydGFudDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIGBcclxuICAgIF1cclxufSlcclxuZXhwb3J0IGNsYXNzIERhdGFUYWJsZUJvZHlDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIEFmdGVyVmlld0luaXQsIE9uQ2hhbmdlcyB7XHJcbiAgICBASW5wdXQoKSBzaXplOiBzdHJpbmc7XHJcbiAgICBASW5wdXQoKSBob3ZlcjogYm9vbGVhbjtcclxuICAgIEBJbnB1dCgpIGJvcmRlcmVkOiBib29sZWFuO1xyXG4gICAgQElucHV0KCkgc3RyaXBlZDogYm9vbGVhbjtcclxuICAgIEBJbnB1dCgpIGNvbHVtbnM6IERhdGFDb2x1bW5bXTtcclxuICAgIEBJbnB1dCgpIGZpeGVkOiBzdHJpbmc7XHJcbiAgICBASW5wdXQoKSByb3dzOiBhbnlbXSA9IFtdO1xyXG4gICAgQElucHV0KCkgcm93Q2xhc3NOYW1lOiAocm93OiBhbnksIGluZGV4OiBudW1iZXIpID0+IHN0cmluZztcclxuICAgIEBJbnB1dCgpIGNlbGxDbGFzc05hbWU6ICh2YWx1ZTogYW55LCBjb2w6IGFueSkgPT4gc3RyaW5nO1xyXG4gICAgQE91dHB1dCgpIHJvd0RibENsaWNrID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gICAgQE91dHB1dCgpIHNlbGVjdFJvdzogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuICAgIEBPdXRwdXQoKSBjZWxsRWRpdDogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuICAgIEBPdXRwdXQoKSBjZWxsQ2xpY2s6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcblxyXG4gICAgbGFzdFJvd0luZGV4ID0gMDtcclxuICAgIGxhc3RDb2x1bW5JbmRleCA9IDA7XHJcbiAgICBib3hTaGFkb3c6IHN0cmluZztcclxuICAgIF9yb3dzOiBhbnk7XHJcbiAgICBlZGl0ID0ge307XHJcbiAgICBjbGFzc05hbWUgPSB7fTtcclxuICAgIGlzUm93VGVtcGwgPSBmYWxzZTtcclxuICAgIHNlbGVjdGVkUm93SW5kZXggPSAtMTtcclxuICAgIF9zZWxlY3Rpb25zID0ge307XHJcbiAgICBlbXB0eU1lc3NhZ2UgPSAn5pqC5peg5pWw5o2uJztcclxuXHJcbiAgICAvLyDlt7LpgInmi6nnmoTooYwg6buY6K6k5Li656m6XHJcbiAgICBzZXQgc2VsZWN0aW9ucyh2KSB7XHJcbiAgICAgICAgdGhpcy5fc2VsZWN0aW9ucyA9IHYgfHwge307XHJcbiAgICAgICAgdGhpcy5kdC51cGRhdGVDaGVja2JveFN0YXRlKHRoaXMucm93cyk7XHJcbiAgICB9XHJcbiAgICBnZXQgc2VsZWN0aW9ucygpOiBhbnkge1xyXG4gICAgICAgIGlmICghdGhpcy5fc2VsZWN0aW9ucykge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyh0aGlzLl9zZWxlY3Rpb25zKTtcclxuICAgICAgICBpZiAoa2V5cy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZHQuc2luZ2xlU2VsZWN0KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fc2VsZWN0aW9ucztcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBrZXlzLm1hcChrID0+IHRoaXMuX3NlbGVjdGlvbnNba10pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgbG9jYWxlU2VydmljZTogTG9jYWxlU2VydmljZTtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwdWJsaWMgZWw6IEVsZW1lbnRSZWYsXHJcbiAgICAgICAgcHJpdmF0ZSBkYXRhU2VydmljZTogRGF0YVRhYmxlU2VydmljZSxcclxuICAgICAgICBwcml2YXRlIHJlbmRlcjogUmVuZGVyZXIyLFxyXG4gICAgICAgIEBPcHRpb25hbCgpIHB1YmxpYyBkdDogRGF0YVRhYmxlQ29tcG9uZW50LFxyXG4gICAgICAgIHB1YmxpYyBjb2xGb3JtYXRTZXI6IENvbHVtbkZvcm1hdFNlcnZpY2UsXHJcbiAgICAgICAgcHVibGljIHV0aWxzOiBDb21tb25VdGlscyxcclxuICAgICAgICBwcml2YXRlIGluamVjdG9yOiBJbmplY3RvclxyXG4gICAgKSB7XHJcbiAgICAgICAgdGhpcy5sb2NhbGVTZXJ2aWNlID0gdGhpcy5pbmplY3Rvci5nZXQoTG9jYWxlU2VydmljZSk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKSB7XHJcbiAgICAgICAgdGhpcy5kYXRhU2VydmljZS5zZWxlY3RlZEFsbC5zdWJzY3JpYmUoYWxsQ2hlY2tlZCA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGlkZmllbGQgPSB0aGlzLmlkRmllbGQoKTtcclxuICAgICAgICAgICAgdGhpcy5yb3dzLmZvckVhY2gocm93ID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChhbGxDaGVja2VkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2VsZWN0aW9uc1tyb3dbaWRmaWVsZF1dID0gcm93O1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5fc2VsZWN0aW9uc1tyb3dbaWRmaWVsZF1dO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBpZiAodGhpcy5yb3dzKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaXNSb3dUZW1wbCA9IHRoaXMucm93cy5zb21lKHJvdyA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcm93Lmhhc093blByb3BlcnR5KCdyb3dUZW1wbCcpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuZml4ZWQgPT09ICdsZWZ0Jykge1xyXG4gICAgICAgICAgICB0aGlzLmNvbHVtbnMgPSBjb252ZXJ0Q29sdW1ucyh0aGlzLmNvbHVtbnMsICdsZWZ0Jyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmZpeGVkID09PSAncmlnaHQnKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29sdW1ucyA9IGNvbnZlcnRDb2x1bW5zKHRoaXMuY29sdW1ucywgJ3JpZ2h0Jyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmVtcHR5TWVzc2FnZSA9IHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZSgnZGF0YWdyaWQuZW1wdHlNZXNzYWdlJyk7XHJcbiAgICB9XHJcbiAgICBuZ0FmdGVyVmlld0luaXQoKSB7XHJcbiAgICAgICAgdGhpcy5fcm93cyA9IHRoaXMuZWwubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKCd0cicpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcclxuICAgICAgICBpZiAoY2hhbmdlcy5yb3dzICYmICFjaGFuZ2VzLnJvd3MuaXNGaXJzdENoYW5nZSgpKSB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5kdC5zaW5nbGVTZWxlY3QpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IF9yb3dzID0gY2hhbmdlcy5yb3dzLmN1cnJlbnRWYWx1ZSB8fCBbXTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNoZWNrZWRSb3dzID0gX3Jvd3MubWFwKG4gPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmlzU2VsZWN0ZWQobikgPyBuIDogMDtcclxuICAgICAgICAgICAgICAgIH0pLmZpbHRlcihuID0+IG4pO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICghX3Jvd3MubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXRhU2VydmljZS51cGRhdGVDaGVja0FsbFN0YXR1cy5uZXh0KDApO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGNvbnN0IGlkZmllbGQgPSB0aGlzLmlkRmllbGQoKTtcclxuICAgICAgICAgICAgICAgIGxldCBjaGVja1RvdGFsID0gMDtcclxuICAgICAgICAgICAgICAgIF9yb3dzLmZvckVhY2goZWxlbWVudCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNoZWNrZWRSb3dzLmZpbmQobiA9PiBuW2lkZmllbGRdID09PSBlbGVtZW50W2lkZmllbGRdKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGVja1RvdGFsICs9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChfcm93cy5sZW5ndGggID09PSBjaGVja1RvdGFsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXRhU2VydmljZS51cGRhdGVDaGVja0FsbFN0YXR1cy5uZXh0KDEpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY2hlY2tlZFJvd3MubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGF0YVNlcnZpY2UudXBkYXRlQ2hlY2tBbGxTdGF0dXMubmV4dCgwKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRhdGFTZXJ2aWNlLnVwZGF0ZUNoZWNrQWxsU3RhdHVzLm5leHQoMik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDojrflj5blr7nosaHkuK3mjIflrprlrZfmrrXnmoTlgLzjgIIgZmllbGQ6IOWPr+S7peS4uuW4puacieWxgue6p+e7k+aehOeahOi3r+W+hO+8jOWmgu+8miB1c2VyLmZpcnN0TmFtZSB8IG5hbWUg562JXHJcbiAgICAgKi9cclxuICAgIGdldFZhbHVlKGZpZWxkOiBzdHJpbmcsIGRhdGE6IGFueSkge1xyXG4gICAgICAgIGlmIChmaWVsZC5pbmRleE9mKCcuJykgPT09IC0xKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBkYXRhW2ZpZWxkXTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gKFxyXG4gICAgICAgICAgICAgICAgZmllbGQuc3BsaXQoJy4nKS5yZWR1Y2UoKG9iaiwga2V5KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9ialtrZXldO1xyXG4gICAgICAgICAgICAgICAgfSwgZGF0YSkgfHwgJydcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBzZWxlY3RlZFJvdyhldmVudDogYW55LCBpbmRleDogbnVtYmVyLCBkYXRhOiBhbnkpIHtcclxuICAgICAgICBpZiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCBpc1NlbGVjdGVkID0gZmFsc2U7XHJcbiAgICAgICAgY29uc3QgaWRmaWVsZCA9IHRoaXMuaWRGaWVsZCgpO1xyXG5cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZHQuc2luZ2xlU2VsZWN0KSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGVkUm93SW5kZXggIT09IGluZGV4IHx8ICF0aGlzLl9zZWxlY3Rpb25zIHx8IHRoaXMuX3NlbGVjdGlvbnNbaWRmaWVsZF0gIT09IGRhdGFbaWRmaWVsZF0pIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRSb3dJbmRleCA9IGluZGV4O1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fc2VsZWN0aW9ucyA9IGRhdGE7XHJcbiAgICAgICAgICAgICAgICBpc1NlbGVjdGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGF0YVNlcnZpY2Uuc2VsZWN0ZWRSb3cubmV4dCh7XHJcbiAgICAgICAgICAgICAgICAgICAgcm93SW5kZXg6IGluZGV4LFxyXG4gICAgICAgICAgICAgICAgICAgIHJvd0RhdGE6IGRhdGFcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmR0LmtlZXBTZWxlY3QpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkUm93SW5kZXggPSAtMTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZWxlY3Rpb25zID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICAgICAgICAgIGlzU2VsZWN0ZWQgPSBmYWxzZTtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGF0YVNlcnZpY2UudW5TZWxlY3RlZFJvdy5uZXh0KHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcm93SW5kZXg6IGluZGV4LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByb3dEYXRhOiBkYXRhXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGlzU2VsZWN0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuaXNTZWxlY3RlZChkYXRhKSkge1xyXG4gICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuX3NlbGVjdGlvbnNbZGF0YVtpZGZpZWxkXV07XHJcblxyXG4gICAgICAgICAgICAgICAgaXNTZWxlY3RlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kYXRhU2VydmljZS51blNlbGVjdGVkUm93Lm5leHQoe1xyXG4gICAgICAgICAgICAgICAgICAgIHJvd0luZGV4OiBpbmRleCxcclxuICAgICAgICAgICAgICAgICAgICByb3dEYXRhOiBkYXRhXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3NlbGVjdGlvbnNbZGF0YVt0aGlzLmlkRmllbGQoKV1dID0gZGF0YTtcclxuICAgICAgICAgICAgICAgIGlzU2VsZWN0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kYXRhU2VydmljZS5zZWxlY3RlZFJvdy5uZXh0KHtcclxuICAgICAgICAgICAgICAgICAgICByb3dJbmRleDogaW5kZXgsXHJcbiAgICAgICAgICAgICAgICAgICAgcm93RGF0YTogZGF0YVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChpc1NlbGVjdGVkKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZHQuc2VsZWN0ZWRSb3cuZW1pdCh7IGRhdGEsIGluZGV4IH0pO1xyXG4gICAgICAgICAgICAvLyDlhbzlrrlcclxuICAgICAgICAgICAgdGhpcy5kdC5zZWxlY3RSb3dzLmVtaXQoeyBkYXRhLCBpbmRleCB9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmR0LnVuU2VsZWN0Um93LmVtaXQoeyBkYXRhLCBpbmRleCB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgb25DaGVja2VkKGV2ZW50OiBhbnksIGluZGV4OiBudW1iZXIsIGRhdGE6IGFueSkge1xyXG4gICAgICAgIGNvbnN0IHN0YXRlID0gZXZlbnQuY2hlY2tlZDtcclxuICAgICAgICBjb25zdCBpZGZpZWxkID0gdGhpcy5kdC5pZEZpZWxkO1xyXG4gICAgICAgIGlmIChzdGF0ZSkge1xyXG4gICAgICAgICAgICB0aGlzLl9zZWxlY3Rpb25zW2RhdGFbaWRmaWVsZF1dID0gZGF0YTtcclxuICAgICAgICAgICAgdGhpcy5kYXRhU2VydmljZS5zZWxlY3RlZFJvdy5uZXh0KHtcclxuICAgICAgICAgICAgICAgIHJvd0luZGV4OiBpbmRleCxcclxuICAgICAgICAgICAgICAgIHJvd0RhdGE6IGRhdGFcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHRoaXMuZHQuc2VsZWN0ZWRSb3cuZW1pdCh7IGRhdGEsIGluZGV4IH0pO1xyXG4gICAgICAgICAgICAvLyDlhbzlrrlcclxuICAgICAgICAgICAgdGhpcy5kdC5zZWxlY3RSb3dzLmVtaXQoeyBkYXRhLCBpbmRleCB9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBkZWxldGUgdGhpcy5fc2VsZWN0aW9uc1tkYXRhW2lkZmllbGRdXTtcclxuICAgICAgICAgICAgdGhpcy5kYXRhU2VydmljZS51blNlbGVjdGVkUm93Lm5leHQoe1xyXG4gICAgICAgICAgICAgICAgcm93SW5kZXg6IGluZGV4LFxyXG4gICAgICAgICAgICAgICAgcm93RGF0YTogZGF0YVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdGhpcy5kdC51blNlbGVjdFJvdy5lbWl0KHsgZGF0YSwgaW5kZXggfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGV2ZW50Lm9yaWdpbmFsRXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBpZEZpZWxkKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmR0LmlkRmllbGQ7XHJcbiAgICB9XHJcblxyXG4gICAgaXNTZWxlY3RlZChyb3c6IGFueSwgdHI/OiBhbnkpIHtcclxuICAgICAgICBjb25zdCBpZGZpZWxkID0gdGhpcy5pZEZpZWxkKCk7XHJcbiAgICAgICAgXHJcblxyXG5cclxuICAgICAgICBpZiAodGhpcy5fc2VsZWN0aW9ucykge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5kdC5zaW5nbGVTZWxlY3QpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9zZWxlY3Rpb25zW2lkZmllbGRdID09PSByb3dbaWRmaWVsZF07XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fc2VsZWN0aW9uc1tyb3dbaWRmaWVsZF1dICE9PSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBmb3JtYXREYXRhKGZpZWxkOiBhbnksIGRhdGE6IGFueSwgZm9ybWF0dGVyOiBhbnkpIHtcclxuICAgICAgICBjb25zdCB2YWx1ZSA9IHRoaXMudXRpbHMuZ2V0VmFsdWUoZmllbGQsIGRhdGEsIHRydWUpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNvbEZvcm1hdFNlci5mb3JtYXQodmFsdWUsIGRhdGEsIGZvcm1hdHRlcik7XHJcbiAgICB9XHJcbiAgICAvLyDmt7vliqDoh6rlrprkuYnorr7nva7liJcg5Y2V5YWD5qC857G75qC35byPXHJcbiAgICBnZXRUZENsYXNzTmFtZSh2YWx1ZSwgY29sKSB7XHJcbiAgICAgICAgY29uc3QgdGVtcENsYXNzTmFtZSA9IHt9O1xyXG4gICAgICAgIC8vIOWIl+exu+eahOagt+W8j1xyXG4gICAgICAgIGlmIChcclxuICAgICAgICAgICAgY29sLmNsYXNzTmFtZSAmJlxyXG4gICAgICAgICAgICBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoY29sLmNsYXNzTmFtZSkgPT09ICdbb2JqZWN0IFN0cmluZ10nXHJcbiAgICAgICAgKSB7XHJcbiAgICAgICAgICAgIHRlbXBDbGFzc05hbWVbY29sLmNsYXNzTmFtZV0gPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5jZWxsQ2xhc3NOYW1lICYmIHRoaXMuY2VsbENsYXNzTmFtZSh2YWx1ZSwgY29sKSkge1xyXG4gICAgICAgICAgICB0ZW1wQ2xhc3NOYW1lW3RoaXMuY2VsbENsYXNzTmFtZSh2YWx1ZSwgY29sKV0gPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGVtcENsYXNzTmFtZTtcclxuICAgIH1cclxuICAgIGNyZWF0ZVJvd0NsYXNzTmFtZShyb3csIGluZGV4KSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucm93Q2xhc3NOYW1lID8gdGhpcy5yb3dDbGFzc05hbWUocm93LCBpbmRleCkgOiAnJztcclxuICAgIH1cclxuICAgIG9uQ2VsbENsaWNrKGV2ZW50OiBFdmVudCwgY29sOiBhbnksIHJvdzogYW55KSB7XHJcbiAgICAgICAgdGhpcy5jZWxsQ2xpY2suZW1pdCh7ZXZlbnQsIGNvbCwgcm93fSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVuZGVyUm93U3R5bGUocm93LCBpbmRleCkge1xyXG4gICAgICAgIGlmICh0aGlzLmR0LnJvd1N0eWxlcikge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5kdC5yb3dTdHlsZXIoeyBkYXRhOiByb3csIGluZGV4IH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gJyc7XHJcbiAgICB9XHJcblxyXG4gICAgcmVuZGVyQ2VsbFN0eWxlKHZhbCwgcm93LCBpbmRleCwgY29sKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZHQuY2VsbFN0eWxlcikge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5kdC5jZWxsU3R5bGVyKHsgdmFsdWU6IHZhbCwgZGF0YTogcm93LCBpbmRleCwgY29sLCBmaWVsZDogY29sLmZpZWxkIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gJyc7XHJcbiAgICB9XHJcbn1cclxuIl19