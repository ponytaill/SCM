import { Optional } from '@angular/core';
import { MessagerService } from '@farris/ui-messager';
import { LanguageService } from '../languag.service';
import { DeviceAbility } from '../util/device-ability';
import moment from 'moment';
/**
 * 异常处理基类
 */
export class ExceptionStrategy {
    constructor(messagerService, languageService) {
        this.messagerService = messagerService;
        this.languageService = languageService;
    }
}
/** @nocollapse */
ExceptionStrategy.ctorParameters = () => [
    { type: MessagerService },
    { type: LanguageService, decorators: [{ type: Optional }] }
];
/**
 * 信息级别异常处理
 */
export class InfoExceptionStrategy extends ExceptionStrategy {
    constructor(messagerService, languageService) {
        super(messagerService, languageService);
    }
    handleException(error) {
        if (!error) {
            return;
        }
        this.messagerService.info(error.Message);
    }
}
/** @nocollapse */
InfoExceptionStrategy.ctorParameters = () => [
    { type: MessagerService },
    { type: LanguageService, decorators: [{ type: Optional }] }
];
/**
 * 警告级别异常处理
 */
export class WarningExceptionStrategy extends ExceptionStrategy {
    constructor(messagerService, languageService) {
        super(messagerService, languageService);
    }
    handleException(error) {
        if (!error) {
            return;
        }
        this.messagerService.warning(error.Message);
    }
}
/** @nocollapse */
WarningExceptionStrategy.ctorParameters = () => [
    { type: MessagerService },
    { type: LanguageService, decorators: [{ type: Optional }] }
];
/**
 * 错误级别异常处理
 */
export class ErrorExceptionStrategy extends ExceptionStrategy {
    constructor(messagerService, languageService) {
        super(messagerService, languageService);
        this.langService = null;
        this.langService = languageService;
        if (!this.langService) {
            this.langService = new LanguageService();
        }
    }
    handleException(error) {
        if (!error) {
            return;
        }
        this.handleErrorLevel(error);
    }
    handleErrorLevel(error) {
        const exceptionMsg = error.Message || '';
        const date = error.date || new Date();
        const localDate = moment(date).format('YYYY-MM-DD HH:mm:ss');
        const detail = error.Detail || `${error.Message}\r\n发生时间：${localDate}\r\n详细信息：${error.innerMessage}` || '';
        const innerMessage = error.innerMessage || null;
        let bsModalRef;
        const options = {
            // title: this.languageService.serverNotifyTitle,
            showMaxButton: false,
            buttons: [
                {
                    text: this.langService.roger,
                    cls: 'btn btn-primary btn-lg',
                    handle: () => {
                        bsModalRef.close();
                    }
                }
            ],
            // showHeader: false,
            width: 440,
            height: 200,
            safeHtml: false,
            exception: {
                date: localDate,
                message: innerMessage,
                copyButton: {
                    text: this.langService.copy,
                    onClick: (e) => {
                        const result = DeviceAbility.copyToClipboard(detail);
                        const text = result ? this.langService.copySuccess : this.langService.copyFailed;
                        bsModalRef.content.showMiniNotify(text, 1500);
                    }
                }
            }
        };
        this.displayError(error);
        bsModalRef = this.messagerService.show('exception', exceptionMsg, options);
    }
    /**
     * 在控制台中显示错误信息
     */
    displayError(error) {
        if (!error) {
            return;
        }
        if (!console || !console.error) {
            return;
        }
        console.error(error);
    }
}
/** @nocollapse */
ErrorExceptionStrategy.ctorParameters = () => [
    { type: MessagerService },
    { type: LanguageService, decorators: [{ type: Optional }] }
];
/**
 * 致命错误级别异常处理
 */
export class FatalExceptionStrategy extends ExceptionStrategy {
    constructor(messagerService, languageService) {
        super(messagerService, languageService);
    }
    handleException(error) {
        if (!error) {
            return;
        }
        this.messagerService.error(error.Message);
    }
}
/** @nocollapse */
FatalExceptionStrategy.ctorParameters = () => [
    { type: MessagerService },
    { type: LanguageService, decorators: [{ type: Optional }] }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXhjZXB0aW9uX3N0cmF0ZWd5LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9jb21tYW5kLXNlcnZpY2VzLyIsInNvdXJjZXMiOlsibGliL2Vycm9yL2V4Y2VwdGlvbl9zdHJhdGVneS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3pDLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN0RCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFFckQsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBSXZELE9BQU8sTUFBTSxNQUFNLFFBQVEsQ0FBQztBQVM1Qjs7R0FFRztBQUNILE1BQU0sT0FBTyxpQkFBaUI7SUFDNUIsWUFDUyxlQUFnQyxFQUNwQixlQUFnQztRQUQ1QyxvQkFBZSxHQUFmLGVBQWUsQ0FBaUI7UUFDcEIsb0JBQWUsR0FBZixlQUFlLENBQWlCO0lBQ3JELENBQUM7Ozs7WUF2Qk0sZUFBZTtZQUNmLGVBQWUsdUJBcUJuQixRQUFROztBQUliOztHQUVHO0FBQ0gsTUFBTSxPQUFPLHFCQUFzQixTQUFRLGlCQUFpQjtJQUMxRCxZQUNFLGVBQWdDLEVBQ3BCLGVBQWdDO1FBQzVDLEtBQUssQ0FBQyxlQUFlLEVBQUUsZUFBZSxDQUFDLENBQUM7SUFDMUMsQ0FBQztJQUVNLGVBQWUsQ0FBQyxLQUE0QjtRQUNqRCxJQUFJLENBQUMsS0FBSyxFQUFFO1lBQ1YsT0FBTztTQUNSO1FBRUQsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQzNDLENBQUM7Ozs7WUExQ00sZUFBZTtZQUNmLGVBQWUsdUJBK0JuQixRQUFROztBQWNiOztHQUVHO0FBQ0gsTUFBTSxPQUFPLHdCQUF5QixTQUFRLGlCQUFpQjtJQUM3RCxZQUNFLGVBQWdDLEVBQ3BCLGVBQWdDO1FB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LFdBQVcsRUFBRSxZQUFZLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDN0UsQ0FBQztJQUNEOztPQUVHO0lBQ0ssWUFBWSxDQUFDLEtBQTRCO1FBQy9DLElBQUksQ0FBQyxLQUFLLEVBQUU7WUFDVixPQUFPO1NBQ1I7UUFDRCxJQUFJLENBQUMsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRTtZQUM5QixPQUFPO1NBQ1I7UUFDRCxPQUFPLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3ZCLENBQUM7Ozs7WUE3SU0sZUFBZTtZQUNmLGVBQWUsdUJBd0VuQixRQUFROztBQXVFYjs7R0FFRztBQUNILE1BQU0sT0FBTyxzQkFBdUIsU0FBUSxpQkFBaUI7SUFDM0QsWUFDRSxlQUFnQyxFQUNwQixlQUFnQztRQUM1QyxLQUFLLENBQUMsZUFBZSxFQUFFLGVBQWUsQ0FBQyxDQUFDO0lBQzFDLENBQUM7SUFFTSxlQUFlLENBQUMsS0FBNEI7UUFDakQsSUFBSSxDQUFDLEtBQUssRUFBRTtZQUNWLE9BQU87U0FDUjtRQUVELElBQUksQ0FBQyxlQUFlLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUM1QyxDQUFDOzs7O1lBaEtNLGVBQWU7WUFDZixlQUFlLHVCQXFKbkIsUUFBUSIsInNvdXJjZXNDb250ZW50IjpbIlxuaW1wb3J0IHsgT3B0aW9uYWwgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE1lc3NhZ2VyU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbWVzc2FnZXInO1xuaW1wb3J0IHsgTGFuZ3VhZ2VTZXJ2aWNlIH0gZnJvbSAnLi4vbGFuZ3VhZy5zZXJ2aWNlJztcbmltcG9ydCB7IFNlcnZlckV4Y2VwdGlvbkVudGl0eSB9IGZyb20gJy4vdHlwZXMnO1xuaW1wb3J0IHsgRGV2aWNlQWJpbGl0eSB9IGZyb20gJy4uL3V0aWwvZGV2aWNlLWFiaWxpdHknO1xuaW1wb3J0IHsgQnNNb2RhbFJlZiB9IGZyb20gJ0BmYXJyaXMvdWktbW9kYWwnO1xuaW1wb3J0IHsgRm9ybU5vdGlmeVNlcnZpY2UgfSBmcm9tICcuLi9mb3JtLW5vdGlmeS5zZXJ2aWNlJztcbmltcG9ydCB7IEZyYW1lQ29udGV4dCB9IGZyb20gJ0BmYXJyaXMvZGV2a2l0JztcbmltcG9ydCBtb21lbnQgZnJvbSAnbW9tZW50Jztcbi8qKlxuICog5byC5bi45aSE55CG5o6l5Y+jXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgSUV4Y2VwdGlvblN0cmF0ZWd5IHtcbiAgaGFuZGxlRXhjZXB0aW9uKGVycm9yOiBTZXJ2ZXJFeGNlcHRpb25FbnRpdHkpOiB2b2lkO1xufVxuXG5cbi8qKlxuICog5byC5bi45aSE55CG5Z+657G7XG4gKi9cbmV4cG9ydCBjbGFzcyBFeGNlcHRpb25TdHJhdGVneSB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIHB1YmxpYyBtZXNzYWdlclNlcnZpY2U6IE1lc3NhZ2VyU2VydmljZSxcbiAgICBAT3B0aW9uYWwoKSBwdWJsaWMgbGFuZ3VhZ2VTZXJ2aWNlOiBMYW5ndWFnZVNlcnZpY2UpIHtcbiAgfVxufVxuXG4vKipcbiAqIOS/oeaBr+e6p+WIq+W8guW4uOWkhOeQhlxuICovXG5leHBvcnQgY2xhc3MgSW5mb0V4Y2VwdGlvblN0cmF0ZWd5IGV4dGVuZHMgRXhjZXB0aW9uU3RyYXRlZ3kgaW1wbGVtZW50cyBJRXhjZXB0aW9uU3RyYXRlZ3kge1xuICBjb25zdHJ1Y3RvcihcbiAgICBtZXNzYWdlclNlcnZpY2U6IE1lc3NhZ2VyU2VydmljZSxcbiAgICBAT3B0aW9uYWwoKSBsYW5ndWFnZVNlcnZpY2U6IExhbmd1YWdlU2VydmljZSkge1xuICAgIHN1cGVyKG1lc3NhZ2VyU2VydmljZSwgbGFuZ3VhZ2VTZXJ2aWNlKTtcbiAgfVxuXG4gIHB1YmxpYyBoYW5kbGVFeGNlcHRpb24oZXJyb3I6IFNlcnZlckV4Y2VwdGlvbkVudGl0eSk6IHZvaWQge1xuICAgIGlmICghZXJyb3IpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLm1lc3NhZ2VyU2VydmljZS5pbmZvKGVycm9yLk1lc3NhZ2UpO1xuICB9XG59XG5cblxuLyoqXG4gKiDorablkYrnuqfliKvlvILluLjlpITnkIZcbiAqL1xuZXhwb3J0IGNsYXNzIFdhcm5pbmdFeGNlcHRpb25TdHJhdGVneSBleHRlbmRzIEV4Y2VwdGlvblN0cmF0ZWd5IGltcGxlbWVudHMgSUV4Y2VwdGlvblN0cmF0ZWd5IHtcbiAgY29uc3RydWN0b3IoXG4gICAgbWVzc2FnZXJTZXJ2aWNlOiBNZXNzYWdlclNlcnZpY2UsXG4gICAgQE9wdGlvbmFsKCkgbGFuZ3VhZ2VTZXJ2aWNlOiBMYW5ndWFnZVNlcnZpY2UpIHtcbiAgICBzdXBlcihtZXNzYWdlclNlcnZpY2UsIGxhbmd1YWdlU2VydmljZSk7XG4gIH1cblxuICBwdWJsaWMgaGFuZGxlRXhjZXB0aW9uKGVycm9yOiBTZXJ2ZXJFeGNlcHRpb25FbnRpdHkpOiB2b2lkIHtcbiAgICBpZiAoIWVycm9yKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5tZXNzYWdlclNlcnZpY2Uud2FybmluZyhlcnJvci5NZXNzYWdlKTtcbiAgfVxufVxuXG5cbi8qKlxuICog6ZSZ6K+v57qn5Yir5byC5bi45aSE55CGXG4gKi9cbmV4cG9ydCBjbGFzcyBFcnJvckV4Y2VwdGlvblN0cmF0ZWd5IGV4dGVuZHMgRXhjZXB0aW9uU3RyYXRlZ3kgaW1wbGVtZW50cyBJRXhjZXB0aW9uU3RyYXRlZ3kge1xuICBwcml2YXRlIGxhbmdTZXJ2aWNlOiBMYW5ndWFnZVNlcnZpY2UgPSBudWxsO1xuICBjb25zdHJ1Y3RvcihcbiAgICBtZXNzYWdlclNlcnZpY2U6IE1lc3NhZ2VyU2VydmljZSxcbiAgICBAT3B0aW9uYWwoKSBsYW5ndWFnZVNlcnZpY2U6IExhbmd1YWdlU2VydmljZSkge1xuICAgIHN1cGVyKG1lc3NhZ2VyU2VydmljZSwgbGFuZ3VhZ2VTZXJ2aWNlKTtcbiAgICB0aGlzLmxhbmdTZXJ2aWNlID0gbGFuZ3VhZ2VTZXJ2aWNlO1xuICAgIGlmICghdGhpcy5sYW5nU2VydmljZSkge1xuICAgICAgdGhpcy5sYW5nU2VydmljZSA9IG5ldyBMYW5ndWFnZVNlcnZpY2UoKTtcbiAgICB9XG5cbiAgfVxuXG4gIHB1YmxpYyBoYW5kbGVFeGNlcHRpb24oZXJyb3I6IFNlcnZlckV4Y2VwdGlvbkVudGl0eSk6IHZvaWQge1xuICAgIGlmICghZXJyb3IpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmhhbmRsZUVycm9yTGV2ZWwoZXJyb3IpO1xuICB9XG5cbiAgcHJpdmF0ZSBoYW5kbGVFcnJvckxldmVsKGVycm9yOiBTZXJ2ZXJFeGNlcHRpb25FbnRpdHkpOiB2b2lkIHtcbiAgICBjb25zdCBleGNlcHRpb25Nc2cgPSBlcnJvci5NZXNzYWdlIHx8ICcnO1xuICAgIGNvbnN0IGRhdGUgPSBlcnJvci5kYXRlIHx8IG5ldyBEYXRlKCk7XG4gICAgY29uc3QgbG9jYWxEYXRlID0gbW9tZW50KGRhdGUpLmZvcm1hdCgnWVlZWS1NTS1ERCBISDptbTpzcycpO1xuICAgIGNvbnN0IGRldGFpbCA9IGVycm9yLkRldGFpbCB8fCBgJHtlcnJvci5NZXNzYWdlfVxcclxcbuWPkeeUn+aXtumXtO+8miR7bG9jYWxEYXRlfVxcclxcbuivpue7huS/oeaBr++8miR7ZXJyb3IuaW5uZXJNZXNzYWdlfWAgfHwgJyc7XG5cbiAgICBjb25zdCBpbm5lck1lc3NhZ2UgPSBlcnJvci5pbm5lck1lc3NhZ2UgfHwgbnVsbDtcbiAgICBsZXQgYnNNb2RhbFJlZjogQnNNb2RhbFJlZjtcbiAgICBjb25zdCBvcHRpb25zID0ge1xuICAgICAgLy8gdGl0bGU6IHRoaXMubGFuZ3VhZ2VTZXJ2aWNlLnNlcnZlck5vdGlmeVRpdGxlLFxuICAgICAgc2hvd01heEJ1dHRvbjogZmFsc2UsXG4gICAgICBidXR0b25zOiBbXG4gICAgICAgIHtcbiAgICAgICAgICB0ZXh0OiB0aGlzLmxhbmdTZXJ2aWNlLnJvZ2VyLFxuICAgICAgICAgIGNsczogJ2J0biBidG4tcHJpbWFyeSBidG4tbGcnLFxuICAgICAgICAgIGhhbmRsZTogKCkgPT4ge1xuICAgICAgICAgICAgYnNNb2RhbFJlZi5jbG9zZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgXSxcbiAgICAgIC8vIHNob3dIZWFkZXI6IGZhbHNlLFxuICAgICAgd2lkdGg6IDQ0MCxcbiAgICAgIGhlaWdodDogMjAwLFxuICAgICAgc2FmZUh0bWw6IGZhbHNlLFxuICAgICAgZXhjZXB0aW9uOiB7XG4gICAgICAgIGRhdGU6IGxvY2FsRGF0ZSxcbiAgICAgICAgbWVzc2FnZTogaW5uZXJNZXNzYWdlLFxuICAgICAgICBjb3B5QnV0dG9uOiB7XG4gICAgICAgICAgdGV4dDogdGhpcy5sYW5nU2VydmljZS5jb3B5LFxuICAgICAgICAgIG9uQ2xpY2s6IChlKSA9PiB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBEZXZpY2VBYmlsaXR5LmNvcHlUb0NsaXBib2FyZChkZXRhaWwpO1xuICAgICAgICAgICAgY29uc3QgdGV4dCA9IHJlc3VsdCA/IHRoaXMubGFuZ1NlcnZpY2UuY29weVN1Y2Nlc3MgOiB0aGlzLmxhbmdTZXJ2aWNlLmNvcHlGYWlsZWQ7XG4gICAgICAgICAgICBic01vZGFsUmVmLmNvbnRlbnQuc2hvd01pbmlOb3RpZnkodGV4dCwgMTUwMCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcbiAgICB0aGlzLmRpc3BsYXlFcnJvcihlcnJvcik7XG4gICAgYnNNb2RhbFJlZiA9IHRoaXMubWVzc2FnZXJTZXJ2aWNlLnNob3coJ2V4Y2VwdGlvbicsIGV4Y2VwdGlvbk1zZywgb3B0aW9ucyk7XG4gIH1cbiAgLyoqXG4gICAqIOWcqOaOp+WItuWPsOS4reaYvuekuumUmeivr+S/oeaBr1xuICAgKi9cbiAgcHJpdmF0ZSBkaXNwbGF5RXJyb3IoZXJyb3I6IFNlcnZlckV4Y2VwdGlvbkVudGl0eSkge1xuICAgIGlmICghZXJyb3IpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKCFjb25zb2xlIHx8ICFjb25zb2xlLmVycm9yKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICB9XG59XG5cbi8qKlxuICog6Ie05ZG96ZSZ6K+v57qn5Yir5byC5bi45aSE55CGXG4gKi9cbmV4cG9ydCBjbGFzcyBGYXRhbEV4Y2VwdGlvblN0cmF0ZWd5IGV4dGVuZHMgRXhjZXB0aW9uU3RyYXRlZ3kgaW1wbGVtZW50cyBJRXhjZXB0aW9uU3RyYXRlZ3kge1xuICBjb25zdHJ1Y3RvcihcbiAgICBtZXNzYWdlclNlcnZpY2U6IE1lc3NhZ2VyU2VydmljZSxcbiAgICBAT3B0aW9uYWwoKSBsYW5ndWFnZVNlcnZpY2U6IExhbmd1YWdlU2VydmljZSkge1xuICAgIHN1cGVyKG1lc3NhZ2VyU2VydmljZSwgbGFuZ3VhZ2VTZXJ2aWNlKTtcbiAgfVxuXG4gIHB1YmxpYyBoYW5kbGVFeGNlcHRpb24oZXJyb3I6IFNlcnZlckV4Y2VwdGlvbkVudGl0eSk6IHZvaWQge1xuICAgIGlmICghZXJyb3IpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLm1lc3NhZ2VyU2VydmljZS5lcnJvcihlcnJvci5NZXNzYWdlKTtcbiAgfVxufVxuIl19