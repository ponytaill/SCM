import * as ValidatorJS from 'validator';
import { ValidationTypes } from './validation_types';
import { ValidationExecutor } from './validation_executor';
import { ValidationUtils } from './validation_utils';
import { DateUtil } from '../../utils/date_util';
import { TranslateService } from '../../i18n/translate_service';
import { BigNumber } from 'bignumber.js';
/**
 * 校验实体实例对象数据
 */
export class Validator {
    constructor() {
        this.validatorJs = ValidatorJS.default;
    }
    /**
     * 验证实例对象中数据是否合法
     * @param object 待校验的实例对象
     * @param propertyName 待校验实例对象属性名称，为空则验证实例对象中所有带有验证规则的属性
     */
    // tslint:disable-next-line: max-line-length
    validate(object, propertyName, value, externalRules, index, frameContext) {
        const validationErrors = [];
        const executor = new ValidationExecutor(this);
        executor.execute(object, value, validationErrors, propertyName, index, externalRules, null, frameContext);
        return Promise.all(executor.awaitingPromises).then(() => {
            const errors = executor.stripEmptyErrors(validationErrors);
            this.sortValidationErrors(errors);
            return this.buildErrors(errors);
        });
    }
    /**
     * 校验信息排序（为了兼容树形表）
     * @param validationErrors 验证信息数组
     */
    sortValidationErrors(validationErrors) {
        // 如果存在无序号的信息则不排序
        let sortable = true;
        validationErrors.forEach(info => {
            if (info.children && info.children.length > 1) {
                this.sortValidationErrors(info.children);
            }
            if (typeof info.index !== "number") {
                sortable = false;
            }
        });
        if (sortable) {
            validationErrors.sort((a, b) => a.index - b.index);
        }
    }
    /**
     * 执行校验
     * @param object
     * @param propertyName
     * @param value
     * @param externalRules
     * @param index
     * @param frameContext
     * @param ignoreAsyncValidateRules
     * @returns
     */
    verify(object, propertyName, value, externalRules, index, frameContext, ignoreAsyncValidateRules = false) {
        const validationErrors = [];
        const executor = new ValidationExecutor(this);
        executor.execute(object, value, validationErrors, propertyName, index, externalRules, null, frameContext);
        if (executor.awaitingPromises && executor.awaitingPromises.length > 0 && ignoreAsyncValidateRules === false) {
            return Promise.all(executor.awaitingPromises).then(() => {
                const errors = executor.stripEmptyErrors(validationErrors);
                const result = this.buildErrors(errors);
                return result;
            });
        }
        else {
            const errors = executor.stripEmptyErrors(validationErrors);
            return this.buildErrors(errors);
        }
    }
    /**
     * 验证实体属性元数据中设置的校验规则是否合法
     * @param object 实例对象
     * @param value 待校验的值
     * @param validateRule 验证规则
     */
    validateValueByMetadata(object, value, validateRule, isMultLanguageField, currentRowId) {
        const validType = validateRule.type;
        let constraintsToValidate = [];
        if (validateRule.constraints) {
            constraintsToValidate = validateRule.constraints.map(param => {
                if (typeof param === 'function') {
                    return param(object, value);
                }
                return param;
            });
        }
        else {
            validateRule.constraints = [];
        }
        if (ValidationTypes.isValidType(validType)) {
            if (validType === ValidationTypes.MAXVALUE) {
                const rule = constraintsToValidate[0];
                if (this.isDateString(value) || this.isDate(value) || this.isDateString(rule) || this.isDate(rule)) {
                    // 如果日期值不存在，则不判断大小
                    if (!value) {
                        return true;
                    }
                    if (value.indexOf('~') !== -1) {
                        // 不对日期区间进行校验
                        return true;
                    }
                    return this[ValidationTypes.MAX_DATE](DateUtil.parse(value), isMultLanguageField, new Date(constraintsToValidate[0]));
                }
                else {
                    return this[ValidationTypes.MAXVALUE](value, isMultLanguageField, constraintsToValidate[0]);
                }
            }
            else if (validType === ValidationTypes.MINVALUE) {
                // 如果是null或undefined，直接返回true
                if (constraintsToValidate[0] === null || constraintsToValidate[0] === undefined) {
                    return true;
                }
                if (this.isDateString(value) || this.isDate(value)) {
                    if (constraintsToValidate[0] === 0) {
                        return true;
                    }
                    return this[ValidationTypes.MIN_DATE](DateUtil.parse(value), isMultLanguageField, DateUtil.parse(constraintsToValidate[0]));
                }
                else if (this.isNumber(value)) {
                    return this[ValidationTypes.MIN](value, isMultLanguageField, constraintsToValidate[0]);
                }
            }
            else {
                return this[validType](value, isMultLanguageField, ...constraintsToValidate);
            }
        }
        else {
            if (typeof validateRule.eval === 'function') {
                const bindingPath = validateRule.bindingPath;
                const bindingPaths = bindingPath.split('/').filter(p => p);
                let fieldName = validateRule.field;
                if (bindingPaths.length !== 0) {
                    const prefix = bindingPaths.join('/');
                    fieldName = `${prefix}/${fieldName.split('.').filter(p => p).join('/')}`;
                }
                const options = { patch: { [fieldName]: value } };
                options.currentRows = [];
                const parentEntityListPaths = object && typeof object['getEntityListPath'] === 'function' && object.getEntityListPath();
                if (parentEntityListPaths.length === 4) {
                    const childrenList = parentEntityListPaths.slice(1, 3).reverse();
                    options.currentRows.push({ bindingPath: childrenList[1], primaryValue: childrenList[0].split(':')[1] });
                }
                if (currentRowId) {
                    if (validateRule.bindingPath.split('/').filter(p => p).length !== 0) {
                        const primaryValue = object && typeof object['getMainEntityPrimaryValue'] === 'function' && object.getMainEntityPrimaryValue();
                        options.currentRows.push({ bindingPath: '/', primaryValue: primaryValue });
                    }
                    options.currentRow = { bindingPath: validateRule.bindingPath, primaryValue: currentRowId };
                }
                else {
                    const primaryValue = object && typeof object['getMainEntityPrimaryValue'] === 'function' && object.getMainEntityPrimaryValue();
                    options.currentRows.push({ bindingPath: '/', primaryValue: primaryValue });
                }
                const result = validateRule.eval(options);
                if (validateRule.type === "require" /* Require */) {
                    const isValid = this.required(value, isMultLanguageField);
                    if (result) {
                        return isValid;
                    }
                    else {
                        return true;
                    }
                }
                else {
                    return result;
                }
            }
        }
        return true;
    }
    buildErrors(errors) {
        const msg = new Set(ValidationUtils.createDetailedErrorMessage(errors));
        const newMsg = [];
        msg.forEach(v => {
            newMsg.push(v);
        });
        return {
            isValid: errors.length === 0,
            errors,
            message: newMsg.join('')
        };
    }
    /** 自定义验证 */
    customValidation(value, comparison) {
        return comparison;
    }
    isEmptyValue(value) {
        const result = value === '' || value === null || value === undefined
            || value === '0001-01-01' || value === '0001-01-01 00:00:00' || value === '0001-01-01T00:00:00';
        return result;
    }
    /** 必填项 */
    required(value, isMultLanguageField) {
        if (isMultLanguageField) {
            const currentLanguage = TranslateService.getCurrentLanguage();
            if (Object.keys(value).length < 1) {
                return false;
            }
            // 如果能够获取到当前语言，那么当前语言对应的输入不能为空
            if (currentLanguage) {
                return !!value[currentLanguage];
            }
            // 如果当前语言为空，那么必填要求至少有一个输入
            // const allEmpty = Object.values(value).every((v: any) => !v || v.length < 1); // .filter((v: any) => !v || v.length < 1);
            // if (allEmpty) {
            //   return false;
            // }
            return true;
        }
        if (typeof value === 'object' && value !== null) {
            if (!Object.keys(value).length) {
                return false;
            }
            value = Object.values(value)[0];
        }
        // tslint:disable: max-line-length
        return value !== '' && value !== null && value !== undefined
            && value !== '0001-01-01' && value !== '0001-01-01 00:00:00' && value !== '0001-01-01T00:00:00';
    }
    /** 判断两个值是否相等 */
    equals(value, comparison) {
        return value === comparison;
    }
    /**
     * 检查 value 是否不等于参照值
     * @param value 要检查的值
     * @param comparison 对比参照值
     */
    notEquals(value, comparison) {
        return value !== comparison;
    }
    /**
     * 判断value 是否为数字
     * @param value 要检查的值
     * @param options 验证选项
     */
    isNumber(value, options = {}) {
        if (value === Infinity || value === -Infinity) {
            return options.allowInfinity;
        }
        if (Number.isNaN(value)) {
            return options.allowNaN;
        }
        return Number.isFinite(value);
    }
    /** 判断value是否为整数 */
    isInt(value) {
        return Number.isInteger(value);
    }
    /** 是否为浮点类型 */
    isFloat(value) {
        if (this.isNumber(value) || this.isNumberString(value)) {
            return this.validatorJs.isFloat(value);
        }
        return false;
    }
    /**
     * 检查给定的value 是否布尔值
     */
    isBoolean(value) {
        return value instanceof Boolean || typeof value === 'boolean';
    }
    /**
     * 检查给定的value 是否为字符串
     */
    isString(value) {
        return value instanceof String || typeof value === 'string';
    }
    /**
     * 检查给定的value 是否为日期
     */
    isDate(value) {
        return value instanceof Date && !isNaN(value.getTime());
    }
    /**
     * 检查给定的value 是否为日期字符串
     */
    isDateString(value) {
        const regex = /\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])(T|\s?)?(([0-2]\d:[0-5]\d)?(:[0-5]\d(?:\.\d+)))?(?:Z|\+[0-2]\d(?:\:[0-5]\d)?)?/g;
        return this.isString(value) && regex.test(value) && this.validatorJs.toDate(value);
    }
    /** 判断value 的长度是否在允许的最小值 和最大值之间 */
    length(value, min, max, isMultLanguageField) {
        return typeof value === 'string' && this.validatorJs.isLength(value, min, max);
    }
    /**
     * 检查给定的value的长度是否符合设定的最小值
     * @param value 待检查的字符串
     * @param min 最小长度
     */
    minLength(value, isMultLanguageField, min) {
        if (isMultLanguageField) {
            // const currentLanguage = TranslateService.getCurrentLanguage();
            if (typeof value === 'object') {
                const hasInvalidLangs = Object.values(value).filter((v) => v && v.length < min);
                if (hasInvalidLangs && hasInvalidLangs.length > 0) {
                    return false;
                }
            }
            // if (currentLanguage) {
            //   return value[currentLanguage] ? value[currentLanguage].length > min : true;
            // }
            // 如果无法获取当前语言，则只要有一种语言的输入长度大于最小长度即可。
            // const hasValidLangs = Object.values(value).filter((v: any) => v && v.length > min);
            // if (hasValidLangs.length > 0) {
            //   return true;
            // }
            // return false;
            return true;
        }
        if (value && typeof value !== 'string') {
            value = value.toString();
        }
        return !value || (typeof value === 'string' && this.length(value, min));
    }
    /**
     * 检查给定的value的长度是否符合设定的最大值
     * @param value 待检查的字符串
     * @param max 最大长度
     */
    maxLength(value, isMultLanguageField, max) {
        if (isMultLanguageField) {
            // const currentLanguage = TranslateService.getCurrentLanguage();
            // if (currentLanguage) {
            //   return value[currentLanguage] ? value[currentLanguage].length < max : true;
            // }
            if (typeof value === 'object') {
                const hasInvalidLangs = Object.values(value).filter((v) => v && v.length > max);
                if (hasInvalidLangs.length > 0) {
                    return false;
                }
            }
            return true;
        }
        if (typeof value === 'object') {
            for (const key in value) {
                if (value.hasOwnProperty(key)) {
                    const element = value[key];
                    if (typeof element === 'string' && !this.length(value[key], 0, max)) {
                        return false;
                    }
                }
            }
            return true;
        }
        if (value && typeof value !== 'string') {
            value = value.toString();
        }
        return !value || (typeof value === 'string' && this.length(value, 0, max));
    }
    /** 检查value的值是否在 最大值与最小值之间 */
    range(value, isMultLanguageField, min, max) {
        return typeof value === 'number' && this.isNumber(min) && this.isNumber(max) && value >= min && value <= max;
    }
    /**
     * 日期类型的值是否在某个区间
     * @param value value
     * @param min 最小值
     * @param max 最大值
     */
    dateRange(value, isMultLanguageField, rule, type) {
        // 2010~2020|04~05|03 11:00:00~05 12:00:00
        if (!value) {
            return true;
        }
        if (type === 'maxValue' || type === 'maxDate') {
            if (this.isYearRange(value) || this.isMonthOrDayRange(value)) {
                return this.maxValue(parseInt(this.getRangeValue(value, 1)), isMultLanguageField, parseInt(rule.split(' ')[0]));
            }
            else if (this.isDayTimeRange(value)) {
                return true;
            }
        }
        else if (type === 'minValue' || type === 'minDate') {
            if (this.isYearRange(value) || this.isMonthOrDayRange(value)) {
                return this.maxValue(parseInt(this.getRangeValue(value, 0)), isMultLanguageField, parseInt(rule.split(' ')[0]));
            }
            else if (this.isDayTimeRange(value)) {
                return true;
            }
        }
        return false;
    }
    getRangeValue(value, position, splitor = '~') {
        return value.split(splitor)[position];
    }
    isDateRange(value) {
        if (typeof value !== 'string') {
            value = value.toString();
        }
        return /(\d{4}|\d{2})/.test(value);
    }
    /**
     * 是否年度区间
     * @param value value
     */
    isYearRange(value) {
        if (typeof value !== 'string') {
            value = value.toString();
        }
        return /^\d{4}~\d{4}$/.test(value);
    }
    /**
     * 是否为年月区间
     * @param value value
     */
    isYearMonthRange(value) {
        if (typeof value !== 'string') {
            value = value.toString();
        }
        return /^\d{4}-\d{2}~\d{4}-\d{2}$/.test(value);
    }
    /**
     * 是否为月或天的区间
     * @param value value
     */
    isMonthOrDayRange(value) {
        if (typeof value !== 'string') {
            value = value.toString();
        }
        return /^[0|1|2|3]\d{1}~[0|1|2|3]\d{1}$/.test(value);
    }
    /**
     * 是否为天+时间的区间
     * @param value value
     */
    isDayTimeRange(value) {
        if (typeof value !== 'string') {
            value = value.toString();
        }
        return /^[0|1|2|3]\d{1} \d{2}:\d{2}:\d{2}~[0|1|2|3]\d{1} \d{2}:\d{2}:\d{2}$/.test(value);
    }
    /**
     * Checks if the first number is greater than second.
     */
    min(num, isMultLanguageField, min) {
        return typeof num === 'number' && typeof min === 'number' && num >= min;
    }
    /**
     * 最小值验证
     */
    minValue(num, isMultLanguageField, min) {
        // 如果值不存在，则不进行最小值的判断
        if (num === null || num === undefined) {
            return true;
        }
        // 按照大数处理
        if (typeof num === 'string' && num.match(/^(-?\d+)(\.\d+)?$/g)) {
            const value = new BigNumber(num);
            const maxValue = new BigNumber(min);
            return value.isGreaterThanOrEqualTo(maxValue);
        }
        return typeof num === 'number' && typeof min === 'number' && num >= min;
    }
    /**
     * Checks if the first number is less than second.
     */
    max(num, isMultLanguageField, max) {
        // 如果值不存在，则不进行最小值的判断
        if (num === null || num === undefined) {
            return true;
        }
        return typeof num === 'number' && typeof max === 'number' && num <= max;
    }
    /**
     * 最大值验证
     */
    maxValue(num, isMultLanguageField, max) {
        // 如果值不存在，则不进行最小值的判断
        if (num === null || num === undefined) {
            return true;
        }
        // 按照大数处理
        if (typeof num === 'string' && num.match(/^(-?\d+)(\.\d+)?$/g)) {
            const value = new BigNumber(num);
            const maxValue = new BigNumber(max);
            return value.isLessThanOrEqualTo(maxValue);
        }
        return typeof num === 'number' && typeof max === 'number' && num <= max;
    }
    /**
     * Checks if the value is a date that's after the specified date.
     */
    minDate(date, isMultLanguageField, minDate) {
        if (!date) {
            return true;
        }
        return date && date.getTime() >= minDate.getTime();
    }
    /**
     * Checks if the value is a date that's before the specified date.
     */
    maxDate(date, isMultLanguageField, maxDate) {
        // 如果值不存在，则不进行最小值的判断
        if (date === null || date === undefined) {
            return true;
        }
        return date && date.getTime() <= maxDate.getTime();
    }
    /**
     * Checks if a string is a boolean.
     * If given value is not a string, then it returns false.
     */
    isBooleanString(value) {
        return typeof value === 'string' && this.validatorJs.isBoolean(value);
    }
    /**
     * Checks if the string is numeric.
     * If given value is not a string, then it returns false.
     */
    isNumberString(value) {
        return typeof value === 'string' && this.validatorJs.isNumeric(value);
    }
    /**
     * Checks if the string contains the seed.
     * If given value is not a string, then it returns false.
     */
    contains(value, isMultLanguageField, seed) {
        return typeof value === 'string' && this.validatorJs.contains(value, seed);
    }
    /**
     * Checks if the string does not contain the seed.
     * If given value is not a string, then it returns false.
     */
    notContains(value, isMultLanguageField, seed) {
        return typeof value === 'string' && !this.validatorJs.contains(value, seed);
    }
    /**
     * Checks if the string is an email.
     * If given value is not a string, then it returns false.
     */
    isEmail(value) {
        return typeof value === 'string' && this.validatorJs.isEmail(value);
    }
    /**
     * Checks if the string is valid JSON (note: uses JSON.parse).
     * If given value is not a string, then it returns false.
     */
    isJSON(value) {
        return typeof value === 'string' && this.validatorJs.isJSON(value);
    }
    /**
     * Checks if the string is lowercase.
     * If given value is not a string, then it returns false.
     */
    isLowercase(value) {
        return typeof value === 'string' && this.validatorJs.isLowercase(value);
    }
    /**
     * Checks if the string is uppercase.
     * If given value is not a string, then it returns false.
     */
    isUppercase(value) {
        return typeof value === 'string' && this.validatorJs.isUppercase(value);
    }
    /**
     * 验证字符串是否包含非法字符
     * @param value 验证的字符串
     * @param someChars 非法字符。如：#￥%@$
     */
    exclude(value, isMultLanguageField, someChars) {
        const arrChar = someChars.split('');
        let counter = 0;
        arrChar.forEach(val => {
            if (this.contains(value, isMultLanguageField, val)) {
                counter++;
            }
        });
        return counter === 0;
    }
    /**
     * 自定义正则验证
     * @param value 待验证的字符串
     * @param pattern 正则表达式
     */
    matches(value, isMultLanguageField, pattern) {
        value = (value === null || value === undefined) ? '' : value.toString();
        if (value === '') {
            return true;
        }
        return this.validatorJs.matches(value, pattern);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmFsaWRhdG9yLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9kZXZraXQvIiwic291cmNlcyI6WyJsaWIvZW50aXR5L3ZhbGlkYXRvci92YWxpZGF0b3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxLQUFLLFdBQVcsTUFBTSxXQUFXLENBQUM7QUFFekMsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBR3JELE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQzNELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUNyRCxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDakQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFDaEUsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUl6Qzs7R0FFRztBQUNILE1BQU0sT0FBTyxTQUFTO0lBQ3BCO1FBRVEsZ0JBQVcsR0FBRyxXQUFXLENBQUMsT0FBTyxDQUFDO0lBRjFCLENBQUM7SUFHakI7Ozs7T0FJRztJQUNILDRDQUE0QztJQUM1QyxRQUFRLENBQUMsTUFBUyxFQUFFLFlBQXFCLEVBQUUsS0FBTSxFQUFFLGFBQTJDLEVBQUUsS0FBYyxFQUFFLFlBQTJCO1FBQ3pJLE1BQU0sZ0JBQWdCLEdBQXNCLEVBQUUsQ0FBQztRQUMvQyxNQUFNLFFBQVEsR0FBRyxJQUFJLGtCQUFrQixDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzlDLFFBQVEsQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFLEtBQUssRUFBRSxnQkFBZ0IsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFFLGFBQWEsRUFBRSxJQUFJLEVBQUUsWUFBWSxDQUFDLENBQUM7UUFDMUcsT0FBTyxPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUU7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T0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDbEQsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgVmFsaWRhdG9ySlMgZnJvbSAndmFsaWRhdG9yJztcclxuaW1wb3J0IHsgVmFsaWRhdGVSdWxlLCBJc051bWJlck9wdGlvbnMsIFZhbGlkYXRpb25SZXN1bHQgfSBmcm9tICcuL3R5cGVzJztcclxuaW1wb3J0IHsgVmFsaWRhdGlvblR5cGVzIH0gZnJvbSAnLi92YWxpZGF0aW9uX3R5cGVzJztcclxuaW1wb3J0IHsgVmFsaWRhdGlvbkVycm9yIH0gZnJvbSAnLi92YWxpZGF0aW9uX2Vycm9yJztcclxuaW1wb3J0IHsgRW50aXR5IH0gZnJvbSAnLi4vZW50aXR5JztcclxuaW1wb3J0IHsgVmFsaWRhdGlvbkV4ZWN1dG9yIH0gZnJvbSAnLi92YWxpZGF0aW9uX2V4ZWN1dG9yJztcclxuaW1wb3J0IHsgVmFsaWRhdGlvblV0aWxzIH0gZnJvbSAnLi92YWxpZGF0aW9uX3V0aWxzJztcclxuaW1wb3J0IHsgRGF0ZVV0aWwgfSBmcm9tICcuLi8uLi91dGlscy9kYXRlX3V0aWwnO1xyXG5pbXBvcnQgeyBUcmFuc2xhdGVTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vaTE4bi90cmFuc2xhdGVfc2VydmljZSc7XHJcbmltcG9ydCB7IEJpZ051bWJlciB9IGZyb20gJ2JpZ251bWJlci5qcyc7XHJcbmltcG9ydCB7IFJ1bGVUeXBlIH0gZnJvbSAnLi4vLi4vZm9ybS9pbmRleCc7XHJcbmltcG9ydCB7IEZyYW1lQ29udGV4dCB9IGZyb20gJy4uLy4uL2ZyYW1lL2luZGV4JztcclxuXHJcbi8qKlxyXG4gKiDmoKHpqozlrp7kvZPlrp7kvovlr7nosaHmlbDmja5cclxuICovXHJcbmV4cG9ydCBjbGFzcyBWYWxpZGF0b3I8VCBleHRlbmRzIEVudGl0eT4ge1xyXG4gIGNvbnN0cnVjdG9yKCkgeyB9XHJcblxyXG4gIHByaXZhdGUgdmFsaWRhdG9ySnMgPSBWYWxpZGF0b3JKUy5kZWZhdWx0O1xyXG4gIC8qKlxyXG4gICAqIOmqjOivgeWunuS+i+WvueixoeS4reaVsOaNruaYr+WQpuWQiOazlVxyXG4gICAqIEBwYXJhbSBvYmplY3Qg5b6F5qCh6aqM55qE5a6e5L6L5a+56LGhXHJcbiAgICogQHBhcmFtIHByb3BlcnR5TmFtZSDlvoXmoKHpqozlrp7kvovlr7nosaHlsZ7mgKflkI3np7DvvIzkuLrnqbrliJnpqozor4Hlrp7kvovlr7nosaHkuK3miYDmnInluKbmnInpqozor4Hop4TliJnnmoTlsZ7mgKdcclxuICAgKi9cclxuICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IG1heC1saW5lLWxlbmd0aFxyXG4gIHZhbGlkYXRlKG9iamVjdDogVCwgcHJvcGVydHlOYW1lPzogc3RyaW5nLCB2YWx1ZT8sIGV4dGVybmFsUnVsZXM/OiBNYXA8c3RyaW5nLCBWYWxpZGF0ZVJ1bGVbXT4sIGluZGV4PzogbnVtYmVyLCBmcmFtZUNvbnRleHQ/OiBGcmFtZUNvbnRleHQpOiBQcm9taXNlPFZhbGlkYXRpb25SZXN1bHQ+IHtcclxuICAgIGNvbnN0IHZhbGlkYXRpb25FcnJvcnM6IFZhbGlkYXRpb25FcnJvcltdID0gW107XHJcbiAgICBjb25zdCBleGVjdXRvciA9IG5ldyBWYWxpZGF0aW9uRXhlY3V0b3IodGhpcyk7XHJcbiAgICBleGVjdXRvci5leGVjdXRlKG9iamVjdCwgdmFsdWUsIHZhbGlkYXRpb25FcnJvcnMsIHByb3BlcnR5TmFtZSwgaW5kZXgsIGV4dGVybmFsUnVsZXMsIG51bGwsIGZyYW1lQ29udGV4dCk7XHJcbiAgICByZXR1cm4gUHJvbWlzZS5hbGwoZXhlY3V0b3IuYXdhaXRpbmdQcm9taXNlcykudGhlbigoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGVycm9ycyA9IGV4ZWN1dG9yLnN0cmlwRW1wdHlFcnJvcnModmFsaWRhdGlvbkVycm9ycyk7XHJcbiAgICAgIHRoaXMuc29ydFZhbGlkYXRpb25FcnJvcnMoZXJyb3JzKTtcclxuICAgICAgcmV0dXJuIHRoaXMuYnVpbGRFcnJvcnMoZXJyb3JzKTtcclxuICAgIH0pO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmoKHpqozkv6Hmga/mjpLluo/vvIjkuLrkuoblhbzlrrnmoJHlvaLooajvvIlcclxuICAgKiBAcGFyYW0gdmFsaWRhdGlvbkVycm9ycyDpqozor4Hkv6Hmga/mlbDnu4RcclxuICAgKi9cclxuICBwcml2YXRlIHNvcnRWYWxpZGF0aW9uRXJyb3JzKHZhbGlkYXRpb25FcnJvcnM6IFZhbGlkYXRpb25FcnJvcltdKSB7XHJcbiAgICAvLyDlpoLmnpzlrZjlnKjml6Dluo/lj7fnmoTkv6Hmga/liJnkuI3mjpLluo9cclxuICAgIGxldCBzb3J0YWJsZTogYm9vbGVhbiA9IHRydWU7XHJcbiAgICB2YWxpZGF0aW9uRXJyb3JzLmZvckVhY2goaW5mbyA9PiB7XHJcbiAgICAgIGlmIChpbmZvLmNoaWxkcmVuICYmIGluZm8uY2hpbGRyZW4ubGVuZ3RoID4gMSkge1xyXG4gICAgICAgIHRoaXMuc29ydFZhbGlkYXRpb25FcnJvcnMoaW5mby5jaGlsZHJlbik7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKHR5cGVvZiBpbmZvLmluZGV4ICE9PSBcIm51bWJlclwiKSB7XHJcbiAgICAgICAgc29ydGFibGUgPSBmYWxzZTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICBpZiAoc29ydGFibGUpIHtcclxuICAgICAgdmFsaWRhdGlvbkVycm9ycy5zb3J0KChhLCBiKSA9PiBhLmluZGV4IC0gYi5pbmRleCk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOaJp+ihjOagoemqjFxyXG4gICAqIEBwYXJhbSBvYmplY3QgXHJcbiAgICogQHBhcmFtIHByb3BlcnR5TmFtZSBcclxuICAgKiBAcGFyYW0gdmFsdWUgXHJcbiAgICogQHBhcmFtIGV4dGVybmFsUnVsZXMgXHJcbiAgICogQHBhcmFtIGluZGV4IFxyXG4gICAqIEBwYXJhbSBmcmFtZUNvbnRleHQgXHJcbiAgICogQHBhcmFtIGlnbm9yZUFzeW5jVmFsaWRhdGVSdWxlc1xyXG4gICAqIEByZXR1cm5zIFxyXG4gICAqL1xyXG4gIHB1YmxpYyB2ZXJpZnkob2JqZWN0OiBULCBwcm9wZXJ0eU5hbWU/OiBzdHJpbmcsIHZhbHVlPywgZXh0ZXJuYWxSdWxlcz86IE1hcDxzdHJpbmcsIFZhbGlkYXRlUnVsZVtdPiwgaW5kZXg/OiBudW1iZXIsIGZyYW1lQ29udGV4dD86IEZyYW1lQ29udGV4dCwgaWdub3JlQXN5bmNWYWxpZGF0ZVJ1bGVzOiBib29sZWFuID0gZmFsc2UpOiBQcm9taXNlPFZhbGlkYXRpb25SZXN1bHQ+IHwgeyBpc1ZhbGlkOiBib29sZWFuLCBlcnJvcnM6IGFueSwgbWVzc2FnZTogc3RyaW5nIH0ge1xyXG4gICAgY29uc3QgdmFsaWRhdGlvbkVycm9yczogVmFsaWRhdGlvbkVycm9yW10gPSBbXTtcclxuICAgIGNvbnN0IGV4ZWN1dG9yID0gbmV3IFZhbGlkYXRpb25FeGVjdXRvcih0aGlzKTtcclxuICAgIGV4ZWN1dG9yLmV4ZWN1dGUob2JqZWN0LCB2YWx1ZSwgdmFsaWRhdGlvbkVycm9ycywgcHJvcGVydHlOYW1lLCBpbmRleCwgZXh0ZXJuYWxSdWxlcywgbnVsbCwgZnJhbWVDb250ZXh0KTtcclxuICAgIGlmIChleGVjdXRvci5hd2FpdGluZ1Byb21pc2VzICYmIGV4ZWN1dG9yLmF3YWl0aW5nUHJvbWlzZXMubGVuZ3RoID4gMCAmJiBpZ25vcmVBc3luY1ZhbGlkYXRlUnVsZXMgPT09IGZhbHNlKSB7XHJcbiAgICAgIHJldHVybiBQcm9taXNlLmFsbChleGVjdXRvci5hd2FpdGluZ1Byb21pc2VzKS50aGVuKCgpID0+IHtcclxuICAgICAgICBjb25zdCBlcnJvcnMgPSBleGVjdXRvci5zdHJpcEVtcHR5RXJyb3JzKHZhbGlkYXRpb25FcnJvcnMpO1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMuYnVpbGRFcnJvcnMoZXJyb3JzKTtcclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICB9KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnN0IGVycm9ycyA9IGV4ZWN1dG9yLnN0cmlwRW1wdHlFcnJvcnModmFsaWRhdGlvbkVycm9ycyk7XHJcbiAgICAgIHJldHVybiB0aGlzLmJ1aWxkRXJyb3JzKGVycm9ycyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDpqozor4Hlrp7kvZPlsZ7mgKflhYPmlbDmja7kuK3orr7nva7nmoTmoKHpqozop4TliJnmmK/lkKblkIjms5VcclxuICAgKiBAcGFyYW0gb2JqZWN0IOWunuS+i+WvueixoVxyXG4gICAqIEBwYXJhbSB2YWx1ZSDlvoXmoKHpqoznmoTlgLxcclxuICAgKiBAcGFyYW0gdmFsaWRhdGVSdWxlIOmqjOivgeinhOWImVxyXG4gICAqL1xyXG4gIHZhbGlkYXRlVmFsdWVCeU1ldGFkYXRhKG9iamVjdDogYW55LCB2YWx1ZTogYW55LCB2YWxpZGF0ZVJ1bGU6IFZhbGlkYXRlUnVsZSwgaXNNdWx0TGFuZ3VhZ2VGaWVsZD86IGJvb2xlYW4sIGN1cnJlbnRSb3dJZD86IHN0cmluZyk6IGJvb2xlYW4gfCBhbnkge1xyXG4gICAgY29uc3QgdmFsaWRUeXBlID0gdmFsaWRhdGVSdWxlLnR5cGU7XHJcbiAgICBsZXQgY29uc3RyYWludHNUb1ZhbGlkYXRlID0gW107XHJcbiAgICBpZiAodmFsaWRhdGVSdWxlLmNvbnN0cmFpbnRzKSB7XHJcbiAgICAgIGNvbnN0cmFpbnRzVG9WYWxpZGF0ZSA9IHZhbGlkYXRlUnVsZS5jb25zdHJhaW50cy5tYXAocGFyYW0gPT4ge1xyXG4gICAgICAgIGlmICh0eXBlb2YgcGFyYW0gPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgIHJldHVybiBwYXJhbShvYmplY3QsIHZhbHVlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHBhcmFtO1xyXG4gICAgICB9KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHZhbGlkYXRlUnVsZS5jb25zdHJhaW50cyA9IFtdO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChWYWxpZGF0aW9uVHlwZXMuaXNWYWxpZFR5cGUodmFsaWRUeXBlKSkge1xyXG4gICAgICBpZiAodmFsaWRUeXBlID09PSBWYWxpZGF0aW9uVHlwZXMuTUFYVkFMVUUpIHtcclxuICAgICAgICBjb25zdCBydWxlID0gY29uc3RyYWludHNUb1ZhbGlkYXRlWzBdO1xyXG4gICAgICAgIGlmICh0aGlzLmlzRGF0ZVN0cmluZyh2YWx1ZSkgfHwgdGhpcy5pc0RhdGUodmFsdWUpIHx8IHRoaXMuaXNEYXRlU3RyaW5nKHJ1bGUpIHx8IHRoaXMuaXNEYXRlKHJ1bGUpKSB7XHJcbiAgICAgICAgICAvLyDlpoLmnpzml6XmnJ/lgLzkuI3lrZjlnKjvvIzliJnkuI3liKTmlq3lpKflsI9cclxuICAgICAgICAgIGlmICghdmFsdWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBpZiAodmFsdWUuaW5kZXhPZignficpICE9PSAtMSkge1xyXG4gICAgICAgICAgICAvLyDkuI3lr7nml6XmnJ/ljLrpl7Tov5vooYzmoKHpqoxcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICByZXR1cm4gdGhpc1tWYWxpZGF0aW9uVHlwZXMuTUFYX0RBVEVdKERhdGVVdGlsLnBhcnNlKHZhbHVlKSwgaXNNdWx0TGFuZ3VhZ2VGaWVsZCwgbmV3IERhdGUoY29uc3RyYWludHNUb1ZhbGlkYXRlWzBdKSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHJldHVybiB0aGlzW1ZhbGlkYXRpb25UeXBlcy5NQVhWQUxVRV0odmFsdWUsIGlzTXVsdExhbmd1YWdlRmllbGQsIGNvbnN0cmFpbnRzVG9WYWxpZGF0ZVswXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2UgaWYgKHZhbGlkVHlwZSA9PT0gVmFsaWRhdGlvblR5cGVzLk1JTlZBTFVFKSB7XHJcbiAgICAgICAgLy8g5aaC5p6c5pivbnVsbOaIlnVuZGVmaW5lZO+8jOebtOaOpei/lOWbnnRydWVcclxuICAgICAgICBpZiAoY29uc3RyYWludHNUb1ZhbGlkYXRlWzBdID09PSBudWxsIHx8IGNvbnN0cmFpbnRzVG9WYWxpZGF0ZVswXSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuaXNEYXRlU3RyaW5nKHZhbHVlKSB8fCB0aGlzLmlzRGF0ZSh2YWx1ZSkpIHtcclxuICAgICAgICAgIGlmIChjb25zdHJhaW50c1RvVmFsaWRhdGVbMF0gPT09IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICByZXR1cm4gdGhpc1tWYWxpZGF0aW9uVHlwZXMuTUlOX0RBVEVdKERhdGVVdGlsLnBhcnNlKHZhbHVlKSwgaXNNdWx0TGFuZ3VhZ2VGaWVsZCwgRGF0ZVV0aWwucGFyc2UoY29uc3RyYWludHNUb1ZhbGlkYXRlWzBdKSk7XHJcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmlzTnVtYmVyKHZhbHVlKSkge1xyXG4gICAgICAgICAgcmV0dXJuIHRoaXNbVmFsaWRhdGlvblR5cGVzLk1JTl0odmFsdWUsIGlzTXVsdExhbmd1YWdlRmllbGQsIGNvbnN0cmFpbnRzVG9WYWxpZGF0ZVswXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJldHVybiB0aGlzW3ZhbGlkVHlwZV0odmFsdWUsIGlzTXVsdExhbmd1YWdlRmllbGQsIC4uLmNvbnN0cmFpbnRzVG9WYWxpZGF0ZSk7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGlmICh0eXBlb2YgdmFsaWRhdGVSdWxlLmV2YWwgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICBjb25zdCBiaW5kaW5nUGF0aCA9IHZhbGlkYXRlUnVsZS5iaW5kaW5nUGF0aDtcclxuICAgICAgICBjb25zdCBiaW5kaW5nUGF0aHMgPSBiaW5kaW5nUGF0aC5zcGxpdCgnLycpLmZpbHRlcihwID0+IHApO1xyXG4gICAgICAgIGxldCBmaWVsZE5hbWUgPSB2YWxpZGF0ZVJ1bGUuZmllbGQ7XHJcbiAgICAgICAgaWYgKGJpbmRpbmdQYXRocy5sZW5ndGggIT09IDApIHtcclxuICAgICAgICAgIGNvbnN0IHByZWZpeCA9IGJpbmRpbmdQYXRocy5qb2luKCcvJyk7XHJcbiAgICAgICAgICBmaWVsZE5hbWUgPSBgJHtwcmVmaXh9LyR7ZmllbGROYW1lLnNwbGl0KCcuJykuZmlsdGVyKHAgPT4gcCkuam9pbignLycpfWA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IG9wdGlvbnM6IGFueSA9IHsgcGF0Y2g6IHsgW2ZpZWxkTmFtZV06IHZhbHVlIH0gfTtcclxuICAgICAgICBvcHRpb25zLmN1cnJlbnRSb3dzID0gW107XHJcbiAgICAgICAgY29uc3QgcGFyZW50RW50aXR5TGlzdFBhdGhzOiBzdHJpbmdbXSA9IG9iamVjdCAmJiB0eXBlb2Ygb2JqZWN0WydnZXRFbnRpdHlMaXN0UGF0aCddID09PSAnZnVuY3Rpb24nICYmIG9iamVjdC5nZXRFbnRpdHlMaXN0UGF0aCgpO1xyXG4gICAgICAgIGlmIChwYXJlbnRFbnRpdHlMaXN0UGF0aHMubGVuZ3RoID09PSA0KSB7XHJcbiAgICAgICAgICBjb25zdCBjaGlsZHJlbkxpc3QgPSBwYXJlbnRFbnRpdHlMaXN0UGF0aHMuc2xpY2UoMSwgMykucmV2ZXJzZSgpO1xyXG4gICAgICAgICAgb3B0aW9ucy5jdXJyZW50Um93cy5wdXNoKHsgYmluZGluZ1BhdGg6IGNoaWxkcmVuTGlzdFsxXSwgcHJpbWFyeVZhbHVlOiBjaGlsZHJlbkxpc3RbMF0uc3BsaXQoJzonKVsxXSB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGN1cnJlbnRSb3dJZCkge1xyXG4gICAgICAgICAgaWYgKHZhbGlkYXRlUnVsZS5iaW5kaW5nUGF0aC5zcGxpdCgnLycpLmZpbHRlcihwID0+IHApLmxlbmd0aCAhPT0gMCkge1xyXG4gICAgICAgICAgICBjb25zdCBwcmltYXJ5VmFsdWUgPSBvYmplY3QgJiYgdHlwZW9mIG9iamVjdFsnZ2V0TWFpbkVudGl0eVByaW1hcnlWYWx1ZSddID09PSAnZnVuY3Rpb24nICYmIG9iamVjdC5nZXRNYWluRW50aXR5UHJpbWFyeVZhbHVlKCk7XHJcbiAgICAgICAgICAgIG9wdGlvbnMuY3VycmVudFJvd3MucHVzaCh7IGJpbmRpbmdQYXRoOiAnLycsIHByaW1hcnlWYWx1ZTogcHJpbWFyeVZhbHVlIH0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgb3B0aW9ucy5jdXJyZW50Um93ID0geyBiaW5kaW5nUGF0aDogdmFsaWRhdGVSdWxlLmJpbmRpbmdQYXRoLCBwcmltYXJ5VmFsdWU6IGN1cnJlbnRSb3dJZCB9O1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBjb25zdCBwcmltYXJ5VmFsdWUgPSBvYmplY3QgJiYgdHlwZW9mIG9iamVjdFsnZ2V0TWFpbkVudGl0eVByaW1hcnlWYWx1ZSddID09PSAnZnVuY3Rpb24nICYmIG9iamVjdC5nZXRNYWluRW50aXR5UHJpbWFyeVZhbHVlKCk7XHJcbiAgICAgICAgICBvcHRpb25zLmN1cnJlbnRSb3dzLnB1c2goeyBiaW5kaW5nUGF0aDogJy8nLCBwcmltYXJ5VmFsdWU6IHByaW1hcnlWYWx1ZSB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IHZhbGlkYXRlUnVsZS5ldmFsKG9wdGlvbnMpO1xyXG4gICAgICAgIGlmICh2YWxpZGF0ZVJ1bGUudHlwZSA9PT0gUnVsZVR5cGUuUmVxdWlyZSkge1xyXG4gICAgICAgICAgY29uc3QgaXNWYWxpZCA9IHRoaXMucmVxdWlyZWQodmFsdWUsIGlzTXVsdExhbmd1YWdlRmllbGQpO1xyXG4gICAgICAgICAgaWYgKHJlc3VsdCkge1xyXG4gICAgICAgICAgICByZXR1cm4gaXNWYWxpZDtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB0cnVlO1xyXG4gIH1cclxuICBwcml2YXRlIGJ1aWxkRXJyb3JzKGVycm9yczogVmFsaWRhdGlvbkVycm9yW10pIHtcclxuICAgIGNvbnN0IG1zZyA9IG5ldyBTZXQoVmFsaWRhdGlvblV0aWxzLmNyZWF0ZURldGFpbGVkRXJyb3JNZXNzYWdlKGVycm9ycykpO1xyXG4gICAgY29uc3QgbmV3TXNnID0gW107XHJcbiAgICBtc2cuZm9yRWFjaCh2ID0+IHtcclxuICAgICAgbmV3TXNnLnB1c2godik7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIGlzVmFsaWQ6IGVycm9ycy5sZW5ndGggPT09IDAsXHJcbiAgICAgIGVycm9ycyxcclxuICAgICAgbWVzc2FnZTogbmV3TXNnLmpvaW4oJycpXHJcbiAgICB9O1xyXG4gIH1cclxuICAvKiog6Ieq5a6a5LmJ6aqM6K+BICovXHJcbiAgY3VzdG9tVmFsaWRhdGlvbih2YWx1ZSwgY29tcGFyaXNvbjogYm9vbGVhbik6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIGNvbXBhcmlzb247XHJcbiAgfVxyXG4gIHByaXZhdGUgaXNFbXB0eVZhbHVlKHZhbHVlOiBhbnkpIHtcclxuICAgIGNvbnN0IHJlc3VsdCA9IHZhbHVlID09PSAnJyB8fCB2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkXHJcbiAgICAgIHx8IHZhbHVlID09PSAnMDAwMS0wMS0wMScgfHwgdmFsdWUgPT09ICcwMDAxLTAxLTAxIDAwOjAwOjAwJyB8fCB2YWx1ZSA9PT0gJzAwMDEtMDEtMDFUMDA6MDA6MDAnO1xyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxuICB9XHJcbiAgLyoqIOW/heWhq+mhuSAqL1xyXG4gIHJlcXVpcmVkKHZhbHVlOiBhbnksIGlzTXVsdExhbmd1YWdlRmllbGQ/OiBib29sZWFuKTogYm9vbGVhbiB7XHJcbiAgICBpZiAoaXNNdWx0TGFuZ3VhZ2VGaWVsZCkge1xyXG4gICAgICBjb25zdCBjdXJyZW50TGFuZ3VhZ2UgPSBUcmFuc2xhdGVTZXJ2aWNlLmdldEN1cnJlbnRMYW5ndWFnZSgpO1xyXG4gICAgICBpZiAoT2JqZWN0LmtleXModmFsdWUpLmxlbmd0aCA8IDEpIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgICAgLy8g5aaC5p6c6IO95aSf6I635Y+W5Yiw5b2T5YmN6K+t6KiA77yM6YKj5LmI5b2T5YmN6K+t6KiA5a+55bqU55qE6L6T5YWl5LiN6IO95Li656m6XHJcbiAgICAgIGlmIChjdXJyZW50TGFuZ3VhZ2UpIHtcclxuICAgICAgICByZXR1cm4gISF2YWx1ZVtjdXJyZW50TGFuZ3VhZ2VdO1xyXG4gICAgICB9XHJcbiAgICAgIC8vIOWmguaenOW9k+WJjeivreiogOS4uuepuu+8jOmCo+S5iOW/heWhq+imgeaxguiHs+WwkeacieS4gOS4qui+k+WFpVxyXG4gICAgICAvLyBjb25zdCBhbGxFbXB0eSA9IE9iamVjdC52YWx1ZXModmFsdWUpLmV2ZXJ5KCh2OiBhbnkpID0+ICF2IHx8IHYubGVuZ3RoIDwgMSk7IC8vIC5maWx0ZXIoKHY6IGFueSkgPT4gIXYgfHwgdi5sZW5ndGggPCAxKTtcclxuICAgICAgLy8gaWYgKGFsbEVtcHR5KSB7XHJcbiAgICAgIC8vICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAvLyB9XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG4gICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgIT09IG51bGwpIHtcclxuICAgICAgaWYgKCFPYmplY3Qua2V5cyh2YWx1ZSkubGVuZ3RoKSB7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICAgIHZhbHVlID0gT2JqZWN0LnZhbHVlcyh2YWx1ZSlbMF07XHJcbiAgICB9XHJcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZTogbWF4LWxpbmUtbGVuZ3RoXHJcbiAgICByZXR1cm4gdmFsdWUgIT09ICcnICYmIHZhbHVlICE9PSBudWxsICYmIHZhbHVlICE9PSB1bmRlZmluZWRcclxuICAgICAgJiYgdmFsdWUgIT09ICcwMDAxLTAxLTAxJyAmJiB2YWx1ZSAhPT0gJzAwMDEtMDEtMDEgMDA6MDA6MDAnICYmIHZhbHVlICE9PSAnMDAwMS0wMS0wMVQwMDowMDowMCc7XHJcbiAgfVxyXG5cclxuICAvKiog5Yik5pat5Lik5Liq5YC85piv5ZCm55u4562JICovXHJcbiAgZXF1YWxzKHZhbHVlOiBhbnksIGNvbXBhcmlzb246IGFueSk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHZhbHVlID09PSBjb21wYXJpc29uO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5qOA5p+lIHZhbHVlIOaYr+WQpuS4jeetieS6juWPgueFp+WAvFxyXG4gICAqIEBwYXJhbSB2YWx1ZSDopoHmo4Dmn6XnmoTlgLxcclxuICAgKiBAcGFyYW0gY29tcGFyaXNvbiDlr7nmr5Tlj4LnhaflgLxcclxuICAgKi9cclxuICBub3RFcXVhbHModmFsdWU6IGFueSwgY29tcGFyaXNvbjogYW55KTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdmFsdWUgIT09IGNvbXBhcmlzb247XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDliKTmlq12YWx1ZSDmmK/lkKbkuLrmlbDlrZdcclxuICAgKiBAcGFyYW0gdmFsdWUg6KaB5qOA5p+l55qE5YC8XHJcbiAgICogQHBhcmFtIG9wdGlvbnMg6aqM6K+B6YCJ6aG5XHJcbiAgICovXHJcbiAgaXNOdW1iZXIodmFsdWU6IGFueSwgb3B0aW9uczogSXNOdW1iZXJPcHRpb25zID0ge30pOiBib29sZWFuIHtcclxuICAgIGlmICh2YWx1ZSA9PT0gSW5maW5pdHkgfHwgdmFsdWUgPT09IC1JbmZpbml0eSkge1xyXG4gICAgICByZXR1cm4gb3B0aW9ucy5hbGxvd0luZmluaXR5O1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChOdW1iZXIuaXNOYU4odmFsdWUpKSB7XHJcbiAgICAgIHJldHVybiBvcHRpb25zLmFsbG93TmFOO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBOdW1iZXIuaXNGaW5pdGUodmFsdWUpO1xyXG4gIH1cclxuXHJcbiAgLyoqIOWIpOaWrXZhbHVl5piv5ZCm5Li65pW05pWwICovXHJcbiAgaXNJbnQodmFsdWU6IG51bWJlcikge1xyXG4gICAgcmV0dXJuIE51bWJlci5pc0ludGVnZXIodmFsdWUpO1xyXG4gIH1cclxuXHJcbiAgLyoqIOaYr+WQpuS4uua1rueCueexu+WeiyAqL1xyXG4gIGlzRmxvYXQodmFsdWU6IGFueSk6IGJvb2xlYW4ge1xyXG4gICAgaWYgKHRoaXMuaXNOdW1iZXIodmFsdWUpIHx8IHRoaXMuaXNOdW1iZXJTdHJpbmcodmFsdWUpKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLnZhbGlkYXRvckpzLmlzRmxvYXQodmFsdWUpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5qOA5p+l57uZ5a6a55qEdmFsdWUg5piv5ZCm5biD5bCU5YC8XHJcbiAgICovXHJcbiAgaXNCb29sZWFuKHZhbHVlOiBhbnkpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIEJvb2xlYW4gfHwgdHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbic7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmo4Dmn6Xnu5nlrprnmoR2YWx1ZSDmmK/lkKbkuLrlrZfnrKbkuLJcclxuICAgKi9cclxuICBpc1N0cmluZyh2YWx1ZTogYW55KTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBTdHJpbmcgfHwgdHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOajgOafpee7meWumueahHZhbHVlIOaYr+WQpuS4uuaXpeacn1xyXG4gICAqL1xyXG4gIGlzRGF0ZSh2YWx1ZTogYW55KTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBEYXRlICYmICFpc05hTih2YWx1ZS5nZXRUaW1lKCkpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5qOA5p+l57uZ5a6a55qEdmFsdWUg5piv5ZCm5Li65pel5pyf5a2X56ym5LiyXHJcbiAgICovXHJcbiAgaXNEYXRlU3RyaW5nKHZhbHVlOiBhbnkpOiBib29sZWFuIHtcclxuICAgIGNvbnN0IHJlZ2V4ID0gL1xcZHs0fS0oMFsxLTldfDFbMC0yXSktKDBbMS05XXxbMS0yXVswLTldfDNbMC0xXSkoVHxcXHM/KT8oKFswLTJdXFxkOlswLTVdXFxkKT8oOlswLTVdXFxkKD86XFwuXFxkKykpKT8oPzpafFxcK1swLTJdXFxkKD86XFw6WzAtNV1cXGQpPyk/L2c7XHJcbiAgICByZXR1cm4gdGhpcy5pc1N0cmluZyh2YWx1ZSkgJiYgcmVnZXgudGVzdCh2YWx1ZSkgJiYgdGhpcy52YWxpZGF0b3JKcy50b0RhdGUodmFsdWUpO1xyXG4gIH1cclxuXHJcbiAgLyoqIOWIpOaWrXZhbHVlIOeahOmVv+W6puaYr+WQpuWcqOWFgeiuuOeahOacgOWwj+WAvCDlkozmnIDlpKflgLzkuYvpl7QgKi9cclxuICBsZW5ndGgodmFsdWU6IGFueSwgbWluOiBudW1iZXIsIG1heD86IG51bWJlciwgaXNNdWx0TGFuZ3VhZ2VGaWVsZD86IGJvb2xlYW4pOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnICYmIHRoaXMudmFsaWRhdG9ySnMuaXNMZW5ndGgodmFsdWUsIG1pbiwgbWF4KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOajgOafpee7meWumueahHZhbHVl55qE6ZW/5bqm5piv5ZCm56ym5ZCI6K6+5a6a55qE5pyA5bCP5YC8XHJcbiAgICogQHBhcmFtIHZhbHVlIOW+heajgOafpeeahOWtl+espuS4slxyXG4gICAqIEBwYXJhbSBtaW4g5pyA5bCP6ZW/5bqmXHJcbiAgICovXHJcbiAgbWluTGVuZ3RoKHZhbHVlOiBhbnksIGlzTXVsdExhbmd1YWdlRmllbGQ6IGJvb2xlYW4sIG1pbjogbnVtYmVyKTogYm9vbGVhbiB7XHJcbiAgICBpZiAoaXNNdWx0TGFuZ3VhZ2VGaWVsZCkge1xyXG4gICAgICAvLyBjb25zdCBjdXJyZW50TGFuZ3VhZ2UgPSBUcmFuc2xhdGVTZXJ2aWNlLmdldEN1cnJlbnRMYW5ndWFnZSgpO1xyXG4gICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnb2JqZWN0Jykge1xyXG4gICAgICAgIGNvbnN0IGhhc0ludmFsaWRMYW5ncyA9IE9iamVjdC52YWx1ZXModmFsdWUpLmZpbHRlcigodjogYW55KSA9PiB2ICYmIHYubGVuZ3RoIDwgbWluKTtcclxuICAgICAgICBpZiAoaGFzSW52YWxpZExhbmdzICYmIGhhc0ludmFsaWRMYW5ncy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIC8vIGlmIChjdXJyZW50TGFuZ3VhZ2UpIHtcclxuICAgICAgLy8gICByZXR1cm4gdmFsdWVbY3VycmVudExhbmd1YWdlXSA/IHZhbHVlW2N1cnJlbnRMYW5ndWFnZV0ubGVuZ3RoID4gbWluIDogdHJ1ZTtcclxuICAgICAgLy8gfVxyXG4gICAgICAvLyDlpoLmnpzml6Dms5Xojrflj5blvZPliY3or63oqIDvvIzliJnlj6ropoHmnInkuIDnp43or63oqIDnmoTovpPlhaXplb/luqblpKfkuo7mnIDlsI/plb/luqbljbPlj6/jgIJcclxuICAgICAgLy8gY29uc3QgaGFzVmFsaWRMYW5ncyA9IE9iamVjdC52YWx1ZXModmFsdWUpLmZpbHRlcigodjogYW55KSA9PiB2ICYmIHYubGVuZ3RoID4gbWluKTtcclxuICAgICAgLy8gaWYgKGhhc1ZhbGlkTGFuZ3MubGVuZ3RoID4gMCkge1xyXG4gICAgICAvLyAgIHJldHVybiB0cnVlO1xyXG4gICAgICAvLyB9XHJcbiAgICAgIC8vIHJldHVybiBmYWxzZTtcclxuICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcbiAgICBpZiAodmFsdWUgJiYgdHlwZW9mIHZhbHVlICE9PSAnc3RyaW5nJykge1xyXG4gICAgICB2YWx1ZSA9IHZhbHVlLnRvU3RyaW5nKCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gIXZhbHVlIHx8ICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnICYmIHRoaXMubGVuZ3RoKHZhbHVlLCBtaW4pKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOajgOafpee7meWumueahHZhbHVl55qE6ZW/5bqm5piv5ZCm56ym5ZCI6K6+5a6a55qE5pyA5aSn5YC8XHJcbiAgICogQHBhcmFtIHZhbHVlIOW+heajgOafpeeahOWtl+espuS4slxyXG4gICAqIEBwYXJhbSBtYXgg5pyA5aSn6ZW/5bqmXHJcbiAgICovXHJcbiAgbWF4TGVuZ3RoKHZhbHVlOiBhbnksIGlzTXVsdExhbmd1YWdlRmllbGQ6IGJvb2xlYW4sIG1heDogbnVtYmVyKTogYm9vbGVhbiB7XHJcbiAgICBpZiAoaXNNdWx0TGFuZ3VhZ2VGaWVsZCkge1xyXG4gICAgICAvLyBjb25zdCBjdXJyZW50TGFuZ3VhZ2UgPSBUcmFuc2xhdGVTZXJ2aWNlLmdldEN1cnJlbnRMYW5ndWFnZSgpO1xyXG4gICAgICAvLyBpZiAoY3VycmVudExhbmd1YWdlKSB7XHJcbiAgICAgIC8vICAgcmV0dXJuIHZhbHVlW2N1cnJlbnRMYW5ndWFnZV0gPyB2YWx1ZVtjdXJyZW50TGFuZ3VhZ2VdLmxlbmd0aCA8IG1heCA6IHRydWU7XHJcbiAgICAgIC8vIH1cclxuICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcpIHtcclxuICAgICAgICBjb25zdCBoYXNJbnZhbGlkTGFuZ3MgPSBPYmplY3QudmFsdWVzKHZhbHVlKS5maWx0ZXIoKHY6IGFueSkgPT4gdiAmJiB2Lmxlbmd0aCA+IG1heCk7XHJcbiAgICAgICAgaWYgKGhhc0ludmFsaWRMYW5ncy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG4gICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcpIHtcclxuICAgICAgZm9yIChjb25zdCBrZXkgaW4gdmFsdWUpIHtcclxuICAgICAgICBpZiAodmFsdWUuaGFzT3duUHJvcGVydHkoa2V5KSkge1xyXG4gICAgICAgICAgY29uc3QgZWxlbWVudCA9IHZhbHVlW2tleV07XHJcbiAgICAgICAgICBpZiAodHlwZW9mIGVsZW1lbnQgPT09ICdzdHJpbmcnICYmICF0aGlzLmxlbmd0aCh2YWx1ZVtrZXldLCAwLCBtYXgpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcbiAgICBpZiAodmFsdWUgJiYgdHlwZW9mIHZhbHVlICE9PSAnc3RyaW5nJykge1xyXG4gICAgICB2YWx1ZSA9IHZhbHVlLnRvU3RyaW5nKCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gIXZhbHVlIHx8ICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnICYmIHRoaXMubGVuZ3RoKHZhbHVlLCAwLCBtYXgpKTtcclxuICB9XHJcblxyXG4gIC8qKiDmo4Dmn6V2YWx1ZeeahOWAvOaYr+WQpuWcqCDmnIDlpKflgLzkuI7mnIDlsI/lgLzkuYvpl7QgKi9cclxuICByYW5nZSh2YWx1ZTogbnVtYmVyLCBpc011bHRMYW5ndWFnZUZpZWxkOiBib29sZWFuLCBtaW46IG51bWJlciwgbWF4OiBudW1iZXIpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInICYmIHRoaXMuaXNOdW1iZXIobWluKSAmJiB0aGlzLmlzTnVtYmVyKG1heCkgJiYgdmFsdWUgPj0gbWluICYmIHZhbHVlIDw9IG1heDtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5pel5pyf57G75Z6L55qE5YC85piv5ZCm5Zyo5p+Q5Liq5Yy66Ze0XHJcbiAgICogQHBhcmFtIHZhbHVlIHZhbHVlXHJcbiAgICogQHBhcmFtIG1pbiDmnIDlsI/lgLxcclxuICAgKiBAcGFyYW0gbWF4IOacgOWkp+WAvFxyXG4gICAqL1xyXG4gIGRhdGVSYW5nZSh2YWx1ZTogYW55LCBpc011bHRMYW5ndWFnZUZpZWxkOiBib29sZWFuLCBydWxlOiBzdHJpbmcsIHR5cGU6IHN0cmluZykge1xyXG4gICAgLy8gMjAxMH4yMDIwfDA0fjA1fDAzIDExOjAwOjAwfjA1IDEyOjAwOjAwXHJcbiAgICBpZiAoIXZhbHVlKSB7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG4gICAgaWYgKHR5cGUgPT09ICdtYXhWYWx1ZScgfHwgdHlwZSA9PT0gJ21heERhdGUnKSB7XHJcbiAgICAgIGlmICh0aGlzLmlzWWVhclJhbmdlKHZhbHVlKSB8fCB0aGlzLmlzTW9udGhPckRheVJhbmdlKHZhbHVlKSkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLm1heFZhbHVlKHBhcnNlSW50KHRoaXMuZ2V0UmFuZ2VWYWx1ZSh2YWx1ZSwgMSkpLCBpc011bHRMYW5ndWFnZUZpZWxkLCBwYXJzZUludChydWxlLnNwbGl0KCcgJylbMF0pKTtcclxuICAgICAgfSBlbHNlIGlmICh0aGlzLmlzRGF5VGltZVJhbmdlKHZhbHVlKSkge1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdtaW5WYWx1ZScgfHwgdHlwZSA9PT0gJ21pbkRhdGUnKSB7XHJcbiAgICAgIGlmICh0aGlzLmlzWWVhclJhbmdlKHZhbHVlKSB8fCB0aGlzLmlzTW9udGhPckRheVJhbmdlKHZhbHVlKSkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLm1heFZhbHVlKHBhcnNlSW50KHRoaXMuZ2V0UmFuZ2VWYWx1ZSh2YWx1ZSwgMCkpLCBpc011bHRMYW5ndWFnZUZpZWxkLCBwYXJzZUludChydWxlLnNwbGl0KCcgJylbMF0pKTtcclxuICAgICAgfSBlbHNlIGlmICh0aGlzLmlzRGF5VGltZVJhbmdlKHZhbHVlKSkge1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfVxyXG4gIHByaXZhdGUgZ2V0UmFuZ2VWYWx1ZSh2YWx1ZTogc3RyaW5nLCBwb3NpdGlvbjogMCB8IDEsIHNwbGl0b3IgPSAnficpIHtcclxuICAgIHJldHVybiB2YWx1ZS5zcGxpdChzcGxpdG9yKVtwb3NpdGlvbl07XHJcbiAgfVxyXG4gIHByaXZhdGUgaXNEYXRlUmFuZ2UodmFsdWU6IGFueSkge1xyXG4gICAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ3N0cmluZycpIHtcclxuICAgICAgdmFsdWUgPSB2YWx1ZS50b1N0cmluZygpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIC8oXFxkezR9fFxcZHsyfSkvLnRlc3QodmFsdWUpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmmK/lkKblubTluqbljLrpl7RcclxuICAgKiBAcGFyYW0gdmFsdWUgdmFsdWVcclxuICAgKi9cclxuICBwcml2YXRlIGlzWWVhclJhbmdlKHZhbHVlOiBhbnkpIHtcclxuICAgIGlmICh0eXBlb2YgdmFsdWUgIT09ICdzdHJpbmcnKSB7XHJcbiAgICAgIHZhbHVlID0gdmFsdWUudG9TdHJpbmcoKTtcclxuICAgIH1cclxuICAgIHJldHVybiAvXlxcZHs0fX5cXGR7NH0kLy50ZXN0KHZhbHVlKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5piv5ZCm5Li65bm05pyI5Yy66Ze0XHJcbiAgICogQHBhcmFtIHZhbHVlIHZhbHVlXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBpc1llYXJNb250aFJhbmdlKHZhbHVlOiBhbnkpIHtcclxuICAgIGlmICh0eXBlb2YgdmFsdWUgIT09ICdzdHJpbmcnKSB7XHJcbiAgICAgIHZhbHVlID0gdmFsdWUudG9TdHJpbmcoKTtcclxuICAgIH1cclxuICAgIHJldHVybiAvXlxcZHs0fS1cXGR7Mn1+XFxkezR9LVxcZHsyfSQvLnRlc3QodmFsdWUpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmmK/lkKbkuLrmnIjmiJblpKnnmoTljLrpl7RcclxuICAgKiBAcGFyYW0gdmFsdWUgdmFsdWVcclxuICAgKi9cclxuICBwcml2YXRlIGlzTW9udGhPckRheVJhbmdlKHZhbHVlOiBhbnkpIHtcclxuICAgIGlmICh0eXBlb2YgdmFsdWUgIT09ICdzdHJpbmcnKSB7XHJcbiAgICAgIHZhbHVlID0gdmFsdWUudG9TdHJpbmcoKTtcclxuICAgIH1cclxuICAgIHJldHVybiAvXlswfDF8MnwzXVxcZHsxfX5bMHwxfDJ8M11cXGR7MX0kLy50ZXN0KHZhbHVlKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5piv5ZCm5Li65aSpK+aXtumXtOeahOWMuumXtFxyXG4gICAqIEBwYXJhbSB2YWx1ZSB2YWx1ZVxyXG4gICAqL1xyXG4gIHByaXZhdGUgaXNEYXlUaW1lUmFuZ2UodmFsdWU6IGFueSkge1xyXG4gICAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ3N0cmluZycpIHtcclxuICAgICAgdmFsdWUgPSB2YWx1ZS50b1N0cmluZygpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIC9eWzB8MXwyfDNdXFxkezF9IFxcZHsyfTpcXGR7Mn06XFxkezJ9flswfDF8MnwzXVxcZHsxfSBcXGR7Mn06XFxkezJ9OlxcZHsyfSQvLnRlc3QodmFsdWUpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ2hlY2tzIGlmIHRoZSBmaXJzdCBudW1iZXIgaXMgZ3JlYXRlciB0aGFuIHNlY29uZC5cclxuICAgKi9cclxuICBtaW4obnVtOiBudW1iZXIsIGlzTXVsdExhbmd1YWdlRmllbGQ6IGJvb2xlYW4sIG1pbjogbnVtYmVyKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdHlwZW9mIG51bSA9PT0gJ251bWJlcicgJiYgdHlwZW9mIG1pbiA9PT0gJ251bWJlcicgJiYgbnVtID49IG1pbjtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOacgOWwj+WAvOmqjOivgVxyXG4gICAqL1xyXG4gIG1pblZhbHVlKG51bTogbnVtYmVyIHwgc3RyaW5nLCBpc011bHRMYW5ndWFnZUZpZWxkOiBib29sZWFuLCBtaW46IG51bWJlcik6IGJvb2xlYW4ge1xyXG4gICAgLy8g5aaC5p6c5YC85LiN5a2Y5Zyo77yM5YiZ5LiN6L+b6KGM5pyA5bCP5YC855qE5Yik5patXHJcbiAgICBpZiAobnVtID09PSBudWxsIHx8IG51bSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG4gICAgLy8g5oyJ54Wn5aSn5pWw5aSE55CGXHJcbiAgICBpZiAodHlwZW9mIG51bSA9PT0gJ3N0cmluZycgJiYgbnVtLm1hdGNoKC9eKC0/XFxkKykoXFwuXFxkKyk/JC9nKSkge1xyXG4gICAgICBjb25zdCB2YWx1ZSA9IG5ldyBCaWdOdW1iZXIobnVtKTtcclxuICAgICAgY29uc3QgbWF4VmFsdWUgPSBuZXcgQmlnTnVtYmVyKG1pbik7XHJcbiAgICAgIHJldHVybiB2YWx1ZS5pc0dyZWF0ZXJUaGFuT3JFcXVhbFRvKG1heFZhbHVlKTtcclxuICAgIH1cclxuICAgIHJldHVybiB0eXBlb2YgbnVtID09PSAnbnVtYmVyJyAmJiB0eXBlb2YgbWluID09PSAnbnVtYmVyJyAmJiBudW0gPj0gbWluO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ2hlY2tzIGlmIHRoZSBmaXJzdCBudW1iZXIgaXMgbGVzcyB0aGFuIHNlY29uZC5cclxuICAgKi9cclxuICBtYXgobnVtOiBudW1iZXIsIGlzTXVsdExhbmd1YWdlRmllbGQ6IGJvb2xlYW4sIG1heDogbnVtYmVyKTogYm9vbGVhbiB7XHJcbiAgICAvLyDlpoLmnpzlgLzkuI3lrZjlnKjvvIzliJnkuI3ov5vooYzmnIDlsI/lgLznmoTliKTmlq1cclxuICAgIGlmIChudW0gPT09IG51bGwgfHwgbnVtID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdHlwZW9mIG51bSA9PT0gJ251bWJlcicgJiYgdHlwZW9mIG1heCA9PT0gJ251bWJlcicgJiYgbnVtIDw9IG1heDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOacgOWkp+WAvOmqjOivgVxyXG4gICAqL1xyXG4gIG1heFZhbHVlKG51bTogbnVtYmVyIHwgc3RyaW5nLCBpc011bHRMYW5ndWFnZUZpZWxkOiBib29sZWFuLCBtYXg6IG51bWJlcik6IGJvb2xlYW4ge1xyXG4gICAgLy8g5aaC5p6c5YC85LiN5a2Y5Zyo77yM5YiZ5LiN6L+b6KGM5pyA5bCP5YC855qE5Yik5patXHJcbiAgICBpZiAobnVtID09PSBudWxsIHx8IG51bSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG4gICAgLy8g5oyJ54Wn5aSn5pWw5aSE55CGXHJcbiAgICBpZiAodHlwZW9mIG51bSA9PT0gJ3N0cmluZycgJiYgbnVtLm1hdGNoKC9eKC0/XFxkKykoXFwuXFxkKyk/JC9nKSkge1xyXG4gICAgICBjb25zdCB2YWx1ZSA9IG5ldyBCaWdOdW1iZXIobnVtKTtcclxuICAgICAgY29uc3QgbWF4VmFsdWUgPSBuZXcgQmlnTnVtYmVyKG1heCk7XHJcbiAgICAgIHJldHVybiB2YWx1ZS5pc0xlc3NUaGFuT3JFcXVhbFRvKG1heFZhbHVlKTtcclxuICAgIH1cclxuICAgIHJldHVybiB0eXBlb2YgbnVtID09PSAnbnVtYmVyJyAmJiB0eXBlb2YgbWF4ID09PSAnbnVtYmVyJyAmJiBudW0gPD0gbWF4O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ2hlY2tzIGlmIHRoZSB2YWx1ZSBpcyBhIGRhdGUgdGhhdCdzIGFmdGVyIHRoZSBzcGVjaWZpZWQgZGF0ZS5cclxuICAgKi9cclxuICBtaW5EYXRlKGRhdGU6IERhdGUsIGlzTXVsdExhbmd1YWdlRmllbGQ6IGJvb2xlYW4sIG1pbkRhdGU6IERhdGUpOiBib29sZWFuIHtcclxuICAgIGlmICghZGF0ZSkge1xyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuICAgIHJldHVybiBkYXRlICYmIGRhdGUuZ2V0VGltZSgpID49IG1pbkRhdGUuZ2V0VGltZSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ2hlY2tzIGlmIHRoZSB2YWx1ZSBpcyBhIGRhdGUgdGhhdCdzIGJlZm9yZSB0aGUgc3BlY2lmaWVkIGRhdGUuXHJcbiAgICovXHJcbiAgbWF4RGF0ZShkYXRlOiBEYXRlLCBpc011bHRMYW5ndWFnZUZpZWxkOiBib29sZWFuLCBtYXhEYXRlOiBEYXRlKTogYm9vbGVhbiB7XHJcbiAgICAvLyDlpoLmnpzlgLzkuI3lrZjlnKjvvIzliJnkuI3ov5vooYzmnIDlsI/lgLznmoTliKTmlq1cclxuICAgIGlmIChkYXRlID09PSBudWxsIHx8IGRhdGUgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuICAgIHJldHVybiBkYXRlICYmIGRhdGUuZ2V0VGltZSgpIDw9IG1heERhdGUuZ2V0VGltZSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ2hlY2tzIGlmIGEgc3RyaW5nIGlzIGEgYm9vbGVhbi5cclxuICAgKiBJZiBnaXZlbiB2YWx1ZSBpcyBub3QgYSBzdHJpbmcsIHRoZW4gaXQgcmV0dXJucyBmYWxzZS5cclxuICAgKi9cclxuICBpc0Jvb2xlYW5TdHJpbmcodmFsdWU6IHN0cmluZyk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycgJiYgdGhpcy52YWxpZGF0b3JKcy5pc0Jvb2xlYW4odmFsdWUpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ2hlY2tzIGlmIHRoZSBzdHJpbmcgaXMgbnVtZXJpYy5cclxuICAgKiBJZiBnaXZlbiB2YWx1ZSBpcyBub3QgYSBzdHJpbmcsIHRoZW4gaXQgcmV0dXJucyBmYWxzZS5cclxuICAgKi9cclxuICBpc051bWJlclN0cmluZyh2YWx1ZTogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJyAmJiB0aGlzLnZhbGlkYXRvckpzLmlzTnVtZXJpYyh2YWx1ZSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDaGVja3MgaWYgdGhlIHN0cmluZyBjb250YWlucyB0aGUgc2VlZC5cclxuICAgKiBJZiBnaXZlbiB2YWx1ZSBpcyBub3QgYSBzdHJpbmcsIHRoZW4gaXQgcmV0dXJucyBmYWxzZS5cclxuICAgKi9cclxuICBjb250YWlucyh2YWx1ZTogc3RyaW5nLCBpc011bHRMYW5ndWFnZUZpZWxkOiBib29sZWFuLCBzZWVkOiBzdHJpbmcpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnICYmIHRoaXMudmFsaWRhdG9ySnMuY29udGFpbnModmFsdWUsIHNlZWQpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ2hlY2tzIGlmIHRoZSBzdHJpbmcgZG9lcyBub3QgY29udGFpbiB0aGUgc2VlZC5cclxuICAgKiBJZiBnaXZlbiB2YWx1ZSBpcyBub3QgYSBzdHJpbmcsIHRoZW4gaXQgcmV0dXJucyBmYWxzZS5cclxuICAgKi9cclxuICBub3RDb250YWlucyh2YWx1ZTogc3RyaW5nLCBpc011bHRMYW5ndWFnZUZpZWxkOiBib29sZWFuLCBzZWVkOiBzdHJpbmcpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnICYmICF0aGlzLnZhbGlkYXRvckpzLmNvbnRhaW5zKHZhbHVlLCBzZWVkKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENoZWNrcyBpZiB0aGUgc3RyaW5nIGlzIGFuIGVtYWlsLlxyXG4gICAqIElmIGdpdmVuIHZhbHVlIGlzIG5vdCBhIHN0cmluZywgdGhlbiBpdCByZXR1cm5zIGZhbHNlLlxyXG4gICAqL1xyXG4gIGlzRW1haWwodmFsdWU6IHN0cmluZyk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycgJiYgdGhpcy52YWxpZGF0b3JKcy5pc0VtYWlsKHZhbHVlKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENoZWNrcyBpZiB0aGUgc3RyaW5nIGlzIHZhbGlkIEpTT04gKG5vdGU6IHVzZXMgSlNPTi5wYXJzZSkuXHJcbiAgICogSWYgZ2l2ZW4gdmFsdWUgaXMgbm90IGEgc3RyaW5nLCB0aGVuIGl0IHJldHVybnMgZmFsc2UuXHJcbiAgICovXHJcbiAgaXNKU09OKHZhbHVlOiBzdHJpbmcpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnICYmIHRoaXMudmFsaWRhdG9ySnMuaXNKU09OKHZhbHVlKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENoZWNrcyBpZiB0aGUgc3RyaW5nIGlzIGxvd2VyY2FzZS5cclxuICAgKiBJZiBnaXZlbiB2YWx1ZSBpcyBub3QgYSBzdHJpbmcsIHRoZW4gaXQgcmV0dXJucyBmYWxzZS5cclxuICAgKi9cclxuICBpc0xvd2VyY2FzZSh2YWx1ZTogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJyAmJiB0aGlzLnZhbGlkYXRvckpzLmlzTG93ZXJjYXNlKHZhbHVlKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENoZWNrcyBpZiB0aGUgc3RyaW5nIGlzIHVwcGVyY2FzZS5cclxuICAgKiBJZiBnaXZlbiB2YWx1ZSBpcyBub3QgYSBzdHJpbmcsIHRoZW4gaXQgcmV0dXJucyBmYWxzZS5cclxuICAgKi9cclxuICBpc1VwcGVyY2FzZSh2YWx1ZTogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJyAmJiB0aGlzLnZhbGlkYXRvckpzLmlzVXBwZXJjYXNlKHZhbHVlKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOmqjOivgeWtl+espuS4suaYr+WQpuWMheWQq+mdnuazleWtl+esplxyXG4gICAqIEBwYXJhbSB2YWx1ZSDpqozor4HnmoTlrZfnrKbkuLJcclxuICAgKiBAcGFyYW0gc29tZUNoYXJzIOmdnuazleWtl+espuOAguWmgu+8miPvv6UlQCRcclxuICAgKi9cclxuICBleGNsdWRlKHZhbHVlOiBzdHJpbmcsIGlzTXVsdExhbmd1YWdlRmllbGQ6IGJvb2xlYW4sIHNvbWVDaGFyczogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgICBjb25zdCBhcnJDaGFyID0gc29tZUNoYXJzLnNwbGl0KCcnKTtcclxuICAgIGxldCBjb3VudGVyID0gMDtcclxuICAgIGFyckNoYXIuZm9yRWFjaCh2YWwgPT4ge1xyXG4gICAgICBpZiAodGhpcy5jb250YWlucyh2YWx1ZSwgaXNNdWx0TGFuZ3VhZ2VGaWVsZCwgdmFsKSkge1xyXG4gICAgICAgIGNvdW50ZXIrKztcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIGNvdW50ZXIgPT09IDA7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDoh6rlrprkuYnmraPliJnpqozor4FcclxuICAgKiBAcGFyYW0gdmFsdWUg5b6F6aqM6K+B55qE5a2X56ym5LiyXHJcbiAgICogQHBhcmFtIHBhdHRlcm4g5q2j5YiZ6KGo6L6+5byPXHJcbiAgICovXHJcbiAgbWF0Y2hlcyh2YWx1ZTogc3RyaW5nLCBpc011bHRMYW5ndWFnZUZpZWxkOiBib29sZWFuLCBwYXR0ZXJuOiBhbnkpOiBib29sZWFuIHtcclxuICAgIHZhbHVlID0gKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQpID8gJycgOiB2YWx1ZS50b1N0cmluZygpO1xyXG4gICAgaWYgKHZhbHVlID09PSAnJykge1xyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLnZhbGlkYXRvckpzLm1hdGNoZXModmFsdWUsIHBhdHRlcm4pO1xyXG4gIH1cclxufVxyXG4iXX0=