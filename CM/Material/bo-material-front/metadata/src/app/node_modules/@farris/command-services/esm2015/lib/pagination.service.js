import { Injectable, Injector } from "@angular/core";
import { DataPropGroup, FrameContext } from "@farris/devkit";
export class PaginationService {
    constructor(injector, frameContext) {
        this.injector = injector;
        this.frameContext = frameContext;
    }
    /**
     * 重置子表分页信息
     */
    resetChildrenPagination() {
        const paginationInfo = this.frameContext.repository.entityCollection.paginationInfo || {};
        const childrenEntityCodes = this.frameContext.repository.entityTypeInfo.getPropNamesByGroup(DataPropGroup.List) || [];
        if (paginationInfo && Object.keys(paginationInfo).length > 0) {
            const keys = Object.keys(paginationInfo);
            keys.forEach((key) => {
                const value = paginationInfo[key];
                if (Object.prototype.toString.apply(value) !== '[object Object]') {
                    return;
                }
                const rowPagination = childrenEntityCodes.find((nodeCode) => {
                    // 去掉s
                    nodeCode = nodeCode.slice(0, -1);
                    return key.startsWith(`${nodeCode}_`);
                });
                if (rowPagination) {
                    delete paginationInfo[key];
                }
                else {
                    paginationInfo[key].pageIndex = 1;
                    delete paginationInfo[key].total;
                    delete paginationInfo[key].pageCount;
                }
            });
            this.frameContext.repository.entityCollection.updatePaginationInfoByPath('/', paginationInfo);
        }
    }
}
PaginationService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
PaginationService.ctorParameters = () => [
    { type: Injector },
    { type: FrameContext }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFnaW5hdGlvbi5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9jb21tYW5kLXNlcnZpY2VzLyIsInNvdXJjZXMiOlsibGliL3BhZ2luYXRpb24uc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNyRCxPQUFPLEVBQUUsYUFBYSxFQUFFLFlBQVksRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRzdELE1BQU0sT0FBTyxpQkFBaUI7SUFDNUIsWUFBb0IsUUFBa0IsRUFBVSxZQUEwQjtRQUF0RCxhQUFRLEdBQVIsUUFBUSxDQUFVO1FBQVUsaUJBQVksR0FBWixZQUFZLENBQWM7SUFBSSxDQUFDO0lBQy9FOztPQUVHO0lBQ0ksdUJBQXVCO1FBQzVCLE1BQU0sY0FBYyxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsVUFBVSxDQUFDLGdCQUFnQixDQUFDLGNBQWMsSUFBSSxFQUFFLENBQUM7UUFDMUYsTUFBTSxtQkFBbUIsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLFVBQVUsQ0FBQyxjQUFjLENBQUMsbUJBQW1CLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUN0SCxJQUFJLGNBQWMsSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDNUQsTUFBTSxJQUFJLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQztZQUN6QyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsR0FBVyxFQUFFLEVBQUU7Z0JBQzNCLE1BQU0sS0FBSyxHQUFHLGNBQWMsQ0FBQyxHQUFHLENBQUMsQ0FBQztnQkFDbEMsSUFBSSxNQUFNLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLEtBQUssaUJBQWlCLEVBQUU7b0JBQ2hFLE9BQU87aUJBQ1I7Z0JBQ0QsTUFBTSxhQUFhLEdBQUcsbUJBQW1CLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBZ0IsRUFBRSxFQUFFO29CQUNsRSxNQUFNO29CQUNOLFFBQVEsR0FBRyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO29CQUNqQyxPQUFPLEdBQUcsQ0FBQyxVQUFVLENBQUMsR0FBRyxRQUFRLEdBQUcsQ0FBQyxDQUFDO2dCQUN4QyxDQUFDLENBQUMsQ0FBQztnQkFDSCxJQUFJLGFBQWEsRUFBRTtvQkFDakIsT0FBTyxjQUFjLENBQUMsR0FBRyxDQUFDLENBQUM7aUJBQzVCO3FCQUFNO29CQUNMLGNBQWMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxTQUFTLEdBQUcsQ0FBQyxDQUFDO29CQUNsQyxPQUFPLGNBQWMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxLQUFLLENBQUM7b0JBQ2pDLE9BQU8sY0FBYyxDQUFDLEdBQUcsQ0FBQyxDQUFDLFNBQVMsQ0FBQztpQkFDdEM7WUFDSCxDQUFDLENBQUMsQ0FBQztZQUNILElBQUksQ0FBQyxZQUFZLENBQUMsVUFBVSxDQUFDLGdCQUFnQixDQUFDLDBCQUEwQixDQUFDLEdBQUcsRUFBRSxjQUFjLENBQUMsQ0FBQztTQUMvRjtJQUNILENBQUM7OztZQS9CRixVQUFVOzs7O1lBSFUsUUFBUTtZQUNMLFlBQVkiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlLCBJbmplY3RvciB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XG5pbXBvcnQgeyBEYXRhUHJvcEdyb3VwLCBGcmFtZUNvbnRleHQgfSBmcm9tIFwiQGZhcnJpcy9kZXZraXRcIjtcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIFBhZ2luYXRpb25TZXJ2aWNlIHtcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IsIHByaXZhdGUgZnJhbWVDb250ZXh0OiBGcmFtZUNvbnRleHQpIHsgfVxuICAvKipcbiAgICog6YeN572u5a2Q6KGo5YiG6aG15L+h5oGvXG4gICAqL1xuICBwdWJsaWMgcmVzZXRDaGlsZHJlblBhZ2luYXRpb24oKSB7XG4gICAgY29uc3QgcGFnaW5hdGlvbkluZm8gPSB0aGlzLmZyYW1lQ29udGV4dC5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24ucGFnaW5hdGlvbkluZm8gfHwge307XG4gICAgY29uc3QgY2hpbGRyZW5FbnRpdHlDb2RlcyA9IHRoaXMuZnJhbWVDb250ZXh0LnJlcG9zaXRvcnkuZW50aXR5VHlwZUluZm8uZ2V0UHJvcE5hbWVzQnlHcm91cChEYXRhUHJvcEdyb3VwLkxpc3QpIHx8IFtdO1xuICAgIGlmIChwYWdpbmF0aW9uSW5mbyAmJiBPYmplY3Qua2V5cyhwYWdpbmF0aW9uSW5mbykubGVuZ3RoID4gMCkge1xuICAgICAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKHBhZ2luYXRpb25JbmZvKTtcbiAgICAgIGtleXMuZm9yRWFjaCgoa2V5OiBzdHJpbmcpID0+IHtcbiAgICAgICAgY29uc3QgdmFsdWUgPSBwYWdpbmF0aW9uSW5mb1trZXldO1xuICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5hcHBseSh2YWx1ZSkgIT09ICdbb2JqZWN0IE9iamVjdF0nKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHJvd1BhZ2luYXRpb24gPSBjaGlsZHJlbkVudGl0eUNvZGVzLmZpbmQoKG5vZGVDb2RlOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAvLyDljrvmjolzXG4gICAgICAgICAgbm9kZUNvZGUgPSBub2RlQ29kZS5zbGljZSgwLCAtMSk7XG4gICAgICAgICAgcmV0dXJuIGtleS5zdGFydHNXaXRoKGAke25vZGVDb2RlfV9gKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChyb3dQYWdpbmF0aW9uKSB7XG4gICAgICAgICAgZGVsZXRlIHBhZ2luYXRpb25JbmZvW2tleV07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcGFnaW5hdGlvbkluZm9ba2V5XS5wYWdlSW5kZXggPSAxO1xuICAgICAgICAgIGRlbGV0ZSBwYWdpbmF0aW9uSW5mb1trZXldLnRvdGFsO1xuICAgICAgICAgIGRlbGV0ZSBwYWdpbmF0aW9uSW5mb1trZXldLnBhZ2VDb3VudDtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICB0aGlzLmZyYW1lQ29udGV4dC5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24udXBkYXRlUGFnaW5hdGlvbkluZm9CeVBhdGgoJy8nLCBwYWdpbmF0aW9uSW5mbyk7XG4gICAgfVxuICB9XG59Il19