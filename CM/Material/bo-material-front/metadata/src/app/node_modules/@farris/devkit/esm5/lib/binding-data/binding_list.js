/**
 * 绑定列表相关定义
 * @author Witt<jiwt@inspur.com>
 */
import * as tslib_1 from "tslib";
// tslint:disable: max-line-length
import { List } from 'immutable';
import { Subject } from 'rxjs';
import { ChangeType } from './changes';
import { BindingObjectFactory } from './binding_object_factory';
import { PropertyUtil } from './property_util';
import { BindingData } from './binding_data';
import { TranslateService } from '../i18n/translate_service';
/**
 * BindingList是一个BindingObject集合
 */
var BindingList = /** @class */ (function () {
    /**
     * 构造函数
     */
    function BindingList(properties) {
        this.__type__ = 'BindingList';
        //#region 分页相关
        /**
         * 分页信息
         */
        this._paginationInfo = null;
        this.properties = properties;
        this.primaryKey = PropertyUtil.getPrimaryKey(properties);
        this.changes = new Subject();
        this.innerList = List();
        this.currentId = null;
        this.destroy$ = new Subject();
    }
    Object.defineProperty(BindingList.prototype, "paginationInfo", {
        get: function () {
            return this._paginationInfo;
        },
        set: function (sPaginationInfo) {
            this._paginationInfo = sPaginationInfo;
            if (this._paginationInfo === sPaginationInfo) {
                return;
            }
            this.changes.next({
                type: ChangeType.PaginationInfoChange,
                path: [],
                value: this._paginationInfo
            });
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BindingList.prototype, "pageIndex", {
        /**
         * 获取页码
         */
        get: function () {
            if (!!this.paginationInfo && this.paginationInfo.hasOwnProperty("pageIndex")) {
                return this.paginationInfo.pageIndex;
            }
            return 1;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BindingList.prototype, "pageSize", {
        /**
         * 获取分页大小
         */
        get: function () {
            if (!!this.paginationInfo && this.paginationInfo.hasOwnProperty("pageSize")) {
                return this.paginationInfo.pageSize;
            }
            return 0;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BindingList.prototype, "total", {
        /**
         * 获取数据总项数
         */
        get: function () {
            if (!!this.paginationInfo) {
                return this.paginationInfo.total || this.paginationInfo.totalCount;
            }
            return 0;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BindingList.prototype, "skip", {
        /**
         * 获取跳过的数据条数
         */
        get: function () {
            var pageIndex = this.pageIndex;
            var pageSize = this.pageSize;
            return (pageIndex - 1) * pageSize;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * 前台设置分页信息
     * @param skip skip
     * @param take take
     */
    BindingList.prototype.setPaginationInfo = function (skip, take) {
        this.paginationInfo = Object.assign({}, this.paginationInfo, {
            pageSize: take,
            pageIndex: skip / take + 1
        });
        /*this.changes.next({
          type: ChangeType.PaginationInfoChange,
          path: [],
          value: this.paginationInfo
        });*/
    };
    Object.defineProperty(BindingList.prototype, "currentItem", {
        //#endregion
        /**
         * 当前行对应的绑定对象
         * 如果currentId为null，则创建一个空结构，防止绑定报错；
         */
        get: function () {
            var currentItem = this.findById(this.currentId);
            if (!currentItem) {
                if (!this.emptyCurrentItem) {
                    this.emptyCurrentItem = BindingObjectFactory.create(this.properties);
                }
                return this.emptyCurrentItem;
            }
            return currentItem;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BindingList.prototype, "length", {
        /**
         * 绑定对象的数量
         */
        get: function () {
            return this.innerList.count();
        },
        enumerable: true,
        configurable: true
    });
    /**
     * 销毁
     * @param options
     */
    BindingList.prototype.dispose = function (options) {
        this.clear(true);
        if (this.destroy$) {
            this.destroy$.next();
            this.destroy$.complete();
            this.destroy$ = null;
        }
    };
    /**
     * 添加[Symbol.iterator]，使之能通过for of遍历
     */
    BindingList.prototype[Symbol.iterator] = function () {
        var self = this;
        var index = -1;
        var size = this.innerList.size;
        return {
            next: function () {
                index++;
                if (index < size) {
                    return { done: false, value: self.innerList.get(index) };
                }
                return { done: true, value: undefined };
            }
        };
    };
    /**
     * 批量加载绑定对象，加载之前先清空绑定列表，并重置当前行，加载之后将第一行设置为默认当前行。
     * @param objects 要加载绑定对象数组
     */
    BindingList.prototype.load = function (objects, entityCreate) {
        var _this = this;
        if (entityCreate === void 0) { entityCreate = false; }
        // 重置列表
        this.innerList = this.innerList.clear();
        if (objects.length !== 0) {
            // 加载数据
            objects.forEach(function (object) {
                _this.add(object);
            });
            // 设置默认当前行
            var currentItem = this.findById(this.currentId);
            if (!currentItem) {
                var firstId = objects[0][this.primaryKey];
                this.setCurrentId(firstId, false, false);
            }
        }
        else {
            this.currentId = null;
        }
        var change = {
            type: ChangeType.Load,
            path: [],
            value: objects
        };
        change.create = entityCreate;
        // 触发事件
        this.changes.next(change);
    };
    /**
     * 批量追加绑定对象，追加之后将最后一个追加的绑定对象设置为当前行。
     * @param objects 要加载绑定对象数组
     */
    BindingList.prototype.append = function (objects, isCloned) {
        var _this = this;
        if (isCloned === void 0) { isCloned = false; }
        if (objects.length === 0) {
            return;
        }
        // 加载BindingObject
        objects.forEach(function (object) {
            _this.add(object);
        });
        // 当前行为新追加的最后1行
        var lastId = objects[objects.length - 1][this.primaryKey];
        this.setCurrentId(lastId, true, true);
        // 触发事件
        var change = {
            type: ChangeType.Append,
            path: [],
            value: objects
        };
        if (isCloned) {
            change.isCloned = true;
        }
        this.changes.next(change);
    };
    /**
     * 增加数据
     * @param objects 实体
     * @description 增加实体数据，但不切换当前行
     */
    BindingList.prototype.addData = function (objects) {
        var _this = this;
        if (objects.length === 0) {
            return;
        }
        // 加载BindingObject
        objects.forEach(function (object) {
            _this.add(object);
        });
        // 触发事件
        this.changes.next({
            type: ChangeType.Append,
            path: [],
            value: objects
        });
    };
    BindingList.prototype.insert = function (object, position) {
        var _this = this;
        var currentIndex = this.innerList.findIndex(function (obj) { return obj.primaryKeyValue === _this.currentId; });
        // 加载BindingObject
        if (position === 1) {
            this.innerList = this.innerList.insert(currentIndex + 1, object);
        }
        else if (position === -1) {
            this.innerList = this.innerList.insert(currentIndex, object);
        }
        else {
            this.innerList = this.innerList.push(object);
        }
        object.parent = this;
        // 监听object变更，并继续向上抛，由于list有当前行的概念，不需要在path中追加路径
        object.changes.subscribe(function (change) {
            _this.changes.next(change);
        });
        this.setCurrentId(object.primaryKeyValue, true, true);
        // 触发事件
        this.changes.next({
            type: ChangeType.Append,
            path: [],
            value: object
        });
    };
    /**
     * 添加绑定对象，并建立绑定对象和绑定列表之间的关联。
     * @param object 绑定对象
     */
    BindingList.prototype.add = function (object) {
        var _this = this;
        this.innerList = this.innerList.push(object);
        object.parent = this;
        // 监听object变更，并继续向上抛，由于list有当前行的概念，不需要在path中追加路径
        object.changes.subscribe(function (change) {
            _this.changes.next(change);
        });
    };
    /**
     * 删除主键值数组对应的绑定对象。
     * @param ids 主键值数组
     */
    BindingList.prototype.removeByIds = function (ids) {
        var _this = this;
        if (!ids || ids.length === 0) {
            return;
        }
        var nextCurrentId = this.currentId;
        ids.forEach(function (id) {
            // 如果当前行被删除，计算下一当前行
            if (id === nextCurrentId) {
                nextCurrentId = _this.getCurrentIdBeforeDeleting();
            }
            // 删除对象，找不到时跳过
            var index = _this.getIndexById(id);
            if (index === -1) {
                return;
            }
            _this.innerList = _this.innerList.delete(index);
        });
        // 重新设置当前行
        if (this.innerList.count() === 0) {
            this.currentId = null;
        }
        else {
            this.setCurrentId(nextCurrentId, false, false);
        }
        // 出发行删除事件
        this.changes.next({
            type: ChangeType.Remove,
            path: [],
            value: ids
        });
    };
    /**
     * 删除数据（不切换当前行）
     * @param ids ids
     */
    BindingList.prototype.removeDataByIds = function (ids) {
        var _this = this;
        if (!ids || ids.length === 0) {
            return;
        }
        ids.forEach(function (id) {
            // 删除对象，找不到时跳过
            var index = _this.getIndexById(id);
            if (index === -1) {
                return;
            }
            _this.innerList = _this.innerList.delete(index);
        });
        // 出发行删除事件
        this.changes.next({
            type: ChangeType.Remove,
            path: [],
            value: ids
        });
    };
    /**
     * 清空
     */
    BindingList.prototype.clear = function (clearOnly) {
        if (clearOnly === void 0) { clearOnly = false; }
        this.innerList.forEach(function (item) {
            item['_ENTITY_'] = null;
            item.unsubscribe.next();
            item.unsubscribe.complete();
            item.changes.complete();
            item.viewChanges.complete();
        });
        this.innerList = this.innerList.clear();
        if (!clearOnly) {
            this.currentId = null;
            this.changes.next({
                type: ChangeType.Remove,
                path: [],
                value: []
            });
        }
    };
    /**
     * 如果当前行被删除，删除之前重新计算当前行的位置，并返回下一当前行的主键值。
     * - 如果被删除的行是最后1行，则上移1行；
     * - 其他情况，下移1行。
     */
    BindingList.prototype.getCurrentIdBeforeDeleting = function () {
        var nextIndex = -1;
        var currentIndex = this.getIndexById(this.currentId);
        if (currentIndex === this.length - 1) {
            nextIndex = currentIndex - 1;
        }
        else {
            nextIndex = currentIndex + 1;
        }
        return this.getIdByIndex(nextIndex);
    };
    /**
     * 根据主键值获取对应绑定对象
     * @param   id 要查找的主键值
     * @returns 找到时返回对应BindingObject， 找不到时返回null
     */
    BindingList.prototype.findById = function (id) {
        var _this = this;
        var target;
        target = this.innerList.find(function (item) {
            return item.getValue(_this.primaryKey) === id;
        });
        return target === undefined ? null : target;
    };
    /**
     * 将主键值为id的绑定对象设置为当前行
     * @param  id        要设置的主键值
     * @param  emitEvent 是否发送当前行变更事件
     * @param  force 强制切换
     */
    BindingList.prototype.setCurrentId = function (id, emitEvent, emitGlobalEvent, force) {
        if (emitEvent === void 0) { emitEvent = true; }
        if (emitGlobalEvent === void 0) { emitGlobalEvent = true; }
        if (force === void 0) { force = false; }
        if (this.currentId === id && !force) {
            return;
        }
        // 不存在时设置为null
        // const currentObj = this.findById(id);
        // if (!currentObj) {
        //   this.currentId = null;
        // } else {
        //   this.currentId = id;
        // }
        // @todo：找不到时按理应该设置为null，目前是直接返回，框架部分功能依赖该特性。
        var currentObj = this.findById(id);
        if (!currentObj && !force) {
            return;
        }
        this.currentId = id;
        // 发出行切换事件
        if (emitEvent === true) {
            this.changes.next({
                type: ChangeType.SelectionChanged,
                path: [],
                value: this.currentItem,
                force: force
            });
        }
        // 是否发送全局的行切换事件
        if (emitGlobalEvent === true) {
            this.changes.next({
                type: ChangeType.GlobalSelectionChanged,
                path: [],
                value: this.currentItem,
                force: force
            });
        }
    };
    /**
     * 根据主键值为id的绑定对象的索引
     * @param id 主键值
     * @returns 找到时返回对应的index，找不到时返回-1
     */
    BindingList.prototype.getIndexById = function (id) {
        var _this = this;
        return this.innerList.findIndex(function (obj) {
            return obj[_this.primaryKey] === id;
        });
    };
    /**
     * 根据索引位置获取对应绑定对象的主键值
     * @reutrn 找到时返回对应主键值，找不到返回null
     */
    BindingList.prototype.getIdByIndex = function (index) {
        if (index < 0 || index > this.length) {
            return null;
        }
        if (this.innerList.has(index) === false) {
            return null;
        }
        var obj = this.innerList.get(index);
        return obj[this.primaryKey];
    };
    /**
     * 转换为BindingObject数组
     */
    BindingList.prototype.toArray = function () {
        return this.innerList.toArray();
    };
    /**
     * 交互数据位置
     * @param id1 id1
     * @param id2 id2
     */
    BindingList.prototype.swapById = function (id1, id2) {
        var item1 = this.innerList.find(function (element) { return element.primaryKeyValue === id1; });
        var item2 = this.innerList.find(function (element) { return element.primaryKeyValue === id2; });
        this.innerList = this.innerList.map(function (bindingObject, index) {
            if (bindingObject.primaryKeyValue === id1) {
                return item2;
            }
            else if (bindingObject.primaryKeyValue === id2) {
                return item1;
            }
            else
                return bindingObject;
        }).toList();
        this.changes.next({
            type: ChangeType.Swap,
            path: []
        });
    };
    /**
     * 转换为JSON对象
     * @returns 普通对象数组
     */
    BindingList.prototype.toJSON = function (options) {
        var result = [];
        this.innerList.forEach(function (obj) {
            result.push(obj.toJSON(options));
        });
        return result;
    };
    /**
     * 获取分页信息
     * @param path 路径
     * @param defaultValue 默认值
     */
    BindingList.prototype.getPaginationConfigByPath = function (path, defaultValue) {
        if (!path || path === '/') {
            return this.paginationInfo;
        }
        if (typeof path !== 'string') {
            throw new Error('路径必须为字符串！');
        }
        path = path.substring(1);
        var paths = path.split('/').filter(function (item) { return !!item && item.trim().length > 0; }).map(function (item) { return item.trim(); });
        var config = this.paginationInfo;
        paths.forEach(function (item) {
            if (config && config.hasOwnProperty(item)) {
                config = config[item];
            }
            else {
                config = null;
            }
        });
        return !!config ? config : typeof defaultValue !== 'undefined' ? defaultValue : undefined;
    };
    /**
     * 对bindingList就行排序
     * @param string 排序字段
     * @param directions 排序规则字段
     * @param options 参数
     */
    BindingList.prototype.sortBy = function (fields, directions, options) {
        var _this = this;
        if (!fields || fields.length < 1 || !directions || directions.length < 1) {
            throw new Error('sortBy:argument error');
        }
        // 默认升序
        var arrFields = typeof fields === 'string' ? fields.split(',') : fields || [];
        var arrDirections = typeof directions === 'string' ? directions.split(',') : directions || [];
        // 排序字段和排序方式应一致
        if (arrFields.length !== arrDirections.length || arrFields.length < 1) {
            throw new Error('sortBy:fields and directions not match');
        }
        // nage,age,total
        var comparator = function (props, orders) { return function (item1, item2) {
            return props.reduce(function (result, prop) {
                if (result === 0) {
                    var bindingProperty = _this.properties.find(function (item) { return item.name === prop; });
                    var isMultiLangProp = false;
                    if (bindingProperty) {
                        isMultiLangProp = bindingProperty.enableMultiLangInput;
                    }
                    var currentLanguage = TranslateService.getCurrentLanguage();
                    var order = ['asc'].includes(orders[props.indexOf(prop)]) ? 1 : -1;
                    var item1Value = _this.getValue(item1, prop, isMultiLangProp, currentLanguage);
                    var item2Value = _this.getValue(item2, prop, isMultiLangProp, currentLanguage);
                    if (item1Value === null || item1Value === undefined) {
                        item1Value = '';
                    }
                    if (item2Value === null || item2Value === undefined) {
                        item2Value = '';
                    }
                    if (typeof item1Value === 'string' && typeof item2Value === 'string') {
                        var localeCompareResult = item1Value.localeCompare(item2Value);
                        result = localeCompareResult * order;
                    }
                    else {
                        if (item1Value > item2Value) {
                            result = order * 1;
                        }
                        if (item1Value < item2Value) {
                            result = order * -1;
                        }
                    }
                }
                return result;
            }, 0);
        }; };
        this.innerList = this.innerList.sort(comparator(arrFields, arrDirections)).toList();
    };
    BindingList.prototype.getValue = function (target, propName, isMultiLangProp, currentLanguage) {
        if (isMultiLangProp === void 0) { isMultiLangProp = false; }
        if (currentLanguage === void 0) { currentLanguage = 'zh-CHS'; }
        var e_1, _a;
        if (target instanceof BindingList) {
            target = target.currentItem;
        }
        else if (target instanceof BindingData) {
            target = target.list.currentItem;
        }
        var result = null;
        if (propName.indexOf('.') === -1) {
            result = target[propName];
        }
        else {
            var props = propName.split('.');
            try {
                for (var props_1 = tslib_1.__values(props), props_1_1 = props_1.next(); !props_1_1.done; props_1_1 = props_1.next()) {
                    var prop = props_1_1.value;
                    target = result = this.getValue(target, prop, isMultiLangProp, currentLanguage);
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (props_1_1 && !props_1_1.done && (_a = props_1.return)) _a.call(props_1);
                }
                finally { if (e_1) throw e_1.error; }
            }
        }
        if (isMultiLangProp && result && result.hasOwnProperty(currentLanguage)) {
            return result[currentLanguage];
        }
        else {
            return result;
        }
    };
    return BindingList;
}());
export { BindingList };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmluZGluZ19saXN0LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9kZXZraXQvIiwic291cmNlcyI6WyJsaWIvYmluZGluZy1kYXRhL2JpbmRpbmdfbGlzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0dBR0c7O0FBRUgsa0NBQWtDO0FBRWxDLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFDakMsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUUvQixPQUFPLEVBQVUsVUFBVSxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBRy9DLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQ2hFLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUMvQyxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDN0MsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFHN0Q7O0dBRUc7QUFDSDtJQTJJRTs7T0FFRztJQUNILHFCQUFZLFVBQTZCO1FBN0lsQyxhQUFRLEdBQUcsYUFBYSxDQUFDO1FBcUNoQyxjQUFjO1FBRWQ7O1dBRUc7UUFDSSxvQkFBZSxHQUFRLElBQUksQ0FBQztRQW9HakMsSUFBSSxDQUFDLFVBQVUsR0FBRyxVQUFVLENBQUM7UUFDN0IsSUFBSSxDQUFDLFVBQVUsR0FBRyxZQUFZLENBQUMsYUFBYSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBRXpELElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxPQUFPLEVBQVUsQ0FBQztRQUNyQyxJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksRUFBaUIsQ0FBQztRQUN2QyxJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQztRQUN0QixJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksT0FBTyxFQUFFLENBQUM7SUFDaEMsQ0FBQztJQXpHRCxzQkFBSSx1Q0FBYzthQVlsQjtZQUNFLE9B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O1lBQ2pDLE1BQU0sR0FBRyxNQUFNLENBQUMsV0FBVyxDQUFDO1NBQzdCO2FBQU0sSUFBSSxNQUFNLFlBQVksV0FBVyxFQUFFO1lBQ3hDLE1BQU0sR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQztTQUNsQztRQUNELElBQUksTUFBTSxHQUFHLElBQUksQ0FBQztRQUNsQixJQUFJLFFBQVEsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUU7WUFDaEMsTUFBTSxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQztTQUMzQjthQUFNO1lBQ0wsSUFBTSxLQUFLLEdBQUcsUUFBUSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQzs7Z0JBQ2xDLEtBQW1CLElBQUEsVUFBQSxpQkFBQSxLQUFLLENBQUEsNEJBQUEsK0NBQUU7b0JBQXJCLElBQU0sSUFBSSxrQkFBQTtvQkFDYixNQUFNLEdBQUcsTUFBTSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFLElBQUksRUFBRSxlQUFlLEVBQUUsZUFBZSxDQUFDLENBQUM7aUJBQ2pGOzs7Ozs7Ozs7U0FDRjtRQUNELElBQUksZUFBZSxJQUFJLE1BQU0sSUFBSSxNQUFNLENBQUMsY0FBYyxDQUFDLGVBQWUsQ0FBQyxFQUFFO1lBQ3ZFLE9BQU8sTUFBTSxDQUFDLGVBQWUsQ0FBQyxDQUFDO1NBQ2hDO2FBQU07WUFDTCxPQUFPLE1BQU0sQ0FBQztTQUNmO0lBQ0gsQ0FBQztJQUNILGtCQUFDO0FBQUQsQ0FBQyxBQTVtQkQsSUE0bUJDO0FBRUQsT0FBTyxFQUFFLFdBQVcsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIOe7keWumuWIl+ihqOebuOWFs+WumuS5iVxyXG4gKiBAYXV0aG9yIFdpdHQ8aml3dEBpbnNwdXIuY29tPlxyXG4gKi9cclxuXHJcbi8vIHRzbGludDpkaXNhYmxlOiBtYXgtbGluZS1sZW5ndGhcclxuXHJcbmltcG9ydCB7IExpc3QgfSBmcm9tICdpbW11dGFibGUnO1xyXG5pbXBvcnQgeyBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcblxyXG5pbXBvcnQgeyBDaGFuZ2UsIENoYW5nZVR5cGUgfSBmcm9tICcuL2NoYW5nZXMnO1xyXG5pbXBvcnQgeyBCaW5kaW5nT2JqZWN0IH0gZnJvbSAnLi9iaW5kaW5nX29iamVjdCc7XHJcbmltcG9ydCB7IEJpbmRpbmdQcm9wZXJ0eSB9IGZyb20gJy4vYmluZGluZ19wcm9wZXJ0eSc7XHJcbmltcG9ydCB7IEJpbmRpbmdPYmplY3RGYWN0b3J5IH0gZnJvbSAnLi9iaW5kaW5nX29iamVjdF9mYWN0b3J5JztcclxuaW1wb3J0IHsgUHJvcGVydHlVdGlsIH0gZnJvbSAnLi9wcm9wZXJ0eV91dGlsJztcclxuaW1wb3J0IHsgQmluZGluZ0RhdGEgfSBmcm9tICcuL2JpbmRpbmdfZGF0YSc7XHJcbmltcG9ydCB7IFRyYW5zbGF0ZVNlcnZpY2UgfSBmcm9tICcuLi9pMThuL3RyYW5zbGF0ZV9zZXJ2aWNlJztcclxuaW1wb3J0IHsgSURpc3Bvc2FibGUgfSBmcm9tICcuLi9jb3JlJztcclxuXHJcbi8qKlxyXG4gKiBCaW5kaW5nTGlzdOaYr+S4gOS4qkJpbmRpbmdPYmplY3Tpm4blkIhcclxuICovXHJcbmNsYXNzIEJpbmRpbmdMaXN0IGltcGxlbWVudHMgSURpc3Bvc2FibGUge1xyXG4gIHB1YmxpYyBfX3R5cGVfXyA9ICdCaW5kaW5nTGlzdCc7XHJcbiAgLyoqXHJcbiAgICogaW1tdXRhYmxl55qEQmluZGluZ09iamVjdOWIl+ihqFxyXG4gICAqL1xyXG4gIHByaXZhdGUgaW5uZXJMaXN0OiBMaXN0PEJpbmRpbmdPYmplY3Q+O1xyXG5cclxuICBwcml2YXRlIGVtcHR5Q3VycmVudEl0ZW06IEJpbmRpbmdPYmplY3Q7XHJcblxyXG4gIC8qKlxyXG4gICAqIOWFs+iBlOWunuS9k+eahOWxnuaAp+mbhuWQiFxyXG4gICAqL1xyXG4gIHB1YmxpYyBwcm9wZXJ0aWVzOiBCaW5kaW5nUHJvcGVydHlbXTtcclxuXHJcbiAgLyoqXHJcbiAgICog5Li76ZSu5ZCNXHJcbiAgICovXHJcbiAgcHVibGljIHByaW1hcnlLZXk6IHN0cmluZztcclxuXHJcbiAgLyoqXHJcbiAgICog54i25a+56LGhXHJcbiAgICovXHJcbiAgcHVibGljIHBhcmVudDogQmluZGluZ09iamVjdDtcclxuXHJcbiAgLyoqXHJcbiAgICog5Y+Y5pu05rWBXHJcbiAgICovXHJcbiAgcHVibGljIGNoYW5nZXM6IFN1YmplY3Q8Q2hhbmdlPjtcclxuXHJcbiAgLyoqXHJcbiAgICog5b2T5YmN6KGM5a+55bqU55qE57uR5a6a5a+56LGh55qE5YaF56CBXHJcbiAgICovXHJcbiAgcHVibGljIGN1cnJlbnRJZDogc3RyaW5nO1xyXG4gIC8qKlxyXG4gICAqIGRlc3Rvcnkgc2lnbmFsXHJcbiAgICovXHJcbiAgcHVibGljIGRlc3Ryb3kkOiBTdWJqZWN0PGFueT47XHJcblxyXG4gIC8vI3JlZ2lvbiDliIbpobXnm7jlhbNcclxuXHJcbiAgLyoqXHJcbiAgICog5YiG6aG15L+h5oGvXHJcbiAgICovXHJcbiAgcHVibGljIF9wYWdpbmF0aW9uSW5mbzogYW55ID0gbnVsbDtcclxuXHJcbiAgc2V0IHBhZ2luYXRpb25JbmZvKHNQYWdpbmF0aW9uSW5mbzogYW55KSB7XHJcbiAgICB0aGlzLl9wYWdpbmF0aW9uSW5mbyA9IHNQYWdpbmF0aW9uSW5mbztcclxuICAgIGlmICh0aGlzLl9wYWdpbmF0aW9uSW5mbyA9PT0gc1BhZ2luYXRpb25JbmZvKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHRoaXMuY2hhbmdlcy5uZXh0KHtcclxuICAgICAgdHlwZTogQ2hhbmdlVHlwZS5QYWdpbmF0aW9uSW5mb0NoYW5nZSxcclxuICAgICAgcGF0aDogW10sXHJcbiAgICAgIHZhbHVlOiB0aGlzLl9wYWdpbmF0aW9uSW5mb1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBnZXQgcGFnaW5hdGlvbkluZm8oKTogYW55IHtcclxuICAgIHJldHVybiB0aGlzLl9wYWdpbmF0aW9uSW5mbztcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6I635Y+W6aG156CBXHJcbiAgICovXHJcbiAgZ2V0IHBhZ2VJbmRleCgpIHtcclxuICAgIGlmICghIXRoaXMucGFnaW5hdGlvbkluZm8gJiYgdGhpcy5wYWdpbmF0aW9uSW5mby5oYXNPd25Qcm9wZXJ0eShcInBhZ2VJbmRleFwiKSkge1xyXG4gICAgICByZXR1cm4gdGhpcy5wYWdpbmF0aW9uSW5mby5wYWdlSW5kZXg7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gMTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6I635Y+W5YiG6aG15aSn5bCPXHJcbiAgICovXHJcbiAgZ2V0IHBhZ2VTaXplKCkge1xyXG4gICAgaWYgKCEhdGhpcy5wYWdpbmF0aW9uSW5mbyAmJiB0aGlzLnBhZ2luYXRpb25JbmZvLmhhc093blByb3BlcnR5KFwicGFnZVNpemVcIikpIHtcclxuICAgICAgcmV0dXJuIHRoaXMucGFnaW5hdGlvbkluZm8ucGFnZVNpemU7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gMDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluaVsOaNruaAu+mhueaVsFxyXG4gICAqL1xyXG4gIGdldCB0b3RhbCgpIHtcclxuICAgIGlmICghIXRoaXMucGFnaW5hdGlvbkluZm8pIHtcclxuICAgICAgcmV0dXJuIHRoaXMucGFnaW5hdGlvbkluZm8udG90YWwgfHwgdGhpcy5wYWdpbmF0aW9uSW5mby50b3RhbENvdW50O1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIDA7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiOt+WPlui3s+i/h+eahOaVsOaNruadoeaVsFxyXG4gICAqL1xyXG4gIGdldCBza2lwKCkge1xyXG4gICAgY29uc3QgcGFnZUluZGV4ID0gdGhpcy5wYWdlSW5kZXg7XHJcbiAgICBjb25zdCBwYWdlU2l6ZSA9IHRoaXMucGFnZVNpemU7XHJcbiAgICByZXR1cm4gKHBhZ2VJbmRleCAtIDEpICogcGFnZVNpemU7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDliY3lj7Dorr7nva7liIbpobXkv6Hmga9cclxuICAgKiBAcGFyYW0gc2tpcCBza2lwXHJcbiAgICogQHBhcmFtIHRha2UgdGFrZVxyXG4gICAqL1xyXG4gIHB1YmxpYyBzZXRQYWdpbmF0aW9uSW5mbyhza2lwOiBudW1iZXIsIHRha2U6IG51bWJlcikge1xyXG4gICAgdGhpcy5wYWdpbmF0aW9uSW5mbyA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMucGFnaW5hdGlvbkluZm8sIHtcclxuICAgICAgcGFnZVNpemU6IHRha2UsXHJcbiAgICAgIHBhZ2VJbmRleDogc2tpcCAvIHRha2UgKyAxXHJcbiAgICB9KTtcclxuICAgIC8qdGhpcy5jaGFuZ2VzLm5leHQoe1xyXG4gICAgICB0eXBlOiBDaGFuZ2VUeXBlLlBhZ2luYXRpb25JbmZvQ2hhbmdlLFxyXG4gICAgICBwYXRoOiBbXSxcclxuICAgICAgdmFsdWU6IHRoaXMucGFnaW5hdGlvbkluZm9cclxuICAgIH0pOyovXHJcbiAgfVxyXG4gIC8vI2VuZHJlZ2lvblxyXG5cclxuXHJcblxyXG4gIC8qKlxyXG4gICAqIOW9k+WJjeihjOWvueW6lOeahOe7keWumuWvueixoVxyXG4gICAqIOWmguaenGN1cnJlbnRJZOS4um51bGzvvIzliJnliJvlu7rkuIDkuKrnqbrnu5PmnoTvvIzpmLLmraLnu5HlrprmiqXplJnvvJtcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0IGN1cnJlbnRJdGVtKCk6IEJpbmRpbmdPYmplY3Qge1xyXG4gICAgY29uc3QgY3VycmVudEl0ZW0gPSB0aGlzLmZpbmRCeUlkKHRoaXMuY3VycmVudElkKTtcclxuICAgIGlmICghY3VycmVudEl0ZW0pIHtcclxuICAgICAgaWYgKCF0aGlzLmVtcHR5Q3VycmVudEl0ZW0pIHtcclxuICAgICAgICB0aGlzLmVtcHR5Q3VycmVudEl0ZW0gPSBCaW5kaW5nT2JqZWN0RmFjdG9yeS5jcmVhdGUodGhpcy5wcm9wZXJ0aWVzKTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gdGhpcy5lbXB0eUN1cnJlbnRJdGVtO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGN1cnJlbnRJdGVtO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog57uR5a6a5a+56LGh55qE5pWw6YePXHJcbiAgICovXHJcbiAgcHVibGljIGdldCBsZW5ndGgoKTogbnVtYmVyIHtcclxuICAgIHJldHVybiB0aGlzLmlubmVyTGlzdC5jb3VudCgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5p6E6YCg5Ye95pWwXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IocHJvcGVydGllczogQmluZGluZ1Byb3BlcnR5W10pIHtcclxuICAgIHRoaXMucHJvcGVydGllcyA9IHByb3BlcnRpZXM7XHJcbiAgICB0aGlzLnByaW1hcnlLZXkgPSBQcm9wZXJ0eVV0aWwuZ2V0UHJpbWFyeUtleShwcm9wZXJ0aWVzKTtcclxuXHJcbiAgICB0aGlzLmNoYW5nZXMgPSBuZXcgU3ViamVjdDxDaGFuZ2U+KCk7XHJcbiAgICB0aGlzLmlubmVyTGlzdCA9IExpc3Q8QmluZGluZ09iamVjdD4oKTtcclxuICAgIHRoaXMuY3VycmVudElkID0gbnVsbDtcclxuICAgIHRoaXMuZGVzdHJveSQgPSBuZXcgU3ViamVjdCgpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDplIDmr4FcclxuICAgKiBAcGFyYW0gb3B0aW9ucyBcclxuICAgKi9cclxuICBkaXNwb3NlKG9wdGlvbnM/OiBhbnkpIHtcclxuICAgIHRoaXMuY2xlYXIodHJ1ZSk7XHJcbiAgICBpZiAodGhpcy5kZXN0cm95JCkge1xyXG4gICAgICB0aGlzLmRlc3Ryb3kkLm5leHQoKTtcclxuICAgICAgdGhpcy5kZXN0cm95JC5jb21wbGV0ZSgpO1xyXG4gICAgICB0aGlzLmRlc3Ryb3kkID0gbnVsbDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOa3u+WKoFtTeW1ib2wuaXRlcmF0b3Jd77yM5L2/5LmL6IO96YCa6L+HZm9yIG9m6YGN5Y6GXHJcbiAgICovXHJcbiAgW1N5bWJvbC5pdGVyYXRvcl0oKSB7XHJcbiAgICBjb25zdCBzZWxmID0gdGhpcztcclxuICAgIGxldCBpbmRleCA9IC0xO1xyXG4gICAgY29uc3Qgc2l6ZSA9IHRoaXMuaW5uZXJMaXN0LnNpemU7XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgbmV4dDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGluZGV4Kys7XHJcbiAgICAgICAgaWYgKGluZGV4IDwgc2l6ZSkge1xyXG4gICAgICAgICAgcmV0dXJuIHsgZG9uZTogZmFsc2UsIHZhbHVlOiBzZWxmLmlubmVyTGlzdC5nZXQoaW5kZXgpIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB7IGRvbmU6IHRydWUsIHZhbHVlOiB1bmRlZmluZWQgfTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaJuemHj+WKoOi9vee7keWumuWvueixoe+8jOWKoOi9veS5i+WJjeWFiOa4heepuue7keWumuWIl+ihqO+8jOW5tumHjee9ruW9k+WJjeihjO+8jOWKoOi9veS5i+WQjuWwhuesrOS4gOihjOiuvue9ruS4uum7mOiupOW9k+WJjeihjOOAglxyXG4gICAqIEBwYXJhbSBvYmplY3RzIOimgeWKoOi9vee7keWumuWvueixoeaVsOe7hFxyXG4gICAqL1xyXG4gIHB1YmxpYyBsb2FkKG9iamVjdHM6IEJpbmRpbmdPYmplY3RbXSwgZW50aXR5Q3JlYXRlOiBib29sZWFuID0gZmFsc2UpOiB2b2lkIHtcclxuICAgIC8vIOmHjee9ruWIl+ihqFxyXG4gICAgdGhpcy5pbm5lckxpc3QgPSB0aGlzLmlubmVyTGlzdC5jbGVhcigpO1xyXG4gICAgaWYgKG9iamVjdHMubGVuZ3RoICE9PSAwKSB7XHJcbiAgICAgIC8vIOWKoOi9veaVsOaNrlxyXG4gICAgICBvYmplY3RzLmZvckVhY2goKG9iamVjdDogQmluZGluZ09iamVjdCkgPT4ge1xyXG4gICAgICAgIHRoaXMuYWRkKG9iamVjdCk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgLy8g6K6+572u6buY6K6k5b2T5YmN6KGMXHJcbiAgICAgIGNvbnN0IGN1cnJlbnRJdGVtID0gdGhpcy5maW5kQnlJZCh0aGlzLmN1cnJlbnRJZCk7XHJcbiAgICAgIGlmICghY3VycmVudEl0ZW0pIHtcclxuICAgICAgICBjb25zdCBmaXJzdElkID0gb2JqZWN0c1swXVt0aGlzLnByaW1hcnlLZXldO1xyXG4gICAgICAgIHRoaXMuc2V0Q3VycmVudElkKGZpcnN0SWQsIGZhbHNlLCBmYWxzZSk7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuY3VycmVudElkID0gbnVsbDtcclxuICAgIH1cclxuICAgIGNvbnN0IGNoYW5nZTogQ2hhbmdlID0ge1xyXG4gICAgICB0eXBlOiBDaGFuZ2VUeXBlLkxvYWQsXHJcbiAgICAgIHBhdGg6IFtdLFxyXG4gICAgICB2YWx1ZTogb2JqZWN0c1xyXG4gICAgfTtcclxuICAgIGNoYW5nZS5jcmVhdGUgPSBlbnRpdHlDcmVhdGU7XHJcbiAgICAvLyDop6blj5Hkuovku7ZcclxuICAgIHRoaXMuY2hhbmdlcy5uZXh0KGNoYW5nZSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmibnph4/ov73liqDnu5Hlrprlr7nosaHvvIzov73liqDkuYvlkI7lsIbmnIDlkI7kuIDkuKrov73liqDnmoTnu5Hlrprlr7nosaHorr7nva7kuLrlvZPliY3ooYzjgIJcclxuICAgKiBAcGFyYW0gb2JqZWN0cyDopoHliqDovb3nu5Hlrprlr7nosaHmlbDnu4RcclxuICAgKi9cclxuICBwdWJsaWMgYXBwZW5kKG9iamVjdHM6IEJpbmRpbmdPYmplY3RbXSwgaXNDbG9uZWQ6IGJvb2xlYW4gPSBmYWxzZSk6IHZvaWQge1xyXG4gICAgaWYgKG9iamVjdHMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIC8vIOWKoOi9vUJpbmRpbmdPYmplY3RcclxuICAgIG9iamVjdHMuZm9yRWFjaCgob2JqZWN0OiBCaW5kaW5nT2JqZWN0KSA9PiB7XHJcbiAgICAgIHRoaXMuYWRkKG9iamVjdCk7XHJcbiAgICB9KTtcclxuICAgIC8vIOW9k+WJjeihjOS4uuaWsOi/veWKoOeahOacgOWQjjHooYxcclxuICAgIGNvbnN0IGxhc3RJZCA9IG9iamVjdHNbb2JqZWN0cy5sZW5ndGggLSAxXVt0aGlzLnByaW1hcnlLZXldO1xyXG4gICAgdGhpcy5zZXRDdXJyZW50SWQobGFzdElkLCB0cnVlLCB0cnVlKTtcclxuICAgIC8vIOinpuWPkeS6i+S7tlxyXG4gICAgY29uc3QgY2hhbmdlOiBDaGFuZ2UgPSB7XHJcbiAgICAgIHR5cGU6IENoYW5nZVR5cGUuQXBwZW5kLFxyXG4gICAgICBwYXRoOiBbXSxcclxuICAgICAgdmFsdWU6IG9iamVjdHNcclxuICAgIH07XHJcbiAgICBpZiAoaXNDbG9uZWQpIHtcclxuICAgICAgY2hhbmdlLmlzQ2xvbmVkID0gdHJ1ZTtcclxuICAgIH1cclxuICAgIHRoaXMuY2hhbmdlcy5uZXh0KGNoYW5nZSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWinuWKoOaVsOaNrlxyXG4gICAqIEBwYXJhbSBvYmplY3RzIOWunuS9k1xyXG4gICAqIEBkZXNjcmlwdGlvbiDlop7liqDlrp7kvZPmlbDmja7vvIzkvYbkuI3liIfmjaLlvZPliY3ooYxcclxuICAgKi9cclxuICBwdWJsaWMgYWRkRGF0YShvYmplY3RzOiBCaW5kaW5nT2JqZWN0W10pOiB2b2lkIHtcclxuICAgIGlmIChvYmplY3RzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICAvLyDliqDovb1CaW5kaW5nT2JqZWN0XHJcbiAgICBvYmplY3RzLmZvckVhY2goKG9iamVjdDogQmluZGluZ09iamVjdCkgPT4ge1xyXG4gICAgICB0aGlzLmFkZChvYmplY3QpO1xyXG4gICAgfSk7XHJcbiAgICAvLyDop6blj5Hkuovku7ZcclxuICAgIHRoaXMuY2hhbmdlcy5uZXh0KHtcclxuICAgICAgdHlwZTogQ2hhbmdlVHlwZS5BcHBlbmQsXHJcbiAgICAgIHBhdGg6IFtdLFxyXG4gICAgICB2YWx1ZTogb2JqZWN0c1xyXG4gICAgfSk7XHJcbiAgfVxyXG4gIHB1YmxpYyBpbnNlcnQob2JqZWN0OiBCaW5kaW5nT2JqZWN0LCBwb3NpdGlvbj86IDEgfCAtMSkge1xyXG4gICAgY29uc3QgY3VycmVudEluZGV4ID0gdGhpcy5pbm5lckxpc3QuZmluZEluZGV4KChvYmo6IEJpbmRpbmdPYmplY3QpID0+IG9iai5wcmltYXJ5S2V5VmFsdWUgPT09IHRoaXMuY3VycmVudElkKTtcclxuICAgIC8vIOWKoOi9vUJpbmRpbmdPYmplY3RcclxuICAgIGlmIChwb3NpdGlvbiA9PT0gMSkge1xyXG4gICAgICB0aGlzLmlubmVyTGlzdCA9IHRoaXMuaW5uZXJMaXN0Lmluc2VydChjdXJyZW50SW5kZXggKyAxLCBvYmplY3QpO1xyXG4gICAgfSBlbHNlIGlmIChwb3NpdGlvbiA9PT0gLTEpIHtcclxuICAgICAgdGhpcy5pbm5lckxpc3QgPSB0aGlzLmlubmVyTGlzdC5pbnNlcnQoY3VycmVudEluZGV4LCBvYmplY3QpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5pbm5lckxpc3QgPSB0aGlzLmlubmVyTGlzdC5wdXNoKG9iamVjdCk7XHJcbiAgICB9XHJcbiAgICBvYmplY3QucGFyZW50ID0gdGhpcztcclxuICAgIC8vIOebkeWQrG9iamVjdOWPmOabtO+8jOW5tue7p+e7reWQkeS4iuaKm++8jOeUseS6jmxpc3TmnInlvZPliY3ooYznmoTmpoLlv7XvvIzkuI3pnIDopoHlnKhwYXRo5Lit6L+95Yqg6Lev5b6EXHJcbiAgICBvYmplY3QuY2hhbmdlcy5zdWJzY3JpYmUoKGNoYW5nZTogQ2hhbmdlKSA9PiB7XHJcbiAgICAgIHRoaXMuY2hhbmdlcy5uZXh0KGNoYW5nZSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICB0aGlzLnNldEN1cnJlbnRJZChvYmplY3QucHJpbWFyeUtleVZhbHVlLCB0cnVlLCB0cnVlKTtcclxuXHJcbiAgICAvLyDop6blj5Hkuovku7ZcclxuICAgIHRoaXMuY2hhbmdlcy5uZXh0KHtcclxuICAgICAgdHlwZTogQ2hhbmdlVHlwZS5BcHBlbmQsXHJcbiAgICAgIHBhdGg6IFtdLFxyXG4gICAgICB2YWx1ZTogb2JqZWN0XHJcbiAgICB9KTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5re75Yqg57uR5a6a5a+56LGh77yM5bm25bu656uL57uR5a6a5a+56LGh5ZKM57uR5a6a5YiX6KGo5LmL6Ze055qE5YWz6IGU44CCXHJcbiAgICogQHBhcmFtIG9iamVjdCDnu5Hlrprlr7nosaFcclxuICAgKi9cclxuICBwdWJsaWMgYWRkKG9iamVjdDogQmluZGluZ09iamVjdCkge1xyXG4gICAgdGhpcy5pbm5lckxpc3QgPSB0aGlzLmlubmVyTGlzdC5wdXNoKG9iamVjdCk7XHJcbiAgICBvYmplY3QucGFyZW50ID0gdGhpcztcclxuXHJcbiAgICAvLyDnm5HlkKxvYmplY3Tlj5jmm7TvvIzlubbnu6fnu63lkJHkuIrmipvvvIznlLHkuo5saXN05pyJ5b2T5YmN6KGM55qE5qaC5b+177yM5LiN6ZyA6KaB5ZyocGF0aOS4rei/veWKoOi3r+W+hFxyXG4gICAgb2JqZWN0LmNoYW5nZXMuc3Vic2NyaWJlKChjaGFuZ2U6IENoYW5nZSkgPT4ge1xyXG4gICAgICB0aGlzLmNoYW5nZXMubmV4dChjaGFuZ2UpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDliKDpmaTkuLvplK7lgLzmlbDnu4Tlr7nlupTnmoTnu5Hlrprlr7nosaHjgIJcclxuICAgKiBAcGFyYW0gaWRzIOS4u+mUruWAvOaVsOe7hFxyXG4gICAqL1xyXG4gIHB1YmxpYyByZW1vdmVCeUlkcyhpZHM6IEFycmF5PHN0cmluZz4pOiB2b2lkIHtcclxuICAgIGlmICghaWRzIHx8IGlkcy5sZW5ndGggPT09IDApIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGxldCBuZXh0Q3VycmVudElkID0gdGhpcy5jdXJyZW50SWQ7XHJcbiAgICBpZHMuZm9yRWFjaCgoaWQ6IHN0cmluZykgPT4ge1xyXG5cclxuICAgICAgLy8g5aaC5p6c5b2T5YmN6KGM6KKr5Yig6Zmk77yM6K6h566X5LiL5LiA5b2T5YmN6KGMXHJcbiAgICAgIGlmIChpZCA9PT0gbmV4dEN1cnJlbnRJZCkge1xyXG4gICAgICAgIG5leHRDdXJyZW50SWQgPSB0aGlzLmdldEN1cnJlbnRJZEJlZm9yZURlbGV0aW5nKCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIOWIoOmZpOWvueixoe+8jOaJvuS4jeWIsOaXtui3s+i/h1xyXG4gICAgICBjb25zdCBpbmRleCA9IHRoaXMuZ2V0SW5kZXhCeUlkKGlkKTtcclxuICAgICAgaWYgKGluZGV4ID09PSAtMSkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICB0aGlzLmlubmVyTGlzdCA9IHRoaXMuaW5uZXJMaXN0LmRlbGV0ZShpbmRleCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyDph43mlrDorr7nva7lvZPliY3ooYxcclxuICAgIGlmICh0aGlzLmlubmVyTGlzdC5jb3VudCgpID09PSAwKSB7XHJcbiAgICAgIHRoaXMuY3VycmVudElkID0gbnVsbDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuc2V0Q3VycmVudElkKG5leHRDdXJyZW50SWQsIGZhbHNlLCBmYWxzZSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5Ye65Y+R6KGM5Yig6Zmk5LqL5Lu2XHJcbiAgICB0aGlzLmNoYW5nZXMubmV4dCh7XHJcbiAgICAgIHR5cGU6IENoYW5nZVR5cGUuUmVtb3ZlLFxyXG4gICAgICBwYXRoOiBbXSxcclxuICAgICAgdmFsdWU6IGlkc1xyXG4gICAgfSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWIoOmZpOaVsOaNru+8iOS4jeWIh+aNouW9k+WJjeihjO+8iVxyXG4gICAqIEBwYXJhbSBpZHMgaWRzXHJcbiAgICovXHJcbiAgcHVibGljIHJlbW92ZURhdGFCeUlkcyhpZHM6IEFycmF5PHN0cmluZz4pOiB2b2lkIHtcclxuICAgIGlmICghaWRzIHx8IGlkcy5sZW5ndGggPT09IDApIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGlkcy5mb3JFYWNoKChpZDogc3RyaW5nKSA9PiB7XHJcbiAgICAgIC8vIOWIoOmZpOWvueixoe+8jOaJvuS4jeWIsOaXtui3s+i/h1xyXG4gICAgICBjb25zdCBpbmRleCA9IHRoaXMuZ2V0SW5kZXhCeUlkKGlkKTtcclxuICAgICAgaWYgKGluZGV4ID09PSAtMSkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICB0aGlzLmlubmVyTGlzdCA9IHRoaXMuaW5uZXJMaXN0LmRlbGV0ZShpbmRleCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyDlh7rlj5HooYzliKDpmaTkuovku7ZcclxuICAgIHRoaXMuY2hhbmdlcy5uZXh0KHtcclxuICAgICAgdHlwZTogQ2hhbmdlVHlwZS5SZW1vdmUsXHJcbiAgICAgIHBhdGg6IFtdLFxyXG4gICAgICB2YWx1ZTogaWRzXHJcbiAgICB9KTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5riF56m6XHJcbiAgICovXHJcbiAgcHVibGljIGNsZWFyKGNsZWFyT25seTogYm9vbGVhbiA9IGZhbHNlKSB7XHJcbiAgICB0aGlzLmlubmVyTGlzdC5mb3JFYWNoKChpdGVtOiBCaW5kaW5nT2JqZWN0KSA9PiB7XHJcbiAgICAgIGl0ZW1bJ19FTlRJVFlfJ10gPSBudWxsO1xyXG4gICAgICBpdGVtLnVuc3Vic2NyaWJlLm5leHQoKTtcclxuICAgICAgaXRlbS51bnN1YnNjcmliZS5jb21wbGV0ZSgpO1xyXG4gICAgICBpdGVtLmNoYW5nZXMuY29tcGxldGUoKTtcclxuICAgICAgaXRlbS52aWV3Q2hhbmdlcy5jb21wbGV0ZSgpO1xyXG4gICAgfSk7XHJcbiAgICB0aGlzLmlubmVyTGlzdCA9IHRoaXMuaW5uZXJMaXN0LmNsZWFyKCk7XHJcbiAgICBpZiAoIWNsZWFyT25seSkge1xyXG4gICAgICB0aGlzLmN1cnJlbnRJZCA9IG51bGw7XHJcbiAgICAgIHRoaXMuY2hhbmdlcy5uZXh0KHtcclxuICAgICAgICB0eXBlOiBDaGFuZ2VUeXBlLlJlbW92ZSxcclxuICAgICAgICBwYXRoOiBbXSxcclxuICAgICAgICB2YWx1ZTogW11cclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlpoLmnpzlvZPliY3ooYzooqvliKDpmaTvvIzliKDpmaTkuYvliY3ph43mlrDorqHnrpflvZPliY3ooYznmoTkvY3nva7vvIzlubbov5Tlm57kuIvkuIDlvZPliY3ooYznmoTkuLvplK7lgLzjgIJcclxuICAgKiAtIOWmguaenOiiq+WIoOmZpOeahOihjOaYr+acgOWQjjHooYzvvIzliJnkuIrnp7sx6KGM77ybXHJcbiAgICogLSDlhbbku5bmg4XlhrXvvIzkuIvnp7sx6KGM44CCXHJcbiAgICovXHJcbiAgcHVibGljIGdldEN1cnJlbnRJZEJlZm9yZURlbGV0aW5nKCk6IHN0cmluZyB7XHJcbiAgICBsZXQgbmV4dEluZGV4ID0gLTE7XHJcbiAgICBjb25zdCBjdXJyZW50SW5kZXggPSB0aGlzLmdldEluZGV4QnlJZCh0aGlzLmN1cnJlbnRJZCk7XHJcbiAgICBpZiAoY3VycmVudEluZGV4ID09PSB0aGlzLmxlbmd0aCAtIDEpIHtcclxuICAgICAgbmV4dEluZGV4ID0gY3VycmVudEluZGV4IC0gMTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIG5leHRJbmRleCA9IGN1cnJlbnRJbmRleCArIDE7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGhpcy5nZXRJZEJ5SW5kZXgobmV4dEluZGV4KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOagueaNruS4u+mUruWAvOiOt+WPluWvueW6lOe7keWumuWvueixoVxyXG4gICAqIEBwYXJhbSAgIGlkIOimgeafpeaJvueahOS4u+mUruWAvFxyXG4gICAqIEByZXR1cm5zIOaJvuWIsOaXtui/lOWbnuWvueW6lEJpbmRpbmdPYmplY3TvvIwg5om+5LiN5Yiw5pe26L+U5ZuebnVsbFxyXG4gICAqL1xyXG4gIHB1YmxpYyBmaW5kQnlJZChpZDogc3RyaW5nKTogQmluZGluZ09iamVjdCB8IG51bGwge1xyXG4gICAgbGV0IHRhcmdldDogQmluZGluZ09iamVjdDtcclxuICAgIHRhcmdldCA9IHRoaXMuaW5uZXJMaXN0LmZpbmQoKGl0ZW0pID0+IHtcclxuICAgICAgcmV0dXJuIGl0ZW0uZ2V0VmFsdWUodGhpcy5wcmltYXJ5S2V5KSA9PT0gaWQ7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiB0YXJnZXQgPT09IHVuZGVmaW5lZCA/IG51bGwgOiB0YXJnZXQ7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlsIbkuLvplK7lgLzkuLppZOeahOe7keWumuWvueixoeiuvue9ruS4uuW9k+WJjeihjFxyXG4gICAqIEBwYXJhbSAgaWQgICAgICAgIOimgeiuvue9rueahOS4u+mUruWAvFxyXG4gICAqIEBwYXJhbSAgZW1pdEV2ZW50IOaYr+WQpuWPkemAgeW9k+WJjeihjOWPmOabtOS6i+S7tlxyXG4gICAqIEBwYXJhbSAgZm9yY2Ug5by65Yi25YiH5o2iXHJcbiAgICovXHJcbiAgcHVibGljIHNldEN1cnJlbnRJZChpZDogc3RyaW5nLCBlbWl0RXZlbnQ6IGJvb2xlYW4gPSB0cnVlLCBlbWl0R2xvYmFsRXZlbnQ6IGJvb2xlYW4gPSB0cnVlLCBmb3JjZTogYm9vbGVhbiA9IGZhbHNlKTogdm9pZCB7XHJcbiAgICBpZiAodGhpcy5jdXJyZW50SWQgPT09IGlkICYmICFmb3JjZSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5LiN5a2Y5Zyo5pe26K6+572u5Li6bnVsbFxyXG4gICAgLy8gY29uc3QgY3VycmVudE9iaiA9IHRoaXMuZmluZEJ5SWQoaWQpO1xyXG4gICAgLy8gaWYgKCFjdXJyZW50T2JqKSB7XHJcbiAgICAvLyAgIHRoaXMuY3VycmVudElkID0gbnVsbDtcclxuICAgIC8vIH0gZWxzZSB7XHJcbiAgICAvLyAgIHRoaXMuY3VycmVudElkID0gaWQ7XHJcbiAgICAvLyB9XHJcblxyXG4gICAgLy8gQHRvZG/vvJrmib7kuI3liLDml7bmjInnkIblupTor6Xorr7nva7kuLpudWxs77yM55uu5YmN5piv55u05o6l6L+U5Zue77yM5qGG5p626YOo5YiG5Yqf6IO95L6d6LWW6K+l54m55oCn44CCXHJcbiAgICBjb25zdCBjdXJyZW50T2JqID0gdGhpcy5maW5kQnlJZChpZCk7XHJcbiAgICBpZiAoIWN1cnJlbnRPYmogJiYgIWZvcmNlKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHRoaXMuY3VycmVudElkID0gaWQ7XHJcblxyXG4gICAgLy8g5Y+R5Ye66KGM5YiH5o2i5LqL5Lu2XHJcbiAgICBpZiAoZW1pdEV2ZW50ID09PSB0cnVlKSB7XHJcbiAgICAgIHRoaXMuY2hhbmdlcy5uZXh0KHtcclxuICAgICAgICB0eXBlOiBDaGFuZ2VUeXBlLlNlbGVjdGlvbkNoYW5nZWQsXHJcbiAgICAgICAgcGF0aDogW10sXHJcbiAgICAgICAgdmFsdWU6IHRoaXMuY3VycmVudEl0ZW0sXHJcbiAgICAgICAgZm9yY2VcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5piv5ZCm5Y+R6YCB5YWo5bGA55qE6KGM5YiH5o2i5LqL5Lu2XHJcbiAgICBpZiAoZW1pdEdsb2JhbEV2ZW50ID09PSB0cnVlKSB7XHJcbiAgICAgIHRoaXMuY2hhbmdlcy5uZXh0KHtcclxuICAgICAgICB0eXBlOiBDaGFuZ2VUeXBlLkdsb2JhbFNlbGVjdGlvbkNoYW5nZWQsXHJcbiAgICAgICAgcGF0aDogW10sXHJcbiAgICAgICAgdmFsdWU6IHRoaXMuY3VycmVudEl0ZW0sXHJcbiAgICAgICAgZm9yY2VcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmoLnmja7kuLvplK7lgLzkuLppZOeahOe7keWumuWvueixoeeahOe0ouW8lVxyXG4gICAqIEBwYXJhbSBpZCDkuLvplK7lgLxcclxuICAgKiBAcmV0dXJucyDmib7liLDml7bov5Tlm57lr7nlupTnmoRpbmRleO+8jOaJvuS4jeWIsOaXtui/lOWbni0xXHJcbiAgICovXHJcbiAgcHVibGljIGdldEluZGV4QnlJZChpZDogc3RyaW5nKTogbnVtYmVyIHtcclxuICAgIHJldHVybiB0aGlzLmlubmVyTGlzdC5maW5kSW5kZXgoKG9iajogQmluZGluZ09iamVjdCkgPT4ge1xyXG4gICAgICByZXR1cm4gb2JqW3RoaXMucHJpbWFyeUtleV0gPT09IGlkO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmoLnmja7ntKLlvJXkvY3nva7ojrflj5blr7nlupTnu5Hlrprlr7nosaHnmoTkuLvplK7lgLxcclxuICAgKiBAcmV1dHJuIOaJvuWIsOaXtui/lOWbnuWvueW6lOS4u+mUruWAvO+8jOaJvuS4jeWIsOi/lOWbnm51bGxcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0SWRCeUluZGV4KGluZGV4OiBudW1iZXIpOiBzdHJpbmcge1xyXG5cclxuICAgIGlmIChpbmRleCA8IDAgfHwgaW5kZXggPiB0aGlzLmxlbmd0aCkge1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodGhpcy5pbm5lckxpc3QuaGFzKGluZGV4KSA9PT0gZmFsc2UpIHtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcbiAgICBjb25zdCBvYmogPSB0aGlzLmlubmVyTGlzdC5nZXQoaW5kZXgpO1xyXG4gICAgcmV0dXJuIG9ialt0aGlzLnByaW1hcnlLZXldO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6L2s5o2i5Li6QmluZGluZ09iamVjdOaVsOe7hFxyXG4gICAqL1xyXG4gIHB1YmxpYyB0b0FycmF5KCk6IEJpbmRpbmdPYmplY3RbXSB7XHJcbiAgICByZXR1cm4gdGhpcy5pbm5lckxpc3QudG9BcnJheSgpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDkuqTkupLmlbDmja7kvY3nva5cclxuICAgKiBAcGFyYW0gaWQxIGlkMVxyXG4gICAqIEBwYXJhbSBpZDIgaWQyXHJcbiAgICovXHJcbiAgcHVibGljIHN3YXBCeUlkKGlkMTogYW55LCBpZDI6IGFueSkge1xyXG4gICAgY29uc3QgaXRlbTEgPSB0aGlzLmlubmVyTGlzdC5maW5kKGVsZW1lbnQgPT4gZWxlbWVudC5wcmltYXJ5S2V5VmFsdWUgPT09IGlkMSk7XHJcbiAgICBjb25zdCBpdGVtMiA9IHRoaXMuaW5uZXJMaXN0LmZpbmQoZWxlbWVudCA9PiBlbGVtZW50LnByaW1hcnlLZXlWYWx1ZSA9PT0gaWQyKTtcclxuICAgIHRoaXMuaW5uZXJMaXN0ID0gdGhpcy5pbm5lckxpc3QubWFwKChiaW5kaW5nT2JqZWN0OiBCaW5kaW5nT2JqZWN0LCBpbmRleDogbnVtYmVyKSA9PiB7XHJcbiAgICAgIGlmIChiaW5kaW5nT2JqZWN0LnByaW1hcnlLZXlWYWx1ZSA9PT0gaWQxKSB7XHJcbiAgICAgICAgcmV0dXJuIGl0ZW0yO1xyXG4gICAgICB9IGVsc2UgaWYgKGJpbmRpbmdPYmplY3QucHJpbWFyeUtleVZhbHVlID09PSBpZDIpIHtcclxuICAgICAgICByZXR1cm4gaXRlbTE7XHJcbiAgICAgIH0gZWxzZSByZXR1cm4gYmluZGluZ09iamVjdDtcclxuICAgIH0pLnRvTGlzdCgpO1xyXG4gICAgdGhpcy5jaGFuZ2VzLm5leHQoe1xyXG4gICAgICB0eXBlOiBDaGFuZ2VUeXBlLlN3YXAsXHJcbiAgICAgIHBhdGg6IFtdXHJcbiAgICB9KTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6L2s5o2i5Li6SlNPTuWvueixoVxyXG4gICAqIEByZXR1cm5zIOaZrumAmuWvueixoeaVsOe7hFxyXG4gICAqL1xyXG4gIHB1YmxpYyB0b0pTT04ob3B0aW9ucz86IGFueSk6IGFueVtdIHtcclxuICAgIGNvbnN0IHJlc3VsdCA9IFtdO1xyXG4gICAgdGhpcy5pbm5lckxpc3QuZm9yRWFjaCgob2JqOiBCaW5kaW5nT2JqZWN0KSA9PiB7XHJcbiAgICAgIHJlc3VsdC5wdXNoKG9iai50b0pTT04ob3B0aW9ucykpO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+W5YiG6aG15L+h5oGvXHJcbiAgICogQHBhcmFtIHBhdGgg6Lev5b6EXHJcbiAgICogQHBhcmFtIGRlZmF1bHRWYWx1ZSDpu5jorqTlgLxcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0UGFnaW5hdGlvbkNvbmZpZ0J5UGF0aChwYXRoOiBzdHJpbmcsIGRlZmF1bHRWYWx1ZT86IGFueSkge1xyXG4gICAgaWYgKCFwYXRoIHx8IHBhdGggPT09ICcvJykge1xyXG4gICAgICByZXR1cm4gdGhpcy5wYWdpbmF0aW9uSW5mbztcclxuICAgIH1cclxuICAgIGlmICh0eXBlb2YgcGF0aCAhPT0gJ3N0cmluZycpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCfot6/lvoTlv4XpobvkuLrlrZfnrKbkuLLvvIEnKTtcclxuICAgIH1cclxuICAgIHBhdGggPSBwYXRoLnN1YnN0cmluZygxKTtcclxuICAgIGNvbnN0IHBhdGhzID0gcGF0aC5zcGxpdCgnLycpLmZpbHRlcihpdGVtID0+ICEhaXRlbSAmJiBpdGVtLnRyaW0oKS5sZW5ndGggPiAwKS5tYXAoaXRlbSA9PiBpdGVtLnRyaW0oKSk7XHJcbiAgICBsZXQgY29uZmlnID0gdGhpcy5wYWdpbmF0aW9uSW5mbztcclxuICAgIHBhdGhzLmZvckVhY2goaXRlbSA9PiB7XHJcbiAgICAgIGlmIChjb25maWcgJiYgY29uZmlnLmhhc093blByb3BlcnR5KGl0ZW0pKSB7XHJcbiAgICAgICAgY29uZmlnID0gY29uZmlnW2l0ZW1dO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbmZpZyA9IG51bGw7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgcmV0dXJuICEhY29uZmlnID8gY29uZmlnIDogdHlwZW9mIGRlZmF1bHRWYWx1ZSAhPT0gJ3VuZGVmaW5lZCcgPyBkZWZhdWx0VmFsdWUgOiB1bmRlZmluZWQ7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWvuWJpbmRpbmdMaXN05bCx6KGM5o6S5bqPXHJcbiAgICogQHBhcmFtIHN0cmluZyDmjpLluo/lrZfmrrVcclxuICAgKiBAcGFyYW0gZGlyZWN0aW9ucyDmjpLluo/op4TliJnlrZfmrrVcclxuICAgKiBAcGFyYW0gb3B0aW9ucyDlj4LmlbBcclxuICAgKi9cclxuICBwdWJsaWMgc29ydEJ5KGZpZWxkczogc3RyaW5nIHwgQXJyYXk8c3RyaW5nPiwgZGlyZWN0aW9uczogc3RyaW5nIHwgQXJyYXk8c3RyaW5nPiwgb3B0aW9ucz86IHsgW3Byb3A6IHN0cmluZ106IGFueSB9KSB7XHJcbiAgICBpZiAoIWZpZWxkcyB8fCBmaWVsZHMubGVuZ3RoIDwgMSB8fCAhZGlyZWN0aW9ucyB8fCBkaXJlY3Rpb25zLmxlbmd0aCA8IDEpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdzb3J0Qnk6YXJndW1lbnQgZXJyb3InKTtcclxuICAgIH1cclxuICAgIC8vIOm7mOiupOWNh+W6j1xyXG4gICAgY29uc3QgYXJyRmllbGRzOiBBcnJheTxzdHJpbmc+ID0gdHlwZW9mIGZpZWxkcyA9PT0gJ3N0cmluZycgPyBmaWVsZHMuc3BsaXQoJywnKSA6IGZpZWxkcyB8fCBbXTtcclxuICAgIGNvbnN0IGFyckRpcmVjdGlvbnM6IEFycmF5PHN0cmluZz4gPSB0eXBlb2YgZGlyZWN0aW9ucyA9PT0gJ3N0cmluZycgPyBkaXJlY3Rpb25zLnNwbGl0KCcsJykgOiBkaXJlY3Rpb25zIHx8IFtdO1xyXG4gICAgLy8g5o6S5bqP5a2X5q615ZKM5o6S5bqP5pa55byP5bqU5LiA6Ie0XHJcbiAgICBpZiAoYXJyRmllbGRzLmxlbmd0aCAhPT0gYXJyRGlyZWN0aW9ucy5sZW5ndGggfHwgYXJyRmllbGRzLmxlbmd0aCA8IDEpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdzb3J0Qnk6ZmllbGRzIGFuZCBkaXJlY3Rpb25zIG5vdCBtYXRjaCcpO1xyXG4gICAgfVxyXG4gICAgLy8gbmFnZSxhZ2UsdG90YWxcclxuICAgIGNvbnN0IGNvbXBhcmF0b3IgPSAocHJvcHM6IEFycmF5PHN0cmluZz4sIG9yZGVyczogQXJyYXk8c3RyaW5nPikgPT4gKGl0ZW0xOiBCaW5kaW5nT2JqZWN0LCBpdGVtMjogQmluZGluZ09iamVjdCkgPT4ge1xyXG4gICAgICByZXR1cm4gcHJvcHMucmVkdWNlKChyZXN1bHQsIHByb3ApID0+IHtcclxuICAgICAgICBpZiAocmVzdWx0ID09PSAwKSB7XHJcbiAgICAgICAgICBjb25zdCBiaW5kaW5nUHJvcGVydHkgPSB0aGlzLnByb3BlcnRpZXMuZmluZChpdGVtID0+IGl0ZW0ubmFtZSA9PT0gcHJvcCk7XHJcbiAgICAgICAgICBsZXQgaXNNdWx0aUxhbmdQcm9wID0gZmFsc2U7XHJcbiAgICAgICAgICBpZiAoYmluZGluZ1Byb3BlcnR5KSB7XHJcbiAgICAgICAgICAgIGlzTXVsdGlMYW5nUHJvcCA9IGJpbmRpbmdQcm9wZXJ0eS5lbmFibGVNdWx0aUxhbmdJbnB1dDtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGNvbnN0IGN1cnJlbnRMYW5ndWFnZSA9IFRyYW5zbGF0ZVNlcnZpY2UuZ2V0Q3VycmVudExhbmd1YWdlKCk7XHJcbiAgICAgICAgICBjb25zdCBvcmRlciA9IFsnYXNjJ10uaW5jbHVkZXMob3JkZXJzW3Byb3BzLmluZGV4T2YocHJvcCldKSA/IDEgOiAtMTtcclxuICAgICAgICAgIGxldCBpdGVtMVZhbHVlID0gdGhpcy5nZXRWYWx1ZShpdGVtMSwgcHJvcCwgaXNNdWx0aUxhbmdQcm9wLCBjdXJyZW50TGFuZ3VhZ2UpO1xyXG4gICAgICAgICAgbGV0IGl0ZW0yVmFsdWUgPSB0aGlzLmdldFZhbHVlKGl0ZW0yLCBwcm9wLCBpc011bHRpTGFuZ1Byb3AsIGN1cnJlbnRMYW5ndWFnZSk7XHJcblxyXG4gICAgICAgICAgaWYgKGl0ZW0xVmFsdWUgPT09IG51bGwgfHwgaXRlbTFWYWx1ZSA9PT0gdW5kZWZpbmVkKSB7IGl0ZW0xVmFsdWUgPSAnJzsgfVxyXG4gICAgICAgICAgaWYgKGl0ZW0yVmFsdWUgPT09IG51bGwgfHwgaXRlbTJWYWx1ZSA9PT0gdW5kZWZpbmVkKSB7IGl0ZW0yVmFsdWUgPSAnJzsgfVxyXG5cclxuICAgICAgICAgIGlmICh0eXBlb2YgaXRlbTFWYWx1ZSA9PT0gJ3N0cmluZycgJiYgdHlwZW9mIGl0ZW0yVmFsdWUgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGxvY2FsZUNvbXBhcmVSZXN1bHQgPSBpdGVtMVZhbHVlLmxvY2FsZUNvbXBhcmUoaXRlbTJWYWx1ZSk7XHJcbiAgICAgICAgICAgIHJlc3VsdCA9IGxvY2FsZUNvbXBhcmVSZXN1bHQgKiBvcmRlcjtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlmIChpdGVtMVZhbHVlID4gaXRlbTJWYWx1ZSkgeyByZXN1bHQgPSBvcmRlciAqIDE7IH1cclxuICAgICAgICAgICAgaWYgKGl0ZW0xVmFsdWUgPCBpdGVtMlZhbHVlKSB7IHJlc3VsdCA9IG9yZGVyICogLTE7IH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgfSwgMCk7XHJcbiAgICB9O1xyXG4gICAgdGhpcy5pbm5lckxpc3QgPSB0aGlzLmlubmVyTGlzdC5zb3J0KGNvbXBhcmF0b3IoYXJyRmllbGRzLCBhcnJEaXJlY3Rpb25zKSkudG9MaXN0KCk7XHJcbiAgfVxyXG4gIHByaXZhdGUgZ2V0VmFsdWUodGFyZ2V0OiBhbnksIHByb3BOYW1lOiBzdHJpbmcsIGlzTXVsdGlMYW5nUHJvcDogYm9vbGVhbiA9IGZhbHNlLCBjdXJyZW50TGFuZ3VhZ2U6IHN0cmluZyA9ICd6aC1DSFMnKSB7XHJcbiAgICBpZiAodGFyZ2V0IGluc3RhbmNlb2YgQmluZGluZ0xpc3QpIHtcclxuICAgICAgdGFyZ2V0ID0gdGFyZ2V0LmN1cnJlbnRJdGVtO1xyXG4gICAgfSBlbHNlIGlmICh0YXJnZXQgaW5zdGFuY2VvZiBCaW5kaW5nRGF0YSkge1xyXG4gICAgICB0YXJnZXQgPSB0YXJnZXQubGlzdC5jdXJyZW50SXRlbTtcclxuICAgIH1cclxuICAgIGxldCByZXN1bHQgPSBudWxsO1xyXG4gICAgaWYgKHByb3BOYW1lLmluZGV4T2YoJy4nKSA9PT0gLTEpIHtcclxuICAgICAgcmVzdWx0ID0gdGFyZ2V0W3Byb3BOYW1lXTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnN0IHByb3BzID0gcHJvcE5hbWUuc3BsaXQoJy4nKTtcclxuICAgICAgZm9yIChjb25zdCBwcm9wIG9mIHByb3BzKSB7XHJcbiAgICAgICAgdGFyZ2V0ID0gcmVzdWx0ID0gdGhpcy5nZXRWYWx1ZSh0YXJnZXQsIHByb3AsIGlzTXVsdGlMYW5nUHJvcCwgY3VycmVudExhbmd1YWdlKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKGlzTXVsdGlMYW5nUHJvcCAmJiByZXN1bHQgJiYgcmVzdWx0Lmhhc093blByb3BlcnR5KGN1cnJlbnRMYW5ndWFnZSkpIHtcclxuICAgICAgcmV0dXJuIHJlc3VsdFtjdXJyZW50TGFuZ3VhZ2VdO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCB7IEJpbmRpbmdMaXN0IH07XHJcbiJdfQ==