import { Injectable } from '@angular/core';
// tslint:disable: no-unused-expression
/**
 * 菜单状态服务
 * @scope FormModule
 */
class MenuStateService {
    constructor() {
        this.COMMAND_SERVICE_LINK_STORAGE_KEY = 'COMMAND_SERVICE_LINK_STORAGE_KEY';
    }
    getState() {
        const data = !!sessionStorage && sessionStorage.getItem(this.COMMAND_SERVICE_LINK_STORAGE_KEY) || null;
        if (!!data) {
            return JSON.parse(data);
        }
        return {};
    }
    setState(links) {
        !!sessionStorage && sessionStorage.setItem(this.COMMAND_SERVICE_LINK_STORAGE_KEY, JSON.stringify(links));
    }
    addMenuState(parentMenuId, childMenuId, status = true) {
        if (!childMenuId) {
            return;
        }
        const state = this.getState();
        const isParentExist = !!state && state.hasOwnProperty(parentMenuId);
        const childItem = { id: childMenuId, status };
        if (isParentExist) {
            const parent = state[parentMenuId];
            const isChildItemExist = parent.find(item => item.id === childMenuId);
            if (!isChildItemExist) {
                state[parentMenuId].push(childItem);
            }
        }
        else {
            state[parentMenuId] = [childItem];
        }
        this.setState(state);
    }
    getMenuState(parentMenuId, childMenuId) {
        const state = this.getState();
        if (state === null) {
            return null;
        }
        const isParentExist = state.hasOwnProperty(parentMenuId);
        if (!isParentExist) {
            return null;
        }
        const parentMenu = state[parentMenuId];
        const childMenu = parentMenu.filter(item => item.status === true);
        if (typeof childMenuId === 'undefined' || childMenuId.length < 1) {
            return childMenu;
        }
        return parentMenu.filter(item => item.status && item.id === childMenuId);
    }
    updateMenuState(childMenuId, status) {
        const state = this.getState();
        if (state === null) {
            return;
        }
        Object.keys(state).forEach(key => {
            const childMenu = state[key].find(item => item.id === childMenuId);
            if (!!childMenu) {
                childMenu.status = status;
            }
        });
        this.setState(state);
    }
    removeMenu(menuId) {
        this.removeParentMenu(menuId);
        this.removeChildMenu(menuId);
    }
    removeParentMenu(menuId) {
        const state = this.getState();
        if (state === null) {
            return null;
        }
        Object.keys(state).forEach(item => {
            if (item === menuId && state[menuId].length < 1) {
                delete state[item];
            }
        });
        this.setState(state);
    }
    removeChildMenu(menuId) {
        const state = this.getState();
        if (state === null) {
            return;
        }
        Object.keys(state).forEach(parentMenuId => {
            const childMenus = state[parentMenuId];
            if (childMenus && childMenus.length > 0) {
                childMenus.forEach((child, index) => {
                    if (child.id === menuId) {
                        childMenus.splice(index, 1);
                    }
                });
            }
        });
        this.setState(state);
    }
}
MenuStateService.decorators = [
    { type: Injectable }
];
export { MenuStateService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWVudS1zdGF0ZS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9jb21tYW5kLXNlcnZpY2VzLyIsInNvdXJjZXMiOlsibGliL21lbnUtc3RhdGUuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLHVDQUF1QztBQUN2Qzs7O0dBR0c7QUFDSCxNQUNNLGdCQUFnQjtJQUR0QjtRQUVxQixxQ0FBZ0MsR0FBRyxrQ0FBa0MsQ0FBQztJQTJGM0YsQ0FBQztJQTFGVyxRQUFRO1FBQ1osTUFBTSxJQUFJLEdBQUcsQ0FBQyxDQUFDLGNBQWMsSUFBSSxjQUFjLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxnQ0FBZ0MsQ0FBQyxJQUFJLElBQUksQ0FBQztRQUN2RyxJQUFJLENBQUMsQ0FBQyxJQUFJLEVBQUU7WUFDUixPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDM0I7UUFDRCxPQUFPLEVBQUUsQ0FBQztJQUNkLENBQUM7SUFDTyxRQUFRLENBQUMsS0FBSztRQUNsQixDQUFDLENBQUMsY0FBYyxJQUFJLGNBQWMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLGdDQUFnQyxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztJQUM3RyxDQUFDO0lBQ00sWUFBWSxDQUFDLFlBQW9CLEVBQUUsV0FBbUIsRUFBRSxTQUFrQixJQUFJO1FBQ2pGLElBQUksQ0FBQyxXQUFXLEVBQUU7WUFDZCxPQUFPO1NBQ1Y7UUFDRCxNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDOUIsTUFBTSxhQUFhLEdBQUcsQ0FBQyxDQUFDLEtBQUssSUFBSSxLQUFLLENBQUMsY0FBYyxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQ3BFLE1BQU0sU0FBUyxHQUFHLEVBQUUsRUFBRSxFQUFFLFdBQVcsRUFBRSxN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QUU7Z0JBQzdDLE9BQU8sS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO2FBQ3RCO1FBQ0wsQ0FBQyxDQUFDLENBQUM7UUFDSCxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3pCLENBQUM7SUFDTyxlQUFlLENBQUMsTUFBYztRQUNsQyxNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDOUIsSUFBSSxLQUFLLEtBQUssSUFBSSxFQUFFO1lBQ2hCLE9BQU87U0FDVjtRQUNELE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxFQUFFO1lBQ3RDLE1BQU0sVUFBVSxHQUFHLEtBQUssQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUN2QyxJQUFJLFVBQVUsSUFBSSxVQUFVLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtnQkFDckMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxDQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsRUFBRTtvQkFDaEMsSUFBSSxLQUFLLENBQUMsRUFBRSxLQUFLLE1BQU0sRUFBRTt3QkFDckIsVUFBVSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUM7cUJBQy9CO2dCQUNMLENBQUMsQ0FBQyxDQUFDO2FBQ047UUFDTCxDQUFDLENBQUMsQ0FBQztRQUNILElBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDekIsQ0FBQzs7O1lBNUZKLFVBQVU7O0FBK0ZYLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuLy8gdHNsaW50OmRpc2FibGU6IG5vLXVudXNlZC1leHByZXNzaW9uXG4vKipcbiAqIOiPnOWNleeKtuaAgeacjeWKoVxuICogQHNjb3BlIEZvcm1Nb2R1bGVcbiAqL1xuQEluamVjdGFibGUoKVxuY2xhc3MgTWVudVN0YXRlU2VydmljZSB7XG4gICAgcHJpdmF0ZSByZWFkb25seSBDT01NQU5EX1NFUlZJQ0VfTElOS19TVE9SQUdFX0tFWSA9ICdDT01NQU5EX1NFUlZJQ0VfTElOS19TVE9SQUdFX0tFWSc7XG4gICAgcHJpdmF0ZSBnZXRTdGF0ZSgpIHtcbiAgICAgICAgY29uc3QgZGF0YSA9ICEhc2Vzc2lvblN0b3JhZ2UgJiYgc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSh0aGlzLkNPTU1BTkRfU0VSVklDRV9MSU5LX1NUT1JBR0VfS0VZKSB8fCBudWxsO1xuICAgICAgICBpZiAoISFkYXRhKSB7XG4gICAgICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShkYXRhKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ge307XG4gICAgfVxuICAgIHByaXZhdGUgc2V0U3RhdGUobGlua3MpIHtcbiAgICAgICAgISFzZXNzaW9uU3RvcmFnZSAmJiBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKHRoaXMuQ09NTUFORF9TRVJWSUNFX0xJTktfU1RPUkFHRV9LRVksIEpTT04uc3RyaW5naWZ5KGxpbmtzKSk7XG4gICAgfVxuICAgIHB1YmxpYyBhZGRNZW51U3RhdGUocGFyZW50TWVudUlkOiBzdHJpbmcsIGNoaWxkTWVudUlkOiBzdHJpbmcsIHN0YXR1czogYm9vbGVhbiA9IHRydWUpIHtcbiAgICAgICAgaWYgKCFjaGlsZE1lbnVJZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHN0YXRlID0gdGhpcy5nZXRTdGF0ZSgpO1xuICAgICAgICBjb25zdCBpc1BhcmVudEV4aXN0ID0gISFzdGF0ZSAmJiBzdGF0ZS5oYXNPd25Qcm9wZXJ0eShwYXJlbnRNZW51SWQpO1xuICAgICAgICBjb25zdCBjaGlsZEl0ZW0gPSB7IGlkOiBjaGlsZE1lbnVJZCwgc3RhdHVzIH07XG4gICAgICAgIGlmIChpc1BhcmVudEV4aXN0KSB7XG4gICAgICAgICAgICBjb25zdCBwYXJlbnQgPSBzdGF0ZVtwYXJlbnRNZW51SWRdO1xuICAgICAgICAgICAgY29uc3QgaXNDaGlsZEl0ZW1FeGlzdCA9IHBhcmVudC5maW5kKGl0ZW0gPT4gaXRlbS5pZCA9PT0gY2hpbGRNZW51SWQpO1xuICAgICAgICAgICAgaWYgKCFpc0NoaWxkSXRlbUV4aXN0KSB7XG4gICAgICAgICAgICAgICAgc3RhdGVbcGFyZW50TWVudUlkXS5wdXNoKGNoaWxkSXRlbSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBzdGF0ZVtwYXJlbnRNZW51SWRdID0gW2NoaWxkSXRlbV07XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zZXRTdGF0ZShzdGF0ZSk7XG4gICAgfVxuICAgIHB1YmxpYyBnZXRNZW51U3RhdGUocGFyZW50TWVudUlkOiBzdHJpbmcsIGNoaWxkTWVudUlkPzogc3RyaW5nKSB7XG4gICAgICAgIGNvbnN0IHN0YXRlID0gdGhpcy5nZXRTdGF0ZSgpO1xuICAgICAgICBpZiAoc3RhdGUgPT09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGlzUGFyZW50RXhpc3QgPSBzdGF0ZS5oYXNPd25Qcm9wZXJ0eShwYXJlbnRNZW51SWQpO1xuICAgICAgICBpZiAoIWlzUGFyZW50RXhpc3QpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHBhcmVudE1lbnUgPSBzdGF0ZVtwYXJlbnRNZW51SWRdO1xuICAgICAgICBjb25zdCBjaGlsZE1lbnUgPSBwYXJlbnRNZW51LmZpbHRlcihpdGVtID0+IGl0ZW0uc3RhdHVzID09PSB0cnVlKTtcbiAgICAgICAgaWYgKHR5cGVvZiBjaGlsZE1lbnVJZCA9PT0gJ3VuZGVmaW5lZCcgfHwgY2hpbGRNZW51SWQubGVuZ3RoIDwgMSkge1xuICAgICAgICAgICAgcmV0dXJuIGNoaWxkTWVudTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcGFyZW50TWVudS5maWx0ZXIoaXRlbSA9PiBpdGVtLnN0YXR1cyAmJiBpdGVtLmlkID09PSBjaGlsZE1lbnVJZCk7XG4gICAgfVxuICAgIHB1YmxpYyB1cGRhdGVNZW51U3RhdGUoY2hpbGRNZW51SWQ6IHN0cmluZywgc3RhdHVzOiBib29sZWFuKSB7XG4gICAgICAgIGNvbnN0IHN0YXRlID0gdGhpcy5nZXRTdGF0ZSgpO1xuICAgICAgICBpZiAoc3RhdGUgPT09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBPYmplY3Qua2V5cyhzdGF0ZSkuZm9yRWFjaChrZXkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY2hpbGRNZW51ID0gc3RhdGVba2V5XS5maW5kKGl0ZW0gPT4gaXRlbS5pZCA9PT0gY2hpbGRNZW51SWQpO1xuICAgICAgICAgICAgaWYgKCEhY2hpbGRNZW51KSB7XG4gICAgICAgICAgICAgICAgY2hpbGRNZW51LnN0YXR1cyA9IHN0YXR1cztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoc3RhdGUpO1xuICAgIH1cbiAgICBwdWJsaWMgcmVtb3ZlTWVudShtZW51SWQ6IHN0cmluZykge1xuICAgICAgICB0aGlzLnJlbW92ZVBhcmVudE1lbnUobWVudUlkKTtcbiAgICAgICAgdGhpcy5yZW1vdmVDaGlsZE1lbnUobWVudUlkKTtcbiAgICB9XG4gICAgcHJpdmF0ZSByZW1vdmVQYXJlbnRNZW51KG1lbnVJZDogc3RyaW5nKSB7XG4gICAgICAgIGNvbnN0IHN0YXRlID0gdGhpcy5nZXRTdGF0ZSgpO1xuICAgICAgICBpZiAoc3RhdGUgPT09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIE9iamVjdC5rZXlzKHN0YXRlKS5mb3JFYWNoKGl0ZW0gPT4ge1xuICAgICAgICAgICAgaWYgKGl0ZW0gPT09IG1lbnVJZCAmJiBzdGF0ZVttZW51SWRdLmxlbmd0aCA8IDEpIHtcbiAgICAgICAgICAgICAgICBkZWxldGUgc3RhdGVbaXRlbV07XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnNldFN0YXRlKHN0YXRlKTtcbiAgICB9XG4gICAgcHJpdmF0ZSByZW1vdmVDaGlsZE1lbnUobWVudUlkOiBzdHJpbmcpIHtcbiAgICAgICAgY29uc3Qgc3RhdGUgPSB0aGlzLmdldFN0YXRlKCk7XG4gICAgICAgIGlmIChzdGF0ZSA9PT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIE9iamVjdC5rZXlzKHN0YXRlKS5mb3JFYWNoKHBhcmVudE1lbnVJZCA9PiB7XG4gICAgICAgICAgICBjb25zdCBjaGlsZE1lbnVzID0gc3RhdGVbcGFyZW50TWVudUlkXTtcbiAgICAgICAgICAgIGlmIChjaGlsZE1lbnVzICYmIGNoaWxkTWVudXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIGNoaWxkTWVudXMuZm9yRWFjaCgoY2hpbGQsIGluZGV4KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjaGlsZC5pZCA9PT0gbWVudUlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjaGlsZE1lbnVzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoc3RhdGUpO1xuICAgIH1cbn1cblxuZXhwb3J0IHsgTWVudVN0YXRlU2VydmljZSB9O1xuIl19