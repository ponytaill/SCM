import { Subject, of } from 'rxjs';
import { Map } from 'immutable';
import { ChangeType, ViewChangeType } from './changes';
import { BindingPropertyType } from './binding_property';
/**
 * 绑定对象基类
 */
class BaseBindingObject {
    constructor() {
        this.__type__ = 'BindingObject';
        /**
         * 标识是否提交过
         */
        this.isShowValidationMsg = false;
        /**
         * 销毁流
         */
        this.unsubscribe = new Subject();
        /**
         * 以{ [propertyName]: FormControl }的形式存放每条数据的control
         */
        this.controlMap = {};
        this.innerValues = Map();
        this.changes = new Subject();
        this.viewChanges = new Subject();
    }
    /**
     * 主键值
     */
    get primaryKeyValue() {
        return this.primaryKey ? this.getValue(this.primaryKey) : '';
    }
    /**
     * 设置是否提交过
     */
    setShowValidationMsg(flag) {
        this.isShowValidationMsg = flag;
    }
    // public abstract load(data: any);
    /**
     * 根据属性名获取属性值
     * @param   propertyName 属性名
     * @returns 属性值
     */
    getValue(propertyName) {
        return this.innerValues.get(propertyName);
    }
    /**
     * 设置属性值
     * @param propertyName        属性名
     * @param propertyValue       属性值
     * @param emitEventToView     是否通知View层去更新界面，默认为false
     * @param emitEventToEntity   是否通知Entity层去更新值，默认为false
     * @param errors              错误消息
     * @param invokeOnValueChange 值变化事件执行句柄
     */
    setValue(propertyName, propertyValue, emitEventToView = false, emitEventToEntity = false, errors, invokeOnValueChange, context) {
        // 屏蔽掉无效的赋值，防止后续赋值对比时跳过，导致实体无法赋值
        // if (this.primaryKey && !this.primaryKeyValue && this.primaryKey !== propertyName) {
        //   return;
        // }
        const oldPropertyValue = this.getValue(propertyName);
        // 由于特定原因（@邵珠强），无法屏蔽oldPropertyValue === propertyValue
        // if (oldPropertyValue === propertyValue) {
        //   return;
        // }
        if (!invokeOnValueChange || oldPropertyValue === propertyValue) {
            // 设定缺省
            invokeOnValueChange = function (preValue, value, entityChanged, primaryValue) {
                return of(true);
            };
        }
        if (emitEventToEntity === true) {
            // BUG 322301，删除@2019.08.10; 如果无对应实体，则中止值传递; 这种情况发生在带从表的单据新增，从表响应Load变化的情况；
            // if(!this.innerValues.has(propertyName)) {
            //   return;
            // }
            // 执行实体值变化前事件
            invokeOnValueChange(oldPropertyValue, propertyValue, false, this.primaryKeyValue).subscribe((result) => {
                if (result) {
                    // 如果成功，执行变化，并通知实体变化
                    this.innerValues = this.innerValues.set(propertyName, propertyValue);
                    // this.data[propertyName] = propertyValue;
                    const viewChange = this.buildViewChangesContext(propertyName, propertyValue, oldPropertyValue, errors, context);
                    this.viewChanges.next(viewChange);
                    // 如果需要通知视图，通知视图相应修改
                    if (emitEventToView === true) {
                        const change = this.buildChangesContext(propertyName, propertyValue, context, errors);
                        this.changes.next(change);
                    }
                    // 执行实体值变化后事件
                    invokeOnValueChange(oldPropertyValue, propertyValue, true, this.primaryKeyValue).subscribe();
                }
                else {
                    // 如果失败，不再通知实体变化
                    // 并执行界面回滚操作
                    const change = this.buildChangesContext(propertyName, oldPropertyValue, context, errors);
                    this.changes.next(change);
                }
            });
        }
        else {
            // `emitEventToEntity === false`, 则认定实体值已经发生变化，通知视图变化，并触发实体值变化后事件
            this.innerValues = this.innerValues.set(propertyName, propertyValue);
            // this.data[propertyName] = propertyValue;
            if (emitEventToView === true) {
                const change = this.buildChangesContext(propertyName, propertyValue, context, errors);
                this.changes.next(change);
            }
            // 执行实体值变化后事件
            invokeOnValueChange(oldPropertyValue, propertyValue, true, this.primaryKeyValue).subscribe();
        }
    }
    /**
     * 将BindingObject实例转换成JSON对象
     */
    toJSON(options) {
        const langCode = this.getCurrentLanguage(); //window.localStorage.getItem('languageCode') || 'zh-CHS';
        const result = {};
        this.properties.forEach((property) => {
            const propName = property.name;
            if (property.type === BindingPropertyType.List) {
                const list = this[propName];
                result[propName] = list.toJSON(options);
            }
            else if (property.type === BindingPropertyType.Object) {
                const object = this[propName];
                result[propName] = object.toJSON(options);
            }
            else if (property.type === BindingPropertyType.Dynamic) {
                const object = this[propName];
                result[propName] = object.toJSON(options);
            }
            else {
                // 1、对于多语录入字段；
                // 2、传入ignoreMultiLangInput标志，则取当前语言的值给控件。
                if (property.enableMultiLangInput === true) {
                    // 忽略多语字段，只返回当前语言
                    if (options && options.ignoreMultiLangInput === true) {
                        const multiLangValueObj = this.getValue(propName);
                        if (multiLangValueObj) {
                            result[propName] = multiLangValueObj[langCode];
                        }
                        else {
                            result[propName] = multiLangValueObj;
                        }
                    }
                    else if (options && options.useFullMultiLangProperty) {
                        // 给审批提供的扩展 @2021-10-13
                        const multiLangValueObj = this.getValue(propName);
                        if (multiLangValueObj) {
                            result[`${propName}_MULTILANGUAGE`] = multiLangValueObj;
                            // 除返回多语字段外，将当前语言也返回
                            result[propName] = multiLangValueObj[langCode];
                        }
                    }
                    else {
                        const multiLangValueObj = this.getValue(propName);
                        if (!multiLangValueObj) {
                            result[propName] = { [langCode]: multiLangValueObj };
                        }
                        else {
                            result[propName] = multiLangValueObj;
                        }
                    }
                }
                else {
                    result[propName] = this.getValue(propName);
                }
            }
        });
        return result;
    }
    /**
     * 获取当前语言
     * @returns
     */
    getCurrentLanguage() {
        this.currentLanguage = this.currentLanguage || window.localStorage.getItem('languageCode') || 'zh-CHS';
        return this.currentLanguage;
    }
    /**
     * 构造bindignData变更上下文
     * @param propertyName
     * @param propertyValue
     * @param context
     * @param errors
     * @param type
     * @returns
     */
    buildChangesContext(propertyName, propertyValue, context, errors, type = ChangeType.ValueChanged) {
        return {
            type: type,
            path: [propertyName],
            value: propertyValue,
            id: this.primaryKeyValue,
            errors: errors,
            context
        };
    }
    /**
     * 构造viewChanges上下文
     * @param propertyName
     * @param value
     * @param preValue
     * @param errors
     * @param context
     * @param type
     * @returns
     */
    buildViewChangesContext(propertyName, value, preValue, errors, context, type = ViewChangeType.ValueChanged) {
        return {
            type: type,
            path: [propertyName],
            value: value,
            preValue: preValue,
            errors: errors,
            context
        };
    }
}
export { BaseBindingObject };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzZV9iaW5kaW5nX29iamVjdC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvZGV2a2l0LyIsInNvdXJjZXMiOlsibGliL2JpbmRpbmctZGF0YS9iYXNlX2JpbmRpbmdfb2JqZWN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxPQUFPLEVBQUUsRUFBRSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ25DLE9BQU8sRUFBRSxHQUFHLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFDaEMsT0FBTyxFQUFVLFVBQVUsRUFBYyxjQUFjLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFDM0UsT0FBTyxFQUFtQixtQkFBbUIsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBSTFFOztHQUVHO0FBQ0gsTUFBZSxpQkFBaUI7SUF1RDlCO1FBdERPLGFBQVEsR0FBRyxlQUFlLENBQUM7UUEwQ2xDOztXQUVHO1FBQ0ksd0JBQW1CLEdBQUcsS0FBSyxDQUFDO1FBQ25DOztXQUVHO1FBQ0ksZ0JBQVcsR0FBaUIsSUFBSSxPQUFPLEVBQUUsQ0FBQztRQUNqRDs7V0FFRztRQUNJLGVBQVUsR0FBUSxFQUFFLENBQUM7UUFFMUIsSUFBSSxDQUFDLFdBQVcsR0FBRyxHQUFHLEVBQWUsQ0FBQztRQUN0QyxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksT0FBTyxFQUFVLENBQUM7UUFDckMsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLE9BQU8sRUFBYyxDQUFDO0lBQy9DLENBQUM7SUF2QkQ7O09BRUc7SUFDSCxJQUFXLGVBQWU7UUFDeEIsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO0lBQy9ELENBQUM7SUFtQkQ7O09BRUc7SUFDSSxvQkFBb0IsQ0FBQyxJQUFhO1FBQ3ZDLElBQUksQ0FBQyxtQkFBbUIsR0FBRyxJQUFJLENBQUM7SUFDbEMs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LEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQztpQkFDNUM7YUFDRjtRQUNILENBQUMsQ0FBQyxDQUFDO1FBRUgsT0FBTyxNQUFNLENBQUM7SUFDaEIsQ0FBQztJQUNEOzs7T0FHRztJQUNPLGtCQUFrQjtRQUMxQixJQUFJLENBQUMsZUFBZSxHQUFHLElBQUksQ0FBQyxlQUFlLElBQUksTUFBTSxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsY0FBYyxDQUFDLElBQUksUUFBUSxDQUFDO1FBQ3ZHLE9BQU8sSUFBSSxDQUFDLGVBQWUsQ0FBQztJQUM5QixDQUFDO0lBQ0Q7Ozs7Ozs7O09BUUc7SUFDSyxtQkFBbUIsQ0FBQyxZQUFvQixFQUFFLGFBQWtCLEVBQUUsT0FBYSxFQUFFLE1BQVksRUFBRSxPQUFtQixVQUFVLENBQUMsWUFBWTtRQUMzSSxPQUFPO1lBQ0wsSUFBSSxFQUFFLElBQUk7WUFDVixJQUFJLEVBQUUsQ0FBQyxZQUFZLENBQUM7WUFDcEIsS0FBSyxFQUFFLGFBQWE7WUFDcEIsRUFBRSxFQUFFLElBQUksQ0FBQyxlQUFlO1lBQ3hCLE1BQU0sRUFBRSxNQUFNO1lBQ2QsT0FBTztTQUNSLENBQUM7SUFDSixDQUFDO0lBQ0Q7Ozs7Ozs7OztPQVNHO0lBQ0ssdUJBQXVCLENBQUMsWUFBb0IsRUFBRSxLQUFVLEVBQUUsUUFBYSxFQUFFLE1BQVksRUFBRSxPQUFhLEVBQUUsT0FBdUIsY0FBYyxDQUFDLFlBQVk7UUFDOUosT0FBTztZQUNMLElBQUksRUFBRSxJQUFJO1lBQ1YsSUFBSSxFQUFFLENBQUMsWUFBWSxDQUFDO1lBQ3BCLEtBQUssRUFBRSxLQUFLO1lBQ1osUUFBUSxFQUFFLFFBQVE7WUFDbEIsTUFBTSxFQUFFLE1BQU07WUFDZCxPQUFPO1NBQ1IsQ0FBQztJQUNKLENBQUM7Q0FDRjtBQUNELE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU3ViamVjdCwgb2YgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgTWFwIH0gZnJvbSAnaW1tdXRhYmxlJztcclxuaW1wb3J0IHsgQ2hhbmdlLCBDaGFuZ2VUeXBlLCBWaWV3Q2hhbmdlLCBWaWV3Q2hhbmdlVHlwZSB9IGZyb20gJy4vY2hhbmdlcyc7XHJcbmltcG9ydCB7IEJpbmRpbmdQcm9wZXJ0eSwgQmluZGluZ1Byb3BlcnR5VHlwZSB9IGZyb20gJy4vYmluZGluZ19wcm9wZXJ0eSc7XHJcbmltcG9ydCB7IEJpbmRpbmdMaXN0IH0gZnJvbSAnLi9iaW5kaW5nX2xpc3QnO1xyXG5pbXBvcnQgeyBJbnZva2VPblZhbHVlQ2hhbmdlIH0gZnJvbSAnLi90eXBlcyc7XHJcblxyXG4vKipcclxuICog57uR5a6a5a+56LGh5Z+657G7XHJcbiAqL1xyXG5hYnN0cmFjdCBjbGFzcyBCYXNlQmluZGluZ09iamVjdCB7XHJcbiAgcHVibGljIF9fdHlwZV9fID0gJ0JpbmRpbmdPYmplY3QnO1xyXG4gIC8vIHByb3RlY3RlZCBkYXRhOiBhbnkgPSB1bmRlZmluZWQ7XHJcbiAgLyoqXHJcbiAgICogaW1tdXRhYmxl5YC85a+56LGhXHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIGlubmVyVmFsdWVzOiBNYXA8c3RyaW5nLCBhbnk+O1xyXG4gIC8qKlxyXG4gICAqIOW9k+WJjeivreiogFxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBjdXJyZW50TGFuZ3VhZ2U6IHN0cmluZztcclxuICAvKipcclxuICAgKiDniLblr7nosaHmiJbniLbliJfooahcclxuICAgKi9cclxuICBwdWJsaWMgcGFyZW50OiBCaW5kaW5nTGlzdCB8IEJhc2VCaW5kaW5nT2JqZWN0O1xyXG5cclxuICAvKipcclxuICAgKiDlrp7kvZPlvJXotbfnmoTlj5jmm7RcclxuICAgKi9cclxuICBwdWJsaWMgY2hhbmdlczogU3ViamVjdDxDaGFuZ2U+O1xyXG5cclxuICAvKipcclxuICAgKiDnlYzpnaLlsYLlvJXotbfnmoTlj5jmm7TmtYFcclxuICAgKi9cclxuICBwdWJsaWMgdmlld0NoYW5nZXM6IFN1YmplY3Q8Vmlld0NoYW5nZT47XHJcblxyXG4gIC8qKlxyXG4gICAqICDlsZ7mgKfpm4blkIhcclxuICAgKi9cclxuICBwdWJsaWMgcHJvcGVydGllczogQmluZGluZ1Byb3BlcnR5W107XHJcblxyXG4gIC8qKlxyXG4gICAqIOS4u+mUruWQjVxyXG4gICAqL1xyXG4gIHB1YmxpYyBwcmltYXJ5S2V5OiBzdHJpbmc7XHJcblxyXG4gIC8qKlxyXG4gICAqIOS4u+mUruWAvFxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXQgcHJpbWFyeUtleVZhbHVlKCkge1xyXG4gICAgcmV0dXJuIHRoaXMucHJpbWFyeUtleSA/IHRoaXMuZ2V0VmFsdWUodGhpcy5wcmltYXJ5S2V5KSA6ICcnO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5qCH6K+G5piv5ZCm5o+Q5Lqk6L+HXHJcbiAgICovXHJcbiAgcHVibGljIGlzU2hvd1ZhbGlkYXRpb25Nc2cgPSBmYWxzZTtcclxuICAvKipcclxuICAgKiDplIDmr4HmtYFcclxuICAgKi9cclxuICBwdWJsaWMgdW5zdWJzY3JpYmU6IFN1YmplY3Q8YW55PiA9IG5ldyBTdWJqZWN0KCk7XHJcbiAgLyoqXHJcbiAgICog5LuleyBbcHJvcGVydHlOYW1lXTogRm9ybUNvbnRyb2wgfeeahOW9ouW8j+WtmOaUvuavj+adoeaVsOaNrueahGNvbnRyb2xcclxuICAgKi9cclxuICBwdWJsaWMgY29udHJvbE1hcDogYW55ID0ge307XHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICB0aGlzLmlubmVyVmFsdWVzID0gTWFwPHN0cmluZywgYW55PigpO1xyXG4gICAgdGhpcy5jaGFuZ2VzID0gbmV3IFN1YmplY3Q8Q2hhbmdlPigpO1xyXG4gICAgdGhpcy52aWV3Q2hhbmdlcyA9IG5ldyBTdWJqZWN0PFZpZXdDaGFuZ2U+KCk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiuvue9ruaYr+WQpuaPkOS6pOi/h1xyXG4gICAqL1xyXG4gIHB1YmxpYyBzZXRTaG93VmFsaWRhdGlvbk1zZyhmbGFnOiBib29sZWFuKSB7XHJcbiAgICB0aGlzLmlzU2hvd1ZhbGlkYXRpb25Nc2cgPSBmbGFnO1xyXG4gIH1cclxuICAvLyBwdWJsaWMgYWJzdHJhY3QgbG9hZChkYXRhOiBhbnkpO1xyXG4gIC8qKlxyXG4gICAqIOagueaNruWxnuaAp+WQjeiOt+WPluWxnuaAp+WAvFxyXG4gICAqIEBwYXJhbSAgIHByb3BlcnR5TmFtZSDlsZ7mgKflkI1cclxuICAgKiBAcmV0dXJucyDlsZ7mgKflgLxcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0VmFsdWUocHJvcGVydHlOYW1lOiBzdHJpbmcpOiBhbnkge1xyXG4gICAgcmV0dXJuIHRoaXMuaW5uZXJWYWx1ZXMuZ2V0KHByb3BlcnR5TmFtZSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDorr7nva7lsZ7mgKflgLxcclxuICAgKiBAcGFyYW0gcHJvcGVydHlOYW1lICAgICAgICDlsZ7mgKflkI1cclxuICAgKiBAcGFyYW0gcHJvcGVydHlWYWx1ZSAgICAgICDlsZ7mgKflgLxcclxuICAgKiBAcGFyYW0gZW1pdEV2ZW50VG9WaWV3ICAgICDmmK/lkKbpgJrnn6VWaWV35bGC5Y675pu05paw55WM6Z2i77yM6buY6K6k5Li6ZmFsc2VcclxuICAgKiBAcGFyYW0gZW1pdEV2ZW50VG9FbnRpdHkgICDmmK/lkKbpgJrnn6VFbnRpdHnlsYLljrvmm7TmlrDlgLzvvIzpu5jorqTkuLpmYWxzZVxyXG4gICAqIEBwYXJhbSBlcnJvcnMgICAgICAgICAgICAgIOmUmeivr+a2iOaBr1xyXG4gICAqIEBwYXJhbSBpbnZva2VPblZhbHVlQ2hhbmdlIOWAvOWPmOWMluS6i+S7tuaJp+ihjOWPpeafhFxyXG4gICAqL1xyXG4gIHB1YmxpYyBzZXRWYWx1ZShwcm9wZXJ0eU5hbWU6IHN0cmluZywgcHJvcGVydHlWYWx1ZTogYW55LCBlbWl0RXZlbnRUb1ZpZXc6IGJvb2xlYW4gPSBmYWxzZSwgZW1pdEV2ZW50VG9FbnRpdHk6IGJvb2xlYW4gPSBmYWxzZSwgZXJyb3JzPzogYW55LCBpbnZva2VPblZhbHVlQ2hhbmdlPzogSW52b2tlT25WYWx1ZUNoYW5nZSwgY29udGV4dD86IGFueSk6IHZvaWQge1xyXG4gICAgLy8g5bGP6JS95o6J5peg5pWI55qE6LWL5YC877yM6Ziy5q2i5ZCO57ut6LWL5YC85a+55q+U5pe26Lez6L+H77yM5a+86Ie05a6e5L2T5peg5rOV6LWL5YC8XHJcbiAgICAvLyBpZiAodGhpcy5wcmltYXJ5S2V5ICYmICF0aGlzLnByaW1hcnlLZXlWYWx1ZSAmJiB0aGlzLnByaW1hcnlLZXkgIT09IHByb3BlcnR5TmFtZSkge1xyXG4gICAgLy8gICByZXR1cm47XHJcbiAgICAvLyB9XHJcbiAgICBjb25zdCBvbGRQcm9wZXJ0eVZhbHVlID0gdGhpcy5nZXRWYWx1ZShwcm9wZXJ0eU5hbWUpO1xyXG4gICAgLy8g55Sx5LqO54m55a6a5Y6f5Zug77yIQOmCteePoOW8uu+8ie+8jOaXoOazleWxj+iUvW9sZFByb3BlcnR5VmFsdWUgPT09IHByb3BlcnR5VmFsdWVcclxuICAgIC8vIGlmIChvbGRQcm9wZXJ0eVZhbHVlID09PSBwcm9wZXJ0eVZhbHVlKSB7XHJcbiAgICAvLyAgIHJldHVybjtcclxuICAgIC8vIH1cclxuICAgIGlmICghaW52b2tlT25WYWx1ZUNoYW5nZSB8fCBvbGRQcm9wZXJ0eVZhbHVlID09PSBwcm9wZXJ0eVZhbHVlKSB7XHJcbiAgICAgIC8vIOiuvuWumue8uuecgVxyXG4gICAgICBpbnZva2VPblZhbHVlQ2hhbmdlID0gZnVuY3Rpb24gKHByZVZhbHVlLCB2YWx1ZSwgZW50aXR5Q2hhbmdlZDogYm9vbGVhbiwgcHJpbWFyeVZhbHVlPzogYW55KSB7XHJcbiAgICAgICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChlbWl0RXZlbnRUb0VudGl0eSA9PT0gdHJ1ZSkge1xyXG4gICAgICAvLyBCVUcgMzIyMzAx77yM5Yig6ZmkQDIwMTkuMDguMTA7IOWmguaenOaXoOWvueW6lOWunuS9k++8jOWImeS4reatouWAvOS8oOmAkjsg6L+Z56eN5oOF5Ya15Y+R55Sf5Zyo5bim5LuO6KGo55qE5Y2V5o2u5paw5aKe77yM5LuO6KGo5ZON5bqUTG9hZOWPmOWMlueahOaDheWGte+8m1xyXG4gICAgICAvLyBpZighdGhpcy5pbm5lclZhbHVlcy5oYXMocHJvcGVydHlOYW1lKSkge1xyXG4gICAgICAvLyAgIHJldHVybjtcclxuICAgICAgLy8gfVxyXG4gICAgICAvLyDmiafooYzlrp7kvZPlgLzlj5jljJbliY3kuovku7ZcclxuICAgICAgaW52b2tlT25WYWx1ZUNoYW5nZShvbGRQcm9wZXJ0eVZhbHVlLCBwcm9wZXJ0eVZhbHVlLCBmYWxzZSwgdGhpcy5wcmltYXJ5S2V5VmFsdWUpLnN1YnNjcmliZSgocmVzdWx0KSA9PiB7XHJcbiAgICAgICAgaWYgKHJlc3VsdCkge1xyXG4gICAgICAgICAgLy8g5aaC5p6c5oiQ5Yqf77yM5omn6KGM5Y+Y5YyW77yM5bm26YCa55+l5a6e5L2T5Y+Y5YyWXHJcbiAgICAgICAgICB0aGlzLmlubmVyVmFsdWVzID0gdGhpcy5pbm5lclZhbHVlcy5zZXQocHJvcGVydHlOYW1lLCBwcm9wZXJ0eVZhbHVlKTtcclxuICAgICAgICAgIC8vIHRoaXMuZGF0YVtwcm9wZXJ0eU5hbWVdID0gcHJvcGVydHlWYWx1ZTtcclxuICAgICAgICAgIGNvbnN0IHZpZXdDaGFuZ2UgPSB0aGlzLmJ1aWxkVmlld0NoYW5nZXNDb250ZXh0KHByb3BlcnR5TmFtZSwgcHJvcGVydHlWYWx1ZSwgb2xkUHJvcGVydHlWYWx1ZSwgZXJyb3JzLCBjb250ZXh0KTtcclxuICAgICAgICAgIHRoaXMudmlld0NoYW5nZXMubmV4dCh2aWV3Q2hhbmdlKTtcclxuICAgICAgICAgIC8vIOWmguaenOmcgOimgemAmuefpeinhuWbvu+8jOmAmuefpeinhuWbvuebuOW6lOS/ruaUuVxyXG4gICAgICAgICAgaWYgKGVtaXRFdmVudFRvVmlldyA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICBjb25zdCBjaGFuZ2UgPSB0aGlzLmJ1aWxkQ2hhbmdlc0NvbnRleHQocHJvcGVydHlOYW1lLCBwcm9wZXJ0eVZhbHVlLCBjb250ZXh0LCBlcnJvcnMpO1xyXG4gICAgICAgICAgICB0aGlzLmNoYW5nZXMubmV4dChjaGFuZ2UpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgLy8g5omn6KGM5a6e5L2T5YC85Y+Y5YyW5ZCO5LqL5Lu2XHJcbiAgICAgICAgICBpbnZva2VPblZhbHVlQ2hhbmdlKG9sZFByb3BlcnR5VmFsdWUsIHByb3BlcnR5VmFsdWUsIHRydWUsIHRoaXMucHJpbWFyeUtleVZhbHVlKS5zdWJzY3JpYmUoKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgLy8g5aaC5p6c5aSx6LSl77yM5LiN5YaN6YCa55+l5a6e5L2T5Y+Y5YyWXHJcbiAgICAgICAgICAvLyDlubbmiafooYznlYzpnaLlm57mu5rmk43kvZxcclxuICAgICAgICAgIGNvbnN0IGNoYW5nZSA9IHRoaXMuYnVpbGRDaGFuZ2VzQ29udGV4dChwcm9wZXJ0eU5hbWUsIG9sZFByb3BlcnR5VmFsdWUsIGNvbnRleHQsIGVycm9ycyk7XHJcbiAgICAgICAgICB0aGlzLmNoYW5nZXMubmV4dChjaGFuZ2UpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvLyBgZW1pdEV2ZW50VG9FbnRpdHkgPT09IGZhbHNlYCwg5YiZ6K6k5a6a5a6e5L2T5YC85bey57uP5Y+R55Sf5Y+Y5YyW77yM6YCa55+l6KeG5Zu+5Y+Y5YyW77yM5bm26Kem5Y+R5a6e5L2T5YC85Y+Y5YyW5ZCO5LqL5Lu2XHJcbiAgICAgIHRoaXMuaW5uZXJWYWx1ZXMgPSB0aGlzLmlubmVyVmFsdWVzLnNldChwcm9wZXJ0eU5hbWUsIHByb3BlcnR5VmFsdWUpO1xyXG4gICAgICAvLyB0aGlzLmRhdGFbcHJvcGVydHlOYW1lXSA9IHByb3BlcnR5VmFsdWU7XHJcbiAgICAgIGlmIChlbWl0RXZlbnRUb1ZpZXcgPT09IHRydWUpIHtcclxuICAgICAgICBjb25zdCBjaGFuZ2UgPSB0aGlzLmJ1aWxkQ2hhbmdlc0NvbnRleHQocHJvcGVydHlOYW1lLCBwcm9wZXJ0eVZhbHVlLCBjb250ZXh0LCBlcnJvcnMpO1xyXG4gICAgICAgIHRoaXMuY2hhbmdlcy5uZXh0KGNoYW5nZSk7XHJcbiAgICAgIH1cclxuICAgICAgLy8g5omn6KGM5a6e5L2T5YC85Y+Y5YyW5ZCO5LqL5Lu2XHJcbiAgICAgIGludm9rZU9uVmFsdWVDaGFuZ2Uob2xkUHJvcGVydHlWYWx1ZSwgcHJvcGVydHlWYWx1ZSwgdHJ1ZSwgdGhpcy5wcmltYXJ5S2V5VmFsdWUpLnN1YnNjcmliZSgpO1xyXG4gICAgfVxyXG4gIH1cclxuICAvKipcclxuICAgKiDlsIZCaW5kaW5nT2JqZWN05a6e5L6L6L2s5o2i5oiQSlNPTuWvueixoVxyXG4gICAqL1xyXG4gIHB1YmxpYyB0b0pTT04ob3B0aW9ucz86IGFueSk6IGFueSB7XHJcbiAgICBjb25zdCBsYW5nQ29kZSA9IHRoaXMuZ2V0Q3VycmVudExhbmd1YWdlKCk7Ly93aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2xhbmd1YWdlQ29kZScpIHx8ICd6aC1DSFMnO1xyXG4gICAgY29uc3QgcmVzdWx0ID0ge307XHJcbiAgICB0aGlzLnByb3BlcnRpZXMuZm9yRWFjaCgocHJvcGVydHk6IEJpbmRpbmdQcm9wZXJ0eSkgPT4ge1xyXG4gICAgICBjb25zdCBwcm9wTmFtZSA9IHByb3BlcnR5Lm5hbWU7XHJcbiAgICAgIGlmIChwcm9wZXJ0eS50eXBlID09PSBCaW5kaW5nUHJvcGVydHlUeXBlLkxpc3QpIHtcclxuICAgICAgICBjb25zdCBsaXN0OiBCaW5kaW5nTGlzdCA9IHRoaXNbcHJvcE5hbWVdO1xyXG4gICAgICAgIHJlc3VsdFtwcm9wTmFtZV0gPSBsaXN0LnRvSlNPTihvcHRpb25zKTtcclxuICAgICAgfSBlbHNlIGlmIChwcm9wZXJ0eS50eXBlID09PSBCaW5kaW5nUHJvcGVydHlUeXBlLk9iamVjdCkge1xyXG4gICAgICAgIGNvbnN0IG9iamVjdDogQmFzZUJpbmRpbmdPYmplY3QgPSB0aGlzW3Byb3BOYW1lXTtcclxuICAgICAgICByZXN1bHRbcHJvcE5hbWVdID0gb2JqZWN0LnRvSlNPTihvcHRpb25zKTtcclxuICAgICAgfSBlbHNlIGlmIChwcm9wZXJ0eS50eXBlID09PSBCaW5kaW5nUHJvcGVydHlUeXBlLkR5bmFtaWMpIHtcclxuICAgICAgICBjb25zdCBvYmplY3Q6IEJhc2VCaW5kaW5nT2JqZWN0ID0gdGhpc1twcm9wTmFtZV07XHJcbiAgICAgICAgcmVzdWx0W3Byb3BOYW1lXSA9IG9iamVjdC50b0pTT04ob3B0aW9ucyk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gMeOAgeWvueS6juWkmuivreW9leWFpeWtl+aute+8m1xyXG4gICAgICAgIC8vIDLjgIHkvKDlhaVpZ25vcmVNdWx0aUxhbmdJbnB1dOagh+W/l++8jOWImeWPluW9k+WJjeivreiogOeahOWAvOe7meaOp+S7tuOAglxyXG4gICAgICAgIGlmIChwcm9wZXJ0eS5lbmFibGVNdWx0aUxhbmdJbnB1dCA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgLy8g5b+955Wl5aSa6K+t5a2X5q6177yM5Y+q6L+U5Zue5b2T5YmN6K+t6KiAXHJcbiAgICAgICAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLmlnbm9yZU11bHRpTGFuZ0lucHV0ID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG11bHRpTGFuZ1ZhbHVlT2JqID0gdGhpcy5nZXRWYWx1ZShwcm9wTmFtZSk7XHJcbiAgICAgICAgICAgIGlmIChtdWx0aUxhbmdWYWx1ZU9iaikge1xyXG4gICAgICAgICAgICAgIHJlc3VsdFtwcm9wTmFtZV0gPSBtdWx0aUxhbmdWYWx1ZU9ialtsYW5nQ29kZV07XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgcmVzdWx0W3Byb3BOYW1lXSA9IG11bHRpTGFuZ1ZhbHVlT2JqO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9IGVsc2UgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy51c2VGdWxsTXVsdGlMYW5nUHJvcGVydHkpIHtcclxuICAgICAgICAgICAgLy8g57uZ5a6h5om55o+Q5L6b55qE5omp5bGVIEAyMDIxLTEwLTEzXHJcbiAgICAgICAgICAgIGNvbnN0IG11bHRpTGFuZ1ZhbHVlT2JqID0gdGhpcy5nZXRWYWx1ZShwcm9wTmFtZSk7XHJcbiAgICAgICAgICAgIGlmIChtdWx0aUxhbmdWYWx1ZU9iaikge1xyXG4gICAgICAgICAgICAgIHJlc3VsdFtgJHtwcm9wTmFtZX1fTVVMVElMQU5HVUFHRWBdID0gbXVsdGlMYW5nVmFsdWVPYmo7XHJcbiAgICAgICAgICAgICAgLy8g6Zmk6L+U5Zue5aSa6K+t5a2X5q615aSW77yM5bCG5b2T5YmN6K+t6KiA5Lmf6L+U5ZueXHJcbiAgICAgICAgICAgICAgcmVzdWx0W3Byb3BOYW1lXSA9IG11bHRpTGFuZ1ZhbHVlT2JqW2xhbmdDb2RlXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY29uc3QgbXVsdGlMYW5nVmFsdWVPYmogPSB0aGlzLmdldFZhbHVlKHByb3BOYW1lKTtcclxuICAgICAgICAgICAgaWYgKCFtdWx0aUxhbmdWYWx1ZU9iaikge1xyXG4gICAgICAgICAgICAgIHJlc3VsdFtwcm9wTmFtZV0gPSB7IFtsYW5nQ29kZV06IG11bHRpTGFuZ1ZhbHVlT2JqIH07XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgcmVzdWx0W3Byb3BOYW1lXSA9IG11bHRpTGFuZ1ZhbHVlT2JqO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHJlc3VsdFtwcm9wTmFtZV0gPSB0aGlzLmdldFZhbHVlKHByb3BOYW1lKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiByZXN1bHQ7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluW9k+WJjeivreiogFxyXG4gICAqIEByZXR1cm5zIFxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBnZXRDdXJyZW50TGFuZ3VhZ2UoKSB7XHJcbiAgICB0aGlzLmN1cnJlbnRMYW5ndWFnZSA9IHRoaXMuY3VycmVudExhbmd1YWdlIHx8IHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnbGFuZ3VhZ2VDb2RlJykgfHwgJ3poLUNIUyc7XHJcbiAgICByZXR1cm4gdGhpcy5jdXJyZW50TGFuZ3VhZ2U7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOaehOmAoGJpbmRpZ25EYXRh5Y+Y5pu05LiK5LiL5paHXHJcbiAgICogQHBhcmFtIHByb3BlcnR5TmFtZSBcclxuICAgKiBAcGFyYW0gcHJvcGVydHlWYWx1ZSBcclxuICAgKiBAcGFyYW0gY29udGV4dCBcclxuICAgKiBAcGFyYW0gZXJyb3JzIFxyXG4gICAqIEBwYXJhbSB0eXBlIFxyXG4gICAqIEByZXR1cm5zIFxyXG4gICAqL1xyXG4gIHByaXZhdGUgYnVpbGRDaGFuZ2VzQ29udGV4dChwcm9wZXJ0eU5hbWU6IHN0cmluZywgcHJvcGVydHlWYWx1ZTogYW55LCBjb250ZXh0PzogYW55LCBlcnJvcnM/OiBhbnksIHR5cGU6IENoYW5nZVR5cGUgPSBDaGFuZ2VUeXBlLlZhbHVlQ2hhbmdlZCk6IENoYW5nZSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB0eXBlOiB0eXBlLFxyXG4gICAgICBwYXRoOiBbcHJvcGVydHlOYW1lXSxcclxuICAgICAgdmFsdWU6IHByb3BlcnR5VmFsdWUsXHJcbiAgICAgIGlkOiB0aGlzLnByaW1hcnlLZXlWYWx1ZSxcclxuICAgICAgZXJyb3JzOiBlcnJvcnMsXHJcbiAgICAgIGNvbnRleHRcclxuICAgIH07XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOaehOmAoHZpZXdDaGFuZ2Vz5LiK5LiL5paHXHJcbiAgICogQHBhcmFtIHByb3BlcnR5TmFtZSBcclxuICAgKiBAcGFyYW0gdmFsdWUgXHJcbiAgICogQHBhcmFtIHByZVZhbHVlIFxyXG4gICAqIEBwYXJhbSBlcnJvcnMgXHJcbiAgICogQHBhcmFtIGNvbnRleHQgXHJcbiAgICogQHBhcmFtIHR5cGUgXHJcbiAgICogQHJldHVybnMgXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBidWlsZFZpZXdDaGFuZ2VzQ29udGV4dChwcm9wZXJ0eU5hbWU6IHN0cmluZywgdmFsdWU6IGFueSwgcHJlVmFsdWU6IGFueSwgZXJyb3JzPzogYW55LCBjb250ZXh0PzogYW55LCB0eXBlOiBWaWV3Q2hhbmdlVHlwZSA9IFZpZXdDaGFuZ2VUeXBlLlZhbHVlQ2hhbmdlZCk6IFZpZXdDaGFuZ2Uge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgdHlwZTogdHlwZSxcclxuICAgICAgcGF0aDogW3Byb3BlcnR5TmFtZV0sXHJcbiAgICAgIHZhbHVlOiB2YWx1ZSxcclxuICAgICAgcHJlVmFsdWU6IHByZVZhbHVlLFxyXG4gICAgICBlcnJvcnM6IGVycm9ycyxcclxuICAgICAgY29udGV4dFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuZXhwb3J0IHsgQmFzZUJpbmRpbmdPYmplY3QgfSJdfQ==