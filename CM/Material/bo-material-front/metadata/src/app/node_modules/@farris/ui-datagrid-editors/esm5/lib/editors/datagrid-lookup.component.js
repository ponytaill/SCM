/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { debounceTime } from 'rxjs/operators';
import { Injector } from '@angular/core';
/*
 * @Author: 疯狂秀才(Lucas Huang)
 * @Date: 2019-08-14 11:41:00
 * @LastEditors: 疯狂秀才(Lucas Huang)
 * @LastEditTime: 2019-10-14 13:00:48
 * @QQ: 1055818239
 * @Version: v0.0.1
 */
import { Component, Renderer2, ElementRef, ViewChild } from '@angular/core';
import { DatagridBaseEditorDirective } from '../datagrid-base-editor.directive';
import { LookupDefaultOptions } from '../editor-default-options';
import { LookupGridComponent } from '@farris/ui-lookup';
import { RuntimeStateService } from '@farris/ui-common';
// [quickSelect]="options?.quickSelect"
var DatagridLookupComponent = /** @class */ (function (_super) {
    tslib_1.__extends(DatagridLookupComponent, _super);
    function DatagridLookupComponent(render, el, rts, injector) {
        var _this = _super.call(this, render, el, injector) || this;
        _this.rts = rts;
        _this.stopPropagation = false;
        _this.extInfoFormatter = (/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            if (_this.options.extInfoFormatter) {
                return _this.options.extInfoFormatter({ bindingData: _this.dr.rowData, instance: e.instance });
            }
            return '';
        });
        return _this;
    }
    Object.defineProperty(DatagridLookupComponent.prototype, "controlId", {
        set: /**
         * @param {?} id
         * @return {?}
         */
        function (id) {
            this.instance.controlId = id;
            if (this.instance.uri) {
                this.instance.controlId += '_' + this.instance.uri;
            }
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    DatagridLookupComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        _super.prototype.ngOnInit.call(this);
        this.options = Object.assign({}, LookupDefaultOptions, this.options);
    };
    /**
     * @return {?}
     */
    DatagridLookupComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.instance.changeDetector.detectChanges();
        if (this.options.viewType === 'tag') {
            this.inputElement = this.instance.tagbox.nativeElement;
        }
        else {
            this.inputElement = this.instance.inputGroup.textbox.nativeElement;
        }
        _super.prototype.ngAfterViewInit.call(this);
        if (this.options.loader) {
            if (this.instance['http']) {
                /** @type {?} */
                var getDataFn = this.instance['http'];
                this.instance['http'] = tslib_1.__assign({}, getDataFn, { getData: this.options.loader });
            }
            else {
                this.instance['http'] = { getData: this.options.loader };
            }
        }
        this.instance['host'] = this.dg;
        this.rts.state$.pipe(debounceTime(10)).subscribe((/**
         * @param {?} state
         * @return {?}
         */
        function (state) {
            if (state && state.form && state.form.lookup && _this.dg) {
                _this.pending = state.form.lookup.pending;
                _this.dg.pending = _this.pending;
            }
        }));
    };
    /**
     * @return {?}
     */
    DatagridLookupComponent.prototype.onDialogClosed = /**
     * @return {?}
     */
    function () {
        // this.lookup.changeDetector.detectChanges();
    };
    /**
     * @return {?}
     */
    DatagridLookupComponent.prototype.onDialogOpen = /**
     * @return {?}
     */
    function () {
        this.instance.changeDetector.detectChanges();
    };
    /**
     * @return {?}
     */
    DatagridLookupComponent.prototype.onLoadSuccess = /**
     * @return {?}
     */
    function () {
        this.instance.changeDetector.detectChanges();
    };
    /**
     * @param {?} event
     * @return {?}
     */
    DatagridLookupComponent.prototype.onClear = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        // const rowData = this.instance.selectionMgr.getBindingData();
        // this.instance['defaultMapping'].lookupFieldMap(null, this.instance.mapFields, rowData);
        this.instance.changeDetector.detectChanges();
        if (this.options.clear) {
            this.options.clear();
        }
    };
    /**
     * @param {?} $evnet
     * @return {?}
     */
    DatagridLookupComponent.prototype.onTagRemoved = /**
     * @param {?} $evnet
     * @return {?}
     */
    function ($evnet) {
        if (this.options.tagRemoved) {
            this.options.tagRemoved($evnet);
        }
    };
    DatagridLookupComponent.decorators = [
        { type: Component, args: [{
                    selector: 'grid-editor-lookup',
                    template: "\n    <div [formGroup]=\"group\" class=\"f-datagrid-cell-formgroup farris-group-auto\">\n        <datagrid-tooltip [control]=\"formControl\" [tooltipPosition]=\"'top-left'\" [message]=\"errorMessage\">\n            <farris-lookup-grid #lookup style=\"width: 100%\"\n                id=\"{{ controlId }}\"\n                [formControlName]=\"column.field\"\n                [uri]=\"options.uri\"\n                [helpId]=\"options.helpId\"\n                [displayType]=\"options.displayType\"\n                [singleSelect]=\"options.singleSelect\"\n                [idField]=\"options.idField\"\n                [pageSize]=\"options.pageSize || 20\"\n                [pageIndex]=\"options.pageSize || 1\"\n                [pagination]=\"options.pageination\"\n                [textField]=\"options.textField\"\n                [valueField]=\"options.valueField\"\n                [title]=\"options.title\"\n                [useFavorite]=\"options.useFavorite\"\n                [isRecordSize]=\"options.isRecordSize\"\n                [useTip]=\"options.useTip\"\n                [editable]=\"options.editable\"\n                [readonly]=\"options.readonly\"\n                [dialogWidth]=\"options.dialogWidth\"\n                [dialogHeight]=\"options.dialogHeight\"\n                [showMaxButton]=\"options.showMaxButton\"\n                [showCloseButton]=\"options.showCloseButton\"\n                [resizable]=\"options.resizable\"\n                [buttonAlign]=\"options.buttonAlign\"\n                [enableClear]=\"options.enableClear\"\n                [searchOnServer]=\"options.searchOnServer\"\n                [nosearch]=\"options.nosearch\"\n                [maxLength]=\"options.maxLength\"\n                [mappingFn]=\"options.mappingFn\"\n                [mapFields]=\"options.mapFields\"\n                [context]=\"options.context\"\n                [expandLevel]=\"options.expandLevel\"\n                [dictPicking]=\"options.dictPicking\"\n                [dictPicked]=\"options.dictPicked\"\n                [enableFullTree]=\"options.enableFullTree\"\n                [loadTreeDataType]=\"options.loadTreeDataType\"\n                [enableCascade]=\"options.enableCascade\"\n                [cascadeStatus]=\"options.cascadeStatus\"\n                [useExtendInfo]=\"options.useExtendInfo\"\n                [extInfoFields]=\"options.extInfoFields\"\n                [extInfoFormatter]=\"options.extInfoFormatter\"\n                [textAlign]=\"options.textAlign\"\n                [loadDataWhenOpen]=\"options.loadDataWhenOpen\"\n                [selectFirstInNav]=\"options.selectFirstInNav\"\n                [customNavFormatter]=\"options.customNavFormatter\"\n                [customFormatter]=\"options.customFormatter\"\n                [treeInfo]=\"options?.treeInfo\"\n                (dialogClosed)=\"onDialogClosed()\"\n                (dialogOpened)=\"onDialogOpen()\"\n                (clear)=\"onClear($event)\"\n                (loadSuccess)=\"onLoadSuccess()\"\n                [treeTableOptions]=\"options?.treeTableOptions\"\n                [showCheckAll]=\"options?.showCheckAll\"\n                [viewType]=\"options?.viewType\"\n                (tagRemoved)=\"onTagRemoved($event)\"\n            ></farris-lookup-grid>\n        </datagrid-tooltip>\n    </div>\n    "
                }] }
    ];
    /** @nocollapse */
    DatagridLookupComponent.ctorParameters = function () { return [
        { type: Renderer2 },
        { type: ElementRef },
        { type: RuntimeStateService },
        { type: Injector }
    ]; };
    DatagridLookupComponent.propDecorators = {
        instance: [{ type: ViewChild, args: ['lookup',] }]
    };
    return DatagridLookupComponent;
}(DatagridBaseEditorDirective));
export { DatagridLookupComponent };
if (false) {
    /** @type {?} */
    DatagridLookupComponent.prototype.instance;
    /** @type {?} */
    DatagridLookupComponent.prototype.stopPropagation;
    /** @type {?} */
    DatagridLookupComponent.prototype.extInfoFormatter;
    /**
     * @type {?}
     * @private
     */
    DatagridLookupComponent.prototype.rts;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YWdyaWQtbG9va3VwLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktZGF0YWdyaWQtZWRpdG9ycy8iLCJzb3VyY2VzIjpbImxpYi9lZGl0b3JzL2RhdGFncmlkLWxvb2t1cC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDOUMsT0FBTyxFQUFxRCxRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7Ozs7Ozs7OztBQVM1RixPQUFPLEVBQUUsU0FBUyxFQUFVLFNBQVMsRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3BGLE9BQU8sRUFBRSwyQkFBMkIsRUFBRSxNQUFNLG1DQUFtQyxDQUFDO0FBQ2hGLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ2pFLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ3hELE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLG1CQUFtQixDQUFDOztBQUl4RDtJQWtFNkMsbURBQTJCO0lBWXBFLGlDQUFZLE1BQWlCLEVBQUUsRUFBYyxFQUFVLEdBQXdCLEVBQ25FLFFBQWtCO1FBRDlCLFlBRUksa0JBQU0sTUFBTSxFQUFFLEVBQUUsRUFBRSxRQUFRLENBQUMsU0FDOUI7UUFIc0QsU0FBRyxHQUFILEdBQUcsQ0FBcUI7UUFEL0UscUJBQWUsR0FBRyxLQUFLLENBQUM7UUFvRXhCLHNCQUFnQjs7OztRQUFHLFVBQUMsQ0FBQztZQUNqQixJQUFJLEtBQUksQ0FBQyxPQUFPLENBQUMsZ0JBQWdCLEVBQUU7Z0JBQy9CLE9BQU8sS0FBSSxDQUFDLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxFQUFFLFdBQVcsRUFBRSxLQUFJLENBQUMsRUFBRSxDQUFDLE9BQU8sRUFBRSxRQUFRLEVBQUUsQ0FBQyxDQUFDLFFBQVEsRUFBRSxD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LENBQUMsY0FBYyxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQzdDLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUU7WUFDcEIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsQ0FBQztTQUN4QjtJQUNMLENBQUM7Ozs7O0lBRUQsOENBQVk7Ozs7SUFBWixVQUFhLE1BQU07UUFDZixJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsVUFBVSxFQUFFO1lBQ3pCLElBQUksQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1NBQ25DO0lBQ0wsQ0FBQzs7Z0JBL0lKLFNBQVMsU0FBQztvQkFDUCxRQUFRLEVBQUUsb0JBQW9CO29CQUM5QixRQUFRLEVBQUUseXdHQThEVDtpQkFDSjs7OztnQkF6RTJCLFNBQVM7Z0JBQUUsVUFBVTtnQkFJeEMsbUJBQW1CO2dCQWJnQyxRQUFROzs7MkJBb0YvRCxTQUFTLFNBQUMsUUFBUTs7SUFxRnZCLDhCQUFDO0NBQUEsQUF4SkQsQ0FrRTZDLDJCQUEyQixHQXNGdkU7U0F0RlksdUJBQXVCOzs7SUFDaEMsMkNBQW1EOztJQVVuRCxrREFBd0I7O0lBb0V4QixtREFNQzs7Ozs7SUF6RThDLHNDQUFnQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGRlYm91bmNlVGltZSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgQWZ0ZXJWaWV3SW5pdCwgQXBwbGljYXRpb25SZWYsIEluamVjdCwgZm9yd2FyZFJlZiwgSW5qZWN0b3IgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuLypcclxuICogQEF1dGhvcjog55av54uC56eA5omNKEx1Y2FzIEh1YW5nKVxyXG4gKiBARGF0ZTogMjAxOS0wOC0xNCAxMTo0MTowMFxyXG4gKiBATGFzdEVkaXRvcnM6IOeWr+eLguengOaJjShMdWNhcyBIdWFuZylcclxuICogQExhc3RFZGl0VGltZTogMjAxOS0xMC0xNCAxMzowMDo0OFxyXG4gKiBAUVE6IDEwNTU4MTgyMzlcclxuICogQFZlcnNpb246IHYwLjAuMVxyXG4gKi9cclxuaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIFJlbmRlcmVyMiwgRWxlbWVudFJlZiwgVmlld0NoaWxkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IERhdGFncmlkQmFzZUVkaXRvckRpcmVjdGl2ZSB9IGZyb20gJy4uL2RhdGFncmlkLWJhc2UtZWRpdG9yLmRpcmVjdGl2ZSc7XHJcbmltcG9ydCB7IExvb2t1cERlZmF1bHRPcHRpb25zIH0gZnJvbSAnLi4vZWRpdG9yLWRlZmF1bHQtb3B0aW9ucyc7XHJcbmltcG9ydCB7IExvb2t1cEdyaWRDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLWxvb2t1cCc7XHJcbmltcG9ydCB7IFJ1bnRpbWVTdGF0ZVNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWNvbW1vbic7XHJcblxyXG5cclxuLy8gW3F1aWNrU2VsZWN0XT1cIm9wdGlvbnM/LnF1aWNrU2VsZWN0XCJcclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ2dyaWQtZWRpdG9yLWxvb2t1cCcsXHJcbiAgICB0ZW1wbGF0ZTogYFxyXG4gICAgPGRpdiBbZm9ybUdyb3VwXT1cImdyb3VwXCIgY2xhc3M9XCJmLWRhdGFncmlkLWNlbGwtZm9ybWdyb3VwIGZhcnJpcy1ncm91cC1hdXRvXCI+XHJcbiAgICAgICAgPGRhdGFncmlkLXRvb2x0aXAgW2NvbnRyb2xdPVwiZm9ybUNvbnRyb2xcIiBbdG9vbHRpcFBvc2l0aW9uXT1cIid0b3AtbGVmdCdcIiBbbWVzc2FnZV09XCJlcnJvck1lc3NhZ2VcIj5cclxuICAgICAgICAgICAgPGZhcnJpcy1sb29rdXAtZ3JpZCAjbG9va3VwIHN0eWxlPVwid2lkdGg6IDEwMCVcIlxyXG4gICAgICAgICAgICAgICAgaWQ9XCJ7eyBjb250cm9sSWQgfX1cIlxyXG4gICAgICAgICAgICAgICAgW2Zvcm1Db250cm9sTmFtZV09XCJjb2x1bW4uZmllbGRcIlxyXG4gICAgICAgICAgICAgICAgW3VyaV09XCJvcHRpb25zLnVyaVwiXHJcbiAgICAgICAgICAgICAgICBbaGVscElkXT1cIm9wdGlvbnMuaGVscElkXCJcclxuICAgICAgICAgICAgICAgIFtkaXNwbGF5VHlwZV09XCJvcHRpb25zLmRpc3BsYXlUeXBlXCJcclxuICAgICAgICAgICAgICAgIFtzaW5nbGVTZWxlY3RdPVwib3B0aW9ucy5zaW5nbGVTZWxlY3RcIlxyXG4gICAgICAgICAgICAgICAgW2lkRmllbGRdPVwib3B0aW9ucy5pZEZpZWxkXCJcclxuICAgICAgICAgICAgICAgIFtwYWdlU2l6ZV09XCJvcHRpb25zLnBhZ2VTaXplIHx8IDIwXCJcclxuICAgICAgICAgICAgICAgIFtwYWdlSW5kZXhdPVwib3B0aW9ucy5wYWdlU2l6ZSB8fCAxXCJcclxuICAgICAgICAgICAgICAgIFtwYWdpbmF0aW9uXT1cIm9wdGlvbnMucGFnZWluYXRpb25cIlxyXG4gICAgICAgICAgICAgICAgW3RleHRGaWVsZF09XCJvcHRpb25zLnRleHRGaWVsZFwiXHJcbiAgICAgICAgICAgICAgICBbdmFsdWVGaWVsZF09XCJvcHRpb25zLnZhbHVlRmllbGRcIlxyXG4gICAgICAgICAgICAgICAgW3RpdGxlXT1cIm9wdGlvbnMudGl0bGVcIlxyXG4gICAgICAgICAgICAgICAgW3VzZUZhdm9yaXRlXT1cIm9wdGlvbnMudXNlRmF2b3JpdGVcIlxyXG4gICAgICAgICAgICAgICAgW2lzUmVjb3JkU2l6ZV09XCJvcHRpb25zLmlzUmVjb3JkU2l6ZVwiXHJcbiAgICAgICAgICAgICAgICBbdXNlVGlwXT1cIm9wdGlvbnMudXNlVGlwXCJcclxuICAgICAgICAgICAgICAgIFtlZGl0YWJsZV09XCJvcHRpb25zLmVkaXRhYmxlXCJcclxuICAgICAgICAgICAgICAgIFtyZWFkb25seV09XCJvcHRpb25zLnJlYWRvbmx5XCJcclxuICAgICAgICAgICAgICAgIFtkaWFsb2dXaWR0aF09XCJvcHRpb25zLmRpYWxvZ1dpZHRoXCJcclxuICAgICAgICAgICAgICAgIFtkaWFsb2dIZWlnaHRdPVwib3B0aW9ucy5kaWFsb2dIZWlnaHRcIlxyXG4gICAgICAgICAgICAgICAgW3Nob3dNYXhCdXR0b25dPVwib3B0aW9ucy5zaG93TWF4QnV0dG9uXCJcclxuICAgICAgICAgICAgICAgIFtzaG93Q2xvc2VCdXR0b25dPVwib3B0aW9ucy5zaG93Q2xvc2VCdXR0b25cIlxyXG4gICAgICAgICAgICAgICAgW3Jlc2l6YWJsZV09XCJvcHRpb25zLnJlc2l6YWJsZVwiXHJcbiAgICAgICAgICAgICAgICBbYnV0dG9uQWxpZ25dPVwib3B0aW9ucy5idXR0b25BbGlnblwiXHJcbiAgICAgICAgICAgICAgICBbZW5hYmxlQ2xlYXJdPVwib3B0aW9ucy5lbmFibGVDbGVhclwiXHJcbiAgICAgICAgICAgICAgICBbc2VhcmNoT25TZXJ2ZXJdPVwib3B0aW9ucy5zZWFyY2hPblNlcnZlclwiXHJcbiAgICAgICAgICAgICAgICBbbm9zZWFyY2hdPVwib3B0aW9ucy5ub3NlYXJjaFwiXHJcbiAgICAgICAgICAgICAgICBbbWF4TGVuZ3RoXT1cIm9wdGlvbnMubWF4TGVuZ3RoXCJcclxuICAgICAgICAgICAgICAgIFttYXBwaW5nRm5dPVwib3B0aW9ucy5tYXBwaW5nRm5cIlxyXG4gICAgICAgICAgICAgICAgW21hcEZpZWxkc109XCJvcHRpb25zLm1hcEZpZWxkc1wiXHJcbiAgICAgICAgICAgICAgICBbY29udGV4dF09XCJvcHRpb25zLmNvbnRleHRcIlxyXG4gICAgICAgICAgICAgICAgW2V4cGFuZExldmVsXT1cIm9wdGlvbnMuZXhwYW5kTGV2ZWxcIlxyXG4gICAgICAgICAgICAgICAgW2RpY3RQaWNraW5nXT1cIm9wdGlvbnMuZGljdFBpY2tpbmdcIlxyXG4gICAgICAgICAgICAgICAgW2RpY3RQaWNrZWRdPVwib3B0aW9ucy5kaWN0UGlja2VkXCJcclxuICAgICAgICAgICAgICAgIFtlbmFibGVGdWxsVHJlZV09XCJvcHRpb25zLmVuYWJsZUZ1bGxUcmVlXCJcclxuICAgICAgICAgICAgICAgIFtsb2FkVHJlZURhdGFUeXBlXT1cIm9wdGlvbnMubG9hZFRyZWVEYXRhVHlwZVwiXHJcbiAgICAgICAgICAgICAgICBbZW5hYmxlQ2FzY2FkZV09XCJvcHRpb25zLmVuYWJsZUNhc2NhZGVcIlxyXG4gICAgICAgICAgICAgICAgW2Nhc2NhZGVTdGF0dXNdPVwib3B0aW9ucy5jYXNjYWRlU3RhdHVzXCJcclxuICAgICAgICAgICAgICAgIFt1c2VFeHRlbmRJbmZvXT1cIm9wdGlvbnMudXNlRXh0ZW5kSW5mb1wiXHJcbiAgICAgICAgICAgICAgICBbZXh0SW5mb0ZpZWxkc109XCJvcHRpb25zLmV4dEluZm9GaWVsZHNcIlxyXG4gICAgICAgICAgICAgICAgW2V4dEluZm9Gb3JtYXR0ZXJdPVwib3B0aW9ucy5leHRJbmZvRm9ybWF0dGVyXCJcclxuICAgICAgICAgICAgICAgIFt0ZXh0QWxpZ25dPVwib3B0aW9ucy50ZXh0QWxpZ25cIlxyXG4gICAgICAgICAgICAgICAgW2xvYWREYXRhV2hlbk9wZW5dPVwib3B0aW9ucy5sb2FkRGF0YVdoZW5PcGVuXCJcclxuICAgICAgICAgICAgICAgIFtzZWxlY3RGaXJzdEluTmF2XT1cIm9wdGlvbnMuc2VsZWN0Rmlyc3RJbk5hdlwiXHJcbiAgICAgICAgICAgICAgICBbY3VzdG9tTmF2Rm9ybWF0dGVyXT1cIm9wdGlvbnMuY3VzdG9tTmF2Rm9ybWF0dGVyXCJcclxuICAgICAgICAgICAgICAgIFtjdXN0b21Gb3JtYXR0ZXJdPVwib3B0aW9ucy5jdXN0b21Gb3JtYXR0ZXJcIlxyXG4gICAgICAgICAgICAgICAgW3RyZWVJbmZvXT1cIm9wdGlvbnM/LnRyZWVJbmZvXCJcclxuICAgICAgICAgICAgICAgIChkaWFsb2dDbG9zZWQpPVwib25EaWFsb2dDbG9zZWQoKVwiXHJcbiAgICAgICAgICAgICAgICAoZGlhbG9nT3BlbmVkKT1cIm9uRGlhbG9nT3BlbigpXCJcclxuICAgICAgICAgICAgICAgIChjbGVhcik9XCJvbkNsZWFyKCRldmVudClcIlxyXG4gICAgICAgICAgICAgICAgKGxvYWRTdWNjZXNzKT1cIm9uTG9hZFN1Y2Nlc3MoKVwiXHJcbiAgICAgICAgICAgICAgICBbdHJlZVRhYmxlT3B0aW9uc109XCJvcHRpb25zPy50cmVlVGFibGVPcHRpb25zXCJcclxuICAgICAgICAgICAgICAgIFtzaG93Q2hlY2tBbGxdPVwib3B0aW9ucz8uc2hvd0NoZWNrQWxsXCJcclxuICAgICAgICAgICAgICAgIFt2aWV3VHlwZV09XCJvcHRpb25zPy52aWV3VHlwZVwiXHJcbiAgICAgICAgICAgICAgICAodGFnUmVtb3ZlZCk9XCJvblRhZ1JlbW92ZWQoJGV2ZW50KVwiXHJcbiAgICAgICAgICAgID48L2ZhcnJpcy1sb29rdXAtZ3JpZD5cclxuICAgICAgICA8L2RhdGFncmlkLXRvb2x0aXA+XHJcbiAgICA8L2Rpdj5cclxuICAgIGAsXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBEYXRhZ3JpZExvb2t1cENvbXBvbmVudCBleHRlbmRzIERhdGFncmlkQmFzZUVkaXRvckRpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCB7XHJcbiAgICBAVmlld0NoaWxkKCdsb29rdXAnKSBpbnN0YW5jZTogTG9va3VwR3JpZENvbXBvbmVudDtcclxuXHJcblxyXG4gICAgc2V0IGNvbnRyb2xJZChpZCkge1xyXG4gICAgICAgIHRoaXMuaW5zdGFuY2UuY29udHJvbElkID0gaWQ7XHJcbiAgICAgICAgaWYgKHRoaXMuaW5zdGFuY2UudXJpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zdGFuY2UuY29udHJvbElkICs9ICdfJyArIHRoaXMuaW5zdGFuY2UudXJpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzdG9wUHJvcGFnYXRpb24gPSBmYWxzZTtcclxuICAgIGNvbnN0cnVjdG9yKHJlbmRlcjogUmVuZGVyZXIyLCBlbDogRWxlbWVudFJlZiwgcHJpdmF0ZSBydHM6IFJ1bnRpbWVTdGF0ZVNlcnZpY2UsXHJcbiAgICAgICAgICAgICAgICBpbmplY3RvcjogSW5qZWN0b3IpIHtcclxuICAgICAgICBzdXBlcihyZW5kZXIsIGVsLCBpbmplY3Rvcik7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKTogdm9pZCB7XHJcbiAgICAgICAgc3VwZXIubmdPbkluaXQoKTtcclxuICAgICAgICB0aGlzLm9wdGlvbnMgPSBPYmplY3QuYXNzaWduKCB7fSAsIExvb2t1cERlZmF1bHRPcHRpb25zLCB0aGlzLm9wdGlvbnMpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcclxuICAgICAgICB0aGlzLmluc3RhbmNlLmNoYW5nZURldGVjdG9yLmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLnZpZXdUeXBlID09PSAndGFnJykge1xyXG4gICAgICAgICAgICB0aGlzLmlucHV0RWxlbWVudCA9IHRoaXMuaW5zdGFuY2UudGFnYm94Lm5hdGl2ZUVsZW1lbnQ7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5pbnB1dEVsZW1lbnQgPSB0aGlzLmluc3RhbmNlLmlucHV0R3JvdXAudGV4dGJveC5uYXRpdmVFbGVtZW50O1xyXG4gICAgICAgIH1cclxuICAgICAgICBzdXBlci5uZ0FmdGVyVmlld0luaXQoKTtcclxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmxvYWRlcikge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5pbnN0YW5jZVsnaHR0cCddKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBnZXREYXRhRm4gPSB0aGlzLmluc3RhbmNlWydodHRwJ107XHJcbiAgICAgICAgICAgICAgICB0aGlzLmluc3RhbmNlWydodHRwJ10gPSB7Li4uZ2V0RGF0YUZuLCBnZXREYXRhOiB0aGlzLm9wdGlvbnMubG9hZGVyfTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5zdGFuY2VbJ2h0dHAnXSA9IHtnZXREYXRhOiB0aGlzLm9wdGlvbnMubG9hZGVyfTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5pbnN0YW5jZVsnaG9zdCddID0gdGhpcy5kZztcclxuXHJcbiAgICAgICAgdGhpcy5ydHMuc3RhdGUkLnBpcGUoXHJcbiAgICAgICAgICAgIGRlYm91bmNlVGltZSgxMClcclxuICAgICAgICApLnN1YnNjcmliZShzdGF0ZSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChzdGF0ZSAmJiBzdGF0ZS5mb3JtICYmIHN0YXRlLmZvcm0ubG9va3VwICYmIHRoaXMuZGcpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucGVuZGluZyA9IHN0YXRlLmZvcm0ubG9va3VwLnBlbmRpbmc7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRnLnBlbmRpbmcgPSB0aGlzLnBlbmRpbmc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBvbkRpYWxvZ0Nsb3NlZCgpIHtcclxuICAgICAgICAvLyB0aGlzLmxvb2t1cC5jaGFuZ2VEZXRlY3Rvci5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgb25EaWFsb2dPcGVuKCkge1xyXG4gICAgICAgIHRoaXMuaW5zdGFuY2UuY2hhbmdlRGV0ZWN0b3IuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uTG9hZFN1Y2Nlc3MoKSB7XHJcbiAgICAgICAgdGhpcy5pbnN0YW5jZS5jaGFuZ2VEZXRlY3Rvci5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgb25DbGVhcihldmVudDogTW91c2VFdmVudCkge1xyXG4gICAgICAgIC8vIGNvbnN0IHJvd0RhdGEgPSB0aGlzLmluc3RhbmNlLnNlbGVjdGlvbk1nci5nZXRCaW5kaW5nRGF0YSgpO1xyXG4gICAgICAgIC8vIHRoaXMuaW5zdGFuY2VbJ2RlZmF1bHRNYXBwaW5nJ10ubG9va3VwRmllbGRNYXAobnVsbCwgdGhpcy5pbnN0YW5jZS5tYXBGaWVsZHMsIHJvd0RhdGEpO1xyXG5cclxuICAgICAgICB0aGlzLmluc3RhbmNlLmNoYW5nZURldGVjdG9yLmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmNsZWFyKSB7XHJcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5jbGVhcigpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBvblRhZ1JlbW92ZWQoJGV2bmV0KSB7XHJcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy50YWdSZW1vdmVkKSB7XHJcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy50YWdSZW1vdmVkKCRldm5ldCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGV4dEluZm9Gb3JtYXR0ZXIgPSAoZSkgPT4ge1xyXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuZXh0SW5mb0Zvcm1hdHRlcikge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLmV4dEluZm9Gb3JtYXR0ZXIoeyBiaW5kaW5nRGF0YTogdGhpcy5kci5yb3dEYXRhLCBpbnN0YW5jZTogZS5pbnN0YW5jZSB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiAnJztcclxuICAgIH1cclxufVxyXG4iXX0=