/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Injectable } from '@angular/core';
import { IdService } from '@farris/ui-common';
import { Subject } from 'rxjs';
var PersonalConfigService = /** @class */ (function () {
    function PersonalConfigService(idService) {
        this.idService = idService;
        this.selectItemObser$ = new Subject();
        this.displayType = 'LIST';
        this.singleSelect = true;
        // 个性化配置KEY
        this._key = '';
        this._newKey = '';
        // 组件ID
        this.controlID = '';
    }
    Object.defineProperty(PersonalConfigService.prototype, "personalConfigKey", {
        get: /**
         * @return {?}
         */
        function () {
            return this._key;
        },
        set: /**
         * @param {?} val
         * @return {?}
         */
        function (val) {
            if (val) {
                this._key = this.buildKey(val);
                if (this.controlID) {
                    this._newKey = this.buildKey(this.controlID + '_' + val);
                }
                else {
                    this._newKey = this._key;
                }
            }
            else {
                this._newKey = this.buildKey(this.controlID);
            }
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @private
     * @param {?} str
     * @return {?}
     */
    PersonalConfigService.prototype.buildKey = /**
     * @private
     * @param {?} str
     * @return {?}
     */
    function (str) {
        /** @type {?} */
        var prefix = '';
        if (location.hash) {
            /** @type {?} */
            var pathArr = location.hash.split('?');
            prefix = pathArr ? pathArr[0] : '';
        }
        else {
            /** @type {?} */
            var pathArr = location.pathname.split('/');
            prefix = pathArr ? pathArr[pathArr.length - 1] : '';
        }
        return this.idService.encrypt(prefix + str);
    };
    /**
     * @param {?} obj
     * @return {?}
     */
    PersonalConfigService.prototype.initPersonalConf = /**
     * @param {?} obj
     * @return {?}
     */
    function (obj) {
        Object.assign(this, obj);
    };
    /**
     * @param {?=} key
     * @return {?}
     */
    PersonalConfigService.prototype.getPersonalData = /**
     * @param {?=} key
     * @return {?}
     */
    function (key) {
        if (key) {
            this._key = key;
        }
        if (this.personalConfigKey) {
            /** @type {?} */
            var conf = localStorage.getItem(this.personalConfigKey);
            if (conf && conf !== 'undefined' && conf !== 'null') {
                this.personalConf = conf ? JSON.parse(conf) : {};
                this._updatePersonalConfig(this.personalConf);
                if (this.controlID) {
                    if (this._key !== this._newKey) {
                        localStorage.removeItem(this._key);
                    }
                    this.savePersonalConfig(this.personalConf);
                }
                return this.personalConf;
            }
            else {
                return null;
            }
        }
        return null;
    };
    /**
     * @param {?=} localeId
     * @return {?}
     */
    PersonalConfigService.prototype.getQuickSelected = /**
     * @param {?=} localeId
     * @return {?}
     */
    function (localeId) {
        /** @type {?} */
        var d = this.getPersonalData();
        /** @type {?} */
        var qs = d ? d.quickSelected : null;
        if (localeId) {
            if (qs) {
                /** @type {?} */
                var items = qs[localeId];
                if (items && items.length) {
                    return items;
                }
            }
            return null;
        }
        return qs;
    };
    /**
     * @return {?}
     */
    PersonalConfigService.prototype.getDialogSize = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var d = this.getPersonalData();
        return d ? d.size : null;
    };
    /**
     * @param {?} cfg
     * @return {?}
     */
    PersonalConfigService.prototype.updatePersonalConfig = /**
     * @param {?} cfg
     * @return {?}
     */
    function (cfg) {
        /** @type {?} */
        var data = Object.assign(this.personalConf || {}, cfg);
        this.savePersonalConfig(data);
    };
    /**
     * @param {?} data
     * @return {?}
     */
    PersonalConfigService.prototype.savePersonalConfig = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        if (this._newKey) {
            localStorage.setItem(this._newKey, JSON.stringify(data));
            this.personalConf = data;
            return true;
        }
        return false;
    };
    /**
     * @param {?=} tabName
     * @return {?}
     */
    PersonalConfigService.prototype.getActiveTabIndex = /**
     * @param {?=} tabName
     * @return {?}
     */
    function (tabName) {
        /** @type {?} */
        var d = this.getPersonalData();
        if (!tabName) {
            return d && d.tabIndex ? d.tabIndex : 'datalist';
        }
        return tabName;
    };
    /**
     * @param {?} selectedRow
     * @param {?} localeId
     * @return {?}
     */
    PersonalConfigService.prototype.updateQueckSelected = /**
     * @param {?} selectedRow
     * @param {?} localeId
     * @return {?}
     */
    function (selectedRow, localeId) {
        var _this = this;
        var _a, _b;
        /** @type {?} */
        var quickItems = this.getQuickSelected(localeId);
        if (quickItems && quickItems.length) {
            /** @type {?} */
            var selectedIndex_1 = [];
            quickItems.forEach((/**
             * @param {?} element
             * @param {?} index
             * @return {?}
             */
            function (element, index) {
                if (_this.singleSelect) {
                    if (element && selectedRow && element[_this.idField] === selectedRow[_this.idField]) {
                        selectedIndex_1.push(index);
                    }
                }
                else {
                    if (selectedRow) {
                        selectedRow.forEach((/**
                         * @param {?} item
                         * @return {?}
                         */
                        function (item) {
                            if (element && element[_this.idField] === item[_this.idField]) {
                                selectedIndex_1.push(index);
                            }
                        }));
                    }
                }
            }));
            selectedIndex_1.forEach((/**
             * @param {?} index
             * @return {?}
             */
            function (index) {
                quickItems[index] = null;
            }));
            this.personalConf.quickSelected[localeId] =
                this.personalConf.quickSelected[localeId].filter((/**
                 * @param {?} v
                 * @return {?}
                 */
                function (v) { return v !== null; }));
            if (this.singleSelect) {
                this.personalConf.quickSelected[localeId].unshift(selectedRow);
            }
            else {
                if (selectedRow) {
                    selectedRow.forEach((/**
                     * @param {?} element
                     * @return {?}
                     */
                    function (element) {
                        _this.personalConf.quickSelected[localeId].unshift(element);
                    }));
                }
            }
            this.personalConf.quickSelected[localeId].length =
                this.personalConf.quickSelected[localeId].length > 5 ?
                    5 : this.personalConf.quickSelected[localeId].length;
        }
        else {
            /** @type {?} */
            var _qs = this.personalConf.quickSelected || {};
            /** @type {?} */
            var newData = void 0;
            if (this.singleSelect) {
                newData = Object.assign(_qs, (_a = {}, _a[localeId] = [selectedRow], _a));
            }
            else {
                selectedRow.length = selectedRow.length > 5 ? 5 : selectedRow.length;
                newData = Object.assign(_qs, (_b = {}, _b[localeId] = selectedRow, _b));
            }
            this.personalConf.quickSelected = newData;
        }
        this.savePersonalConfig(this.personalConf);
    };
    /**
     *  更新数据结构，现有个性化数据均转为 中文环境下数据；
     */
    /**
     *  更新数据结构，现有个性化数据均转为 中文环境下数据；
     * @param {?} per
     * @return {?}
     */
    PersonalConfigService.prototype._updatePersonalConfig = /**
     *  更新数据结构，现有个性化数据均转为 中文环境下数据；
     * @param {?} per
     * @return {?}
     */
    function (per) {
        if (per) {
            /** @type {?} */
            var flag = false;
            // 更新收藏数据
            if (per.favorite && Array.isArray(per.favorite)) {
                per.favorite = { 'zh-CHS': tslib_1.__spread(per.favorite) };
                delete per.favorite;
                flag = true;
            }
            // 更新快捷录入数据
            if (per.selected) {
                if (Array.isArray(per.selected)) {
                    per.quickSelected = { 'zh-CHS': tslib_1.__spread(per.selected) };
                }
                delete per.selected;
                flag = true;
            }
            if (flag) {
                this.savePersonalConfig(per);
            }
        }
    };
    PersonalConfigService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    PersonalConfigService.ctorParameters = function () { return [
        { type: IdService }
    ]; };
    return PersonalConfigService;
}());
export { PersonalConfigService };
if (false) {
    /** @type {?} */
    PersonalConfigService.prototype.personalConf;
    /** @type {?} */
    PersonalConfigService.prototype.selectItemObser$;
    /** @type {?} */
    PersonalConfigService.prototype.displayType;
    /** @type {?} */
    PersonalConfigService.prototype.singleSelect;
    /** @type {?} */
    PersonalConfigService.prototype.idField;
    /** @type {?} */
    PersonalConfigService.prototype.textField;
    /** @type {?} */
    PersonalConfigService.prototype.mapFields;
    /**
     * @type {?}
     * @private
     */
    PersonalConfigService.prototype._key;
    /** @type {?} */
    PersonalConfigService.prototype._newKey;
    /** @type {?} */
    PersonalConfigService.prototype.controlID;
    /**
     * @type {?}
     * @private
     */
    PersonalConfigService.prototype.idService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9va3VwLXByZXNvbmFsQ29uZmlnLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWxvb2t1cC8iLCJzb3VyY2VzIjpbImxpYi9sb29rdXAtcHJlc29uYWxDb25maWcuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQzlDLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFJL0I7SUFvQ0ksK0JBQW9CLFNBQW9CO1FBQXBCLGNBQVMsR0FBVCxTQUFTLENBQVc7UUEvQnhDLHFCQUFnQixHQUFHLElBQUksT0FBTyxFQUFFLENBQUM7UUFFakMsZ0JBQVcsR0FBRyxNQUFNLENBQUM7UUFFckIsaUJBQVksR0FBRyxJQUFJLENBQUM7O1FBTVosU0FBSSxHQUFHLEVBQUUsQ0FBQztRQUNsQixZQUFPLEdBQUcsRUFBRSxDQUFDOztRQWtCYixjQUFTLEdBQUcsRUFBRSxDQUFDO0lBRTRCLENBQUM7SUFuQjVDLHNCQUFJLG9EQUFpQjs7OztRQUFyQjtZQUNJLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQztRQUNyQixDQUFDOzs7OztRQUNELFVBQXNCLEdBQUc7WUFDckIsSUFBSSxHQUFHLEVBQUU7Z0JBQ0wsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUMvQixJQUFJLElBQUksQ0FBQyxTQUFTLEVBQUU7b0JBQ2hCLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsU0FBUyxHQUFHLEdBQUcsR0FBRyxHQUFHLENBQUMsQ0FBQztpQkFDNUQ7cUJBQU07b0JBQ0gsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDO2lCQUM1QjthQUNKO2lC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bmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBJZFNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWNvbW1vbic7XHJcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgUGVyc29uYWxDb25maWcgfSBmcm9tICcuL2xvb2t1cC1ncmlkLW9wdGlvbnMnO1xyXG5cclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIFBlcnNvbmFsQ29uZmlnU2VydmljZSB7XHJcbiAgICAvLyDkuKrmgKfljJbphY3nva5cclxuICAgIHBlcnNvbmFsQ29uZjogUGVyc29uYWxDb25maWc7XHJcblxyXG4gICAgc2VsZWN0SXRlbU9ic2VyJCA9IG5ldyBTdWJqZWN0KCk7XHJcblxyXG4gICAgZGlzcGxheVR5cGUgPSAnTElTVCc7XHJcblxyXG4gICAgc2luZ2xlU2VsZWN0ID0gdHJ1ZTtcclxuICAgIGlkRmllbGQ6IHN0cmluZztcclxuICAgIHRleHRGaWVsZDogc3RyaW5nO1xyXG4gICAgbWFwRmllbGRzOiBhbnk7XHJcblxyXG4gICAgLy8g5Liq5oCn5YyW6YWN572uS0VZXHJcbiAgICBwcml2YXRlIF9rZXkgPSAnJztcclxuICAgIF9uZXdLZXkgPSAnJztcclxuICAgIGdldCBwZXJzb25hbENvbmZpZ0tleSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fa2V5O1xyXG4gICAgfVxyXG4gICAgc2V0IHBlcnNvbmFsQ29uZmlnS2V5KHZhbCkge1xyXG4gICAgICAgIGlmICh2YWwpIHtcclxuICAgICAgICAgICAgdGhpcy5fa2V5ID0gdGhpcy5idWlsZEtleSh2YWwpO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5jb250cm9sSUQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX25ld0tleSA9IHRoaXMuYnVpbGRLZXkodGhpcy5jb250cm9sSUQgKyAnXycgKyB2YWwpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fbmV3S2V5ID0gdGhpcy5fa2V5O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5fbmV3S2V5ID0gdGhpcy5idWlsZEtleSh0aGlzLmNvbnRyb2xJRCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIOe7hOS7tklEXHJcbiAgICBjb250cm9sSUQgPSAnJztcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGlkU2VydmljZTogSWRTZXJ2aWNlKSB7fVxyXG5cclxuICAgIHByaXZhdGUgYnVpbGRLZXkoc3RyKSB7XHJcbiAgICAgICAgbGV0IHByZWZpeCA9ICcnO1xyXG4gICAgICAgIGlmIChsb2NhdGlvbi5oYXNoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHBhdGhBcnIgPSBsb2NhdGlvbi5oYXNoLnNwbGl0KCc/Jyk7XHJcbiAgICAgICAgICAgIHByZWZpeCA9IHBhdGhBcnIgPyBwYXRoQXJyWzBdIDogJyc7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY29uc3QgcGF0aEFyciAgPSBsb2NhdGlvbi5wYXRobmFtZS5zcGxpdCgnLycpO1xyXG4gICAgICAgICAgICBwcmVmaXggPSBwYXRoQXJyID8gcGF0aEFycltwYXRoQXJyLmxlbmd0aCAtIDFdIDogJyc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLmlkU2VydmljZS5lbmNyeXB0KHByZWZpeCArIHN0cik7XHJcbiAgICB9XHJcblxyXG4gICAgaW5pdFBlcnNvbmFsQ29uZihvYmopIHtcclxuICAgICAgICBPYmplY3QuYXNzaWduKHRoaXMsIG9iaik7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0UGVyc29uYWxEYXRhKGtleT86IHN0cmluZyk6IFBlcnNvbmFsQ29uZmlnIHtcclxuICAgICAgICBpZiAoa2V5KSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2tleSA9IGtleTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLnBlcnNvbmFsQ29uZmlnS2V5KSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbmYgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSh0aGlzLnBlcnNvbmFsQ29uZmlnS2V5KTtcclxuXHJcbiAgICAgICAgICAgIGlmIChjb25mICYmIGNvbmYgIT09ICd1bmRlZmluZWQnICYmIGNvbmYgIT09ICdudWxsJykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wZXJzb25hbENvbmYgPSBjb25mID8gSlNPTi5wYXJzZShjb25mKSA6IHt9O1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fdXBkYXRlUGVyc29uYWxDb25maWcodGhpcy5wZXJzb25hbENvbmYpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbnRyb2xJRCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9rZXkgIT09IHRoaXMuX25ld0tleSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSh0aGlzLl9rZXkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNhdmVQZXJzb25hbENvbmZpZyh0aGlzLnBlcnNvbmFsQ29uZik7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGVyc29uYWxDb25mO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIGdldFF1aWNrU2VsZWN0ZWQobG9jYWxlSWQ/OiBzdHJpbmcpOiBhbnkge1xyXG4gICAgICAgIGNvbnN0IGQgPSB0aGlzLmdldFBlcnNvbmFsRGF0YSgpO1xyXG4gICAgICAgIGNvbnN0IHFzID0gIGQgPyBkLnF1aWNrU2VsZWN0ZWQgOiBudWxsO1xyXG5cclxuICAgICAgICBpZiAobG9jYWxlSWQpIHtcclxuICAgICAgICAgICAgaWYgKHFzKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBpdGVtcyA9IHFzW2xvY2FsZUlkXTtcclxuICAgICAgICAgICAgICAgIGlmIChpdGVtcyAmJiBpdGVtcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXRlbXM7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBxcztcclxuICAgIH1cclxuXHJcbiAgICBnZXREaWFsb2dTaXplKCkge1xyXG4gICAgICAgIGNvbnN0IGQgPSB0aGlzLmdldFBlcnNvbmFsRGF0YSgpO1xyXG4gICAgICAgIHJldHVybiBkID8gZC5zaXplIDogbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICB1cGRhdGVQZXJzb25hbENvbmZpZyhjZmc6IFBhcnRpYWw8UGVyc29uYWxDb25maWc+KSB7XHJcbiAgICAgICAgY29uc3QgZGF0YSA9IE9iamVjdC5hc3NpZ24odGhpcy5wZXJzb25hbENvbmYgfHwge30sIGNmZyk7XHJcbiAgICAgICAgdGhpcy5zYXZlUGVyc29uYWxDb25maWcoZGF0YSk7XHJcbiAgICB9XHJcblxyXG4gICAgc2F2ZVBlcnNvbmFsQ29uZmlnKGRhdGE6IFBlcnNvbmFsQ29uZmlnKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX25ld0tleSkge1xyXG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSh0aGlzLl9uZXdLZXksIEpTT04uc3RyaW5naWZ5KGRhdGEpKTtcclxuICAgICAgICAgICAgdGhpcy5wZXJzb25hbENvbmYgPSBkYXRhO1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRBY3RpdmVUYWJJbmRleCh0YWJOYW1lPzogc3RyaW5nKSB7XHJcbiAgICAgICAgY29uc3QgZCA9IHRoaXMuZ2V0UGVyc29uYWxEYXRhKCk7XHJcbiAgICAgICAgaWYgKCF0YWJOYW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBkICYmIGQudGFiSW5kZXggPyBkLnRhYkluZGV4ICA6ICdkYXRhbGlzdCc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0YWJOYW1lO1xyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZVF1ZWNrU2VsZWN0ZWQoc2VsZWN0ZWRSb3c6IGFueSwgbG9jYWxlSWQ6IHN0cmluZykge1xyXG4gICAgICAgIGNvbnN0IHF1aWNrSXRlbXMgPSB0aGlzLmdldFF1aWNrU2VsZWN0ZWQobG9jYWxlSWQpO1xyXG5cclxuICAgICAgICBpZiAocXVpY2tJdGVtcyAmJiBxdWlja0l0ZW1zLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBjb25zdCBzZWxlY3RlZEluZGV4ID0gW107XHJcbiAgICAgICAgICAgIHF1aWNrSXRlbXMuZm9yRWFjaCgoZWxlbWVudCwgaW5kZXgpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNpbmdsZVNlbGVjdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChlbGVtZW50ICYmIHNlbGVjdGVkUm93ICYmIGVsZW1lbnRbdGhpcy5pZEZpZWxkXSA9PT0gc2VsZWN0ZWRSb3dbdGhpcy5pZEZpZWxkXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZEluZGV4LnB1c2goaW5kZXgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGVjdGVkUm93KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkUm93LmZvckVhY2goaXRlbSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWxlbWVudCAmJiBlbGVtZW50W3RoaXMuaWRGaWVsZF0gPT09IGl0ZW1bdGhpcy5pZEZpZWxkXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkSW5kZXgucHVzaChpbmRleCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBzZWxlY3RlZEluZGV4LmZvckVhY2goaW5kZXggPT4ge1xyXG4gICAgICAgICAgICAgICAgcXVpY2tJdGVtc1tpbmRleF0gPSBudWxsO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMucGVyc29uYWxDb25mLnF1aWNrU2VsZWN0ZWRbbG9jYWxlSWRdID1cclxuICAgICAgICAgICAgICAgIHRoaXMucGVyc29uYWxDb25mLnF1aWNrU2VsZWN0ZWRbbG9jYWxlSWRdLmZpbHRlcih2ID0+IHYgIT09IG51bGwpO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5zaW5nbGVTZWxlY3QpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucGVyc29uYWxDb25mLnF1aWNrU2VsZWN0ZWRbbG9jYWxlSWRdLnVuc2hpZnQoc2VsZWN0ZWRSb3cpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKHNlbGVjdGVkUm93KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRSb3cuZm9yRWFjaChlbGVtZW50ID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wZXJzb25hbENvbmYucXVpY2tTZWxlY3RlZFtsb2NhbGVJZF0udW5zaGlmdChlbGVtZW50KTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLnBlcnNvbmFsQ29uZi5xdWlja1NlbGVjdGVkW2xvY2FsZUlkXS5sZW5ndGggPVxyXG4gICAgICAgICAgICAgICAgdGhpcy5wZXJzb25hbENvbmYucXVpY2tTZWxlY3RlZFtsb2NhbGVJZF0ubGVuZ3RoID4gNSA/XHJcbiAgICAgICAgICAgICAgICAgICAgNSA6IHRoaXMucGVyc29uYWxDb25mLnF1aWNrU2VsZWN0ZWRbbG9jYWxlSWRdLmxlbmd0aDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zdCBfcXMgPSB0aGlzLnBlcnNvbmFsQ29uZi5xdWlja1NlbGVjdGVkIHx8IHt9O1xyXG4gICAgICAgICAgICBsZXQgbmV3RGF0YTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuc2luZ2xlU2VsZWN0KSB7XHJcbiAgICAgICAgICAgICAgICBuZXdEYXRhID0gT2JqZWN0LmFzc2lnbihfcXMsIHsgW2xvY2FsZUlkXTogW3NlbGVjdGVkUm93XSB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHNlbGVjdGVkUm93Lmxlbmd0aCA9IHNlbGVjdGVkUm93Lmxlbmd0aCA+IDUgPyA1IDogc2VsZWN0ZWRSb3cubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgbmV3RGF0YSA9IE9iamVjdC5hc3NpZ24oX3FzLCB7IFtsb2NhbGVJZF06IHNlbGVjdGVkUm93IH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMucGVyc29uYWxDb25mLnF1aWNrU2VsZWN0ZWQgPSBuZXdEYXRhO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5zYXZlUGVyc29uYWxDb25maWcodGhpcy5wZXJzb25hbENvbmYpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogIOabtOaWsOaVsOaNrue7k+aehO+8jOeOsOacieS4quaAp+WMluaVsOaNruWdh+i9rOS4uiDkuK3mlofnjq/looPkuIvmlbDmja7vvJtcclxuICAgICAqL1xyXG4gICAgX3VwZGF0ZVBlcnNvbmFsQ29uZmlnKHBlcjogUGVyc29uYWxDb25maWcpIHtcclxuICAgICAgICBpZiAocGVyKSB7XHJcbiAgICAgICAgICAgIGxldCBmbGFnID0gZmFsc2U7XHJcbiAgICAgICAgICAgIC8vIOabtOaWsOaUtuiXj+aVsOaNrlxyXG4gICAgICAgICAgICBpZiAocGVyLmZhdm9yaXRlICYmIEFycmF5LmlzQXJyYXkocGVyLmZhdm9yaXRlKSkge1xyXG4gICAgICAgICAgICAgICAgcGVyLmZhdm9yaXRlID0geyAnemgtQ0hTJzogWy4uLnBlci5mYXZvcml0ZV0gfTtcclxuICAgICAgICAgICAgICAgIGRlbGV0ZSBwZXIuZmF2b3JpdGU7XHJcblxyXG4gICAgICAgICAgICAgICAgZmxhZyA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8g5pu05paw5b+r5o235b2V5YWl5pWw5o2uXHJcbiAgICAgICAgICAgIGlmIChwZXIuc2VsZWN0ZWQpIHtcclxuICAgICAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHBlci5zZWxlY3RlZCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBwZXIucXVpY2tTZWxlY3RlZCA9IHsgJ3poLUNIUyc6IFsuLi5wZXIuc2VsZWN0ZWRdIH07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBkZWxldGUgcGVyLnNlbGVjdGVkO1xyXG4gICAgICAgICAgICAgICAgZmxhZyA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChmbGFnKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNhdmVQZXJzb25hbENvbmZpZyhwZXIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiJdfQ==