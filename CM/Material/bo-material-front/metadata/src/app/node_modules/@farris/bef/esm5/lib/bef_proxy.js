/**
 * @fileoverview added by tsickle
 * Generated from: lib/bef_proxy.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { switchMap, map, catchError, tap } from 'rxjs/operators';
import { HttpClient } from '@angular/common/http';
import { encodeUrl } from '@farris/devkit';
import { BefDataPathUtil } from './bef_data_path_util';
import { UriService } from './uri_service';
import { HttpHeaderUtil, HttpParamUtil, RequestInfoUtil, ResponseInfoUtil } from './utils/index';
import { HttpService } from './http_service';
/** @type {?} */
var GET = 'GET';
/** @type {?} */
var DELETE = 'DELETE';
/** @type {?} */
var PUT = 'PUT';
/** @type {?} */
var POST = 'POST';
/** @type {?} */
var PATCH = 'PATCH';
/**
 * Bef代理类
 * 代理类的职责是处理http请求，发送一个http请求所需的资源有：uri，method，header、body、query parameter
 * uri 由uriService
 */
var BefProxy = /** @class */ (function () {
    function BefProxy(httpClient, uriService) {
        this.httpClient = httpClient;
        this.uriService = uriService;
        this.httpService = new HttpService(this.httpClient);
    }
    /**
     * 设置基路径
     * @param baseUri 基路径
     */
    /**
     * 设置基路径
     * @param {?} baseUri 基路径
     * @return {?}
     */
    BefProxy.prototype.setBaseUri = /**
     * 设置基路径
     * @param {?} baseUri 基路径
     * @return {?}
     */
    function (baseUri) {
        this.baseUri = baseUri;
    };
    /**
     * 设置策略模式
     * @param strategy 策略
     */
    /**
     * 设置策略模式
     * @param {?} proxyExtend
     * @return {?}
     */
    BefProxy.prototype.setProxyExtend = /**
     * 设置策略模式
     * @param {?} proxyExtend
     * @return {?}
     */
    function (proxyExtend) {
        this.proxyExtend = proxyExtend;
    };
    /**
     * 查询
     */
    /**
     * 查询
     * @param {?=} entityFilter
     * @return {?}
     */
    BefProxy.prototype.query = /**
     * 查询
     * @param {?=} entityFilter
     * @return {?}
     */
    function (entityFilter) {
        /** @type {?} */
        var url = this.baseUri;
        if (entityFilter) {
            /** @type {?} */
            var entityFilterJson = JSON.stringify(entityFilter);
            url = url + "?entityFilter=" + entityFilterJson;
        }
        return this.request(url, GET);
    };
    /**
     * 扩展查询
     */
    /**
     * 扩展查询
     * @param {?} entityFilter
     * @param {?} requestInfo
     * @return {?}
     */
    BefProxy.prototype.extendQuery = /**
     * 扩展查询
     * @param {?} entityFilter
     * @param {?} requestInfo
     * @return {?}
     */
    function (entityFilter, requestInfo) {
        /** @type {?} */
        var url = this.baseUri + "/extension/query";
        if (entityFilter) {
            /** @type {?} */
            var entityFilterJson = JSON.stringify(entityFilter);
            entityFilterJson = encodeUrl(entityFilterJson);
            url = url + "?entityFilter=" + entityFilterJson;
        }
        /** @type {?} */
        var body = requestInfo;
        /** @type {?} */
        var options = this.addBodyToOptions({}, body);
        return this.request(url, PUT, null, options, false);
    };
    /**
     * 查询数据（带过滤条件）
     * @param entityFilter 过滤、排序、分页信息
     * @param requestInfo requestInfo
     * @description 和extendQuery一致，仅将查询参数放到body中
     */
    /**
     * 查询数据（带过滤条件）
     * \@description 和extendQuery一致，仅将查询参数放到body中
     * @param {?} entityFilter 过滤、排序、分页信息
     * @param {?} requestInfo requestInfo
     * @return {?}
     */
    BefProxy.prototype.filter = /**
     * 查询数据（带过滤条件）
     * \@description 和extendQuery一致，仅将查询参数放到body中
     * @param {?} entityFilter 过滤、排序、分页信息
     * @param {?} requestInfo requestInfo
     * @return {?}
     */
    function (entityFilter, requestInfo) {
        /** @type {?} */
        var url = this.baseUri + "/extension/filter";
        /** @type {?} */
        var body = { requestInfo: requestInfo };
        if (entityFilter) {
            body = { entityFilter: entityFilter, requestInfo: requestInfo };
        }
        /** @type {?} */
        var options = this.addBodyToOptions({}, body);
        return this.request(url, POST, null, options, false);
    };
    /**
     * 检索数据
     * @param id 单据内码
     * @return 数据对象
     */
    /**
     * 检索数据
     * @param {?} id 单据内码
     * @return {?} 数据对象
     */
    BefProxy.prototype.retrieve = /**
     * 检索数据
     * @param {?} id 单据内码
     * @return {?} 数据对象
     */
    function (id) {
        /** @type {?} */
        var url = this.baseUri + "/" + id;
        return this.request(url, GET);
    };
    /**
     * @deprecated 方法已经废弃，请勿使用
     */
    /**
     * @deprecated 方法已经废弃，请勿使用
     * @param {?} id
     * @param {?} retrieveParam
     * @param {?} requestInfo
     * @return {?}
     */
    BefProxy.prototype.serviceRetrieve = /**
     * @deprecated 方法已经废弃，请勿使用
     * @param {?} id
     * @param {?} retrieveParam
     * @param {?} requestInfo
     * @return {?}
     */
    function (id, retrieveParam, requestInfo) {
        /** @type {?} */
        var url = this.baseUri + "/service/retrieve/" + id;
        /** @type {?} */
        var options = {
            body: { retrieveParam: retrieveParam, requestInfo: requestInfo }
        };
        return this.request(url, PUT, null, options);
    };
    /**
     * 分页查询从表/从从表数据
     * @param params 参数
     */
    /**
     * 分页查询从表/从从表数据
     * @param {?} params 参数
     * @return {?}
     */
    BefProxy.prototype.queryChild = /**
     * 分页查询从表/从从表数据
     * @param {?} params 参数
     * @return {?}
     */
    function (params) {
        /** @type {?} */
        var url = this.baseUri + "/service/querychild";
        /** @type {?} */
        var options = { body: params };
        return this.request(url, PUT, null, options);
    };
    /**
     * 检索数据（扩展）
     */
    /**
     * 检索数据（扩展）
     * @param {?} id
     * @param {?} requestInfo
     * @param {?=} retrieveParam
     * @return {?}
     */
    BefProxy.prototype.extendRetrieve = /**
     * 检索数据（扩展）
     * @param {?} id
     * @param {?} requestInfo
     * @param {?=} retrieveParam
     * @return {?}
     */
    function (id, requestInfo, retrieveParam) {
        /** @type {?} */
        var url = this.baseUri + "/extension/retrieve/" + id;
        /** @type {?} */
        var body = requestInfo;
        if (retrieveParam) {
            body = { retrieveParam: retrieveParam, requestInfo: requestInfo };
        }
        /** @type {?} */
        var options = this.addBodyToOptions({}, body);
        return this.request(url, PUT, null, options);
    };
    /**
     * 检索数据
     */
    /**
     * 检索数据
     * @param {?} id
     * @param {?} requestInfo
     * @return {?}
     */
    BefProxy.prototype.edit = /**
     * 检索数据
     * @param {?} id
     * @param {?} requestInfo
     * @return {?}
     */
    function (id, requestInfo) {
        /** @type {?} */
        var url = this.baseUri + "/service/edit/" + id;
        /** @type {?} */
        var body = requestInfo;
        /** @type {?} */
        var options = this.addBodyToOptions({}, body);
        return this.request(url, PUT, null, options);
    };
    /**
     * 创建一条数据
     */
    /**
     * 创建一条数据
     * @param {?=} defaultValue
     * @param {?=} requestInfo
     * @return {?}
     */
    BefProxy.prototype.create = /**
     * 创建一条数据
     * @param {?=} defaultValue
     * @param {?=} requestInfo
     * @return {?}
     */
    function (defaultValue, requestInfo) {
        /** @type {?} */
        var body = {
            defaultValue: defaultValue,
            requestInfo: requestInfo,
        };
        /** @type {?} */
        var options = this.addBodyToOptions({}, body);
        return this.request(this.baseUri, POST, null, options);
    };
    /**
     * 从表新增
     * @path 新增路径（从表形如：/1/edus，从从表形如：/1/edus/11/grades）
     */
    /**
     * 从表新增
     * \@path 新增路径（从表形如：/1/edus，从从表形如：/1/edus/11/grades）
     * @param {?} fpath
     * @param {?=} requestInfo
     * @return {?}
     */
    BefProxy.prototype.createByPath = /**
     * 从表新增
     * \@path 新增路径（从表形如：/1/edus，从从表形如：/1/edus/11/grades）
     * @param {?} fpath
     * @param {?=} requestInfo
     * @return {?}
     */
    function (fpath, requestInfo) {
        /** @type {?} */
        var pathUrl = BefDataPathUtil.convertPathToUrl(fpath);
        /** @type {?} */
        var url = "" + this.baseUri + pathUrl;
        /** @type {?} */
        var body = requestInfo;
        /** @type {?} */
        var options = this.addBodyToOptions({}, body);
        return this.request(url, POST, null, options);
    };
    /**
     * 提交变更
     */
    /**
     * 提交变更
     * @param {?} changeDetail
     * @param {?=} requestInfo
     * @return {?}
     */
    BefProxy.prototype.update = /**
     * 提交变更
     * @param {?} changeDetail
     * @param {?=} requestInfo
     * @return {?}
     */
    function (changeDetail, requestInfo) {
        /** @type {?} */
        var body = {
            changeDetail: changeDetail,
            requestInfo: requestInfo,
        };
        /** @type {?} */
        var options = this.addBodyToOptions({}, body);
        return this.request(this.baseUri, PATCH, null, options);
    };
    /**
     * 执行保存
     */
    /**
     * 执行保存
     * @param {?=} requestInfo
     * @return {?}
     */
    BefProxy.prototype.save = /**
     * 执行保存
     * @param {?=} requestInfo
     * @return {?}
     */
    function (requestInfo) {
        /** @type {?} */
        var body = requestInfo;
        /** @type {?} */
        var options = this.addBodyToOptions({}, body);
        return this.request(this.baseUri, PUT, null, options);
    };
    /**
     * 删除
     */
    /**
     * 删除
     * @param {?} id
     * @return {?}
     */
    BefProxy.prototype.delete = /**
     * 删除
     * @param {?} id
     * @return {?}
     */
    function (id) {
        /** @type {?} */
        var url = this.baseUri + "/" + id;
        return this.request(url, DELETE);
    };
    /**
     * 删除并保存
     */
    /**
     * 删除并保存
     * @param {?} id
     * @param {?} requestInfo
     * @return {?}
     */
    BefProxy.prototype.deleteAndSave = /**
     * 删除并保存
     * @param {?} id
     * @param {?} requestInfo
     * @return {?}
     */
    function (id, requestInfo) {
        /** @type {?} */
        var url = this.baseUri + "/service/delete/" + id;
        /** @type {?} */
        var body = requestInfo;
        /** @type {?} */
        var options = this.addBodyToOptions({}, body);
        return this.request(url, PUT, null, options);
    };
    /**
     * 删除（扩展）
     */
    /**
     * 删除（扩展）
     * @param {?} id
     * @param {?} requestInfo
     * @return {?}
     */
    BefProxy.prototype.extendDelete = /**
     * 删除（扩展）
     * @param {?} id
     * @param {?} requestInfo
     * @return {?}
     */
    function (id, requestInfo) {
        /** @type {?} */
        var url = this.baseUri + "/extension/delete/" + id;
        /** @type {?} */
        var body = requestInfo;
        /** @type {?} */
        var options = this.addBodyToOptions({}, body);
        return this.request(url, PUT, null, options);
    };
    /**
     * 删除后代
     * @param fpath 父路径（从表形如：/1/edus，从从表形如：/1/edus/11/grades）
     */
    /**
     * 删除后代
     * @param {?} fpath 父路径（从表形如：/1/edus，从从表形如：/1/edus/11/grades）
     * @param {?} id
     * @return {?}
     */
    BefProxy.prototype.deletByPath = /**
     * 删除后代
     * @param {?} fpath 父路径（从表形如：/1/edus，从从表形如：/1/edus/11/grades）
     * @param {?} id
     * @return {?}
     */
    function (fpath, id) {
        /** @type {?} */
        var pathUrl = BefDataPathUtil.convertPathToUrl(fpath);
        /** @type {?} */
        var url = "" + this.baseUri + pathUrl + "/" + id;
        return this.request(url, DELETE);
    };
    /**
     * 删除后代（扩展）
     * @param fpath 父路径（从表形如：/1/edus，从从表形如：/1/edus/11/grades）
     */
    /**
     * 删除后代（扩展）
     * @param {?} fpath 父路径（从表形如：/1/edus，从从表形如：/1/edus/11/grades）
     * @param {?} id
     * @param {?} requestInfo
     * @return {?}
     */
    BefProxy.prototype.extendDeletByPath = /**
     * 删除后代（扩展）
     * @param {?} fpath 父路径（从表形如：/1/edus，从从表形如：/1/edus/11/grades）
     * @param {?} id
     * @param {?} requestInfo
     * @return {?}
     */
    function (fpath, id, requestInfo) {
        /** @type {?} */
        var pathUrl = BefDataPathUtil.convertPathToUrl(fpath);
        /** @type {?} */
        var url = this.baseUri + "/extension" + pathUrl + "/" + id;
        /** @type {?} */
        var body = requestInfo;
        /** @type {?} */
        var options = this.addBodyToOptions({}, body);
        return this.request(url, PUT, null, options);
    };
    /**
     * 批量删除后代
     * @param fPath 'extension/{rootId}/cc/batch'
     * @param  ids 子集id
     * @param  requestInfo 请求信息
     */
    /**
     * 批量删除后代
     * @param {?} fPath 'extension/{rootId}/cc/batch'
     * @param {?} ids 子集id
     * @param {?} requestInfo 请求信息
     * @return {?}
     */
    BefProxy.prototype.batchDeleteByPath = /**
     * 批量删除后代
     * @param {?} fPath 'extension/{rootId}/cc/batch'
     * @param {?} ids 子集id
     * @param {?} requestInfo 请求信息
     * @return {?}
     */
    function (fPath, ids, requestInfo) {
        /** @type {?} */
        var pathUrl = BefDataPathUtil.convertPathToUrl(fPath);
        /** @type {?} */
        var pathArray = pathUrl.split('/');
        if (pathArray.length < 3) {
            throw Error("\u6839\u636Epath\u5220\u9664\u5B9E\u4F53\u6570\u636E\u51FA\u9519\u4E86\u3002\u4F20\u5165\u7684path[" + fPath + "]\u683C\u5F0F\u4E0D\u5BF9");
        }
        /*   const rootId = pathArray[1];
        
            const nameArray = [];
            pathArray.forEach((name, index) => {
              if (index > 1 ) {
                if (name.indexOf('s') !== -1) {
                  nameArray.push(name.substr(0, name.length - 1));
                } else {
                  nameArray.push(name);
                }
              }
            });
            const childName = nameArray.join('/');*/
        /** @type {?} */
        var url = this.baseUri + "/extension" + pathUrl + "/batch";
        /** @type {?} */
        var idsArray = ids.split(',');
        /** @type {?} */
        var body = {
            ids: idsArray,
            requestInfo: requestInfo
        };
        /** @type {?} */
        var options = this.addBodyToOptions({}, body);
        return this.request(url, PUT, null, options);
    };
    /**
     * 批量删除
     * @param ids 待删除的id数组
     */
    /**
     * 批量删除
     * @param {?} ids 待删除的id数组
     * @return {?}
     */
    BefProxy.prototype.batchDelete = /**
     * 批量删除
     * @param {?} ids 待删除的id数组
     * @return {?}
     */
    function (ids) {
        /** @type {?} */
        var params = {
            ids: ids.join(',')
        };
        return this.request(this.baseUri, DELETE, params);
    };
    /**
     * 根据ids批量删除实体
     * @param ids ids
     * @param ifSave 是否保存
     */
    /**
     * 根据ids批量删除实体
     * @param {?} ids ids
     * @param {?} requestInfo
     * @return {?}
     */
    BefProxy.prototype.extendBatchDeletion = /**
     * 根据ids批量删除实体
     * @param {?} ids ids
     * @param {?} requestInfo
     * @return {?}
     */
    function (ids, requestInfo) {
        /** @type {?} */
        var url = this.baseUri + "/extension/batchdeletion";
        /** @type {?} */
        var body = {
            ids: ids,
            requestInfo: requestInfo
        };
        /** @type {?} */
        var options = this.addBodyToOptions({}, body);
        return this.request(url, PUT, null, options);
    };
    /**
     * 批量删除（扩展）
     */
    /**
     * 批量删除（扩展）
     * @param {?} ids
     * @param {?} requestInfo
     * @return {?}
     */
    BefProxy.prototype.extendBatchDelete = /**
     * 批量删除（扩展）
     * @param {?} ids
     * @param {?} requestInfo
     * @return {?}
     */
    function (ids, requestInfo) {
        /** @type {?} */
        var url = this.baseUri + "/extension/batchdelete";
        /** @type {?} */
        var params = {
            ids: ids.join(',')
        };
        /** @type {?} */
        var body = requestInfo;
        /** @type {?} */
        var options = this.addBodyToOptions({}, body);
        return this.request(url, PUT, params, options);
    };
    /**
     * 取消
     */
    /**
     * 取消
     * @param {?=} context
     * @return {?}
     */
    BefProxy.prototype.cancel = /**
     * 取消
     * @param {?=} context
     * @return {?}
     */
    function (context) {
        /** @type {?} */
        var url = this.baseUri + "/service/cancel";
        return this.request(url, POST, null, null, false, false, false, context);
    };
    /**
     * 批量新增从表/从从表数据
     * @param path 实体绑定路径，like 1/childs or 1/childs/11/childchilds
     * @param defaultValues 默认实体数据数组
     */
    /**
     * 批量新增从表/从从表数据
     * @param {?} path 实体绑定路径，like 1/childs or 1/childs/11/childchilds
     * @param {?} defaultValues 默认实体数据数组
     * @param {?} requestInfo
     * @return {?}
     */
    BefProxy.prototype.batchAppendByPath = /**
     * 批量新增从表/从从表数据
     * @param {?} path 实体绑定路径，like 1/childs or 1/childs/11/childchilds
     * @param {?} defaultValues 默认实体数据数组
     * @param {?} requestInfo
     * @return {?}
     */
    function (path, defaultValues, requestInfo) {
        /** @type {?} */
        var pathUrl = BefDataPathUtil.convertPathToUrl(path);
        /** @type {?} */
        var url = "" + this.baseUri + pathUrl + "/batch";
        /** @type {?} */
        var body = {
            requestInfo: requestInfo,
            retrieveDefaultParam: {
                defaultValues: defaultValues
            }
        };
        /** @type {?} */
        var options = this.addBodyToOptions({}, body);
        return this.request(url, POST, null, options);
    };
    /**
     * 批量新增主表数据
     * @param defaultValues 默认实体数据数组
     */
    /**
     * 批量新增主表数据
     * @param {?} defaultValues 默认实体数据数组
     * @param {?} requestInfo
     * @return {?}
     */
    BefProxy.prototype.batchAppend = /**
     * 批量新增主表数据
     * @param {?} defaultValues 默认实体数据数组
     * @param {?} requestInfo
     * @return {?}
     */
    function (defaultValues, requestInfo) {
        /** @type {?} */
        var url = this.baseUri + "/batch";
        ;
        /** @type {?} */
        var body = {
            requestInfo: requestInfo,
            retrieveDefaultParam: {
                defaultValues: defaultValues
            }
        };
        /** @type {?} */
        var options = this.addBodyToOptions({}, body);
        return this.request(url, POST, null, options);
    };
    // tslint:disable-next-line: max-line-length
    // tslint:disable-next-line: max-line-length
    /**
     * @param {?} url
     * @param {?} method
     * @param {?=} params
     * @param {?=} options
     * @param {?=} selfHandError
     * @param {?=} ignoreError
     * @param {?=} ignoreChanges
     * @param {?=} runtimeContext
     * @return {?}
     */
    BefProxy.prototype.request = 
    // tslint:disable-next-line: max-line-length
    /**
     * @param {?} url
     * @param {?} method
     * @param {?=} params
     * @param {?=} options
     * @param {?=} selfHandError
     * @param {?=} ignoreError
     * @param {?=} ignoreChanges
     * @param {?=} runtimeContext
     * @return {?}
     */
    function (url, method, params, options, selfHandError, ignoreError, ignoreChanges, runtimeContext) {
        var _this = this;
        options = options || {};
        // 是否自行处理错误
        if (typeof (selfHandError) === 'undefined' || typeof (selfHandError) !== 'boolean') {
            selfHandError = false;
        }
        // 是否忽略异常继续执行
        if (typeof (ignoreError) === 'undefined' || typeof (ignoreError) !== 'boolean') {
            ignoreError = false;
        }
        // params
        if (params) {
            // const httpParams = this.buildParams(params);
            options.params = params;
        }
        // 处理headers
        options.headers = HttpHeaderUtil.convertToHeaders(options.headers);
        // 1、判断是否带requestInfo（不区分首字母大小写）;
        // 2、如果传递的是RequestInfo，则转换为requestInfo；
        /** @type {?} */
        var hasRequestInfo = this.hasRequestInfo(options);
        if (options && options.body && options.body.hasOwnProperty('RequestInfo')) {
            options.body.requestInfo = options.body.RequestInfo;
            delete options.body.RequestInfo;
        }
        return this.proxyExtend.extendHeaders(options.headers, runtimeContext).pipe(switchMap((/**
         * @param {?} headers
         * @return {?}
         */
        function (headers) {
            options.headers = HttpHeaderUtil.toJson(headers);
            options.observe = 'response';
            return _this.httpService.request(method, url, options);
        })), tap((/**
         * @param {?} response
         * @return {?}
         */
        function (response) { return _this.proxyExtend.parseHeaders(response); })), map((/**
         * @param {?} result
         * @return {?}
         */
        function (result) { return result.body; })), map((/**
         * @param {?} result
         * @return {?}
         */
        function (result) {
            if (hasRequestInfo) {
                _this.proxyExtend.onResponse(result, ignoreChanges, options);
                return result;
            }
            else {
                // body里没有requestInfo的情况，模拟老的处理方式（不清理变更、将returnValue解析出来）
                return _this.unWrapResponseInfo(result);
            }
        })), catchError((/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            return _this.proxyExtend.onError(error, selfHandError, ignoreError);
        })));
    };
    /**
     * 调用httpclient取数
     * @param url url
     * @param method methods
     * @param options options
     */
    /**
     * 调用httpclient取数
     * @protected
     * @param {?} url url
     * @param {?} method methods
     * @param {?} options options
     * @return {?}
     */
    BefProxy.prototype.invoke = /**
     * 调用httpclient取数
     * @protected
     * @param {?} url url
     * @param {?} method methods
     * @param {?} options options
     * @return {?}
     */
    function (url, method, options) {
        var _this = this;
        if (options.params) {
            url = this.proxyExtend.extendUrl(url, options.params);
            options.params = null;
        }
        if (options.body) {
            options.body = this.proxyExtend.extendBody(options.body);
        }
        options.headers = HttpHeaderUtil.convertToHeaders(options.headers);
        /** @type {?} */
        var headers$ = this.proxyExtend.extendHeaders(options.headers);
        return headers$.pipe(switchMap((/**
         * @param {?} headers
         * @return {?}
         */
        function (headers) {
            options.headers = HttpHeaderUtil.toJson(headers);
            options.observe = 'response';
            return _this.httpService.request(method, url, options)
                .pipe(tap((/**
             * @param {?} response
             * @return {?}
             */
            function (response) { return _this.proxyExtend.parseHeaders(response); })), map((/**
             * @param {?} result
             * @return {?}
             */
            function (result) { return result.body; })), map((/**
             * @param {?} result
             * @return {?}
             */
            function (result) { return _this.proxyExtend.onResponse(result, false, options); })), catchError((/**
             * @param {?} error
             * @return {?}
             */
            function (error) { return _this.proxyExtend.onError(error, false, false); })));
        })));
    };
    /**
     * 向HttpOptions对象中添加body
     * @param options 原来的options
     * @param body body内容
     */
    /**
     * 向HttpOptions对象中添加body
     * @private
     * @param {?} options 原来的options
     * @param {?} body body内容
     * @return {?}
     */
    BefProxy.prototype.addBodyToOptions = /**
     * 向HttpOptions对象中添加body
     * @private
     * @param {?} options 原来的options
     * @param {?} body body内容
     * @return {?}
     */
    function (options, body) {
        options = options || {};
        /** @type {?} */
        var mergedOptions = Object.assign(options, { body: body });
        return mergedOptions;
    };
    /**
     * 构造HttpParams对象
     * @param params 请求参数
     */
    /**
     * 构造HttpParams对象
     * @private
     * @param {?} params 请求参数
     * @return {?}
     */
    BefProxy.prototype.buildParams = /**
     * 构造HttpParams对象
     * @private
     * @param {?} params 请求参数
     * @return {?}
     */
    function (params) {
        return HttpParamUtil.buildParams(params);
    };
    /**
     * 是否带有RequestInfo
     */
    /**
     * 是否带有RequestInfo
     * @private
     * @param {?} options
     * @return {?}
     */
    BefProxy.prototype.hasRequestInfo = /**
     * 是否带有RequestInfo
     * @private
     * @param {?} options
     * @return {?}
     */
    function (options) {
        return RequestInfoUtil.hasRequestInfo(options) || RequestInfoUtil.hasRequestInfoWithR(options);
    };
    /**
     * 处理返回值，兼容老版本
     */
    /**
     * 处理返回值，兼容老版本
     * @private
     * @param {?} result
     * @return {?}
     */
    BefProxy.prototype.unWrapResponseInfo = /**
     * 处理返回值，兼容老版本
     * @private
     * @param {?} result
     * @return {?}
     */
    function (result) {
        return ResponseInfoUtil.unWrapResponseInfo(result);
    };
    BefProxy.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    BefProxy.ctorParameters = function () { return [
        { type: HttpClient },
        { type: UriService }
    ]; };
    return BefProxy;
}());
export { BefProxy };
if (false) {
    /**
     * @type {?}
     * @protected
     */
    BefProxy.prototype.proxyExtend;
    /**
     * restful基路径
     * @type {?}
     * @protected
     */
    BefProxy.prototype.baseUri;
    /**
     * @type {?}
     * @private
     */
    BefProxy.prototype.httpService;
    /** @type {?} */
    BefProxy.prototype.httpClient;
    /** @type {?} */
    BefProxy.prototype.uriService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmVmX3Byb3h5LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9iZWYvIiwic291cmNlcyI6WyJsaWIvYmVmX3Byb3h5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUUzQyxPQUFPLEVBQUUsU0FBUyxFQUFFLEdBQUcsRUFBRSxVQUFVLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDakUsT0FBTyxFQUFjLFVBQVUsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQzlELE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUUzQyxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDdkQsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQUUsY0FBYyxFQUFFLGFBQWEsRUFBRSxlQUFlLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDakcsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGdCQUFnQixDQUFDOztJQUd2QyxHQUFHLEdBQUcsS0FBSzs7SUFDWCxNQUFNLEdBQUcsUUFBUTs7SUFDakIsR0FBRyxHQUFHLEtBQUs7O0lBQ1gsSUFBSSxHQUFHLE1BQU07O0lBQ2IsS0FBSyxHQUFHLE9BQU87Ozs7OztBQU9yQjtJQVFFLGtCQUFtQixVQUFzQixFQUFTLFVBQXNCO1FBQXJELGVBQVUsR0FBVixVQUFVLENBQVk7UUFBUyxlQUFVLEdBQVYsVUFBVSxDQUFZO1FBQ3RFLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxXQUFXLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQ3RELENBQUM7SUFDRDs7O09BR0c7Ozs7OztJQUNJLDZCQUFVOzs7OztJQUFqQixVQUFrQixPQUFlO1FBQy9CLElBQUksQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDO0lBQ3pCLENBQUM7SUFD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LDhCQUE2QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBzd2l0Y2hNYXAsIG1hcCwgY2F0Y2hFcnJvciwgdGFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBIdHRwUGFyYW1zLCBIdHRwQ2xpZW50IH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xyXG5pbXBvcnQgeyBlbmNvZGVVcmwgfSBmcm9tICdAZmFycmlzL2RldmtpdCc7XHJcbmltcG9ydCB7IElQcm94eUV4dGVuZCwgUmVxdWVzdEluZm8sIFJlc3BvbnNlSW5mbywgQ2hhbmdlRGV0YWlsLCBSZXRyaWV2ZVBhcmFtIH0gZnJvbSAnLi90eXBlcyc7XHJcbmltcG9ydCB7IEJlZkRhdGFQYXRoVXRpbCB9IGZyb20gJy4vYmVmX2RhdGFfcGF0aF91dGlsJztcclxuaW1wb3J0IHsgVXJpU2VydmljZSB9IGZyb20gJy4vdXJpX3NlcnZpY2UnO1xyXG5pbXBvcnQgeyBIdHRwSGVhZGVyVXRpbCwgSHR0cFBhcmFtVXRpbCwgUmVxdWVzdEluZm9VdGlsLCBSZXNwb25zZUluZm9VdGlsIH0gZnJvbSAnLi91dGlscy9pbmRleCc7XHJcbmltcG9ydCB7IEh0dHBTZXJ2aWNlIH0gZnJvbSAnLi9odHRwX3NlcnZpY2UnO1xyXG5cclxuXHJcbmNvbnN0IEdFVCA9ICdHRVQnO1xyXG5jb25zdCBERUxFVEUgPSAnREVMRVRFJztcclxuY29uc3QgUFVUID0gJ1BVVCc7XHJcbmNvbnN0IFBPU1QgPSAnUE9TVCc7XHJcbmNvbnN0IFBBVENIID0gJ1BBVENIJztcclxuXHJcbi8qKlxyXG4gKiBCZWbku6PnkIbnsbtcclxuICog5Luj55CG57G755qE6IGM6LSj5piv5aSE55CGaHR0cOivt+axgu+8jOWPkemAgeS4gOS4qmh0dHDor7fmsYLmiYDpnIDnmoTotYTmupDmnInvvJp1cmnvvIxtZXRob2TvvIxoZWFkZXLjgIFib2R544CBcXVlcnkgcGFyYW1ldGVyXHJcbiAqIHVyaSDnlLF1cmlTZXJ2aWNlXHJcbiAqL1xyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBCZWZQcm94eSB7XHJcbiAgcHJvdGVjdGVkIHByb3h5RXh0ZW5kOiBJUHJveHlFeHRlbmQ7XHJcbiAgLyoqXHJcbiAgICogcmVzdGZ1bOWfuui3r+W+hFxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBiYXNlVXJpOiBzdHJpbmc7XHJcbiAgcHJpdmF0ZSBodHRwU2VydmljZTogSHR0cFNlcnZpY2U7XHJcbiAgY29uc3RydWN0b3IocHVibGljIGh0dHBDbGllbnQ6IEh0dHBDbGllbnQsIHB1YmxpYyB1cmlTZXJ2aWNlOiBVcmlTZXJ2aWNlKSB7XHJcbiAgICB0aGlzLmh0dHBTZXJ2aWNlID0gbmV3IEh0dHBTZXJ2aWNlKHRoaXMuaHR0cENsaWVudCk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiuvue9ruWfuui3r+W+hFxyXG4gICAqIEBwYXJhbSBiYXNlVXJpIOWfuui3r+W+hFxyXG4gICAqL1xyXG4gIHB1YmxpYyBzZXRCYXNlVXJpKGJhc2VVcmk6IHN0cmluZyk6IHZvaWQge1xyXG4gICAgdGhpcy5iYXNlVXJpID0gYmFzZVVyaTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6K6+572u562W55Wl5qih5byPXHJcbiAgICogQHBhcmFtIHN0cmF0ZWd5IOetlueVpVxyXG4gICAqL1xyXG4gIHB1YmxpYyBzZXRQcm94eUV4dGVuZChwcm94eUV4dGVuZDogSVByb3h5RXh0ZW5kKSB7XHJcbiAgICB0aGlzLnByb3h5RXh0ZW5kID0gcHJveHlFeHRlbmQ7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOafpeivolxyXG4gICAqL1xyXG4gIHB1YmxpYyBxdWVyeShlbnRpdHlGaWx0ZXI/OiBhbnkpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgbGV0IHVybCA9IHRoaXMuYmFzZVVyaTtcclxuICAgIGlmIChlbnRpdHlGaWx0ZXIpIHtcclxuICAgICAgY29uc3QgZW50aXR5RmlsdGVySnNvbiA9IEpTT04uc3RyaW5naWZ5KGVudGl0eUZpbHRlcik7XHJcbiAgICAgIHVybCA9IGAke3VybH0/ZW50aXR5RmlsdGVyPSR7ZW50aXR5RmlsdGVySnNvbn1gO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdCh1cmwsIEdFVCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmianlsZXmn6Xor6JcclxuICAgKi9cclxuICBwdWJsaWMgZXh0ZW5kUXVlcnkoZW50aXR5RmlsdGVyOiBhbnksIHJlcXVlc3RJbmZvOiBSZXF1ZXN0SW5mbyk6IE9ic2VydmFibGU8UmVzcG9uc2VJbmZvPiB7XHJcbiAgICBsZXQgdXJsID0gYCR7dGhpcy5iYXNlVXJpfS9leHRlbnNpb24vcXVlcnlgO1xyXG4gICAgaWYgKGVudGl0eUZpbHRlcikge1xyXG4gICAgICBsZXQgZW50aXR5RmlsdGVySnNvbiA9IEpTT04uc3RyaW5naWZ5KGVudGl0eUZpbHRlcik7XHJcbiAgICAgIGVudGl0eUZpbHRlckpzb24gPSBlbmNvZGVVcmwoZW50aXR5RmlsdGVySnNvbik7XHJcbiAgICAgIHVybCA9IGAke3VybH0/ZW50aXR5RmlsdGVyPSR7ZW50aXR5RmlsdGVySnNvbn1gO1xyXG4gICAgfVxyXG4gICAgY29uc3QgYm9keSA9IHJlcXVlc3RJbmZvO1xyXG4gICAgY29uc3Qgb3B0aW9ucyA9IHRoaXMuYWRkQm9keVRvT3B0aW9ucyh7fSwgYm9keSk7XHJcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KHVybCwgUFVULCBudWxsLCBvcHRpb25zLCBmYWxzZSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOafpeivouaVsOaNru+8iOW4pui/h+a7pOadoeS7tu+8iVxyXG4gICAqIEBwYXJhbSBlbnRpdHlGaWx0ZXIg6L+H5ruk44CB5o6S5bqP44CB5YiG6aG15L+h5oGvXHJcbiAgICogQHBhcmFtIHJlcXVlc3RJbmZvIHJlcXVlc3RJbmZvXHJcbiAgICogQGRlc2NyaXB0aW9uIOWSjGV4dGVuZFF1ZXJ55LiA6Ie077yM5LuF5bCG5p+l6K+i5Y+C5pWw5pS+5YiwYm9keeS4rVxyXG4gICAqL1xyXG4gIHB1YmxpYyBmaWx0ZXIoZW50aXR5RmlsdGVyOiBhbnksIHJlcXVlc3RJbmZvOiBSZXF1ZXN0SW5mbyk6IE9ic2VydmFibGU8UmVzcG9uc2VJbmZvPiB7XHJcbiAgICBsZXQgdXJsID0gYCR7dGhpcy5iYXNlVXJpfS9leHRlbnNpb24vZmlsdGVyYDtcclxuICAgIGxldCBib2R5OiBhbnkgPSB7IHJlcXVlc3RJbmZvIH07XHJcbiAgICBpZiAoZW50aXR5RmlsdGVyKSB7XHJcbiAgICAgIGJvZHkgPSB7IGVudGl0eUZpbHRlciwgcmVxdWVzdEluZm8gfTtcclxuICAgIH1cclxuICAgIGNvbnN0IG9wdGlvbnMgPSB0aGlzLmFkZEJvZHlUb09wdGlvbnMoe30sIGJvZHkpO1xyXG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdCh1cmwsIFBPU1QsIG51bGwsIG9wdGlvbnMsIGZhbHNlKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOajgOe0ouaVsOaNrlxyXG4gICAqIEBwYXJhbSBpZCDljZXmja7lhoXnoIFcclxuICAgKiBAcmV0dXJuIOaVsOaNruWvueixoVxyXG4gICAqL1xyXG4gIHB1YmxpYyByZXRyaWV2ZShpZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IHVybCA9IGAke3RoaXMuYmFzZVVyaX0vJHtpZH1gO1xyXG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdCh1cmwsIEdFVCk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIEBkZXByZWNhdGVkIOaWueazleW3sue7j+W6n+W8g++8jOivt+WLv+S9v+eUqFxyXG4gICAqL1xyXG4gIHB1YmxpYyBzZXJ2aWNlUmV0cmlldmUoaWQ6IHN0cmluZywgcmV0cmlldmVQYXJhbTogYW55LCByZXF1ZXN0SW5mbzogUmVxdWVzdEluZm8pOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgY29uc3QgdXJsID0gYCR7dGhpcy5iYXNlVXJpfS9zZXJ2aWNlL3JldHJpZXZlLyR7aWR9YDtcclxuICAgIGNvbnN0IG9wdGlvbnMgPSB7XHJcbiAgICAgIGJvZHk6IHsgcmV0cmlldmVQYXJhbSwgcmVxdWVzdEluZm8gfVxyXG4gICAgfTtcclxuICAgIHJldHVybiB0aGlzLnJlcXVlc3QodXJsLCBQVVQsIG51bGwsIG9wdGlvbnMpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDliIbpobXmn6Xor6Lku47ooagv5LuO5LuO6KGo5pWw5o2uXHJcbiAgICogQHBhcmFtIHBhcmFtcyDlj4LmlbBcclxuICAgKi9cclxuICBwdWJsaWMgcXVlcnlDaGlsZChwYXJhbXM6IGFueSkge1xyXG4gICAgY29uc3QgdXJsID0gYCR7dGhpcy5iYXNlVXJpfS9zZXJ2aWNlL3F1ZXJ5Y2hpbGRgO1xyXG4gICAgY29uc3Qgb3B0aW9ucyA9IHsgYm9keTogcGFyYW1zIH07XHJcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KHVybCwgUFVULCBudWxsLCBvcHRpb25zKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOajgOe0ouaVsOaNru+8iOaJqeWxle+8iVxyXG4gICAqL1xyXG4gIHB1YmxpYyBleHRlbmRSZXRyaWV2ZShpZDogc3RyaW5nLCByZXF1ZXN0SW5mbzogUmVxdWVzdEluZm8sIHJldHJpZXZlUGFyYW0/OiBSZXRyaWV2ZVBhcmFtKTogT2JzZXJ2YWJsZTxSZXNwb25zZUluZm8+IHtcclxuICAgIGNvbnN0IHVybCA9IGAke3RoaXMuYmFzZVVyaX0vZXh0ZW5zaW9uL3JldHJpZXZlLyR7aWR9YDtcclxuICAgIGxldCBib2R5OiBhbnkgPSByZXF1ZXN0SW5mbztcclxuICAgIGlmIChyZXRyaWV2ZVBhcmFtKSB7XHJcbiAgICAgIGJvZHkgPSB7IHJldHJpZXZlUGFyYW0sIHJlcXVlc3RJbmZvIH07XHJcbiAgICB9XHJcbiAgICBjb25zdCBvcHRpb25zID0gdGhpcy5hZGRCb2R5VG9PcHRpb25zKHt9LCBib2R5KTtcclxuICAgIHJldHVybiB0aGlzLnJlcXVlc3QodXJsLCBQVVQsIG51bGwsIG9wdGlvbnMpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5qOA57Si5pWw5o2uXHJcbiAgICovXHJcbiAgcHVibGljIGVkaXQoaWQ6IHN0cmluZywgcmVxdWVzdEluZm86IFJlcXVlc3RJbmZvKTogT2JzZXJ2YWJsZTxSZXNwb25zZUluZm8+IHtcclxuICAgIGNvbnN0IHVybCA9IGAke3RoaXMuYmFzZVVyaX0vc2VydmljZS9lZGl0LyR7aWR9YDtcclxuICAgIGNvbnN0IGJvZHkgPSByZXF1ZXN0SW5mbztcclxuICAgIGNvbnN0IG9wdGlvbnMgPSB0aGlzLmFkZEJvZHlUb09wdGlvbnMoe30sIGJvZHkpO1xyXG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdCh1cmwsIFBVVCwgbnVsbCwgb3B0aW9ucyk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDliJvlu7rkuIDmnaHmlbDmja5cclxuICAgKi9cclxuICBwdWJsaWMgY3JlYXRlKGRlZmF1bHRWYWx1ZT86IGFueSwgcmVxdWVzdEluZm8/OiBSZXF1ZXN0SW5mbyk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBjb25zdCBib2R5ID0ge1xyXG4gICAgICBkZWZhdWx0VmFsdWUsXHJcbiAgICAgIHJlcXVlc3RJbmZvOiByZXF1ZXN0SW5mbyxcclxuICAgIH07XHJcbiAgICBjb25zdCBvcHRpb25zID0gdGhpcy5hZGRCb2R5VG9PcHRpb25zKHt9LCBib2R5KTtcclxuICAgIHJldHVybiB0aGlzLnJlcXVlc3QodGhpcy5iYXNlVXJpLCBQT1NULCBudWxsLCBvcHRpb25zKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOS7juihqOaWsOWinlxyXG4gICAqIEBwYXRoIOaWsOWinui3r+W+hO+8iOS7juihqOW9ouWmgu+8mi8xL2VkdXPvvIzku47ku47ooajlvaLlpoLvvJovMS9lZHVzLzExL2dyYWRlc++8iVxyXG4gICAqL1xyXG4gIHB1YmxpYyBjcmVhdGVCeVBhdGgoZnBhdGg6IHN0cmluZywgcmVxdWVzdEluZm8/OiBSZXF1ZXN0SW5mbyk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBjb25zdCBwYXRoVXJsID0gQmVmRGF0YVBhdGhVdGlsLmNvbnZlcnRQYXRoVG9VcmwoZnBhdGgpO1xyXG4gICAgY29uc3QgdXJsID0gYCR7dGhpcy5iYXNlVXJpfSR7cGF0aFVybH1gO1xyXG5cclxuICAgIGNvbnN0IGJvZHkgPSByZXF1ZXN0SW5mbztcclxuICAgIGNvbnN0IG9wdGlvbnMgPSB0aGlzLmFkZEJvZHlUb09wdGlvbnMoe30sIGJvZHkpO1xyXG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdCh1cmwsIFBPU1QsIG51bGwsIG9wdGlvbnMpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5o+Q5Lqk5Y+Y5pu0XHJcbiAgICovXHJcbiAgdXBkYXRlKGNoYW5nZURldGFpbDogQ2hhbmdlRGV0YWlsLCByZXF1ZXN0SW5mbz86IFJlcXVlc3RJbmZvKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IGJvZHkgPSB7XHJcbiAgICAgIGNoYW5nZURldGFpbCxcclxuICAgICAgcmVxdWVzdEluZm86IHJlcXVlc3RJbmZvLFxyXG4gICAgfTtcclxuICAgIGNvbnN0IG9wdGlvbnMgPSB0aGlzLmFkZEJvZHlUb09wdGlvbnMoe30sIGJvZHkpO1xyXG5cclxuICAgIHJldHVybiB0aGlzLnJlcXVlc3QodGhpcy5iYXNlVXJpLCBQQVRDSCwgbnVsbCwgb3B0aW9ucyk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmiafooYzkv53lrZhcclxuICAgKi9cclxuICBwdWJsaWMgc2F2ZShyZXF1ZXN0SW5mbz86IFJlcXVlc3RJbmZvKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IGJvZHkgPSByZXF1ZXN0SW5mbztcclxuICAgIGNvbnN0IG9wdGlvbnMgPSB0aGlzLmFkZEJvZHlUb09wdGlvbnMoe30sIGJvZHkpO1xyXG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdCh0aGlzLmJhc2VVcmksIFBVVCwgbnVsbCwgb3B0aW9ucyk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDliKDpmaRcclxuICAgKi9cclxuICBwdWJsaWMgZGVsZXRlKGlkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgY29uc3QgdXJsID0gYCR7dGhpcy5iYXNlVXJpfS8ke2lkfWA7XHJcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KHVybCwgREVMRVRFKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWIoOmZpOW5tuS/neWtmFxyXG4gICAqL1xyXG4gIHB1YmxpYyBkZWxldGVBbmRTYXZlKGlkOiBhbnksIHJlcXVlc3RJbmZvOiBSZXF1ZXN0SW5mbyk6IE9ic2VydmFibGU8UmVzcG9uc2VJbmZvPiB7XHJcbiAgICBjb25zdCB1cmwgPSBgJHt0aGlzLmJhc2VVcml9L3NlcnZpY2UvZGVsZXRlLyR7aWR9YDtcclxuICAgIGNvbnN0IGJvZHkgPSByZXF1ZXN0SW5mbztcclxuICAgIGNvbnN0IG9wdGlvbnMgPSB0aGlzLmFkZEJvZHlUb09wdGlvbnMoe30sIGJvZHkpO1xyXG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdCh1cmwsIFBVVCwgbnVsbCwgb3B0aW9ucyk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDliKDpmaTvvIjmianlsZXvvIlcclxuICAgKi9cclxuICBwdWJsaWMgZXh0ZW5kRGVsZXRlKGlkOiBzdHJpbmcsIHJlcXVlc3RJbmZvOiBSZXF1ZXN0SW5mbyk6IE9ic2VydmFibGU8UmVzcG9uc2VJbmZvPiB7XHJcbiAgICBjb25zdCB1cmwgPSBgJHt0aGlzLmJhc2VVcml9L2V4dGVuc2lvbi9kZWxldGUvJHtpZH1gO1xyXG4gICAgY29uc3QgYm9keSA9IHJlcXVlc3RJbmZvO1xyXG4gICAgY29uc3Qgb3B0aW9ucyA9IHRoaXMuYWRkQm9keVRvT3B0aW9ucyh7fSwgYm9keSk7XHJcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KHVybCwgUFVULCBudWxsLCBvcHRpb25zKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWIoOmZpOWQjuS7o1xyXG4gICAqIEBwYXJhbSBmcGF0aCDniLbot6/lvoTvvIjku47ooajlvaLlpoLvvJovMS9lZHVz77yM5LuO5LuO6KGo5b2i5aaC77yaLzEvZWR1cy8xMS9ncmFkZXPvvIlcclxuICAgKi9cclxuICBwdWJsaWMgZGVsZXRCeVBhdGgoZnBhdGg6IHN0cmluZywgaWQ6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBjb25zdCBwYXRoVXJsID0gQmVmRGF0YVBhdGhVdGlsLmNvbnZlcnRQYXRoVG9VcmwoZnBhdGgpO1xyXG4gICAgY29uc3QgdXJsID0gYCR7dGhpcy5iYXNlVXJpfSR7cGF0aFVybH0vJHtpZH1gO1xyXG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdCh1cmwsIERFTEVURSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDliKDpmaTlkI7ku6PvvIjmianlsZXvvIlcclxuICAgKiBAcGFyYW0gZnBhdGgg54i26Lev5b6E77yI5LuO6KGo5b2i5aaC77yaLzEvZWR1c++8jOS7juS7juihqOW9ouWmgu+8mi8xL2VkdXMvMTEvZ3JhZGVz77yJXHJcbiAgICovXHJcbiAgcHVibGljIGV4dGVuZERlbGV0QnlQYXRoKGZwYXRoOiBzdHJpbmcsIGlkOiBzdHJpbmcsIHJlcXVlc3RJbmZvOiBSZXF1ZXN0SW5mbyk6IE9ic2VydmFibGU8UmVzcG9uc2VJbmZvPiB7XHJcbiAgICBjb25zdCBwYXRoVXJsID0gQmVmRGF0YVBhdGhVdGlsLmNvbnZlcnRQYXRoVG9VcmwoZnBhdGgpO1xyXG4gICAgY29uc3QgdXJsID0gYCR7dGhpcy5iYXNlVXJpfS9leHRlbnNpb24ke3BhdGhVcmx9LyR7aWR9YDtcclxuICAgIGNvbnN0IGJvZHkgPSByZXF1ZXN0SW5mbztcclxuICAgIGNvbnN0IG9wdGlvbnMgPSB0aGlzLmFkZEJvZHlUb09wdGlvbnMoe30sIGJvZHkpO1xyXG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdCh1cmwsIFBVVCwgbnVsbCwgb3B0aW9ucyk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOaJuemHj+WIoOmZpOWQjuS7o1xyXG4gICAqIEBwYXJhbSBmUGF0aCAnZXh0ZW5zaW9uL3tyb290SWR9L2NjL2JhdGNoJ1xyXG4gICAqIEBwYXJhbSAgaWRzIOWtkOmbhmlkXHJcbiAgICogQHBhcmFtICByZXF1ZXN0SW5mbyDor7fmsYLkv6Hmga9cclxuICAgKi9cclxuICBwdWJsaWMgYmF0Y2hEZWxldGVCeVBhdGgoZlBhdGg6IHN0cmluZywgaWRzOiBzdHJpbmcsIHJlcXVlc3RJbmZvOiBSZXF1ZXN0SW5mbyk6IE9ic2VydmFibGU8UmVzcG9uc2VJbmZvPiB7XHJcbiAgICBjb25zdCBwYXRoVXJsID0gQmVmRGF0YVBhdGhVdGlsLmNvbnZlcnRQYXRoVG9VcmwoZlBhdGgpO1xyXG4gICAgY29uc3QgcGF0aEFycmF5ID0gcGF0aFVybC5zcGxpdCgnLycpO1xyXG4gICAgaWYgKHBhdGhBcnJheS5sZW5ndGggPCAzKSB7XHJcbiAgICAgIHRocm93IEVycm9yKGDmoLnmja5wYXRo5Yig6Zmk5a6e5L2T5pWw5o2u5Ye66ZSZ5LqG44CC5Lyg5YWl55qEcGF0aFske2ZQYXRofV3moLzlvI/kuI3lr7lgKTtcclxuICAgIH1cclxuICAgIC8qICAgY29uc3Qgcm9vdElkID0gcGF0aEFycmF5WzFdO1xyXG5cclxuICAgIGNvbnN0IG5hbWVBcnJheSA9IFtdO1xyXG4gICAgcGF0aEFycmF5LmZvckVhY2goKG5hbWUsIGluZGV4KSA9PiB7XHJcbiAgICAgIGlmIChpbmRleCA+IDEgKSB7XHJcbiAgICAgICAgaWYgKG5hbWUuaW5kZXhPZigncycpICE9PSAtMSkge1xyXG4gICAgICAgICAgbmFtZUFycmF5LnB1c2gobmFtZS5zdWJzdHIoMCwgbmFtZS5sZW5ndGggLSAxKSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIG5hbWVBcnJheS5wdXNoKG5hbWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICBjb25zdCBjaGlsZE5hbWUgPSBuYW1lQXJyYXkuam9pbignLycpOyovXHJcbiAgICBjb25zdCB1cmwgPSBgJHt0aGlzLmJhc2VVcml9L2V4dGVuc2lvbiR7cGF0aFVybH0vYmF0Y2hgO1xyXG4gICAgY29uc3QgaWRzQXJyYXkgPSBpZHMuc3BsaXQoJywnKTtcclxuICAgIGNvbnN0IGJvZHkgPSB7XHJcbiAgICAgIGlkczogaWRzQXJyYXksXHJcbiAgICAgIHJlcXVlc3RJbmZvOiByZXF1ZXN0SW5mb1xyXG4gICAgfTtcclxuICAgIGNvbnN0IG9wdGlvbnMgPSB0aGlzLmFkZEJvZHlUb09wdGlvbnMoe30sIGJvZHkpO1xyXG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdCh1cmwsIFBVVCwgbnVsbCwgb3B0aW9ucyk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOaJuemHj+WIoOmZpFxyXG4gICAqIEBwYXJhbSBpZHMg5b6F5Yig6Zmk55qEaWTmlbDnu4RcclxuICAgKi9cclxuICBwdWJsaWMgYmF0Y2hEZWxldGUoaWRzOiBzdHJpbmdbXSk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBjb25zdCBwYXJhbXMgPSB7XHJcbiAgICAgIGlkczogaWRzLmpvaW4oJywnKVxyXG4gICAgfTtcclxuICAgIHJldHVybiB0aGlzLnJlcXVlc3QodGhpcy5iYXNlVXJpLCBERUxFVEUsIHBhcmFtcyk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOagueaNrmlkc+aJuemHj+WIoOmZpOWunuS9k1xyXG4gICAqIEBwYXJhbSBpZHMgaWRzXHJcbiAgICogQHBhcmFtIGlmU2F2ZSDmmK/lkKbkv53lrZhcclxuICAgKi9cclxuICBwdWJsaWMgZXh0ZW5kQmF0Y2hEZWxldGlvbihpZHM6IHN0cmluZ1tdLCByZXF1ZXN0SW5mbzogUmVxdWVzdEluZm8pOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgY29uc3QgdXJsID0gYCR7dGhpcy5iYXNlVXJpfS9leHRlbnNpb24vYmF0Y2hkZWxldGlvbmA7XHJcbiAgICBjb25zdCBib2R5ID0ge1xyXG4gICAgICBpZHM6IGlkcyxcclxuICAgICAgcmVxdWVzdEluZm86IHJlcXVlc3RJbmZvXHJcbiAgICB9O1xyXG4gICAgY29uc3Qgb3B0aW9ucyA9IHRoaXMuYWRkQm9keVRvT3B0aW9ucyh7fSwgYm9keSk7XHJcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KHVybCwgUFVULCBudWxsLCBvcHRpb25zKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaJuemHj+WIoOmZpO+8iOaJqeWxle+8iVxyXG4gICAqL1xyXG4gIHB1YmxpYyBleHRlbmRCYXRjaERlbGV0ZShpZHM6IHN0cmluZ1tdLCByZXF1ZXN0SW5mbzogUmVxdWVzdEluZm8pOiBPYnNlcnZhYmxlPFJlc3BvbnNlSW5mbz4ge1xyXG4gICAgY29uc3QgdXJsID0gYCR7dGhpcy5iYXNlVXJpfS9leHRlbnNpb24vYmF0Y2hkZWxldGVgO1xyXG4gICAgY29uc3QgcGFyYW1zID0ge1xyXG4gICAgICBpZHM6IGlkcy5qb2luKCcsJylcclxuICAgIH07XHJcblxyXG4gICAgY29uc3QgYm9keSA9IHJlcXVlc3RJbmZvO1xyXG4gICAgY29uc3Qgb3B0aW9ucyA9IHRoaXMuYWRkQm9keVRvT3B0aW9ucyh7fSwgYm9keSk7XHJcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KHVybCwgUFVULCBwYXJhbXMsIG9wdGlvbnMpO1xyXG4gIH1cclxuXHJcblxyXG4gIC8qKlxyXG4gICAqIOWPlua2iFxyXG4gICAqL1xyXG4gIHB1YmxpYyBjYW5jZWwoY29udGV4dD86IGFueSk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBjb25zdCB1cmwgPSBgJHt0aGlzLmJhc2VVcml9L3NlcnZpY2UvY2FuY2VsYDtcclxuICAgIHJldHVybiB0aGlzLnJlcXVlc3QodXJsLCBQT1NULCBudWxsLCBudWxsLCBmYWxzZSwgZmFsc2UsIGZhbHNlLCBjb250ZXh0KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaJuemHj+aWsOWinuS7juihqC/ku47ku47ooajmlbDmja5cclxuICAgKiBAcGFyYW0gcGF0aCDlrp7kvZPnu5Hlrprot6/lvoTvvIxsaWtlIDEvY2hpbGRzIG9yIDEvY2hpbGRzLzExL2NoaWxkY2hpbGRzXHJcbiAgICogQHBhcmFtIGRlZmF1bHRWYWx1ZXMg6buY6K6k5a6e5L2T5pWw5o2u5pWw57uEXHJcbiAgICovXHJcbiAgcHVibGljIGJhdGNoQXBwZW5kQnlQYXRoKHBhdGg6IHN0cmluZywgZGVmYXVsdFZhbHVlczogQXJyYXk8YW55PiwgcmVxdWVzdEluZm86IFJlcXVlc3RJbmZvKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IHBhdGhVcmwgPSBCZWZEYXRhUGF0aFV0aWwuY29udmVydFBhdGhUb1VybChwYXRoKTtcclxuICAgIGNvbnN0IHVybCA9IGAke3RoaXMuYmFzZVVyaX0ke3BhdGhVcmx9L2JhdGNoYDtcclxuICAgIGNvbnN0IGJvZHkgPSB7XHJcbiAgICAgIHJlcXVlc3RJbmZvLFxyXG4gICAgICByZXRyaWV2ZURlZmF1bHRQYXJhbToge1xyXG4gICAgICAgIGRlZmF1bHRWYWx1ZXNcclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgIGNvbnN0IG9wdGlvbnMgPSB0aGlzLmFkZEJvZHlUb09wdGlvbnMoe30sIGJvZHkpO1xyXG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdCh1cmwsIFBPU1QsIG51bGwsIG9wdGlvbnMpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmibnph4/mlrDlop7kuLvooajmlbDmja5cclxuICAgKiBAcGFyYW0gZGVmYXVsdFZhbHVlcyDpu5jorqTlrp7kvZPmlbDmja7mlbDnu4RcclxuICAgKi9cclxuICBwdWJsaWMgYmF0Y2hBcHBlbmQoZGVmYXVsdFZhbHVlczogQXJyYXk8YW55PiwgcmVxdWVzdEluZm86IFJlcXVlc3RJbmZvKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IHVybCA9IGAke3RoaXMuYmFzZVVyaX0vYmF0Y2hgOztcclxuICAgIGNvbnN0IGJvZHkgPSB7XHJcbiAgICAgIHJlcXVlc3RJbmZvLFxyXG4gICAgICByZXRyaWV2ZURlZmF1bHRQYXJhbToge1xyXG4gICAgICAgIGRlZmF1bHRWYWx1ZXNcclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgIGNvbnN0IG9wdGlvbnMgPSB0aGlzLmFkZEJvZHlUb09wdGlvbnMoe30sIGJvZHkpO1xyXG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdCh1cmwsIFBPU1QsIG51bGwsIG9wdGlvbnMpO1xyXG4gIH1cclxuICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IG1heC1saW5lLWxlbmd0aFxyXG4gIHB1YmxpYyByZXF1ZXN0KFxyXG4gICAgdXJsOiBzdHJpbmcsIG1ldGhvZDogc3RyaW5nLCBwYXJhbXM/OiBhbnksIG9wdGlvbnM/OiBhbnksXHJcbiAgICBzZWxmSGFuZEVycm9yPzogYm9vbGVhbiwgaWdub3JlRXJyb3I/OiBib29sZWFuLCBpZ25vcmVDaGFuZ2VzPzogYm9vbGVhbiwgcnVudGltZUNvbnRleHQ/OiBhbnlcclxuICApOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XHJcblxyXG4gICAgLy8g5piv5ZCm6Ieq6KGM5aSE55CG6ZSZ6K+vXHJcbiAgICBpZiAodHlwZW9mIChzZWxmSGFuZEVycm9yKSA9PT0gJ3VuZGVmaW5lZCcgfHwgdHlwZW9mIChzZWxmSGFuZEVycm9yKSAhPT0gJ2Jvb2xlYW4nKSB7XHJcbiAgICAgIHNlbGZIYW5kRXJyb3IgPSBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICAvLyDmmK/lkKblv73nlaXlvILluLjnu6fnu63miafooYxcclxuICAgIGlmICh0eXBlb2YgKGlnbm9yZUVycm9yKSA9PT0gJ3VuZGVmaW5lZCcgfHwgdHlwZW9mIChpZ25vcmVFcnJvcikgIT09ICdib29sZWFuJykge1xyXG4gICAgICBpZ25vcmVFcnJvciA9IGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIHBhcmFtc1xyXG4gICAgaWYgKHBhcmFtcykge1xyXG4gICAgICAvLyBjb25zdCBodHRwUGFyYW1zID0gdGhpcy5idWlsZFBhcmFtcyhwYXJhbXMpO1xyXG4gICAgICBvcHRpb25zLnBhcmFtcyA9IHBhcmFtcztcclxuICAgIH1cclxuXHJcbiAgICAvLyDlpITnkIZoZWFkZXJzXHJcbiAgICBvcHRpb25zLmhlYWRlcnMgPSBIdHRwSGVhZGVyVXRpbC5jb252ZXJ0VG9IZWFkZXJzKG9wdGlvbnMuaGVhZGVycyk7XHJcbiAgICAvLyAx44CB5Yik5pat5piv5ZCm5bimcmVxdWVzdEluZm/vvIjkuI3ljLrliIbpppblrZfmr43lpKflsI/lhpnvvIk7XHJcbiAgICAvLyAy44CB5aaC5p6c5Lyg6YCS55qE5pivUmVxdWVzdEluZm/vvIzliJnovazmjaLkuLpyZXF1ZXN0SW5mb++8m1xyXG4gICAgY29uc3QgaGFzUmVxdWVzdEluZm8gPSB0aGlzLmhhc1JlcXVlc3RJbmZvKG9wdGlvbnMpO1xyXG4gICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5ib2R5ICYmIG9wdGlvbnMuYm9keS5oYXNPd25Qcm9wZXJ0eSgnUmVxdWVzdEluZm8nKSkge1xyXG4gICAgICBvcHRpb25zLmJvZHkucmVxdWVzdEluZm8gPSBvcHRpb25zLmJvZHkuUmVxdWVzdEluZm87XHJcbiAgICAgIGRlbGV0ZSBvcHRpb25zLmJvZHkuUmVxdWVzdEluZm87XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGhpcy5wcm94eUV4dGVuZC5leHRlbmRIZWFkZXJzKG9wdGlvbnMuaGVhZGVycywgcnVudGltZUNvbnRleHQpLnBpcGUoXHJcbiAgICAgIHN3aXRjaE1hcChoZWFkZXJzID0+IHtcclxuICAgICAgICBvcHRpb25zLmhlYWRlcnMgPSBIdHRwSGVhZGVyVXRpbC50b0pzb24oaGVhZGVycyk7XHJcbiAgICAgICAgb3B0aW9ucy5vYnNlcnZlID0gJ3Jlc3BvbnNlJztcclxuICAgICAgICByZXR1cm4gdGhpcy5odHRwU2VydmljZS5yZXF1ZXN0KG1ldGhvZCwgdXJsLCBvcHRpb25zKTtcclxuICAgICAgfSksXHJcbiAgICAgIHRhcCgocmVzcG9uc2U6IGFueSkgPT4gdGhpcy5wcm94eUV4dGVuZC5wYXJzZUhlYWRlcnMocmVzcG9uc2UpKSxcclxuICAgICAgbWFwKChyZXN1bHQ6IGFueSkgPT4gcmVzdWx0LmJvZHkpLFxyXG4gICAgICBtYXAoKHJlc3VsdDogYW55KSA9PiB7XHJcbiAgICAgICAgaWYgKGhhc1JlcXVlc3RJbmZvKSB7XHJcbiAgICAgICAgICB0aGlzLnByb3h5RXh0ZW5kLm9uUmVzcG9uc2UocmVzdWx0LCBpZ25vcmVDaGFuZ2VzLCBvcHRpb25zKTtcclxuICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuXHJcbiAgICAgICAgICAvLyBib2R56YeM5rKh5pyJcmVxdWVzdEluZm/nmoTmg4XlhrXvvIzmqKHmi5/ogIHnmoTlpITnkIbmlrnlvI/vvIjkuI3muIXnkIblj5jmm7TjgIHlsIZyZXR1cm5WYWx1Zeino+aekOWHuuadpe+8iVxyXG4gICAgICAgICAgcmV0dXJuIHRoaXMudW5XcmFwUmVzcG9uc2VJbmZvKHJlc3VsdCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KSxcclxuICAgICAgY2F0Y2hFcnJvcihlcnJvciA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucHJveHlFeHRlbmQub25FcnJvcihlcnJvciwgc2VsZkhhbmRFcnJvciwgaWdub3JlRXJyb3IpO1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiwg+eUqGh0dHBjbGllbnTlj5bmlbBcclxuICAgKiBAcGFyYW0gdXJsIHVybFxyXG4gICAqIEBwYXJhbSBtZXRob2QgbWV0aG9kc1xyXG4gICAqIEBwYXJhbSBvcHRpb25zIG9wdGlvbnNcclxuICAgKi9cclxuICBwcm90ZWN0ZWQgaW52b2tlKHVybDogc3RyaW5nLCBtZXRob2Q6IHN0cmluZywgb3B0aW9uczogYW55KTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGlmIChvcHRpb25zLnBhcmFtcykge1xyXG4gICAgICB1cmwgPSB0aGlzLnByb3h5RXh0ZW5kLmV4dGVuZFVybCh1cmwsIG9wdGlvbnMucGFyYW1zKTtcclxuICAgICAgb3B0aW9ucy5wYXJhbXMgPSBudWxsO1xyXG4gICAgfVxyXG4gICAgaWYgKG9wdGlvbnMuYm9keSkge1xyXG4gICAgICBvcHRpb25zLmJvZHkgPSB0aGlzLnByb3h5RXh0ZW5kLmV4dGVuZEJvZHkob3B0aW9ucy5ib2R5KTtcclxuICAgIH1cclxuICAgIG9wdGlvbnMuaGVhZGVycyA9IEh0dHBIZWFkZXJVdGlsLmNvbnZlcnRUb0hlYWRlcnMob3B0aW9ucy5oZWFkZXJzKTtcclxuICAgIGNvbnN0IGhlYWRlcnMkID0gdGhpcy5wcm94eUV4dGVuZC5leHRlbmRIZWFkZXJzKG9wdGlvbnMuaGVhZGVycyk7XHJcbiAgICByZXR1cm4gaGVhZGVycyQucGlwZShcclxuICAgICAgc3dpdGNoTWFwKGhlYWRlcnMgPT4ge1xyXG4gICAgICAgIG9wdGlvbnMuaGVhZGVycyA9IEh0dHBIZWFkZXJVdGlsLnRvSnNvbihoZWFkZXJzKTtcclxuICAgICAgICBvcHRpb25zLm9ic2VydmUgPSAncmVzcG9uc2UnO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmh0dHBTZXJ2aWNlLnJlcXVlc3QobWV0aG9kLCB1cmwsIG9wdGlvbnMpXHJcbiAgICAgICAgICAucGlwZShcclxuICAgICAgICAgICAgdGFwKChyZXNwb25zZTogYW55KSA9PiB0aGlzLnByb3h5RXh0ZW5kLnBhcnNlSGVhZGVycyhyZXNwb25zZSkpLFxyXG4gICAgICAgICAgICBtYXAoKHJlc3VsdDogYW55KSA9PiByZXN1bHQuYm9keSksXHJcbiAgICAgICAgICAgIG1hcCgocmVzdWx0OiBhbnkpID0+IHRoaXMucHJveHlFeHRlbmQub25SZXNwb25zZShyZXN1bHQsIGZhbHNlLCBvcHRpb25zKSksXHJcbiAgICAgICAgICAgIGNhdGNoRXJyb3IoZXJyb3IgPT4gdGhpcy5wcm94eUV4dGVuZC5vbkVycm9yKGVycm9yLCBmYWxzZSwgZmFsc2UpKVxyXG4gICAgICAgICAgKTtcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlkJFIdHRwT3B0aW9uc+WvueixoeS4rea3u+WKoGJvZHlcclxuICAgKiBAcGFyYW0gb3B0aW9ucyDljp/mnaXnmoRvcHRpb25zXHJcbiAgICogQHBhcmFtIGJvZHkgYm9keeWGheWuuVxyXG4gICAqL1xyXG4gIHByaXZhdGUgYWRkQm9keVRvT3B0aW9ucyhvcHRpb25zOiBhbnksIGJvZHk6IGFueSkge1xyXG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XHJcbiAgICBjb25zdCBtZXJnZWRPcHRpb25zID0gT2JqZWN0LmFzc2lnbihvcHRpb25zLCB7IGJvZHkgfSk7XHJcbiAgICByZXR1cm4gbWVyZ2VkT3B0aW9ucztcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5p6E6YCgSHR0cFBhcmFtc+WvueixoVxyXG4gICAqIEBwYXJhbSBwYXJhbXMg6K+35rGC5Y+C5pWwXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBidWlsZFBhcmFtcyhwYXJhbXM6IG9iamVjdCk6IEh0dHBQYXJhbXMge1xyXG4gICAgcmV0dXJuIEh0dHBQYXJhbVV0aWwuYnVpbGRQYXJhbXMocGFyYW1zKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5piv5ZCm5bim5pyJUmVxdWVzdEluZm9cclxuICAgKi9cclxuICBwcml2YXRlIGhhc1JlcXVlc3RJbmZvKG9wdGlvbnM6IGFueSk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIFJlcXVlc3RJbmZvVXRpbC5oYXNSZXF1ZXN0SW5mbyhvcHRpb25zKSB8fCBSZXF1ZXN0SW5mb1V0aWwuaGFzUmVxdWVzdEluZm9XaXRoUihvcHRpb25zKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5aSE55CG6L+U5Zue5YC877yM5YW85a656ICB54mI5pysXHJcbiAgICovXHJcbiAgcHJpdmF0ZSB1bldyYXBSZXNwb25zZUluZm8ocmVzdWx0OiBhbnkpIHtcclxuICAgIHJldHVybiBSZXNwb25zZUluZm9VdGlsLnVuV3JhcFJlc3BvbnNlSW5mbyhyZXN1bHQpO1xyXG4gIH1cclxufVxyXG4iXX0=