import { MessagePipe } from './message-pipe';
import { RuntimeFrameworkService } from '../rtf-service';
import { QuerystringService } from '../querystring';
var MessagePipeService = /** @class */ (function () {
    function MessagePipeService() {
    }
    /**
     * 通过token获取消息管道
     * @param token 消息管道标识
     */
    MessagePipeService.get = function (token) {
        var pipe = new MessagePipe(token, this.rtfService);
        return pipe;
    };
    /**
     * 创建消息管道
     * @param pipeName 管道名称
     * @param useFormContext 是否使用表单上下文创建管道标识
     * @param pipeType 管道类型(可选)，默认Subject<any>
     */
    MessagePipeService.create = function (pipeName, useFormContext, pipeType) {
        var options = null;
        if (useFormContext) {
            var params = this.querystringService.parse(window.location.hash);
            var funcId = params.funcId, appId = params.appId, appEntrance = params.appEntrance;
            options = { funcId: funcId, appId: appId, appEntrance: appEntrance };
        }
        var token = this.rtfService.subjectRegister(pipeName, options, pipeType);
        if (!token) {
            return null;
        }
        var pipe = new MessagePipe(token, this.rtfService);
        return pipe;
    };
    MessagePipeService.rtfService = new RuntimeFrameworkService();
    MessagePipeService.querystringService = new QuerystringService();
    return MessagePipeService;
}());
export { MessagePipeService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWVzc2FnZS1waXBlLXNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2NvbW1hbmQtc2VydmljZXMvIiwic291cmNlcyI6WyJsaWIvcnRmLW1lc3NhZ2UvbWVzc2FnZS1waXBlLXNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzdDLE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRXpELE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRXBEO0lBQUE7SUErQkEsQ0FBQztJQTVCQzs7O09BR0c7SUFDVyxzQkFBRyxHQUFqQixVQUFrQixLQUFhO1FBQzdCLElBQU0sSUFBSSxHQUFHLElBQUksV0FBVyxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDckQsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBQ0Q7Ozs7O09BS0c7SUFDVyx5QkFBTSxHQUFwQixVQUFxQixRQUFnQixFQUFFLGNBQXVCLEVBQUUsUUFBdUI7UUFDckYsSUFBSSxPQUFPLEdBQUcsSUFBSSxDQUFDO1FBQ25CLElBQUksY0FBYyxFQUFFO1lBQ2xCLElBQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUMzRCxJQUFBLHNCQUFNLEVBQUUsb0JBQUssRUFBRSxnQ0FBVyxDQUFZO1lBQzlDLE9BQU8sR0FBRyxFQUFFLE1BQU0sUUFBQSxFQUFFLEtBQUssT0FBQSxFQUFFLFdBQVcsYUFBQSxFQUFFLENBQUM7U0FDMUM7UUFDRCxJQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLGVBQWUsQ0FBQyxRQUFRLEVBQUUsT0FBTyxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBQzNFLElBQUksQ0FBQyxLQUFLLEVBQUU7WUFDVixPQUFPLElBQUksQ0FBQztTQUNiO1FBQ0QsSUFBTSxJQUFJLEdBQUcsSUFBSSxXQUFXLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUNyRCxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUE3QmMsNkJBQVUsR0FBNEIsSUFBSSx1QkFBdUIsRUFBRSxDQUFDO0lBQ3BFLHFDQUFrQixHQUF1QixJQUFJLGtCQUFrQixFQUFFLENBQUM7SUE2Qm5GLHlCQUFDO0NBQUEsQUEvQkQsSUErQkM7U0EvQlksa0JBQWtCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTWVzc2FnZVBpcGUgfSBmcm9tICcuL21lc3NhZ2UtcGlwZSc7XG5pbXBvcnQgeyBSdW50aW1lRnJhbWV3b3JrU2VydmljZSB9IGZyb20gJy4uL3J0Zi1zZXJ2aWNlJztcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IFF1ZXJ5c3RyaW5nU2VydmljZSB9IGZyb20gJy4uL3F1ZXJ5c3RyaW5nJztcblxuZXhwb3J0IGNsYXNzIE1lc3NhZ2VQaXBlU2VydmljZSB7XG4gIHByaXZhdGUgc3RhdGljIHJ0ZlNlcnZpY2U6IFJ1bnRpbWVGcmFtZXdvcmtTZXJ2aWNlID0gbmV3IFJ1bnRpbWVGcmFtZXdvcmtTZXJ2aWNlKCk7XG4gIHByaXZhdGUgc3RhdGljIHF1ZXJ5c3RyaW5nU2VydmljZTogUXVlcnlzdHJpbmdTZXJ2aWNlID0gbmV3IFF1ZXJ5c3RyaW5nU2VydmljZSgpO1xuICAvKipcbiAgICog6YCa6L+HdG9rZW7ojrflj5bmtojmga/nrqHpgZNcbiAgICogQHBhcmFtIHRva2VuIOa2iOaBr+euoemBk+agh+ivhlxuICAgKi9cbiAgcHVibGljIHN0YXRpYyBnZXQodG9rZW46IHN0cmluZyk6IE1lc3NhZ2VQaXBlIHtcbiAgICBjb25zdCBwaXBlID0gbmV3IE1lc3NhZ2VQaXBlKHRva2VuLCB0aGlzLnJ0ZlNlcnZpY2UpO1xuICAgIHJldHVybiBwaXBlO1xuICB9XG4gIC8qKlxuICAgKiDliJvlu7rmtojmga/nrqHpgZNcbiAgICogQHBhcmFtIHBpcGVOYW1lIOeuoemBk+WQjeensFxuICAgKiBAcGFyYW0gdXNlRm9ybUNvbnRleHQg5piv5ZCm5L2/55So6KGo5Y2V5LiK5LiL5paH5Yib5bu6566h6YGT5qCH6K+GXG4gICAqIEBwYXJhbSBwaXBlVHlwZSDnrqHpgZPnsbvlnoso5Y+v6YCJKe+8jOm7mOiupFN1YmplY3Q8YW55PlxuICAgKi9cbiAgcHVibGljIHN0YXRpYyBjcmVhdGUocGlwZU5hbWU6IHN0cmluZywgdXNlRm9ybUNvbnRleHQ6IGJvb2xlYW4sIHBpcGVUeXBlPzogU3ViamVjdDxhbnk+KTogTWVzc2FnZVBpcGUge1xuICAgIGxldCBvcHRpb25zID0gbnVsbDtcbiAgICBpZiAodXNlRm9ybUNvbnRleHQpIHtcbiAgICAgIGNvbnN0IHBhcmFtcyA9IHRoaXMucXVlcnlzdHJpbmdTZXJ2aWNlLnBhcnNlKHdpbmRvdy5sb2NhdGlvbi5oYXNoKTtcbiAgICAgIGNvbnN0IHsgZnVuY0lkLCBhcHBJZCwgYXBwRW50cmFuY2UgfSA9IHBhcmFtcztcbiAgICAgIG9wdGlvbnMgPSB7IGZ1bmNJZCwgYXBwSWQsIGFwcEVudHJhbmNlIH07XG4gICAgfVxuICAgIGNvbnN0IHRva2VuID0gdGhpcy5ydGZTZXJ2aWNlLnN1YmplY3RSZWdpc3RlcihwaXBlTmFtZSwgb3B0aW9ucywgcGlwZVR5cGUpO1xuICAgIGlmICghdG9rZW4pIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCBwaXBlID0gbmV3IE1lc3NhZ2VQaXBlKHRva2VuLCB0aGlzLnJ0ZlNlcnZpY2UpO1xuICAgIHJldHVybiBwaXBlO1xuICB9XG59XG4iXX0=