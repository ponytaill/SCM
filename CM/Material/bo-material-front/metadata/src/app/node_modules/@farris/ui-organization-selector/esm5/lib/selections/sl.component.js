/**
 * @fileoverview added by tsickle
 * Generated from: lib/selections/sl.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, EventEmitter, Output, ChangeDetectorRef, Injector, NgZone } from '@angular/core';
import { ApiService } from '../../utils/api.service';
import * as _ from 'lodash-es';
import { FavoritesTool } from '../../utils/favorites.tool';
import { ChangeType } from '../../utils/index.type';
import { CommonUtil } from '../../utils/common.tool';
import { StateMgrTool } from '../../utils/state.mgr.tool';
import { LocaleService } from '@farris/ui-locale';
import { ORGANIZATION_SELECTOR_LOCALE } from '../../utils/locale';
var SelectionComponent = /** @class */ (function () {
    function SelectionComponent(apiService, cdr, favoritesTool, injector, ngZone, stateMgr) {
        this.apiService = apiService;
        this.cdr = cdr;
        this.favoritesTool = favoritesTool;
        this.injector = injector;
        this.ngZone = ngZone;
        this.stateMgr = stateMgr;
        this.openedChange = new EventEmitter();
        this.datas = [];
        this.items = [];
        this.pageIndex = 0;
        this.pageSize = 5;
        this.moreText = '';
        this.localeService = null;
        this.moreDataText = '';
        this.noneDataText = '';
        this.cdr = this.injector.get(ChangeDetectorRef);
        this.localeService = this.injector.get(LocaleService);
        if (!this.localeService.langData['organizationSelector']) {
            this.localeService.setLocaleData(ORGANIZATION_SELECTOR_LOCALE);
        }
    }
    /**
     * @return {?}
     */
    SelectionComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.selectionsSub.unsubscribe();
    };
    /**
     * @return {?}
     */
    SelectionComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.selectionsSub = this.stateMgr.selectionsSubject.subscribe((/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            _this.pageIndex = 0;
            if (data.changeType === ChangeType.ValueChanged) {
                _this.datas = _.cloneDeep(data.value);
            }
            else if (data.changeType === ChangeType.Remove) {
                _this.datas = _this.datas.filter((/**
                 * @param {?} item
                 * @return {?}
                 */
                function (item) { return item[_this.primaryField] !== data.value[_this.primaryField]; }));
            }
            else if (data.changeType === ChangeType.Append) {
                if (CommonUtil.findIndex(data.value[_this.primaryField], _this.primaryField, _this.datas) === -1) {
                    _this.datas.push(data.value);
                }
            }
            _this.items = _this.datas.slice(_this.pageIndex, _this.pageSize);
            if (_this.items.length < _this.datas.length) {
                _this.moreText = _this.moreDataText;
            }
            else {
                _this.moreText = _this.noneDataText;
            }
            _this.cdr.detectChanges();
        }));
        this.moreDataText = this.localeService.getValue("organizationSelector.tabCommon.more");
        this.noneDataText = this.localeService.getValue("organizationSelector.tabCommon.noMore");
    };
    /**
     * @return {?}
     */
    SelectionComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    SelectionComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
    };
    /**
     * @return {?}
     */
    SelectionComponent.prototype.openGroupDialog = /**
     * @return {?}
     */
    function () {
        this.openedChange.emit(true);
    };
    /**
     * @param {?} index
     * @param {?} item
     * @return {?}
     */
    SelectionComponent.prototype.trackByFn = /**
     * @param {?} index
     * @param {?} item
     * @return {?}
     */
    function (index, item) {
        return index;
    };
    /**
     * @return {?}
     */
    SelectionComponent.prototype.loadMore = /**
     * @return {?}
     */
    function () {
        if (this.pageIndex < this.datas.length) {
            this.pageIndex += 1;
            /** @type {?} */
            var currentPageIndex = this.pageIndex * this.pageSize;
            /** @type {?} */
            var currentItems = this.datas.slice(currentPageIndex, currentPageIndex + this.pageSize);
            this.items = this.items.concat(currentItems);
            if (this.items.length && this.items.length === this.datas.length) {
                this.moreText = this.noneDataText;
            }
            this.cdr.detectChanges;
        }
    };
    /**
     * @param {?} e
     * @param {?} data
     * @param {?} i
     * @return {?}
     */
    SelectionComponent.prototype.removeItem = /**
     * @param {?} e
     * @param {?} data
     * @param {?} i
     * @return {?}
     */
    function (e, data, i) {
        this.stateMgr.emitSelections(data, ChangeType.Remove, 'selection');
        if (i !== 0) {
            e.stopPropagation();
            e.cancelBubble = true;
        }
    };
    SelectionComponent.decorators = [
        { type: Component, args: [{
                    selector: 'lib-selection',
                    template: "<div class=\"selections-content\">\r\n    <perfect-scrollbar style=\"max-height: 340px;min-height: 40px;\">\r\n        <ng-container *ngFor=\"let item of items; let i = index;trackBy: trackByFn\">\r\n            <div class=\"selections-blank-4\"></div>\r\n            <div class=\"selections-item\">\r\n                <span class=\"si-icon-circle\">{{ i + 1 }}</span>\r\n                <dl>\r\n                    <dt>{{ item.name }}</dt>\r\n                    <dd title=\"{{item.orgAllPath}}\">{{ item.orgAllPath }}</dd>\r\n                </dl>\r\n                <span class=\"f-icon f-icon-minus-circle deleteBtn\" (click)=\"removeItem($event, item, i)\"></span>\r\n            </div>\r\n        </ng-container>\r\n        <div class=\"selections-more\">\r\n            <span (click)=\"loadMore()\"\r\n                [ngStyle]=\"{'color': moreText === moreDataText ? '#2A87FF' : '#ded5d5', 'cursor': moreText === moreDataText ? 'pointer' : 'default'}\">{{\r\n                moreText }}</span>\r\n            <div class=\"saved-group\" (click)=\"openGroupDialog()\" *ngIf=\"enableGroup\">\r\n                <span class=\"f-icon f-icon-team\"></span>{{'organizationSelector.group.saveGroup' | locale}}\r\n            </div>\r\n        </div>\r\n        <div class=\"selections-blank-34\"></div>\r\n    </perfect-scrollbar>\r\n</div>\r\n<div class=\"selections-triangle-down\"></div>",
                    styles: [".selections-content{box-shadow:0 1px 12px 0 rgba(73,84,102,.15);border-radius:7px;width:340px;height:auto;overflow:hidden}.selections-item{width:332px;height:44px;border-radius:6px;margin:0 4px;display:-webkit-box;display:flex}.selections-blank-4{width:100%;height:4px}.selections-blank-34{width:100%;height:34px}.selections-item:hover{background:#ebf4ff}.selections-item .si-icon-circle{border-radius:50%;font-size:12px;width:14px;height:14px;background:#62c8ca;text-align:center;display:block;color:#fff;margin:7px 8px 0 11px;line-height:14px}.selections-item dl{-webkit-box-flex:1;flex:1;margin-top:3px;font-size:13px;overflow:hidden}.selections-item dl dt{font-weight:400;line-height:18px;color:#53565d}.selections-item dl dd{line-height:18px;color:#a8adb8;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.selections-item .deleteBtn{font-size:14px;margin:15px 15px 0;color:#f46160;cursor:pointer}.selections-triangle-down{width:0;height:0;border-left:6px solid transparent;border-right:6px solid transparent;border-top:8px solid #fff;margin-left:40px}.selections-more{text-align:center;padding:4px 20px;height:34px;line-height:26px;font-size:13px;color:#2a87ff;display:-webkit-box;display:flex;-webkit-box-pack:justify;justify-content:space-between;position:absolute;bottom:0;left:0;right:0;background:#fff}.selections-more .saved-group{width:95px;height:26px;line-height:26px;background:#eaedf2;border-radius:5px;text-align:center;font-size:13px;color:#909ba2;cursor:pointer}.selections-more .saved-group:hover{color:#2a87ff;background:#eaf4ff}.selections-more .saved-group:hover .f-icon{color:#2a87ff}.selections-more .saved-group .f-icon{color:#909ba2;margin-right:5px;cursor:pointer;font-size:14px}"]
                }] }
    ];
    /** @nocollapse */
    SelectionComponent.ctorParameters = function () { return [
        { type: ApiService },
        { type: ChangeDetectorRef },
        { type: FavoritesTool },
        { type: Injector },
        { type: NgZone },
        { type: StateMgrTool }
    ]; };
    SelectionComponent.propDecorators = {
        primaryField: [{ type: Input }],
        enableGroup: [{ type: Input }],
        openedChange: [{ type: Output }]
    };
    return SelectionComponent;
}());
export { SelectionComponent };
if (false) {
    /** @type {?} */
    SelectionComponent.prototype.primaryField;
    /** @type {?} */
    SelectionComponent.prototype.enableGroup;
    /** @type {?} */
    SelectionComponent.prototype.openedChange;
    /** @type {?} */
    SelectionComponent.prototype.datas;
    /** @type {?} */
    SelectionComponent.prototype.items;
    /** @type {?} */
    SelectionComponent.prototype.pageIndex;
    /** @type {?} */
    SelectionComponent.prototype.pageSize;
    /** @type {?} */
    SelectionComponent.prototype.moreText;
    /** @type {?} */
    SelectionComponent.prototype.selectionsSub;
    /** @type {?} */
    SelectionComponent.prototype.localeService;
    /** @type {?} */
    SelectionComponent.prototype.moreDataText;
    /** @type {?} */
    SelectionComponent.prototype.noneDataText;
    /**
     * @type {?}
     * @private
     */
    SelectionComponent.prototype.apiService;
    /**
     * @type {?}
     * @private
     */
    SelectionComponent.prototype.cdr;
    /**
     * @type {?}
     * @private
     */
    SelectionComponent.prototype.favoritesTool;
    /**
     * @type {?}
     * @private
     */
    SelectionComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    SelectionComponent.prototype.ngZone;
    /**
     * @type {?}
     * @private
     */
    SelectionComponent.prototype.stateMgr;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2wuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1vcmdhbml6YXRpb24tc2VsZWN0b3IvIiwic291cmNlcyI6WyJsaWIvc2VsZWN0aW9ucy9zbC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQ0gsU0FBUyxFQUFFLEtBQUssRUFBRSxZQUFZLEVBQUUsTUFBTSxFQUFtRCxpQkFBaUIsRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUMvSCxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFDckQsT0FBTyxLQUFLLENBQUMsTUFBTSxXQUFXLENBQUM7QUFDL0IsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBQzNELE9BQU8sRUFBRSxVQUFVLEVBQW1CLE1BQU0sd0JBQXdCLENBQUM7QUFDckUsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBQ3JELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUUxRCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDbEQsT0FBTyxFQUFFLDRCQUE0QixFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFFbEU7SUFxQkksNEJBQ1ksVUFBc0IsRUFDdEIsR0FBc0IsRUFDdEIsYUFBNEIsRUFDNUIsUUFBa0IsRUFDbEIsTUFBYyxFQUNkLFFBQXNCO1FBTHRCLGVBQVUsR0FBVixVQUFVLENBQVk7UUFDdEIsUUFBRyxHQUFILEdBQUcsQ0FBbUI7UUFDdEIsa0JBQWEsR0FBYixhQUFhLENBQWU7UUFDNUIsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUNsQixXQUFNLEdBQU4sTUFBTSxDQUFRO1FBQ2QsYUFBUSxHQUFSLFFBQVEsQ0FBYztRQWxCeEIsaUJBQVksR0FBRyxJQUFJLFlBQVksRUFBVyxDQUFDO1FBRXJELFVBQUssR0FB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QyxNQUFNLEVBQUUsV0FBVyxDQUFDLENBQUM7UUFDbkUsSUFBRyxDQUFDLEtBQUssQ0FBQyxFQUFFO1lBQ1IsQ0FBQyxDQUFDLGVBQWUsRUFBRSxDQUFDO1lBQ3BCLENBQUMsQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDO1NBQ3pCO0lBQ0wsQ0FBQzs7Z0JBbkdKLFNBQVMsU0FBQztvQkFDUCxRQUFRLEVBQUUsZUFBZTtvQkFDekIsMDNDQUFrQzs7aUJBRXJDOzs7O2dCQWRRLFVBQVU7Z0JBRjBFLGlCQUFpQjtnQkFJckcsYUFBYTtnQkFKMEYsUUFBUTtnQkFBRSxNQUFNO2dCQU92SCxZQUFZOzs7K0JBWWhCLEtBQUs7OEJBQ0wsS0FBSzsrQkFDTCxNQUFNOztJQTZGWCx5QkFBQztDQUFBLEFBdEdELElBc0dDO1NBakdZLGtCQUFrQjs7O0lBRTNCLDBDQUE4Qjs7SUFDOUIseUNBQThCOztJQUM5QiwwQ0FBcUQ7O0lBRXJELG1DQUFXOztJQUNYLG1DQUFXOztJQUNYLHVDQUFjOztJQUNkLHNDQUFhOztJQUNiLHNDQUFjOztJQUNkLDJDQUE0Qjs7SUFDNUIsMkNBQW9DOztJQUNwQywwQ0FBa0I7O0lBQ2xCLDBDQUFrQjs7Ozs7SUFHZCx3Q0FBOEI7Ozs7O0lBQzlCLGlDQUE4Qjs7Ozs7SUFDOUIsMkNBQW9DOzs7OztJQUNwQyxzQ0FBMEI7Ozs7O0lBQzFCLG9DQUFzQjs7Ozs7SUFDdEIsc0NBQThCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICAgIENvbXBvbmVudCwgSW5wdXQsIEV2ZW50RW1pdHRlciwgT3V0cHV0LCBPbkluaXQsIEFmdGVyVmlld0luaXQsIFNpbXBsZUNoYW5nZXMsIE9uQ2hhbmdlcywgQ2hhbmdlRGV0ZWN0b3JSZWYsIEluamVjdG9yLCBOZ1pvbmUsIE9uRGVzdHJveVxyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBBcGlTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vdXRpbHMvYXBpLnNlcnZpY2UnO1xyXG5pbXBvcnQgKiBhcyBfIGZyb20gJ2xvZGFzaC1lcyc7XHJcbmltcG9ydCB7IEZhdm9yaXRlc1Rvb2wgfSBmcm9tICcuLi8uLi91dGlscy9mYXZvcml0ZXMudG9vbCc7XHJcbmltcG9ydCB7IENoYW5nZVR5cGUsIE9yZ1JlcXVlc3RQYXJhbSB9IGZyb20gJy4uLy4uL3V0aWxzL2luZGV4LnR5cGUnO1xyXG5pbXBvcnQgeyBDb21tb25VdGlsIH0gZnJvbSAnLi4vLi4vdXRpbHMvY29tbW9uLnRvb2wnO1xyXG5pbXBvcnQgeyBTdGF0ZU1nclRvb2wgfSBmcm9tICcuLi8uLi91dGlscy9zdGF0ZS5tZ3IudG9vbCc7XHJcbmltcG9ydCB7IFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBMb2NhbGVTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1sb2NhbGUnO1xyXG5pbXBvcnQgeyBPUkdBTklaQVRJT05fU0VMRUNUT1JfTE9DQUxFIH0gZnJvbSAnLi4vLi4vdXRpbHMvbG9jYWxlJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdsaWItc2VsZWN0aW9uJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnLi9zbC5jb21wb25lbnQuaHRtbCcsXHJcbiAgICBzdHlsZVVybHM6IFsnLi9zbC5jb21wb25lbnQuY3NzJ10sXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBTZWxlY3Rpb25Db21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIEFmdGVyVmlld0luaXQsIE9uQ2hhbmdlcywgT25EZXN0cm95IHtcclxuXHJcbiAgICBASW5wdXQoKSBwcmltYXJ5RmllbGQ6IHN0cmluZztcclxuICAgIEBJbnB1dCgpIGVuYWJsZUdyb3VwOiBib29sZWFuO1xyXG4gICAgQE91dHB1dCgpIG9wZW5lZENoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXI8Ym9vbGVhbj4oKTtcclxuXHJcbiAgICBkYXRhcyA9IFtdO1xyXG4gICAgaXRlbXMgPSBbXTtcclxuICAgIHBhZ2VJbmRleCA9IDA7XHJcbiAgICBwYWdlU2l6ZSA9IDU7XHJcbiAgICBtb3JlVGV4dCA9ICcnO1xyXG4gICAgc2VsZWN0aW9uc1N1YjogU3Vic2NyaXB0aW9uO1xyXG4gICAgbG9jYWxlU2VydmljZTogTG9jYWxlU2VydmljZSA9IG51bGw7XHJcbiAgICBtb3JlRGF0YVRleHQgPSAnJztcclxuICAgIG5vbmVEYXRhVGV4dCA9ICcnO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIHByaXZhdGUgYXBpU2VydmljZTogQXBpU2VydmljZSxcclxuICAgICAgICBwcml2YXRlIGNkcjogQ2hhbmdlRGV0ZWN0b3JSZWYsXHJcbiAgICAgICAgcHJpdmF0ZSBmYXZvcml0ZXNUb29sOiBGYXZvcml0ZXNUb29sLFxyXG4gICAgICAgIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yLFxyXG4gICAgICAgIHByaXZhdGUgbmdab25lOiBOZ1pvbmUsXHJcbiAgICAgICAgcHJpdmF0ZSBzdGF0ZU1ncjogU3RhdGVNZ3JUb29sXHJcbiAgICApIHtcclxuICAgICAgICB0aGlzLmNkciA9IHRoaXMuaW5qZWN0b3IuZ2V0KENoYW5nZURldGVjdG9yUmVmKTtcclxuICAgICAgICB0aGlzLmxvY2FsZVNlcnZpY2UgPSB0aGlzLmluamVjdG9yLmdldChMb2NhbGVTZXJ2aWNlKTtcclxuICAgICAgICBpZighdGhpcy5sb2NhbGVTZXJ2aWNlLmxhbmdEYXRhWydvcmdhbml6YXRpb25TZWxlY3RvciddKSB7XHJcbiAgICAgICAgICAgIHRoaXMubG9jYWxlU2VydmljZS5zZXRMb2NhbGVEYXRhKE9SR0FOSVpBVElPTl9TRUxFQ1RPUl9MT0NBTEUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnNlbGVjdGlvbnNTdWIudW5zdWJzY3JpYmUoKTtcclxuICAgIH1cclxuXHJcbiAgICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnNlbGVjdGlvbnNTdWIgPSB0aGlzLnN0YXRlTWdyLnNlbGVjdGlvbnNTdWJqZWN0LnN1YnNjcmliZShkYXRhID0+IHtcclxuICAgICAgICAgICAgdGhpcy5wYWdlSW5kZXggPSAwO1xyXG4gICAgICAgICAgICBpZiAoZGF0YS5jaGFuZ2VUeXBlID09PSBDaGFuZ2VUeXBlLlZhbHVlQ2hhbmdlZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kYXRhcyA9IF8uY2xvbmVEZWVwKGRhdGEudmFsdWUpO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGRhdGEuY2hhbmdlVHlwZSA9PT0gQ2hhbmdlVHlwZS5SZW1vdmUpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGF0YXMgPSB0aGlzLmRhdGFzLmZpbHRlcihpdGVtID0+IGl0ZW1bdGhpcy5wcmltYXJ5RmllbGRdICE9PSBkYXRhLnZhbHVlW3RoaXMucHJpbWFyeUZpZWxkXSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZGF0YS5jaGFuZ2VUeXBlID09PSBDaGFuZ2VUeXBlLkFwcGVuZCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKENvbW1vblV0aWwuZmluZEluZGV4KGRhdGEudmFsdWVbdGhpcy5wcmltYXJ5RmllbGRdLCB0aGlzLnByaW1hcnlGaWVsZCwgdGhpcy5kYXRhcykgPT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXRhcy5wdXNoKGRhdGEudmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuaXRlbXMgPSB0aGlzLmRhdGFzLnNsaWNlKHRoaXMucGFnZUluZGV4LCB0aGlzLnBhZ2VTaXplKTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuaXRlbXMubGVuZ3RoIDwgdGhpcy5kYXRhcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubW9yZVRleHQgPSB0aGlzLm1vcmVEYXRhVGV4dDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubW9yZVRleHQgPSB0aGlzLm5vbmVEYXRhVGV4dDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmNkci5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5tb3JlRGF0YVRleHQgPSB0aGlzLmxvY2FsZVNlcnZpY2UuZ2V0VmFsdWUoXCJvcmdhbml6YXRpb25TZWxlY3Rvci50YWJDb21tb24ubW9yZVwiKTtcclxuICAgICAgICB0aGlzLm5vbmVEYXRhVGV4dCA9IHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZShcIm9yZ2FuaXphdGlvblNlbGVjdG9yLnRhYkNvbW1vbi5ub01vcmVcIik7XHJcbiAgICB9XHJcblxyXG4gICAgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIG9wZW5Hcm91cERpYWxvZygpIHtcclxuICAgICAgICB0aGlzLm9wZW5lZENoYW5nZS5lbWl0KHRydWUpO1xyXG4gICAgfVxyXG5cclxuICAgIHRyYWNrQnlGbihpbmRleCwgaXRlbSkge1xyXG4gICAgICAgIHJldHVybiBpbmRleDtcclxuICAgIH1cclxuXHJcbiAgICBsb2FkTW9yZSgpIHtcclxuICAgICAgICBpZiAodGhpcy5wYWdlSW5kZXggPCB0aGlzLmRhdGFzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICB0aGlzLnBhZ2VJbmRleCArPSAxO1xyXG4gICAgICAgICAgICBjb25zdCBjdXJyZW50UGFnZUluZGV4ID0gdGhpcy5wYWdlSW5kZXggKiB0aGlzLnBhZ2VTaXplO1xyXG4gICAgICAgICAgICBjb25zdCBjdXJyZW50SXRlbXMgPSB0aGlzLmRhdGFzLnNsaWNlKGN1cnJlbnRQYWdlSW5kZXgsIGN1cnJlbnRQYWdlSW5kZXggKyB0aGlzLnBhZ2VTaXplKVxyXG4gICAgICAgICAgICB0aGlzLml0ZW1zID0gdGhpcy5pdGVtcy5jb25jYXQoY3VycmVudEl0ZW1zKTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuaXRlbXMubGVuZ3RoICYmIHRoaXMuaXRlbXMubGVuZ3RoID09PSB0aGlzLmRhdGFzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5tb3JlVGV4dCA9IHRoaXMubm9uZURhdGFUZXh0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuY2RyLmRldGVjdENoYW5nZXM7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJlbW92ZUl0ZW0oZTogYW55LCBkYXRhOiBhbnksIGk6IGFueSkge1xyXG4gICAgICAgIHRoaXMuc3RhdGVNZ3IuZW1pdFNlbGVjdGlvbnMoZGF0YSwgQ2hhbmdlVHlwZS5SZW1vdmUsICdzZWxlY3Rpb24nKTtcclxuICAgICAgICBpZihpICE9PSAwKSB7XHJcbiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgIGUuY2FuY2VsQnViYmxlID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxufVxyXG4iXX0=