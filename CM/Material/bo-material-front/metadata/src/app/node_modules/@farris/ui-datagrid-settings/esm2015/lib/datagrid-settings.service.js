/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { map, switchMap } from 'rxjs/operators';
import { forkJoin, of, timer } from 'rxjs';
import { Injectable, Injector, InjectionToken, ComponentFactoryResolver, ApplicationRef } from '@angular/core';
import { BsModalService } from '@farris/ui-modal';
import { MessagerService } from '@farris/ui-messager';
import { DatagridSettingsComponent } from './datagrid-settings.component';
import { cloneDeep } from 'lodash-es';
import { LocaleService } from '@farris/ui-locale';
import { IdService } from '@farris/ui-common';
import { SimpleColumnsComponent } from './simple-mode/simple-columns.component';
import { DatagridSchemeService } from './datagrid-scheme.service';
import { NewSchemeComponent } from './scheme/newscheme.component';
import { SchemeListComponent } from './scheme/scheme-list.component';
import { NotifyService } from '@farris/ui-notify';
/** @type {?} */
export const GRID_SETTINGS_WEBAPI = new InjectionToken(' Farris DataGrid User Setting WebApi URI.');
export class DatagridSettingsService {
    /**
     * @param {?} injector
     * @param {?} modalSer
     * @param {?} messager
     * @param {?} idService
     * @param {?} localeSer
     */
    constructor(injector, modalSer, messager, idService, localeSer) {
        this.injector = injector;
        this.modalSer = modalSer;
        this.messager = messager;
        this.idService = idService;
        this.localeSer = localeSer;
        this.multiSortMsg = '列表中未开启多列排序的功能。 请检查！';
        this.columnsSortableMsg = '未开启列的排序功能。请检查！';
        this.notSupportHeaderGroupMsg = '暂不支持多表头设置';
        this.notShowDialog = '多表头暂不支持列显示设置；同时未启用列排序功能。';
        this._httpRestService = null;
        this.languages = [];
        this.gridRefs = null;
        this.activeSchemeItem = null;
        this.saving = false;
        this.cfr = null;
        this.app = null;
        this.schemeListSubscription = null;
        this.cfr = this.injector.get(ComponentFactoryResolver);
        this.app = this.injector.get(ApplicationRef);
        this.notifyService = this.injector.get(NotifyService, null);
        this.schemeService = new DatagridSchemeService();
    }
    /**
     * @return {?}
     */
    get httpRestService() {
        return this._httpRestService;
    }
    ;
    /**
     * @param {?} httpSer
     * @return {?}
     */
    set httpRestService(httpSer) {
        this._httpRestService = httpSer;
        if (this.schemeService) {
            this.schemeService.setRestService(httpSer);
        }
    }
    /**
     * @param {?=} id
     * @return {?}
     */
    destroy(id) {
        if (id && this.gridRefs && this.gridRefs[id]) {
            delete this.gridRefs[id];
        }
        else {
            this.gridRefs = null;
        }
        this.saving = false;
        this.setActiveSchemeItem(id, null);
    }
    /**
     * @param {?} dg
     * @return {?}
     */
    registerGridInstance(dg) {
        if (!dg) {
            console.log('DatagridSettingService: grid instance is null.');
            return;
        }
        /** @type {?} */
        const id = dg.id;
        this.gridRefs = this.gridRefs || {};
        if (!this.gridRefs[id]) {
            this.gridRefs[id] = dg;
        }
    }
    /**
     * @param {?} dgID
     * @return {?}
     */
    getGridInstance(dgID) {
        return this.gridRefs ? this.gridRefs[dgID] : null;
    }
    /**
     * 更新方案中的配置数据
     * @private
     * @param {?} schemeItem
     * @param {?} settings
     * @return {?}
     */
    updateSchemeSettings(schemeItem, settings) {
        if (schemeItem && settings) {
            /** @type {?} */
            const schemeContentObj = JSON.parse(schemeItem.queryConditionString);
            if (schemeContentObj) {
                if (schemeContentObj[this.localeSer.localeId]) {
                    /** @type {?} */
                    const schemeSettings = schemeContentObj[this.localeSer.localeId];
                    schemeContentObj[this.localeSer.localeId] = Object.assign(schemeSettings, settings);
                }
                else {
                    schemeContentObj[this.localeSer.localeId] = settings;
                }
                schemeItem.queryConditionString = JSON.stringify(schemeContentObj);
            }
        }
    }
    /**
     * 更新当前方案配置数据
     * @param {?} dgId
     * @param {?} settings
     * @return {?}
     */
    updateActiveSchemeItemSettings(dgId, settings) {
        /** @type {?} */
        const schemeItem = this.getActiveSchemeItem(dgId);
        this.updateSchemeSettings(schemeItem, settings);
    }
    /**
     * 设置活动的方案
     * @param {?} dgId
     * @param {?} activeItem
     * @return {?}
     */
    setActiveSchemeItem(dgId, activeItem) {
        /** @type {?} */
        const schemekey = this.schemeService.getSchemeKey(dgId);
        this.activeSchemeItem = this.activeSchemeItem || {};
        this.activeSchemeItem[schemekey] = activeItem;
    }
    /**
     * 获取当前活动的方案
     * @param {?} dgId
     * @return {?}
     */
    getActiveSchemeItem(dgId) {
        /** @type {?} */
        const schemekey = this.schemeService.getSchemeKey(dgId);
        return this.activeSchemeItem ? this.activeSchemeItem[schemekey] : null;
    }
    /**
     * @return {?}
     */
    getSearchTypes() {
        return [
            { value: 'all', title: this.localeSer.getValue('datagrid.settings.allColumns') },
            { value: 'visible', title: this.localeSer.getValue('datagrid.settings.visibleColumns') },
            { value: 'hidden', title: this.localeSer.getValue('datagrid.settings.hiddenColumns') }
        ];
    }
    /**
     * @param {?} gridInstance
     * @param {?=} settings
     * @param {?=} selectedSchemeItem
     * @return {?}
     */
    showSimple(gridInstance, settings, selectedSchemeItem) {
        /** @type {?} */
        const columns = this.convertColumnsToSimple(gridInstance.columns);
        columns[0] = columns[0].filter((/**
         * @param {?} n
         * @return {?}
         */
        n => n.field && n.field !== gridInstance.ControlPanelFeild));
        /** @type {?} */
        const searchTypes = this.getSearchTypes();
        if (this.cfr) {
            /** @type {?} */
            const cmpFactory = this.cfr.resolveComponentFactory(SimpleColumnsComponent);
            /** @type {?} */
            let simpleRef = cmpFactory.create(this.injector);
            this.app.attachView(simpleRef.hostView);
            simpleRef.instance.columns = columns;
            simpleRef.instance.seartTypes = searchTypes;
            simpleRef.instance.gridInstance = gridInstance;
            if (document.querySelector('#page-wrapper')) {
                simpleRef.instance.top = 76;
            }
            simpleRef.instance.enableScheme = gridInstance.enableScheme;
            if (gridInstance.enableScheme) {
                if (settings) {
                    if (selectedSchemeItem) {
                        this.updateSchemeSettings(selectedSchemeItem, settings);
                        simpleRef.instance.currentSchemeItem = selectedSchemeItem;
                    }
                    else {
                        simpleRef.instance.currentSchemeItem = null;
                        simpleRef.instance.settings = settings;
                    }
                }
                else {
                    /** @type {?} */
                    const _currentSchemtItem = this.getActiveSchemeItem(gridInstance.id);
                    simpleRef.instance.currentSchemeItem = _currentSchemtItem;
                }
            }
            document.body.appendChild(simpleRef.location.nativeElement);
            simpleRef.instance.closed.pipe(switchMap((/**
             * @return {?}
             */
            () => {
                simpleRef.instance.container.nativeElement.style.right = '-500px';
                return timer(500);
            }))).subscribe((/**
             * @return {?}
             */
            () => {
                simpleRef.location.nativeElement.remove();
                simpleRef.destroy();
                simpleRef = null;
                if (this.schemeListSubscription) {
                    this.schemeListSubscription.unsubscribe();
                }
            }));
            simpleRef.instance.advanced.subscribe((/**
             * @param {?} __0
             * @return {?}
             */
            ({ viewFields }) => {
                if (viewFields && viewFields.length) {
                    this.updateSchemeSettings(simpleRef.instance.currentSchemeItem, { viewColumns: viewFields });
                }
                this.showAdvanced(gridInstance, null, simpleRef.instance.currentSchemeItem);
            }));
            simpleRef.instance.submit.subscribe((/**
             * @param {?} e
             * @return {?}
             */
            (e) => {
                e.target.disabled = true;
                if (this.saving) {
                    return;
                }
                if (!this.saving) {
                    if (e.currentScheme) {
                        this.setActiveSchemeItem(gridInstance.id, e.currentScheme);
                    }
                    this.updateGridView(e, gridInstance, e.target);
                }
            }));
            simpleRef.instance.fieldsChange.subscribe((/**
             * @param {?} visibleFields
             * @return {?}
             */
            (visibleFields) => {
                this.updateActiveSchemeItemSettings(gridInstance.id, { viewColumns: visibleFields });
            }));
            // 打开新增方案窗口
            simpleRef.instance.addNewScheme.subscribe((/**
             * @return {?}
             */
            () => {
                this.showNewSchemeDialog(gridInstance, simpleRef);
            }));
            simpleRef.instance.schemeList = this.schemeService.getStateValue(gridInstance.id, 'list') || [];
            // 打开方案管理列表窗口
            simpleRef.instance.showSchemeList.subscribe((/**
             * @return {?}
             */
            () => {
                this.schemeService.getSchemeList(gridInstance.id).pipe(switchMap((/**
                 * @param {?} t
                 * @return {?}
                 */
                (t) => {
                    return this.schemeService.checkAuthority().pipe(map((/**
                     * @param {?} auth
                     * @return {?}
                     */
                    (auth) => {
                        return Object.assign({ list: t }, auth);
                    })));
                }))).subscribe((/**
                 * @param {?} t
                 * @return {?}
                 */
                (t) => {
                    this.schemeService.setSchemeList(gridInstance.id, t.list || []);
                    this.showSchemeListDialog(gridInstance, cloneDeep(t.list || []), t.success);
                }));
            }));
            this.schemeListSubscription = this.schemeService.schemeList$.subscribe((/**
             * @param {?} list
             * @return {?}
             */
            (list) => {
                simpleRef.instance.schemeList = list;
                if (!list || !list.length) {
                    this.setActiveSchemeItem(gridInstance.id, null);
                    return;
                }
                /** @type {?} */
                const _activeSchemeItem = this.getActiveSchemeItem(gridInstance.id);
                if (_activeSchemeItem) {
                    /** @type {?} */
                    let hasActiveItem = list.find((/**
                     * @param {?} n
                     * @return {?}
                     */
                    n => n.id === _activeSchemeItem.id));
                    if (!hasActiveItem) {
                        hasActiveItem = this.getDefaultScheme(list); // 获取设置为当前方案的项
                        this.setActiveSchemeItem(gridInstance.id, hasActiveItem || null);
                    }
                    simpleRef.instance.currentSchemeItem = hasActiveItem;
                }
            }));
            // 切换方案
            simpleRef.instance.activeItemChange.subscribe((/**
             * @param {?} r
             * @return {?}
             */
            (r) => {
                this.setActiveSchemeItem(gridInstance.id, r);
            }));
            simpleRef.hostView.detectChanges();
            simpleRef.instance.container.nativeElement.style.right = '0px';
            return simpleRef;
        }
    }
    /**
     * @param {?} gridInstance
     * @param {?=} opts
     * @return {?}
     */
    show(gridInstance, opts) {
        this.registerGridInstance(gridInstance);
        if (gridInstance.enableSimpleMode) {
            return this.showSimple(gridInstance);
        }
        else {
            return this.showAdvanced(gridInstance, opts);
        }
    }
    /**
     * @private
     * @param {?} gridInstance
     * @param {?=} opts
     * @param {?=} selectedSchemeItem
     * @return {?}
     */
    showAdvanced(gridInstance, opts, selectedSchemeItem) {
        /** @type {?} */
        let _editColSortInfo = true;
        /** @type {?} */
        const editColSortInfo = this.canSetColumnSort(gridInstance);
        if (editColSortInfo !== true) {
            // this.messager.warning(msg);
            // return;
            _editColSortInfo = false;
        }
        /** @type {?} */
        const showSetColumnsTab = !this.isHeaderGroup(gridInstance);
        /** @type {?} */
        const getActiveTabIndex = (/**
         * @return {?}
         */
        () => {
            if (showSetColumnsTab) {
                return 1;
            }
            else {
                if (_editColSortInfo) {
                    return 2;
                }
                else {
                    return -1;
                }
            }
        });
        /** @type {?} */
        const activeTabIndex = getActiveTabIndex();
        if (activeTabIndex === -1) {
            this.messager.warning(this.notShowDialog);
            return;
        }
        /** @type {?} */
        const columns = this.convertColumnsToSimple(gridInstance.columns);
        // 获取当前方案中当前语言的配置数据
        /** @type {?} */
        let currentSettings = null;
        if (selectedSchemeItem && selectedSchemeItem.queryConditionString) {
            currentSettings = JSON.parse(selectedSchemeItem.queryConditionString)[this.localeSer.localeId];
            if (currentSettings.columnFormat && currentSettings.columnFormat.length) {
                columns[0] = columns[0].map((/**
                 * @param {?} col
                 * @return {?}
                 */
                (col) => {
                    /** @type {?} */
                    const fcol = currentSettings.columnFormat.find((/**
                     * @param {?} n
                     * @return {?}
                     */
                    n => n.field === col.field));
                    if (fcol) {
                        col = Object.assign(col, fcol);
                    }
                    return col;
                }));
            }
        }
        columns[0] = columns[0].filter((/**
         * @param {?} n
         * @return {?}
         */
        n => n.field && n.field !== gridInstance.ControlPanelFeild));
        /** @type {?} */
        const treeData = this.convertColumns2TreeData(cloneDeep(columns), true);
        /** @type {?} */
        const viewColumnsTreeData = this.convertColumns2TreeData(cloneDeep(columns), false);
        this.checkViewTreeNodes(viewColumnsTreeData);
        /** @type {?} */
        let modalRef = null;
        /** @type {?} */
        const okText = this.localeSer.getValue('datagrid.settings.ok') || '确定';
        /** @type {?} */
        const cancelText = this.localeSer.getValue('datagrid.settings.cancel') || '取消';
        /** @type {?} */
        const resetText = this.localeSer.getValue('datagrid.settings.reset') || '重置';
        /** @type {?} */
        const defaultOpts = {
            width: 760, height: 560, showHeader: false, title: '控制面板',
            initialState: {
                columns,
                sortTreeData: treeData,
                viewTreeData: viewColumnsTreeData,
                gridInstance,
                canSetColumnSort: _editColSortInfo,
                canSetColumnVisible: showSetColumnsTab,
                activeTabIndex,
                schemeInfo: currentSettings
            },
            showButtons: false
        };
        /** @type {?} */
        const modalOpts = Object.assign(defaultOpts, opts || {});
        modalRef = this.modalSer.show(DatagridSettingsComponent, modalOpts);
        /** @type {?} */
        const instance = (/** @type {?} */ (modalRef.content));
        instance.enableReset = true;
        instance.modalRef = modalRef;
        instance.canSetColumnSort = _editColSortInfo;
        instance.canSetColumnVisible = !this.isHeaderGroup(gridInstance);
        instance.submitHandle.subscribe((/**
         * @param {?} e
         * @return {?}
         */
        (e) => {
            e.target.disabled = true;
            if (this.saving) {
                return;
            }
            if (!this.saving) {
                if (selectedSchemeItem) {
                    this.setActiveSchemeItem(gridInstance.id, selectedSchemeItem);
                }
                this.updateGridView(modalRef, gridInstance, e.target);
            }
        }));
        instance.cancelHandle.subscribe((/**
         * @param {?} e
         * @return {?}
         */
        (e) => {
            modalRef.close();
        }));
        // 切换到侧边栏简洁模式
        instance.concise.subscribe((/**
         * @param {?} e
         * @return {?}
         */
        (e) => {
            modalRef.close();
            /** @type {?} */
            const settings = modalRef.content;
            const { sortInfo, viewColumns, columnFormat, groupField } = settings;
            this.showSimple(gridInstance, { sortInfo, viewColumns, columnFormat, groupField }, selectedSchemeItem);
        }));
        /** @type {?} */
        const modalContainer = (/** @type {?} */ (modalRef.dialog.instance));
        modalContainer.draggbar.handle = instance.header.nativeElement;
        return modalRef;
    }
    /**
     * @private
     * @param {?} gridInstance
     * @return {?}
     */
    canSetColumnSort(gridInstance) {
        if (gridInstance.multiSort && this.hasEnableSortColumns(gridInstance)) {
            return true;
        }
        else {
            if (!this.hasEnableSortColumns(gridInstance)) {
                return this.columnsSortableMsg;
            }
            else if (!gridInstance.multiSort) {
                return this.multiSortMsg;
            }
        }
    }
    /**
     * @private
     * @param {?} gridInstance
     * @return {?}
     */
    hasEnableSortColumns(gridInstance) {
        /** @type {?} */
        const sortColumnsCount = gridInstance.flatColumns.reduce((/**
         * @param {?} c
         * @param {?} r
         * @return {?}
         */
        (c, r) => {
            if (r.sortable) {
                return c + 1;
            }
            return c;
        }), 0);
        return sortColumnsCount > 0;
    }
    /**
     * @private
     * @param {?} grid
     * @return {?}
     */
    isHeaderGroup(grid) {
        /** @type {?} */
        const flag = grid.columns.length > 1;
        if (flag) {
            return this.notSupportHeaderGroupMsg;
        }
        return flag;
    }
    /**
     * @private
     * @param {?} cols
     * @param {?} rowIndex
     * @param {?} colStartIndex
     * @param {?} colCount
     * @param {?=} forSort
     * @return {?}
     */
    getChilds(cols, rowIndex, colStartIndex, colCount, forSort = false) {
        /** @type {?} */
        const childCols = [];
        /** @type {?} */
        let _count = colStartIndex;
        if (!cols[rowIndex]) {
            return [];
        }
        cols[rowIndex].slice().forEach((/**
         * @param {?} element
         * @return {?}
         */
        element => {
            _count = _count + element.colspan;
            if (_count <= colCount) {
                childCols.push(element);
            }
        }));
        cols[rowIndex].splice(0, childCols.length);
        return childCols.map((/**
         * @param {?} c
         * @param {?} i
         * @return {?}
         */
        (c, i) => {
            /** @type {?} */
            let n = {
                data: c,
                selectable: forSort ? !!c.sortable : true
            };
            if (c.colspan && c.colspan > 1) {
                n = {
                    data: c,
                    selectable: false,
                    expanded: true,
                    children: this.getChilds(cols, rowIndex + 1, 0, c.colspan)
                };
            }
            return n;
        }));
    }
    /**
     * @param {?} cols
     * @param {?=} forSort
     * @return {?}
     */
    convertColumns2TreeData(cols, forSort = false) {
        /** @type {?} */
        const columns = cols.map((/**
         * @param {?} c
         * @return {?}
         */
        (c) => {
            c.map((/**
             * @param {?} _
             * @return {?}
             */
            (_) => {
                _.colspan = _.colspan || 1;
                return _;
            }));
            return c;
        }));
        if (columns.length === 1) {
            return columns[0].map((/**
             * @param {?} c
             * @return {?}
             */
            c => {
                return {
                    data: c,
                    selectable: forSort ? !!c.sortable : true
                };
            }));
        }
        else {
            return columns[0].map((/**
             * @param {?} c
             * @param {?} i
             * @return {?}
             */
            (c, i) => {
                if (c.colspan && c.colspan > 1) {
                    return {
                        data: c,
                        selectable: false,
                        expanded: true,
                        children: this.getChilds(columns, 1, 0, c.colspan, forSort)
                    };
                }
                else {
                    return {
                        data: c,
                        selectable: forSort ? !!c.sortable : true
                    };
                }
            }));
        }
    }
    /**
     * @private
     * @param {?} treeNodes
     * @return {?}
     */
    checkViewTreeNodes(treeNodes) {
        treeNodes.forEach((/**
         * @param {?} tn
         * @return {?}
         */
        (tn) => {
            if (!tn.children || !tn.children.length) {
                tn.selectable = true;
            }
            else {
                tn.selectable = false;
                this.checkViewTreeNodes(tn.children);
            }
        }));
    }
    /**
     * @private
     * @param {?} cols
     * @return {?}
     */
    convertColumnsToSimple(cols) {
        // 移除设置列
        return cols.map((/**
         * @param {?} _cols
         * @return {?}
         */
        (_cols) => {
            return _cols.map((/**
             * @param {?} c
             * @return {?}
             */
            (c) => {
                if (c.field !== '_datagrid-setting-control_') {
                    return {
                        field: c.field,
                        title: c.title,
                        colspan: c.colspan,
                        rowspan: c.rowspan,
                        sortable: c.sortable,
                        order: c.order,
                        halign: c.halign || 'left',
                        align: c.align || 'left',
                        visible: c.visible,
                        allowGrouping: c.allowGrouping,
                        groupFooter: c.groupFooter,
                        footer: c.footer,
                        width: c.width || 100,
                        dataType: c.dataType || 'string'
                    };
                }
            })).filter((/**
             * @param {?} n
             * @return {?}
             */
            n => n));
        }));
    }
    /**
     * @private
     * @param {?} gridInstance
     * @return {?}
     */
    resetGridView(gridInstance) {
        if (!gridInstance) {
            return;
        }
        /** @type {?} */
        const dfs = gridInstance.dfs;
        if (dfs) {
            /** @type {?} */
            const options = dfs['_state'].initialOptions;
            if (options.sort) {
                if (options.sort.sortName) {
                    gridInstance.sortName = options.sort.sortName;
                }
                if (options.sort.sortOrder) {
                    gridInstance.sortOrder = options.sort.sortOrder;
                }
            }
            gridInstance.groupField = options.groupField || '';
            // TODO: 还需要修正默认列的显示顺序
            if (options.columnFields && options.columnFields.length) {
                /** @type {?} */
                const newColumns = [];
                options.columnFields.forEach((/**
                 * @param {?} c
                 * @return {?}
                 */
                c => {
                    /** @type {?} */
                    const col = gridInstance.columns[0].find((/**
                     * @param {?} n
                     * @return {?}
                     */
                    (n) => n.field === c.field));
                    if (col) {
                        col.visible = c.visible;
                        col.halign = c.halign;
                        col.align = c.align;
                        col.width = c.width;
                        col.footer = c.footer;
                        col.groupFooter = c.groupFooter;
                        newColumns.push(col);
                    }
                }));
                gridInstance.columns[0] = newColumns;
            }
            // gridInstance['checkOptions']();
            gridInstance['columnsChanged']();
        }
    }
    /**
     * @private
     * @param {?} modalRef
     * @param {?} gridInstance
     * @param {?=} btn
     * @return {?}
     */
    updateGridView(modalRef, gridInstance, btn = null) {
        /** @type {?} */
        const settings = modalRef.content;
        if (settings) {
            const { sortInfo, viewColumns, columnFormat, groupField } = settings;
            this.updateActiveSchemeItemSettings(gridInstance.id, { sortInfo, viewColumns, columnFormat, groupField });
            this.saving = true;
            /** @type {?} */
            let _groupField = '';
            if (gridInstance.groupRows && groupField && groupField.length) {
                _groupField = groupField.join(',');
            }
            gridInstance.groupField = _groupField;
            /** @type {?} */
            const _colformats = columnFormat ? this.convertColumnsToSimple([columnFormat])[0] : [];
            /** @type {?} */
            const saveData = { sortInfo, viewColumns, groupField: _groupField, columnFormat: _colformats };
            this.setUserConfig(gridInstance.id, saveData).subscribe((/**
             * @return {?}
             */
            () => {
                if (btn) {
                    btn.disabled = false;
                }
                this.saving = false;
                if (viewColumns && viewColumns.length) {
                    gridInstance.columns = gridInstance.columns.map((/**
                     * @param {?} cols
                     * @return {?}
                     */
                    cols => {
                        this.updateColumnFormat(cols, columnFormat, gridInstance);
                        return this.newVisibleOrderColumns(cols, viewColumns, columnFormat, gridInstance);
                    }));
                }
                gridInstance.columnsChanged(true);
                if (sortInfo && Object.keys(sortInfo).length) {
                    const { sortName, sortOrder } = sortInfo;
                    if (sortName && sortName.length) {
                        gridInstance.sort(sortName.join(','), sortOrder.join(','));
                    }
                    else {
                        gridInstance.clearSort();
                    }
                }
                else {
                    gridInstance.clearSort();
                }
                modalRef.close();
            }));
        }
        else {
            modalRef.close();
        }
    }
    /**
     * @param {?} cols
     * @param {?} viewColumns
     * @param {?} columnFormat
     * @param {?} gridInstance
     * @return {?}
     */
    newVisibleOrderColumns(cols, viewColumns, columnFormat, gridInstance) {
        /** @type {?} */
        const hideColumns = [];
        cols.forEach((/**
         * @param {?} element
         * @param {?} index
         * @return {?}
         */
        (element, index) => {
            if (this.isNewAddColumn(element.field, columnFormat) && element.field !== '_datagrid-setting-control_' && !gridInstance.enableScheme) {
                viewColumns.push(element.field);
            }
            else {
                element.visible = viewColumns.includes(element.field);
                if (!element.visible) {
                    hideColumns.push(element);
                }
            }
        }));
        // 清理不存在的列
        /** @type {?} */
        let newCols = viewColumns.map((/**
         * @param {?} field
         * @return {?}
         */
        field => {
            return cols.find((/**
             * @param {?} c
             * @return {?}
             */
            c => c.field === field));
        })).filter((/**
         * @param {?} n
         * @return {?}
         */
        n => n));
        if (hideColumns.length) {
            newCols = newCols.concat(hideColumns);
        }
        return newCols.filter((/**
         * @param {?} c
         * @return {?}
         */
        c => c && c.field && c.field !== '_datagrid-setting-control_'));
    }
    /**
     * 是否为新增加的字段
     * 新增的字段，需要在列表中展示出来，并保存到个性化设置中
     * @private
     * @param {?} field
     * @param {?} columns
     * @return {?}
     */
    isNewAddColumn(field, columns) {
        columns = columns || [];
        return !columns.find((/**
         * @param {?} c
         * @return {?}
         */
        c => c.field === field));
    }
    /**
     * @param {?} cols
     * @param {?} columnFormat
     * @param {?} gridInstance
     * @return {?}
     */
    updateColumnFormat(cols, columnFormat, gridInstance) {
        if (columnFormat && columnFormat.length) {
            cols.forEach((/**
             * @param {?} col
             * @return {?}
             */
            col => {
                /** @type {?} */
                const formatCol = columnFormat.find((/**
                 * @param {?} f
                 * @return {?}
                 */
                f => f.field === col.field));
                if (formatCol) {
                    col.width = formatCol.width;
                    col.halign = formatCol.halign || 'left';
                    col.align = formatCol.align || 'left';
                    if (gridInstance.groupRows && (col.allowGrouping || col.allowGrouping === undefined)) {
                        if (!col.groupFooter) {
                            col.groupFooter = formatCol.groupFooter;
                        }
                        if (col.groupFooter && col.groupFooter.options) {
                            col.groupFooter.options.text = formatCol.groupFooter.options.text || '';
                            col.groupFooter.options.calculationType =
                                formatCol.groupFooter.options.calculationType !== undefined &&
                                    formatCol.groupFooter.options.calculationType !== null ?
                                    parseInt(formatCol.groupFooter.options.calculationType, 10) : -1;
                        }
                    }
                    if (gridInstance.showFooter && !gridInstance.footerTemplate) {
                        if (!col.footer) {
                            col.footer = formatCol.footer;
                        }
                        if (col.footer && col.footer.options) {
                            col.footer.options.text = formatCol.footer.options.text || '';
                            col.footer.options.calculationType =
                                formatCol.footer.options.calculationType !== undefined &&
                                    formatCol.footer.options.calculationType !== null ?
                                    parseInt(formatCol.footer.options.calculationType, 10) : -1;
                        }
                    }
                }
            }));
        }
    }
    // 创建唯一key, 由uri + gridId 组成，并混淆
    /**
     * @private
     * @param {?} gridId
     * @return {?}
     */
    createConfigKey(gridId) {
        /** @type {?} */
        const grid = this.getGridInstance(gridId);
        if (grid) {
            return grid.dgs.createConfigKey(gridId);
        }
        else {
            console.log('DatagridSettingService: Can not find the grid instance.');
        }
    }
    /**
     * @private
     * @param {?} gridId
     * @return {?}
     */
    getCurrentUserSettings(gridId) {
        /** @type {?} */
        const gridInstance = this.getGridInstance(gridId);
        /** @type {?} */
        const config = { sortInfo: {}, viewColumns: [], groupField: '', columnFormat: [] };
        if (gridInstance) {
            const { sortName, sortOrder, columns } = gridInstance;
            if (sortName) {
                /** @type {?} */
                const sortInfo = {
                    sortName: sortName.split(','),
                    sortOrder: sortOrder.split(',')
                };
                config.sortInfo = sortInfo;
            }
            /** @type {?} */
            const viewColumns = columns[0].filter((/**
             * @param {?} n
             * @return {?}
             */
            n => n.visible || n.visible === undefined)).map((/**
             * @param {?} n
             * @return {?}
             */
            n => n.field));
            config.viewColumns = viewColumns;
            config.columnFormat = this.convertColumnsToSimple(columns)[0];
            if (gridInstance.groupRows) {
                config.groupField = gridInstance.groupField;
            }
        }
        return config;
    }
    /**
     * @param {?} gridId
     * @return {?}
     */
    saveUserConfig(gridId) {
        /** @type {?} */
        const config = this.getCurrentUserSettings(gridId);
        return this.setUserConfig(gridId, config);
    }
    /**
     * @param {?} gridId
     * @param {?} config
     * @return {?}
     */
    setUserConfig(gridId, config) {
        /** @type {?} */
        const key = this.createConfigKey(gridId);
        /** @type {?} */
        const LOCALEID = this.localeSer.localeId;
        /** @type {?} */
        const currentConfig = localStorage.getItem(key);
        /** @type {?} */
        const _config = (currentConfig ? JSON.parse(currentConfig) : {}) || {};
        if (config) {
            if (_config) {
                _config[LOCALEID] = config;
            }
            localStorage.setItem(key, JSON.stringify(_config));
        }
        else {
            localStorage.removeItem(key);
        }
        if (this.httpRestService) {
            /** @type {?} */
            const gridIns = this.getGridInstance(gridId);
            if (gridIns && gridIns.enableScheme) {
                /** @type {?} */
                const activeScheme = this.getActiveSchemeItem(gridId);
                if (activeScheme) {
                    // return this.updateScheme(gridId, config);
                    if (activeScheme.type === 'private') {
                        return this.schemeService.saveScheme(activeScheme, gridId, true);
                    }
                    else {
                        return this.schemeService.checkAuthority().pipe(switchMap((/**
                         * @param {?} t
                         * @return {?}
                         */
                        (t) => {
                            if (t.success) {
                                /** @type {?} */
                                const hasOrgAuthority = t.authOrganizationData && t.authOrganizationData.length;
                                if (activeScheme.type === 'public' || (activeScheme.type === 'org' && hasOrgAuthority)) {
                                    return this.schemeService.saveScheme(activeScheme, gridId, true);
                                }
                            }
                            return of(true);
                        })));
                    }
                }
                else {
                    return of(true);
                }
            }
            // 保存至数据库
            return this._saveUserConfig(key, config ? _config : '');
        }
        return of(true);
    }
    /**
     * @param {?} key
     * @return {?}
     */
    getUserConfig(key) {
        if (this.httpRestService) {
            return this._getUserConfig(key);
        }
        else {
            /** @type {?} */
            const config = localStorage.getItem(key);
            if (config) {
                /** @type {?} */
                const con = JSON.parse(config);
                if (con[this.localeSer.localeId]) {
                    return of(con[this.localeSer.localeId]);
                }
                else {
                    if (Object.keys(con).indexOf('viewColumns') > -1) {
                        return of(con);
                    }
                    return null;
                }
            }
            else {
                return of(null);
            }
        }
    }
    /**
     * @private
     * @param {?} schemeList
     * @return {?}
     */
    getDefaultScheme(schemeList) {
        // 1、有个人默认的返回个人默认方案
        // 2、没有个人默认方案的，返回公共方案第1个
        // 3、没有公共方案，返回组织方案第1个
        // 4、没有组织方案的, 返回个人方案第1个
        // 5、没有个人方案的，返回系统预制，即表单设计时的格式
        // 1、有个人默认的返回个人默认方案
        // 2、没有个人默认方案的，返回公共方案第1个
        // 3、没有公共方案，返回组织方案第1个
        // 4、没有组织方案的, 返回个人方案第1个
        // 5、没有个人方案的，返回系统预制，即表单设计时的格式
        /** @type {?} */
        let defaultScheme = null;
        if (!schemeList || !schemeList.length) {
            return defaultScheme;
        }
        else {
            defaultScheme = schemeList.find((/**
             * @param {?} n
             * @return {?}
             */
            n => n.isDefault));
            if (!defaultScheme) {
                /** @type {?} */
                let publicSchemes = schemeList.filter((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => n.type === 'public'));
                if (!publicSchemes.length) {
                    publicSchemes = schemeList.filter((/**
                     * @param {?} n
                     * @return {?}
                     */
                    n => n.type === 'org'));
                }
                if (publicSchemes.length) {
                    defaultScheme = publicSchemes[0];
                }
                else {
                    defaultScheme = schemeList[0];
                }
            }
        }
        return defaultScheme;
    }
    /**
     * @param {?} gridId
     * @return {?}
     */
    getSettings(gridId) {
        /** @type {?} */
        const key = this.createConfigKey(gridId);
        /** @type {?} */
        const gridIns = this.getGridInstance(gridId);
        /** @type {?} */
        let schemeList$ = of([]);
        if (gridIns && gridIns.enableScheme) {
            schemeList$ = this.getSchemeList(gridId);
        }
        return forkJoin(schemeList$, this.getUserConfig(key), this.schemeService.getLanguages()).pipe(map((/**
         * @param {?} __0
         * @return {?}
         */
        ([schemeList, userSetting, supportedLanguages]) => {
            schemeList = schemeList || [];
            this.languages = supportedLanguages;
            if (!schemeList.length) {
                return userSetting;
            }
            else {
                // 缓存方案列表
                this.setSchemeList(schemeList, gridId);
                // 查找默认方案
                /** @type {?} */
                const defaultScheme = this.getDefaultScheme(schemeList);
                if (!defaultScheme) {
                    return userSetting;
                }
                else {
                    this.setActiveSchemeItem(gridId, defaultScheme);
                    /** @type {?} */
                    const userSettings = JSON.parse(defaultScheme.queryConditionString);
                    if (userSettings) {
                        /** @type {?} */
                        const localeId = this.localeSer.localeId;
                        if (userSettings[localeId]) {
                            localStorage.setItem(key, JSON.stringify(userSettings));
                            return userSettings[localeId];
                        }
                        else {
                            userSettings[localeId] = null;
                            localStorage.setItem(key, JSON.stringify(userSettings));
                            return null;
                        }
                    }
                    else {
                        return null;
                    }
                }
            }
        })));
    }
    /**
     * @private
     * @param {?} key
     * @param {?} config
     * @return {?}
     */
    _saveUserConfig(key, config) {
        try {
            /** @type {?} */
            const userConfigSetting = {
                configkey1: key,
                configkey2: '',
                configkey3: '',
                textvalue: config ? JSON.stringify(config) : ''
            };
            return this.httpRestService.saveUserSettings(userConfigSetting);
        }
        catch (e) {
            console.error(e);
        }
    }
    /**
     * @param {?} gridInstance
     * @param {?} modalRef
     * @return {?}
     */
    resetUserConfig(gridInstance, modalRef) {
        /** @type {?} */
        const restorDefaultText = this.localeSer.getValue('datagrid.settings.restoreDefaultSettingsText') || '确认要恢复默认设置吗？';
        this.messager.confirm(restorDefaultText).pipe(switchMap((/**
         * @param {?} t
         * @return {?}
         */
        (t) => {
            if (t) {
                return this.setUserConfig(gridInstance.id, '');
            }
            return of(t);
        }))).subscribe((/**
         * @param {?} t
         * @return {?}
         */
        (t) => {
            if (t) {
                this.resetGridView(gridInstance);
                modalRef.close();
            }
        }));
    }
    /**
     * @private
     * @param {?} key
     * @return {?}
     */
    _getUserConfig(key) {
        try {
            return this.httpRestService.getUserSettings(key).pipe(map((/**
             * @param {?} ucs
             * @return {?}
             */
            (ucs) => {
                if (ucs && ucs.textValue) {
                    /** @type {?} */
                    const c = JSON.parse(ucs.textValue);
                    if (c) {
                        if (c[this.localeSer.localeId]) {
                            localStorage.setItem(key, ucs.textValue);
                            return c[this.localeSer.localeId];
                        }
                        else {
                            c[this.localeSer.localeId] = null;
                            localStorage.setItem(key, JSON.stringify(c));
                            // if (Object.keys(c).indexOf('viewColumns') > -1) {
                            //     return c;
                            // }
                            return null;
                        }
                    }
                    return null;
                }
                return null;
            })));
        }
        catch (e) {
            console.error(e);
        }
    }
    /**
     * @private
     * @param {?} gridId
     * @param {?=} settings
     * @return {?}
     */
    buildSubmitData(gridId, settings = null) {
        /** @type {?} */
        const LOCALEID = this.localeSer.localeId;
        if (!settings) {
            settings = this.getCurrentUserSettings(gridId);
        }
        /** @type {?} */
        const localeKey = this.createConfigKey(gridId);
        /** @type {?} */
        const currentConfig = localStorage.getItem(localeKey);
        /** @type {?} */
        const _config = (currentConfig ? JSON.parse(currentConfig) : {}) || {};
        if (_config) {
            _config[LOCALEID] = settings;
        }
        return _config;
    }
    // ----------------------------------------------------------------------------------------------- \\
    /**
     * @private
     * @param {?} gridInstance
     * @param {?} schemeList
     * @param {?=} canDel
     * @return {?}
     */
    showSchemeListDialog(gridInstance, schemeList, canDel = true) {
        /** @type {?} */
        const modalOpts = {
            width: 760, height: 577, showHeader: false, title: '控制面板',
            initialState: {
                items: schemeList || [],
                removeItem: canDel
            },
            showButtons: false
        };
        /** @type {?} */
        const schemeListDlg = this.modalSer.show(SchemeListComponent, modalOpts);
        /** @type {?} */
        const instance = (/** @type {?} */ (schemeListDlg.content));
        instance.closeModal.subscribe((/**
         * @return {?}
         */
        () => {
            schemeListDlg.close();
        }));
        instance.submitModal.subscribe((/**
         * @param {?} t
         * @return {?}
         */
        (t) => {
            this.schemeService.updateScheme(t, gridInstance.id).subscribe((/**
             * @param {?} e
             * @return {?}
             */
            (e) => {
                if (e === false) {
                    schemeListDlg.close();
                    return;
                }
                /** @type {?} */
                const msg = '列设置方案保存成功。';
                if (this.notifyService) {
                    this.notifyService.success(msg);
                }
                else {
                    this.messager.success(msg);
                }
                /** @type {?} */
                const schemeList = this.schemeService.getStateValue(gridInstance.id, 'list');
                if (t.defaultId) {
                    schemeList.forEach((/**
                     * @param {?} n
                     * @return {?}
                     */
                    n => {
                        n.isDefault = false;
                        if (n.id === t.defaultId) {
                            n.isDefault = true;
                            // this.setActiveSchemeItem(gridInstance.id, n);
                        }
                    }));
                }
                /** @type {?} */
                let newSchemeList = schemeList;
                if (t.deletedIds && t.deletedIds.length) {
                    newSchemeList = schemeList.filter((/**
                     * @param {?} n
                     * @return {?}
                     */
                    n => {
                        return !t.deletedIds.includes(n.id);
                    }));
                }
                this.schemeService.setSchemeList(gridInstance.id, newSchemeList);
                schemeListDlg.close();
            }));
        }));
        /** @type {?} */
        const modalContainer = (/** @type {?} */ (schemeListDlg.dialog.instance));
        modalContainer.draggbar.handle = instance.header.nativeElement;
    }
    // 新增或另存方案
    /**
     * @private
     * @param {?} gridInstance
     * @param {?} simpleRef
     * @return {?}
     */
    showNewSchemeDialog(gridInstance, simpleRef) {
        /** @type {?} */
        const modalOpts = {
            width: 480, height: 269, showHeader: false, title: '控制面板',
            initialState: {
                languages: this.languages
            },
            showButtons: false,
            resizable: false
        };
        /** @type {?} */
        const newSchemeDlg = this.modalSer.show(NewSchemeComponent, modalOpts);
        /** @type {?} */
        const instance = (/** @type {?} */ (newSchemeDlg.content));
        instance.closeModal.subscribe((/**
         * @return {?}
         */
        () => {
            newSchemeDlg.close();
        }));
        instance.submitModal.pipe(switchMap((/**
         * @param {?} t
         * @return {?}
         */
        (t) => {
            return this.createNewScheme(gridInstance.id, t);
        }))).subscribe((/**
         * @param {?} t
         * @return {?}
         */
        (t) => {
            if (t.flag === false) {
                /** @type {?} */
                const msg = t.msg || '请输入方案名称';
                if (this.notifyService) {
                    this.notifyService.info(msg);
                }
                else {
                    this.messager.info(msg);
                }
                return;
            }
            // 更新方案列表
            /** @type {?} */
            const schemeList = this.schemeService.getStateValue(gridInstance.id, 'list') || [];
            if (t.isDefault) {
                schemeList.forEach((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => {
                    n.isDefault = false;
                }));
            }
            schemeList.push(t);
            this.setActiveSchemeItem(gridInstance.id, t);
            this.schemeService.setSchemeList(gridInstance.id, schemeList);
            newSchemeDlg.close();
        }));
        instance.checkAuthority.pipe(switchMap((/**
         * @param {?} t
         * @return {?}
         */
        (t) => {
            return this.schemeService.checkAuthority().pipe(map((/**
             * @param {?} auth
             * @return {?}
             */
            (auth) => {
                return Object.assign({ type: t }, auth);
            })));
        }))).subscribe((/**
         * @param {?} t
         * @return {?}
         */
        (t) => {
            /** @type {?} */
            let hasAuthority = { public: true, org: true };
            /** @type {?} */
            let msg = '您没有将方案的使用范围设置为公共的权限。';
            if (t.type.value === 'org') {
                msg = '您没有将方案的使用范围设置为组织的权限。';
            }
            if (t.success) {
                /** @type {?} */
                const hasPublicAuthority = t.authOperationData && t.authOperationData.length;
                hasAuthority.public = hasPublicAuthority;
                /** @type {?} */
                const hasOrgAuthority = t.authOrganizationData && t.authOrganizationData.length;
                hasAuthority.org = hasOrgAuthority;
                if (t.type.value === 'public') {
                    instance.schemeInfo.type = t.type.value;
                }
                else if (t.type.value === 'org') {
                    if (!hasOrgAuthority) {
                        this.notifyService.warning(msg);
                    }
                    else {
                        instance.schemeInfo.type = t.type.value;
                        instance.schemeInfo.orgids = t.authOrganizationData.join(',');
                        instance.dataPermissionIds = t.authOrganizationData;
                    }
                }
            }
            else {
                this.notifyService.warning(msg);
                hasAuthority = { public: false, org: false };
                ;
            }
            instance.refresh(hasAuthority);
        }));
        /** @type {?} */
        const modalContainer = (/** @type {?} */ (newSchemeDlg.dialog.instance));
        modalContainer.draggbar.handle = instance.header.nativeElement;
    }
    /**
     * @param {?} gridId
     * @return {?}
     */
    getSchemeList(gridId) {
        return this.schemeService.getSchemeList(gridId);
    }
    /**
     * @param {?} gridId
     * @param {?} data
     * @return {?}
     */
    createNewScheme(gridId, data) {
        if (!data.name) {
            return of({ flag: false, msg: '请输入方案名称' });
        }
        else {
            /** @type {?} */
            const hasName = this.schemeService.hasSchemeName(gridId, data.name);
            if (typeof hasName === 'boolean' && hasName) {
                return of({ flag: false, msg: '方案名称已存在，请修改。' });
            }
            else if (Array.isArray(hasName) && hasName.length) {
                /** @type {?} */
                const msgs = hasName.map((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => {
                    if (n === 'zh-CHS') {
                        return '简体中文名称已存在。';
                    }
                    else if (n === 'zh-CHT') {
                        return '繁体中文名称已存在。';
                    }
                    else {
                        return '英文名称已存在。';
                    }
                }));
                return of({ flag: false, msg: msgs.join('') });
            }
        }
        /** @type {?} */
        const requiredName = [];
        this.languages.forEach((/**
         * @param {?} n
         * @return {?}
         */
        n => {
            if (data.name[n.code] === '' || data.name[n.code] === undefined) {
                requiredName.push(n.code);
            }
        }));
        if (requiredName.length) {
            /** @type {?} */
            const msgs = requiredName.map((/**
             * @param {?} n
             * @return {?}
             */
            n => {
                if (n === 'zh-CHS') {
                    return '请输入简体中文名称。';
                }
                else if (n === 'zh-CHT') {
                    return '请输入繁体中文名称。';
                }
                else {
                    return '请输入英文名称。';
                }
            }));
            return of({ flag: false, msg: msgs.join('') });
        }
        if (data.type && data.type === 'org' && (!data.orgids || !data.orgids.length)) {
            return of({ flag: false, msg: '请选择组织' });
        }
        /** @type {?} */
        let _config = null;
        /** @type {?} */
        const selectedSettings = this.getCurrentSchemeSettings(gridId);
        if (selectedSettings) {
            _config = selectedSettings;
        }
        else {
            // 收集当前方案配置数据
            _config = this.buildSubmitData(gridId);
        }
        /** @type {?} */
        const newId = this.idService.guid();
        /** @type {?} */
        let isDefault = data.isDefault;
        if (isDefault) {
            if (data.type !== 'private') {
                isDefault = false;
            }
        }
        if (data.name && typeof data.name === 'object') {
            data.name = JSON.stringify(data.name);
        }
        /** @type {?} */
        const scheme = {
            id: newId,
            belongId: '',
            code: '',
            name: data.name,
            type: data.type,
            isDefault: isDefault,
            isSystem: false,
            extendId: 'datagrid-settings-scheme',
            extendInfo: this.buildOrgAndSchemeRelations(newId, data.orgids),
            queryConditionString: _config ? JSON.stringify(_config) : '',
        };
        return this.schemeService.saveScheme(scheme, gridId).pipe(map((/**
         * @return {?}
         */
        () => {
            return scheme;
        })));
    }
    /**
     * @param {?} schemeList
     * @param {?} gridId
     * @return {?}
     */
    setSchemeList(schemeList, gridId) {
        this.schemeService.update({ list: schemeList }, gridId);
    }
    /**
     * @private
     * @param {?} schemeId
     * @param {?} orgIds
     * @return {?}
     */
    buildOrgAndSchemeRelations(schemeId, orgIds) {
        if (!orgIds || !orgIds.length) {
            return [];
        }
        return orgIds.map((/**
         * @param {?} n
         * @return {?}
         */
        n => {
            return {
                id: this.idService.guid(),
                orgId: n,
                relatedId: schemeId
            };
        }));
    }
    /**
     * @private
     * @param {?} gridId
     * @return {?}
     */
    getCurrentSchemeSettings(gridId) {
        /** @type {?} */
        const activeScheme = (/** @type {?} */ (this.getActiveSchemeItem(gridId)));
        if (activeScheme && activeScheme.queryConditionString) {
            return JSON.parse(activeScheme.queryConditionString);
        }
        return null;
    }
}
DatagridSettingsService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
DatagridSettingsService.ctorParameters = () => [
    { type: Injector },
    { type: BsModalService },
    { type: MessagerService },
    { type: IdService },
    { type: LocaleService }
];
if (false) {
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.multiSortMsg;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.columnsSortableMsg;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.notSupportHeaderGroupMsg;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.notShowDialog;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype._httpRestService;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.languages;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.gridRefs;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.activeSchemeItem;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.saving;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.cfr;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.app;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.schemeListSubscription;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.schemeService;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.notifyService;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.modalSer;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.messager;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.idService;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.localeSer;
    /* Skipping unhandled member: ;*/
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YWdyaWQtc2V0dGluZ3Muc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktZGF0YWdyaWQtc2V0dGluZ3MvIiwic291cmNlcyI6WyJsaWIvZGF0YWdyaWQtc2V0dGluZ3Muc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLEdBQUcsRUFBRSxTQUFTLEVBQU8sTUFBTSxnQkFBZ0IsQ0FBQztBQUNyRCxPQUFPLEVBQUUsUUFBUSxFQUFjLEVBQUUsRUFBZ0IsS0FBSyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ3JFLE9BQU8sRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLGNBQWMsRUFBRSx3QkFBd0IsRUFBRSxjQUFjLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFL0csT0FBTyxFQUFFLGNBQWMsRUFBeUMsTUFBTSxrQkFBa0IsQ0FBQztBQUN6RixPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDdEQsT0FBTyxFQUFFLHlCQUF5QixFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFDMUUsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUN0QyxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFFbEQsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQzlDLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLHdDQUF3QyxDQUFDO0FBQ2hGLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ2xFLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBQ2xFLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBQ3JFLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQzs7QUFJbEQsTUFBTSxPQUFPLG9CQUFvQixHQUFJLElBQUksY0FBYyxDQUFDLDJD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SUFBRSwyQ0FBZ0M7Ozs7O0lBQzVELDJDQUFpQzs7Ozs7SUFBRSw0Q0FBNEI7Ozs7O0lBQy9ELDRDQUFnQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IG1hcCwgc3dpdGNoTWFwLCB0YXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7IGZvcmtKb2luLCBPYnNlcnZhYmxlLCBvZiwgU3Vic2NyaXB0aW9uLCB0aW1lciB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBJbmplY3RhYmxlLCBJbmplY3RvciwgSW5qZWN0aW9uVG9rZW4sIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciwgQXBwbGljYXRpb25SZWYgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgRGF0YWdyaWRDb21wb25lbnQsIERhdGFDb2x1bW4gfSBmcm9tICdAZmFycmlzL3VpLWRhdGFncmlkJztcclxuaW1wb3J0IHsgQnNNb2RhbFNlcnZpY2UsIE1vZGFsT3B0aW9ucywgTW9kYWxDb250YWluZXJDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLW1vZGFsJztcclxuaW1wb3J0IHsgTWVzc2FnZXJTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1tZXNzYWdlcic7XHJcbmltcG9ydCB7IERhdGFncmlkU2V0dGluZ3NDb21wb25lbnQgfSBmcm9tICcuL2RhdGFncmlkLXNldHRpbmdzLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IGNsb25lRGVlcCB9IGZyb20gJ2xvZGFzaC1lcyc7XHJcbmltcG9ydCB7IExvY2FsZVNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWxvY2FsZSc7XHJcbmltcG9ydCB7IFRyZWVOb2RlIH0gZnJvbSAnQGZhcnJpcy91aS10cmVldGFibGUnO1xyXG5pbXBvcnQgeyBJZFNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWNvbW1vbic7XHJcbmltcG9ydCB7IFNpbXBsZUNvbHVtbnNDb21wb25lbnQgfSBmcm9tICcuL3NpbXBsZS1tb2RlL3NpbXBsZS1jb2x1bW5zLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IERhdGFncmlkU2NoZW1lU2VydmljZSB9IGZyb20gJy4vZGF0YWdyaWQtc2NoZW1lLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBOZXdTY2hlbWVDb21wb25lbnQgfSBmcm9tICcuL3NjaGVtZS9uZXdzY2hlbWUuY29tcG9uZW50JztcclxuaW1wb3J0IHsgU2NoZW1lTGlzdENvbXBvbmVudCB9IGZyb20gJy4vc2NoZW1lL3NjaGVtZS1saXN0LmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IE5vdGlmeVNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW5vdGlmeSc7XHJcbmltcG9ydCB7IERhdGFncmlkU2NoZW1lTW9kZWwsIFNjaGVtZUF1dGhNb2RlbCwgU2V0dGluZ01vZGVsIH0gZnJvbSAnLi9zZXR0aW5nLm1vZGVsJztcclxuXHJcblxyXG5leHBvcnQgY29uc3QgR1JJRF9TRVRUSU5HU19XRUJBUEkgPSAgbmV3IEluamVjdGlvblRva2VuKCcgRmFycmlzIERhdGFHcmlkIFVzZXIgU2V0dGluZyBXZWJBcGkgVVJJLicpO1xyXG5cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgRGF0YWdyaWRTZXR0aW5nc1NlcnZpY2Uge1xyXG5cclxuICAgIHByaXZhdGUgbXVsdGlTb3J0TXNnID0gJ+WIl+ihqOS4reacquW8gOWQr+WkmuWIl+aOkuW6j+eahOWKn+iDveOAgiDor7fmo4Dmn6XvvIEnO1xyXG4gICAgcHJpdmF0ZSBjb2x1bW5zU29ydGFibGVNc2cgPSAn5pyq5byA5ZCv5YiX55qE5o6S5bqP5Yqf6IO944CC6K+35qOA5p+l77yBJztcclxuICAgIHByaXZhdGUgbm90U3VwcG9ydEhlYWRlckdyb3VwTXNnID0gJ+aaguS4jeaUr+aMgeWkmuihqOWktOiuvue9ric7XHJcbiAgICBwcml2YXRlIG5vdFNob3dEaWFsb2cgPSAn5aSa6KGo5aS05pqC5LiN5pSv5oyB5YiX5pi+56S66K6+572u77yb5ZCM5pe25pyq5ZCv55So5YiX5o6S5bqP5Yqf6IO944CCJztcclxuXHJcbiAgICBwcml2YXRlIF9odHRwUmVzdFNlcnZpY2UgPSBudWxsO1xyXG5cclxuICAgIHByaXZhdGUgbGFuZ3VhZ2VzOiBhbnkgPSBbXTtcclxuXHJcbiAgICBnZXQgaHR0cFJlc3RTZXJ2aWNlKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9odHRwUmVzdFNlcnZpY2U7XHJcbiAgICB9O1xyXG5cclxuICAgIHNldCBodHRwUmVzdFNlcnZpY2UoaHR0cFNlcikge1xyXG4gICAgICAgIHRoaXMuX2h0dHBSZXN0U2VydmljZSA9IGh0dHBTZXI7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLnNjaGVtZVNlcnZpY2UpIHtcclxuICAgICAgICAgICAgdGhpcy5zY2hlbWVTZXJ2aWNlLnNldFJlc3RTZXJ2aWNlKGh0dHBTZXIpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdyaWRSZWZzOiB7W2tleTogc3RyaW5nXTogRGF0YWdyaWRDb21wb25lbnR9ID0gbnVsbDtcclxuICAgIHByaXZhdGUgYWN0aXZlU2NoZW1lSXRlbToge1tzY2hlbWVpZDogc3RyaW5nXTogYW55fSA9IG51bGw7XHJcblxyXG4gICAgcHJpdmF0ZSBzYXZpbmcgPSBmYWxzZTtcclxuICAgIHByaXZhdGUgY2ZyOiBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIgPSBudWxsO1xyXG4gICAgcHJpdmF0ZSBhcHA6IEFwcGxpY2F0aW9uUmVmID0gbnVsbDtcclxuICAgIHByaXZhdGUgc2NoZW1lTGlzdFN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uID0gbnVsbDtcclxuXHJcbiAgICBwcml2YXRlIHNjaGVtZVNlcnZpY2U6IERhdGFncmlkU2NoZW1lU2VydmljZTtcclxuICAgIHByaXZhdGUgbm90aWZ5U2VydmljZTogTm90aWZ5U2VydmljZTtcclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yLCBwcml2YXRlIG1vZGFsU2VyOiBCc01vZGFsU2VydmljZSxcclxuICAgICAgICAgICAgICAgIHByaXZhdGUgbWVzc2FnZXI6IE1lc3NhZ2VyU2VydmljZSwgcHJpdmF0ZSBpZFNlcnZpY2U6IElkU2VydmljZSxcclxuICAgICAgICAgICAgICAgIHByaXZhdGUgbG9jYWxlU2VyOiBMb2NhbGVTZXJ2aWNlKSB7XHJcblxyXG4gICAgICAgIHRoaXMuY2ZyID0gdGhpcy5pbmplY3Rvci5nZXQoQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyKTtcclxuICAgICAgICB0aGlzLmFwcCA9IHRoaXMuaW5qZWN0b3IuZ2V0KEFwcGxpY2F0aW9uUmVmKTtcclxuICAgICAgICB0aGlzLm5vdGlmeVNlcnZpY2UgPSB0aGlzLmluamVjdG9yLmdldChOb3RpZnlTZXJ2aWNlLCBudWxsKTtcclxuICAgICAgICB0aGlzLnNjaGVtZVNlcnZpY2UgPSBuZXcgRGF0YWdyaWRTY2hlbWVTZXJ2aWNlKCk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGRlc3Ryb3koaWQ/OiBzdHJpbmcpIHtcclxuICAgICAgICBpZiAoaWQgJiYgdGhpcy5ncmlkUmVmcyAmJiB0aGlzLmdyaWRSZWZzW2lkXSkge1xyXG4gICAgICAgICAgICBkZWxldGUgdGhpcy5ncmlkUmVmc1tpZF07XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5ncmlkUmVmcyA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuc2F2aW5nID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5zZXRBY3RpdmVTY2hlbWVJdGVtKGlkLCBudWxsKTtcclxuICAgIH1cclxuXHJcbiAgICByZWdpc3RlckdyaWRJbnN0YW5jZShkZzogRGF0YWdyaWRDb21wb25lbnQpIHtcclxuICAgICAgICBpZiAoIWRnKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdEYXRhZ3JpZFNldHRpbmdTZXJ2aWNlOiBncmlkIGluc3RhbmNlIGlzIG51bGwuJyk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgaWQgPSBkZy5pZDtcclxuICAgICAgICB0aGlzLmdyaWRSZWZzID0gdGhpcy5ncmlkUmVmcyB8fCB7fTtcclxuICAgICAgICBpZiAoIXRoaXMuZ3JpZFJlZnNbaWRdKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZ3JpZFJlZnNbaWRdID0gZGc7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldEdyaWRJbnN0YW5jZShkZ0lEOiBzdHJpbmcpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5ncmlkUmVmcyA/IHRoaXMuZ3JpZFJlZnNbZGdJRF0gOiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKiDmm7TmlrDmlrnmoYjkuK3nmoTphY3nva7mlbDmja4gKi9cclxuICAgIHByaXZhdGUgdXBkYXRlU2NoZW1lU2V0dGluZ3Moc2NoZW1lSXRlbTogRGF0YWdyaWRTY2hlbWVNb2RlbCwgc2V0dGluZ3M6IFBhcnRpYWw8U2V0dGluZ01vZGVsPikge1xyXG4gICAgICAgIGlmIChzY2hlbWVJdGVtICYmIHNldHRpbmdzKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHNjaGVtZUNvbnRlbnRPYmogPSBKU09OLnBhcnNlKHNjaGVtZUl0ZW0ucXVlcnlDb25kaXRpb25TdHJpbmcpO1xyXG4gICAgICAgICAgICBpZiAoc2NoZW1lQ29udGVudE9iaikge1xyXG4gICAgICAgICAgICAgICAgaWYgKCBzY2hlbWVDb250ZW50T2JqW3RoaXMubG9jYWxlU2VyLmxvY2FsZUlkXSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNjaGVtZVNldHRpbmdzID0gc2NoZW1lQ29udGVudE9ialt0aGlzLmxvY2FsZVNlci5sb2NhbGVJZF07XHJcbiAgICAgICAgICAgICAgICAgICAgc2NoZW1lQ29udGVudE9ialt0aGlzLmxvY2FsZVNlci5sb2NhbGVJZF0gPSBPYmplY3QuYXNzaWduKHNjaGVtZVNldHRpbmdzLCBzZXR0aW5ncyk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHNjaGVtZUNvbnRlbnRPYmpbdGhpcy5sb2NhbGVTZXIubG9jYWxlSWRdID0gIHNldHRpbmdzO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgc2NoZW1lSXRlbS5xdWVyeUNvbmRpdGlvblN0cmluZyA9IEpTT04uc3RyaW5naWZ5KHNjaGVtZUNvbnRlbnRPYmopO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKiDmm7TmlrDlvZPliY3mlrnmoYjphY3nva7mlbDmja4gKi9cclxuICAgIHVwZGF0ZUFjdGl2ZVNjaGVtZUl0ZW1TZXR0aW5ncyhkZ0lkOiBzdHJpbmcsIHNldHRpbmdzOiBQYXJ0aWFsPFNldHRpbmdNb2RlbD4pIHtcclxuICAgICAgICBjb25zdCBzY2hlbWVJdGVtID0gdGhpcy5nZXRBY3RpdmVTY2hlbWVJdGVtKGRnSWQpO1xyXG4gICAgICAgIHRoaXMudXBkYXRlU2NoZW1lU2V0dGluZ3Moc2NoZW1lSXRlbSwgc2V0dGluZ3MpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKiDorr7nva7mtLvliqjnmoTmlrnmoYggKi9cclxuICAgIHNldEFjdGl2ZVNjaGVtZUl0ZW0oZGdJZDogc3RyaW5nLCBhY3RpdmVJdGVtOiBhbnkpIHtcclxuICAgICAgICBjb25zdCBzY2hlbWVrZXkgPSB0aGlzLnNjaGVtZVNlcnZpY2UuZ2V0U2NoZW1lS2V5KGRnSWQpO1xyXG4gICAgICAgIHRoaXMuYWN0aXZlU2NoZW1lSXRlbSA9IHRoaXMuYWN0aXZlU2NoZW1lSXRlbSB8fCB7fTtcclxuICAgICAgICB0aGlzLmFjdGl2ZVNjaGVtZUl0ZW1bc2NoZW1la2V5XSA9IGFjdGl2ZUl0ZW07XHJcbiAgICB9XHJcbiAgICAvKiog6I635Y+W5b2T5YmN5rS75Yqo55qE5pa55qGIICovXHJcbiAgICBnZXRBY3RpdmVTY2hlbWVJdGVtKGRnSWQ6IHN0cmluZyk6IERhdGFncmlkU2NoZW1lTW9kZWwge1xyXG4gICAgICAgIGNvbnN0IHNjaGVtZWtleSA9IHRoaXMuc2NoZW1lU2VydmljZS5nZXRTY2hlbWVLZXkoZGdJZCk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuYWN0aXZlU2NoZW1lSXRlbSA/IHRoaXMuYWN0aXZlU2NoZW1lSXRlbVtzY2hlbWVrZXldIDogbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBnZXRTZWFyY2hUeXBlcygpIHtcclxuICAgICAgICByZXR1cm4gW1xyXG4gICAgICAgICAgICB7IHZhbHVlOiAnYWxsJywgdGl0bGU6IHRoaXMubG9jYWxlU2VyLmdldFZhbHVlKCdkYXRhZ3JpZC5zZXR0aW5ncy5hbGxDb2x1bW5zJykgfSxcclxuICAgICAgICAgICAgeyB2YWx1ZTogJ3Zpc2libGUnLCB0aXRsZTogdGhpcy5sb2NhbGVTZXIuZ2V0VmFsdWUoJ2RhdGFncmlkLnNldHRpbmdzLnZpc2libGVDb2x1bW5zJykgfSxcclxuICAgICAgICAgICAgeyB2YWx1ZTogJ2hpZGRlbicsIHRpdGxlOiB0aGlzLmxvY2FsZVNlci5nZXRWYWx1ZSgnZGF0YWdyaWQuc2V0dGluZ3MuaGlkZGVuQ29sdW1ucycpIH1cclxuICAgICAgICBdO1xyXG4gICAgfVxyXG5cclxuICAgIHNob3dTaW1wbGUoZ3JpZEluc3RhbmNlOiBEYXRhZ3JpZENvbXBvbmVudCwgc2V0dGluZ3M/OiBTZXR0aW5nTW9kZWwsIHNlbGVjdGVkU2NoZW1lSXRlbT86IERhdGFncmlkU2NoZW1lTW9kZWwpIHtcclxuICAgICAgICBjb25zdCBjb2x1bW5zID0gdGhpcy5jb252ZXJ0Q29sdW1uc1RvU2ltcGxlKGdyaWRJbnN0YW5jZS5jb2x1bW5zKTtcclxuICAgICAgICBjb2x1bW5zWzBdID0gY29sdW1uc1swXS5maWx0ZXIobiA9PiBuLmZpZWxkICYmIG4uZmllbGQgIT09IGdyaWRJbnN0YW5jZS5Db250cm9sUGFuZWxGZWlsZCk7XHJcblxyXG4gICAgICAgIGNvbnN0IHNlYXJjaFR5cGVzID0gdGhpcy5nZXRTZWFyY2hUeXBlcygpO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5jZnIpIHtcclxuICAgICAgICAgICAgY29uc3QgY21wRmFjdG9yeSA9IHRoaXMuY2ZyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KFNpbXBsZUNvbHVtbnNDb21wb25lbnQpO1xyXG4gICAgICAgICAgICBsZXQgc2ltcGxlUmVmID0gY21wRmFjdG9yeS5jcmVhdGUodGhpcy5pbmplY3Rvcik7XHJcbiAgICAgICAgICAgIHRoaXMuYXBwLmF0dGFjaFZpZXcoc2ltcGxlUmVmLmhvc3RWaWV3KTtcclxuICAgICAgICAgICAgc2ltcGxlUmVmLmluc3RhbmNlLmNvbHVtbnMgPSBjb2x1bW5zO1xyXG4gICAgICAgICAgICBzaW1wbGVSZWYuaW5zdGFuY2Uuc2VhcnRUeXBlcyA9IHNlYXJjaFR5cGVzO1xyXG4gICAgICAgICAgICBzaW1wbGVSZWYuaW5zdGFuY2UuZ3JpZEluc3RhbmNlID0gZ3JpZEluc3RhbmNlO1xyXG5cclxuICAgICAgICAgICAgaWYgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNwYWdlLXdyYXBwZXInKSkge1xyXG4gICAgICAgICAgICAgICAgc2ltcGxlUmVmLmluc3RhbmNlLnRvcCA9IDc2O1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBzaW1wbGVSZWYuaW5zdGFuY2UuZW5hYmxlU2NoZW1lID0gZ3JpZEluc3RhbmNlLmVuYWJsZVNjaGVtZTtcclxuICAgICAgICAgICAgaWYgKGdyaWRJbnN0YW5jZS5lbmFibGVTY2hlbWUpIHtcclxuICAgICAgICAgICAgICAgIGlmIChzZXR0aW5ncykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzZWxlY3RlZFNjaGVtZUl0ZW0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVTY2hlbWVTZXR0aW5ncyhzZWxlY3RlZFNjaGVtZUl0ZW0sIHNldHRpbmdzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2ltcGxlUmVmLmluc3RhbmNlLmN1cnJlbnRTY2hlbWVJdGVtID0gc2VsZWN0ZWRTY2hlbWVJdGVtO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNpbXBsZVJlZi5pbnN0YW5jZS5jdXJyZW50U2NoZW1lSXRlbSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNpbXBsZVJlZi5pbnN0YW5jZS5zZXR0aW5ncyA9IHNldHRpbmdzO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgX2N1cnJlbnRTY2hlbXRJdGVtID0gdGhpcy5nZXRBY3RpdmVTY2hlbWVJdGVtKGdyaWRJbnN0YW5jZS5pZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2ltcGxlUmVmLmluc3RhbmNlLmN1cnJlbnRTY2hlbWVJdGVtID0gX2N1cnJlbnRTY2hlbXRJdGVtO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHNpbXBsZVJlZi5sb2NhdGlvbi5uYXRpdmVFbGVtZW50KTtcclxuXHJcbiAgICAgICAgICAgIHNpbXBsZVJlZi5pbnN0YW5jZS5jbG9zZWQucGlwZShcclxuICAgICAgICAgICAgICAgIHN3aXRjaE1hcCggKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHNpbXBsZVJlZi5pbnN0YW5jZS5jb250YWluZXIubmF0aXZlRWxlbWVudC5zdHlsZS5yaWdodCA9ICctNTAwcHgnO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aW1lcig1MDApO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgKS5zdWJzY3JpYmUoICgpID0+IHtcclxuICAgICAgICAgICAgICAgIHNpbXBsZVJlZi5sb2NhdGlvbi5uYXRpdmVFbGVtZW50LnJlbW92ZSgpO1xyXG4gICAgICAgICAgICAgICAgc2ltcGxlUmVmLmRlc3Ryb3koKTtcclxuICAgICAgICAgICAgICAgIHNpbXBsZVJlZiA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zY2hlbWVMaXN0U3Vic2NyaXB0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zY2hlbWVMaXN0U3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgc2ltcGxlUmVmLmluc3RhbmNlLmFkdmFuY2VkLnN1YnNjcmliZSgoeyB2aWV3RmllbGRzIH0pID0+IHtcclxuICAgICAgICAgICAgICAgIGlmICh2aWV3RmllbGRzICYmIHZpZXdGaWVsZHMubGVuZ3RoKXtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVNjaGVtZVNldHRpbmdzKHNpbXBsZVJlZi5pbnN0YW5jZS5jdXJyZW50U2NoZW1lSXRlbSwge3ZpZXdDb2x1bW5zOiB2aWV3RmllbGRzfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNob3dBZHZhbmNlZChncmlkSW5zdGFuY2UsIG51bGwsIHNpbXBsZVJlZi5pbnN0YW5jZS5jdXJyZW50U2NoZW1lSXRlbSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgc2ltcGxlUmVmLmluc3RhbmNlLnN1Ym1pdC5zdWJzY3JpYmUoIChlOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIGUudGFyZ2V0LmRpc2FibGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNhdmluZykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5zYXZpbmcpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGUuY3VycmVudFNjaGVtZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEFjdGl2ZVNjaGVtZUl0ZW0oZ3JpZEluc3RhbmNlLmlkLCBlLmN1cnJlbnRTY2hlbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVHcmlkVmlldyhlLCBncmlkSW5zdGFuY2UsIGUudGFyZ2V0KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBzaW1wbGVSZWYuaW5zdGFuY2UuZmllbGRzQ2hhbmdlLnN1YnNjcmliZSgodmlzaWJsZUZpZWxkczogc3RyaW5nW10pID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlQWN0aXZlU2NoZW1lSXRlbVNldHRpbmdzKGdyaWRJbnN0YW5jZS5pZCwge3ZpZXdDb2x1bW5zOiB2aXNpYmxlRmllbGRzfSlcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAvLyDmiZPlvIDmlrDlop7mlrnmoYjnqpflj6NcclxuICAgICAgICAgICAgc2ltcGxlUmVmLmluc3RhbmNlLmFkZE5ld1NjaGVtZS5zdWJzY3JpYmUoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zaG93TmV3U2NoZW1lRGlhbG9nKGdyaWRJbnN0YW5jZSwgc2ltcGxlUmVmKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBzaW1wbGVSZWYuaW5zdGFuY2Uuc2NoZW1lTGlzdCA9IHRoaXMuc2NoZW1lU2VydmljZS5nZXRTdGF0ZVZhbHVlKGdyaWRJbnN0YW5jZS5pZCwgJ2xpc3QnKSB8fCBbXTtcclxuXHJcbiAgICAgICAgICAgIC8vIOaJk+W8gOaWueahiOeuoeeQhuWIl+ihqOeql+WPo1xyXG4gICAgICAgICAgICBzaW1wbGVSZWYuaW5zdGFuY2Uuc2hvd1NjaGVtZUxpc3Quc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2NoZW1lU2VydmljZS5nZXRTY2hlbWVMaXN0KGdyaWRJbnN0YW5jZS5pZCkucGlwZShcclxuICAgICAgICAgICAgICAgICAgICBzd2l0Y2hNYXAoKHQpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2NoZW1lU2VydmljZS5jaGVja0F1dGhvcml0eSgpLnBpcGUoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXAoKGF1dGg6IFNjaGVtZUF1dGhNb2RlbCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpc3Q6IHQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC4uLmF1dGhcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICApXHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICkuc3Vic2NyaWJlKCh0OiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNjaGVtZVNlcnZpY2Uuc2V0U2NoZW1lTGlzdChncmlkSW5zdGFuY2UuaWQsIHQubGlzdCB8fCBbXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93U2NoZW1lTGlzdERpYWxvZyhncmlkSW5zdGFuY2UsIGNsb25lRGVlcCh0Lmxpc3QgfHwgW10pLCB0LnN1Y2Nlc3MpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5zY2hlbWVMaXN0U3Vic2NyaXB0aW9uID0gdGhpcy5zY2hlbWVTZXJ2aWNlLnNjaGVtZUxpc3QkLnN1YnNjcmliZSgobGlzdDogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBzaW1wbGVSZWYuaW5zdGFuY2Uuc2NoZW1lTGlzdCA9IGxpc3Q7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCFsaXN0IHx8ICFsaXN0Lmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0QWN0aXZlU2NoZW1lSXRlbShncmlkSW5zdGFuY2UuaWQsIG51bGwpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBfYWN0aXZlU2NoZW1lSXRlbSA9IHRoaXMuZ2V0QWN0aXZlU2NoZW1lSXRlbShncmlkSW5zdGFuY2UuaWQpO1xyXG4gICAgICAgICAgICAgICAgaWYgKF9hY3RpdmVTY2hlbWVJdGVtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IGhhc0FjdGl2ZUl0ZW0gPSBsaXN0LmZpbmQobiA9PiBuLmlkID09PSBfYWN0aXZlU2NoZW1lSXRlbS5pZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFoYXNBY3RpdmVJdGVtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGhhc0FjdGl2ZUl0ZW0gPSB0aGlzLmdldERlZmF1bHRTY2hlbWUobGlzdCk7IC8vIOiOt+WPluiuvue9ruS4uuW9k+WJjeaWueahiOeahOmhuVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEFjdGl2ZVNjaGVtZUl0ZW0oZ3JpZEluc3RhbmNlLmlkLCBoYXNBY3RpdmVJdGVtIHx8IG51bGwpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgc2ltcGxlUmVmLmluc3RhbmNlLmN1cnJlbnRTY2hlbWVJdGVtID0gaGFzQWN0aXZlSXRlbTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAvLyDliIfmjaLmlrnmoYhcclxuICAgICAgICAgICAgc2ltcGxlUmVmLmluc3RhbmNlLmFjdGl2ZUl0ZW1DaGFuZ2Uuc3Vic2NyaWJlKChyOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2V0QWN0aXZlU2NoZW1lSXRlbShncmlkSW5zdGFuY2UuaWQsIHIpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHNpbXBsZVJlZi5ob3N0Vmlldy5kZXRlY3RDaGFuZ2VzKCk7XHJcblxyXG4gICAgICAgICAgICBzaW1wbGVSZWYuaW5zdGFuY2UuY29udGFpbmVyLm5hdGl2ZUVsZW1lbnQuc3R5bGUucmlnaHQgPSAnMHB4JztcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBzaW1wbGVSZWY7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcbiAgICBzaG93KGdyaWRJbnN0YW5jZTogRGF0YWdyaWRDb21wb25lbnQsIG9wdHM/OiBNb2RhbE9wdGlvbnMpIHtcclxuICAgICAgICB0aGlzLnJlZ2lzdGVyR3JpZEluc3RhbmNlKGdyaWRJbnN0YW5jZSk7XHJcblxyXG4gICAgICAgIGlmIChncmlkSW5zdGFuY2UuZW5hYmxlU2ltcGxlTW9kZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zaG93U2ltcGxlKGdyaWRJbnN0YW5jZSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2hvd0FkdmFuY2VkKGdyaWRJbnN0YW5jZSwgb3B0cyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2hvd0FkdmFuY2VkKGdyaWRJbnN0YW5jZTogRGF0YWdyaWRDb21wb25lbnQsIG9wdHM/OiBNb2RhbE9wdGlvbnMsIHNlbGVjdGVkU2NoZW1lSXRlbT86IERhdGFncmlkU2NoZW1lTW9kZWwpIHtcclxuICAgICAgICBsZXQgX2VkaXRDb2xTb3J0SW5mbyA9IHRydWU7XHJcbiAgICAgICAgY29uc3QgZWRpdENvbFNvcnRJbmZvID0gdGhpcy5jYW5TZXRDb2x1bW5Tb3J0KGdyaWRJbnN0YW5jZSk7XHJcbiAgICAgICAgaWYgKGVkaXRDb2xTb3J0SW5mbyAhPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAvLyB0aGlzLm1lc3NhZ2VyLndhcm5pbmcobXNnKTtcclxuICAgICAgICAgICAgLy8gcmV0dXJuO1xyXG4gICAgICAgICAgICBfZWRpdENvbFNvcnRJbmZvID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBzaG93U2V0Q29sdW1uc1RhYiA9ICF0aGlzLmlzSGVhZGVyR3JvdXAoZ3JpZEluc3RhbmNlKTtcclxuICAgICAgICBjb25zdCBnZXRBY3RpdmVUYWJJbmRleCA9ICgpID0+IHtcclxuICAgICAgICAgICAgaWYgKHNob3dTZXRDb2x1bW5zVGFiKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gMTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmIChfZWRpdENvbFNvcnRJbmZvKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDI7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAtMTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgY29uc3QgYWN0aXZlVGFiSW5kZXggPSBnZXRBY3RpdmVUYWJJbmRleCgpO1xyXG5cclxuICAgICAgICBpZiAoYWN0aXZlVGFiSW5kZXggPT09IC0xKSB7XHJcbiAgICAgICAgICAgIHRoaXMubWVzc2FnZXIud2FybmluZyh0aGlzLm5vdFNob3dEaWFsb2cpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBjb2x1bW5zID0gdGhpcy5jb252ZXJ0Q29sdW1uc1RvU2ltcGxlKGdyaWRJbnN0YW5jZS5jb2x1bW5zKTtcclxuXHJcbiAgICAgICAgLy8g6I635Y+W5b2T5YmN5pa55qGI5Lit5b2T5YmN6K+t6KiA55qE6YWN572u5pWw5o2uXHJcbiAgICAgICAgbGV0IGN1cnJlbnRTZXR0aW5nczogU2V0dGluZ01vZGVsID0gbnVsbDtcclxuICAgICAgICBpZiAoc2VsZWN0ZWRTY2hlbWVJdGVtICYmIHNlbGVjdGVkU2NoZW1lSXRlbS5xdWVyeUNvbmRpdGlvblN0cmluZykge1xyXG4gICAgICAgICAgICBjdXJyZW50U2V0dGluZ3MgPSBKU09OLnBhcnNlKHNlbGVjdGVkU2NoZW1lSXRlbS5xdWVyeUNvbmRpdGlvblN0cmluZylbdGhpcy5sb2NhbGVTZXIubG9jYWxlSWRdO1xyXG5cclxuICAgICAgICAgICAgaWYgKGN1cnJlbnRTZXR0aW5ncy5jb2x1bW5Gb3JtYXQgJiYgY3VycmVudFNldHRpbmdzLmNvbHVtbkZvcm1hdC5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIGNvbHVtbnNbMF0gPSBjb2x1bW5zWzBdLm1hcCgoY29sKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZmNvbCA9IGN1cnJlbnRTZXR0aW5ncy5jb2x1bW5Gb3JtYXQuZmluZChuID0+IG4uZmllbGQgPT09IGNvbC5maWVsZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZjb2wpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29sID0gT2JqZWN0LmFzc2lnbihjb2wsIGZjb2wpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29sO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBjb2x1bW5zWzBdID0gY29sdW1uc1swXS5maWx0ZXIobiA9PiBuLmZpZWxkICYmIG4uZmllbGQgIT09IGdyaWRJbnN0YW5jZS5Db250cm9sUGFuZWxGZWlsZCk7XHJcbiAgICAgICAgY29uc3QgdHJlZURhdGEgPSB0aGlzLmNvbnZlcnRDb2x1bW5zMlRyZWVEYXRhKGNsb25lRGVlcChjb2x1bW5zKSwgdHJ1ZSk7XHJcbiAgICAgICAgY29uc3Qgdmlld0NvbHVtbnNUcmVlRGF0YSA9IHRoaXMuY29udmVydENvbHVtbnMyVHJlZURhdGEoY2xvbmVEZWVwKGNvbHVtbnMpLCBmYWxzZSk7XHJcbiAgICAgICAgdGhpcy5jaGVja1ZpZXdUcmVlTm9kZXModmlld0NvbHVtbnNUcmVlRGF0YSk7XHJcblxyXG4gICAgICAgIGxldCBtb2RhbFJlZiA9IG51bGw7XHJcblxyXG4gICAgICAgIGNvbnN0IG9rVGV4dCA9IHRoaXMubG9jYWxlU2VyLmdldFZhbHVlKCdkYXRhZ3JpZC5zZXR0aW5ncy5vaycpIHx8ICfnoa7lrponO1xyXG4gICAgICAgIGNvbnN0IGNhbmNlbFRleHQgPSB0aGlzLmxvY2FsZVNlci5nZXRWYWx1ZSgnZGF0YWdyaWQuc2V0dGluZ3MuY2FuY2VsJykgfHwgJ+WPlua2iCc7XHJcbiAgICAgICAgY29uc3QgcmVzZXRUZXh0ID0gIHRoaXMubG9jYWxlU2VyLmdldFZhbHVlKCdkYXRhZ3JpZC5zZXR0aW5ncy5yZXNldCcpIHx8ICfph43nva4nO1xyXG5cclxuICAgICAgICBjb25zdCBkZWZhdWx0T3B0cyA9IHtcclxuICAgICAgICAgICAgd2lkdGg6IDc2MCwgaGVpZ2h0OiA1NjAsIHNob3dIZWFkZXI6IGZhbHNlLCB0aXRsZTogJ+aOp+WItumdouadvycsXHJcbiAgICAgICAgICAgIGluaXRpYWxTdGF0ZToge1xyXG4gICAgICAgICAgICAgICAgY29sdW1ucyxcclxuICAgICAgICAgICAgICAgIHNvcnRUcmVlRGF0YTogdHJlZURhdGEsXHJcbiAgICAgICAgICAgICAgICB2aWV3VHJlZURhdGE6IHZpZXdDb2x1bW5zVHJlZURhdGEsXHJcbiAgICAgICAgICAgICAgICBncmlkSW5zdGFuY2UsXHJcbiAgICAgICAgICAgICAgICBjYW5TZXRDb2x1bW5Tb3J0OiBfZWRpdENvbFNvcnRJbmZvLFxyXG4gICAgICAgICAgICAgICAgY2FuU2V0Q29sdW1uVmlzaWJsZTogc2hvd1NldENvbHVtbnNUYWIsXHJcbiAgICAgICAgICAgICAgICBhY3RpdmVUYWJJbmRleCxcclxuICAgICAgICAgICAgICAgIHNjaGVtZUluZm86IGN1cnJlbnRTZXR0aW5nc1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBzaG93QnV0dG9uczogZmFsc2VcclxuICAgICAgICB9O1xyXG4gICAgICAgIGNvbnN0IG1vZGFsT3B0cyA9IE9iamVjdC5hc3NpZ24oZGVmYXVsdE9wdHMsIG9wdHMgfHwge30pO1xyXG5cclxuICAgICAgICBtb2RhbFJlZiA9IHRoaXMubW9kYWxTZXIuc2hvdyhEYXRhZ3JpZFNldHRpbmdzQ29tcG9uZW50LCBtb2RhbE9wdHMpO1xyXG4gICAgICAgIGNvbnN0IGluc3RhbmNlID0gbW9kYWxSZWYuY29udGVudCBhcyBEYXRhZ3JpZFNldHRpbmdzQ29tcG9uZW50O1xyXG4gICAgICAgIGluc3RhbmNlLmVuYWJsZVJlc2V0ID0gdHJ1ZTtcclxuICAgICAgICBpbnN0YW5jZS5tb2RhbFJlZiA9IG1vZGFsUmVmO1xyXG4gICAgICAgIGluc3RhbmNlLmNhblNldENvbHVtblNvcnQgPSBfZWRpdENvbFNvcnRJbmZvO1xyXG4gICAgICAgIGluc3RhbmNlLmNhblNldENvbHVtblZpc2libGUgPSAhdGhpcy5pc0hlYWRlckdyb3VwKGdyaWRJbnN0YW5jZSk7XHJcblxyXG4gICAgICAgIGluc3RhbmNlLnN1Ym1pdEhhbmRsZS5zdWJzY3JpYmUoKGUpID0+IHtcclxuICAgICAgICAgICAgZS50YXJnZXQuZGlzYWJsZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5zYXZpbmcpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIXRoaXMuc2F2aW5nKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoc2VsZWN0ZWRTY2hlbWVJdGVtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRBY3RpdmVTY2hlbWVJdGVtKGdyaWRJbnN0YW5jZS5pZCwgc2VsZWN0ZWRTY2hlbWVJdGVtKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlR3JpZFZpZXcobW9kYWxSZWYsIGdyaWRJbnN0YW5jZSwgZS50YXJnZXQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGluc3RhbmNlLmNhbmNlbEhhbmRsZS5zdWJzY3JpYmUoKGUpID0+IHtcclxuICAgICAgICAgICAgbW9kYWxSZWYuY2xvc2UoKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8g5YiH5o2i5Yiw5L6n6L655qCP566A5rSB5qih5byPXHJcbiAgICAgICAgaW5zdGFuY2UuY29uY2lzZS5zdWJzY3JpYmUoKGUpID0+IHtcclxuICAgICAgICAgICAgbW9kYWxSZWYuY2xvc2UoKTtcclxuICAgICAgICAgICAgY29uc3Qgc2V0dGluZ3MgPSBtb2RhbFJlZi5jb250ZW50O1xyXG4gICAgICAgICAgICBjb25zdCB7IHNvcnRJbmZvLCB2aWV3Q29sdW1ucywgY29sdW1uRm9ybWF0LCBncm91cEZpZWxkIH0gPSBzZXR0aW5ncztcclxuICAgICAgICAgICAgdGhpcy5zaG93U2ltcGxlKGdyaWRJbnN0YW5jZSwgeyBzb3J0SW5mbywgdmlld0NvbHVtbnMsIGNvbHVtbkZvcm1hdCwgZ3JvdXBGaWVsZCB9LCBzZWxlY3RlZFNjaGVtZUl0ZW0pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBjb25zdCBtb2RhbENvbnRhaW5lciA9IG1vZGFsUmVmLmRpYWxvZy5pbnN0YW5jZSBhcyBNb2RhbENvbnRhaW5lckNvbXBvbmVudDtcclxuICAgICAgICBtb2RhbENvbnRhaW5lci5kcmFnZ2Jhci5oYW5kbGUgPSBpbnN0YW5jZS5oZWFkZXIubmF0aXZlRWxlbWVudDtcclxuICAgICAgICByZXR1cm4gbW9kYWxSZWY7XHJcbiAgICB9XHJcblxyXG5cclxuXHJcbiAgICBwcml2YXRlIGNhblNldENvbHVtblNvcnQoZ3JpZEluc3RhbmNlOiBEYXRhZ3JpZENvbXBvbmVudCkge1xyXG4gICAgICAgIGlmIChncmlkSW5zdGFuY2UubXVsdGlTb3J0ICYmIHRoaXMuaGFzRW5hYmxlU29ydENvbHVtbnMoZ3JpZEluc3RhbmNlKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuaGFzRW5hYmxlU29ydENvbHVtbnMoZ3JpZEluc3RhbmNlKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29sdW1uc1NvcnRhYmxlTXNnO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKCFncmlkSW5zdGFuY2UubXVsdGlTb3J0KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5tdWx0aVNvcnRNc2c7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBoYXNFbmFibGVTb3J0Q29sdW1ucyhncmlkSW5zdGFuY2U6IERhdGFncmlkQ29tcG9uZW50KSB7XHJcbiAgICAgICAgY29uc3Qgc29ydENvbHVtbnNDb3VudCA9IGdyaWRJbnN0YW5jZS5mbGF0Q29sdW1ucy5yZWR1Y2UoKGMsIHIpID0+IHtcclxuICAgICAgICAgICAgaWYgKHIuc29ydGFibGUpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBjICsgMTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gYztcclxuICAgICAgICB9LCAwKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHNvcnRDb2x1bW5zQ291bnQgPiAwO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgaXNIZWFkZXJHcm91cChncmlkOiBEYXRhZ3JpZENvbXBvbmVudCkge1xyXG4gICAgICAgIGNvbnN0IGZsYWcgPSBncmlkLmNvbHVtbnMubGVuZ3RoID4gMTtcclxuICAgICAgICBpZiAoZmxhZykge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5ub3RTdXBwb3J0SGVhZGVyR3JvdXBNc2c7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBmbGFnO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0Q2hpbGRzKGNvbHMsIHJvd0luZGV4LCBjb2xTdGFydEluZGV4LCBjb2xDb3VudCwgZm9yU29ydCA9IGZhbHNlKSB7XHJcbiAgICAgICAgY29uc3QgY2hpbGRDb2xzID0gW107XHJcbiAgICAgICAgbGV0IF9jb3VudCA9IGNvbFN0YXJ0SW5kZXg7XHJcbiAgICAgICAgaWYgKCFjb2xzW3Jvd0luZGV4XSkge1xyXG4gICAgICAgICAgICByZXR1cm4gIFtdO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29sc1tyb3dJbmRleF0uc2xpY2UoKS5mb3JFYWNoKGVsZW1lbnQgPT4ge1xyXG4gICAgICAgICAgICBfY291bnQgPSBfY291bnQgKyBlbGVtZW50LmNvbHNwYW47XHJcbiAgICAgICAgICAgIGlmICggX2NvdW50IDw9IGNvbENvdW50ICkge1xyXG4gICAgICAgICAgICAgICAgY2hpbGRDb2xzLnB1c2goZWxlbWVudCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgY29sc1tyb3dJbmRleF0uc3BsaWNlKDAsIGNoaWxkQ29scy5sZW5ndGgpO1xyXG5cclxuICAgICAgICByZXR1cm4gY2hpbGRDb2xzLm1hcCgoYywgaSkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgbjogYW55ID0ge1xyXG4gICAgICAgICAgICAgICAgZGF0YTogYyxcclxuICAgICAgICAgICAgICAgIHNlbGVjdGFibGU6IGZvclNvcnQgPyAhIWMuc29ydGFibGUgOiB0cnVlXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBpZiAoYy5jb2xzcGFuICYmIGMuY29sc3BhbiA+IDEpIHtcclxuICAgICAgICAgICAgICAgIG4gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogYyxcclxuICAgICAgICAgICAgICAgICAgICBzZWxlY3RhYmxlOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICBleHBhbmRlZDogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICBjaGlsZHJlbjogdGhpcy5nZXRDaGlsZHMoY29scywgcm93SW5kZXggKyAxLCAwICwgYy5jb2xzcGFuKVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gbjtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIGNvbnZlcnRDb2x1bW5zMlRyZWVEYXRhKGNvbHM6IERhdGFDb2x1bW5bXVtdLCBmb3JTb3J0ID0gZmFsc2UpIHtcclxuICAgICAgICBjb25zdCBjb2x1bW5zID0gY29scy5tYXAoKGM6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICBjLm1hcCgoXykgPT4ge1xyXG4gICAgICAgICAgICAgICAgXy5jb2xzcGFuID0gXy5jb2xzcGFuIHx8IDE7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gXztcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiBjO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGlmIChjb2x1bW5zLmxlbmd0aCA9PT0gMSkge1xyXG4gICAgICAgICAgICByZXR1cm4gY29sdW1uc1swXS5tYXAoYyA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IGMsXHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0YWJsZTogZm9yU29ydCA/ICEhYy5zb3J0YWJsZSA6IHRydWVcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBjb2x1bW5zWzBdLm1hcCgoYywgaSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKGMuY29sc3BhbiAmJiBjLmNvbHNwYW4gPiAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogYyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0YWJsZTogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4cGFuZGVkOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGlsZHJlbjogdGhpcy5nZXRDaGlsZHMoY29sdW1ucywgMSwgMCwgYy5jb2xzcGFuLCBmb3JTb3J0KVxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IGMsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGFibGU6IGZvclNvcnQgPyAhIWMuc29ydGFibGUgOiB0cnVlXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwcml2YXRlIGNoZWNrVmlld1RyZWVOb2Rlcyh0cmVlTm9kZXM6IFRyZWVOb2RlW10pIHtcclxuICAgICAgICB0cmVlTm9kZXMuZm9yRWFjaCgodG46IFRyZWVOb2RlKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICghdG4uY2hpbGRyZW4gfHwgIXRuLmNoaWxkcmVuLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgdG4uc2VsZWN0YWJsZSA9IHRydWU7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0bi5zZWxlY3RhYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNoZWNrVmlld1RyZWVOb2Rlcyh0bi5jaGlsZHJlbik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNvbnZlcnRDb2x1bW5zVG9TaW1wbGUoY29sczogYW55KSB7XHJcbiAgICAgICAgLy8g56e76Zmk6K6+572u5YiXXHJcbiAgICAgICAgcmV0dXJuIGNvbHMubWFwKCAoX2NvbHM6IERhdGFDb2x1bW5bXSkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gX2NvbHMubWFwKCAoYzogRGF0YUNvbHVtbikgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKGMuZmllbGQgIT09ICdfZGF0YWdyaWQtc2V0dGluZy1jb250cm9sXycpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWVsZDogYy5maWVsZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IGMudGl0bGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbHNwYW46IGMuY29sc3BhbixcclxuICAgICAgICAgICAgICAgICAgICAgICAgcm93c3BhbjogYy5yb3dzcGFuLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzb3J0YWJsZTogYy5zb3J0YWJsZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgb3JkZXI6IGMub3JkZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGhhbGlnbjogYy5oYWxpZ24gfHwgJ2xlZnQnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhbGlnbjogYy5hbGlnbiB8fCAnbGVmdCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZpc2libGU6IGMudmlzaWJsZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWxsb3dHcm91cGluZzogYy5hbGxvd0dyb3VwaW5nLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBncm91cEZvb3RlcjogYy5ncm91cEZvb3RlcixcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9vdGVyOiBjLmZvb3RlcixcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IGMud2lkdGggfHwgMTAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogYy5kYXRhVHlwZSB8fCAnc3RyaW5nJ1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pLmZpbHRlcihuID0+IG4pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgcmVzZXRHcmlkVmlldyhncmlkSW5zdGFuY2U6IGFueSkge1xyXG4gICAgICAgIGlmICghZ3JpZEluc3RhbmNlKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgZGZzID0gZ3JpZEluc3RhbmNlLmRmcztcclxuICAgICAgICBpZiAoZGZzKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG9wdGlvbnMgPSBkZnNbJ19zdGF0ZSddLmluaXRpYWxPcHRpb25zO1xyXG5cclxuICAgICAgICAgICAgaWYgKG9wdGlvbnMuc29ydCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuc29ydC5zb3J0TmFtZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGdyaWRJbnN0YW5jZS5zb3J0TmFtZSA9IG9wdGlvbnMuc29ydC5zb3J0TmFtZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLnNvcnQuc29ydE9yZGVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZ3JpZEluc3RhbmNlLnNvcnRPcmRlciA9IG9wdGlvbnMuc29ydC5zb3J0T3JkZXI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGdyaWRJbnN0YW5jZS5ncm91cEZpZWxkID0gb3B0aW9ucy5ncm91cEZpZWxkIHx8ICcnO1xyXG4gICAgICAgICAgICAvLyBUT0RPOiDov5jpnIDopoHkv67mraPpu5jorqTliJfnmoTmmL7npLrpobrluo9cclxuICAgICAgICAgICAgaWYgKG9wdGlvbnMuY29sdW1uRmllbGRzICYmIG9wdGlvbnMuY29sdW1uRmllbGRzLmxlbmd0aCkge1xyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IG5ld0NvbHVtbnMgPSBbXTtcclxuICAgICAgICAgICAgICAgIG9wdGlvbnMuY29sdW1uRmllbGRzLmZvckVhY2goYyA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29sID0gZ3JpZEluc3RhbmNlLmNvbHVtbnNbMF0uZmluZCgobjogYW55KSA9PiBuLmZpZWxkID09PSBjLmZpZWxkKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY29sKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbC52aXNpYmxlID0gYy52aXNpYmxlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2wuaGFsaWduID0gYy5oYWxpZ247XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbC5hbGlnbiA9IGMuYWxpZ247XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbC53aWR0aCA9IGMud2lkdGg7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbC5mb290ZXIgPSBjLmZvb3RlcjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29sLmdyb3VwRm9vdGVyID0gYy5ncm91cEZvb3RlcjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3Q29sdW1ucy5wdXNoKGNvbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgZ3JpZEluc3RhbmNlLmNvbHVtbnNbMF0gPSBuZXdDb2x1bW5zO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBncmlkSW5zdGFuY2VbJ2NoZWNrT3B0aW9ucyddKCk7XHJcbiAgICAgICAgICAgIGdyaWRJbnN0YW5jZVsnY29sdW1uc0NoYW5nZWQnXSgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHVwZGF0ZUdyaWRWaWV3KG1vZGFsUmVmLCBncmlkSW5zdGFuY2UsIGJ0biA9IG51bGwpIHtcclxuICAgICAgICBjb25zdCBzZXR0aW5ncyA9IG1vZGFsUmVmLmNvbnRlbnQ7XHJcblxyXG4gICAgICAgIGlmIChzZXR0aW5ncykge1xyXG4gICAgICAgICAgICBjb25zdCB7IHNvcnRJbmZvLCB2aWV3Q29sdW1ucywgY29sdW1uRm9ybWF0LCBncm91cEZpZWxkIH0gPSBzZXR0aW5ncztcclxuXHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlQWN0aXZlU2NoZW1lSXRlbVNldHRpbmdzKGdyaWRJbnN0YW5jZS5pZCwge3NvcnRJbmZvLCB2aWV3Q29sdW1ucywgY29sdW1uRm9ybWF0LCBncm91cEZpZWxkfSk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLnNhdmluZyA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICBsZXQgX2dyb3VwRmllbGQgPSAnJztcclxuICAgICAgICAgICAgaWYgKGdyaWRJbnN0YW5jZS5ncm91cFJvd3MgJiYgZ3JvdXBGaWVsZCAmJiBncm91cEZpZWxkLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgX2dyb3VwRmllbGQgPSBncm91cEZpZWxkLmpvaW4oJywnKSA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZ3JpZEluc3RhbmNlLmdyb3VwRmllbGQgPSBfZ3JvdXBGaWVsZDtcclxuICAgICAgICAgICAgY29uc3QgX2NvbGZvcm1hdHMgPSBjb2x1bW5Gb3JtYXQgPyB0aGlzLmNvbnZlcnRDb2x1bW5zVG9TaW1wbGUoW2NvbHVtbkZvcm1hdF0pWzBdIDogW107XHJcbiAgICAgICAgICAgIGNvbnN0IHNhdmVEYXRhID0geyBzb3J0SW5mbywgdmlld0NvbHVtbnMsIGdyb3VwRmllbGQ6IF9ncm91cEZpZWxkLCBjb2x1bW5Gb3JtYXQ6IF9jb2xmb3JtYXRzIH07XHJcbiAgICAgICAgICAgIHRoaXMuc2V0VXNlckNvbmZpZyhncmlkSW5zdGFuY2UuaWQsIHNhdmVEYXRhKS5zdWJzY3JpYmUoICgpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChidG4pIHtcclxuICAgICAgICAgICAgICAgICAgICBidG4uZGlzYWJsZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRoaXMuc2F2aW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBpZiAodmlld0NvbHVtbnMgJiYgdmlld0NvbHVtbnMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZ3JpZEluc3RhbmNlLmNvbHVtbnMgPSBncmlkSW5zdGFuY2UuY29sdW1ucy5tYXAoY29scyA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlQ29sdW1uRm9ybWF0KGNvbHMsIGNvbHVtbkZvcm1hdCwgZ3JpZEluc3RhbmNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubmV3VmlzaWJsZU9yZGVyQ29sdW1ucyhjb2xzLCB2aWV3Q29sdW1ucywgY29sdW1uRm9ybWF0LCBncmlkSW5zdGFuY2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGdyaWRJbnN0YW5jZS5jb2x1bW5zQ2hhbmdlZCh0cnVlKTtcclxuICAgICAgICAgICAgICAgIGlmIChzb3J0SW5mbyAmJiBPYmplY3Qua2V5cyhzb3J0SW5mbykubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgeyBzb3J0TmFtZSwgc29ydE9yZGVyIH0gPSBzb3J0SW5mbztcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc29ydE5hbWUgJiYgc29ydE5hbWUubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdyaWRJbnN0YW5jZS5zb3J0KHNvcnROYW1lLmpvaW4oJywnKSwgc29ydE9yZGVyLmpvaW4oJywnKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ3JpZEluc3RhbmNlLmNsZWFyU29ydCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZ3JpZEluc3RhbmNlLmNsZWFyU29ydCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIG1vZGFsUmVmLmNsb3NlKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIG1vZGFsUmVmLmNsb3NlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcbiAgICBuZXdWaXNpYmxlT3JkZXJDb2x1bW5zKGNvbHM6IGFueSwgdmlld0NvbHVtbnM6IGFueSwgY29sdW1uRm9ybWF0OiBhbnksIGdyaWRJbnN0YW5jZTogYW55KSB7XHJcbiAgICAgICAgY29uc3QgaGlkZUNvbHVtbnMgPSBbXTtcclxuICAgICAgICBjb2xzLmZvckVhY2goKGVsZW1lbnQsIGluZGV4KSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmlzTmV3QWRkQ29sdW1uKGVsZW1lbnQuZmllbGQsIGNvbHVtbkZvcm1hdCkgJiYgZWxlbWVudC5maWVsZCAhPT0gJ19kYXRhZ3JpZC1zZXR0aW5nLWNvbnRyb2xfJyAmJiAhZ3JpZEluc3RhbmNlLmVuYWJsZVNjaGVtZSkge1xyXG4gICAgICAgICAgICAgICAgdmlld0NvbHVtbnMucHVzaChlbGVtZW50LmZpZWxkKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGVsZW1lbnQudmlzaWJsZSA9IHZpZXdDb2x1bW5zLmluY2x1ZGVzKGVsZW1lbnQuZmllbGQpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFlbGVtZW50LnZpc2libGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBoaWRlQ29sdW1ucy5wdXNoKGVsZW1lbnQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIOa4heeQhuS4jeWtmOWcqOeahOWIl1xyXG4gICAgICAgIGxldCBuZXdDb2xzID0gdmlld0NvbHVtbnMubWFwKCBmaWVsZCA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiBjb2xzLmZpbmQoYyA9PiBjLmZpZWxkID09PSBmaWVsZCk7XHJcbiAgICAgICAgfSkuZmlsdGVyKG4gPT4gbik7XHJcblxyXG4gICAgICAgIGlmIChoaWRlQ29sdW1ucy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgbmV3Q29scyA9IG5ld0NvbHMuY29uY2F0KGhpZGVDb2x1bW5zKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBuZXdDb2xzLmZpbHRlcihjID0+IGMgJiYgYy5maWVsZCAmJiBjLmZpZWxkICE9PSAnX2RhdGFncmlkLXNldHRpbmctY29udHJvbF8nICk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmmK/lkKbkuLrmlrDlop7liqDnmoTlrZfmrrVcclxuICAgICAqIOaWsOWinueahOWtl+aute+8jOmcgOimgeWcqOWIl+ihqOS4reWxleekuuWHuuadpe+8jOW5tuS/neWtmOWIsOS4quaAp+WMluiuvue9ruS4rVxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGlzTmV3QWRkQ29sdW1uKGZpZWxkOiBhbnksIGNvbHVtbnM6IGFueSkge1xyXG4gICAgICAgIGNvbHVtbnMgPSBjb2x1bW5zIHx8IFtdO1xyXG4gICAgICAgIHJldHVybiAhY29sdW1ucy5maW5kKGMgPT4gYy5maWVsZCA9PT0gZmllbGQpO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICB1cGRhdGVDb2x1bW5Gb3JtYXQoY29sczogYW55W10sIGNvbHVtbkZvcm1hdDogYW55W10sIGdyaWRJbnN0YW5jZSkge1xyXG4gICAgICAgIGlmIChjb2x1bW5Gb3JtYXQgJiYgY29sdW1uRm9ybWF0Lmxlbmd0aCkge1xyXG4gICAgICAgICAgICBjb2xzLmZvckVhY2goY29sID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGZvcm1hdENvbCA9IGNvbHVtbkZvcm1hdC5maW5kKGY9PiBmLmZpZWxkID09PSBjb2wuZmllbGQpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGZvcm1hdENvbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbC53aWR0aCA9IGZvcm1hdENvbC53aWR0aDtcclxuICAgICAgICAgICAgICAgICAgICBjb2wuaGFsaWduID0gZm9ybWF0Q29sLmhhbGlnbiB8fCAnbGVmdCc7XHJcbiAgICAgICAgICAgICAgICAgICAgY29sLmFsaWduID0gZm9ybWF0Q29sLmFsaWduIHx8ICdsZWZ0JztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGdyaWRJbnN0YW5jZS5ncm91cFJvd3MgJiYgKGNvbC5hbGxvd0dyb3VwaW5nIHx8IGNvbC5hbGxvd0dyb3VwaW5nID09PSB1bmRlZmluZWQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghY29sLmdyb3VwRm9vdGVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2wuZ3JvdXBGb290ZXIgPSBmb3JtYXRDb2wuZ3JvdXBGb290ZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb2wuZ3JvdXBGb290ZXIgJiYgY29sLmdyb3VwRm9vdGVyLm9wdGlvbnMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbC5ncm91cEZvb3Rlci5vcHRpb25zLnRleHQgPSBmb3JtYXRDb2wuZ3JvdXBGb290ZXIub3B0aW9ucy50ZXh0IHx8ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sLmdyb3VwRm9vdGVyLm9wdGlvbnMuY2FsY3VsYXRpb25UeXBlID1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXRDb2wuZ3JvdXBGb290ZXIub3B0aW9ucy5jYWxjdWxhdGlvblR5cGUgIT09IHVuZGVmaW5lZCAmJlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdENvbC5ncm91cEZvb3Rlci5vcHRpb25zLmNhbGN1bGF0aW9uVHlwZSAhPT0gbnVsbCA/XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VJbnQoZm9ybWF0Q29sLmdyb3VwRm9vdGVyLm9wdGlvbnMuY2FsY3VsYXRpb25UeXBlLCAxMCkgOiAtMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGdyaWRJbnN0YW5jZS5zaG93Rm9vdGVyICYmICFncmlkSW5zdGFuY2UuZm9vdGVyVGVtcGxhdGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFjb2wuZm9vdGVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2wuZm9vdGVyID0gZm9ybWF0Q29sLmZvb3RlcjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbC5mb290ZXIgJiYgY29sLmZvb3Rlci5vcHRpb25zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2wuZm9vdGVyLm9wdGlvbnMudGV4dCA9IGZvcm1hdENvbC5mb290ZXIub3B0aW9ucy50ZXh0IHx8ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sLmZvb3Rlci5vcHRpb25zLmNhbGN1bGF0aW9uVHlwZSA9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWF0Q29sLmZvb3Rlci5vcHRpb25zLmNhbGN1bGF0aW9uVHlwZSAhPT0gdW5kZWZpbmVkICYmXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWF0Q29sLmZvb3Rlci5vcHRpb25zLmNhbGN1bGF0aW9uVHlwZSAhPT0gbnVsbCA/XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VJbnQoZm9ybWF0Q29sLmZvb3Rlci5vcHRpb25zLmNhbGN1bGF0aW9uVHlwZSwgMTApIDogLTE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyDliJvlu7rllK/kuIBrZXksIOeUsXVyaSArIGdyaWRJZCDnu4TmiJDvvIzlubbmt7fmt4ZcclxuICAgIHByaXZhdGUgY3JlYXRlQ29uZmlnS2V5KGdyaWRJZDogc3RyaW5nKSB7XHJcbiAgICAgICAgY29uc3QgZ3JpZCA9IHRoaXMuZ2V0R3JpZEluc3RhbmNlKGdyaWRJZCk7XHJcbiAgICAgICAgaWYgKGdyaWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGdyaWQuZGdzLmNyZWF0ZUNvbmZpZ0tleShncmlkSWQpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdEYXRhZ3JpZFNldHRpbmdTZXJ2aWNlOiBDYW4gbm90IGZpbmQgdGhlIGdyaWQgaW5zdGFuY2UuJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcblxyXG4gICAgcHJpdmF0ZSBnZXRDdXJyZW50VXNlclNldHRpbmdzKGdyaWRJZDogc3RyaW5nKSB7XHJcbiAgICAgICAgY29uc3QgZ3JpZEluc3RhbmNlID0gdGhpcy5nZXRHcmlkSW5zdGFuY2UoZ3JpZElkKTtcclxuICAgICAgICBjb25zdCBjb25maWcgPSB7c29ydEluZm86IHt9LCB2aWV3Q29sdW1uczogW10sIGdyb3VwRmllbGQ6ICcnLCBjb2x1bW5Gb3JtYXQ6IFtdfTtcclxuXHJcbiAgICAgICAgaWYgKGdyaWRJbnN0YW5jZSkge1xyXG4gICAgICAgICAgICBjb25zdCB7IHNvcnROYW1lLCBzb3J0T3JkZXIsIGNvbHVtbnN9ID0gZ3JpZEluc3RhbmNlO1xyXG4gICAgICAgICAgICBpZiAoc29ydE5hbWUpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHNvcnRJbmZvID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHNvcnROYW1lOiBzb3J0TmFtZS5zcGxpdCgnLCcpLFxyXG4gICAgICAgICAgICAgICAgICAgIHNvcnRPcmRlcjogc29ydE9yZGVyLnNwbGl0KCcsJylcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgY29uZmlnLnNvcnRJbmZvID0gc29ydEluZm87XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHZpZXdDb2x1bW5zID0gY29sdW1uc1swXS5maWx0ZXIobiA9PiBuLnZpc2libGUgfHwgbi52aXNpYmxlID09PSB1bmRlZmluZWQpLm1hcChuID0+IG4uZmllbGQpO1xyXG4gICAgICAgICAgICBjb25maWcudmlld0NvbHVtbnMgPSB2aWV3Q29sdW1ucztcclxuICAgICAgICAgICAgY29uZmlnLmNvbHVtbkZvcm1hdCA9IHRoaXMuY29udmVydENvbHVtbnNUb1NpbXBsZShjb2x1bW5zKVswXTtcclxuXHJcbiAgICAgICAgICAgIGlmIChncmlkSW5zdGFuY2UuZ3JvdXBSb3dzKSB7XHJcbiAgICAgICAgICAgICAgICBjb25maWcuZ3JvdXBGaWVsZCA9IGdyaWRJbnN0YW5jZS5ncm91cEZpZWxkO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBjb25maWc7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHNhdmVVc2VyQ29uZmlnKGdyaWRJZDogc3RyaW5nKSB7XHJcbiAgICAgICAgY29uc3QgY29uZmlnID0gdGhpcy5nZXRDdXJyZW50VXNlclNldHRpbmdzKGdyaWRJZCk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc2V0VXNlckNvbmZpZyhncmlkSWQsIGNvbmZpZyk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0VXNlckNvbmZpZyhncmlkSWQ6IHN0cmluZywgY29uZmlnOiBhbnkgKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgICAgICBjb25zdCBrZXkgPSB0aGlzLmNyZWF0ZUNvbmZpZ0tleShncmlkSWQpO1xyXG4gICAgICAgIGNvbnN0IExPQ0FMRUlEID0gdGhpcy5sb2NhbGVTZXIubG9jYWxlSWQ7XHJcbiAgICAgICAgY29uc3QgY3VycmVudENvbmZpZyA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKGtleSk7XHJcbiAgICAgICAgY29uc3QgX2NvbmZpZyA9IChjdXJyZW50Q29uZmlnID8gSlNPTi5wYXJzZShjdXJyZW50Q29uZmlnKSA6IHsgfSkgfHwge307XHJcbiAgICAgICAgaWYgKGNvbmZpZykge1xyXG4gICAgICAgICAgICBpZiAoX2NvbmZpZykge1xyXG4gICAgICAgICAgICAgICAgX2NvbmZpZ1tMT0NBTEVJRF0gPSBjb25maWc7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGtleSwgSlNPTi5zdHJpbmdpZnkoX2NvbmZpZykpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGtleSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmh0dHBSZXN0U2VydmljZSkge1xyXG4gICAgICAgICAgICBjb25zdCBncmlkSW5zID0gdGhpcy5nZXRHcmlkSW5zdGFuY2UoZ3JpZElkKTtcclxuICAgICAgICAgICAgaWYgKGdyaWRJbnMgJiYgZ3JpZElucy5lbmFibGVTY2hlbWUpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGFjdGl2ZVNjaGVtZSA9IHRoaXMuZ2V0QWN0aXZlU2NoZW1lSXRlbShncmlkSWQpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGFjdGl2ZVNjaGVtZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIHJldHVybiB0aGlzLnVwZGF0ZVNjaGVtZShncmlkSWQsIGNvbmZpZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFjdGl2ZVNjaGVtZS50eXBlID09PSAncHJpdmF0ZScpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2NoZW1lU2VydmljZS5zYXZlU2NoZW1lKGFjdGl2ZVNjaGVtZSwgZ3JpZElkLCB0cnVlKVxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNjaGVtZVNlcnZpY2UuY2hlY2tBdXRob3JpdHkoKS5waXBlKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoTWFwKCh0OiBTY2hlbWVBdXRoTW9kZWwpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodC5zdWNjZXNzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGhhc09yZ0F1dGhvcml0eSA9IHQuYXV0aE9yZ2FuaXphdGlvbkRhdGEgJiYgdC5hdXRoT3JnYW5pemF0aW9uRGF0YS5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhY3RpdmVTY2hlbWUudHlwZSA9PT0gJ3B1YmxpYycgfHwgKGFjdGl2ZVNjaGVtZS50eXBlID09PSAnb3JnJyAmJiBoYXNPcmdBdXRob3JpdHkpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zY2hlbWVTZXJ2aWNlLnNhdmVTY2hlbWUoYWN0aXZlU2NoZW1lLCBncmlkSWQsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2YodHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIOS/neWtmOiHs+aVsOaNruW6k1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fc2F2ZVVzZXJDb25maWcoa2V5LCAgY29uZmlnID8gX2NvbmZpZyA6ICAnJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gb2YodHJ1ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0VXNlckNvbmZpZyhrZXkpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgICAgIGlmICh0aGlzLmh0dHBSZXN0U2VydmljZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fZ2V0VXNlckNvbmZpZyhrZXkpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbmZpZyA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKGtleSk7XHJcbiAgICAgICAgICAgIGlmIChjb25maWcpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNvbiA9IEpTT04ucGFyc2UoY29uZmlnKTtcclxuICAgICAgICAgICAgICAgIGlmIChjb25bdGhpcy5sb2NhbGVTZXIubG9jYWxlSWRdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9mKGNvblt0aGlzLmxvY2FsZVNlci5sb2NhbGVJZF0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmtleXMoY29uKS5pbmRleE9mKCd2aWV3Q29sdW1ucycpID4gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9mKGNvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG9mKG51bGwpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0RGVmYXVsdFNjaGVtZShzY2hlbWVMaXN0OiBBcnJheTxEYXRhZ3JpZFNjaGVtZU1vZGVsPikge1xyXG4gICAgICAgIC8vIDHjgIHmnInkuKrkurrpu5jorqTnmoTov5Tlm57kuKrkurrpu5jorqTmlrnmoYhcclxuICAgICAgICAvLyAy44CB5rKh5pyJ5Liq5Lq66buY6K6k5pa55qGI55qE77yM6L+U5Zue5YWs5YWx5pa55qGI56ysMeS4qlxyXG4gICAgICAgIC8vIDPjgIHmsqHmnInlhazlhbHmlrnmoYjvvIzov5Tlm57nu4Tnu4fmlrnmoYjnrKwx5LiqXHJcbiAgICAgICAgLy8gNOOAgeayoeaciee7hOe7h+aWueahiOeahCwg6L+U5Zue5Liq5Lq65pa55qGI56ysMeS4qlxyXG4gICAgICAgIC8vIDXjgIHmsqHmnInkuKrkurrmlrnmoYjnmoTvvIzov5Tlm57ns7vnu5/pooTliLbvvIzljbPooajljZXorr7orqHml7bnmoTmoLzlvI9cclxuXHJcbiAgICAgICAgbGV0IGRlZmF1bHRTY2hlbWUgPSBudWxsO1xyXG4gICAgICAgIGlmICghc2NoZW1lTGlzdCB8fCAhc2NoZW1lTGlzdC5sZW5ndGgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHRTY2hlbWU7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgZGVmYXVsdFNjaGVtZSA9IHNjaGVtZUxpc3QuZmluZChuID0+IG4uaXNEZWZhdWx0KTtcclxuICAgICAgICAgICAgaWYgKCFkZWZhdWx0U2NoZW1lKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgcHVibGljU2NoZW1lcyA9IHNjaGVtZUxpc3QuZmlsdGVyKG4gPT4gbi50eXBlID09PSAncHVibGljJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCFwdWJsaWNTY2hlbWVzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHB1YmxpY1NjaGVtZXMgPSBzY2hlbWVMaXN0LmZpbHRlcihuID0+IG4udHlwZSA9PT0gJ29yZycpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChwdWJsaWNTY2hlbWVzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHRTY2hlbWUgPSBwdWJsaWNTY2hlbWVzWzBdO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0U2NoZW1lID0gc2NoZW1lTGlzdFswXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGRlZmF1bHRTY2hlbWU7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGdldFNldHRpbmdzKGdyaWRJZDogc3RyaW5nKSB7XHJcbiAgICAgICAgY29uc3Qga2V5ID0gdGhpcy5jcmVhdGVDb25maWdLZXkoZ3JpZElkKTtcclxuICAgICAgICBjb25zdCBncmlkSW5zID0gdGhpcy5nZXRHcmlkSW5zdGFuY2UoZ3JpZElkKTtcclxuXHJcbiAgICAgICAgbGV0IHNjaGVtZUxpc3QkID0gb2YoW10pO1xyXG4gICAgICAgIGlmIChncmlkSW5zICYmIGdyaWRJbnMuZW5hYmxlU2NoZW1lKSB7XHJcbiAgICAgICAgICAgIHNjaGVtZUxpc3QkID0gdGhpcy5nZXRTY2hlbWVMaXN0KGdyaWRJZCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gZm9ya0pvaW4oc2NoZW1lTGlzdCQsIHRoaXMuZ2V0VXNlckNvbmZpZyhrZXkpLCB0aGlzLnNjaGVtZVNlcnZpY2UuZ2V0TGFuZ3VhZ2VzKCkpLnBpcGUoXHJcbiAgICAgICAgICAgIG1hcCgoW3NjaGVtZUxpc3QsIHVzZXJTZXR0aW5nLCBzdXBwb3J0ZWRMYW5ndWFnZXNdKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBzY2hlbWVMaXN0ID0gc2NoZW1lTGlzdCB8fCBbXTtcclxuICAgICAgICAgICAgICAgIHRoaXMubGFuZ3VhZ2VzID0gc3VwcG9ydGVkTGFuZ3VhZ2VzO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFzY2hlbWVMaXN0Lmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB1c2VyU2V0dGluZztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8g57yT5a2Y5pa55qGI5YiX6KGoXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRTY2hlbWVMaXN0KHNjaGVtZUxpc3QsIGdyaWRJZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8g5p+l5om+6buY6K6k5pa55qGIXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGVmYXVsdFNjaGVtZTogRGF0YWdyaWRTY2hlbWVNb2RlbCA9IHRoaXMuZ2V0RGVmYXVsdFNjaGVtZShzY2hlbWVMaXN0KTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIWRlZmF1bHRTY2hlbWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVzZXJTZXR0aW5nO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0QWN0aXZlU2NoZW1lSXRlbShncmlkSWQsIGRlZmF1bHRTY2hlbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB1c2VyU2V0dGluZ3MgPSBKU09OLnBhcnNlKGRlZmF1bHRTY2hlbWUucXVlcnlDb25kaXRpb25TdHJpbmcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodXNlclNldHRpbmdzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBsb2NhbGVJZCA9IHRoaXMubG9jYWxlU2VyLmxvY2FsZUlkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXJTZXR0aW5nc1tsb2NhbGVJZF0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShrZXksIEpTT04uc3RyaW5naWZ5KHVzZXJTZXR0aW5ncykpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1c2VyU2V0dGluZ3NbbG9jYWxlSWRdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyU2V0dGluZ3NbbG9jYWxlSWRdID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShrZXksIEpTT04uc3RyaW5naWZ5KHVzZXJTZXR0aW5ncykpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgcHJpdmF0ZSBfc2F2ZVVzZXJDb25maWcoa2V5LCBjb25maWcpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBjb25zdCB1c2VyQ29uZmlnU2V0dGluZyA9IHtcclxuICAgICAgICAgICAgICAgIGNvbmZpZ2tleTE6IGtleSxcclxuICAgICAgICAgICAgICAgIGNvbmZpZ2tleTI6ICcnLFxyXG4gICAgICAgICAgICAgICAgY29uZmlna2V5MzogJycsXHJcbiAgICAgICAgICAgICAgICB0ZXh0dmFsdWU6IGNvbmZpZyA/IEpTT04uc3RyaW5naWZ5KGNvbmZpZykgOiAgJydcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmh0dHBSZXN0U2VydmljZS5zYXZlVXNlclNldHRpbmdzKHVzZXJDb25maWdTZXR0aW5nKTtcclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJlc2V0VXNlckNvbmZpZyhncmlkSW5zdGFuY2UsIG1vZGFsUmVmKSB7XHJcbiAgICAgICAgY29uc3QgcmVzdG9yRGVmYXVsdFRleHQgPSB0aGlzLmxvY2FsZVNlci5nZXRWYWx1ZSgnZGF0YWdyaWQuc2V0dGluZ3MucmVzdG9yZURlZmF1bHRTZXR0aW5nc1RleHQnKSB8fCAn56Gu6K6k6KaB5oGi5aSN6buY6K6k6K6+572u5ZCX77yfJztcclxuICAgICAgICB0aGlzLm1lc3NhZ2VyLmNvbmZpcm0ocmVzdG9yRGVmYXVsdFRleHQpLnBpcGUoXHJcbiAgICAgICAgICAgIHN3aXRjaE1hcCggKHQ6IGJvb2xlYW4pID0+IHtcclxuICAgICAgICAgICAgICAgIGlmICh0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2V0VXNlckNvbmZpZyhncmlkSW5zdGFuY2UuaWQsICcnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiBvZih0KTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICApLnN1YnNjcmliZSgodDogYm9vbGVhbikgPT4ge1xyXG4gICAgICAgICAgICBpZiAodCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZXNldEdyaWRWaWV3KGdyaWRJbnN0YW5jZSk7XHJcbiAgICAgICAgICAgICAgICBtb2RhbFJlZi5jbG9zZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfZ2V0VXNlckNvbmZpZyhrZXkpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5odHRwUmVzdFNlcnZpY2UuZ2V0VXNlclNldHRpbmdzKGtleSkucGlwZShcclxuICAgICAgICAgICAgICAgIG1hcCgodWNzOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodWNzICYmIHVjcy50ZXh0VmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYyA9IEpTT04ucGFyc2UodWNzLnRleHRWYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY1t0aGlzLmxvY2FsZVNlci5sb2NhbGVJZF0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShrZXksIHVjcy50ZXh0VmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjW3RoaXMubG9jYWxlU2VyLmxvY2FsZUlkXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY1t0aGlzLmxvY2FsZVNlci5sb2NhbGVJZF0gPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGtleSwgSlNPTi5zdHJpbmdpZnkoYykpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlmIChPYmplY3Qua2V5cyhjKS5pbmRleE9mKCd2aWV3Q29sdW1ucycpID4gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgcmV0dXJuIGM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBidWlsZFN1Ym1pdERhdGEoZ3JpZElkOiBzdHJpbmcsIHNldHRpbmdzID0gbnVsbCkge1xyXG4gICAgICAgIGNvbnN0IExPQ0FMRUlEID0gdGhpcy5sb2NhbGVTZXIubG9jYWxlSWQ7XHJcbiAgICAgICAgaWYgKCFzZXR0aW5ncykge1xyXG4gICAgICAgICAgICBzZXR0aW5ncyA9IHRoaXMuZ2V0Q3VycmVudFVzZXJTZXR0aW5ncyhncmlkSWQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBsb2NhbGVLZXkgPSB0aGlzLmNyZWF0ZUNvbmZpZ0tleShncmlkSWQpO1xyXG4gICAgICAgIGNvbnN0IGN1cnJlbnRDb25maWcgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShsb2NhbGVLZXkpO1xyXG4gICAgICAgIGNvbnN0IF9jb25maWcgPSAoY3VycmVudENvbmZpZyA/IEpTT04ucGFyc2UoY3VycmVudENvbmZpZykgOiB7IH0pIHx8IHt9O1xyXG4gICAgICAgIGlmIChfY29uZmlnKSB7XHJcbiAgICAgICAgICAgIF9jb25maWdbTE9DQUxFSURdID0gc2V0dGluZ3M7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gX2NvbmZpZztcclxuICAgIH1cclxuXHJcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIFxcXFxcclxuXHJcbiAgICBwcml2YXRlIHNob3dTY2hlbWVMaXN0RGlhbG9nKGdyaWRJbnN0YW5jZTogYW55LCBzY2hlbWVMaXN0OiBhbnksIGNhbkRlbCA9IHRydWUpIHtcclxuICAgICAgICBjb25zdCBtb2RhbE9wdHMgPSB7XHJcbiAgICAgICAgICAgIHdpZHRoOiA3NjAsIGhlaWdodDogNTc3LCBzaG93SGVhZGVyOiBmYWxzZSwgdGl0bGU6ICfmjqfliLbpnaLmnb8nLFxyXG4gICAgICAgICAgICBpbml0aWFsU3RhdGU6IHtcclxuICAgICAgICAgICAgICAgIGl0ZW1zOiBzY2hlbWVMaXN0IHx8IFtdLFxyXG4gICAgICAgICAgICAgICAgcmVtb3ZlSXRlbTogY2FuRGVsXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHNob3dCdXR0b25zOiBmYWxzZVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGNvbnN0IHNjaGVtZUxpc3REbGcgPSB0aGlzLm1vZGFsU2VyLnNob3coU2NoZW1lTGlzdENvbXBvbmVudCwgbW9kYWxPcHRzKTtcclxuICAgICAgICBjb25zdCBpbnN0YW5jZSA9IHNjaGVtZUxpc3REbGcuY29udGVudCBhcyBTY2hlbWVMaXN0Q29tcG9uZW50O1xyXG4gICAgICAgIGluc3RhbmNlLmNsb3NlTW9kYWwuc3Vic2NyaWJlKCAoKSA9PiB7XHJcbiAgICAgICAgICAgIHNjaGVtZUxpc3REbGcuY2xvc2UoKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaW5zdGFuY2Uuc3VibWl0TW9kYWwuc3Vic2NyaWJlKCh0OiBhbnkpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5zY2hlbWVTZXJ2aWNlLnVwZGF0ZVNjaGVtZSh0LCBncmlkSW5zdGFuY2UuaWQpLnN1YnNjcmliZSgoZTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZihlID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNjaGVtZUxpc3REbGcuY2xvc2UoKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjb25zdCBtc2cgPSAn5YiX6K6+572u5pa55qGI5L+d5a2Y5oiQ5Yqf44CCJztcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLm5vdGlmeVNlcnZpY2UpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm5vdGlmeVNlcnZpY2Uuc3VjY2Vzcyhtc2cpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm1lc3NhZ2VyLnN1Y2Nlc3MobXNnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBzY2hlbWVMaXN0ID0gdGhpcy5zY2hlbWVTZXJ2aWNlLmdldFN0YXRlVmFsdWUoZ3JpZEluc3RhbmNlLmlkLCAnbGlzdCcpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmKHQuZGVmYXVsdElkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NoZW1lTGlzdC5mb3JFYWNoKG4gPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBuLmlzRGVmYXVsdCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobi5pZCA9PT0gdC5kZWZhdWx0SWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4uaXNEZWZhdWx0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuc2V0QWN0aXZlU2NoZW1lSXRlbShncmlkSW5zdGFuY2UuaWQsIG4pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IG5ld1NjaGVtZUxpc3QgPSBzY2hlbWVMaXN0O1xyXG4gICAgICAgICAgICAgICAgaWYgKHQuZGVsZXRlZElkcyAmJiB0LmRlbGV0ZWRJZHMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV3U2NoZW1lTGlzdCA9IHNjaGVtZUxpc3QuZmlsdGVyKG4gPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIXQuZGVsZXRlZElkcy5pbmNsdWRlcyhuLmlkKVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMuc2NoZW1lU2VydmljZS5zZXRTY2hlbWVMaXN0KGdyaWRJbnN0YW5jZS5pZCwgbmV3U2NoZW1lTGlzdCk7XHJcbiAgICAgICAgICAgICAgICBzY2hlbWVMaXN0RGxnLmNsb3NlKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBjb25zdCBtb2RhbENvbnRhaW5lciA9IHNjaGVtZUxpc3REbGcuZGlhbG9nLmluc3RhbmNlIGFzIE1vZGFsQ29udGFpbmVyQ29tcG9uZW50O1xyXG4gICAgICAgIG1vZGFsQ29udGFpbmVyLmRyYWdnYmFyLmhhbmRsZSA9IGluc3RhbmNlLmhlYWRlci5uYXRpdmVFbGVtZW50O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOaWsOWinuaIluWPpuWtmOaWueahiFxyXG4gICAgcHJpdmF0ZSBzaG93TmV3U2NoZW1lRGlhbG9nKGdyaWRJbnN0YW5jZSwgc2ltcGxlUmVmICkge1xyXG4gICAgICAgIGNvbnN0IG1vZGFsT3B0cyA9IHtcclxuICAgICAgICAgICAgd2lkdGg6IDQ4MCwgaGVpZ2h0OiAyNjksIHNob3dIZWFkZXI6IGZhbHNlLCB0aXRsZTogJ+aOp+WItumdouadvycsXHJcbiAgICAgICAgICAgIGluaXRpYWxTdGF0ZToge1xyXG4gICAgICAgICAgICAgICAgbGFuZ3VhZ2VzOiB0aGlzLmxhbmd1YWdlc1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBzaG93QnV0dG9uczogZmFsc2UsXHJcbiAgICAgICAgICAgIHJlc2l6YWJsZTogZmFsc2VcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBjb25zdCBuZXdTY2hlbWVEbGcgPSB0aGlzLm1vZGFsU2VyLnNob3coTmV3U2NoZW1lQ29tcG9uZW50LCBtb2RhbE9wdHMpO1xyXG4gICAgICAgIGNvbnN0IGluc3RhbmNlID0gbmV3U2NoZW1lRGxnLmNvbnRlbnQgYXMgTmV3U2NoZW1lQ29tcG9uZW50O1xyXG4gICAgICAgIGluc3RhbmNlLmNsb3NlTW9kYWwuc3Vic2NyaWJlKCAoKSA9PiB7XHJcbiAgICAgICAgICAgIG5ld1NjaGVtZURsZy5jbG9zZSgpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpbnN0YW5jZS5zdWJtaXRNb2RhbC5waXBlKFxyXG4gICAgICAgICAgICBzd2l0Y2hNYXAoKHQ6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlTmV3U2NoZW1lKGdyaWRJbnN0YW5jZS5pZCwgdCk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgKS5zdWJzY3JpYmUoKHQ6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAodC5mbGFnID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbXNnID0gdC5tc2cgfHwgJ+ivt+i+k+WFpeaWueahiOWQjeensCc7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5ub3RpZnlTZXJ2aWNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ub3RpZnlTZXJ2aWNlLmluZm8obXNnKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tZXNzYWdlci5pbmZvKG1zZyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8g5pu05paw5pa55qGI5YiX6KGoXHJcbiAgICAgICAgICAgIGNvbnN0IHNjaGVtZUxpc3QgPSB0aGlzLnNjaGVtZVNlcnZpY2UuZ2V0U3RhdGVWYWx1ZShncmlkSW5zdGFuY2UuaWQsICdsaXN0JykgfHwgW107XHJcbiAgICAgICAgICAgIGlmICh0LmlzRGVmYXVsdCkge1xyXG4gICAgICAgICAgICAgICAgc2NoZW1lTGlzdC5mb3JFYWNoKG4gPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIG4uaXNEZWZhdWx0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzY2hlbWVMaXN0LnB1c2godCk7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0QWN0aXZlU2NoZW1lSXRlbShncmlkSW5zdGFuY2UuaWQsIHQpO1xyXG4gICAgICAgICAgICB0aGlzLnNjaGVtZVNlcnZpY2Uuc2V0U2NoZW1lTGlzdChncmlkSW5zdGFuY2UuaWQsIHNjaGVtZUxpc3QpO1xyXG4gICAgICAgICAgICBuZXdTY2hlbWVEbGcuY2xvc2UoKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaW5zdGFuY2UuY2hlY2tBdXRob3JpdHkucGlwZShcclxuICAgICAgICAgICAgc3dpdGNoTWFwKCh0OiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNjaGVtZVNlcnZpY2UuY2hlY2tBdXRob3JpdHkoKS5waXBlKFxyXG4gICAgICAgICAgICAgICAgICAgIG1hcCgoYXV0aDogU2NoZW1lQXV0aE1vZGVsKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiB0LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLi4uYXV0aFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICApLnN1YnNjcmliZSgodDogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIGxldCBoYXNBdXRob3JpdHkgPSB7IHB1YmxpYzogdHJ1ZSwgb3JnOiB0cnVlIH07XHJcbiAgICAgICAgICAgIGxldCBtc2cgPSAn5oKo5rKh5pyJ5bCG5pa55qGI55qE5L2/55So6IyD5Zu06K6+572u5Li65YWs5YWx55qE5p2D6ZmQ44CCJztcclxuICAgICAgICAgICAgaWYgKHQudHlwZS52YWx1ZSA9PT0gJ29yZycpIHtcclxuICAgICAgICAgICAgICAgIG1zZyA9ICfmgqjmsqHmnInlsIbmlrnmoYjnmoTkvb/nlKjojIPlm7Torr7nva7kuLrnu4Tnu4fnmoTmnYPpmZDjgIInO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0LnN1Y2Nlc3MpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGhhc1B1YmxpY0F1dGhvcml0eSA9IHQuYXV0aE9wZXJhdGlvbkRhdGEgJiYgdC5hdXRoT3BlcmF0aW9uRGF0YS5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICBoYXNBdXRob3JpdHkucHVibGljID0gaGFzUHVibGljQXV0aG9yaXR5O1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaGFzT3JnQXV0aG9yaXR5ID0gdC5hdXRoT3JnYW5pemF0aW9uRGF0YSAmJiB0LmF1dGhPcmdhbml6YXRpb25EYXRhLmxlbmd0aDtcclxuICAgICAgICAgICAgICAgIGhhc0F1dGhvcml0eS5vcmcgPSBoYXNPcmdBdXRob3JpdHk7XHJcbiAgICAgICAgICAgICAgICBpZiAodC50eXBlLnZhbHVlID09PSAncHVibGljJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGluc3RhbmNlLnNjaGVtZUluZm8udHlwZSA9IHQudHlwZS52YWx1ZTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodC50eXBlLnZhbHVlID09PSAnb3JnJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghaGFzT3JnQXV0aG9yaXR5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubm90aWZ5U2VydmljZS53YXJuaW5nKG1zZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfWVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZS5zY2hlbWVJbmZvLnR5cGUgPSB0LnR5cGUudmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGluc3RhbmNlLnNjaGVtZUluZm8ub3JnaWRzID0gdC5hdXRoT3JnYW5pemF0aW9uRGF0YS5qb2luKCcsJylcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2UuZGF0YVBlcm1pc3Npb25JZHMgPSB0LmF1dGhPcmdhbml6YXRpb25EYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubm90aWZ5U2VydmljZS53YXJuaW5nKG1zZyk7XHJcbiAgICAgICAgICAgICAgICBoYXNBdXRob3JpdHkgPSB7IHB1YmxpYzogZmFsc2UsIG9yZzogZmFsc2UgfTs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaW5zdGFuY2UucmVmcmVzaChoYXNBdXRob3JpdHkpO1xyXG4gICAgICAgIH0pXHJcblxyXG4gICAgICAgIGNvbnN0IG1vZGFsQ29udGFpbmVyID0gbmV3U2NoZW1lRGxnLmRpYWxvZy5pbnN0YW5jZSBhcyBNb2RhbENvbnRhaW5lckNvbXBvbmVudDtcclxuICAgICAgICBtb2RhbENvbnRhaW5lci5kcmFnZ2Jhci5oYW5kbGUgPSBpbnN0YW5jZS5oZWFkZXIubmF0aXZlRWxlbWVudDtcclxuICAgIH1cclxuXHJcbiAgICBnZXRTY2hlbWVMaXN0KGdyaWRJZDogc3RyaW5nKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc2NoZW1lU2VydmljZS5nZXRTY2hlbWVMaXN0KGdyaWRJZCk7XHJcbiAgICB9XHJcblxyXG4gICAgY3JlYXRlTmV3U2NoZW1lKGdyaWRJZDogc3RyaW5nLCBkYXRhOiBhbnkpIHtcclxuICAgICAgICBpZighZGF0YS5uYW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBvZih7ZmxhZzogZmFsc2UsIG1zZzogJ+ivt+i+k+WFpeaWueahiOWQjeensCd9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zdCBoYXNOYW1lID0gdGhpcy5zY2hlbWVTZXJ2aWNlLmhhc1NjaGVtZU5hbWUoZ3JpZElkLCBkYXRhLm5hbWUpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBoYXNOYW1lID09PSAnYm9vbGVhbicgJiYgaGFzTmFtZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG9mKHtmbGFnOiBmYWxzZSwgbXNnOiAn5pa55qGI5ZCN56ew5bey5a2Y5Zyo77yM6K+35L+u5pS544CCJ30pO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoaGFzTmFtZSkgJiYgaGFzTmFtZS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG1zZ3MgPSAgaGFzTmFtZS5tYXAobiA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG4gPT09ICd6aC1DSFMnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAn566A5L2T5Lit5paH5ZCN56ew5bey5a2Y5Zyo44CCJztcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYobiA9PT0gJ3poLUNIVCcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICfnuYHkvZPkuK3mloflkI3np7Dlt7LlrZjlnKjjgIInO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAn6Iux5paH5ZCN56ew5bey5a2Y5Zyo44CCJztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gb2Yoe2ZsYWc6IGZhbHNlLCBtc2c6IG1zZ3Muam9pbignJyl9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgcmVxdWlyZWROYW1lID0gW107XHJcbiAgICAgICAgdGhpcy5sYW5ndWFnZXMuZm9yRWFjaChuID0+IHtcclxuICAgICAgICAgICAgaWYgKGRhdGEubmFtZVtuLmNvZGVdID09PSAnJyB8fCBkYXRhLm5hbWVbbi5jb2RlXSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICByZXF1aXJlZE5hbWUucHVzaChuLmNvZGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGlmIChyZXF1aXJlZE5hbWUubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1zZ3MgPSAgcmVxdWlyZWROYW1lLm1hcChuID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChuID09PSAnemgtQ0hTJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAn6K+36L6T5YWl566A5L2T5Lit5paH5ZCN56ew44CCJztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZihuID09PSAnemgtQ0hUJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAn6K+36L6T5YWl57mB5L2T5Lit5paH5ZCN56ew44CCJztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICfor7fovpPlhaXoi7HmloflkI3np7DjgIInO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIG9mKHtmbGFnOiBmYWxzZSwgbXNnOiBtc2dzLmpvaW4oJycpfSk7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgaWYgKGRhdGEudHlwZSAmJiBkYXRhLnR5cGUgPT09ICdvcmcnICYmICghZGF0YS5vcmdpZHMgfHwgIWRhdGEub3JnaWRzLmxlbmd0aCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG9mKHtmbGFnOiBmYWxzZSwgbXNnOiAn6K+36YCJ5oup57uE57uHJ30pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgX2NvbmZpZyA9IG51bGw7XHJcbiAgICAgICAgY29uc3Qgc2VsZWN0ZWRTZXR0aW5ncyA9IHRoaXMuZ2V0Q3VycmVudFNjaGVtZVNldHRpbmdzKGdyaWRJZCk7XHJcbiAgICAgICAgaWYgKHNlbGVjdGVkU2V0dGluZ3MpIHtcclxuICAgICAgICAgICAgX2NvbmZpZyA9IHNlbGVjdGVkU2V0dGluZ3M7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8g5pS26ZuG5b2T5YmN5pa55qGI6YWN572u5pWw5o2uXHJcbiAgICAgICAgICAgIF9jb25maWcgPSB0aGlzLmJ1aWxkU3VibWl0RGF0YShncmlkSWQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgbmV3SWQgPSB0aGlzLmlkU2VydmljZS5ndWlkKCk7XHJcbiAgICAgICAgbGV0IGlzRGVmYXVsdCA9IGRhdGEuaXNEZWZhdWx0O1xyXG4gICAgICAgIGlmIChpc0RlZmF1bHQpIHtcclxuICAgICAgICAgICAgaWYgKGRhdGEudHlwZSAhPT0gJ3ByaXZhdGUnKSB7XHJcbiAgICAgICAgICAgICAgICBpc0RlZmF1bHQgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGRhdGEubmFtZSAmJiB0eXBlb2YgZGF0YS5uYW1lID09PSAnb2JqZWN0Jykge1xyXG4gICAgICAgICAgICBkYXRhLm5hbWUgPSBKU09OLnN0cmluZ2lmeShkYXRhLm5hbWUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3Qgc2NoZW1lOiBEYXRhZ3JpZFNjaGVtZU1vZGVsID0ge1xyXG4gICAgICAgICAgICBpZDogbmV3SWQsXHJcbiAgICAgICAgICAgIGJlbG9uZ0lkOiAnJyxcclxuICAgICAgICAgICAgY29kZTogJycsXHJcbiAgICAgICAgICAgIG5hbWU6IGRhdGEubmFtZSxcclxuICAgICAgICAgICAgdHlwZTogZGF0YS50eXBlLFxyXG4gICAgICAgICAgICBpc0RlZmF1bHQ6IGlzRGVmYXVsdCxcclxuICAgICAgICAgICAgaXNTeXN0ZW06IGZhbHNlLFxyXG4gICAgICAgICAgICBleHRlbmRJZDogJ2RhdGFncmlkLXNldHRpbmdzLXNjaGVtZScsXHJcbiAgICAgICAgICAgIGV4dGVuZEluZm86IHRoaXMuYnVpbGRPcmdBbmRTY2hlbWVSZWxhdGlvbnMobmV3SWQsIGRhdGEub3JnaWRzKSxcclxuICAgICAgICAgICAgcXVlcnlDb25kaXRpb25TdHJpbmc6IF9jb25maWc/IEpTT04uc3RyaW5naWZ5KF9jb25maWcpOiAnJyxcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5zY2hlbWVTZXJ2aWNlLnNhdmVTY2hlbWUoc2NoZW1lLCBncmlkSWQpLnBpcGUoXHJcbiAgICAgICAgICAgIG1hcCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gc2NoZW1lO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0U2NoZW1lTGlzdChzY2hlbWVMaXN0OiBEYXRhZ3JpZFNjaGVtZU1vZGVsW10sIGdyaWRJZDogc3RyaW5nKSB7XHJcbiAgICAgICAgdGhpcy5zY2hlbWVTZXJ2aWNlLnVwZGF0ZSh7bGlzdDogc2NoZW1lTGlzdH0sIGdyaWRJZCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBidWlsZE9yZ0FuZFNjaGVtZVJlbGF0aW9ucyhzY2hlbWVJZDogc3RyaW5nLCBvcmdJZHM6IHN0cmluZ1tdKSB7XHJcbiAgICAgICAgaWYgKCFvcmdJZHMgfHwgIW9yZ0lkcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgcmV0dXJuICBbXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG9yZ0lkcy5tYXAobiA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICBpZDogdGhpcy5pZFNlcnZpY2UuZ3VpZCgpLFxyXG4gICAgICAgICAgICAgICAgb3JnSWQ6IG4sXHJcbiAgICAgICAgICAgICAgICByZWxhdGVkSWQ6IHNjaGVtZUlkXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldEN1cnJlbnRTY2hlbWVTZXR0aW5ncyhncmlkSWQ6IHN0cmluZyk6IFNldHRpbmdNb2RlbCB7XHJcbiAgICAgICAgY29uc3QgYWN0aXZlU2NoZW1lID0gdGhpcy5nZXRBY3RpdmVTY2hlbWVJdGVtKGdyaWRJZCkgYXMgRGF0YWdyaWRTY2hlbWVNb2RlbDtcclxuICAgICAgICBpZiAoYWN0aXZlU2NoZW1lICYmIGFjdGl2ZVNjaGVtZS5xdWVyeUNvbmRpdGlvblN0cmluZykge1xyXG4gICAgICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShhY3RpdmVTY2hlbWUucXVlcnlDb25kaXRpb25TdHJpbmcpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxufVxyXG4iXX0=