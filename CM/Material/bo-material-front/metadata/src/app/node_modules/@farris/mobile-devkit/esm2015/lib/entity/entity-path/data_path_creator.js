import { DataTypeInfo, DataPropGroup } from '../entity-type-info/index';
import { DataPathNodeType } from './data_path_node';
import { DataPath } from './data_path';
/**
 * 数据Path工厂类
 */
class DataPathCreator {
    /**
     * 将长路径数组或字符串转换为
     * @param fullPathArrayOrString 路径数组或字符串
     * @param repository 实体仓库
     * @summary
     * 1、长路径格式说明参考：data-path.md
     */
    static createByLongPathFromRoot(fullPathArrayOrString, entityManager) {
        const dataPath = new DataPath();
        const fullPathArray = fullPathArrayOrString;
        if (!fullPathArray || fullPathArray.length === 0) {
            return dataPath;
        }
        let currentNodeInfo = {
            nodeValue: fullPathArray.shift(),
            nodeType: DataPathNodeType.DataId,
            entityTypeInfo: new DataTypeInfo(entityManager.entityType)
        };
        while (currentNodeInfo) {
            dataPath.push(currentNodeInfo.nodeType, currentNodeInfo.nodeValue);
            // 处理下一个节点
            const nextNodeValue = fullPathArray.shift();
            if (!nextNodeValue || !currentNodeInfo.entityTypeInfo) {
                break;
            }
            currentNodeInfo = this.getNextPathNodeInfo(currentNodeInfo, nextNodeValue);
        }
        return dataPath;
    }
    /**
     * 获取下一个路径节点的信息
     * @param parentNodeInfo 当前路径节点信息
     * @param nextNodeValue 下一个路径节点的值
     * @summary
     * 1、这个递归写的很绕，说明数据结构设计不合理；
     * 2、多个因素混用了一个结构；
     */
    static getNextPathNodeInfo(parentNodeInfo, nextNodeValue) {
        const parentNodeValue = parentNodeInfo.nodeValue;
        const parentNodeType = parentNodeInfo.nodeType;
        const parentEntityTypeInfo = parentNodeInfo.entityTypeInfo;
        if (!nextNodeValue || !parentEntityTypeInfo) {
            return null;
        }
        const nextPathNodeInfo = {
            nodeValue: nextNodeValue,
            nodeType: null,
            entityTypeInfo: null
        };
        // DataNodeType=List：下一节点肯定是Object，并且EntityTypeInfo不变
        if (parentNodeType === DataPathNodeType.DataId) {
            nextPathNodeInfo.nodeType = DataPathNodeType.PropName;
            nextPathNodeInfo.entityTypeInfo = parentEntityTypeInfo;
        }
        else {
            // DataNodeType=Object：必然对应一个属性信息
            const nextPropInfo = parentEntityTypeInfo.getPropInfoByName(parentNodeValue);
            if (nextPropInfo.group === DataPropGroup.List) {
                // EntityPropGroup=EntityList：下一个节点是List类型。
                nextPathNodeInfo.nodeType = DataPathNodeType.DataId;
                nextPathNodeInfo.entityTypeInfo = nextPropInfo.typeInfo;
            }
            else {
                // EntityPropGroup=Entity：       下级entityTypeInfo为
                // EntityPropGroup=Dynamic|Plain：null
                nextPathNodeInfo.nodeType = DataPathNodeType.PropName;
                nextPathNodeInfo.entityTypeInfo = nextPropInfo.group === DataPropGroup.Object ? nextPropInfo.typeInfo : null;
            }
        }
        return nextPathNodeInfo;
    }
    /**
     * @param fullPathArrayOrString 路径数组或字符串
     * @param repository 实体仓库
     * @summary
     * 1、长路径格式说明参考：data-path.md
     * 2、shortPathArrayOrString暂时只支持字符串数组
     */
    static createByShortPathFromRoot(shortPathArrayOrString, entityManager, bindingData) {
        const dataPath = new DataPath();
        const shortPathArray = shortPathArrayOrString;
        // 根节点
        let currentBindingObject = bindingData.list.currentItem;
        let currentEntityTypeInfo = new DataTypeInfo(entityManager.entityType);
        dataPath.push(DataPathNodeType.DataId, currentBindingObject.primaryKeyValue);
        // 遍历下级节点
        shortPathArray.forEach((propName) => {
            const propInfo = currentEntityTypeInfo.getPropInfoByName(propName);
            switch (propInfo.group) {
                case DataPropGroup.Primitive:
                    dataPath.push(DataPathNodeType.PropName, propName);
                    break;
                case DataPropGroup.Object:
                    currentBindingObject = currentBindingObject[propName];
                    currentEntityTypeInfo = propInfo.typeInfo;
                    dataPath.push(DataPathNodeType.PropName, propName);
                    break;
                case DataPropGroup.List:
                    const currentBindingList = currentBindingObject[propName];
                    currentBindingObject = currentBindingList.currentItem;
                    currentEntityTypeInfo = propInfo.typeInfo;
                    dataPath.push(DataPathNodeType.PropName, propName);
                    dataPath.push(DataPathNodeType.DataId, currentBindingObject.primaryKeyValue);
                    break;
                default:
                    break;
            }
        });
        return dataPath;
    }
}
export { DataPathCreator };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YV9wYXRoX2NyZWF0b3IuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL21vYmlsZS1kZXZraXQvIiwic291cmNlcyI6WyJsaWIvZW50aXR5L2VudGl0eS1wYXRoL2RhdGFfcGF0aF9jcmVhdG9yLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxZQUFZLEVBQUUsYUFBYSxFQUFHLE1BQU0sMkJBQTJCLENBQUM7QUFJekUsT0FBTyxFQUFnQixnQkFBZ0IsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQ2xFLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFFdkM7O0dBRUc7QUFDSCxNQUFNLGVBQWU7SUFFbkI7Ozs7OztPQU1HO0lBQ0ksTUFBTSxDQUFDLHdCQUF3QixDQUFDLHFCQUF3QyxFQUFFLGFBQW9DO1FBQ25ILE1BQU0sUUFBUSxHQUFHLElBQUksUUFBUSxFQUFFLENBQUM7UUFDaEMsTUFBTSxhQUFhLEdBQUcscUJBQWlDLENBQUM7UUFDeEQsSUFBSSxDQUFDLGFBQWEsSUFBSSxhQUFhLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtZQUNoRCxPQUFPLFFBQVEsQ0FBQztTQUNqQjtRQUVELElBQUksZUFBZSxHQUFHO1lBQ3BCLFNBQVMsRUFBRSxhQUFhLENBQUMsS0FBSyxFQUFFO1lBQ2hDLFFBQVEsRUFBRSxnQkFBZ0IsQ0FBQyxNQUFNO1lBQ2pDLGNBQWMsRUFBRSxJQUFJLFlBQVksQ0FBQyxhQUFhLENBQUMsVUFBVSxDQUFDO1NBQzNELENBQUM7UUFDRixPQUFPLGVBQWUsRUFBRTtZQUN0QixRQUFRLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxRQUFRLEVBQUUsZUFBZSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBRW5FLFVBQVU7WUFDVixNQUFNLGFBQWEsR0FBRyxhQUFhLENBQUMsS0FBSyxFQUFFLENBQUM7WUFDNUMsSUFBSSxDQUFDLGFBQWEsSUFBSSxDQUFDLGVBQWUsQ0FBQyxjQUFjLEVBQUU7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UUFBUSxDQUFDLFFBQVEsQ0FBQztvQkFDMUMsUUFBUSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxRQUFRLEVBQUUsUUFBUSxDQUFDLENBQUM7b0JBRW5ELE1BQU07Z0JBQ1IsS0FBSyxhQUFhLENBQUMsSUFBSTtvQkFDckIsTUFBTSxrQkFBa0IsR0FBRyxvQkFBb0IsQ0FBQyxRQUFRLENBQUMsQ0FBQztvQkFDMUQsb0JBQW9CLEdBQUcsa0JBQWtCLENBQUMsV0FBVyxDQUFDO29CQUN0RCxxQkFBcUIsR0FBRyxRQUFRLENBQUMsUUFBUSxDQUFDO29CQUUxQyxRQUFRLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLFFBQVEsRUFBRSxRQUFRLENBQUMsQ0FBQztvQkFDbkQsUUFBUSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLEVBQUUsb0JBQW9CLENBQUMsZUFBZSxDQUFDLENBQUM7b0JBQzdFLE1BQU07Z0JBQ1I7b0JBQ0ksTUFBTTthQUNYO1FBQ0gsQ0FBQyxDQUFDLENBQUM7UUFFSCxPQUFPLFFBQVEsQ0FBQztJQUNsQixDQUFDO0NBRUY7QUFFRCxPQUFPLEVBQUUsZUFBZSxFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJcclxuaW1wb3J0IHsgRGF0YVR5cGVJbmZvLCBEYXRhUHJvcEdyb3VwICB9IGZyb20gJy4uL2VudGl0eS10eXBlLWluZm8vaW5kZXgnO1xyXG5pbXBvcnQgeyBFbnRpdHkgIH0gZnJvbSAnLi4vaW5kZXgnO1xyXG5pbXBvcnQgeyBSZXBvc2l0b3J5LCBFbnRpdHlNYW5hZ2VyIH0gZnJvbSAnLi4vLi4vcmVwb3NpdG9yeS9pbmRleCc7XHJcbmltcG9ydCB7IEJpbmRpbmdEYXRhIH0gZnJvbSAnLi4vLi4vYmluZGluZy1kYXRhL2luZGV4JztcclxuaW1wb3J0IHsgRGF0YVBhdGhOb2RlLCBEYXRhUGF0aE5vZGVUeXBlIH0gZnJvbSAnLi9kYXRhX3BhdGhfbm9kZSc7XHJcbmltcG9ydCB7IERhdGFQYXRoIH0gZnJvbSAnLi9kYXRhX3BhdGgnO1xyXG5cclxuLyoqXHJcbiAqIOaVsOaNrlBhdGjlt6XljoLnsbtcclxuICovXHJcbmNsYXNzIERhdGFQYXRoQ3JlYXRvciB7XHJcblxyXG4gIC8qKlxyXG4gICAqIOWwhumVv+i3r+W+hOaVsOe7hOaIluWtl+espuS4sui9rOaNouS4ulxyXG4gICAqIEBwYXJhbSBmdWxsUGF0aEFycmF5T3JTdHJpbmcg6Lev5b6E5pWw57uE5oiW5a2X56ym5LiyXHJcbiAgICogQHBhcmFtIHJlcG9zaXRvcnkg5a6e5L2T5LuT5bqTXHJcbiAgICogQHN1bW1hcnlcclxuICAgKiAx44CB6ZW/6Lev5b6E5qC85byP6K+05piO5Y+C6ICD77yaZGF0YS1wYXRoLm1kXHJcbiAgICovXHJcbiAgcHVibGljIHN0YXRpYyBjcmVhdGVCeUxvbmdQYXRoRnJvbVJvb3QoZnVsbFBhdGhBcnJheU9yU3RyaW5nOiBzdHJpbmdbXSB8IHN0cmluZywgZW50aXR5TWFuYWdlcjogRW50aXR5TWFuYWdlcjxFbnRpdHk+KTogRGF0YVBhdGgge1xyXG4gICAgY29uc3QgZGF0YVBhdGggPSBuZXcgRGF0YVBhdGgoKTtcclxuICAgIGNvbnN0IGZ1bGxQYXRoQXJyYXkgPSBmdWxsUGF0aEFycmF5T3JTdHJpbmcgYXMgc3RyaW5nW107XHJcbiAgICBpZiAoIWZ1bGxQYXRoQXJyYXkgfHwgZnVsbFBhdGhBcnJheS5sZW5ndGggPT09IDApIHtcclxuICAgICAgcmV0dXJuIGRhdGFQYXRoO1xyXG4gICAgfVxyXG5cclxuICAgIGxldCBjdXJyZW50Tm9kZUluZm8gPSB7XHJcbiAgICAgIG5vZGVWYWx1ZTogZnVsbFBhdGhBcnJheS5zaGlmdCgpLFxyXG4gICAgICBub2RlVHlwZTogRGF0YVBhdGhOb2RlVHlwZS5EYXRhSWQsXHJcbiAgICAgIGVudGl0eVR5cGVJbmZvOiBuZXcgRGF0YVR5cGVJbmZvKGVudGl0eU1hbmFnZXIuZW50aXR5VHlwZSlcclxuICAgIH07XHJcbiAgICB3aGlsZSAoY3VycmVudE5vZGVJbmZvKSB7XHJcbiAgICAgIGRhdGFQYXRoLnB1c2goY3VycmVudE5vZGVJbmZvLm5vZGVUeXBlLCBjdXJyZW50Tm9kZUluZm8ubm9kZVZhbHVlKTtcclxuXHJcbiAgICAgIC8vIOWkhOeQhuS4i+S4gOS4quiKgueCuVxyXG4gICAgICBjb25zdCBuZXh0Tm9kZVZhbHVlID0gZnVsbFBhdGhBcnJheS5zaGlmdCgpO1xyXG4gICAgICBpZiAoIW5leHROb2RlVmFsdWUgfHwgIWN1cnJlbnROb2RlSW5mby5lbnRpdHlUeXBlSW5mbykge1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICAgIGN1cnJlbnROb2RlSW5mbyA9IHRoaXMuZ2V0TmV4dFBhdGhOb2RlSW5mbyhjdXJyZW50Tm9kZUluZm8sIG5leHROb2RlVmFsdWUpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBkYXRhUGF0aDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluS4i+S4gOS4qui3r+W+hOiKgueCueeahOS/oeaBr1xyXG4gICAqIEBwYXJhbSBwYXJlbnROb2RlSW5mbyDlvZPliY3ot6/lvoToioLngrnkv6Hmga9cclxuICAgKiBAcGFyYW0gbmV4dE5vZGVWYWx1ZSDkuIvkuIDkuKrot6/lvoToioLngrnnmoTlgLxcclxuICAgKiBAc3VtbWFyeVxyXG4gICAqIDHjgIHov5nkuKrpgJLlvZLlhpnnmoTlvojnu5XvvIzor7TmmI7mlbDmja7nu5PmnoTorr7orqHkuI3lkIjnkIbvvJtcclxuICAgKiAy44CB5aSa5Liq5Zug57Sg5re355So5LqG5LiA5Liq57uT5p6E77ybXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzdGF0aWMgZ2V0TmV4dFBhdGhOb2RlSW5mbyhwYXJlbnROb2RlSW5mbzogYW55LCBuZXh0Tm9kZVZhbHVlOiBzdHJpbmcpOiBhbnkge1xyXG5cclxuICAgIGNvbnN0IHBhcmVudE5vZGVWYWx1ZSA9IHBhcmVudE5vZGVJbmZvLm5vZGVWYWx1ZTtcclxuICAgIGNvbnN0IHBhcmVudE5vZGVUeXBlID0gcGFyZW50Tm9kZUluZm8ubm9kZVR5cGU7XHJcbiAgICBjb25zdCBwYXJlbnRFbnRpdHlUeXBlSW5mbyA9IHBhcmVudE5vZGVJbmZvLmVudGl0eVR5cGVJbmZvO1xyXG5cclxuICAgIGlmICghbmV4dE5vZGVWYWx1ZSB8fCAhcGFyZW50RW50aXR5VHlwZUluZm8pIHtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgbmV4dFBhdGhOb2RlSW5mbyA9IHtcclxuICAgICAgbm9kZVZhbHVlOiBuZXh0Tm9kZVZhbHVlLFxyXG4gICAgICBub2RlVHlwZTogbnVsbCxcclxuICAgICAgZW50aXR5VHlwZUluZm86IG51bGxcclxuICAgIH07XHJcblxyXG5cclxuICAgIC8vIERhdGFOb2RlVHlwZT1MaXN077ya5LiL5LiA6IqC54K56IKv5a6a5pivT2JqZWN077yM5bm25LiURW50aXR5VHlwZUluZm/kuI3lj5hcclxuICAgIGlmIChwYXJlbnROb2RlVHlwZSA9PT0gRGF0YVBhdGhOb2RlVHlwZS5EYXRhSWQpIHtcclxuICAgICAgbmV4dFBhdGhOb2RlSW5mby5ub2RlVHlwZSA9IERhdGFQYXRoTm9kZVR5cGUuUHJvcE5hbWU7XHJcbiAgICAgIG5leHRQYXRoTm9kZUluZm8uZW50aXR5VHlwZUluZm8gPSBwYXJlbnRFbnRpdHlUeXBlSW5mbztcclxuICAgIH0gZWxzZSB7XHJcblxyXG4gICAgICAvLyBEYXRhTm9kZVR5cGU9T2JqZWN077ya5b+F54S25a+55bqU5LiA5Liq5bGe5oCn5L+h5oGvXHJcbiAgICAgIGNvbnN0IG5leHRQcm9wSW5mbyA9IHBhcmVudEVudGl0eVR5cGVJbmZvLmdldFByb3BJbmZvQnlOYW1lKHBhcmVudE5vZGVWYWx1ZSk7XHJcbiAgICAgIGlmIChuZXh0UHJvcEluZm8uZ3JvdXAgPT09IERhdGFQcm9wR3JvdXAuTGlzdCkge1xyXG5cclxuICAgICAgICAvLyBFbnRpdHlQcm9wR3JvdXA9RW50aXR5TGlzdO+8muS4i+S4gOS4quiKgueCueaYr0xpc3TnsbvlnovjgIJcclxuICAgICAgICBuZXh0UGF0aE5vZGVJbmZvLm5vZGVUeXBlID0gRGF0YVBhdGhOb2RlVHlwZS5EYXRhSWQ7XHJcbiAgICAgICAgbmV4dFBhdGhOb2RlSW5mby5lbnRpdHlUeXBlSW5mbyA9IG5leHRQcm9wSW5mby50eXBlSW5mbztcclxuICAgICAgfSBlbHNlIHtcclxuXHJcbiAgICAgICAgLy8gRW50aXR5UHJvcEdyb3VwPUVudGl0ee+8miAgICAgICDkuIvnuqdlbnRpdHlUeXBlSW5mb+S4ulxyXG4gICAgICAgIC8vIEVudGl0eVByb3BHcm91cD1EeW5hbWljfFBsYWlu77yabnVsbFxyXG4gICAgICAgIG5leHRQYXRoTm9kZUluZm8ubm9kZVR5cGUgPSBEYXRhUGF0aE5vZGVUeXBlLlByb3BOYW1lO1xyXG4gICAgICAgIG5leHRQYXRoTm9kZUluZm8uZW50aXR5VHlwZUluZm8gPSBuZXh0UHJvcEluZm8uZ3JvdXAgPT09IERhdGFQcm9wR3JvdXAuT2JqZWN0ID8gbmV4dFByb3BJbmZvLnR5cGVJbmZvIDogbnVsbDtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBuZXh0UGF0aE5vZGVJbmZvO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIGZ1bGxQYXRoQXJyYXlPclN0cmluZyDot6/lvoTmlbDnu4TmiJblrZfnrKbkuLJcclxuICAgKiBAcGFyYW0gcmVwb3NpdG9yeSDlrp7kvZPku5PlupNcclxuICAgKiBAc3VtbWFyeVxyXG4gICAqIDHjgIHplb/ot6/lvoTmoLzlvI/or7TmmI7lj4LogIPvvJpkYXRhLXBhdGgubWRcclxuICAgKiAy44CBc2hvcnRQYXRoQXJyYXlPclN0cmluZ+aaguaXtuWPquaUr+aMgeWtl+espuS4suaVsOe7hFxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGF0aWMgY3JlYXRlQnlTaG9ydFBhdGhGcm9tUm9vdChcclxuICAgIHNob3J0UGF0aEFycmF5T3JTdHJpbmc6IHN0cmluZ1tdIHwgc3RyaW5nLCBlbnRpdHlNYW5hZ2VyOiBFbnRpdHlNYW5hZ2VyPEVudGl0eT4sIGJpbmRpbmdEYXRhOiBCaW5kaW5nRGF0YVxyXG4gICk6IERhdGFQYXRoIHtcclxuXHJcbiAgICBjb25zdCBkYXRhUGF0aCA9IG5ldyBEYXRhUGF0aCgpO1xyXG4gICAgY29uc3Qgc2hvcnRQYXRoQXJyYXk6IHN0cmluZ1tdID0gc2hvcnRQYXRoQXJyYXlPclN0cmluZyBhcyBzdHJpbmdbXTtcclxuXHJcbiAgICAvLyDmoLnoioLngrlcclxuICAgIGxldCBjdXJyZW50QmluZGluZ09iamVjdCA9IGJpbmRpbmdEYXRhLmxpc3QuY3VycmVudEl0ZW07XHJcbiAgICBsZXQgY3VycmVudEVudGl0eVR5cGVJbmZvID0gbmV3IERhdGFUeXBlSW5mbyhlbnRpdHlNYW5hZ2VyLmVudGl0eVR5cGUpO1xyXG4gICAgZGF0YVBhdGgucHVzaChEYXRhUGF0aE5vZGVUeXBlLkRhdGFJZCwgY3VycmVudEJpbmRpbmdPYmplY3QucHJpbWFyeUtleVZhbHVlKTtcclxuXHJcbiAgICAvLyDpgY3ljobkuIvnuqfoioLngrlcclxuICAgIHNob3J0UGF0aEFycmF5LmZvckVhY2goKHByb3BOYW1lOiBzdHJpbmcpID0+IHtcclxuICAgICAgY29uc3QgcHJvcEluZm8gPSBjdXJyZW50RW50aXR5VHlwZUluZm8uZ2V0UHJvcEluZm9CeU5hbWUocHJvcE5hbWUpO1xyXG4gICAgICBzd2l0Y2ggKHByb3BJbmZvLmdyb3VwKSB7XHJcbiAgICAgICAgY2FzZSBEYXRhUHJvcEdyb3VwLlByaW1pdGl2ZTpcclxuICAgICAgICAgIGRhdGFQYXRoLnB1c2goRGF0YVBhdGhOb2RlVHlwZS5Qcm9wTmFtZSwgcHJvcE5hbWUpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBEYXRhUHJvcEdyb3VwLk9iamVjdDpcclxuICAgICAgICAgIGN1cnJlbnRCaW5kaW5nT2JqZWN0ID0gY3VycmVudEJpbmRpbmdPYmplY3RbcHJvcE5hbWVdO1xyXG4gICAgICAgICAgY3VycmVudEVudGl0eVR5cGVJbmZvID0gcHJvcEluZm8udHlwZUluZm87XHJcbiAgICAgICAgICBkYXRhUGF0aC5wdXNoKERhdGFQYXRoTm9kZVR5cGUuUHJvcE5hbWUsIHByb3BOYW1lKTtcclxuXHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIERhdGFQcm9wR3JvdXAuTGlzdDpcclxuICAgICAgICAgIGNvbnN0IGN1cnJlbnRCaW5kaW5nTGlzdCA9IGN1cnJlbnRCaW5kaW5nT2JqZWN0W3Byb3BOYW1lXTtcclxuICAgICAgICAgIGN1cnJlbnRCaW5kaW5nT2JqZWN0ID0gY3VycmVudEJpbmRpbmdMaXN0LmN1cnJlbnRJdGVtO1xyXG4gICAgICAgICAgY3VycmVudEVudGl0eVR5cGVJbmZvID0gcHJvcEluZm8udHlwZUluZm87XHJcblxyXG4gICAgICAgICAgZGF0YVBhdGgucHVzaChEYXRhUGF0aE5vZGVUeXBlLlByb3BOYW1lLCBwcm9wTmFtZSk7XHJcbiAgICAgICAgICBkYXRhUGF0aC5wdXNoKERhdGFQYXRoTm9kZVR5cGUuRGF0YUlkLCBjdXJyZW50QmluZGluZ09iamVjdC5wcmltYXJ5S2V5VmFsdWUpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiBkYXRhUGF0aDtcclxuICB9XHJcblxyXG59XHJcblxyXG5leHBvcnQgeyBEYXRhUGF0aENyZWF0b3IgfTtcclxuIl19