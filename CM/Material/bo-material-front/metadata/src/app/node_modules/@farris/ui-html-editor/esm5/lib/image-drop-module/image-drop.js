/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
var ImageDrop = /** @class */ (function () {
    function ImageDrop(quill, options, ngZone) {
        if (options === void 0) { options = {}; }
        this.ngZone = ngZone;
        // save the quill reference
        this.quill = quill;
        // bind handlers to this instance
        this.handleDrop = this.handleDrop.bind(this);
        this.handlePaste = this.handlePaste.bind(this);
        // listen for drop and paste events
        this.quill.root.addEventListener('drop', this.handleDrop, false);
        this.quill.root.addEventListener('paste', this.handlePaste, false);
    }
    /**
     * @param {?} evt
     * @return {?}
     */
    ImageDrop.prototype.handleDrop = /**
     * @param {?} evt
     * @return {?}
     */
    function (evt) {
        evt.preventDefault();
        if (evt.dataTransfer &&
            evt.dataTransfer.files &&
            evt.dataTransfer.files.length) {
            if (document.caretRangeFromPoint) {
                /** @type {?} */
                var selection = document.getSelection();
                /** @type {?} */
                var range = document.caretRangeFromPoint(evt.clientX, evt.clientY);
                if (selection && range) {
                    selection.setBaseAndExtent(range.startContainer, range.startOffset, range.startContainer, range.startOffset);
                }
            }
            this.readFiles(evt.dataTransfer.files, this.insert.bind(this));
        }
    };
    /**
     * @param {?} evt
     * @return {?}
     */
    ImageDrop.prototype.handlePaste = /**
     * @param {?} evt
     * @return {?}
     */
    function (evt) {
        var _this = this;
        if (evt.clipboardData &&
            evt.clipboardData.items &&
            evt.clipboardData.items.length) {
            this.readFiles(evt.clipboardData.items, (/**
             * @param {?} dataUrl
             * @return {?}
             */
            function (dataUrl) {
                /** @type {?} */
                var selection = _this.quill.getSelection();
                if (selection) {
                    // we must be in a browser that supports pasting (like Firefox)
                    // so it has already been placed into the editor
                }
                else {
                    // otherwise we wait until after the paste when this.quill.getSelection()
                    // will return a valid index
                    _this.ngZone.runOutsideAngular((/**
                     * @return {?}
                     */
                    function () {
                        setTimeout((/**
                         * @return {?}
                         */
                        function () { return _this.insert(dataUrl); }), 0);
                    }));
                }
            }));
        }
    };
    /**
     * @param {?} dataUrl
     * @return {?}
     */
    ImageDrop.prototype.insert = /**
     * @param {?} dataUrl
     * @return {?}
     */
    function (dataUrl) {
        /** @type {?} */
        var index = (this.quill.getSelection() || {}).index || this.quill.getLength();
        this.quill.insertEmbed(index, 'image', dataUrl, 'user');
    };
    /**
     * @param {?} files
     * @param {?} callback
     * @return {?}
     */
    ImageDrop.prototype.readFiles = /**
     * @param {?} files
     * @param {?} callback
     * @return {?}
     */
    function (files, callback) {
        // check each file for an image
        [].forEach.call(files, (/**
         * @param {?} file
         * @return {?}
         */
        function (file) {
            if (!file.type.match(/^image\/(gif|jpe?g|a?png|svg|webp|bmp|vnd\.microsoft\.icon)/i)) {
                // file is not an image
                // Note that some file formats such as psd start with image/* but are not readable
                return;
            }
            // set up file reader
            /** @type {?} */
            var reader = new FileReader();
            reader.onload = (/**
             * @param {?} evt
             * @return {?}
             */
            function (evt) {
                callback(evt.target.result);
            });
            // read the clipboard item or file
            /** @type {?} */
            var blob = file.getAsFile ? file.getAsFile() : file;
            if (blob instanceof Blob) {
                reader.readAsDataURL(blob);
            }
        }));
    };
    return ImageDrop;
}());
export { ImageDrop };
if (false) {
    /** @type {?} */
    ImageDrop.prototype.quill;
    /**
     * @type {?}
     * @private
     */
    ImageDrop.prototype.ngZone;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW1hZ2UtZHJvcC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktaHRtbC1lZGl0b3IvIiwic291cmNlcyI6WyJsaWIvaW1hZ2UtZHJvcC1tb2R1bGUvaW1hZ2UtZHJvcC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQ0E7SUFFSSxtQkFBWSxLQUFLLEVBQUUsT0FBWSxFQUFVLE1BQWM7UUFBcEMsd0JBQUEsRUFBQSxZQUFZO1FBQVUsV0FBTSxHQUFOLE1BQU0sQ0FBUTtRQUNuRCwyQkFBMkI7UUFDM0IsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7UUFDbkIsaUNBQWlDO1FBQ2pDLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDN0MsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMvQyxtQ0FBbUM7UUFDbkMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxVQUFVLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDakUsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxXQUFXLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDdkUsQ0FBQzs7Ozs7SUFFRCw4QkFBVTs7OztJQUFWLFVBQVcsR0FBRztRQUNWLEdBQUcsQ0FBQyxjQUFjLEVBQUUsQ0FBQztRQUNyQixJQUNJLEdBQUcsQ0FBQyxZQUFZO1lBQ2hCLEdBQUcsQ0FBQyxZQUFZLENBQUMsS0FBSztZQUN0QixHQUFHLENBQUMsWUFBWSxDQUFDLEtBQUssQ0FBQyxNQUFNLEVBQy9CO1lBQ0UsSUFBSSxRQUFRLENBQUMsbUJBQW1CLEVBQUU7O29CQUN4QixTQUFTLEdBQUcsUUFBUSxDQUFDLFlBQVksRUFBRTs7b0JBQ25DLEtBQUssR0FBRyxRQUFRLENBQUMsbUJBQW1CLENBQ3RDLEdBQUcsQ0FBQyxPQUFPLEVBQ1gsR0FBRyxDQUFDLE9BQU8sQ0FDZDtnQkFDRCxJQUFJLFNBQVMsSUFBSSxLQUFLLEVBQUU7b0JBQ3BCLFNBQVMsQ0FBQyxnQkFBZ0IsQ0FDdEIsS0FBSyxDQUFDLGNBQWMsRUFDcEIsS0FBSyxDQUFDLFdBQVcsRUFDakIsS0FBSyxDQUFDLGNBQWMsRUFDcEIsS0FBSyxDQUFDLFdBQVcsQ0FDcEIsQ0FBQztpQkFDTDthQUNKO1lBQ0QsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1NBQ2xFO0lBQ0wsQ0FBQzs7Ozs7SUFFRCwrQkFBVzs7OztJQUFYLFVBQVksR0FBRztRQUFmLGlCQW9CQztRQW5CRyxJQUNJLEdBQUcsQ0FBQyxhQUFhO1lBQ2pCLEdBQUcsQ0FBQyxhQUFhLENBQUMsS0FBSztZQUN2QixHQUFHLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxNQUFNLEVBQ2hDO1lBQ0UsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsYUFBYSxDQUFDLEtBQUs7Ozs7WUFBRSxVQUFBLE9BQU87O29CQUNyQyxTQUFTLEdBQUcsS0FBSSxDQUFDLEtBQUssQ0FBQyxZQUFZLEVBQUU7Z0JBQzNDLElBQUksU0FBUyxFQUFFO29CQUNYLCtEQUErRDtvQkFDL0QsZ0RBQWdEO2lCQUNuRDtxQkFBTTtvQkFDSCx5RUFBeUU7b0JBQ3pFLDRCQUE0QjtvQkFDNUIsS0FBSSxDQUFDLE1BQU0sQ0FBQyxpQkFBaUI7OztvQkFBQzt3QkFDMUIsVUFBVTs7O3dCQUFDLGNBQU0sT0FBQSxLQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxFQUFwQixDQUFvQixHQUFFLENBQUMsQ0FBQyxDQUFDO29CQUM5QyxDQUFDLEVBQUMsQ0FBQztpQkFDTjtZQUNMLENBQUMsRUFBQyxDQUFDO1NBQ047SUFDTCxDQUFDOzs7OztJQUVELDBCQUFNOzs7O0lBQU4sVUFBTyxPQUFPOztZQUNKLEtBQUssR0FDUCxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsWUFBWSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsS0FBSyxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsU0FBUyxFQUFFO1FBQ3JFLElBQUksQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDLEtBQUssRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQzVELENBQUM7Ozs7OztJQUVELDZCQUFTOzs7OztJQUFULFVBQVUsS0FBSyxFQUFFLFFBQVE7UUFDckIsK0JBQStCO1FBQy9CLEVBQUUsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEtBQUs7Ozs7UUFBRSxVQUFBLElBQUk7WUFDdkIsSUFDSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUNaLDhEQUE4RCxDQUNqRSxFQUNIO2dCQUNFLHVCQUF1QjtnQkFDdkIsa0ZBQWtGO2dCQUNsRixPQUFPO2FBQ1Y7OztnQkFFSyxNQUFNLEdBQUcsSUFBSSxVQUFVLEVBQUU7WUFDL0IsTUFBTSxDQUFDLE1BQU07Ozs7WUFBRyxVQUFDLEdBQVE7Z0JBQ3JCLFFBQVEsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQ2hDLENBQUMsQ0FBQSxDQUFDOzs7Z0JBRUksSUFBSSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSTtZQUNyRCxJQUFJLElBQUksWUFBWSxJQUFJLEVBQUU7Z0JBQ3RCLE1BQU0sQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUM7YUFDOUI7UUFDTCxDQUFDLEVBQUMsQ0FBQztJQUNQLENBQUM7SUFDTCxnQkFBQztBQUFELENBQUMsQUEzRkQsSUEyRkM7Ozs7SUExRkcsMEJBQVc7Ozs7O0lBQ3NCLDJCQUFzQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5nWm9uZSB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XHJcbmV4cG9ydCBjbGFzcyBJbWFnZURyb3Age1xyXG4gICAgcXVpbGw6IGFueTtcclxuICAgIGNvbnN0cnVjdG9yKHF1aWxsLCBvcHRpb25zID0ge30sIHByaXZhdGUgbmdab25lOiBOZ1pvbmUpIHtcclxuICAgICAgICAvLyBzYXZlIHRoZSBxdWlsbCByZWZlcmVuY2VcclxuICAgICAgICB0aGlzLnF1aWxsID0gcXVpbGw7XHJcbiAgICAgICAgLy8gYmluZCBoYW5kbGVycyB0byB0aGlzIGluc3RhbmNlXHJcbiAgICAgICAgdGhpcy5oYW5kbGVEcm9wID0gdGhpcy5oYW5kbGVEcm9wLmJpbmQodGhpcyk7XHJcbiAgICAgICAgdGhpcy5oYW5kbGVQYXN0ZSA9IHRoaXMuaGFuZGxlUGFzdGUuYmluZCh0aGlzKTtcclxuICAgICAgICAvLyBsaXN0ZW4gZm9yIGRyb3AgYW5kIHBhc3RlIGV2ZW50c1xyXG4gICAgICAgIHRoaXMucXVpbGwucm9vdC5hZGRFdmVudExpc3RlbmVyKCdkcm9wJywgdGhpcy5oYW5kbGVEcm9wLCBmYWxzZSk7XHJcbiAgICAgICAgdGhpcy5xdWlsbC5yb290LmFkZEV2ZW50TGlzdGVuZXIoJ3Bhc3RlJywgdGhpcy5oYW5kbGVQYXN0ZSwgZmFsc2UpO1xyXG4gICAgfVxyXG5cclxuICAgIGhhbmRsZURyb3AoZXZ0KSB7XHJcbiAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgaWYgKFxyXG4gICAgICAgICAgICBldnQuZGF0YVRyYW5zZmVyICYmXHJcbiAgICAgICAgICAgIGV2dC5kYXRhVHJhbnNmZXIuZmlsZXMgJiZcclxuICAgICAgICAgICAgZXZ0LmRhdGFUcmFuc2Zlci5maWxlcy5sZW5ndGhcclxuICAgICAgICApIHtcclxuICAgICAgICAgICAgaWYgKGRvY3VtZW50LmNhcmV0UmFuZ2VGcm9tUG9pbnQpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGlvbiA9IGRvY3VtZW50LmdldFNlbGVjdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcmFuZ2UgPSBkb2N1bWVudC5jYXJldFJhbmdlRnJvbVBvaW50KFxyXG4gICAgICAgICAgICAgICAgICAgIGV2dC5jbGllbnRYLFxyXG4gICAgICAgICAgICAgICAgICAgIGV2dC5jbGllbnRZXHJcbiAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgaWYgKHNlbGVjdGlvbiAmJiByYW5nZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGlvbi5zZXRCYXNlQW5kRXh0ZW50KFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByYW5nZS5zdGFydENvbnRhaW5lcixcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmFuZ2Uuc3RhcnRPZmZzZXQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJhbmdlLnN0YXJ0Q29udGFpbmVyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByYW5nZS5zdGFydE9mZnNldFxyXG4gICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5yZWFkRmlsZXMoZXZ0LmRhdGFUcmFuc2Zlci5maWxlcywgdGhpcy5pbnNlcnQuYmluZCh0aGlzKSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGhhbmRsZVBhc3RlKGV2dCkge1xyXG4gICAgICAgIGlmIChcclxuICAgICAgICAgICAgZXZ0LmNsaXBib2FyZERhdGEgJiZcclxuICAgICAgICAgICAgZXZ0LmNsaXBib2FyZERhdGEuaXRlbXMgJiZcclxuICAgICAgICAgICAgZXZ0LmNsaXBib2FyZERhdGEuaXRlbXMubGVuZ3RoXHJcbiAgICAgICAgKSB7XHJcbiAgICAgICAgICAgIHRoaXMucmVhZEZpbGVzKGV2dC5jbGlwYm9hcmREYXRhLml0ZW1zLCBkYXRhVXJsID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGlvbiA9IHRoaXMucXVpbGwuZ2V0U2VsZWN0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoc2VsZWN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gd2UgbXVzdCBiZSBpbiBhIGJyb3dzZXIgdGhhdCBzdXBwb3J0cyBwYXN0aW5nIChsaWtlIEZpcmVmb3gpXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gc28gaXQgaGFzIGFscmVhZHkgYmVlbiBwbGFjZWQgaW50byB0aGUgZWRpdG9yXHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIG90aGVyd2lzZSB3ZSB3YWl0IHVudGlsIGFmdGVyIHRoZSBwYXN0ZSB3aGVuIHRoaXMucXVpbGwuZ2V0U2VsZWN0aW9uKClcclxuICAgICAgICAgICAgICAgICAgICAvLyB3aWxsIHJldHVybiBhIHZhbGlkIGluZGV4XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMuaW5zZXJ0KGRhdGFVcmwpLCAwKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGluc2VydChkYXRhVXJsKSB7XHJcbiAgICAgICAgY29uc3QgaW5kZXggPVxyXG4gICAgICAgICAgICAodGhpcy5xdWlsbC5nZXRTZWxlY3Rpb24oKSB8fCB7fSkuaW5kZXggfHwgdGhpcy5xdWlsbC5nZXRMZW5ndGgoKTtcclxuICAgICAgICB0aGlzLnF1aWxsLmluc2VydEVtYmVkKGluZGV4LCAnaW1hZ2UnLCBkYXRhVXJsLCAndXNlcicpO1xyXG4gICAgfVxyXG5cclxuICAgIHJlYWRGaWxlcyhmaWxlcywgY2FsbGJhY2spIHtcclxuICAgICAgICAvLyBjaGVjayBlYWNoIGZpbGUgZm9yIGFuIGltYWdlXHJcbiAgICAgICAgW10uZm9yRWFjaC5jYWxsKGZpbGVzLCBmaWxlID0+IHtcclxuICAgICAgICAgICAgaWYgKFxyXG4gICAgICAgICAgICAgICAgIWZpbGUudHlwZS5tYXRjaChcclxuICAgICAgICAgICAgICAgICAgICAvXmltYWdlXFwvKGdpZnxqcGU/Z3xhP3BuZ3xzdmd8d2VicHxibXB8dm5kXFwubWljcm9zb2Z0XFwuaWNvbikvaVxyXG4gICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICApIHtcclxuICAgICAgICAgICAgICAgIC8vIGZpbGUgaXMgbm90IGFuIGltYWdlXHJcbiAgICAgICAgICAgICAgICAvLyBOb3RlIHRoYXQgc29tZSBmaWxlIGZvcm1hdHMgc3VjaCBhcyBwc2Qgc3RhcnQgd2l0aCBpbWFnZS8qIGJ1dCBhcmUgbm90IHJlYWRhYmxlXHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gc2V0IHVwIGZpbGUgcmVhZGVyXHJcbiAgICAgICAgICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XHJcbiAgICAgICAgICAgIHJlYWRlci5vbmxvYWQgPSAoZXZ0OiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGV2dC50YXJnZXQucmVzdWx0KTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgLy8gcmVhZCB0aGUgY2xpcGJvYXJkIGl0ZW0gb3IgZmlsZVxyXG4gICAgICAgICAgICBjb25zdCBibG9iID0gZmlsZS5nZXRBc0ZpbGUgPyBmaWxlLmdldEFzRmlsZSgpIDogZmlsZTtcclxuICAgICAgICAgICAgaWYgKGJsb2IgaW5zdGFuY2VvZiBCbG9iKSB7XHJcbiAgICAgICAgICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChibG9iKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==