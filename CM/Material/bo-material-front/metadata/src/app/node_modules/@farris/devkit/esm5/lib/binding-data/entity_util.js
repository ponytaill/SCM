import { PARENT_CLASS, FieldMetadataUtil } from '../entity/index';
import { ModifyType } from '../changeset/index';
import { ChangeType } from './changes';
import { BindingPropertyType } from './binding_property';
import { BindingObjectFactory } from './binding_object_factory';
import { Form } from '../form/index';
import { takeUntil } from 'rxjs/operators';
/**
 * 实体操作工具类
 */
var EntityUtil = /** @class */ (function () {
    function EntityUtil() {
    }
    /**
     * 将entity的数据加载到bindingObject中，并保持两者同步。
     * @param entity        实体对象
     * @param bindingObject 绑定对象
     */
    EntityUtil.loadEntity = function (entity, bindingObject) {
        var _this = this;
        // 遍历bindingObject的properties进行赋值
        bindingObject.properties.forEach(function (property) {
            var propertyName = property.name;
            if (property.type === BindingPropertyType.List) {
                _this.loadEntityList(entity[propertyName] || entity[PARENT_CLASS], bindingObject[propertyName]);
            }
            else if (property.type === BindingPropertyType.Object) {
                if (entity && entity[propertyName] && _this.isEffectiveField(entity, propertyName)) {
                    _this.loadEntity(entity[propertyName], bindingObject[propertyName]);
                }
            }
            else if (property.type === BindingPropertyType.Dynamic) {
                if (entity && entity[propertyName]) {
                    var dynamicObject = BindingObjectFactory.createDynamicBindingObject(entity[propertyName].data);
                    BindingObjectFactory.attachDynamicObjectProperty(bindingObject, propertyName, dynamicObject);
                    _this.loadEntity(entity[propertyName], bindingObject[propertyName]);
                }
            }
            else {
                if (_this.isEffectiveField(entity, propertyName)) {
                    var value = entity[propertyName];
                    bindingObject.setValue(propertyName, value, false, false);
                }
            }
        });
        this.setUpEntityPipeline(entity, bindingObject);
    };
    /**
     * 建立entity和bindingObject之间的关联
     * @param entity        实体对象
     * @param bindingObject 绑定对象
     */
    EntityUtil.setUpEntityPipeline = function (entity, bindingObject) {
        if (!entity || !bindingObject) {
            return;
        }
        // 监听entity变更
        entity.onValueChanged.pipe(takeUntil(entity.unsubscribe)).subscribe(function (modification) {
            if (modification.type !== ModifyType.ValueChange || modification.path.length === 0) {
                return;
            }
            var propertyName = modification.path[modification.path.length - 1];
            var primaryKeyPath = modification.path[modification.path.length - 2];
            // 验证主键是否匹配
            // 存在主键并且主键不是id时才检查（值对象、关联对象不检查）
            if (bindingObject.primaryKey && bindingObject.primaryKey === 'id') {
                var primaryKey = bindingObject.primaryKey;
                var primaryKeyValue = bindingObject.getValue(primaryKey);
                if (primaryKeyPath !== primaryKey + ":" + primaryKeyValue) {
                    return;
                }
            }
            // TODO:修复动态列不触发变更的问题，临时方案，应该有单独的dynamicBindingObject类
            if (modification.dynamic) {
                if (bindingObject['__original__']) {
                    return;
                }
                var value_1 = modification.value;
                var target_1 = bindingObject[propertyName];
                if (!target_1) {
                    return;
                }
                Object.keys(value_1).forEach(function (key) {
                    if (target_1.getValue(key) === value_1[key]) {
                        return;
                    }
                    target_1.setValue(key, value_1[key], true, false);
                });
            }
            else {
                // 值没有发生变化，不再设置
                // TODO: 通过bindingObject修改entity属性值时，entity总会触发一个变更回来，如果不截获这个重复的变更，会导致重复或死循环
                if (bindingObject.getValue(propertyName) === modification.value) {
                    return;
                }
                bindingObject.setValue(propertyName, modification.value, true, false, modification.errors);
            }
        });
        // 监听bindingObject变更
        bindingObject.viewChanges.pipe(takeUntil(bindingObject.unsubscribe)).subscribe(function (viewChange) {
            var value = viewChange.value;
            var propertyName = viewChange.path[0];
            var pathPrefix = '';
            var pathData = entity.getPaths();
            var paths = pathData.path;
            var id = bindingObject['id'];
            bindingObject['__original__'] = true;
            // if (pathData.isUdt) {
            // grid中udt没有id，从父级中取出id，以便存放验证信息
            var getParentId = function (target) {
                var parentId = '';
                var findId = function (item) {
                    if (item && item && item['id']) {
                        parentId = item['id'];
                        return;
                    }
                    else if (item['parent']) {
                        findId(item['parent']);
                    }
                };
                findId(target);
                return parentId;
            };
            id = getParentId(bindingObject);
            // if (pathData.isGrid) {
            //   // grid 将从表主字段去除
            //   paths.pop();
            // }
            if (paths.length) {
                pathPrefix = paths.join('.') + '.';
            }
            // }
            var controlProp = pathPrefix + propertyName;
            // 调用实体验证，并将错误信息合并到formControl上
            var entityValidate = function (callback) {
                var enableValidate = Object.values(Form.insMap).find(function (item) { return item && item.enableValidate; });
                if (!enableValidate) {
                    if (typeof callback === 'function') {
                        callback(null);
                    }
                    return;
                }
                entity.validateFromUtilSync(propertyName, value, function (result) {
                    var _a;
                    var errorObj = {};
                    if (result.errors && result.errors.length > 0) {
                        result.errors.forEach(function (error) {
                            if (error.constraints) {
                                Object.keys(error.constraints).forEach(function (key) {
                                    errorObj[key] = {
                                        value: value,
                                        name: error.constraints[key],
                                        error: error
                                    };
                                });
                            }
                        });
                    }
                    // 先设置实体验证信息，再设置form验证信息，然后在form.isFormValid内部整合实体验证form验证信息
                    Form.updateErrors(controlProp, errorObj, id, value, pathData.isGrid);
                    var formErrors = viewChange['errors'] || {};
                    var mergedErrors = Object.assign({}, formErrors, errorObj);
                    var validateError = null;
                    if (Object.keys(mergedErrors).length > 0) {
                        validateError = (_a = {}, _a[propertyName] = mergedErrors, _a);
                    }
                    if (typeof (callback) === 'function') {
                        callback(validateError);
                    }
                }, viewChange.context);
            };
            // 不是主键值字段时，要先检查主键是否存在，并且主键是否相等（防止后代变更冒泡上来）
            // 非主键属性变更时，要先检查主键是否匹配（如果主键也修改了，要求先修改主键再修改其他值）
            if (bindingObject.primaryKey) {
                var primaryKey = bindingObject.primaryKey;
                if (propertyName !== primaryKey) {
                    if (!entity[primaryKey] || entity[primaryKey] !== bindingObject[primaryKey]) {
                        entityValidate();
                        return;
                    }
                }
                else if (entity[propertyName] !== value) {
                    // todo: 因异步校验未结束实体主键没有被赋值，导致实体其他属性无法赋值，待后续前端校验重构时去掉
                    entity[propertyName] = value;
                    entityValidate();
                    return;
                }
            }
            // 如果BindingObject上的属性值和Entity上对应属性值一样，则不再设置
            if (entity[propertyName] === value) {
                entityValidate();
                return;
            }
            // 调用表单验证,通过后调用实体验证
            // bingdingObject变化后，先调用实体上的验证，通过后再设置实体的变动
            entityValidate(function (errors) {
                entity.errors = errors;
                entity[propertyName] = value;
            });
        });
    };
    /**
     * 将entityList中的Entity对象转换为BindingObject对象，加载到bindingList中，并保持entityList和bindingList同步。
     * @param entityList  实体列表
     * @param bindingList 绑定列表
     */
    EntityUtil.loadEntityList = function (entityList, bindingList) {
        this.loadEntities(entityList.items, bindingList);
        this.setUpEntityListPipeline(entityList, bindingList);
    };
    /**
     * 建立entityList和bindingList之间的关联
     * @param entityList  实体列表
     * @param bindingList 绑定列表
     */
    EntityUtil.setUpEntityListPipeline = function (entityList, bindingList) {
        var _this = this;
        entityList.onListChanged.subscribe(function (modification) {
            var target = modification['target'];
            if (target && target !== entityList) {
                return;
            }
            switch (modification.type) {
                // 添加实体
                case ModifyType.Add:
                case ModifyType.Clone:
                    {
                        var entitiesToAdd = modification.value;
                        if (entitiesToAdd.length === 0) {
                            return;
                        }
                        // 检查父id是否一致，冒泡导致的变更不处理
                        var paths_1 = modification.path;
                        var parentPath_1 = paths_1[paths_1.length - 2];
                        var parentId_1 = bindingList.parent.primaryKeyValue;
                        if (parentPath_1.indexOf(parentId_1) === -1) {
                            return;
                        }
                        _this.appendEntities(modification.value, bindingList, modification.type === ModifyType.Clone);
                    }
                    break;
                case ModifyType.Insert:
                    {
                        // 检查父id是否一致，冒泡导致的变更不处理
                        var paths_2 = modification.path;
                        var parentPath_2 = paths_2[paths_2.length - 2];
                        var parentId_2 = bindingList.parent.primaryKeyValue;
                        var position = modification.position;
                        if (parentPath_2.indexOf(parentId_2) === -1) {
                            return;
                        }
                        _this.insertEntity(modification.value[0], bindingList, position);
                    }
                    break;
                // 删除实体
                case ModifyType.Remove:
                    {
                        // 检查父id是否一致，冒泡导致的变更不处理
                        var paths_3 = modification.path;
                        var parentPath_3 = paths_3[paths_3.length - 2];
                        var parentId_3 = bindingList.parent.primaryKeyValue;
                        if (parentPath_3.indexOf(parentId_3) === -1) {
                            return;
                        }
                        // 删除实体（value格式待商榷，目前value的格式为 { primaryKey: primaryValue}）
                        var id = modification.value[bindingList.primaryKey];
                        bindingList.removeByIds([id]);
                        // this.removeEntities(<Entity[]>modification.value, bindingList);
                    }
                    break;
                // 加载实体
                case ModifyType.Load:
                    // 检查父id是否一致，冒泡导致的变更不处理
                    var paths = modification.path;
                    var parentPath = paths[paths.length - 2];
                    var parentId = bindingList.parent.primaryKeyValue;
                    if (parentPath.indexOf(parentId) === -1) {
                        return;
                    }
                    var entities = modification.value;
                    _this.loadEntities(entities, bindingList);
                    break;
                default:
                    break;
            }
        });
    };
    /**
     * 监听repository变化，保持repository和bindingList同步。
     * @param repository  实体仓库
     * @param bindingList 绑定列表
     */
    EntityUtil.loadRepository = function (repository, bindingList) {
        var _this = this;
        // 初次加载
        var entities = Array.from(repository.entityCollection.toArray());
        this.loadEntities(entities, bindingList);
        // 监听变化
        repository.entityCollectionChange.pipe(takeUntil(repository.destroy$)).subscribe(function (modification) {
            switch (modification.type) {
                case ModifyType.Load:
                    bindingList.clear(true);
                    _this.loadEntities(modification.value, bindingList, modification.entityCreate);
                    break;
                case ModifyType.Add:
                case ModifyType.Clone:
                    _this.appendEntities(modification.value, bindingList, modification.type === ModifyType.Clone);
                    break;
                case ModifyType.AddData:
                    _this.addData(modification.value, bindingList);
                    break;
                case ModifyType.Insert:
                    _this.insertEntity(modification.value, bindingList, modification.position);
                    break;
                case ModifyType.Remove:
                    _this.removeEntities(modification.value, bindingList);
                    break;
                case ModifyType.RemoveData:
                    _this.removeData(modification.value, bindingList);
                    break;
                case ModifyType.PaginationInfoChange:
                    // 分页信息无需同步到bindingList，放到bindingData即可。保留此处只是为了兼容产品部可能使用bindingList上分页信息的场景
                    bindingList.paginationInfo = modification.value;
                    break;
                default:
                    break;
            }
        });
        // 监听BindingList数据变化
        bindingList.changes.pipe(takeUntil(bindingList.destroy$)).subscribe(function (change) {
            if (change.type === ChangeType.PaginationInfoChange) {
                var entityCollection = repository.entityCollection;
                // const entityTypeName = entityCollection.entityTypeName;
                // const original = entityCollection.paginationInfo[entityTypeName];
                // const entityPaginationInfo = Object.assign({}, original, change.value);
                entityCollection.paginationInfo = Object.assign({}, entityCollection.paginationInfo, change.value);
            }
        });
    };
    /**
     * 将entities中的Entity对象转换为BindingObject对象，并加载到bindingList中
     * @param entities    实体数组
     * @param bindingList 绑定列表
     */
    EntityUtil.loadEntities = function (entities, bindingList, entityCreate) {
        if (entityCreate === void 0) { entityCreate = false; }
        var bindingObjects = this.createBindingObjects(entities, bindingList);
        bindingList.load(bindingObjects, entityCreate);
    };
    /**
     * 将entities中的Entity对象转换为BIndingObject对象，并追加到bindingList中
     * @param entities    实体数组
     * @param bindingList 绑定列表
     */
    EntityUtil.appendEntities = function (entities, bindingList, isCloned) {
        if (isCloned === void 0) { isCloned = false; }
        var bindingObjects = this.createBindingObjects(entities, bindingList);
        bindingList.append(bindingObjects, isCloned);
    };
    /**
     * 是否是有效的字段
     * @param entity 实体
     * @param propertyName 字段
     * @returns
     */
    EntityUtil.isEffectiveField = function (entity, propertyName) {
        if (!entity || !propertyName) {
            return false;
        }
        propertyName = propertyName.toLowerCase();
        if (entity['__farris_effective_fields__']) {
            return entity['__farris_effective_fields__'].includes(propertyName);
        }
        if (entity['farris_effective_fields'] && typeof entity['farris_effective_fields'] === 'string') {
            var effectiveFields = entity['farris_effective_fields'].split(',').filter(function (p) { return p; }).map(function (item) { return item.toLowerCase(); });
            entity['__farris_effective_fields__'] = effectiveFields;
            return effectiveFields.includes(propertyName);
        }
        return true;
    };
    /**
     * 增加实体数据（不切换当前行）
     * @param entities
     * @param bindingList
     */
    EntityUtil.addData = function (entities, bindingList) {
        var bindingObjects = this.createBindingObjects(entities, bindingList);
        bindingList.addData(bindingObjects);
    };
    EntityUtil.insertEntity = function (entity, bindingList, position) {
        var bindingObject = this.createBindingObject(entity, bindingList);
        bindingList.insert(bindingObject, position);
    };
    /**
     * 从bindingList移除entities对应的BindingObject对象
     * @param entities    实体数组
     * @param bindingList 绑定列表
     */
    EntityUtil.removeEntities = function (entities, bindingList) {
        if (entities === null || entities.length === 0) {
            return;
        }
        // 归集要删除的id数组
        var primaryKey = bindingList.primaryKey;
        var ids = [];
        entities.forEach(function (entity) {
            ids.push(entity[primaryKey]);
        });
        bindingList.removeByIds(ids);
    };
    EntityUtil.removeData = function (entities, bindingList) {
        if (entities === null || entities.length === 0) {
            return;
        }
        // 归集要删除的id数组
        var primaryKey = bindingList.primaryKey;
        var ids = [];
        entities.forEach(function (entity) {
            ids.push(entity[primaryKey]);
        });
        bindingList.removeDataByIds(ids);
    };
    /**
     * 将entities中的Entity对象转换为BindingObject对象
     * @param entities    实体数组
     * @param bindingList 绑定列表
     */
    EntityUtil.createBindingObjects = function (entities, bindingList) {
        var _this = this;
        if (entities === null || entities.length === 0) {
            return [];
        }
        var bindingObjects = [];
        entities.forEach(function (entity) {
            var bindingObject = BindingObjectFactory.create(bindingList.properties);
            bindingObject['_ENTITY_'] = entity;
            _this.loadEntity(entity, bindingObject);
            // // 为bindingObject设置默认值initialData属性
            // if (entity['initialData']) {
            //   bindingObject['initialData'] = entity['initialData'];
            // }
            bindingObjects.push(bindingObject);
        });
        return bindingObjects;
    };
    EntityUtil.createBindingObject = function (entity, bindingList) {
        var bindingObject = BindingObjectFactory.create(bindingList.properties);
        this.loadEntity(entity, bindingObject);
        return bindingObject;
    };
    EntityUtil.watchReposiroty = function (repository, bindingData) {
        // reposiroty => bindingData
        repository.entityCollectionChange.subscribe(function (modification) {
            switch (modification.type) {
                case ModifyType.PaginationInfoChange:
                    bindingData.pagingInfo = modification.value;
                    break;
                default:
                    break;
            }
        });
    };
    /**
     * 查找属性的类型
     * @param entityType 实体类型
     * @param targetPropName 属性名称
     * @return 属性信息，包含属性类型（NgField、NgObject、NgList）和属性对应的实体类型（当NgField类型时为null）
     */
    EntityUtil.getPropInfo = function (entityType, targetPropName) {
        var propType;
        var propEntityType;
        // NgField
        var ngFieldProperties = FieldMetadataUtil.getNgFields(entityType);
        Object.keys(ngFieldProperties).forEach(function (propName) {
            if (propName === targetPropName) {
                propType = 'NgField';
                propEntityType = null;
            }
        });
        // NgObject
        var ngObjectProperties = FieldMetadataUtil.getNgObjects(entityType);
        Object.keys(ngObjectProperties).forEach(function (propName) {
            if (propName === targetPropName) {
                propType = 'NgObject';
                propEntityType = ngObjectProperties[propName].type;
            }
        });
        // NgList
        var ngListProperties = FieldMetadataUtil.getNgList(entityType);
        Object.keys(ngListProperties).forEach(function (propName) {
            if (propName === targetPropName) {
                propType = 'NgList';
                propEntityType = ngListProperties[propName].type;
            }
        });
        var ngDynamicProperties = FieldMetadataUtil.getNgDynamic(entityType);
        Object.keys(ngDynamicProperties).forEach(function (propName) {
            if (propName === targetPropName) {
                propType = 'NgDynamic';
                propEntityType = ngDynamicProperties[propName].type;
            }
        });
        return { propType: propType, propEntityType: propEntityType };
    };
    /**
     * 获取实体的主键名
     * @param entityType 实体类型
     */
    EntityUtil.getPrimaryKey = function (entityType) {
        var primaryNgFiledProp = FieldMetadataUtil.getPrimaryFieldMetadata(entityType);
        if (primaryNgFiledProp) {
            return primaryNgFiledProp.dataField;
        }
        else {
            return '';
        }
    };
    /**
     * 是否为对象属性
     */
    EntityUtil.isObjectProp = function (entityType, targetPropName) {
        var isObjectProp = false;
        var ngObjectProperties = FieldMetadataUtil.getNgObjects(entityType);
        Object.keys(ngObjectProperties).forEach(function (propName) {
            if (propName === targetPropName) {
                isObjectProp = true;
            }
        });
        return isObjectProp;
    };
    /**
     * 检查是否是动态列属性
     */
    EntityUtil.isDynamicProp = function (entityType, targetPropName) {
        var isDynamicProp = false;
        var ngDynamicProperties = FieldMetadataUtil.getNgDynamic(entityType);
        Object.keys(ngDynamicProperties).forEach(function (propName) {
            if (propName === targetPropName) {
                isDynamicProp = true;
            }
        });
        return isDynamicProp;
    };
    /**
     * 为实体增加initialData属性
     * @param entity 实体实例
     * @param initialData 默认值对象
     */
    EntityUtil.appendInitialData = function (entity, initialData) {
        var data = Object.assign({}, initialData);
        delete data.id;
        delete data.parentID;
        entity['initialData'] = data;
    };
    return EntityUtil;
}());
export { EntityUtil };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW50aXR5X3V0aWwuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2RldmtpdC8iLCJzb3VyY2VzIjpbImxpYi9iaW5kaW5nLWRhdGEvZW50aXR5X3V0aWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFzQixZQUFZLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUN0RixPQUFPLEVBQWdCLFVBQVUsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQzlELE9BQU8sRUFBc0IsVUFBVSxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBRzNELE9BQU8sRUFBbUIsbUJBQW1CLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUMxRSxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUNoRSxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBR3JDLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUUzQzs7R0FFRztBQUNIO0lBQUE7SUE4aUJBLENBQUM7SUE1aUJDOzs7O09BSUc7SUFDSSxxQkFBVSxHQUFqQixVQUFrQixNQUFjLEVBQUUsYUFBNEI7UUFBOUQsaUJBeUJDO1FBeEJDLGlDQUFpQztRQUNqQyxhQUFhLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxVQUFDLFFBQXlCO1lBQ3pELElBQU0sWUFBWSxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUM7WUFDbkMsSUFBSSxRQUFRLENBQUMsSUFBSSxLQUFLLG1CQUFtQixDQUFDLElBQUksRUFBRTtnQkFDOUMsS0FBSSxDQUFDLGNBQWMsQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLElBQUksTUFBTSxDQUFDLFlBQVksQ0FBQyxFQUFFLGFBQWEsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO2FBQ2hHO2lCQUFNLElBQUksUUFBUSxDQUFDLElBQUksS0FBSyxtQkFBbUIsQ0FBQyxNQUFNLEVBQUU7Z0JBQ3ZELElBQUksTUFBTSxJQUFJ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LENBQUMsbUJBQW1CLENBQUMsQ0FBQyxPQUFPLENBQUMsVUFBQyxRQUFnQjtZQUN4RCxJQUFJLFFBQVEsS0FBSyxjQUFjLEVBQUU7Z0JBQy9CLGFBQWEsR0FBRyxJQUFJLENBQUM7YUFDdEI7UUFDSCxDQUFDLENBQUMsQ0FBQztRQUNILE9BQU8sYUFBYSxDQUFDO0lBQ3ZCLENBQUM7SUFFRDs7OztPQUlHO0lBQ0ksNEJBQWlCLEdBQXhCLFVBQXlCLE1BQU0sRUFBRSxXQUFXO1FBQzFDLElBQU0sSUFBSSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLFdBQVcsQ0FBQyxDQUFDO1FBQzVDLE9BQU8sSUFBSSxDQUFDLEVBQUUsQ0FBQztRQUNmLE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQztRQUNyQixNQUFNLENBQUMsYUFBYSxDQUFDLEdBQUcsSUFBSSxDQUFDO0lBQy9CLENBQUM7SUFDSCxpQkFBQztBQUFELENBQUMsQUE5aUJELElBOGlCQztBQUVELE9BQU8sRUFBRSxVQUFVLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJlcG9zaXRvcnkgfSBmcm9tICcuLi9yZXBvc2l0b3J5L2luZGV4JztcclxuaW1wb3J0IHsgRW50aXR5LCBFbnRpdHlMaXN0LCBQQVJFTlRfQ0xBU1MsIEZpZWxkTWV0YWRhdGFVdGlsIH0gZnJvbSAnLi4vZW50aXR5L2luZGV4JztcclxuaW1wb3J0IHsgTW9kaWZpY2F0aW9uLCBNb2RpZnlUeXBlIH0gZnJvbSAnLi4vY2hhbmdlc2V0L2luZGV4JztcclxuaW1wb3J0IHsgVmlld0NoYW5nZSwgQ2hhbmdlLCBDaGFuZ2VUeXBlIH0gZnJvbSAnLi9jaGFuZ2VzJztcclxuaW1wb3J0IHsgQmluZGluZ0xpc3QgfSBmcm9tICcuL2JpbmRpbmdfbGlzdCc7XHJcbmltcG9ydCB7IEJpbmRpbmdPYmplY3QgfSBmcm9tICcuL2JpbmRpbmdfb2JqZWN0JztcclxuaW1wb3J0IHsgQmluZGluZ1Byb3BlcnR5LCBCaW5kaW5nUHJvcGVydHlUeXBlIH0gZnJvbSAnLi9iaW5kaW5nX3Byb3BlcnR5JztcclxuaW1wb3J0IHsgQmluZGluZ09iamVjdEZhY3RvcnkgfSBmcm9tICcuL2JpbmRpbmdfb2JqZWN0X2ZhY3RvcnknO1xyXG5pbXBvcnQgeyBGb3JtIH0gZnJvbSAnLi4vZm9ybS9pbmRleCc7XHJcbmltcG9ydCB7IFBhZ2luYXRpb24gfSBmcm9tICcuLi9jb3JlJztcclxuaW1wb3J0IHsgQmluZGluZ0RhdGEgfSBmcm9tICcuL2JpbmRpbmdfZGF0YSc7XHJcbmltcG9ydCB7IHRha2VVbnRpbCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuXHJcbi8qKlxyXG4gKiDlrp7kvZPmk43kvZzlt6XlhbfnsbtcclxuICovXHJcbmNsYXNzIEVudGl0eVV0aWwge1xyXG5cclxuICAvKipcclxuICAgKiDlsIZlbnRpdHnnmoTmlbDmja7liqDovb3liLBiaW5kaW5nT2JqZWN05Lit77yM5bm25L+d5oyB5Lik6ICF5ZCM5q2l44CCXHJcbiAgICogQHBhcmFtIGVudGl0eSAgICAgICAg5a6e5L2T5a+56LGhXHJcbiAgICogQHBhcmFtIGJpbmRpbmdPYmplY3Qg57uR5a6a5a+56LGhXHJcbiAgICovXHJcbiAgc3RhdGljIGxvYWRFbnRpdHkoZW50aXR5OiBFbnRpdHksIGJpbmRpbmdPYmplY3Q6IEJpbmRpbmdPYmplY3QpIHtcclxuICAgIC8vIOmBjeWOhmJpbmRpbmdPYmplY3TnmoRwcm9wZXJ0aWVz6L+b6KGM6LWL5YC8XHJcbiAgICBiaW5kaW5nT2JqZWN0LnByb3BlcnRpZXMuZm9yRWFjaCgocHJvcGVydHk6IEJpbmRpbmdQcm9wZXJ0eSkgPT4ge1xyXG4gICAgICBjb25zdCBwcm9wZXJ0eU5hbWUgPSBwcm9wZXJ0eS5uYW1lO1xyXG4gICAgICBpZiAocHJvcGVydHkudHlwZSA9PT0gQmluZGluZ1Byb3BlcnR5VHlwZS5MaXN0KSB7XHJcbiAgICAgICAgdGhpcy5sb2FkRW50aXR5TGlzdChlbnRpdHlbcHJvcGVydHlOYW1lXSB8fCBlbnRpdHlbUEFSRU5UX0NMQVNTXSwgYmluZGluZ09iamVjdFtwcm9wZXJ0eU5hbWVdKTtcclxuICAgICAgfSBlbHNlIGlmIChwcm9wZXJ0eS50eXBlID09PSBCaW5kaW5nUHJvcGVydHlUeXBlLk9iamVjdCkge1xyXG4gICAgICAgIGlmIChlbnRpdHkgJiYgZW50aXR5W3Byb3BlcnR5TmFtZV0gJiYgdGhpcy5pc0VmZmVjdGl2ZUZpZWxkKGVudGl0eSwgcHJvcGVydHlOYW1lKSkge1xyXG4gICAgICAgICAgdGhpcy5sb2FkRW50aXR5KGVudGl0eVtwcm9wZXJ0eU5hbWVdLCBiaW5kaW5nT2JqZWN0W3Byb3BlcnR5TmFtZV0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIGlmIChwcm9wZXJ0eS50eXBlID09PSBCaW5kaW5nUHJvcGVydHlUeXBlLkR5bmFtaWMpIHtcclxuICAgICAgICBpZiAoZW50aXR5ICYmIGVudGl0eVtwcm9wZXJ0eU5hbWVdKSB7XHJcbiAgICAgICAgICBjb25zdCBkeW5hbWljT2JqZWN0ID0gQmluZGluZ09iamVjdEZhY3RvcnkuY3JlYXRlRHluYW1pY0JpbmRpbmdPYmplY3QoZW50aXR5W3Byb3BlcnR5TmFtZV0uZGF0YSk7XHJcbiAgICAgICAgICBCaW5kaW5nT2JqZWN0RmFjdG9yeS5hdHRhY2hEeW5hbWljT2JqZWN0UHJvcGVydHkoYmluZGluZ09iamVjdCwgcHJvcGVydHlOYW1lLCBkeW5hbWljT2JqZWN0KTtcclxuICAgICAgICAgIHRoaXMubG9hZEVudGl0eShlbnRpdHlbcHJvcGVydHlOYW1lXSwgYmluZGluZ09iamVjdFtwcm9wZXJ0eU5hbWVdKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNFZmZlY3RpdmVGaWVsZChlbnRpdHksIHByb3BlcnR5TmFtZSkpIHtcclxuICAgICAgICAgIGNvbnN0IHZhbHVlID0gZW50aXR5W3Byb3BlcnR5TmFtZV07XHJcbiAgICAgICAgICBiaW5kaW5nT2JqZWN0LnNldFZhbHVlKHByb3BlcnR5TmFtZSwgdmFsdWUsIGZhbHNlLCBmYWxzZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICB0aGlzLnNldFVwRW50aXR5UGlwZWxpbmUoZW50aXR5LCBiaW5kaW5nT2JqZWN0KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOW7uueri2VudGl0eeWSjGJpbmRpbmdPYmplY3TkuYvpl7TnmoTlhbPogZRcclxuICAgKiBAcGFyYW0gZW50aXR5ICAgICAgICDlrp7kvZPlr7nosaFcclxuICAgKiBAcGFyYW0gYmluZGluZ09iamVjdCDnu5Hlrprlr7nosaFcclxuICAgKi9cclxuICBzdGF0aWMgc2V0VXBFbnRpdHlQaXBlbGluZShlbnRpdHk6IEVudGl0eSwgYmluZGluZ09iamVjdDogQmluZGluZ09iamVjdCkge1xyXG4gICAgaWYgKCFlbnRpdHkgfHwgIWJpbmRpbmdPYmplY3QpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgLy8g55uR5ZCsZW50aXR55Y+Y5pu0XHJcbiAgICBlbnRpdHkub25WYWx1ZUNoYW5nZWQucGlwZSh0YWtlVW50aWwoZW50aXR5LnVuc3Vic2NyaWJlKSkuc3Vic2NyaWJlKChtb2RpZmljYXRpb246IE1vZGlmaWNhdGlvbikgPT4ge1xyXG4gICAgICBpZiAobW9kaWZpY2F0aW9uLnR5cGUgIT09IE1vZGlmeVR5cGUuVmFsdWVDaGFuZ2UgfHwgbW9kaWZpY2F0aW9uLnBhdGgubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICAgIGNvbnN0IHByb3BlcnR5TmFtZSA9IG1vZGlmaWNhdGlvbi5wYXRoW21vZGlmaWNhdGlvbi5wYXRoLmxlbmd0aCAtIDFdO1xyXG4gICAgICBjb25zdCBwcmltYXJ5S2V5UGF0aCA9IG1vZGlmaWNhdGlvbi5wYXRoW21vZGlmaWNhdGlvbi5wYXRoLmxlbmd0aCAtIDJdO1xyXG5cclxuICAgICAgLy8g6aqM6K+B5Li76ZSu5piv5ZCm5Yy56YWNXHJcbiAgICAgIC8vIOWtmOWcqOS4u+mUruW5tuS4lOS4u+mUruS4jeaYr2lk5pe25omN5qOA5p+l77yI5YC85a+56LGh44CB5YWz6IGU5a+56LGh5LiN5qOA5p+l77yJXHJcbiAgICAgIGlmIChiaW5kaW5nT2JqZWN0LnByaW1hcnlLZXkgJiYgYmluZGluZ09iamVjdC5wcmltYXJ5S2V5ID09PSAnaWQnKSB7XHJcbiAgICAgICAgY29uc3QgcHJpbWFyeUtleSA9IGJpbmRpbmdPYmplY3QucHJpbWFyeUtleTtcclxuICAgICAgICBjb25zdCBwcmltYXJ5S2V5VmFsdWUgPSBiaW5kaW5nT2JqZWN0LmdldFZhbHVlKHByaW1hcnlLZXkpO1xyXG4gICAgICAgIGlmIChwcmltYXJ5S2V5UGF0aCAhPT0gYCR7cHJpbWFyeUtleX06JHtwcmltYXJ5S2V5VmFsdWV9YCkge1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICAvLyBUT0RPOuS/ruWkjeWKqOaAgeWIl+S4jeinpuWPkeWPmOabtOeahOmXrumimO+8jOS4tOaXtuaWueahiO+8jOW6lOivpeacieWNleeLrOeahGR5bmFtaWNCaW5kaW5nT2JqZWN057G7XHJcbiAgICAgIGlmIChtb2RpZmljYXRpb24uZHluYW1pYykge1xyXG4gICAgICAgIGlmIChiaW5kaW5nT2JqZWN0WydfX29yaWdpbmFsX18nXSkge1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCB2YWx1ZSA9IG1vZGlmaWNhdGlvbi52YWx1ZTtcclxuICAgICAgICBjb25zdCB0YXJnZXQgPSBiaW5kaW5nT2JqZWN0W3Byb3BlcnR5TmFtZV07XHJcbiAgICAgICAgaWYgKCF0YXJnZXQpIHtcclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgT2JqZWN0LmtleXModmFsdWUpLmZvckVhY2goKGtleTogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgICBpZiAodGFyZ2V0LmdldFZhbHVlKGtleSkgPT09IHZhbHVlW2tleV0pIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgdGFyZ2V0LnNldFZhbHVlKGtleSwgdmFsdWVba2V5XSwgdHJ1ZSwgZmFsc2UpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIOWAvOayoeacieWPkeeUn+WPmOWMlu+8jOS4jeWGjeiuvue9rlxyXG4gICAgICAgIC8vIFRPRE86IOmAmui/h2JpbmRpbmdPYmplY3Tkv67mlLllbnRpdHnlsZ7mgKflgLzml7bvvIxlbnRpdHnmgLvkvJrop6blj5HkuIDkuKrlj5jmm7Tlm57mnaXvvIzlpoLmnpzkuI3miKrojrfov5nkuKrph43lpI3nmoTlj5jmm7TvvIzkvJrlr7zoh7Tph43lpI3miJbmrbvlvqrnjq9cclxuICAgICAgICBpZiAoYmluZGluZ09iamVjdC5nZXRWYWx1ZShwcm9wZXJ0eU5hbWUpID09PSBtb2RpZmljYXRpb24udmFsdWUpIHtcclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgYmluZGluZ09iamVjdC5zZXRWYWx1ZShwcm9wZXJ0eU5hbWUsIG1vZGlmaWNhdGlvbi52YWx1ZSwgdHJ1ZSwgZmFsc2UsIG1vZGlmaWNhdGlvbi5lcnJvcnMpO1xyXG4gICAgICB9XHJcblxyXG4gICAgfSk7XHJcbiAgICAvLyDnm5HlkKxiaW5kaW5nT2JqZWN05Y+Y5pu0XHJcbiAgICBiaW5kaW5nT2JqZWN0LnZpZXdDaGFuZ2VzLnBpcGUodGFrZVVudGlsKGJpbmRpbmdPYmplY3QudW5zdWJzY3JpYmUpKS5zdWJzY3JpYmUoKHZpZXdDaGFuZ2U6IFZpZXdDaGFuZ2UpID0+IHtcclxuICAgICAgY29uc3QgdmFsdWUgPSB2aWV3Q2hhbmdlLnZhbHVlO1xyXG4gICAgICBjb25zdCBwcm9wZXJ0eU5hbWUgPSB2aWV3Q2hhbmdlLnBhdGhbMF07XHJcblxyXG4gICAgICBsZXQgcGF0aFByZWZpeCA9ICcnO1xyXG4gICAgICBjb25zdCBwYXRoRGF0YSA9IGVudGl0eS5nZXRQYXRocygpO1xyXG4gICAgICBjb25zdCBwYXRocyA9IHBhdGhEYXRhLnBhdGg7XHJcbiAgICAgIGxldCBpZCA9IGJpbmRpbmdPYmplY3RbJ2lkJ107XHJcbiAgICAgIGJpbmRpbmdPYmplY3RbJ19fb3JpZ2luYWxfXyddID0gdHJ1ZTtcclxuICAgICAgLy8gaWYgKHBhdGhEYXRhLmlzVWR0KSB7XHJcbiAgICAgIC8vIGdyaWTkuK11ZHTmsqHmnIlpZO+8jOS7jueItue6p+S4reWPluWHumlk77yM5Lul5L6/5a2Y5pS+6aqM6K+B5L+h5oGvXHJcbiAgICAgIGNvbnN0IGdldFBhcmVudElkID0gKHRhcmdldDogYW55KSA9PiB7XHJcbiAgICAgICAgbGV0IHBhcmVudElkID0gJyc7XHJcbiAgICAgICAgY29uc3QgZmluZElkID0gKGl0ZW06IGFueSkgPT4ge1xyXG4gICAgICAgICAgaWYgKGl0ZW0gJiYgaXRlbSAmJiBpdGVtWydpZCddKSB7XHJcbiAgICAgICAgICAgIHBhcmVudElkID0gaXRlbVsnaWQnXTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgfSBlbHNlIGlmIChpdGVtWydwYXJlbnQnXSkge1xyXG4gICAgICAgICAgICBmaW5kSWQoaXRlbVsncGFyZW50J10pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgZmluZElkKHRhcmdldCk7XHJcbiAgICAgICAgcmV0dXJuIHBhcmVudElkO1xyXG4gICAgICB9O1xyXG4gICAgICBpZCA9IGdldFBhcmVudElkKGJpbmRpbmdPYmplY3QpO1xyXG4gICAgICAvLyBpZiAocGF0aERhdGEuaXNHcmlkKSB7XHJcbiAgICAgIC8vICAgLy8gZ3JpZCDlsIbku47ooajkuLvlrZfmrrXljrvpmaRcclxuICAgICAgLy8gICBwYXRocy5wb3AoKTtcclxuICAgICAgLy8gfVxyXG4gICAgICBpZiAocGF0aHMubGVuZ3RoKSB7XHJcbiAgICAgICAgcGF0aFByZWZpeCA9IHBhdGhzLmpvaW4oJy4nKSArICcuJztcclxuICAgICAgfVxyXG4gICAgICAvLyB9XHJcbiAgICAgIGNvbnN0IGNvbnRyb2xQcm9wID0gcGF0aFByZWZpeCArIHByb3BlcnR5TmFtZTtcclxuICAgICAgLy8g6LCD55So5a6e5L2T6aqM6K+B77yM5bm25bCG6ZSZ6K+v5L+h5oGv5ZCI5bm25YiwZm9ybUNvbnRyb2zkuIpcclxuICAgICAgY29uc3QgZW50aXR5VmFsaWRhdGUgPSAoY2FsbGJhY2s/OiAoZXJyb3I6IGFueSkgPT4gdm9pZCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGVuYWJsZVZhbGlkYXRlID0gT2JqZWN0LnZhbHVlcyhGb3JtLmluc01hcCkuZmluZChpdGVtID0+IGl0ZW0gJiYgaXRlbS5lbmFibGVWYWxpZGF0ZSk7XHJcbiAgICAgICAgaWYgKCFlbmFibGVWYWxpZGF0ZSkge1xyXG4gICAgICAgICAgaWYgKHR5cGVvZiBjYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICBjYWxsYmFjayhudWxsKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZW50aXR5LnZhbGlkYXRlRnJvbVV0aWxTeW5jKHByb3BlcnR5TmFtZSwgdmFsdWUsIHJlc3VsdCA9PiB7XHJcbiAgICAgICAgICBjb25zdCBlcnJvck9iaiA9IHt9O1xyXG4gICAgICAgICAgaWYgKHJlc3VsdC5lcnJvcnMgJiYgcmVzdWx0LmVycm9ycy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIHJlc3VsdC5lcnJvcnMuZm9yRWFjaCgoZXJyb3I6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgIGlmIChlcnJvci5jb25zdHJhaW50cykge1xyXG4gICAgICAgICAgICAgICAgT2JqZWN0LmtleXMoZXJyb3IuY29uc3RyYWludHMpLmZvckVhY2goa2V5ID0+IHtcclxuICAgICAgICAgICAgICAgICAgZXJyb3JPYmpba2V5XSA9IHtcclxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUsXHJcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogZXJyb3IuY29uc3RyYWludHNba2V5XSxcclxuICAgICAgICAgICAgICAgICAgICBlcnJvcjogZXJyb3JcclxuICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICAvLyDlhYjorr7nva7lrp7kvZPpqozor4Hkv6Hmga/vvIzlho3orr7nva5mb3Jt6aqM6K+B5L+h5oGv77yM54S25ZCO5ZyoZm9ybS5pc0Zvcm1WYWxpZOWGhemDqOaVtOWQiOWunuS9k+mqjOivgWZvcm3pqozor4Hkv6Hmga9cclxuICAgICAgICAgIEZvcm0udXBkYXRlRXJyb3JzKGNvbnRyb2xQcm9wLCBlcnJvck9iaiwgaWQsIHZhbHVlLCBwYXRoRGF0YS5pc0dyaWQpO1xyXG4gICAgICAgICAgY29uc3QgZm9ybUVycm9ycyA9IHZpZXdDaGFuZ2VbJ2Vycm9ycyddIHx8IHt9O1xyXG4gICAgICAgICAgY29uc3QgbWVyZ2VkRXJyb3JzID0gT2JqZWN0LmFzc2lnbih7fSwgZm9ybUVycm9ycywgZXJyb3JPYmopO1xyXG4gICAgICAgICAgbGV0IHZhbGlkYXRlRXJyb3IgPSBudWxsO1xyXG4gICAgICAgICAgaWYgKE9iamVjdC5rZXlzKG1lcmdlZEVycm9ycykubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICB2YWxpZGF0ZUVycm9yID0geyBbcHJvcGVydHlOYW1lXTogbWVyZ2VkRXJyb3JzIH07XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBpZiAodHlwZW9mIChjYWxsYmFjaykgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgY2FsbGJhY2sodmFsaWRhdGVFcnJvcik7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSwgdmlld0NoYW5nZS5jb250ZXh0KTtcclxuICAgICAgfTtcclxuXHJcbiAgICAgIC8vIOS4jeaYr+S4u+mUruWAvOWtl+auteaXtu+8jOimgeWFiOajgOafpeS4u+mUruaYr+WQpuWtmOWcqO+8jOW5tuS4lOS4u+mUruaYr+WQpuebuOetie+8iOmYsuatouWQjuS7o+WPmOabtOWGkuazoeS4iuadpe+8iVxyXG4gICAgICAvLyDpnZ7kuLvplK7lsZ7mgKflj5jmm7Tml7bvvIzopoHlhYjmo4Dmn6XkuLvplK7mmK/lkKbljLnphY3vvIjlpoLmnpzkuLvplK7kuZ/kv67mlLnkuobvvIzopoHmsYLlhYjkv67mlLnkuLvplK7lho3kv67mlLnlhbbku5blgLzvvIlcclxuICAgICAgaWYgKGJpbmRpbmdPYmplY3QucHJpbWFyeUtleSkge1xyXG4gICAgICAgIGNvbnN0IHByaW1hcnlLZXkgPSBiaW5kaW5nT2JqZWN0LnByaW1hcnlLZXk7XHJcbiAgICAgICAgaWYgKHByb3BlcnR5TmFtZSAhPT0gcHJpbWFyeUtleSkge1xyXG4gICAgICAgICAgaWYgKCFlbnRpdHlbcHJpbWFyeUtleV0gfHwgZW50aXR5W3ByaW1hcnlLZXldICE9PSBiaW5kaW5nT2JqZWN0W3ByaW1hcnlLZXldKSB7XHJcbiAgICAgICAgICAgIGVudGl0eVZhbGlkYXRlKCk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2UgaWYgKGVudGl0eVtwcm9wZXJ0eU5hbWVdICE9PSB2YWx1ZSkge1xyXG4gICAgICAgICAgLy8gdG9kbzog5Zug5byC5q2l5qCh6aqM5pyq57uT5p2f5a6e5L2T5Li76ZSu5rKh5pyJ6KKr6LWL5YC877yM5a+86Ie05a6e5L2T5YW25LuW5bGe5oCn5peg5rOV6LWL5YC877yM5b6F5ZCO57ut5YmN56uv5qCh6aqM6YeN5p6E5pe25Y675o6JXHJcbiAgICAgICAgICBlbnRpdHlbcHJvcGVydHlOYW1lXSA9IHZhbHVlO1xyXG4gICAgICAgICAgZW50aXR5VmFsaWRhdGUoKTtcclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIOWmguaenEJpbmRpbmdPYmplY3TkuIrnmoTlsZ7mgKflgLzlkoxFbnRpdHnkuIrlr7nlupTlsZ7mgKflgLzkuIDmoLfvvIzliJnkuI3lho3orr7nva5cclxuICAgICAgaWYgKGVudGl0eVtwcm9wZXJ0eU5hbWVdID09PSB2YWx1ZSkge1xyXG4gICAgICAgIGVudGl0eVZhbGlkYXRlKCk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyDosIPnlKjooajljZXpqozor4Es6YCa6L+H5ZCO6LCD55So5a6e5L2T6aqM6K+BXHJcbiAgICAgIC8vIGJpbmdkaW5nT2JqZWN05Y+Y5YyW5ZCO77yM5YWI6LCD55So5a6e5L2T5LiK55qE6aqM6K+B77yM6YCa6L+H5ZCO5YaN6K6+572u5a6e5L2T55qE5Y+Y5YqoXHJcbiAgICAgIGVudGl0eVZhbGlkYXRlKChlcnJvcnM6IGFueSkgPT4ge1xyXG4gICAgICAgIGVudGl0eS5lcnJvcnMgPSBlcnJvcnM7XHJcbiAgICAgICAgZW50aXR5W3Byb3BlcnR5TmFtZV0gPSB2YWx1ZTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWwhmVudGl0eUxpc3TkuK3nmoRFbnRpdHnlr7nosaHovazmjaLkuLpCaW5kaW5nT2JqZWN05a+56LGh77yM5Yqg6L295YiwYmluZGluZ0xpc3TkuK3vvIzlubbkv53mjIFlbnRpdHlMaXN05ZKMYmluZGluZ0xpc3TlkIzmraXjgIJcclxuICAgKiBAcGFyYW0gZW50aXR5TGlzdCAg5a6e5L2T5YiX6KGoXHJcbiAgICogQHBhcmFtIGJpbmRpbmdMaXN0IOe7keWumuWIl+ihqFxyXG4gICAqL1xyXG4gIHN0YXRpYyBsb2FkRW50aXR5TGlzdChlbnRpdHlMaXN0OiBFbnRpdHlMaXN0PGFueT4sIGJpbmRpbmdMaXN0OiBCaW5kaW5nTGlzdCkge1xyXG4gICAgdGhpcy5sb2FkRW50aXRpZXMoZW50aXR5TGlzdC5pdGVtcywgYmluZGluZ0xpc3QpO1xyXG4gICAgdGhpcy5zZXRVcEVudGl0eUxpc3RQaXBlbGluZShlbnRpdHlMaXN0LCBiaW5kaW5nTGlzdCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlu7rnq4tlbnRpdHlMaXN05ZKMYmluZGluZ0xpc3TkuYvpl7TnmoTlhbPogZRcclxuICAgKiBAcGFyYW0gZW50aXR5TGlzdCAg5a6e5L2T5YiX6KGoXHJcbiAgICogQHBhcmFtIGJpbmRpbmdMaXN0IOe7keWumuWIl+ihqFxyXG4gICAqL1xyXG4gIHN0YXRpYyBzZXRVcEVudGl0eUxpc3RQaXBlbGluZShlbnRpdHlMaXN0OiBFbnRpdHlMaXN0PGFueT4sIGJpbmRpbmdMaXN0OiBCaW5kaW5nTGlzdCkge1xyXG4gICAgZW50aXR5TGlzdC5vbkxpc3RDaGFuZ2VkLnN1YnNjcmliZSgobW9kaWZpY2F0aW9uOiBNb2RpZmljYXRpb24pID0+IHtcclxuICAgICAgY29uc3QgdGFyZ2V0ID0gbW9kaWZpY2F0aW9uWyd0YXJnZXQnXTtcclxuICAgICAgaWYgKHRhcmdldCAmJiB0YXJnZXQgIT09IGVudGl0eUxpc3QpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgICAgc3dpdGNoIChtb2RpZmljYXRpb24udHlwZSkge1xyXG4gICAgICAgIC8vIOa3u+WKoOWunuS9k1xyXG4gICAgICAgIGNhc2UgTW9kaWZ5VHlwZS5BZGQ6XHJcbiAgICAgICAgY2FzZSBNb2RpZnlUeXBlLkNsb25lOlxyXG4gICAgICAgICAge1xyXG4gICAgICAgICAgICBjb25zdCBlbnRpdGllc1RvQWRkID0gPEVudGl0eVtdPm1vZGlmaWNhdGlvbi52YWx1ZTtcclxuICAgICAgICAgICAgaWYgKGVudGl0aWVzVG9BZGQubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIOajgOafpeeItmlk5piv5ZCm5LiA6Ie077yM5YaS5rOh5a+86Ie055qE5Y+Y5pu05LiN5aSE55CGXHJcbiAgICAgICAgICAgIGNvbnN0IHBhdGhzID0gbW9kaWZpY2F0aW9uLnBhdGg7XHJcbiAgICAgICAgICAgIGNvbnN0IHBhcmVudFBhdGggPSBwYXRoc1twYXRocy5sZW5ndGggLSAyXTtcclxuICAgICAgICAgICAgY29uc3QgcGFyZW50SWQgPSBiaW5kaW5nTGlzdC5wYXJlbnQucHJpbWFyeUtleVZhbHVlO1xyXG4gICAgICAgICAgICBpZiAocGFyZW50UGF0aC5pbmRleE9mKHBhcmVudElkKSA9PT0gLTEpIHtcclxuICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMuYXBwZW5kRW50aXRpZXMoPEVudGl0eVtdPm1vZGlmaWNhdGlvbi52YWx1ZSwgYmluZGluZ0xpc3QsIG1vZGlmaWNhdGlvbi50eXBlID09PSBNb2RpZnlUeXBlLkNsb25lKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgTW9kaWZ5VHlwZS5JbnNlcnQ6XHJcbiAgICAgICAgICB7XHJcbiAgICAgICAgICAgIC8vIOajgOafpeeItmlk5piv5ZCm5LiA6Ie077yM5YaS5rOh5a+86Ie055qE5Y+Y5pu05LiN5aSE55CGXHJcbiAgICAgICAgICAgIGNvbnN0IHBhdGhzID0gbW9kaWZpY2F0aW9uLnBhdGg7XHJcbiAgICAgICAgICAgIGNvbnN0IHBhcmVudFBhdGggPSBwYXRoc1twYXRocy5sZW5ndGggLSAyXTtcclxuICAgICAgICAgICAgY29uc3QgcGFyZW50SWQgPSBiaW5kaW5nTGlzdC5wYXJlbnQucHJpbWFyeUtleVZhbHVlO1xyXG4gICAgICAgICAgICBjb25zdCBwb3NpdGlvbiA9IG1vZGlmaWNhdGlvbi5wb3NpdGlvbjtcclxuICAgICAgICAgICAgaWYgKHBhcmVudFBhdGguaW5kZXhPZihwYXJlbnRJZCkgPT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuaW5zZXJ0RW50aXR5KG1vZGlmaWNhdGlvbi52YWx1ZVswXSwgYmluZGluZ0xpc3QsIHBvc2l0aW9uKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIC8vIOWIoOmZpOWunuS9k1xyXG4gICAgICAgIGNhc2UgTW9kaWZ5VHlwZS5SZW1vdmU6XHJcbiAgICAgICAgICB7XHJcbiAgICAgICAgICAgIC8vIOajgOafpeeItmlk5piv5ZCm5LiA6Ie077yM5YaS5rOh5a+86Ie055qE5Y+Y5pu05LiN5aSE55CGXHJcbiAgICAgICAgICAgIGNvbnN0IHBhdGhzID0gbW9kaWZpY2F0aW9uLnBhdGg7XHJcbiAgICAgICAgICAgIGNvbnN0IHBhcmVudFBhdGggPSBwYXRoc1twYXRocy5sZW5ndGggLSAyXTtcclxuICAgICAgICAgICAgY29uc3QgcGFyZW50SWQgPSBiaW5kaW5nTGlzdC5wYXJlbnQucHJpbWFyeUtleVZhbHVlO1xyXG4gICAgICAgICAgICBpZiAocGFyZW50UGF0aC5pbmRleE9mKHBhcmVudElkKSA9PT0gLTEpIHtcclxuICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8g5Yig6Zmk5a6e5L2T77yIdmFsdWXmoLzlvI/lvoXllYbmprfvvIznm67liY12YWx1ZeeahOagvOW8j+S4uiB7IHByaW1hcnlLZXk6IHByaW1hcnlWYWx1ZX3vvIlcclxuICAgICAgICAgICAgY29uc3QgaWQgPSBtb2RpZmljYXRpb24udmFsdWVbYmluZGluZ0xpc3QucHJpbWFyeUtleV07XHJcbiAgICAgICAgICAgIGJpbmRpbmdMaXN0LnJlbW92ZUJ5SWRzKFtpZF0pO1xyXG4gICAgICAgICAgICAvLyB0aGlzLnJlbW92ZUVudGl0aWVzKDxFbnRpdHlbXT5tb2RpZmljYXRpb24udmFsdWUsIGJpbmRpbmdMaXN0KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAvLyDliqDovb3lrp7kvZNcclxuICAgICAgICBjYXNlIE1vZGlmeVR5cGUuTG9hZDpcclxuICAgICAgICAgIC8vIOajgOafpeeItmlk5piv5ZCm5LiA6Ie077yM5YaS5rOh5a+86Ie055qE5Y+Y5pu05LiN5aSE55CGXHJcbiAgICAgICAgICBjb25zdCBwYXRocyA9IG1vZGlmaWNhdGlvbi5wYXRoO1xyXG4gICAgICAgICAgY29uc3QgcGFyZW50UGF0aCA9IHBhdGhzW3BhdGhzLmxlbmd0aCAtIDJdO1xyXG4gICAgICAgICAgY29uc3QgcGFyZW50SWQgPSBiaW5kaW5nTGlzdC5wYXJlbnQucHJpbWFyeUtleVZhbHVlO1xyXG4gICAgICAgICAgaWYgKHBhcmVudFBhdGguaW5kZXhPZihwYXJlbnRJZCkgPT09IC0xKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGNvbnN0IGVudGl0aWVzID0gbW9kaWZpY2F0aW9uLnZhbHVlO1xyXG4gICAgICAgICAgdGhpcy5sb2FkRW50aXRpZXMoZW50aXRpZXMsIGJpbmRpbmdMaXN0KTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDnm5HlkKxyZXBvc2l0b3J55Y+Y5YyW77yM5L+d5oyBcmVwb3NpdG9yeeWSjGJpbmRpbmdMaXN05ZCM5q2l44CCXHJcbiAgICogQHBhcmFtIHJlcG9zaXRvcnkgIOWunuS9k+S7k+W6k1xyXG4gICAqIEBwYXJhbSBiaW5kaW5nTGlzdCDnu5HlrprliJfooahcclxuICAgKi9cclxuICBzdGF0aWMgbG9hZFJlcG9zaXRvcnkocmVwb3NpdG9yeTogUmVwb3NpdG9yeTxhbnk+LCBiaW5kaW5nTGlzdDogQmluZGluZ0xpc3QpIHtcclxuICAgIC8vIOWIneasoeWKoOi9vVxyXG4gICAgY29uc3QgZW50aXRpZXMgPSBBcnJheS5mcm9tKHJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi50b0FycmF5KCkpO1xyXG4gICAgdGhpcy5sb2FkRW50aXRpZXMoZW50aXRpZXMsIGJpbmRpbmdMaXN0KTtcclxuXHJcbiAgICAvLyDnm5HlkKzlj5jljJZcclxuICAgIHJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbkNoYW5nZS5waXBlKHRha2VVbnRpbChyZXBvc2l0b3J5LmRlc3Ryb3kkKSkuc3Vic2NyaWJlKChtb2RpZmljYXRpb246IE1vZGlmaWNhdGlvbikgPT4ge1xyXG4gICAgICBzd2l0Y2ggKG1vZGlmaWNhdGlvbi50eXBlKSB7XHJcbiAgICAgICAgY2FzZSBNb2RpZnlUeXBlLkxvYWQ6XHJcbiAgICAgICAgICBiaW5kaW5nTGlzdC5jbGVhcih0cnVlKTtcclxuICAgICAgICAgIHRoaXMubG9hZEVudGl0aWVzKDxFbnRpdHlbXT5tb2RpZmljYXRpb24udmFsdWUsIGJpbmRpbmdMaXN0LCBtb2RpZmljYXRpb24uZW50aXR5Q3JlYXRlKTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgTW9kaWZ5VHlwZS5BZGQ6XHJcbiAgICAgICAgY2FzZSBNb2RpZnlUeXBlLkNsb25lOlxyXG4gICAgICAgICAgdGhpcy5hcHBlbmRFbnRpdGllcyg8RW50aXR5W10+bW9kaWZpY2F0aW9uLnZhbHVlLCBiaW5kaW5nTGlzdCwgbW9kaWZpY2F0aW9uLnR5cGUgPT09IE1vZGlmeVR5cGUuQ2xvbmUpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBNb2RpZnlUeXBlLkFkZERhdGE6XHJcbiAgICAgICAgICB0aGlzLmFkZERhdGEoPEVudGl0eVtdPm1vZGlmaWNhdGlvbi52YWx1ZSwgYmluZGluZ0xpc3QpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBNb2RpZnlUeXBlLkluc2VydDpcclxuICAgICAgICAgIHRoaXMuaW5zZXJ0RW50aXR5KG1vZGlmaWNhdGlvbi52YWx1ZSwgYmluZGluZ0xpc3QsIG1vZGlmaWNhdGlvbi5wb3NpdGlvbik7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIE1vZGlmeVR5cGUuUmVtb3ZlOlxyXG4gICAgICAgICAgdGhpcy5yZW1vdmVFbnRpdGllcyg8RW50aXR5W10+bW9kaWZpY2F0aW9uLnZhbHVlLCBiaW5kaW5nTGlzdCk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIE1vZGlmeVR5cGUuUmVtb3ZlRGF0YTpcclxuICAgICAgICAgIHRoaXMucmVtb3ZlRGF0YSg8RW50aXR5W10+bW9kaWZpY2F0aW9uLnZhbHVlLCBiaW5kaW5nTGlzdCk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIE1vZGlmeVR5cGUuUGFnaW5hdGlvbkluZm9DaGFuZ2U6XHJcbiAgICAgICAgICAvLyDliIbpobXkv6Hmga/ml6DpnIDlkIzmraXliLBiaW5kaW5nTGlzdO+8jOaUvuWIsGJpbmRpbmdEYXRh5Y2z5Y+v44CC5L+d55WZ5q2k5aSE5Y+q5piv5Li65LqG5YW85a655Lqn5ZOB6YOo5Y+v6IO95L2/55SoYmluZGluZ0xpc3TkuIrliIbpobXkv6Hmga/nmoTlnLrmma9cclxuICAgICAgICAgIGJpbmRpbmdMaXN0LnBhZ2luYXRpb25JbmZvID0gPFBhZ2luYXRpb24+bW9kaWZpY2F0aW9uLnZhbHVlO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyDnm5HlkKxCaW5kaW5nTGlzdOaVsOaNruWPmOWMllxyXG4gICAgYmluZGluZ0xpc3QuY2hhbmdlcy5waXBlKHRha2VVbnRpbChiaW5kaW5nTGlzdC5kZXN0cm95JCkpLnN1YnNjcmliZSgoY2hhbmdlOiBDaGFuZ2UpID0+IHtcclxuICAgICAgaWYgKGNoYW5nZS50eXBlID09PSBDaGFuZ2VUeXBlLlBhZ2luYXRpb25JbmZvQ2hhbmdlKSB7XHJcbiAgICAgICAgY29uc3QgZW50aXR5Q29sbGVjdGlvbiA9IHJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbjtcclxuICAgICAgICAvLyBjb25zdCBlbnRpdHlUeXBlTmFtZSA9IGVudGl0eUNvbGxlY3Rpb24uZW50aXR5VHlwZU5hbWU7XHJcbiAgICAgICAgLy8gY29uc3Qgb3JpZ2luYWwgPSBlbnRpdHlDb2xsZWN0aW9uLnBhZ2luYXRpb25JbmZvW2VudGl0eVR5cGVOYW1lXTtcclxuICAgICAgICAvLyBjb25zdCBlbnRpdHlQYWdpbmF0aW9uSW5mbyA9IE9iamVjdC5hc3NpZ24oe30sIG9yaWdpbmFsLCBjaGFuZ2UudmFsdWUpO1xyXG4gICAgICAgIGVudGl0eUNvbGxlY3Rpb24ucGFnaW5hdGlvbkluZm8gPSBPYmplY3QuYXNzaWduKHt9LCBlbnRpdHlDb2xsZWN0aW9uLnBhZ2luYXRpb25JbmZvLCBjaGFuZ2UudmFsdWUpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWwhmVudGl0aWVz5Lit55qERW50aXR55a+56LGh6L2s5o2i5Li6QmluZGluZ09iamVjdOWvueixoe+8jOW5tuWKoOi9veWIsGJpbmRpbmdMaXN05LitXHJcbiAgICogQHBhcmFtIGVudGl0aWVzICAgIOWunuS9k+aVsOe7hFxyXG4gICAqIEBwYXJhbSBiaW5kaW5nTGlzdCDnu5HlrprliJfooahcclxuICAgKi9cclxuICBzdGF0aWMgbG9hZEVudGl0aWVzKGVudGl0aWVzOiBFbnRpdHlbXSwgYmluZGluZ0xpc3Q6IEJpbmRpbmdMaXN0LCBlbnRpdHlDcmVhdGU6IGJvb2xlYW4gPSBmYWxzZSkge1xyXG4gICAgY29uc3QgYmluZGluZ09iamVjdHMgPSB0aGlzLmNyZWF0ZUJpbmRpbmdPYmplY3RzKGVudGl0aWVzLCBiaW5kaW5nTGlzdCk7XHJcbiAgICBiaW5kaW5nTGlzdC5sb2FkKGJpbmRpbmdPYmplY3RzLCBlbnRpdHlDcmVhdGUpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5bCGZW50aXRpZXPkuK3nmoRFbnRpdHnlr7nosaHovazmjaLkuLpCSW5kaW5nT2JqZWN05a+56LGh77yM5bm26L+95Yqg5YiwYmluZGluZ0xpc3TkuK1cclxuICAgKiBAcGFyYW0gZW50aXRpZXMgICAg5a6e5L2T5pWw57uEXHJcbiAgICogQHBhcmFtIGJpbmRpbmdMaXN0IOe7keWumuWIl+ihqFxyXG4gICAqL1xyXG4gIHN0YXRpYyBhcHBlbmRFbnRpdGllcyhlbnRpdGllczogRW50aXR5W10sIGJpbmRpbmdMaXN0OiBCaW5kaW5nTGlzdCwgaXNDbG9uZWQ6IGJvb2xlYW4gPSBmYWxzZSkge1xyXG4gICAgY29uc3QgYmluZGluZ09iamVjdHMgPSB0aGlzLmNyZWF0ZUJpbmRpbmdPYmplY3RzKGVudGl0aWVzLCBiaW5kaW5nTGlzdCk7XHJcbiAgICBiaW5kaW5nTGlzdC5hcHBlbmQoYmluZGluZ09iamVjdHMsIGlzQ2xvbmVkKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5piv5ZCm5piv5pyJ5pWI55qE5a2X5q61XHJcbiAgICogQHBhcmFtIGVudGl0eSDlrp7kvZNcclxuICAgKiBAcGFyYW0gcHJvcGVydHlOYW1lIOWtl+autVxyXG4gICAqIEByZXR1cm5zIFxyXG4gICAqL1xyXG4gIHN0YXRpYyBpc0VmZmVjdGl2ZUZpZWxkKGVudGl0eTogRW50aXR5LCBwcm9wZXJ0eU5hbWU6IHN0cmluZykge1xyXG4gICAgaWYgKCFlbnRpdHkgfHwgIXByb3BlcnR5TmFtZSkge1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBwcm9wZXJ0eU5hbWUgPSBwcm9wZXJ0eU5hbWUudG9Mb3dlckNhc2UoKTtcclxuICAgIGlmIChlbnRpdHlbJ19fZmFycmlzX2VmZmVjdGl2ZV9maWVsZHNfXyddKSB7XHJcbiAgICAgIHJldHVybiBlbnRpdHlbJ19fZmFycmlzX2VmZmVjdGl2ZV9maWVsZHNfXyddLmluY2x1ZGVzKHByb3BlcnR5TmFtZSk7XHJcbiAgICB9XHJcbiAgICBpZiAoZW50aXR5WydmYXJyaXNfZWZmZWN0aXZlX2ZpZWxkcyddICYmIHR5cGVvZiBlbnRpdHlbJ2ZhcnJpc19lZmZlY3RpdmVfZmllbGRzJ10gPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgIGNvbnN0IGVmZmVjdGl2ZUZpZWxkcyA9IGVudGl0eVsnZmFycmlzX2VmZmVjdGl2ZV9maWVsZHMnXS5zcGxpdCgnLCcpLmZpbHRlcihwID0+IHApLm1hcChpdGVtID0+IGl0ZW0udG9Mb3dlckNhc2UoKSk7XHJcbiAgICAgIGVudGl0eVsnX19mYXJyaXNfZWZmZWN0aXZlX2ZpZWxkc19fJ10gPSBlZmZlY3RpdmVGaWVsZHM7XHJcbiAgICAgIHJldHVybiBlZmZlY3RpdmVGaWVsZHMuaW5jbHVkZXMocHJvcGVydHlOYW1lKTtcclxuICAgIH1cclxuICAgIHJldHVybiB0cnVlO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDlop7liqDlrp7kvZPmlbDmja7vvIjkuI3liIfmjaLlvZPliY3ooYzvvIlcclxuICAgKiBAcGFyYW0gZW50aXRpZXMgXHJcbiAgICogQHBhcmFtIGJpbmRpbmdMaXN0IFxyXG4gICAqL1xyXG4gIHN0YXRpYyBhZGREYXRhKGVudGl0aWVzOiBFbnRpdHlbXSwgYmluZGluZ0xpc3Q6IEJpbmRpbmdMaXN0KSB7XHJcbiAgICBjb25zdCBiaW5kaW5nT2JqZWN0cyA9IHRoaXMuY3JlYXRlQmluZGluZ09iamVjdHMoZW50aXRpZXMsIGJpbmRpbmdMaXN0KTtcclxuICAgIGJpbmRpbmdMaXN0LmFkZERhdGEoYmluZGluZ09iamVjdHMpO1xyXG4gIH1cclxuICBzdGF0aWMgaW5zZXJ0RW50aXR5KGVudGl0eTogRW50aXR5LCBiaW5kaW5nTGlzdDogQmluZGluZ0xpc3QsIHBvc2l0aW9uOiAtMSB8IDEpIHtcclxuICAgIGNvbnN0IGJpbmRpbmdPYmplY3QgPSB0aGlzLmNyZWF0ZUJpbmRpbmdPYmplY3QoZW50aXR5LCBiaW5kaW5nTGlzdCk7XHJcbiAgICBiaW5kaW5nTGlzdC5pbnNlcnQoYmluZGluZ09iamVjdCwgcG9zaXRpb24pO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDku45iaW5kaW5nTGlzdOenu+mZpGVudGl0aWVz5a+55bqU55qEQmluZGluZ09iamVjdOWvueixoVxyXG4gICAqIEBwYXJhbSBlbnRpdGllcyAgICDlrp7kvZPmlbDnu4RcclxuICAgKiBAcGFyYW0gYmluZGluZ0xpc3Qg57uR5a6a5YiX6KGoXHJcbiAgICovXHJcbiAgc3RhdGljIHJlbW92ZUVudGl0aWVzKGVudGl0aWVzOiBFbnRpdHlbXSwgYmluZGluZ0xpc3Q6IEJpbmRpbmdMaXN0KSB7XHJcbiAgICBpZiAoZW50aXRpZXMgPT09IG51bGwgfHwgZW50aXRpZXMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICAvLyDlvZLpm4bopoHliKDpmaTnmoRpZOaVsOe7hFxyXG4gICAgY29uc3QgcHJpbWFyeUtleSA9IGJpbmRpbmdMaXN0LnByaW1hcnlLZXk7XHJcbiAgICBjb25zdCBpZHMgPSBbXTtcclxuICAgIGVudGl0aWVzLmZvckVhY2goKGVudGl0eTogRW50aXR5KSA9PiB7XHJcbiAgICAgIGlkcy5wdXNoKGVudGl0eVtwcmltYXJ5S2V5XSk7XHJcbiAgICB9KTtcclxuICAgIGJpbmRpbmdMaXN0LnJlbW92ZUJ5SWRzKGlkcyk7XHJcbiAgfVxyXG4gIHN0YXRpYyByZW1vdmVEYXRhKGVudGl0aWVzOiBFbnRpdHlbXSwgYmluZGluZ0xpc3Q6IEJpbmRpbmdMaXN0KSB7XHJcbiAgICBpZiAoZW50aXRpZXMgPT09IG51bGwgfHwgZW50aXRpZXMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIC8vIOW9kumbhuimgeWIoOmZpOeahGlk5pWw57uEXHJcbiAgICBjb25zdCBwcmltYXJ5S2V5ID0gYmluZGluZ0xpc3QucHJpbWFyeUtleTtcclxuICAgIGNvbnN0IGlkcyA9IFtdO1xyXG4gICAgZW50aXRpZXMuZm9yRWFjaCgoZW50aXR5OiBFbnRpdHkpID0+IHtcclxuICAgICAgaWRzLnB1c2goZW50aXR5W3ByaW1hcnlLZXldKTtcclxuICAgIH0pO1xyXG4gICAgYmluZGluZ0xpc3QucmVtb3ZlRGF0YUJ5SWRzKGlkcyk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWwhmVudGl0aWVz5Lit55qERW50aXR55a+56LGh6L2s5o2i5Li6QmluZGluZ09iamVjdOWvueixoVxyXG4gICAqIEBwYXJhbSBlbnRpdGllcyAgICDlrp7kvZPmlbDnu4RcclxuICAgKiBAcGFyYW0gYmluZGluZ0xpc3Qg57uR5a6a5YiX6KGoXHJcbiAgICovXHJcbiAgc3RhdGljIGNyZWF0ZUJpbmRpbmdPYmplY3RzKGVudGl0aWVzOiBFbnRpdHlbXSwgYmluZGluZ0xpc3Q6IEJpbmRpbmdMaXN0KSB7XHJcbiAgICBpZiAoZW50aXRpZXMgPT09IG51bGwgfHwgZW50aXRpZXMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIHJldHVybiBbXTtcclxuICAgIH1cclxuICAgIGNvbnN0IGJpbmRpbmdPYmplY3RzID0gW107XHJcbiAgICBlbnRpdGllcy5mb3JFYWNoKChlbnRpdHk6IEVudGl0eSkgPT4ge1xyXG4gICAgICBjb25zdCBiaW5kaW5nT2JqZWN0ID0gQmluZGluZ09iamVjdEZhY3RvcnkuY3JlYXRlKGJpbmRpbmdMaXN0LnByb3BlcnRpZXMpO1xyXG4gICAgICBiaW5kaW5nT2JqZWN0WydfRU5USVRZXyddID0gZW50aXR5O1xyXG4gICAgICB0aGlzLmxvYWRFbnRpdHkoZW50aXR5LCBiaW5kaW5nT2JqZWN0KTtcclxuXHJcbiAgICAgIC8vIC8vIOS4umJpbmRpbmdPYmplY3Torr7nva7pu5jorqTlgLxpbml0aWFsRGF0YeWxnuaAp1xyXG4gICAgICAvLyBpZiAoZW50aXR5Wydpbml0aWFsRGF0YSddKSB7XHJcbiAgICAgIC8vICAgYmluZGluZ09iamVjdFsnaW5pdGlhbERhdGEnXSA9IGVudGl0eVsnaW5pdGlhbERhdGEnXTtcclxuICAgICAgLy8gfVxyXG4gICAgICBiaW5kaW5nT2JqZWN0cy5wdXNoKGJpbmRpbmdPYmplY3QpO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gYmluZGluZ09iamVjdHM7XHJcbiAgfVxyXG4gIHN0YXRpYyBjcmVhdGVCaW5kaW5nT2JqZWN0KGVudGl0eTogRW50aXR5LCBiaW5kaW5nTGlzdDogQmluZGluZ0xpc3QpIHtcclxuICAgIGNvbnN0IGJpbmRpbmdPYmplY3QgPSBCaW5kaW5nT2JqZWN0RmFjdG9yeS5jcmVhdGUoYmluZGluZ0xpc3QucHJvcGVydGllcyk7XHJcbiAgICB0aGlzLmxvYWRFbnRpdHkoZW50aXR5LCBiaW5kaW5nT2JqZWN0KTtcclxuICAgIHJldHVybiBiaW5kaW5nT2JqZWN0O1xyXG4gIH1cclxuICBwdWJsaWMgc3RhdGljIHdhdGNoUmVwb3Npcm90eShyZXBvc2l0b3J5OiBSZXBvc2l0b3J5PGFueT4sIGJpbmRpbmdEYXRhOiBCaW5kaW5nRGF0YSkge1xyXG4gICAgLy8gcmVwb3Npcm90eSA9PiBiaW5kaW5nRGF0YVxyXG4gICAgcmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uQ2hhbmdlLnN1YnNjcmliZSgobW9kaWZpY2F0aW9uOiBNb2RpZmljYXRpb24pID0+IHtcclxuICAgICAgc3dpdGNoIChtb2RpZmljYXRpb24udHlwZSkge1xyXG4gICAgICAgIGNhc2UgTW9kaWZ5VHlwZS5QYWdpbmF0aW9uSW5mb0NoYW5nZTpcclxuICAgICAgICAgIGJpbmRpbmdEYXRhLnBhZ2luZ0luZm8gPSBtb2RpZmljYXRpb24udmFsdWU7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmn6Xmib7lsZ7mgKfnmoTnsbvlnotcclxuICAgKiBAcGFyYW0gZW50aXR5VHlwZSDlrp7kvZPnsbvlnotcclxuICAgKiBAcGFyYW0gdGFyZ2V0UHJvcE5hbWUg5bGe5oCn5ZCN56ewXHJcbiAgICogQHJldHVybiDlsZ7mgKfkv6Hmga/vvIzljIXlkKvlsZ7mgKfnsbvlnovvvIhOZ0ZpZWxk44CBTmdPYmplY3TjgIFOZ0xpc3TvvInlkozlsZ7mgKflr7nlupTnmoTlrp7kvZPnsbvlnovvvIjlvZNOZ0ZpZWxk57G75Z6L5pe25Li6bnVsbO+8iVxyXG4gICAqL1xyXG4gIHN0YXRpYyBnZXRQcm9wSW5mbyhlbnRpdHlUeXBlOiBhbnksIHRhcmdldFByb3BOYW1lOiBzdHJpbmcpOiB7IHByb3BUeXBlOiBzdHJpbmcsIHByb3BFbnRpdHlUeXBlOiBhbnkgfSB7XHJcblxyXG4gICAgbGV0IHByb3BUeXBlOiBzdHJpbmc7XHJcbiAgICBsZXQgcHJvcEVudGl0eVR5cGU6IGFueTtcclxuXHJcbiAgICAvLyBOZ0ZpZWxkXHJcbiAgICBjb25zdCBuZ0ZpZWxkUHJvcGVydGllcyA9IEZpZWxkTWV0YWRhdGFVdGlsLmdldE5nRmllbGRzKGVudGl0eVR5cGUpO1xyXG4gICAgT2JqZWN0LmtleXMobmdGaWVsZFByb3BlcnRpZXMpLmZvckVhY2goKHByb3BOYW1lOiBzdHJpbmcpID0+IHtcclxuICAgICAgaWYgKHByb3BOYW1lID09PSB0YXJnZXRQcm9wTmFtZSkge1xyXG4gICAgICAgIHByb3BUeXBlID0gJ05nRmllbGQnO1xyXG4gICAgICAgIHByb3BFbnRpdHlUeXBlID0gbnVsbDtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gTmdPYmplY3RcclxuICAgIGNvbnN0IG5nT2JqZWN0UHJvcGVydGllcyA9IEZpZWxkTWV0YWRhdGFVdGlsLmdldE5nT2JqZWN0cyhlbnRpdHlUeXBlKTtcclxuICAgIE9iamVjdC5rZXlzKG5nT2JqZWN0UHJvcGVydGllcykuZm9yRWFjaCgocHJvcE5hbWU6IHN0cmluZykgPT4ge1xyXG4gICAgICBpZiAocHJvcE5hbWUgPT09IHRhcmdldFByb3BOYW1lKSB7XHJcbiAgICAgICAgcHJvcFR5cGUgPSAnTmdPYmplY3QnO1xyXG4gICAgICAgIHByb3BFbnRpdHlUeXBlID0gbmdPYmplY3RQcm9wZXJ0aWVzW3Byb3BOYW1lXS50eXBlO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBOZ0xpc3RcclxuICAgIGNvbnN0IG5nTGlzdFByb3BlcnRpZXMgPSBGaWVsZE1ldGFkYXRhVXRpbC5nZXROZ0xpc3QoZW50aXR5VHlwZSk7XHJcbiAgICBPYmplY3Qua2V5cyhuZ0xpc3RQcm9wZXJ0aWVzKS5mb3JFYWNoKChwcm9wTmFtZTogc3RyaW5nKSA9PiB7XHJcbiAgICAgIGlmIChwcm9wTmFtZSA9PT0gdGFyZ2V0UHJvcE5hbWUpIHtcclxuICAgICAgICBwcm9wVHlwZSA9ICdOZ0xpc3QnO1xyXG4gICAgICAgIHByb3BFbnRpdHlUeXBlID0gbmdMaXN0UHJvcGVydGllc1twcm9wTmFtZV0udHlwZTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgY29uc3QgbmdEeW5hbWljUHJvcGVydGllcyA9IEZpZWxkTWV0YWRhdGFVdGlsLmdldE5nRHluYW1pYyhlbnRpdHlUeXBlKTtcclxuICAgIE9iamVjdC5rZXlzKG5nRHluYW1pY1Byb3BlcnRpZXMpLmZvckVhY2goKHByb3BOYW1lOiBzdHJpbmcpID0+IHtcclxuICAgICAgaWYgKHByb3BOYW1lID09PSB0YXJnZXRQcm9wTmFtZSkge1xyXG4gICAgICAgIHByb3BUeXBlID0gJ05nRHluYW1pYyc7XHJcbiAgICAgICAgcHJvcEVudGl0eVR5cGUgPSBuZ0R5bmFtaWNQcm9wZXJ0aWVzW3Byb3BOYW1lXS50eXBlO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4geyBwcm9wVHlwZSwgcHJvcEVudGl0eVR5cGUgfTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluWunuS9k+eahOS4u+mUruWQjVxyXG4gICAqIEBwYXJhbSBlbnRpdHlUeXBlIOWunuS9k+exu+Wei1xyXG4gICAqL1xyXG4gIHN0YXRpYyBnZXRQcmltYXJ5S2V5KGVudGl0eVR5cGU6IGFueSkge1xyXG4gICAgY29uc3QgcHJpbWFyeU5nRmlsZWRQcm9wID0gRmllbGRNZXRhZGF0YVV0aWwuZ2V0UHJpbWFyeUZpZWxkTWV0YWRhdGEoZW50aXR5VHlwZSk7XHJcbiAgICBpZiAocHJpbWFyeU5nRmlsZWRQcm9wKSB7XHJcbiAgICAgIHJldHVybiBwcmltYXJ5TmdGaWxlZFByb3AuZGF0YUZpZWxkO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuICcnO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5piv5ZCm5Li65a+56LGh5bGe5oCnXHJcbiAgICovXHJcbiAgc3RhdGljIGlzT2JqZWN0UHJvcChlbnRpdHlUeXBlOiBhbnksIHRhcmdldFByb3BOYW1lOiBzdHJpbmcsKSB7XHJcbiAgICBsZXQgaXNPYmplY3RQcm9wID0gZmFsc2U7XHJcbiAgICBjb25zdCBuZ09iamVjdFByb3BlcnRpZXMgPSBGaWVsZE1ldGFkYXRhVXRpbC5nZXROZ09iamVjdHMoZW50aXR5VHlwZSk7XHJcbiAgICBPYmplY3Qua2V5cyhuZ09iamVjdFByb3BlcnRpZXMpLmZvckVhY2goKHByb3BOYW1lOiBzdHJpbmcpID0+IHtcclxuICAgICAgaWYgKHByb3BOYW1lID09PSB0YXJnZXRQcm9wTmFtZSkge1xyXG4gICAgICAgIGlzT2JqZWN0UHJvcCA9IHRydWU7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIGlzT2JqZWN0UHJvcDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOajgOafpeaYr+WQpuaYr+WKqOaAgeWIl+WxnuaAp1xyXG4gICAqL1xyXG4gIHN0YXRpYyBpc0R5bmFtaWNQcm9wKGVudGl0eVR5cGU6IGFueSwgdGFyZ2V0UHJvcE5hbWU6IHN0cmluZykge1xyXG4gICAgbGV0IGlzRHluYW1pY1Byb3AgPSBmYWxzZTtcclxuICAgIGNvbnN0IG5nRHluYW1pY1Byb3BlcnRpZXMgPSBGaWVsZE1ldGFkYXRhVXRpbC5nZXROZ0R5bmFtaWMoZW50aXR5VHlwZSk7XHJcbiAgICBPYmplY3Qua2V5cyhuZ0R5bmFtaWNQcm9wZXJ0aWVzKS5mb3JFYWNoKChwcm9wTmFtZTogc3RyaW5nKSA9PiB7XHJcbiAgICAgIGlmIChwcm9wTmFtZSA9PT0gdGFyZ2V0UHJvcE5hbWUpIHtcclxuICAgICAgICBpc0R5bmFtaWNQcm9wID0gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gaXNEeW5hbWljUHJvcDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOS4uuWunuS9k+WinuWKoGluaXRpYWxEYXRh5bGe5oCnXHJcbiAgICogQHBhcmFtIGVudGl0eSDlrp7kvZPlrp7kvotcclxuICAgKiBAcGFyYW0gaW5pdGlhbERhdGEg6buY6K6k5YC85a+56LGhXHJcbiAgICovXHJcbiAgc3RhdGljIGFwcGVuZEluaXRpYWxEYXRhKGVudGl0eSwgaW5pdGlhbERhdGEpIHtcclxuICAgIGNvbnN0IGRhdGEgPSBPYmplY3QuYXNzaWduKHt9LCBpbml0aWFsRGF0YSk7XHJcbiAgICBkZWxldGUgZGF0YS5pZDtcclxuICAgIGRlbGV0ZSBkYXRhLnBhcmVudElEO1xyXG4gICAgZW50aXR5Wydpbml0aWFsRGF0YSddID0gZGF0YTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCB7IEVudGl0eVV0aWwgfTtcclxuIl19