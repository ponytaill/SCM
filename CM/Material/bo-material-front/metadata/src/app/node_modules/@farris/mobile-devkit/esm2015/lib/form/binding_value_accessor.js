import { BindingPathConverter, DateUtil } from '../utils/index';
import { BindingType } from './types';
/**
 * Entity值访问器
 */
class EntityBindingValueAccessor {
    constructor(bindingData, bindingPath, valueConverter) {
        this.bindingData = bindingData;
        this.bindingPathSegments = this.getBindingPathSegments(bindingPath);
        this.valueConverter = valueConverter;
    }
    getValue() {
        const stateValue = this.bindingData.getValue(this.bindingPathSegments);
        const controlValue = this.valueConverter ? this.valueConverter.convertTo(stateValue) : stateValue;
        return controlValue;
    }
    setValue(controlValue) {
        const oldStateValue = this.bindingData.getValue(this.bindingPathSegments);
        const stateValue = this.valueConverter ? this.valueConverter.convertFrom(controlValue) : controlValue;
        if (this.isDateConverter(this.valueConverter) === true) {
            if (DateUtil.isEqual(oldStateValue, stateValue) === true) {
                return;
            }
        }
        this.bindingData.setValue(this.bindingPathSegments, stateValue, true, true);
    }
    getBindingPathSegments(bindingPath) {
        const parentPathSegments = BindingPathConverter.toBindingPathArray(this.bindingData.bindingPath);
        bindingPath = bindingPath.replace(/\./g, '\/');
        const bindingPathSegments = BindingPathConverter.toBindingPathArray(bindingPath);
        return parentPathSegments.concat(bindingPathSegments);
    }
    /**
     * 是否是DateConverter
     */
    isDateConverter(converter) {
        let isDateConverter = false;
        if (converter && converter.hasOwnProperty('format') === true) {
            isDateConverter = true;
        }
        return isDateConverter;
    }
}
/**
 * UIState值访问器
 */
class UIStateBindingValueAccessor {
    constructor(uiState, bindingPath, valueConverter) {
        this.uiState = uiState;
        this.bindingPathSegments = this.getUiStateBindingPath(bindingPath);
    }
    getValue() {
        let stateValue;
        let obj = this.uiState;
        this.bindingPathSegments.forEach(item => {
            stateValue = obj[item];
            obj = stateValue;
        });
        return stateValue;
    }
    setValue(controlValue) {
        const length = this.bindingPathSegments.length;
        if (length === 1) {
            this.uiState.setPropertyValue(this.bindingPathSegments, controlValue);
        }
        else {
            let obj;
            for (let i = length - 1; i > 0; i--) {
                obj = { [this.bindingPathSegments[i]]: controlValue };
                controlValue = obj;
            }
            this.uiState.setPropertyValue(this.bindingPathSegments[0], obj);
        }
    }
    // UISTATE获取路径
    getUiStateBindingPath(bindingPath) {
        const index = bindingPath.search('/');
        if (index !== -1) {
            return bindingPath.split('/');
        }
        else {
            return [bindingPath];
        }
    }
}
/**
 * 绑定值访问器工厂
 */
class BindingValueAccessorFactory {
    static create(bindingType, bindingBindingPath, bindingValueConverter, viewModelContext) {
        switch (bindingType) {
            case BindingType.EntityState:
                const bindingData = viewModelContext.bindingData;
                return new EntityBindingValueAccessor(bindingData, bindingBindingPath, bindingValueConverter);
            case BindingType.UIState:
                const uiState = viewModelContext.uiState;
                return new UIStateBindingValueAccessor(uiState, bindingBindingPath, bindingValueConverter);
            default:
                throw new Error('Not Supported');
        }
    }
}
export { EntityBindingValueAccessor, UIStateBindingValueAccessor, BindingValueAccessorFactory };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmluZGluZ192YWx1ZV9hY2Nlc3Nvci5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvbW9iaWxlLWRldmtpdC8iLCJzb3VyY2VzIjpbImxpYi9mb3JtL2JpbmRpbmdfdmFsdWVfYWNjZXNzb3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBR0EsT0FBTyxFQUFFLG9CQUFvQixFQUFFLFFBQVEsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRWhFLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxTQUFTLENBQUM7QUFhdEM7O0dBRUc7QUFDSCxNQUFNLDBCQUEwQjtJQVE5QixZQUFZLFdBQXdCLEVBQUUsV0FBbUIsRUFBRSxjQUFxQztRQUM5RixJQUFJLENBQUMsV0FBVyxHQUFHLFdBQVcsQ0FBQztRQUMvQixJQUFJLENBQUMsbUJBQW1CLEdBQUcsSUFBSSxDQUFDLHNCQUFzQixDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQ3BFLElBQUksQ0FBQyxjQUFjLEdBQUcsY0FBYyxDQUFDO0lBQ3ZDLENBQUM7SUFFTSxRQUFRO1FBQ2IsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLENBQUM7UUFDdkUsTUFBTSxZQUFZLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQztRQUNsRyxPQUFPLFlBQVksQ0FBQztJQUN0QixDQUFDO0lBRU0sUUFBUSxDQUFDLFlBQWlCO1FBQy9CLE1BQU0sYUFBYSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO1FBQzFFLE1BQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsV0FBVyxDQUFDLFlBQVksQ0FBQyxD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LEtBQUssS0FBSyxDQUFDLENBQUMsRUFBRTtZQUNoQixPQUFPLFdBQVcsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUE7U0FDOUI7YUFBTTtZQUNMLE9BQU8sQ0FBQyxXQUFXLENBQUMsQ0FBQTtTQUNyQjtJQUNILENBQUM7Q0FDRjtBQUVEOztHQUVHO0FBQ0gsTUFBTSwyQkFBMkI7SUFFL0IsTUFBTSxDQUFDLE1BQU0sQ0FBQyxXQUF3QixFQUFFLGtCQUEwQixFQUFFLHFCQUFxQixFQUFFLGdCQUFrQztRQUMzSCxRQUFRLFdBQVcsRUFBRTtZQUNuQixLQUFLLFdBQVcsQ0FBQyxXQUFXO2dCQUMxQixNQUFNLFdBQVcsR0FBRyxnQkFBZ0IsQ0FBQyxXQUFXLENBQUM7Z0JBQ2pELE9BQU8sSUFBSSwwQkFBMEIsQ0FBQyxXQUFXLEVBQUUsa0JBQWtCLEVBQUUscUJBQXFCLENBQUMsQ0FBQztZQUNoRyxLQUFLLFdBQVcsQ0FBQyxPQUFPO2dCQUN0QixNQUFNLE9BQU8sR0FBRyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUM7Z0JBQ3pDLE9BQU8sSUFBSSwyQkFBMkIsQ0FBQyxPQUFPLEVBQUUsa0JBQWtCLEVBQUUscUJBQXFCLENBQUMsQ0FBQztZQUM3RjtnQkFDRSxNQUFNLElBQUksS0FBSyxDQUFDLGVBQWUsQ0FBQyxDQUFDO1NBQ3BDO0lBQ0gsQ0FBQztDQUNGO0FBRUQsT0FBTyxFQUF3QiwwQkFBMEIsRUFBRSwyQkFBMkIsRUFBRSwyQkFBMkIsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQmluZGluZ0RhdGEgfSBmcm9tICcuLi9iaW5kaW5nLWRhdGEvaW5kZXgnO1xyXG5pbXBvcnQgeyBVSVN0YXRlIH0gZnJvbSAnLi4vdWktc3RhdGUvaW5kZXgnO1xyXG5pbXBvcnQgeyBWaWV3TW9kZWxDb250ZXh0IH0gZnJvbSAnLi4vdmlldy1tb2RlbC9pbmRleCc7XHJcbmltcG9ydCB7IEJpbmRpbmdQYXRoQ29udmVydGVyLCBEYXRlVXRpbCB9IGZyb20gJy4uL3V0aWxzL2luZGV4JztcclxuXHJcbmltcG9ydCB7IEJpbmRpbmdUeXBlIH0gZnJvbSAnLi90eXBlcyc7XHJcbmltcG9ydCB7IEJpbmRpbmdWYWx1ZUNvbnZlcnRlciB9IGZyb20gJy4vYmluZGluZ192YWx1ZV9jb252ZXJ0ZXInO1xyXG5cclxuLyoqXHJcbiAqIOe7keWumuWAvOiuv+mXruWZqOaOpeWPo1xyXG4gKi9cclxuaW50ZXJmYWNlIEJpbmRpbmdWYWx1ZUFjY2Vzc29yIHtcclxuXHJcbiAgZ2V0VmFsdWUoKTogYW55O1xyXG5cclxuICBzZXRWYWx1ZShjb250cm9sVmFsdWU6IGFueSk6IHZvaWQ7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBFbnRpdHnlgLzorr/pl67lmahcclxuICovXHJcbmNsYXNzIEVudGl0eUJpbmRpbmdWYWx1ZUFjY2Vzc29yIGltcGxlbWVudHMgQmluZGluZ1ZhbHVlQWNjZXNzb3Ige1xyXG5cclxuICBwcml2YXRlIGJpbmRpbmdEYXRhOiBCaW5kaW5nRGF0YTtcclxuXHJcbiAgcHJpdmF0ZSBiaW5kaW5nUGF0aFNlZ21lbnRzOiBzdHJpbmdbXTtcclxuXHJcbiAgcHJpdmF0ZSB2YWx1ZUNvbnZlcnRlcjogQmluZGluZ1ZhbHVlQ29udmVydGVyO1xyXG5cclxuICBjb25zdHJ1Y3RvcihiaW5kaW5nRGF0YTogQmluZGluZ0RhdGEsIGJpbmRpbmdQYXRoOiBzdHJpbmcsIHZhbHVlQ29udmVydGVyOiBCaW5kaW5nVmFsdWVDb252ZXJ0ZXIpIHtcclxuICAgIHRoaXMuYmluZGluZ0RhdGEgPSBiaW5kaW5nRGF0YTtcclxuICAgIHRoaXMuYmluZGluZ1BhdGhTZWdtZW50cyA9IHRoaXMuZ2V0QmluZGluZ1BhdGhTZWdtZW50cyhiaW5kaW5nUGF0aCk7XHJcbiAgICB0aGlzLnZhbHVlQ29udmVydGVyID0gdmFsdWVDb252ZXJ0ZXI7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0VmFsdWUoKTogYW55IHtcclxuICAgIGNvbnN0IHN0YXRlVmFsdWUgPSB0aGlzLmJpbmRpbmdEYXRhLmdldFZhbHVlKHRoaXMuYmluZGluZ1BhdGhTZWdtZW50cyk7XHJcbiAgICBjb25zdCBjb250cm9sVmFsdWUgPSB0aGlzLnZhbHVlQ29udmVydGVyID8gdGhpcy52YWx1ZUNvbnZlcnRlci5jb252ZXJ0VG8oc3RhdGVWYWx1ZSkgOiBzdGF0ZVZhbHVlO1xyXG4gICAgcmV0dXJuIGNvbnRyb2xWYWx1ZTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzZXRWYWx1ZShjb250cm9sVmFsdWU6IGFueSk6IHZvaWQge1xyXG4gICAgY29uc3Qgb2xkU3RhdGVWYWx1ZSA9IHRoaXMuYmluZGluZ0RhdGEuZ2V0VmFsdWUodGhpcy5iaW5kaW5nUGF0aFNlZ21lbnRzKTtcclxuICAgIGNvbnN0IHN0YXRlVmFsdWUgPSB0aGlzLnZhbHVlQ29udmVydGVyID8gdGhpcy52YWx1ZUNvbnZlcnRlci5jb252ZXJ0RnJvbShjb250cm9sVmFsdWUpIDogY29udHJvbFZhbHVlO1xyXG5cclxuICAgIGlmICh0aGlzLmlzRGF0ZUNvbnZlcnRlcih0aGlzLnZhbHVlQ29udmVydGVyKSA9PT0gdHJ1ZSkge1xyXG4gICAgICBpZiAoRGF0ZVV0aWwuaXNFcXVhbChvbGRTdGF0ZVZhbHVlLCBzdGF0ZVZhbHVlKSA9PT0gdHJ1ZSkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuYmluZGluZ0RhdGEuc2V0VmFsdWUodGhpcy5iaW5kaW5nUGF0aFNlZ21lbnRzLCBzdGF0ZVZhbHVlLCB0cnVlLCB0cnVlKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0QmluZGluZ1BhdGhTZWdtZW50cyhiaW5kaW5nUGF0aDogc3RyaW5nKSB7XHJcbiAgICBjb25zdCBwYXJlbnRQYXRoU2VnbWVudHMgPSBCaW5kaW5nUGF0aENvbnZlcnRlci50b0JpbmRpbmdQYXRoQXJyYXkodGhpcy5iaW5kaW5nRGF0YS5iaW5kaW5nUGF0aCk7XHJcbiAgICBiaW5kaW5nUGF0aCA9IGJpbmRpbmdQYXRoLnJlcGxhY2UoL1xcLi9nLCAnXFwvJyk7XHJcbiAgICBjb25zdCBiaW5kaW5nUGF0aFNlZ21lbnRzID0gQmluZGluZ1BhdGhDb252ZXJ0ZXIudG9CaW5kaW5nUGF0aEFycmF5KGJpbmRpbmdQYXRoKTtcclxuICAgIHJldHVybiBwYXJlbnRQYXRoU2VnbWVudHMuY29uY2F0KGJpbmRpbmdQYXRoU2VnbWVudHMpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5piv5ZCm5pivRGF0ZUNvbnZlcnRlclxyXG4gICAqL1xyXG4gIHByaXZhdGUgaXNEYXRlQ29udmVydGVyKGNvbnZlcnRlcjogQmluZGluZ1ZhbHVlQ29udmVydGVyKTogYm9vbGVhbiB7XHJcbiAgICBsZXQgaXNEYXRlQ29udmVydGVyID0gZmFsc2U7XHJcbiAgICBpZiAoY29udmVydGVyICYmIGNvbnZlcnRlci5oYXNPd25Qcm9wZXJ0eSgnZm9ybWF0JykgPT09IHRydWUpIHtcclxuICAgICAgaXNEYXRlQ29udmVydGVyID0gdHJ1ZTtcclxuICAgIH1cclxuICAgIHJldHVybiBpc0RhdGVDb252ZXJ0ZXI7XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogVUlTdGF0ZeWAvOiuv+mXruWZqFxyXG4gKi9cclxuY2xhc3MgVUlTdGF0ZUJpbmRpbmdWYWx1ZUFjY2Vzc29yIGltcGxlbWVudHMgQmluZGluZ1ZhbHVlQWNjZXNzb3Ige1xyXG5cclxuICBwcml2YXRlIHVpU3RhdGU6IFVJU3RhdGU7XHJcblxyXG4gIHByaXZhdGUgYmluZGluZ1BhdGhTZWdtZW50czogc3RyaW5nW107XHJcblxyXG5cclxuICBjb25zdHJ1Y3Rvcih1aVN0YXRlOiBVSVN0YXRlLCBiaW5kaW5nUGF0aDogc3RyaW5nLCB2YWx1ZUNvbnZlcnRlcjogQmluZGluZ1ZhbHVlQ29udmVydGVyKSB7XHJcbiAgICB0aGlzLnVpU3RhdGUgPSB1aVN0YXRlO1xyXG4gICAgdGhpcy5iaW5kaW5nUGF0aFNlZ21lbnRzID0gdGhpcy5nZXRVaVN0YXRlQmluZGluZ1BhdGgoYmluZGluZ1BhdGgpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldFZhbHVlKCk6IGFueSB7XHJcbiAgICBsZXQgc3RhdGVWYWx1ZTtcclxuICAgIGxldCBvYmogPSB0aGlzLnVpU3RhdGU7XHJcbiAgICB0aGlzLmJpbmRpbmdQYXRoU2VnbWVudHMuZm9yRWFjaChpdGVtID0+IHtcclxuICAgICAgc3RhdGVWYWx1ZSA9IG9ialtpdGVtXTtcclxuICAgICAgb2JqID0gc3RhdGVWYWx1ZVxyXG4gICAgfSlcclxuICAgIHJldHVybiBzdGF0ZVZhbHVlO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHNldFZhbHVlKGNvbnRyb2xWYWx1ZTogYW55KTogdm9pZCB7XHJcbiAgICBjb25zdCBsZW5ndGggPSB0aGlzLmJpbmRpbmdQYXRoU2VnbWVudHMubGVuZ3RoO1xyXG4gICAgaWYgKGxlbmd0aCA9PT0gMSkge1xyXG4gICAgICB0aGlzLnVpU3RhdGUuc2V0UHJvcGVydHlWYWx1ZSh0aGlzLmJpbmRpbmdQYXRoU2VnbWVudHMsIGNvbnRyb2xWYWx1ZSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBsZXQgb2JqO1xyXG4gICAgICBmb3IobGV0IGkgPSBsZW5ndGgtMSA7IGkgPiAwIDsgaS0tKXtcclxuICAgICAgICBvYmogPSB7W3RoaXMuYmluZGluZ1BhdGhTZWdtZW50c1tpXV06IGNvbnRyb2xWYWx1ZX07XHJcbiAgICAgICAgY29udHJvbFZhbHVlID0gb2JqO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMudWlTdGF0ZS5zZXRQcm9wZXJ0eVZhbHVlKHRoaXMuYmluZGluZ1BhdGhTZWdtZW50c1swXSwgb2JqKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIFVJU1RBVEXojrflj5bot6/lvoRcclxuICBwcml2YXRlIGdldFVpU3RhdGVCaW5kaW5nUGF0aChiaW5kaW5nUGF0aDogc3RyaW5nKSB7XHJcbiAgICBjb25zdCBpbmRleCA9IGJpbmRpbmdQYXRoLnNlYXJjaCgnLycpO1xyXG4gICAgaWYgKGluZGV4ICE9PSAtMSkge1xyXG4gICAgICByZXR1cm4gYmluZGluZ1BhdGguc3BsaXQoJy8nKVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIFtiaW5kaW5nUGF0aF1cclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiDnu5HlrprlgLzorr/pl67lmajlt6XljoJcclxuICovXHJcbmNsYXNzIEJpbmRpbmdWYWx1ZUFjY2Vzc29yRmFjdG9yeSB7XHJcblxyXG4gIHN0YXRpYyBjcmVhdGUoYmluZGluZ1R5cGU6IEJpbmRpbmdUeXBlLCBiaW5kaW5nQmluZGluZ1BhdGg6IHN0cmluZywgYmluZGluZ1ZhbHVlQ29udmVydGVyLCB2aWV3TW9kZWxDb250ZXh0OiBWaWV3TW9kZWxDb250ZXh0KSB7XHJcbiAgICBzd2l0Y2ggKGJpbmRpbmdUeXBlKSB7XHJcbiAgICAgIGNhc2UgQmluZGluZ1R5cGUuRW50aXR5U3RhdGU6XHJcbiAgICAgICAgY29uc3QgYmluZGluZ0RhdGEgPSB2aWV3TW9kZWxDb250ZXh0LmJpbmRpbmdEYXRhO1xyXG4gICAgICAgIHJldHVybiBuZXcgRW50aXR5QmluZGluZ1ZhbHVlQWNjZXNzb3IoYmluZGluZ0RhdGEsIGJpbmRpbmdCaW5kaW5nUGF0aCwgYmluZGluZ1ZhbHVlQ29udmVydGVyKTtcclxuICAgICAgY2FzZSBCaW5kaW5nVHlwZS5VSVN0YXRlOlxyXG4gICAgICAgIGNvbnN0IHVpU3RhdGUgPSB2aWV3TW9kZWxDb250ZXh0LnVpU3RhdGU7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBVSVN0YXRlQmluZGluZ1ZhbHVlQWNjZXNzb3IodWlTdGF0ZSwgYmluZGluZ0JpbmRpbmdQYXRoLCBiaW5kaW5nVmFsdWVDb252ZXJ0ZXIpO1xyXG4gICAgICBkZWZhdWx0OlxyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignTm90IFN1cHBvcnRlZCcpO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IHsgQmluZGluZ1ZhbHVlQWNjZXNzb3IsIEVudGl0eUJpbmRpbmdWYWx1ZUFjY2Vzc29yLCBVSVN0YXRlQmluZGluZ1ZhbHVlQWNjZXNzb3IsIEJpbmRpbmdWYWx1ZUFjY2Vzc29yRmFjdG9yeSB9O1xyXG4iXX0=