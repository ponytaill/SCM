import { DateUtil } from '../utils/date_util';
/**
 * 验证器工厂
 */
var ValidatorFactory = /** @class */ (function () {
    function ValidatorFactory() {
    }
    /**
     * 创建适配器
     */
    ValidatorFactory.create = function (validRules) {
        var _this = this;
        var validatorFn = [];
        if (Array.isArray(validRules) && validRules.length > 1) {
            validRules.forEach(function (validRule) {
                validatorFn.push(_this.initValidRuleFn(validRule));
            });
        }
        else if (Array.isArray(validRules) && validRules.length === 1) {
            validatorFn.push(this.initValidRuleFn(validRules[0]));
        }
        else {
            validatorFn.push(this.initValidRuleFn(validRules));
        }
        return validatorFn;
    };
    ValidatorFactory.initValidRuleFn = function (validRule) {
        var type = validRule.type, constraints = validRule.constraints, message = validRule.message;
        switch (type) {
            case 'required':
                return function (v) {
                    if (constraints[0] === true) {
                        if (null === v || undefined === v || '' === v) {
                            return { passing: false, message: message || '必填' };
                        }
                        else {
                            return { passing: true, message: '' };
                        }
                    }
                };
            case 'NumberMaxValue':
                return function (v) {
                    if (typeof v !== 'number') {
                        return;
                    }
                    if (constraints[0] || 0 == constraints[0]) {
                        if (v <= parseFloat(constraints[0])) {
                            return { passing: true, message: '' };
                        }
                        else {
                            return { passing: false, message: message || "\u8F93\u5165\u503C\u4E0D\u80FD\u5927\u4E8E" + constraints[0] };
                        }
                    }
                };
            case 'NumberMinValue':
                return function (v) {
                    if (typeof v !== 'number') {
                        return;
                    }
                    if (constraints[0] || 0 == constraints[0]) {
                        if (v >= parseFloat(constraints[0])) {
                            return { passing: true, message: '' };
                        }
                        else {
                            return { passing: false, message: message || "\u8F93\u5165\u503C\u4E0D\u80FD\u5C0F\u4E8E" + constraints[0] };
                        }
                    }
                };
            case 'DateMaxValue':
                return function (v) {
                    if (constraints[0]) {
                        if (DateUtil.isBefore(v, constraints[0]) || DateUtil.isSame(v, constraints[0])) {
                            return { passing: true, message: '' };
                        }
                        else {
                            return { passing: false, message: message || "\u8F93\u5165\u65E5\u671F\u4E0D\u80FD\u5927\u4E8E" + constraints[0] };
                        }
                    }
                };
            case 'DateMinValue':
                return function (v) {
                    if (constraints[0]) {
                        if (DateUtil.isAfter(v, constraints[0]) || DateUtil.isSame(v, constraints[0])) {
                            return { passing: true, message: '' };
                        }
                        else {
                            return { passing: false, message: message || "\u8F93\u5165\u65E5\u671F\u4E0D\u80FD\u5C0F\u4E8E" + constraints[0] };
                        }
                    }
                };
            case 'StringMaxLength':
                return function (v) {
                    if (constraints[0]) {
                        if (v.length <= constraints[0]) {
                            return { passing: true, message: '' };
                        }
                        else {
                            return { passing: false, message: message || "\u8F93\u5165\u503C\u957F\u5EA6\u4E0D\u80FD\u5927\u4E8E" + constraints[0] };
                        }
                    }
                };
            case 'StringMinLength':
                return function (v) {
                    if (constraints[0]) {
                        if (v.length >= constraints[0]) {
                            return { passing: true, message: '' };
                        }
                        else {
                            return { passing: false, message: message || "\u8F93\u5165\u503C\u957F\u5EA6\u4E0D\u80FD\u5C0F\u4E8E" + constraints[0] };
                        }
                    }
                };
            case 'regex':
                return function (v) {
                    var constraintsTemp = [];
                    if (typeof constraints[0] === 'string') {
                        constraintsTemp = constraints[0].split(',');
                    }
                    for (var i = 0; i < constraintsTemp.length; i++) {
                        if (constraintsTemp[i] === '') {
                            return;
                        }
                        var re = new RegExp(constraintsTemp[i]);
                        if (re.test(v)) {
                            return { passing: false, message: message || "\u5B58\u5728\u4E0D\u53EF\u8F93\u5165\u9879" + constraints[0] };
                        }
                        else {
                            return { passing: true, message: '' };
                        }
                    }
                };
            case 'customFunction':
                return function (v) {
                    if (typeof constraints[0] === 'function') {
                        var message_1 = constraints[0](v);
                        if (!message_1) {
                            return { passing: true, message: '' };
                        }
                        else {
                            return { passing: false, message: message_1 };
                        }
                    }
                };
            default:
                return function () {
                    return { passing: true, message: '' };
                };
        }
    };
    /**
     * 遍历生成的校验方法对当前值进行校验，当发现错误就返回校验结果
     * 遍历完成没有错误则返回校验通过结果
     * @param validatorFn 校验方法
     * @param value 当前值
     */
    ValidatorFactory.executeValidator = function (validatorFn, value) {
        for (var i = 0; i < validatorFn.length; i++) {
            var validationResult = validatorFn[i](value);
            if (validationResult['passing'] === false) {
                return validationResult;
            }
        }
        return { passing: true, message: '' };
    };
    return ValidatorFactory;
}());
export { ValidatorFactory };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmFsaWRhdG9yLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9tb2JpbGUtZGV2a2l0LyIsInNvdXJjZXMiOlsibGliL3ZhbGlkYXRvci92YWxpZGF0b3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLG9CQUFvQixDQUFBO0FBQzdDOztHQUVHO0FBQ0g7SUFBQTtJQXdKQSxDQUFDO0lBdkpHOztPQUVHO0lBQ0ksdUJBQU0sR0FBYixVQUFjLFVBQTZDO1FBQTNELGlCQVlDO1FBWEcsSUFBSSxXQUFXLEdBQUcsRUFBRSxDQUFDO1FBQ3JCLElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsSUFBSSxVQUFVLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUNwRCxVQUFVLENBQUMsT0FBTyxDQUFDLFVBQUMsU0FBeUI7Z0JBQ3pDLFdBQVcsQ0FBQyxJQUFJLENBQUMsS0FBSSxDQUFDLGVBQWUsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFBO1lBQ3JELENBQUMsQ0FBQyxDQUFBO1NBQ0w7YUFBTSxJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLElBQUksVUFBVSxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7WUFDN0QsV0FBVyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUE7U0FDeEQ7YUFBTTtZQUNILFdBQVcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxVQUE0QixDQUFDLENBQUMsQ0FBQTtTQUN2RTtRQUNELE9BQU8sV0FBVyxDQUFDO0lBQ3ZCLENBQUM7SUFFYyxnQ0FBZSxHQUE5QixVQUErQixTQUF5QjtRQUM1QyxJQUFBLHFCQUFJLEVBQUUsbUNBQVcsRUFBRSwyQkFBTyxDQUFlO1FBQ2pELFFBQVEsSUFBSSxFQUFFO1lBQ1YsS0FBSyxVQUFVO2dCQUNYLE9BQU8sVUFBQyxD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QUNILE9BQU8sRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxFQUFFLEVBQUUsQ0FBQTtnQkFDekMsQ0FBQyxDQUFBO1NBQ1I7SUFFTCxDQUFDO0lBRUQ7Ozs7O09BS0c7SUFDSSxpQ0FBZ0IsR0FBdkIsVUFBd0IsV0FBVyxFQUFFLEtBQUs7UUFDdEMsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLFdBQVcsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7WUFDekMsSUFBSSxnQkFBZ0IsR0FBRyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDN0MsSUFBSSxnQkFBZ0IsQ0FBQyxTQUFTLENBQUMsS0FBSyxLQUFLLEVBQUU7Z0JBQ3ZDLE9BQU8sZ0JBQWdCLENBQUM7YUFDM0I7U0FDSjtRQUNELE9BQU8sRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxFQUFFLEVBQUUsQ0FBQztJQUMxQyxDQUFDO0lBRUwsdUJBQUM7QUFBRCxDQUFDLEFBeEpELElBd0pDO0FBRUQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBWYWxpZGF0aW9uUnVsZSB9IGZyb20gJy4vdHlwZXMnO1xyXG5pbXBvcnQgeyBEYXRlVXRpbCB9IGZyb20gJy4uL3V0aWxzL2RhdGVfdXRpbCdcclxuLyoqXHJcbiAqIOmqjOivgeWZqOW3peWOglxyXG4gKi9cclxuY2xhc3MgVmFsaWRhdG9yRmFjdG9yeSB7XHJcbiAgICAvKipcclxuICAgICAqIOWIm+W7uumAgumFjeWZqFxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgY3JlYXRlKHZhbGlkUnVsZXM6IFZhbGlkYXRpb25SdWxlIHwgVmFsaWRhdGlvblJ1bGVbXSk6IGFueSB7XHJcbiAgICAgICAgbGV0IHZhbGlkYXRvckZuID0gW107XHJcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsaWRSdWxlcykgJiYgdmFsaWRSdWxlcy5sZW5ndGggPiAxKSB7XHJcbiAgICAgICAgICAgIHZhbGlkUnVsZXMuZm9yRWFjaCgodmFsaWRSdWxlOiBWYWxpZGF0aW9uUnVsZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdmFsaWRhdG9yRm4ucHVzaCh0aGlzLmluaXRWYWxpZFJ1bGVGbih2YWxpZFJ1bGUpKVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheSh2YWxpZFJ1bGVzKSAmJiB2YWxpZFJ1bGVzLmxlbmd0aCA9PT0gMSkge1xyXG4gICAgICAgICAgICB2YWxpZGF0b3JGbi5wdXNoKHRoaXMuaW5pdFZhbGlkUnVsZUZuKHZhbGlkUnVsZXNbMF0pKVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHZhbGlkYXRvckZuLnB1c2godGhpcy5pbml0VmFsaWRSdWxlRm4odmFsaWRSdWxlcyBhcyBWYWxpZGF0aW9uUnVsZSkpXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB2YWxpZGF0b3JGbjtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHN0YXRpYyBpbml0VmFsaWRSdWxlRm4odmFsaWRSdWxlOiBWYWxpZGF0aW9uUnVsZSk6IGFueSB7XHJcbiAgICAgICAgY29uc3QgeyB0eXBlLCBjb25zdHJhaW50cywgbWVzc2FnZSB9ID0gdmFsaWRSdWxlO1xyXG4gICAgICAgIHN3aXRjaCAodHlwZSkge1xyXG4gICAgICAgICAgICBjYXNlICdyZXF1aXJlZCc6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gKHYpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY29uc3RyYWludHNbMF0gPT09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG51bGwgPT09IHYgfHwgdW5kZWZpbmVkID09PSB2IHx8ICcnID09PSB2KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4geyBwYXNzaW5nOiBmYWxzZSwgbWVzc2FnZTogbWVzc2FnZSB8fCAn5b+F5aGrJyB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4geyBwYXNzaW5nOiB0cnVlLCBtZXNzYWdlOiAnJyB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXNlICdOdW1iZXJNYXhWYWx1ZSc6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gKHYpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHYgIT09ICdudW1iZXInKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVyblxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAoY29uc3RyYWludHNbMF0gfHwgMCA9PSBjb25zdHJhaW50c1swXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodiA8PSBwYXJzZUZsb2F0KGNvbnN0cmFpbnRzWzBdKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsgcGFzc2luZzogdHJ1ZSwgbWVzc2FnZTogJycgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsgcGFzc2luZzogZmFsc2UsIG1lc3NhZ2U6IG1lc3NhZ2UgfHwgYOi+k+WFpeWAvOS4jeiDveWkp+S6jiR7Y29uc3RyYWludHNbMF19YCB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhc2UgJ051bWJlck1pblZhbHVlJzpcclxuICAgICAgICAgICAgICAgIHJldHVybiAodikgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdiAhPT0gJ251bWJlcicpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjb25zdHJhaW50c1swXSB8fCAwID09IGNvbnN0cmFpbnRzWzBdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2ID49IHBhcnNlRmxvYXQoY29uc3RyYWludHNbMF0pKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4geyBwYXNzaW5nOiB0cnVlLCBtZXNzYWdlOiAnJyB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4geyBwYXNzaW5nOiBmYWxzZSwgbWVzc2FnZTogbWVzc2FnZSB8fCBg6L6T5YWl5YC85LiN6IO95bCP5LqOJHtjb25zdHJhaW50c1swXX1gIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2FzZSAnRGF0ZU1heFZhbHVlJzpcclxuICAgICAgICAgICAgICAgIHJldHVybiAodikgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjb25zdHJhaW50c1swXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoRGF0ZVV0aWwuaXNCZWZvcmUodiwgY29uc3RyYWludHNbMF0pIHx8IERhdGVVdGlsLmlzU2FtZSh2LCBjb25zdHJhaW50c1swXSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7IHBhc3Npbmc6IHRydWUsIG1lc3NhZ2U6ICcnIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7IHBhc3Npbmc6IGZhbHNlLCBtZXNzYWdlOiBtZXNzYWdlIHx8IGDovpPlhaXml6XmnJ/kuI3og73lpKfkuo4ke2NvbnN0cmFpbnRzWzBdfWAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXNlICdEYXRlTWluVmFsdWUnOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuICh2KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnN0cmFpbnRzWzBdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChEYXRlVXRpbC5pc0FmdGVyKHYsIGNvbnN0cmFpbnRzWzBdKSB8fCBEYXRlVXRpbC5pc1NhbWUodiwgY29uc3RyYWludHNbMF0pKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4geyBwYXNzaW5nOiB0cnVlLCBtZXNzYWdlOiAnJyB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4geyBwYXNzaW5nOiBmYWxzZSwgbWVzc2FnZTogbWVzc2FnZSB8fCBg6L6T5YWl5pel5pyf5LiN6IO95bCP5LqOJHtjb25zdHJhaW50c1swXX1gIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2FzZSAnU3RyaW5nTWF4TGVuZ3RoJzpcclxuICAgICAgICAgICAgICAgIHJldHVybiAodikgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjb25zdHJhaW50c1swXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodi5sZW5ndGggPD0gY29uc3RyYWludHNbMF0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7IHBhc3Npbmc6IHRydWUsIG1lc3NhZ2U6ICcnIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7IHBhc3Npbmc6IGZhbHNlLCBtZXNzYWdlOiBtZXNzYWdlIHx8IGDovpPlhaXlgLzplb/luqbkuI3og73lpKfkuo4ke2NvbnN0cmFpbnRzWzBdfWAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXNlICdTdHJpbmdNaW5MZW5ndGgnOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuICh2KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnN0cmFpbnRzWzBdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2Lmxlbmd0aCA+PSBjb25zdHJhaW50c1swXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsgcGFzc2luZzogdHJ1ZSwgbWVzc2FnZTogJycgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsgcGFzc2luZzogZmFsc2UsIG1lc3NhZ2U6IG1lc3NhZ2UgfHwgYOi+k+WFpeWAvOmVv+W6puS4jeiDveWwj+S6jiR7Y29uc3RyYWludHNbMF19YCB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhc2UgJ3JlZ2V4JzpcclxuICAgICAgICAgICAgICAgIHJldHVybiAodikgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBjb25zdHJhaW50c1RlbXAgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGNvbnN0cmFpbnRzWzBdID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdHJhaW50c1RlbXAgPSBjb25zdHJhaW50c1swXS5zcGxpdCgnLCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMCA7IGkgPCBjb25zdHJhaW50c1RlbXAubGVuZ3RoIDsgaSsrKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoY29uc3RyYWludHNUZW1wW2ldID09PSAnJyl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmUgPSBuZXcgUmVnRXhwKGNvbnN0cmFpbnRzVGVtcFtpXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZS50ZXN0KHYpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4geyBwYXNzaW5nOiBmYWxzZSwgbWVzc2FnZTogbWVzc2FnZSAgfHwgYOWtmOWcqOS4jeWPr+i+k+WFpemhuSR7Y29uc3RyYWludHNbMF19YCB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4geyBwYXNzaW5nOiB0cnVlLCBtZXNzYWdlOiAnJyB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXNlICdjdXN0b21GdW5jdGlvbic6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gKHYpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGNvbnN0cmFpbnRzWzBdID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBtZXNzYWdlID0gY29uc3RyYWludHNbMF0odilcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFtZXNzYWdlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4geyBwYXNzaW5nOiB0cnVlLCBtZXNzYWdlOiAnJyB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4geyBwYXNzaW5nOiBmYWxzZSwgbWVzc2FnZSB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7IHBhc3Npbmc6IHRydWUsIG1lc3NhZ2U6ICcnIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6YGN5Y6G55Sf5oiQ55qE5qCh6aqM5pa55rOV5a+55b2T5YmN5YC86L+b6KGM5qCh6aqM77yM5b2T5Y+R546w6ZSZ6K+v5bCx6L+U5Zue5qCh6aqM57uT5p6cXHJcbiAgICAgKiDpgY3ljoblrozmiJDmsqHmnInplJnor6/liJnov5Tlm57moKHpqozpgJrov4fnu5PmnpxcclxuICAgICAqIEBwYXJhbSB2YWxpZGF0b3JGbiDmoKHpqozmlrnms5VcclxuICAgICAqIEBwYXJhbSB2YWx1ZSDlvZPliY3lgLxcclxuICAgICAqL1xyXG4gICAgc3RhdGljIGV4ZWN1dGVWYWxpZGF0b3IodmFsaWRhdG9yRm4sIHZhbHVlKSB7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB2YWxpZGF0b3JGbi5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBsZXQgdmFsaWRhdGlvblJlc3VsdCA9IHZhbGlkYXRvckZuW2ldKHZhbHVlKTtcclxuICAgICAgICAgICAgaWYgKHZhbGlkYXRpb25SZXN1bHRbJ3Bhc3NpbmcnXSA9PT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB2YWxpZGF0aW9uUmVzdWx0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB7IHBhc3Npbmc6IHRydWUsIG1lc3NhZ2U6ICcnIH07XHJcbiAgICB9XHJcblxyXG59XHJcblxyXG5leHBvcnQgeyBWYWxpZGF0b3JGYWN0b3J5IH07Il19