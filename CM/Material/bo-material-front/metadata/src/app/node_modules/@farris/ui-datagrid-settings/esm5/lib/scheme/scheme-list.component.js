/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { ChangeDetectorRef, Component, ElementRef, EventEmitter, Injector, Input, Output, TemplateRef, ViewChild } from '@angular/core';
import { DatagridComponent } from '@farris/ui-datagrid';
import { LocaleService } from '@farris/ui-locale';
import { getMultilingualValue } from '../getValueWithLocaleId';
var SchemeListComponent = /** @class */ (function () {
    function SchemeListComponent(cd, localeSer, injector) {
        this.cd = cd;
        this.localeSer = localeSer;
        this.injector = injector;
        this.items = [];
        this.closeModal = new EventEmitter();
        this.submitModal = new EventEmitter();
        this.removeItem = true;
        this.columns = [];
        this.changes = null;
    }
    /**
     * @return {?}
     */
    SchemeListComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var colName = this.localeSer.getValue('datagrid.scheme.columns.name') || '名称';
        /** @type {?} */
        var colType = this.localeSer.getValue('datagrid.scheme.columns.type') || '属性';
        /** @type {?} */
        var colDefault = this.localeSer.getValue('datagrid.scheme.columns.isDefault') || '默认';
        /** @type {?} */
        var colCreator = this.localeSer.getValue('datagrid.scheme.columns.username') || '创建人';
        /** @type {?} */
        var colMgr = this.localeSer.getValue('datagrid.scheme.columns.mgr') || '管理';
        /** @type {?} */
        var publicTxt = this.localeSer.getValue('datagrid.scheme.isPublic') || '公共';
        /** @type {?} */
        var privateTxt = this.localeSer.getValue('datagrid.scheme.isPrivate') || '个人';
        /** @type {?} */
        var orgTxt = this.localeSer.getValue('datagrid.scheme.isOrg') || '组织';
        this.columns = [
            // {field: 'name', title: '名称', width: 150, template: this.schemeName},
            { field: 'name', title: colName, width: 150, formatter: (/**
                 * @param {?} v
                 * @return {?}
                 */
                function (v) {
                    return getMultilingualValue(JSON.parse(v), _this.localeSer.localeId);
                }) },
            { field: 'type', title: colType, width: 50, halign: 'center', align: 'center', formatter: (/**
                 * @param {?} v
                 * @param {?} d
                 * @return {?}
                 */
                function (v, d) {
                    switch (v) {
                        case 'public':
                            return '<span class="scheme-manager__label px-1 public">' + publicTxt + '</span>';
                        case 'org':
                            return '<span class="scheme-manager__label px-1 org">' + orgTxt + '</span>';
                        case 'private':
                        default:
                            return '<span class="scheme-manager__label px-1 private">' + privateTxt + '</span>';
                    }
                }) },
            { field: 'isDefault', title: colDefault, width: 50, halign: 'center', align: 'center', template: this.schemeIsDefault },
            { field: 'userName', title: colCreator, width: 80 },
            { title: colMgr, width: 50, template: this.btnDel, halign: 'center', align: 'center', }
        ];
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    SchemeListComponent.prototype.onClose = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        this.closeModal.emit();
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    SchemeListComponent.prototype.onSubmitClick = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        this.submitModal.emit(this.changes);
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    SchemeListComponent.prototype.onCancelClick = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        this.closeModal.emit();
    };
    /**
     * @param {?} $event
     * @param {?} ctx
     * @return {?}
     */
    SchemeListComponent.prototype.setDefault = /**
     * @param {?} $event
     * @param {?} ctx
     * @return {?}
     */
    function ($event, ctx) {
        /** @type {?} */
        var r = $event == '1';
        // $event.stopPropagation();
        this.items.forEach((/**
         * @param {?} n
         * @return {?}
         */
        function (n) {
            n.isDefault = false;
            if (n.id === ctx.rowData.id && r) {
                n.isDefault = r;
            }
        }));
        this.items = tslib_1.__spread(this.items);
        /** @type {?} */
        var defaultItem = this.items.find((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n.isDefault; }));
        if (defaultItem) {
            this.changes = this.changes || {};
            this.changes.defaultId = defaultItem.id;
        }
        // this.cd.detectChanges();
    };
    /**
     * @param {?} $event
     * @param {?} ctx
     * @return {?}
     */
    SchemeListComponent.prototype.onSchemeDel = /**
     * @param {?} $event
     * @param {?} ctx
     * @return {?}
     */
    function ($event, ctx) {
        if (!this.removeItem) {
            return;
        }
        $event.stopPropagation();
        /** @type {?} */
        var id = ctx.rowData.id;
        this.items = this.items.filter((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n.id !== id; }));
        this.changes = this.changes || {};
        this.changes.deletedIds = tslib_1.__spread((this.changes.deletedIds || []), [id]);
        if (id === this.changes.defaultId) {
            this.changes.defaultId = '';
            delete this.changes.defaultId;
        }
    };
    SchemeListComponent.decorators = [
        { type: Component, args: [{
                    selector: 'scheme-list',
                    template: "\r\n<div class=\"f-datagrid-save-scheme d-flex flex-column\" style=\"height: 100%;\">\r\n    <div class=\"d-flex justify-content-between header\" #header >\r\n        <div class=\"title\">{{'datagrid.scheme.schemeList' | locale}}</div>\r\n        <div class=\"close\" style=\"margin-right: 20px;\">\r\n            <span class=\"f-icon modal_close\" (click)=\"onClose($event)\"></span>\r\n        </div>\r\n    </div>\r\n\r\n    <div class=\"f-utils-fill mx-3 mt-1\" >\r\n        <farris-datagrid #dg\r\n            [columns]=\"columns\"\r\n            [data]=\"items\"\r\n            [fit]=\"true\"\r\n            [fitColumns]=\"true\"\r\n            [pagination]=\"false\"\r\n            [editable]=\"false\">\r\n        </farris-datagrid>\r\n    </div>\r\n\r\n    <div class=\"p-3 mb-3\" style=\"height: 50px;text-align: right;\">\r\n        <button class=\"btn btn-secondary cancel btn-lg mr-3\" style=\"width: 70px\"\r\n            (click)=\"onCancelClick($event)\">{{'datagrid.settings.cancel' | locale}}</button>\r\n        <button class=\"btn btn-primary ok btn-lg\" style=\"width: 70px\"\r\n            (click)=\"onSubmitClick($event)\">{{'datagrid.settings.ok' | locale}}</button>\r\n    </div>\r\n</div>\r\n\r\n<ng-template #schemeName let-ctx>\r\n    <div class=\"input-group\">\r\n        <input type=\"text\" class=\"form-control\" [(ngModel)]=\"ctx.rowData['name']\">\r\n    </div>\r\n</ng-template>\r\n<ng-template #schemeIsDefault let-ctx>\r\n    <div class=\"f-datagrid-cell-formgroup farris-group-auto f-datagrid_scheme-switch\" [style.opacity]=\"ctx.rowData['type'] !== 'private' ? 0.6: 1\" style=\"line-height:100%\" #ctrlbox hidefocus=\"true\">\r\n        <farris-switch [(ngModel)]=\"ctx.rowData['isDefault']\" trueValue=\"1\" falseValue=\"0\"\r\n        (valueChange)=\"setDefault($event, ctx)\"  [disabled]=\"ctx.rowData['type'] !== 'private' || ctx.rowData['isDefault']\"></farris-switch>\r\n    </div>\r\n</ng-template>\r\n\r\n<ng-template let-ctx #btnDel>\r\n    <a href=\"javascript:void(0)\" (click)=\"onSchemeDel($event, ctx)\" title=\"{{'datagrid.scheme.delete' | locale}}\" *ngIf=\"removeItem\">\r\n        <span class=\"f-icon f-icon-yxs_delete\"></span>\r\n    </a>\r\n</ng-template>"
                }] }
    ];
    /** @nocollapse */
    SchemeListComponent.ctorParameters = function () { return [
        { type: ChangeDetectorRef },
        { type: LocaleService },
        { type: Injector }
    ]; };
    SchemeListComponent.propDecorators = {
        items: [{ type: Input }],
        closeModal: [{ type: Output }],
        submitModal: [{ type: Output }],
        removeItem: [{ type: Input }],
        header: [{ type: ViewChild, args: ['header',] }],
        schemeName: [{ type: ViewChild, args: ['schemeName',] }],
        schemeIsDefault: [{ type: ViewChild, args: ['schemeIsDefault',] }],
        btnDel: [{ type: ViewChild, args: ['btnDel',] }],
        dg: [{ type: ViewChild, args: ['dg',] }]
    };
    return SchemeListComponent;
}());
export { SchemeListComponent };
if (false) {
    /** @type {?} */
    SchemeListComponent.prototype.items;
    /** @type {?} */
    SchemeListComponent.prototype.closeModal;
    /** @type {?} */
    SchemeListComponent.prototype.submitModal;
    /** @type {?} */
    SchemeListComponent.prototype.removeItem;
    /** @type {?} */
    SchemeListComponent.prototype.header;
    /** @type {?} */
    SchemeListComponent.prototype.schemeName;
    /** @type {?} */
    SchemeListComponent.prototype.schemeIsDefault;
    /** @type {?} */
    SchemeListComponent.prototype.btnDel;
    /** @type {?} */
    SchemeListComponent.prototype.dg;
    /** @type {?} */
    SchemeListComponent.prototype.columns;
    /**
     * @type {?}
     * @private
     */
    SchemeListComponent.prototype.changes;
    /**
     * @type {?}
     * @private
     */
    SchemeListComponent.prototype.cd;
    /**
     * @type {?}
     * @private
     */
    SchemeListComponent.prototype.localeSer;
    /**
     * @type {?}
     * @private
     */
    SchemeListComponent.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NoZW1lLWxpc3QuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1kYXRhZ3JpZC1zZXR0aW5ncy8iLCJzb3VyY2VzIjpbImxpYi9zY2hlbWUvc2NoZW1lLWxpc3QuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLGlCQUFpQixFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsWUFBWSxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQVUsTUFBTSxFQUFFLFdBQVcsRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDaEosT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDeEQsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBRS9EO0lBMEJJLDZCQUFvQixFQUFxQixFQUFVLFNBQXdCLEVBQVUsUUFBa0I7UUFBbkYsT0FBRSxHQUFGLEVBQUUsQ0FBbUI7UUFBVSxjQUFTLEdBQVQsU0FBUyxDQUFlO1FBQVUsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQW5COUYsVUFBSyxHQUFHLEVBQUUsQ0FBQztRQUVWLGVBQVUsR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBQ2hDLGdCQUFXLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUVsQyxlQUFVLEdBQUcsSUFBSSxDQUFDO1FBUTNCLFlBQU8sR0FBRyxFQUFFLENBQUM7UUFFTCxZQUFPLEdBR1gsSUFBSSxDQUFDO0lBQ2tHLENBQUM7Ozs7SUFFNUcsc0NBQVE7OztJQUFSO1FBQUEsaUJBa0NDOztZQWhDUyxPQUFPLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsOEJBQThCLENBQUMsSUFBSSxJQUFJOztZQUN6RSxPQUFPLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsOEJBQThCLENB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SUFBSSxDQUFDLE9BQU8sQ0FBQyxVQUFVLElBQUksRUFBRSxDQUFDLEdBQUUsRUFBRSxFQUFDLENBQUM7UUFDbkUsSUFBSSxFQUFFLEtBQUssSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUU7WUFDL0IsSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLEdBQUcsRUFBRSxDQUFDO1lBQzVCLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUM7U0FDakM7SUFDTCxDQUFDOztnQkE3R0osU0FBUyxTQUFDO29CQUNQLFFBQVEsRUFBRSxhQUFhO29CQUN2QixxckVBQXlDO2lCQUM1Qzs7OztnQkFSUSxpQkFBaUI7Z0JBRWpCLGFBQWE7Z0JBRjJDLFFBQVE7Ozt3QkFZcEUsS0FBSzs2QkFFTCxNQUFNOzhCQUNOLE1BQU07NkJBRU4sS0FBSzt5QkFFTCxTQUFTLFNBQUMsUUFBUTs2QkFDbEIsU0FBUyxTQUFDLFlBQVk7a0NBQ3RCLFNBQVMsU0FBQyxpQkFBaUI7eUJBQzNCLFNBQVMsU0FBQyxRQUFRO3FCQUNsQixTQUFTLFNBQUMsSUFBSTs7SUE0Rm5CLDBCQUFDO0NBQUEsQUE5R0QsSUE4R0M7U0F6R1ksbUJBQW1COzs7SUFFNUIsb0NBQW9COztJQUVwQix5Q0FBMEM7O0lBQzFDLDBDQUEyQzs7SUFFM0MseUNBQTJCOztJQUUzQixxQ0FBNkM7O0lBQzdDLHlDQUFzRDs7SUFDdEQsOENBQWdFOztJQUNoRSxxQ0FBOEM7O0lBQzlDLGlDQUF1Qzs7SUFFdkMsc0NBQWE7Ozs7O0lBRWIsc0NBR1M7Ozs7O0lBQ0csaUNBQTZCOzs7OztJQUFFLHdDQUFnQzs7Ozs7SUFBRSx1Q0FBMEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDaGFuZ2VEZXRlY3RvclJlZiwgQ29tcG9uZW50LCBFbGVtZW50UmVmLCBFdmVudEVtaXR0ZXIsIEluamVjdG9yLCBJbnB1dCwgT25Jbml0LCBPdXRwdXQsIFRlbXBsYXRlUmVmLCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgRGF0YWdyaWRDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLWRhdGFncmlkJztcclxuaW1wb3J0IHsgTG9jYWxlU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbG9jYWxlJztcclxuaW1wb3J0IHsgZ2V0TXVsdGlsaW5ndWFsVmFsdWUgfSBmcm9tICcuLi9nZXRWYWx1ZVdpdGhMb2NhbGVJZCc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAnc2NoZW1lLWxpc3QnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICdzY2hlbWUtbGlzdC5jb21wb25lbnQuaHRtbCdcclxufSlcclxuXHJcbmV4cG9ydCBjbGFzcyBTY2hlbWVMaXN0Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuXHJcbiAgICBASW5wdXQoKSBpdGVtcyA9IFtdO1xyXG4gICAgXHJcbiAgICBAT3V0cHV0KCkgY2xvc2VNb2RhbCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIEBPdXRwdXQoKSBzdWJtaXRNb2RhbCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuXHJcbiAgICBASW5wdXQoKSByZW1vdmVJdGVtID0gdHJ1ZTtcclxuICAgIFxyXG4gICAgQFZpZXdDaGlsZCgnaGVhZGVyJykgaGVhZGVyOiBFbGVtZW50UmVmPGFueT47XHJcbiAgICBAVmlld0NoaWxkKCdzY2hlbWVOYW1lJykgc2NoZW1lTmFtZTogVGVtcGxhdGVSZWY8YW55PjtcclxuICAgIEBWaWV3Q2hpbGQoJ3NjaGVtZUlzRGVmYXVsdCcpIHNjaGVtZUlzRGVmYXVsdDogVGVtcGxhdGVSZWY8YW55PjtcclxuICAgIEBWaWV3Q2hpbGQoJ2J0bkRlbCcpIGJ0bkRlbDogVGVtcGxhdGVSZWY8YW55PjtcclxuICAgIEBWaWV3Q2hpbGQoJ2RnJykgZGc6IERhdGFncmlkQ29tcG9uZW50O1xyXG5cclxuICAgIGNvbHVtbnMgPSBbXTtcclxuICAgXHJcbiAgICBwcml2YXRlIGNoYW5nZXM6IHtcclxuICAgICAgICBkZWZhdWx0SWQ/OiBzdHJpbmcsXHJcbiAgICAgICAgZGVsZXRlZElkcz86IGFueVtdXHJcbiAgICB9ID0gbnVsbDtcclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgY2Q6IENoYW5nZURldGVjdG9yUmVmLCBwcml2YXRlIGxvY2FsZVNlcjogTG9jYWxlU2VydmljZSwgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IpIHsgfVxyXG5cclxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xyXG5cclxuICAgICAgICBjb25zdCBjb2xOYW1lID0gdGhpcy5sb2NhbGVTZXIuZ2V0VmFsdWUoJ2RhdGFncmlkLnNjaGVtZS5jb2x1bW5zLm5hbWUnKSB8fCAn5ZCN56ewJztcclxuICAgICAgICBjb25zdCBjb2xUeXBlID0gdGhpcy5sb2NhbGVTZXIuZ2V0VmFsdWUoJ2RhdGFncmlkLnNjaGVtZS5jb2x1bW5zLnR5cGUnKSB8fCAn5bGe5oCnJztcclxuICAgICAgICBjb25zdCBjb2xEZWZhdWx0ID0gdGhpcy5sb2NhbGVTZXIuZ2V0VmFsdWUoJ2RhdGFncmlkLnNjaGVtZS5jb2x1bW5zLmlzRGVmYXVsdCcpIHx8ICfpu5jorqQnO1xyXG4gICAgICAgIGNvbnN0IGNvbENyZWF0b3IgPSB0aGlzLmxvY2FsZVNlci5nZXRWYWx1ZSgnZGF0YWdyaWQuc2NoZW1lLmNvbHVtbnMudXNlcm5hbWUnKSB8fCAn5Yib5bu65Lq6JztcclxuICAgICAgICBjb25zdCBjb2xNZ3IgPSB0aGlzLmxvY2FsZVNlci5nZXRWYWx1ZSgnZGF0YWdyaWQuc2NoZW1lLmNvbHVtbnMubWdyJykgfHwgJ+euoeeQhic7XHJcblxyXG4gICAgICAgIGNvbnN0IHB1YmxpY1R4dCA9IHRoaXMubG9jYWxlU2VyLmdldFZhbHVlKCdkYXRhZ3JpZC5zY2hlbWUuaXNQdWJsaWMnKSB8fCAn5YWs5YWxJztcclxuICAgICAgICBjb25zdCBwcml2YXRlVHh0ID0gdGhpcy5sb2NhbGVTZXIuZ2V0VmFsdWUoJ2RhdGFncmlkLnNjaGVtZS5pc1ByaXZhdGUnKSB8fCAn5Liq5Lq6JztcclxuICAgICAgICBjb25zdCBvcmdUeHQgPSB0aGlzLmxvY2FsZVNlci5nZXRWYWx1ZSgnZGF0YWdyaWQuc2NoZW1lLmlzT3JnJykgfHwgJ+e7hOe7hyc7XHJcblxyXG5cclxuICAgICAgICB0aGlzLmNvbHVtbnMgPSBbXHJcbiAgICAgICAgICAgIC8vIHtmaWVsZDogJ25hbWUnLCB0aXRsZTogJ+WQjeensCcsIHdpZHRoOiAxNTAsIHRlbXBsYXRlOiB0aGlzLnNjaGVtZU5hbWV9LFxyXG4gICAgICAgICAgICB7ZmllbGQ6ICduYW1lJywgdGl0bGU6IGNvbE5hbWUsIHdpZHRoOiAxNTAsIGZvcm1hdHRlcjogKHYpID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBnZXRNdWx0aWxpbmd1YWxWYWx1ZShKU09OLnBhcnNlKHYpLCB0aGlzLmxvY2FsZVNlci5sb2NhbGVJZCk7XHJcbiAgICAgICAgICAgIH19LFxyXG4gICAgICAgICAgICB7ZmllbGQ6ICd0eXBlJywgdGl0bGU6IGNvbFR5cGUsIHdpZHRoOiA1MCwgaGFsaWduOiAnY2VudGVyJywgYWxpZ246ICdjZW50ZXInLCBmb3JtYXR0ZXI6ICh2LCBkKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBzd2l0Y2godikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ3B1YmxpYyc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPHNwYW4gY2xhc3M9XCJzY2hlbWUtbWFuYWdlcl9fbGFiZWwgcHgtMSBwdWJsaWNcIj4nKyBwdWJsaWNUeHQgKyc8L3NwYW4+JztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdvcmcnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxzcGFuIGNsYXNzPVwic2NoZW1lLW1hbmFnZXJfX2xhYmVsIHB4LTEgb3JnXCI+Jysgb3JnVHh0ICsnPC9zcGFuPic7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAncHJpdmF0ZSc6XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8c3BhbiBjbGFzcz1cInNjaGVtZS1tYW5hZ2VyX19sYWJlbCBweC0xIHByaXZhdGVcIj4nKyBwcml2YXRlVHh0ICsnPC9zcGFuPic7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH19LFxyXG4gICAgICAgICAgICB7ZmllbGQ6ICdpc0RlZmF1bHQnLCB0aXRsZTogY29sRGVmYXVsdCwgd2lkdGg6IDUwLCBoYWxpZ246ICdjZW50ZXInLCBhbGlnbjogJ2NlbnRlcicsIHRlbXBsYXRlOiB0aGlzLnNjaGVtZUlzRGVmYXVsdCB9LFxyXG4gICAgICAgICAgICB7ZmllbGQ6ICd1c2VyTmFtZScsIHRpdGxlOiBjb2xDcmVhdG9yLCB3aWR0aDogODB9LFxyXG4gICAgICAgICAgICB7dGl0bGU6IGNvbE1nciwgd2lkdGg6IDUwLCB0ZW1wbGF0ZTogdGhpcy5idG5EZWwsIGhhbGlnbjogJ2NlbnRlcicsIGFsaWduOiAnY2VudGVyJyx9XHJcbiAgICAgICAgXTtcclxuICAgIFxyXG4gICAgfVxyXG5cclxuICAgIG9uQ2xvc2UoJGV2ZW50KSB7XHJcbiAgICAgICAgdGhpcy5jbG9zZU1vZGFsLmVtaXQoKTtcclxuICAgIH1cclxuXHJcbiAgICBvblN1Ym1pdENsaWNrKCRldmVudCkge1xyXG4gICAgICAgIHRoaXMuc3VibWl0TW9kYWwuZW1pdCggdGhpcy5jaGFuZ2VzKTtcclxuICAgIH1cclxuXHJcbiAgICBvbkNhbmNlbENsaWNrKCRldmVudCkge1xyXG4gICAgICAgIHRoaXMuY2xvc2VNb2RhbC5lbWl0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0RGVmYXVsdCgkZXZlbnQ6IGFueSwgY3R4KSB7XHJcbiAgICAgICAgY29uc3QgciA9ICRldmVudCA9PSAnMSc7XHJcbiAgICAgICAgLy8gJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgIHRoaXMuaXRlbXMuZm9yRWFjaChuID0+IHtcclxuICAgICAgICAgICAgbi5pc0RlZmF1bHQgPSBmYWxzZTtcclxuICAgICAgICAgICAgaWYgKG4uaWQgPT09IGN0eC5yb3dEYXRhLmlkICYmIHIpIHtcclxuICAgICAgICAgICAgICAgIG4uaXNEZWZhdWx0ID0gcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLml0ZW1zID0gWy4uLnRoaXMuaXRlbXNdO1xyXG5cclxuICAgICAgICBjb25zdCBkZWZhdWx0SXRlbSA9IHRoaXMuaXRlbXMuZmluZChuID0+IG4uaXNEZWZhdWx0KTtcclxuICAgICAgICBpZiAoZGVmYXVsdEl0ZW0pIHtcclxuICAgICAgICAgICAgdGhpcy5jaGFuZ2VzID0gdGhpcy5jaGFuZ2VzIHx8IHt9O1xyXG4gICAgICAgICAgICB0aGlzLmNoYW5nZXMuZGVmYXVsdElkID0gZGVmYXVsdEl0ZW0uaWQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uU2NoZW1lRGVsKCRldmVudCwgY3R4KSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLnJlbW92ZUl0ZW0pIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgY29uc3QgaWQgPSBjdHgucm93RGF0YS5pZDtcclxuICAgICAgICB0aGlzLml0ZW1zID0gdGhpcy5pdGVtcy5maWx0ZXIobiA9PiBuLmlkICE9PSBpZCk7XHJcbiAgICAgICAgdGhpcy5jaGFuZ2VzID0gdGhpcy5jaGFuZ2VzIHx8IHt9O1xyXG4gICAgICAgIHRoaXMuY2hhbmdlcy5kZWxldGVkSWRzID0gWy4uLih0aGlzLmNoYW5nZXMuZGVsZXRlZElkcyB8fCBbXSksIGlkXTtcclxuICAgICAgICBpZiAoaWQgPT09IHRoaXMuY2hhbmdlcy5kZWZhdWx0SWQpIHtcclxuICAgICAgICAgICAgdGhpcy5jaGFuZ2VzLmRlZmF1bHRJZCA9ICcnO1xyXG4gICAgICAgICAgICBkZWxldGUgdGhpcy5jaGFuZ2VzLmRlZmF1bHRJZDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0iXX0=