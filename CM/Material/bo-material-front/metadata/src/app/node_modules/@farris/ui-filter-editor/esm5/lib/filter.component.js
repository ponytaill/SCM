/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { LocaleService } from '@farris/ui-locale';
/*
 * @Author: 疯狂秀才(Lucas Huang)
 * @Date: 2018-12-04 10:43:42
 * @LastEditors: 疯狂秀才(Lucas Huang)
 * @LastEditTime: 2019-10-17 17:34:39
 * @Company: Inspur
 * @Version: v0.0.1
 */
import { Component, Input, EventEmitter, Output, Injector, ElementRef, ComponentFactoryResolver, TemplateRef, ViewChild, forwardRef, HostListener, HostBinding, ChangeDetectorRef } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { cloneDeep } from 'lodash-es';
import { BsModalService } from '@farris/ui-modal';
import { LookupComponent } from '@farris/ui-lookup';
import { Compare } from '@farris/ui-common/types';
import { FilterService } from './services/filter.service';
import { FilterEditorComponent } from './components/filter-editor.component';
import { CommonUtils } from '@farris/ui-common';
/** @type {?} */
export var FILTER_LOOKUPGRID_VALUE_ACCESSOR = {
    provide: NG_VALUE_ACCESSOR,
    useExisting: forwardRef((/**
     * @return {?}
     */
    function () { return FilterComponent; })),
    multi: true
};
/**
 * @record
 */
export function FILTER_FIELD_EDITOR() { }
if (false) {
    /** @type {?} */
    FILTER_FIELD_EDITOR.prototype.type;
    /** @type {?|undefined} */
    FILTER_FIELD_EDITOR.prototype.options;
}
var FilterComponent = /** @class */ (function (_super) {
    tslib_1.__extends(FilterComponent, _super);
    function FilterComponent(injector, cfr, modalService, el, filterService) {
        var _this = _super.call(this, injector, el) || this;
        _this.cfr = cfr;
        _this.modalService = modalService;
        _this.el = el;
        _this.filterService = filterService;
        _this.hostCls = 'f-cmp-inputgroup';
        _this.text = '';
        _this.conditions = [];
        _this.originalData = [];
        /**
         * 字段数据
         */
        _this.columns = [];
        _this.showCode = false;
        _this.showSql = false;
        _this.enableExpress = false;
        _this.fieldEditor = { type: 'select', options: {} };
        _this.enableClear = true;
        _this.returnType = 'object';
        _this.openDialog = new EventEmitter();
        _this.showExpress = new EventEmitter();
        _this.showClearButton = false;
        _this.cd = null;
        _this.commonUtils = null;
        _this.filterService.conditionsChanged.subscribe((/**
         * @param {?} conditionList
         * @return {?}
         */
        function (conditionList) {
            _this.conditions = conditionList;
        }));
        _this.localeService = _this.injector.get(LocaleService);
        _this.cd = _this.injector.get(ChangeDetectorRef);
        _this.commonUtils = _this.injector.get(CommonUtils, null) || new CommonUtils();
        return _this;
    }
    /**
     * @return {?}
     */
    FilterComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @param {?} event
     * @return {?}
     */
    FilterComponent.prototype.onmouseover = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        this.showClearButton = true;
    };
    /**
     * @param {?} event
     * @return {?}
     */
    FilterComponent.prototype.onmouseleave = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        this.showClearButton = false;
    };
    /**
     * @return {?}
     */
    FilterComponent.prototype.showDialog = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (!this.disabled) {
            if (this.fieldEditor && this.fieldEditor.type === 'combo-tree') {
                this.fieldEditor.options = this.fieldEditor.options || {};
                if (this.fieldEditor.options.autoWidth === undefined) {
                    this.fieldEditor.options.autoWidth = true;
                }
                if (!this.fieldEditor.options.columns) {
                    this.fieldEditor.options.columns = [{ field: 'label', title: 'label', width: 100 }];
                }
                if (!this.fieldEditor.options.textField) {
                    this.fieldEditor.options.textField = 'label';
                }
                if (!this.fieldEditor.options.idField) {
                    this.fieldEditor.options.idField = 'value';
                }
            }
            /** @type {?} */
            var filterEditorFactory = this.cfr.resolveComponentFactory(FilterEditorComponent);
            this.filterEditorRef = filterEditorFactory.create(this.injector);
            this.filterEditorRef.instance.columns = this.columns;
            this.filterEditorRef.instance.conditions = this.conditions;
            this.originalData = cloneDeep(this.conditions);
            this.dlgRef = this.modalService.show(this.filterEditorRef, {
                width: 800, height: 500,
                title: this.localeService.getValue('filterEditor.title'),
                enableScroll: false,
                minHeight: 398, minWidth: 798,
                iconCls: 'f-icon f-icon-filter',
                buttons: this.btnRef,
                // dialogFooterStyles: { background: '#F4F6F9' },
                buttonAlign: 'right',
                initialState: {
                    showCode: this.showCode,
                    showSql: this.showSql,
                    enableExpress: this.enableExpress,
                    fieldEditor: this.fieldEditor
                },
                closed: (/**
                 * @param {?} isCloseButtonClick
                 * @return {?}
                 */
                function (isCloseButtonClick) {
                    if (isCloseButtonClick) {
                        _this.cancel();
                    }
                })
            });
            this.filterEditorRef.instance.height = this.dlgRef.dialog.instance.getContainerSize().height;
            this.filterEditorRef.instance.showExpress.subscribe((/**
             * @param {?} $event
             * @return {?}
             */
            function ($event) {
                _this.showExpress.emit($event);
            }));
            this.dlgRef.dialog.instance.resized.subscribe((/**
             * @param {?} size
             * @return {?}
             */
            function (size) {
                _this.filterEditorRef.instance.height = size.containerHeight;
            }));
            this.filterEditorRef.changeDetectorRef.detectChanges();
            this.dlgRef.dialog.changeDetectorRef.reattach();
            this.openDialog.emit();
        }
    };
    /**
     * @param {?} val
     * @return {?}
     */
    FilterComponent.prototype.writeValue = /**
     * @param {?} val
     * @return {?}
     */
    function (val) {
        if (val) {
            if (typeof val === 'string') {
                val = JSON.parse(val);
            }
            this.conditions = val || [];
            this.text = this.commonUtils.buildSqlWhere(this.conditions);
        }
    };
    /**
     * @return {?}
     */
    FilterComponent.prototype.save = /**
     * @return {?}
     */
    function () {
        if (this.conditions.length) {
            this.conditions = this.conditions.filter((/**
             * @param {?} c
             * @return {?}
             */
            function (c) { return c.filterField; }));
            // 转换in 操作符的value 值
            this.conditions = this.conditions.map((/**
             * @param {?} con
             * @return {?}
             */
            function (con) {
                /** @type {?} */
                var cp = parseInt('' + con.compare, 10);
                if (cp === Compare.In || cp === Compare.NotIn) {
                    con.value = con.value.replace(/,/g, '\r\n');
                }
                return con;
            }));
            this.text = this.commonUtils.buildSqlWhere(this.conditions);
        }
        else {
            this.text = '';
        }
        if (this.cd) {
            this.cd.detectChanges();
        }
        this.closeDialog();
    };
    /**
     * @return {?}
     */
    FilterComponent.prototype.cancel = /**
     * @return {?}
     */
    function () {
        this.conditions = this.originalData;
        this.closeDialog();
    };
    /**
     * @return {?}
     */
    FilterComponent.prototype.closeDialog = /**
     * @return {?}
     */
    function () {
        this.updateModel();
        this.filterEditorRef = null;
        this.dlgRef.close();
    };
    /**
     * @return {?}
     */
    FilterComponent.prototype.clear = /**
     * @return {?}
     */
    function () {
        this.text = '';
        this.conditions = [];
        this.updateModel();
    };
    /**
     * @private
     * @return {?}
     */
    FilterComponent.prototype.updateModel = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var v = this.conditions;
        if (this.returnType === 'string') {
            v = JSON.stringify(this.conditions);
        }
        this.onModelChange(v);
        this.onModelTouched(v);
    };
    FilterComponent.decorators = [
        { type: Component, args: [{
                    selector: 'filter,filter-textbox',
                    template: "<div class=\"input-group\">\r\n    <input #txtbox\r\n        class=\"form-control\" \r\n        [value]=\"text\"\r\n        [readonly]=\"!editable || readonly\"\r\n        [class.f-state-disabled] = \"disabled\"\r\n        [class.f-state-readonly] = \"readonly\"\r\n        [class.f-state-editable] = \"!editable\"\r\n        [disabled]=\"disabled\"/>\r\n    <div class=\"input-group-append\" *ngIf=\"!readonly && !disabled\">\r\n        <span *ngIf=\"showClearButton && enableClear\" class=\"input-group-text input-group-clear\" (click)=\"clear()\">\r\n            <i class=\"f-icon modal_close\"></i>\r\n        </span>\r\n        <span class=\"f-select input-group-text\"  (click)=\"showDialog()\">\r\n            <i class=\"f-icon f-icon-lookup\"></i>\r\n        </span>\r\n    </div>\r\n</div>\r\n\r\n<ng-template #defaultButtonRef>\r\n    <button class=\"btn btn-outline-secondary\" (click)=\"cancel()\"> {{ 'filterEditor.cancelButton'|locale }} </button>&nbsp;\r\n    <button class=\"btn btn-primary\" (click)=\"save()\"> {{ 'filterEditor.okButton'| locale }} </button>\r\n</ng-template>",
                    providers: [
                        FILTER_LOOKUPGRID_VALUE_ACCESSOR,
                        FilterService
                    ],
                    styles: ["\n        .lookup-clear { cursor: pointer; background: #fff!important;}\n        .lookup-clear:hover { background: #e9ecef!important;}\n        "]
                }] }
    ];
    /** @nocollapse */
    FilterComponent.ctorParameters = function () { return [
        { type: Injector },
        { type: ComponentFactoryResolver },
        { type: BsModalService },
        { type: ElementRef },
        { type: FilterService }
    ]; };
    FilterComponent.propDecorators = {
        hostCls: [{ type: HostBinding, args: ['class',] }],
        columns: [{ type: Input }],
        showCode: [{ type: Input }],
        showSql: [{ type: Input }],
        enableExpress: [{ type: Input }],
        fieldEditor: [{ type: Input }],
        enableClear: [{ type: Input }],
        returnType: [{ type: Input }],
        openDialog: [{ type: Output }],
        showExpress: [{ type: Output }],
        btnRef: [{ type: ViewChild, args: ['defaultButtonRef',] }],
        textbox: [{ type: ViewChild, args: ['txtbox',] }],
        onmouseover: [{ type: HostListener, args: ['mouseover', ['$event'],] }],
        onmouseleave: [{ type: HostListener, args: ['mouseleave', ['$event'],] }]
    };
    return FilterComponent;
}(LookupComponent));
export { FilterComponent };
if (false) {
    /** @type {?} */
    FilterComponent.prototype.hostCls;
    /** @type {?} */
    FilterComponent.prototype.text;
    /** @type {?} */
    FilterComponent.prototype.conditions;
    /** @type {?} */
    FilterComponent.prototype.originalData;
    /**
     * 字段数据
     * @type {?}
     */
    FilterComponent.prototype.columns;
    /** @type {?} */
    FilterComponent.prototype.showCode;
    /** @type {?} */
    FilterComponent.prototype.showSql;
    /** @type {?} */
    FilterComponent.prototype.enableExpress;
    /** @type {?} */
    FilterComponent.prototype.fieldEditor;
    /** @type {?} */
    FilterComponent.prototype.enableClear;
    /** @type {?} */
    FilterComponent.prototype.returnType;
    /** @type {?} */
    FilterComponent.prototype.openDialog;
    /** @type {?} */
    FilterComponent.prototype.showExpress;
    /** @type {?} */
    FilterComponent.prototype.btnRef;
    /** @type {?} */
    FilterComponent.prototype.textbox;
    /** @type {?} */
    FilterComponent.prototype.showClearButton;
    /** @type {?} */
    FilterComponent.prototype.cd;
    /** @type {?} */
    FilterComponent.prototype.dlgRef;
    /** @type {?} */
    FilterComponent.prototype.filterEditorRef;
    /** @type {?} */
    FilterComponent.prototype.localeService;
    /** @type {?} */
    FilterComponent.prototype.commonUtils;
    /**
     * @type {?}
     * @private
     */
    FilterComponent.prototype.cfr;
    /**
     * @type {?}
     * @private
     */
    FilterComponent.prototype.modalService;
    /** @type {?} */
    FilterComponent.prototype.el;
    /**
     * @type {?}
     * @private
     */
    FilterComponent.prototype.filterService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsdGVyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktZmlsdGVyLWVkaXRvci8iLCJzb3VyY2VzIjpbImxpYi9maWx0ZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG1CQUFtQixDQUFDOzs7Ozs7Ozs7QUFTbEQsT0FBTyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsWUFBWSxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsVUFBVSxFQUM3RCx3QkFBd0IsRUFBRSxXQUFXLEVBQUUsU0FBUyxFQUNoRCxVQUFVLEVBQVUsWUFBWSxFQUFFLFdBQVcsRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNoRyxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNuRCxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBQ3RDLE9BQU8sRUFBYyxjQUFjLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUM5RCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDcEQsT0FBTyxFQUFtQixPQUFPLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUVuRSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDMUQsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sc0NBQXNDLENBQUM7QUFDN0UsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLG1CQUFtQixDQUFDOztBQUVoRCxNQUFNLEtBQU8sZ0NBQWdDLEdBQVE7SUFDakQsT0FBTyxFQUFFLGlCQUFpQjtJQUMxQixXQUFXLEVBQUUsVUFBVTs7O0lBQUMsY0FBTSxPQUFBLGVBQWUsRUFBZixDQUFlLEVBQUM7SUFDOUMsS0FBSyxFQUFFLElBQUk7Q0FDZDs7OztBQUVELHlDQUdDOzs7SUFGRyxtQ0FBeUM7O0lBQ3pDLHNDQUFjOztBQUds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R0M7aUJBRVI7Ozs7Z0JBckNnRCxRQUFRO2dCQUNqRCx3QkFBd0I7Z0JBSVgsY0FBYztnQkFMd0IsVUFBVTtnQkFTNUQsYUFBYTs7OzBCQStCakIsV0FBVyxTQUFDLE9BQU87MEJBTW5CLEtBQUs7MkJBQ0wsS0FBSzswQkFDTCxLQUFLO2dDQUNMLEtBQUs7OEJBQ0wsS0FBSzs4QkFDTCxLQUFLOzZCQUNMLEtBQUs7NkJBR0wsTUFBTTs4QkFDTixNQUFNO3lCQUNOLFNBQVMsU0FBQyxrQkFBa0I7MEJBQzVCLFNBQVMsU0FBQyxRQUFROzhCQThCbEIsWUFBWSxTQUFDLFdBQVcsRUFBRSxDQUFDLFFBQVEsQ0FBQzsrQkFLcEMsWUFBWSxTQUFDLFlBQVksRUFBRSxDQUFDLFFBQVEsQ0FBQzs7SUFzSTFDLHNCQUFDO0NBQUEsQUEzTUQsQ0FjcUMsZUFBZSxHQTZMbkQ7U0E3TFksZUFBZTs7O0lBRXhCLGtDQUFtRDs7SUFFbkQsK0JBQVU7O0lBQ1YscUNBQW1DOztJQUNuQyx1Q0FBcUM7Ozs7O0lBRXJDLGtDQUF3RDs7SUFDeEQsbUNBQTBCOztJQUMxQixrQ0FBeUI7O0lBQ3pCLHdDQUErQjs7SUFDL0Isc0NBQTJFOztJQUMzRSxzQ0FBNEI7O0lBQzVCLHFDQUFvRDs7SUFHcEQscUNBQTBDOztJQUMxQyxzQ0FBMkM7O0lBQzNDLGlDQUF3RDs7SUFDeEQsa0NBQThDOztJQUU5QywwQ0FBd0I7O0lBQ3hCLDZCQUE2Qjs7SUFDN0IsaUNBQW1COztJQUNuQiwwQ0FBcUQ7O0lBQ3JELHdDQUE2Qjs7SUFFN0Isc0NBQWdDOzs7OztJQUVSLDhCQUFxQzs7Ozs7SUFDekQsdUNBQW9DOztJQUFFLDZCQUFxQjs7Ozs7SUFDM0Qsd0NBQW9DIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTG9jYWxlU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbG9jYWxlJztcclxuLypcclxuICogQEF1dGhvcjog55av54uC56eA5omNKEx1Y2FzIEh1YW5nKVxyXG4gKiBARGF0ZTogMjAxOC0xMi0wNCAxMDo0Mzo0MlxyXG4gKiBATGFzdEVkaXRvcnM6IOeWr+eLguengOaJjShMdWNhcyBIdWFuZylcclxuICogQExhc3RFZGl0VGltZTogMjAxOS0xMC0xNyAxNzozNDozOVxyXG4gKiBAQ29tcGFueTogSW5zcHVyXHJcbiAqIEBWZXJzaW9uOiB2MC4wLjFcclxuICovXHJcbmltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQsIEV2ZW50RW1pdHRlciwgT3V0cHV0LCBJbmplY3RvciwgRWxlbWVudFJlZixcclxuICAgICAgICBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsIFRlbXBsYXRlUmVmLCBWaWV3Q2hpbGQsIENvbXBvbmVudFJlZixcclxuICAgICAgICBmb3J3YXJkUmVmLCBPbkluaXQsIEhvc3RMaXN0ZW5lciwgSG9zdEJpbmRpbmcsIENoYW5nZURldGVjdG9yUmVmIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IE5HX1ZBTFVFX0FDQ0VTU09SIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xyXG5pbXBvcnQgeyBjbG9uZURlZXAgfSBmcm9tICdsb2Rhc2gtZXMnO1xyXG5pbXBvcnQgeyBCc01vZGFsUmVmLCBCc01vZGFsU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbW9kYWwnO1xyXG5pbXBvcnQgeyBMb29rdXBDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLWxvb2t1cCc7XHJcbmltcG9ydCB7IEZpbHRlckNvbmRpdGlvbiwgQ29tcGFyZSB9IGZyb20gJ0BmYXJyaXMvdWktY29tbW9uL3R5cGVzJztcclxuXHJcbmltcG9ydCB7IEZpbHRlclNlcnZpY2UgfSBmcm9tICcuL3NlcnZpY2VzL2ZpbHRlci5zZXJ2aWNlJztcclxuaW1wb3J0IHsgRmlsdGVyRWRpdG9yQ29tcG9uZW50IH0gZnJvbSAnLi9jb21wb25lbnRzL2ZpbHRlci1lZGl0b3IuY29tcG9uZW50JztcclxuaW1wb3J0IHsgQ29tbW9uVXRpbHMgfSBmcm9tICdAZmFycmlzL3VpLWNvbW1vbic7XHJcblxyXG5leHBvcnQgY29uc3QgRklMVEVSX0xPT0tVUEdSSURfVkFMVUVfQUNDRVNTT1I6IGFueSA9IHtcclxuICAgIHByb3ZpZGU6IE5HX1ZBTFVFX0FDQ0VTU09SLFxyXG4gICAgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gRmlsdGVyQ29tcG9uZW50KSxcclxuICAgIG11bHRpOiB0cnVlXHJcbn07XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIEZJTFRFUl9GSUVMRF9FRElUT1Ige1xyXG4gICAgdHlwZTogJ3NlbGVjdCcgfCAnY29tYm8tdHJlZScgfCAnbG9va3VwJztcclxuICAgIG9wdGlvbnM/OiBhbnk7XHJcbn1cclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdmaWx0ZXIsZmlsdGVyLXRleHRib3gnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICdmaWx0ZXIuY29tcG9uZW50Lmh0bWwnLFxyXG4gICAgcHJvdmlkZXJzOiBbXHJcbiAgICAgICAgRklMVEVSX0xPT0tVUEdSSURfVkFMVUVfQUNDRVNTT1IsXHJcbiAgICAgICAgRmlsdGVyU2VydmljZVxyXG4gICAgXSxcclxuICAgIHN0eWxlczogW1xyXG4gICAgICAgIGBcclxuICAgICAgICAubG9va3VwLWNsZWFyIHsgY3Vyc29yOiBwb2ludGVyOyBiYWNrZ3JvdW5kOiAjZmZmIWltcG9ydGFudDt9XHJcbiAgICAgICAgLmxvb2t1cC1jbGVhcjpob3ZlciB7IGJhY2tncm91bmQ6ICNlOWVjZWYhaW1wb3J0YW50O31cclxuICAgICAgICBgXHJcbiAgICBdXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBGaWx0ZXJDb21wb25lbnQgZXh0ZW5kcyBMb29rdXBDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG5cclxuICAgIEBIb3N0QmluZGluZygnY2xhc3MnKSBob3N0Q2xzID0gJ2YtY21wLWlucHV0Z3JvdXAnO1xyXG5cclxuICAgIHRleHQgPSAnJztcclxuICAgIGNvbmRpdGlvbnM6IEZpbHRlckNvbmRpdGlvbltdID0gW107XHJcbiAgICBvcmlnaW5hbERhdGE6IEZpbHRlckNvbmRpdGlvbltdID0gW107XHJcbiAgICAvKiog5a2X5q615pWw5o2uICovXHJcbiAgICBASW5wdXQoKSBjb2x1bW5zOiB7bGFiZWw6IHN0cmluZywgdmFsdWU6IHN0cmluZ31bXSA9IFtdO1xyXG4gICAgQElucHV0KCkgc2hvd0NvZGUgPSBmYWxzZTtcclxuICAgIEBJbnB1dCgpIHNob3dTcWwgPSBmYWxzZTtcclxuICAgIEBJbnB1dCgpIGVuYWJsZUV4cHJlc3MgPSBmYWxzZTtcclxuICAgIEBJbnB1dCgpIGZpZWxkRWRpdG9yOiBGSUxURVJfRklFTERfRURJVE9SID0geyB0eXBlOiAnc2VsZWN0Jywgb3B0aW9uczoge319O1xyXG4gICAgQElucHV0KCkgZW5hYmxlQ2xlYXIgPSB0cnVlO1xyXG4gICAgQElucHV0KCkgcmV0dXJuVHlwZTogJ29iamVjdCcgfCAnc3RyaW5nJyA9ICdvYmplY3QnO1xyXG5cclxuXHJcbiAgICBAT3V0cHV0KCkgb3BlbkRpYWxvZyA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIEBPdXRwdXQoKSBzaG93RXhwcmVzcyA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIEBWaWV3Q2hpbGQoJ2RlZmF1bHRCdXR0b25SZWYnKSBidG5SZWY6IFRlbXBsYXRlUmVmPGFueT47XHJcbiAgICBAVmlld0NoaWxkKCd0eHRib3gnKSB0ZXh0Ym94OiBFbGVtZW50UmVmPGFueT47XHJcblxyXG4gICAgc2hvd0NsZWFyQnV0dG9uID0gZmFsc2U7XHJcbiAgICBjZDogQ2hhbmdlRGV0ZWN0b3JSZWYgPSBudWxsO1xyXG4gICAgZGxnUmVmOiBCc01vZGFsUmVmO1xyXG4gICAgZmlsdGVyRWRpdG9yUmVmOiBDb21wb25lbnRSZWY8RmlsdGVyRWRpdG9yQ29tcG9uZW50PjtcclxuICAgIGxvY2FsZVNlcnZpY2U6IExvY2FsZVNlcnZpY2U7XHJcblxyXG4gICAgY29tbW9uVXRpbHM6IENvbW1vblV0aWxzID0gbnVsbDtcclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIGluamVjdG9yOiBJbmplY3RvciwgcHJpdmF0ZSBjZnI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcclxuICAgICAgICBwcml2YXRlIG1vZGFsU2VydmljZTogQnNNb2RhbFNlcnZpY2UsIHB1YmxpYyBlbDogRWxlbWVudFJlZixcclxuICAgICAgICBwcml2YXRlIGZpbHRlclNlcnZpY2U6IEZpbHRlclNlcnZpY2UpIHtcclxuICAgICAgICBzdXBlcihpbmplY3RvciwgZWwpO1xyXG5cclxuICAgICAgICB0aGlzLmZpbHRlclNlcnZpY2UuY29uZGl0aW9uc0NoYW5nZWQuc3Vic2NyaWJlKGNvbmRpdGlvbkxpc3QgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmNvbmRpdGlvbnMgPSBjb25kaXRpb25MaXN0O1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLmxvY2FsZVNlcnZpY2UgPSB0aGlzLmluamVjdG9yLmdldChMb2NhbGVTZXJ2aWNlKTtcclxuXHJcbiAgICAgICAgdGhpcy5jZCA9IHRoaXMuaW5qZWN0b3IuZ2V0KENoYW5nZURldGVjdG9yUmVmKTtcclxuXHJcbiAgICAgICAgdGhpcy5jb21tb25VdGlscyA9IHRoaXMuaW5qZWN0b3IuZ2V0KENvbW1vblV0aWxzLCBudWxsKSB8fCBuZXcgQ29tbW9uVXRpbHMoKTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKSB7XHJcbiAgICB9XHJcblxyXG4gICAgQEhvc3RMaXN0ZW5lcignbW91c2VvdmVyJywgWyckZXZlbnQnXSlcclxuICAgIG9ubW91c2VvdmVyKGV2ZW50OiBhbnkpIHtcclxuICAgICAgICB0aGlzLnNob3dDbGVhckJ1dHRvbiA9IHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgQEhvc3RMaXN0ZW5lcignbW91c2VsZWF2ZScsIFsnJGV2ZW50J10pXHJcbiAgICBvbm1vdXNlbGVhdmUoZXZlbnQ6IGFueSkge1xyXG4gICAgICAgIHRoaXMuc2hvd0NsZWFyQnV0dG9uID0gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgc2hvd0RpYWxvZygpIHtcclxuICAgICAgICBpZiAoIXRoaXMuZGlzYWJsZWQpIHtcclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmZpZWxkRWRpdG9yICYmIHRoaXMuZmllbGRFZGl0b3IudHlwZSA9PT0gJ2NvbWJvLXRyZWUnKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZpZWxkRWRpdG9yLm9wdGlvbnMgPSB0aGlzLmZpZWxkRWRpdG9yLm9wdGlvbnMgfHwge307XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5maWVsZEVkaXRvci5vcHRpb25zLmF1dG9XaWR0aCA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5maWVsZEVkaXRvci5vcHRpb25zLmF1dG9XaWR0aCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmZpZWxkRWRpdG9yLm9wdGlvbnMuY29sdW1ucykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmllbGRFZGl0b3Iub3B0aW9ucy5jb2x1bW5zID0gWyB7IGZpZWxkOiAnbGFiZWwnLCB0aXRsZTogJ2xhYmVsJywgd2lkdGg6IDEwMCB9IF07XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmZpZWxkRWRpdG9yLm9wdGlvbnMudGV4dEZpZWxkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5maWVsZEVkaXRvci5vcHRpb25zLnRleHRGaWVsZCA9ICdsYWJlbCc7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmZpZWxkRWRpdG9yLm9wdGlvbnMuaWRGaWVsZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmllbGRFZGl0b3Iub3B0aW9ucy5pZEZpZWxkID0gJ3ZhbHVlJztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY29uc3QgZmlsdGVyRWRpdG9yRmFjdG9yeSA9IHRoaXMuY2ZyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KEZpbHRlckVkaXRvckNvbXBvbmVudCk7XHJcbiAgICAgICAgICAgIHRoaXMuZmlsdGVyRWRpdG9yUmVmID0gZmlsdGVyRWRpdG9yRmFjdG9yeS5jcmVhdGUodGhpcy5pbmplY3Rvcik7XHJcbiAgICAgICAgICAgIHRoaXMuZmlsdGVyRWRpdG9yUmVmLmluc3RhbmNlLmNvbHVtbnMgPSB0aGlzLmNvbHVtbnM7XHJcbiAgICAgICAgICAgIHRoaXMuZmlsdGVyRWRpdG9yUmVmLmluc3RhbmNlLmNvbmRpdGlvbnMgPSB0aGlzLmNvbmRpdGlvbnM7XHJcbiAgICAgICAgICAgIHRoaXMub3JpZ2luYWxEYXRhID0gY2xvbmVEZWVwKHRoaXMuY29uZGl0aW9ucyk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmRsZ1JlZiA9IHRoaXMubW9kYWxTZXJ2aWNlLnNob3codGhpcy5maWx0ZXJFZGl0b3JSZWYsIHtcclxuICAgICAgICAgICAgICAgIHdpZHRoOiA4MDAsIGhlaWdodDogNTAwLFxyXG4gICAgICAgICAgICAgICAgdGl0bGU6IHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZSgnZmlsdGVyRWRpdG9yLnRpdGxlJyksXHJcbiAgICAgICAgICAgICAgICBlbmFibGVTY3JvbGw6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgbWluSGVpZ2h0OiAzOTgsIG1pbldpZHRoOiA3OTgsXHJcbiAgICAgICAgICAgICAgICBpY29uQ2xzOiAnZi1pY29uIGYtaWNvbi1maWx0ZXInLFxyXG4gICAgICAgICAgICAgICAgYnV0dG9uczogdGhpcy5idG5SZWYsXHJcbiAgICAgICAgICAgICAgICAvLyBkaWFsb2dGb290ZXJTdHlsZXM6IHsgYmFja2dyb3VuZDogJyNGNEY2RjknIH0sXHJcbiAgICAgICAgICAgICAgICBidXR0b25BbGlnbjogJ3JpZ2h0JyxcclxuICAgICAgICAgICAgICAgIGluaXRpYWxTdGF0ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIHNob3dDb2RlOiB0aGlzLnNob3dDb2RlLFxyXG4gICAgICAgICAgICAgICAgICAgIHNob3dTcWw6IHRoaXMuc2hvd1NxbCxcclxuICAgICAgICAgICAgICAgICAgICBlbmFibGVFeHByZXNzOiB0aGlzLmVuYWJsZUV4cHJlc3MsXHJcbiAgICAgICAgICAgICAgICAgICAgZmllbGRFZGl0b3I6IHRoaXMuZmllbGRFZGl0b3JcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBjbG9zZWQ6IChpc0Nsb3NlQnV0dG9uQ2xpY2s6IGJvb2xlYW4pID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaXNDbG9zZUJ1dHRvbkNsaWNrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2FuY2VsKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuZmlsdGVyRWRpdG9yUmVmLmluc3RhbmNlLmhlaWdodCA9IHRoaXMuZGxnUmVmLmRpYWxvZy5pbnN0YW5jZS5nZXRDb250YWluZXJTaXplKCkuaGVpZ2h0O1xyXG5cclxuXHJcbiAgICAgICAgICAgIHRoaXMuZmlsdGVyRWRpdG9yUmVmLmluc3RhbmNlLnNob3dFeHByZXNzLnN1YnNjcmliZSgoJGV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNob3dFeHByZXNzLmVtaXQoJGV2ZW50KTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmRsZ1JlZi5kaWFsb2cuaW5zdGFuY2UucmVzaXplZC5zdWJzY3JpYmUoIHNpemUgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5maWx0ZXJFZGl0b3JSZWYuaW5zdGFuY2UuaGVpZ2h0ID0gc2l6ZS5jb250YWluZXJIZWlnaHQ7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5maWx0ZXJFZGl0b3JSZWYuY2hhbmdlRGV0ZWN0b3JSZWYuZGV0ZWN0Q2hhbmdlcygpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5kbGdSZWYuZGlhbG9nLmNoYW5nZURldGVjdG9yUmVmLnJlYXR0YWNoKCk7XHJcbiAgICAgICAgICAgIHRoaXMub3BlbkRpYWxvZy5lbWl0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHdyaXRlVmFsdWUodmFsOiBhbnkpIHtcclxuICAgICAgICBpZiAodmFsKSB7XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICAgICAgdmFsID0gSlNPTi5wYXJzZSh2YWwpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuY29uZGl0aW9ucyA9IHZhbCB8fCBbXTtcclxuICAgICAgICAgICAgdGhpcy50ZXh0ID0gdGhpcy5jb21tb25VdGlscy5idWlsZFNxbFdoZXJlKHRoaXMuY29uZGl0aW9ucyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHNhdmUoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuY29uZGl0aW9ucy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgdGhpcy5jb25kaXRpb25zID0gdGhpcy5jb25kaXRpb25zLmZpbHRlcihjID0+IGMuZmlsdGVyRmllbGQpO1xyXG5cclxuICAgICAgICAgICAgLy8g6L2s5o2iaW4g5pON5L2c56ym55qEdmFsdWUg5YC8XHJcbiAgICAgICAgICAgIHRoaXMuY29uZGl0aW9ucyA9IHRoaXMuY29uZGl0aW9ucy5tYXAoY29uID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNwID0gcGFyc2VJbnQoJycgKyBjb24uY29tcGFyZSwgMTApO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNwID09PSBDb21wYXJlLkluIHx8IGNwID09PSBDb21wYXJlLk5vdEluKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uLnZhbHVlID0gY29uLnZhbHVlLnJlcGxhY2UoLywvZywgJ1xcclxcbicpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbjtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLnRleHQgPSB0aGlzLmNvbW1vblV0aWxzLmJ1aWxkU3FsV2hlcmUodGhpcy5jb25kaXRpb25zKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnRleHQgPSAnJztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmNkKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5jbG9zZURpYWxvZygpO1xyXG4gICAgfVxyXG5cclxuICAgIGNhbmNlbCgpIHtcclxuICAgICAgICB0aGlzLmNvbmRpdGlvbnMgPSB0aGlzLm9yaWdpbmFsRGF0YTtcclxuICAgICAgICB0aGlzLmNsb3NlRGlhbG9nKCk7XHJcbiAgICB9XHJcblxyXG4gICAgY2xvc2VEaWFsb2coKSB7XHJcbiAgICAgICAgdGhpcy51cGRhdGVNb2RlbCgpO1xyXG4gICAgICAgIHRoaXMuZmlsdGVyRWRpdG9yUmVmID0gbnVsbDtcclxuICAgICAgICB0aGlzLmRsZ1JlZi5jbG9zZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIGNsZWFyKCkge1xyXG4gICAgICAgIHRoaXMudGV4dCA9ICcnO1xyXG4gICAgICAgIHRoaXMuY29uZGl0aW9ucyA9IFtdO1xyXG4gICAgICAgIHRoaXMudXBkYXRlTW9kZWwoKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHVwZGF0ZU1vZGVsKCkge1xyXG4gICAgICAgIGxldCB2OiBhbnkgPSB0aGlzLmNvbmRpdGlvbnM7XHJcbiAgICAgICAgaWYgKHRoaXMucmV0dXJuVHlwZSA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgdiA9IEpTT04uc3RyaW5naWZ5KHRoaXMuY29uZGl0aW9ucyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLm9uTW9kZWxDaGFuZ2Uodik7XHJcbiAgICAgICAgdGhpcy5vbk1vZGVsVG91Y2hlZCh2KTtcclxuICAgIH1cclxufVxyXG4iXX0=