/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { LocaleService } from '@farris/ui-locale';
import { Component, Input, ComponentFactoryResolver, Injector, ApplicationRef, Renderer2, ViewChild, ElementRef, ChangeDetectorRef, NgZone } from '@angular/core';
import { delay, filter } from 'rxjs/operators';
import ResizeObserver from 'resize-observer-polyfill';
import { ColumnFilterType } from '@farris/ui-datagrid';
import { FilterOperator, TextFilterOperators, NumberOrDateFilterOperators, FilterConditionValue, } from './../operations/operators';
import { FilterRowPanelComponent } from './filter-row-panel.component';
import { DatagridFilterRowService } from '../datagrid-filter-row.service';
import { FilterRowEditorComponent } from './filter-row-editor.component';
var FilterTextboxComponent = /** @class */ (function (_super) {
    tslib_1.__extends(FilterTextboxComponent, _super);
    function FilterTextboxComponent(cfr, injector, app, dfrs, render, cd, localSer) {
        var _this = _super.call(this) || this;
        _this.cfr = cfr;
        _this.injector = injector;
        _this.app = app;
        _this.dfrs = dfrs;
        _this.render = render;
        _this.cd = cd;
        _this.localSer = localSer;
        _this.disabled = false;
        _this.delay = 300;
        _this.filterStr = '';
        _this.filterPanelSubscription = null;
        _this.ro = null;
        _this.zone = null;
        _this.el = null;
        _this.zone = _this.injector.get(NgZone);
        _this.el = _this.injector.get(ElementRef);
        _this.dfrs.filterTextboxChanged.pipe(filter((/**
         * @param {?} v
         * @return {?}
         */
        function (v) { return v[_this.column.field] !== undefined; })), delay(_this.delay)).subscribe((/**
         * @param {?} obj
         * @return {?}
         */
        function (obj) {
            /** @type {?} */
            var val = obj[_this.column.field];
            if (val !== '') {
                /** @type {?} */
                var _condition = { operator1: FilterOperator.Contains, value1: val };
                if (_this.column.filter.type === ColumnFilterType.number) {
                    _condition.operator1 = FilterOperator.Equal;
                }
                _this.dfrs.updateColumnConditions(_this.column.field, _condition);
            }
            else {
                _this.dfrs.updateColumnConditions(_this.column.field, FilterConditionValue.All);
            }
        }));
        _this.dfrs.removeField.subscribe((/**
         * @param {?} f
         * @return {?}
         */
        function (f) {
            if (f === _this.column.field) {
                _this.clearValue();
            }
        }));
        return _this;
    }
    Object.defineProperty(FilterTextboxComponent.prototype, "inputType", {
        get: /**
         * @return {?}
         */
        function () {
            if (this.column.filter.type === ColumnFilterType.number) {
                return 'number';
            }
            return 'text';
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    FilterTextboxComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        if (this.ro) {
            this.ro.disconnect();
        }
    };
    /**
     * @param {?} event
     * @return {?}
     */
    FilterTextboxComponent.prototype.show = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        var _this = this;
        this.close();
        event.stopPropagation();
        /** @type {?} */
        var dgContainerEle = ((/** @type {?} */ (event.target))).closest('.f-datagrid');
        if (dgContainerEle) {
            dgContainerEle.addEventListener('click', (/**
             * @param {?} e
             * @return {?}
             */
            function (e) {
                _this.close();
            }));
        }
        if (!this.dfrs.gridInstance) {
            this.dfrs.gridInstance = this.gridInstance;
        }
        /** @type {?} */
        var cf = this.cfr.resolveComponentFactory(FilterRowPanelComponent);
        this.filterPanelRef = cf.create(this.injector);
        this.app.attachView(this.filterPanelRef.hostView);
        this.filterPanelRef.instance.column = this.column;
        this.filterPanelRef.instance.gridInstance = this.gridInstance;
        this.initOperators(this.filterPanelRef.instance);
        if (this.column.filter !== false && this.column.filter !== undefined) {
            this.filterPanelRef.instance.datatype = this.column.filter.type;
            if (this.column.filter.type === ColumnFilterType.enum ||
                this.column.filter.type === ColumnFilterType.fromdata) {
                this.filterPanelRef.instance.height = 300;
            }
        }
        /** @type {?} */
        var currentColumnCondition = this.dfrs.columnConditions[this.column.field];
        if (currentColumnCondition) {
            this.filterPanelRef.instance.condition = (/** @type {?} */ (currentColumnCondition));
        }
        else {
            this.filterPanelRef.instance.condition = {
                operator1: 0,
                value1: '',
                relation: '',
                operator2: 0,
                value2: ''
            };
            // this.initOperators(this.filterPanelRef.instance);
        }
        this.filterPanelSubscription = this.filterPanelRef.instance.conditionChange.subscribe((/**
         * @param {?} condition
         * @return {?}
         */
        function (condition) {
            if (condition) {
                _this.dfrs.updateColumnConditions(_this.column.field, condition);
                _this.filterStr = _this.dfrs.condition2string(_this.column, condition);
                if (_this.column.filter.type < 2) {
                    _this.disabled = !!_this.filterStr;
                }
                _this.cd.detectChanges();
            }
            else {
                _this.clearValue();
                _this.dfrs.updateColumnConditions(_this.column.field, FilterConditionValue.All);
            }
        }));
        document.body.appendChild(this.filterPanelRef.location.nativeElement);
        this.updateFilterPanelPosition(event.target);
        this.dfrs.setFilterPanel(this.filterPanelRef);
        /** @type {?} */
        var dgWidth = dgContainerEle.getBoundingClientRect().width;
        this.zone.runOutsideAngular((/**
         * @return {?}
         */
        function () {
            _this.ro = new ResizeObserver((/**
             * @param {?} entries
             * @param {?} observer
             * @return {?}
             */
            function (entries, observer) {
                if (entries[0].target.getBoundingClientRect().width !== dgWidth) {
                    _this.close();
                }
            }));
            _this.ro.observe(dgContainerEle);
        }));
        this.filterPanelRef.instance.target = event;
        this.filterPanelRef.changeDetectorRef.markForCheck();
        this.filterPanelRef.changeDetectorRef.detectChanges();
    };
    /**
     * @return {?}
     */
    FilterTextboxComponent.prototype.close = /**
     * @return {?}
     */
    function () {
        this.dfrs.closeFilterPanel();
        if (this.filterPanelSubscription) {
            this.filterPanelSubscription.unsubscribe();
            this.filterPanelSubscription = null;
        }
    };
    /**
     * @private
     * @param {?} ins
     * @return {?}
     */
    FilterTextboxComponent.prototype.initOperators = /**
     * @private
     * @param {?} ins
     * @return {?}
     */
    function (ins) {
        var _this = this;
        if (this.column.filter.type === ColumnFilterType.string) {
            ins.operators = TextFilterOperators;
            ins.condition.operator1 = FilterOperator.Contains;
            ins.condition.operator2 = FilterOperator.Contains;
        }
        else if (this.column.filter.type === ColumnFilterType.number || this.column.filter.type === ColumnFilterType.datetime
            || this.column.filter.type === ColumnFilterType.date || this.column.filter.type === ColumnFilterType.time) {
            ins.operators = NumberOrDateFilterOperators;
            ins.condition.operator1 = FilterOperator.Equal;
            ins.condition.operator2 = FilterOperator.Equal;
        }
        if (ins.operators) {
            ins.operators.forEach((/**
             * @param {?} o
             * @return {?}
             */
            function (o) {
                o.label = _this.dfrs.getOperatorLabel(o.code);
            }));
        }
    };
    /**
     * @private
     * @param {?} target
     * @return {?}
     */
    FilterTextboxComponent.prototype.updateFilterPanelPosition = /**
     * @private
     * @param {?} target
     * @return {?}
     */
    function (target) {
        if (target) {
            /** @type {?} */
            var filterIconParent = target.parentElement;
            if (filterIconParent) {
                /** @type {?} */
                var pos = filterIconParent.getBoundingClientRect();
                /** @type {?} */
                var tr = target.closest('tr');
                /** @type {?} */
                var td = target.closest('td');
                /** @type {?} */
                var headerPos = target.closest('.f-datagrid-header').getBoundingClientRect();
                /** @type {?} */
                var panelWidth = this.filterPanelRef.instance.width;
                /** @type {?} */
                var left = pos.left;
                if (headerPos.width + headerPos.x < pos.x + panelWidth) { // this.column.filter.type === ColumnFilterType.enum
                    left = td.getBoundingClientRect().left + td.offsetWidth - panelWidth;
                    this.filterPanelRef.location.nativeElement.querySelector('.panel-icon').style.left = panelWidth - 40 + "px";
                }
                // const top = pos.top
                /** @type {?} */
                var panel = this.filterPanelRef.location.nativeElement.querySelector('div');
                if (panel) {
                    this.render.setStyle(panel, 'top', pos.top + "px");
                    this.render.setStyle(panel, 'left', left + "px");
                }
            }
        }
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    FilterTextboxComponent.prototype.onTextValueChange = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        var _a;
        /** @type {?} */
        var value = $event.target.value;
        this.dfrs.filterTextboxChanged.emit((_a = {}, _a[this.column.field] = value, _a));
    };
    /**
     * @return {?}
     */
    FilterTextboxComponent.prototype.clearValue = /**
     * @return {?}
     */
    function () {
        this.filterStr = '';
        if (this.input) {
            this.input.nativeElement.value = '';
        }
        if (this.column.filter.type < 2) {
            this.disabled = false;
        }
        this.cd.detectChanges();
    };
    /**
     * @param {?} condition
     * @return {?}
     */
    FilterTextboxComponent.prototype.initFilter = /**
     * @param {?} condition
     * @return {?}
     */
    function (condition) {
        this.filterStr = this.dfrs.condition2string(this.column, condition);
        this.disabled = !!this.filterStr;
        this.dfrs._updateColumnConditions(this.column.field, condition);
        this.cd.detectChanges();
    };
    FilterTextboxComponent.decorators = [
        { type: Component, args: [{
                    selector: 'filter-textbox',
                    template: "\n    <div class=\"f-datagrid-header-cell-content f-datagrid-filter-cell d-flex\" style=\"padding-right: 5px\">\n        <div class=\"f-datagrid-cell-formgroup farris-group-auto flex-fill\">\n            <input *ngIf=\"!disabled\" class=\"form-control\" [attr.type]=\"inputType\" [value]=\"filterStr\"\n                (input)=\"onTextValueChange($event)\" #input>\n            <input *ngIf=\"disabled\" class=\"form-control\" type=\"text\" [value]=\"filterStr\"\n            [attr.title]=\"filterStr\" [disabled]=\"disabled\" [class.filter-editor-disabled]=\"disabled\" >\n        </div>\n        <div style=\"min-width: 26px; text-align: center; align-items: center;\n            display: flex; justify-content: center;\" *ngIf=\"column.filter.enableOperator\">\n            <span style=\"cursor: pointer;\" class=\"f-icon f-icon-filter-sm\" (click)=\"show($event)\"></span>\n        </div>\n    </div>\n    "
                }] }
    ];
    /** @nocollapse */
    FilterTextboxComponent.ctorParameters = function () { return [
        { type: ComponentFactoryResolver },
        { type: Injector },
        { type: ApplicationRef },
        { type: DatagridFilterRowService },
        { type: Renderer2 },
        { type: ChangeDetectorRef },
        { type: LocaleService }
    ]; };
    FilterTextboxComponent.propDecorators = {
        column: [{ type: Input }],
        disabled: [{ type: Input }],
        delay: [{ type: Input }],
        input: [{ type: ViewChild, args: ['input',] }]
    };
    return FilterTextboxComponent;
}(FilterRowEditorComponent));
export { FilterTextboxComponent };
if (false) {
    /** @type {?} */
    FilterTextboxComponent.prototype.column;
    /** @type {?} */
    FilterTextboxComponent.prototype.disabled;
    /** @type {?} */
    FilterTextboxComponent.prototype.delay;
    /** @type {?} */
    FilterTextboxComponent.prototype.filterStr;
    /** @type {?} */
    FilterTextboxComponent.prototype.gridInstance;
    /** @type {?} */
    FilterTextboxComponent.prototype.filterPanelRef;
    /** @type {?} */
    FilterTextboxComponent.prototype.filterPanelSubscription;
    /** @type {?} */
    FilterTextboxComponent.prototype.input;
    /**
     * @type {?}
     * @private
     */
    FilterTextboxComponent.prototype.ro;
    /**
     * @type {?}
     * @private
     */
    FilterTextboxComponent.prototype.zone;
    /**
     * @type {?}
     * @private
     */
    FilterTextboxComponent.prototype.el;
    /**
     * @type {?}
     * @private
     */
    FilterTextboxComponent.prototype.cfr;
    /**
     * @type {?}
     * @private
     */
    FilterTextboxComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    FilterTextboxComponent.prototype.app;
    /** @type {?} */
    FilterTextboxComponent.prototype.dfrs;
    /**
     * @type {?}
     * @private
     */
    FilterTextboxComponent.prototype.render;
    /**
     * @type {?}
     * @private
     */
    FilterTextboxComponent.prototype.cd;
    /**
     * @type {?}
     * @private
     */
    FilterTextboxComponent.prototype.localSer;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsdGVyLXJvdy10ZXh0Ym94LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktZGF0YWdyaWQtZmlsdGVyLyIsInNvdXJjZXMiOlsibGliL2ZpbHRlci1lZGl0b3JzL2ZpbHRlci1yb3ctdGV4dGJveC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDbEQsT0FBTyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsd0JBQXdCLEVBQUUsUUFBUSxFQUFnQixjQUFjLEVBQ3ZGLFNBQVMsRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLGlCQUFpQixFQUFFLE1BQU0sRUFBYSxNQUFNLGVBQWUsQ0FBQztBQUVsRyxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBZ0IsTUFBTSxnQkFBZ0IsQ0FBQztBQUU3RCxPQUFPLGNBQWMsTUFBTSwwQkFBMEIsQ0FBQztBQUV0RCxPQUFPLEVBQUUsZ0JBQWdCLEVBQXFCLE1BQU0scUJBQXFCLENBQUM7QUFFMUUsT0FBTyxFQUFFLGNBQWMsRUFDZixtQkFBbUIsRUFBRSwyQkFBMkIsRUFBRSxvQkFBb0IsR0FBRyxNQUFNLDJCQUEyQixDQUFDO0FBQ25ILE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBQ3ZFLE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBQzFFLE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxNQUFNLCtCQUErQixDQUFDO0FBRXpFO0lBaUI0QyxrREFBd0I7SUF5QmhFLGdDQUNZLEdBQTZCLEVBQVUsUUFBa0IsRUFBVSxHQUFtQixFQUN2RixJQUE4QixFQUFVLE1BQWlCLEVBQVUsRUFBcUIsRUFDdkYsUUFBdUI7UUFIbkMsWUFLSSxpQkFBTyxTQTJCVjtRQS9CVyxTQUFHLEdBQUgsR0FBRyxDQUEwQjtRQUFVLGNBQVEsR0FBUixRQUFRLENB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QUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxTQUFTLENBQUMsQ0FBQztRQUNwRSxJQUFJLENBQUMsUUFBUSxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDO1FBQ2pDLElBQUksQ0FBQyxJQUFJLENBQUMsdUJBQXVCLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsU0FBUyxDQUFDLENBQUM7UUFDaEUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUM1QixDQUFDOztnQkExT0osU0FBUyxTQUFDO29CQUNQLFFBQVEsRUFBRSxnQkFBZ0I7b0JBQzFCLFFBQVEsRUFBRSxnNUJBYVQ7aUJBQ0o7Ozs7Z0JBL0IwQix3QkFBd0I7Z0JBQUUsUUFBUTtnQkFBZ0IsY0FBYztnQkFZbEYsd0JBQXdCO2dCQVg3QixTQUFTO2dCQUF5QixpQkFBaUI7Z0JBRjlDLGFBQWE7Ozt5QkFrQ2pCLEtBQUs7MkJBQ0wsS0FBSzt3QkFDTCxLQUFLO3dCQWdCTCxTQUFTLFNBQUMsT0FBTzs7SUF1TXRCLDZCQUFDO0NBQUEsQUEzT0QsQ0FpQjRDLHdCQUF3QixHQTBObkU7U0ExTlksc0JBQXNCOzs7SUFDL0Isd0NBQXFCOztJQUNyQiwwQ0FBMEI7O0lBQzFCLHVDQUFxQjs7SUFDckIsMkNBQWU7O0lBU2YsOENBQWdDOztJQUVoQyxnREFBc0Q7O0lBRXRELHlEQUE2Qzs7SUFFN0MsdUNBQXNDOzs7OztJQUV0QyxvQ0FBeUM7Ozs7O0lBQ3pDLHNDQUE0Qjs7Ozs7SUFDNUIsb0NBQThCOzs7OztJQUcxQixxQ0FBcUM7Ozs7O0lBQUUsMENBQTBCOzs7OztJQUFFLHFDQUEyQjs7SUFDOUYsc0NBQXFDOzs7OztJQUFFLHdDQUF5Qjs7Ozs7SUFBRSxvQ0FBNkI7Ozs7O0lBQy9GLDBDQUErQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IExvY2FsZVNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWxvY2FsZSc7XHJcbmltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQsIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciwgSW5qZWN0b3IsIENvbXBvbmVudFJlZiwgQXBwbGljYXRpb25SZWYsXHJcbiAgICBSZW5kZXJlcjIsIFZpZXdDaGlsZCwgRWxlbWVudFJlZiwgQ2hhbmdlRGV0ZWN0b3JSZWYsIE5nWm9uZSwgT25EZXN0cm95IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBkZWxheSwgZmlsdGVyLCBkZWJvdW5jZVRpbWUgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcblxyXG5pbXBvcnQgUmVzaXplT2JzZXJ2ZXIgZnJvbSAncmVzaXplLW9ic2VydmVyLXBvbHlmaWxsJztcclxuXHJcbmltcG9ydCB7IENvbHVtbkZpbHRlclR5cGUsIERhdGFncmlkQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1kYXRhZ3JpZCc7XHJcblxyXG5pbXBvcnQgeyBGaWx0ZXJPcGVyYXRvciwgRmlsdGVyQ29uZGl0aW9uLFxyXG4gICAgICAgIFRleHRGaWx0ZXJPcGVyYXRvcnMsIE51bWJlck9yRGF0ZUZpbHRlck9wZXJhdG9ycywgRmlsdGVyQ29uZGl0aW9uVmFsdWUsIH0gZnJvbSAnLi8uLi9vcGVyYXRpb25zL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7IEZpbHRlclJvd1BhbmVsQ29tcG9uZW50IH0gZnJvbSAnLi9maWx0ZXItcm93LXBhbmVsLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IERhdGFncmlkRmlsdGVyUm93U2VydmljZSB9IGZyb20gJy4uL2RhdGFncmlkLWZpbHRlci1yb3cuc2VydmljZSc7XHJcbmltcG9ydCB7IEZpbHRlclJvd0VkaXRvckNvbXBvbmVudCB9IGZyb20gJy4vZmlsdGVyLXJvdy1lZGl0b3IuY29tcG9uZW50JztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdmaWx0ZXItdGV4dGJveCcsXHJcbiAgICB0ZW1wbGF0ZTogYFxyXG4gICAgPGRpdiBjbGFzcz1cImYtZGF0YWdyaWQtaGVhZGVyLWNlbGwtY29udGVudCBmLWRhdGFncmlkLWZpbHRlci1jZWxsIGQtZmxleFwiIHN0eWxlPVwicGFkZGluZy1yaWdodDogNXB4XCI+XHJcbiAgICAgICAgPGRpdiBjbGFzcz1cImYtZGF0YWdyaWQtY2VsbC1mb3JtZ3JvdXAgZmFycmlzLWdyb3VwLWF1dG8gZmxleC1maWxsXCI+XHJcbiAgICAgICAgICAgIDxpbnB1dCAqbmdJZj1cIiFkaXNhYmxlZFwiIGNsYXNzPVwiZm9ybS1jb250cm9sXCIgW2F0dHIudHlwZV09XCJpbnB1dFR5cGVcIiBbdmFsdWVdPVwiZmlsdGVyU3RyXCJcclxuICAgICAgICAgICAgICAgIChpbnB1dCk9XCJvblRleHRWYWx1ZUNoYW5nZSgkZXZlbnQpXCIgI2lucHV0PlxyXG4gICAgICAgICAgICA8aW5wdXQgKm5nSWY9XCJkaXNhYmxlZFwiIGNsYXNzPVwiZm9ybS1jb250cm9sXCIgdHlwZT1cInRleHRcIiBbdmFsdWVdPVwiZmlsdGVyU3RyXCJcclxuICAgICAgICAgICAgW2F0dHIudGl0bGVdPVwiZmlsdGVyU3RyXCIgW2Rpc2FibGVkXT1cImRpc2FibGVkXCIgW2NsYXNzLmZpbHRlci1lZGl0b3ItZGlzYWJsZWRdPVwiZGlzYWJsZWRcIiA+XHJcbiAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgPGRpdiBzdHlsZT1cIm1pbi13aWR0aDogMjZweDsgdGV4dC1hbGlnbjogY2VudGVyOyBhbGlnbi1pdGVtczogY2VudGVyO1xyXG4gICAgICAgICAgICBkaXNwbGF5OiBmbGV4OyBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjtcIiAqbmdJZj1cImNvbHVtbi5maWx0ZXIuZW5hYmxlT3BlcmF0b3JcIj5cclxuICAgICAgICAgICAgPHNwYW4gc3R5bGU9XCJjdXJzb3I6IHBvaW50ZXI7XCIgY2xhc3M9XCJmLWljb24gZi1pY29uLWZpbHRlci1zbVwiIChjbGljayk9XCJzaG93KCRldmVudClcIj48L3NwYW4+XHJcbiAgICAgICAgPC9kaXY+XHJcbiAgICA8L2Rpdj5cclxuICAgIGBcclxufSlcclxuZXhwb3J0IGNsYXNzIEZpbHRlclRleHRib3hDb21wb25lbnQgZXh0ZW5kcyBGaWx0ZXJSb3dFZGl0b3JDb21wb25lbnQgaW1wbGVtZW50cyBPbkRlc3Ryb3kge1xyXG4gICAgQElucHV0KCkgY29sdW1uOiBhbnk7XHJcbiAgICBASW5wdXQoKSBkaXNhYmxlZCA9IGZhbHNlO1xyXG4gICAgQElucHV0KCkgZGVsYXkgPSAzMDA7XHJcbiAgICBmaWx0ZXJTdHIgPSAnJztcclxuXHJcbiAgICBnZXQgaW5wdXRUeXBlKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmNvbHVtbi5maWx0ZXIudHlwZSA9PT0gQ29sdW1uRmlsdGVyVHlwZS5udW1iZXIgKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAnbnVtYmVyJztcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuICd0ZXh0JztcclxuICAgIH1cclxuXHJcbiAgICBncmlkSW5zdGFuY2U6IERhdGFncmlkQ29tcG9uZW50O1xyXG5cclxuICAgIGZpbHRlclBhbmVsUmVmOiBDb21wb25lbnRSZWY8RmlsdGVyUm93UGFuZWxDb21wb25lbnQ+O1xyXG5cclxuICAgIGZpbHRlclBhbmVsU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb24gPSBudWxsO1xyXG5cclxuICAgIEBWaWV3Q2hpbGQoJ2lucHV0JykgaW5wdXQ6IEVsZW1lbnRSZWY7XHJcblxyXG4gICAgcHJpdmF0ZSBybzogUmVzaXplT2JzZXJ2ZXIgfCBudWxsID0gbnVsbDtcclxuICAgIHByaXZhdGUgem9uZTogTmdab25lID0gbnVsbDtcclxuICAgIHByaXZhdGUgZWw6IEVsZW1lbnRSZWYgPSBudWxsO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIHByaXZhdGUgY2ZyOiBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yLCBwcml2YXRlIGFwcDogQXBwbGljYXRpb25SZWYsXHJcbiAgICAgICAgcHVibGljIGRmcnM6IERhdGFncmlkRmlsdGVyUm93U2VydmljZSwgcHJpdmF0ZSByZW5kZXI6IFJlbmRlcmVyMiwgcHJpdmF0ZSBjZDogQ2hhbmdlRGV0ZWN0b3JSZWYsXHJcbiAgICAgICAgcHJpdmF0ZSBsb2NhbFNlcjogTG9jYWxlU2VydmljZVxyXG4gICAgKSB7XHJcbiAgICAgICAgc3VwZXIoKTtcclxuXHJcbiAgICAgICAgdGhpcy56b25lID0gdGhpcy5pbmplY3Rvci5nZXQoTmdab25lKTtcclxuICAgICAgICB0aGlzLmVsID0gdGhpcy5pbmplY3Rvci5nZXQoRWxlbWVudFJlZik7XHJcblxyXG4gICAgICAgIHRoaXMuZGZycy5maWx0ZXJUZXh0Ym94Q2hhbmdlZC5waXBlKFxyXG4gICAgICAgICAgICBmaWx0ZXIodiA9PiB2W3RoaXMuY29sdW1uLmZpZWxkXSAhPT0gdW5kZWZpbmVkKSxcclxuICAgICAgICAgICAgZGVsYXkodGhpcy5kZWxheSlcclxuICAgICAgICApLnN1YnNjcmliZSgob2JqOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgdmFsID0gb2JqW3RoaXMuY29sdW1uLmZpZWxkXTtcclxuICAgICAgICAgICAgaWYgKHZhbCAhPT0gJycpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IF9jb25kaXRpb24gPSB7IG9wZXJhdG9yMTogRmlsdGVyT3BlcmF0b3IuQ29udGFpbnMsIHZhbHVlMTogdmFsIH07XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jb2x1bW4uZmlsdGVyLnR5cGUgPT09IENvbHVtbkZpbHRlclR5cGUubnVtYmVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgX2NvbmRpdGlvbi5vcGVyYXRvcjEgPSBGaWx0ZXJPcGVyYXRvci5FcXVhbDtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLmRmcnMudXBkYXRlQ29sdW1uQ29uZGl0aW9ucyh0aGlzLmNvbHVtbi5maWVsZCwgX2NvbmRpdGlvbiApO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kZnJzLnVwZGF0ZUNvbHVtbkNvbmRpdGlvbnModGhpcy5jb2x1bW4uZmllbGQsIEZpbHRlckNvbmRpdGlvblZhbHVlLkFsbCApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMuZGZycy5yZW1vdmVGaWVsZC5zdWJzY3JpYmUoZiA9PiB7XHJcbiAgICAgICAgICAgIGlmIChmID09PSB0aGlzLmNvbHVtbi5maWVsZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jbGVhclZhbHVlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcclxuICAgICAgICBpZiAodGhpcy5ybykge1xyXG4gICAgICAgICAgICB0aGlzLnJvLmRpc2Nvbm5lY3QoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc2hvdyhldmVudDogTW91c2VFdmVudCkge1xyXG4gICAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuXHJcbiAgICAgICAgY29uc3QgZGdDb250YWluZXJFbGUgPSAoZXZlbnQudGFyZ2V0IGFzIGFueSkuY2xvc2VzdCgnLmYtZGF0YWdyaWQnKTtcclxuICAgICAgICBpZiAoZGdDb250YWluZXJFbGUpIHtcclxuICAgICAgICAgICAgZGdDb250YWluZXJFbGUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICghdGhpcy5kZnJzLmdyaWRJbnN0YW5jZSkge1xyXG4gICAgICAgICAgICB0aGlzLmRmcnMuZ3JpZEluc3RhbmNlID0gdGhpcy5ncmlkSW5zdGFuY2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBjZiA9IHRoaXMuY2ZyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KEZpbHRlclJvd1BhbmVsQ29tcG9uZW50KTtcclxuICAgICAgICB0aGlzLmZpbHRlclBhbmVsUmVmID0gY2YuY3JlYXRlKHRoaXMuaW5qZWN0b3IpO1xyXG4gICAgICAgIHRoaXMuYXBwLmF0dGFjaFZpZXcodGhpcy5maWx0ZXJQYW5lbFJlZi5ob3N0Vmlldyk7XHJcbiAgICAgICAgdGhpcy5maWx0ZXJQYW5lbFJlZi5pbnN0YW5jZS5jb2x1bW4gPSB0aGlzLmNvbHVtbjtcclxuICAgICAgICB0aGlzLmZpbHRlclBhbmVsUmVmLmluc3RhbmNlLmdyaWRJbnN0YW5jZSA9IHRoaXMuZ3JpZEluc3RhbmNlO1xyXG5cclxuICAgICAgICB0aGlzLmluaXRPcGVyYXRvcnModGhpcy5maWx0ZXJQYW5lbFJlZi5pbnN0YW5jZSk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmNvbHVtbi5maWx0ZXIgIT09IGZhbHNlICYmIHRoaXMuY29sdW1uLmZpbHRlciAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZmlsdGVyUGFuZWxSZWYuaW5zdGFuY2UuZGF0YXR5cGUgPSB0aGlzLmNvbHVtbi5maWx0ZXIudHlwZTtcclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbHVtbi5maWx0ZXIudHlwZSA9PT0gQ29sdW1uRmlsdGVyVHlwZS5lbnVtIHx8XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbHVtbi5maWx0ZXIudHlwZSA9PT0gQ29sdW1uRmlsdGVyVHlwZS5mcm9tZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5maWx0ZXJQYW5lbFJlZi5pbnN0YW5jZS5oZWlnaHQgPSAgMzAwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBjdXJyZW50Q29sdW1uQ29uZGl0aW9uID0gdGhpcy5kZnJzLmNvbHVtbkNvbmRpdGlvbnNbdGhpcy5jb2x1bW4uZmllbGRdO1xyXG4gICAgICAgIGlmIChjdXJyZW50Q29sdW1uQ29uZGl0aW9uKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZmlsdGVyUGFuZWxSZWYuaW5zdGFuY2UuY29uZGl0aW9uID0gY3VycmVudENvbHVtbkNvbmRpdGlvbiBhcyBGaWx0ZXJDb25kaXRpb247XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5maWx0ZXJQYW5lbFJlZi5pbnN0YW5jZS5jb25kaXRpb24gPSB7XHJcbiAgICAgICAgICAgICAgICBvcGVyYXRvcjE6IDAsXHJcbiAgICAgICAgICAgICAgICB2YWx1ZTE6ICcnLFxyXG4gICAgICAgICAgICAgICAgcmVsYXRpb246ICcnLFxyXG4gICAgICAgICAgICAgICAgb3BlcmF0b3IyOiAwLFxyXG4gICAgICAgICAgICAgICAgdmFsdWUyOiAnJ1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAvLyB0aGlzLmluaXRPcGVyYXRvcnModGhpcy5maWx0ZXJQYW5lbFJlZi5pbnN0YW5jZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmZpbHRlclBhbmVsU3Vic2NyaXB0aW9uID0gdGhpcy5maWx0ZXJQYW5lbFJlZi5pbnN0YW5jZS5jb25kaXRpb25DaGFuZ2Uuc3Vic2NyaWJlKChjb25kaXRpb246IEZpbHRlckNvbmRpdGlvbikgPT4ge1xyXG4gICAgICAgICAgICBpZiAoY29uZGl0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRmcnMudXBkYXRlQ29sdW1uQ29uZGl0aW9ucyh0aGlzLmNvbHVtbi5maWVsZCwgY29uZGl0aW9uICk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZpbHRlclN0ciA9IHRoaXMuZGZycy5jb25kaXRpb24yc3RyaW5nKHRoaXMuY29sdW1uLCBjb25kaXRpb24pO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY29sdW1uLmZpbHRlci50eXBlIDwgMikge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGlzYWJsZWQgPSAhIXRoaXMuZmlsdGVyU3RyO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsZWFyVmFsdWUoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGZycy51cGRhdGVDb2x1bW5Db25kaXRpb25zKHRoaXMuY29sdW1uLmZpZWxkLCBGaWx0ZXJDb25kaXRpb25WYWx1ZS5BbGwpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5maWx0ZXJQYW5lbFJlZi5sb2NhdGlvbi5uYXRpdmVFbGVtZW50KTtcclxuXHJcbiAgICAgICAgdGhpcy51cGRhdGVGaWx0ZXJQYW5lbFBvc2l0aW9uKGV2ZW50LnRhcmdldCk7XHJcbiAgICAgICAgdGhpcy5kZnJzLnNldEZpbHRlclBhbmVsKHRoaXMuZmlsdGVyUGFuZWxSZWYpO1xyXG4gICAgICAgIGNvbnN0IGRnV2lkdGggPSBkZ0NvbnRhaW5lckVsZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aDtcclxuICAgICAgICB0aGlzLnpvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnJvID0gbmV3IFJlc2l6ZU9ic2VydmVyKChlbnRyaWVzLCBvYnNlcnZlcikgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKGVudHJpZXNbMF0udGFyZ2V0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoICE9PSBkZ1dpZHRoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdGhpcy5yby5vYnNlcnZlKGRnQ29udGFpbmVyRWxlKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGhpcy5maWx0ZXJQYW5lbFJlZi5pbnN0YW5jZS50YXJnZXQgPSBldmVudDtcclxuICAgICAgICB0aGlzLmZpbHRlclBhbmVsUmVmLmNoYW5nZURldGVjdG9yUmVmLm1hcmtGb3JDaGVjaygpO1xyXG4gICAgICAgIHRoaXMuZmlsdGVyUGFuZWxSZWYuY2hhbmdlRGV0ZWN0b3JSZWYuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgfVxyXG5cclxuICAgIGNsb3NlKCkge1xyXG4gICAgICAgIHRoaXMuZGZycy5jbG9zZUZpbHRlclBhbmVsKCk7XHJcbiAgICAgICAgaWYgKHRoaXMuZmlsdGVyUGFuZWxTdWJzY3JpcHRpb24pIHtcclxuICAgICAgICAgICAgdGhpcy5maWx0ZXJQYW5lbFN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICB0aGlzLmZpbHRlclBhbmVsU3Vic2NyaXB0aW9uID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBpbml0T3BlcmF0b3JzKGluczogRmlsdGVyUm93UGFuZWxDb21wb25lbnQpIHtcclxuICAgICAgICBpZiAodGhpcy5jb2x1bW4uZmlsdGVyLnR5cGUgPT09IENvbHVtbkZpbHRlclR5cGUuc3RyaW5nKSB7XHJcbiAgICAgICAgICAgIGlucy5vcGVyYXRvcnMgPSBUZXh0RmlsdGVyT3BlcmF0b3JzO1xyXG4gICAgICAgICAgICBpbnMuY29uZGl0aW9uLm9wZXJhdG9yMSA9IEZpbHRlck9wZXJhdG9yLkNvbnRhaW5zO1xyXG4gICAgICAgICAgICBpbnMuY29uZGl0aW9uLm9wZXJhdG9yMiA9IEZpbHRlck9wZXJhdG9yLkNvbnRhaW5zO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5jb2x1bW4uZmlsdGVyLnR5cGUgPT09IENvbHVtbkZpbHRlclR5cGUubnVtYmVyIHx8IHRoaXMuY29sdW1uLmZpbHRlci50eXBlID09PSBDb2x1bW5GaWx0ZXJUeXBlLmRhdGV0aW1lXHJcbiAgICAgICAgICAgIHx8IHRoaXMuY29sdW1uLmZpbHRlci50eXBlID09PSBDb2x1bW5GaWx0ZXJUeXBlLmRhdGUgfHwgdGhpcy5jb2x1bW4uZmlsdGVyLnR5cGUgPT09IENvbHVtbkZpbHRlclR5cGUudGltZSkge1xyXG4gICAgICAgICAgICBpbnMub3BlcmF0b3JzID0gTnVtYmVyT3JEYXRlRmlsdGVyT3BlcmF0b3JzO1xyXG4gICAgICAgICAgICBpbnMuY29uZGl0aW9uLm9wZXJhdG9yMSA9IEZpbHRlck9wZXJhdG9yLkVxdWFsO1xyXG4gICAgICAgICAgICBpbnMuY29uZGl0aW9uLm9wZXJhdG9yMiA9IEZpbHRlck9wZXJhdG9yLkVxdWFsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGlucy5vcGVyYXRvcnMpIHtcclxuICAgICAgICAgICAgaW5zLm9wZXJhdG9ycy5mb3JFYWNoKG8gPT4ge1xyXG4gICAgICAgICAgICAgICAgby5sYWJlbCA9IHRoaXMuZGZycy5nZXRPcGVyYXRvckxhYmVsKG8uY29kZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHVwZGF0ZUZpbHRlclBhbmVsUG9zaXRpb24odGFyZ2V0KSB7XHJcbiAgICAgICAgaWYgKHRhcmdldCkge1xyXG4gICAgICAgICAgICBjb25zdCBmaWx0ZXJJY29uUGFyZW50ID0gdGFyZ2V0LnBhcmVudEVsZW1lbnQ7XHJcbiAgICAgICAgICAgIGlmIChmaWx0ZXJJY29uUGFyZW50KSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBwb3MgPSBmaWx0ZXJJY29uUGFyZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdHIgPSB0YXJnZXQuY2xvc2VzdCgndHInKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHRkID0gdGFyZ2V0LmNsb3Nlc3QoJ3RkJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgaGVhZGVyUG9zID0gdGFyZ2V0LmNsb3Nlc3QoJy5mLWRhdGFncmlkLWhlYWRlcicpLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcGFuZWxXaWR0aCA9IHRoaXMuZmlsdGVyUGFuZWxSZWYuaW5zdGFuY2Uud2lkdGg7XHJcbiAgICAgICAgICAgICAgICBsZXQgbGVmdCA9IHBvcy5sZWZ0O1xyXG4gICAgICAgICAgICAgICAgaWYgKGhlYWRlclBvcy53aWR0aCArIGhlYWRlclBvcy54IDwgcG9zLnggKyBwYW5lbFdpZHRoICkgeyAvLyB0aGlzLmNvbHVtbi5maWx0ZXIudHlwZSA9PT0gQ29sdW1uRmlsdGVyVHlwZS5lbnVtXHJcbiAgICAgICAgICAgICAgICAgICAgbGVmdCA9IHRkLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmxlZnQgKyB0ZC5vZmZzZXRXaWR0aCAtIHBhbmVsV2lkdGg7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5maWx0ZXJQYW5lbFJlZi5sb2NhdGlvbi5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wYW5lbC1pY29uJykuc3R5bGUubGVmdCA9IGAke3BhbmVsV2lkdGggLSA0MH1weGA7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyBjb25zdCB0b3AgPSBwb3MudG9wXHJcbiAgICAgICAgICAgICAgICBjb25zdCBwYW5lbCA9IHRoaXMuZmlsdGVyUGFuZWxSZWYubG9jYXRpb24ubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCdkaXYnKTtcclxuICAgICAgICAgICAgICAgIGlmIChwYW5lbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyLnNldFN0eWxlKHBhbmVsLCAndG9wJywgYCR7cG9zLnRvcH1weGApO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyLnNldFN0eWxlKHBhbmVsLCAnbGVmdCcsIGAke2xlZnR9cHhgKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBvblRleHRWYWx1ZUNoYW5nZSgkZXZlbnQpIHtcclxuICAgICAgICBjb25zdCB2YWx1ZSA9ICRldmVudC50YXJnZXQudmFsdWU7XHJcbiAgICAgICAgdGhpcy5kZnJzLmZpbHRlclRleHRib3hDaGFuZ2VkLmVtaXQoeyBbdGhpcy5jb2x1bW4uZmllbGRdOiB2YWx1ZSB9KTtcclxuICAgIH1cclxuXHJcbiAgICBjbGVhclZhbHVlKCkge1xyXG4gICAgICAgIHRoaXMuZmlsdGVyU3RyID0gJyc7XHJcbiAgICAgICAgaWYgKHRoaXMuaW5wdXQpIHtcclxuICAgICAgICAgICAgdGhpcy5pbnB1dC5uYXRpdmVFbGVtZW50LnZhbHVlID0gJyc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmNvbHVtbi5maWx0ZXIudHlwZSA8IDIpIHtcclxuICAgICAgICAgICAgdGhpcy5kaXNhYmxlZCA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcclxuICAgIH1cclxuXHJcbiAgICBpbml0RmlsdGVyKGNvbmRpdGlvbjogYW55KSB7XHJcbiAgICAgICAgdGhpcy5maWx0ZXJTdHIgPSB0aGlzLmRmcnMuY29uZGl0aW9uMnN0cmluZyh0aGlzLmNvbHVtbiwgY29uZGl0aW9uKTtcclxuICAgICAgICB0aGlzLmRpc2FibGVkID0gISF0aGlzLmZpbHRlclN0cjtcclxuICAgICAgICB0aGlzLmRmcnMuX3VwZGF0ZUNvbHVtbkNvbmRpdGlvbnModGhpcy5jb2x1bW4uZmllbGQsIGNvbmRpdGlvbik7XHJcbiAgICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICB9XHJcbn1cclxuIl19