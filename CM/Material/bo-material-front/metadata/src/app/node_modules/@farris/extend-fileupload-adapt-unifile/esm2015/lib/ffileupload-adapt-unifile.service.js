/**
 * @fileoverview added by tsickle
 * Generated from: lib/ffileupload-adapt-unifile.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { UploadServerService, UploadStatus } from '@farris/extend-file-upload';
import { Observable, forkJoin, of, EMPTY, concat, Subject } from 'rxjs';
import { UploadService, GspFormUploadListEntity, GspFormRemoveListEntity, GspFormDocInfo, GspFormUploadEntity, OperatingModes } from '@gsp-svc/formdoc-upload';
import { FFileUploadAdaptUnifileConfigService } from './ffileupload-adapt-unifile.config';
import { catchError, delay, expand, last, map, switchMap } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "@gsp-svc/formdoc-upload";
import * as i2 from "./ffileupload-adapt-unifile.config";
export class FfileuploadAdaptUnifileService extends UploadServerService {
    /**
     * @param {?} uploadSer
     * @param {?} configSer
     */
    constructor(uploadSer, configSer) {
        super();
        this.uploadSer = uploadSer;
        this.configSer = configSer;
        // 暂时用于简单合并
        this.bufferSize = 1024 * 1024;
        this.uploadedChunk = {};
        this.fileTotalChunk = {};
        this.extendData = this.configSer.getConfig();
    }
    /**
     * @private
     * @return {?}
     */
    uuid() {
        /** @type {?} */
        let S4 = (/**
         * @return {?}
         */
        function () {
            return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);
        });
        /** @type {?} */
        let nGuid = S4() + S4() + S4() + S4() + S4() + S4() + S4() + S4();
        return nGuid;
    }
    /**
     * 删除文件
     * @param {?} files
     * @param {?} event
     * @param {?} extendService
     * @return {?}
     */
    remove(files, event, extendService) {
        return this.innerRemoveList(files, event, extendService);
    }
    /**
     * @private
     * @param {?} files
     * @param {?} event
     * @param {?=} extendService
     * @return {?}
     */
    innerRemoveList(files, event, extendService = null) {
        return new Observable((/**
         * @param {?} observer
         * @return {?}
         */
        observer => {
            /** @type {?} */
            let removeFileInfo = new GspFormRemoveListEntity;
            /** @type {?} */
            let metadataIdList = [];
            files.forEach((/**
             * @param {?} fileItem
             * @return {?}
             */
            fileItem => {
                if (fileItem['response']) {
                    metadataIdList.push(fileItem['response']['metadataId']);
                }
            }));
            removeFileInfo.mode = this.getFinallyConfig('mode', extendService);
            /** @type {?} */
            let rootId = this.getFinallyConfig('rootId', extendService);
            removeFileInfo.metadataIdList = [].concat(metadataIdList);
            this.uploadSer.removeList(metadataIdList, rootId).subscribe((/**
             * @param {?} result
             * @return {?}
             */
            result => {
                // 没有需要整合的服务器端返回数据
                observer.next({ type: 'removed', files: files });
            }), (/**
             * @param {?} error
             * @return {?}
             */
            error => {
                observer.error(error);
                observer.complete();
            }), (/**
             * @return {?}
             */
            () => {
                observer.complete();
            }));
        }));
    }
    /**
     * 上传文件
     * @param {?} files
     * @param {?} event
     * @param {?} extendService
     * @return {?}
     */
    upload(files, event, extendService) {
        if (event.type == 'sliceUpload') {
            return this.uploadBigFile(files, event, extendService);
        }
        return this.innerUploadList(files, event, extendService);
    }
    /**
     * 内部上传方式
     * @private
     * @param {?} files
     * @param {?} event
     * @param {?} extendService
     * @return {?}
     */
    innerUploadList(files, event, extendService) {
        return new Observable((/**
         * @param {?} observer
         * @return {?}
         */
        observer => {
            /** @type {?} */
            let uploadInfo = new GspFormUploadListEntity;
            uploadInfo.formId = this.getFinallyConfig('formId', extendService);
            uploadInfo.mode = this.getFinallyConfig('mode', extendService);
            /** @type {?} */
            let rootId = this.getFinallyConfig('rootId', extendService);
            uploadInfo.docInfoList = [];
            /** @type {?} */
            let readerObserable = [];
            files.forEach((/**
             * @param {?} fileItem
             * @return {?}
             */
            (fileItem) => {
                /** @type {?} */
                let sub = new Observable((/**
                 * @param {?} obser
                 * @return {?}
                 */
                obser => {
                    /** @type {?} */
                    let reader = new FileReader();
                    // 暂不处理异常
                    reader.readAsBinaryString(fileItem.nativeFile);
                    reader.onload = (/**
                     * @param {?} e
                     * @return {?}
                     */
                    (e) => {
                        /** @type {?} */
                        let info = (/** @type {?} */ ({ 'fileName': '', 'fileContent': '' }));
                        info['fileName'] = fileItem.name;
                        info['fileContent'] = btoa(reader.result.toString());
                        // 如果data里有数据，并且属性是配置的扩展属性
                        if (event.hasOwnProperty('data') && event['data'] && event['data'].hasOwnProperty('extProperty')) {
                            // 
                            info['extProperty'] = event['data']['extProperty'];
                        }
                        uploadInfo.docInfoList.push(info);
                        obser.next();
                        obser.complete();
                    });
                }));
                readerObserable.push(sub);
            }));
            forkJoin(readerObserable).subscribe((/**
             * @param {?} datas
             * @return {?}
             */
            datas => {
                //     metadataId: string;
                //  fileName: string;
                this.uploadSer.uploadList(uploadInfo, rootId).subscribe((/**
                 * @param {?} result
                 * @return {?}
                 */
                result => {
                    if (result.error) {
                        // 此接口一旦出现问题，所有附件都上传不通过
                        observer.error(this.errorInfoFormat(result.error, files));
                        observer.complete();
                        return;
                    }
                    // 合并返回结果到此处
                    result.forEach((/**
                     * @param {?} item
                     * @return {?}
                     */
                    item => {
                        /** @type {?} */
                        var findIndex = this.findFileIndexByFileName(files, item.fileName);
                        if (findIndex > -1) {
                            files[findIndex]['response'] = item;
                            files[findIndex]['progress']['status'] = UploadStatus.Done;
                        }
                    }));
                    observer.next({ type: 'done', files: files });
                }), (/**
                 * @param {?} error
                 * @return {?}
                 */
                error => {
                    observer.error(this.errorInfoFormat(error, files));
                    observer.complete();
                }), (/**
                 * @return {?}
                 */
                () => {
                    observer.complete();
                }));
            }));
        }));
    }
    ;
    /**
     * 分片加载
     * @param {?} file
     * @param {?} event
     * @param {?} extendService
     * @return {?}
     */
    multipartUpload(file, event, extendService) {
        return new Observable((/**
         * @param {?} observer
         * @return {?}
         */
        observer => {
            // let fileInfo: FileInfo;
            /** @type {?} */
            let uuid = this.uuid();
            // let uuid = UUID.UUID();
            //reader.readAsBinaryString(selectedFile);
            //reader.onload = (e) => {
            /** @type {?} */
            let fileName = file.name;
            // fileInfo = {
            //   id: uuid,
            //   name: fileName,
            //   type: file.type,
            //   source: "",
            //   size: this.formatFileSize(file.size),
            //   fileSize: file.size,
            //   picListDisplayName: this.getMultipartDisplayName(fileName),
            //   queueListDisplayName: fileName,
            //   //content: reader.result.toString(),
            //   hasUploaded: false,
            //   mouseOn: false,
            //   selectd: false,
            //   isUploading: true,
            //   uploadResult: false,
            //   uploadProcess: 0,
            //   errorMessage: "",
            //   extensionDropListId: 0,
            //   extensionName: ""
            // }
            /** @type {?} */
            let chunkTotal = Math.ceil(file.size / this.bufferSize);
            // 标记当前附件总的分片数
            this.fileTotalChunk[uuid] = chunkTotal;
            /** @type {?} */
            let chunkIndex = 0;
            // 标记当前附件成功的分片数
            this.uploadedChunk[uuid] = 0;
            while (chunkIndex < chunkTotal) {
                /** @type {?} */
                let uploadInfo = new GspFormUploadEntity;
                uploadInfo.mode = OperatingModes.Temp;
                uploadInfo.formId = this.getFinallyConfig('formId', extendService);
                uploadInfo.rootId = this.getFinallyConfig('rootId', extendService);
                /** @type {?} */
                let docInfo = new GspFormDocInfo;
                docInfo.fileName = fileName;
                docInfo.metadataId = uuid;
                docInfo.total = chunkTotal;
                // 如果data里有数据，并且属性是配置的扩展属性
                if (event.hasOwnProperty('data') && event['data'] && event['data'].hasOwnProperty('extProperty')) {
                    docInfo['extProperty'] = (/** @type {?} */ (event['data']['extProperty']));
                }
                // 下一个文件大小
                /** @type {?} */
                let nextSize = Math.min((chunkIndex + 1) * this.bufferSize, file.size);
                // File类型
                /** @type {?} */
                let fileData = file['nativeFile'].slice(chunkIndex * this.bufferSize, nextSize);
                // 读取文件
                /** @type {?} */
                let reader = new FileReader();
                reader.readAsBinaryString(fileData);
                /** @type {?} */
                let innerIndex = chunkIndex;
                reader.onload = (/**
                 * @return {?}
                 */
                () => {
                    // 附件上传
                    docInfo.fileContent = btoa(reader.result.toString());
                    docInfo.index = innerIndex;
                    uploadInfo.docInfo = docInfo;
                    /** @type {?} */
                    let info = uploadInfo;
                    this.uploadSer.uploadFile(info).subscribe((/**
                     * @param {?} result
                     * @return {?}
                     */
                    result => {
                        if (result && result.error) {
                            // 分片上传有返回结果就是报错了
                            observer.error(this.errorInfoFormat(result.error, [file]));
                            observer.complete();
                            return;
                        }
                        else {
                            this.uploadedChunk[uuid]++;
                            if (this.uploadedChunk[docInfo.metadataId] == this.fileTotalChunk[docInfo.metadataId]) {
                                // 判断是所有分片都上传完成
                                file.progress = {
                                    status: UploadStatus.Done,
                                    data: {
                                        percentage: 100
                                    }
                                };
                                file.response = docInfo;
                                delete this.uploadedChunk[uuid];
                                delete this.fileTotalChunk[uuid];
                                observer.next({ type: 'done', files: [file] });
                                observer.complete();
                            }
                            else {
                                // 分片上传正常
                                /** @type {?} */
                                const percentage = Number.parseInt((this.uploadedChunk[uuid] / this.fileTotalChunk[uuid] * 100).toFixed(0));
                                // 判断未上传完成
                                file.progress = {
                                    status: UploadStatus.Uploading,
                                    data: {
                                        percentage: percentage
                                    }
                                };
                                observer.next({ type: 'uploading', files: [file] });
                            }
                        }
                    }), (/**
                     * @param {?} error
                     * @return {?}
                     */
                    error => {
                        delete this.uploadedChunk[uuid];
                        delete this.fileTotalChunk[uuid];
                        observer.error(this.errorInfoFormat(error, [file]));
                        observer.complete();
                    }));
                });
                chunkIndex = chunkIndex + 1;
            }
        }));
    }
    /**
     * 获取分片的附件大小
     * @private
     * @param {?} size
     * @return {?}
     */
    formatFileSize(size) {
        if (size < 102400)
            return (size / 1024).toFixed(1) + "K";
        else if (size < 1024 * 1024)
            return (size / 1024).toFixed(0) + "K";
        else if (size < 100 * 1024 * 1024)
            return (size / 1024 / 1024).toFixed(1) + "M";
        else if (size < 1024 * 1024 * 1024)
            return (size / 1024 / 1024).toFixed(0) + "M";
        else
            return (size / 1024 / 1024 / 1024).toFixed(1) + "G";
    }
    /**
     * 获取分片的 附件名称
     * @private
     * @param {?} fileName
     * @return {?}
     */
    getMultipartDisplayName(fileName) {
        if (fileName.length <= 10)
            return fileName;
        else {
            /** @type {?} */
            let headContent = fileName.substring(0, 2);
            /** @type {?} */
            let tailContent = fileName.substring(fileName.lastIndexOf('.') - 2);
            return headContent + "…" + tailContent;
        }
    }
    /**
     * @private
     * @param {?} error
     * @param {?} files
     * @return {?}
     */
    errorInfoFormat(error, files) {
        // 
        /** @type {?} */
        let errorFiles = files.map((/**
         * @param {?} item
         * @return {?}
         */
        item => {
            return { id: item.id, name: item.name };
        }));
        if (error) {
            return Object.assign(error, { files: errorFiles }, { message: error['Message'] || error['extensionMessage'] || '上传失败', type: 'error' });
        }
        else {
            return Object.assign({ files: errorFiles }, { message: '上传失败', type: 'error' });
        }
    }
    /**
     * 返回最终属性值
     * @private
     * @param {?} key
     * @param {?} extendValue
     * @return {?}
     */
    getFinallyConfig(key, extendValue) {
        if (extendValue && extendValue.hasOwnProperty(key)) {
            return extendValue[key];
        }
        return this.extendData[key];
    }
    /**
     * @private
     * @param {?} files
     * @param {?} fileName
     * @return {?}
     */
    findFileIndexByFileName(files, fileName) {
        // 按照肯定能找到文件来处理
        /** @type {?} */
        let findIndex = files.findIndex((/**
         * @param {?} file
         * @return {?}
         */
        file => file.name == fileName));
        return findIndex;
    }
    //#region 大文件分片上传
    /**
     * @param {?} files
     * @param {?} event
     * @param {?} extendService
     * @return {?}
     */
    uploadBigFile(files, event, extendService) {
        /** @type {?} */
        const uploadChunks$ = new Subject();
        /** @type {?} */
        const _files = files.map((/**
         * @param {?} n
         * @return {?}
         */
        n => {
            /** @type {?} */
            const chunks = this._getBigFileChunks(n, event, extendService);
            return Object.assign({}, n, chunks);
        }));
        /** @type {?} */
        const uploadchunks$ = _files.map((/**
         * @param {?} f
         * @return {?}
         */
        (f) => this.uploadChunks(f, uploadChunks$)));
        concat(...uploadchunks$).subscribe((/**
         * @param {?} f
         * @return {?}
         */
        (f) => {
            // console.log(`file: ${f.name} - upload complete`);
            f.progress = {
                status: UploadStatus.Done,
                data: {
                    percentage: 100
                }
            };
            f.response = JSON.parse(f.chunks[0].get('docInfo'));
            uploadChunks$.next({ type: 'done', files: [f] });
        }), (/**
         * @param {?} error
         * @return {?}
         */
        error => {
            uploadChunks$.error(this.errorInfoFormat(error, files));
            uploadChunks$.complete();
        }), (/**
         * @return {?}
         */
        () => {
            uploadChunks$.complete();
            // console.log("all files uploaded")
        }));
        return uploadChunks$.asObservable();
    }
    /**
     * @private
     * @param {?} file
     * @return {?}
     */
    uploadFileChunk(file) {
        /** @type {?} */
        const url = "/api/runtime/dfs/v1.0/formdoc/slice";
        return this.uploadSer['http']['http'].post(url, file.chunks[file.total]).pipe(switchMap((/**
         * @return {?}
         */
        () => {
            return of(file);
        })), catchError((/**
         * @param {?} error
         * @return {?}
         */
        (error) => {
            return of(error);
        })));
    }
    /**
     * @private
     * @param {?} file
     * @param {?} upChunk$
     * @return {?}
     */
    uploadChunks(file, upChunk$) {
        /** @type {?} */
        const doChunksRemain = (/**
         * @param {?} i
         * @return {?}
         */
        (i) => i > -1);
        /** @type {?} */
        const completeUpload = (/**
         * @param {?} f
         * @return {?}
         */
        (f) => of(f));
        /** @type {?} */
        const uploadChunk = (/**
         * @param {?} f
         * @return {?}
         */
        (f) => {
            return this.uploadFileChunk(f).pipe(delay(100), map((/**
             * @param {?} f
             * @return {?}
             */
            (f) => {
                // 块数为0 时，即为此文件的所有块均上传成功
                f.progress = {
                    status: UploadStatus.Uploading,
                    data: {
                        percentage: (f.total / f.chunks.length * 100).toFixed(0)
                    }
                };
                upChunk$.next({ type: 'uploading', files: [f] });
                return f;
            })));
        });
        /** @type {?} */
        const createMultipartUpload = (/**
         * @param {?} f
         * @return {?}
         */
        (f) => of(f));
        return createMultipartUpload(file).pipe(
        // tap((f) => console.log("upload file", f.name)),
        expand((/**
         * @param {?} f
         * @return {?}
         */
        (f) => {
            if (doChunksRemain(--file.total)) {
                return uploadChunk(file);
            }
            return EMPTY;
        })), 
        // tap((f: any) => {
        //     console.log(`file: ${f.name} - remaining chunks: ${f.total}`);
        // }),
        last(), switchMap((/**
         * @param {?} res
         * @return {?}
         */
        (res) => {
            return completeUpload(file);
        })));
    }
    /**
     * @private
     * @param {?} file
     * @param {?} event
     * @param {?} extendService
     * @return {?}
     */
    _getBigFileChunks(file, event, extendService) {
        /** @type {?} */
        let uuid = this.uuid();
        /** @type {?} */
        let chunkTotal = Math.ceil(file.size / this.bufferSize * (event.chunkSize || 1));
        /** @type {?} */
        let chunkIndex = 0;
        /** @type {?} */
        const fileChunks = { chunks: [], total: chunkTotal };
        while (chunkIndex < chunkTotal) {
            /** @type {?} */
            let uploadInfo = new GspFormUploadEntity;
            uploadInfo.mode = OperatingModes.Temp;
            uploadInfo.formId = this.getFinallyConfig('formId', extendService);
            uploadInfo.rootId = this.getFinallyConfig('rootId', extendService);
            /** @type {?} */
            let docInfo = new GspFormDocInfo;
            docInfo.fileName = file.name;
            docInfo.metadataId = uuid;
            docInfo.total = chunkTotal;
            /** @type {?} */
            let nextSize = Math.min((chunkIndex + 1) * this.bufferSize, file.size);
            // File类型
            /** @type {?} */
            let fileData = file['nativeFile'].slice(chunkIndex * this.bufferSize, nextSize);
            docInfo.size = file.size;
            docInfo.index = chunkIndex;
            docInfo.fileContent = "";
            // 如果data里有数据，并且属性是配置的扩展属性
            if (event.hasOwnProperty('data') && event['data'] && event['data'].hasOwnProperty('extProperty')) {
                docInfo['extProperty'] = (/** @type {?} */ (event['data']['extProperty']));
            }
            uploadInfo.docInfo = docInfo;
            //封装请求formdata
            /** @type {?} */
            let formData = new FormData();
            formData.append('uploadInfo', JSON.stringify(uploadInfo));
            formData.append('docInfo', JSON.stringify(docInfo));
            formData.append('file', fileData);
            fileChunks.chunks.push(formData);
            chunkIndex = chunkIndex + 1;
        }
        return fileChunks;
    }
}
FfileuploadAdaptUnifileService.previous = 0;
FfileuploadAdaptUnifileService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
/** @nocollapse */
FfileuploadAdaptUnifileService.ctorParameters = () => [
    { type: UploadService },
    { type: FFileUploadAdaptUnifileConfigService }
];
/** @nocollapse */ FfileuploadAdaptUnifileService.ngInjectableDef = i0.defineInjectable({ factory: function FfileuploadAdaptUnifileService_Factory() { return new FfileuploadAdaptUnifileService(i0.inject(i1.UploadService), i0.inject(i2.FFileUploadAdaptUnifileConfigService)); }, token: FfileuploadAdaptUnifileService, providedIn: "root" });
if (false) {
    /**
     * @type {?}
     * @private
     */
    FfileuploadAdaptUnifileService.previous;
    /** @type {?} */
    FfileuploadAdaptUnifileService.prototype.extendData;
    /** @type {?} */
    FfileuploadAdaptUnifileService.prototype.bufferSize;
    /**
     * @type {?}
     * @private
     */
    FfileuploadAdaptUnifileService.prototype.uploadedChunk;
    /**
     * @type {?}
     * @private
     */
    FfileuploadAdaptUnifileService.prototype.fileTotalChunk;
    /**
     * @type {?}
     * @private
     */
    FfileuploadAdaptUnifileService.prototype.uploadSer;
    /**
     * @type {?}
     * @private
     */
    FfileuploadAdaptUnifileService.prototype.configSer;
    /* Skipping unhandled member: ;*/
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmZpbGV1cGxvYWQtYWRhcHQtdW5pZmlsZS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9leHRlbmQtZmlsZXVwbG9hZC1hZGFwdC11bmlmaWxlLyIsInNvdXJjZXMiOlsibGliL2ZmaWxldXBsb2FkLWFkYXB0LXVuaWZpbGUuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLG1CQUFtQixFQUEyQixZQUFZLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUN4RyxPQUFPLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxFQUFFLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDeEUsT0FBTyxFQUFFLGFBQWEsRUFBRSx1QkFBdUIsRUFBRSx1QkFBdUIsRUFBRSxjQUFjLEVBQUUsbUJBQW1CLEVBQVksY0FBYyxFQUFzQixNQUFNLHlCQUF5QixDQUFDO0FBQzdMLE9BQU8sRUFBRSxvQ0FBb0MsRUFBaUMsTUFBTSxvQ0FBb0MsQ0FBQztBQUN6SCxPQUFPLEVBQUUsVUFBVSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLEdBQUcsRUFBRSxTQUFTLEVBQU8sTUFBTSxnQkFBZ0IsQ0FBQzs7OztBQU10RixNQUFNLE9BQU8sOEJBQStCLFNBQVEsbUJBQW1COzs7OztJQVVuRSxZQUFvQixTQUF3QixFQUFVLFNBQStDO1FBQ2pHLEtBQUssRUFBRSxDQUFDO1FBRFEsY0FBUyxHQUFULFNBQVMsQ0FBZTtRQUFVLGNBQVMsR0FBVCxTQUFTLENBQXNDOztRQVJyRyxlQUFVLEdBQUcsSUFBSSxHQUFHLElBQUksQ0FBQztRQUVqQixrQkFBYSxHQUFHLEVBQUUsQ0FBQztRQUNuQixtQkFBYyxHQUFHLEVBQUUsQ0FBQztRQU94QixJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxT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QU0sQ0FBQyxJQUFJLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxjQUFjLENBQUMsYUFBYSxDQUFDLEVBQUU7Z0JBQzlGLE9BQU8sQ0FBQyxhQUFhLENBQUMsR0FBRyxtQkFBQSxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsYUFBYSxDQUFDLEVBQXNCLENBQUM7YUFDL0U7WUFHRCxVQUFVLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQzs7O2dCQUd6QixRQUFRLEdBQUcsSUFBSSxRQUFRLEVBQUU7WUFDN0IsUUFBUSxDQUFDLE1BQU0sQ0FBQyxZQUFZLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDO1lBQzFELFFBQVEsQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztZQUNwRCxRQUFRLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRSxRQUFRLENBQUMsQ0FBQztZQUVsQyxVQUFVLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUNqQyxVQUFVLEdBQUcsVUFBVSxHQUFHLENBQUMsQ0FBQztTQUMvQjtRQUVELE9BQU8sVUFBVSxDQUFDO0lBRXRCLENBQUM7O0FBcmNjLHVDQUFRLEdBQUcsQ0FBQyxDQUFDOztZQU4vQixVQUFVLFNBQUM7Z0JBQ1IsVUFBVSxFQUFFLE1BQU07YUFDckI7Ozs7WUFQUSxhQUFhO1lBQ2Isb0NBQW9DOzs7Ozs7OztJQVV6Qyx3Q0FBNEI7O0lBRjVCLG9EQUFXOztJQUNYLG9EQUF5Qjs7Ozs7SUFFekIsdURBQTJCOzs7OztJQUMzQix3REFBNEI7Ozs7O0lBS2hCLG1EQUFnQzs7Ozs7SUFBRSxtREFBdUQiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFVwbG9hZFNlcnZlclNlcnZpY2UsIFVwbG9hZEZpbGUsIFVwbG9hZElucHV0LCBVcGxvYWRTdGF0dXMgfSBmcm9tICdAZmFycmlzL2V4dGVuZC1maWxlLXVwbG9hZCc7XHJcbmltcG9ydCB7IE9ic2VydmFibGUsIGZvcmtKb2luLCBvZiwgRU1QVFksIGNvbmNhdCwgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBVcGxvYWRTZXJ2aWNlLCBHc3BGb3JtVXBsb2FkTGlzdEVudGl0eSwgR3NwRm9ybVJlbW92ZUxpc3RFbnRpdHksIEdzcEZvcm1Eb2NJbmZvLCBHc3BGb3JtVXBsb2FkRW50aXR5LCBGaWxlSW5mbywgT3BlcmF0aW5nTW9kZXMsIEdzcERvY01ldGFQcm9wZXJ0eSB9IGZyb20gJ0Bnc3Atc3ZjL2Zvcm1kb2MtdXBsb2FkJztcclxuaW1wb3J0IHsgRkZpbGVVcGxvYWRBZGFwdFVuaWZpbGVDb25maWdTZXJ2aWNlLCBGRmlsZVVwbG9hZEFkYXB0VW5pZmlsZUNvbmZpZyB9IGZyb20gJy4vZmZpbGV1cGxvYWQtYWRhcHQtdW5pZmlsZS5jb25maWcnO1xyXG5pbXBvcnQgeyBjYXRjaEVycm9yLCBkZWxheSwgZXhwYW5kLCBsYXN0LCBtYXAsIHN3aXRjaE1hcCwgdGFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBIdHRwRXJyb3JSZXNwb25zZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcclxuXHJcbkBJbmplY3RhYmxlKHtcclxuICAgIHByb3ZpZGVkSW46ICdyb290J1xyXG59KVxyXG5leHBvcnQgY2xhc3MgRmZpbGV1cGxvYWRBZGFwdFVuaWZpbGVTZXJ2aWNlIGV4dGVuZHMgVXBsb2FkU2VydmVyU2VydmljZSB7XHJcbiAgICBleHRlbmREYXRhOy8vIOaaguaXtueUqOS6jueugOWNleWQiOW5tlxyXG4gICAgYnVmZmVyU2l6ZSA9IDEwMjQgKiAxMDI0O1xyXG4gICAgcHJpdmF0ZSBzdGF0aWMgcHJldmlvdXMgPSAwO1xyXG4gICAgcHJpdmF0ZSB1cGxvYWRlZENodW5rID0ge307XHJcbiAgICBwcml2YXRlIGZpbGVUb3RhbENodW5rID0ge307XHJcblxyXG5cclxuICAgIFxyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgdXBsb2FkU2VyOiBVcGxvYWRTZXJ2aWNlLCBwcml2YXRlIGNvbmZpZ1NlcjogRkZpbGVVcGxvYWRBZGFwdFVuaWZpbGVDb25maWdTZXJ2aWNlKSB7XHJcbiAgICAgICAgc3VwZXIoKTtcclxuICAgICAgICB0aGlzLmV4dGVuZERhdGEgPSB0aGlzLmNvbmZpZ1Nlci5nZXRDb25maWcoKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHV1aWQoKSB7XHJcbiAgICAgICAgbGV0IFM0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gKCgoMSArIE1hdGgucmFuZG9tKCkpICogMHgxMDAwMCkgfCAwKS50b1N0cmluZygxNikuc3Vic3RyaW5nKDEpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgbGV0IG5HdWlkID0gUzQoKSArIFM0KCkgKyBTNCgpICsgUzQoKSArIFM0KCkgKyBTNCgpICsgUzQoKSArIFM0KCk7XHJcbiAgICAgICAgcmV0dXJuIG5HdWlkO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDliKDpmaTmlofku7ZcclxuICAgICAqIEBwYXJhbSBmaWxlIFxyXG4gICAgICogQHBhcmFtIGV2ZW50IFxyXG4gICAgICovXHJcbiAgICByZW1vdmUoZmlsZXM6IFVwbG9hZEZpbGVbXSwgZXZlbnQ6IFVwbG9hZElucHV0LCBleHRlbmRTZXJ2aWNlOiBGRmlsZVVwbG9hZEFkYXB0VW5pZmlsZUNvbmZpZyk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5uZXJSZW1vdmVMaXN0KGZpbGVzLCBldmVudCwgZXh0ZW5kU2VydmljZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBpbm5lclJlbW92ZUxpc3QoZmlsZXM6IFVwbG9hZEZpbGVbXSwgZXZlbnQ6IFVwbG9hZElucHV0LCBleHRlbmRTZXJ2aWNlID0gbnVsbCk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBPYnNlcnZhYmxlKG9ic2VydmVyID0+IHtcclxuICAgICAgICAgICAgbGV0IHJlbW92ZUZpbGVJbmZvID0gbmV3IEdzcEZvcm1SZW1vdmVMaXN0RW50aXR5O1xyXG4gICAgICAgICAgICBsZXQgbWV0YWRhdGFJZExpc3QgPSBbXTtcclxuICAgICAgICAgICAgZmlsZXMuZm9yRWFjaChmaWxlSXRlbSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZmlsZUl0ZW1bJ3Jlc3BvbnNlJ10pIHtcclxuICAgICAgICAgICAgICAgICAgICBtZXRhZGF0YUlkTGlzdC5wdXNoKGZpbGVJdGVtWydyZXNwb25zZSddWydtZXRhZGF0YUlkJ10pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJlbW92ZUZpbGVJbmZvLm1vZGUgPSB0aGlzLmdldEZpbmFsbHlDb25maWcoJ21vZGUnLCBleHRlbmRTZXJ2aWNlKTtcclxuICAgICAgICAgICAgbGV0IHJvb3RJZCA9IHRoaXMuZ2V0RmluYWxseUNvbmZpZygncm9vdElkJywgZXh0ZW5kU2VydmljZSk7XHJcbiAgICAgICAgICAgIHJlbW92ZUZpbGVJbmZvLm1ldGFkYXRhSWRMaXN0ID0gW10uY29uY2F0KG1ldGFkYXRhSWRMaXN0KTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMudXBsb2FkU2VyLnJlbW92ZUxpc3QobWV0YWRhdGFJZExpc3QsIHJvb3RJZCkuc3Vic2NyaWJlKHJlc3VsdCA9PiB7XHJcbiAgICAgICAgICAgICAgICAvLyDmsqHmnInpnIDopoHmlbTlkIjnmoTmnI3liqHlmajnq6/ov5Tlm57mlbDmja5cclxuICAgICAgICAgICAgICAgIG9ic2VydmVyLm5leHQoeyB0eXBlOiAncmVtb3ZlZCcsIGZpbGVzOiBmaWxlcyB9KTtcclxuICAgICAgICAgICAgfSwgZXJyb3IgPT4ge1xyXG4gICAgICAgICAgICAgICAgb2JzZXJ2ZXIuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcclxuICAgICAgICAgICAgfSwgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOS4iuS8oOaWh+S7tlxyXG4gICAgICogQHBhcmFtIGZpbGUgXHJcbiAgICAgKiBAcGFyYW0gZXZlbnQgXHJcbiAgICAgKi9cclxuICAgIHVwbG9hZChmaWxlczogVXBsb2FkRmlsZVtdLCBldmVudDogVXBsb2FkSW5wdXQsIGV4dGVuZFNlcnZpY2U6IEZGaWxlVXBsb2FkQWRhcHRVbmlmaWxlQ29uZmlnKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgICAgICBpZiAoZXZlbnQudHlwZSA9PSAnc2xpY2VVcGxvYWQnKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnVwbG9hZEJpZ0ZpbGUoZmlsZXMsIGV2ZW50LCBleHRlbmRTZXJ2aWNlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5uZXJVcGxvYWRMaXN0KGZpbGVzLCBldmVudCwgZXh0ZW5kU2VydmljZSk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOWGhemDqOS4iuS8oOaWueW8j1xyXG4gICAgICogQHBhcmFtIGZpbGVzIFxyXG4gICAgICogQHBhcmFtIGV2ZW50IFxyXG4gICAgICogQHBhcmFtIGV4dGVuZFNlcnZpY2UgXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgaW5uZXJVcGxvYWRMaXN0KGZpbGVzOiBVcGxvYWRGaWxlW10sIGV2ZW50OiBVcGxvYWRJbnB1dCwgZXh0ZW5kU2VydmljZTogRkZpbGVVcGxvYWRBZGFwdFVuaWZpbGVDb25maWcpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgICAgIHJldHVybiBuZXcgT2JzZXJ2YWJsZShvYnNlcnZlciA9PiB7XHJcblxyXG4gICAgICAgICAgICBsZXQgdXBsb2FkSW5mbyA9IG5ldyBHc3BGb3JtVXBsb2FkTGlzdEVudGl0eTtcclxuICAgICAgICAgICAgdXBsb2FkSW5mby5mb3JtSWQgPSB0aGlzLmdldEZpbmFsbHlDb25maWcoJ2Zvcm1JZCcsIGV4dGVuZFNlcnZpY2UpO1xyXG4gICAgICAgICAgICB1cGxvYWRJbmZvLm1vZGUgPSB0aGlzLmdldEZpbmFsbHlDb25maWcoJ21vZGUnLCBleHRlbmRTZXJ2aWNlKTtcclxuXHJcbiAgICAgICAgICAgIGxldCByb290SWQgPSB0aGlzLmdldEZpbmFsbHlDb25maWcoJ3Jvb3RJZCcsIGV4dGVuZFNlcnZpY2UpO1xyXG4gICAgICAgICAgICB1cGxvYWRJbmZvLmRvY0luZm9MaXN0ID0gW107XHJcbiAgICAgICAgICAgIGxldCByZWFkZXJPYnNlcmFibGU6IE9ic2VydmFibGU8YW55PltdID0gW107XHJcbiAgICAgICAgICAgIGZpbGVzLmZvckVhY2goKGZpbGVJdGVtOiBVcGxvYWRGaWxlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgc3ViID0gbmV3IE9ic2VydmFibGUob2JzZXIgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIOaaguS4jeWkhOeQhuW8guW4uFxyXG4gICAgICAgICAgICAgICAgICAgIHJlYWRlci5yZWFkQXNCaW5hcnlTdHJpbmcoZmlsZUl0ZW0ubmF0aXZlRmlsZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVhZGVyLm9ubG9hZCA9IChlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBpbmZvID0geyAnZmlsZU5hbWUnOiAnJywgJ2ZpbGVDb250ZW50JzogJycgfSBhcyBhbnk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGluZm9bJ2ZpbGVOYW1lJ10gPSBmaWxlSXRlbS5uYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbmZvWydmaWxlQ29udGVudCddID0gYnRvYShyZWFkZXIucmVzdWx0LnRvU3RyaW5nKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyDlpoLmnpxkYXRh6YeM5pyJ5pWw5o2u77yM5bm25LiU5bGe5oCn5piv6YWN572u55qE5omp5bGV5bGe5oCnXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChldmVudC5oYXNPd25Qcm9wZXJ0eSgnZGF0YScpICYmIGV2ZW50WydkYXRhJ10gJiYgZXZlbnRbJ2RhdGEnXS5oYXNPd25Qcm9wZXJ0eSgnZXh0UHJvcGVydHknKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmZvWydleHRQcm9wZXJ0eSddID0gZXZlbnRbJ2RhdGEnXVsnZXh0UHJvcGVydHknXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWRJbmZvLmRvY0luZm9MaXN0LnB1c2goaW5mbyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ic2VyLm5leHQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JzZXIuY29tcGxldGUoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHJlYWRlck9ic2VyYWJsZS5wdXNoKHN1Yik7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgZm9ya0pvaW4ocmVhZGVyT2JzZXJhYmxlKS5zdWJzY3JpYmUoZGF0YXMgPT4ge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgIG1ldGFkYXRhSWQ6IHN0cmluZztcclxuICAgICAgICAgICAgICAgIC8vICBmaWxlTmFtZTogc3RyaW5nO1xyXG4gICAgICAgICAgICAgICAgdGhpcy51cGxvYWRTZXIudXBsb2FkTGlzdCh1cGxvYWRJbmZvLCByb290SWQpLnN1YnNjcmliZShyZXN1bHQgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8g5q2k5o6l5Y+j5LiA5pem5Ye6546w6Zeu6aKY77yM5omA5pyJ6ZmE5Lu26YO95LiK5Lyg5LiN6YCa6L+HXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLmVycm9yKHRoaXMuZXJyb3JJbmZvRm9ybWF0KHJlc3VsdC5lcnJvciwgZmlsZXMpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAvLyDlkIjlubbov5Tlm57nu5PmnpzliLDmraTlpIRcclxuICAgICAgICAgICAgICAgICAgICByZXN1bHQuZm9yRWFjaChpdGVtID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZpbmRJbmRleCA9IHRoaXMuZmluZEZpbGVJbmRleEJ5RmlsZU5hbWUoZmlsZXMsIGl0ZW0uZmlsZU5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmluZEluZGV4ID4gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVzW2ZpbmRJbmRleF1bJ3Jlc3BvbnNlJ10gPSBpdGVtO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZXNbZmluZEluZGV4XVsncHJvZ3Jlc3MnXVsnc3RhdHVzJ10gPSBVcGxvYWRTdGF0dXMuRG9uZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5uZXh0KHsgdHlwZTogJ2RvbmUnLCBmaWxlczogZmlsZXMgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgfSwgZXJyb3IgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLmVycm9yKHRoaXMuZXJyb3JJbmZvRm9ybWF0KGVycm9yLCBmaWxlcykpO1xyXG4gICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7XHJcbiAgICAgICAgICAgICAgICB9LCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIOWIhueJh+WKoOi9vVxyXG4gICAgICogQHBhcmFtIGZpbGUgXHJcbiAgICAgKiBAcGFyYW0gZXZlbnQgXHJcbiAgICAgKiBAcGFyYW0gZXh0ZW5kU2VydmljZSBcclxuICAgICAqL1xyXG4gICAgbXVsdGlwYXJ0VXBsb2FkKGZpbGU6IFVwbG9hZEZpbGUsIGV2ZW50OiBVcGxvYWRJbnB1dCwgZXh0ZW5kU2VydmljZTogRkZpbGVVcGxvYWRBZGFwdFVuaWZpbGVDb25maWcpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG5cclxuICAgICAgICByZXR1cm4gbmV3IE9ic2VydmFibGUob2JzZXJ2ZXIgPT4ge1xyXG5cclxuICAgICAgICAgICAgLy8gbGV0IGZpbGVJbmZvOiBGaWxlSW5mbztcclxuICAgICAgICAgICAgbGV0IHV1aWQgPSB0aGlzLnV1aWQoKTtcclxuICAgICAgICAgICAgLy8gbGV0IHV1aWQgPSBVVUlELlVVSUQoKTtcclxuICAgICAgICAgICAgLy9yZWFkZXIucmVhZEFzQmluYXJ5U3RyaW5nKHNlbGVjdGVkRmlsZSk7XHJcbiAgICAgICAgICAgIC8vcmVhZGVyLm9ubG9hZCA9IChlKSA9PiB7XHJcbiAgICAgICAgICAgIGxldCBmaWxlTmFtZSA9IGZpbGUubmFtZTtcclxuICAgICAgICAgICAgLy8gZmlsZUluZm8gPSB7XHJcbiAgICAgICAgICAgIC8vICAgaWQ6IHV1aWQsXHJcbiAgICAgICAgICAgIC8vICAgbmFtZTogZmlsZU5hbWUsXHJcbiAgICAgICAgICAgIC8vICAgdHlwZTogZmlsZS50eXBlLFxyXG4gICAgICAgICAgICAvLyAgIHNvdXJjZTogXCJcIixcclxuICAgICAgICAgICAgLy8gICBzaXplOiB0aGlzLmZvcm1hdEZpbGVTaXplKGZpbGUuc2l6ZSksXHJcbiAgICAgICAgICAgIC8vICAgZmlsZVNpemU6IGZpbGUuc2l6ZSxcclxuICAgICAgICAgICAgLy8gICBwaWNMaXN0RGlzcGxheU5hbWU6IHRoaXMuZ2V0TXVsdGlwYXJ0RGlzcGxheU5hbWUoZmlsZU5hbWUpLFxyXG4gICAgICAgICAgICAvLyAgIHF1ZXVlTGlzdERpc3BsYXlOYW1lOiBmaWxlTmFtZSxcclxuICAgICAgICAgICAgLy8gICAvL2NvbnRlbnQ6IHJlYWRlci5yZXN1bHQudG9TdHJpbmcoKSxcclxuICAgICAgICAgICAgLy8gICBoYXNVcGxvYWRlZDogZmFsc2UsXHJcbiAgICAgICAgICAgIC8vICAgbW91c2VPbjogZmFsc2UsXHJcbiAgICAgICAgICAgIC8vICAgc2VsZWN0ZDogZmFsc2UsXHJcbiAgICAgICAgICAgIC8vICAgaXNVcGxvYWRpbmc6IHRydWUsXHJcbiAgICAgICAgICAgIC8vICAgdXBsb2FkUmVzdWx0OiBmYWxzZSxcclxuICAgICAgICAgICAgLy8gICB1cGxvYWRQcm9jZXNzOiAwLFxyXG4gICAgICAgICAgICAvLyAgIGVycm9yTWVzc2FnZTogXCJcIixcclxuICAgICAgICAgICAgLy8gICBleHRlbnNpb25Ecm9wTGlzdElkOiAwLFxyXG4gICAgICAgICAgICAvLyAgIGV4dGVuc2lvbk5hbWU6IFwiXCJcclxuICAgICAgICAgICAgLy8gfVxyXG5cclxuICAgICAgICAgICAgbGV0IGNodW5rVG90YWw6IG51bWJlciA9IE1hdGguY2VpbChmaWxlLnNpemUgLyB0aGlzLmJ1ZmZlclNpemUpO1xyXG4gICAgICAgICAgICAvLyDmoIforrDlvZPliY3pmYTku7bmgLvnmoTliIbniYfmlbBcclxuICAgICAgICAgICAgdGhpcy5maWxlVG90YWxDaHVua1t1dWlkXSA9IGNodW5rVG90YWw7XHJcbiAgICAgICAgICAgIGxldCBjaHVua0luZGV4OiBudW1iZXIgPSAwO1xyXG4gICAgICAgICAgICAvLyDmoIforrDlvZPliY3pmYTku7bmiJDlip/nmoTliIbniYfmlbBcclxuICAgICAgICAgICAgdGhpcy51cGxvYWRlZENodW5rW3V1aWRdID0gMDtcclxuICAgICAgICAgICAgd2hpbGUgKGNodW5rSW5kZXggPCBjaHVua1RvdGFsKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgdXBsb2FkSW5mbyA9IG5ldyBHc3BGb3JtVXBsb2FkRW50aXR5O1xyXG4gICAgICAgICAgICAgICAgdXBsb2FkSW5mby5tb2RlID0gT3BlcmF0aW5nTW9kZXMuVGVtcDtcclxuICAgICAgICAgICAgICAgIHVwbG9hZEluZm8uZm9ybUlkID0gdGhpcy5nZXRGaW5hbGx5Q29uZmlnKCdmb3JtSWQnLCBleHRlbmRTZXJ2aWNlKTtcclxuICAgICAgICAgICAgICAgIHVwbG9hZEluZm8ucm9vdElkID0gdGhpcy5nZXRGaW5hbGx5Q29uZmlnKCdyb290SWQnLCBleHRlbmRTZXJ2aWNlKTtcclxuXHJcbiAgICAgICAgICAgICAgICBsZXQgZG9jSW5mbzogR3NwRm9ybURvY0luZm8gPSBuZXcgR3NwRm9ybURvY0luZm87XHJcbiAgICAgICAgICAgICAgICBkb2NJbmZvLmZpbGVOYW1lID0gZmlsZU5hbWU7XHJcbiAgICAgICAgICAgICAgICBkb2NJbmZvLm1ldGFkYXRhSWQgPSB1dWlkO1xyXG4gICAgICAgICAgICAgICAgZG9jSW5mby50b3RhbCA9IGNodW5rVG90YWw7XHJcbiAgICAgICAgICAgICAgICAvLyDlpoLmnpxkYXRh6YeM5pyJ5pWw5o2u77yM5bm25LiU5bGe5oCn5piv6YWN572u55qE5omp5bGV5bGe5oCnXHJcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQuaGFzT3duUHJvcGVydHkoJ2RhdGEnKSAmJiBldmVudFsnZGF0YSddICYmIGV2ZW50WydkYXRhJ10uaGFzT3duUHJvcGVydHkoJ2V4dFByb3BlcnR5JykpIHtcclxuICAgICAgICAgICAgICAgICAgICBkb2NJbmZvWydleHRQcm9wZXJ0eSddID0gZXZlbnRbJ2RhdGEnXVsnZXh0UHJvcGVydHknXSBhcyBHc3BEb2NNZXRhUHJvcGVydHk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyDkuIvkuIDkuKrmlofku7blpKflsI9cclxuICAgICAgICAgICAgICAgIGxldCBuZXh0U2l6ZSA9IE1hdGgubWluKChjaHVua0luZGV4ICsgMSkgKiB0aGlzLmJ1ZmZlclNpemUsIGZpbGUuc2l6ZSk7XHJcbiAgICAgICAgICAgICAgICAvLyBGaWxl57G75Z6LXHJcbiAgICAgICAgICAgICAgICBsZXQgZmlsZURhdGEgPSBmaWxlWyduYXRpdmVGaWxlJ10uc2xpY2UoY2h1bmtJbmRleCAqIHRoaXMuYnVmZmVyU2l6ZSwgbmV4dFNpemUpO1xyXG4gICAgICAgICAgICAgICAgLy8g6K+75Y+W5paH5Lu2XHJcbiAgICAgICAgICAgICAgICBsZXQgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcclxuICAgICAgICAgICAgICAgIHJlYWRlci5yZWFkQXNCaW5hcnlTdHJpbmcoZmlsZURhdGEpO1xyXG4gICAgICAgICAgICAgICAgbGV0IGlubmVySW5kZXggPSBjaHVua0luZGV4O1xyXG4gICAgICAgICAgICAgICAgcmVhZGVyLm9ubG9hZCA9ICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAvLyDpmYTku7bkuIrkvKBcclxuICAgICAgICAgICAgICAgICAgICBkb2NJbmZvLmZpbGVDb250ZW50ID0gYnRvYShyZWFkZXIucmVzdWx0LnRvU3RyaW5nKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGRvY0luZm8uaW5kZXggPSBpbm5lckluZGV4O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB1cGxvYWRJbmZvLmRvY0luZm8gPSBkb2NJbmZvO1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBpbmZvID0gdXBsb2FkSW5mbztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGxvYWRTZXIudXBsb2FkRmlsZShpbmZvKS5zdWJzY3JpYmUocmVzdWx0ID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdCAmJiByZXN1bHQuZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIOWIhueJh+S4iuS8oOaciei/lOWbnue7k+aenOWwseaYr+aKpemUmeS6hlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIuZXJyb3IodGhpcy5lcnJvckluZm9Gb3JtYXQocmVzdWx0LmVycm9yLCBbZmlsZV0pKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVwbG9hZGVkQ2h1bmtbdXVpZF0rKztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnVwbG9hZGVkQ2h1bmtbZG9jSW5mby5tZXRhZGF0YUlkXSA9PSB0aGlzLmZpbGVUb3RhbENodW5rW2RvY0luZm8ubWV0YWRhdGFJZF0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDliKTmlq3mmK/miYDmnInliIbniYfpg73kuIrkvKDlrozmiJBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlLnByb2dyZXNzID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IFVwbG9hZFN0YXR1cy5Eb25lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwZXJjZW50YWdlOiAxMDBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZS5yZXNwb25zZSA9IGRvY0luZm87XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMudXBsb2FkZWRDaHVua1t1dWlkXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5maWxlVG90YWxDaHVua1t1dWlkXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5uZXh0KHsgdHlwZTogJ2RvbmUnLCBmaWxlczogW2ZpbGVdIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDliIbniYfkuIrkvKDmraPluLhcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwZXJjZW50YWdlID0gTnVtYmVyLnBhcnNlSW50KCh0aGlzLnVwbG9hZGVkQ2h1bmtbdXVpZF0gLyB0aGlzLmZpbGVUb3RhbENodW5rW3V1aWRdICogMTAwKS50b0ZpeGVkKDApKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDliKTmlq3mnKrkuIrkvKDlrozmiJBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlLnByb2dyZXNzID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IFVwbG9hZFN0YXR1cy5VcGxvYWRpbmcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBlcmNlbnRhZ2U6IHBlcmNlbnRhZ2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIubmV4dCh7IHR5cGU6ICd1cGxvYWRpbmcnLCBmaWxlczogW2ZpbGVdIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSwgZXJyb3IgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy51cGxvYWRlZENodW5rW3V1aWRdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5maWxlVG90YWxDaHVua1t1dWlkXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIuZXJyb3IodGhpcy5lcnJvckluZm9Gb3JtYXQoZXJyb3IsIFtmaWxlXSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY2h1bmtJbmRleCA9IGNodW5rSW5kZXggKyAxO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOiOt+WPluWIhueJh+eahOmZhOS7tuWkp+Wwj1xyXG4gICAgICogQHBhcmFtIHNpemUgXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgZm9ybWF0RmlsZVNpemUoc2l6ZTogbnVtYmVyKSB7XHJcbiAgICAgICAgaWYgKHNpemUgPCAxMDI0MDApXHJcbiAgICAgICAgICAgIHJldHVybiAoc2l6ZSAvIDEwMjQpLnRvRml4ZWQoMSkgKyBcIktcIjtcclxuICAgICAgICBlbHNlIGlmIChzaXplIDwgMTAyNCAqIDEwMjQpXHJcbiAgICAgICAgICAgIHJldHVybiAoc2l6ZSAvIDEwMjQpLnRvRml4ZWQoMCkgKyBcIktcIjtcclxuICAgICAgICBlbHNlIGlmIChzaXplIDwgMTAwICogMTAyNCAqIDEwMjQpXHJcbiAgICAgICAgICAgIHJldHVybiAoc2l6ZSAvIDEwMjQgLyAxMDI0KS50b0ZpeGVkKDEpICsgXCJNXCI7XHJcbiAgICAgICAgZWxzZSBpZiAoc2l6ZSA8IDEwMjQgKiAxMDI0ICogMTAyNClcclxuICAgICAgICAgICAgcmV0dXJuIChzaXplIC8gMTAyNCAvIDEwMjQpLnRvRml4ZWQoMCkgKyBcIk1cIjtcclxuICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHJldHVybiAoc2l6ZSAvIDEwMjQgLyAxMDI0IC8gMTAyNCkudG9GaXhlZCgxKSArIFwiR1wiO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDojrflj5bliIbniYfnmoQg6ZmE5Lu25ZCN56ewXHJcbiAgICAgKiBAcGFyYW0gZmlsZU5hbWUgXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgZ2V0TXVsdGlwYXJ0RGlzcGxheU5hbWUoZmlsZU5hbWU6IHN0cmluZykge1xyXG4gICAgICAgIGlmIChmaWxlTmFtZS5sZW5ndGggPD0gMTApXHJcbiAgICAgICAgICAgIHJldHVybiBmaWxlTmFtZTtcclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgbGV0IGhlYWRDb250ZW50ID0gZmlsZU5hbWUuc3Vic3RyaW5nKDAsIDIpO1xyXG4gICAgICAgICAgICBsZXQgdGFpbENvbnRlbnQgPSBmaWxlTmFtZS5zdWJzdHJpbmcoZmlsZU5hbWUubGFzdEluZGV4T2YoJy4nKSAtIDIpO1xyXG4gICAgICAgICAgICByZXR1cm4gaGVhZENvbnRlbnQgKyBcIuKAplwiICsgdGFpbENvbnRlbnQ7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSBlcnJvckluZm9Gb3JtYXQoZXJyb3IsIGZpbGVzKSB7XHJcbiAgICAgICAgLy8gXHJcbiAgICAgICAgbGV0IGVycm9yRmlsZXMgPSBmaWxlcy5tYXAoaXRlbSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiB7IGlkOiBpdGVtLmlkLCBuYW1lOiBpdGVtLm5hbWUgfTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oZXJyb3IsIHsgZmlsZXM6IGVycm9yRmlsZXMgfSwgeyBtZXNzYWdlOiBlcnJvclsnTWVzc2FnZSddIHx8IGVycm9yWydleHRlbnNpb25NZXNzYWdlJ10gfHwgJ+S4iuS8oOWksei0pScsIHR5cGU6ICdlcnJvcicgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oeyBmaWxlczogZXJyb3JGaWxlcyB9LCB7IG1lc3NhZ2U6ICfkuIrkvKDlpLHotKUnLCB0eXBlOiAnZXJyb3InIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog6L+U5Zue5pyA57uI5bGe5oCn5YC8XHJcbiAgICAgKiBAcGFyYW0ga2V5IFxyXG4gICAgICogQHBhcmFtIGNvbmZpZ1ZhbHVlIFxyXG4gICAgICogQHBhcmFtIGV4dGVuZFZhbHVlIFxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGdldEZpbmFsbHlDb25maWcoa2V5LCBleHRlbmRWYWx1ZSkge1xyXG4gICAgICAgIGlmIChleHRlbmRWYWx1ZSAmJiBleHRlbmRWYWx1ZS5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBleHRlbmRWYWx1ZVtrZXldO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5leHRlbmREYXRhW2tleV07XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBmaW5kRmlsZUluZGV4QnlGaWxlTmFtZShmaWxlczogVXBsb2FkRmlsZVtdLCBmaWxlTmFtZSkge1xyXG4gICAgICAgIC8vIOaMieeFp+iCr+WumuiDveaJvuWIsOaWh+S7tuadpeWkhOeQhlxyXG4gICAgICAgIGxldCBmaW5kSW5kZXggPSBmaWxlcy5maW5kSW5kZXgoZmlsZSA9PiBmaWxlLm5hbWUgPT0gZmlsZU5hbWUpO1xyXG4gICAgICAgIHJldHVybiBmaW5kSW5kZXg7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIC8vI3JlZ2lvbiDlpKfmlofku7bliIbniYfkuIrkvKBcclxuXHJcbiAgICB1cGxvYWRCaWdGaWxlKGZpbGVzOiBVcGxvYWRGaWxlW10sIGV2ZW50OiBVcGxvYWRJbnB1dCwgZXh0ZW5kU2VydmljZTogRkZpbGVVcGxvYWRBZGFwdFVuaWZpbGVDb25maWcpIHtcclxuXHJcbiAgICAgICAgY29uc3QgdXBsb2FkQ2h1bmtzJCA9IG5ldyBTdWJqZWN0KCk7XHJcblxyXG4gICAgICAgIGNvbnN0IF9maWxlcyA9IGZpbGVzLm1hcChuID0+IHtcclxuICAgICAgICAgICAgY29uc3QgY2h1bmtzID0gdGhpcy5fZ2V0QmlnRmlsZUNodW5rcyhuLCBldmVudCwgZXh0ZW5kU2VydmljZSlcclxuICAgICAgICAgICAgcmV0dXJuIHsgLi4ubiwgLi4uY2h1bmtzfTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgXHJcbiAgICAgICAgY29uc3QgdXBsb2FkY2h1bmtzJDogT2JzZXJ2YWJsZTxhbnk+W10gPSAgX2ZpbGVzLm1hcCgoZikgPT4gdGhpcy51cGxvYWRDaHVua3MoZiwgdXBsb2FkQ2h1bmtzJCkpO1xyXG4gICAgICAgIGNvbmNhdCguLi51cGxvYWRjaHVua3MkKS5zdWJzY3JpYmUoXHJcbiAgICAgICAgICAgIChmOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGBmaWxlOiAke2YubmFtZX0gLSB1cGxvYWQgY29tcGxldGVgKTtcclxuICAgICAgICAgICAgICAgIGYucHJvZ3Jlc3MgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiBVcGxvYWRTdGF0dXMuRG9uZSxcclxuICAgICAgICAgICAgICAgICAgICBkYXRhOiAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwZXJjZW50YWdlOiAxMDBcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgZi5yZXNwb25zZSA9IEpTT04ucGFyc2UoZi5jaHVua3NbMF0uZ2V0KCdkb2NJbmZvJykpO1xyXG4gICAgICAgICAgICAgICAgdXBsb2FkQ2h1bmtzJC5uZXh0KHt0eXBlOiAnZG9uZScsIGZpbGVzOltmXX0pO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBlcnJvciA9PiB7XHJcbiAgICAgICAgICAgICAgICB1cGxvYWRDaHVua3MkLmVycm9yKHRoaXMuZXJyb3JJbmZvRm9ybWF0KGVycm9yLCBmaWxlcykpO1xyXG4gICAgICAgICAgICAgICAgdXBsb2FkQ2h1bmtzJC5jb21wbGV0ZSgpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB1cGxvYWRDaHVua3MkLmNvbXBsZXRlKCk7XHJcbiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcImFsbCBmaWxlcyB1cGxvYWRlZFwiKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHVwbG9hZENodW5rcyQuYXNPYnNlcnZhYmxlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSB1cGxvYWRGaWxlQ2h1bmsoZmlsZTogYW55KSB7XHJcbiAgICAgICAgY29uc3QgdXJsID0gXCIvYXBpL3J1bnRpbWUvZGZzL3YxLjAvZm9ybWRvYy9zbGljZVwiO1xyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy51cGxvYWRTZXJbJ2h0dHAnXVsnaHR0cCddLnBvc3QodXJsLCBmaWxlLmNodW5rc1tmaWxlLnRvdGFsXSkucGlwZShcclxuICAgICAgICAgICAgc3dpdGNoTWFwKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBvZihmaWxlKTtcclxuICAgICAgICAgICAgfSksXHJcbiAgICAgICAgICAgIGNhdGNoRXJyb3IoKGVycm9yOiBIdHRwRXJyb3JSZXNwb25zZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG9mKGVycm9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICkpO1xyXG4gICAgfVxyXG5cclxuICAgIFxyXG4gICAgcHJpdmF0ZSB1cGxvYWRDaHVua3MoZmlsZSwgdXBDaHVuayQ6IFN1YmplY3Q8YW55Pikge1xyXG5cclxuICAgICAgICBjb25zdCBkb0NodW5rc1JlbWFpbiA9IChpKSA9PiBpID4gLTE7XHJcbiAgICAgICAgY29uc3QgY29tcGxldGVVcGxvYWQgPSAoZikgPT4gb2YoZik7XHJcbiAgICAgICAgY29uc3QgdXBsb2FkQ2h1bmsgPSAoZikgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy51cGxvYWRGaWxlQ2h1bmsoZikucGlwZShcclxuICAgICAgICAgICAgICAgIGRlbGF5KDEwMCksXHJcbiAgICAgICAgICAgICAgICBtYXAoKGY6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIOWdl+aVsOS4ujAg5pe277yM5Y2z5Li65q2k5paH5Lu255qE5omA5pyJ5Z2X5Z2H5LiK5Lyg5oiQ5YqfXHJcbiAgICAgICAgICAgICAgICAgICAgZi5wcm9ncmVzcyA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiBVcGxvYWRTdGF0dXMuVXBsb2FkaW5nLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGVyY2VudGFnZTogKGYudG90YWwgLyBmLmNodW5rcy5sZW5ndGggKiAxMDApLnRvRml4ZWQoMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgdXBDaHVuayQubmV4dCh7IHR5cGU6ICd1cGxvYWRpbmcnLCBmaWxlczogW2ZdIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZjtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIClcclxuICAgICAgICB9O1xyXG4gICAgICAgIGNvbnN0IGNyZWF0ZU11bHRpcGFydFVwbG9hZCA9IChmKSA9PiBvZihmKTtcclxuXHJcblxyXG4gICAgICAgIHJldHVybiBjcmVhdGVNdWx0aXBhcnRVcGxvYWQoZmlsZSkucGlwZShcclxuICAgICAgICAgICAgLy8gdGFwKChmKSA9PiBjb25zb2xlLmxvZyhcInVwbG9hZCBmaWxlXCIsIGYubmFtZSkpLFxyXG4gICAgICAgICAgICBleHBhbmQoKGYpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChkb0NodW5rc1JlbWFpbigtLWZpbGUudG90YWwpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVwbG9hZENodW5rKGZpbGUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIEVNUFRZO1xyXG4gICAgICAgICAgICB9KSxcclxuICAgICAgICAgICAgLy8gdGFwKChmOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgLy8gICAgIGNvbnNvbGUubG9nKGBmaWxlOiAke2YubmFtZX0gLSByZW1haW5pbmcgY2h1bmtzOiAke2YudG90YWx9YCk7XHJcbiAgICAgICAgICAgIC8vIH0pLFxyXG4gICAgICAgICAgICBsYXN0KCksXHJcbiAgICAgICAgICAgIHN3aXRjaE1hcCgocmVzOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBjb21wbGV0ZVVwbG9hZChmaWxlKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwcml2YXRlIF9nZXRCaWdGaWxlQ2h1bmtzKGZpbGU6IFVwbG9hZEZpbGUsIGV2ZW50OiBVcGxvYWRJbnB1dCwgZXh0ZW5kU2VydmljZTogRkZpbGVVcGxvYWRBZGFwdFVuaWZpbGVDb25maWcpIHtcclxuICAgICAgICBsZXQgdXVpZCA9IHRoaXMudXVpZCgpO1xyXG5cclxuICAgICAgICBsZXQgY2h1bmtUb3RhbDogbnVtYmVyID0gTWF0aC5jZWlsKGZpbGUuc2l6ZSAvIHRoaXMuYnVmZmVyU2l6ZSAqIChldmVudC5jaHVua1NpemUgfHwgMSkpO1xyXG4gICAgICAgIGxldCBjaHVua0luZGV4OiBudW1iZXIgPSAwO1xyXG4gICAgICAgIGNvbnN0IGZpbGVDaHVua3MgPSB7Y2h1bmtzOiBbXSwgdG90YWw6IGNodW5rVG90YWx9O1xyXG5cclxuICAgICAgICB3aGlsZSAoY2h1bmtJbmRleCA8IGNodW5rVG90YWwpIHtcclxuICAgICAgICAgICAgbGV0IHVwbG9hZEluZm8gPSBuZXcgR3NwRm9ybVVwbG9hZEVudGl0eTtcclxuICAgICAgICAgICAgdXBsb2FkSW5mby5tb2RlID0gT3BlcmF0aW5nTW9kZXMuVGVtcDtcclxuICAgICAgICAgICAgdXBsb2FkSW5mby5mb3JtSWQgPSB0aGlzLmdldEZpbmFsbHlDb25maWcoJ2Zvcm1JZCcsIGV4dGVuZFNlcnZpY2UpO1xyXG4gICAgICAgICAgICB1cGxvYWRJbmZvLnJvb3RJZCA9IHRoaXMuZ2V0RmluYWxseUNvbmZpZygncm9vdElkJywgZXh0ZW5kU2VydmljZSk7XHJcblxyXG4gICAgICAgICAgICBsZXQgZG9jSW5mbzogR3NwRm9ybURvY0luZm8gPSBuZXcgR3NwRm9ybURvY0luZm87XHJcblxyXG4gICAgICAgICAgICBkb2NJbmZvLmZpbGVOYW1lID0gZmlsZS5uYW1lO1xyXG4gICAgICAgICAgICBkb2NJbmZvLm1ldGFkYXRhSWQgPSB1dWlkO1xyXG4gICAgICAgICAgICBkb2NJbmZvLnRvdGFsID0gY2h1bmtUb3RhbDtcclxuXHJcbiAgICAgICAgICAgIGxldCBuZXh0U2l6ZSA9IE1hdGgubWluKChjaHVua0luZGV4ICsgMSkgKiB0aGlzLmJ1ZmZlclNpemUsIGZpbGUuc2l6ZSk7XHJcbiAgICAgICAgICAgIC8vIEZpbGXnsbvlnotcclxuICAgICAgICAgICAgbGV0IGZpbGVEYXRhID0gZmlsZVsnbmF0aXZlRmlsZSddLnNsaWNlKGNodW5rSW5kZXggKiB0aGlzLmJ1ZmZlclNpemUsIG5leHRTaXplKTtcclxuXHJcbiAgICAgICAgICAgIGRvY0luZm8uc2l6ZSA9IGZpbGUuc2l6ZTtcclxuICAgICAgICAgICAgZG9jSW5mby5pbmRleCA9IGNodW5rSW5kZXg7XHJcbiAgICAgICAgICAgIGRvY0luZm8uZmlsZUNvbnRlbnQgPSBcIlwiXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyDlpoLmnpxkYXRh6YeM5pyJ5pWw5o2u77yM5bm25LiU5bGe5oCn5piv6YWN572u55qE5omp5bGV5bGe5oCnXHJcbiAgICAgICAgICAgIGlmIChldmVudC5oYXNPd25Qcm9wZXJ0eSgnZGF0YScpICYmIGV2ZW50WydkYXRhJ10gJiYgZXZlbnRbJ2RhdGEnXS5oYXNPd25Qcm9wZXJ0eSgnZXh0UHJvcGVydHknKSkge1xyXG4gICAgICAgICAgICAgICAgZG9jSW5mb1snZXh0UHJvcGVydHknXSA9IGV2ZW50WydkYXRhJ11bJ2V4dFByb3BlcnR5J10gYXMgR3NwRG9jTWV0YVByb3BlcnR5O1xyXG4gICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgdXBsb2FkSW5mby5kb2NJbmZvID0gZG9jSW5mbztcclxuICAgICAgXHJcbiAgICAgICAgICAgIC8v5bCB6KOF6K+35rGCZm9ybWRhdGFcclxuICAgICAgICAgICAgbGV0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XHJcbiAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZCgndXBsb2FkSW5mbycsIEpTT04uc3RyaW5naWZ5KHVwbG9hZEluZm8pKTtcclxuICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdkb2NJbmZvJywgSlNPTi5zdHJpbmdpZnkoZG9jSW5mbykpO1xyXG4gICAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ2ZpbGUnLCBmaWxlRGF0YSk7XHJcblxyXG4gICAgICAgICAgICBmaWxlQ2h1bmtzLmNodW5rcy5wdXNoKGZvcm1EYXRhKTtcclxuICAgICAgICAgICAgY2h1bmtJbmRleCA9IGNodW5rSW5kZXggKyAxO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGZpbGVDaHVua3M7XHJcbiAgICBcclxuICAgIH1cclxuXHJcblxyXG4gICAgLy8gcHJpdmF0ZSBzaG93UHJvZ3Jlc3NCYXIoKSB7XHJcbiAgICAvLyAgICAgLy8gb3ZlcmxheSBEaXZcclxuICAgIC8vICAgICBjb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgIC8vICAgICBkaXYuc3R5bGUuY3NzVGV4dCA9ICdwb3NpdGlvbjogYWJzb2x1dGU7dG9wOiAwO2xlZnQ6IDA7d2lkdGg6IDEwMHZ3O2hlaWdodDogMTAwdmg7ei1pbmRleDogOTk5OTk5O2JhY2tncm91bmQ6ICNmZGZkZmQ1NDsnO1xyXG5cclxuICAgIC8vICAgICAvLyBwYW5lbCBEaXZcclxuICAgIC8vICAgICBjb25zdCBwcm9ncmVzc1BhbmVsRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAvLyAgICAgZGl2LnN0eWxlLmNzc1RleHQgPWBiYWNrZ3JvdW5kOiB3aGl0ZTt3aWR0aDogNTAwcHg7aGVpZ2h0OiAxMzBweDtsZWZ0OiA1MCU7dG9wOiA1MCU7cG9zaXRpb246IHJlbGF0aXZlO1xyXG4gICAgLy8gICAgIG1hcmdpbi10b3A6IC01MHB4O21hcmdpbi1sZWZ0OiAtMjUwcHg7YWxpZ24taXRlbXM6IGNlbnRlcjtqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjtkaXNwbGF5OiBmbGV4O2ZsZXgtZGlyZWN0aW9uOiBjb2x1bW47XHJcbiAgICAvLyAgICAgYm9yZGVyLXJhZGl1czogMTVweDtib3gtc2hhZG93OiAxcHggMXB4IDdweCAjY2VkNGRhO2A7XHJcblxyXG4gICAgLy8gICAgIGRpdi5hcHBlbmRDaGlsZChwcm9ncmVzc1BhbmVsRGl2KTtcclxuXHJcbiAgICAvLyAgICAgY29uc3QgcHJvZ3Jlc3NOdW1FbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gyJyk7XHJcbiAgICAgICAgXHJcbiAgICAvLyB9XHJcblxyXG5cclxuICAgIC8vI2VuZHJlZ2lvblxyXG5cclxufVxyXG5cclxuIl19