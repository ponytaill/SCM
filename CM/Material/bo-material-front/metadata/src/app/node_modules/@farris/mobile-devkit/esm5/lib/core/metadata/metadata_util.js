import { ANNOTATIONS, PROP_METADATA } from './decorator';
/**
 * 元数据解析
 * 约束：
 * 1、类型装饰器：在某个类型上，某种类型的装饰器，只使用一次，不重复添加；
 * 2、属性装饰器：在某个属性上，某种类型的装饰器，只使用一次，不重复添加
 */
var MetadataUtil = /** @class */ (function () {
    function MetadataUtil() {
    }
    // ----------------------------------------
    // 类型元数据
    // ----------------------------------------
    /**
     * 获取类元数据
     * 返回结果形如：
     * [
     *   Injectable
     *   NgViewModel
     *   NgViewModel
     * ]
     */
    MetadataUtil.getClassMetadatas = function (constructor) {
        var metadatas = constructor[ANNOTATIONS];
        return metadatas;
    };
    /**
     * 获取某个class上的某种装饰器
     * 返回结果：NgViewModel
     */
    MetadataUtil.getClassMetadataByName = function (constructor, metadataName) {
        var metadata = this.getClassMetadataByNameWithTranslate(constructor, metadataName, null, null);
        return metadata;
    };
    MetadataUtil.getClassMetadataByNameWithTranslate = function (constructor, metadataName, translateService, keysToTranslate) {
        var allClassMetadatas = this.getClassMetadatas(constructor);
        if (!allClassMetadatas) {
            return null;
        }
        var metadata = allClassMetadatas.find(function (classMetadata) {
            return classMetadata.ngMetadataName === metadataName;
        });
        if (metadata && translateService && keysToTranslate) {
            keysToTranslate.forEach(function (metadataPropKey) {
                var propertyVariable = metadata[metadataPropKey];
                if (propertyVariable && propertyVariable.startsWith('{{') && propertyVariable.endsWith('}}')) {
                    var translateKey = propertyVariable.replace('{{', '').replace('}}', '').trim();
                    metadata[metadataPropKey] = translateService.transform(translateKey, null);
                }
            });
        }
        return metadata;
    };
    // ----------------------------------------
    // 属性元数据
    // ----------------------------------------
    /**
     * 获取所有属性的所有元数据
     * 返回格式：
     * {
     *   propName1: [ NgDefaultValue, NgMaxLength, NgMinLength],
     *   propName2: [ NgDefaultValue, NgMaxLength, NgMinLength]
     * }
     */
    MetadataUtil.getPropsMetadatas = function (constructor) {
        var allPropMetadatas = constructor[PROP_METADATA];
        return allPropMetadatas;
    };
    /**
     * 获取所有属性的某一类型的元数据
     * 如果同一属性
     * 返回结果：
     * {
     *    propName1: NgDefaultValue,
     *    propName2: NgDefaultValue
     * }
     */
    MetadataUtil.getPropsMetadatasByName = function (constructor, metadataName) {
        var metadatas = this.getPropsMetadatasByNameWithTranslate(constructor, metadataName);
        return metadatas;
    };
    MetadataUtil.getPropsMetadatasByNameWithTranslate = function (constructor, metadataName, translateService, keysToTranslate) {
        var metadatas = {};
        // 读取构造函数中存储的类属性注解。
        var allPropMetadatas = this.getPropsMetadatas(constructor);
        if (!allPropMetadatas) {
            return metadatas;
        }
        // 遍历所有属性提取注解信息。
        Object.keys(allPropMetadatas).forEach(function (propName) {
            // 提取当前属性注解对象
            var propMetadatas = allPropMetadatas[propName];
            // 提取指定类型的注解项
            var metadata = propMetadatas.find(function (propMetadata) {
                return propMetadata.ngMetadataName === metadataName;
            });
            if (translateService && keysToTranslate) {
                keysToTranslate.forEach(function (metadataPropKey) {
                    var propertyVariable = metadata[metadataPropKey];
                    if (propertyVariable && propertyVariable.startsWith('{{') && propertyVariable.endsWith('}}')) {
                        var translateKey = propertyVariable.replace('{{', '').replace('}}', '').trim();
                        metadata[metadataPropKey] = translateService.transform(translateKey, null);
                    }
                });
            }
            if (metadata) {
                metadatas[propName] = metadata;
            }
        });
        return metadatas;
    };
    /**
     * 获取某个属性的所有元数据
     * 返回格式：[ NgDefaultValue, NgMaxLength, NgMinLength]
     */
    MetadataUtil.getPropMetadatasByName = function (constructor, propName) {
        // 暂不实现
        return null;
    };
    /**
     * 获取某个属性的某种元数据
     * 返回格式：NgDefaultValue
     */
    MetadataUtil.getPropMetadataByName = function (constructor, propName, metadataName) {
        // 暂不实现
        return null;
    };
    return MetadataUtil;
}());
export { MetadataUtil };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWV0YWRhdGFfdXRpbC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvbW9iaWxlLWRldmtpdC8iLCJzb3VyY2VzIjpbImxpYi9jb3JlL21ldGFkYXRhL21ldGFkYXRhX3V0aWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFdBQVcsRUFBRSxhQUFhLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFHekQ7Ozs7O0dBS0c7QUFDSDtJQUFBO0lBMklBLENBQUM7SUF6SUMsMkNBQTJDO0lBQzNDLFFBQVE7SUFDUiwyQ0FBMkM7SUFFM0M7Ozs7Ozs7O09BUUc7SUFDSSw4QkFBaUIsR0FBeEIsVUFBeUIsV0FBZ0I7UUFDdkMsSUFBTSxTQUFTLEdBQUcsV0FBVyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQzNDLE9BQU8sU0FBUyxDQUFDO0lBQ25CLENBQUM7SUFFRDs7O09BR0c7SUFDSSxtQ0FBc0IsR0FBN0IsVUFBOEIsV0FBZ0IsRUFBRSxZQUFvQjtRQUNsRSxJQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsbUNBQW1DLENBQUMsV0FBVyxFQUFFLFlBQVksRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDakcsT0FBTyxRQUFRLENBQUM7SUFDbEIsQ0FBQztJQUVNLGdEQUFtQyxHQUExQyxVQUNFLFdBQWdCLEVBQUUsWUFBb0IsRUFDdEMsZ0JBQTRCLEVBQUUsZUFBMEI7UUFDeEQsSUFBTSxpQkFBaUIsR0FBRyxJQUFJLENBQUMsaUJBQWlCLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDOUQsSUFBSSxDQUFDLGlCQUFpQixFQUFFO1lBQ3RCLE9BQU8sSUFBSSxDQUFDO1NBQ2I7UUFDRCxJQUFNLFFBQVEsR0FBRyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsVUFBQyxhQUFrQjtZQUN6RCxPQUFPLGFBQWEsQ0FBQyxjQUFjLEtBQUssWUFBWSxDQUFDO1FBQ3ZELENBQUMsQ0FBQyxDQUFDO1FBQ0gsSUFBSSxRQUFRLElBQUksZ0JBQWdCLElBQUks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TyxTQUFTLENBQUM7SUFDbkIsQ0FBQztJQUVEOzs7T0FHRztJQUNJLG1DQUFzQixHQUE3QixVQUE4QixXQUFnQixFQUFFLFFBQWdCO1FBQzlELE9BQU87UUFDUCxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFFRDs7O09BR0c7SUFDSSxrQ0FBcUIsR0FBNUIsVUFBNkIsV0FBZ0IsRUFBRSxRQUFnQixFQUFFLFlBQW9CO1FBQ25GLE9BQU87UUFDUCxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFPSCxtQkFBQztBQUFELENBQUMsQUEzSUQsSUEySUM7QUFFRCxPQUFPLEVBQUUsWUFBWSxFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBTk5PVEFUSU9OUywgUFJPUF9NRVRBREFUQSB9IGZyb20gJy4vZGVjb3JhdG9yJztcclxuaW1wb3J0IHsgVHJhbnNsYXRlIH0gZnJvbSAnLi4vLi4vaTE4bi9pbmRleCc7XHJcblxyXG4vKipcclxuICog5YWD5pWw5o2u6Kej5p6QXHJcbiAqIOe6puadn++8mlxyXG4gKiAx44CB57G75Z6L6KOF6aWw5Zmo77ya5Zyo5p+Q5Liq57G75Z6L5LiK77yM5p+Q56eN57G75Z6L55qE6KOF6aWw5Zmo77yM5Y+q5L2/55So5LiA5qyh77yM5LiN6YeN5aSN5re75Yqg77ybXHJcbiAqIDLjgIHlsZ7mgKfoo4XppbDlmajvvJrlnKjmn5DkuKrlsZ7mgKfkuIrvvIzmn5Dnp43nsbvlnovnmoToo4XppbDlmajvvIzlj6rkvb/nlKjkuIDmrKHvvIzkuI3ph43lpI3mt7vliqBcclxuICovXHJcbmNsYXNzIE1ldGFkYXRhVXRpbCB7XHJcblxyXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuICAvLyDnsbvlnovlhYPmlbDmja5cclxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluexu+WFg+aVsOaNrlxyXG4gICAqIOi/lOWbnue7k+aenOW9ouWmgu+8mlxyXG4gICAqIFtcclxuICAgKiAgIEluamVjdGFibGVcclxuICAgKiAgIE5nVmlld01vZGVsXHJcbiAgICogICBOZ1ZpZXdNb2RlbFxyXG4gICAqIF1cclxuICAgKi9cclxuICBzdGF0aWMgZ2V0Q2xhc3NNZXRhZGF0YXMoY29uc3RydWN0b3I6IGFueSk6IGFueVtdIHtcclxuICAgIGNvbnN0IG1ldGFkYXRhcyA9IGNvbnN0cnVjdG9yW0FOTk9UQVRJT05TXTtcclxuICAgIHJldHVybiBtZXRhZGF0YXM7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDojrflj5bmn5DkuKpjbGFzc+S4iueahOafkOenjeijhemlsOWZqFxyXG4gICAqIOi/lOWbnue7k+aenO+8mk5nVmlld01vZGVsXHJcbiAgICovXHJcbiAgc3RhdGljIGdldENsYXNzTWV0YWRhdGFCeU5hbWUoY29uc3RydWN0b3I6IGFueSwgbWV0YWRhdGFOYW1lOiBzdHJpbmcpOiBhbnkge1xyXG4gICAgY29uc3QgbWV0YWRhdGEgPSB0aGlzLmdldENsYXNzTWV0YWRhdGFCeU5hbWVXaXRoVHJhbnNsYXRlKGNvbnN0cnVjdG9yLCBtZXRhZGF0YU5hbWUsIG51bGwsIG51bGwpO1xyXG4gICAgcmV0dXJuIG1ldGFkYXRhO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIGdldENsYXNzTWV0YWRhdGFCeU5hbWVXaXRoVHJhbnNsYXRlKFxyXG4gICAgY29uc3RydWN0b3I6IGFueSwgbWV0YWRhdGFOYW1lOiBzdHJpbmcsXHJcbiAgICB0cmFuc2xhdGVTZXJ2aWNlPzogVHJhbnNsYXRlLCBrZXlzVG9UcmFuc2xhdGU/OiBzdHJpbmdbXSk6IGFueSB7XHJcbiAgICBjb25zdCBhbGxDbGFzc01ldGFkYXRhcyA9IHRoaXMuZ2V0Q2xhc3NNZXRhZGF0YXMoY29uc3RydWN0b3IpO1xyXG4gICAgaWYgKCFhbGxDbGFzc01ldGFkYXRhcykge1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICAgIGNvbnN0IG1ldGFkYXRhID0gYWxsQ2xhc3NNZXRhZGF0YXMuZmluZCgoY2xhc3NNZXRhZGF0YTogYW55KSA9PiB7XHJcbiAgICAgIHJldHVybiBjbGFzc01ldGFkYXRhLm5nTWV0YWRhdGFOYW1lID09PSBtZXRhZGF0YU5hbWU7XHJcbiAgICB9KTtcclxuICAgIGlmIChtZXRhZGF0YSAmJiB0cmFuc2xhdGVTZXJ2aWNlICYmIGtleXNUb1RyYW5zbGF0ZSkge1xyXG4gICAgICBrZXlzVG9UcmFuc2xhdGUuZm9yRWFjaCgobWV0YWRhdGFQcm9wS2V5KSA9PiB7XHJcbiAgICAgICAgY29uc3QgcHJvcGVydHlWYXJpYWJsZTogc3RyaW5nID0gbWV0YWRhdGFbbWV0YWRhdGFQcm9wS2V5XTtcclxuICAgICAgICBpZiAocHJvcGVydHlWYXJpYWJsZSAmJiBwcm9wZXJ0eVZhcmlhYmxlLnN0YXJ0c1dpdGgoJ3t7JykgJiYgcHJvcGVydHlWYXJpYWJsZS5lbmRzV2l0aCgnfX0nKSkge1xyXG4gICAgICAgICAgY29uc3QgdHJhbnNsYXRlS2V5ID0gcHJvcGVydHlWYXJpYWJsZS5yZXBsYWNlKCd7eycsICcnKS5yZXBsYWNlKCd9fScsICcnKS50cmltKCk7XHJcbiAgICAgICAgICBtZXRhZGF0YVttZXRhZGF0YVByb3BLZXldID0gdHJhbnNsYXRlU2VydmljZS50cmFuc2Zvcm0odHJhbnNsYXRlS2V5LCBudWxsKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIG1ldGFkYXRhO1xyXG4gIH1cclxuXHJcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG4gIC8vIOWxnuaAp+WFg+aVsOaNrlxyXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+W5omA5pyJ5bGe5oCn55qE5omA5pyJ5YWD5pWw5o2uXHJcbiAgICog6L+U5Zue5qC85byP77yaXHJcbiAgICoge1xyXG4gICAqICAgcHJvcE5hbWUxOiBbIE5nRGVmYXVsdFZhbHVlLCBOZ01heExlbmd0aCwgTmdNaW5MZW5ndGhdLFxyXG4gICAqICAgcHJvcE5hbWUyOiBbIE5nRGVmYXVsdFZhbHVlLCBOZ01heExlbmd0aCwgTmdNaW5MZW5ndGhdXHJcbiAgICogfVxyXG4gICAqL1xyXG4gIHN0YXRpYyBnZXRQcm9wc01ldGFkYXRhcyhjb25zdHJ1Y3RvcjogYW55KTogYW55IHtcclxuICAgIGNvbnN0IGFsbFByb3BNZXRhZGF0YXMgPSBjb25zdHJ1Y3RvcltQUk9QX01FVEFEQVRBXTtcclxuICAgIHJldHVybiBhbGxQcm9wTWV0YWRhdGFzO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+W5omA5pyJ5bGe5oCn55qE5p+Q5LiA57G75Z6L55qE5YWD5pWw5o2uXHJcbiAgICog5aaC5p6c5ZCM5LiA5bGe5oCnXHJcbiAgICog6L+U5Zue57uT5p6c77yaXHJcbiAgICoge1xyXG4gICAqICAgIHByb3BOYW1lMTogTmdEZWZhdWx0VmFsdWUsXHJcbiAgICogICAgcHJvcE5hbWUyOiBOZ0RlZmF1bHRWYWx1ZVxyXG4gICAqIH1cclxuICAgKi9cclxuICBzdGF0aWMgZ2V0UHJvcHNNZXRhZGF0YXNCeU5hbWUoY29uc3RydWN0b3I6IGFueSwgbWV0YWRhdGFOYW1lOiBzdHJpbmcpOiB7IFtwcm9wTmFtZTogc3RyaW5nXTogYW55IH0ge1xyXG4gICAgY29uc3QgbWV0YWRhdGFzID0gdGhpcy5nZXRQcm9wc01ldGFkYXRhc0J5TmFtZVdpdGhUcmFuc2xhdGUoY29uc3RydWN0b3IsIG1ldGFkYXRhTmFtZSk7XHJcbiAgICByZXR1cm4gbWV0YWRhdGFzO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIGdldFByb3BzTWV0YWRhdGFzQnlOYW1lV2l0aFRyYW5zbGF0ZShcclxuICAgIGNvbnN0cnVjdG9yOiBhbnksIG1ldGFkYXRhTmFtZTogc3RyaW5nLFxyXG4gICAgdHJhbnNsYXRlU2VydmljZT86IFRyYW5zbGF0ZSwga2V5c1RvVHJhbnNsYXRlPzogc3RyaW5nW10pOiB7IFtwcm9wTmFtZTogc3RyaW5nXTogYW55IH0ge1xyXG4gICAgY29uc3QgbWV0YWRhdGFzID0ge307XHJcbiAgICAvLyDor7vlj5bmnoTpgKDlh73mlbDkuK3lrZjlgqjnmoTnsbvlsZ7mgKfms6jop6PjgIJcclxuICAgIGNvbnN0IGFsbFByb3BNZXRhZGF0YXMgPSB0aGlzLmdldFByb3BzTWV0YWRhdGFzKGNvbnN0cnVjdG9yKTtcclxuICAgIGlmICghYWxsUHJvcE1ldGFkYXRhcykge1xyXG4gICAgICByZXR1cm4gbWV0YWRhdGFzO1xyXG4gICAgfVxyXG4gICAgLy8g6YGN5Y6G5omA5pyJ5bGe5oCn5o+Q5Y+W5rOo6Kej5L+h5oGv44CCXHJcbiAgICBPYmplY3Qua2V5cyhhbGxQcm9wTWV0YWRhdGFzKS5mb3JFYWNoKChwcm9wTmFtZTogc3RyaW5nKSA9PiB7XHJcbiAgICAgIC8vIOaPkOWPluW9k+WJjeWxnuaAp+azqOino+WvueixoVxyXG4gICAgICBjb25zdCBwcm9wTWV0YWRhdGFzOiBhbnlbXSA9IGFsbFByb3BNZXRhZGF0YXNbcHJvcE5hbWVdO1xyXG4gICAgICAvLyDmj5Dlj5bmjIflrprnsbvlnovnmoTms6jop6PpoblcclxuICAgICAgY29uc3QgbWV0YWRhdGEgPSBwcm9wTWV0YWRhdGFzLmZpbmQoKHByb3BNZXRhZGF0YTogYW55KSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHByb3BNZXRhZGF0YS5uZ01ldGFkYXRhTmFtZSA9PT0gbWV0YWRhdGFOYW1lO1xyXG4gICAgICB9KTtcclxuICAgICAgaWYgKHRyYW5zbGF0ZVNlcnZpY2UgJiYga2V5c1RvVHJhbnNsYXRlKSB7XHJcbiAgICAgICAga2V5c1RvVHJhbnNsYXRlLmZvckVhY2goKG1ldGFkYXRhUHJvcEtleSkgPT4ge1xyXG4gICAgICAgICAgY29uc3QgcHJvcGVydHlWYXJpYWJsZTogc3RyaW5nID0gbWV0YWRhdGFbbWV0YWRhdGFQcm9wS2V5XTtcclxuICAgICAgICAgIGlmIChwcm9wZXJ0eVZhcmlhYmxlICYmIHByb3BlcnR5VmFyaWFibGUuc3RhcnRzV2l0aCgne3snKSAmJiBwcm9wZXJ0eVZhcmlhYmxlLmVuZHNXaXRoKCd9fScpKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRyYW5zbGF0ZUtleSA9IHByb3BlcnR5VmFyaWFibGUucmVwbGFjZSgne3snLCAnJykucmVwbGFjZSgnfX0nLCAnJykudHJpbSgpO1xyXG4gICAgICAgICAgICBtZXRhZGF0YVttZXRhZGF0YVByb3BLZXldID0gdHJhbnNsYXRlU2VydmljZS50cmFuc2Zvcm0odHJhbnNsYXRlS2V5LCBudWxsKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgICBpZiAobWV0YWRhdGEpIHtcclxuICAgICAgICBtZXRhZGF0YXNbcHJvcE5hbWVdID0gbWV0YWRhdGE7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiBtZXRhZGF0YXM7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDojrflj5bmn5DkuKrlsZ7mgKfnmoTmiYDmnInlhYPmlbDmja5cclxuICAgKiDov5Tlm57moLzlvI/vvJpbIE5nRGVmYXVsdFZhbHVlLCBOZ01heExlbmd0aCwgTmdNaW5MZW5ndGhdXHJcbiAgICovXHJcbiAgc3RhdGljIGdldFByb3BNZXRhZGF0YXNCeU5hbWUoY29uc3RydWN0b3I6IGFueSwgcHJvcE5hbWU6IHN0cmluZyk6IGFueVtdIHtcclxuICAgIC8vIOaaguS4jeWunueOsFxyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDojrflj5bmn5DkuKrlsZ7mgKfnmoTmn5Dnp43lhYPmlbDmja5cclxuICAgKiDov5Tlm57moLzlvI/vvJpOZ0RlZmF1bHRWYWx1ZVxyXG4gICAqL1xyXG4gIHN0YXRpYyBnZXRQcm9wTWV0YWRhdGFCeU5hbWUoY29uc3RydWN0b3I6IGFueSwgcHJvcE5hbWU6IHN0cmluZywgbWV0YWRhdGFOYW1lOiBzdHJpbmcpOiBhbnkge1xyXG4gICAgLy8g5pqC5LiN5a6e546wXHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcblxyXG5cclxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbiAgLy8g5Y+C5pWw5YWD5pWw5o2uXHJcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxufVxyXG5cclxuZXhwb3J0IHsgTWV0YWRhdGFVdGlsIH07XHJcbiJdfQ==