/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/components/bill-tracker-data/bill-tracker-data.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ComponentFactoryResolver, Injector, ViewContainerRef, ViewChild, ComponentRef, NgModuleFactoryLoader, ChangeDetectorRef, LOCALE_ID, Inject } from '@angular/core';
import { BasicTableComponent } from '../basic-table/basic-table.component';
import { BillTrackerDataService } from '../../services/bill-tracker-data.service';
import { LoadingService } from '@farris/ui-loading';
import { MessagerService } from '@farris/ui-messager';
import { BillTrackingSettings, BillTrackingDataShownMode } from '@edp-bif/common-api';
import { from, of } from 'rxjs';
import { switchMap } from 'rxjs/operators';
import { BasicInfoComponent } from '../basic-info/basic-info.component';
import { NotifyService } from '@farris/ui-notify';
import { BsModalService } from '@farris/ui-modal';
import { BillTrackerDataInfoService } from '../../services/bill-tracker-data-info.service';
import { BillTrackerLocalePipe } from '../../pipe/bill-tracker-locale.pipe';
var BillTrackerDataComponent = /** @class */ (function () {
    function BillTrackerDataComponent(notify, messager, loading, modal, dataService, inj, cfr, cdf, loader, localeId) {
        this.notify = notify;
        this.messager = messager;
        this.loading = loading;
        this.modal = modal;
        this.dataService = dataService;
        this.inj = inj;
        this.cfr = cfr;
        this.cdf = cdf;
        this.loader = loader;
        this.dataInfoService = new BillTrackerDataInfoService();
        this.localeId = localeId || this.inj.get(LOCALE_ID, null) || 'zh-CHS';
        this.localePipe = new BillTrackerLocalePipe(localeId);
    }
    /**
     * @return {?}
     */
    BillTrackerDataComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @return {?}
     */
    BillTrackerDataComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @return {?}
     */
    BillTrackerDataComponent.prototype.clearDataRegion = /**
     * @return {?}
     */
    function () {
        this.dataRegion.clear();
    };
    /**
     * @param {?} args
     * @param {?=} billInfo
     * @param {?=} billDataInfo
     * @param {?=} res
     * @return {?}
     */
    BillTrackerDataComponent.prototype.showDataGrid = /**
     * @param {?} args
     * @param {?=} billInfo
     * @param {?=} billDataInfo
     * @param {?=} res
     * @return {?}
     */
    function (args, billInfo, billDataInfo, res) {
        // 单据追踪配置
        /** @type {?} */
        var bts = new BillTrackingSettings();
        if (billInfo && billInfo.billTrackingSettings) {
            bts.LoadFromJson(billInfo.billTrackingSettings);
        }
        if (bts.billTrackingDataShownMode == BillTrackingDataShownMode.CUSTOMFORM) {
            this.showCustomForm(args, billInfo, billDataInfo);
        }
        else {
            this.showGeneralForm(args, billInfo, billDataInfo, res);
        }
    };
    /**
     * 打开通用表单
     * @param args
     * @param billInfo
     * @param res
     */
    /**
     * 打开通用表单
     * @private
     * @param {?} args
     * @param {?=} billInfo
     * @param {?=} billDataInfo
     * @param {?=} res
     * @param {?=} newBTS
     * @return {?}
     */
    BillTrackerDataComponent.prototype.showGeneralForm = /**
     * 打开通用表单
     * @private
     * @param {?} args
     * @param {?=} billInfo
     * @param {?=} billDataInfo
     * @param {?=} res
     * @param {?=} newBTS
     * @return {?}
     */
    function (args, billInfo, billDataInfo, res, newBTS) {
        var _this = this;
        if (res != null) {
            this.createDataComp(res, billInfo, billDataInfo);
        }
        else {
            /** @type {?} */
            var l_1 = this.loading.show({ message: this.localePipe.transform("loading") });
            this.dataService.getEntityData(args).subscribe((/**
             * @param {?} res
             * @return {?}
             */
            function (res) {
                _this.createDataComp(res, billInfo, billDataInfo);
                l_1.close();
            }), (/**
             * @param {?} err
             * @return {?}
             */
            function (err) {
                l_1.close();
                _this.messager.error(err.error == null ? err.message : (err.error.Message || err.error.message || err.message));
                throw err;
            }));
        }
    };
    /**
     * 打开自定义表单
     * @param args
     * @param billInfo
     */
    /**
     * 打开自定义表单
     * @private
     * @param {?} args
     * @param {?=} billInfo
     * @param {?=} billDataInfo
     * @return {?}
     */
    BillTrackerDataComponent.prototype.showCustomForm = /**
     * 打开自定义表单
     * @private
     * @param {?} args
     * @param {?=} billInfo
     * @param {?=} billDataInfo
     * @return {?}
     */
    function (args, billInfo, billDataInfo) {
        var _this = this;
        /** @type {?} */
        var bts = new BillTrackingSettings();
        if (billInfo && billInfo.billTrackingSettings) {
            bts.LoadFromJson(billInfo.billTrackingSettings);
        }
        /** @type {?} */
        var formContent = JSON.parse(bts.customFormContent);
        /** @type {?} */
        var moduleF$ = null;
        if (formContent.form.endsWith(".js")) {
            // url格式为[js路径]时
            moduleF$ = from(System.import(formContent.form.toLowerCase()).then((/**
             * @param {?} m
             * @return {?}
             */
            function (m) { return m; }))).pipe(switchMap((/**
             * @param {?} m
             * @return {?}
             */
            function (m) {
                for (var key in m) {
                    return of(m[key]);
                }
                return of(null);
            })));
        }
        else {
            // url格式为[js路径#模块名]时
            moduleF$ = from(this.loader.load(formContent.form));
        }
        moduleF$.subscribe((/**
         * @param {?} moduleFactory
         * @return {?}
         */
        function (moduleFactory) {
            /** @type {?} */
            var moduleRef = moduleFactory.create(_this.inj);
            /** @type {?} */
            var cmpR$ = moduleRef.instance.createDataShownComponent(_this.inj, args);
            if (cmpR$ instanceof ComponentRef) {
                cmpR$ = of(cmpR$);
            }
            cmpR$.subscribe((/**
             * @param {?} cmpR
             * @return {?}
             */
            function (cmpR) {
                // 重置滚动条
                /** @type {?} */
                var elt = (/** @type {?} */ (_this.dataRegion.element.nativeElement.parentElement));
                elt.scrollTo({ left: 0 });
                _this.dataRegion.clear();
                _this.dataRegion.insert(cmpR.hostView);
            }));
        }));
    };
    /**
   * 创建通用表组件
   * @param res
   * @param billInfo
   */
    /**
     * 创建通用表组件
     * @param {?} res
     * @param {?} billInfo
     * @param {?} billDataInfo
     * @return {?}
     */
    BillTrackerDataComponent.prototype.createDataComp = /**
     * 创建通用表组件
     * @param {?} res
     * @param {?} billInfo
     * @param {?} billDataInfo
     * @return {?}
     */
    function (res, billInfo, billDataInfo) {
        /** @type {?} */
        var newBTS = this.dataInfoService.isNewBTS(billInfo.billTrackingSettings);
        // if (newBTS) {
        try {
            this.createNewDataComp(res, billInfo, billDataInfo);
        }
        catch (e) {
            // 重置滚动条
            /** @type {?} */
            var elt = (/** @type {?} */ (this.dataRegion.element.nativeElement.parentElement));
            elt && elt.scrollTo({ left: 0 });
            this.dataRegion.clear();
            /** @type {?} */
            var cmf = this.cfr.resolveComponentFactory(BasicTableComponent);
            /** @type {?} */
            var cmpR = this.dataRegion.createComponent(cmf);
            cmpR.instance.billInfo = billInfo;
            cmpR.instance.isMain = true;
            cmpR.instance.showMainTable(res);
            this.dataRegion.insert(cmpR.hostView);
        }
        // }
    };
    /**
   * 创建通用表组件
   * @param res
   * @param billInfo
   */
    /**
     * 创建通用表组件
     * @param {?} res
     * @param {?=} billInfo
     * @param {?=} billDataInfo
     * @return {?}
     */
    BillTrackerDataComponent.prototype.createNewDataComp = /**
     * 创建通用表组件
     * @param {?} res
     * @param {?=} billInfo
     * @param {?=} billDataInfo
     * @return {?}
     */
    function (res, billInfo, billDataInfo) {
        // 重置滚动条
        /** @type {?} */
        var elt = (/** @type {?} */ (this.dataRegion.element.nativeElement.parentElement));
        elt && elt.scrollTo({ left: 0 });
        this.dataRegion.clear();
        /** @type {?} */
        var cmf = this.cfr.resolveComponentFactory(BasicInfoComponent);
        /** @type {?} */
        var cmpR = this.dataRegion.createComponent(cmf);
        cmpR.instance.schemaTable = res.billSchema.mainTable;
        cmpR.instance.dataTable = res.billData.mainTable;
        cmpR.instance.billInfo = billInfo;
        cmpR.instance.billDataInfo = billDataInfo;
        this.dataRegion.insert(cmpR.hostView);
    };
    BillTrackerDataComponent.decorators = [
        { type: Component, args: [{
                    selector: 'lib-bill-tracker-data',
                    template: "<div style=\"\">\r\n    <ng-container #dataRegion></ng-container>\r\n</div>",
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    BillTrackerDataComponent.ctorParameters = function () { return [
        { type: NotifyService },
        { type: MessagerService },
        { type: LoadingService },
        { type: BsModalService },
        { type: BillTrackerDataService },
        { type: Injector },
        { type: ComponentFactoryResolver },
        { type: ChangeDetectorRef },
        { type: NgModuleFactoryLoader },
        { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] }
    ]; };
    BillTrackerDataComponent.propDecorators = {
        dataRegion: [{ type: ViewChild, args: ["dataRegion", { read: ViewContainerRef },] }]
    };
    return BillTrackerDataComponent;
}());
export { BillTrackerDataComponent };
if (false) {
    /** @type {?} */
    BillTrackerDataComponent.prototype.dataRegion;
    /** @type {?} */
    BillTrackerDataComponent.prototype.dataInfoService;
    /** @type {?} */
    BillTrackerDataComponent.prototype.localePipe;
    /** @type {?} */
    BillTrackerDataComponent.prototype.localeId;
    /** @type {?} */
    BillTrackerDataComponent.prototype.notify;
    /** @type {?} */
    BillTrackerDataComponent.prototype.messager;
    /** @type {?} */
    BillTrackerDataComponent.prototype.loading;
    /** @type {?} */
    BillTrackerDataComponent.prototype.modal;
    /** @type {?} */
    BillTrackerDataComponent.prototype.dataService;
    /** @type {?} */
    BillTrackerDataComponent.prototype.inj;
    /** @type {?} */
    BillTrackerDataComponent.prototype.cfr;
    /** @type {?} */
    BillTrackerDataComponent.prototype.cdf;
    /** @type {?} */
    BillTrackerDataComponent.prototype.loader;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmlsbC10cmFja2VyLWRhdGEuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGVkcC1iaWYvcnVudGltZS1hcGkvIiwic291cmNlcyI6WyJsaWIvYmlsbC10cmFja2VyL2NvbXBvbmVudHMvYmlsbC10cmFja2VyLWRhdGEvYmlsbC10cmFja2VyLWRhdGEuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBVSx3QkFBd0IsRUFBRSxRQUFRLEVBQWlCLGdCQUFnQixFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUscUJBQXFCLEVBQW1CLGlCQUFpQixFQUFZLFNBQVMsRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDeE8sT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sc0NBQXNDLENBQUM7QUFDM0UsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sMENBQTBDLENBQUM7QUFFbEYsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQ3BELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUd0RCxPQUFPLEVBQUUsb0JBQW9CLEVBQUUseUJBQXlCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN0RixPQUFPLEVBQUUsSUFBSSxFQUFFLEVBQUUsRUFBYyxNQUFNLE1BQU0sQ0FBQztBQUM1QyxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFHM0MsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sb0NBQW9DLENBQUM7QUFDeEUsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUNsRCxPQUFPLEVBQUUsMEJBQTBCLEVBQUUsTUFBTSwrQ0FBK0MsQ0FBQztBQUMzRixPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSxxQ0FBcUMsQ0FB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bmVudEZhY3RvcnlSZXNvbHZlciwgSW5qZWN0b3IsIEFmdGVyVmlld0luaXQsIFZpZXdDb250YWluZXJSZWYsIFZpZXdDaGlsZCwgQ29tcG9uZW50UmVmLCBOZ01vZHVsZUZhY3RvcnlMb2FkZXIsIE5nTW9kdWxlRmFjdG9yeSwgQ2hhbmdlRGV0ZWN0b3JSZWYsIE9wdGlvbmFsLCBMT0NBTEVfSUQsIEluamVjdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBCYXNpY1RhYmxlQ29tcG9uZW50IH0gZnJvbSAnLi4vYmFzaWMtdGFibGUvYmFzaWMtdGFibGUuY29tcG9uZW50JztcclxuaW1wb3J0IHsgQmlsbFRyYWNrZXJEYXRhU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL2JpbGwtdHJhY2tlci1kYXRhLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBHZXRNYWluRW50aXR5RGF0YUFyZ3MgfSBmcm9tICcuLi8uLi9hcmdzL0dldE1haW5FbnRpdHlEYXRhQXJncyc7XHJcbmltcG9ydCB7IExvYWRpbmdTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1sb2FkaW5nJztcclxuaW1wb3J0IHsgTWVzc2FnZXJTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1tZXNzYWdlcic7XHJcbmltcG9ydCB7IEVudGl0eURhdGFSZXN1bHQgfSBmcm9tICcuLi8uLi9hcmdzL0VudGl0eURhdGFSZXN1bHQnO1xyXG5pbXBvcnQgeyBCaWxsSW5mbyB9IGZyb20gJy4uLy4uLy4uL2VudGl0eS90cmFja2luZy9CaWxsSW5mbyc7XHJcbmltcG9ydCB7IEJpbGxUcmFja2luZ1NldHRpbmdzLCBCaWxsVHJhY2tpbmdEYXRhU2hvd25Nb2RlIH0gZnJvbSAnQGVkcC1iaWYvY29tbW9uLWFwaSc7XHJcbmltcG9ydCB7IGZyb20sIG9mLCBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IHN3aXRjaE1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgSUJpbGxUcmFja2VyRGF0YVNob3duTW9kdWxlIH0gZnJvbSAnLi4vLi4vYmFzZS9JQmlsbFRyYWNrZXJEYXRhU2hvd25Nb2R1bGUnO1xyXG5pbXBvcnQgeyBJQmlsbFRyYWNrZXJEYXRhU2hvd25Db21wb25lbnQgfSBmcm9tICcuLi8uLi9iYXNlL0lCaWxsVHJhY2tlckRhdGFTaG93bkNvbXBvbmVudCc7XHJcbmltcG9ydCB7IEJhc2ljSW5mb0NvbXBvbmVudCB9IGZyb20gJy4uL2Jhc2ljLWluZm8vYmFzaWMtaW5mby5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBOb3RpZnlTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1ub3RpZnknO1xyXG5pbXBvcnQgeyBCc01vZGFsU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbW9kYWwnO1xyXG5pbXBvcnQgeyBCaWxsVHJhY2tlckRhdGFJbmZvU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL2JpbGwtdHJhY2tlci1kYXRhLWluZm8uc2VydmljZSc7XHJcbmltcG9ydCB7IEJpbGxUcmFja2VyTG9jYWxlUGlwZSB9IGZyb20gJy4uLy4uL3BpcGUvYmlsbC10cmFja2VyLWxvY2FsZS5waXBlJztcclxuaW1wb3J0IHsgQmlsbERhdGFJbmZvIH0gZnJvbSAnLi4vLi4vLi4vZW50aXR5L3RyYWNraW5nL0JpbGxEYXRhSW5mbyc7XHJcblxyXG5kZWNsYXJlIHZhciBTeXN0ZW06IGFueTtcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnbGliLWJpbGwtdHJhY2tlci1kYXRhJyxcclxuICB0ZW1wbGF0ZVVybDogJy4vYmlsbC10cmFja2VyLWRhdGEuY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsczogWycuL2JpbGwtdHJhY2tlci1kYXRhLmNvbXBvbmVudC5jc3MnXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgQmlsbFRyYWNrZXJEYXRhQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0IHtcclxuXHJcbiAgQFZpZXdDaGlsZChcImRhdGFSZWdpb25cIiwgeyByZWFkOiBWaWV3Q29udGFpbmVyUmVmIH0pXHJcbiAgZGF0YVJlZ2lvbjogVmlld0NvbnRhaW5lclJlZjtcclxuICBkYXRhSW5mb1NlcnZpY2U6IEJpbGxUcmFja2VyRGF0YUluZm9TZXJ2aWNlO1xyXG4gIGxvY2FsZVBpcGU6IEJpbGxUcmFja2VyTG9jYWxlUGlwZTtcclxuICBsb2NhbGVJZDogc3RyaW5nO1xyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHB1YmxpYyBub3RpZnk6IE5vdGlmeVNlcnZpY2UsXHJcbiAgICBwdWJsaWMgbWVzc2FnZXI6IE1lc3NhZ2VyU2VydmljZSxcclxuICAgIHB1YmxpYyBsb2FkaW5nOiBMb2FkaW5nU2VydmljZSxcclxuICAgIHB1YmxpYyBtb2RhbDogQnNNb2RhbFNlcnZpY2UsXHJcbiAgICBwdWJsaWMgZGF0YVNlcnZpY2U6IEJpbGxUcmFja2VyRGF0YVNlcnZpY2UsXHJcbiAgICBwdWJsaWMgaW5qOiBJbmplY3RvcixcclxuICAgIHB1YmxpYyBjZnI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcclxuICAgIHB1YmxpYyBjZGY6IENoYW5nZURldGVjdG9yUmVmLFxyXG4gICAgcHVibGljIGxvYWRlcjogTmdNb2R1bGVGYWN0b3J5TG9hZGVyLFxyXG4gICAgQEluamVjdChMT0NBTEVfSUQpIGxvY2FsZUlkOiBzdHJpbmcsXHJcbiAgKSB7XHJcbiAgICB0aGlzLmRhdGFJbmZvU2VydmljZSA9IG5ldyBCaWxsVHJhY2tlckRhdGFJbmZvU2VydmljZSgpO1xyXG4gICAgdGhpcy5sb2NhbGVJZCA9IGxvY2FsZUlkIHx8IHRoaXMuaW5qLmdldChMT0NBTEVfSUQsIG51bGwpIHx8ICd6aC1DSFMnO1xyXG4gICAgdGhpcy5sb2NhbGVQaXBlID0gbmV3IEJpbGxUcmFja2VyTG9jYWxlUGlwZShsb2NhbGVJZCk7XHJcbiAgfVxyXG5cclxuICBuZ09uSW5pdCgpIHtcclxuXHJcbiAgfVxyXG5cclxuICBuZ0FmdGVyVmlld0luaXQoKTogdm9pZCB7XHJcblxyXG4gIH1cclxuXHJcbiAgcHVibGljIGNsZWFyRGF0YVJlZ2lvbigpOiB2b2lkIHtcclxuICAgIHRoaXMuZGF0YVJlZ2lvbi5jbGVhcigpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHNob3dEYXRhR3JpZChhcmdzOiBHZXRNYWluRW50aXR5RGF0YUFyZ3MsIGJpbGxJbmZvPzogQmlsbEluZm8sIGJpbGxEYXRhSW5mbz86IEJpbGxEYXRhSW5mbywgcmVzPzogRW50aXR5RGF0YVJlc3VsdCk6IHZvaWQge1xyXG4gICAgLy8g5Y2V5o2u6L+96Liq6YWN572uXHJcbiAgICBsZXQgYnRzOiBCaWxsVHJhY2tpbmdTZXR0aW5ncyA9IG5ldyBCaWxsVHJhY2tpbmdTZXR0aW5ncygpO1xyXG4gICAgaWYgKGJpbGxJbmZvICYmIGJpbGxJbmZvLmJpbGxUcmFja2luZ1NldHRpbmdzKSB7XHJcbiAgICAgIGJ0cy5Mb2FkRnJvbUpzb24oYmlsbEluZm8uYmlsbFRyYWNraW5nU2V0dGluZ3MpO1xyXG4gICAgfVxyXG4gICAgaWYgKGJ0cy5iaWxsVHJhY2tpbmdEYXRhU2hvd25Nb2RlID09IEJpbGxUcmFja2luZ0RhdGFTaG93bk1vZGUuQ1VTVE9NRk9STSkge1xyXG4gICAgICB0aGlzLnNob3dDdXN0b21Gb3JtKGFyZ3MsIGJpbGxJbmZvLCBiaWxsRGF0YUluZm8pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5zaG93R2VuZXJhbEZvcm0oYXJncywgYmlsbEluZm8sIGJpbGxEYXRhSW5mbywgcmVzKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaJk+W8gOmAmueUqOihqOWNlVxyXG4gICAqIEBwYXJhbSBhcmdzIFxyXG4gICAqIEBwYXJhbSBiaWxsSW5mbyBcclxuICAgKiBAcGFyYW0gcmVzIFxyXG4gICAqL1xyXG4gIHByaXZhdGUgc2hvd0dlbmVyYWxGb3JtKGFyZ3M6IEdldE1haW5FbnRpdHlEYXRhQXJncywgYmlsbEluZm8/OiBCaWxsSW5mbywgYmlsbERhdGFJbmZvPzogQmlsbERhdGFJbmZvLCByZXM/OiBFbnRpdHlEYXRhUmVzdWx0LCBuZXdCVFM/OiBib29sZWFuKSB7XHJcbiAgICBpZiAocmVzICE9IG51bGwpIHtcclxuICAgICAgdGhpcy5jcmVhdGVEYXRhQ29tcChyZXMsIGJpbGxJbmZvLCBiaWxsRGF0YUluZm8pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY29uc3QgbCA9IHRoaXMubG9hZGluZy5zaG93KHsgbWVzc2FnZTogdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybShcImxvYWRpbmdcIikgfSk7XHJcbiAgICAgIHRoaXMuZGF0YVNlcnZpY2UuZ2V0RW50aXR5RGF0YShhcmdzKS5zdWJzY3JpYmUoXHJcbiAgICAgICAgKHJlczogRW50aXR5RGF0YVJlc3VsdCkgPT4ge1xyXG4gICAgICAgICAgdGhpcy5jcmVhdGVEYXRhQ29tcChyZXMsIGJpbGxJbmZvLCBiaWxsRGF0YUluZm8pO1xyXG4gICAgICAgICAgbC5jbG9zZSgpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgKGVycikgPT4ge1xyXG4gICAgICAgICAgbC5jbG9zZSgpO1xyXG4gICAgICAgICAgdGhpcy5tZXNzYWdlci5lcnJvcihlcnIuZXJyb3IgPT0gbnVsbCA/IGVyci5tZXNzYWdlIDogKGVyci5lcnJvci5NZXNzYWdlIHx8IGVyci5lcnJvci5tZXNzYWdlIHx8IGVyci5tZXNzYWdlKSk7XHJcbiAgICAgICAgICB0aHJvdyBlcnI7XHJcbiAgICAgICAgfVxyXG4gICAgICApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5omT5byA6Ieq5a6a5LmJ6KGo5Y2VXHJcbiAgICogQHBhcmFtIGFyZ3MgXHJcbiAgICogQHBhcmFtIGJpbGxJbmZvIFxyXG4gICAqL1xyXG4gIHByaXZhdGUgc2hvd0N1c3RvbUZvcm0oYXJnczogR2V0TWFpbkVudGl0eURhdGFBcmdzLCBiaWxsSW5mbz86IEJpbGxJbmZvLCBiaWxsRGF0YUluZm8/OiBCaWxsRGF0YUluZm8pIHtcclxuICAgIGxldCBidHM6IEJpbGxUcmFja2luZ1NldHRpbmdzID0gbmV3IEJpbGxUcmFja2luZ1NldHRpbmdzKCk7XHJcbiAgICBpZiAoYmlsbEluZm8gJiYgYmlsbEluZm8uYmlsbFRyYWNraW5nU2V0dGluZ3MpIHtcclxuICAgICAgYnRzLkxvYWRGcm9tSnNvbihiaWxsSW5mby5iaWxsVHJhY2tpbmdTZXR0aW5ncyk7XHJcbiAgICB9XHJcbiAgICBsZXQgZm9ybUNvbnRlbnQgPSBKU09OLnBhcnNlKGJ0cy5jdXN0b21Gb3JtQ29udGVudCk7XHJcblxyXG4gICAgbGV0IG1vZHVsZUYkID0gbnVsbDtcclxuICAgIGlmIChmb3JtQ29udGVudC5mb3JtLmVuZHNXaXRoKFwiLmpzXCIpKSB7XHJcbiAgICAgIC8vIHVybOagvOW8j+S4ultqc+i3r+W+hF3ml7ZcclxuICAgICAgbW9kdWxlRiQgPSBmcm9tKFN5c3RlbS5pbXBvcnQoZm9ybUNvbnRlbnQuZm9ybS50b0xvd2VyQ2FzZSgpKS50aGVuKG0gPT4gbSkpLnBpcGUoXHJcbiAgICAgICAgc3dpdGNoTWFwKFxyXG4gICAgICAgICAgKG06IHsgW2tleTogc3RyaW5nXTogTmdNb2R1bGVGYWN0b3J5PElCaWxsVHJhY2tlckRhdGFTaG93bk1vZHVsZT4gfSkgPT4ge1xyXG4gICAgICAgICAgICBmb3IgKGxldCBrZXkgaW4gbSkge1xyXG4gICAgICAgICAgICAgIHJldHVybiBvZihtW2tleV0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBvZihudWxsKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICApXHJcbiAgICAgICk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvLyB1cmzmoLzlvI/kuLpbanPot6/lvoQj5qih5Z2X5ZCNXeaXtlxyXG4gICAgICBtb2R1bGVGJCA9IGZyb20odGhpcy5sb2FkZXIubG9hZChmb3JtQ29udGVudC5mb3JtKSk7XHJcbiAgICB9XHJcblxyXG4gICAgbW9kdWxlRiQuc3Vic2NyaWJlKFxyXG4gICAgICAobW9kdWxlRmFjdG9yeTogTmdNb2R1bGVGYWN0b3J5PElCaWxsVHJhY2tlckRhdGFTaG93bk1vZHVsZT4pID0+IHtcclxuICAgICAgICBjb25zdCBtb2R1bGVSZWYgPSBtb2R1bGVGYWN0b3J5LmNyZWF0ZSh0aGlzLmluaik7XHJcblxyXG4gICAgICAgIGxldCBjbXBSJCA9IG1vZHVsZVJlZi5pbnN0YW5jZS5jcmVhdGVEYXRhU2hvd25Db21wb25lbnQodGhpcy5pbmosIGFyZ3MpO1xyXG4gICAgICAgIGlmIChjbXBSJCBpbnN0YW5jZW9mIENvbXBvbmVudFJlZikge1xyXG4gICAgICAgICAgY21wUiQgPSBvZihjbXBSJCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNtcFIkLnN1YnNjcmliZShcclxuICAgICAgICAgIChjbXBSOiBDb21wb25lbnRSZWY8SUJpbGxUcmFja2VyRGF0YVNob3duQ29tcG9uZW50PikgPT4ge1xyXG4gICAgICAgICAgICAvLyDph43nva7mu5rliqjmnaFcclxuICAgICAgICAgICAgY29uc3QgZWx0ID0gdGhpcy5kYXRhUmVnaW9uLmVsZW1lbnQubmF0aXZlRWxlbWVudC5wYXJlbnRFbGVtZW50IGFzIEhUTUxFbGVtZW50O1xyXG4gICAgICAgICAgICBlbHQuc2Nyb2xsVG8oeyBsZWZ0OiAwIH0pO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5kYXRhUmVnaW9uLmNsZWFyKCk7XHJcbiAgICAgICAgICAgIHRoaXMuZGF0YVJlZ2lvbi5pbnNlcnQoY21wUi5ob3N0Vmlldyk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgKTtcclxuICAgICAgfVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gKiDliJvlu7rpgJrnlKjooajnu4Tku7ZcclxuICogQHBhcmFtIHJlcyBcclxuICogQHBhcmFtIGJpbGxJbmZvIFxyXG4gKi9cclxuICBjcmVhdGVEYXRhQ29tcChyZXM6IEVudGl0eURhdGFSZXN1bHQsIGJpbGxJbmZvOiBCaWxsSW5mbywgYmlsbERhdGFJbmZvOiBCaWxsRGF0YUluZm8pIHtcclxuICAgIGNvbnN0IG5ld0JUUyA9IHRoaXMuZGF0YUluZm9TZXJ2aWNlLmlzTmV3QlRTKGJpbGxJbmZvLmJpbGxUcmFja2luZ1NldHRpbmdzKTtcclxuICAgIC8vIGlmIChuZXdCVFMpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIHRoaXMuY3JlYXRlTmV3RGF0YUNvbXAocmVzLCBiaWxsSW5mbywgYmlsbERhdGFJbmZvKTtcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgLy8g6YeN572u5rua5Yqo5p2hXHJcbiAgICAgIGNvbnN0IGVsdCA9IHRoaXMuZGF0YVJlZ2lvbi5lbGVtZW50Lm5hdGl2ZUVsZW1lbnQucGFyZW50RWxlbWVudCBhcyBIVE1MRWxlbWVudDtcclxuICAgICAgZWx0ICYmIGVsdC5zY3JvbGxUbyh7IGxlZnQ6IDAgfSk7XHJcblxyXG4gICAgICB0aGlzLmRhdGFSZWdpb24uY2xlYXIoKTtcclxuICAgICAgY29uc3QgY21mID0gdGhpcy5jZnIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoQmFzaWNUYWJsZUNvbXBvbmVudCk7XHJcbiAgICAgIGNvbnN0IGNtcFI6IENvbXBvbmVudFJlZjxCYXNpY1RhYmxlQ29tcG9uZW50PiA9IHRoaXMuZGF0YVJlZ2lvbi5jcmVhdGVDb21wb25lbnQoY21mKTtcclxuICAgICAgY21wUi5pbnN0YW5jZS5iaWxsSW5mbyA9IGJpbGxJbmZvO1xyXG4gICAgICBjbXBSLmluc3RhbmNlLmlzTWFpbiA9IHRydWU7XHJcbiAgICAgIGNtcFIuaW5zdGFuY2Uuc2hvd01haW5UYWJsZShyZXMpO1xyXG5cclxuICAgICAgdGhpcy5kYXRhUmVnaW9uLmluc2VydChjbXBSLmhvc3RWaWV3KTtcclxuICAgIH1cclxuICAgIC8vIH1cclxuXHJcbiAgfVxyXG5cclxuICAvKipcclxuICog5Yib5bu66YCa55So6KGo57uE5Lu2XHJcbiAqIEBwYXJhbSByZXMgXHJcbiAqIEBwYXJhbSBiaWxsSW5mbyBcclxuICovXHJcbiAgY3JlYXRlTmV3RGF0YUNvbXAocmVzOiBFbnRpdHlEYXRhUmVzdWx0LCBiaWxsSW5mbz86IEJpbGxJbmZvLCBiaWxsRGF0YUluZm8/OiBCaWxsRGF0YUluZm8pIHtcclxuICAgIC8vIOmHjee9rua7muWKqOadoVxyXG4gICAgY29uc3QgZWx0ID0gdGhpcy5kYXRhUmVnaW9uLmVsZW1lbnQubmF0aXZlRWxlbWVudC5wYXJlbnRFbGVtZW50IGFzIEhUTUxFbGVtZW50O1xyXG4gICAgZWx0ICYmIGVsdC5zY3JvbGxUbyh7IGxlZnQ6IDAgfSk7XHJcblxyXG4gICAgdGhpcy5kYXRhUmVnaW9uLmNsZWFyKCk7XHJcbiAgICBjb25zdCBjbWYgPSB0aGlzLmNmci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShCYXNpY0luZm9Db21wb25lbnQpO1xyXG4gICAgY29uc3QgY21wUjogQ29tcG9uZW50UmVmPEJhc2ljSW5mb0NvbXBvbmVudD4gPSB0aGlzLmRhdGFSZWdpb24uY3JlYXRlQ29tcG9uZW50KGNtZik7XHJcbiAgICBjbXBSLmluc3RhbmNlLnNjaGVtYVRhYmxlID0gcmVzLmJpbGxTY2hlbWEubWFpblRhYmxlO1xyXG4gICAgY21wUi5pbnN0YW5jZS5kYXRhVGFibGUgPSByZXMuYmlsbERhdGEubWFpblRhYmxlO1xyXG4gICAgY21wUi5pbnN0YW5jZS5iaWxsSW5mbyA9IGJpbGxJbmZvO1xyXG4gICAgY21wUi5pbnN0YW5jZS5iaWxsRGF0YUluZm8gPSBiaWxsRGF0YUluZm87XHJcblxyXG4gICAgdGhpcy5kYXRhUmVnaW9uLmluc2VydChjbXBSLmhvc3RWaWV3KTtcclxuICB9XHJcbn1cclxuIl19