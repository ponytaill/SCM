/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, Input, ViewChild, TemplateRef, ComponentFactoryResolver, Injector } from '@angular/core';
import { EditorTypes } from '@farris/ui-datagrid-editors';
import { workFlowActions, executionTime, FormMethodConfig } from '../entities/form-method-config';
import { HttpService } from '@ecp-caf/caf-common';
import { DialogComponent } from '@farris/ui-dialog';
import { DatagridComponent } from '@farris/ui-datagrid';
import { MessagerService } from '@farris/ui-messager';
import { BsModalService } from '@farris/ui-modal';
import { ParameterSettingComponent } from '../parameter-setting/parameter-setting.component';
var FormOperationConfigComponent = /** @class */ (function () {
    function FormOperationConfigComponent(http, message, resolver, injector, modalService) {
        this.http = http;
        this.message = message;
        this.resolver = resolver;
        this.injector = injector;
        this.modalService = modalService;
        this.operations = new Array();
        this.cols = new Array();
        this.methodCols = [
            { field: 'method', width: 100, title: '方法标识', showTips: true },
            { field: 'methodName', width: 80, title: '方法名称', showTips: true },
            { field: 'description', width: 120, title: '描述', showTips: true }
        ];
        this.formMethods = new Array();
        this.state = 'add';
    }
    Object.defineProperty(FormOperationConfigComponent.prototype, "formFormatId", {
        get: /**
         * @return {?}
         */
        function () {
            return this._fromFormatId;
        },
        set: /**
         * @param {?} v
         * @return {?}
         */
        function (v) {
            this._fromFormatId = v;
            if (this._fromFormatId) {
                this.getFormMethods();
            }
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    FormOperationConfigComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.cols = [
            {
                field: 'workFlowAction', width: 80, title: '流转方向',
                formatter: {
                    type: 'enum',
                    options: { valueField: 'value', textField: 'text', data: workFlowActions }
                },
                editor: {
                    type: EditorTypes.COMBOLIST,
                    options: { valueField: 'value', textField: 'text', data: workFlowActions, idField: 'value', panelHeight: 'auto', enableClear: false }
                },
                validators: [
                    { type: 'required', messager: '必填' }
                ]
            }, {
                field: 'method', width: 100, title: '表单操作',
                editor: {
                    type: 'input-group',
                    options: {
                        groupText: '<i class="f-icon f-icon-lookup"></i>',
                        editable: false,
                        clickHandle: (/**
                         * @param {?} e
                         * @return {?}
                         */
                        function (e) {
                            e.formControl.setValue(e.instance.value ? e.instance.value : '');
                            _this.e = e;
                            _this.methodsDialog.show();
                            _this.state = 'edit';
                        }),
                        clear: (/**
                         * @param {?} e
                         * @return {?}
                         */
                        function (e) {
                            console.log('clear', e);
                        })
                    }
                },
                formatter: (/**
                 * @param {?} v
                 * @param {?} d
                 * @param {?} i
                 * @return {?}
                 */
                function (v, d, i) {
                    if (v) {
                        /** @type {?} */
                        var m = _this.formMethods.find((/**
                         * @param {?} item
                         * @return {?}
                         */
                        function (item) { return item.method === v; }));
                        if (m) {
                            return m.methodName;
                        }
                        else {
                            return '';
                        }
                    }
                    else {
                        return '';
                    }
                }),
                validators: [
                    { type: 'required', messager: '必填' }
                ]
            },
            {
                field: 'executionTime', width: 80, title: '执行时机',
                formatter: {
                    type: 'enum',
                    options: { valueField: 'value', textField: 'text', data: executionTime }
                },
                editor: {
                    type: EditorTypes.COMBOLIST,
                    options: { valueField: 'value', textField: 'text', data: executionTime, idField: 'value', panelHeight: 'auto', enableClear: false }
                },
                validators: [
                    { type: 'required', messager: '必填' }
                ]
            },
            {
                field: 'sortOrder', width: 60, title: '执行顺序',
                editor: {
                    type: EditorTypes.NUMBERBOX, options: {}
                },
                formatter: { type: 'number', options: { precision: 0 } },
                validators: [
                    { type: 'required', messager: '必填' }
                ]
            },
            {
                field: 'methodParameters', width: 80, title: '参数',
                template: this.cell,
                halign: 'center', align: 'center'
            }
        ];
    };
    /**
     * @return {?}
     */
    FormOperationConfigComponent.prototype.add = /**
     * @return {?}
     */
    function () {
        this.methodsDialog.show();
        this.state = 'add';
    };
    /**
     * @return {?}
     */
    FormOperationConfigComponent.prototype.delete = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.grid.selectedRow) {
            this.operations = this.operations.filter((/**
             * @param {?} o
             * @return {?}
             */
            function (o) { return o.id !== _this.grid.selectedRow.id; }));
        }
        else {
            this.message.info('尚未选中表单操作配置！');
        }
    };
    /**
     * @param {?} ctx
     * @return {?}
     */
    FormOperationConfigComponent.prototype.editParam = /**
     * @param {?} ctx
     * @return {?}
     */
    function (ctx) {
        var _this = this;
        /** @type {?} */
        var compFactory = this.resolver.resolveComponentFactory(ParameterSettingComponent);
        /** @type {?} */
        var compRef = compFactory.create(this.injector);
        compRef.instance.mode = 'usual';
        compRef.instance.showFormType = false;
        if (ctx.rowData.methodParameters) {
            compRef.instance.parameters = tslib_1.__spread(ctx.rowData.methodParameters.map((/**
             * @param {?} p
             * @return {?}
             */
            function (p) { return Object.assign({}, p); })));
        }
        else {
            compRef.instance.parameters = new Array();
        }
        /** @type {?} */
        var modalConfig = {
            title: '参数设置',
            width: 620,
            height: 400,
            showButtons: true,
            buttons: compRef.instance.modalFooter
        };
        /** @type {?} */
        var dialog = this.modalService.show(compRef, modalConfig);
        compRef.instance.submit.subscribe((/**
         * @param {?} re
         * @return {?}
         */
        function (re) {
            var e_1, _a;
            try {
                for (var _b = tslib_1.__values(_this.operations), _c = _b.next(); !_c.done; _c = _b.next()) {
                    var o = _c.value;
                    if (o.id === ctx.rowData.id) {
                        o.methodParameters = re.parameters;
                    }
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                }
                finally { if (e_1) throw e_1.error; }
            }
            dialog.close();
        }));
        compRef.instance.cancel.subscribe((/**
         * @param {?} re
         * @return {?}
         */
        function (re) {
            dialog.close();
        }));
    };
    /**
     * @return {?}
     */
    FormOperationConfigComponent.prototype.methodSelected = /**
     * @return {?}
     */
    function () {
        var e_2, _a;
        if (this.methodGrid.selectedRow) {
            /** @type {?} */
            var data = this.methodGrid.selectedRow.data;
            if (this.state === 'edit') {
                if (this.e) {
                    this.e.formControl.setValue(data.method);
                    this.e.instance.cd.detectChanges();
                    try {
                        for (var _b = tslib_1.__values(this.operations), _c = _b.next(); !_c.done; _c = _b.next()) {
                            var o = _c.value;
                            if (o.id === data.id) {
                                o.method = data.method;
                                o.sortOrder = data.sortOrder;
                                o.methodParameters = data.methodParameters;
                            }
                        }
                    }
                    catch (e_2_1) { e_2 = { error: e_2_1 }; }
                    finally {
                        try {
                            if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                        }
                        finally { if (e_2) throw e_2.error; }
                    }
                }
            }
            else {
                /** @type {?} */
                var operation = new FormMethodConfig();
                operation.formFormatConfigId = this.formFormatConfigId;
                operation.method = data.method;
                operation.sortOrder = data.sortOrder;
                operation.methodParameters = data.methodParameters;
                this.operations = this.operations.concat([operation]);
            }
            this.methodsDialog.close();
        }
        else {
            this.message.info('尚未选中表单操作！');
        }
    };
    /**
     * @return {?}
     */
    FormOperationConfigComponent.prototype.validator = /**
     * @return {?}
     */
    function () {
        var e_3, _a;
        this.grid.endCellEdit();
        try {
            for (var _b = tslib_1.__values(this.operations), _c = _b.next(); !_c.done; _c = _b.next()) {
                var o = _c.value;
                if (!o.method) {
                    this.message.info('尚未选择表单操作！');
                    return false;
                }
            }
        }
        catch (e_3_1) { e_3 = { error: e_3_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_3) throw e_3.error; }
        }
        return true;
    };
    /**
     * @private
     * @return {?}
     */
    FormOperationConfigComponent.prototype.getFormMethods = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.formFormatId) {
            /** @type {?} */
            var url = "/api/runtime/wf/v1.0/formOperation?formFormatId=" + this.formFormatId;
            this.http.get(url).subscribe((/**
             * @param {?} re
             * @return {?}
             */
            function (re) {
                if (re) {
                    _this.formMethods = re;
                }
            }));
        }
    };
    FormOperationConfigComponent.decorators = [
        { type: Component, args: [{
                    selector: 'lib-form-operation-config',
                    template: "<div class=\"f-utils-fill-flex-column h-100\" style=\"background: #FFF;\">\r\n  <farris-datagrid class=\"f-component-grid f-utils-fill\" [columns]=\"cols\" [data]=\"operations\" #grid\r\n    [idField]=\"'id'\" [showLineNumber]=\"true\" [fitColumns]=\"true\" [striped]=\"true\" [showCheckbox]=\"false\"\r\n    [virtualized]=\"true\" [pagination]=\"false\" [useThemes]=\"false\" [fit]=\"true\"\r\n    [editable]=\"true\" [editMode]=\"'cell'\" >\r\n  </farris-datagrid>\r\n  <ng-template #cell let-ctx>\r\n    <a href=\"javascript: void(0);\" title=\"\u53C2\u6570\u8BBE\u7F6E\" (click)=\"editParam(ctx)\">\u8BBE\u7F6E</a>\r\n  </ng-template>\r\n</div>\r\n\r\n<ng-template #buttonRef>\r\n  <button class=\"btn btn-sm btn-primary px-3\" (click)=\"methodSelected()\">\u786E\u5B9A</button>\r\n  <button class=\"btn btn-sm btn-default px-3\" (click)=\"methodsDialog.close()\">\u53D6\u6D88</button>\r\n</ng-template>\r\n<farris-dialog #methodsDialog [buttons]=\"buttonRef\" [width]=\"700\" [height]=\"500\" [title]=\"'\u8868\u5355\u4E8B\u4EF6'\">\r\n  <div class=\"f-page f-page-is-managelist\">\r\n    <div class=\"f-page-main\">\r\n      <div class=\"f-struct-wrapper f-utils-fill-flex-column\">\r\n        <farris-section class=\"f-section-grid f-section-in-managelist p-0\" [showHeader]=\"false\">\r\n          <farris-datagrid class=\"f-component-grid\" [columns]=\"methodCols\" [data]=\"formMethods\" #methodGrid [idField]=\"'id'\"\r\n            [showLineNumber]=\"true\" [striped]=\"true\" [showCheckbox]=\"false\" [virtualized]=\"true\" [pagination]=\"false\"\r\n            [fit]=\"true\" [fitColumns]=\"true\">\r\n          </farris-datagrid>\r\n        </farris-section>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</farris-dialog>\r\n\r\n",
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    FormOperationConfigComponent.ctorParameters = function () { return [
        { type: HttpService },
        { type: MessagerService },
        { type: ComponentFactoryResolver },
        { type: Injector },
        { type: BsModalService }
    ]; };
    FormOperationConfigComponent.propDecorators = {
        formFormatId: [{ type: Input }],
        formFormatConfigId: [{ type: Input }],
        operations: [{ type: Input }],
        methodsDialog: [{ type: ViewChild, args: ['methodsDialog',] }],
        grid: [{ type: ViewChild, args: ['grid',] }],
        methodGrid: [{ type: ViewChild, args: ['methodGrid',] }],
        cell: [{ type: ViewChild, args: ['cell',] }]
    };
    return FormOperationConfigComponent;
}());
export { FormOperationConfigComponent };
if (false) {
    /**
     * @type {?}
     * @private
     */
    FormOperationConfigComponent.prototype._fromFormatId;
    /** @type {?} */
    FormOperationConfigComponent.prototype.formFormatConfigId;
    /** @type {?} */
    FormOperationConfigComponent.prototype.operations;
    /** @type {?} */
    FormOperationConfigComponent.prototype.methodsDialog;
    /** @type {?} */
    FormOperationConfigComponent.prototype.grid;
    /** @type {?} */
    FormOperationConfigComponent.prototype.methodGrid;
    /** @type {?} */
    FormOperationConfigComponent.prototype.cell;
    /** @type {?} */
    FormOperationConfigComponent.prototype.cols;
    /** @type {?} */
    FormOperationConfigComponent.prototype.methodCols;
    /** @type {?} */
    FormOperationConfigComponent.prototype.e;
    /** @type {?} */
    FormOperationConfigComponent.prototype.formMethods;
    /** @type {?} */
    FormOperationConfigComponent.prototype.state;
    /**
     * @type {?}
     * @private
     */
    FormOperationConfigComponent.prototype.http;
    /**
     * @type {?}
     * @private
     */
    FormOperationConfigComponent.prototype.message;
    /**
     * @type {?}
     * @private
     */
    FormOperationConfigComponent.prototype.resolver;
    /**
     * @type {?}
     * @private
     */
    FormOperationConfigComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    FormOperationConfigComponent.prototype.modalService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9ybS1vcGVyYXRpb24tY29uZmlnLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc3Atd2Yvd2YtcHJvY2Vzcy1lZGl0b3IvIiwic291cmNlcyI6WyJsaWIvdmlld3MvZXhlY3V0ZS1mb3Jtcy9mb3JtLW9wZXJhdGlvbi1jb25maWcvZm9ybS1vcGVyYXRpb24tY29uZmlnLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsS0FBSyxFQUFFLFNBQVMsRUFBRSxXQUFXLEVBQUUsd0JBQXdCLEVBQUUsUUFBUSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3JILE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUMxRCxPQUFPLEVBQUUsZUFBZSxFQUFFLGFBQWEsRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBQ2xHLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUVsRCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDcEQsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDeEQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3RELE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUNsRCxPQUFPLEVBQUUseUJBQXlCLEVBQUUsTUFBTSxrREFBa0QsQ0FBQztBQUU3RjtJQXNDRSxzQ0FDVSxJQUFpQixFQUNqQixPQUF3QixFQUN4QixRQUFrQyxFQUNsQyxRQUFrQixFQUNsQixZQUE0QjtRQUo1QixTQUFJLEdBQUosSUFBSSxDQUFhO1FBQ2pCLFlBQU8sR0FBUCxPQUFPLENBQWlCO1FBQ3hCLGFBQVEsR0FBUixRQUFRLENBQTBCO1FBQ2xDLGFBQVEsR0FBUixRQUFRLENBQVU7UUFDbEIsaUJBQVksR0FBWixZQUFZLENBQWdCO1FBeEI3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QUMsV0FBVyxHQUFHLEVBQUUsQ0FBQztpQkFDdkI7WUFDSCxDQUFDLEVBQUMsQ0FBQztTQUNKO0lBQ0gsQ0FBQzs7Z0JBL05GLFNBQVMsU0FBQztvQkFDVCxRQUFRLEVBQUUsMkJBQTJCO29CQUNyQywydERBQXFEOztpQkFFdEQ7Ozs7Z0JBWlEsV0FBVztnQkFJWCxlQUFlO2dCQVBtQyx3QkFBd0I7Z0JBQUUsUUFBUTtnQkFRcEYsY0FBYzs7OytCQVVwQixLQUFLO3FDQVdMLEtBQUs7NkJBQ0wsS0FBSztnQ0FFTCxTQUFTLFNBQUMsZUFBZTt1QkFDekIsU0FBUyxTQUFDLE1BQU07NkJBQ2hCLFNBQVMsU0FBQyxZQUFZO3VCQUN0QixTQUFTLFNBQUMsTUFBTTs7SUF5TW5CLG1DQUFDO0NBQUEsQUFqT0QsSUFpT0M7U0E1TlksNEJBQTRCOzs7Ozs7SUFDdkMscURBQThCOztJQVk5QiwwREFBb0M7O0lBQ3BDLGtEQUFvRDs7SUFFcEQscURBQTJEOztJQUMzRCw0Q0FBMkM7O0lBQzNDLGtEQUF1RDs7SUFDdkQsNENBQTBDOztJQUUxQyw0Q0FBbUI7O0lBRW5CLGtEQUlFOztJQUNGLHlDQUFPOztJQUVQLG1EQUFzQzs7SUFDdEMsNkNBQThCOzs7OztJQUc1Qiw0Q0FBeUI7Ozs7O0lBQ3pCLCtDQUFnQzs7Ozs7SUFDaEMsZ0RBQTBDOzs7OztJQUMxQyxnREFBMEI7Ozs7O0lBQzFCLG9EQUFvQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBJbnB1dCwgVmlld0NoaWxkLCBUZW1wbGF0ZVJlZiwgQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLCBJbmplY3RvciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBFZGl0b3JUeXBlcyB9IGZyb20gJ0BmYXJyaXMvdWktZGF0YWdyaWQtZWRpdG9ycyc7XHJcbmltcG9ydCB7IHdvcmtGbG93QWN0aW9ucywgZXhlY3V0aW9uVGltZSwgRm9ybU1ldGhvZENvbmZpZyB9IGZyb20gJy4uL2VudGl0aWVzL2Zvcm0tbWV0aG9kLWNvbmZpZyc7XHJcbmltcG9ydCB7IEh0dHBTZXJ2aWNlIH0gZnJvbSAnQGVjcC1jYWYvY2FmLWNvbW1vbic7XHJcbmltcG9ydCB7IEZvcm1NZXRob2QgfSBmcm9tICcuLi9lbnRpdGllcy9mb3JtLW1ldGhvZCc7XHJcbmltcG9ydCB7IERpYWxvZ0NvbXBvbmVudCB9IGZyb20gJ0BmYXJyaXMvdWktZGlhbG9nJztcclxuaW1wb3J0IHsgRGF0YWdyaWRDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLWRhdGFncmlkJztcclxuaW1wb3J0IHsgTWVzc2FnZXJTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1tZXNzYWdlcic7XHJcbmltcG9ydCB7IEJzTW9kYWxTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1tb2RhbCc7XHJcbmltcG9ydCB7IFBhcmFtZXRlclNldHRpbmdDb21wb25lbnQgfSBmcm9tICcuLi9wYXJhbWV0ZXItc2V0dGluZy9wYXJhbWV0ZXItc2V0dGluZy5jb21wb25lbnQnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdsaWItZm9ybS1vcGVyYXRpb24tY29uZmlnJyxcclxuICB0ZW1wbGF0ZVVybDogJy4vZm9ybS1vcGVyYXRpb24tY29uZmlnLmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi9mb3JtLW9wZXJhdGlvbi1jb25maWcuY29tcG9uZW50LnNjc3MnXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgRm9ybU9wZXJhdGlvbkNvbmZpZ0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XHJcbiAgcHJpdmF0ZSBfZnJvbUZvcm1hdElkOiBzdHJpbmc7XHJcbiAgQElucHV0KClcclxuICBzZXQgZm9ybUZvcm1hdElkKHY6IHN0cmluZykge1xyXG4gICAgdGhpcy5fZnJvbUZvcm1hdElkID0gdjtcclxuICAgIGlmICh0aGlzLl9mcm9tRm9ybWF0SWQpIHtcclxuICAgICAgdGhpcy5nZXRGb3JtTWV0aG9kcygpO1xyXG4gICAgfVxyXG4gIH1cclxuICBnZXQgZm9ybUZvcm1hdElkKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX2Zyb21Gb3JtYXRJZDtcclxuICB9XHJcblxyXG4gIEBJbnB1dCgpIGZvcm1Gb3JtYXRDb25maWdJZDogc3RyaW5nO1xyXG4gIEBJbnB1dCgpIG9wZXJhdGlvbnMgPSBuZXcgQXJyYXk8Rm9ybU1ldGhvZENvbmZpZz4oKTtcclxuXHJcbiAgQFZpZXdDaGlsZCgnbWV0aG9kc0RpYWxvZycpIG1ldGhvZHNEaWFsb2c6IERpYWxvZ0NvbXBvbmVudDtcclxuICBAVmlld0NoaWxkKCdncmlkJykgZ3JpZDogRGF0YWdyaWRDb21wb25lbnQ7XHJcbiAgQFZpZXdDaGlsZCgnbWV0aG9kR3JpZCcpIG1ldGhvZEdyaWQ6IERhdGFncmlkQ29tcG9uZW50O1xyXG4gIEBWaWV3Q2hpbGQoJ2NlbGwnKSBjZWxsOiBUZW1wbGF0ZVJlZjxhbnk+O1xyXG5cclxuICBjb2xzID0gbmV3IEFycmF5KCk7XHJcblxyXG4gIG1ldGhvZENvbHMgPSBbXHJcbiAgICB7IGZpZWxkOiAnbWV0aG9kJywgd2lkdGg6IDEwMCwgdGl0bGU6ICfmlrnms5XmoIfor4YnLCBzaG93VGlwczogdHJ1ZSB9LFxyXG4gICAgeyBmaWVsZDogJ21ldGhvZE5hbWUnLCB3aWR0aDogODAsIHRpdGxlOiAn5pa55rOV5ZCN56ewJywgc2hvd1RpcHM6IHRydWUgfSxcclxuICAgIHsgZmllbGQ6ICdkZXNjcmlwdGlvbicsIHdpZHRoOiAxMjAsIHRpdGxlOiAn5o+P6L+wJywgc2hvd1RpcHM6IHRydWUgfVxyXG4gIF07XHJcbiAgZTogYW55O1xyXG5cclxuICBmb3JtTWV0aG9kcyA9IG5ldyBBcnJheTxGb3JtTWV0aG9kPigpO1xyXG4gIHN0YXRlOiAnYWRkJyB8ICdlZGl0JyA9ICdhZGQnO1xyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgaHR0cDogSHR0cFNlcnZpY2UsXHJcbiAgICBwcml2YXRlIG1lc3NhZ2U6IE1lc3NhZ2VyU2VydmljZSxcclxuICAgIHByaXZhdGUgcmVzb2x2ZXI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcclxuICAgIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yLFxyXG4gICAgcHJpdmF0ZSBtb2RhbFNlcnZpY2U6IEJzTW9kYWxTZXJ2aWNlXHJcbiAgKSB7IH1cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICB0aGlzLmNvbHMgPSBbXHJcbiAgICB7XHJcbiAgICAgIGZpZWxkOiAnd29ya0Zsb3dBY3Rpb24nLCB3aWR0aDogODAsIHRpdGxlOiAn5rWB6L2s5pa55ZCRJyxcclxuICAgICAgZm9ybWF0dGVyOiB7XHJcbiAgICAgICAgdHlwZTogJ2VudW0nLFxyXG4gICAgICAgIG9wdGlvbnM6IHsgdmFsdWVGaWVsZDogJ3ZhbHVlJywgdGV4dEZpZWxkOiAndGV4dCcsIGRhdGE6IHdvcmtGbG93QWN0aW9ucyB9XHJcbiAgICAgIH0sXHJcbiAgICAgIGVkaXRvcjoge1xyXG4gICAgICAgIHR5cGU6IEVkaXRvclR5cGVzLkNPTUJPTElTVCxcclxuICAgICAgICBvcHRpb25zOiB7IHZhbHVlRmllbGQ6ICd2YWx1ZScsIHRleHRGaWVsZDogJ3RleHQnLCBkYXRhOiB3b3JrRmxvd0FjdGlvbnMsIGlkRmllbGQ6ICd2YWx1ZScsIHBhbmVsSGVpZ2h0OiAnYXV0bycsIGVuYWJsZUNsZWFyOiBmYWxzZSB9XHJcbiAgICAgIH0sXHJcbiAgICAgIHZhbGlkYXRvcnM6IFtcclxuICAgICAgICB7IHR5cGU6ICdyZXF1aXJlZCcsIG1lc3NhZ2VyOiAn5b+F5aGrJyB9XHJcbiAgICAgIF1cclxuICAgIH0sIHtcclxuICAgICAgZmllbGQ6ICdtZXRob2QnLCB3aWR0aDogMTAwLCB0aXRsZTogJ+ihqOWNleaTjeS9nCcsXHJcbiAgICAgIGVkaXRvcjoge1xyXG4gICAgICAgIHR5cGU6ICdpbnB1dC1ncm91cCcsXHJcbiAgICAgICAgb3B0aW9uczoge1xyXG4gICAgICAgICAgZ3JvdXBUZXh0OiAnPGkgY2xhc3M9XCJmLWljb24gZi1pY29uLWxvb2t1cFwiPjwvaT4nLFxyXG4gICAgICAgICAgZWRpdGFibGU6IGZhbHNlLFxyXG4gICAgICAgICAgY2xpY2tIYW5kbGU6IChlKSA9PiB7XHJcbiAgICAgICAgICAgIGUuZm9ybUNvbnRyb2wuc2V0VmFsdWUoZS5pbnN0YW5jZS52YWx1ZSA/IGUuaW5zdGFuY2UudmFsdWUgOiAnJyk7XHJcbiAgICAgICAgICAgIHRoaXMuZSA9IGU7XHJcbiAgICAgICAgICAgIHRoaXMubWV0aG9kc0RpYWxvZy5zaG93KCk7XHJcbiAgICAgICAgICAgIHRoaXMuc3RhdGUgPSAnZWRpdCc7XHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgY2xlYXI6IChlKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdjbGVhcicsIGUpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfSxcclxuICAgICAgZm9ybWF0dGVyOiAodiwgZCwgaSkgPT4ge1xyXG4gICAgICAgIGlmICh2KSB7XHJcbiAgICAgICAgICBjb25zdCBtID0gdGhpcy5mb3JtTWV0aG9kcy5maW5kKGl0ZW0gPT4gaXRlbS5tZXRob2QgPT09IHYpO1xyXG4gICAgICAgICAgaWYgKG0pIHtcclxuICAgICAgICAgICAgcmV0dXJuIG0ubWV0aG9kTmFtZTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiAnJztcclxuICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgICAgIH1cclxuICAgICAgfSxcclxuICAgICAgdmFsaWRhdG9yczogW1xyXG4gICAgICAgIHsgdHlwZTogJ3JlcXVpcmVkJywgbWVzc2FnZXI6ICflv4XloasnIH1cclxuICAgICAgXVxyXG4gICAgfSxcclxuICAgIHtcclxuICAgICAgZmllbGQ6ICdleGVjdXRpb25UaW1lJywgd2lkdGg6IDgwLCB0aXRsZTogJ+aJp+ihjOaXtuacuicsXHJcbiAgICAgIGZvcm1hdHRlcjoge1xyXG4gICAgICAgIHR5cGU6ICdlbnVtJyxcclxuICAgICAgICBvcHRpb25zOiB7IHZhbHVlRmllbGQ6ICd2YWx1ZScsIHRleHRGaWVsZDogJ3RleHQnLCBkYXRhOiBleGVjdXRpb25UaW1lIH1cclxuICAgICAgfSxcclxuICAgICAgZWRpdG9yOiB7XHJcbiAgICAgICAgdHlwZTogRWRpdG9yVHlwZXMuQ09NQk9MSVNULFxyXG4gICAgICAgIG9wdGlvbnM6IHsgdmFsdWVGaWVsZDogJ3ZhbHVlJywgdGV4dEZpZWxkOiAndGV4dCcsIGRhdGE6IGV4ZWN1dGlvblRpbWUsIGlkRmllbGQ6ICd2YWx1ZScsIHBhbmVsSGVpZ2h0OiAnYXV0bycsIGVuYWJsZUNsZWFyOiBmYWxzZSB9XHJcbiAgICAgIH0sXHJcbiAgICAgIHZhbGlkYXRvcnM6IFtcclxuICAgICAgICB7IHR5cGU6ICdyZXF1aXJlZCcsIG1lc3NhZ2VyOiAn5b+F5aGrJyB9XHJcbiAgICAgIF1cclxuICAgIH0sXHJcbiAgICB7XHJcbiAgICAgIGZpZWxkOiAnc29ydE9yZGVyJywgd2lkdGg6IDYwLCB0aXRsZTogJ+aJp+ihjOmhuuW6jycsXHJcbiAgICAgIGVkaXRvcjoge1xyXG4gICAgICAgIHR5cGU6IEVkaXRvclR5cGVzLk5VTUJFUkJPWCwgb3B0aW9uczoge1xyXG4gICAgICAgIH1cclxuICAgICAgfSxcclxuICAgICAgZm9ybWF0dGVyOiB7IHR5cGU6ICdudW1iZXInLCBvcHRpb25zOiB7IHByZWNpc2lvbjogMCB9IH0sXHJcbiAgICAgIHZhbGlkYXRvcnM6IFtcclxuICAgICAgICB7IHR5cGU6ICdyZXF1aXJlZCcsIG1lc3NhZ2VyOiAn5b+F5aGrJyB9XHJcbiAgICAgIF1cclxuICAgIH0sXHJcbiAgICB7XHJcbiAgICAgIGZpZWxkOiAnbWV0aG9kUGFyYW1ldGVycycsIHdpZHRoOiA4MCwgdGl0bGU6ICflj4LmlbAnLFxyXG4gICAgICB0ZW1wbGF0ZTogdGhpcy5jZWxsLFxyXG4gICAgICBoYWxpZ246ICdjZW50ZXInLCBhbGlnbjogJ2NlbnRlcidcclxuICAgIH1cclxuICBdO1xyXG4gIH1cclxuXHJcbiAgYWRkKCkge1xyXG4gICAgdGhpcy5tZXRob2RzRGlhbG9nLnNob3coKTtcclxuICAgIHRoaXMuc3RhdGUgPSAnYWRkJztcclxuICB9XHJcblxyXG4gIGRlbGV0ZSgpIHtcclxuICAgIGlmICh0aGlzLmdyaWQuc2VsZWN0ZWRSb3cpIHtcclxuICAgICAgdGhpcy5vcGVyYXRpb25zID0gdGhpcy5vcGVyYXRpb25zLmZpbHRlcihvID0+IG8uaWQgIT09IHRoaXMuZ3JpZC5zZWxlY3RlZFJvdy5pZCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLm1lc3NhZ2UuaW5mbygn5bCa5pyq6YCJ5Lit6KGo5Y2V5pON5L2c6YWN572u77yBJyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBlZGl0UGFyYW0oY3R4OiBhbnkpIHtcclxuICAgIGNvbnN0IGNvbXBGYWN0b3J5ID0gdGhpcy5yZXNvbHZlci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShQYXJhbWV0ZXJTZXR0aW5nQ29tcG9uZW50KTtcclxuICAgIGNvbnN0IGNvbXBSZWYgPSBjb21wRmFjdG9yeS5jcmVhdGUodGhpcy5pbmplY3Rvcik7XHJcbiAgICBjb21wUmVmLmluc3RhbmNlLm1vZGUgPSAndXN1YWwnO1xyXG4gICAgY29tcFJlZi5pbnN0YW5jZS5zaG93Rm9ybVR5cGUgPSBmYWxzZTtcclxuICAgIGlmIChjdHgucm93RGF0YS5tZXRob2RQYXJhbWV0ZXJzKSB7XHJcbiAgICAgIGNvbXBSZWYuaW5zdGFuY2UucGFyYW1ldGVycyA9IFsuLi5jdHgucm93RGF0YS5tZXRob2RQYXJhbWV0ZXJzLm1hcChwID0+IE9iamVjdC5hc3NpZ24oe30sIHApKV07XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb21wUmVmLmluc3RhbmNlLnBhcmFtZXRlcnMgPSBuZXcgQXJyYXkoKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBtb2RhbENvbmZpZyA9IHtcclxuICAgICAgdGl0bGU6ICflj4LmlbDorr7nva4nLFxyXG4gICAgICB3aWR0aDogNjIwLFxyXG4gICAgICBoZWlnaHQ6IDQwMCxcclxuICAgICAgc2hvd0J1dHRvbnM6IHRydWUsXHJcbiAgICAgIGJ1dHRvbnM6IGNvbXBSZWYuaW5zdGFuY2UubW9kYWxGb290ZXJcclxuICAgIH07XHJcbiAgICBjb25zdCBkaWFsb2cgPSB0aGlzLm1vZGFsU2VydmljZS5zaG93KGNvbXBSZWYsIG1vZGFsQ29uZmlnKTtcclxuXHJcbiAgICBjb21wUmVmLmluc3RhbmNlLnN1Ym1pdC5zdWJzY3JpYmUocmUgPT4ge1xyXG4gICAgICBmb3IgKGNvbnN0IG8gb2YgdGhpcy5vcGVyYXRpb25zKSB7XHJcbiAgICAgICAgaWYgKG8uaWQgPT09IGN0eC5yb3dEYXRhLmlkKSB7XHJcbiAgICAgICAgICBvLm1ldGhvZFBhcmFtZXRlcnMgPSByZS5wYXJhbWV0ZXJzO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBkaWFsb2cuY2xvc2UoKTtcclxuICAgIH0pO1xyXG4gICAgY29tcFJlZi5pbnN0YW5jZS5jYW5jZWwuc3Vic2NyaWJlKHJlID0+IHtcclxuICAgICAgZGlhbG9nLmNsb3NlKCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIG1ldGhvZFNlbGVjdGVkKCkge1xyXG4gICAgaWYgKHRoaXMubWV0aG9kR3JpZC5zZWxlY3RlZFJvdykge1xyXG4gICAgICBjb25zdCBkYXRhID0gdGhpcy5tZXRob2RHcmlkLnNlbGVjdGVkUm93LmRhdGE7XHJcbiAgICAgIGlmICh0aGlzLnN0YXRlID09PSAnZWRpdCcpIHtcclxuICAgICAgICBpZiAodGhpcy5lKSB7XHJcbiAgICAgICAgICB0aGlzLmUuZm9ybUNvbnRyb2wuc2V0VmFsdWUoZGF0YS5tZXRob2QpO1xyXG4gICAgICAgICAgdGhpcy5lLmluc3RhbmNlLmNkLmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICAgIGZvciAoY29uc3QgbyBvZiB0aGlzLm9wZXJhdGlvbnMpIHtcclxuICAgICAgICAgICAgaWYgKG8uaWQgPT09IGRhdGEuaWQpIHtcclxuICAgICAgICAgICAgICBvLm1ldGhvZCA9IGRhdGEubWV0aG9kO1xyXG4gICAgICAgICAgICAgIG8uc29ydE9yZGVyID0gZGF0YS5zb3J0T3JkZXI7XHJcbiAgICAgICAgICAgICAgby5tZXRob2RQYXJhbWV0ZXJzID0gZGF0YS5tZXRob2RQYXJhbWV0ZXJzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnN0IG9wZXJhdGlvbiA9IG5ldyBGb3JtTWV0aG9kQ29uZmlnKCk7XHJcbiAgICAgICAgb3BlcmF0aW9uLmZvcm1Gb3JtYXRDb25maWdJZCA9IHRoaXMuZm9ybUZvcm1hdENvbmZpZ0lkO1xyXG4gICAgICAgIG9wZXJhdGlvbi5tZXRob2QgPSBkYXRhLm1ldGhvZDtcclxuICAgICAgICBvcGVyYXRpb24uc29ydE9yZGVyID0gZGF0YS5zb3J0T3JkZXI7XHJcbiAgICAgICAgb3BlcmF0aW9uLm1ldGhvZFBhcmFtZXRlcnMgPSBkYXRhLm1ldGhvZFBhcmFtZXRlcnM7XHJcbiAgICAgICAgdGhpcy5vcGVyYXRpb25zID0gdGhpcy5vcGVyYXRpb25zLmNvbmNhdChbb3BlcmF0aW9uXSk7XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5tZXRob2RzRGlhbG9nLmNsb3NlKCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLm1lc3NhZ2UuaW5mbygn5bCa5pyq6YCJ5Lit6KGo5Y2V5pON5L2c77yBJyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICB2YWxpZGF0b3IoKTogYm9vbGVhbiB7XHJcbiAgICB0aGlzLmdyaWQuZW5kQ2VsbEVkaXQoKTtcclxuICAgIGZvciAoY29uc3QgbyBvZiB0aGlzLm9wZXJhdGlvbnMpIHtcclxuICAgICAgaWYgKCFvLm1ldGhvZCkge1xyXG4gICAgICAgIHRoaXMubWVzc2FnZS5pbmZvKCflsJrmnKrpgInmi6nooajljZXmk43kvZzvvIEnKTtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiB0cnVlO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXRGb3JtTWV0aG9kcygpIHtcclxuICAgIGlmICh0aGlzLmZvcm1Gb3JtYXRJZCkge1xyXG4gICAgICBjb25zdCB1cmwgPSBgL2FwaS9ydW50aW1lL3dmL3YxLjAvZm9ybU9wZXJhdGlvbj9mb3JtRm9ybWF0SWQ9JHt0aGlzLmZvcm1Gb3JtYXRJZH1gO1xyXG4gICAgICB0aGlzLmh0dHAuZ2V0KHVybCkuc3Vic2NyaWJlKChyZTogYW55KSA9PiB7XHJcbiAgICAgICAgaWYgKHJlKSB7XHJcbiAgICAgICAgICB0aGlzLmZvcm1NZXRob2RzID0gcmU7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG59XHJcbiJdfQ==