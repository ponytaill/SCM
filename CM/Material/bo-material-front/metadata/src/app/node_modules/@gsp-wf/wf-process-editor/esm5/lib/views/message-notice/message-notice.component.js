/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, HostBinding, EventEmitter, Output, Input, ViewChild, TemplateRef, ComponentFactoryResolver, Injector } from '@angular/core';
import { activitySendTime, MessageNotice, processSendTime } from './message-notice';
import { BsModalService } from '@farris/ui-modal';
import { MessagerService } from '@farris/ui-messager';
import { MessageNoticeEditComponent } from './message-notice-edit/message-notice-edit.component';
import { DatagridComponent } from '@farris/ui-datagrid';
import { ProcessDeUtil } from '../../domain/process-de-util';
import { ProcessDesignerUIState } from '../../app/process-designer.uistate';
var MessageNoticeComponent = /** @class */ (function () {
    function MessageNoticeComponent(resolver, injector, modalService, message, uistate) {
        this.resolver = resolver;
        this.injector = injector;
        this.modalService = modalService;
        this.message = message;
        this.uistate = uistate;
        this.cls = 'farris-main-area flex-column';
        this.closeModal = new EventEmitter();
        this.submitModal = new EventEmitter();
        this.editorParams = {};
        this.modalConfig = {
            title: '消息通知',
            width: 800,
            height: 515,
            showButtons: true
        };
        this.messageNotices = new Array();
        this.columns = [];
        this.location = 'activity';
    }
    Object.defineProperty(MessageNoticeComponent.prototype, "value", {
        set: /**
         * @param {?} notices
         * @return {?}
         */
        function (notices) {
            if (notices && notices.length > 0) {
                this.messageNotices = notices.map((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return ({
                    id: ProcessDeUtil.GenerateElementId(),
                    content: n.content,
                    sendTime: n.sendTime,
                    sendType: n.sendType,
                    subject: n.subject,
                    receiver: n.receiver,
                    receiverText: n.receiverText
                }); }));
            }
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    MessageNoticeComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.location = this.editorParams.location;
        this.columns = [
            {
                field: 'subject', width: 100, title: '消息主题',
            }, {
                field: 'content', width: 150, title: '消息内容', showTips: true,
            }, {
                field: 'sendTime', width: 100, title: '发送时机',
                formatter: {
                    type: 'enum',
                    options: { valueField: 'value', textField: 'text', data: this.location === 'process' ? processSendTime : activitySendTime }
                },
            }, {
                field: 'sendType', width: 100, title: '发送方式',
                formatter: {
                    type: 'enum',
                    options: { valueField: 'value', textField: 'name', data: this.uistate.messageChannels.map((/**
                         * @param {?} m
                         * @return {?}
                         */
                        function (m) { return ({ value: m.code, name: m.name }); })) }
                },
            }, {
                field: 'receiverText', width: 120, title: '消息接收人', showTips: true
            }
        ];
        if (this.location === 'messageActivity') {
            this.columns = this.columns.filter((/**
             * @param {?} c
             * @return {?}
             */
            function (c) { return c.field !== 'sendTime'; }));
        }
    };
    /**
     * @return {?}
     */
    MessageNoticeComponent.prototype.add = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var dialog;
        /** @type {?} */
        var compFactory = this.resolver.resolveComponentFactory(MessageNoticeEditComponent);
        /** @type {?} */
        var compRef = compFactory.create(this.injector);
        compRef.instance.location = this.location;
        /** @type {?} */
        var messageNotice = new MessageNotice();
        if (this.location === 'activity') {
            messageNotice.sendTime = 'WORKITEM_CREATED';
            messageNotice.receiver = 'workItemParticipant';
            messageNotice.receiverText = '任务办理人';
        }
        else if (this.location === 'process') {
            messageNotice.sendTime = 'PROCESSINSTANCE_COMPLETED';
            messageNotice.receiver = 'procInstCreator';
            messageNotice.receiverText = '流程发起人';
        }
        else if (this.location === 'messageActivity') {
            messageNotice.receiver = 'procInstCreator';
            messageNotice.receiverText = '流程发起人';
        }
        compRef.instance.value = messageNotice;
        compRef.instance.submitEmitter.subscribe((/**
         * @param {?} re
         * @return {?}
         */
        function (re) {
            _this.messageNotices = _this.messageNotices.concat([re]);
            dialog.close();
        }));
        compRef.instance.closeEmitter.subscribe((/**
         * @param {?} re
         * @return {?}
         */
        function (re) {
            dialog.close();
        }));
        /** @type {?} */
        var modalConfig = {
            title: '消息通知',
            width: 490,
            height: this.location === 'messageActivity' ? 450 : 490,
            showButtons: true,
            buttons: compRef.instance.footer
        };
        dialog = this.modalService.show(compRef, modalConfig);
    };
    /**
     * @return {?}
     */
    MessageNoticeComponent.prototype.edit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (!this.grid.selectedRow) {
            this.message.info('尚未选中消息通知！');
            return;
        }
        /** @type {?} */
        var dialog;
        /** @type {?} */
        var compFactory = this.resolver.resolveComponentFactory(MessageNoticeEditComponent);
        /** @type {?} */
        var compRef = compFactory.create(this.injector);
        compRef.instance.location = this.location;
        compRef.instance.value = this.grid.selectedRow.data;
        compRef.instance.submitEmitter.subscribe((/**
         * @param {?} re
         * @return {?}
         */
        function (re) {
            _this.messageNotices = _this.messageNotices.map((/**
             * @param {?} m
             * @return {?}
             */
            function (m) {
                if (m.id === re.id) {
                    return re;
                }
                return m;
            }));
            dialog.close();
        }));
        compRef.instance.closeEmitter.subscribe((/**
         * @param {?} re
         * @return {?}
         */
        function (re) {
            dialog.close();
        }));
        /** @type {?} */
        var modalConfig = {
            title: '消息通知',
            width: 490,
            height: this.location === 'messageActivity' ? 450 : 490,
            showButtons: true,
            buttons: compRef.instance.footer
        };
        dialog = this.modalService.show(compRef, modalConfig);
    };
    /**
     * @return {?}
     */
    MessageNoticeComponent.prototype.delete = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var selected = this.grid.selectedRow;
        if (!selected) {
            this.message.info('尚未选中消息通知！');
            return;
        }
        this.messageNotices = this.messageNotices.filter((/**
         * @param {?} m
         * @return {?}
         */
        function (m) { return m.id !== selected.id; }));
    };
    /**
     * @return {?}
     */
    MessageNoticeComponent.prototype.clickOK = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var object = { value: this.messageNotices, parameters: null };
        this.submitModal.emit(object);
    };
    /**
     * @return {?}
     */
    MessageNoticeComponent.prototype.clickCancel = /**
     * @return {?}
     */
    function () {
        this.closeModal.emit();
    };
    MessageNoticeComponent.decorators = [
        { type: Component, args: [{
                    selector: 'lib-message-notice',
                    template: "<div class=\"f-page\">\r\n  <div class=\"f-page-header\">\r\n    <nav class=\"f-page-header-base\">\r\n      <div class=\"f-title\">\r\n        <span class=\"f-title-icon f-text-orna-bill\">\r\n          <i class=\"f-icon f-icon-page-title-administer\"></i>\r\n        </span>\r\n        <h4 class=\"f-title-text\">\u5217\u8868</h4>\r\n      </div>\r\n      <div class=\"btn-toolbar btn-group-lg\">\r\n        <button class=\"btn btn-primary mr-2\" (click)=\"add()\">\u65B0\u589E</button>\r\n        <button class=\"btn btn-secondary mr-2\" (click)=\"edit()\">\u7F16\u8F91</button>\r\n        <button class=\"btn btn-secondary\" (click)=\"delete()\">\u5220\u9664</button>\r\n      </div>\r\n    </nav>\r\n  </div>\r\n  <div class=\"f-page-main f-utils-fill-flex-column h-100\">\r\n    <div class=\"f-utils-fill-flex-column farris-overflow-y-auto h-100\">\r\n      <farris-datagrid #grid [data]=\"messageNotices\" [columns]=\"columns\" [idField]=\"'id'\" [fit]=\"true\"\r\n        [fitColumns]=\"true\" [editable]=\"false\" [pagination]=\"false\" [showCheckbox]=\"false\"\r\n        [multiSelect]=\"false\" [showLineNumber]=\"true\" [lineNumberTitle]=\"'\u5E8F\u53F7'\" [lineNumberWidth]=\"50\" \r\n        [striped]=\"true\">\r\n      </farris-datagrid>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<ng-template #iconSelectFooter>\r\n  <button type=\"button\" class=\"btn btn-primary btn-sm px-3 mx-2\" (click)=\"clickOK()\">\u786E\u5B9A</button>\r\n  <button type=\"button\" class=\"btn btn-secondary btn-sm px-3 mx-2\" (click)=\"clickCancel()\">\u53D6\u6D88</button>\r\n</ng-template>\r\n",
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    MessageNoticeComponent.ctorParameters = function () { return [
        { type: ComponentFactoryResolver },
        { type: Injector },
        { type: BsModalService },
        { type: MessagerService },
        { type: ProcessDesignerUIState }
    ]; };
    MessageNoticeComponent.propDecorators = {
        cls: [{ type: HostBinding, args: ['class',] }],
        closeModal: [{ type: Output }],
        submitModal: [{ type: Output }],
        value: [{ type: Input }],
        editorParams: [{ type: Input }],
        modalFooter: [{ type: ViewChild, args: ['iconSelectFooter',] }],
        grid: [{ type: ViewChild, args: ['grid',] }]
    };
    return MessageNoticeComponent;
}());
export { MessageNoticeComponent };
if (false) {
    /** @type {?} */
    MessageNoticeComponent.prototype.cls;
    /** @type {?} */
    MessageNoticeComponent.prototype.closeModal;
    /** @type {?} */
    MessageNoticeComponent.prototype.submitModal;
    /** @type {?} */
    MessageNoticeComponent.prototype.editorParams;
    /** @type {?} */
    MessageNoticeComponent.prototype.modalFooter;
    /** @type {?} */
    MessageNoticeComponent.prototype.grid;
    /** @type {?} */
    MessageNoticeComponent.prototype.modalConfig;
    /** @type {?} */
    MessageNoticeComponent.prototype.messageNotices;
    /** @type {?} */
    MessageNoticeComponent.prototype.columns;
    /** @type {?} */
    MessageNoticeComponent.prototype.location;
    /**
     * @type {?}
     * @private
     */
    MessageNoticeComponent.prototype.resolver;
    /**
     * @type {?}
     * @private
     */
    MessageNoticeComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    MessageNoticeComponent.prototype.modalService;
    /**
     * @type {?}
     * @private
     */
    MessageNoticeComponent.prototype.message;
    /**
     * @type {?}
     * @private
     */
    MessageNoticeComponent.prototype.uistate;
}
var MessageNoticeConverter = /** @class */ (function () {
    function MessageNoticeConverter() {
    }
    /**
     * @param {?} data
     * @return {?}
     */
    MessageNoticeConverter.prototype.convertTo = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        if (data && data.length > 0) {
            return '（已设置）';
        }
        else {
            return '（未设置）';
        }
    };
    return MessageNoticeConverter;
}());
export { MessageNoticeConverter };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWVzc2FnZS1ub3RpY2UuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdzcC13Zi93Zi1wcm9jZXNzLWVkaXRvci8iLCJzb3VyY2VzIjpbImxpYi92aWV3cy9tZXNzYWdlLW5vdGljZS9tZXNzYWdlLW5vdGljZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsV0FBVyxFQUFFLFlBQVksRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxXQUFXLEVBQUUsd0JBQXdCLEVBQUUsUUFBUSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRXhKLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxhQUFhLEVBQWEsZUFBZSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDL0YsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN0RCxPQUFPLEVBQUUsMEJBQTBCLEVBQUUsTUFBTSxxREFBcUQsQ0FBQztBQUNqRyxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN4RCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFDN0QsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sb0NBQW9DLENBQUM7QUFFNUU7SUEwQ0UsZ0NBQ1UsUUFBa0MsRUFDbEMsUUFBa0IsRUFDbEIsWUFBNEIsRUFDNUIsT0FBd0IsRUFDeEIsT0FBK0I7UUFKL0IsYUFBUSxHQUFSLFFBQVEsQ0FBMEI7UUFDbEMsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUNsQixpQkFBWSxHQUFaLFlBQVksQ0FBZ0I7UUFDNUIsWUFBTyxHQUFQLE9BQU8sQ0FBaUI7UUFDeEIsWUFBTyxHQUFQLE9BQU8sQ0FBd0I7UUF4Q3pDLFFBQUcsR0FBRyw4QkFBOEIsQ0FBQztRQUUzQixlQUFVLEdBQUcsSUFBSSxZ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QVM7Ozs7SUFBVCxVQUFVLElBQVc7UUFDbkIsSUFBSSxJQUFJLElBQUksSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDM0IsT0FBTyxPQUFPLENBQUM7U0FDaEI7YUFBTTtZQUNMLE9BQU8sT0FBTyxDQUFDO1NBQ2hCO0lBQ0gsQ0FBQztJQUNILDZCQUFDO0FBQUQsQ0FBQyxBQVZELElBVUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgSG9zdEJpbmRpbmcsIEV2ZW50RW1pdHRlciwgT3V0cHV0LCBJbnB1dCwgVmlld0NoaWxkLCBUZW1wbGF0ZVJlZiwgQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLCBJbmplY3RvciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBUeXBlQ29udmVydGVyIH0gZnJvbSAnQGZhcnJpcy91aS1wcm9wZXJ0eS1wYW5lbCc7XHJcbmltcG9ydCB7IGFjdGl2aXR5U2VuZFRpbWUsIE1lc3NhZ2VOb3RpY2UsIHNlbmRUeXBlcywgcHJvY2Vzc1NlbmRUaW1lIH0gZnJvbSAnLi9tZXNzYWdlLW5vdGljZSc7XHJcbmltcG9ydCB7IEJzTW9kYWxTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1tb2RhbCc7XHJcbmltcG9ydCB7IE1lc3NhZ2VyU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbWVzc2FnZXInO1xyXG5pbXBvcnQgeyBNZXNzYWdlTm90aWNlRWRpdENvbXBvbmVudCB9IGZyb20gJy4vbWVzc2FnZS1ub3RpY2UtZWRpdC9tZXNzYWdlLW5vdGljZS1lZGl0LmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IERhdGFncmlkQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1kYXRhZ3JpZCc7XHJcbmltcG9ydCB7IFByb2Nlc3NEZVV0aWwgfSBmcm9tICcuLi8uLi9kb21haW4vcHJvY2Vzcy1kZS11dGlsJztcclxuaW1wb3J0IHsgUHJvY2Vzc0Rlc2lnbmVyVUlTdGF0ZSB9IGZyb20gJy4uLy4uL2FwcC9wcm9jZXNzLWRlc2lnbmVyLnVpc3RhdGUnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdsaWItbWVzc2FnZS1ub3RpY2UnLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9tZXNzYWdlLW5vdGljZS5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vbWVzc2FnZS1ub3RpY2UuY29tcG9uZW50LnNjc3MnXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgTWVzc2FnZU5vdGljZUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XHJcbiAgQEhvc3RCaW5kaW5nKCdjbGFzcycpXHJcbiAgY2xzID0gJ2ZhcnJpcy1tYWluLWFyZWEgZmxleC1jb2x1bW4nO1xyXG5cclxuICBAT3V0cHV0KCkgY2xvc2VNb2RhbCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG4gIEBPdXRwdXQoKSBzdWJtaXRNb2RhbCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG5cclxuICBASW5wdXQoKVxyXG4gIHNldCB2YWx1ZShub3RpY2VzOiBhbnlbXSkge1xyXG4gICAgaWYgKG5vdGljZXMgJiYgbm90aWNlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgIHRoaXMubWVzc2FnZU5vdGljZXMgPSBub3RpY2VzLm1hcChuID0+ICh7XHJcbiAgICAgICAgaWQ6IFByb2Nlc3NEZVV0aWwuR2VuZXJhdGVFbGVtZW50SWQoKSxcclxuICAgICAgICBjb250ZW50OiBuLmNvbnRlbnQsXHJcbiAgICAgICAgc2VuZFRpbWU6IG4uc2VuZFRpbWUsXHJcbiAgICAgICAgc2VuZFR5cGU6IG4uc2VuZFR5cGUsXHJcbiAgICAgICAgc3ViamVjdDogbi5zdWJqZWN0LFxyXG4gICAgICAgIHJlY2VpdmVyOiBuLnJlY2VpdmVyLFxyXG4gICAgICAgIHJlY2VpdmVyVGV4dDogbi5yZWNlaXZlclRleHRcclxuICAgICAgfSkpO1xyXG4gICAgfVxyXG4gIH1cclxuICBASW5wdXQoKSBlZGl0b3JQYXJhbXM6IGFueSA9IHt9O1xyXG4gIEBWaWV3Q2hpbGQoJ2ljb25TZWxlY3RGb290ZXInKSBtb2RhbEZvb3RlcjogVGVtcGxhdGVSZWY8YW55PjtcclxuICBAVmlld0NoaWxkKCdncmlkJykgZ3JpZDogRGF0YWdyaWRDb21wb25lbnQ7XHJcblxyXG4gIG1vZGFsQ29uZmlnID0ge1xyXG4gICAgdGl0bGU6ICfmtojmga/pgJrnn6UnLFxyXG4gICAgd2lkdGg6IDgwMCxcclxuICAgIGhlaWdodDogNTE1LFxyXG4gICAgc2hvd0J1dHRvbnM6IHRydWVcclxuICB9O1xyXG5cclxuICBtZXNzYWdlTm90aWNlczogQXJyYXk8TWVzc2FnZU5vdGljZT4gPSBuZXcgQXJyYXkoKTtcclxuICBjb2x1bW5zID0gW107XHJcblxyXG4gIGxvY2F0aW9uOiAnYWN0aXZpdHknIHwgJ3Byb2Nlc3MnIHwgJ21lc3NhZ2VBY3Rpdml0eScgPSAnYWN0aXZpdHknO1xyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgcmVzb2x2ZXI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcclxuICAgIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yLFxyXG4gICAgcHJpdmF0ZSBtb2RhbFNlcnZpY2U6IEJzTW9kYWxTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBtZXNzYWdlOiBNZXNzYWdlclNlcnZpY2UsXHJcbiAgICBwcml2YXRlIHVpc3RhdGU6IFByb2Nlc3NEZXNpZ25lclVJU3RhdGVcclxuICApIHsgfVxyXG5cclxuICBuZ09uSW5pdCgpIHtcclxuICAgIHRoaXMubG9jYXRpb24gPSB0aGlzLmVkaXRvclBhcmFtcy5sb2NhdGlvbjtcclxuICAgIHRoaXMuY29sdW1ucyA9IFtcclxuICAgICAge1xyXG4gICAgICAgIGZpZWxkOiAnc3ViamVjdCcsIHdpZHRoOiAxMDAsIHRpdGxlOiAn5raI5oGv5Li76aKYJyxcclxuICAgICAgfSwge1xyXG4gICAgICAgIGZpZWxkOiAnY29udGVudCcsIHdpZHRoOiAxNTAsIHRpdGxlOiAn5raI5oGv5YaF5a65Jywgc2hvd1RpcHM6IHRydWUsXHJcbiAgICAgIH0sIHtcclxuICAgICAgICBmaWVsZDogJ3NlbmRUaW1lJywgd2lkdGg6IDEwMCwgdGl0bGU6ICflj5HpgIHml7bmnLonLFxyXG4gICAgICAgIGZvcm1hdHRlcjoge1xyXG4gICAgICAgICAgdHlwZTogJ2VudW0nLFxyXG4gICAgICAgICAgb3B0aW9uczogeyB2YWx1ZUZpZWxkOiAndmFsdWUnLCB0ZXh0RmllbGQ6ICd0ZXh0JywgZGF0YTogdGhpcy5sb2NhdGlvbiA9PT0gJ3Byb2Nlc3MnID8gcHJvY2Vzc1NlbmRUaW1lIDogYWN0aXZpdHlTZW5kVGltZSB9XHJcbiAgICAgICAgfSxcclxuICAgICAgfSwge1xyXG4gICAgICAgIGZpZWxkOiAnc2VuZFR5cGUnLCB3aWR0aDogMTAwLCB0aXRsZTogJ+WPkemAgeaWueW8jycsXHJcbiAgICAgICAgZm9ybWF0dGVyOiB7XHJcbiAgICAgICAgICB0eXBlOiAnZW51bScsXHJcbiAgICAgICAgICBvcHRpb25zOiB7IHZhbHVlRmllbGQ6ICd2YWx1ZScsIHRleHRGaWVsZDogJ25hbWUnLCBkYXRhOiB0aGlzLnVpc3RhdGUubWVzc2FnZUNoYW5uZWxzLm1hcChtID0+ICh7IHZhbHVlOiBtLmNvZGUsIG5hbWU6IG0ubmFtZSB9KSkgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgIH0sIHtcclxuICAgICAgICBmaWVsZDogJ3JlY2VpdmVyVGV4dCcsIHdpZHRoOiAxMjAsIHRpdGxlOiAn5raI5oGv5o6l5pS25Lq6Jywgc2hvd1RpcHM6IHRydWVcclxuICAgICAgfV07XHJcbiAgICBpZiAodGhpcy5sb2NhdGlvbiA9PT0gJ21lc3NhZ2VBY3Rpdml0eScpIHtcclxuICAgICAgdGhpcy5jb2x1bW5zID0gdGhpcy5jb2x1bW5zLmZpbHRlcihjID0+IGMuZmllbGQgIT09ICdzZW5kVGltZScpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgYWRkKCkge1xyXG4gICAgbGV0IGRpYWxvZzogYW55O1xyXG4gICAgY29uc3QgY29tcEZhY3RvcnkgPSB0aGlzLnJlc29sdmVyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KE1lc3NhZ2VOb3RpY2VFZGl0Q29tcG9uZW50KTtcclxuICAgIGNvbnN0IGNvbXBSZWYgPSBjb21wRmFjdG9yeS5jcmVhdGUodGhpcy5pbmplY3Rvcik7XHJcbiAgICBjb21wUmVmLmluc3RhbmNlLmxvY2F0aW9uID0gdGhpcy5sb2NhdGlvbjtcclxuICAgIGNvbnN0IG1lc3NhZ2VOb3RpY2UgPSBuZXcgTWVzc2FnZU5vdGljZSgpO1xyXG4gICAgaWYgKHRoaXMubG9jYXRpb24gPT09ICdhY3Rpdml0eScpIHtcclxuICAgICAgbWVzc2FnZU5vdGljZS5zZW5kVGltZSA9ICdXT1JLSVRFTV9DUkVBVEVEJztcclxuICAgICAgbWVzc2FnZU5vdGljZS5yZWNlaXZlciA9ICd3b3JrSXRlbVBhcnRpY2lwYW50JztcclxuICAgICAgbWVzc2FnZU5vdGljZS5yZWNlaXZlclRleHQgPSAn5Lu75Yqh5Yqe55CG5Lq6JztcclxuICAgIH0gZWxzZSBpZiAodGhpcy5sb2NhdGlvbiA9PT0gJ3Byb2Nlc3MnKSB7XHJcbiAgICAgIG1lc3NhZ2VOb3RpY2Uuc2VuZFRpbWUgPSAnUFJPQ0VTU0lOU1RBTkNFX0NPTVBMRVRFRCc7XHJcbiAgICAgIG1lc3NhZ2VOb3RpY2UucmVjZWl2ZXIgPSAncHJvY0luc3RDcmVhdG9yJztcclxuICAgICAgbWVzc2FnZU5vdGljZS5yZWNlaXZlclRleHQgPSAn5rWB56iL5Y+R6LW35Lq6JztcclxuICAgIH0gZWxzZSBpZiAodGhpcy5sb2NhdGlvbiA9PT0gJ21lc3NhZ2VBY3Rpdml0eScpIHtcclxuICAgICAgbWVzc2FnZU5vdGljZS5yZWNlaXZlciA9ICdwcm9jSW5zdENyZWF0b3InO1xyXG4gICAgICBtZXNzYWdlTm90aWNlLnJlY2VpdmVyVGV4dCA9ICfmtYHnqIvlj5HotbfkuronO1xyXG4gICAgfVxyXG4gICAgY29tcFJlZi5pbnN0YW5jZS52YWx1ZSA9IG1lc3NhZ2VOb3RpY2U7XHJcbiAgICBjb21wUmVmLmluc3RhbmNlLnN1Ym1pdEVtaXR0ZXIuc3Vic2NyaWJlKChyZTogTWVzc2FnZU5vdGljZSkgPT4ge1xyXG4gICAgICB0aGlzLm1lc3NhZ2VOb3RpY2VzID0gdGhpcy5tZXNzYWdlTm90aWNlcy5jb25jYXQoW3JlXSk7XHJcbiAgICAgIGRpYWxvZy5jbG9zZSgpO1xyXG4gICAgfSk7XHJcbiAgICBjb21wUmVmLmluc3RhbmNlLmNsb3NlRW1pdHRlci5zdWJzY3JpYmUocmUgPT4ge1xyXG4gICAgICBkaWFsb2cuY2xvc2UoKTtcclxuICAgIH0pO1xyXG4gICAgY29uc3QgbW9kYWxDb25maWcgPSB7XHJcbiAgICAgIHRpdGxlOiAn5raI5oGv6YCa55+lJyxcclxuICAgICAgd2lkdGg6IDQ5MCxcclxuICAgICAgaGVpZ2h0OiB0aGlzLmxvY2F0aW9uID09PSAnbWVzc2FnZUFjdGl2aXR5JyA/IDQ1MCA6IDQ5MCxcclxuICAgICAgc2hvd0J1dHRvbnM6IHRydWUsXHJcbiAgICAgIGJ1dHRvbnM6IGNvbXBSZWYuaW5zdGFuY2UuZm9vdGVyXHJcbiAgICB9O1xyXG4gICAgZGlhbG9nID0gdGhpcy5tb2RhbFNlcnZpY2Uuc2hvdyhjb21wUmVmLCBtb2RhbENvbmZpZyk7XHJcbiAgfVxyXG4gIGVkaXQoKSB7XHJcbiAgICBpZiAoIXRoaXMuZ3JpZC5zZWxlY3RlZFJvdykge1xyXG4gICAgICB0aGlzLm1lc3NhZ2UuaW5mbygn5bCa5pyq6YCJ5Lit5raI5oGv6YCa55+l77yBJyk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGxldCBkaWFsb2c6IGFueTtcclxuICAgIGNvbnN0IGNvbXBGYWN0b3J5ID0gdGhpcy5yZXNvbHZlci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShNZXNzYWdlTm90aWNlRWRpdENvbXBvbmVudCk7XHJcbiAgICBjb25zdCBjb21wUmVmID0gY29tcEZhY3RvcnkuY3JlYXRlKHRoaXMuaW5qZWN0b3IpO1xyXG4gICAgY29tcFJlZi5pbnN0YW5jZS5sb2NhdGlvbiA9IHRoaXMubG9jYXRpb247XHJcbiAgICBjb21wUmVmLmluc3RhbmNlLnZhbHVlID0gdGhpcy5ncmlkLnNlbGVjdGVkUm93LmRhdGE7XHJcbiAgICBjb21wUmVmLmluc3RhbmNlLnN1Ym1pdEVtaXR0ZXIuc3Vic2NyaWJlKChyZTogTWVzc2FnZU5vdGljZSkgPT4ge1xyXG4gICAgICB0aGlzLm1lc3NhZ2VOb3RpY2VzID0gdGhpcy5tZXNzYWdlTm90aWNlcy5tYXAobSA9PiB7XHJcbiAgICAgICAgaWYgKG0uaWQgPT09IHJlLmlkKSB7XHJcbiAgICAgICAgICByZXR1cm4gcmU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBtO1xyXG4gICAgICB9KTtcclxuICAgICAgZGlhbG9nLmNsb3NlKCk7XHJcbiAgICB9KTtcclxuICAgIGNvbXBSZWYuaW5zdGFuY2UuY2xvc2VFbWl0dGVyLnN1YnNjcmliZShyZSA9PiB7XHJcbiAgICAgIGRpYWxvZy5jbG9zZSgpO1xyXG4gICAgfSk7XHJcbiAgICBjb25zdCBtb2RhbENvbmZpZyA9IHtcclxuICAgICAgdGl0bGU6ICfmtojmga/pgJrnn6UnLFxyXG4gICAgICB3aWR0aDogNDkwLFxyXG4gICAgICBoZWlnaHQ6IHRoaXMubG9jYXRpb24gPT09ICdtZXNzYWdlQWN0aXZpdHknID8gNDUwIDogNDkwLFxyXG4gICAgICBzaG93QnV0dG9uczogdHJ1ZSxcclxuICAgICAgYnV0dG9uczogY29tcFJlZi5pbnN0YW5jZS5mb290ZXJcclxuICAgIH07XHJcbiAgICBkaWFsb2cgPSB0aGlzLm1vZGFsU2VydmljZS5zaG93KGNvbXBSZWYsIG1vZGFsQ29uZmlnKTtcclxuICB9XHJcbiAgZGVsZXRlKCkge1xyXG4gICAgY29uc3Qgc2VsZWN0ZWQgPSB0aGlzLmdyaWQuc2VsZWN0ZWRSb3c7XHJcbiAgICBpZiAoIXNlbGVjdGVkKSB7XHJcbiAgICAgIHRoaXMubWVzc2FnZS5pbmZvKCflsJrmnKrpgInkuK3mtojmga/pgJrnn6XvvIEnKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy5tZXNzYWdlTm90aWNlcyA9IHRoaXMubWVzc2FnZU5vdGljZXMuZmlsdGVyKG0gPT4gbS5pZCAhPT0gc2VsZWN0ZWQuaWQpO1xyXG4gIH1cclxuICBjbGlja09LKCkge1xyXG4gICAgY29uc3Qgb2JqZWN0ID0geyB2YWx1ZTogdGhpcy5tZXNzYWdlTm90aWNlcywgcGFyYW1ldGVyczogbnVsbCB9O1xyXG4gICAgdGhpcy5zdWJtaXRNb2RhbC5lbWl0KG9iamVjdCk7XHJcbiAgfVxyXG4gIGNsaWNrQ2FuY2VsKCkge1xyXG4gICAgdGhpcy5jbG9zZU1vZGFsLmVtaXQoKTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBNZXNzYWdlTm90aWNlQ29udmVydGVyIGltcGxlbWVudHMgVHlwZUNvbnZlcnRlciB7XHJcbiAgY29uc3RydWN0b3IoKSB7IH1cclxuXHJcbiAgY29udmVydFRvKGRhdGE6IGFueVtdKTogc3RyaW5nIHtcclxuICAgIGlmIChkYXRhICYmIGRhdGEubGVuZ3RoID4gMCkge1xyXG4gICAgICByZXR1cm4gJ++8iOW3suiuvue9ru+8iSc7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gJ++8iOacquiuvue9ru+8iSc7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcbiJdfQ==