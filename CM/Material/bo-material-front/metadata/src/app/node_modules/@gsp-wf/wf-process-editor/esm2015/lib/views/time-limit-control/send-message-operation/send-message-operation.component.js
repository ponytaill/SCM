/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Injector, ViewChild, TemplateRef, Input, Output, EventEmitter } from '@angular/core';
import { SendMessage } from '../time-limit-control.entity';
import { MessagerService } from '@farris/ui-messager';
import { ProcessDesignerUIState } from '../../../app/process-designer.uistate';
export class SendMessageOperationComponent {
    /**
     * @param {?} injector
     * @param {?} message
     * @param {?} uistate
     */
    constructor(injector, message, uistate) {
        this.injector = injector;
        this.message = message;
        this.uistate = uistate;
        // operation: ExpireOperation = new ExpireOperation();
        this.operation = new SendMessage('activity');
        this.closeEmitter = new EventEmitter();
        this.submitEmitter = new EventEmitter();
        this.typeGroup = this.uistate.messageChannels.map((/**
         * @param {?} m
         * @return {?}
         */
        m => ({ value: m.code, name: m.name })));
        this.receiverVariables = [
            { value: 'procInstCreator', name: '流程发起人' }
        ];
        this.activityReceiverVariables = [
            { value: 'workItemParticipant', name: '当前节点办理人' },
            { value: 'procInstCreator', name: '流程发起人' },
            { value: 'preActExecutors', name: '上一节点办理人' }
        ];
        this.placeholder = '';
        this.placeholder2 = '';
        this.parser = (/**
         * @param {?} val
         * @return {?}
         */
        (val) => {
            // console.log(val);
            return Number(val);
        });
        this.timeUnitCollection = [
            { value: 'day', text: '天' },
            { value: 'hour', text: '时' },
            { value: 'minute', text: '分' }
        ];
        this.location = 'activity';
        this.activityReceiverVar = '';
        this.bindingData = {};
    }
    /**
     * @param {?} info
     * @return {?}
     */
    set value(info) {
        this.operation = Object.assign({}, info);
        if (this.operation.sendType === undefined) {
            /** @type {?} */
            const sendMessage = new SendMessage(this.location);
            this.operation.cycleEnable = sendMessage.cycleEnable;
            this.operation.cycleTimeUnit = sendMessage.cycleTimeUnit;
            this.operation.receiver = sendMessage.receiver;
            this.operation.subject = sendMessage.subject;
            this.operation.message = sendMessage.message;
        }
        if (this.operation.receiver && this.operation.receiver.length > 0) {
            /** @type {?} */
            let array = this.operation.receiver.split(',');
            if (array.indexOf('workItemParticipant') > -1) {
                this.receiverVari = 'workItemParticipant';
                this.activityReceiverVar += 'workItemParticipant,';
            }
            if (array.indexOf('procInstCreator') > -1) {
                this.receiverVari = 'procInstCreator';
                this.activityReceiverVar += 'procInstCreator,';
            }
            if (array.indexOf('preActExecutors') > -1) {
                this.activityReceiverVar += 'preActExecutors,';
            }
            if (this.activityReceiverVar.length > 0) {
                this.activityReceiverVar = this.activityReceiverVar.substring(0, this.activityReceiverVar.length - 1);
            }
            if (array.length > 0) {
                array = array.filter((/**
                 * @param {?} a
                 * @return {?}
                 */
                a => a !== 'procInstCreator'));
                this.bindingData.id = '';
                for (const r of array) {
                    this.bindingData.id += r + ',';
                }
                if (this.bindingData.id) {
                    this.bindingData.id = this.bindingData.id.substring(0, this.bindingData.id.length - 1);
                }
            }
        }
        if (this.operation.receiverText && this.operation.receiverText.length > 0) {
            /** @type {?} */
            let array = this.operation.receiverText.split(',');
            if (array.length > 0) {
                array = array.filter((/**
                 * @param {?} a
                 * @return {?}
                 */
                a => a !== '流程发起人'));
                this.bindingData.name = '';
                for (const r of array) {
                    this.bindingData.name += r + ',';
                }
                if (this.bindingData.name) {
                    this.bindingData.name = this.bindingData.name.substring(0, this.bindingData.name.length - 1);
                }
            }
        }
    }
    /**
     * @return {?}
     */
    get value() {
        return this.operation;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
    }
    /**
     * @return {?}
     */
    clickOK() {
        this.operation.cycleTime += '';
        if (this.location === 'process') {
            this.setReceiver();
        }
        if (this.location === 'activity') {
            this.setActivityReceiver();
        }
        if (this.validator()) {
            this.submitEmitter.emit(this.operation);
        }
    }
    /**
     * @return {?}
     */
    clickCancel() {
        this.closeEmitter.emit();
    }
    /**
     * @return {?}
     */
    clear() {
        this.bindingData = {};
    }
    /**
     * @private
     * @return {?}
     */
    setReceiver() {
        /** @type {?} */
        let receiver = '';
        /** @type {?} */
        let receiverText = '';
        if (this.receiverVari) {
            receiver += this.receiverVari + ',';
            /** @type {?} */
            const array = this.receiverVari.split(',');
            if (array.length > 0) {
                for (const a of array) {
                    /** @type {?} */
                    const t = this.receiverVariables.find((/**
                     * @param {?} v
                     * @return {?}
                     */
                    v => v.value === a)).name;
                    receiverText += t + ',';
                }
            }
        }
        if (this.bindingData.id) {
            receiver += this.bindingData.id + ',';
            receiverText += this.bindingData.name + ',';
        }
        if (receiver) {
            receiver = receiver.substring(0, receiver.length - 1);
        }
        if (receiverText) {
            receiverText = receiverText.substring(0, receiverText.length - 1);
        }
        this.operation.receiver = receiver;
        this.operation.receiverText = receiverText;
    }
    /**
     * @return {?}
     */
    setActivityReceiver() {
        /** @type {?} */
        let receiver = '';
        if (this.activityReceiverVar) {
            receiver += this.activityReceiverVar + ',';
        }
        if (receiver) {
            receiver = receiver.substring(0, receiver.length - 1);
        }
        this.operation.receiver = receiver;
    }
    /**
     * @private
     * @return {?}
     */
    validator() {
        if (!this.operation.sendType) {
            this.message.info('发送方式不允许为空！');
            return false;
        }
        if (!this.operation.subject) {
            this.message.info('消息主题不允许为空！');
            return false;
        }
        if (!this.operation.message) {
            this.message.info('消息内容不允许为空！');
            return false;
        }
        if (!this.operation.receiver) {
            this.message.info('接收人不允许为空！');
            return false;
        }
        return true;
    }
}
SendMessageOperationComponent.decorators = [
    { type: Component, args: [{
                selector: 'lib-send-message-operation',
                template: "<div class=\"f-page\">\r\n  <div class=\"f-utils-fill-flex-column farris-split-section m-2 h-100\">\r\n    <section class=\"f-utils-fill-flex-column h-100\">\r\n      <div class=\"f-section-header pt-2 mx-2\">\r\n        <div class=\"f-title\">\r\n          <h4 class=\"f-title-text\">\u9884\u8B66\u6D88\u606F\u8BBE\u7F6E</h4>\r\n        </div>\r\n      </div>\r\n      <div class=\"f-utils-fill-flex-column h-100\">\r\n        <perfect-scrollbar [config]=\"{}\">\r\n          <form class=\"h-100\">\r\n            <div class=\"farris-form form-inline farris-form-inline\">\r\n              <div class=\"farris-form-controls-inline\">\r\n                <div class=\"farris-group-wrap\">\r\n                  <div class=\"form-group\">\r\n                    <label class=\"col-form-label pl-1 mr-3\">\r\n                      <span class=\"farris-label-text\">\u542F\u7528\u5FAA\u73AF\u9884\u8B66</span>\r\n                    </label>\r\n                    <div class=\"farris-input-wrap mr-5\">\r\n                      <farris-switch [(ngModel)]=\"operation.cycleEnable\" name=\"cycleEnable\"></farris-switch>\r\n                      <div class=\"farris-feedback valid-feedback\"></div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div class=\"farris-form-controls-inline\">\r\n                <div class=\"farris-group-wrap\">\r\n                  <div class=\"form-group\" style=\"width: 100%;\">\r\n                    <label class=\"col-form-label pl-1 mr-3\">\r\n                      <span class=\"farris-label-text\">\u5FAA\u73AF\u65F6\u95F4\u95F4\u9694</span>\r\n                    </label>\r\n                    <div class=\"farris-input-wrap mr-1\" style=\"width: 35%;\">\r\n                      <farris-number-spinner [(ngModel)]=\"operation.cycleTime\" name=\"cycleTime\"\r\n                                             [editable]=\"true\" [precision]=\"0\" [parser]=\"parser\"\r\n                                             [min]=\"0\"></farris-number-spinner>\r\n                      <div class=\"farris-feedback valid-feedback\"></div>\r\n                    </div>\r\n                    <div class=\"farris-input-wrap mr-5\" style=\"width: 30%;\">\r\n                      <farris-combo-list [(ngModel)]=\"operation.cycleTimeUnit\" name=\"cycleTimeUnit\" [idField]=\"'value'\" [textField]=\"'text'\"\r\n                                         [valueField]=\"'value'\" [data]=\"timeUnitCollection\" [panelHeight]=\"'auto'\"\r\n                                         [editable]=\"false\" [enableClear]=\"false\">\r\n                      </farris-combo-list>\r\n                      <div class=\"farris-feedback valid-feedback\"></div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div class=\"farris-group-wrap\">\r\n                <div class=\"form-group farris-form-group\">\r\n                  <label class=\"col-form-label\">\r\n                    <span class=\"farris-label-info text-danger\">*</span>\r\n                    <span class=\"farris-label-text\">\u53D1\u9001\u65B9\u5F0F</span>\r\n                  </label>\r\n                  <div class=\"farris-input-wrap ml-1\">\r\n                    <farris-checkboxgroup #checkboxGroup [(ngModel)]=\"operation.sendType\" name=\"sendType\" [horizontal]=\"true\"\r\n                      [data]=\"typeGroup\">\r\n                    </farris-checkboxgroup>\r\n                    <div class=\"farris-feedback valid-feedback\"></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div class=\"farris-group-wrap my-3\">\r\n                <div class=\"form-group farris-form-group\">\r\n                  <label class=\"col-form-label\">\r\n                    <span class=\"farris-label-info text-danger\">*</span>\r\n                    <span class=\"farris-label-text\">\u6D88\u606F\u4E3B\u9898</span>\r\n                  </label>\r\n                  <div class=\"farris-input-wrap ml-1\">\r\n                    <input class=\"form-control\" type=\"text\" value=\"subject\" [(ngModel)]=\"operation.subject\" name=\"subject\"\r\n                      [placeholder]=\"placeholder\" />\r\n                    <div class=\"farris-feedback valid-feedback\"></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div class=\"farris-group-wrap my-3\">\r\n                <div class=\"form-group farris-form-group\">\r\n                  <label class=\"col-form-label\">\r\n                    <span class=\"farris-label-info text-danger\">*</span>\r\n                    <span class=\"farris-label-text\">\u6D88\u606F\u5185\u5BB9</span>\r\n                  </label>\r\n                  <div class=\"farris-input-wrap ml-1\">\r\n                    <textarea class=\"form-control\" type=\"text\" value=\"message\" [(ngModel)]=\"operation.message\" name=\"message\"\r\n                      [placeholder]=\"placeholder2\" style=\"height: 100px;\"></textarea>\r\n                    <div class=\"farris-feedback valid-feedback\"></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div *ngIf=\"location==='process'\" class=\"farris-group-wrap\">\r\n                <div class=\"form-group farris-form-group\">\r\n                  <label class=\"col-form-label\">\r\n                    <span class=\"farris-label-info text-danger\">*</span>\r\n                    <span class=\"farris-label-text\">\u63A5\u6536\u4EBA</span>\r\n                  </label>\r\n                  <div class=\"farris-input-wrap ml-1\">\r\n                    <div class=\"pb-2\">\r\n                      <farris-checkboxgroup #receiverVariable [(ngModel)]=\"receiverVari\" name=\"receiverVariable\"\r\n                        [horizontal]=\"true\" [data]=\"receiverVariables\">\r\n                      </farris-checkboxgroup>\r\n                    </div>\r\n                    <div>\r\n                      <sys-farris-grid-lookup #userHelp [singleSelect]=\"false\" [displayTxt]=\"bindingData.name\" [pagination]=\"true\"\r\n                        [pageSize]=\"20\" [title]=\"'\u7CFB\u7EDF\u7528\u6237'\" [sourceType]=\"'user'\" [bindingData]=\"bindingData\"\r\n                        [filter]=\"{notGetCurrentUser:false, notGetStopUser:true}\" [typeMode]=\"1\" (clear)=\"clear()\">\r\n                      </sys-farris-grid-lookup>\r\n                    </div>\r\n                    <div class=\"farris-feedback valid-feedback\"></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div *ngIf=\"location==='activity'\" class=\"farris-group-wrap\">\r\n                <div class=\"form-group farris-form-group\">\r\n                  <label class=\"col-form-label\">\r\n                    <span class=\"farris-label-info text-danger\">*</span>\r\n                    <span class=\"farris-label-text\">\u63A5\u6536\u4EBA</span>\r\n                  </label>\r\n                  <div class=\"farris-input-wrap ml-1\">\r\n                    <div class=\"pb-2\">\r\n                      <farris-checkboxgroup #receiverVariable1 [(ngModel)]=\"activityReceiverVar\" name=\"ActivityReceiverVariable\"\r\n                                            [horizontal]=\"true\" [data]=\"activityReceiverVariables\">\r\n                      </farris-checkboxgroup>\r\n                    </div>\r\n                    <div class=\"farris-feedback valid-feedback\"></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </form>\r\n        </perfect-scrollbar>\r\n\r\n      </div>\r\n    </section>\r\n  </div>\r\n</div>\r\n\r\n<ng-template #footer>\r\n  <button type=\"button\" class=\"btn btn-primary btn-sm mx-2\" (click)=\"clickOK()\">\u786E\u5B9A</button>\r\n  <button type=\"button\" class=\"btn btn-secondary btn-sm mx-2\" (click)=\"clickCancel()\">\u53D6\u6D88</button>\r\n</ng-template>\r\n",
                styles: [""]
            }] }
];
/** @nocollapse */
SendMessageOperationComponent.ctorParameters = () => [
    { type: Injector },
    { type: MessagerService },
    { type: ProcessDesignerUIState }
];
SendMessageOperationComponent.propDecorators = {
    footer: [{ type: ViewChild, args: ['footer',] }],
    value: [{ type: Input }],
    closeEmitter: [{ type: Output }],
    submitEmitter: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    SendMessageOperationComponent.prototype.footer;
    /** @type {?} */
    SendMessageOperationComponent.prototype.operation;
    /** @type {?} */
    SendMessageOperationComponent.prototype.closeEmitter;
    /** @type {?} */
    SendMessageOperationComponent.prototype.submitEmitter;
    /** @type {?} */
    SendMessageOperationComponent.prototype.typeGroup;
    /** @type {?} */
    SendMessageOperationComponent.prototype.receiverVariables;
    /** @type {?} */
    SendMessageOperationComponent.prototype.activityReceiverVariables;
    /** @type {?} */
    SendMessageOperationComponent.prototype.placeholder;
    /** @type {?} */
    SendMessageOperationComponent.prototype.placeholder2;
    /** @type {?} */
    SendMessageOperationComponent.prototype.parser;
    /** @type {?} */
    SendMessageOperationComponent.prototype.timeUnitCollection;
    /** @type {?} */
    SendMessageOperationComponent.prototype.location;
    /** @type {?} */
    SendMessageOperationComponent.prototype.receiverVari;
    /** @type {?} */
    SendMessageOperationComponent.prototype.activityReceiverVar;
    /** @type {?} */
    SendMessageOperationComponent.prototype.bindingData;
    /**
     * @type {?}
     * @private
     */
    SendMessageOperationComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    SendMessageOperationComponent.prototype.message;
    /**
     * @type {?}
     * @private
     */
    SendMessageOperationComponent.prototype.uistate;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VuZC1tZXNzYWdlLW9wZXJhdGlvbi5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLXdmL3dmLXByb2Nlc3MtZWRpdG9yLyIsInNvdXJjZXMiOlsibGliL3ZpZXdzL3RpbWUtbGltaXQtY29udHJvbC9zZW5kLW1lc3NhZ2Utb3BlcmF0aW9uL3NlbmQtbWVzc2FnZS1vcGVyYXRpb24uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLFFBQVEsRUFBRSxTQUFTLEVBQUUsV0FBVyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ2pILE9BQU8sRUFBa0IsV0FBVyxFQUFDLE1BQU0sOEJBQThCLENBQUM7QUFDMUUsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3RELE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLHVDQUF1QyxDQUFDO0FBTy9FLE1BQU0sT0FBTyw2QkFBNkI7Ozs7OztJQWtHeEMsWUFDVSxRQUFrQixFQUNsQixPQUF3QixFQUN4QixPQUErQjtRQUYvQixhQUFRLEdBQVIsUUFBUSxDQUFVO1FBQ2xCLFlBQU8sR0FBUCxPQUFPLENBQWlCO1FBQ3hCLFlBQU8sR0FBUCxPQUFPLENBQXdCOztRQXhDekMsY0FBUyxHQUFnQixJQUFJLFdBQVcsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUMzQyxpQkFBWSxHQUFHLElBQUksWUFBWSxFQUFPLENBQUM7UUFDdkMsa0JBQWEsR0FBRyxJQUFJLFlBQVksRUFBbUIsQ0FBQztRQUU5RCxjQUFTLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxlQUFlLENBQUMsR0FBRzs7OztRQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUMsRUFBQyxD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QWU7WUFDZixzQkFBc0I7OztxQkFTNUIsU0FBUyxTQUFDLFFBQVE7b0JBQ2xCLEtBQUs7MkJBMkRMLE1BQU07NEJBQ04sTUFBTTs7OztJQTdEUCwrQ0FBOEM7O0lBMkQ5QyxrREFBcUQ7O0lBQ3JELHFEQUFpRDs7SUFDakQsc0RBQThEOztJQUU5RCxrREFBcUY7O0lBRXJGLDBEQUVFOztJQUNGLGtFQUlFOztJQUVGLG9EQUFpQjs7SUFDakIscURBQWtCOztJQUVsQiwrQ0FHQzs7SUFFRCwyREFJRTs7SUFFRixpREFBOEM7O0lBRTlDLHFEQUFxQjs7SUFFckIsNERBQWlDOztJQUVqQyxvREFBZ0M7Ozs7O0lBRzlCLGlEQUEwQjs7Ozs7SUFDMUIsZ0RBQWdDOzs7OztJQUNoQyxnREFBdUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgSW5qZWN0b3IsIFZpZXdDaGlsZCwgVGVtcGxhdGVSZWYsIElucHV0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQge0V4cGlyZU9wZXJhdGlvbiwgU2VuZE1lc3NhZ2V9IGZyb20gJy4uL3RpbWUtbGltaXQtY29udHJvbC5lbnRpdHknO1xyXG5pbXBvcnQgeyBNZXNzYWdlclNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW1lc3NhZ2VyJztcclxuaW1wb3J0IHsgUHJvY2Vzc0Rlc2lnbmVyVUlTdGF0ZSB9IGZyb20gJy4uLy4uLy4uL2FwcC9wcm9jZXNzLWRlc2lnbmVyLnVpc3RhdGUnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdsaWItc2VuZC1tZXNzYWdlLW9wZXJhdGlvbicsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL3NlbmQtbWVzc2FnZS1vcGVyYXRpb24uY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsczogWycuL3NlbmQtbWVzc2FnZS1vcGVyYXRpb24uY29tcG9uZW50LnNjc3MnXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgU2VuZE1lc3NhZ2VPcGVyYXRpb25Db21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG5cclxuICBAVmlld0NoaWxkKCdmb290ZXInKSBmb290ZXI6IFRlbXBsYXRlUmVmPGFueT47XHJcbiAgQElucHV0KClcclxuICBzZXQgdmFsdWUoaW5mbzogU2VuZE1lc3NhZ2UpIHtcclxuICAgIHRoaXMub3BlcmF0aW9uID0gT2JqZWN0LmFzc2lnbih7fSwgaW5mbyk7XHJcbiAgICBpZiAodGhpcy5vcGVyYXRpb24uc2VuZFR5cGUgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICBjb25zdCBzZW5kTWVzc2FnZSA9IG5ldyBTZW5kTWVzc2FnZSh0aGlzLmxvY2F0aW9uKTtcclxuICAgICAgdGhpcy5vcGVyYXRpb24uY3ljbGVFbmFibGUgPSBzZW5kTWVzc2FnZS5jeWNsZUVuYWJsZTtcclxuICAgICAgdGhpcy5vcGVyYXRpb24uY3ljbGVUaW1lVW5pdCA9IHNlbmRNZXNzYWdlLmN5Y2xlVGltZVVuaXQ7XHJcbiAgICAgIHRoaXMub3BlcmF0aW9uLnJlY2VpdmVyID0gc2VuZE1lc3NhZ2UucmVjZWl2ZXI7XHJcbiAgICAgIHRoaXMub3BlcmF0aW9uLnN1YmplY3QgPSBzZW5kTWVzc2FnZS5zdWJqZWN0O1xyXG4gICAgICB0aGlzLm9wZXJhdGlvbi5tZXNzYWdlID0gc2VuZE1lc3NhZ2UubWVzc2FnZTtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLm9wZXJhdGlvbi5yZWNlaXZlciAmJiB0aGlzLm9wZXJhdGlvbi5yZWNlaXZlci5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGxldCBhcnJheSA9IHRoaXMub3BlcmF0aW9uLnJlY2VpdmVyLnNwbGl0KCcsJyk7XHJcbiAgICAgIGlmIChhcnJheS5pbmRleE9mKCd3b3JrSXRlbVBhcnRpY2lwYW50JykgPiAtMSkge1xyXG4gICAgICAgIHRoaXMucmVjZWl2ZXJWYXJpID0gJ3dvcmtJdGVtUGFydGljaXBhbnQnO1xyXG4gICAgICAgIHRoaXMuYWN0aXZpdHlSZWNlaXZlclZhciArPSAnd29ya0l0ZW1QYXJ0aWNpcGFudCwnO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChhcnJheS5pbmRleE9mKCdwcm9jSW5zdENyZWF0b3InKSA+IC0xKSB7XHJcbiAgICAgICAgdGhpcy5yZWNlaXZlclZhcmkgPSAncHJvY0luc3RDcmVhdG9yJztcclxuICAgICAgICB0aGlzLmFjdGl2aXR5UmVjZWl2ZXJWYXIgKz0gJ3Byb2NJbnN0Q3JlYXRvciwnO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChhcnJheS5pbmRleE9mKCdwcmVBY3RFeGVjdXRvcnMnKSA+IC0xKXtcclxuICAgICAgICB0aGlzLmFjdGl2aXR5UmVjZWl2ZXJWYXIgKz0gJ3ByZUFjdEV4ZWN1dG9ycywnO1xyXG4gICAgICB9XHJcbiAgICAgIGlmKHRoaXMuYWN0aXZpdHlSZWNlaXZlclZhci5sZW5ndGggPiAwKXtcclxuICAgICAgICB0aGlzLmFjdGl2aXR5UmVjZWl2ZXJWYXIgPSB0aGlzLmFjdGl2aXR5UmVjZWl2ZXJWYXIuc3Vic3RyaW5nKDAsdGhpcy5hY3Rpdml0eVJlY2VpdmVyVmFyLmxlbmd0aC0xKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoYXJyYXkubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIGFycmF5ID0gYXJyYXkuZmlsdGVyKGEgPT4gYSAhPT0gJ3Byb2NJbnN0Q3JlYXRvcicpO1xyXG4gICAgICAgIHRoaXMuYmluZGluZ0RhdGEuaWQgPSAnJztcclxuICAgICAgICBmb3IgKGNvbnN0IHIgb2YgYXJyYXkpIHtcclxuICAgICAgICAgIHRoaXMuYmluZGluZ0RhdGEuaWQgKz0gciArICcsJztcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuYmluZGluZ0RhdGEuaWQpIHtcclxuICAgICAgICAgIHRoaXMuYmluZGluZ0RhdGEuaWQgPSB0aGlzLmJpbmRpbmdEYXRhLmlkLnN1YnN0cmluZygwLCB0aGlzLmJpbmRpbmdEYXRhLmlkLmxlbmd0aCAtIDEpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMub3BlcmF0aW9uLnJlY2VpdmVyVGV4dCAmJiB0aGlzLm9wZXJhdGlvbi5yZWNlaXZlclRleHQubGVuZ3RoID4gMCkge1xyXG4gICAgICBsZXQgYXJyYXkgPSB0aGlzLm9wZXJhdGlvbi5yZWNlaXZlclRleHQuc3BsaXQoJywnKTtcclxuICAgICAgaWYgKGFycmF5Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICBhcnJheSA9IGFycmF5LmZpbHRlcihhID0+IGEgIT09ICfmtYHnqIvlj5HotbfkuronKTtcclxuICAgICAgICB0aGlzLmJpbmRpbmdEYXRhLm5hbWUgPSAnJztcclxuICAgICAgICBmb3IgKGNvbnN0IHIgb2YgYXJyYXkpIHtcclxuICAgICAgICAgIHRoaXMuYmluZGluZ0RhdGEubmFtZSArPSByICsgJywnO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5iaW5kaW5nRGF0YS5uYW1lKSB7XHJcbiAgICAgICAgICB0aGlzLmJpbmRpbmdEYXRhLm5hbWUgPSB0aGlzLmJpbmRpbmdEYXRhLm5hbWUuc3Vic3RyaW5nKDAsIHRoaXMuYmluZGluZ0RhdGEubmFtZS5sZW5ndGggLSAxKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIGdldCB2YWx1ZSgpIHtcclxuICAgIHJldHVybiB0aGlzLm9wZXJhdGlvbjtcclxuICB9XHJcblxyXG4gIC8vIG9wZXJhdGlvbjogRXhwaXJlT3BlcmF0aW9uID0gbmV3IEV4cGlyZU9wZXJhdGlvbigpO1xyXG4gIG9wZXJhdGlvbjogU2VuZE1lc3NhZ2UgPSBuZXcgU2VuZE1lc3NhZ2UoJ2FjdGl2aXR5Jyk7XHJcbiAgQE91dHB1dCgpIGNsb3NlRW1pdHRlciA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG4gIEBPdXRwdXQoKSBzdWJtaXRFbWl0dGVyID0gbmV3IEV2ZW50RW1pdHRlcjxFeHBpcmVPcGVyYXRpb24+KCk7XHJcblxyXG4gIHR5cGVHcm91cCA9IHRoaXMudWlzdGF0ZS5tZXNzYWdlQ2hhbm5lbHMubWFwKG0gPT4gKHsgdmFsdWU6IG0uY29kZSwgbmFtZTogbS5uYW1lIH0pKTtcclxuXHJcbiAgcmVjZWl2ZXJWYXJpYWJsZXMgPSBbXHJcbiAgICB7IHZhbHVlOiAncHJvY0luc3RDcmVhdG9yJywgbmFtZTogJ+a1geeoi+WPkei1t+S6uicgfVxyXG4gIF07XHJcbiAgYWN0aXZpdHlSZWNlaXZlclZhcmlhYmxlcyA9IFtcclxuICAgIHsgdmFsdWU6ICd3b3JrSXRlbVBhcnRpY2lwYW50JywgbmFtZTogJ+W9k+WJjeiKgueCueWKnueQhuS6uicgfSxcclxuICAgIHsgdmFsdWU6ICdwcm9jSW5zdENyZWF0b3InLCBuYW1lOiAn5rWB56iL5Y+R6LW35Lq6JyB9LFxyXG4gICAgeyB2YWx1ZTogJ3ByZUFjdEV4ZWN1dG9ycycsIG5hbWU6ICfkuIrkuIDoioLngrnlip7nkIbkuronIH1cclxuICBdO1xyXG5cclxuICBwbGFjZWhvbGRlciA9ICcnO1xyXG4gIHBsYWNlaG9sZGVyMiA9ICcnO1xyXG5cclxuICBwYXJzZXIgPSAodmFsOiBzdHJpbmcgfCBudW1iZXIpID0+IHtcclxuICAgIC8vIGNvbnNvbGUubG9nKHZhbCk7XHJcbiAgICByZXR1cm4gTnVtYmVyKHZhbCk7XHJcbiAgfVxyXG5cclxuICB0aW1lVW5pdENvbGxlY3Rpb24gPSBbXHJcbiAgICB7IHZhbHVlOiAnZGF5JywgdGV4dDogJ+WkqScgfSxcclxuICAgIHsgdmFsdWU6ICdob3VyJywgdGV4dDogJ+aXticgfSxcclxuICAgIHsgdmFsdWU6ICdtaW51dGUnLCB0ZXh0OiAn5YiGJyB9XHJcbiAgXTtcclxuXHJcbiAgbG9jYXRpb246ICdhY3Rpdml0eScgfCAncHJvY2VzcycgPSAnYWN0aXZpdHknO1xyXG5cclxuICByZWNlaXZlclZhcmk6IHN0cmluZztcclxuXHJcbiAgYWN0aXZpdHlSZWNlaXZlclZhcjogc3RyaW5nID0gJyc7XHJcblxyXG4gIGJpbmRpbmdEYXRhOiB7IGlkPywgbmFtZT99ID0ge307XHJcblxyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IsXHJcbiAgICBwcml2YXRlIG1lc3NhZ2U6IE1lc3NhZ2VyU2VydmljZSxcclxuICAgIHByaXZhdGUgdWlzdGF0ZTogUHJvY2Vzc0Rlc2lnbmVyVUlTdGF0ZVxyXG4gICkgeyB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gIH1cclxuXHJcbiAgY2xpY2tPSygpIHtcclxuICAgIHRoaXMub3BlcmF0aW9uLmN5Y2xlVGltZSArPSAnJztcclxuICAgIGlmICh0aGlzLmxvY2F0aW9uID09PSAncHJvY2VzcycpIHtcclxuICAgICAgdGhpcy5zZXRSZWNlaXZlcigpO1xyXG4gICAgfVxyXG4gICAgaWYodGhpcy5sb2NhdGlvbiA9PT0gJ2FjdGl2aXR5Jykge1xyXG4gICAgICB0aGlzLnNldEFjdGl2aXR5UmVjZWl2ZXIoKVxyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMudmFsaWRhdG9yKCkpIHtcclxuICAgICAgdGhpcy5zdWJtaXRFbWl0dGVyLmVtaXQodGhpcy5vcGVyYXRpb24pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgY2xpY2tDYW5jZWwoKSB7XHJcbiAgICB0aGlzLmNsb3NlRW1pdHRlci5lbWl0KCk7XHJcbiAgfVxyXG5cclxuICBjbGVhcigpIHtcclxuICAgIHRoaXMuYmluZGluZ0RhdGEgPSB7fTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgc2V0UmVjZWl2ZXIoKSB7XHJcbiAgICBsZXQgcmVjZWl2ZXIgPSAnJztcclxuICAgIGxldCByZWNlaXZlclRleHQgPSAnJztcclxuICAgIGlmICh0aGlzLnJlY2VpdmVyVmFyaSkge1xyXG4gICAgICByZWNlaXZlciArPSB0aGlzLnJlY2VpdmVyVmFyaSArICcsJztcclxuICAgICAgY29uc3QgYXJyYXkgPSB0aGlzLnJlY2VpdmVyVmFyaS5zcGxpdCgnLCcpO1xyXG4gICAgICBpZiAoYXJyYXkubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIGZvciAoY29uc3QgYSBvZiBhcnJheSkge1xyXG4gICAgICAgICAgY29uc3QgdCA9IHRoaXMucmVjZWl2ZXJWYXJpYWJsZXMuZmluZCh2ID0+IHYudmFsdWUgPT09IGEpLm5hbWU7XHJcbiAgICAgICAgICByZWNlaXZlclRleHQgKz0gdCArICcsJztcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGlmICh0aGlzLmJpbmRpbmdEYXRhLmlkKSB7XHJcbiAgICAgIHJlY2VpdmVyICs9IHRoaXMuYmluZGluZ0RhdGEuaWQgKyAnLCc7XHJcbiAgICAgIHJlY2VpdmVyVGV4dCArPSB0aGlzLmJpbmRpbmdEYXRhLm5hbWUgKyAnLCc7XHJcbiAgICB9XHJcbiAgICBpZiAocmVjZWl2ZXIpIHtcclxuICAgICAgcmVjZWl2ZXIgPSByZWNlaXZlci5zdWJzdHJpbmcoMCwgcmVjZWl2ZXIubGVuZ3RoIC0gMSk7XHJcbiAgICB9XHJcbiAgICBpZiAocmVjZWl2ZXJUZXh0KSB7XHJcbiAgICAgIHJlY2VpdmVyVGV4dCA9IHJlY2VpdmVyVGV4dC5zdWJzdHJpbmcoMCwgcmVjZWl2ZXJUZXh0Lmxlbmd0aCAtIDEpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5vcGVyYXRpb24ucmVjZWl2ZXIgPSByZWNlaXZlcjtcclxuICAgIHRoaXMub3BlcmF0aW9uLnJlY2VpdmVyVGV4dCA9IHJlY2VpdmVyVGV4dDtcclxuICB9XHJcblxyXG4gIHNldEFjdGl2aXR5UmVjZWl2ZXIoKXtcclxuICAgIGxldCByZWNlaXZlciA9ICcnO1xyXG4gICAgaWYgKHRoaXMuYWN0aXZpdHlSZWNlaXZlclZhcikge1xyXG4gICAgICByZWNlaXZlciArPSB0aGlzLmFjdGl2aXR5UmVjZWl2ZXJWYXIgKyAnLCc7XHJcbiAgICB9XHJcbiAgICBpZiAocmVjZWl2ZXIpIHtcclxuICAgICAgcmVjZWl2ZXIgPSByZWNlaXZlci5zdWJzdHJpbmcoMCwgcmVjZWl2ZXIubGVuZ3RoIC0gMSk7XHJcbiAgICB9XHJcbiAgICB0aGlzLm9wZXJhdGlvbi5yZWNlaXZlciA9IHJlY2VpdmVyO1xyXG4gIH1cclxuICBwcml2YXRlIHZhbGlkYXRvcigpOiBib29sZWFuIHtcclxuICAgIGlmICghdGhpcy5vcGVyYXRpb24uc2VuZFR5cGUpIHtcclxuICAgICAgdGhpcy5tZXNzYWdlLmluZm8oJ+WPkemAgeaWueW8j+S4jeWFgeiuuOS4uuepuu+8gScpO1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBpZiAoIXRoaXMub3BlcmF0aW9uLnN1YmplY3QpIHtcclxuICAgICAgdGhpcy5tZXNzYWdlLmluZm8oJ+a2iOaBr+S4u+mimOS4jeWFgeiuuOS4uuepuu+8gScpO1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBpZiAoIXRoaXMub3BlcmF0aW9uLm1lc3NhZ2UpIHtcclxuICAgICAgdGhpcy5tZXNzYWdlLmluZm8oJ+a2iOaBr+WGheWuueS4jeWFgeiuuOS4uuepuu+8gScpO1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBpZiAoIXRoaXMub3BlcmF0aW9uLnJlY2VpdmVyKSB7XHJcbiAgICAgIHRoaXMubWVzc2FnZS5pbmZvKCfmjqXmlLbkurrkuI3lhYHorrjkuLrnqbrvvIEnKTtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRydWU7XHJcbiAgfVxyXG59XHJcbiJdfQ==