/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ComponentFactoryResolver, Injector, Input, ViewChild, ElementRef, HostBinding, NgZone, TemplateRef, EventEmitter, Output } from '@angular/core';
import { FormBuilder } from '@angular/forms';
import { ProcessDesignerUIState } from '../../../../app/process-designer.uistate';
import { ExpressionService, InjectedType } from '@gsp-svc/expression';
import { SessionService } from '@ecp-caf/caf-common';
import { BsModalService } from '@farris/ui-modal';
import { CommonComponentUiRTService } from '@gsp-cmp/ccmp-ui';
import { SelectMetadataRTComponent } from '@gsp-lcm/metadatart-selector';
import { DatagridComponent } from '@farris/ui-datagrid';
import { of } from 'rxjs';
import { EditorTypes } from '@farris/ui-datagrid-editors';
import { LookupGridComponent, ServerSideToken } from '@farris/ui-lookup';
import { ParameterFetchValueMode } from '@gsp-cmp/wscmp-models';
import { ComponentEditLookUpService } from './component-edit-lookup.service';
import { ComponentEditService } from './component-edit.service';
import { ComponentEntity } from './component.entity';
import { ProcessDeUtil } from '../../../../domain/process-de-util';
import { MessagerService } from '@farris/ui-messager';
export class ComponentEditComponent {
    /**
     * @param {?} formBuilder
     * @param {?} designerState
     * @param {?} expr
     * @param {?} resolver
     * @param {?} injector
     * @param {?} sessionSrc
     * @param {?} modalService
     * @param {?} componentService
     * @param {?} ngZone
     * @param {?} service
     * @param {?} util
     * @param {?} message
     */
    constructor(formBuilder, designerState, expr, resolver, injector, sessionSrc, modalService, componentService, ngZone, service, util, message) {
        this.formBuilder = formBuilder;
        this.designerState = designerState;
        this.expr = expr;
        this.resolver = resolver;
        this.injector = injector;
        this.sessionSrc = sessionSrc;
        this.modalService = modalService;
        this.componentService = componentService;
        this.ngZone = ngZone;
        this.service = service;
        this.util = util;
        this.message = message;
        this.cls = 'farris-main-area flex-column';
        this.closeEmitter = new EventEmitter();
        this.submitEmitter = new EventEmitter();
        this.showClearButton = false;
        this._component = new ComponentEntity();
        this.columns = [
            { field: 'Name', width: 100, title: '参数名' },
            {
                field: 'Value', width: 100, title: '参数值',
                editor: {
                    type: 'input-group',
                    options: {
                        groupText: '<i class="f-icon f-icon-lookup"></i>',
                        editable: false,
                        clickHandle: (/**
                         * @param {?} e
                         * @return {?}
                         */
                        (e) => {
                            e.formControl.setValue(e.instance.value ? e.instance.value : '');
                            this.showExprHelp(e);
                        }),
                        clear: (/**
                         * @param {?} e
                         * @return {?}
                         */
                        (e) => {
                            console.log('clear', e);
                        })
                    }
                }
            }
        ];
        this.helpFields = {
            idField: '',
            valueField: '',
            textField: ''
        };
        this.dataUri = '/api/runtime/wf/v1.0/dtProcDefs/getHelpData';
        this.helpCols = [];
        this.displayType = 'List';
        this.title = '';
        this.beforeEdit = (/**
         * @param {?} param
         * @return {?}
         */
        (param) => {
            /** @type {?} */
            const rowData = (/** @type {?} */ (param.rowData));
            switch (rowData.fetchValueMode) {
                case ParameterFetchValueMode.express:
                    param.column.editor = {
                        type: 'input-group',
                        options: {
                            groupText: '<i class="f-icon f-icon-lookup"></i>',
                            editable: false,
                            clickHandle: (/**
                             * @param {?} e
                             * @return {?}
                             */
                            (e) => {
                                e.formControl.setValue(e.instance.value ? e.instance.value : '');
                                this.showExprHelp(e);
                            }),
                            clear: (/**
                             * @param {?} e
                             * @return {?}
                             */
                            (e) => {
                                console.log('clear', e);
                            })
                        }
                    };
                    break;
                case ParameterFetchValueMode.none:
                    param.column.editor = {
                        type: 'input-group',
                        options: {
                            groupText: '<i class="f-icon f-icon-lookup"></i>',
                            editable: false,
                            clickHandle: (/**
                             * @param {?} e
                             * @return {?}
                             */
                            (e) => {
                                e.formControl.setValue(e.instance.value ? e.instance.value : '');
                                this.showExprHelp(e);
                            }),
                            clear: (/**
                             * @param {?} e
                             * @return {?}
                             */
                            (e) => {
                                console.log('clear', e);
                            })
                        }
                    };
                    break;
                case ParameterFetchValueMode.const:
                    param.column.editor = { type: EditorTypes.TEXTBOX, options: {} };
                    break;
                case ParameterFetchValueMode.enum:
                    param.column.editor = { type: EditorTypes.TEXTBOX, options: {} };
                    break;
                case ParameterFetchValueMode.help:
                    param.column.editor = {
                        type: 'input-group',
                        options: {
                            groupText: '<i class="f-icon f-icon-lookup"></i>',
                            editable: false,
                            clickHandle: (/**
                             * @param {?} e
                             * @return {?}
                             */
                            (e) => {
                                this.cell = e;
                                this.helpId = ((/** @type {?} */ (rowData.fetchValueSetting))).helpId;
                                this.su = ((/** @type {?} */ (rowData.fetchValueSetting))).serviceUnit;
                                this.getHelpInfo().subscribe((/**
                                 * @param {?} re
                                 * @return {?}
                                 */
                                re => {
                                    console.log(re);
                                    /** @type {?} */
                                    const meta = re;
                                    /** @type {?} */
                                    const help = (/** @type {?} */ (JSON.parse(meta.content)));
                                    this.helpCols = help.dataSource.columns;
                                    this.displayType = help.displayType;
                                    this.helpFields = {
                                        idField: help.idField,
                                        valueField: help.valueField,
                                        textField: help.textField
                                    };
                                    this.lookup.onClear();
                                    this.lookup.showDialog();
                                }), (/**
                                 * @param {?} err
                                 * @return {?}
                                 */
                                err => {
                                    this.message.error('帮助元数据不存在，请联系系统管理员查看原因！');
                                }));
                            }),
                            clear: (/**
                             * @param {?} e
                             * @return {?}
                             */
                            (e) => {
                                console.log('clear', e);
                            })
                        }
                    };
                    break;
            }
            return of(true);
        });
        this.afterEdit = (/**
         * @param {?} rowIndex
         * @param {?} rowData
         * @param {?=} column
         * @return {?}
         */
        (rowIndex, rowData, column) => {
            return of(true);
        });
        this.dictPicking = (/**
         * @return {?}
         */
        () => {
            return of({
                showDialog: true, data: {
                    helpId: this.helpId
                }
            });
        });
        this.dictPicked = (/**
         * @param {?} rowData
         * @return {?}
         */
        (rowData) => {
            if (this.cell) {
                console.log(rowData);
                this.cell.formControl.setValue(this.util.getValue(rowData, this.helpFields.valueField));
                this.cell.instance.cd.detectChanges();
                return of(true);
            }
        });
    }
    /**
     * @param {?} cmp
     * @return {?}
     */
    set component(cmp) {
        if (cmp && cmp.MethodCode) {
            this.service.getHelpMetaData(cmp.MetadataId, '').subscribe((/**
             * @param {?} re
             * @return {?}
             */
            re => {
                /** @type {?} */
                const c = JSON.parse(re.content);
                /** @type {?} */
                const operation = c.operations.find((/**
                 * @param {?} o
                 * @return {?}
                 */
                o => o.code === cmp.MethodCode));
                if (operation) {
                    cmp.ActualParameters = cmp.ActualParameters.map((/**
                     * @param {?} a
                     * @return {?}
                     */
                    a => {
                        /** @type {?} */
                        const p = operation.parameters.find((/**
                         * @param {?} i
                         * @return {?}
                         */
                        i => i.code === a.Name));
                        if (p) {
                            return Object.assign({}, a, { fetchValueMode: p.fetchValueMode, fetchValueSetting: p.fetchValueSetting });
                        }
                        else {
                            throw new Error('当前构件方法参数不一致，请更新！');
                        }
                    }));
                    this._component = cmp;
                }
                else {
                    throw new Error('当前构件已不存在此方法，请更新！');
                }
            }));
        }
        else {
            this._component = new ComponentEntity();
        }
    }
    /**
     * @return {?}
     */
    get component() {
        return this._component;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        this.ngZone.runOutsideAngular((/**
         * @return {?}
         */
        () => {
            this.inputGroup.nativeElement.addEventListener('mouseenter', this.onMouseEnter.bind(this));
            this.inputGroup.nativeElement.addEventListener('mouseleave', this.onMouseLeave.bind(this));
        }));
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onMouseEnter(event) {
        this.showClearButton = true;
        if (this.showClearButton) {
            this.toggleClearIcon(event, true);
        }
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onMouseLeave(event) {
        this.showClearButton = false;
        this.toggleClearIcon(event, false);
    }
    /**
     * @private
     * @param {?} event
     * @param {?=} isShow
     * @return {?}
     */
    toggleClearIcon(event, isShow = false) {
        /** @type {?} */
        const str = isShow ? '' : 'none';
        /** @type {?} */
        const clearIcon = event.target.querySelector('.input-group-clear');
        if (clearIcon) {
            clearIcon.style.display = str;
        }
    }
    /**
     * @return {?}
     */
    clickOK() {
        this.grid.endCellEdit();
        if (this.validator()) {
            this.submitEmitter.emit(this.component);
        }
        else {
            this.message.info('尚未选择构件方法!');
        }
    }
    /**
     * @return {?}
     */
    clickCancel() {
        this.closeEmitter.emit();
    }
    /**
     * @private
     * @return {?}
     */
    validator() {
        if (!this.component.MethodCode || !this.component.MetadataId) {
            return false;
        }
        return true;
    }
    /**
     * @return {?}
     */
    clear() {
        this.component = new ComponentEntity();
    }
    /**
     * @return {?}
     */
    selectComponent() {
        /** @type {?} */
        const compFactory = this.resolver.resolveComponentFactory(SelectMetadataRTComponent);
        /** @type {?} */
        const compRef = compFactory.create(this.injector);
        compRef.instance.typeList = 'WebServiceComponent'; // 目前只能根据元数据类型过滤，后续添加标签过滤
        compRef.instance.selectedMetadata.subscribe((/**
         * @param {?} $event
         * @return {?}
         */
        ($event) => {
            try {
                /** @type {?} */
                const meta = $event.metadata;
                this.openComponentSelectorNew(meta.id, this.sessionSrc.getUserSessionId());
            }
            catch (_a) {
                console.log('$event', $event);
                throw new Error('获取解析构件出错' + $event);
            }
        }));
        /** @type {?} */
        const modalConfig = {
            title: '构件选择',
            width: 980,
            height: 548,
            showButtons: false
        };
        /** @type {?} */
        const dialog = this.modalService.show(compRef, modalConfig);
        compRef.instance.closeModalEmitter.subscribe((/**
         * @param {?} $event
         * @return {?}
         */
        $event => dialog.close()));
    }
    /**
     * @private
     * @param {?} metadataId
     * @param {?} sessionId
     * @return {?}
     */
    openComponentSelectorNew(metadataId, sessionId) {
        this.componentService.openSelector(metadataId, sessionId).subscribe((/**
         * @param {?} selectorResult
         * @return {?}
         */
        (selectorResult) => {
            selectorResult.confirmEvent.subscribe((/**
             * @param {?} result
             * @return {?}
             */
            (result) => {
                if (result) {
                    this.component.Name = result.name;
                    this.component.MetadataId = result.id;
                    this.component.MethodCode = result.operations[0].code;
                    // this.component.methodName = result.operations[0].name;
                    this.component.ActualParameters = [];
                    if (result.operations[0].parameters && result.operations[0].parameters.length > 0) {
                        this.component.ActualParameters = result.operations[0].parameters
                            .map((/**
                         * @param {?} p
                         * @return {?}
                         */
                        (p) => ({
                            Name: p.code, Value: '', Tag: p.fetchValueMode.indexOf('express,none') > -1 ? 'expression' : 'constant',
                            fetchValueMode: p.fetchValueMode,
                            fetchValueSetting: p.fetchValueSetting
                        })));
                    }
                }
            }));
        }));
    }
    /**
     * @param {?} e
     * @return {?}
     */
    showExprHelp(e) {
        if (this.designerState.schemas.length > 0) {
            for (const schema of this.designerState.schemas) {
                this.expr.addSchema('Schema', schema);
            }
            if (this.designerState.schemas[0].entityTypes && this.designerState.schemas[0].entityTypes.length > 0) {
                /** @type {?} */
                const entityType = this.designerState.schemas[0].entityTypes[0];
                this.expr.addInjectedEntity(entityType.name, 'Schema', entityType.name, InjectedType.EntityType);
            }
        }
        /** @type {?} */
        const context = new Array();
        if (this.designerState.procInstContext.length > 0) {
            for (const variable of this.designerState.procInstContext) {
                context.push(variable);
                // this.expr.addContext(variable);
            }
        }
        if (this.designerState.formalParameterContext.length > 0) {
            for (const variable of this.designerState.formalParameterContext) {
                if (!context.some((/**
                 * @param {?} c
                 * @return {?}
                 */
                c => c.key === variable.key))) {
                    context.push(variable);
                }
                // this.expr.addContext(variable);
            }
        }
        if (this.designerState.participantContext.length > 0) {
            for (const variable of this.designerState.participantContext) {
                if (!context.some((/**
                 * @param {?} c
                 * @return {?}
                 */
                c => c.key === variable.key))) {
                    context.push(variable);
                }
                // this.expr.addContext(variable);
            }
        }
        if (this.designerState.processVariableContext.length > 0) {
            for (const variable of this.designerState.processVariableContext) {
                if (!context.some((/**
                 * @param {?} c
                 * @return {?}
                 */
                c => c.key === variable.key))) {
                    context.push(variable);
                }
                // this.expr.addContext(variable);
            }
        }
        if (context.length > 0) {
            for (const v of context) {
                this.expr.addContext(v);
            }
        }
        this.expr.addExpressionText(e.instance.value);
        this.expr.buildExpression().then((/**
         * @param {?} d
         * @return {?}
         */
        (d) => {
            e.formControl.setValue(d);
            e.instance.cd.detectChanges();
        }));
    }
    /**
     * @private
     * @return {?}
     */
    getHelpInfo() {
        return this.service.getHelpMetaData(this.helpId, this.su);
    }
}
ComponentEditComponent.decorators = [
    { type: Component, args: [{
                selector: 'lib-component-edit',
                template: "<div class=\"f-utils-fill-flex-column farris-overflow-y-auto h-100 m-2\" style=\"background:#FFF;\">\r\n  <form class=\"farris-form farris-card-content-bg farris-card-section mx-2\">\r\n    <div class=\"d-flex flex-wrap flex-column mb-2 pr-4\">\r\n      <div class=\"farris-form-controls-inline farris-form-auto mb-2\">\r\n        <div class=\"farris-group-wrap mx-3\">\r\n          <div class=\"form-group\">\r\n            <label class=\"col-form-label\">\r\n              <span class=\"farris-label-info text-danger\">*</span>\r\n              <span class=\"farris-label-text\">\u6784\u4EF6\u540D\u79F0</span>\r\n            </label>\r\n            <div class=\"farris-input-wrap ml-2\">\r\n              <input type=\"text\" class=\"k-textbox form-control\" name=\"name\" [(ngModel)]=\"component.Name\" />\r\n              <div class=\"farris-feedback valid-feedback\"></div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class=\"farris-form-controls-inline farris-form-auto\">\r\n        <div class=\"farris-group-wrap mx-3\">\r\n          <div class=\"form-group\">\r\n            <label class=\"col-form-label\">\r\n              <span class=\"farris-label-info text-danger\">*</span>\r\n              <span class=\"farris-label-text\">\u6784\u4EF6\u9009\u62E9</span>\r\n            </label>\r\n            <div class=\"farris-input-wrap ml-2\">\r\n              <div #inputGroup class=\"input-group\">\r\n                <input type=\"text\" class=\"form-control\" [(ngModel)]=\"component.MethodCode\" name=\"methodCode\"\r\n                  [readOnly]=\"true\" />\r\n                <div class=\"input-group-append\">\r\n                  <span [style.display]=\"showClearButton ? '' : 'none'\" class=\"input-group-text input-group-clear\"\r\n                    (click)=\"clear()\">\r\n                    <i class=\"f-icon modal_close\"></i>\r\n                  </span>\r\n                  <span class=\"input-group-text\" (click)=\"selectComponent()\" style=\"background: #FFF;\">\r\n                    <i class=\"f-icon f-icon-lookup\"></i>\r\n                  </span>\r\n                </div>\r\n              </div>\r\n              <div class=\"farris-feedback valid-feedback\"></div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </form>\r\n  <farris-tabs class=\"f-utils-fill\" #params [value]=\"'params'\" [contentFill]=\"true\">\r\n    <farris-tab title=\"\u53C2\u6570\u5217\u8868\" [id]=\"'params'\">\r\n      <ng-template #content>\r\n        <div class=\"f-utils-fill-flex-column h-100\">\r\n          <farris-datagrid #grid [data]=\"component.ActualParameters\" [columns]=\"columns\" [idField]=\"'Name'\" [fit]=\"true\"\r\n            [fitColumns]=\"true\" [editable]=\"true\" [editMode]=\"'cell'\" [pagination]=\"false\" [showCheckbox]=\"false\" [striped]=\"true\"\r\n            [multiSelect]=\"false\" [afterEdit]=\"afterEdit\" [beforeEdit]=\"beforeEdit\"></farris-datagrid>\r\n        </div>\r\n      </ng-template>\r\n    </farris-tab>\r\n  </farris-tabs>\r\n</div>\r\n\r\n<farris-lookup-grid style=\"display: none;\" #lookup [(ngModel)]=\"value\" [editable]=\"false\" [columns]=\"helpCols\"\r\n  [singleSelect]=\"true\" [title]=\"title\" [displayType]=\"displayType\" [uri]=\"dataUri\"\r\n  [idField]=\"helpFields.idField\" [pagination]=\"true\" [valueField]=\"helpFields.valueField\"\r\n  [textField]=\"helpFields.textField\" [dictPicking]=\"dictPicking\" [dictPicked]=\"dictPicked\">\r\n</farris-lookup-grid>\r\n\r\n<ng-template #footer>\r\n  <button type=\"button\" class=\"btn btn-primary btn-sm mx-2\" (click)=\"clickOK()\">\u786E\u5B9A</button>\r\n  <button type=\"button\" class=\"btn btn-secondary btn-sm\" (click)=\"clickCancel()\">\u53D6\u6D88</button>\r\n</ng-template>",
                providers: [
                    ComponentEditService,
                    { provide: ServerSideToken, useClass: ComponentEditLookUpService }
                ],
                styles: [""]
            }] }
];
/** @nocollapse */
ComponentEditComponent.ctorParameters = () => [
    { type: FormBuilder },
    { type: ProcessDesignerUIState },
    { type: ExpressionService },
    { type: ComponentFactoryResolver },
    { type: Injector },
    { type: SessionService },
    { type: BsModalService },
    { type: CommonComponentUiRTService },
    { type: NgZone },
    { type: ComponentEditService },
    { type: ProcessDeUtil },
    { type: MessagerService }
];
ComponentEditComponent.propDecorators = {
    cls: [{ type: HostBinding, args: ['class',] }],
    grid: [{ type: ViewChild, args: [DatagridComponent,] }],
    lookup: [{ type: ViewChild, args: [LookupGridComponent,] }],
    footer: [{ type: ViewChild, args: ['footer',] }],
    closeEmitter: [{ type: Output }],
    submitEmitter: [{ type: Output }],
    inputGroup: [{ type: ViewChild, args: ['inputGroup',] }],
    component: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    ComponentEditComponent.prototype.cls;
    /** @type {?} */
    ComponentEditComponent.prototype.grid;
    /** @type {?} */
    ComponentEditComponent.prototype.lookup;
    /** @type {?} */
    ComponentEditComponent.prototype.footer;
    /** @type {?} */
    ComponentEditComponent.prototype.closeEmitter;
    /** @type {?} */
    ComponentEditComponent.prototype.submitEmitter;
    /** @type {?} */
    ComponentEditComponent.prototype.inputGroup;
    /** @type {?} */
    ComponentEditComponent.prototype.showClearButton;
    /**
     * @type {?}
     * @private
     */
    ComponentEditComponent.prototype._component;
    /** @type {?} */
    ComponentEditComponent.prototype.curParameter;
    /** @type {?} */
    ComponentEditComponent.prototype.columns;
    /** @type {?} */
    ComponentEditComponent.prototype.helpFields;
    /** @type {?} */
    ComponentEditComponent.prototype.dataUri;
    /** @type {?} */
    ComponentEditComponent.prototype.helpId;
    /** @type {?} */
    ComponentEditComponent.prototype.su;
    /** @type {?} */
    ComponentEditComponent.prototype.helpCols;
    /** @type {?} */
    ComponentEditComponent.prototype.displayType;
    /** @type {?} */
    ComponentEditComponent.prototype.title;
    /** @type {?} */
    ComponentEditComponent.prototype.value;
    /** @type {?} */
    ComponentEditComponent.prototype.cell;
    /** @type {?} */
    ComponentEditComponent.prototype.beforeEdit;
    /** @type {?} */
    ComponentEditComponent.prototype.afterEdit;
    /** @type {?} */
    ComponentEditComponent.prototype.dictPicking;
    /** @type {?} */
    ComponentEditComponent.prototype.dictPicked;
    /**
     * @type {?}
     * @private
     */
    ComponentEditComponent.prototype.formBuilder;
    /**
     * @type {?}
     * @private
     */
    ComponentEditComponent.prototype.designerState;
    /**
     * @type {?}
     * @private
     */
    ComponentEditComponent.prototype.expr;
    /**
     * @type {?}
     * @private
     */
    ComponentEditComponent.prototype.resolver;
    /**
     * @type {?}
     * @private
     */
    ComponentEditComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    ComponentEditComponent.prototype.sessionSrc;
    /**
     * @type {?}
     * @private
     */
    ComponentEditComponent.prototype.modalService;
    /**
     * @type {?}
     * @private
     */
    ComponentEditComponent.prototype.componentService;
    /**
     * @type {?}
     * @private
     */
    ComponentEditComponent.prototype.ngZone;
    /**
     * @type {?}
     * @private
     */
    ComponentEditComponent.prototype.service;
    /**
     * @type {?}
     * @private
     */
    ComponentEditComponent.prototype.util;
    /**
     * @type {?}
     * @private
     */
    ComponentEditComponent.prototype.message;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tcG9uZW50LWVkaXQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdzcC13Zi93Zi1wcm9jZXNzLWVkaXRvci8iLCJzb3VyY2VzIjpbImxpYi92aWV3cy92YXJpYWJsZS1zZXR0aW5nL3ZpZXdzL2NvbXBvbmVudC1lZGl0L2NvbXBvbmVudC1lZGl0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBVSx3QkFBd0IsRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsV0FBVyxFQUFpQixNQUFNLEVBQUUsV0FBVyxFQUFFLFlBQVksRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0wsT0FBTyxFQUFhLFdBQVcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3hELE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLDBDQUEwQyxDQUFDO0FBQ2xGLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxZQUFZLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN0RSxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDckQsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQ2xELE9BQU8sRUFBRSwwQkFBMEIsRUFBa0IsTUFBTSxrQkFBa0IsQ0FBQztBQUM5RSxPQUFPLEVBQUUseUJBQXlCLEVBQWdDLE1BQU0sOEJBQThCLENBQUM7QUFFdkcsT0FBTyxFQUFjLGlCQUFpQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDcEUsT0FBTyxFQUFFLEVBQUUsRUFBd0IsTUFBTSxNQUFNLENBQUM7QUFFaEQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBQzFELE9BQU8sRUFBRSxtQkFBbUIsRUFBb0IsZUFBZSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDM0YsT0FBTyxFQUF1Qix1QkFBdUIsRUFBeUIsTUFBTSx1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O1lBZ0J2SCxvQkFBb0I7WUFFcEIsYUFBYTtZQUNiLGVBQWU7OztrQkFZckIsV0FBVyxTQUFDLE9BQU87bUJBR25CLFNBQVMsU0FBQyxpQkFBaUI7cUJBQzNCLFNBQVMsU0FBQyxtQkFBbUI7cUJBRTdCLFNBQVMsU0FBQyxRQUFROzJCQUVsQixNQUFNOzRCQUNOLE1BQU07eUJBRU4sU0FBUyxTQUFDLFlBQVk7d0JBSXRCLEtBQUs7Ozs7SUFmTixxQ0FDcUM7O0lBRXJDLHNDQUFzRDs7SUFDdEQsd0NBQTREOztJQUU1RCx3Q0FBOEM7O0lBRTlDLDhDQUFpRDs7SUFDakQsK0NBQWtEOztJQUVsRCw0Q0FBZ0Q7O0lBQ2hELGlEQUF3Qjs7Ozs7SUFFeEIsNENBQWdEOztJQWlDaEQsOENBQThCOztJQUM5Qix5Q0FtQkU7O0lBRUYsNENBSUU7O0lBQ0YseUNBQXdEOztJQUN4RCx3Q0FBTzs7SUFDUCxvQ0FBVzs7SUFDWCwwQ0FBYzs7SUFDZCw2Q0FBcUI7O0lBQ3JCLHVDQUFXOztJQUNYLHVDQUFXOztJQUVYLHNDQUFVOztJQXNFViw0Q0E0RUM7O0lBQ0QsMkNBRUM7O0lBK0dELDZDQU1DOztJQUNELDRDQU9DOzs7OztJQWhSQyw2Q0FBZ0M7Ozs7O0lBQ2hDLCtDQUE2Qzs7Ozs7SUFDN0Msc0NBQStCOzs7OztJQUMvQiwwQ0FBMEM7Ozs7O0lBQzFDLDBDQUEwQjs7Ozs7SUFDMUIsNENBQWtDOzs7OztJQUNsQyw4Q0FBb0M7Ozs7O0lBQ3BDLGtEQUFvRDs7Ozs7SUFDcEQsd0NBQXNCOzs7OztJQUN0Qix5Q0FBcUM7Ozs7O0lBQ3JDLHNDQUEyQjs7Ozs7SUFDM0IseUNBQWdDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciwgSW5qZWN0b3IsIElucHV0LCBWaWV3Q2hpbGQsIEVsZW1lbnRSZWYsIEhvc3RCaW5kaW5nLCBBZnRlclZpZXdJbml0LCBOZ1pvbmUsIFRlbXBsYXRlUmVmLCBFdmVudEVtaXR0ZXIsIE91dHB1dCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBGb3JtR3JvdXAsIEZvcm1CdWlsZGVyIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xyXG5pbXBvcnQgeyBQcm9jZXNzRGVzaWduZXJVSVN0YXRlIH0gZnJvbSAnLi4vLi4vLi4vLi4vYXBwL3Byb2Nlc3MtZGVzaWduZXIudWlzdGF0ZSc7XHJcbmltcG9ydCB7IEV4cHJlc3Npb25TZXJ2aWNlLCBJbmplY3RlZFR5cGUgfSBmcm9tICdAZ3NwLXN2Yy9leHByZXNzaW9uJztcclxuaW1wb3J0IHsgU2Vzc2lvblNlcnZpY2UgfSBmcm9tICdAZWNwLWNhZi9jYWYtY29tbW9uJztcclxuaW1wb3J0IHsgQnNNb2RhbFNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW1vZGFsJztcclxuaW1wb3J0IHsgQ29tbW9uQ29tcG9uZW50VWlSVFNlcnZpY2UsIFNlbGVjdG9yUmVzdWx0IH0gZnJvbSAnQGdzcC1jbXAvY2NtcC11aSc7XHJcbmltcG9ydCB7IFNlbGVjdE1ldGFkYXRhUlRDb21wb25lbnQsIE1ldGFkYXRhNFJlZkR0bywgTWV0YWRhdGFEdG8gfSBmcm9tICdAZ3NwLWxjbS9tZXRhZGF0YXJ0LXNlbGVjdG9yJztcclxuaW1wb3J0IHsgR3NwQ29tcG9uZW50IH0gZnJvbSAnQGdzcC1jbXAvY29tbW9uLWNvbXBvbmVudCc7XHJcbmltcG9ydCB7IERhdGFDb2x1bW4sIERhdGFncmlkQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1kYXRhZ3JpZCc7XHJcbmltcG9ydCB7IG9mLCBmb3JrSm9pbiwgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBSb3dFZGl0UGFyYW0gfSBmcm9tICdAZmFycmlzL3VpLWRhdGFncmlkL2xpYi90eXBlcyc7XHJcbmltcG9ydCB7IEVkaXRvclR5cGVzIH0gZnJvbSAnQGZhcnJpcy91aS1kYXRhZ3JpZC1lZGl0b3JzJztcclxuaW1wb3J0IHsgTG9va3VwR3JpZENvbXBvbmVudCwgTG9va3VwR3JpZFJlc3VsdCwgU2VydmVyU2lkZVRva2VuIH0gZnJvbSAnQGZhcnJpcy91aS1sb29rdXAnO1xyXG5pbXBvcnQgeyBXZWJTZXJ2aWNlUGFyYW1ldGVyLCBQYXJhbWV0ZXJGZXRjaFZhbHVlTW9kZSwgSGVscEZldGNoVmFsdWVTZXR0aW5nIH0gZnJvbSAnQGdzcC1jbXAvd3NjbXAtbW9kZWxzJztcclxuaW1wb3J0IHsgQ29tcG9uZW50RWRpdExvb2tVcFNlcnZpY2UgfSBmcm9tICcuL2NvbXBvbmVudC1lZGl0LWxvb2t1cC5zZXJ2aWNlJztcclxuaW1wb3J0IHsgQ29tcG9uZW50RWRpdFNlcnZpY2UgfSBmcm9tICcuL2NvbXBvbmVudC1lZGl0LnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBDb21wb25lbnRFbnRpdHksIEFjdHVhbFBhcmFtZXRlciB9IGZyb20gJy4vY29tcG9uZW50LmVudGl0eSc7XHJcbmltcG9ydCB7IFByb2Nlc3NEZVV0aWwgfSBmcm9tICcuLi8uLi8uLi8uLi9kb21haW4vcHJvY2Vzcy1kZS11dGlsJztcclxuaW1wb3J0IHsgTWVzc2FnZXJTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1tZXNzYWdlcic7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ2xpYi1jb21wb25lbnQtZWRpdCcsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL2NvbXBvbmVudC1lZGl0LmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi9jb21wb25lbnQtZWRpdC5jb21wb25lbnQuc2NzcyddLFxyXG4gIHByb3ZpZGVyczogW1xyXG4gICAgQ29tcG9uZW50RWRpdFNlcnZpY2UsXHJcbiAgICB7IHByb3ZpZGU6IFNlcnZlclNpZGVUb2tlbiwgdXNlQ2xhc3M6IENvbXBvbmVudEVkaXRMb29rVXBTZXJ2aWNlIH1cclxuICBdXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBDb21wb25lbnRFZGl0Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0IHtcclxuICBASG9zdEJpbmRpbmcoJ2NsYXNzJylcclxuICBjbHMgPSAnZmFycmlzLW1haW4tYXJlYSBmbGV4LWNvbHVtbic7XHJcblxyXG4gIEBWaWV3Q2hpbGQoRGF0YWdyaWRDb21wb25lbnQpIGdyaWQ6IERhdGFncmlkQ29tcG9uZW50O1xyXG4gIEBWaWV3Q2hpbGQoTG9va3VwR3JpZENvbXBvbmVudCkgbG9va3VwOiBMb29rdXBHcmlkQ29tcG9uZW50O1xyXG5cclxuICBAVmlld0NoaWxkKCdmb290ZXInKSBmb290ZXI6IFRlbXBsYXRlUmVmPGFueT47XHJcblxyXG4gIEBPdXRwdXQoKSBjbG9zZUVtaXR0ZXIgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuICBAT3V0cHV0KCkgc3VibWl0RW1pdHRlciA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG5cclxuICBAVmlld0NoaWxkKCdpbnB1dEdyb3VwJykgaW5wdXRHcm91cDogRWxlbWVudFJlZjtcclxuICBzaG93Q2xlYXJCdXR0b24gPSBmYWxzZTtcclxuXHJcbiAgcHJpdmF0ZSBfY29tcG9uZW50OiBhbnkgPSBuZXcgQ29tcG9uZW50RW50aXR5KCk7XHJcbiAgQElucHV0KClcclxuICBzZXQgY29tcG9uZW50KGNtcDogQ29tcG9uZW50RW50aXR5KSB7XHJcbiAgICBpZiAoY21wICYmIGNtcC5NZXRob2RDb2RlKSB7XHJcbiAgICAgIHRoaXMuc2VydmljZS5nZXRIZWxwTWV0YURhdGEoY21wLk1ldGFkYXRhSWQsICcnKS5zdWJzY3JpYmUocmUgPT4ge1xyXG4gICAgICAgIGNvbnN0IGMgPSBKU09OLnBhcnNlKHJlLmNvbnRlbnQpO1xyXG4gICAgICAgIGNvbnN0IG9wZXJhdGlvbiA9IGMub3BlcmF0aW9ucy5maW5kKG8gPT4gby5jb2RlID09PSBjbXAuTWV0aG9kQ29kZSk7XHJcbiAgICAgICAgaWYgKG9wZXJhdGlvbikge1xyXG4gICAgICAgICAgY21wLkFjdHVhbFBhcmFtZXRlcnMgPSBjbXAuQWN0dWFsUGFyYW1ldGVycy5tYXAoYSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHAgPSBvcGVyYXRpb24ucGFyYW1ldGVycy5maW5kKGkgPT4gaS5jb2RlID09PSBhLk5hbWUpO1xyXG4gICAgICAgICAgICBpZiAocCkge1xyXG4gICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAuLi5hLFxyXG4gICAgICAgICAgICAgICAgZmV0Y2hWYWx1ZU1vZGU6IHAuZmV0Y2hWYWx1ZU1vZGUsXHJcbiAgICAgICAgICAgICAgICBmZXRjaFZhbHVlU2V0dGluZzogcC5mZXRjaFZhbHVlU2V0dGluZ1xyXG4gICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCflvZPliY3mnoTku7bmlrnms5Xlj4LmlbDkuI3kuIDoh7TvvIzor7fmm7TmlrDvvIEnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgICB0aGlzLl9jb21wb25lbnQgPSBjbXA7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRocm93IG5ldyBFcnJvcign5b2T5YmN5p6E5Lu25bey5LiN5a2Y5Zyo5q2k5pa55rOV77yM6K+35pu05paw77yBJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuX2NvbXBvbmVudCA9IG5ldyBDb21wb25lbnRFbnRpdHkoKTtcclxuICAgIH1cclxuICB9XHJcbiAgZ2V0IGNvbXBvbmVudCgpIHtcclxuICAgIHJldHVybiB0aGlzLl9jb21wb25lbnQ7XHJcbiAgfVxyXG5cclxuICBjdXJQYXJhbWV0ZXI6IEFjdHVhbFBhcmFtZXRlcjtcclxuICBjb2x1bW5zID0gW1xyXG4gICAgeyBmaWVsZDogJ05hbWUnLCB3aWR0aDogMTAwLCB0aXRsZTogJ+WPguaVsOWQjScgfSxcclxuICAgIHtcclxuICAgICAgZmllbGQ6ICdWYWx1ZScsIHdpZHRoOiAxMDAsIHRpdGxlOiAn5Y+C5pWw5YC8JyxcclxuICAgICAgZWRpdG9yOiB7XHJcbiAgICAgICAgdHlwZTogJ2lucHV0LWdyb3VwJyxcclxuICAgICAgICBvcHRpb25zOiB7XHJcbiAgICAgICAgICBncm91cFRleHQ6ICc8aSBjbGFzcz1cImYtaWNvbiBmLWljb24tbG9va3VwXCI+PC9pPicsXHJcbiAgICAgICAgICBlZGl0YWJsZTogZmFsc2UsXHJcbiAgICAgICAgICBjbGlja0hhbmRsZTogKGUpID0+IHtcclxuICAgICAgICAgICAgZS5mb3JtQ29udHJvbC5zZXRWYWx1ZShlLmluc3RhbmNlLnZhbHVlID8gZS5pbnN0YW5jZS52YWx1ZSA6ICcnKTtcclxuICAgICAgICAgICAgdGhpcy5zaG93RXhwckhlbHAoZSk7XHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgY2xlYXI6IChlKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdjbGVhcicsIGUpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gIF07XHJcblxyXG4gIGhlbHBGaWVsZHM6IHsgaWRGaWVsZDogc3RyaW5nLCB2YWx1ZUZpZWxkOiBzdHJpbmc7IHRleHRGaWVsZDogc3RyaW5nIH0gPSB7XHJcbiAgICBpZEZpZWxkOiAnJyxcclxuICAgIHZhbHVlRmllbGQ6ICcnLFxyXG4gICAgdGV4dEZpZWxkOiAnJ1xyXG4gIH07XHJcbiAgZGF0YVVyaSA9ICcvYXBpL3J1bnRpbWUvd2YvdjEuMC9kdFByb2NEZWZzL2dldEhlbHBEYXRhJztcclxuICBoZWxwSWQ7XHJcbiAgc3U6IHN0cmluZztcclxuICBoZWxwQ29scyA9IFtdO1xyXG4gIGRpc3BsYXlUeXBlID0gJ0xpc3QnO1xyXG4gIHRpdGxlID0gJyc7XHJcbiAgdmFsdWU6IGFueTtcclxuXHJcbiAgY2VsbDogYW55O1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJpdmF0ZSBmb3JtQnVpbGRlcjogRm9ybUJ1aWxkZXIsXHJcbiAgICBwcml2YXRlIGRlc2lnbmVyU3RhdGU6IFByb2Nlc3NEZXNpZ25lclVJU3RhdGUsXHJcbiAgICBwcml2YXRlIGV4cHI6IEV4cHJlc3Npb25TZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSByZXNvbHZlcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxyXG4gICAgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IsXHJcbiAgICBwcml2YXRlIHNlc3Npb25TcmM6IFNlc3Npb25TZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBtb2RhbFNlcnZpY2U6IEJzTW9kYWxTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBjb21wb25lbnRTZXJ2aWNlOiBDb21tb25Db21wb25lbnRVaVJUU2VydmljZSxcclxuICAgIHByaXZhdGUgbmdab25lOiBOZ1pvbmUsXHJcbiAgICBwcml2YXRlIHNlcnZpY2U6IENvbXBvbmVudEVkaXRTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSB1dGlsOiBQcm9jZXNzRGVVdGlsLFxyXG4gICAgcHJpdmF0ZSBtZXNzYWdlOiBNZXNzYWdlclNlcnZpY2VcclxuICApIHsgfVxyXG5cclxuICBuZ09uSW5pdCgpIHtcclxuICB9XHJcbiAgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xyXG4gICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xyXG4gICAgICB0aGlzLmlucHV0R3JvdXAubmF0aXZlRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFxyXG4gICAgICAgICdtb3VzZWVudGVyJyxcclxuICAgICAgICB0aGlzLm9uTW91c2VFbnRlci5iaW5kKHRoaXMpXHJcbiAgICAgICk7XHJcbiAgICAgIHRoaXMuaW5wdXRHcm91cC5uYXRpdmVFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXHJcbiAgICAgICAgJ21vdXNlbGVhdmUnLFxyXG4gICAgICAgIHRoaXMub25Nb3VzZUxlYXZlLmJpbmQodGhpcylcclxuICAgICAgKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgb25Nb3VzZUVudGVyKGV2ZW50KSB7XHJcbiAgICB0aGlzLnNob3dDbGVhckJ1dHRvbiA9IHRydWU7XHJcbiAgICBpZiAodGhpcy5zaG93Q2xlYXJCdXR0b24pIHtcclxuICAgICAgdGhpcy50b2dnbGVDbGVhckljb24oZXZlbnQsIHRydWUpO1xyXG4gICAgfVxyXG4gIH1cclxuICBvbk1vdXNlTGVhdmUoZXZlbnQpIHtcclxuICAgIHRoaXMuc2hvd0NsZWFyQnV0dG9uID0gZmFsc2U7XHJcbiAgICB0aGlzLnRvZ2dsZUNsZWFySWNvbihldmVudCwgZmFsc2UpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSB0b2dnbGVDbGVhckljb24oZXZlbnQ6IGFueSwgaXNTaG93ID0gZmFsc2UpIHtcclxuICAgIGNvbnN0IHN0ciA9IGlzU2hvdyA/ICcnIDogJ25vbmUnO1xyXG4gICAgY29uc3QgY2xlYXJJY29uID0gZXZlbnQudGFyZ2V0LnF1ZXJ5U2VsZWN0b3IoJy5pbnB1dC1ncm91cC1jbGVhcicpO1xyXG4gICAgaWYgKGNsZWFySWNvbikge1xyXG4gICAgICBjbGVhckljb24uc3R5bGUuZGlzcGxheSA9IHN0cjtcclxuICAgIH1cclxuICB9XHJcblxyXG5cclxuICBjbGlja09LKCkge1xyXG4gICAgdGhpcy5ncmlkLmVuZENlbGxFZGl0KCk7XHJcbiAgICBpZiAodGhpcy52YWxpZGF0b3IoKSkge1xyXG4gICAgICB0aGlzLnN1Ym1pdEVtaXR0ZXIuZW1pdCh0aGlzLmNvbXBvbmVudCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLm1lc3NhZ2UuaW5mbygn5bCa5pyq6YCJ5oup5p6E5Lu25pa55rOVIScpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgY2xpY2tDYW5jZWwoKSB7XHJcbiAgICB0aGlzLmNsb3NlRW1pdHRlci5lbWl0KCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHZhbGlkYXRvcigpIHtcclxuICAgIGlmICghdGhpcy5jb21wb25lbnQuTWV0aG9kQ29kZSB8fCAhdGhpcy5jb21wb25lbnQuTWV0YWRhdGFJZCkge1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcbiAgYmVmb3JlRWRpdCA9IChwYXJhbTogUm93RWRpdFBhcmFtKSA9PiB7XHJcbiAgICBjb25zdCByb3dEYXRhID0gcGFyYW0ucm93RGF0YSBhcyBhbnk7XHJcbiAgICBzd2l0Y2ggKHJvd0RhdGEuZmV0Y2hWYWx1ZU1vZGUpIHtcclxuICAgICAgY2FzZSBQYXJhbWV0ZXJGZXRjaFZhbHVlTW9kZS5leHByZXNzOlxyXG4gICAgICAgIHBhcmFtLmNvbHVtbi5lZGl0b3IgPSB7XHJcbiAgICAgICAgICB0eXBlOiAnaW5wdXQtZ3JvdXAnLFxyXG4gICAgICAgICAgb3B0aW9uczoge1xyXG4gICAgICAgICAgICBncm91cFRleHQ6ICc8aSBjbGFzcz1cImYtaWNvbiBmLWljb24tbG9va3VwXCI+PC9pPicsXHJcbiAgICAgICAgICAgIGVkaXRhYmxlOiBmYWxzZSxcclxuICAgICAgICAgICAgY2xpY2tIYW5kbGU6IChlKSA9PiB7XHJcbiAgICAgICAgICAgICAgZS5mb3JtQ29udHJvbC5zZXRWYWx1ZShlLmluc3RhbmNlLnZhbHVlID8gZS5pbnN0YW5jZS52YWx1ZSA6ICcnKTtcclxuICAgICAgICAgICAgICB0aGlzLnNob3dFeHBySGVscChlKTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgY2xlYXI6IChlKSA9PiB7XHJcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2NsZWFyJywgZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlIFBhcmFtZXRlckZldGNoVmFsdWVNb2RlLm5vbmU6XHJcbiAgICAgICAgcGFyYW0uY29sdW1uLmVkaXRvciA9IHtcclxuICAgICAgICAgIHR5cGU6ICdpbnB1dC1ncm91cCcsXHJcbiAgICAgICAgICBvcHRpb25zOiB7XHJcbiAgICAgICAgICAgIGdyb3VwVGV4dDogJzxpIGNsYXNzPVwiZi1pY29uIGYtaWNvbi1sb29rdXBcIj48L2k+JyxcclxuICAgICAgICAgICAgZWRpdGFibGU6IGZhbHNlLFxyXG4gICAgICAgICAgICBjbGlja0hhbmRsZTogKGUpID0+IHtcclxuICAgICAgICAgICAgICBlLmZvcm1Db250cm9sLnNldFZhbHVlKGUuaW5zdGFuY2UudmFsdWUgPyBlLmluc3RhbmNlLnZhbHVlIDogJycpO1xyXG4gICAgICAgICAgICAgIHRoaXMuc2hvd0V4cHJIZWxwKGUpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBjbGVhcjogKGUpID0+IHtcclxuICAgICAgICAgICAgICBjb25zb2xlLmxvZygnY2xlYXInLCBlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgUGFyYW1ldGVyRmV0Y2hWYWx1ZU1vZGUuY29uc3Q6XHJcbiAgICAgICAgcGFyYW0uY29sdW1uLmVkaXRvciA9IHsgdHlwZTogRWRpdG9yVHlwZXMuVEVYVEJPWCwgb3B0aW9uczoge30gfTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSBQYXJhbWV0ZXJGZXRjaFZhbHVlTW9kZS5lbnVtOlxyXG4gICAgICAgIHBhcmFtLmNvbHVtbi5lZGl0b3IgPSB7IHR5cGU6IEVkaXRvclR5cGVzLlRFWFRCT1gsIG9wdGlvbnM6IHt9IH07XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgUGFyYW1ldGVyRmV0Y2hWYWx1ZU1vZGUuaGVscDpcclxuICAgICAgICBwYXJhbS5jb2x1bW4uZWRpdG9yID0ge1xyXG4gICAgICAgICAgdHlwZTogJ2lucHV0LWdyb3VwJyxcclxuICAgICAgICAgIG9wdGlvbnM6IHtcclxuICAgICAgICAgICAgZ3JvdXBUZXh0OiAnPGkgY2xhc3M9XCJmLWljb24gZi1pY29uLWxvb2t1cFwiPjwvaT4nLFxyXG4gICAgICAgICAgICBlZGl0YWJsZTogZmFsc2UsXHJcbiAgICAgICAgICAgIGNsaWNrSGFuZGxlOiAoZSkgPT4ge1xyXG4gICAgICAgICAgICAgIHRoaXMuY2VsbCA9IGU7XHJcbiAgICAgICAgICAgICAgdGhpcy5oZWxwSWQgPSAocm93RGF0YS5mZXRjaFZhbHVlU2V0dGluZyBhcyBIZWxwRmV0Y2hWYWx1ZVNldHRpbmcpLmhlbHBJZDtcclxuICAgICAgICAgICAgICB0aGlzLnN1ID0gKHJvd0RhdGEuZmV0Y2hWYWx1ZVNldHRpbmcgYXMgSGVscEZldGNoVmFsdWVTZXR0aW5nKS5zZXJ2aWNlVW5pdDtcclxuICAgICAgICAgICAgICB0aGlzLmdldEhlbHBJbmZvKCkuc3Vic2NyaWJlKHJlID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG1ldGEgPSByZTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGhlbHAgPSBKU09OLnBhcnNlKG1ldGEuY29udGVudCkgYXMgYW55O1xyXG4gICAgICAgICAgICAgICAgdGhpcy5oZWxwQ29scyA9IGhlbHAuZGF0YVNvdXJjZS5jb2x1bW5zO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kaXNwbGF5VHlwZSA9IGhlbHAuZGlzcGxheVR5cGU7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmhlbHBGaWVsZHMgPSB7XHJcbiAgICAgICAgICAgICAgICAgIGlkRmllbGQ6IGhlbHAuaWRGaWVsZCxcclxuICAgICAgICAgICAgICAgICAgdmFsdWVGaWVsZDogaGVscC52YWx1ZUZpZWxkLFxyXG4gICAgICAgICAgICAgICAgICB0ZXh0RmllbGQ6IGhlbHAudGV4dEZpZWxkXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgdGhpcy5sb29rdXAub25DbGVhcigpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5sb29rdXAuc2hvd0RpYWxvZygpO1xyXG4gICAgICAgICAgICAgIH0sIGVyciA9PiB7XHJcbiAgICAgICAgICAgICAgICAgIHRoaXMubWVzc2FnZS5lcnJvcign5biu5Yqp5YWD5pWw5o2u5LiN5a2Y5Zyo77yM6K+36IGU57O757O757uf566h55CG5ZGY5p+l55yL5Y6f5Zug77yBJyk7XHJcbiAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGNsZWFyOiAoZSkgPT4ge1xyXG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdjbGVhcicsIGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICBicmVhaztcclxuICAgIH1cclxuICAgIHJldHVybiBvZih0cnVlKTtcclxuICB9XHJcbiAgYWZ0ZXJFZGl0ID0gKHJvd0luZGV4OiBudW1iZXIsIHJvd0RhdGE6IGFueSwgY29sdW1uPzogRGF0YUNvbHVtbikgPT4ge1xyXG4gICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gIH1cclxuXHJcbiAgY2xlYXIoKSB7XHJcbiAgICB0aGlzLmNvbXBvbmVudCA9IG5ldyBDb21wb25lbnRFbnRpdHkoKTtcclxuICB9XHJcbiAgc2VsZWN0Q29tcG9uZW50KCkge1xyXG4gICAgY29uc3QgY29tcEZhY3RvcnkgPSB0aGlzLnJlc29sdmVyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KFNlbGVjdE1ldGFkYXRhUlRDb21wb25lbnQpO1xyXG4gICAgY29uc3QgY29tcFJlZiA9IGNvbXBGYWN0b3J5LmNyZWF0ZSh0aGlzLmluamVjdG9yKTtcclxuICAgIGNvbXBSZWYuaW5zdGFuY2UudHlwZUxpc3QgPSAnV2ViU2VydmljZUNvbXBvbmVudCc7IC8vIOebruWJjeWPquiDveagueaNruWFg+aVsOaNruexu+Wei+i/h+a7pO+8jOWQjue7rea3u+WKoOagh+etvui/h+a7pFxyXG4gICAgY29tcFJlZi5pbnN0YW5jZS5zZWxlY3RlZE1ldGFkYXRhLnN1YnNjcmliZSgoJGV2ZW50OiBNZXRhZGF0YTRSZWZEdG8pID0+IHtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBjb25zdCBtZXRhOiBNZXRhZGF0YUR0byA9ICRldmVudC5tZXRhZGF0YTtcclxuICAgICAgICB0aGlzLm9wZW5Db21wb25lbnRTZWxlY3Rvck5ldyhtZXRhLmlkLCB0aGlzLnNlc3Npb25TcmMuZ2V0VXNlclNlc3Npb25JZCgpKTtcclxuICAgICAgfSBjYXRjaCB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJyRldmVudCcsICRldmVudCk7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCfojrflj5bop6PmnpDmnoTku7blh7rplJknICsgJGV2ZW50KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgY29uc3QgbW9kYWxDb25maWcgPSB7XHJcbiAgICAgIHRpdGxlOiAn5p6E5Lu26YCJ5oupJyxcclxuICAgICAgd2lkdGg6IDk4MCxcclxuICAgICAgaGVpZ2h0OiA1NDgsXHJcbiAgICAgIHNob3dCdXR0b25zOiBmYWxzZVxyXG4gICAgfTtcclxuICAgIGNvbnN0IGRpYWxvZyA9IHRoaXMubW9kYWxTZXJ2aWNlLnNob3coY29tcFJlZiwgbW9kYWxDb25maWcpO1xyXG4gICAgY29tcFJlZi5pbnN0YW5jZS5jbG9zZU1vZGFsRW1pdHRlci5zdWJzY3JpYmUoJGV2ZW50ID0+IGRpYWxvZy5jbG9zZSgpKTtcclxuICB9XHJcbiAgcHJpdmF0ZSBvcGVuQ29tcG9uZW50U2VsZWN0b3JOZXcobWV0YWRhdGFJZDogc3RyaW5nLCBzZXNzaW9uSWQ6IHN0cmluZykge1xyXG4gICAgdGhpcy5jb21wb25lbnRTZXJ2aWNlLm9wZW5TZWxlY3RvcihtZXRhZGF0YUlkLCBzZXNzaW9uSWQpLnN1YnNjcmliZShcclxuICAgICAgKHNlbGVjdG9yUmVzdWx0OiBTZWxlY3RvclJlc3VsdCkgPT4ge1xyXG4gICAgICAgIHNlbGVjdG9yUmVzdWx0LmNvbmZpcm1FdmVudC5zdWJzY3JpYmUoXHJcbiAgICAgICAgICAocmVzdWx0OiBHc3BDb21wb25lbnQpID0+IHtcclxuICAgICAgICAgICAgaWYgKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgIHRoaXMuY29tcG9uZW50Lk5hbWUgPSByZXN1bHQubmFtZTtcclxuICAgICAgICAgICAgICB0aGlzLmNvbXBvbmVudC5NZXRhZGF0YUlkID0gcmVzdWx0LmlkO1xyXG4gICAgICAgICAgICAgIHRoaXMuY29tcG9uZW50Lk1ldGhvZENvZGUgPSByZXN1bHQub3BlcmF0aW9uc1swXS5jb2RlO1xyXG4gICAgICAgICAgICAgIC8vIHRoaXMuY29tcG9uZW50Lm1ldGhvZE5hbWUgPSByZXN1bHQub3BlcmF0aW9uc1swXS5uYW1lO1xyXG4gICAgICAgICAgICAgIHRoaXMuY29tcG9uZW50LkFjdHVhbFBhcmFtZXRlcnMgPSBbXTtcclxuXHJcbiAgICAgICAgICAgICAgaWYgKHJlc3VsdC5vcGVyYXRpb25zWzBdLnBhcmFtZXRlcnMgJiYgcmVzdWx0Lm9wZXJhdGlvbnNbMF0ucGFyYW1ldGVycy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbXBvbmVudC5BY3R1YWxQYXJhbWV0ZXJzID0gcmVzdWx0Lm9wZXJhdGlvbnNbMF0ucGFyYW1ldGVyc1xyXG4gICAgICAgICAgICAgICAgICAubWFwKChwOiBXZWJTZXJ2aWNlUGFyYW1ldGVyKSA9PiAoXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgTmFtZTogcC5jb2RlLCBWYWx1ZTogJycsIFRhZzogcC5mZXRjaFZhbHVlTW9kZS5pbmRleE9mKCdleHByZXNzLG5vbmUnKSA+IC0xID8gJ2V4cHJlc3Npb24nIDogJ2NvbnN0YW50JyxcclxuICAgICAgICAgICAgICAgICAgICAgIGZldGNoVmFsdWVNb2RlOiBwLmZldGNoVmFsdWVNb2RlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgZmV0Y2hWYWx1ZVNldHRpbmc6IHAuZmV0Y2hWYWx1ZVNldHRpbmdcclxuICAgICAgICAgICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgfSk7XHJcbiAgfVxyXG4gIHNob3dFeHBySGVscChlOiBhbnkpIHtcclxuICAgIGlmICh0aGlzLmRlc2lnbmVyU3RhdGUuc2NoZW1hcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGZvciAoY29uc3Qgc2NoZW1hIG9mIHRoaXMuZGVzaWduZXJTdGF0ZS5zY2hlbWFzKSB7XHJcbiAgICAgICAgdGhpcy5leHByLmFkZFNjaGVtYSgnU2NoZW1hJywgc2NoZW1hKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAodGhpcy5kZXNpZ25lclN0YXRlLnNjaGVtYXNbMF0uZW50aXR5VHlwZXMgJiYgdGhpcy5kZXNpZ25lclN0YXRlLnNjaGVtYXNbMF0uZW50aXR5VHlwZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIGNvbnN0IGVudGl0eVR5cGUgPSB0aGlzLmRlc2lnbmVyU3RhdGUuc2NoZW1hc1swXS5lbnRpdHlUeXBlc1swXTtcclxuICAgICAgICB0aGlzLmV4cHIuYWRkSW5qZWN0ZWRFbnRpdHkoZW50aXR5VHlwZS5uYW1lLCAnU2NoZW1hJyxcclxuICAgICAgICAgIGVudGl0eVR5cGUubmFtZSwgSW5qZWN0ZWRUeXBlLkVudGl0eVR5cGUpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBjb25zdCBjb250ZXh0ID0gbmV3IEFycmF5KCk7XHJcbiAgICBpZiAodGhpcy5kZXNpZ25lclN0YXRlLnByb2NJbnN0Q29udGV4dC5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGZvciAoY29uc3QgdmFyaWFibGUgb2YgdGhpcy5kZXNpZ25lclN0YXRlLnByb2NJbnN0Q29udGV4dCkge1xyXG4gICAgICAgIGNvbnRleHQucHVzaCh2YXJpYWJsZSk7XHJcbiAgICAgICAgLy8gdGhpcy5leHByLmFkZENvbnRleHQodmFyaWFibGUpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5kZXNpZ25lclN0YXRlLmZvcm1hbFBhcmFtZXRlckNvbnRleHQubGVuZ3RoID4gMCkge1xyXG4gICAgICBmb3IgKGNvbnN0IHZhcmlhYmxlIG9mIHRoaXMuZGVzaWduZXJTdGF0ZS5mb3JtYWxQYXJhbWV0ZXJDb250ZXh0KSB7XHJcbiAgICAgICAgaWYgKCFjb250ZXh0LnNvbWUoYyA9PiBjLmtleSA9PT0gdmFyaWFibGUua2V5KSkge1xyXG4gICAgICAgICAgY29udGV4dC5wdXNoKHZhcmlhYmxlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gdGhpcy5leHByLmFkZENvbnRleHQodmFyaWFibGUpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5kZXNpZ25lclN0YXRlLnBhcnRpY2lwYW50Q29udGV4dC5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGZvciAoY29uc3QgdmFyaWFibGUgb2YgdGhpcy5kZXNpZ25lclN0YXRlLnBhcnRpY2lwYW50Q29udGV4dCkge1xyXG4gICAgICAgIGlmICghY29udGV4dC5zb21lKGMgPT4gYy5rZXkgPT09IHZhcmlhYmxlLmtleSkpIHtcclxuICAgICAgICAgIGNvbnRleHQucHVzaCh2YXJpYWJsZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIHRoaXMuZXhwci5hZGRDb250ZXh0KHZhcmlhYmxlKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMuZGVzaWduZXJTdGF0ZS5wcm9jZXNzVmFyaWFibGVDb250ZXh0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgZm9yIChjb25zdCB2YXJpYWJsZSBvZiB0aGlzLmRlc2lnbmVyU3RhdGUucHJvY2Vzc1ZhcmlhYmxlQ29udGV4dCkge1xyXG4gICAgICAgIGlmICghY29udGV4dC5zb21lKGMgPT4gYy5rZXkgPT09IHZhcmlhYmxlLmtleSkpIHtcclxuICAgICAgICAgIGNvbnRleHQucHVzaCh2YXJpYWJsZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIHRoaXMuZXhwci5hZGRDb250ZXh0KHZhcmlhYmxlKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKGNvbnRleHQubGVuZ3RoID4gMCkge1xyXG4gICAgICBmb3IgKGNvbnN0IHYgb2YgY29udGV4dCkge1xyXG4gICAgICAgIHRoaXMuZXhwci5hZGRDb250ZXh0KHYpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICB0aGlzLmV4cHIuYWRkRXhwcmVzc2lvblRleHQoZS5pbnN0YW5jZS52YWx1ZSk7XHJcbiAgICB0aGlzLmV4cHIuYnVpbGRFeHByZXNzaW9uKCkudGhlbigoZDogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgZS5mb3JtQ29udHJvbC5zZXRWYWx1ZShkKTtcclxuICAgICAgICBlLmluc3RhbmNlLmNkLmRldGVjdENoYW5nZXMoKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXRIZWxwSW5mbygpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgcmV0dXJuIHRoaXMuc2VydmljZS5nZXRIZWxwTWV0YURhdGEodGhpcy5oZWxwSWQsIHRoaXMuc3UpO1xyXG4gIH1cclxuXHJcbiAgZGljdFBpY2tpbmcgPSAoKSA9PiB7XHJcbiAgICByZXR1cm4gb2Yoe1xyXG4gICAgICBzaG93RGlhbG9nOiB0cnVlLCBkYXRhOiB7XHJcbiAgICAgICAgaGVscElkOiB0aGlzLmhlbHBJZFxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcbiAgZGljdFBpY2tlZCA9IChyb3dEYXRhKSA9PiB7XHJcbiAgICBpZiAodGhpcy5jZWxsKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKHJvd0RhdGEpO1xyXG4gICAgICB0aGlzLmNlbGwuZm9ybUNvbnRyb2wuc2V0VmFsdWUodGhpcy51dGlsLmdldFZhbHVlKHJvd0RhdGEsIHRoaXMuaGVscEZpZWxkcy52YWx1ZUZpZWxkKSk7XHJcbiAgICAgIHRoaXMuY2VsbC5pbnN0YW5jZS5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgIHJldHVybiBvZih0cnVlKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuIl19