/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Injectable, Injector, ComponentFactoryResolver, ApplicationRef } from '@angular/core';
import { WfApprovalLogsService } from '@gsp-wf/wf-approval-logs';
import { ForecastProcessPayload, WFFlowchartService } from '@gsp-wf/ui-flowchart';
import { BsModalService } from '@farris/ui-modal';
import { Subject, of } from 'rxjs';
import { TaskService } from './service/task.service';
import { TaskAction } from './entity/task-action';
import { NotifyService } from '@farris/ui-notify';
import { I18nService } from './service/i18n/i18n.service';
import { FrameworkService } from '@gsp-sys/rtf-common';
import { TaskEntity } from './entity/task-entity';
import { TaskExecuteComponent } from './components/task-execute/task-execute.component';
import { switchMap } from 'rxjs/operators';
import { StartProcessPayload, CancelSubmitPayload } from './entity/start-process-payload';
import { ProcessSelectorComponent } from './submit/process-selector/process-selector.component';
import { LoadingService } from '@farris/ui-loading';
import { MessagerService } from '@farris/ui-messager';
import { ConfigCode, OwnerType } from './entity/task-center-config';
var WfTaskHandlerService = /** @class */ (function () {
    function WfTaskHandlerService(logService, flowchartService, injector, resolver, modalService, taskService, notify, i18nService, frameworkService, appRef) {
        this.logService = logService;
        this.flowchartService = flowchartService;
        this.injector = injector;
        this.resolver = resolver;
        this.modalService = modalService;
        this.taskService = taskService;
        this.notify = notify;
        this.i18nService = i18nService;
        this.frameworkService = frameworkService;
        this.appRef = appRef;
        this.subject = new Subject();
        this.curLanguage = localStorage.getItem('languageCode') || 'zh-CHS'; //系统当前语言
        //系统当前语言
        this.batchSubmitNum = {
            //批量提交数量
            successNum: 0,
            failedNum: 0,
            errorNum: 0,
        };
        this.batchCancelNum = {
            //批量取消提交数量
            successNum: 0,
            errorNum: 0
        };
        this.loading = this.injector.get(LoadingService);
        this.message = this.injector.get(MessagerService);
    }
    /**
     * 处理单条任务
     * @param entity 任务实体
     * @param action 任务动作
     */
    /**
     * 处理单条任务
     * @param {?} task
     * @param {?} action 任务动作
     * @return {?}
     */
    WfTaskHandlerService.prototype.execute = /**
     * 处理单条任务
     * @param {?} task
     * @param {?} action 任务动作
     * @return {?}
     */
    function (task, action) {
        switch (action.code) {
            case 'ViewBizLog': //审批日志
                this.logService.showByDataId(task.refBizId);
                break;
            case 'ViewFlowChart': //查看流程
                this.flowchartService.viewFlowChart(task.processInstanceId);
                break;
            case 'ViewExecuteForm': // 联查单据
                this.openApp(task, action);
                break;
            default: //办理类任务
                this.complete(task, action);
        }
        return this.subject.asObservable();
    };
    /**
     * @param {?} assigneeInfo
     * @param {?} openFromIframe
     * @return {?}
     */
    WfTaskHandlerService.prototype.assignByInfo = /**
     * @param {?} assigneeInfo
     * @param {?} openFromIframe
     * @return {?}
     */
    function (assigneeInfo, openFromIframe) {
        /** @type {?} */
        var assignSubject = new Subject();
        return assignSubject.asObservable();
    };
    /**
     * @private
     * @param {?} task
     * @param {?} action
     * @return {?}
     */
    WfTaskHandlerService.prototype.complete = /**
     * @private
     * @param {?} task
     * @param {?} action
     * @return {?}
     */
    function (task, action) {
        var _this = this;
        /** @type {?} */
        var compFactory = this.resolver.resolveComponentFactory(TaskExecuteComponent);
        /** @type {?} */
        var compRef = compFactory.create(this.injector);
        compRef.instance.setTask(task);
        compRef.instance.setAction(action);
        compRef.instance.addPadding();
        /** @type {?} */
        var modalConfig = {
            title: action.name ? action.name : this.i18nService.getValue('task.title'),
            width: 550,
            height: compRef.instance.dialogHeight,
            showButtons: true,
            buttons: compRef.instance.buttons
        };
        /** @type {?} */
        var dialog = this.modalService.show(compRef, modalConfig);
        compRef.instance.getSubject().subscribe(function (re) {
            re && re.result && _this.subject.next(true);
            re && re.result && dialog.close();
        });
    };
    /**
     * 打开审批联查界面
     * @param entity 任务实体
     * @param action 动作实体
     */
    /**
     * 打开审批联查界面
     * @param {?} entity 任务实体
     * @param {?} action 动作实体
     * @return {?}
     */
    WfTaskHandlerService.prototype.openApp = /**
     * 打开审批联查界面
     * @param {?} entity 任务实体
     * @param {?} action 动作实体
     * @return {?}
     */
    function (entity, action) {
        var _this = this;
        /** @type {?} */
        var taskId = entity.sourceId;
        /** @type {?} */
        var getFormInfoLoading = this.loading.show();
        this.taskService.getAppInfo(taskId).subscribe(function (formInfo) {
            getFormInfoLoading.close();
            if (!formInfo) {
                _this.notify.info(_this.i18nService.getValue('task.notFoundBill'));
                return;
            }
            /** @type {?} */
            var options = {
                appType: 'menu',
                funcId: '',
                appId: '',
                appEntrance: '',
                tabId: taskId,
                isNewTab: true
            };
            // 传工作流上下文参数
            /** @type {?} */
            var parameters = new Map();
            // 功能菜单情况
            if (formInfo.appId) {
                // 默认联查审批界面
                if (formInfo.formType === '1') { //表单嵌流程
                    parameters.set('workItemId', taskId);
                    parameters.set('procInstId', action.parameters[0].value);
                    parameters.set('taskState', entity.state);
                    parameters.set('isAssign', entity.actions.some(function (action) { return action.code === 'AssignUser'; }));
                    formInfo.parameters.forEach(function (item) {
                        return parameters.set(item.code, item.value);
                    });
                    options.funcId = formInfo.appId;
                }
                else { //流程嵌表单
                    options.funcId = 'WF0120';
                    parameters.set('taskId', entity.id);
                    parameters.set('taskState', entity.state);
                }
            }
            else if (formInfo.url) { //表单格式
                options.funcId = 'WF0120';
                parameters.set('taskId', entity.id);
                parameters.set('taskState', entity.state);
            }
            else {
                _this.notify.info(_this.i18nService.getValue('task.notFoundBill'));
                return;
            }
            options.entityParams = parameters;
            options.queryStringParams = parameters; //兼容IDP表单
            //兼容IDP表单
            /** @type {?} */
            var openMenuLoading = _this.loading.show();
            _this.frameworkService.openMenu$(options).subscribe(function () {
                openMenuLoading.close();
            });
        }, function (error) {
            getFormInfoLoading.close();
            _this.taskService.error(error);
        });
    };
    /**
     * 返回动作列表，表单嵌流程用到
     * @param workItemId
     */
    /**
     * 返回动作列表，表单嵌流程用到
     * @param {?} workItemId
     * @return {?}
     */
    WfTaskHandlerService.prototype.refreshActions = /**
     * 返回动作列表，表单嵌流程用到
     * @param {?} workItemId
     * @return {?}
     */
    function (workItemId) {
        return this.taskService.getWorkItemActions(workItemId).pipe(switchMap(function (actionList) {
            return of(actionList.filter(function (action) {
                return action.code !== 'ViewBizLog' &&
                    action.code !== 'ViewFlowChart' &&
                    action.code !== 'ViewExecuteForm';
            }));
        }));
    };
    /**
     * 根据流程实例ID和动作Code办理任务（暂未用到 by fangpengfei@2020.06.22）
     * @param procInstId 流程实例ID
     * @param state 任务状态
     * @param actionCode 动作Code
     */
    /**
     * 根据流程实例ID和动作Code办理任务（暂未用到 by fangpengfei\@2020.06.22）
     * @param {?} procInstId 流程实例ID
     * @param {?} state 任务状态
     * @param {?} actionCode 动作Code
     * @return {?}
     */
    WfTaskHandlerService.prototype.executeByProcInstId = /**
     * 根据流程实例ID和动作Code办理任务（暂未用到 by fangpengfei\@2020.06.22）
     * @param {?} procInstId 流程实例ID
     * @param {?} state 任务状态
     * @param {?} actionCode 动作Code
     * @return {?}
     */
    function (procInstId, state, actionCode) {
        var _this = this;
        /** @type {?} */
        var action = new TaskAction();
        action.code = actionCode;
        /** @type {?} */
        var subject = new Subject();
        this.taskService.getTaskByProcInstId(procInstId, state).subscribe(function (task) {
            if (task) {
                _this.execute(task, action).subscribe(function (re) {
                    subject.next(re);
                });
            }
            else {
                _this.notify.info(_this.i18nService.getValue('task.noTask'));
            }
        });
        return subject.asObservable();
    };
    /**
     * 根据workItemId 办理任务
     * @param workItemId 工作项ID
     * @param action 动作实体
     */
    /**
     * 根据workItemId 办理任务
     * @param {?} workItemId 工作项ID
     * @param {?} action 动作实体
     * @return {?}
     */
    WfTaskHandlerService.prototype.executeByWorkItemId = /**
     * 根据workItemId 办理任务
     * @param {?} workItemId 工作项ID
     * @param {?} action 动作实体
     * @return {?}
     */
    function (workItemId, action) {
        /** @type {?} */
        var task = new TaskEntity();
        task.sourceId = workItemId;
        return this.execute(task, action);
    };
    /**
     * 提交审批
     * @param payload 上下文参数
     * @returns subject true：提交成功，false：提交失败
     */
    /**
     * 提交审批
     * @param {?} payload 上下文参数
     * @return {?} subject true：提交成功，false：提交失败
     */
    WfTaskHandlerService.prototype.startProcess = /**
     * 提交审批
     * @param {?} payload 上下文参数
     * @return {?} subject true：提交成功，false：提交失败
     */
    function (payload) {
        var _this = this;
        /** @type {?} */
        var subject = new Subject();
        /** @type {?} */
        var configLoad = this.loading.show();
        this.taskService.getTaskCenterConfigByCode(ConfigCode.If_Show_Submit_Dialog, OwnerType.BizDefKey, payload.bizDefKey).subscribe(function (re) {
            configLoad.close();
            if (re && re.currentValue === 'false') { //自定义无需弹框
                //自定义无需弹框
                /** @type {?} */
                var simulateLoad_1 = _this.loading.show();
                _this.taskService.startProcessSimulate(payload).subscribe(function (response) {
                    simulateLoad_1.close();
                    if (!response || response.needInteraction === false) { //预解析无需交互
                        //预解析无需交互
                        /** @type {?} */
                        var executeLoad_1 = _this.loading.show();
                        _this.taskService.startProcess(payload).subscribe(function (response) {
                            executeLoad_1.close();
                            subject.next(response);
                            _this.handleSubmitMessage(ConfigCode.Info_After_Submit, payload.bizDefKey);
                        }, function (error) {
                            executeLoad_1.close();
                            subject.next(null);
                            _this.taskService.error(error);
                        });
                    }
                    else { //预解析需要交互
                        _this.showStartProcessDialog(payload).subscribe(function (re) {
                            subject.next(re);
                        });
                    }
                }, function (error) {
                    simulateLoad_1.close();
                    subject.next(null);
                    _this.taskService.error(error);
                });
            }
            else { //无是否弹框配置
                _this.showStartProcessDialog(payload).subscribe(function (re) {
                    subject.next(re);
                });
            }
        }, function (error) {
            configLoad.close();
            _this.taskService.error(error);
        });
        return subject.asObservable();
    };
    /**
     * 提交审批弹框
     * @param payload 参数
     * @param withResponse 是否带返回值
     */
    /**
     * 提交审批弹框
     * @private
     * @param {?} payload 参数
     * @return {?}
     */
    WfTaskHandlerService.prototype.showStartProcessDialog = /**
     * 提交审批弹框
     * @private
     * @param {?} payload 参数
     * @return {?}
     */
    function (payload) {
        var _this = this;
        /** @type {?} */
        var subject = new Subject();
        /** @type {?} */
        var compFactory = this.resolver.resolveComponentFactory(ProcessSelectorComponent);
        /** @type {?} */
        var compRef = compFactory.create(this.injector);
        compRef.instance.setParam(payload).subscribe(function () {
            /** @type {?} */
            var modalConfig = {
                title: _this.i18nService.getValue('startProcess.title'),
                width: 520,
                height: 338,
                showButtons: true,
                buttons: compRef.instance.buttons
            };
            /** @type {?} */
            var dialog = _this.modalService.show(compRef, modalConfig);
            if (payload.withResponse === true) { //内部使用
                compRef.instance.getSubjectWithResponse().subscribe(function (re) {
                    subject.next(re);
                    dialog.close();
                });
                compRef.instance.getSubjectCancel().subscribe(function () {
                    dialog.close();
                });
            }
            else { //已有业务组调用
                compRef.instance.getSubject().subscribe(function (re) {
                    subject.next(re);
                    dialog.close();
                });
                compRef.instance.getSubjectCancel().subscribe(function (re) {
                    subject.next(re);
                    dialog.close();
                });
            }
        });
        return subject.asObservable();
    };
    /**
     * 取消提交
     * @payload payload 参数
     */
    /**
     * 取消提交
     * \@payload payload 参数
     * @param {?} payload
     * @return {?}
     */
    WfTaskHandlerService.prototype.cancelSubmit = /**
     * 取消提交
     * \@payload payload 参数
     * @param {?} payload
     * @return {?}
     */
    function (payload) {
        var _this = this;
        /** @type {?} */
        var subject = new Subject();
        /** @type {?} */
        var load = this.loading.show();
        this.taskService.cancelSubmit(payload).subscribe(function () {
            load.close();
            subject.next(true);
            _this.handleSubmitMessage(ConfigCode.Info_After_Cancel_Submit, payload.bizDefKey);
        }, function (error) {
            load.close();
            subject.error(false);
            _this.taskService.error(error);
        });
        return subject.asObservable();
    };
    /**
     * 提交审批
     * @param dataId 表单id
     * @param bizDefKey 入口单据id
     * @param options 自定义配置
     */
    /**
     * 提交审批
     * @param {?} dataId 表单id
     * @param {?} bizDefKey 入口单据id
     * @return {?}
     */
    WfTaskHandlerService.prototype.submitWithBizDefKey = /**
     * 提交审批
     * @param {?} dataId 表单id
     * @param {?} bizDefKey 入口单据id
     * @return {?}
     */
    function (dataId, bizDefKey) {
        if (!dataId) {
            this.notify.warning(this.i18nService.getValue('startProcess.dataIdIsNull'));
            return;
        }
        if (!bizDefKey) {
            this.message.error(this.i18nService.getValue('startProcess.bizDefKeyIsNull'));
            return;
        }
        /** @type {?} */
        var payload = new StartProcessPayload();
        payload.dataId = dataId;
        payload.bizDefKey = bizDefKey;
        payload.withResponse = true;
        return this.startProcess(payload);
    };
    /**
     * 取消提交审批
     * @param dataId 表单id
     * @param bizDefKey 入口单据id
     * @param options 自定义配置
     */
    /**
     * 取消提交审批
     * @param {?} dataId 表单id
     * @param {?} bizDefKey 入口单据id
     * @return {?}
     */
    WfTaskHandlerService.prototype.cancelSubmitWithDataId = /**
     * 取消提交审批
     * @param {?} dataId 表单id
     * @param {?} bizDefKey 入口单据id
     * @return {?}
     */
    function (dataId, bizDefKey) {
        if (!dataId) {
            this.notify.warning(this.i18nService.getValue('startProcess.dataIdIsNull'));
            return;
        }
        if (!bizDefKey) {
            this.message.error(this.i18nService.getValue('startProcess.bizDefKeyIsNull'));
            return;
        }
        /** @type {?} */
        var cancelSubmitPayload = new CancelSubmitPayload();
        cancelSubmitPayload.dataId = dataId;
        cancelSubmitPayload.bizDefKey = bizDefKey;
        return this.cancelSubmit(cancelSubmitPayload);
    };
    /**
     * 批量提交审批
     * @param dataIds 表单ID集合
     * @param bizDefKey 入口单据id
     */
    /**
     * 批量提交审批
     * @param {?} dataIds 表单ID集合
     * @param {?} bizDefKey 入口单据id
     * @return {?}
     */
    WfTaskHandlerService.prototype.batchSubmitWithBizDefKey = /**
     * 批量提交审批
     * @param {?} dataIds 表单ID集合
     * @param {?} bizDefKey 入口单据id
     * @return {?}
     */
    function (dataIds, bizDefKey) {
        if (!dataIds || !dataIds.length) {
            this.notify.warning(this.i18nService.getValue('startProcess.dataIdIsEmpty'));
            return;
        }
        if (!bizDefKey) {
            this.message.error(this.i18nService.getValue('startProcess.bizDefKeyIsNull'));
            return;
        }
        if (dataIds.length === 1) {
            /** @type {?} */
            var startPayload = new StartProcessPayload();
            startPayload.bizDefKey = bizDefKey;
            startPayload.dataId = dataIds[0];
            return this.startProcess(startPayload);
        }
        /** @type {?} */
        var subject = new Subject();
        /** @type {?} */
        var load = this.loading.show();
        this.batchSubmitNum.successNum = 0;
        this.batchSubmitNum.failedNum = 0;
        this.batchSubmitNum.errorNum = 0;
        this.batchSubmitHelpFunction(tslib_1.__spread(dataIds), bizDefKey, function () {
            load.close();
            subject.next(true);
        });
        return subject.asObservable();
    };
    /**
     * 批量提交审批辅助函数
     */
    /**
     * 批量提交审批辅助函数
     * @private
     * @param {?} dataIds
     * @param {?} bizDefKey
     * @param {?} handler
     * @return {?}
     */
    WfTaskHandlerService.prototype.batchSubmitHelpFunction = /**
     * 批量提交审批辅助函数
     * @private
     * @param {?} dataIds
     * @param {?} bizDefKey
     * @param {?} handler
     * @return {?}
     */
    function (dataIds, bizDefKey, handler) {
        var _this = this;
        if (dataIds && dataIds.length > 0) {
            /** @type {?} */
            var dataId = dataIds.shift();
            //引用类型转换
            /** @type {?} */
            var startPayload_1 = new StartProcessPayload();
            startPayload_1.bizDefKey = bizDefKey;
            startPayload_1.dataId = dataId;
            startPayload_1.variables = { simulate: true };
            this.taskService.startProcess(startPayload_1).subscribe(function (response) {
                if (response.needInteraction) { //需要交互
                    _this.batchSubmitNum.failedNum++;
                    _this.batchSubmitHelpFunction(dataIds, bizDefKey, handler);
                }
                else { //不需要交互
                    startPayload_1.variables = { simulate: false };
                    _this.taskService.startProcess(startPayload_1).subscribe(function (response) {
                        _this.batchSubmitNum.successNum++;
                        _this.batchSubmitHelpFunction(dataIds, bizDefKey, handler);
                    }, function () {
                        _this.batchSubmitNum.errorNum++;
                        _this.batchSubmitHelpFunction(dataIds, bizDefKey, handler);
                    });
                }
            }, function () {
                _this.batchSubmitNum.errorNum++;
                _this.batchSubmitHelpFunction(dataIds, bizDefKey, handler);
            });
        }
        else { //批量执行完毕
            this.showBatchSubmitInfo(this.batchSubmitNum, bizDefKey);
            handler(); //执行回调函数
        }
    };
    /**
     * 批量取消提交审批
     * @param dataIds 表单ID集合
     * @param bizDefKey 入口单据id
     */
    /**
     * 批量取消提交审批
     * @param {?} dataIds 表单ID集合
     * @param {?} bizDefKey 入口单据id
     * @return {?}
     */
    WfTaskHandlerService.prototype.batchCancelSubmitWithDataId = /**
     * 批量取消提交审批
     * @param {?} dataIds 表单ID集合
     * @param {?} bizDefKey 入口单据id
     * @return {?}
     */
    function (dataIds, bizDefKey) {
        if (!dataIds || !dataIds.length) {
            this.notify.warning(this.i18nService.getValue('startProcess.dataIdIsEmpty'));
            return;
        }
        if (!bizDefKey) {
            this.message.error(this.i18nService.getValue('startProcess.bizDefKeyIsNull'));
            return;
        }
        if (dataIds.length === 1) {
            return this.cancelSubmitWithDataId(dataIds[0], bizDefKey);
        }
        /** @type {?} */
        var subject = new Subject();
        /** @type {?} */
        var load = this.loading.show();
        this.batchCancelNum.successNum = 0;
        this.batchCancelNum.errorNum = 0;
        this.batchCancelHelpFunction(tslib_1.__spread(dataIds), bizDefKey, function () {
            load.close();
            subject.next(true);
        });
        return subject.asObservable();
    };
    /**
     * 批量取消辅助函数
     */
    /**
     * 批量取消辅助函数
     * @private
     * @param {?} dataIds
     * @param {?} bizDefKey
     * @param {?} handler
     * @return {?}
     */
    WfTaskHandlerService.prototype.batchCancelHelpFunction = /**
     * 批量取消辅助函数
     * @private
     * @param {?} dataIds
     * @param {?} bizDefKey
     * @param {?} handler
     * @return {?}
     */
    function (dataIds, bizDefKey, handler) {
        var _this = this;
        if (dataIds && dataIds.length) {
            /** @type {?} */
            var dataId = dataIds.shift();
            //引用类型转换
            /** @type {?} */
            var cancelPayload = new CancelSubmitPayload();
            cancelPayload.dataId = dataId;
            cancelPayload.bizDefKey = bizDefKey;
            this.taskService.cancelSubmit(cancelPayload).subscribe(function () {
                _this.batchCancelNum.successNum++;
                _this.batchCancelHelpFunction(dataIds, bizDefKey, handler);
            }, function () {
                _this.batchCancelNum.errorNum++;
                _this.batchCancelHelpFunction(dataIds, bizDefKey, handler);
            });
        }
        else {
            this.showBatchCancelSubmitInfo(this.batchCancelNum, bizDefKey);
            handler();
        }
    };
    /**
     * 子表提交审批
     * @param parentDataId 主表id
     * @param childDataId 子表id
     * @param bizDefKey 入口单据id
     */
    /**
     * 子表提交审批
     * @param {?} parentDataId 主表id
     * @param {?} childDataId 子表id
     * @param {?} bizDefKey 入口单据id
     * @return {?}
     */
    WfTaskHandlerService.prototype.childSubmit = /**
     * 子表提交审批
     * @param {?} parentDataId 主表id
     * @param {?} childDataId 子表id
     * @param {?} bizDefKey 入口单据id
     * @return {?}
     */
    function (parentDataId, childDataId, bizDefKey) {
        if (!parentDataId || !childDataId) {
            this.notify.warning(this.i18nService.getValue('startProcess.dataIdIsNull'));
            return;
        }
        if (!bizDefKey) {
            this.message.error(this.i18nService.getValue('startProcess.bizDefKeyIsNull'));
            return;
        }
        /** @type {?} */
        var startProcessPayload = new StartProcessPayload();
        startProcessPayload.dataId = parentDataId + "," + childDataId;
        startProcessPayload.bizDefKey = bizDefKey;
        return this.startProcess(startProcessPayload);
    };
    /**
     * 子表取消提交审批
     * @param parentDataId 主表id
     * @param childDataId 子表id
     * @param bizDefKey 入口单据id
     */
    /**
     * 子表取消提交审批
     * @param {?} parentDataId 主表id
     * @param {?} childDataId 子表id
     * @param {?} bizDefKey 入口单据id
     * @return {?}
     */
    WfTaskHandlerService.prototype.childCancelSubmit = /**
     * 子表取消提交审批
     * @param {?} parentDataId 主表id
     * @param {?} childDataId 子表id
     * @param {?} bizDefKey 入口单据id
     * @return {?}
     */
    function (parentDataId, childDataId, bizDefKey) {
        if (!parentDataId || !childDataId) {
            this.notify.warning(this.i18nService.getValue('startProcess.dataIdIsNull'));
            return;
        }
        if (!bizDefKey) {
            this.message.error(this.i18nService.getValue('startProcess.bizDefKeyIsNull'));
            return;
        }
        /** @type {?} */
        var cancelSubmitPayload = new CancelSubmitPayload();
        cancelSubmitPayload.dataId = parentDataId + "," + childDataId;
        cancelSubmitPayload.bizDefKey = bizDefKey;
        return this.cancelSubmit(cancelSubmitPayload);
    };
    /**
     * 子表批量提交审批
     * @param parentDataId 主表id
     * @param childDataIds 子表id集合
     * @param bizDefKey 入口单据id
     */
    /**
     * 子表批量提交审批
     * @param {?} parentDataId 主表id
     * @param {?} childDataIds 子表id集合
     * @param {?} bizDefKey 入口单据id
     * @return {?}
     */
    WfTaskHandlerService.prototype.childBatchSubmit = /**
     * 子表批量提交审批
     * @param {?} parentDataId 主表id
     * @param {?} childDataIds 子表id集合
     * @param {?} bizDefKey 入口单据id
     * @return {?}
     */
    function (parentDataId, childDataIds, bizDefKey) {
        if (!parentDataId || !childDataIds) {
            this.notify.warning(this.i18nService.getValue('startProcess.dataIdIsNull'));
            return;
        }
        if (!bizDefKey) {
            this.message.error(this.i18nService.getValue('startProcess.bizDefKeyIsNull'));
            return;
        }
        /** @type {?} */
        var dataIds = childDataIds.map(function (childDataId) { return parentDataId + "," + childDataId; });
        return this.batchSubmitWithBizDefKey(dataIds, bizDefKey);
    };
    /**
     * 子表批量取消提交审批
     * @param parentDataId 主表id
     * @param childDataIds 子表id集合
     * @param bizDefKey 入口单据id
     */
    /**
     * 子表批量取消提交审批
     * @param {?} parentDataId 主表id
     * @param {?} childDataIds 子表id集合
     * @param {?} bizDefKey 入口单据id
     * @return {?}
     */
    WfTaskHandlerService.prototype.childBatchCancelSubmit = /**
     * 子表批量取消提交审批
     * @param {?} parentDataId 主表id
     * @param {?} childDataIds 子表id集合
     * @param {?} bizDefKey 入口单据id
     * @return {?}
     */
    function (parentDataId, childDataIds, bizDefKey) {
        if (!parentDataId || !childDataIds) {
            this.notify.warning(this.i18nService.getValue('startProcess.dataIdIsNull'));
            return;
        }
        if (!bizDefKey) {
            this.message.error(this.i18nService.getValue('startProcess.bizDefKeyIsNull'));
            return;
        }
        /** @type {?} */
        var dataIds = childDataIds.map(function (childDataId) { return parentDataId + "," + childDataId; });
        return this.batchCancelSubmitWithDataId(dataIds, bizDefKey);
    };
    /**
   * 批量提交提示信息
   * @param successNum 成功条数
   * @param failedNum 需要交互的条数
   * @param errorNum 执行报错的条数
   */
    /**
     * 批量提交提示信息
     * @private
     * @param {?} num
     * @param {?} bizDefKey
     * @return {?}
     */
    WfTaskHandlerService.prototype.showBatchSubmitInfo = /**
     * 批量提交提示信息
     * @private
     * @param {?} num
     * @param {?} bizDefKey
     * @return {?}
     */
    function (num, bizDefKey) {
        var _this = this;
        if (num.successNum && !num.failedNum && !num.errorNum) { //批量全部成功
            this.taskService.getTaskCenterConfigByCode(ConfigCode.Info_After_Submit, OwnerType.BizDefKey, bizDefKey).subscribe(function (config) {
                if (_this.curLanguage === 'en') {
                    _this.notify.success(JSON.parse(config.currentValue).en);
                }
                if (_this.curLanguage === 'zh-CHS') {
                    _this.notify.success(JSON.parse(config.currentValue).zh_CHS);
                }
            });
        }
        else { //非全部成功
            //非全部成功
            /** @type {?} */
            var message = '';
            num.successNum && (message += this.i18nService.getValue('batchStartProcess.success') + ("\u3010" + num.successNum + "\u3011") + this.i18nService.getValue('batchStartProcess.row'));
            num.errorNum && (message += this.i18nService.getValue('batchStartProcess.error') + ("\u3010" + num.errorNum + "\u3011") + this.i18nService.getValue('batchStartProcess.row'));
            num.failedNum && (message += this.i18nService.getValue('batchStartProcess.failed') + ("\u3010" + num.failedNum + "\u3011") + this.i18nService.getValue('batchStartProcess.row'));
            message += this.i18nService.getValue('batchStartProcess.single');
            this.message.show('warning', message, { safeHtml: false });
        }
    };
    /**
     * 批量取消提交提示信息
     */
    /**
     * 批量取消提交提示信息
     * @private
     * @param {?} num
     * @param {?} bizDefKey
     * @return {?}
     */
    WfTaskHandlerService.prototype.showBatchCancelSubmitInfo = /**
     * 批量取消提交提示信息
     * @private
     * @param {?} num
     * @param {?} bizDefKey
     * @return {?}
     */
    function (num, bizDefKey) {
        var _this = this;
        if (num.successNum && !num.errorNum) { //批量全部成功
            this.taskService.getTaskCenterConfigByCode(ConfigCode.Info_After_Cancel_Submit, OwnerType.BizDefKey, bizDefKey).subscribe(function (config) {
                if (_this.curLanguage === 'en') {
                    _this.notify.success(JSON.parse(config.currentValue).en);
                }
                if (_this.curLanguage === 'zh-CHS') {
                    _this.notify.success(JSON.parse(config.currentValue).zh_CHS);
                }
            });
        }
        else {
            /** @type {?} */
            var message = '';
            num.successNum && (message += this.i18nService.getValue('startProcess.success') + ("\u3010" + num.successNum + "\u3011") + this.i18nService.getValue('startProcess.row'));
            num.errorNum && (message += this.i18nService.getValue('startProcess.failed') + ("\u3010" + num.errorNum + "\u3011") + this.i18nService.getValue('startProcess.row'));
            this.message.show('warning', message, { safeHtml: false });
        }
    };
    /**
     * @param {?} code
     * @param {?} ownerId
     * @return {?}
     */
    WfTaskHandlerService.prototype.handleSubmitMessage = /**
     * @param {?} code
     * @param {?} ownerId
     * @return {?}
     */
    function (code, ownerId) {
        var _this = this;
        /** @type {?} */
        var load = this.loading.show();
        this.taskService.getTaskCenterConfigByCode(code, OwnerType.BizDefKey, ownerId).subscribe(function (re) {
            load.close();
            if (re && re.currentValue) {
                /** @type {?} */
                var message = '';
                /** @type {?} */
                var currentValue = JSON.parse(re.currentValue);
                _this.curLanguage === 'zh-CHS' && (message = currentValue.zh_CHS);
                _this.curLanguage === 'en' && (message = currentValue.en);
                _this.curLanguage === 'zh-CHT' && (message = currentValue.zh_CHT);
                _this.notify.success(message);
            }
            else {
                code === ConfigCode.Info_After_Submit && _this.notify.success(_this.i18nService.getValue('startProcess.submitSuccess'));
                code === ConfigCode.Info_After_Cancel_Submit && _this.notify.success(_this.i18nService.getValue('startProcess.cancelSubmitSuccess'));
            }
        }, function (error) {
            load.close();
            _this.taskService.error(error);
        });
    };
    /**
     * 表单上触发流程预解析操作
     * 已封装为表单的命令操作
     */
    /**
     * 表单上触发流程预解析操作
     * 已封装为表单的命令操作
     * @return {?}
     */
    WfTaskHandlerService.prototype.processSimulate = /**
     * 表单上触发流程预解析操作
     * 已封装为表单的命令操作
     * @return {?}
     */
    function () {
        /** @type {?} */
        var subject = new Subject();
        /** @type {?} */
        var gspWfEventService = ((/** @type {?} */ (window))).parent.gspWfEventService;
        gspWfEventService.simulate(function () {
            subject.next(true);
        });
        return subject.asObservable();
    };
    /**
     * 根据单据id查看流程图
     * 已封装为表单命令和操作
     */
    /**
     * 根据单据id查看流程图
     * 已封装为表单命令和操作
     * @param {?} dataId
     * @return {?}
     */
    WfTaskHandlerService.prototype.viewFlowChartByDataId = /**
     * 根据单据id查看流程图
     * 已封装为表单命令和操作
     * @param {?} dataId
     * @return {?}
     */
    function (dataId) {
        if (dataId) {
            this.flowchartService.viewFlowChartByDataId(dataId);
        }
        else {
            console.error("查看流程图，表单id为空");
        }
    };
    /**
     * 查看流程图（新，支持预览）
     * 已封装为表单命令和操作
     * @param bizDefKey 流程分类id
     * @param dataId 表单数据id
     */
    /**
     * 查看流程图（新，支持预览）
     * 已封装为表单命令和操作
     * @param {?} bizDefKey 流程分类id
     * @param {?} dataId 表单数据id
     * @return {?}
     */
    WfTaskHandlerService.prototype.viewFlowChartWithForecast = /**
     * 查看流程图（新，支持预览）
     * 已封装为表单命令和操作
     * @param {?} bizDefKey 流程分类id
     * @param {?} dataId 表单数据id
     * @return {?}
     */
    function (bizDefKey, dataId) {
        /** @type {?} */
        var payload = new ForecastProcessPayload();
        payload.bizDefKey = bizDefKey;
        payload.dataId = dataId;
        this.flowchartService.viewProcess(payload);
    };
    WfTaskHandlerService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    WfTaskHandlerService.ctorParameters = function () { return [
        { type: WfApprovalLogsService },
        { type: WFFlowchartService },
        { type: Injector },
        { type: ComponentFactoryResolver },
        { type: BsModalService },
        { type: TaskService },
        { type: NotifyService },
        { type: I18nService },
        { type: FrameworkService },
        { type: ApplicationRef }
    ]; };
    return WfTaskHandlerService;
}());
export { WfTaskHandlerService };
if (false) {
    /** @type {?} */
    WfTaskHandlerService.prototype.subject;
    /**
     * @type {?}
     * @private
     */
    WfTaskHandlerService.prototype.loading;
    /**
     * @type {?}
     * @private
     */
    WfTaskHandlerService.prototype.message;
    /**
     * @type {?}
     * @private
     */
    WfTaskHandlerService.prototype.curLanguage;
    /**
     * @type {?}
     * @private
     */
    WfTaskHandlerService.prototype.batchSubmitNum;
    /**
     * @type {?}
     * @private
     */
    WfTaskHandlerService.prototype.batchCancelNum;
    /**
     * @type {?}
     * @private
     */
    WfTaskHandlerService.prototype.logService;
    /**
     * @type {?}
     * @private
     */
    WfTaskHandlerService.prototype.flowchartService;
    /**
     * @type {?}
     * @private
     */
    WfTaskHandlerService.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    WfTaskHandlerService.prototype.resolver;
    /**
     * @type {?}
     * @private
     */
    WfTaskHandlerService.prototype.modalService;
    /**
     * @type {?}
     * @private
     */
    WfTaskHandlerService.prototype.taskService;
    /**
     * @type {?}
     * @private
     */
    WfTaskHandlerService.prototype.notify;
    /**
     * @type {?}
     * @private
     */
    WfTaskHandlerService.prototype.i18nService;
    /**
     * @type {?}
     * @private
     */
    WfTaskHandlerService.prototype.frameworkService;
    /**
     * @type {?}
     * @private
     */
    WfTaskHandlerService.prototype.appRef;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2YtdGFzay1oYW5kbGVyLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLXdmL3dmLXRhc2staGFuZGxlci8iLCJzb3VyY2VzIjpbImxpYi93Zi10YXNrLWhhbmRsZXIuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLHdCQUF3QixFQUFFLGNBQWMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMvRixPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQTtBQUNoRSxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUNsRixPQUFPLEVBQUUsY0FBYyxFQUFnQixNQUFNLGtCQUFrQixDQUFDO0FBQ2hFLE9BQU8sRUFBYyxPQUFPLEVBQUUsRUFBRSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQy9DLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUNyRCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFFbEQsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUMxRCxPQUFPLEVBQUUsZ0JBQWdCLEVBQWMsTUFBTSxxQkFBcUIsQ0FBQztBQUVuRSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDbEQsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sa0RBQWtELENBQUM7QUFDeEYsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzNDLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxtQkFBbUIsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBQzFGLE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxNQUFNLHNEQUFzRCxDQUFDO0FBRWhHLE9BQU8sRUFB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SW5qZWN0b3IsIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciwgQXBwbGljYXRpb25SZWYgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgV2ZBcHByb3ZhbExvZ3NTZXJ2aWNlIH0gZnJvbSAnQGdzcC13Zi93Zi1hcHByb3ZhbC1sb2dzJ1xyXG5pbXBvcnQgeyBGb3JlY2FzdFByb2Nlc3NQYXlsb2FkLCBXRkZsb3djaGFydFNlcnZpY2UgfSBmcm9tICdAZ3NwLXdmL3VpLWZsb3djaGFydCc7XHJcbmltcG9ydCB7IEJzTW9kYWxTZXJ2aWNlLCBNb2RhbE9wdGlvbnMgfSBmcm9tICdAZmFycmlzL3VpLW1vZGFsJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgU3ViamVjdCwgb2YgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgVGFza1NlcnZpY2UgfSBmcm9tICcuL3NlcnZpY2UvdGFzay5zZXJ2aWNlJztcclxuaW1wb3J0IHsgVGFza0FjdGlvbiB9IGZyb20gJy4vZW50aXR5L3Rhc2stYWN0aW9uJztcclxuaW1wb3J0IHsgQXNzaWduZWVJbmZvIH0gZnJvbSAnLi9lbnRpdHkvY29tcGxldGUtcmVzcG9uc2UnO1xyXG5pbXBvcnQgeyBOb3RpZnlTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1ub3RpZnknO1xyXG5pbXBvcnQgeyBJMThuU2VydmljZSB9IGZyb20gJy4vc2VydmljZS9pMThuL2kxOG4uc2VydmljZSc7XHJcbmltcG9ydCB7IEZyYW1ld29ya1NlcnZpY2UsIEFwcE9wdGlvbnMgfSBmcm9tICdAZ3NwLXN5cy9ydGYtY29tbW9uJztcclxuaW1wb3J0IHsgQml6Rm9ybVJlc3VsdCwgRm9ybVBhcmFtZXRlciB9IGZyb20gJy4vZW50aXR5L2JpemZvcm0nO1xyXG5pbXBvcnQgeyBUYXNrRW50aXR5IH0gZnJvbSAnLi9lbnRpdHkvdGFzay1lbnRpdHknO1xyXG5pbXBvcnQgeyBUYXNrRXhlY3V0ZUNvbXBvbmVudCB9IGZyb20gJy4vY29tcG9uZW50cy90YXNrLWV4ZWN1dGUvdGFzay1leGVjdXRlLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IHN3aXRjaE1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgU3RhcnRQcm9jZXNzUGF5bG9hZCwgQ2FuY2VsU3VibWl0UGF5bG9hZCB9IGZyb20gJy4vZW50aXR5L3N0YXJ0LXByb2Nlc3MtcGF5bG9hZCc7XHJcbmltcG9ydCB7IFByb2Nlc3NTZWxlY3RvckNvbXBvbmVudCB9IGZyb20gJy4vc3VibWl0L3Byb2Nlc3Mtc2VsZWN0b3IvcHJvY2Vzcy1zZWxlY3Rvci5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBFeGVjdXRpb25SZXNwb25zZSB9IGZyb20gJy4vZW50aXR5L2V4ZWN1dGlvbi1yZXNwb25zZSc7XHJcbmltcG9ydCB7IExvYWRpbmdTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1sb2FkaW5nJztcclxuaW1wb3J0IHsgTWVzc2FnZXJTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1tZXNzYWdlcic7XHJcbmltcG9ydCB7IEJhdGNoQ2FuY2VsTnVtYmVyLCBCYXRjaFN1Ym1pdE51bWJlciB9IGZyb20gJy4vZW50aXR5L2JhdGNoTnVtYmVyJztcclxuaW1wb3J0IHsgU2ltdWxhdGVSZXNwb25zZSB9IGZyb20gJy4vZW50aXR5L3NpbXVsYXRlLXJlc3BvbnNlJztcclxuaW1wb3J0IHsgQ29uZmlnQ29kZSwgT3duZXJUeXBlIH0gZnJvbSAnLi9lbnRpdHkvdGFzay1jZW50ZXItY29uZmlnJztcclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIFdmVGFza0hhbmRsZXJTZXJ2aWNlIHtcclxuXHJcbiAgc3ViamVjdCA9IG5ldyBTdWJqZWN0PGFueT4oKTtcclxuICBwcml2YXRlIGxvYWRpbmc6IExvYWRpbmdTZXJ2aWNlO1xyXG4gIHByaXZhdGUgbWVzc2FnZTogTWVzc2FnZXJTZXJ2aWNlO1xyXG4gIHByaXZhdGUgY3VyTGFuZ3VhZ2U6IHN0cmluZyA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdsYW5ndWFnZUNvZGUnKSB8fCAnemgtQ0hTJzsvL+ezu+e7n+W9k+WJjeivreiogFxyXG4gIHByaXZhdGUgYmF0Y2hTdWJtaXROdW06IEJhdGNoU3VibWl0TnVtYmVyID0gey8v5om56YeP5o+Q5Lqk5pWw6YePXHJcbiAgICBzdWNjZXNzTnVtOiAwLFxyXG4gICAgZmFpbGVkTnVtOiAwLFxyXG4gICAgZXJyb3JOdW06IDAsXHJcbiAgfTtcclxuICBwcml2YXRlIGJhdGNoQ2FuY2VsTnVtOiBCYXRjaENhbmNlbE51bWJlciA9IHsvL+aJuemHj+WPlua2iOaPkOS6pOaVsOmHj1xyXG4gICAgc3VjY2Vzc051bTogMCxcclxuICAgIGVycm9yTnVtOiAwXHJcbiAgfVxyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgbG9nU2VydmljZTogV2ZBcHByb3ZhbExvZ3NTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBmbG93Y2hhcnRTZXJ2aWNlOiBXRkZsb3djaGFydFNlcnZpY2UsXHJcbiAgICBwcml2YXRlIGluamVjdG9yOiBJbmplY3RvcixcclxuICAgIHByaXZhdGUgcmVzb2x2ZXI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcclxuICAgIHByaXZhdGUgbW9kYWxTZXJ2aWNlOiBCc01vZGFsU2VydmljZSxcclxuICAgIHByaXZhdGUgdGFza1NlcnZpY2U6IFRhc2tTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBub3RpZnk6IE5vdGlmeVNlcnZpY2UsXHJcbiAgICBwcml2YXRlIGkxOG5TZXJ2aWNlOiBJMThuU2VydmljZSxcclxuICAgIHByaXZhdGUgZnJhbWV3b3JrU2VydmljZTogRnJhbWV3b3JrU2VydmljZSxcclxuICAgIHByaXZhdGUgYXBwUmVmOiBBcHBsaWNhdGlvblJlZixcclxuICApIHtcclxuICAgIHRoaXMubG9hZGluZyA9IHRoaXMuaW5qZWN0b3IuZ2V0KExvYWRpbmdTZXJ2aWNlKTtcclxuICAgIHRoaXMubWVzc2FnZSA9IHRoaXMuaW5qZWN0b3IuZ2V0KE1lc3NhZ2VyU2VydmljZSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlpITnkIbljZXmnaHku7vliqFcclxuICAgKiBAcGFyYW0gZW50aXR5IOS7u+WKoeWunuS9k1xyXG4gICAqIEBwYXJhbSBhY3Rpb24g5Lu75Yqh5Yqo5L2cXHJcbiAgICovXHJcbiAgZXhlY3V0ZSh0YXNrOiBUYXNrRW50aXR5LCBhY3Rpb246IFRhc2tBY3Rpb24pOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgc3dpdGNoIChhY3Rpb24uY29kZSkge1xyXG4gICAgICBjYXNlICdWaWV3Qml6TG9nJzovL+WuoeaJueaXpeW/l1xyXG4gICAgICAgIHRoaXMubG9nU2VydmljZS5zaG93QnlEYXRhSWQodGFzay5yZWZCaXpJZCk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ1ZpZXdGbG93Q2hhcnQnOi8v5p+l55yL5rWB56iLXHJcbiAgICAgICAgdGhpcy5mbG93Y2hhcnRTZXJ2aWNlLnZpZXdGbG93Q2hhcnQodGFzay5wcm9jZXNzSW5zdGFuY2VJZCk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ1ZpZXdFeGVjdXRlRm9ybSc6Ly8g6IGU5p+l5Y2V5o2uXHJcbiAgICAgICAgdGhpcy5vcGVuQXBwKHRhc2ssIGFjdGlvbik7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGRlZmF1bHQ6IC8v5Yqe55CG57G75Lu75YqhXHJcbiAgICAgICAgdGhpcy5jb21wbGV0ZSh0YXNrLCBhY3Rpb24pO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRoaXMuc3ViamVjdC5hc09ic2VydmFibGUoKTtcclxuICB9XHJcblxyXG4gIGFzc2lnbkJ5SW5mbyhhc3NpZ25lZUluZm86IEFzc2lnbmVlSW5mbywgb3BlbkZyb21JZnJhbWU6IGJvb2xlYW4pOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgY29uc3QgYXNzaWduU3ViamVjdCA9IG5ldyBTdWJqZWN0PGFueT4oKTtcclxuICAgIHJldHVybiBhc3NpZ25TdWJqZWN0LmFzT2JzZXJ2YWJsZSgpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBjb21wbGV0ZSh0YXNrOiBUYXNrRW50aXR5LCBhY3Rpb246IFRhc2tBY3Rpb24pIHtcclxuICAgIGNvbnN0IGNvbXBGYWN0b3J5ID0gdGhpcy5yZXNvbHZlci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShUYXNrRXhlY3V0ZUNvbXBvbmVudCk7XHJcbiAgICBjb25zdCBjb21wUmVmID0gY29tcEZhY3RvcnkuY3JlYXRlKHRoaXMuaW5qZWN0b3IpO1xyXG4gICAgY29tcFJlZi5pbnN0YW5jZS5zZXRUYXNrKHRhc2spO1xyXG4gICAgY29tcFJlZi5pbnN0YW5jZS5zZXRBY3Rpb24oYWN0aW9uKTtcclxuICAgIGNvbXBSZWYuaW5zdGFuY2UuYWRkUGFkZGluZygpO1xyXG4gICAgY29uc3QgbW9kYWxDb25maWc6IE1vZGFsT3B0aW9ucyA9IHtcclxuICAgICAgdGl0bGU6IGFjdGlvbi5uYW1lID8gYWN0aW9uLm5hbWUgOiB0aGlzLmkxOG5TZXJ2aWNlLmdldFZhbHVlKCd0YXNrLnRpdGxlJyksXHJcbiAgICAgIHdpZHRoOiA1NTAsXHJcbiAgICAgIGhlaWdodDogY29tcFJlZi5pbnN0YW5jZS5kaWFsb2dIZWlnaHQsXHJcbiAgICAgIHNob3dCdXR0b25zOiB0cnVlLFxyXG4gICAgICBidXR0b25zOiBjb21wUmVmLmluc3RhbmNlLmJ1dHRvbnNcclxuICAgIH07XHJcbiAgICBjb25zdCBkaWFsb2cgPSB0aGlzLm1vZGFsU2VydmljZS5zaG93KGNvbXBSZWYsIG1vZGFsQ29uZmlnKTtcclxuICAgIGNvbXBSZWYuaW5zdGFuY2UuZ2V0U3ViamVjdCgpLnN1YnNjcmliZShyZSA9PiB7XHJcbiAgICAgIHJlICYmIHJlLnJlc3VsdCAmJiB0aGlzLnN1YmplY3QubmV4dCh0cnVlKTtcclxuICAgICAgcmUgJiYgcmUucmVzdWx0ICYmIGRpYWxvZy5jbG9zZSgpO1xyXG4gICAgfSlcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaJk+W8gOWuoeaJueiBlOafpeeVjOmdolxyXG4gICAqIEBwYXJhbSBlbnRpdHkg5Lu75Yqh5a6e5L2TXHJcbiAgICogQHBhcmFtIGFjdGlvbiDliqjkvZzlrp7kvZNcclxuICAgKi9cclxuICBvcGVuQXBwKGVudGl0eTogVGFza0VudGl0eSwgYWN0aW9uOiBUYXNrQWN0aW9uKSB7XHJcbiAgICBjb25zdCB0YXNrSWQgPSBlbnRpdHkuc291cmNlSWQ7XHJcbiAgICBjb25zdCBnZXRGb3JtSW5mb0xvYWRpbmcgPSB0aGlzLmxvYWRpbmcuc2hvdygpO1xyXG4gICAgdGhpcy50YXNrU2VydmljZS5nZXRBcHBJbmZvKHRhc2tJZCkuc3Vic2NyaWJlKChmb3JtSW5mbzogQml6Rm9ybVJlc3VsdCkgPT4ge1xyXG4gICAgICBnZXRGb3JtSW5mb0xvYWRpbmcuY2xvc2UoKTtcclxuXHJcbiAgICAgIGlmICghZm9ybUluZm8pIHtcclxuICAgICAgICB0aGlzLm5vdGlmeS5pbmZvKHRoaXMuaTE4blNlcnZpY2UuZ2V0VmFsdWUoJ3Rhc2subm90Rm91bmRCaWxsJykpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICBjb25zdCBvcHRpb25zOiBBcHBPcHRpb25zID0ge1xyXG4gICAgICAgIGFwcFR5cGU6ICdtZW51JyxcclxuICAgICAgICBmdW5jSWQ6ICcnLFxyXG4gICAgICAgIGFwcElkOiAnJyxcclxuICAgICAgICBhcHBFbnRyYW5jZTogJycsXHJcbiAgICAgICAgdGFiSWQ6IHRhc2tJZCxcclxuICAgICAgICBpc05ld1RhYjogdHJ1ZVxyXG4gICAgICB9O1xyXG4gICAgICAvLyDkvKDlt6XkvZzmtYHkuIrkuIvmloflj4LmlbBcclxuICAgICAgY29uc3QgcGFyYW1ldGVycyA9IG5ldyBNYXA8c3RyaW5nLCBhbnk+KCk7XHJcbiAgICAgIC8vIOWKn+iDveiPnOWNleaDheWGtVxyXG4gICAgICBpZiAoZm9ybUluZm8uYXBwSWQpIHtcclxuICAgICAgICAvLyDpu5jorqTogZTmn6XlrqHmibnnlYzpnaJcclxuICAgICAgICBpZiAoZm9ybUluZm8uZm9ybVR5cGUgPT09ICcxJykgey8v6KGo5Y2V5bWM5rWB56iLXHJcbiAgICAgICAgICBwYXJhbWV0ZXJzLnNldCgnd29ya0l0ZW1JZCcsIHRhc2tJZCk7XHJcbiAgICAgICAgICBwYXJhbWV0ZXJzLnNldCgncHJvY0luc3RJZCcsIGFjdGlvbi5wYXJhbWV0ZXJzWzBdLnZhbHVlKTtcclxuICAgICAgICAgIHBhcmFtZXRlcnMuc2V0KCd0YXNrU3RhdGUnLCBlbnRpdHkuc3RhdGUpO1xyXG4gICAgICAgICAgcGFyYW1ldGVycy5zZXQoJ2lzQXNzaWduJywgZW50aXR5LmFjdGlvbnMuc29tZShhY3Rpb24gPT4gYWN0aW9uLmNvZGUgPT09ICdBc3NpZ25Vc2VyJykpO1xyXG4gICAgICAgICAgZm9ybUluZm8ucGFyYW1ldGVycy5mb3JFYWNoKChpdGVtOiBGb3JtUGFyYW1ldGVyKSA9PlxyXG4gICAgICAgICAgICBwYXJhbWV0ZXJzLnNldChpdGVtLmNvZGUsIGl0ZW0udmFsdWUpXHJcbiAgICAgICAgICApO1xyXG4gICAgICAgICAgb3B0aW9ucy5mdW5jSWQgPSBmb3JtSW5mby5hcHBJZDtcclxuICAgICAgICB9IGVsc2Ugey8v5rWB56iL5bWM6KGo5Y2VXHJcbiAgICAgICAgICBvcHRpb25zLmZ1bmNJZCA9ICdXRjAxMjAnO1xyXG4gICAgICAgICAgcGFyYW1ldGVycy5zZXQoJ3Rhc2tJZCcsIGVudGl0eS5pZCk7XHJcbiAgICAgICAgICBwYXJhbWV0ZXJzLnNldCgndGFza1N0YXRlJywgZW50aXR5LnN0YXRlKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSBpZiAoZm9ybUluZm8udXJsKSB7Ly/ooajljZXmoLzlvI9cclxuICAgICAgICBvcHRpb25zLmZ1bmNJZCA9ICdXRjAxMjAnO1xyXG4gICAgICAgIHBhcmFtZXRlcnMuc2V0KCd0YXNrSWQnLCBlbnRpdHkuaWQpO1xyXG4gICAgICAgIHBhcmFtZXRlcnMuc2V0KCd0YXNrU3RhdGUnLCBlbnRpdHkuc3RhdGUpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMubm90aWZ5LmluZm8odGhpcy5pMThuU2VydmljZS5nZXRWYWx1ZSgndGFzay5ub3RGb3VuZEJpbGwnKSk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICAgIG9wdGlvbnMuZW50aXR5UGFyYW1zID0gcGFyYW1ldGVycztcclxuICAgICAgb3B0aW9ucy5xdWVyeVN0cmluZ1BhcmFtcyA9IHBhcmFtZXRlcnM7Ly/lhbzlrrlJRFDooajljZVcclxuICAgICAgY29uc3Qgb3Blbk1lbnVMb2FkaW5nID0gdGhpcy5sb2FkaW5nLnNob3coKTtcclxuICAgICAgdGhpcy5mcmFtZXdvcmtTZXJ2aWNlLm9wZW5NZW51JChvcHRpb25zKS5zdWJzY3JpYmUoKCkgPT4ge1xyXG4gICAgICAgIG9wZW5NZW51TG9hZGluZy5jbG9zZSgpO1xyXG4gICAgICB9KTtcclxuICAgIH0sIGVycm9yID0+IHtcclxuICAgICAgZ2V0Rm9ybUluZm9Mb2FkaW5nLmNsb3NlKCk7XHJcbiAgICAgIHRoaXMudGFza1NlcnZpY2UuZXJyb3IoZXJyb3IpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDov5Tlm57liqjkvZzliJfooajvvIzooajljZXltYzmtYHnqIvnlKjliLBcclxuICAgKiBAcGFyYW0gd29ya0l0ZW1JZCBcclxuICAgKi9cclxuICByZWZyZXNoQWN0aW9ucyh3b3JrSXRlbUlkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgcmV0dXJuIHRoaXMudGFza1NlcnZpY2UuZ2V0V29ya0l0ZW1BY3Rpb25zKHdvcmtJdGVtSWQpLnBpcGUoXHJcbiAgICAgIHN3aXRjaE1hcCgoYWN0aW9uTGlzdDogYW55W10pID0+IHtcclxuICAgICAgICByZXR1cm4gb2YoYWN0aW9uTGlzdC5maWx0ZXIoYWN0aW9uID0+XHJcbiAgICAgICAgICBhY3Rpb24uY29kZSAhPT0gJ1ZpZXdCaXpMb2cnICYmXHJcbiAgICAgICAgICBhY3Rpb24uY29kZSAhPT0gJ1ZpZXdGbG93Q2hhcnQnICYmXHJcbiAgICAgICAgICBhY3Rpb24uY29kZSAhPT0gJ1ZpZXdFeGVjdXRlRm9ybSdcclxuICAgICAgICApKTtcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmoLnmja7mtYHnqIvlrp7kvotJROWSjOWKqOS9nENvZGXlip7nkIbku7vliqHvvIjmmoLmnKrnlKjliLAgYnkgZmFuZ3BlbmdmZWlAMjAyMC4wNi4yMu+8iVxyXG4gICAqIEBwYXJhbSBwcm9jSW5zdElkIOa1geeoi+WunuS+i0lEXHJcbiAgICogQHBhcmFtIHN0YXRlIOS7u+WKoeeKtuaAgVxyXG4gICAqIEBwYXJhbSBhY3Rpb25Db2RlIOWKqOS9nENvZGVcclxuICAgKi9cclxuICBleGVjdXRlQnlQcm9jSW5zdElkKHByb2NJbnN0SWQ6IHN0cmluZywgc3RhdGU6IG51bWJlciwgYWN0aW9uQ29kZTogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIHZhciBhY3Rpb24gPSBuZXcgVGFza0FjdGlvbigpO1xyXG4gICAgYWN0aW9uLmNvZGUgPSBhY3Rpb25Db2RlO1xyXG4gICAgY29uc3Qgc3ViamVjdCA9IG5ldyBTdWJqZWN0KCk7XHJcbiAgICB0aGlzLnRhc2tTZXJ2aWNlLmdldFRhc2tCeVByb2NJbnN0SWQocHJvY0luc3RJZCwgc3RhdGUpLnN1YnNjcmliZSgodGFzazogVGFza0VudGl0eSkgPT4ge1xyXG4gICAgICBpZiAodGFzaykge1xyXG4gICAgICAgIHRoaXMuZXhlY3V0ZSh0YXNrLCBhY3Rpb24pLnN1YnNjcmliZShyZSA9PiB7XHJcbiAgICAgICAgICBzdWJqZWN0Lm5leHQocmUpO1xyXG4gICAgICAgIH0pXHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5ub3RpZnkuaW5mbyh0aGlzLmkxOG5TZXJ2aWNlLmdldFZhbHVlKCd0YXNrLm5vVGFzaycpKTtcclxuICAgICAgfVxyXG4gICAgfSlcclxuICAgIHJldHVybiBzdWJqZWN0LmFzT2JzZXJ2YWJsZSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5qC55o2ud29ya0l0ZW1JZCDlip7nkIbku7vliqFcclxuICAgKiBAcGFyYW0gd29ya0l0ZW1JZCDlt6XkvZzpoblJRFxyXG4gICAqIEBwYXJhbSBhY3Rpb24g5Yqo5L2c5a6e5L2TXHJcbiAgICovXHJcbiAgZXhlY3V0ZUJ5V29ya0l0ZW1JZCh3b3JrSXRlbUlkOiBzdHJpbmcsIGFjdGlvbjogVGFza0FjdGlvbik6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBsZXQgdGFzayA9IG5ldyBUYXNrRW50aXR5KCk7XHJcbiAgICB0YXNrLnNvdXJjZUlkID0gd29ya0l0ZW1JZDtcclxuICAgIHJldHVybiB0aGlzLmV4ZWN1dGUodGFzaywgYWN0aW9uKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaPkOS6pOWuoeaJuVxyXG4gICAqIEBwYXJhbSBwYXlsb2FkIOS4iuS4i+aWh+WPguaVsFxyXG4gICAqIEByZXR1cm5zIHN1YmplY3QgdHJ1Ze+8muaPkOS6pOaIkOWKn++8jGZhbHNl77ya5o+Q5Lqk5aSx6LSlIFxyXG4gICAqL1xyXG4gIHN0YXJ0UHJvY2VzcyhwYXlsb2FkOiBTdGFydFByb2Nlc3NQYXlsb2FkKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IHN1YmplY3QgPSBuZXcgU3ViamVjdCgpO1xyXG4gICAgY29uc3QgY29uZmlnTG9hZCA9IHRoaXMubG9hZGluZy5zaG93KCk7XHJcbiAgICB0aGlzLnRhc2tTZXJ2aWNlLmdldFRhc2tDZW50ZXJDb25maWdCeUNvZGUoQ29uZmlnQ29kZS5JZl9TaG93X1N1Ym1pdF9EaWFsb2csIE93bmVyVHlwZS5CaXpEZWZLZXksIHBheWxvYWQuYml6RGVmS2V5KS5zdWJzY3JpYmUocmUgPT4ge1xyXG4gICAgICBjb25maWdMb2FkLmNsb3NlKCk7XHJcbiAgICAgIGlmIChyZSAmJiByZS5jdXJyZW50VmFsdWUgPT09ICdmYWxzZScpIHsvL+iHquWumuS5ieaXoOmcgOW8ueahhlxyXG4gICAgICAgIGNvbnN0IHNpbXVsYXRlTG9hZCA9IHRoaXMubG9hZGluZy5zaG93KCk7XHJcbiAgICAgICAgdGhpcy50YXNrU2VydmljZS5zdGFydFByb2Nlc3NTaW11bGF0ZShwYXlsb2FkKS5zdWJzY3JpYmUoKHJlc3BvbnNlOiBTaW11bGF0ZVJlc3BvbnNlKSA9PiB7Ly/pooTop6PmnpBcclxuICAgICAgICAgIHNpbXVsYXRlTG9hZC5jbG9zZSgpO1xyXG4gICAgICAgICAgaWYgKCFyZXNwb25zZSB8fCByZXNwb25zZS5uZWVkSW50ZXJhY3Rpb24gPT09IGZhbHNlKSB7Ly/pooTop6PmnpDml6DpnIDkuqTkupJcclxuICAgICAgICAgICAgY29uc3QgZXhlY3V0ZUxvYWQgPSB0aGlzLmxvYWRpbmcuc2hvdygpO1xyXG4gICAgICAgICAgICB0aGlzLnRhc2tTZXJ2aWNlLnN0YXJ0UHJvY2VzcyhwYXlsb2FkKS5zdWJzY3JpYmUoKHJlc3BvbnNlOiBFeGVjdXRpb25SZXNwb25zZSkgPT4gey8v5omn6KGMXHJcbiAgICAgICAgICAgICAgZXhlY3V0ZUxvYWQuY2xvc2UoKTtcclxuICAgICAgICAgICAgICBzdWJqZWN0Lm5leHQocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgIHRoaXMuaGFuZGxlU3VibWl0TWVzc2FnZShDb25maWdDb2RlLkluZm9fQWZ0ZXJfU3VibWl0LCBwYXlsb2FkLmJpekRlZktleSk7XHJcbiAgICAgICAgICAgIH0sIGVycm9yID0+IHsvL+aJp+ihjOaKpemUmVxyXG4gICAgICAgICAgICAgIGV4ZWN1dGVMb2FkLmNsb3NlKCk7XHJcbiAgICAgICAgICAgICAgc3ViamVjdC5uZXh0KG51bGwpO1xyXG4gICAgICAgICAgICAgIHRoaXMudGFza1NlcnZpY2UuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgIH0gZWxzZSB7Ly/pooTop6PmnpDpnIDopoHkuqTkupJcclxuICAgICAgICAgICAgdGhpcy5zaG93U3RhcnRQcm9jZXNzRGlhbG9nKHBheWxvYWQpLnN1YnNjcmliZShyZSA9PiB7XHJcbiAgICAgICAgICAgICAgc3ViamVjdC5uZXh0KHJlKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSwgZXJyb3IgPT4gey8v6aKE6Kej5p6Q5oql6ZSZXHJcbiAgICAgICAgICBzaW11bGF0ZUxvYWQuY2xvc2UoKTtcclxuICAgICAgICAgIHN1YmplY3QubmV4dChudWxsKTtcclxuICAgICAgICAgIHRoaXMudGFza1NlcnZpY2UuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgIH0pXHJcbiAgICAgIH0gZWxzZSB7Ly/ml6DmmK/lkKblvLnmoYbphY3nva5cclxuICAgICAgICB0aGlzLnNob3dTdGFydFByb2Nlc3NEaWFsb2cocGF5bG9hZCkuc3Vic2NyaWJlKHJlID0+IHtcclxuICAgICAgICAgIHN1YmplY3QubmV4dChyZSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH0sIGVycm9yID0+IHsvL+iOt+WPlumFjee9ruWHuumUmVxyXG4gICAgICBjb25maWdMb2FkLmNsb3NlKCk7XHJcbiAgICAgIHRoaXMudGFza1NlcnZpY2UuZXJyb3IoZXJyb3IpO1xyXG4gICAgfSlcclxuICAgIHJldHVybiBzdWJqZWN0LmFzT2JzZXJ2YWJsZSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5o+Q5Lqk5a6h5om55by55qGGXHJcbiAgICogQHBhcmFtIHBheWxvYWQg5Y+C5pWwXHJcbiAgICogQHBhcmFtIHdpdGhSZXNwb25zZSDmmK/lkKbluKbov5Tlm57lgLxcclxuICAgKi9cclxuICBwcml2YXRlIHNob3dTdGFydFByb2Nlc3NEaWFsb2cocGF5bG9hZDogU3RhcnRQcm9jZXNzUGF5bG9hZCk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBjb25zdCBzdWJqZWN0ID0gbmV3IFN1YmplY3QoKTtcclxuICAgIGNvbnN0IGNvbXBGYWN0b3J5ID0gdGhpcy5yZXNvbHZlci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShQcm9jZXNzU2VsZWN0b3JDb21wb25lbnQpO1xyXG4gICAgY29uc3QgY29tcFJlZiA9IGNvbXBGYWN0b3J5LmNyZWF0ZSh0aGlzLmluamVjdG9yKTtcclxuICAgIGNvbXBSZWYuaW5zdGFuY2Uuc2V0UGFyYW0ocGF5bG9hZCkuc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgY29uc3QgbW9kYWxDb25maWc6IE1vZGFsT3B0aW9ucyA9IHtcclxuICAgICAgICB0aXRsZTogdGhpcy5pMThuU2VydmljZS5nZXRWYWx1ZSgnc3RhcnRQcm9jZXNzLnRpdGxlJyksXHJcbiAgICAgICAgd2lkdGg6IDUyMCxcclxuICAgICAgICBoZWlnaHQ6IDMzOCxcclxuICAgICAgICBzaG93QnV0dG9uczogdHJ1ZSxcclxuICAgICAgICBidXR0b25zOiBjb21wUmVmLmluc3RhbmNlLmJ1dHRvbnNcclxuICAgICAgfTtcclxuICAgICAgY29uc3QgZGlhbG9nID0gdGhpcy5tb2RhbFNlcnZpY2Uuc2hvdyhjb21wUmVmLCBtb2RhbENvbmZpZyk7XHJcbiAgICAgIGlmIChwYXlsb2FkLndpdGhSZXNwb25zZSA9PT0gdHJ1ZSkgey8v5YaF6YOo5L2/55SoXHJcbiAgICAgICAgY29tcFJlZi5pbnN0YW5jZS5nZXRTdWJqZWN0V2l0aFJlc3BvbnNlKCkuc3Vic2NyaWJlKHJlID0+IHtcclxuICAgICAgICAgIHN1YmplY3QubmV4dChyZSk7XHJcbiAgICAgICAgICBkaWFsb2cuY2xvc2UoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBjb21wUmVmLmluc3RhbmNlLmdldFN1YmplY3RDYW5jZWwoKS5zdWJzY3JpYmUoKCkgPT4ge1xyXG4gICAgICAgICAgZGlhbG9nLmNsb3NlKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0gZWxzZSB7Ly/lt7LmnInkuJrliqHnu4TosIPnlKhcclxuICAgICAgICBjb21wUmVmLmluc3RhbmNlLmdldFN1YmplY3QoKS5zdWJzY3JpYmUocmUgPT4ge1xyXG4gICAgICAgICAgc3ViamVjdC5uZXh0KHJlKTtcclxuICAgICAgICAgIGRpYWxvZy5jbG9zZSgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGNvbXBSZWYuaW5zdGFuY2UuZ2V0U3ViamVjdENhbmNlbCgpLnN1YnNjcmliZShyZSA9PiB7XHJcbiAgICAgICAgICBzdWJqZWN0Lm5leHQocmUpO1xyXG4gICAgICAgICAgZGlhbG9nLmNsb3NlKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIHN1YmplY3QuYXNPYnNlcnZhYmxlKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlj5bmtojmj5DkuqRcclxuICAgKiBAcGF5bG9hZCBwYXlsb2FkIOWPguaVsFxyXG4gICAqL1xyXG4gIGNhbmNlbFN1Ym1pdChwYXlsb2FkOiBDYW5jZWxTdWJtaXRQYXlsb2FkKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IHN1YmplY3QgPSBuZXcgU3ViamVjdCgpO1xyXG4gICAgY29uc3QgbG9hZCA9IHRoaXMubG9hZGluZy5zaG93KCk7XHJcbiAgICB0aGlzLnRhc2tTZXJ2aWNlLmNhbmNlbFN1Ym1pdChwYXlsb2FkKS5zdWJzY3JpYmUoKCkgPT4ge1xyXG4gICAgICBsb2FkLmNsb3NlKCk7XHJcbiAgICAgIHN1YmplY3QubmV4dCh0cnVlKTtcclxuICAgICAgdGhpcy5oYW5kbGVTdWJtaXRNZXNzYWdlKENvbmZpZ0NvZGUuSW5mb19BZnRlcl9DYW5jZWxfU3VibWl0LCBwYXlsb2FkLmJpekRlZktleSk7XHJcbiAgICB9LCBlcnJvciA9PiB7XHJcbiAgICAgIGxvYWQuY2xvc2UoKTtcclxuICAgICAgc3ViamVjdC5lcnJvcihmYWxzZSk7XHJcbiAgICAgIHRoaXMudGFza1NlcnZpY2UuZXJyb3IoZXJyb3IpO1xyXG4gICAgfSlcclxuICAgIHJldHVybiBzdWJqZWN0LmFzT2JzZXJ2YWJsZSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5o+Q5Lqk5a6h5om5XHJcbiAgICogQHBhcmFtIGRhdGFJZCDooajljZVpZFxyXG4gICAqIEBwYXJhbSBiaXpEZWZLZXkg5YWl5Y+j5Y2V5o2uaWRcclxuICAgKiBAcGFyYW0gb3B0aW9ucyDoh6rlrprkuYnphY3nva5cclxuICAgKi9cclxuICBzdWJtaXRXaXRoQml6RGVmS2V5KGRhdGFJZDogc3RyaW5nLCBiaXpEZWZLZXk6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBpZiAoIWRhdGFJZCkge1xyXG4gICAgICB0aGlzLm5vdGlmeS53YXJuaW5nKHRoaXMuaTE4blNlcnZpY2UuZ2V0VmFsdWUoJ3N0YXJ0UHJvY2Vzcy5kYXRhSWRJc051bGwnKSk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmICghYml6RGVmS2V5KSB7XHJcbiAgICAgIHRoaXMubWVzc2FnZS5lcnJvcih0aGlzLmkxOG5TZXJ2aWNlLmdldFZhbHVlKCdzdGFydFByb2Nlc3MuYml6RGVmS2V5SXNOdWxsJykpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgdmFyIHBheWxvYWQgPSBuZXcgU3RhcnRQcm9jZXNzUGF5bG9hZCgpO1xyXG4gICAgcGF5bG9hZC5kYXRhSWQgPSBkYXRhSWQ7XHJcbiAgICBwYXlsb2FkLmJpekRlZktleSA9IGJpekRlZktleTtcclxuICAgIHBheWxvYWQud2l0aFJlc3BvbnNlID0gdHJ1ZTtcclxuXHJcbiAgICByZXR1cm4gdGhpcy5zdGFydFByb2Nlc3MocGF5bG9hZCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlj5bmtojmj5DkuqTlrqHmiblcclxuICAgKiBAcGFyYW0gZGF0YUlkIOihqOWNlWlkXHJcbiAgICogQHBhcmFtIGJpekRlZktleSDlhaXlj6PljZXmja5pZFxyXG4gICAqIEBwYXJhbSBvcHRpb25zIOiHquWumuS5iemFjee9rlxyXG4gICAqL1xyXG4gIGNhbmNlbFN1Ym1pdFdpdGhEYXRhSWQoZGF0YUlkOiBzdHJpbmcsIGJpekRlZktleTogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGlmICghZGF0YUlkKSB7XHJcbiAgICAgIHRoaXMubm90aWZ5Lndhcm5pbmcodGhpcy5pMThuU2VydmljZS5nZXRWYWx1ZSgnc3RhcnRQcm9jZXNzLmRhdGFJZElzTnVsbCcpKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKCFiaXpEZWZLZXkpIHtcclxuICAgICAgdGhpcy5tZXNzYWdlLmVycm9yKHRoaXMuaTE4blNlcnZpY2UuZ2V0VmFsdWUoJ3N0YXJ0UHJvY2Vzcy5iaXpEZWZLZXlJc051bGwnKSk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHZhciBjYW5jZWxTdWJtaXRQYXlsb2FkID0gbmV3IENhbmNlbFN1Ym1pdFBheWxvYWQoKTtcclxuICAgIGNhbmNlbFN1Ym1pdFBheWxvYWQuZGF0YUlkID0gZGF0YUlkO1xyXG4gICAgY2FuY2VsU3VibWl0UGF5bG9hZC5iaXpEZWZLZXkgPSBiaXpEZWZLZXk7XHJcbiAgICByZXR1cm4gdGhpcy5jYW5jZWxTdWJtaXQoY2FuY2VsU3VibWl0UGF5bG9hZCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmibnph4/mj5DkuqTlrqHmiblcclxuICAgKiBAcGFyYW0gZGF0YUlkcyDooajljZVJROmbhuWQiFxyXG4gICAqIEBwYXJhbSBiaXpEZWZLZXkg5YWl5Y+j5Y2V5o2uaWRcclxuICAgKi9cclxuICBiYXRjaFN1Ym1pdFdpdGhCaXpEZWZLZXkoZGF0YUlkczogc3RyaW5nW10sIGJpekRlZktleTogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGlmICghZGF0YUlkcyB8fCAhZGF0YUlkcy5sZW5ndGgpIHtcclxuICAgICAgdGhpcy5ub3RpZnkud2FybmluZyh0aGlzLmkxOG5TZXJ2aWNlLmdldFZhbHVlKCdzdGFydFByb2Nlc3MuZGF0YUlkSXNFbXB0eScpKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKCFiaXpEZWZLZXkpIHtcclxuICAgICAgdGhpcy5tZXNzYWdlLmVycm9yKHRoaXMuaTE4blNlcnZpY2UuZ2V0VmFsdWUoJ3N0YXJ0UHJvY2Vzcy5iaXpEZWZLZXlJc051bGwnKSk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmIChkYXRhSWRzLmxlbmd0aCA9PT0gMSkge1xyXG4gICAgICB2YXIgc3RhcnRQYXlsb2FkID0gbmV3IFN0YXJ0UHJvY2Vzc1BheWxvYWQoKVxyXG4gICAgICBzdGFydFBheWxvYWQuYml6RGVmS2V5ID0gYml6RGVmS2V5O1xyXG4gICAgICBzdGFydFBheWxvYWQuZGF0YUlkID0gZGF0YUlkc1swXTtcclxuICAgICAgcmV0dXJuIHRoaXMuc3RhcnRQcm9jZXNzKHN0YXJ0UGF5bG9hZCk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3Qgc3ViamVjdCA9IG5ldyBTdWJqZWN0KCk7XHJcbiAgICBjb25zdCBsb2FkID0gdGhpcy5sb2FkaW5nLnNob3coKTtcclxuICAgIHRoaXMuYmF0Y2hTdWJtaXROdW0uc3VjY2Vzc051bSA9IDA7XHJcbiAgICB0aGlzLmJhdGNoU3VibWl0TnVtLmZhaWxlZE51bSA9IDA7XHJcbiAgICB0aGlzLmJhdGNoU3VibWl0TnVtLmVycm9yTnVtID0gMDtcclxuICAgIHRoaXMuYmF0Y2hTdWJtaXRIZWxwRnVuY3Rpb24oWy4uLmRhdGFJZHNdLCBiaXpEZWZLZXksICgpID0+IHtcclxuICAgICAgbG9hZC5jbG9zZSgpO1xyXG4gICAgICBzdWJqZWN0Lm5leHQodHJ1ZSk7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiBzdWJqZWN0LmFzT2JzZXJ2YWJsZSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5om56YeP5o+Q5Lqk5a6h5om56L6F5Yqp5Ye95pWwXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBiYXRjaFN1Ym1pdEhlbHBGdW5jdGlvbihkYXRhSWRzOiBzdHJpbmdbXSwgYml6RGVmS2V5OiBzdHJpbmcsIGhhbmRsZXI6IEZ1bmN0aW9uKSB7XHJcbiAgICBpZiAoZGF0YUlkcyAmJiBkYXRhSWRzLmxlbmd0aCA+IDApIHtcclxuICAgICAgY29uc3QgZGF0YUlkID0gZGF0YUlkcy5zaGlmdCgpOy8v5byV55So57G75Z6L6L2s5o2iXHJcbiAgICAgIGxldCBzdGFydFBheWxvYWQgPSBuZXcgU3RhcnRQcm9jZXNzUGF5bG9hZCgpXHJcbiAgICAgIHN0YXJ0UGF5bG9hZC5iaXpEZWZLZXkgPSBiaXpEZWZLZXk7XHJcbiAgICAgIHN0YXJ0UGF5bG9hZC5kYXRhSWQgPSBkYXRhSWQ7XHJcbiAgICAgIHN0YXJ0UGF5bG9hZC52YXJpYWJsZXMgPSB7IHNpbXVsYXRlOiB0cnVlIH07XHJcbiAgICAgIHRoaXMudGFza1NlcnZpY2Uuc3RhcnRQcm9jZXNzKHN0YXJ0UGF5bG9hZCkuc3Vic2NyaWJlKChyZXNwb25zZTogRXhlY3V0aW9uUmVzcG9uc2UpID0+IHtcclxuICAgICAgICBpZiAocmVzcG9uc2UubmVlZEludGVyYWN0aW9uKSB7Ly/pnIDopoHkuqTkupJcclxuICAgICAgICAgIHRoaXMuYmF0Y2hTdWJtaXROdW0uZmFpbGVkTnVtKys7XHJcbiAgICAgICAgICB0aGlzLmJhdGNoU3VibWl0SGVscEZ1bmN0aW9uKGRhdGFJZHMsIGJpekRlZktleSwgaGFuZGxlcik7XHJcbiAgICAgICAgfSBlbHNlIHsvL+S4jemcgOimgeS6pOS6klxyXG4gICAgICAgICAgc3RhcnRQYXlsb2FkLnZhcmlhYmxlcyA9IHsgc2ltdWxhdGU6IGZhbHNlIH07XHJcbiAgICAgICAgICB0aGlzLnRhc2tTZXJ2aWNlLnN0YXJ0UHJvY2VzcyhzdGFydFBheWxvYWQpLnN1YnNjcmliZSgocmVzcG9uc2U6IEV4ZWN1dGlvblJlc3BvbnNlKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuYmF0Y2hTdWJtaXROdW0uc3VjY2Vzc051bSsrO1xyXG4gICAgICAgICAgICB0aGlzLmJhdGNoU3VibWl0SGVscEZ1bmN0aW9uKGRhdGFJZHMsIGJpekRlZktleSwgaGFuZGxlcik7XHJcbiAgICAgICAgICB9LCAoKSA9PiB7Ly/lrp7pmYXmj5DkuqTmiqXplJlcclxuICAgICAgICAgICAgdGhpcy5iYXRjaFN1Ym1pdE51bS5lcnJvck51bSsrO1xyXG4gICAgICAgICAgICB0aGlzLmJhdGNoU3VibWl0SGVscEZ1bmN0aW9uKGRhdGFJZHMsIGJpekRlZktleSwgaGFuZGxlcik7XHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgIH1cclxuICAgICAgfSwgKCkgPT4gey8v5qih5ouf5o+Q5Lqk5oql6ZSZXHJcbiAgICAgICAgdGhpcy5iYXRjaFN1Ym1pdE51bS5lcnJvck51bSsrO1xyXG4gICAgICAgIHRoaXMuYmF0Y2hTdWJtaXRIZWxwRnVuY3Rpb24oZGF0YUlkcywgYml6RGVmS2V5LCBoYW5kbGVyKTtcclxuICAgICAgfSlcclxuICAgIH0gZWxzZSB7Ly/mibnph4/miafooYzlrozmr5VcclxuICAgICAgdGhpcy5zaG93QmF0Y2hTdWJtaXRJbmZvKHRoaXMuYmF0Y2hTdWJtaXROdW0sIGJpekRlZktleSk7XHJcbiAgICAgIGhhbmRsZXIoKTsvL+aJp+ihjOWbnuiwg+WHveaVsFxyXG4gICAgfVxyXG5cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaJuemHj+WPlua2iOaPkOS6pOWuoeaJuVxyXG4gICAqIEBwYXJhbSBkYXRhSWRzIOihqOWNlUlE6ZuG5ZCIXHJcbiAgICogQHBhcmFtIGJpekRlZktleSDlhaXlj6PljZXmja5pZFxyXG4gICAqL1xyXG4gIGJhdGNoQ2FuY2VsU3VibWl0V2l0aERhdGFJZChkYXRhSWRzOiBzdHJpbmdbXSwgYml6RGVmS2V5OiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgaWYgKCFkYXRhSWRzIHx8ICFkYXRhSWRzLmxlbmd0aCkge1xyXG4gICAgICB0aGlzLm5vdGlmeS53YXJuaW5nKHRoaXMuaTE4blNlcnZpY2UuZ2V0VmFsdWUoJ3N0YXJ0UHJvY2Vzcy5kYXRhSWRJc0VtcHR5JykpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAoIWJpekRlZktleSkge1xyXG4gICAgICB0aGlzLm1lc3NhZ2UuZXJyb3IodGhpcy5pMThuU2VydmljZS5nZXRWYWx1ZSgnc3RhcnRQcm9jZXNzLmJpekRlZktleUlzTnVsbCcpKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKGRhdGFJZHMubGVuZ3RoID09PSAxKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLmNhbmNlbFN1Ym1pdFdpdGhEYXRhSWQoZGF0YUlkc1swXSwgYml6RGVmS2V5KTtcclxuICAgIH1cclxuICAgIGNvbnN0IHN1YmplY3QgPSBuZXcgU3ViamVjdCgpO1xyXG4gICAgY29uc3QgbG9hZCA9IHRoaXMubG9hZGluZy5zaG93KCk7XHJcbiAgICB0aGlzLmJhdGNoQ2FuY2VsTnVtLnN1Y2Nlc3NOdW0gPSAwO1xyXG4gICAgdGhpcy5iYXRjaENhbmNlbE51bS5lcnJvck51bSA9IDA7XHJcbiAgICB0aGlzLmJhdGNoQ2FuY2VsSGVscEZ1bmN0aW9uKFsuLi5kYXRhSWRzXSwgYml6RGVmS2V5LCAoKSA9PiB7XHJcbiAgICAgIGxvYWQuY2xvc2UoKTtcclxuICAgICAgc3ViamVjdC5uZXh0KHRydWUpO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gc3ViamVjdC5hc09ic2VydmFibGUoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaJuemHj+WPlua2iOi+heWKqeWHveaVsFxyXG4gICAqL1xyXG4gIHByaXZhdGUgYmF0Y2hDYW5jZWxIZWxwRnVuY3Rpb24oZGF0YUlkczogc3RyaW5nW10sIGJpekRlZktleTogc3RyaW5nLCBoYW5kbGVyOiBGdW5jdGlvbikge1xyXG4gICAgaWYgKGRhdGFJZHMgJiYgZGF0YUlkcy5sZW5ndGgpIHtcclxuICAgICAgY29uc3QgZGF0YUlkID0gZGF0YUlkcy5zaGlmdCgpOy8v5byV55So57G75Z6L6L2s5o2iXHJcbiAgICAgIGxldCBjYW5jZWxQYXlsb2FkID0gbmV3IENhbmNlbFN1Ym1pdFBheWxvYWQoKTtcclxuICAgICAgY2FuY2VsUGF5bG9hZC5kYXRhSWQgPSBkYXRhSWQ7XHJcbiAgICAgIGNhbmNlbFBheWxvYWQuYml6RGVmS2V5ID0gYml6RGVmS2V5O1xyXG4gICAgICB0aGlzLnRhc2tTZXJ2aWNlLmNhbmNlbFN1Ym1pdChjYW5jZWxQYXlsb2FkKS5zdWJzY3JpYmUoKCkgPT4gey8v5Y+W5raI5oiQ5YqfXHJcbiAgICAgICAgdGhpcy5iYXRjaENhbmNlbE51bS5zdWNjZXNzTnVtKys7XHJcbiAgICAgICAgdGhpcy5iYXRjaENhbmNlbEhlbHBGdW5jdGlvbihkYXRhSWRzLCBiaXpEZWZLZXksIGhhbmRsZXIpO1xyXG4gICAgICB9LCAoKSA9PiB7Ly/lj5bmtojlpLHotKVcclxuICAgICAgICB0aGlzLmJhdGNoQ2FuY2VsTnVtLmVycm9yTnVtKys7XHJcbiAgICAgICAgdGhpcy5iYXRjaENhbmNlbEhlbHBGdW5jdGlvbihkYXRhSWRzLCBiaXpEZWZLZXksIGhhbmRsZXIpO1xyXG4gICAgICB9KVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5zaG93QmF0Y2hDYW5jZWxTdWJtaXRJbmZvKHRoaXMuYmF0Y2hDYW5jZWxOdW0sIGJpekRlZktleSk7XHJcbiAgICAgIGhhbmRsZXIoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWtkOihqOaPkOS6pOWuoeaJuVxyXG4gICAqIEBwYXJhbSBwYXJlbnREYXRhSWQg5Li76KGoaWRcclxuICAgKiBAcGFyYW0gY2hpbGREYXRhSWQg5a2Q6KGoaWRcclxuICAgKiBAcGFyYW0gYml6RGVmS2V5IOWFpeWPo+WNleaNrmlkXHJcbiAgICovXHJcbiAgY2hpbGRTdWJtaXQocGFyZW50RGF0YUlkOiBzdHJpbmcsIGNoaWxkRGF0YUlkOiBzdHJpbmcsIGJpekRlZktleTogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGlmICghcGFyZW50RGF0YUlkIHx8ICFjaGlsZERhdGFJZCkge1xyXG4gICAgICB0aGlzLm5vdGlmeS53YXJuaW5nKHRoaXMuaTE4blNlcnZpY2UuZ2V0VmFsdWUoJ3N0YXJ0UHJvY2Vzcy5kYXRhSWRJc051bGwnKSk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmICghYml6RGVmS2V5KSB7XHJcbiAgICAgIHRoaXMubWVzc2FnZS5lcnJvcih0aGlzLmkxOG5TZXJ2aWNlLmdldFZhbHVlKCdzdGFydFByb2Nlc3MuYml6RGVmS2V5SXNOdWxsJykpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB2YXIgc3RhcnRQcm9jZXNzUGF5bG9hZCA9IG5ldyBTdGFydFByb2Nlc3NQYXlsb2FkKCk7XHJcbiAgICBzdGFydFByb2Nlc3NQYXlsb2FkLmRhdGFJZCA9IGAke3BhcmVudERhdGFJZH0sJHtjaGlsZERhdGFJZH1gO1xyXG4gICAgc3RhcnRQcm9jZXNzUGF5bG9hZC5iaXpEZWZLZXkgPSBiaXpEZWZLZXk7XHJcbiAgICByZXR1cm4gdGhpcy5zdGFydFByb2Nlc3Moc3RhcnRQcm9jZXNzUGF5bG9hZCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlrZDooajlj5bmtojmj5DkuqTlrqHmiblcclxuICAgKiBAcGFyYW0gcGFyZW50RGF0YUlkIOS4u+ihqGlkXHJcbiAgICogQHBhcmFtIGNoaWxkRGF0YUlkIOWtkOihqGlkXHJcbiAgICogQHBhcmFtIGJpekRlZktleSDlhaXlj6PljZXmja5pZFxyXG4gICAqL1xyXG4gIGNoaWxkQ2FuY2VsU3VibWl0KHBhcmVudERhdGFJZDogc3RyaW5nLCBjaGlsZERhdGFJZDogc3RyaW5nLCBiaXpEZWZLZXk6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBpZiAoIXBhcmVudERhdGFJZCB8fCAhY2hpbGREYXRhSWQpIHtcclxuICAgICAgdGhpcy5ub3RpZnkud2FybmluZyh0aGlzLmkxOG5TZXJ2aWNlLmdldFZhbHVlKCdzdGFydFByb2Nlc3MuZGF0YUlkSXNOdWxsJykpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAoIWJpekRlZktleSkge1xyXG4gICAgICB0aGlzLm1lc3NhZ2UuZXJyb3IodGhpcy5pMThuU2VydmljZS5nZXRWYWx1ZSgnc3RhcnRQcm9jZXNzLmJpekRlZktleUlzTnVsbCcpKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdmFyIGNhbmNlbFN1Ym1pdFBheWxvYWQgPSBuZXcgQ2FuY2VsU3VibWl0UGF5bG9hZCgpO1xyXG4gICAgY2FuY2VsU3VibWl0UGF5bG9hZC5kYXRhSWQgPSBgJHtwYXJlbnREYXRhSWR9LCR7Y2hpbGREYXRhSWR9YDtcclxuICAgIGNhbmNlbFN1Ym1pdFBheWxvYWQuYml6RGVmS2V5ID0gYml6RGVmS2V5O1xyXG4gICAgcmV0dXJuIHRoaXMuY2FuY2VsU3VibWl0KGNhbmNlbFN1Ym1pdFBheWxvYWQpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5a2Q6KGo5om56YeP5o+Q5Lqk5a6h5om5XHJcbiAgICogQHBhcmFtIHBhcmVudERhdGFJZCDkuLvooahpZFxyXG4gICAqIEBwYXJhbSBjaGlsZERhdGFJZHMg5a2Q6KGoaWTpm4blkIhcclxuICAgKiBAcGFyYW0gYml6RGVmS2V5IOWFpeWPo+WNleaNrmlkXHJcbiAgICovXHJcbiAgY2hpbGRCYXRjaFN1Ym1pdChwYXJlbnREYXRhSWQ6IHN0cmluZywgY2hpbGREYXRhSWRzOiBzdHJpbmdbXSwgYml6RGVmS2V5OiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgaWYgKCFwYXJlbnREYXRhSWQgfHwgIWNoaWxkRGF0YUlkcykge1xyXG4gICAgICB0aGlzLm5vdGlmeS53YXJuaW5nKHRoaXMuaTE4blNlcnZpY2UuZ2V0VmFsdWUoJ3N0YXJ0UHJvY2Vzcy5kYXRhSWRJc051bGwnKSk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmICghYml6RGVmS2V5KSB7XHJcbiAgICAgIHRoaXMubWVzc2FnZS5lcnJvcih0aGlzLmkxOG5TZXJ2aWNlLmdldFZhbHVlKCdzdGFydFByb2Nlc3MuYml6RGVmS2V5SXNOdWxsJykpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBjb25zdCBkYXRhSWRzID0gY2hpbGREYXRhSWRzLm1hcChjaGlsZERhdGFJZCA9PiBgJHtwYXJlbnREYXRhSWR9LCR7Y2hpbGREYXRhSWR9YCk7XHJcbiAgICByZXR1cm4gdGhpcy5iYXRjaFN1Ym1pdFdpdGhCaXpEZWZLZXkoZGF0YUlkcywgYml6RGVmS2V5KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWtkOihqOaJuemHj+WPlua2iOaPkOS6pOWuoeaJuVxyXG4gICAqIEBwYXJhbSBwYXJlbnREYXRhSWQg5Li76KGoaWRcclxuICAgKiBAcGFyYW0gY2hpbGREYXRhSWRzIOWtkOihqGlk6ZuG5ZCIXHJcbiAgICogQHBhcmFtIGJpekRlZktleSDlhaXlj6PljZXmja5pZFxyXG4gICAqL1xyXG4gIGNoaWxkQmF0Y2hDYW5jZWxTdWJtaXQocGFyZW50RGF0YUlkOiBzdHJpbmcsIGNoaWxkRGF0YUlkczogc3RyaW5nW10sIGJpekRlZktleTogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGlmICghcGFyZW50RGF0YUlkIHx8ICFjaGlsZERhdGFJZHMpIHtcclxuICAgICAgdGhpcy5ub3RpZnkud2FybmluZyh0aGlzLmkxOG5TZXJ2aWNlLmdldFZhbHVlKCdzdGFydFByb2Nlc3MuZGF0YUlkSXNOdWxsJykpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAoIWJpekRlZktleSkge1xyXG4gICAgICB0aGlzLm1lc3NhZ2UuZXJyb3IodGhpcy5pMThuU2VydmljZS5nZXRWYWx1ZSgnc3RhcnRQcm9jZXNzLmJpekRlZktleUlzTnVsbCcpKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgY29uc3QgZGF0YUlkcyA9IGNoaWxkRGF0YUlkcy5tYXAoY2hpbGREYXRhSWQgPT4gYCR7cGFyZW50RGF0YUlkfSwke2NoaWxkRGF0YUlkfWApO1xyXG4gICAgcmV0dXJuIHRoaXMuYmF0Y2hDYW5jZWxTdWJtaXRXaXRoRGF0YUlkKGRhdGFJZHMsIGJpekRlZktleSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICog5om56YeP5o+Q5Lqk5o+Q56S65L+h5oGvXHJcbiAqIEBwYXJhbSBzdWNjZXNzTnVtIOaIkOWKn+adoeaVsFxyXG4gKiBAcGFyYW0gZmFpbGVkTnVtIOmcgOimgeS6pOS6kueahOadoeaVsFxyXG4gKiBAcGFyYW0gZXJyb3JOdW0g5omn6KGM5oql6ZSZ55qE5p2h5pWwXHJcbiAqL1xyXG4gIHByaXZhdGUgc2hvd0JhdGNoU3VibWl0SW5mbyhudW06IEJhdGNoU3VibWl0TnVtYmVyLCBiaXpEZWZLZXk6IHN0cmluZykge1xyXG4gICAgaWYgKG51bS5zdWNjZXNzTnVtICYmICFudW0uZmFpbGVkTnVtICYmICFudW0uZXJyb3JOdW0pIHsvL+aJuemHj+WFqOmDqOaIkOWKn1xyXG4gICAgICB0aGlzLnRhc2tTZXJ2aWNlLmdldFRhc2tDZW50ZXJDb25maWdCeUNvZGUoQ29uZmlnQ29kZS5JbmZvX0FmdGVyX1N1Ym1pdCwgT3duZXJUeXBlLkJpekRlZktleSwgYml6RGVmS2V5KS5zdWJzY3JpYmUoKGNvbmZpZzogYW55KSA9PiB7XHJcbiAgICAgICAgaWYgKHRoaXMuY3VyTGFuZ3VhZ2UgPT09ICdlbicpIHtcclxuICAgICAgICAgIHRoaXMubm90aWZ5LnN1Y2Nlc3MoSlNPTi5wYXJzZShjb25maWcuY3VycmVudFZhbHVlKS5lbik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmN1ckxhbmd1YWdlID09PSAnemgtQ0hTJykge1xyXG4gICAgICAgICAgdGhpcy5ub3RpZnkuc3VjY2VzcyhKU09OLnBhcnNlKGNvbmZpZy5jdXJyZW50VmFsdWUpLnpoX0NIUyk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gICAgfSBlbHNlIHsvL+mdnuWFqOmDqOaIkOWKn1xyXG4gICAgICBsZXQgbWVzc2FnZSA9ICcnO1xyXG4gICAgICBudW0uc3VjY2Vzc051bSAmJiAobWVzc2FnZSArPSB0aGlzLmkxOG5TZXJ2aWNlLmdldFZhbHVlKCdiYXRjaFN0YXJ0UHJvY2Vzcy5zdWNjZXNzJykgKyBg44CQJHtudW0uc3VjY2Vzc051bX3jgJFgICsgdGhpcy5pMThuU2VydmljZS5nZXRWYWx1ZSgnYmF0Y2hTdGFydFByb2Nlc3Mucm93JykpO1xyXG4gICAgICBudW0uZXJyb3JOdW0gJiYgKG1lc3NhZ2UgKz0gdGhpcy5pMThuU2VydmljZS5nZXRWYWx1ZSgnYmF0Y2hTdGFydFByb2Nlc3MuZXJyb3InKSArIGDjgJAke251bS5lcnJvck51bX3jgJFgICsgdGhpcy5pMThuU2VydmljZS5nZXRWYWx1ZSgnYmF0Y2hTdGFydFByb2Nlc3Mucm93JykpO1xyXG4gICAgICBudW0uZmFpbGVkTnVtICYmIChtZXNzYWdlICs9IHRoaXMuaTE4blNlcnZpY2UuZ2V0VmFsdWUoJ2JhdGNoU3RhcnRQcm9jZXNzLmZhaWxlZCcpICsgYOOAkCR7bnVtLmZhaWxlZE51bX3jgJFgICsgdGhpcy5pMThuU2VydmljZS5nZXRWYWx1ZSgnYmF0Y2hTdGFydFByb2Nlc3Mucm93JykpO1xyXG4gICAgICBtZXNzYWdlICs9IHRoaXMuaTE4blNlcnZpY2UuZ2V0VmFsdWUoJ2JhdGNoU3RhcnRQcm9jZXNzLnNpbmdsZScpO1xyXG4gICAgICB0aGlzLm1lc3NhZ2Uuc2hvdygnd2FybmluZycsIG1lc3NhZ2UsIHsgc2FmZUh0bWw6IGZhbHNlIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5om56YeP5Y+W5raI5o+Q5Lqk5o+Q56S65L+h5oGvXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzaG93QmF0Y2hDYW5jZWxTdWJtaXRJbmZvKG51bTogQmF0Y2hDYW5jZWxOdW1iZXIsIGJpekRlZktleTogc3RyaW5nKSB7XHJcbiAgICBpZiAobnVtLnN1Y2Nlc3NOdW0gJiYgIW51bS5lcnJvck51bSkgey8v5om56YeP5YWo6YOo5oiQ5YqfXHJcbiAgICAgIHRoaXMudGFza1NlcnZpY2UuZ2V0VGFza0NlbnRlckNvbmZpZ0J5Q29kZShDb25maWdDb2RlLkluZm9fQWZ0ZXJfQ2FuY2VsX1N1Ym1pdCwgT3duZXJUeXBlLkJpekRlZktleSwgYml6RGVmS2V5KS5zdWJzY3JpYmUoKGNvbmZpZzogYW55KSA9PiB7XHJcbiAgICAgICAgaWYgKHRoaXMuY3VyTGFuZ3VhZ2UgPT09ICdlbicpIHtcclxuICAgICAgICAgIHRoaXMubm90aWZ5LnN1Y2Nlc3MoSlNPTi5wYXJzZShjb25maWcuY3VycmVudFZhbHVlKS5lbik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmN1ckxhbmd1YWdlID09PSAnemgtQ0hTJykge1xyXG4gICAgICAgICAgdGhpcy5ub3RpZnkuc3VjY2VzcyhKU09OLnBhcnNlKGNvbmZpZy5jdXJyZW50VmFsdWUpLnpoX0NIUyk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgbGV0IG1lc3NhZ2UgPSAnJztcclxuICAgICAgbnVtLnN1Y2Nlc3NOdW0gJiYgKG1lc3NhZ2UgKz0gdGhpcy5pMThuU2VydmljZS5nZXRWYWx1ZSgnc3RhcnRQcm9jZXNzLnN1Y2Nlc3MnKSArIGDjgJAke251bS5zdWNjZXNzTnVtfeOAkWAgKyB0aGlzLmkxOG5TZXJ2aWNlLmdldFZhbHVlKCdzdGFydFByb2Nlc3Mucm93JykpO1xyXG4gICAgICBudW0uZXJyb3JOdW0gJiYgKG1lc3NhZ2UgKz0gdGhpcy5pMThuU2VydmljZS5nZXRWYWx1ZSgnc3RhcnRQcm9jZXNzLmZhaWxlZCcpICsgYOOAkCR7bnVtLmVycm9yTnVtfeOAkWAgKyB0aGlzLmkxOG5TZXJ2aWNlLmdldFZhbHVlKCdzdGFydFByb2Nlc3Mucm93JykpO1xyXG4gICAgICB0aGlzLm1lc3NhZ2Uuc2hvdygnd2FybmluZycsIG1lc3NhZ2UsIHsgc2FmZUh0bWw6IGZhbHNlIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgaGFuZGxlU3VibWl0TWVzc2FnZShjb2RlOiBzdHJpbmcsIG93bmVySWQ6IHN0cmluZykge1xyXG4gICAgY29uc3QgbG9hZCA9IHRoaXMubG9hZGluZy5zaG93KCk7XHJcbiAgICB0aGlzLnRhc2tTZXJ2aWNlLmdldFRhc2tDZW50ZXJDb25maWdCeUNvZGUoY29kZSwgT3duZXJUeXBlLkJpekRlZktleSwgb3duZXJJZCkuc3Vic2NyaWJlKHJlID0+IHtcclxuICAgICAgbG9hZC5jbG9zZSgpO1xyXG4gICAgICBpZiAocmUgJiYgcmUuY3VycmVudFZhbHVlKSB7XHJcbiAgICAgICAgbGV0IG1lc3NhZ2UgPSAnJztcclxuICAgICAgICBjb25zdCBjdXJyZW50VmFsdWUgPSBKU09OLnBhcnNlKHJlLmN1cnJlbnRWYWx1ZSk7XHJcbiAgICAgICAgdGhpcy5jdXJMYW5ndWFnZSA9PT0gJ3poLUNIUycgJiYgKG1lc3NhZ2UgPSBjdXJyZW50VmFsdWUuemhfQ0hTKTtcclxuICAgICAgICB0aGlzLmN1ckxhbmd1YWdlID09PSAnZW4nICYmIChtZXNzYWdlID0gY3VycmVudFZhbHVlLmVuKTtcclxuICAgICAgICB0aGlzLmN1ckxhbmd1YWdlID09PSAnemgtQ0hUJyAmJiAobWVzc2FnZSA9IGN1cnJlbnRWYWx1ZS56aF9DSFQpO1xyXG4gICAgICAgIHRoaXMubm90aWZ5LnN1Y2Nlc3MobWVzc2FnZSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29kZSA9PT0gQ29uZmlnQ29kZS5JbmZvX0FmdGVyX1N1Ym1pdCAmJiB0aGlzLm5vdGlmeS5zdWNjZXNzKHRoaXMuaTE4blNlcnZpY2UuZ2V0VmFsdWUoJ3N0YXJ0UHJvY2Vzcy5zdWJtaXRTdWNjZXNzJykpO1xyXG4gICAgICAgIGNvZGUgPT09IENvbmZpZ0NvZGUuSW5mb19BZnRlcl9DYW5jZWxfU3VibWl0ICYmIHRoaXMubm90aWZ5LnN1Y2Nlc3ModGhpcy5pMThuU2VydmljZS5nZXRWYWx1ZSgnc3RhcnRQcm9jZXNzLmNhbmNlbFN1Ym1pdFN1Y2Nlc3MnKSk7XHJcbiAgICAgIH1cclxuICAgIH0sIGVycm9yID0+IHtcclxuICAgICAgbG9hZC5jbG9zZSgpO1xyXG4gICAgICB0aGlzLnRhc2tTZXJ2aWNlLmVycm9yKGVycm9yKTtcclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDooajljZXkuIrop6blj5HmtYHnqIvpooTop6PmnpDmk43kvZxcclxuICAgKiDlt7LlsIHoo4XkuLrooajljZXnmoTlkb3ku6Tmk43kvZxcclxuICAgKi9cclxuICBwcm9jZXNzU2ltdWxhdGUoKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IHN1YmplY3QgPSBuZXcgU3ViamVjdCgpO1xyXG4gICAgY29uc3QgZ3NwV2ZFdmVudFNlcnZpY2UgPSAod2luZG93IGFzIGFueSkucGFyZW50LmdzcFdmRXZlbnRTZXJ2aWNlO1xyXG4gICAgZ3NwV2ZFdmVudFNlcnZpY2Uuc2ltdWxhdGUoKCkgPT4ge1xyXG4gICAgICBzdWJqZWN0Lm5leHQodHJ1ZSk7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiBzdWJqZWN0LmFzT2JzZXJ2YWJsZSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5qC55o2u5Y2V5o2uaWTmn6XnnIvmtYHnqIvlm75cclxuICAgKiDlt7LlsIHoo4XkuLrooajljZXlkb3ku6Tlkozmk43kvZxcclxuICAgKi9cclxuICB2aWV3Rmxvd0NoYXJ0QnlEYXRhSWQoZGF0YUlkOiBzdHJpbmcpIHtcclxuICAgIGlmIChkYXRhSWQpIHtcclxuICAgICAgdGhpcy5mbG93Y2hhcnRTZXJ2aWNlLnZpZXdGbG93Q2hhcnRCeURhdGFJZChkYXRhSWQpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY29uc29sZS5lcnJvcihcIuafpeeci+a1geeoi+Wbvu+8jOihqOWNlWlk5Li656m6XCIpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5p+l55yL5rWB56iL5Zu+77yI5paw77yM5pSv5oyB6aKE6KeI77yJXHJcbiAgICog5bey5bCB6KOF5Li66KGo5Y2V5ZG95Luk5ZKM5pON5L2cXHJcbiAgICogQHBhcmFtIGJpekRlZktleSDmtYHnqIvliIbnsbtpZFxyXG4gICAqIEBwYXJhbSBkYXRhSWQg6KGo5Y2V5pWw5o2uaWRcclxuICAgKi9cclxuICB2aWV3Rmxvd0NoYXJ0V2l0aEZvcmVjYXN0KGJpekRlZktleTogc3RyaW5nLCBkYXRhSWQ6IHN0cmluZykge1xyXG4gICAgbGV0IHBheWxvYWQgPSBuZXcgRm9yZWNhc3RQcm9jZXNzUGF5bG9hZCgpO1xyXG4gICAgcGF5bG9hZC5iaXpEZWZLZXkgPSBiaXpEZWZLZXk7XHJcbiAgICBwYXlsb2FkLmRhdGFJZCA9IGRhdGFJZDtcclxuICAgIHRoaXMuZmxvd2NoYXJ0U2VydmljZS52aWV3UHJvY2VzcyhwYXlsb2FkKTtcclxuICB9XHJcblxyXG5cclxuXHJcbn1cclxuIl19