/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { DatagridComponent } from './../../datagrid.component';
import { Utils } from './../../utils/utils';
import { Input, ElementRef, Directive, Injector, NgZone, Renderer2 } from '@angular/core';
import { CommonUtils } from '@farris/ui-common';
import { DomHandler } from '../../services/domhandler';
export class DatagridCellTooltipDirective {
    /**
     * @param {?} el
     * @param {?} injector
     */
    constructor(el, injector) {
        this.el = el;
        this.injector = injector;
        this.position = 'top-left';
        this.delay = 1000;
        this.cls = '';
        this.type = 'info';
        this.tipMode = 'auto';
        this.showTipTimer = null;
        this._mouseenter = null;
        this._mouseleave = null;
        this._mouseclick = null;
        this.ngZone = null;
        this.render = null;
        if (this.injector) {
            this.commonUtils = this.injector.get(CommonUtils, new CommonUtils());
            this.ngZone = this.injector.get(NgZone);
            this.render = this.injector.get(Renderer2);
            this.dg = this.injector.get(DatagridComponent);
        }
        else {
            this.commonUtils = new CommonUtils();
        }
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        if (this.ngZone) {
            this.ngZone.runOutsideAngular((/**
             * @return {?}
             */
            () => {
                this._mouseenter = Utils.on(this.el.nativeElement, 'mouseenter', this.onMouseEnter.bind(this), { target: '.f-datagrid-cell-content', options: { capture: true } });
                this._mouseleave = Utils.on(this.el.nativeElement, 'mouseleave', this.onMouseLeave.bind(this), { target: '.f-datagrid-cell-content', options: { capture: true } });
                this._mouseclick = Utils.on(this.el.nativeElement, 'mousedown', this.onClick.bind(this));
            }));
        }
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.hide();
        if (this._mouseenter) {
            this._mouseenter();
        }
        if (this._mouseleave) {
            this._mouseleave();
        }
        if (this._mouseclick) {
            this._mouseclick();
        }
        // this.dg = null;
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onMouseEnter($event) {
        if ($event.fromElement) {
            if (!$event.fromElement.closest('.f-datagrid')) {
                return;
            }
        }
        /** @type {?} */
        const cellTiptimer = this.dg ? this.dg.cellTipTimer : 1000;
        if (this.showTipTimer) {
            clearTimeout(this.showTipTimer);
            this.showTipTimer = null;
        }
        this.showTipTimer = setTimeout((/**
         * @return {?}
         */
        () => {
            this.show($event);
        }), cellTiptimer);
    }
    /**
     * @return {?}
     */
    onMouseLeave() {
        this.hide();
    }
    /**
     * @param {?} e
     * @return {?}
     */
    onClick(e) {
        // e.stopPropagation();
        this.hide();
    }
    /**
     * @private
     * @return {?}
     */
    getTextContainer() {
        return DomHandler.findSingle(this.container, '.f-tooltip-text');
    }
    /**
     * @private
     * @param {?} target
     * @return {?}
     */
    donotShowTips(target) {
        /** @type {?} */
        const tdWidth = target.offsetWidth;
        /** @type {?} */
        const tagetSty = window.getComputedStyle(target);
        /** @type {?} */
        const txtWidth = this.commonUtils.getTextWidth(this.message, tagetSty.font);
        const { paddingLeft, paddingRight } = tagetSty;
        /** @type {?} */
        const _width = tdWidth - (Number(paddingLeft.replace('px', '')) || 0) - (Number(paddingRight.replace('px', '')) || 0);
        /** @type {?} */
        let tr = target.closest('tr');
        if (tr) {
            /** @type {?} */
            const trId = tr.id;
            tr = document.querySelector('#' + trId);
        }
        if (this.tipMode === 'auto') {
            if (tr) {
                return _width && _width > txtWidth;
            }
            return true;
        }
        else {
            return tr ? false : true;
        }
    }
    /**
     * @return {?}
     */
    hide() {
        if (this.showTipTimer) {
            clearTimeout(this.showTipTimer);
            this.showTipTimer = null;
        }
        if (this.container && this.container.parentElement) {
            document.body.removeChild(this.container);
        }
        this.container = null;
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    show($event) {
        /** @type {?} */
        const cellEl = (/** @type {?} */ ($event.target));
        this.enable = cellEl.getAttribute('cell-tooltip') === 'true';
        this.message = cellEl.getAttribute('message');
        this.tipMode = cellEl.getAttribute('tipMode') || 'auto';
        if (!this.enable || !this.message) {
            return;
        }
        /** @type {?} */
        const tipWidth = cellEl.getAttribute('tipWidth');
        /** @type {?} */
        const tipHeight = cellEl.getAttribute('tipHeight');
        this.position = cellEl.getAttribute('position') || 'top-left';
        // 检查下内容宽度是否超出列宽
        if (this.donotShowTips($event.target)) {
            return;
        }
        // const boxEl = this.el.nativeElement;
        /** @type {?} */
        const boxEl = $event.target;
        /** @type {?} */
        const elSize = this.getBoxSizeObj(boxEl);
        /** 如果存在则不新建，只需要修改里面的内容 */
        if (!this.container) {
            this.create(elSize);
        }
        else {
            DomHandler.findSingle(this.container, '.f-tooltip-text').innerHTML = this.message;
        }
        this.container.style.maxWidth = `${window.innerWidth - 30}px`;
        this.container.style.minWidth = '35px';
        if (tipWidth) {
            this.container.style.width = tipWidth;
        }
        if (tipHeight) {
            this.container.style.height = tipHeight;
        }
        /** @type {?} */
        const offset = DomHandler.getOffset(boxEl);
        /** @type {?} */
        const targetTop = offset.top;
        /** @type {?} */
        const targetLeft = offset.left;
        /** @type {?} */
        let left;
        /** @type {?} */
        let top;
        this.container.style.display = 'block';
        this.changeTooltipPosition(boxEl);
        /** @type {?} */
        const arrow = DomHandler.findSingle(this.container, '.f-tooltip-arrow');
        /** @type {?} */
        const tooltipSize = this.getTooltipSize();
        // 检查内容高度
        if (window.innerHeight - 10 < tooltipSize.height) {
            this.container.style.height = `${window.innerHeight - 20}px`;
            tooltipSize.height = window.innerHeight - 25;
            /** @type {?} */
            const textContainer = this.getTextContainer();
            textContainer.style.height = `${tooltipSize.height}px`;
            textContainer.style.overflow = 'hidden';
        }
        /** @type {?} */
        const n = this.updateArrowPosition(arrow, offset, $event);
        switch (this.position) {
            case 'right':
                left = targetLeft + elSize.width;
                top = n;
                break;
            case 'left':
                left = targetLeft - tooltipSize.width;
                top = n;
                break;
            case 'top-left':
                top = targetTop - tooltipSize.height - 7;
                left = n;
                break;
        }
        if (left) {
            this.container.style.left = left + 'px';
        }
        this.container.style.top = top + 'px';
        this.container.style.zIndex = 999999;
    }
    /**
     * @private
     * @param {?} arrow
     * @param {?} elOffset
     * @param {?} $event
     * @return {?}
     */
    updateArrowPosition(arrow, elOffset, $event) {
        /** @type {?} */
        const tooltipSize = this.getTooltipSize();
        if (this.position === 'left' || this.position === 'right') {
            /** @type {?} */
            const targetTop = elOffset.top;
            /** @type {?} */
            const halfHeight = tooltipSize.height / 2;
            /** @type {?} */
            let top = 10;
            if (targetTop > halfHeight && window.innerHeight - targetTop > halfHeight) {
                top = targetTop - tooltipSize.height / 2;
            }
            // 调整箭头的位置
            if (arrow) {
                arrow.style.top = `${targetTop - top}px`;
            }
            return top;
        }
        else if (this.position === 'top-left') {
            /** @type {?} */
            let left = $event.pageX - tooltipSize.width / 2;
            if (left < 10) {
                left = elOffset.left;
            }
            if (left + tooltipSize.width > window.innerWidth) {
                left = window.innerWidth - tooltipSize.width - 20;
            }
            // 调整箭头的位置
            if (arrow) {
                if ($event.pageX - left > 28) {
                    if ($event.pageX - left + 28 > tooltipSize.width) {
                        arrow.style.left = `${tooltipSize.width - 28}px`;
                    }
                    else {
                        arrow.style.left = `${$event.pageX - left}px`;
                    }
                }
            }
            return left;
        }
    }
    /**
     * @param {?} elSize
     * @return {?}
     */
    create(elSize) {
        /** @type {?} */
        let styleClass = this.tooltipCls();
        this.container = document.createElement('div');
        if (this.tooltipStyleClass) {
            styleClass += ' ' + this.tooltipStyleClass;
        }
        this.container.className = styleClass;
        /** @type {?} */
        const tooltipArrow = document.createElement('div');
        tooltipArrow.className = 'f-tooltip-arrow ';
        this.container.appendChild(tooltipArrow);
        /** @type {?} */
        const tooltipText = document.createElement('div');
        tooltipText.className = 'f-tooltip-text ';
        tooltipText.innerHTML = this.message;
        /** @type {?} */
        const maxWidth = window.innerWidth - 50;
        tooltipText.style.maxWidth = `${maxWidth}px`;
        tooltipText.style.wordBreak = 'break-all';
        this.container.style.textAlign = 'center';
        if (this.positionStyle) {
            this.container.style.position = this.positionStyle;
        }
        this.container.appendChild(tooltipText);
        document.body.appendChild(this.container);
    }
    /**
     * @private
     * @return {?}
     */
    tooltipCls() {
        return 'datagrid-cell-tooltip f-tooltip ' + this.getThemeCls() + ' f-tooltip-' + this.position + ' ' + this.cls;
    }
    /**
     * @private
     * @return {?}
     */
    getThemeCls() {
        if (this.type) {
            return 'f-tooltip-' + this.type;
        }
        return '';
    }
    /**
     * 获取宿主尺寸
     * @private
     * @param {?} boxEl
     * @return {?}
     */
    getBoxSizeObj(boxEl) {
        /** @type {?} */
        const p = boxEl.getBoundingClientRect();
        return {
            width: DomHandler.getOuterWidth(boxEl),
            height: DomHandler.getOuterHeight(boxEl),
            left: p.left,
            right: p.right,
            top: p.top,
            bottom: p.bottom
        };
    }
    /**
     * 获取tooltip 容器尺寸
     * @private
     * @return {?}
     */
    getTooltipSize() {
        return {
            width: DomHandler.getOuterWidth(this.container),
            height: DomHandler.getOuterHeight(this.container)
        };
    }
    /**
     * 获取窗口尺寸
     * @private
     * @return {?}
     */
    getWindowSize() {
        return {
            width: window.innerWidth,
            height: window.innerHeight
        };
    }
    /**
     * 根据内容的多少，自动更改tooltip 的位置
     * @private
     * @param {?} boxEl
     * @return {?}
     */
    changeTooltipPosition(boxEl) {
        /** @type {?} */
        const boxSize = this.getBoxSizeObj(boxEl);
        /** @type {?} */
        const tooltip = this.getTooltipSize();
        /** @type {?} */
        const winSize = this.getWindowSize();
        this.container.className = this.tooltipCls();
        if (tooltip.width < winSize.width && tooltip.height < boxSize.top) {
            // this.position = 'top-left';
            return;
        }
        else {
            /** @type {?} */
            const elOffset = DomHandler.getOffset(boxEl);
            /** @type {?} */
            const elLeft = elOffset.left;
            /** @type {?} */
            const elRight = winSize.width - elLeft - boxSize.width;
            if (elLeft > elRight) {
                this.position = 'left';
            }
            else {
                this.position = 'right';
            }
            /** @type {?} */
            const toolTipTextWidth = elLeft > elRight ? elLeft : elRight;
            /** @type {?} */
            const textEl = this.getTextContainer();
            textEl.style.maxWidth = `${toolTipTextWidth - 30}px`;
            this.container.style.maxWidth = `${toolTipTextWidth}px`;
        }
    }
}
DatagridCellTooltipDirective.decorators = [
    { type: Directive, args: [{
                selector: '[cell-tooltip]',
                exportAs: 'cellTooltip'
            },] }
];
/** @nocollapse */
DatagridCellTooltipDirective.ctorParameters = () => [
    { type: ElementRef },
    { type: Injector }
];
DatagridCellTooltipDirective.propDecorators = {
    enable: [{ type: Input, args: ['cell-tooltip',] }],
    position: [{ type: Input }],
    positionStyle: [{ type: Input }],
    tooltipStyleClass: [{ type: Input }],
    message: [{ type: Input }],
    delay: [{ type: Input }],
    cls: [{ type: Input }],
    type: [{ type: Input }],
    tipMode: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    DatagridCellTooltipDirective.prototype.enable;
    /** @type {?} */
    DatagridCellTooltipDirective.prototype.position;
    /** @type {?} */
    DatagridCellTooltipDirective.prototype.positionStyle;
    /** @type {?} */
    DatagridCellTooltipDirective.prototype.tooltipStyleClass;
    /** @type {?} */
    DatagridCellTooltipDirective.prototype.message;
    /** @type {?} */
    DatagridCellTooltipDirective.prototype.delay;
    /** @type {?} */
    DatagridCellTooltipDirective.prototype.cls;
    /** @type {?} */
    DatagridCellTooltipDirective.prototype.type;
    /** @type {?} */
    DatagridCellTooltipDirective.prototype.tipMode;
    /** @type {?} */
    DatagridCellTooltipDirective.prototype.container;
    /**
     * @type {?}
     * @private
     */
    DatagridCellTooltipDirective.prototype.commonUtils;
    /**
     * @type {?}
     * @private
     */
    DatagridCellTooltipDirective.prototype.showTipTimer;
    /**
     * @type {?}
     * @private
     */
    DatagridCellTooltipDirective.prototype._mouseenter;
    /**
     * @type {?}
     * @private
     */
    DatagridCellTooltipDirective.prototype._mouseleave;
    /**
     * @type {?}
     * @private
     */
    DatagridCellTooltipDirective.prototype._mouseclick;
    /**
     * @type {?}
     * @private
     */
    DatagridCellTooltipDirective.prototype.ngZone;
    /**
     * @type {?}
     * @private
     */
    DatagridCellTooltipDirective.prototype.render;
    /**
     * @type {?}
     * @private
     */
    DatagridCellTooltipDirective.prototype.dg;
    /**
     * @type {?}
     * @private
     */
    DatagridCellTooltipDirective.prototype.el;
    /**
     * @type {?}
     * @private
     */
    DatagridCellTooltipDirective.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2VsbC10b29sdGlwLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktZGF0YWdyaWQvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy90b29sdGlwL2NlbGwtdG9vbHRpcC5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBQy9ELE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUM1QyxPQUFPLEVBQWEsS0FBSyxFQUFnQixVQUFVLEVBQUUsU0FBUyxFQUFFLFFBQVEsRUFBVSxNQUFNLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNILE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNoRCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFNdkQsTUFBTSxPQUFPLDRCQUE0Qjs7Ozs7SUF5QnJDLFlBQW9CLEVBQWMsRUFBVSxRQUFrQjtRQUExQyxPQUFFLEdBQUYsRUFBRSxDQUFZO1FBQVUsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQXZCckQsYUFBUSxHQUFrRixVQUFVLENBQUM7UUFJckcsVUFBSyxHQUFHLElBQUksQ0FBQztRQUViLFFBQUcsR0FBRyxFQUFFLENBQUM7UUFDVCxTQUFJLEdBQThDLE1BQU0sQ0FBQztRQUN6RCxZQUFPLEdBQXVCLE1BQU0sQ0FBQztRQU10QyxpQkFBWSxHQUFHLElBQUksQ0FBQztRQUdwQixnQkFBVyxHQUFHLElBQUksQ0FBQztRQUNuQixnQkFBVyxHQUFHLElBQUksQ0FBQztRQUNuQixnQkFBVyxHQUFHLElBQUksQ0FBQztRQUNuQixXQUFNLEdBQVcsSUFBSSxDQUFDO1FBQ3RCLFdBQU0sR0FBYyxJQUFJLENBQUM7UUFHN0IsSUFBSSxJQUFJLENBQUMsUUFBUSxFQUFFO1lBQ2YsSUFBSSxDQUFDLFdBQVcsR0FBRyxJ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Qjs7Ozs7SUFDOUIsOENBQWlDOzs7OztJQUNqQywwQ0FBOEI7Ozs7O0lBQ2xCLDBDQUFzQjs7Ozs7SUFBRSxnREFBMEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEYXRhZ3JpZENvbXBvbmVudCB9IGZyb20gJy4vLi4vLi4vZGF0YWdyaWQuY29tcG9uZW50JztcclxuaW1wb3J0IHsgVXRpbHMgfSBmcm9tICcuLy4uLy4uL3V0aWxzL3V0aWxzJztcclxuaW1wb3J0IHsgT25EZXN0cm95LCBJbnB1dCwgSG9zdExpc3RlbmVyLCBFbGVtZW50UmVmLCBEaXJlY3RpdmUsIEluamVjdG9yLCBPbkluaXQsIE5nWm9uZSwgUmVuZGVyZXIyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IENvbW1vblV0aWxzIH0gZnJvbSAnQGZhcnJpcy91aS1jb21tb24nO1xyXG5pbXBvcnQgeyBEb21IYW5kbGVyIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvZG9taGFuZGxlcic7XHJcblxyXG5ARGlyZWN0aXZlKHtcclxuICAgIHNlbGVjdG9yOiAnW2NlbGwtdG9vbHRpcF0nLFxyXG4gICAgZXhwb3J0QXM6ICdjZWxsVG9vbHRpcCdcclxufSlcclxuZXhwb3J0IGNsYXNzIERhdGFncmlkQ2VsbFRvb2x0aXBEaXJlY3RpdmUgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSB7XHJcbiAgICBASW5wdXQoJ2NlbGwtdG9vbHRpcCcpIGVuYWJsZTogYm9vbGVhbjtcclxuICAgIEBJbnB1dCgpIHBvc2l0aW9uOiAndG9wJyB8ICdib3R0b20nIHwgJ2xlZnQnIHwgJ3JpZ2h0JyB8ICd0b3AtbGVmdCcgfCAndG9wLWNlbnRlcicgfCAndG9wLXJpZ2h0JyA9ICd0b3AtbGVmdCc7XHJcbiAgICBASW5wdXQoKSBwb3NpdGlvblN0eWxlOiBzdHJpbmc7XHJcbiAgICBASW5wdXQoKSB0b29sdGlwU3R5bGVDbGFzczogc3RyaW5nO1xyXG4gICAgQElucHV0KCkgbWVzc2FnZTogc3RyaW5nO1xyXG4gICAgQElucHV0KCkgZGVsYXkgPSAxMDAwO1xyXG5cclxuICAgIEBJbnB1dCgpIGNscyA9ICcnO1xyXG4gICAgQElucHV0KCkgdHlwZTogJ2RhbmdlcicgfCAnc3VjY2VzcycgfCAnaW5mbycgfCAnd2FybmluZycgPSAnaW5mbyc7XHJcbiAgICBASW5wdXQoKSB0aXBNb2RlOiAnYWxsd2F5cycgfCAnYXV0bycgPSAnYXV0byc7XHJcblxyXG4gICAgLy8gQEhvc3RCaW5kaW5nKCdzdHlsZS53aWR0aCcpIGNtcFdpZHRoID0gJzEwMCUnO1xyXG5cclxuICAgIGNvbnRhaW5lcjogYW55O1xyXG4gICAgcHJpdmF0ZSBjb21tb25VdGlsczogQ29tbW9uVXRpbHM7XHJcbiAgICBwcml2YXRlIHNob3dUaXBUaW1lciA9IG51bGw7XHJcblxyXG5cclxuICAgIHByaXZhdGUgX21vdXNlZW50ZXIgPSBudWxsO1xyXG4gICAgcHJpdmF0ZSBfbW91c2VsZWF2ZSA9IG51bGw7XHJcbiAgICBwcml2YXRlIF9tb3VzZWNsaWNrID0gbnVsbDtcclxuICAgIHByaXZhdGUgbmdab25lOiBOZ1pvbmUgPSBudWxsO1xyXG4gICAgcHJpdmF0ZSByZW5kZXI6IFJlbmRlcmVyMiA9IG51bGw7XHJcbiAgICBwcml2YXRlIGRnOiBEYXRhZ3JpZENvbXBvbmVudDtcclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgZWw6IEVsZW1lbnRSZWYsIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuaW5qZWN0b3IpIHtcclxuICAgICAgICAgICAgdGhpcy5jb21tb25VdGlscyA9IHRoaXMuaW5qZWN0b3IuZ2V0KENvbW1vblV0aWxzLCBuZXcgQ29tbW9uVXRpbHMoKSk7XHJcbiAgICAgICAgICAgIHRoaXMubmdab25lID0gdGhpcy5pbmplY3Rvci5nZXQoTmdab25lKTtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXIgPSB0aGlzLmluamVjdG9yLmdldChSZW5kZXJlcjIpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5kZyA9IHRoaXMuaW5qZWN0b3IuZ2V0KERhdGFncmlkQ29tcG9uZW50KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmNvbW1vblV0aWxzID0gbmV3IENvbW1vblV0aWxzKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCkge1xyXG4gICAgICAgIGlmICh0aGlzLm5nWm9uZSkge1xyXG4gICAgICAgICAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9tb3VzZWVudGVyID0gVXRpbHMub24odGhpcy5lbC5uYXRpdmVFbGVtZW50LCAnbW91c2VlbnRlcicsIHRoaXMub25Nb3VzZUVudGVyLmJpbmQodGhpcyksIHsgdGFyZ2V0OiAnLmYtZGF0YWdyaWQtY2VsbC1jb250ZW50Jywgb3B0aW9uczogeyBjYXB0dXJlOiB0cnVlIH19KTtcclxuICAgICAgICAgICAgICAgIHRoaXMuX21vdXNlbGVhdmUgPSBVdGlscy5vbih0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsICdtb3VzZWxlYXZlJywgdGhpcy5vbk1vdXNlTGVhdmUuYmluZCh0aGlzKSwgeyB0YXJnZXQ6ICcuZi1kYXRhZ3JpZC1jZWxsLWNvbnRlbnQnLCBvcHRpb25zOiB7IGNhcHR1cmU6IHRydWUgfX0pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fbW91c2VjbGljayA9IFV0aWxzLm9uKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgJ21vdXNlZG93bicsIHRoaXMub25DbGljay5iaW5kKHRoaXMpKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG5nT25EZXN0cm95KCkge1xyXG4gICAgICAgIHRoaXMuaGlkZSgpO1xyXG4gICAgICAgIGlmICh0aGlzLl9tb3VzZWVudGVyKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX21vdXNlZW50ZXIoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLl9tb3VzZWxlYXZlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX21vdXNlbGVhdmUoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLl9tb3VzZWNsaWNrKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX21vdXNlY2xpY2soKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIHRoaXMuZGcgPSBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIG9uTW91c2VFbnRlcigkZXZlbnQ6IGFueSkge1xyXG5cclxuICAgICAgICBpZiAoJGV2ZW50LmZyb21FbGVtZW50KSB7XHJcbiAgICAgICAgICAgIGlmICghJGV2ZW50LmZyb21FbGVtZW50LmNsb3Nlc3QoJy5mLWRhdGFncmlkJykpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGNvbnN0IGNlbGxUaXB0aW1lciA9IHRoaXMuZGcgPyB0aGlzLmRnLmNlbGxUaXBUaW1lciA6IDEwMDA7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLnNob3dUaXBUaW1lcikge1xyXG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5zaG93VGlwVGltZXIpO1xyXG4gICAgICAgICAgICB0aGlzLnNob3dUaXBUaW1lciA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuc2hvd1RpcFRpbWVyID0gc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuc2hvdygkZXZlbnQpO1xyXG4gICAgICAgIH0sIGNlbGxUaXB0aW1lcik7XHJcbiAgICB9XHJcblxyXG4gICAgb25Nb3VzZUxlYXZlKCkge1xyXG4gICAgICAgIHRoaXMuaGlkZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uQ2xpY2soZTogTW91c2VFdmVudCkge1xyXG4gICAgICAgIC8vIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgdGhpcy5oaWRlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRUZXh0Q29udGFpbmVyKCkge1xyXG4gICAgICAgIHJldHVybiBEb21IYW5kbGVyLmZpbmRTaW5nbGUodGhpcy5jb250YWluZXIsICcuZi10b29sdGlwLXRleHQnKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGRvbm90U2hvd1RpcHModGFyZ2V0OiBhbnkpIHtcclxuICAgICAgICBjb25zdCB0ZFdpZHRoID0gdGFyZ2V0Lm9mZnNldFdpZHRoO1xyXG4gICAgICAgIGNvbnN0IHRhZ2V0U3R5ID0gIHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKHRhcmdldCk7XHJcbiAgICAgICAgY29uc3QgdHh0V2lkdGggPSB0aGlzLmNvbW1vblV0aWxzLmdldFRleHRXaWR0aCh0aGlzLm1lc3NhZ2UsIHRhZ2V0U3R5LmZvbnQpO1xyXG4gICAgICAgIGNvbnN0IHsgcGFkZGluZ0xlZnQsIHBhZGRpbmdSaWdodCB9ID0gdGFnZXRTdHk7XHJcbiAgICAgICAgY29uc3QgX3dpZHRoID0gdGRXaWR0aCAtIChOdW1iZXIocGFkZGluZ0xlZnQucmVwbGFjZSgncHgnLCAnJykpIHx8IDApIC0gKE51bWJlcihwYWRkaW5nUmlnaHQucmVwbGFjZSgncHgnLCAnJykpIHx8IDApO1xyXG5cclxuICAgICAgICBsZXQgdHIgPSB0YXJnZXQuY2xvc2VzdCgndHInKTtcclxuICAgICAgICBpZiAodHIpIHtcclxuICAgICAgICAgICAgY29uc3QgdHJJZCA9IHRyLmlkO1xyXG4gICAgICAgICAgICB0ciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyMnKyB0cklkKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLnRpcE1vZGUgPT09ICdhdXRvJykge1xyXG4gICAgICAgICAgICBpZiAodHIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBfd2lkdGggJiYgX3dpZHRoID4gdHh0V2lkdGg7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRyID8gZmFsc2UgOiB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBoaWRlKCkge1xyXG4gICAgICAgIGlmICh0aGlzLnNob3dUaXBUaW1lcikge1xyXG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5zaG93VGlwVGltZXIpO1xyXG4gICAgICAgICAgICB0aGlzLnNob3dUaXBUaW1lciA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5jb250YWluZXIgJiYgdGhpcy5jb250YWluZXIucGFyZW50RWxlbWVudCkge1xyXG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHRoaXMuY29udGFpbmVyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jb250YWluZXIgPSBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIHNob3coJGV2ZW50OiBNb3VzZUV2ZW50KSB7XHJcbiAgICAgICAgY29uc3QgY2VsbEVsID0gJGV2ZW50LnRhcmdldCBhcyBhbnk7XHJcbiAgICAgICAgdGhpcy5lbmFibGUgPSBjZWxsRWwuZ2V0QXR0cmlidXRlKCdjZWxsLXRvb2x0aXAnKSA9PT0gJ3RydWUnO1xyXG4gICAgICAgIHRoaXMubWVzc2FnZSA9IGNlbGxFbC5nZXRBdHRyaWJ1dGUoJ21lc3NhZ2UnKTtcclxuICAgICAgICB0aGlzLnRpcE1vZGUgPSBjZWxsRWwuZ2V0QXR0cmlidXRlKCd0aXBNb2RlJykgfHwgJ2F1dG8nO1xyXG5cclxuICAgICAgICBpZiAoIXRoaXMuZW5hYmxlIHx8ICF0aGlzLm1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgdGlwV2lkdGggPSBjZWxsRWwuZ2V0QXR0cmlidXRlKCd0aXBXaWR0aCcpO1xyXG4gICAgICAgIGNvbnN0IHRpcEhlaWdodCA9IGNlbGxFbC5nZXRBdHRyaWJ1dGUoJ3RpcEhlaWdodCcpO1xyXG4gICAgICAgIHRoaXMucG9zaXRpb24gPSBjZWxsRWwuZ2V0QXR0cmlidXRlKCdwb3NpdGlvbicpIHx8ICd0b3AtbGVmdCc7XHJcblxyXG4gICAgICAgIC8vIOajgOafpeS4i+WGheWuueWuveW6puaYr+WQpui2heWHuuWIl+WuvVxyXG4gICAgICAgIGlmICh0aGlzLmRvbm90U2hvd1RpcHMoJGV2ZW50LnRhcmdldCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gY29uc3QgYm94RWwgPSB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQ7XHJcbiAgICAgICAgY29uc3QgYm94RWwgPSAkZXZlbnQudGFyZ2V0O1xyXG4gICAgICAgIGNvbnN0IGVsU2l6ZSA9IHRoaXMuZ2V0Qm94U2l6ZU9iaihib3hFbCk7XHJcblxyXG5cclxuICAgICAgICAvKiog5aaC5p6c5a2Y5Zyo5YiZ5LiN5paw5bu677yM5Y+q6ZyA6KaB5L+u5pS56YeM6Z2i55qE5YaF5a65ICovXHJcbiAgICAgICAgaWYgKCF0aGlzLmNvbnRhaW5lcikge1xyXG4gICAgICAgICAgICB0aGlzLmNyZWF0ZShlbFNpemUpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIERvbUhhbmRsZXIuZmluZFNpbmdsZSh0aGlzLmNvbnRhaW5lciwgJy5mLXRvb2x0aXAtdGV4dCcpLmlubmVySFRNTCA9IHRoaXMubWVzc2FnZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuY29udGFpbmVyLnN0eWxlLm1heFdpZHRoID0gYCR7d2luZG93LmlubmVyV2lkdGggLSAzMH1weGA7XHJcbiAgICAgICAgdGhpcy5jb250YWluZXIuc3R5bGUubWluV2lkdGggPSAnMzVweCc7XHJcblxyXG4gICAgICAgIGlmICh0aXBXaWR0aCkge1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5zdHlsZS53aWR0aCA9IHRpcFdpZHRoO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRpcEhlaWdodCkge1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5zdHlsZS5oZWlnaHQgPSB0aXBIZWlnaHQ7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgY29uc3Qgb2Zmc2V0ID0gRG9tSGFuZGxlci5nZXRPZmZzZXQoYm94RWwpO1xyXG4gICAgICAgIGNvbnN0IHRhcmdldFRvcCA9IG9mZnNldC50b3A7XHJcbiAgICAgICAgY29uc3QgdGFyZ2V0TGVmdCA9IG9mZnNldC5sZWZ0O1xyXG4gICAgICAgIGxldCBsZWZ0OiBudW1iZXI7XHJcbiAgICAgICAgbGV0IHRvcDogbnVtYmVyO1xyXG4gICAgICAgIHRoaXMuY29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xyXG5cclxuICAgICAgICB0aGlzLmNoYW5nZVRvb2x0aXBQb3NpdGlvbihib3hFbCk7XHJcbiAgICAgICAgY29uc3QgYXJyb3cgPSBEb21IYW5kbGVyLmZpbmRTaW5nbGUodGhpcy5jb250YWluZXIsICcuZi10b29sdGlwLWFycm93Jyk7XHJcbiAgICAgICAgY29uc3QgdG9vbHRpcFNpemUgPSB0aGlzLmdldFRvb2x0aXBTaXplKCk7XHJcblxyXG4gICAgICAgIC8vIOajgOafpeWGheWuuemrmOW6plxyXG4gICAgICAgIGlmICh3aW5kb3cuaW5uZXJIZWlnaHQgLSAxMCA8IHRvb2x0aXBTaXplLmhlaWdodCkge1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5zdHlsZS5oZWlnaHQgPSBgJHt3aW5kb3cuaW5uZXJIZWlnaHQgLSAyMH1weGA7XHJcblxyXG4gICAgICAgICAgICB0b29sdGlwU2l6ZS5oZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQgLSAyNTtcclxuICAgICAgICAgICAgY29uc3QgdGV4dENvbnRhaW5lciA9IHRoaXMuZ2V0VGV4dENvbnRhaW5lcigpO1xyXG4gICAgICAgICAgICB0ZXh0Q29udGFpbmVyLnN0eWxlLmhlaWdodCA9IGAke3Rvb2x0aXBTaXplLmhlaWdodH1weGA7XHJcbiAgICAgICAgICAgIHRleHRDb250YWluZXIuc3R5bGUub3ZlcmZsb3cgPSAnaGlkZGVuJztcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBjb25zdCBuID0gdGhpcy51cGRhdGVBcnJvd1Bvc2l0aW9uKGFycm93LCBvZmZzZXQsICRldmVudCk7XHJcbiAgICAgICAgc3dpdGNoICh0aGlzLnBvc2l0aW9uKSB7XHJcbiAgICAgICAgICAgIGNhc2UgJ3JpZ2h0JzpcclxuICAgICAgICAgICAgICAgIGxlZnQgPSB0YXJnZXRMZWZ0ICsgZWxTaXplLndpZHRoO1xyXG4gICAgICAgICAgICAgICAgdG9wID0gbjtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICdsZWZ0JzpcclxuICAgICAgICAgICAgICAgIGxlZnQgPSB0YXJnZXRMZWZ0IC0gdG9vbHRpcFNpemUud2lkdGg7XHJcbiAgICAgICAgICAgICAgICB0b3AgPSBuO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ3RvcC1sZWZ0JzpcclxuICAgICAgICAgICAgICAgIHRvcCA9IHRhcmdldFRvcCAtIHRvb2x0aXBTaXplLmhlaWdodCAtIDc7XHJcbiAgICAgICAgICAgICAgICBsZWZ0ID0gbjtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGxlZnQpIHtcclxuICAgICAgICAgICAgdGhpcy5jb250YWluZXIuc3R5bGUubGVmdCA9IGxlZnQgKyAncHgnO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5jb250YWluZXIuc3R5bGUudG9wID0gdG9wICsgJ3B4JztcclxuICAgICAgICB0aGlzLmNvbnRhaW5lci5zdHlsZS56SW5kZXggPSA5OTk5OTk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSB1cGRhdGVBcnJvd1Bvc2l0aW9uKGFycm93OiBhbnksIGVsT2Zmc2V0OiB7IHRvcCwgbGVmdCB9LCAkZXZlbnQ6IGFueSkge1xyXG4gICAgICAgIGNvbnN0IHRvb2x0aXBTaXplID0gdGhpcy5nZXRUb29sdGlwU2l6ZSgpO1xyXG4gICAgICAgIGlmICh0aGlzLnBvc2l0aW9uID09PSAnbGVmdCcgfHwgdGhpcy5wb3NpdGlvbiA9PT0gJ3JpZ2h0Jykge1xyXG4gICAgICAgICAgICBjb25zdCB0YXJnZXRUb3AgPSBlbE9mZnNldC50b3A7XHJcbiAgICAgICAgICAgIGNvbnN0IGhhbGZIZWlnaHQgPSB0b29sdGlwU2l6ZS5oZWlnaHQgLyAyO1xyXG4gICAgICAgICAgICBsZXQgdG9wID0gMTA7XHJcbiAgICAgICAgICAgIGlmICh0YXJnZXRUb3AgPiBoYWxmSGVpZ2h0ICYmIHdpbmRvdy5pbm5lckhlaWdodCAtIHRhcmdldFRvcCA+IGhhbGZIZWlnaHQpIHtcclxuICAgICAgICAgICAgICAgIHRvcCA9IHRhcmdldFRvcCAtIHRvb2x0aXBTaXplLmhlaWdodCAvIDI7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIOiwg+aVtOeureWktOeahOS9jee9rlxyXG4gICAgICAgICAgICBpZiAoYXJyb3cpIHtcclxuICAgICAgICAgICAgICAgIGFycm93LnN0eWxlLnRvcCA9IGAke3RhcmdldFRvcCAtIHRvcH1weGA7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiB0b3A7XHJcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnBvc2l0aW9uID09PSAndG9wLWxlZnQnKSB7XHJcbiAgICAgICAgICAgIGxldCBsZWZ0ID0gJGV2ZW50LnBhZ2VYIC0gdG9vbHRpcFNpemUud2lkdGggLyAyO1xyXG5cclxuICAgICAgICAgICAgaWYgKGxlZnQgPCAxMCkge1xyXG4gICAgICAgICAgICAgICAgbGVmdCA9IGVsT2Zmc2V0LmxlZnQ7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChsZWZ0ICsgdG9vbHRpcFNpemUud2lkdGggPiB3aW5kb3cuaW5uZXJXaWR0aCkge1xyXG4gICAgICAgICAgICAgICAgbGVmdCA9IHdpbmRvdy5pbm5lcldpZHRoIC0gdG9vbHRpcFNpemUud2lkdGggLSAyMDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyDosIPmlbTnrq3lpLTnmoTkvY3nva5cclxuICAgICAgICAgICAgaWYgKGFycm93KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoJGV2ZW50LnBhZ2VYIC0gbGVmdCA+IDI4KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCRldmVudC5wYWdlWCAtIGxlZnQgKyAyOCA+IHRvb2x0aXBTaXplLndpZHRoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFycm93LnN0eWxlLmxlZnQgPSBgJHt0b29sdGlwU2l6ZS53aWR0aCAtIDI4IH1weGA7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXJyb3cuc3R5bGUubGVmdCA9IGAkeyRldmVudC5wYWdlWCAtIGxlZnQgfXB4YDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBsZWZ0O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjcmVhdGUoZWxTaXplOiBhbnkpIHtcclxuICAgICAgICBsZXQgc3R5bGVDbGFzcyA9IHRoaXMudG9vbHRpcENscygpO1xyXG4gICAgICAgIHRoaXMuY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgaWYgKHRoaXMudG9vbHRpcFN0eWxlQ2xhc3MpIHtcclxuICAgICAgICAgICAgc3R5bGVDbGFzcyArPSAnICcgKyB0aGlzLnRvb2x0aXBTdHlsZUNsYXNzO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmNvbnRhaW5lci5jbGFzc05hbWUgPSBzdHlsZUNsYXNzO1xyXG5cclxuICAgICAgICBjb25zdCB0b29sdGlwQXJyb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICB0b29sdGlwQXJyb3cuY2xhc3NOYW1lID0gJ2YtdG9vbHRpcC1hcnJvdyAnO1xyXG4gICAgICAgIHRoaXMuY29udGFpbmVyLmFwcGVuZENoaWxkKHRvb2x0aXBBcnJvdyk7XHJcblxyXG4gICAgICAgIGNvbnN0IHRvb2x0aXBUZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgdG9vbHRpcFRleHQuY2xhc3NOYW1lID0gJ2YtdG9vbHRpcC10ZXh0ICc7XHJcbiAgICAgICAgdG9vbHRpcFRleHQuaW5uZXJIVE1MID0gdGhpcy5tZXNzYWdlO1xyXG5cclxuICAgICAgICBjb25zdCBtYXhXaWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoIC0gNTA7XHJcbiAgICAgICAgdG9vbHRpcFRleHQuc3R5bGUubWF4V2lkdGggPSBgJHttYXhXaWR0aH1weGA7XHJcblxyXG4gICAgICAgIHRvb2x0aXBUZXh0LnN0eWxlLndvcmRCcmVhayA9ICdicmVhay1hbGwnO1xyXG4gICAgICAgIHRoaXMuY29udGFpbmVyLnN0eWxlLnRleHRBbGlnbiA9ICdjZW50ZXInO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5wb3NpdGlvblN0eWxlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLnN0eWxlLnBvc2l0aW9uID0gdGhpcy5wb3NpdGlvblN0eWxlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5jb250YWluZXIuYXBwZW5kQ2hpbGQodG9vbHRpcFRleHQpO1xyXG4gICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5jb250YWluZXIpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgdG9vbHRpcENscygpIHtcclxuICAgICAgICByZXR1cm4gJ2RhdGFncmlkLWNlbGwtdG9vbHRpcCBmLXRvb2x0aXAgJyArIHRoaXMuZ2V0VGhlbWVDbHMoKSArICcgZi10b29sdGlwLScgKyB0aGlzLnBvc2l0aW9uICsgJyAnICsgdGhpcy5jbHM7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRUaGVtZUNscygpIHtcclxuICAgICAgICBpZiAodGhpcy50eXBlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAnZi10b29sdGlwLScgKyB0aGlzLnR5cGU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiAnJztcclxuICAgIH1cclxuXHJcbiAgICAvKiog6I635Y+W5a6/5Li75bC65a+4ICovXHJcbiAgICBwcml2YXRlIGdldEJveFNpemVPYmooYm94RWwpIHtcclxuICAgICAgICBjb25zdCBwID0gYm94RWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgd2lkdGg6IERvbUhhbmRsZXIuZ2V0T3V0ZXJXaWR0aChib3hFbCksXHJcbiAgICAgICAgICAgIGhlaWdodDogRG9tSGFuZGxlci5nZXRPdXRlckhlaWdodChib3hFbCksXHJcbiAgICAgICAgICAgIGxlZnQ6IHAubGVmdCxcclxuICAgICAgICAgICAgcmlnaHQ6IHAucmlnaHQsXHJcbiAgICAgICAgICAgIHRvcDogcC50b3AsXHJcbiAgICAgICAgICAgIGJvdHRvbTogcC5ib3R0b21cclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8qKiDojrflj5Z0b29sdGlwIOWuueWZqOWwuuWvuCAqL1xyXG4gICAgcHJpdmF0ZSBnZXRUb29sdGlwU2l6ZSgpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICB3aWR0aDogRG9tSGFuZGxlci5nZXRPdXRlcldpZHRoKHRoaXMuY29udGFpbmVyKSxcclxuICAgICAgICAgICAgaGVpZ2h0OiBEb21IYW5kbGVyLmdldE91dGVySGVpZ2h0KHRoaXMuY29udGFpbmVyKVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIOiOt+WPlueql+WPo+WwuuWvuCAqL1xyXG4gICAgcHJpdmF0ZSBnZXRXaW5kb3dTaXplKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHdpZHRoOiB3aW5kb3cuaW5uZXJXaWR0aCxcclxuICAgICAgICAgICAgaGVpZ2h0OiB3aW5kb3cuaW5uZXJIZWlnaHRcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8qKiDmoLnmja7lhoXlrrnnmoTlpJrlsJHvvIzoh6rliqjmm7TmlLl0b29sdGlwIOeahOS9jee9riAqL1xyXG4gICAgcHJpdmF0ZSBjaGFuZ2VUb29sdGlwUG9zaXRpb24oYm94RWw6IGFueSkge1xyXG4gICAgICAgIGNvbnN0IGJveFNpemUgPSB0aGlzLmdldEJveFNpemVPYmooYm94RWwpO1xyXG4gICAgICAgIGNvbnN0IHRvb2x0aXAgPSB0aGlzLmdldFRvb2x0aXBTaXplKCk7XHJcbiAgICAgICAgY29uc3Qgd2luU2l6ZSA9IHRoaXMuZ2V0V2luZG93U2l6ZSgpO1xyXG5cclxuICAgICAgICB0aGlzLmNvbnRhaW5lci5jbGFzc05hbWUgPSB0aGlzLnRvb2x0aXBDbHMoKTtcclxuXHJcbiAgICAgICAgaWYgKHRvb2x0aXAud2lkdGggPCB3aW5TaXplLndpZHRoICYmIHRvb2x0aXAuaGVpZ2h0IDwgYm94U2l6ZS50b3ApIHtcclxuICAgICAgICAgICAgLy8gdGhpcy5wb3NpdGlvbiA9ICd0b3AtbGVmdCc7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zdCBlbE9mZnNldCA9IERvbUhhbmRsZXIuZ2V0T2Zmc2V0KGJveEVsKTtcclxuICAgICAgICAgICAgY29uc3QgZWxMZWZ0ID0gZWxPZmZzZXQubGVmdDtcclxuICAgICAgICAgICAgY29uc3QgZWxSaWdodCA9IHdpblNpemUud2lkdGggLSBlbExlZnQgLSBib3hTaXplLndpZHRoO1xyXG5cclxuICAgICAgICAgICAgaWYgKGVsTGVmdCA+IGVsUmlnaHQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucG9zaXRpb24gPSAnbGVmdCc7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnBvc2l0aW9uID0gJ3JpZ2h0JztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY29uc3QgdG9vbFRpcFRleHRXaWR0aCA9IGVsTGVmdCA+IGVsUmlnaHQgPyBlbExlZnQgOiBlbFJpZ2h0O1xyXG4gICAgICAgICAgICBjb25zdCB0ZXh0RWwgPSB0aGlzLmdldFRleHRDb250YWluZXIoKTtcclxuICAgICAgICAgICAgdGV4dEVsLnN0eWxlLm1heFdpZHRoID0gYCR7dG9vbFRpcFRleHRXaWR0aCAtIDMwfXB4YDtcclxuICAgICAgICAgICAgdGhpcy5jb250YWluZXIuc3R5bGUubWF4V2lkdGggPSBgJHt0b29sVGlwVGV4dFdpZHRofXB4YDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxufVxyXG4iXX0=