/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { FavoriteAction, FAVORITE_FIELD_NAME } from '../lookup-displaytype';
import { cloneDeep } from 'lodash-es';
import { of } from 'rxjs';
import { tap, catchError } from 'rxjs/operators';
export class TreeTableEventManager {
    /**
     * @param {?} ins
     */
    constructor(ins) {
        this.ins = ins;
        this._sortState = null;
        /**
         * 标识当前数据是否查询结果
         */
        this.IS_SEARCH_RESULT = false;
        this._isLoadAllTreeData = (/**
         * @param {?} tt
         * @return {?}
         */
        (tt) => {
            if (this.ins.loadTreeDataType === 'default') {
                return tt.loadDataType === 'all';
            }
            else {
                return this.ins.loadTreeDataType === 'loadall';
            }
        });
        this._isAsyncLoadTreeData = (/**
         * @param {?} tt
         * @return {?}
         */
        (tt) => {
            if (this.ins.loadTreeDataType === 'default') {
                return tt.loadDataType === 'async';
            }
            else {
                return this.ins.loadTreeDataType === 'layerload';
            }
        });
        this.lookupSelectionSer = this.ins.lookupSelectionSer;
    }
    /**
     * @param {?} search
     * @return {?}
     */
    searchTreeData(search) {
        /** @type {?} */
        const tt = (/** @type {?} */ (this.ins.componentRef.instance));
        // 判断uri 发出search.emit();
        if (this.ins.searching) {
            return;
        }
        else {
            this.ins.searching = true;
        }
        this.ins.showLoading();
        return this.ins.httpMgr.getData({ search, sortName: tt.sortName, sortOrder: tt.sortOrder }, 'search').pipe(tap((/**
         * @return {?}
         */
        () => {
            this.ins.searching = false;
        })), catchError((/**
         * @param {?} err
         * @return {?}
         */
        (err) => {
            this.ins.searching = false;
            return of(err);
        }))).subscribe((/**
         * @param {?} resData
         * @return {?}
         */
        resData => {
            this.ins.closeLoading();
            if (resData) {
                // this.ins.items = resData.items;
                tt.clearAll();
                /** @type {?} */
                const treeInfo = this.ins.gridOptions.treeInfo;
                if (!treeInfo['treeDataIsInit']) {
                    if (treeInfo.layerType.toLowerCase() === 'pathcode') {
                        this.ins.items = this.ins.lookupUtils.makeTree(this.ins.items, treeInfo);
                    }
                    else {
                        this.ins.items = this.ins.lookupUtils.makeTreeWithParentID(this.ins.items, '', treeInfo.dataField ? `${treeInfo.dataField}.${treeInfo.parentField}` : treeInfo.parentField, this.ins.idField);
                    }
                }
                /** @type {?} */
                const checkNodes = (/**
                 * @param {?} nodes
                 * @return {?}
                 */
                (nodes) => {
                    if (nodes && nodes.length) {
                        return nodes.map((/**
                         * @param {?} node
                         * @return {?}
                         */
                        (node) => {
                            if (node.hasOwnProperty('addtional')) {
                                node.selectable = !node['addtional'];
                            }
                            if (node.children && node.children.length) {
                                checkNodes(node.children);
                            }
                            else {
                                if (this._isLoadAllTreeData(tt)) {
                                    node.leaf = true;
                                }
                            }
                            return node;
                        }));
                    }
                    return nodes;
                });
                /** @type {?} */
                const _nodes = checkNodes(resData.items);
                if (_nodes && _nodes.length && _nodes[0].children && _nodes[0].children.length) {
                    _nodes[0].expanded = true;
                    _nodes[0].children = this.ins.expandFirstNode(_nodes[0].children);
                }
                this.ins.items = _nodes;
                // 加载收藏数据
                if (this.ins.useFavorite) {
                    // 更新数据的收藏状态
                    this.ins.favHelper.updateFavoritesStatus(this.ins.items);
                }
                tt.loadData(this.ins.items);
                // // 展开查询结果。
                // if (search.value && this.ins.items.length) {
                //     tt.toggleExpand(this.ins.items[0], true);
                // }
                tt.resize();
                this.IS_SEARCH_RESULT = true;
                this.ins.selectionMgr.selectCurrentValue();
            }
            this.ins.search.emit(search);
        }));
    }
    /**
     * @private
     * @param {?} parentPath
     * @param {?} parentLayer
     * @param {?} searchData
     * @return {?}
     */
    getChildren(parentPath, parentLayer, searchData) {
        /** @type {?} */
        const uri = this.ins.gridOptions.uri;
        /** @type {?} */
        const search = Object.assign({ parentLayer, category: 'children' }, searchData);
        if (this.ins.treeInfo.layerType === 'parentId') {
            search['parentId'] = parentPath;
        }
        else {
            search['parentPath'] = parentPath;
        }
        /** @type {?} */
        const param = {
            searchValue: '',
            customData: this.ins.customData,
            enableFullTree: this.ins.enableFullTree,
            loadTreeDataType: this.ins.loadTreeDataType
        };
        /** @type {?} */
        const tt = (/** @type {?} */ (this.ins.componentRef.instance));
        if (tt && tt.sortName) {
            Object.assign(search, {
                sortName: tt.sortName,
                sortOrder: tt.sortOrder
            });
        }
        if (this.IS_SEARCH_RESULT) {
            param.enableFullTree = false;
            param.loadTreeDataType = 'layerload';
            if (this.ins.treeInfo.layerType === 'parentId') {
                // 树形帮助查询后，展开节点时将相关查询参数传递到后端 2022-09-13
                search.searchValue = '';
                search.searchField = '*';
            }
            // param.searchValue = JSON.stringify(search);
        }
        param.searchValue = JSON.stringify(search);
        if (this.ins.helpId) {
            param['helpId'] = this.ins.helpId;
        }
        return this.ins.http.getData(uri, param);
    }
    /**
     * @return {?}
     */
    bindTreetableEvent() {
        /** @type {?} */
        const tt = (/** @type {?} */ (this.ins.componentRef.instance));
        /** @type {?} */
        const _searchTreeData = (/**
         * @param {?} searchparam
         * @return {?}
         */
        (searchparam) => {
            if (this.ins.remoteSearch) {
                this.ins._searchState = searchparam;
                this.searchTreeData(searchparam);
            }
            else {
                if (this.ins.useInsideSearchHandler) {
                    tt.searchHandle.search(searchparam.field, searchparam.value, 'client');
                }
                else {
                    this.ins.search.emit(searchparam);
                }
            }
        });
        /** @type {?} */
        const isLoadAllTreeData = (/**
         * @return {?}
         */
        () => {
            return this._isLoadAllTreeData(tt);
        });
        /** @type {?} */
        const isAsyncLoadTreeData = (/**
         * @return {?}
         */
        () => {
            return this._isAsyncLoadTreeData(tt);
        });
        tt.dblClickExpand = !this.ins.singleSelect; // 禁用双击展开节点
        tt.allColumnsTitle = this.ins.allColumnsTitle; // this.displayInfo.allColumns;
        tt.idField = this.ins.idField;
        tt.columns = this.ins.columns;
        tt.searchFields = this.ins.gridOptions.searchFields;
        if (this.ins.treeInfo) {
            tt.loadDataType = this.ins.treeInfo.loadDataType;
            tt.virtualized = true;
            if (!this.ins.isTextChange) {
                this.ins.allData = cloneDeep(this.ins.items);
            }
            else {
                this.ins.allData = [];
            }
        }
        if (this.ins.gridOptions.treeInfo) {
            tt.onlySelectLeaf = this.ins.gridOptions.treeInfo.onlySelectLeaf;
            tt.loadDataType = this.ins.gridOptions.treeInfo.loadDataType;
        }
        if (!tt.singleSelect) {
            tt.checkOnSelect = true;
            tt.selectOnCheck = true;
            tt.showCheckbox = true;
            tt.showCheckAll = this.ins.showCheckAll;
            // 启用多选后，同时启用级联选择
            if (this.ins.enableCascade) {
                this.cascadeValueChanged(this.ins.cascadeStatus);
            }
            else {
                tt.cascadeCheck = false;
                tt.cascadeDown = false;
                tt.cascadeUp = false;
            }
        }
        tt.enableFindText = this.ins.enableFindText;
        // tt.findField = this.textField;
        tt.nodeSelected.subscribe((/**
         * @param {?} e
         * @return {?}
         */
        (e) => {
            // if (this.ins.favoritesComponentRef && this.ins.singleSelect) {
            //     const ftt = this.ins.favoritesComponentRef.instance as TreeTableComponent;
            //     ftt.clearSelections();
            // }
            if (this.ins.singleSelect) {
                this.lookupSelectionSer.clearSelections();
            }
            this.lookupSelectionSer.updateSelections([e.node.data]);
            this.ins.checkedChange.emit({ data: [e.node.data], isCheck: true });
        }));
        tt.nodeChecked.subscribe((/**
         * @param {?} e
         * @return {?}
         */
        e => {
            if (!this.ins.singleSelect) {
                /** @type {?} */
                let data = null;
                if (e.nodes && e.nodes.length) {
                    data = e.nodes.map((/**
                     * @param {?} n
                     * @return {?}
                     */
                    n => n.data));
                    // this.ins.multiSelMgr.updateSelections(e.nodes.map(n => n.data));
                }
                else {
                    if (Array.isArray(e.node)) {
                        data = e.node.map((/**
                         * @param {?} n
                         * @return {?}
                         */
                        n => n.data));
                        // this.ins.multiSelMgr.updateSelections(e.node.map(n => n.data));
                    }
                    else {
                        data = [e.node.data];
                        // this.ins.multiSelMgr.updateSelections([e.node.data]);
                    }
                }
                this.ins.multiSelMgr.updateSelections(data);
                this.ins.checkedChange.emit({ data, isCheck: true });
            }
        }));
        tt.nodeUnChecked.subscribe((/**
         * @param {?} e
         * @return {?}
         */
        (e) => {
            if (e && e.node) {
                if (!this.ins.singleSelect) {
                    this.ins.multiSelMgr.remove(e.node.id);
                    // 分层加载，多选，包含下级时，取消勾选 需要将当前节点的所有子级数据也要取消选择，即从已选记录中移除
                    if (tt.loadDataType !== 'all' && this.ins.treeInfo.layerType === 'pathcode' &&
                        (this.ins.cascadeStatus === 'enable' || this.ins.cascadeStatus === 'down')) {
                        if (e.node.children && e.node.children.length) {
                            /** @type {?} */
                            const nodes = e.node.children.map((/**
                             * @param {?} n
                             * @return {?}
                             */
                            n => n.data));
                            this.ins.lookupSelectionSer.updateSelections(nodes, false);
                        }
                        else {
                            // const pathcode = e.node.data[this.ins.treeInfo.dataField][this.ins.treeInfo.pathField];
                            /** @type {?} */
                            const pathcode = this.ins.getPathCode(e.node.data, this.ins.treeInfo);
                            this.ins.lookupSelectionSer.unselectByPathcode(pathcode);
                        }
                    }
                    if (e.nodes && e.nodes.length) {
                        this.ins.multiSelMgr.remove(e.nodes.map((/**
                         * @param {?} n
                         * @return {?}
                         */
                        n => n.id)));
                        this.ins.checkedChange.emit({ data: e.nodes.map((/**
                             * @param {?} n
                             * @return {?}
                             */
                            n => n.data)), isCheck: false });
                    }
                    else {
                        this.ins.checkedChange.emit({ data: [e.node.data], isCheck: false });
                    }
                }
                else {
                    /** @type {?} */
                    const ftt = this.ins.favoritesComponentRef && ((/** @type {?} */ (this.ins.favoritesComponentRef.instance)));
                    if (ftt && ftt.findRowNode(e.node.id)) {
                        ftt.unSelectNode(e.node.id);
                    }
                    this.ins.checkedChange.emit({ data: [e.node.data], isCheck: false });
                }
            }
        }));
        tt.checkAll.subscribe((/**
         * @param {?} e
         * @return {?}
         */
        e => {
            /** @type {?} */
            const data = e.instance.checkeds.map((/**
             * @param {?} n
             * @return {?}
             */
            n => n.data));
            this.ins.multiSelMgr.updateSelections(data);
            this.ins.checkedChange.emit({ data, isCheck: true });
        }));
        tt.unCheckAll.subscribe((/**
         * @return {?}
         */
        () => {
            this.ins.multiSelMgr.clear();
            this.ins.checkedChange.emit({ data: [], isCheck: false });
        }));
        tt.search.subscribe((/**
         * @param {?} searchparam
         * @return {?}
         */
        searchparam => {
            if (searchparam.field !== '*' && !searchparam.value) {
                this.ins.messagerService.warning(this.ins.mustWriteSomething);
            }
            else {
                searchparam.value = searchparam.value.trim();
                _searchTreeData(searchparam);
            }
        }));
        tt.cellClick.subscribe((/**
         * @param {?} e
         * @return {?}
         */
        (e) => {
            if (e.col.field === FAVORITE_FIELD_NAME) {
                e.event.stopPropagation();
                // tslint:disable-next-line: no-string-literal
                /** @type {?} */
                const classList = e.event.target['classList'];
                if (classList.contains('f-lookup-favorite')) {
                    // classList.toggle('f-icon-star');
                    // classList.toggle('f-icon-star-outline');
                    /** @type {?} */
                    const _this = this.ins;
                    ((/**
                     * @param {?} arr
                     * @return {?}
                     */
                    function each(arr) {
                        if (arr) {
                            arr.forEach((/**
                             * @param {?} item
                             * @return {?}
                             */
                            item => {
                                /** @type {?} */
                                const id = _this.utils.getValue(_this.idField, item.data);
                                if (id === e.node.id) {
                                    item.data[FAVORITE_FIELD_NAME] = !item.data[FAVORITE_FIELD_NAME];
                                    return true;
                                }
                                else if (item.children && item.children.length > 0) {
                                    return each(item.children);
                                }
                                else {
                                    return false;
                                }
                            }));
                        }
                    }))(this.ins.items);
                    tt.loadData(this.ins.items);
                    // 更新收藏数据
                    this.lookupSelectionSer.updateFavoriteData(e.node.data, e.node.data[FAVORITE_FIELD_NAME] ? FavoriteAction.add : FavoriteAction.delete);
                }
            }
        }));
        tt.dblClick.subscribe((/**
         * @param {?} treeNode
         * @return {?}
         */
        (treeNode) => {
            if (this.ins.gridOptions.singleSelect && treeNode.selectable) {
                if (this.ins.okButton) {
                    // this.lookupSelectionSer.select(treeNode.data);
                    // this.ins.okButton.nativeElement.click();
                    this.ins.selectItem(treeNode.data);
                }
            }
        }));
        /** @type {?} */
        const loadAllData = isLoadAllTreeData();
        tt.columnSorted.subscribe((/**
         * @param {?} sort
         * @return {?}
         */
        (sort) => {
            this._sortState = sort;
            if (isLoadAllTreeData()) {
                tt.clientSort();
            }
            else {
                const { sortName, sortOrder } = Object.assign({}, sort);
                /** @type {?} */
                const col = this.ins.columns.find((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => n.field === sortName));
                /** @type {?} */
                const _sortName = col ? col.fieldPath ? col.fieldPath : col.field : sortName;
                /** @type {?} */
                const param = Object.assign({ sortName: _sortName, sortOrder }, { search: this.ins._searchState });
                /** @type {?} */
                let reqTyp = 'all';
                if (this.ins._searchState && this.ins._searchState.value) {
                    reqTyp = 'search';
                }
                this.ins.httpMgr.getData(param, reqTyp).subscribe((/**
                 * @param {?} d
                 * @return {?}
                 */
                d => {
                    this.ins.closeLoading();
                    tt.clearAll();
                    /** @type {?} */
                    const items = this.ins.checkNodeCanBeSelect(d.items, false);
                    if (this.ins.useFavorite) {
                        this.ins.favHelper.updateFavoritesStatus(items);
                    }
                    this.ins.items = items;
                    tt.loadData(items);
                    tt.resize();
                }));
            }
        }));
        tt.clearSearchValue.subscribe((/**
         * @return {?}
         */
        () => {
            this.ins._searchState = null;
            this.IS_SEARCH_RESULT = false;
            /** @type {?} */
            let _items = [];
            if (this.ins.allData && this.ins.allData.length) {
                _items = this.ins.checkNodeCanBeSelect(this.ins.allData, loadAllData);
            }
            if (!_items || !_items.length) {
                _searchTreeData({ field: '*', value: '' });
            }
            else {
                this.ins.items = _items;
                this.ins.favHelper.updateFavoritesStatus(this.ins.items);
                tt.loadData(_items);
                this.ins.selectionMgr.selectCurrentValue();
            }
        }));
        tt.expand.subscribe((/**
         * @param {?} tn
         * @return {?}
         */
        (tn) => {
            if (tn.leaf || tn['showLoading']) {
                return;
            }
            if (!tn.children || !tn.children.length) {
                /** @type {?} */
                const treeInfo = this.ins.gridOptions.treeInfo;
                if (isAsyncLoadTreeData() || this.IS_SEARCH_RESULT) {
                    /** @type {?} */
                    let parentPath = '';
                    /** @type {?} */
                    let parentLayer = -1;
                    const { field = '*', value = '' } = Object.assign({}, tt.searchData);
                    tn['showLoading'] = true;
                    tt.detectChanges();
                    if (treeInfo.layerType === 'parentId') {
                        // 父ID加载方式
                        parentPath = tn['id'];
                    }
                    else {
                        /** @type {?} */
                        const treeInfoField = treeInfo.dataField;
                        if (treeInfoField) {
                            // parentPath = tn.data[treeInfoField][treeInfo.pathField];
                            parentPath = this.ins.getPathCode(tn.data, treeInfo);
                            // parentLayer = tn.data[treeInfoField][treeInfo.layerField];
                            parentLayer = this.ins.getLayerData(tn.data, treeInfo);
                        }
                        else {
                            this.ins.writeConsole('未找到分级信息。');
                        }
                    }
                    if (!this.ins.uri) {
                        this.ins.expandTreeNode.emit({
                            instance: tt, node: tn,
                            parentIdOrPath: parentPath, parentLayer, search: { value, field }
                        });
                        return;
                    }
                    this.ins.showLoading();
                    this.getChildren(parentPath, parentLayer, {
                        searchField: field === '*' ? '*' : field,
                        searchValue: value
                    }).subscribe((/**
                     * @param {?} data
                     * @return {?}
                     */
                    data => {
                        this.ins.closeLoading();
                        if (tt) {
                            if (tn && data.items && data.items.length) {
                                if (this.ins.useFavorite) {
                                    // 更新子节点收藏状态
                                    this.ins.favHelper.updateFavoritesStatus(data.items);
                                }
                                /** @type {?} */
                                const nodes = this.ins.checkNodeCanBeSelect(data.items, false);
                                tt.appendChildren(nodes, tn);
                                if (tt.loadDataType !== 'all' && !this.ins.singleSelect && this.ins.isGetAllChidlNodes &&
                                    (this.ins.cascadeStatus === 'enable' || this.ins.cascadeStatus === 'down')) {
                                    /** @type {?} */
                                    const rn = tt.findRowNode(tn.id);
                                    tt.propagateSelectionDown(rn, rn.isChecked);
                                    // 更新选中记录缓存
                                    /** @type {?} */
                                    const _items = data.items.filter((/**
                                     * @param {?} n
                                     * @return {?}
                                     */
                                    n => !n.addtional));
                                    if (_items && _items.length) {
                                        this.ins.lookupSelectionSer.updateSelections(_items.map((/**
                                         * @param {?} n
                                         * @return {?}
                                         */
                                        n => n.data)), rn.isChecked);
                                    }
                                }
                            }
                            tn['showLoading'] = false;
                            tt.detectChanges();
                            tt.psRef.directiveRef.update();
                            this.ins.selectionMgr.selectCurrentValue();
                        }
                    }));
                }
            }
            else {
                if (!this.ins.singleSelect && this.ins.enableCascade &&
                    (this.ins.cascadeStatus === 'enable' || this.ins.cascadeStatus === 'down') && this.ins.isGetAllChidlNodes) {
                    /** @type {?} */
                    const rn = tt.findRowNode(tn.id);
                    tt.propagateSelectionDown(rn, rn.isChecked);
                    /** @type {?} */
                    const selectItems = tn.children.filter((/**
                     * @param {?} n
                     * @return {?}
                     */
                    n => n.selectable)).map((/**
                     * @param {?} n
                     * @return {?}
                     */
                    n => n.data));
                    this.ins.lookupSelectionSer.updateSelections(selectItems, rn.isChecked);
                }
                // this.ins.selectionMgr.selectCurrentValue();
            }
        }));
        if (loadAllData && this.ins.items) {
            this.ins.treeNodeHelper.updateTreeNodeExpanded(this.ins.items);
        }
        return loadAllData;
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    cascadeValueChanged($event) {
        /** @type {?} */
        const val = $event;
        // const tt = this.ins.componentRef.instance as TreeTableComponent;
        /** @type {?} */
        const instanceTyp = this.ins.activeTab === 'datalist' ? 'treetable' : 'fav';
        /** @type {?} */
        const tt = (/** @type {?} */ (this.ins.lookupCmpMgr.getComponentInstance(instanceTyp)));
        if (!tt) {
            return;
        }
        switch (val) {
            case 'enable':
                tt.cascadeCheck = true;
                tt.cascadeDown = true;
                tt.cascadeUp = true;
                break;
            case 'disable':
                tt.cascadeCheck = false;
                tt.cascadeDown = false;
                tt.cascadeUp = false;
                break;
            case 'up':
                tt.cascadeCheck = true;
                tt.cascadeUp = true;
                tt.cascadeDown = false;
                break;
            case 'down':
                tt.cascadeCheck = true;
                tt.cascadeDown = true;
                tt.cascadeUp = false;
                break;
            default:
                tt.cascadeCheck = true;
                tt.cascadeDown = true;
                tt.cascadeUp = true;
                break;
        }
        this.ins.cascadeStatus = val || 'enable';
        this.ins.personalConf.cascadeStatus = val || 'enable';
    }
}
if (false) {
    /**
     * @type {?}
     * @private
     */
    TreeTableEventManager.prototype.lookupSelectionSer;
    /**
     * @type {?}
     * @private
     */
    TreeTableEventManager.prototype._sortState;
    /**
     * 标识当前数据是否查询结果
     * @type {?}
     * @private
     */
    TreeTableEventManager.prototype.IS_SEARCH_RESULT;
    /**
     * @type {?}
     * @private
     */
    TreeTableEventManager.prototype._isLoadAllTreeData;
    /**
     * @type {?}
     * @private
     */
    TreeTableEventManager.prototype._isAsyncLoadTreeData;
    /**
     * @type {?}
     * @private
     */
    TreeTableEventManager.prototype.ins;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmluZC10cmVldGFibGUtZXZlbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWxvb2t1cC8iLCJzb3VyY2VzIjpbImxpYi9zZXJ2aWNlcy9iaW5kLXRyZWV0YWJsZS1ldmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQ0EsT0FBTyxFQUFFLGNBQWMsRUFBRSxtQkFBbUIsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBRTVFLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFDdEMsT0FBTyxFQUFjLEVBQUUsRUFBVyxNQUFNLE1BQU0sQ0FBQztBQUUvQyxPQUFPLEVBQVEsR0FBRyxFQUFFLFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBSXZELE1BQU0sT0FBTyxxQkFBcUI7Ozs7SUFTOUIsWUFBb0IsR0FBd0I7UUFBeEIsUUFBRyxHQUFILEdBQUcsQ0FBcUI7UUFQcEMsZUFBVSxHQUFHLElBQUksQ0FBQzs7OztRQUlsQixxQkFBZ0IsR0FBRyxLQUFLLENBQUM7UUFtSnpCLHVCQUFrQjs7OztRQUFHLENBQUMsRUFBRSxFQUFFLEVBQUU7WUFDaEMsSUFBSSxJQUFJLENBQUMsR0FBRyxDQUFDLGdCQUFnQixLQUFLLFNBQVMsRUFBRTtnQkFDekMsT0FBTyxFQUFFLENBQUMsWUFBWSxLQUFLLEtBQUssQ0FBQzthQUNwQztpQkFBTTtnQkFDSCxPQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLEtBQUssU0FBUyxDQUFDO2FBQ2xEO1FBQ0wsQ0FBQyxFQUFDO1FBRU0seUJBQW9COzs7O1FBQUcsQ0FBQyxFQUFFLEVBQUUsRUFBRTtZQUNsQyxJQUFJLElBQUksQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLEtBQUssU0FBUyxFQUFFO2dCQUN6QyxPQUFPLEVBQUUsQ0FBQyxZQUFZLEtBQUssT0FBTyxDQUFDO2FBQ3RDO2lCQUFNO2dCQUNILE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsS0FBSyxXQUFXLENB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O1FBQ3pDLElBQUksQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDLGFBQWEsR0FBRyxHQUFHLElBQUksUUFBUSxDQUFDO0lBQzFELENBQUM7Q0FFSjs7Ozs7O0lBamlCRyxtREFBbUQ7Ozs7O0lBQ25ELDJDQUEwQjs7Ozs7O0lBSTFCLGlEQUFpQzs7Ozs7SUFtSmpDLG1EQU1FOzs7OztJQUVGLHFEQU1FOzs7OztJQTlKVSxvQ0FBZ0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUcmVlVGFibGVDb21wb25lbnQsIFRyZWVOb2RlIH0gZnJvbSAnQGZhcnJpcy91aS10cmVldGFibGUnO1xyXG5pbXBvcnQgeyBGYXZvcml0ZUFjdGlvbiwgRkFWT1JJVEVfRklFTERfTkFNRSB9IGZyb20gJy4uL2xvb2t1cC1kaXNwbGF5dHlwZSc7XHJcbmltcG9ydCB7IExPQURfREFUQV9UWVBFLCBMb29rdXBHcmlkUmVzdWx0IH0gZnJvbSAnLi4vbG9va3VwLWdyaWQtb3B0aW9ucyc7XHJcbmltcG9ydCB7IGNsb25lRGVlcCB9IGZyb20gJ2xvZGFzaC1lcyc7XHJcbmltcG9ydCB7IE9ic2VydmFibGUsIG9mLCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IExvb2t1cEdyaWRDb21wb25lbnQgfSBmcm9tICcuLi9sb29rdXAtZ3JpZC5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyB0YWtlLCB0YXAsIGNhdGNoRXJyb3IgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7IExvb2t1cFNlbGVjdGlvblNlcnZpY2UgfSBmcm9tICcuL2xvb2t1cC1zZWxlY3Rpb24uc2VydmljZSc7XHJcblxyXG5cclxuZXhwb3J0IGNsYXNzIFRyZWVUYWJsZUV2ZW50TWFuYWdlciB7XHJcbiAgICBwcml2YXRlIGxvb2t1cFNlbGVjdGlvblNlcjogTG9va3VwU2VsZWN0aW9uU2VydmljZTtcclxuICAgIHByaXZhdGUgX3NvcnRTdGF0ZSA9IG51bGw7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgKiDmoIfor4blvZPliY3mlbDmja7mmK/lkKbmn6Xor6Lnu5PmnpxcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBJU19TRUFSQ0hfUkVTVUxUID0gZmFsc2U7XHJcblxyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgaW5zOiBMb29rdXBHcmlkQ29tcG9uZW50KSB7XHJcbiAgICAgICAgdGhpcy5sb29rdXBTZWxlY3Rpb25TZXIgPSB0aGlzLmlucy5sb29rdXBTZWxlY3Rpb25TZXI7XHJcbiAgICB9XHJcblxyXG4gICAgc2VhcmNoVHJlZURhdGEoc2VhcmNoOiB7IGZpZWxkOiBzdHJpbmc7IHZhbHVlOiBzdHJpbmcgfSkge1xyXG4gICAgICAgIGNvbnN0IHR0ID0gdGhpcy5pbnMuY29tcG9uZW50UmVmLmluc3RhbmNlIGFzIFRyZWVUYWJsZUNvbXBvbmVudDtcclxuICAgICAgICAvLyDliKTmlq11cmkg5Y+R5Ye6c2VhcmNoLmVtaXQoKTtcclxuICAgICAgICBpZiAodGhpcy5pbnMuc2VhcmNoaW5nKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmlucy5zZWFyY2hpbmcgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5pbnMuc2hvd0xvYWRpbmcoKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5pbnMuaHR0cE1nci5nZXREYXRhKHsgc2VhcmNoLCBzb3J0TmFtZTogdHQuc29ydE5hbWUsIHNvcnRPcmRlcjogdHQuc29ydE9yZGVyIH0sICdzZWFyY2gnKS5waXBlKFxyXG4gICAgICAgICAgICB0YXAoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnMuc2VhcmNoaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH0pLFxyXG4gICAgICAgICAgICBjYXRjaEVycm9yKChlcnIpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5zLnNlYXJjaGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG9mKGVycik7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgKS5zdWJzY3JpYmUocmVzRGF0YSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zLmNsb3NlTG9hZGluZygpO1xyXG4gICAgICAgICAgICBpZiAocmVzRGF0YSkge1xyXG4gICAgICAgICAgICAgICAgLy8gdGhpcy5pbnMuaXRlbXMgPSByZXNEYXRhLml0ZW1zO1xyXG4gICAgICAgICAgICAgICAgdHQuY2xlYXJBbGwoKTtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCB0cmVlSW5mbyA9IHRoaXMuaW5zLmdyaWRPcHRpb25zLnRyZWVJbmZvO1xyXG4gICAgICAgICAgICAgICAgaWYgKCF0cmVlSW5mb1sndHJlZURhdGFJc0luaXQnXSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0cmVlSW5mby5sYXllclR5cGUudG9Mb3dlckNhc2UoKSA9PT0gJ3BhdGhjb2RlJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5pdGVtcyA9IHRoaXMuaW5zLmxvb2t1cFV0aWxzLm1ha2VUcmVlKHRoaXMuaW5zLml0ZW1zLCB0cmVlSW5mbyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMuaXRlbXMgPSB0aGlzLmlucy5sb29rdXBVdGlscy5tYWtlVHJlZVdpdGhQYXJlbnRJRChcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zLml0ZW1zLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmVlSW5mby5kYXRhRmllbGQgPyBgJHt0cmVlSW5mby5kYXRhRmllbGR9LiR7dHJlZUluZm8ucGFyZW50RmllbGR9YCA6IHRyZWVJbmZvLnBhcmVudEZpZWxkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMuaWRGaWVsZFxyXG4gICAgICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgY2hlY2tOb2RlcyA9IChub2Rlcyk6IFRyZWVOb2RlW10gPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChub2RlcyAmJiBub2Rlcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5vZGVzLm1hcCgobm9kZTogVHJlZU5vZGUpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChub2RlLmhhc093blByb3BlcnR5KCdhZGR0aW9uYWwnKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUuc2VsZWN0YWJsZSA9ICFub2RlWydhZGR0aW9uYWwnXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5jaGlsZHJlbiAmJiBub2RlLmNoaWxkcmVuLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrTm9kZXMobm9kZS5jaGlsZHJlbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9pc0xvYWRBbGxUcmVlRGF0YSh0dCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS5sZWFmID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbm9kZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBub2RlcztcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgX25vZGVzID0gY2hlY2tOb2RlcyhyZXNEYXRhLml0ZW1zKTtcclxuICAgICAgICAgICAgICAgIGlmIChfbm9kZXMgJiYgX25vZGVzLmxlbmd0aCAmJiBfbm9kZXNbMF0uY2hpbGRyZW4gJiYgX25vZGVzWzBdLmNoaWxkcmVuLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIF9ub2Rlc1swXS5leHBhbmRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgX25vZGVzWzBdLmNoaWxkcmVuID0gdGhpcy5pbnMuZXhwYW5kRmlyc3ROb2RlKF9ub2Rlc1swXS5jaGlsZHJlbik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlucy5pdGVtcyA9IF9ub2RlcztcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgLy8g5Yqg6L295pS26JeP5pWw5o2uXHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pbnMudXNlRmF2b3JpdGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyDmm7TmlrDmlbDmja7nmoTmlLbol4/nirbmgIFcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5mYXZIZWxwZXIudXBkYXRlRmF2b3JpdGVzU3RhdHVzKHRoaXMuaW5zLml0ZW1zKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB0dC5sb2FkRGF0YSh0aGlzLmlucy5pdGVtcyk7XHJcbiAgICAgICAgICAgICAgICAvLyAvLyDlsZXlvIDmn6Xor6Lnu5PmnpzjgIJcclxuICAgICAgICAgICAgICAgIC8vIGlmIChzZWFyY2gudmFsdWUgJiYgdGhpcy5pbnMuaXRlbXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgdHQudG9nZ2xlRXhwYW5kKHRoaXMuaW5zLml0ZW1zWzBdLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgIC8vIH1cclxuICAgICAgICAgICAgICAgIHR0LnJlc2l6ZSgpO1xyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMuSVNfU0VBUkNIX1JFU1VMVCA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnMuc2VsZWN0aW9uTWdyLnNlbGVjdEN1cnJlbnRWYWx1ZSgpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLmlucy5zZWFyY2guZW1pdChzZWFyY2gpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0Q2hpbGRyZW4oXHJcbiAgICAgICAgcGFyZW50UGF0aCxcclxuICAgICAgICBwYXJlbnRMYXllcixcclxuICAgICAgICBzZWFyY2hEYXRhOiB7IHNlYXJjaEZpZWxkOiBzdHJpbmc7IHNlYXJjaFZhbHVlOiBzdHJpbmcgfVxyXG4gICAgKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgICAgICBjb25zdCB1cmkgPSB0aGlzLmlucy5ncmlkT3B0aW9ucy51cmk7XHJcbiAgICAgICAgY29uc3Qgc2VhcmNoID0geyBwYXJlbnRMYXllciwgY2F0ZWdvcnk6ICdjaGlsZHJlbicsIC4uLnNlYXJjaERhdGEgfTtcclxuICAgICAgICBpZiAodGhpcy5pbnMudHJlZUluZm8ubGF5ZXJUeXBlID09PSAncGFyZW50SWQnKSB7XHJcbiAgICAgICAgICAgIHNlYXJjaFsncGFyZW50SWQnXSA9IHBhcmVudFBhdGg7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgc2VhcmNoWydwYXJlbnRQYXRoJ10gPSBwYXJlbnRQYXRoO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBjb25zdCBwYXJhbSA9IHtcclxuICAgICAgICAgICAgc2VhcmNoVmFsdWU6ICcnLFxyXG4gICAgICAgICAgICBjdXN0b21EYXRhOiB0aGlzLmlucy5jdXN0b21EYXRhLFxyXG4gICAgICAgICAgICBlbmFibGVGdWxsVHJlZTogdGhpcy5pbnMuZW5hYmxlRnVsbFRyZWUsXHJcbiAgICAgICAgICAgIGxvYWRUcmVlRGF0YVR5cGU6IHRoaXMuaW5zLmxvYWRUcmVlRGF0YVR5cGVcclxuICAgICAgICB9O1xyXG4gICAgICAgIFxyXG4gICAgICAgIGNvbnN0IHR0ID0gdGhpcy5pbnMuY29tcG9uZW50UmVmLmluc3RhbmNlIGFzIFRyZWVUYWJsZUNvbXBvbmVudDtcclxuICAgICAgICBpZiAodHQgJiYgdHQuc29ydE5hbWUpIHtcclxuICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihzZWFyY2gsIHtcclxuICAgICAgICAgICAgICAgIHNvcnROYW1lOiB0dC5zb3J0TmFtZSxcclxuICAgICAgICAgICAgICAgIHNvcnRPcmRlcjogdHQuc29ydE9yZGVyXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgIFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuSVNfU0VBUkNIX1JFU1VMVCkge1xyXG4gICAgICAgICAgICBwYXJhbS5lbmFibGVGdWxsVHJlZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICBwYXJhbS5sb2FkVHJlZURhdGFUeXBlID0gJ2xheWVybG9hZCc7XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5pbnMudHJlZUluZm8ubGF5ZXJUeXBlID09PSAncGFyZW50SWQnKSB7XHJcbiAgICAgICAgICAgICAgICAvLyDmoJHlvaLluK7liqnmn6Xor6LlkI7vvIzlsZXlvIDoioLngrnml7blsIbnm7jlhbPmn6Xor6Llj4LmlbDkvKDpgJLliLDlkI7nq68gMjAyMi0wOS0xM1xyXG4gICAgICAgICAgICAgICAgc2VhcmNoLnNlYXJjaFZhbHVlID0gJyc7XHJcbiAgICAgICAgICAgICAgICBzZWFyY2guc2VhcmNoRmllbGQgPSAnKic7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gcGFyYW0uc2VhcmNoVmFsdWUgPSBKU09OLnN0cmluZ2lmeShzZWFyY2gpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcGFyYW0uc2VhcmNoVmFsdWUgPSBKU09OLnN0cmluZ2lmeShzZWFyY2gpO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5pbnMuaGVscElkKSB7XHJcbiAgICAgICAgICAgIHBhcmFtWydoZWxwSWQnXSA9IHRoaXMuaW5zLmhlbHBJZDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLmlucy5odHRwLmdldERhdGEodXJpLCBwYXJhbSk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHByaXZhdGUgX2lzTG9hZEFsbFRyZWVEYXRhID0gKHR0KSA9PiB7XHJcbiAgICAgICAgaWYgKHRoaXMuaW5zLmxvYWRUcmVlRGF0YVR5cGUgPT09ICdkZWZhdWx0Jykge1xyXG4gICAgICAgICAgICByZXR1cm4gdHQubG9hZERhdGFUeXBlID09PSAnYWxsJztcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5pbnMubG9hZFRyZWVEYXRhVHlwZSA9PT0gJ2xvYWRhbGwnO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgcHJpdmF0ZSBfaXNBc3luY0xvYWRUcmVlRGF0YSA9ICh0dCkgPT4ge1xyXG4gICAgICAgIGlmICh0aGlzLmlucy5sb2FkVHJlZURhdGFUeXBlID09PSAnZGVmYXVsdCcpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHR0LmxvYWREYXRhVHlwZSA9PT0gJ2FzeW5jJztcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5pbnMubG9hZFRyZWVEYXRhVHlwZSA9PT0gJ2xheWVybG9hZCc7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcblxyXG4gICAgYmluZFRyZWV0YWJsZUV2ZW50KCkge1xyXG4gICAgICAgIGNvbnN0IHR0ID0gdGhpcy5pbnMuY29tcG9uZW50UmVmLmluc3RhbmNlIGFzIFRyZWVUYWJsZUNvbXBvbmVudDtcclxuICAgICAgICBjb25zdCBfc2VhcmNoVHJlZURhdGEgPSAoc2VhcmNocGFyYW06IGFueSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5pbnMucmVtb3RlU2VhcmNoKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlucy5fc2VhcmNoU3RhdGUgPSBzZWFyY2hwYXJhbTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VhcmNoVHJlZURhdGEoc2VhcmNocGFyYW0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaW5zLnVzZUluc2lkZVNlYXJjaEhhbmRsZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICB0dC5zZWFyY2hIYW5kbGUuc2VhcmNoKHNlYXJjaHBhcmFtLmZpZWxkLCBzZWFyY2hwYXJhbS52YWx1ZSwgJ2NsaWVudCcpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5zZWFyY2guZW1pdChzZWFyY2hwYXJhbSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBjb25zdCBpc0xvYWRBbGxUcmVlRGF0YSA9ICgpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lzTG9hZEFsbFRyZWVEYXRhKHR0KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBjb25zdCBpc0FzeW5jTG9hZFRyZWVEYXRhID0gKCkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5faXNBc3luY0xvYWRUcmVlRGF0YSh0dCk7XHJcbiAgICAgICAgfTtcclxuXHJcblxyXG4gICAgICAgIHR0LmRibENsaWNrRXhwYW5kID0gIXRoaXMuaW5zLnNpbmdsZVNlbGVjdDsgLy8g56aB55So5Y+M5Ye75bGV5byA6IqC54K5XHJcblxyXG4gICAgICAgIHR0LmFsbENvbHVtbnNUaXRsZSA9IHRoaXMuaW5zLmFsbENvbHVtbnNUaXRsZTsgLy8gdGhpcy5kaXNwbGF5SW5mby5hbGxDb2x1bW5zO1xyXG4gICAgICAgIHR0LmlkRmllbGQgPSB0aGlzLmlucy5pZEZpZWxkO1xyXG4gICAgICAgIHR0LmNvbHVtbnMgPSB0aGlzLmlucy5jb2x1bW5zO1xyXG4gICAgICAgIHR0LnNlYXJjaEZpZWxkcyA9IHRoaXMuaW5zLmdyaWRPcHRpb25zLnNlYXJjaEZpZWxkcztcclxuICAgICAgICBpZiAodGhpcy5pbnMudHJlZUluZm8pIHtcclxuICAgICAgICAgICAgdHQubG9hZERhdGFUeXBlID0gdGhpcy5pbnMudHJlZUluZm8ubG9hZERhdGFUeXBlO1xyXG4gICAgICAgICAgICB0dC52aXJ0dWFsaXplZCA9IHRydWU7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5pbnMuaXNUZXh0Q2hhbmdlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlucy5hbGxEYXRhID0gY2xvbmVEZWVwKHRoaXMuaW5zLml0ZW1zKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5zLmFsbERhdGEgPSBbXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuaW5zLmdyaWRPcHRpb25zLnRyZWVJbmZvKSB7XHJcbiAgICAgICAgICAgIHR0Lm9ubHlTZWxlY3RMZWFmID0gdGhpcy5pbnMuZ3JpZE9wdGlvbnMudHJlZUluZm8ub25seVNlbGVjdExlYWY7XHJcbiAgICAgICAgICAgIHR0LmxvYWREYXRhVHlwZSA9IHRoaXMuaW5zLmdyaWRPcHRpb25zLnRyZWVJbmZvLmxvYWREYXRhVHlwZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICghdHQuc2luZ2xlU2VsZWN0KSB7XHJcbiAgICAgICAgICAgIHR0LmNoZWNrT25TZWxlY3QgPSB0cnVlO1xyXG4gICAgICAgICAgICB0dC5zZWxlY3RPbkNoZWNrID0gdHJ1ZTtcclxuICAgICAgICAgICAgdHQuc2hvd0NoZWNrYm94ID0gdHJ1ZTtcclxuICAgICAgICAgICAgdHQuc2hvd0NoZWNrQWxsID0gIHRoaXMuaW5zLnNob3dDaGVja0FsbDtcclxuICAgICAgICAgICAgLy8g5ZCv55So5aSa6YCJ5ZCO77yM5ZCM5pe25ZCv55So57qn6IGU6YCJ5oupXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmlucy5lbmFibGVDYXNjYWRlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNhc2NhZGVWYWx1ZUNoYW5nZWQodGhpcy5pbnMuY2FzY2FkZVN0YXR1cyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0dC5jYXNjYWRlQ2hlY2sgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHR0LmNhc2NhZGVEb3duID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB0dC5jYXNjYWRlVXAgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdHQuZW5hYmxlRmluZFRleHQgPSB0aGlzLmlucy5lbmFibGVGaW5kVGV4dDtcclxuICAgICAgICAvLyB0dC5maW5kRmllbGQgPSB0aGlzLnRleHRGaWVsZDtcclxuICAgICAgICB0dC5ub2RlU2VsZWN0ZWQuc3Vic2NyaWJlKChlOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgLy8gaWYgKHRoaXMuaW5zLmZhdm9yaXRlc0NvbXBvbmVudFJlZiAmJiB0aGlzLmlucy5zaW5nbGVTZWxlY3QpIHtcclxuICAgICAgICAgICAgLy8gICAgIGNvbnN0IGZ0dCA9IHRoaXMuaW5zLmZhdm9yaXRlc0NvbXBvbmVudFJlZi5pbnN0YW5jZSBhcyBUcmVlVGFibGVDb21wb25lbnQ7XHJcbiAgICAgICAgICAgIC8vICAgICBmdHQuY2xlYXJTZWxlY3Rpb25zKCk7XHJcbiAgICAgICAgICAgIC8vIH1cclxuICAgICAgICAgICAgaWYgKHRoaXMuaW5zLnNpbmdsZVNlbGVjdCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5sb29rdXBTZWxlY3Rpb25TZXIuY2xlYXJTZWxlY3Rpb25zKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5sb29rdXBTZWxlY3Rpb25TZXIudXBkYXRlU2VsZWN0aW9ucyhbZS5ub2RlLmRhdGFdKTtcclxuICAgICAgICAgICAgdGhpcy5pbnMuY2hlY2tlZENoYW5nZS5lbWl0KHsgZGF0YTogW2Uubm9kZS5kYXRhXSAsIGlzQ2hlY2s6IHRydWUgIH0pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0dC5ub2RlQ2hlY2tlZC5zdWJzY3JpYmUoIGUgPT4ge1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuaW5zLnNpbmdsZVNlbGVjdCkge1xyXG4gICAgICAgICAgICAgICAgbGV0IGRhdGEgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgaWYgKGUubm9kZXMgJiYgZS5ub2Rlcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICBkYXRhID0gZS5ub2Rlcy5tYXAobiA9PiBuLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuaW5zLm11bHRpU2VsTWdyLnVwZGF0ZVNlbGVjdGlvbnMoZS5ub2Rlcy5tYXAobiA9PiBuLmRhdGEpKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoZS5ub2RlKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0gZS5ub2RlLm1hcChuID0+IG4uZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuaW5zLm11bHRpU2VsTWdyLnVwZGF0ZVNlbGVjdGlvbnMoZS5ub2RlLm1hcChuID0+IG4uZGF0YSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSBbZS5ub2RlLmRhdGFdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLmlucy5tdWx0aVNlbE1nci51cGRhdGVTZWxlY3Rpb25zKFtlLm5vZGUuZGF0YV0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRoaXMuaW5zLm11bHRpU2VsTWdyLnVwZGF0ZVNlbGVjdGlvbnMoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlucy5jaGVja2VkQ2hhbmdlLmVtaXQoeyBkYXRhLCBpc0NoZWNrOiB0cnVlICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0dC5ub2RlVW5DaGVja2VkLnN1YnNjcmliZSgoZTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChlICYmIGUubm9kZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmlucy5zaW5nbGVTZWxlY3QpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5tdWx0aVNlbE1nci5yZW1vdmUoZS5ub2RlLmlkKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8g5YiG5bGC5Yqg6L2977yM5aSa6YCJ77yM5YyF5ZCr5LiL57qn5pe277yM5Y+W5raI5Yu+6YCJIOmcgOimgeWwhuW9k+WJjeiKgueCueeahOaJgOacieWtkOe6p+aVsOaNruS5n+imgeWPlua2iOmAieaLqe+8jOWNs+S7juW3sumAieiusOW9leS4reenu+mZpFxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0dC5sb2FkRGF0YVR5cGUgIT09ICdhbGwnICYmIHRoaXMuaW5zLnRyZWVJbmZvLmxheWVyVHlwZSA9PT0gJ3BhdGhjb2RlJyAmJlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAodGhpcy5pbnMuY2FzY2FkZVN0YXR1cyA9PT0gJ2VuYWJsZScgfHwgdGhpcy5pbnMuY2FzY2FkZVN0YXR1cyA9PT0gJ2Rvd24nKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZS5ub2RlLmNoaWxkcmVuICYmIGUubm9kZS5jaGlsZHJlbi5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG5vZGVzID0gZS5ub2RlLmNoaWxkcmVuLm1hcChuID0+IG4uZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5sb29rdXBTZWxlY3Rpb25TZXIudXBkYXRlU2VsZWN0aW9ucyhub2RlcywgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29uc3QgcGF0aGNvZGUgPSBlLm5vZGUuZGF0YVt0aGlzLmlucy50cmVlSW5mby5kYXRhRmllbGRdW3RoaXMuaW5zLnRyZWVJbmZvLnBhdGhGaWVsZF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXRoY29kZSA9IHRoaXMuaW5zLmdldFBhdGhDb2RlKGUubm9kZS5kYXRhLCB0aGlzLmlucy50cmVlSW5mbylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zLmxvb2t1cFNlbGVjdGlvblNlci51bnNlbGVjdEJ5UGF0aGNvZGUocGF0aGNvZGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoZS5ub2RlcyAmJiBlLm5vZGVzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5tdWx0aVNlbE1nci5yZW1vdmUoZS5ub2Rlcy5tYXAobiA9PiBuLmlkKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zLmNoZWNrZWRDaGFuZ2UuZW1pdCh7IGRhdGE6IGUubm9kZXMubWFwKG4gPT4gbi5kYXRhKSwgaXNDaGVjazogZmFsc2UgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMuY2hlY2tlZENoYW5nZS5lbWl0KHsgZGF0YTogW2Uubm9kZS5kYXRhXSwgaXNDaGVjazogZmFsc2UgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBmdHQgPSB0aGlzLmlucy5mYXZvcml0ZXNDb21wb25lbnRSZWYgJiYgKHRoaXMuaW5zLmZhdm9yaXRlc0NvbXBvbmVudFJlZi5pbnN0YW5jZSBhcyBUcmVlVGFibGVDb21wb25lbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChmdHQgJiYgZnR0LmZpbmRSb3dOb2RlKGUubm9kZS5pZCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZnR0LnVuU2VsZWN0Tm9kZShlLm5vZGUuaWQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMuY2hlY2tlZENoYW5nZS5lbWl0KHsgZGF0YTogW2Uubm9kZS5kYXRhXSwgaXNDaGVjazogZmFsc2UgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdHQuY2hlY2tBbGwuc3Vic2NyaWJlKCBlID0+IHtcclxuICAgICAgICAgICAgY29uc3QgZGF0YSA9IGUuaW5zdGFuY2UuY2hlY2tlZHMubWFwKG4gPT4gbi5kYXRhKTtcclxuICAgICAgICAgICAgdGhpcy5pbnMubXVsdGlTZWxNZ3IudXBkYXRlU2VsZWN0aW9ucyhkYXRhKTtcclxuICAgICAgICAgICAgdGhpcy5pbnMuY2hlY2tlZENoYW5nZS5lbWl0KHsgZGF0YSwgaXNDaGVjazogdHJ1ZSAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdHQudW5DaGVja0FsbC5zdWJzY3JpYmUoKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmlucy5tdWx0aVNlbE1nci5jbGVhcigpO1xyXG4gICAgICAgICAgICB0aGlzLmlucy5jaGVja2VkQ2hhbmdlLmVtaXQoeyBkYXRhOiBbXSwgaXNDaGVjazogZmFsc2UgIH0pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0dC5zZWFyY2guc3Vic2NyaWJlKHNlYXJjaHBhcmFtID0+IHtcclxuICAgICAgICAgICAgaWYgKHNlYXJjaHBhcmFtLmZpZWxkICE9PSAnKicgJiYgIXNlYXJjaHBhcmFtLnZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlucy5tZXNzYWdlclNlcnZpY2Uud2FybmluZyh0aGlzLmlucy5tdXN0V3JpdGVTb21ldGhpbmcpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgc2VhcmNocGFyYW0udmFsdWUgPSBzZWFyY2hwYXJhbS52YWx1ZS50cmltKCk7XHJcbiAgICAgICAgICAgICAgICBfc2VhcmNoVHJlZURhdGEoc2VhcmNocGFyYW0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHR0LmNlbGxDbGljay5zdWJzY3JpYmUoKGU6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZS5jb2wuZmllbGQgPT09IEZBVk9SSVRFX0ZJRUxEX05BTUUpIHtcclxuICAgICAgICAgICAgICAgIGUuZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IG5vLXN0cmluZy1saXRlcmFsXHJcbiAgICAgICAgICAgICAgICBjb25zdCBjbGFzc0xpc3QgPSBlLmV2ZW50LnRhcmdldFsnY2xhc3NMaXN0J107XHJcbiAgICAgICAgICAgICAgICBpZiAoY2xhc3NMaXN0LmNvbnRhaW5zKCdmLWxvb2t1cC1mYXZvcml0ZScpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gY2xhc3NMaXN0LnRvZ2dsZSgnZi1pY29uLXN0YXInKTtcclxuICAgICAgICAgICAgICAgICAgICAvLyBjbGFzc0xpc3QudG9nZ2xlKCdmLWljb24tc3Rhci1vdXRsaW5lJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgX3RoaXMgPSB0aGlzLmlucztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgKGZ1bmN0aW9uIGVhY2goYXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyci5mb3JFYWNoKGl0ZW0gPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGlkID0gX3RoaXMudXRpbHMuZ2V0VmFsdWUoX3RoaXMuaWRGaWVsZCwgaXRlbS5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaWQgPT09IGUubm9kZS5pZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLmRhdGFbRkFWT1JJVEVfRklFTERfTkFNRV0gPSAhaXRlbS5kYXRhW0ZBVk9SSVRFX0ZJRUxEX05BTUVdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGl0ZW0uY2hpbGRyZW4gJiYgaXRlbS5jaGlsZHJlbi5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlYWNoKGl0ZW0uY2hpbGRyZW4pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pKHRoaXMuaW5zLml0ZW1zKTtcclxuICAgICAgICAgICAgICAgICAgICB0dC5sb2FkRGF0YSh0aGlzLmlucy5pdGVtcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIOabtOaWsOaUtuiXj+aVsOaNrlxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9va3VwU2VsZWN0aW9uU2VyLnVwZGF0ZUZhdm9yaXRlRGF0YSggZS5ub2RlLmRhdGEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGUubm9kZS5kYXRhW0ZBVk9SSVRFX0ZJRUxEX05BTUVdID8gRmF2b3JpdGVBY3Rpb24uYWRkIDogRmF2b3JpdGVBY3Rpb24uZGVsZXRlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0dC5kYmxDbGljay5zdWJzY3JpYmUoKHRyZWVOb2RlOiBUcmVlTm9kZSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5pbnMuZ3JpZE9wdGlvbnMuc2luZ2xlU2VsZWN0ICYmIHRyZWVOb2RlLnNlbGVjdGFibGUpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlucy5va0J1dHRvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIHRoaXMubG9va3VwU2VsZWN0aW9uU2VyLnNlbGVjdCh0cmVlTm9kZS5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLmlucy5va0J1dHRvbi5uYXRpdmVFbGVtZW50LmNsaWNrKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMuc2VsZWN0SXRlbSh0cmVlTm9kZS5kYXRhKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGNvbnN0IGxvYWRBbGxEYXRhID0gaXNMb2FkQWxsVHJlZURhdGEoKTtcclxuICAgICAgICB0dC5jb2x1bW5Tb3J0ZWQuc3Vic2NyaWJlKChzb3J0OiB7IHNvcnROYW1lOiBzdHJpbmc7IHNvcnRPcmRlcjogYW55OyB9KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuX3NvcnRTdGF0ZSA9IHNvcnQ7XHJcbiAgICAgICAgICAgIGlmIChpc0xvYWRBbGxUcmVlRGF0YSgpKSB7XHJcbiAgICAgICAgICAgICAgICB0dC5jbGllbnRTb3J0KCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB7IHNvcnROYW1lLCBzb3J0T3JkZXIgfSA9IHsgLi4uc29ydCB9O1xyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IGNvbCA9IHRoaXMuaW5zLmNvbHVtbnMuZmluZChuID0+IG4uZmllbGQgPT09IHNvcnROYW1lKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IF9zb3J0TmFtZSA9IGNvbCA/IGNvbC5maWVsZFBhdGggPyBjb2wuZmllbGRQYXRoIDogY29sLmZpZWxkIDogc29ydE5hbWU7XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgcGFyYW0gPSBPYmplY3QuYXNzaWduKHsgc29ydE5hbWU6IF9zb3J0TmFtZSwgc29ydE9yZGVyIH0sIHsgc2VhcmNoOiB0aGlzLmlucy5fc2VhcmNoU3RhdGUgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IHJlcVR5cDogTE9BRF9EQVRBX1RZUEUgPSAnYWxsJztcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlucy5fc2VhcmNoU3RhdGUgJiYgdGhpcy5pbnMuX3NlYXJjaFN0YXRlLnZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVxVHlwID0gJ3NlYXJjaCc7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnMuaHR0cE1nci5nZXREYXRhKHBhcmFtLCByZXFUeXApLnN1YnNjcmliZShkID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5jbG9zZUxvYWRpbmcoKTtcclxuICAgICAgICAgICAgICAgICAgICB0dC5jbGVhckFsbCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW1zID0gdGhpcy5pbnMuY2hlY2tOb2RlQ2FuQmVTZWxlY3QoZC5pdGVtcywgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmlucy51c2VGYXZvcml0ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5mYXZIZWxwZXIudXBkYXRlRmF2b3JpdGVzU3RhdHVzKGl0ZW1zKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMuaXRlbXMgPSBpdGVtcztcclxuICAgICAgICAgICAgICAgICAgICB0dC5sb2FkRGF0YShpdGVtcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgdHQucmVzaXplKCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0dC5jbGVhclNlYXJjaFZhbHVlLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zLl9zZWFyY2hTdGF0ZSA9IG51bGw7XHJcbiAgICAgICAgICAgIHRoaXMuSVNfU0VBUkNIX1JFU1VMVCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBsZXQgX2l0ZW1zID0gW107XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmlucy5hbGxEYXRhICYmIHRoaXMuaW5zLmFsbERhdGEubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICBfaXRlbXMgPSB0aGlzLmlucy5jaGVja05vZGVDYW5CZVNlbGVjdCh0aGlzLmlucy5hbGxEYXRhLCBsb2FkQWxsRGF0YSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCFfaXRlbXMgfHwgIV9pdGVtcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIF9zZWFyY2hUcmVlRGF0YSh7IGZpZWxkOiAnKicsIHZhbHVlOiAnJyB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5zLml0ZW1zID0gX2l0ZW1zO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnMuZmF2SGVscGVyLnVwZGF0ZUZhdm9yaXRlc1N0YXR1cyh0aGlzLmlucy5pdGVtcyk7XHJcbiAgICAgICAgICAgICAgICB0dC5sb2FkRGF0YShfaXRlbXMpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnMuc2VsZWN0aW9uTWdyLnNlbGVjdEN1cnJlbnRWYWx1ZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHR0LmV4cGFuZC5zdWJzY3JpYmUoKHRuOiBUcmVlTm9kZSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAodG4ubGVhZiB8fCAgdG5bJ3Nob3dMb2FkaW5nJ10pIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIXRuLmNoaWxkcmVuIHx8ICF0bi5jaGlsZHJlbi5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHRyZWVJbmZvID0gdGhpcy5pbnMuZ3JpZE9wdGlvbnMudHJlZUluZm87XHJcbiAgICAgICAgICAgICAgICBpZiAoaXNBc3luY0xvYWRUcmVlRGF0YSgpIHx8IHRoaXMuSVNfU0VBUkNIX1JFU1VMVCApIHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgcGFyZW50UGF0aCA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBwYXJlbnRMYXllciA9IC0xO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgZmllbGQgPSAnKicsIHZhbHVlID0gJycgfSA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLi4udHQuc2VhcmNoRGF0YVxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHRuWydzaG93TG9hZGluZyddID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB0dC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRyZWVJbmZvLmxheWVyVHlwZSA9PT0gJ3BhcmVudElkJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyDniLZJROWKoOi9veaWueW8j1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRQYXRoID0gdG5bJ2lkJ107XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdHJlZUluZm9GaWVsZCA9IHRyZWVJbmZvLmRhdGFGaWVsZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRyZWVJbmZvRmllbGQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHBhcmVudFBhdGggPSB0bi5kYXRhW3RyZWVJbmZvRmllbGRdW3RyZWVJbmZvLnBhdGhGaWVsZF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRQYXRoID0gdGhpcy5pbnMuZ2V0UGF0aENvZGUodG4uZGF0YSwgdHJlZUluZm8pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gcGFyZW50TGF5ZXIgPSB0bi5kYXRhW3RyZWVJbmZvRmllbGRdW3RyZWVJbmZvLmxheWVyRmllbGRdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50TGF5ZXIgPSB0aGlzLmlucy5nZXRMYXllckRhdGEodG4uZGF0YSwgdHJlZUluZm8pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMud3JpdGVDb25zb2xlKCfmnKrmib7liLDliIbnuqfkv6Hmga/jgIInKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmlucy51cmkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMuZXhwYW5kVHJlZU5vZGUuZW1pdCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZTogdHQsIG5vZGU6IHRuLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50SWRPclBhdGg6IHBhcmVudFBhdGgsIHBhcmVudExheWVyLCBzZWFyY2g6IHsgdmFsdWUsIGZpZWxkIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5zaG93TG9hZGluZygpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmdldENoaWxkcmVuKHBhcmVudFBhdGgsIHBhcmVudExheWVyLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlYXJjaEZpZWxkOiBmaWVsZCA9PT0gJyonID8gJyonIDogZmllbGQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlYXJjaFZhbHVlOiB2YWx1ZVxyXG4gICAgICAgICAgICAgICAgICAgIH0pLnN1YnNjcmliZShkYXRhID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMuY2xvc2VMb2FkaW5nKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0dCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRuICYmIGRhdGEuaXRlbXMgJiYgZGF0YS5pdGVtcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pbnMudXNlRmF2b3JpdGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g5pu05paw5a2Q6IqC54K55pS26JeP54q25oCBXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zLmZhdkhlbHBlci51cGRhdGVGYXZvcml0ZXNTdGF0dXMoZGF0YS5pdGVtcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBub2RlcyA9IHRoaXMuaW5zLmNoZWNrTm9kZUNhbkJlU2VsZWN0KGRhdGEuaXRlbXMsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHQuYXBwZW5kQ2hpbGRyZW4obm9kZXMsIHRuKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR0LmxvYWREYXRhVHlwZSAhPT0gJ2FsbCcgJiYgIXRoaXMuaW5zLnNpbmdsZVNlbGVjdCAmJiB0aGlzLmlucy5pc0dldEFsbENoaWRsTm9kZXMgJiZcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHRoaXMuaW5zLmNhc2NhZGVTdGF0dXMgPT09ICdlbmFibGUnIHx8IHRoaXMuaW5zLmNhc2NhZGVTdGF0dXMgPT09ICdkb3duJykgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJuID0gdHQuZmluZFJvd05vZGUodG4uaWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0dC5wcm9wYWdhdGVTZWxlY3Rpb25Eb3duKHJuLCBybi5pc0NoZWNrZWQpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g5pu05paw6YCJ5Lit6K6w5b2V57yT5a2YXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IF9pdGVtcyA9IGRhdGEuaXRlbXMuZmlsdGVyKG4gPT4gIW4uYWRkdGlvbmFsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF9pdGVtcyAmJiBfaXRlbXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5sb29rdXBTZWxlY3Rpb25TZXIudXBkYXRlU2VsZWN0aW9ucyhfaXRlbXMubWFwKG4gPT4gbi5kYXRhKSwgcm4uaXNDaGVja2VkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRuWydzaG93TG9hZGluZyddID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0dC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0dC5wc1JlZi5kaXJlY3RpdmVSZWYudXBkYXRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5zZWxlY3Rpb25NZ3Iuc2VsZWN0Q3VycmVudFZhbHVlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5pbnMuc2luZ2xlU2VsZWN0ICYmIHRoaXMuaW5zLmVuYWJsZUNhc2NhZGUgJiZcclxuICAgICAgICAgICAgICAgICAgICAgICAgKHRoaXMuaW5zLmNhc2NhZGVTdGF0dXMgPT09ICdlbmFibGUnIHx8IHRoaXMuaW5zLmNhc2NhZGVTdGF0dXMgPT09ICdkb3duJykgJiYgdGhpcy5pbnMuaXNHZXRBbGxDaGlkbE5vZGVzICkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJuID0gdHQuZmluZFJvd05vZGUodG4uaWQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHR0LnByb3BhZ2F0ZVNlbGVjdGlvbkRvd24ocm4sIHJuLmlzQ2hlY2tlZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0SXRlbXMgPSB0bi5jaGlsZHJlbi5maWx0ZXIobiA9PiBuLnNlbGVjdGFibGUpLm1hcChuID0+IG4uZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMubG9va3VwU2VsZWN0aW9uU2VyLnVwZGF0ZVNlbGVjdGlvbnMoc2VsZWN0SXRlbXMsIHJuLmlzQ2hlY2tlZCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyB0aGlzLmlucy5zZWxlY3Rpb25NZ3Iuc2VsZWN0Q3VycmVudFZhbHVlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaWYgKGxvYWRBbGxEYXRhICYmIHRoaXMuaW5zLml0ZW1zKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zLnRyZWVOb2RlSGVscGVyLnVwZGF0ZVRyZWVOb2RlRXhwYW5kZWQodGhpcy5pbnMuaXRlbXMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbG9hZEFsbERhdGE7XHJcbiAgICB9XHJcblxyXG4gICAgY2FzY2FkZVZhbHVlQ2hhbmdlZCgkZXZlbnQpIHtcclxuICAgICAgICBjb25zdCB2YWwgPSAkZXZlbnQ7XHJcbiAgICAgICAgLy8gY29uc3QgdHQgPSB0aGlzLmlucy5jb21wb25lbnRSZWYuaW5zdGFuY2UgYXMgVHJlZVRhYmxlQ29tcG9uZW50O1xyXG4gICAgICAgIGNvbnN0IGluc3RhbmNlVHlwID0gdGhpcy5pbnMuYWN0aXZlVGFiID09PSAnZGF0YWxpc3QnID8gJ3RyZWV0YWJsZScgOiAnZmF2JztcclxuICAgICAgICBjb25zdCB0dCA9IHRoaXMuaW5zLmxvb2t1cENtcE1nci5nZXRDb21wb25lbnRJbnN0YW5jZShpbnN0YW5jZVR5cCkgYXMgVHJlZVRhYmxlQ29tcG9uZW50O1xyXG5cclxuICAgICAgICBpZiAoIXR0KSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHN3aXRjaCAodmFsKSB7XHJcbiAgICAgICAgICAgIGNhc2UgJ2VuYWJsZSc6XHJcbiAgICAgICAgICAgICAgICB0dC5jYXNjYWRlQ2hlY2sgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdHQuY2FzY2FkZURvd24gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdHQuY2FzY2FkZVVwID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICdkaXNhYmxlJzpcclxuICAgICAgICAgICAgICAgIHR0LmNhc2NhZGVDaGVjayA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdHQuY2FzY2FkZURvd24gPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHR0LmNhc2NhZGVVcCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ3VwJzpcclxuICAgICAgICAgICAgICAgIHR0LmNhc2NhZGVDaGVjayA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB0dC5jYXNjYWRlVXAgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdHQuY2FzY2FkZURvd24gPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICdkb3duJzpcclxuICAgICAgICAgICAgICAgIHR0LmNhc2NhZGVDaGVjayA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB0dC5jYXNjYWRlRG93biA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB0dC5jYXNjYWRlVXAgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgdHQuY2FzY2FkZUNoZWNrID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHR0LmNhc2NhZGVEb3duID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHR0LmNhc2NhZGVVcCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuaW5zLmNhc2NhZGVTdGF0dXMgPSB2YWwgfHwgJ2VuYWJsZSc7XHJcbiAgICAgICAgdGhpcy5pbnMucGVyc29uYWxDb25mLmNhc2NhZGVTdGF0dXMgPSB2YWwgfHwgJ2VuYWJsZSc7XHJcbiAgICB9XHJcblxyXG59XHJcbiJdfQ==