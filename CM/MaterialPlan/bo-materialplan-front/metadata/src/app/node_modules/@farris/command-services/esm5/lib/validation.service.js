import * as tslib_1 from "tslib";
// tslint:disable: max-line-length
import { Injectable, Optional } from '@angular/core';
import { Repository, FrameContext, PARENT_CLASS, ChangeType, DataPropGroup } from '@farris/devkit';
import { tap, switchMap } from 'rxjs/operators';
import { EMPTY, Subject } from 'rxjs';
import { zip } from 'rxjs/observable/zip';
import { empty } from 'rxjs/observable/empty';
import { of } from 'rxjs/observable/of';
import { VerifyDetailService } from '@farris/ui-verify-detail';
import { FormNotifyService } from './form-notify.service';
import { LanguageService } from './languag.service';
/**
 * 表单验证服务
 * @scope FrameComponent
 */
var ValidationService = /** @class */ (function () {
    /**
     * 构造函数
     */
    function ValidationService(repository, frameContext, notifyService, languageService) {
        this.repository = repository;
        this.frameContext = frameContext;
        this.notifyService = notifyService;
        this.languageService = languageService;
        this.validationResults = new Subject();
        this.validationAllResult = new Subject();
        if (!this.languageService) {
            this.languageService = new LanguageService();
        }
    }
    /**
     * 验证表单内的所有表单
     */
    ValidationService.prototype.validate = function () {
        var _this = this;
        this.repository.getList().subscribe(function (result) {
            var e_1, _a;
            try {
                for (var result_1 = tslib_1.__values(result), result_1_1 = result_1.next(); !result_1_1.done; result_1_1 = result_1.next()) {
                    var entity = result_1_1.value;
                    entity.validate().subscribe(function (result) {
                        if (!result.isValid) {
                            alert(result.message);
                            _this.validationResults.next(result);
                        }
                    });
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (result_1_1 && !result_1_1.done && (_a = result_1.return)) _a.call(result_1);
                }
                finally { if (e_1) throw e_1.error; }
            }
        });
        return this.validationResults;
    };
    /**
     * 校验当前行
     */
    ValidationService.prototype.validateCurrentRow = function () {
        var _this = this;
        var entityTypeInfo = this.repository.entityTypeInfo;
        // 组合表单只校验当前按钮所在的表单
        var primaryValue = this.frameContext.bindingData.list.currentId;
        if (!primaryValue) {
            return of(true);
        }
        // 首先校验实体不能为空规则
        var entity = this.repository.entityCollection.getEntityById(primaryValue);
        if (!entity) {
            return of(true);
        }
        var isEntityValid = this.validateEntityAllowEmptyRule(entityTypeInfo);
        if (!isEntityValid) {
            return EMPTY;
        }
        var entities = [entity];
        var namespace = this.frameContext.namespace;
        var frameContexts = [];
        // 修复使用相同be创建的vo的组合表单校验时多个表单校验规则被合并的问题
        // TODO: 目前未考虑组合表单统一保存的场景，后续支持组合表单统一保存时再修改
        if (namespace !== null) {
            // 存在命名空间，说明表单较新，可以依赖该特性
            frameContexts = this.frameContext.appContext.frameContextManager.getFrameContextsByNamespace(namespace);
        }
        else {
            // 表单较老，获取所有的上下文，在校验阶段过滤规则
            frameContexts = this.frameContext.appContext.frameContextManager.getFrameContexts();
        }
        var isModal = this.isInDialog();
        var hasOwnVerifyDetailService = this.hasOwnVerifyDetailService();
        var rootViewModel = this.frameContext.root.viewModel;
        if (isModal && hasOwnVerifyDetailService) {
            rootViewModel = this.frameContext.getVirtualRootFrameContext().viewModel;
        }
        var toValidate = false;
        var formErrors = [];
        frameContexts.forEach(function (frameContext) {
            if (frameContext.form && frameContext.form.enableValidate) {
                toValidate = true;
            }
        });
        if (!toValidate || entities.length < 1) {
            return of(true);
        }
        rootViewModel.verifyInformations = [];
        var formValid = true;
        var entityValid = true;
        var formValidationRules = new Map();
        frameContexts.forEach(function (formContext) {
            var bindingObject = formContext.bindingData.getObject();
            // 通知所有bindingData,
            bindingObject && bindingObject.setShowValidationMsg(true);
            if (formContext.form && formContext.form.enableValidate) {
                // 获取当前表单上的所有验证规则
                var currentFormValidationRules = formContext.form.getValidationRules();
                currentFormValidationRules.forEach(function (rules, path) {
                    if (formValidationRules.has(path)) {
                        rules.forEach(function (rule) { return formValidationRules.get(path).push(rule); });
                    }
                    else {
                        formValidationRules.set(path, tslib_1.__spread(rules));
                    }
                });
                formContext.form.setShowValidationMsg(true);
                // 逐个调用表单的验证，验证前端表单规则
                if (!formContext.form.isFormValid()) {
                    formErrors.push(formContext.form);
                    formValid = false;
                }
            }
        });
        // 验证所有实体
        var observableList = entities.map(function (entity) {
            var index = _this.frameContext.bindingData.list.getIndexById(entity.primaryValue);
            return entity.validate(undefined, undefined, formValidationRules, null, _this.frameContext);
        });
        var result$ = zip.apply(void 0, tslib_1.__spread(observableList)).pipe(tap(function (resultList) {
            frameContexts.forEach(function (formContext) {
                if (!formContext.form.enableValidate) {
                    return;
                }
                var handleErrors = function (errors) {
                    errors.forEach(function (validationError) {
                        if (validationError.children && validationError.children.length) {
                            handleErrors(validationError.children);
                        }
                        var errMsgObj = {};
                        var id = '';
                        var findId = function (target) {
                            if (target && target.data && target.data.id) {
                                id = target.data.id;
                                return;
                            }
                            else if (target[PARENT_CLASS]) {
                                findId(target[PARENT_CLASS]);
                            }
                        };
                        findId(validationError.target);
                        // 实体验证出错，需要将错误展示到界面上
                        // 实体不一定是当前行
                        var parentPathData = {
                            path: [],
                            isUdt: false,
                            isGrid: false
                        };
                        if (validationError.target) {
                            parentPathData = validationError.target.getPaths();
                        }
                        var bindingPath = '/' + parentPathData.path.join('/');
                        if (validationError.constraints) {
                            Object.keys(validationError.constraints).forEach(function (key) {
                                errMsgObj[key] = {
                                    name: validationError.constraints[key]
                                };
                                // if (this.frameContext.viewModel.bindingPath === bindingPath) {
                                //   rootViewModel['verifyInformations'].push({
                                //     id: id,
                                //     title: key,
                                //     msg: validationError.constraints[key],
                                //     type: 'warn'
                                //   })
                                // }
                            });
                        }
                        var paths = parentPathData.path.concat(validationError.property);
                        //if (this.frameContext.viewModel.bindingPath === bindingPath) {
                        // 将错误信息更新到formControl上
                        formContext.bindingData.changes.next({
                            type: ChangeType.UpdateErrors,
                            id: id,
                            path: paths,
                            isUdt: parentPathData.isUdt,
                            isGrid: parentPathData.isGrid,
                            value: validationError.value,
                            errors: errMsgObj
                        });
                        //}
                    });
                };
                // 展开验证结果
                var isValidList = resultList.map(function (result) { return result.isValid; });
                // 保存前先调用实体上的验证规则，全部通过之后才保存
                // 实体验证通过
                if (isValidList.filter(function (x) { return x; }).length === observableList.length) {
                    // 将错误信息更新到formControl上
                    formContext.bindingData.changes.next({
                        type: ChangeType.UpdateErrors,
                        path: []
                    });
                    // 验证成功后隐藏输入时的验证
                    if (formValid) {
                        var bindingObject = formContext.bindingData.getObject();
                        bindingObject && bindingObject.setShowValidationMsg(false);
                        var form = formContext.form;
                        if (form) {
                            form.setShowValidationMsg(false);
                        }
                    }
                }
                else {
                    // 实体验证有错误
                    entityValid = false;
                    resultList.forEach(function (result) {
                        if (result.isValid) {
                            // 清除验证通过的错误
                            formContext.bindingData.changes.next({
                                type: ChangeType.UpdateErrors,
                                path: []
                            });
                        }
                        else {
                            handleErrors(result.errors);
                        }
                    });
                }
            });
        }), switchMap(function (resultList) {
            var isValidated = true;
            var errors = [];
            resultList.forEach(function (result) {
                if (!result.isValid) {
                    isValidated = false;
                }
                errors.push.apply(errors, tslib_1.__spread(result.errors));
            });
            if (errors.length > 0) {
                _this.collectValidationErrors(rootViewModel, errors, _this.frameContext.namespace);
            }
            // rootViewModel.verifycationChanged.next(rootViewModel.verifyInformations);
            var verifyInformations = rootViewModel.verifyInformations;
            if (isModal && hasOwnVerifyDetailService) {
                verifyInformations = rootViewModel.verifyInformations.filter(function (item) { return item.namespace === namespace; });
            }
            rootViewModel.verifycationChanged.next(verifyInformations);
            if (isValidated && !formValid) {
                // 实体校验通过但表单校验不通过，此时实体和表单存在校验规则不一致的情况
                console.warn('实体和控件校验规则不一致，会导致命令执行中断！');
            }
            if (isValidated && formValid) {
                return of(true);
            }
            else {
                return empty();
            }
        }));
        return result$;
    };
    /**
     * 调用表单和实体上的验证规则, 通过后调用回调cb
     */
    ValidationService.prototype.validateAll = function () {
        var _this = this;
        var entityTypeInfo = this.repository.entityTypeInfo;
        // 组合表单只校验当前按钮所在的表单
        var entities = this.repository.entityCollection.getAllEntities();
        var namespace = this.frameContext.namespace;
        var frameContexts = [];
        if (namespace !== null) {
            // 存在命名空间，说明表单较新，可以依赖该特性
            frameContexts = this.frameContext.appContext.frameContextManager.getFrameContextsByNamespace(namespace);
        }
        else {
            // 表单较老，获取所有的上下文，在校验阶段过滤规则
            frameContexts = this.frameContext.appContext.frameContextManager.getFrameContexts();
        }
        var isEntityValid = this.validateEntityAllowEmptyRule(entityTypeInfo);
        if (!isEntityValid) {
            return EMPTY;
        }
        var toValidate = false;
        var formErrors = [];
        frameContexts.forEach(function (frameContext) {
            if (frameContext.form && frameContext.form.enableValidate) {
                toValidate = true;
            }
        });
        if (!toValidate || entities.length < 1) {
            return of(true);
        }
        var isModal = this.isInDialog();
        var hasOwnVerifyDetailService = this.hasOwnVerifyDetailService();
        var rootViewModel = this.frameContext.root.viewModel;
        if (isModal && hasOwnVerifyDetailService) {
            rootViewModel = this.frameContext.getVirtualRootFrameContext().viewModel;
        }
        var formValid = true;
        var entityValid = true;
        var formValidationRules = new Map();
        frameContexts.forEach(function (formContext) {
            var bindingObject = formContext.bindingData.getObject();
            // 通知所有bindingData,
            bindingObject && bindingObject.setShowValidationMsg(true);
            if (formContext.form && formContext.form.enableValidate) {
                // 获取当前表单上的所有验证规则
                var currentFormValidationRules = formContext.form.getValidationRules();
                currentFormValidationRules.forEach(function (rules, path) {
                    if (formValidationRules.has(path)) {
                        rules.forEach(function (rule) { return formValidationRules.get(path).push(rule); });
                    }
                    else {
                        formValidationRules.set(path, tslib_1.__spread(rules));
                    }
                });
                formContext.form.setShowValidationMsg(true);
                // 逐个调用表单的验证，验证前端表单规则
                if (!formContext.form.isFormValid()) {
                    formErrors.push(formContext.form);
                    formValid = false;
                }
            }
        });
        // 触发所有实体的validate事件
        var isMultiEntityValiate = entities.length > 0;
        // 验证所有实体
        var observableList = entities.map(function (entity, index) {
            return entity.validate(undefined, undefined, formValidationRules, isMultiEntityValiate ? index : null, _this.frameContext);
        });
        var result$ = zip.apply(void 0, tslib_1.__spread(observableList)).pipe(tap(function (resultList) {
            frameContexts.forEach(function (formContext) {
                if (!formContext.form.enableValidate) {
                    return;
                }
                var handleErrors = function (errors) {
                    errors.forEach(function (validationError) {
                        if (validationError.children && validationError.children.length) {
                            handleErrors(validationError.children);
                        }
                        var errMsgObj = {};
                        var id = '';
                        var findId = function (target) {
                            if (target && target.data && target.data.id) {
                                id = target.data.id;
                                return;
                            }
                            else if (target[PARENT_CLASS]) {
                                findId(target[PARENT_CLASS]);
                            }
                        };
                        findId(validationError.target);
                        // 实体验证出错，需要将错误展示到界面上
                        // 实体不一定是当前行
                        var parentPathData = {
                            path: [],
                            isUdt: false,
                            isGrid: false
                        };
                        if (validationError.target) {
                            parentPathData = validationError.target.getPaths();
                        }
                        var bindingPath = '/' + parentPathData.path.join('/');
                        if (validationError.constraints) {
                            Object.keys(validationError.constraints).forEach(function (key) {
                                errMsgObj[key] = {
                                    name: validationError.constraints[key]
                                };
                                // if (this.frameContext.viewModel.bindingPath === bindingPath) {
                                //   rootViewModel['verifyInformations'].push({
                                //     id: id,
                                //     title: key,
                                //     msg: validationError.constraints[key],
                                //     type: 'warn'
                                //   })
                                // }
                            });
                        }
                        var paths = parentPathData.path.concat(validationError.property);
                        //if (this.frameContext.viewModel.bindingPath === bindingPath) {
                        // 将错误信息更新到formControl上
                        formContext.bindingData.changes.next({
                            type: ChangeType.UpdateErrors,
                            id: id,
                            path: paths,
                            isUdt: parentPathData.isUdt,
                            isGrid: parentPathData.isGrid,
                            value: validationError.value,
                            errors: errMsgObj
                        });
                        //}
                    });
                };
                // 展开验证结果
                var isValidList = resultList.map(function (result) { return result.isValid; });
                // 保存前先调用实体上的验证规则，全部通过之后才保存
                // 实体验证通过
                if (isValidList.filter(function (x) { return x; }).length === observableList.length) {
                    // 将错误信息更新到formControl上
                    formContext.bindingData.changes.next({
                        type: ChangeType.UpdateErrors,
                        path: []
                    });
                    // 验证成功后隐藏输入时的验证
                    if (formValid) {
                        var bindingObject = formContext.bindingData.getObject();
                        bindingObject && bindingObject.setShowValidationMsg(false);
                        var form = formContext.form;
                        if (form) {
                            form.setShowValidationMsg(false);
                        }
                    }
                }
                else {
                    // 实体验证有错误
                    entityValid = false;
                    resultList.forEach(function (result) {
                        if (result.isValid) {
                            // 清除验证通过的错误
                            formContext.bindingData.changes.next({
                                type: ChangeType.UpdateErrors,
                                path: []
                            });
                        }
                        else {
                            handleErrors(result.errors);
                        }
                    });
                }
            });
        }), switchMap(function (resultList) {
            var isValidated = true;
            var errors = [];
            resultList.forEach(function (result) {
                if (!result.isValid) {
                    isValidated = false;
                }
                errors.push.apply(errors, tslib_1.__spread(result.errors));
            });
            if (errors.length > 0) {
                _this.collectValidationErrors(rootViewModel, errors, _this.frameContext.namespace);
            }
            var verifyInformations = rootViewModel.verifyInformations;
            if (isModal && hasOwnVerifyDetailService) {
                verifyInformations = rootViewModel.verifyInformations.filter(function (item) { return item.namespace === namespace; });
            }
            // 因为校验累加的缘故，导致之前的校验信息一直存在，只能通过校验结果来确定是否还有错误信息
            if (isValidated && formValid) {
                verifyInformations = rootViewModel.verifyInformations = [];
            }
            rootViewModel.verifycationChanged.next(verifyInformations);
            if (isValidated && formValid) {
                return of(true);
            }
            else {
                return empty();
            }
        }));
        return result$;
    };
    /**
     * 校验实体是否满足不能为空的规则
     * @param entity 主实体
     */
    ValidationService.prototype.validateEntityAllowEmptyRule = function (entityTypeInfo) {
        var _this = this;
        // 确认实体各个层级中是否存在不能为空的规则
        var paths = this.getNotAllowEmptyBindingPaths(entityTypeInfo);
        if (!paths || paths.length < 1) {
            return true;
        }
        // 找到所有不合法的bindingPaths
        var invalidPaths = paths.filter(function (path) {
            var bindingPaths = path.split('/').filter(function (p) { return p; });
            var bindingList = _this.frameContext.bindingData.getValue(bindingPaths);
            if (!bindingList || bindingList.length < 1) {
                return true;
            }
            return false;
        });
        // 有实体必填，但实体数据为空
        if (invalidPaths.length > 0) {
            var tableNames_1 = [];
            invalidPaths.forEach(function (path) {
                //const frameContexts = this.getFrameContextByBindingPath(path.split('/'));
                //const frameComponents = frameContexts.map(frameContext => frameContext.frameComponent);
                // 找到所有容器类组件
                //const containerComponents = frameComponents.filter(frameComponent => [ComponentType.farrisDataGridComponent, ComponentType.farrisTreeTalbeComponent, ComponentType.kendoGridComponent, ComponentType.primengTreeComponent].includes(frameComponent.componentType));
                //if (!(!containerComponents || containerComponents.length < 1)) {
                var viewModelName = _this.getViewModelNameByBindingPaths(path.split('/')) || "\u7ED1\u5B9A\u8DEF\u5F84" + path;
                tableNames_1.push(viewModelName);
                //}
            });
            if (this.notifyService) {
                this.notifyService.error(tableNames_1.join('，') + " " + this.languageService.tableCanNotEmpty, { hideTitle: true });
            }
            return false;
        }
        return true;
    };
    /**
     *
     * @param bindingPaths path不能为空或/，不支持主表
     */
    ValidationService.prototype.getViewModelNameByBindingPaths = function (bindingPaths) {
        var namespace = this.frameContext.namespace;
        var frameContexts = null;
        if (namespace !== null) {
            // 存在命名空间，说明表单较新，可以依赖该特性
            frameContexts = this.frameContext.appContext.frameContextManager.getFrameContextsByNamespace(namespace);
        }
        else {
            // 表单较老，获取所有的上下文，在校验阶段过滤规则
            frameContexts = this.frameContext.appContext.frameContextManager.getFrameContexts();
        }
        var bindingPath = bindingPaths.filter(function (p) { return p; }).join('/');
        var frameContext = frameContexts.find(function (frameContext) { return frameContext.viewModel && frameContext.viewModel.bindingPath.split('/').filter(function (p) { return p; }).join('/') === bindingPath; });
        var viewModelName = frameContext && frameContext.form && frameContext.form.formGroupName || '';
        return viewModelName;
    };
    /**
     * 遍历获取所有不能为空的实体的绑定路径
     * @param entityTypeInfo
     * @param results
     * @returns
     */
    ValidationService.prototype.getNotAllowEmptyBindingPaths = function (entityTypeInfo, results) {
        if (results === void 0) { results = []; }
        if (!entityTypeInfo) {
            return;
        }
        this.deepFirstTraversalEntityTypeInfo(entityTypeInfo, results);
        return results;
    };
    ValidationService.prototype.deepFirstTraversalEntityTypeInfo = function (entityTypeInfo, result, previousValue) {
        var _this = this;
        if (result === void 0) { result = []; }
        if (previousValue === void 0) { previousValue = []; }
        // 确认当前实体是否必填
        var isAllowEmpty = this.isAllowEmpty(entityTypeInfo.entityInfo.allowEmpty, previousValue);
        if (isAllowEmpty === false) {
            if (previousValue.length < 1) {
                result.push('');
            }
            else {
                result.push(previousValue.join('/'));
            }
        }
        // 获取所有子表
        var list = entityTypeInfo.getPropInfosByGroup(DataPropGroup.List);
        if (list && list.length > 0) {
            list.forEach(function (propInfo) {
                var typeInfo = propInfo.typeInfo;
                if (typeInfo && typeInfo.entityInfo) {
                    previousValue.push(typeInfo.entityInfo.nodeCode);
                    _this.deepFirstTraversalEntityTypeInfo(typeInfo, result, previousValue);
                }
            });
        }
        // 没有下级了，此时应该清空游标，将收集到的路径放到结果集中
        if (previousValue && previousValue.length > 0) {
            previousValue.pop();
        }
    };
    ValidationService.prototype.isAllowEmpty = function (value, paths) {
        if (value === undefined || value === true || value === '') {
            return true;
        }
        // 开发者定义了不能为空的规则
        var frameContexts = this.getFrameContextByBindingPath(paths);
        var caller = this.frameContext.frameComponent;
        if (!frameContexts || frameContexts.length < 1) {
            // 定义了规则但对应的Frame没有渲染
            console.warn("\u7ED1\u5B9A\u8DEF\u5F84 " + paths.join('/') + " \u5B9A\u4E49\u4E86\u4E0D\u80FD\u4E3A\u7A7A\u7684\u89C4\u5219\uFF0C\u4F46\u627E\u4E0D\u5230\u8BE5\u7ED1\u5B9A\u8DEF\u5F84\u5BF9\u5E94\u7684\u7EC4\u4EF6\u3002\u8BF7\u786E\u4FDD\u7EC4\u4EF6\u663E\u9690\u4E0E\u5FC5\u586B\u4E00\u81F4\u3002");
        }
        else {
            caller = frameContexts.pop().frameComponent;
        }
        if (typeof value === 'boolean') {
            return value;
        }
        else if (typeof value === 'string') {
            value = value.trim().startsWith('return') ? value : "return " + value;
            var factory = new Function("\n        var viewModel = this.viewModel;\n        var bindingData = this.bindingData;\n        var context = this.context;\n        " + value + "\n      ");
            return factory.apply(caller);
        }
        else {
            console.warn("\u65E0\u6548\u7684\u5FC5\u586B\u89C4\u5219\u3002");
        }
    };
    ValidationService.prototype.collectValidationErrors = function (rootViewModel, errors, namespace, filter) {
        var _this = this;
        if (filter === void 0) { filter = true; }
        if (filter) {
            rootViewModel.verifyInformations = rootViewModel.verifyInformations.filter(function (item) { return item.namespace !== namespace; });
        }
        errors.forEach(function (validationError) {
            if (validationError.children && validationError.children.length) {
                _this.collectValidationErrors(rootViewModel, validationError.children, namespace, false);
            }
            var id = '';
            var findId = function (target) {
                if (target && target.data && target.data.id) {
                    id = target.data.id;
                    return;
                }
                else if (target[PARENT_CLASS]) {
                    findId(target[PARENT_CLASS]);
                }
            };
            findId(validationError.target);
            if (validationError.constraints) {
                var validationResultTypes = Object.keys(validationError.constraints);
                if (validationResultTypes.length) {
                    var offset = rootViewModel.verifyInformations.filter(function (item) { return item.namespace === namespace; }).length;
                    var index = rootViewModel.verifyInformations.findIndex(function (item) { return item.namespace === namespace; });
                    index = index === -1 ? 0 : index + offset;
                    rootViewModel.verifyInformations.splice(index, 0, {
                        id: id,
                        namespace: namespace,
                        targetField: validationError.field,
                        index: validationError.index,
                        title: validationError.propertyName,
                        msg: validationError.constraints[validationResultTypes[0]],
                        frameContext: validationError.frameContext,
                        fullPath: validationError.fullPath,
                        type: validationResultTypes[0] === 'required' ? 'empty' : 'error'
                    });
                }
            }
        });
    };
    /**
     * 重置校验信息（仅当前表单）
     */
    ValidationService.prototype.resetValidation = function () {
        var isDialog = this.isInDialog();
        var rootViewModel = this.frameContext.root.viewModel;
        if (isDialog) {
            rootViewModel = this.frameContext.getVirtualRootFrameContext().viewModel;
        }
        var verifyInformations = rootViewModel.verifyInformations;
        if (verifyInformations.length) {
            var namespace_1 = this.frameContext.namespace;
            if (namespace_1 !== null) {
                verifyInformations = rootViewModel.verifyInformations.filter(function (item) { return item.namespace !== namespace_1; });
            }
            rootViewModel.verifyInformations = verifyInformations;
            //rootViewModel.verifyInformations.splice(0, rootViewModel.verifyInformations.length);
        }
        if (rootViewModel && rootViewModel.verifycationChanged) {
            rootViewModel.verifycationChanged.next(verifyInformations);
        }
        return of(null);
    };
    /**
     * 是否在弹窗内部
     */
    ValidationService.prototype.isInDialog = function () {
        return this.frameContext && this.frameContext.getVirtualRootFrameContext() && this.frameContext.getVirtualRootFrameContext().frameComponent && this.frameContext.getVirtualRootFrameContext().frameComponent['isDialogRootComponent'] || false;
    };
    /**
     * 拥有独自的校验提示服务
     */
    ValidationService.prototype.hasOwnVerifyDetailService = function () {
        return this.frameContext.injector.get(VerifyDetailService, null) !== this.frameContext.root.appContext.injector.get(VerifyDetailService, null);
        ;
    };
    /**
     * 通过bindingPath获取所有匹配的frameContext
     * @param bindingPath
     * @returns
     */
    ValidationService.prototype.getFrameContextByBindingPath = function (bindingPaths) {
        var bindingPath = bindingPaths.filter(function (p) { return p; }).join('/');
        return this.frameContext.appContext.frameContextManager.getFrameContexts().filter(function (frameContext) { return frameContext.viewModel.bindingPath.split('/').filter(function (p) { return p; }).join('/') === bindingPath; });
    };
    ValidationService.prototype.filterDataGridComponent = function () { };
    ValidationService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    ValidationService.ctorParameters = function () { return [
        { type: Repository },
        { type: FrameContext },
        { type: FormNotifyService, decorators: [{ type: Optional }] },
        { type: LanguageService, decorators: [{ type: Optional }] }
    ]; };
    return ValidationService;
}());
export { ValidationService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmFsaWRhdGlvbi5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9jb21tYW5kLXNlcnZpY2VzLyIsInNvdXJjZXMiOlsibGliL3ZhbGlkYXRpb24uc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsa0NBQWtDO0FBQ2xDLE9BQU8sRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3JELE9BQU8sRUFBRSxVQUFVLEVBQVUsWUFBWSxFQUFFLFlBQVksRUFBRSxVQUFVLEVBQTRFLGFBQWEsRUFBNEMsTUFBTSxnQkFBZ0IsQ0FBQztBQUMvTixPQUFPLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ2hELE9BQU8sRUFBRSxLQUFLLEVBQWMsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ2xELE9BQU8sRUFBRSxHQUFHLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUMxQyxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDOUMsT0FBTyxFQUFFLEVBQUUsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQ3hDLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQy9ELE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQzFELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUVwRDs7O0dBR0c7QUFFSDtJQUtFOztPQUVHO0lBQ0gsMkJBQ1UsVUFBMkIsRUFDM0IsWUFBMEIsRUFDZCxhQUFnQyxFQUNoQyxlQUFnQztRQUg1QyxlQUFVLEdBQVYsVUFBVSxDQUFpQjtRQUMzQixpQkFBWSxHQUFaLFlBQVksQ0FBYztRQUNkLGtCQUFhLEdBQWIsYUFBYSxDQUFtQjtRQUNoQyxvQkFBZSxHQUFmLGVBQWUsQ0FBaUI7UUFUOUMsc0JBQWlCLEdBQUcsSUFBSSxPQUFPLEVBQU8sQ0FBQztRQUN2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QVksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFzQixtQkFBbUIsRUFBRSxJQUFJLENBQUMsS0FBSyxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBc0IsbUJBQW1CLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFBQSxDQUFDO0lBQzVMLENBQUM7SUFDRDs7OztPQUlHO0lBQ0ssd0RBQTRCLEdBQXBDLFVBQXFDLFlBQXNCO1FBQ3pELElBQU0sV0FBVyxHQUFHLFlBQVksQ0FBQyxNQUFNLENBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLEVBQUQsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzFELE9BQU8sSUFBSSxDQUFDLFlBQVksQ0FBQyxVQUFVLENBQUMsbUJBQW1CLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQyxNQUFNLENBQUMsVUFBQSxZQUFZLElBQUksT0FBQSxZQUFZLENBQUMsU0FBUyxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsTUFBTSxDQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxFQUFELENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxXQUFXLEVBQXRGLENBQXNGLENBQUMsQ0FBQztJQUM1TCxDQUFDO0lBQ08sbURBQXVCLEdBQS9CLGNBQW9DLENBQUM7O2dCQWpwQnRDLFVBQVU7Ozs7Z0JBZkYsVUFBVTtnQkFBVSxZQUFZO2dCQU9oQyxpQkFBaUIsdUJBbUJyQixRQUFRO2dCQWxCSixlQUFlLHVCQW1CbkIsUUFBUTs7SUFzb0JiLHdCQUFDO0NBQUEsQUFscEJELElBa3BCQztBQUVELE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gdHNsaW50OmRpc2FibGU6IG1heC1saW5lLWxlbmd0aFxyXG5pbXBvcnQgeyBJbmplY3RhYmxlLCBPcHRpb25hbCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBSZXBvc2l0b3J5LCBFbnRpdHksIEZyYW1lQ29udGV4dCwgUEFSRU5UX0NMQVNTLCBDaGFuZ2VUeXBlLCBWYWxpZGF0aW9uUmVzdWx0LCBWYWxpZGF0aW9uRXJyb3IsIFZhbGlkYXRlUnVsZSwgVmlld01vZGVsLCBEYXRhVHlwZUluZm8sIERhdGFQcm9wR3JvdXAsIERhdGFQcm9wSW5mbywgQmluZGluZ0xpc3QsIENvbXBvbmVudFR5cGUgfSBmcm9tICdAZmFycmlzL2RldmtpdCc7XHJcbmltcG9ydCB7IHRhcCwgc3dpdGNoTWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBFTVBUWSwgT2JzZXJ2YWJsZSwgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyB6aXAgfSBmcm9tICdyeGpzL29ic2VydmFibGUvemlwJztcclxuaW1wb3J0IHsgZW1wdHkgfSBmcm9tICdyeGpzL29ic2VydmFibGUvZW1wdHknO1xyXG5pbXBvcnQgeyBvZiB9IGZyb20gJ3J4anMvb2JzZXJ2YWJsZS9vZic7XHJcbmltcG9ydCB7IFZlcmlmeURldGFpbFNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLXZlcmlmeS1kZXRhaWwnO1xyXG5pbXBvcnQgeyBGb3JtTm90aWZ5U2VydmljZSB9IGZyb20gJy4vZm9ybS1ub3RpZnkuc2VydmljZSc7XHJcbmltcG9ydCB7IExhbmd1YWdlU2VydmljZSB9IGZyb20gJy4vbGFuZ3VhZy5zZXJ2aWNlJztcclxuXHJcbi8qKlxyXG4gKiDooajljZXpqozor4HmnI3liqFcclxuICogQHNjb3BlIEZyYW1lQ29tcG9uZW50XHJcbiAqL1xyXG5cclxuQEluamVjdGFibGUoKVxyXG5jbGFzcyBWYWxpZGF0aW9uU2VydmljZSB7XHJcblxyXG4gIHByaXZhdGUgdmFsaWRhdGlvblJlc3VsdHMgPSBuZXcgU3ViamVjdDxhbnk+KCk7XHJcbiAgcHJpdmF0ZSB2YWxpZGF0aW9uQWxsUmVzdWx0ID0gbmV3IFN1YmplY3Q8YW55PigpO1xyXG4gIC8qKlxyXG4gICAqIOaehOmAoOWHveaVsFxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJpdmF0ZSByZXBvc2l0b3J5OiBSZXBvc2l0b3J5PGFueT4sXHJcbiAgICBwcml2YXRlIGZyYW1lQ29udGV4dDogRnJhbWVDb250ZXh0LFxyXG4gICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSBub3RpZnlTZXJ2aWNlOiBGb3JtTm90aWZ5U2VydmljZSxcclxuICAgIEBPcHRpb25hbCgpIHByaXZhdGUgbGFuZ3VhZ2VTZXJ2aWNlOiBMYW5ndWFnZVNlcnZpY2VcclxuICApIHtcclxuICAgIGlmICghdGhpcy5sYW5ndWFnZVNlcnZpY2UpIHtcclxuICAgICAgdGhpcy5sYW5ndWFnZVNlcnZpY2UgPSBuZXcgTGFuZ3VhZ2VTZXJ2aWNlKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDpqozor4HooajljZXlhoXnmoTmiYDmnInooajljZVcclxuICAgKi9cclxuICBwdWJsaWMgdmFsaWRhdGUoKSB7XHJcbiAgICB0aGlzLnJlcG9zaXRvcnkuZ2V0TGlzdCgpLnN1YnNjcmliZShcclxuICAgICAgKHJlc3VsdDogRW50aXR5W10pID0+IHtcclxuICAgICAgICBmb3IgKGNvbnN0IGVudGl0eSBvZiByZXN1bHQpIHtcclxuICAgICAgICAgIGVudGl0eS52YWxpZGF0ZSgpLnN1YnNjcmliZSgocmVzdWx0OiBWYWxpZGF0aW9uUmVzdWx0KSA9PiB7XHJcbiAgICAgICAgICAgIGlmICghcmVzdWx0LmlzVmFsaWQpIHtcclxuICAgICAgICAgICAgICBhbGVydChyZXN1bHQubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgdGhpcy52YWxpZGF0aW9uUmVzdWx0cy5uZXh0KHJlc3VsdCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgKTtcclxuICAgIHJldHVybiB0aGlzLnZhbGlkYXRpb25SZXN1bHRzO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmoKHpqozlvZPliY3ooYxcclxuICAgKi9cclxuICBwdWJsaWMgdmFsaWRhdGVDdXJyZW50Um93KCk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBjb25zdCBlbnRpdHlUeXBlSW5mbyA9IHRoaXMucmVwb3NpdG9yeS5lbnRpdHlUeXBlSW5mbztcclxuICAgIC8vIOe7hOWQiOihqOWNleWPquagoemqjOW9k+WJjeaMiemSruaJgOWcqOeahOihqOWNlVxyXG4gICAgY29uc3QgcHJpbWFyeVZhbHVlID0gdGhpcy5mcmFtZUNvbnRleHQuYmluZGluZ0RhdGEubGlzdC5jdXJyZW50SWQ7XHJcbiAgICBpZiAoIXByaW1hcnlWYWx1ZSkge1xyXG4gICAgICByZXR1cm4gb2YodHJ1ZSk7XHJcbiAgICB9XHJcbiAgICAvLyDpppblhYjmoKHpqozlrp7kvZPkuI3og73kuLrnqbrop4TliJlcclxuICAgIGNvbnN0IGVudGl0eSA9IHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmdldEVudGl0eUJ5SWQocHJpbWFyeVZhbHVlKTtcclxuICAgIGlmICghZW50aXR5KSB7XHJcbiAgICAgIHJldHVybiBvZih0cnVlKTtcclxuICAgIH1cclxuICAgIGNvbnN0IGlzRW50aXR5VmFsaWQgPSB0aGlzLnZhbGlkYXRlRW50aXR5QWxsb3dFbXB0eVJ1bGUoZW50aXR5VHlwZUluZm8pO1xyXG4gICAgaWYgKCFpc0VudGl0eVZhbGlkKSB7XHJcbiAgICAgIHJldHVybiBFTVBUWTtcclxuICAgIH1cclxuICAgIGNvbnN0IGVudGl0aWVzOiBFbnRpdHlbXSA9IFtlbnRpdHldO1xyXG4gICAgY29uc3QgbmFtZXNwYWNlID0gdGhpcy5mcmFtZUNvbnRleHQubmFtZXNwYWNlO1xyXG4gICAgbGV0IGZyYW1lQ29udGV4dHMgPSBbXTtcclxuICAgIC8vIOS/ruWkjeS9v+eUqOebuOWQjGJl5Yib5bu655qEdm/nmoTnu4TlkIjooajljZXmoKHpqozml7blpJrkuKrooajljZXmoKHpqozop4TliJnooqvlkIjlubbnmoTpl67pophcclxuICAgIC8vIFRPRE86IOebruWJjeacquiAg+iZkee7hOWQiOihqOWNlee7n+S4gOS/neWtmOeahOWcuuaZr++8jOWQjue7reaUr+aMgee7hOWQiOihqOWNlee7n+S4gOS/neWtmOaXtuWGjeS/ruaUuVxyXG4gICAgaWYgKG5hbWVzcGFjZSAhPT0gbnVsbCkge1xyXG4gICAgICAvLyDlrZjlnKjlkb3lkI3nqbrpl7TvvIzor7TmmI7ooajljZXovoPmlrDvvIzlj6/ku6Xkvp3otZbor6XnibnmgKdcclxuICAgICAgZnJhbWVDb250ZXh0cyA9IHRoaXMuZnJhbWVDb250ZXh0LmFwcENvbnRleHQuZnJhbWVDb250ZXh0TWFuYWdlci5nZXRGcmFtZUNvbnRleHRzQnlOYW1lc3BhY2UobmFtZXNwYWNlKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIC8vIOihqOWNlei+g+iAge+8jOiOt+WPluaJgOacieeahOS4iuS4i+aWh++8jOWcqOagoemqjOmYtuautei/h+a7pOinhOWImVxyXG4gICAgICBmcmFtZUNvbnRleHRzID0gdGhpcy5mcmFtZUNvbnRleHQuYXBwQ29udGV4dC5mcmFtZUNvbnRleHRNYW5hZ2VyLmdldEZyYW1lQ29udGV4dHMoKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBpc01vZGFsID0gdGhpcy5pc0luRGlhbG9nKCk7XHJcbiAgICBjb25zdCBoYXNPd25WZXJpZnlEZXRhaWxTZXJ2aWNlID0gdGhpcy5oYXNPd25WZXJpZnlEZXRhaWxTZXJ2aWNlKCk7XHJcbiAgICBsZXQgcm9vdFZpZXdNb2RlbCA9IHRoaXMuZnJhbWVDb250ZXh0LnJvb3Qudmlld01vZGVsO1xyXG4gICAgaWYgKGlzTW9kYWwgJiYgaGFzT3duVmVyaWZ5RGV0YWlsU2VydmljZSkge1xyXG4gICAgICByb290Vmlld01vZGVsID0gdGhpcy5mcmFtZUNvbnRleHQuZ2V0VmlydHVhbFJvb3RGcmFtZUNvbnRleHQoKS52aWV3TW9kZWw7XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IHRvVmFsaWRhdGUgPSBmYWxzZTtcclxuICAgIGNvbnN0IGZvcm1FcnJvcnMgPSBbXTtcclxuICAgIGZyYW1lQ29udGV4dHMuZm9yRWFjaCgoZnJhbWVDb250ZXh0OiBGcmFtZUNvbnRleHQpID0+IHtcclxuICAgICAgaWYgKGZyYW1lQ29udGV4dC5mb3JtICYmIGZyYW1lQ29udGV4dC5mb3JtLmVuYWJsZVZhbGlkYXRlKSB7XHJcbiAgICAgICAgdG9WYWxpZGF0ZSA9IHRydWU7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgaWYgKCF0b1ZhbGlkYXRlIHx8IGVudGl0aWVzLmxlbmd0aCA8IDEpIHtcclxuICAgICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gICAgfVxyXG4gICAgcm9vdFZpZXdNb2RlbC52ZXJpZnlJbmZvcm1hdGlvbnMgPSBbXTtcclxuICAgIGxldCBmb3JtVmFsaWQgPSB0cnVlO1xyXG4gICAgbGV0IGVudGl0eVZhbGlkID0gdHJ1ZTtcclxuICAgIGNvbnN0IGZvcm1WYWxpZGF0aW9uUnVsZXMgPSBuZXcgTWFwPHN0cmluZywgVmFsaWRhdGVSdWxlW10+KCk7XHJcbiAgICBmcmFtZUNvbnRleHRzLmZvckVhY2goKGZvcm1Db250ZXh0OiBGcmFtZUNvbnRleHQpID0+IHtcclxuICAgICAgY29uc3QgYmluZGluZ09iamVjdCA9IGZvcm1Db250ZXh0LmJpbmRpbmdEYXRhLmdldE9iamVjdCgpO1xyXG4gICAgICAvLyDpgJrnn6XmiYDmnIliaW5kaW5nRGF0YSxcclxuICAgICAgYmluZGluZ09iamVjdCAmJiBiaW5kaW5nT2JqZWN0LnNldFNob3dWYWxpZGF0aW9uTXNnKHRydWUpO1xyXG4gICAgICBpZiAoZm9ybUNvbnRleHQuZm9ybSAmJiBmb3JtQ29udGV4dC5mb3JtLmVuYWJsZVZhbGlkYXRlKSB7XHJcbiAgICAgICAgLy8g6I635Y+W5b2T5YmN6KGo5Y2V5LiK55qE5omA5pyJ6aqM6K+B6KeE5YiZXHJcbiAgICAgICAgY29uc3QgY3VycmVudEZvcm1WYWxpZGF0aW9uUnVsZXMgPSBmb3JtQ29udGV4dC5mb3JtLmdldFZhbGlkYXRpb25SdWxlcygpO1xyXG4gICAgICAgIGN1cnJlbnRGb3JtVmFsaWRhdGlvblJ1bGVzLmZvckVhY2goKHJ1bGVzLCBwYXRoKSA9PiB7XHJcbiAgICAgICAgICBpZiAoZm9ybVZhbGlkYXRpb25SdWxlcy5oYXMocGF0aCkpIHtcclxuICAgICAgICAgICAgcnVsZXMuZm9yRWFjaChydWxlID0+IGZvcm1WYWxpZGF0aW9uUnVsZXMuZ2V0KHBhdGgpLnB1c2gocnVsZSkpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgZm9ybVZhbGlkYXRpb25SdWxlcy5zZXQocGF0aCwgWy4uLnJ1bGVzXSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgZm9ybUNvbnRleHQuZm9ybS5zZXRTaG93VmFsaWRhdGlvbk1zZyh0cnVlKTtcclxuICAgICAgICAvLyDpgJDkuKrosIPnlKjooajljZXnmoTpqozor4HvvIzpqozor4HliY3nq6/ooajljZXop4TliJlcclxuICAgICAgICBpZiAoIWZvcm1Db250ZXh0LmZvcm0uaXNGb3JtVmFsaWQoKSkge1xyXG4gICAgICAgICAgZm9ybUVycm9ycy5wdXNoKGZvcm1Db250ZXh0LmZvcm0pO1xyXG4gICAgICAgICAgZm9ybVZhbGlkID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyDpqozor4HmiYDmnInlrp7kvZNcclxuICAgIGNvbnN0IG9ic2VydmFibGVMaXN0ID0gZW50aXRpZXMubWFwKChlbnRpdHk6IEVudGl0eSkgPT4ge1xyXG4gICAgICBjb25zdCBpbmRleCA9IHRoaXMuZnJhbWVDb250ZXh0LmJpbmRpbmdEYXRhLmxpc3QuZ2V0SW5kZXhCeUlkKGVudGl0eS5wcmltYXJ5VmFsdWUpO1xyXG4gICAgICByZXR1cm4gZW50aXR5LnZhbGlkYXRlKHVuZGVmaW5lZCwgdW5kZWZpbmVkLCBmb3JtVmFsaWRhdGlvblJ1bGVzLCBudWxsLCB0aGlzLmZyYW1lQ29udGV4dCk7XHJcbiAgICB9KTtcclxuICAgIGNvbnN0IHJlc3VsdCQgPSB6aXAoLi4ub2JzZXJ2YWJsZUxpc3QpLnBpcGUoXHJcbiAgICAgIHRhcCgocmVzdWx0TGlzdCkgPT4ge1xyXG4gICAgICAgIGZyYW1lQ29udGV4dHMuZm9yRWFjaCgoZm9ybUNvbnRleHQ6IEZyYW1lQ29udGV4dCkgPT4ge1xyXG4gICAgICAgICAgaWYgKCFmb3JtQ29udGV4dC5mb3JtLmVuYWJsZVZhbGlkYXRlKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGNvbnN0IGhhbmRsZUVycm9ycyA9IChlcnJvcnM6IFZhbGlkYXRpb25FcnJvcltdKSA9PiB7XHJcbiAgICAgICAgICAgIGVycm9ycy5mb3JFYWNoKCh2YWxpZGF0aW9uRXJyb3I6IFZhbGlkYXRpb25FcnJvcikgPT4ge1xyXG4gICAgICAgICAgICAgIGlmICh2YWxpZGF0aW9uRXJyb3IuY2hpbGRyZW4gJiYgdmFsaWRhdGlvbkVycm9yLmNoaWxkcmVuLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgaGFuZGxlRXJyb3JzKHZhbGlkYXRpb25FcnJvci5jaGlsZHJlbik7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIGNvbnN0IGVyck1zZ09iaiA9IHt9O1xyXG4gICAgICAgICAgICAgIGxldCBpZCA9ICcnO1xyXG4gICAgICAgICAgICAgIGNvbnN0IGZpbmRJZCA9ICh0YXJnZXQ6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRhcmdldCAmJiB0YXJnZXQuZGF0YSAmJiB0YXJnZXQuZGF0YS5pZCkge1xyXG4gICAgICAgICAgICAgICAgICBpZCA9IHRhcmdldC5kYXRhLmlkO1xyXG4gICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRhcmdldFtQQVJFTlRfQ0xBU1NdKSB7XHJcbiAgICAgICAgICAgICAgICAgIGZpbmRJZCh0YXJnZXRbUEFSRU5UX0NMQVNTXSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICBmaW5kSWQodmFsaWRhdGlvbkVycm9yLnRhcmdldCk7XHJcblxyXG4gICAgICAgICAgICAgIC8vIOWunuS9k+mqjOivgeWHuumUme+8jOmcgOimgeWwhumUmeivr+WxleekuuWIsOeVjOmdouS4ilxyXG4gICAgICAgICAgICAgIC8vIOWunuS9k+S4jeS4gOWumuaYr+W9k+WJjeihjFxyXG4gICAgICAgICAgICAgIGxldCBwYXJlbnRQYXRoRGF0YSA9IHtcclxuICAgICAgICAgICAgICAgIHBhdGg6IFtdLFxyXG4gICAgICAgICAgICAgICAgaXNVZHQ6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgaXNHcmlkOiBmYWxzZVxyXG4gICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgaWYgKHZhbGlkYXRpb25FcnJvci50YXJnZXQpIHtcclxuICAgICAgICAgICAgICAgIHBhcmVudFBhdGhEYXRhID0gdmFsaWRhdGlvbkVycm9yLnRhcmdldC5nZXRQYXRocygpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBjb25zdCBiaW5kaW5nUGF0aCA9ICcvJyArIHBhcmVudFBhdGhEYXRhLnBhdGguam9pbignLycpO1xyXG4gICAgICAgICAgICAgIGlmICh2YWxpZGF0aW9uRXJyb3IuY29uc3RyYWludHMpIHtcclxuICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKHZhbGlkYXRpb25FcnJvci5jb25zdHJhaW50cykuZm9yRWFjaChrZXkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICBlcnJNc2dPYmpba2V5XSA9IHtcclxuICAgICAgICAgICAgICAgICAgICBuYW1lOiB2YWxpZGF0aW9uRXJyb3IuY29uc3RyYWludHNba2V5XVxyXG4gICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAvLyBpZiAodGhpcy5mcmFtZUNvbnRleHQudmlld01vZGVsLmJpbmRpbmdQYXRoID09PSBiaW5kaW5nUGF0aCkge1xyXG4gICAgICAgICAgICAgICAgICAvLyAgIHJvb3RWaWV3TW9kZWxbJ3ZlcmlmeUluZm9ybWF0aW9ucyddLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAvLyAgICAgaWQ6IGlkLFxyXG4gICAgICAgICAgICAgICAgICAvLyAgICAgdGl0bGU6IGtleSxcclxuICAgICAgICAgICAgICAgICAgLy8gICAgIG1zZzogdmFsaWRhdGlvbkVycm9yLmNvbnN0cmFpbnRzW2tleV0sXHJcbiAgICAgICAgICAgICAgICAgIC8vICAgICB0eXBlOiAnd2FybidcclxuICAgICAgICAgICAgICAgICAgLy8gICB9KVxyXG4gICAgICAgICAgICAgICAgICAvLyB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgY29uc3QgcGF0aHMgPSBwYXJlbnRQYXRoRGF0YS5wYXRoLmNvbmNhdCh2YWxpZGF0aW9uRXJyb3IucHJvcGVydHkpO1xyXG5cclxuICAgICAgICAgICAgICAvL2lmICh0aGlzLmZyYW1lQ29udGV4dC52aWV3TW9kZWwuYmluZGluZ1BhdGggPT09IGJpbmRpbmdQYXRoKSB7XHJcbiAgICAgICAgICAgICAgLy8g5bCG6ZSZ6K+v5L+h5oGv5pu05paw5YiwZm9ybUNvbnRyb2zkuIpcclxuICAgICAgICAgICAgICBmb3JtQ29udGV4dC5iaW5kaW5nRGF0YS5jaGFuZ2VzLm5leHQoe1xyXG4gICAgICAgICAgICAgICAgdHlwZTogQ2hhbmdlVHlwZS5VcGRhdGVFcnJvcnMsXHJcbiAgICAgICAgICAgICAgICBpZCxcclxuICAgICAgICAgICAgICAgIHBhdGg6IHBhdGhzLFxyXG4gICAgICAgICAgICAgICAgaXNVZHQ6IHBhcmVudFBhdGhEYXRhLmlzVWR0LFxyXG4gICAgICAgICAgICAgICAgaXNHcmlkOiBwYXJlbnRQYXRoRGF0YS5pc0dyaWQsXHJcbiAgICAgICAgICAgICAgICB2YWx1ZTogdmFsaWRhdGlvbkVycm9yLnZhbHVlLFxyXG4gICAgICAgICAgICAgICAgZXJyb3JzOiBlcnJNc2dPYmpcclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAvL31cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgICAgLy8g5bGV5byA6aqM6K+B57uT5p6cXHJcbiAgICAgICAgICBjb25zdCBpc1ZhbGlkTGlzdCA9IHJlc3VsdExpc3QubWFwKChyZXN1bHQ6IFZhbGlkYXRpb25SZXN1bHQpID0+IHJlc3VsdC5pc1ZhbGlkKTtcclxuICAgICAgICAgIC8vIOS/neWtmOWJjeWFiOiwg+eUqOWunuS9k+S4iueahOmqjOivgeinhOWIme+8jOWFqOmDqOmAmui/h+S5i+WQjuaJjeS/neWtmFxyXG4gICAgICAgICAgLy8g5a6e5L2T6aqM6K+B6YCa6L+HXHJcbiAgICAgICAgICBpZiAoaXNWYWxpZExpc3QuZmlsdGVyKHggPT4geCkubGVuZ3RoID09PSBvYnNlcnZhYmxlTGlzdC5sZW5ndGgpIHtcclxuICAgICAgICAgICAgLy8g5bCG6ZSZ6K+v5L+h5oGv5pu05paw5YiwZm9ybUNvbnRyb2zkuIpcclxuICAgICAgICAgICAgZm9ybUNvbnRleHQuYmluZGluZ0RhdGEuY2hhbmdlcy5uZXh0KHtcclxuICAgICAgICAgICAgICB0eXBlOiBDaGFuZ2VUeXBlLlVwZGF0ZUVycm9ycyxcclxuICAgICAgICAgICAgICBwYXRoOiBbXVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgLy8g6aqM6K+B5oiQ5Yqf5ZCO6ZqQ6JeP6L6T5YWl5pe255qE6aqM6K+BXHJcbiAgICAgICAgICAgIGlmIChmb3JtVmFsaWQpIHtcclxuICAgICAgICAgICAgICBjb25zdCBiaW5kaW5nT2JqZWN0ID0gZm9ybUNvbnRleHQuYmluZGluZ0RhdGEuZ2V0T2JqZWN0KCk7XHJcbiAgICAgICAgICAgICAgYmluZGluZ09iamVjdCAmJiBiaW5kaW5nT2JqZWN0LnNldFNob3dWYWxpZGF0aW9uTXNnKGZhbHNlKTtcclxuICAgICAgICAgICAgICBjb25zdCBmb3JtID0gZm9ybUNvbnRleHQuZm9ybTtcclxuICAgICAgICAgICAgICBpZiAoZm9ybSkge1xyXG4gICAgICAgICAgICAgICAgZm9ybS5zZXRTaG93VmFsaWRhdGlvbk1zZyhmYWxzZSk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyDlrp7kvZPpqozor4HmnInplJnor69cclxuICAgICAgICAgICAgZW50aXR5VmFsaWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgcmVzdWx0TGlzdC5mb3JFYWNoKChyZXN1bHQ6IFZhbGlkYXRpb25SZXN1bHQpID0+IHtcclxuICAgICAgICAgICAgICBpZiAocmVzdWx0LmlzVmFsaWQpIHtcclxuICAgICAgICAgICAgICAgIC8vIOa4hemZpOmqjOivgemAmui/h+eahOmUmeivr1xyXG4gICAgICAgICAgICAgICAgZm9ybUNvbnRleHQuYmluZGluZ0RhdGEuY2hhbmdlcy5uZXh0KHtcclxuICAgICAgICAgICAgICAgICAgdHlwZTogQ2hhbmdlVHlwZS5VcGRhdGVFcnJvcnMsXHJcbiAgICAgICAgICAgICAgICAgIHBhdGg6IFtdXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaGFuZGxlRXJyb3JzKHJlc3VsdC5lcnJvcnMpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pLFxyXG4gICAgICBzd2l0Y2hNYXAoKHJlc3VsdExpc3QpID0+IHtcclxuICAgICAgICBsZXQgaXNWYWxpZGF0ZWQgPSB0cnVlO1xyXG4gICAgICAgIGNvbnN0IGVycm9ycyA9IFtdO1xyXG4gICAgICAgIHJlc3VsdExpc3QuZm9yRWFjaCgocmVzdWx0OiBWYWxpZGF0aW9uUmVzdWx0KSA9PiB7XHJcbiAgICAgICAgICBpZiAoIXJlc3VsdC5pc1ZhbGlkKSB7XHJcbiAgICAgICAgICAgIGlzVmFsaWRhdGVkID0gZmFsc2U7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBlcnJvcnMucHVzaCguLi5yZXN1bHQuZXJyb3JzKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBpZiAoZXJyb3JzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgIHRoaXMuY29sbGVjdFZhbGlkYXRpb25FcnJvcnMocm9vdFZpZXdNb2RlbCwgZXJyb3JzLCB0aGlzLmZyYW1lQ29udGV4dC5uYW1lc3BhY2UpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyByb290Vmlld01vZGVsLnZlcmlmeWNhdGlvbkNoYW5nZWQubmV4dChyb290Vmlld01vZGVsLnZlcmlmeUluZm9ybWF0aW9ucyk7XHJcbiAgICAgICAgbGV0IHZlcmlmeUluZm9ybWF0aW9ucyA9IHJvb3RWaWV3TW9kZWwudmVyaWZ5SW5mb3JtYXRpb25zO1xyXG4gICAgICAgIGlmIChpc01vZGFsICYmIGhhc093blZlcmlmeURldGFpbFNlcnZpY2UpIHtcclxuICAgICAgICAgIHZlcmlmeUluZm9ybWF0aW9ucyA9IHJvb3RWaWV3TW9kZWwudmVyaWZ5SW5mb3JtYXRpb25zLmZpbHRlcihpdGVtID0+IGl0ZW0ubmFtZXNwYWNlID09PSBuYW1lc3BhY2UpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByb290Vmlld01vZGVsLnZlcmlmeWNhdGlvbkNoYW5nZWQubmV4dCh2ZXJpZnlJbmZvcm1hdGlvbnMpO1xyXG4gICAgICAgIGlmIChpc1ZhbGlkYXRlZCAmJiAhZm9ybVZhbGlkKSB7XHJcbiAgICAgICAgICAvLyDlrp7kvZPmoKHpqozpgJrov4fkvYbooajljZXmoKHpqozkuI3pgJrov4fvvIzmraTml7blrp7kvZPlkozooajljZXlrZjlnKjmoKHpqozop4TliJnkuI3kuIDoh7TnmoTmg4XlhrVcclxuICAgICAgICAgIGNvbnNvbGUud2Fybign5a6e5L2T5ZKM5o6n5Lu25qCh6aqM6KeE5YiZ5LiN5LiA6Ie077yM5Lya5a+86Ie05ZG95Luk5omn6KGM5Lit5pat77yBJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChpc1ZhbGlkYXRlZCAmJiBmb3JtVmFsaWQpIHtcclxuICAgICAgICAgIHJldHVybiBvZih0cnVlKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgcmV0dXJuIGVtcHR5KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICAgIHJldHVybiByZXN1bHQkO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDosIPnlKjooajljZXlkozlrp7kvZPkuIrnmoTpqozor4Hop4TliJksIOmAmui/h+WQjuiwg+eUqOWbnuiwg2NiXHJcbiAgICovXHJcbiAgdmFsaWRhdGVBbGwoKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IGVudGl0eVR5cGVJbmZvID0gdGhpcy5yZXBvc2l0b3J5LmVudGl0eVR5cGVJbmZvO1xyXG4gICAgLy8g57uE5ZCI6KGo5Y2V5Y+q5qCh6aqM5b2T5YmN5oyJ6ZKu5omA5Zyo55qE6KGo5Y2VXHJcbiAgICBjb25zdCBlbnRpdGllczogRW50aXR5W10gPSB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5nZXRBbGxFbnRpdGllcygpO1xyXG4gICAgY29uc3QgbmFtZXNwYWNlID0gdGhpcy5mcmFtZUNvbnRleHQubmFtZXNwYWNlO1xyXG4gICAgbGV0IGZyYW1lQ29udGV4dHMgPSBbXTtcclxuICAgIGlmIChuYW1lc3BhY2UgIT09IG51bGwpIHtcclxuICAgICAgLy8g5a2Y5Zyo5ZG95ZCN56m66Ze077yM6K+05piO6KGo5Y2V6L6D5paw77yM5Y+v5Lul5L6d6LWW6K+l54m55oCnXHJcbiAgICAgIGZyYW1lQ29udGV4dHMgPSB0aGlzLmZyYW1lQ29udGV4dC5hcHBDb250ZXh0LmZyYW1lQ29udGV4dE1hbmFnZXIuZ2V0RnJhbWVDb250ZXh0c0J5TmFtZXNwYWNlKG5hbWVzcGFjZSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvLyDooajljZXovoPogIHvvIzojrflj5bmiYDmnInnmoTkuIrkuIvmlofvvIzlnKjmoKHpqozpmLbmrrXov4fmu6Top4TliJlcclxuICAgICAgZnJhbWVDb250ZXh0cyA9IHRoaXMuZnJhbWVDb250ZXh0LmFwcENvbnRleHQuZnJhbWVDb250ZXh0TWFuYWdlci5nZXRGcmFtZUNvbnRleHRzKCk7XHJcbiAgICB9XHJcbiAgICBjb25zdCBpc0VudGl0eVZhbGlkID0gdGhpcy52YWxpZGF0ZUVudGl0eUFsbG93RW1wdHlSdWxlKGVudGl0eVR5cGVJbmZvKTtcclxuICAgIGlmICghaXNFbnRpdHlWYWxpZCkge1xyXG4gICAgICByZXR1cm4gRU1QVFk7XHJcbiAgICB9XHJcbiAgICBsZXQgdG9WYWxpZGF0ZSA9IGZhbHNlO1xyXG4gICAgY29uc3QgZm9ybUVycm9ycyA9IFtdO1xyXG4gICAgZnJhbWVDb250ZXh0cy5mb3JFYWNoKChmcmFtZUNvbnRleHQ6IEZyYW1lQ29udGV4dCkgPT4ge1xyXG4gICAgICBpZiAoZnJhbWVDb250ZXh0LmZvcm0gJiYgZnJhbWVDb250ZXh0LmZvcm0uZW5hYmxlVmFsaWRhdGUpIHtcclxuICAgICAgICB0b1ZhbGlkYXRlID0gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICBpZiAoIXRvVmFsaWRhdGUgfHwgZW50aXRpZXMubGVuZ3RoIDwgMSkge1xyXG4gICAgICByZXR1cm4gb2YodHJ1ZSk7XHJcbiAgICB9XHJcbiAgICBjb25zdCBpc01vZGFsID0gdGhpcy5pc0luRGlhbG9nKCk7XHJcbiAgICBjb25zdCBoYXNPd25WZXJpZnlEZXRhaWxTZXJ2aWNlID0gdGhpcy5oYXNPd25WZXJpZnlEZXRhaWxTZXJ2aWNlKCk7XHJcbiAgICBsZXQgcm9vdFZpZXdNb2RlbCA9IHRoaXMuZnJhbWVDb250ZXh0LnJvb3Qudmlld01vZGVsO1xyXG4gICAgaWYgKGlzTW9kYWwgJiYgaGFzT3duVmVyaWZ5RGV0YWlsU2VydmljZSkge1xyXG4gICAgICByb290Vmlld01vZGVsID0gdGhpcy5mcmFtZUNvbnRleHQuZ2V0VmlydHVhbFJvb3RGcmFtZUNvbnRleHQoKS52aWV3TW9kZWw7XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IGZvcm1WYWxpZCA9IHRydWU7XHJcbiAgICBsZXQgZW50aXR5VmFsaWQgPSB0cnVlO1xyXG4gICAgY29uc3QgZm9ybVZhbGlkYXRpb25SdWxlcyA9IG5ldyBNYXA8c3RyaW5nLCBWYWxpZGF0ZVJ1bGVbXT4oKTtcclxuICAgIGZyYW1lQ29udGV4dHMuZm9yRWFjaCgoZm9ybUNvbnRleHQ6IEZyYW1lQ29udGV4dCkgPT4ge1xyXG4gICAgICBjb25zdCBiaW5kaW5nT2JqZWN0ID0gZm9ybUNvbnRleHQuYmluZGluZ0RhdGEuZ2V0T2JqZWN0KCk7XHJcbiAgICAgIC8vIOmAmuefpeaJgOaciWJpbmRpbmdEYXRhLFxyXG4gICAgICBiaW5kaW5nT2JqZWN0ICYmIGJpbmRpbmdPYmplY3Quc2V0U2hvd1ZhbGlkYXRpb25Nc2codHJ1ZSk7XHJcbiAgICAgIGlmIChmb3JtQ29udGV4dC5mb3JtICYmIGZvcm1Db250ZXh0LmZvcm0uZW5hYmxlVmFsaWRhdGUpIHtcclxuICAgICAgICAvLyDojrflj5blvZPliY3ooajljZXkuIrnmoTmiYDmnInpqozor4Hop4TliJlcclxuICAgICAgICBjb25zdCBjdXJyZW50Rm9ybVZhbGlkYXRpb25SdWxlcyA9IGZvcm1Db250ZXh0LmZvcm0uZ2V0VmFsaWRhdGlvblJ1bGVzKCk7XHJcbiAgICAgICAgY3VycmVudEZvcm1WYWxpZGF0aW9uUnVsZXMuZm9yRWFjaCgocnVsZXMsIHBhdGgpID0+IHtcclxuICAgICAgICAgIGlmIChmb3JtVmFsaWRhdGlvblJ1bGVzLmhhcyhwYXRoKSkge1xyXG4gICAgICAgICAgICBydWxlcy5mb3JFYWNoKHJ1bGUgPT4gZm9ybVZhbGlkYXRpb25SdWxlcy5nZXQocGF0aCkucHVzaChydWxlKSk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBmb3JtVmFsaWRhdGlvblJ1bGVzLnNldChwYXRoLCBbLi4ucnVsZXNdKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICBmb3JtQ29udGV4dC5mb3JtLnNldFNob3dWYWxpZGF0aW9uTXNnKHRydWUpO1xyXG4gICAgICAgIC8vIOmAkOS4quiwg+eUqOihqOWNleeahOmqjOivge+8jOmqjOivgeWJjeerr+ihqOWNleinhOWImVxyXG4gICAgICAgIGlmICghZm9ybUNvbnRleHQuZm9ybS5pc0Zvcm1WYWxpZCgpKSB7XHJcbiAgICAgICAgICBmb3JtRXJyb3JzLnB1c2goZm9ybUNvbnRleHQuZm9ybSk7XHJcbiAgICAgICAgICBmb3JtVmFsaWQgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgLy8g6Kem5Y+R5omA5pyJ5a6e5L2T55qEdmFsaWRhdGXkuovku7ZcclxuICAgIGNvbnN0IGlzTXVsdGlFbnRpdHlWYWxpYXRlID0gZW50aXRpZXMubGVuZ3RoID4gMDtcclxuXHJcbiAgICAvLyDpqozor4HmiYDmnInlrp7kvZNcclxuICAgIGNvbnN0IG9ic2VydmFibGVMaXN0ID0gZW50aXRpZXMubWFwKChlbnRpdHk6IEVudGl0eSwgaW5kZXg6IG51bWJlcikgPT5cclxuICAgICAgZW50aXR5LnZhbGlkYXRlKHVuZGVmaW5lZCwgdW5kZWZpbmVkLCBmb3JtVmFsaWRhdGlvblJ1bGVzLCBpc011bHRpRW50aXR5VmFsaWF0ZSA/IGluZGV4IDogbnVsbCwgdGhpcy5mcmFtZUNvbnRleHQpKTtcclxuICAgIGNvbnN0IHJlc3VsdCQgPSB6aXAoLi4ub2JzZXJ2YWJsZUxpc3QpLnBpcGUoXHJcbiAgICAgIHRhcCgocmVzdWx0TGlzdCkgPT4ge1xyXG4gICAgICAgIGZyYW1lQ29udGV4dHMuZm9yRWFjaCgoZm9ybUNvbnRleHQ6IEZyYW1lQ29udGV4dCkgPT4ge1xyXG4gICAgICAgICAgaWYgKCFmb3JtQ29udGV4dC5mb3JtLmVuYWJsZVZhbGlkYXRlKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGNvbnN0IGhhbmRsZUVycm9ycyA9IChlcnJvcnM6IFZhbGlkYXRpb25FcnJvcltdKSA9PiB7XHJcbiAgICAgICAgICAgIGVycm9ycy5mb3JFYWNoKCh2YWxpZGF0aW9uRXJyb3I6IFZhbGlkYXRpb25FcnJvcikgPT4ge1xyXG4gICAgICAgICAgICAgIGlmICh2YWxpZGF0aW9uRXJyb3IuY2hpbGRyZW4gJiYgdmFsaWRhdGlvbkVycm9yLmNoaWxkcmVuLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgaGFuZGxlRXJyb3JzKHZhbGlkYXRpb25FcnJvci5jaGlsZHJlbik7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIGNvbnN0IGVyck1zZ09iaiA9IHt9O1xyXG4gICAgICAgICAgICAgIGxldCBpZCA9ICcnO1xyXG4gICAgICAgICAgICAgIGNvbnN0IGZpbmRJZCA9ICh0YXJnZXQ6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRhcmdldCAmJiB0YXJnZXQuZGF0YSAmJiB0YXJnZXQuZGF0YS5pZCkge1xyXG4gICAgICAgICAgICAgICAgICBpZCA9IHRhcmdldC5kYXRhLmlkO1xyXG4gICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRhcmdldFtQQVJFTlRfQ0xBU1NdKSB7XHJcbiAgICAgICAgICAgICAgICAgIGZpbmRJZCh0YXJnZXRbUEFSRU5UX0NMQVNTXSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICBmaW5kSWQodmFsaWRhdGlvbkVycm9yLnRhcmdldCk7XHJcblxyXG4gICAgICAgICAgICAgIC8vIOWunuS9k+mqjOivgeWHuumUme+8jOmcgOimgeWwhumUmeivr+WxleekuuWIsOeVjOmdouS4ilxyXG4gICAgICAgICAgICAgIC8vIOWunuS9k+S4jeS4gOWumuaYr+W9k+WJjeihjFxyXG4gICAgICAgICAgICAgIGxldCBwYXJlbnRQYXRoRGF0YSA9IHtcclxuICAgICAgICAgICAgICAgIHBhdGg6IFtdLFxyXG4gICAgICAgICAgICAgICAgaXNVZHQ6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgaXNHcmlkOiBmYWxzZVxyXG4gICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgaWYgKHZhbGlkYXRpb25FcnJvci50YXJnZXQpIHtcclxuICAgICAgICAgICAgICAgIHBhcmVudFBhdGhEYXRhID0gdmFsaWRhdGlvbkVycm9yLnRhcmdldC5nZXRQYXRocygpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBjb25zdCBiaW5kaW5nUGF0aCA9ICcvJyArIHBhcmVudFBhdGhEYXRhLnBhdGguam9pbignLycpO1xyXG4gICAgICAgICAgICAgIGlmICh2YWxpZGF0aW9uRXJyb3IuY29uc3RyYWludHMpIHtcclxuICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKHZhbGlkYXRpb25FcnJvci5jb25zdHJhaW50cykuZm9yRWFjaChrZXkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICBlcnJNc2dPYmpba2V5XSA9IHtcclxuICAgICAgICAgICAgICAgICAgICBuYW1lOiB2YWxpZGF0aW9uRXJyb3IuY29uc3RyYWludHNba2V5XVxyXG4gICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAvLyBpZiAodGhpcy5mcmFtZUNvbnRleHQudmlld01vZGVsLmJpbmRpbmdQYXRoID09PSBiaW5kaW5nUGF0aCkge1xyXG4gICAgICAgICAgICAgICAgICAvLyAgIHJvb3RWaWV3TW9kZWxbJ3ZlcmlmeUluZm9ybWF0aW9ucyddLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAvLyAgICAgaWQ6IGlkLFxyXG4gICAgICAgICAgICAgICAgICAvLyAgICAgdGl0bGU6IGtleSxcclxuICAgICAgICAgICAgICAgICAgLy8gICAgIG1zZzogdmFsaWRhdGlvbkVycm9yLmNvbnN0cmFpbnRzW2tleV0sXHJcbiAgICAgICAgICAgICAgICAgIC8vICAgICB0eXBlOiAnd2FybidcclxuICAgICAgICAgICAgICAgICAgLy8gICB9KVxyXG4gICAgICAgICAgICAgICAgICAvLyB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgY29uc3QgcGF0aHMgPSBwYXJlbnRQYXRoRGF0YS5wYXRoLmNvbmNhdCh2YWxpZGF0aW9uRXJyb3IucHJvcGVydHkpO1xyXG5cclxuICAgICAgICAgICAgICAvL2lmICh0aGlzLmZyYW1lQ29udGV4dC52aWV3TW9kZWwuYmluZGluZ1BhdGggPT09IGJpbmRpbmdQYXRoKSB7XHJcbiAgICAgICAgICAgICAgLy8g5bCG6ZSZ6K+v5L+h5oGv5pu05paw5YiwZm9ybUNvbnRyb2zkuIpcclxuICAgICAgICAgICAgICBmb3JtQ29udGV4dC5iaW5kaW5nRGF0YS5jaGFuZ2VzLm5leHQoe1xyXG4gICAgICAgICAgICAgICAgdHlwZTogQ2hhbmdlVHlwZS5VcGRhdGVFcnJvcnMsXHJcbiAgICAgICAgICAgICAgICBpZCxcclxuICAgICAgICAgICAgICAgIHBhdGg6IHBhdGhzLFxyXG4gICAgICAgICAgICAgICAgaXNVZHQ6IHBhcmVudFBhdGhEYXRhLmlzVWR0LFxyXG4gICAgICAgICAgICAgICAgaXNHcmlkOiBwYXJlbnRQYXRoRGF0YS5pc0dyaWQsXHJcbiAgICAgICAgICAgICAgICB2YWx1ZTogdmFsaWRhdGlvbkVycm9yLnZhbHVlLFxyXG4gICAgICAgICAgICAgICAgZXJyb3JzOiBlcnJNc2dPYmpcclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAvL31cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgICAgLy8g5bGV5byA6aqM6K+B57uT5p6cXHJcbiAgICAgICAgICBjb25zdCBpc1ZhbGlkTGlzdCA9IHJlc3VsdExpc3QubWFwKChyZXN1bHQ6IFZhbGlkYXRpb25SZXN1bHQpID0+IHJlc3VsdC5pc1ZhbGlkKTtcclxuICAgICAgICAgIC8vIOS/neWtmOWJjeWFiOiwg+eUqOWunuS9k+S4iueahOmqjOivgeinhOWIme+8jOWFqOmDqOmAmui/h+S5i+WQjuaJjeS/neWtmFxyXG4gICAgICAgICAgLy8g5a6e5L2T6aqM6K+B6YCa6L+HXHJcbiAgICAgICAgICBpZiAoaXNWYWxpZExpc3QuZmlsdGVyKHggPT4geCkubGVuZ3RoID09PSBvYnNlcnZhYmxlTGlzdC5sZW5ndGgpIHtcclxuICAgICAgICAgICAgLy8g5bCG6ZSZ6K+v5L+h5oGv5pu05paw5YiwZm9ybUNvbnRyb2zkuIpcclxuICAgICAgICAgICAgZm9ybUNvbnRleHQuYmluZGluZ0RhdGEuY2hhbmdlcy5uZXh0KHtcclxuICAgICAgICAgICAgICB0eXBlOiBDaGFuZ2VUeXBlLlVwZGF0ZUVycm9ycyxcclxuICAgICAgICAgICAgICBwYXRoOiBbXVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgLy8g6aqM6K+B5oiQ5Yqf5ZCO6ZqQ6JeP6L6T5YWl5pe255qE6aqM6K+BXHJcbiAgICAgICAgICAgIGlmIChmb3JtVmFsaWQpIHtcclxuICAgICAgICAgICAgICBjb25zdCBiaW5kaW5nT2JqZWN0ID0gZm9ybUNvbnRleHQuYmluZGluZ0RhdGEuZ2V0T2JqZWN0KCk7XHJcbiAgICAgICAgICAgICAgYmluZGluZ09iamVjdCAmJiBiaW5kaW5nT2JqZWN0LnNldFNob3dWYWxpZGF0aW9uTXNnKGZhbHNlKTtcclxuICAgICAgICAgICAgICBjb25zdCBmb3JtID0gZm9ybUNvbnRleHQuZm9ybTtcclxuICAgICAgICAgICAgICBpZiAoZm9ybSkge1xyXG4gICAgICAgICAgICAgICAgZm9ybS5zZXRTaG93VmFsaWRhdGlvbk1zZyhmYWxzZSk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyDlrp7kvZPpqozor4HmnInplJnor69cclxuICAgICAgICAgICAgZW50aXR5VmFsaWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgcmVzdWx0TGlzdC5mb3JFYWNoKChyZXN1bHQ6IFZhbGlkYXRpb25SZXN1bHQpID0+IHtcclxuICAgICAgICAgICAgICBpZiAocmVzdWx0LmlzVmFsaWQpIHtcclxuICAgICAgICAgICAgICAgIC8vIOa4hemZpOmqjOivgemAmui/h+eahOmUmeivr1xyXG4gICAgICAgICAgICAgICAgZm9ybUNvbnRleHQuYmluZGluZ0RhdGEuY2hhbmdlcy5uZXh0KHtcclxuICAgICAgICAgICAgICAgICAgdHlwZTogQ2hhbmdlVHlwZS5VcGRhdGVFcnJvcnMsXHJcbiAgICAgICAgICAgICAgICAgIHBhdGg6IFtdXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaGFuZGxlRXJyb3JzKHJlc3VsdC5lcnJvcnMpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pLFxyXG4gICAgICBzd2l0Y2hNYXAoKHJlc3VsdExpc3QpID0+IHtcclxuICAgICAgICBsZXQgaXNWYWxpZGF0ZWQgPSB0cnVlO1xyXG4gICAgICAgIGNvbnN0IGVycm9ycyA9IFtdO1xyXG4gICAgICAgIHJlc3VsdExpc3QuZm9yRWFjaCgocmVzdWx0OiBWYWxpZGF0aW9uUmVzdWx0KSA9PiB7XHJcbiAgICAgICAgICBpZiAoIXJlc3VsdC5pc1ZhbGlkKSB7XHJcbiAgICAgICAgICAgIGlzVmFsaWRhdGVkID0gZmFsc2U7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBlcnJvcnMucHVzaCguLi5yZXN1bHQuZXJyb3JzKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBpZiAoZXJyb3JzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgIHRoaXMuY29sbGVjdFZhbGlkYXRpb25FcnJvcnMocm9vdFZpZXdNb2RlbCwgZXJyb3JzLCB0aGlzLmZyYW1lQ29udGV4dC5uYW1lc3BhY2UpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgdmVyaWZ5SW5mb3JtYXRpb25zID0gcm9vdFZpZXdNb2RlbC52ZXJpZnlJbmZvcm1hdGlvbnM7XHJcbiAgICAgICAgaWYgKGlzTW9kYWwgJiYgaGFzT3duVmVyaWZ5RGV0YWlsU2VydmljZSkge1xyXG4gICAgICAgICAgdmVyaWZ5SW5mb3JtYXRpb25zID0gcm9vdFZpZXdNb2RlbC52ZXJpZnlJbmZvcm1hdGlvbnMuZmlsdGVyKGl0ZW0gPT4gaXRlbS5uYW1lc3BhY2UgPT09IG5hbWVzcGFjZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIOWboOS4uuagoemqjOe0r+WKoOeahOe8mOaVhe+8jOWvvOiHtOS5i+WJjeeahOagoemqjOS/oeaBr+S4gOebtOWtmOWcqO+8jOWPquiDvemAmui/h+agoemqjOe7k+aenOadpeehruWumuaYr+WQpui/mOaciemUmeivr+S/oeaBr1xyXG4gICAgICAgIGlmIChpc1ZhbGlkYXRlZCAmJiBmb3JtVmFsaWQpIHtcclxuICAgICAgICAgIHZlcmlmeUluZm9ybWF0aW9ucyA9IHJvb3RWaWV3TW9kZWwudmVyaWZ5SW5mb3JtYXRpb25zID0gW107XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJvb3RWaWV3TW9kZWwudmVyaWZ5Y2F0aW9uQ2hhbmdlZC5uZXh0KHZlcmlmeUluZm9ybWF0aW9ucyk7XHJcbiAgICAgICAgaWYgKGlzVmFsaWRhdGVkICYmIGZvcm1WYWxpZCkge1xyXG4gICAgICAgICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByZXR1cm4gZW1wdHkoKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gICAgcmV0dXJuIHJlc3VsdCQ7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOagoemqjOWunuS9k+aYr+WQpua7oei2s+S4jeiDveS4uuepuueahOinhOWImVxyXG4gICAqIEBwYXJhbSBlbnRpdHkg5Li75a6e5L2TXHJcbiAgICovXHJcbiAgcHJpdmF0ZSB2YWxpZGF0ZUVudGl0eUFsbG93RW1wdHlSdWxlKGVudGl0eVR5cGVJbmZvOiBEYXRhVHlwZUluZm8pIHtcclxuICAgIC8vIOehruiupOWunuS9k+WQhOS4quWxgue6p+S4reaYr+WQpuWtmOWcqOS4jeiDveS4uuepuueahOinhOWImVxyXG4gICAgY29uc3QgcGF0aHMgPSB0aGlzLmdldE5vdEFsbG93RW1wdHlCaW5kaW5nUGF0aHMoZW50aXR5VHlwZUluZm8pO1xyXG4gICAgaWYgKCFwYXRocyB8fCBwYXRocy5sZW5ndGggPCAxKSB7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG4gICAgLy8g5om+5Yiw5omA5pyJ5LiN5ZCI5rOV55qEYmluZGluZ1BhdGhzXHJcbiAgICBjb25zdCBpbnZhbGlkUGF0aHMgPSBwYXRocy5maWx0ZXIoKHBhdGg6IHN0cmluZykgPT4ge1xyXG4gICAgICBjb25zdCBiaW5kaW5nUGF0aHMgPSBwYXRoLnNwbGl0KCcvJykuZmlsdGVyKHAgPT4gcCk7XHJcbiAgICAgIGNvbnN0IGJpbmRpbmdMaXN0ID0gdGhpcy5mcmFtZUNvbnRleHQuYmluZGluZ0RhdGEuZ2V0VmFsdWUoYmluZGluZ1BhdGhzKSBhcyBCaW5kaW5nTGlzdDtcclxuICAgICAgaWYgKCFiaW5kaW5nTGlzdCB8fCBiaW5kaW5nTGlzdC5sZW5ndGggPCAxKSB7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfSk7XHJcbiAgICAvLyDmnInlrp7kvZPlv4XloavvvIzkvYblrp7kvZPmlbDmja7kuLrnqbpcclxuICAgIGlmIChpbnZhbGlkUGF0aHMubGVuZ3RoID4gMCkge1xyXG4gICAgICBjb25zdCB0YWJsZU5hbWVzID0gW107XHJcbiAgICAgIGludmFsaWRQYXRocy5mb3JFYWNoKChwYXRoOiBzdHJpbmcpID0+IHtcclxuICAgICAgICAvL2NvbnN0IGZyYW1lQ29udGV4dHMgPSB0aGlzLmdldEZyYW1lQ29udGV4dEJ5QmluZGluZ1BhdGgocGF0aC5zcGxpdCgnLycpKTtcclxuICAgICAgICAvL2NvbnN0IGZyYW1lQ29tcG9uZW50cyA9IGZyYW1lQ29udGV4dHMubWFwKGZyYW1lQ29udGV4dCA9PiBmcmFtZUNvbnRleHQuZnJhbWVDb21wb25lbnQpO1xyXG4gICAgICAgIC8vIOaJvuWIsOaJgOacieWuueWZqOexu+e7hOS7tlxyXG4gICAgICAgIC8vY29uc3QgY29udGFpbmVyQ29tcG9uZW50cyA9IGZyYW1lQ29tcG9uZW50cy5maWx0ZXIoZnJhbWVDb21wb25lbnQgPT4gW0NvbXBvbmVudFR5cGUuZmFycmlzRGF0YUdyaWRDb21wb25lbnQsIENvbXBvbmVudFR5cGUuZmFycmlzVHJlZVRhbGJlQ29tcG9uZW50LCBDb21wb25lbnRUeXBlLmtlbmRvR3JpZENvbXBvbmVudCwgQ29tcG9uZW50VHlwZS5wcmltZW5nVHJlZUNvbXBvbmVudF0uaW5jbHVkZXMoZnJhbWVDb21wb25lbnQuY29tcG9uZW50VHlwZSkpO1xyXG4gICAgICAgIC8vaWYgKCEoIWNvbnRhaW5lckNvbXBvbmVudHMgfHwgY29udGFpbmVyQ29tcG9uZW50cy5sZW5ndGggPCAxKSkge1xyXG4gICAgICAgIGNvbnN0IHZpZXdNb2RlbE5hbWUgPSB0aGlzLmdldFZpZXdNb2RlbE5hbWVCeUJpbmRpbmdQYXRocyhwYXRoLnNwbGl0KCcvJykpIHx8IGDnu5Hlrprot6/lvoQke3BhdGh9YDtcclxuICAgICAgICB0YWJsZU5hbWVzLnB1c2godmlld01vZGVsTmFtZSk7XHJcbiAgICAgICAgLy99XHJcbiAgICAgIH0pO1xyXG4gICAgICBpZiAodGhpcy5ub3RpZnlTZXJ2aWNlKSB7XHJcbiAgICAgICAgdGhpcy5ub3RpZnlTZXJ2aWNlLmVycm9yKGAke3RhYmxlTmFtZXMuam9pbign77yMJyl9ICR7dGhpcy5sYW5ndWFnZVNlcnZpY2UudGFibGVDYW5Ob3RFbXB0eX1gLCB7IGhpZGVUaXRsZTogdHJ1ZSB9KTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICogXHJcbiAgICogQHBhcmFtIGJpbmRpbmdQYXRocyBwYXRo5LiN6IO95Li656m65oiWL++8jOS4jeaUr+aMgeS4u+ihqFxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0Vmlld01vZGVsTmFtZUJ5QmluZGluZ1BhdGhzKGJpbmRpbmdQYXRoczogc3RyaW5nW10pIHtcclxuICAgIGNvbnN0IG5hbWVzcGFjZSA9IHRoaXMuZnJhbWVDb250ZXh0Lm5hbWVzcGFjZTtcclxuICAgIGxldCBmcmFtZUNvbnRleHRzOiBGcmFtZUNvbnRleHRbXSA9IG51bGw7XHJcbiAgICBpZiAobmFtZXNwYWNlICE9PSBudWxsKSB7XHJcbiAgICAgIC8vIOWtmOWcqOWRveWQjeepuumXtO+8jOivtOaYjuihqOWNlei+g+aWsO+8jOWPr+S7peS+nei1luivpeeJueaAp1xyXG4gICAgICBmcmFtZUNvbnRleHRzID0gdGhpcy5mcmFtZUNvbnRleHQuYXBwQ29udGV4dC5mcmFtZUNvbnRleHRNYW5hZ2VyLmdldEZyYW1lQ29udGV4dHNCeU5hbWVzcGFjZShuYW1lc3BhY2UpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8g6KGo5Y2V6L6D6ICB77yM6I635Y+W5omA5pyJ55qE5LiK5LiL5paH77yM5Zyo5qCh6aqM6Zi25q616L+H5ruk6KeE5YiZXHJcbiAgICAgIGZyYW1lQ29udGV4dHMgPSB0aGlzLmZyYW1lQ29udGV4dC5hcHBDb250ZXh0LmZyYW1lQ29udGV4dE1hbmFnZXIuZ2V0RnJhbWVDb250ZXh0cygpO1xyXG4gICAgfVxyXG4gICAgY29uc3QgYmluZGluZ1BhdGggPSBiaW5kaW5nUGF0aHMuZmlsdGVyKHAgPT4gcCkuam9pbignLycpO1xyXG4gICAgY29uc3QgZnJhbWVDb250ZXh0ID0gZnJhbWVDb250ZXh0cy5maW5kKChmcmFtZUNvbnRleHQ6IEZyYW1lQ29udGV4dCkgPT4gZnJhbWVDb250ZXh0LnZpZXdNb2RlbCAmJiBmcmFtZUNvbnRleHQudmlld01vZGVsLmJpbmRpbmdQYXRoLnNwbGl0KCcvJykuZmlsdGVyKHAgPT4gcCkuam9pbignLycpID09PSBiaW5kaW5nUGF0aCk7XHJcbiAgICBjb25zdCB2aWV3TW9kZWxOYW1lID0gZnJhbWVDb250ZXh0ICYmIGZyYW1lQ29udGV4dC5mb3JtICYmIGZyYW1lQ29udGV4dC5mb3JtLmZvcm1Hcm91cE5hbWUgfHwgJyc7XHJcbiAgICByZXR1cm4gdmlld01vZGVsTmFtZTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6YGN5Y6G6I635Y+W5omA5pyJ5LiN6IO95Li656m655qE5a6e5L2T55qE57uR5a6a6Lev5b6EXHJcbiAgICogQHBhcmFtIGVudGl0eVR5cGVJbmZvIFxyXG4gICAqIEBwYXJhbSByZXN1bHRzIFxyXG4gICAqIEByZXR1cm5zIFxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0Tm90QWxsb3dFbXB0eUJpbmRpbmdQYXRocyhlbnRpdHlUeXBlSW5mbzogRGF0YVR5cGVJbmZvLCByZXN1bHRzOiBzdHJpbmdbXSA9IFtdKTogc3RyaW5nW10ge1xyXG4gICAgaWYgKCFlbnRpdHlUeXBlSW5mbykge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB0aGlzLmRlZXBGaXJzdFRyYXZlcnNhbEVudGl0eVR5cGVJbmZvKGVudGl0eVR5cGVJbmZvLCByZXN1bHRzKTtcclxuICAgIHJldHVybiByZXN1bHRzO1xyXG4gIH1cclxuICBwcml2YXRlIGRlZXBGaXJzdFRyYXZlcnNhbEVudGl0eVR5cGVJbmZvKGVudGl0eVR5cGVJbmZvOiBEYXRhVHlwZUluZm8sIHJlc3VsdDogc3RyaW5nW10gPSBbXSwgcHJldmlvdXNWYWx1ZTogc3RyaW5nW10gPSBbXSkge1xyXG4gICAgLy8g56Gu6K6k5b2T5YmN5a6e5L2T5piv5ZCm5b+F5aGrXHJcbiAgICBjb25zdCBpc0FsbG93RW1wdHkgPSB0aGlzLmlzQWxsb3dFbXB0eShlbnRpdHlUeXBlSW5mby5lbnRpdHlJbmZvLmFsbG93RW1wdHksIHByZXZpb3VzVmFsdWUpO1xyXG4gICAgaWYgKGlzQWxsb3dFbXB0eSA9PT0gZmFsc2UpIHtcclxuICAgICAgaWYgKHByZXZpb3VzVmFsdWUubGVuZ3RoIDwgMSkge1xyXG4gICAgICAgIHJlc3VsdC5wdXNoKCcnKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXN1bHQucHVzaChwcmV2aW91c1ZhbHVlLmpvaW4oJy8nKSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIC8vIOiOt+WPluaJgOacieWtkOihqFxyXG4gICAgY29uc3QgbGlzdCA9IGVudGl0eVR5cGVJbmZvLmdldFByb3BJbmZvc0J5R3JvdXAoRGF0YVByb3BHcm91cC5MaXN0KTtcclxuICAgIGlmIChsaXN0ICYmIGxpc3QubGVuZ3RoID4gMCkge1xyXG4gICAgICBsaXN0LmZvckVhY2goKHByb3BJbmZvOiBEYXRhUHJvcEluZm8pID0+IHtcclxuICAgICAgICBjb25zdCB0eXBlSW5mbyA9IHByb3BJbmZvLnR5cGVJbmZvO1xyXG4gICAgICAgIGlmICh0eXBlSW5mbyAmJiB0eXBlSW5mby5lbnRpdHlJbmZvKSB7XHJcbiAgICAgICAgICBwcmV2aW91c1ZhbHVlLnB1c2godHlwZUluZm8uZW50aXR5SW5mby5ub2RlQ29kZSk7XHJcbiAgICAgICAgICB0aGlzLmRlZXBGaXJzdFRyYXZlcnNhbEVudGl0eVR5cGVJbmZvKHR5cGVJbmZvLCByZXN1bHQsIHByZXZpb3VzVmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICAvLyDmsqHmnInkuIvnuqfkuobvvIzmraTml7blupTor6XmuIXnqbrmuLjmoIfvvIzlsIbmlLbpm4bliLDnmoTot6/lvoTmlL7liLDnu5Pmnpzpm4bkuK1cclxuICAgIGlmIChwcmV2aW91c1ZhbHVlICYmIHByZXZpb3VzVmFsdWUubGVuZ3RoID4gMCkge1xyXG4gICAgICBwcmV2aW91c1ZhbHVlLnBvcCgpO1xyXG4gICAgfVxyXG4gIH1cclxuICBwcml2YXRlIGlzQWxsb3dFbXB0eSh2YWx1ZTogc3RyaW5nIHwgYm9vbGVhbiwgcGF0aHM6IHN0cmluZ1tdKSB7XHJcbiAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gdHJ1ZSB8fCB2YWx1ZSA9PT0gJycpIHtcclxuICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcbiAgICAvLyDlvIDlj5HogIXlrprkuYnkuobkuI3og73kuLrnqbrnmoTop4TliJlcclxuICAgIGNvbnN0IGZyYW1lQ29udGV4dHMgPSB0aGlzLmdldEZyYW1lQ29udGV4dEJ5QmluZGluZ1BhdGgocGF0aHMpO1xyXG4gICAgbGV0IGNhbGxlciA9IHRoaXMuZnJhbWVDb250ZXh0LmZyYW1lQ29tcG9uZW50O1xyXG4gICAgaWYgKCFmcmFtZUNvbnRleHRzIHx8IGZyYW1lQ29udGV4dHMubGVuZ3RoIDwgMSkge1xyXG4gICAgICAvLyDlrprkuYnkuobop4TliJnkvYblr7nlupTnmoRGcmFtZeayoeaciea4suafk1xyXG4gICAgICBjb25zb2xlLndhcm4oYOe7keWumui3r+W+hCAke3BhdGhzLmpvaW4oJy8nKX0g5a6a5LmJ5LqG5LiN6IO95Li656m655qE6KeE5YiZ77yM5L2G5om+5LiN5Yiw6K+l57uR5a6a6Lev5b6E5a+55bqU55qE57uE5Lu244CC6K+356Gu5L+d57uE5Lu25pi+6ZqQ5LiO5b+F5aGr5LiA6Ie044CCYCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjYWxsZXIgPSBmcmFtZUNvbnRleHRzLnBvcCgpLmZyYW1lQ29tcG9uZW50O1xyXG4gICAgfVxyXG4gICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XHJcbiAgICAgIHJldHVybiB2YWx1ZTtcclxuICAgIH0gZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xyXG4gICAgICB2YWx1ZSA9IHZhbHVlLnRyaW0oKS5zdGFydHNXaXRoKCdyZXR1cm4nKSA/IHZhbHVlIDogYHJldHVybiAke3ZhbHVlfWA7XHJcbiAgICAgIGNvbnN0IGZhY3RvcnkgPSBuZXcgRnVuY3Rpb24oYFxyXG4gICAgICAgIHZhciB2aWV3TW9kZWwgPSB0aGlzLnZpZXdNb2RlbDtcclxuICAgICAgICB2YXIgYmluZGluZ0RhdGEgPSB0aGlzLmJpbmRpbmdEYXRhO1xyXG4gICAgICAgIHZhciBjb250ZXh0ID0gdGhpcy5jb250ZXh0O1xyXG4gICAgICAgICR7dmFsdWV9XHJcbiAgICAgIGApO1xyXG4gICAgICByZXR1cm4gZmFjdG9yeS5hcHBseShjYWxsZXIpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY29uc29sZS53YXJuKGDml6DmlYjnmoTlv4Xloavop4TliJnjgIJgKTtcclxuICAgIH1cclxuICB9XHJcbiAgY29sbGVjdFZhbGlkYXRpb25FcnJvcnMocm9vdFZpZXdNb2RlbDogVmlld01vZGVsLCBlcnJvcnM6IFZhbGlkYXRpb25FcnJvcltdLCBuYW1lc3BhY2U6IHN0cmluZywgZmlsdGVyOiBib29sZWFuID0gdHJ1ZSkge1xyXG4gICAgaWYgKGZpbHRlcikge1xyXG4gICAgICByb290Vmlld01vZGVsLnZlcmlmeUluZm9ybWF0aW9ucyA9IHJvb3RWaWV3TW9kZWwudmVyaWZ5SW5mb3JtYXRpb25zLmZpbHRlcihpdGVtID0+IGl0ZW0ubmFtZXNwYWNlICE9PSBuYW1lc3BhY2UpO1xyXG4gICAgfVxyXG4gICAgZXJyb3JzLmZvckVhY2goKHZhbGlkYXRpb25FcnJvcjogVmFsaWRhdGlvbkVycm9yKSA9PiB7XHJcbiAgICAgIGlmICh2YWxpZGF0aW9uRXJyb3IuY2hpbGRyZW4gJiYgdmFsaWRhdGlvbkVycm9yLmNoaWxkcmVuLmxlbmd0aCkge1xyXG4gICAgICAgIHRoaXMuY29sbGVjdFZhbGlkYXRpb25FcnJvcnMocm9vdFZpZXdNb2RlbCwgdmFsaWRhdGlvbkVycm9yLmNoaWxkcmVuLCBuYW1lc3BhY2UsIGZhbHNlKTtcclxuICAgICAgfVxyXG4gICAgICBsZXQgaWQgPSAnJztcclxuICAgICAgY29uc3QgZmluZElkID0gKHRhcmdldDogYW55KSA9PiB7XHJcbiAgICAgICAgaWYgKHRhcmdldCAmJiB0YXJnZXQuZGF0YSAmJiB0YXJnZXQuZGF0YS5pZCkge1xyXG4gICAgICAgICAgaWQgPSB0YXJnZXQuZGF0YS5pZDtcclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9IGVsc2UgaWYgKHRhcmdldFtQQVJFTlRfQ0xBU1NdKSB7XHJcbiAgICAgICAgICBmaW5kSWQodGFyZ2V0W1BBUkVOVF9DTEFTU10pO1xyXG4gICAgICAgIH1cclxuICAgICAgfTtcclxuICAgICAgZmluZElkKHZhbGlkYXRpb25FcnJvci50YXJnZXQpO1xyXG4gICAgICBpZiAodmFsaWRhdGlvbkVycm9yLmNvbnN0cmFpbnRzKSB7XHJcbiAgICAgICAgY29uc3QgdmFsaWRhdGlvblJlc3VsdFR5cGVzID0gT2JqZWN0LmtleXModmFsaWRhdGlvbkVycm9yLmNvbnN0cmFpbnRzKTtcclxuICAgICAgICBpZiAodmFsaWRhdGlvblJlc3VsdFR5cGVzLmxlbmd0aCkge1xyXG4gICAgICAgICAgY29uc3Qgb2Zmc2V0ID0gcm9vdFZpZXdNb2RlbC52ZXJpZnlJbmZvcm1hdGlvbnMuZmlsdGVyKGl0ZW0gPT4gaXRlbS5uYW1lc3BhY2UgPT09IG5hbWVzcGFjZSkubGVuZ3RoO1xyXG4gICAgICAgICAgbGV0IGluZGV4ID0gcm9vdFZpZXdNb2RlbC52ZXJpZnlJbmZvcm1hdGlvbnMuZmluZEluZGV4KGl0ZW0gPT4gaXRlbS5uYW1lc3BhY2UgPT09IG5hbWVzcGFjZSk7XHJcbiAgICAgICAgICBpbmRleCA9IGluZGV4ID09PSAtMSA/IDAgOiBpbmRleCArIG9mZnNldDtcclxuICAgICAgICAgIHJvb3RWaWV3TW9kZWwudmVyaWZ5SW5mb3JtYXRpb25zLnNwbGljZShpbmRleCwgMCwge1xyXG4gICAgICAgICAgICBpZDogaWQsXHJcbiAgICAgICAgICAgIG5hbWVzcGFjZSxcclxuICAgICAgICAgICAgdGFyZ2V0RmllbGQ6IHZhbGlkYXRpb25FcnJvci5maWVsZCxcclxuICAgICAgICAgICAgaW5kZXg6IHZhbGlkYXRpb25FcnJvci5pbmRleCxcclxuICAgICAgICAgICAgdGl0bGU6IHZhbGlkYXRpb25FcnJvci5wcm9wZXJ0eU5hbWUsXHJcbiAgICAgICAgICAgIG1zZzogdmFsaWRhdGlvbkVycm9yLmNvbnN0cmFpbnRzW3ZhbGlkYXRpb25SZXN1bHRUeXBlc1swXV0sXHJcbiAgICAgICAgICAgIGZyYW1lQ29udGV4dDogdmFsaWRhdGlvbkVycm9yLmZyYW1lQ29udGV4dCxcclxuICAgICAgICAgICAgZnVsbFBhdGg6IHZhbGlkYXRpb25FcnJvci5mdWxsUGF0aCxcclxuICAgICAgICAgICAgdHlwZTogdmFsaWRhdGlvblJlc3VsdFR5cGVzWzBdID09PSAncmVxdWlyZWQnID8gJ2VtcHR5JyA6ICdlcnJvcidcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOmHjee9ruagoemqjOS/oeaBr++8iOS7heW9k+WJjeihqOWNle+8iVxyXG4gICAqL1xyXG4gIHB1YmxpYyByZXNldFZhbGlkYXRpb24oKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IGlzRGlhbG9nID0gdGhpcy5pc0luRGlhbG9nKCk7XHJcbiAgICBsZXQgcm9vdFZpZXdNb2RlbCA9IHRoaXMuZnJhbWVDb250ZXh0LnJvb3Qudmlld01vZGVsO1xyXG4gICAgaWYgKGlzRGlhbG9nKSB7XHJcbiAgICAgIHJvb3RWaWV3TW9kZWwgPSB0aGlzLmZyYW1lQ29udGV4dC5nZXRWaXJ0dWFsUm9vdEZyYW1lQ29udGV4dCgpLnZpZXdNb2RlbDtcclxuICAgIH1cclxuICAgIGxldCB2ZXJpZnlJbmZvcm1hdGlvbnMgPSByb290Vmlld01vZGVsLnZlcmlmeUluZm9ybWF0aW9ucztcclxuICAgIGlmICh2ZXJpZnlJbmZvcm1hdGlvbnMubGVuZ3RoKSB7XHJcbiAgICAgIGNvbnN0IG5hbWVzcGFjZSA9IHRoaXMuZnJhbWVDb250ZXh0Lm5hbWVzcGFjZTtcclxuICAgICAgaWYgKG5hbWVzcGFjZSAhPT0gbnVsbCkge1xyXG4gICAgICAgIHZlcmlmeUluZm9ybWF0aW9ucyA9IHJvb3RWaWV3TW9kZWwudmVyaWZ5SW5mb3JtYXRpb25zLmZpbHRlcihpdGVtID0+IGl0ZW0ubmFtZXNwYWNlICE9PSBuYW1lc3BhY2UpO1xyXG4gICAgICB9XHJcbiAgICAgIHJvb3RWaWV3TW9kZWwudmVyaWZ5SW5mb3JtYXRpb25zID0gdmVyaWZ5SW5mb3JtYXRpb25zO1xyXG4gICAgICAvL3Jvb3RWaWV3TW9kZWwudmVyaWZ5SW5mb3JtYXRpb25zLnNwbGljZSgwLCByb290Vmlld01vZGVsLnZlcmlmeUluZm9ybWF0aW9ucy5sZW5ndGgpO1xyXG4gICAgfVxyXG4gICAgaWYgKHJvb3RWaWV3TW9kZWwgJiYgcm9vdFZpZXdNb2RlbC52ZXJpZnljYXRpb25DaGFuZ2VkKSB7XHJcbiAgICAgIHJvb3RWaWV3TW9kZWwudmVyaWZ5Y2F0aW9uQ2hhbmdlZC5uZXh0KHZlcmlmeUluZm9ybWF0aW9ucyk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gb2YobnVsbCk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOaYr+WQpuWcqOW8ueeql+WGhemDqFxyXG4gICAqL1xyXG4gIHByaXZhdGUgaXNJbkRpYWxvZygpIHtcclxuICAgIHJldHVybiB0aGlzLmZyYW1lQ29udGV4dCAmJiB0aGlzLmZyYW1lQ29udGV4dC5nZXRWaXJ0dWFsUm9vdEZyYW1lQ29udGV4dCgpICYmIHRoaXMuZnJhbWVDb250ZXh0LmdldFZpcnR1YWxSb290RnJhbWVDb250ZXh0KCkuZnJhbWVDb21wb25lbnQgJiYgdGhpcy5mcmFtZUNvbnRleHQuZ2V0VmlydHVhbFJvb3RGcmFtZUNvbnRleHQoKS5mcmFtZUNvbXBvbmVudFsnaXNEaWFsb2dSb290Q29tcG9uZW50J10gfHwgZmFsc2U7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOaLpeacieeLrOiHqueahOagoemqjOaPkOekuuacjeWKoVxyXG4gICAqL1xyXG4gIHByaXZhdGUgaGFzT3duVmVyaWZ5RGV0YWlsU2VydmljZSgpIHtcclxuICAgIHJldHVybiB0aGlzLmZyYW1lQ29udGV4dC5pbmplY3Rvci5nZXQ8VmVyaWZ5RGV0YWlsU2VydmljZT4oVmVyaWZ5RGV0YWlsU2VydmljZSwgbnVsbCkgIT09IHRoaXMuZnJhbWVDb250ZXh0LnJvb3QuYXBwQ29udGV4dC5pbmplY3Rvci5nZXQ8VmVyaWZ5RGV0YWlsU2VydmljZT4oVmVyaWZ5RGV0YWlsU2VydmljZSwgbnVsbCk7O1xyXG4gIH1cclxuICAvKipcclxuICAgKiDpgJrov4diaW5kaW5nUGF0aOiOt+WPluaJgOacieWMuemFjeeahGZyYW1lQ29udGV4dFxyXG4gICAqIEBwYXJhbSBiaW5kaW5nUGF0aCBcclxuICAgKiBAcmV0dXJucyBcclxuICAgKi9cclxuICBwcml2YXRlIGdldEZyYW1lQ29udGV4dEJ5QmluZGluZ1BhdGgoYmluZGluZ1BhdGhzOiBzdHJpbmdbXSk6IEZyYW1lQ29udGV4dFtdIHtcclxuICAgIGNvbnN0IGJpbmRpbmdQYXRoID0gYmluZGluZ1BhdGhzLmZpbHRlcihwID0+IHApLmpvaW4oJy8nKTtcclxuICAgIHJldHVybiB0aGlzLmZyYW1lQ29udGV4dC5hcHBDb250ZXh0LmZyYW1lQ29udGV4dE1hbmFnZXIuZ2V0RnJhbWVDb250ZXh0cygpLmZpbHRlcihmcmFtZUNvbnRleHQgPT4gZnJhbWVDb250ZXh0LnZpZXdNb2RlbC5iaW5kaW5nUGF0aC5zcGxpdCgnLycpLmZpbHRlcihwID0+IHApLmpvaW4oJy8nKSA9PT0gYmluZGluZ1BhdGgpO1xyXG4gIH1cclxuICBwcml2YXRlIGZpbHRlckRhdGFHcmlkQ29tcG9uZW50KCkgeyB9XHJcbn1cclxuXHJcbmV4cG9ydCB7IFZhbGlkYXRpb25TZXJ2aWNlIH07XHJcbiJdfQ==