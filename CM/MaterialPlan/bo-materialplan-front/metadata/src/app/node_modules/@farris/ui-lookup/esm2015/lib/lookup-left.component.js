/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*
* @Author: 疯狂秀才(Lucas Huang)
* @Date: 2018-12-14 14:40:48
 * @LastEditors: 疯狂秀才(Lucas Huang)
 * @LastEditTime: 2019-09-25 18:10:29
* @Company: Inspur
* @Version: v0.0.1
*/
import { Component, ViewChild, ViewContainerRef, EventEmitter, Output, ComponentFactoryResolver, ChangeDetectorRef } from '@angular/core';
import { of } from 'rxjs';
import { DataTableComponent } from '@farris/ui-datatable';
import { TreeTableComponent } from '@farris/ui-treetable';
import { switchMap } from 'rxjs/operators';
export class LookupLeftComponent {
    /**
     * @param {?} cfr
     * @param {?} cd
     */
    constructor(cfr, cd) {
        this.cfr = cfr;
        this.cd = cd;
        this.selected = new EventEmitter();
        this.unselected = new EventEmitter();
        this.search = new EventEmitter();
        this.pageChanged = new EventEmitter();
        this._searchState = null;
        this._sortState = null;
        this.allData = null;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        if (this.lookupCmp && this.isTreeList()) {
            this.lookupCmp.includeSubordinates$$ = this.lookupCmp.includeSubordinates$.subscribe((/**
             * @param {?} val
             * @return {?}
             */
            (val) => {
                if (this.cmpRef) {
                    /** @type {?} */
                    const tt = (/** @type {?} */ (this.cmpRef.instance));
                    if (tt.selectedRow) {
                        this.selected.emit({ data: tt.selectedRow.data, node: tt.selectedRow });
                    }
                }
            }));
        }
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this._searchState = null;
        this._sortState = null;
    }
    /**
     * @return {?}
     */
    createComponent() {
        /** @type {?} */
        let dtFac = null;
        if (!this.isTreeList()) {
            dtFac = this.cfr.resolveComponentFactory(DataTableComponent);
        }
        else {
            dtFac = this.cfr.resolveComponentFactory(TreeTableComponent);
        }
        this.navOptions['keepSelect'] = false;
        // 左侧查询过滤条，隐藏掉；
        this.navOptions['showFilterBar'] = true;
        // if (this.navOptions.width) {
        //     this.navOptions.width = this.navOptions.width - 2;
        // }
        this.navOptions.width = this.lookupCmp.leftPanelWidth - 2;
        // const injector: Injector = ReflectiveInjector.resolveAndCreate([
        //     { provide: DataTableService, useFactory: () => { new DataTableService()}}
        // ]);
        this.cmpRef = this.cmpContainer.createComponent(dtFac);
        if (!this.isTreeList()) {
            this.navOptions['fill'] = true;
            this.cmpRef.instance.maxSize = 5;
            this.cmpRef.instance.fill = true;
        }
        else {
            this.navOptions['fit'] = true;
        }
        // this.cmpRef.instance.fit = true;
        if (this.navOptions.pageInfo) {
            if (this.navOptions.pageInfo.pageList) {
                this.navOptions.pageList = this.navOptions.pageInfo.pageList;
            }
            this.navOptions.pagination = this.navOptions.pageInfo.enablePager;
            this.navOptions.pageIndex = this.navOptions.pageInfo.pageIndex;
            this.navOptions.pageSize = this.navOptions.pageInfo.pageSize;
        }
        else {
            this.navOptions.pagination = false;
        }
        Object.assign(this.cmpRef.instance, this.navOptions);
        this.loadData();
        return of(this.cmpRef);
    }
    /**
     * @return {?}
     */
    update() {
        this.cd.detectChanges();
    }
    /**
     * @param {?=} size
     * @return {?}
     */
    resize(size) {
        if (size) {
            size.width = size.width - 2;
            // if (this.cmpRef.instance instanceof TreeTableComponent) {
            //     size.height += 46;
            // }
            this.cmpRef.instance.resize(size);
        }
    }
    /**
     * @return {?}
     */
    isTreeList() {
        return this.navOptions.displayType.toLowerCase() === 'treelist' && !this.lookupCmp.navTreeToList;
    }
    /**
     * @private
     * @param {?} items
     * @param {?} dt
     * @return {?}
     */
    selectLeftDataTableRow(items, dt) {
        if (items && items.length) {
            /** @type {?} */
            let item = null;
            if (this.lookupCmp.navSelectedIds) {
                item = items.find((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => n[dt.idField] == this.lookupCmp.navSelectedIds));
            }
            else {
                if (this.lookupCmp.selectFirstInNav) {
                    item = items[0];
                }
            }
            if (item) {
                dt.dtBody.selectedRowIndex = -1;
                dt.dtBody.selectedRow('', 0, item);
            }
        }
    }
    /**
     * @private
     * @return {?}
     */
    closeLoading() {
        this.lookupCmp.closeLoading();
    }
    /**
     * @private
     * @param {?} dt
     * @return {?}
     */
    initDataTable(dt) {
        dt.loadData({
            pageSize: this.navOptions.pageSize,
            pageIndex: this.navOptions.pageIndex,
            total: this.navOptions.total,
            data: this.navOptions.items,
        });
        dt.resize({ width: 320, height: this.navOptions.height });
        // 行选中
        dt.selectedRow.subscribe((/**
         * @param {?} d
         * @return {?}
         */
        d => {
            this.selected.emit({ data: d.data });
        }));
        dt.unSelectRow.subscribe((/**
         * @param {?} d
         * @return {?}
         */
        d => {
            this.selected.emit(null);
        }));
        /** @type {?} */
        const p = { pageInfo: { pageIndex: 1, pageSize: this.navOptions.pageSize }, search: '' };
        /** @type {?} */
        const loadTableData = {
            next: (/**
             * @param {?} data
             * @return {?}
             */
            (data) => {
                this.closeLoading();
                dataTableReLoad(data);
            }),
            error: (/**
             * @param {?} err
             * @return {?}
             */
            (err) => {
                this.closeLoading();
            })
        };
        // 查询
        dt.search.subscribe((/**
         * @param {?} searchData
         * @return {?}
         */
        searchData => {
            this._searchState = searchData;
            this.search.emit(searchData);
            p.search = searchData;
            p.pageInfo.pageSize = dt.pageSize;
            this.lookupCmp.navigationFilter = null;
            if (this._sortState && this._sortState.sortName) {
                p['sortName'] = this._sortState.sortName;
                p['sortOrder'] = this._sortState.sortOrder;
            }
            else {
                delete p['sortName'];
                delete p['sortOrder'];
            }
            this.lookupCmp.httpMgr.getData(p, 'navsearch').subscribe(loadTableData);
        }));
        /** @type {?} */
        const dataTableReLoad = (/**
         * @param {?} data
         * @return {?}
         */
        (data) => {
            dt.loadData({
                pageSize: data.pageInfo.pageSize,
                pageIndex: data.pageInfo.pageIndex,
                total: data.total,
                data: data.items,
            });
            this.selectLeftDataTableRow(data.items, dt);
            dt.cd.markForCheck();
        });
        // 分页
        dt.pageChanged.subscribe((/**
         * @param {?} d
         * @return {?}
         */
        d => {
            this.pageChanged.emit(d);
            this.lookupCmp.navigationFilter = null;
            this.lookupCmp.httpMgr.getData(d, 'navsearch').subscribe(loadTableData);
        }));
        dt.pageSizeChanged.subscribe((/**
         * @param {?} e
         * @return {?}
         */
        (e) => {
            this.lookupCmp.navigationFilter = null;
            this.lookupCmp.httpMgr.getData(e, 'navsearch').subscribe(loadTableData);
        }));
        dt.columnSorted.subscribe((/**
         * @param {?} sort
         * @return {?}
         */
        (sort) => {
            const { sortName, sortOrder } = Object.assign({}, sort);
            this._sortState = sort;
            this.lookupCmp.navigationFilter = null;
            /** @type {?} */
            const param = {
                sortName,
                sortOrder,
                search: this._searchState,
                pageInfo: {
                    pageSize: dt.pageSize,
                    pageIndex: 1
                }
            };
            this.lookupCmp.httpMgr.getData(param, 'navsearch').subscribe(loadTableData);
        }));
        dt.clearSearchValue.subscribe((/**
         * @return {?}
         */
        () => {
            this._searchState = null;
        }));
        this.selectLeftDataTableRow(this.navOptions.items, dt);
    }
    /**
     * @private
     * @param {?} params
     * @return {?}
     */
    buildParams(params) {
        return Object.assign({}, params, { treeToList: this.lookupCmp.treeToList, navTreeToList: this.lookupCmp.navTreeToList });
    }
    /**
     * @private
     * @param {?} tt
     * @return {?}
     */
    initTreeTable(tt) {
        tt.virtualized = true;
        tt.fast = true;
        tt.nodeSelected.subscribe((/**
         * @param {?} d
         * @return {?}
         */
        d => {
            this.selected.emit({ data: d.node.data, node: d.node });
        }));
        tt.nodeUnSelect.subscribe((/**
         * @param {?} d
         * @return {?}
         */
        d => {
            this.selected.emit(null);
        }));
        tt.fixedHeader = true;
        // tt.fit = true;
        this.lookupCmp.treeNodeHelper.updateTreeNodeExpanded(this.navOptions.items, this.navOptions.treeInfo);
        tt.loadDataType = this.navOptions.treeInfo.loadDataType;
        // 检查完整树过滤条件 By Lucas 20200302
        this.navOptions.items = this.lookupCmp.checkNodeCanBeSelect(this.navOptions.items, this.navOptions.treeInfo.loadDataType === 'all');
        tt.loadData(this.navOptions.items);
        if (this.lookupCmp.navSelectedIds) {
            tt.selectNode(this.lookupCmp.navSelectedIds);
        }
        else if (this.lookupCmp.selectFirstInNav) {
            tt.selectFirstNode();
        }
        this.allData = this.navOptions.items;
        /** @type {?} */
        const loadTreeData = {
            next: (/**
             * @param {?} resData
             * @return {?}
             */
            (resData) => {
                this.closeLoading();
                tt.clearAll();
                /** @type {?} */
                const items = this.lookupCmp.checkNodeCanBeSelect(resData.items, this.navOptions.treeInfo.loadDataType === 'all' && (!this._searchState || !this._searchState.value));
                if (items && items.length && items[0].children && items[0].children.length) {
                    items[0].expanded = true;
                    items[0].children = this.lookupCmp.expandFirstNode(items[0].children);
                }
                tt.loadData(items);
                tt.resize();
            }),
            error: (/**
             * @param {?} err
             * @return {?}
             */
            (err) => {
                this.closeLoading();
            })
        };
        tt.search.subscribe((/**
         * @param {?} search
         * @return {?}
         */
        search => {
            this._searchState = search;
            this.lookupCmp.navigationFilter = null;
            /** @type {?} */
            const p = this.buildParams({ search });
            if (this._sortState && this._sortState.sortName) {
                p['sortName'] = this._sortState.sortName;
                p['sortOrder'] = this._sortState.sortOrder;
            }
            this.lookupCmp.httpMgr.getData(p, 'navsearch').subscribe(loadTreeData);
        }));
        tt.columnSorted.subscribe((/**
         * @param {?} sort
         * @return {?}
         */
        (sort) => {
            this.lookupCmp.navigationFilter = null;
            if (tt.loadDataType === 'all') {
                tt.clientSort();
            }
            else {
                const { sortName, sortOrder } = Object.assign({}, sort);
                this._sortState = sort;
                // const param = Object.assign({ sortName, sortOrder }, this._searchState);
                /** @type {?} */
                const param = this.buildParams({ sortName, sortOrder, search: this._searchState });
                /** @type {?} */
                let requestType = 'nav';
                if (this._searchState && this._searchState.value) {
                    requestType = 'navsearch';
                }
                this.lookupCmp.httpMgr.getData(param, requestType).subscribe(loadTreeData);
            }
        }));
        tt.clearSearchValue.subscribe((/**
         * @return {?}
         */
        () => {
            this._searchState = null;
            if (!this._sortState || !this._sortState.sortName) {
                tt.loadData(this.allData);
            }
            else {
                /** @type {?} */
                const p = this.buildParams({});
                if (this._sortState && this._sortState.sortName) {
                    p['sortName'] = this._sortState.sortName;
                    p['sortOrder'] = this._sortState.sortOrder;
                }
                this.lookupCmp.httpMgr.getData(p, 'nav').subscribe(loadTreeData);
            }
        }));
        tt.expand.subscribe((/**
         * @param {?} tn
         * @return {?}
         */
        (tn) => {
            this.onNodeExpanded(tn, tt);
        }));
    }
    /**
     * @private
     * @param {?} tn
     * @param {?} tt
     * @return {?}
     */
    onNodeExpanded(tn, tt) {
        if (tn.leaf) {
            return;
        }
        if (!tn.children || !tn.children.length) {
            /** @type {?} */
            const treeInfo = this.navOptions.treeInfo;
            if (this.navOptions.treeInfo.loadDataType === 'async') {
                /** @type {?} */
                let parentPath = '';
                /** @type {?} */
                let parentLayer = -1;
                const { field = '*', value = '' } = Object.assign({}, tt.searchData);
                tn['showLoading'] = true;
                tt.detectChanges();
                if (treeInfo.layerType === 'parentId') {
                    // 父ID加载方式
                    parentPath = tn['id'];
                }
                else {
                    /** @type {?} */
                    const treeInfoField = treeInfo.dataField;
                    if (treeInfoField) {
                        // parentPath = tn.data[treeInfoField][treeInfo.pathField];
                        // parentLayer = tn.data[treeInfoField][treeInfo.layerField];
                        parentPath = this.lookupCmp.getPathCode(tn.data, treeInfo);
                        parentLayer = this.lookupCmp.getLayerData(tn.data, treeInfo);
                    }
                    else {
                        console.log('未找到分级信息。');
                    }
                }
                if (!this.lookupCmp.uri) {
                    this.lookupCmp.expandTreeNode.emit({
                        instance: tt, node: tn,
                        parentIdOrPath: parentPath, parentLayer, search: { value, field }
                    });
                    return;
                }
                this.getChildren(parentPath, parentLayer, { searchField: field === '*' ? '*' : field, searchValue: value }, tt).pipe(switchMap((/**
                 * @param {?} data
                 * @return {?}
                 */
                (data) => {
                    if (data && data.items && data.items.length) {
                        return of(data);
                    }
                    else {
                        return this.getChildren(parentPath, parentLayer, { searchField: '*', searchValue: '' }, tt);
                    }
                }))).subscribe((/**
                 * @param {?} data
                 * @return {?}
                 */
                data => {
                    if (tt) {
                        if (tn && data.items && data.items.length) {
                            tt.appendChildren(data.items, tn);
                        }
                        tn['showLoading'] = false;
                        tt.detectChanges();
                    }
                }));
            }
        }
    }
    /**
     * @private
     * @param {?} parentPath
     * @param {?} parentLayer
     * @param {?} searchData
     * @param {?} tt
     * @return {?}
     */
    getChildren(parentPath, parentLayer, searchData, tt) {
        /** @type {?} */
        const uri = this.lookupCmp.gridOptions.uri;
        /** @type {?} */
        const search = Object.assign({ parentLayer, category: 'nav' }, searchData);
        if (this.navOptions.treeInfo.layerType === 'parentId') {
            search['parentId'] = parentPath;
        }
        else {
            search['parentPath'] = parentPath;
        }
        /** @type {?} */
        const param = this.buildParams({
            searchValue: JSON.stringify(search),
            customData: this.lookupCmp.customData,
            enableFullTree: false,
            loadTreeDataType: 'layerload',
        });
        if (this.lookupCmp.helpId) {
            param['helpId'] = this.lookupCmp.helpId;
        }
        if (tt && tt.sortName) {
            search['sortName'] = tt.sortName;
            search['sortOrder'] = tt.sortOrder;
            param.searchValue = JSON.stringify(search);
        }
        return this.lookupCmp.http.getData(uri, param);
    }
    /**
     * @return {?}
     */
    loadData() {
        this.cmpRef.instance.allColumnsTitle = this.lookupCmp.allColumnsTitle;
        if (!this.isTreeList()) {
            /** @type {?} */
            const dt = (/** @type {?} */ (this.cmpRef.instance));
            this.initDataTable(dt);
        }
        else {
            /** @type {?} */
            const tt = (/** @type {?} */ (this.cmpRef.instance));
            this.initTreeTable(tt);
        }
    }
}
LookupLeftComponent.decorators = [
    { type: Component, args: [{
                selector: 'lookup-left',
                template: "<div style=\"height: 100%;position: relative;\">\r\n    <ng-container #container></ng-container>\r\n</div>"
            }] }
];
/** @nocollapse */
LookupLeftComponent.ctorParameters = () => [
    { type: ComponentFactoryResolver },
    { type: ChangeDetectorRef }
];
LookupLeftComponent.propDecorators = {
    cmpContainer: [{ type: ViewChild, args: ['container', { read: ViewContainerRef },] }],
    selected: [{ type: Output }],
    unselected: [{ type: Output }],
    search: [{ type: Output }],
    pageChanged: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    LookupLeftComponent.prototype.cmpRef;
    /** @type {?} */
    LookupLeftComponent.prototype.navOptions;
    /** @type {?} */
    LookupLeftComponent.prototype.lookupCmp;
    /** @type {?} */
    LookupLeftComponent.prototype.cmpContainer;
    /** @type {?} */
    LookupLeftComponent.prototype.selected;
    /** @type {?} */
    LookupLeftComponent.prototype.unselected;
    /** @type {?} */
    LookupLeftComponent.prototype.search;
    /** @type {?} */
    LookupLeftComponent.prototype.pageChanged;
    /**
     * @type {?}
     * @private
     */
    LookupLeftComponent.prototype._searchState;
    /**
     * @type {?}
     * @private
     */
    LookupLeftComponent.prototype._sortState;
    /**
     * @type {?}
     * @private
     */
    LookupLeftComponent.prototype.allData;
    /**
     * @type {?}
     * @private
     */
    LookupLeftComponent.prototype.cfr;
    /**
     * @type {?}
     * @private
     */
    LookupLeftComponent.prototype.cd;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9va3VwLWxlZnQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1sb29rdXAvIiwic291cmNlcyI6WyJsaWIvbG9va3VwLWxlZnQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQVNBLE9BQU8sRUFBRSxTQUFTLEVBQVUsU0FBUyxFQUFFLGdCQUFnQixFQUFFLFlBQVksRUFBRSxNQUFNLEVBQ3pFLHdCQUF3QixFQUFnQixpQkFBaUIsRUFDNUQsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFjLEVBQUUsRUFBZ0IsTUFBTSxNQUFNLENBQUM7QUFFcEQsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDMUQsT0FBTyxFQUFZLGtCQUFrQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFJcEUsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBTzNDLE1BQU0sT0FBTyxtQkFBbUI7Ozs7O0lBZ0I1QixZQUFvQixHQUE2QixFQUFVLEVBQXFCO1FBQTVELFFBQUcsR0FBSCxHQUFHLENBQTBCO1FBQVUsT0FBRSxHQUFGLEVBQUUsQ0FBbUI7UUFSdEUsYUFBUSxHQUFHLElBQUksWUFBWSxFQUE0QixDQUFDO1FBQ3hELGVBQVUsR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBQ2hDLFdBQU0sR0FBRyxJQUFJLFlBQVksRUFBb0MsQ0FBQztRQUM5RCxnQkFBVyxHQUFHLElBQUksWUFBWSxFQUErRixDQUFDO1FBRWhJLGlCQUFZLEdBQUcsSUFBSSxDQUFDO1FBQ3BCLGVBQVUsR0FBRyxJQUFJLENBQUM7UUFDbEIsWUFBTyxHQUFHLElBQUksQ0FBQztJQUM2RCxDQUFDOzs7O0lBRXJGLFFBQVE7UUFDSixJQUFJLElBQUksQ0FBQyxTQUFTLElBQUksSUFBSSxDQUFDLFVBQVUsRUFBRSxFQUFFO1lBQ3JDLElBQUksQ0FBQyxTQUFTLENBQUMscUJBQXFCLEdB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NkIiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxyXG4qIEBBdXRob3I6IOeWr+eLguengOaJjShMdWNhcyBIdWFuZylcclxuKiBARGF0ZTogMjAxOC0xMi0xNCAxNDo0MDo0OFxyXG4gKiBATGFzdEVkaXRvcnM6IOeWr+eLguengOaJjShMdWNhcyBIdWFuZylcclxuICogQExhc3RFZGl0VGltZTogMjAxOS0wOS0yNSAxODoxMDoyOVxyXG4qIEBDb21wYW55OiBJbnNwdXJcclxuKiBAVmVyc2lvbjogdjAuMC4xXHJcbiovXHJcblxyXG5pbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgVmlld0NoaWxkLCBWaWV3Q29udGFpbmVyUmVmLCBFdmVudEVtaXR0ZXIsIE91dHB1dCxcclxuICAgIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciwgQ29tcG9uZW50UmVmLCBDaGFuZ2VEZXRlY3RvclJlZiwgSW5qZWN0b3IsIFJlZmxlY3RpdmVJbmplY3RvciwgT25EZXN0cm95XHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IE9ic2VydmFibGUsIG9mLCBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcclxuXHJcbmltcG9ydCB7IERhdGFUYWJsZUNvbXBvbmVudCB9IGZyb20gJ0BmYXJyaXMvdWktZGF0YXRhYmxlJztcclxuaW1wb3J0IHsgVHJlZU5vZGUsIFRyZWVUYWJsZUNvbXBvbmVudCB9IGZyb20gJ0BmYXJyaXMvdWktdHJlZXRhYmxlJztcclxuXHJcbmltcG9ydCB7IExPQURfREFUQV9UWVBFLCBMb29rdXBHcmlkT3B0aW9ucywgTG9va3VwR3JpZFJlc3VsdCB9IGZyb20gJy4vbG9va3VwLWdyaWQtb3B0aW9ucyc7XHJcbmltcG9ydCB7IExvb2t1cEdyaWRDb21wb25lbnQgfSBmcm9tICcuL2xvb2t1cC1ncmlkLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IHN3aXRjaE1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdsb29rdXAtbGVmdCcsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vbG9va3VwLWxlZnQuY29tcG9uZW50Lmh0bWwnXHJcbn0pXHJcblxyXG5leHBvcnQgY2xhc3MgTG9va3VwTGVmdENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95IHtcclxuXHJcbiAgICBjbXBSZWY6IENvbXBvbmVudFJlZjxhbnk+O1xyXG4gICAgbmF2T3B0aW9uczogTG9va3VwR3JpZE9wdGlvbnM7XHJcbiAgICBsb29rdXBDbXA6IExvb2t1cEdyaWRDb21wb25lbnQ7XHJcblxyXG5cclxuICAgIEBWaWV3Q2hpbGQoJ2NvbnRhaW5lcicsIHtyZWFkOiBWaWV3Q29udGFpbmVyUmVmfSkgY21wQ29udGFpbmVyOiBWaWV3Q29udGFpbmVyUmVmO1xyXG4gICAgQE91dHB1dCgpIHNlbGVjdGVkID0gbmV3IEV2ZW50RW1pdHRlcjx7IGRhdGE6IGFueSwgbm9kZT86IGFueX0+KCk7XHJcbiAgICBAT3V0cHV0KCkgdW5zZWxlY3RlZCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIEBPdXRwdXQoKSBzZWFyY2ggPSBuZXcgRXZlbnRFbWl0dGVyPHsgZmllbGQ6IHN0cmluZywgdmFsdWU6IHN0cmluZyB9PigpO1xyXG4gICAgQE91dHB1dCgpIHBhZ2VDaGFuZ2VkID0gbmV3IEV2ZW50RW1pdHRlcjx7IHBhZ2VJbmZvOiB7cGFnZUluZGV4OiBudW1iZXIsIHBhZ2VTaXplOiBudW1iZXJ9LCBzZWFyY2g6IHtmaWVsZDogc3RyaW5nLCB2YWx1ZTogc3RyaW5nfSB9PigpO1xyXG5cclxuICAgIHByaXZhdGUgX3NlYXJjaFN0YXRlID0gbnVsbDtcclxuICAgIHByaXZhdGUgX3NvcnRTdGF0ZSA9IG51bGw7XHJcbiAgICBwcml2YXRlIGFsbERhdGEgPSBudWxsO1xyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBjZnI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciwgcHJpdmF0ZSBjZDogQ2hhbmdlRGV0ZWN0b3JSZWYpIHsgfVxyXG5cclxuICAgIG5nT25Jbml0KCkge1xyXG4gICAgICAgIGlmICh0aGlzLmxvb2t1cENtcCAmJiB0aGlzLmlzVHJlZUxpc3QoKSkge1xyXG4gICAgICAgICAgICB0aGlzLmxvb2t1cENtcC5pbmNsdWRlU3Vib3JkaW5hdGVzJCQgPSB0aGlzLmxvb2t1cENtcC5pbmNsdWRlU3Vib3JkaW5hdGVzJC5zdWJzY3JpYmUoKHZhbDogYm9vbGVhbikgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY21wUmVmKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdHQgPSB0aGlzLmNtcFJlZi5pbnN0YW5jZSBhcyBUcmVlVGFibGVDb21wb25lbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR0LnNlbGVjdGVkUm93KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWQuZW1pdCh7IGRhdGE6IHR0LnNlbGVjdGVkUm93LmRhdGEsIG5vZGU6IHR0LnNlbGVjdGVkUm93IH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG5nT25EZXN0cm95KCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuX3NlYXJjaFN0YXRlID0gbnVsbDtcclxuICAgICAgICB0aGlzLl9zb3J0U3RhdGUgPSBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZUNvbXBvbmVudCgpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgICAgIGxldCBkdEZhYyA9IG51bGw7XHJcbiAgICAgICAgaWYgKCF0aGlzLmlzVHJlZUxpc3QoKSkge1xyXG4gICAgICAgICAgICBkdEZhYyA9IHRoaXMuY2ZyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KERhdGFUYWJsZUNvbXBvbmVudCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgZHRGYWMgPSB0aGlzLmNmci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShUcmVlVGFibGVDb21wb25lbnQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLm5hdk9wdGlvbnNbJ2tlZXBTZWxlY3QnXSA9IGZhbHNlO1xyXG4gICAgICAgIC8vIOW3puS+p+afpeivoui/h+a7pOadoe+8jOmakOiXj+aOie+8m1xyXG4gICAgICAgIHRoaXMubmF2T3B0aW9uc1snc2hvd0ZpbHRlckJhciddID0gdHJ1ZTtcclxuICAgICAgICAvLyBpZiAodGhpcy5uYXZPcHRpb25zLndpZHRoKSB7XHJcbiAgICAgICAgLy8gICAgIHRoaXMubmF2T3B0aW9ucy53aWR0aCA9IHRoaXMubmF2T3B0aW9ucy53aWR0aCAtIDI7XHJcbiAgICAgICAgLy8gfVxyXG5cclxuICAgICAgICB0aGlzLm5hdk9wdGlvbnMud2lkdGggPSB0aGlzLmxvb2t1cENtcC5sZWZ0UGFuZWxXaWR0aCAtIDI7XHJcblxyXG4gICAgICAgIC8vIGNvbnN0IGluamVjdG9yOiBJbmplY3RvciA9IFJlZmxlY3RpdmVJbmplY3Rvci5yZXNvbHZlQW5kQ3JlYXRlKFtcclxuICAgICAgICAvLyAgICAgeyBwcm92aWRlOiBEYXRhVGFibGVTZXJ2aWNlLCB1c2VGYWN0b3J5OiAoKSA9PiB7IG5ldyBEYXRhVGFibGVTZXJ2aWNlKCl9fVxyXG4gICAgICAgIC8vIF0pO1xyXG5cclxuICAgICAgICB0aGlzLmNtcFJlZiA9IHRoaXMuY21wQ29udGFpbmVyLmNyZWF0ZUNvbXBvbmVudChkdEZhYyk7XHJcblxyXG4gICAgICAgIGlmICghdGhpcy5pc1RyZWVMaXN0KCkpIHtcclxuICAgICAgICAgICAgdGhpcy5uYXZPcHRpb25zWydmaWxsJ10gPSB0cnVlO1xyXG4gICAgICAgICAgICB0aGlzLmNtcFJlZi5pbnN0YW5jZS5tYXhTaXplID0gNTtcclxuICAgICAgICAgICAgdGhpcy5jbXBSZWYuaW5zdGFuY2UuZmlsbCA9IHRydWU7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5uYXZPcHRpb25zWydmaXQnXSA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIHRoaXMuY21wUmVmLmluc3RhbmNlLmZpdCA9IHRydWU7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLm5hdk9wdGlvbnMucGFnZUluZm8pIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMubmF2T3B0aW9ucy5wYWdlSW5mby5wYWdlTGlzdCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5uYXZPcHRpb25zLnBhZ2VMaXN0ID0gdGhpcy5uYXZPcHRpb25zLnBhZ2VJbmZvLnBhZ2VMaXN0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMubmF2T3B0aW9ucy5wYWdpbmF0aW9uID0gdGhpcy5uYXZPcHRpb25zLnBhZ2VJbmZvLmVuYWJsZVBhZ2VyO1xyXG4gICAgICAgICAgICB0aGlzLm5hdk9wdGlvbnMucGFnZUluZGV4ID0gdGhpcy5uYXZPcHRpb25zLnBhZ2VJbmZvLnBhZ2VJbmRleDtcclxuICAgICAgICAgICAgdGhpcy5uYXZPcHRpb25zLnBhZ2VTaXplID0gdGhpcy5uYXZPcHRpb25zLnBhZ2VJbmZvLnBhZ2VTaXplO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMubmF2T3B0aW9ucy5wYWdpbmF0aW9uID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBPYmplY3QuYXNzaWduKHRoaXMuY21wUmVmLmluc3RhbmNlLCB0aGlzLm5hdk9wdGlvbnMpO1xyXG5cclxuICAgICAgICB0aGlzLmxvYWREYXRhKCk7XHJcbiAgICAgICAgcmV0dXJuIG9mKHRoaXMuY21wUmVmKTtcclxuICAgIH1cclxuXHJcbiAgICB1cGRhdGUoKSB7XHJcbiAgICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVzaXplKHNpemU/OiB7d2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXJ9KSB7XHJcbiAgICAgICAgaWYgKHNpemUpIHtcclxuICAgICAgICAgICAgc2l6ZS53aWR0aCA9IHNpemUud2lkdGggLSAyO1xyXG4gICAgICAgICAgICAvLyBpZiAodGhpcy5jbXBSZWYuaW5zdGFuY2UgaW5zdGFuY2VvZiBUcmVlVGFibGVDb21wb25lbnQpIHtcclxuICAgICAgICAgICAgLy8gICAgIHNpemUuaGVpZ2h0ICs9IDQ2O1xyXG4gICAgICAgICAgICAvLyB9XHJcbiAgICAgICAgICAgIHRoaXMuY21wUmVmLmluc3RhbmNlLnJlc2l6ZShzaXplKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaXNUcmVlTGlzdCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5uYXZPcHRpb25zLmRpc3BsYXlUeXBlLnRvTG93ZXJDYXNlKCkgPT09ICd0cmVlbGlzdCcgJiYgIXRoaXMubG9va3VwQ21wLm5hdlRyZWVUb0xpc3Q7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzZWxlY3RMZWZ0RGF0YVRhYmxlUm93KGl0ZW1zOiBhbnksIGR0OiBEYXRhVGFibGVDb21wb25lbnQpIHtcclxuICAgICAgICBpZiAoaXRlbXMgJiYgaXRlbXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGxldCBpdGVtID0gbnVsbDtcclxuICAgICAgICAgICAgaWYgKHRoaXMubG9va3VwQ21wLm5hdlNlbGVjdGVkSWRzKSB7XHJcbiAgICAgICAgICAgICAgICBpdGVtID0gaXRlbXMuZmluZChuID0+IG5bZHQuaWRGaWVsZF0gPT0gdGhpcy5sb29rdXBDbXAubmF2U2VsZWN0ZWRJZHMpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubG9va3VwQ21wLnNlbGVjdEZpcnN0SW5OYXYpIHtcclxuICAgICAgICAgICAgICAgICAgICBpdGVtID0gaXRlbXNbMF07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICBkdC5kdEJvZHkuc2VsZWN0ZWRSb3dJbmRleCA9IC0xO1xyXG4gICAgICAgICAgICAgICAgZHQuZHRCb2R5LnNlbGVjdGVkUm93KCcnLCAwLCBpdGVtKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNsb3NlTG9hZGluZygpIHtcclxuICAgICAgICB0aGlzLmxvb2t1cENtcC5jbG9zZUxvYWRpbmcoKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGluaXREYXRhVGFibGUoZHQ6IERhdGFUYWJsZUNvbXBvbmVudCkge1xyXG4gICAgICAgIGR0LmxvYWREYXRhKHtcclxuICAgICAgICAgICAgcGFnZVNpemU6IHRoaXMubmF2T3B0aW9ucy5wYWdlU2l6ZSxcclxuICAgICAgICAgICAgcGFnZUluZGV4OiB0aGlzLm5hdk9wdGlvbnMucGFnZUluZGV4LFxyXG4gICAgICAgICAgICB0b3RhbDogdGhpcy5uYXZPcHRpb25zLnRvdGFsLFxyXG4gICAgICAgICAgICBkYXRhOiB0aGlzLm5hdk9wdGlvbnMuaXRlbXMsXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGR0LnJlc2l6ZSh7IHdpZHRoOiAzMjAsIGhlaWdodDogdGhpcy5uYXZPcHRpb25zLmhlaWdodH0pO1xyXG4gICAgICAgIC8vIOihjOmAieS4rVxyXG4gICAgICAgIGR0LnNlbGVjdGVkUm93LnN1YnNjcmliZShkID0+IHtcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZC5lbWl0KHsgZGF0YTogZC5kYXRhIH0pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBkdC51blNlbGVjdFJvdy5zdWJzY3JpYmUoZCA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWQuZW1pdChudWxsKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgY29uc3QgcCA9IHsgcGFnZUluZm86IHsgcGFnZUluZGV4OiAxLCBwYWdlU2l6ZTogdGhpcy5uYXZPcHRpb25zLnBhZ2VTaXplIH0sIHNlYXJjaDogJycgfTtcclxuXHJcblxyXG4gICAgICAgIGNvbnN0IGxvYWRUYWJsZURhdGEgPSB7XHJcbiAgICAgICAgICAgIG5leHQ6IChkYXRhOiBMb29rdXBHcmlkUmVzdWx0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlTG9hZGluZygpO1xyXG4gICAgICAgICAgICAgICAgZGF0YVRhYmxlUmVMb2FkKGRhdGEpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBlcnJvcjogKGVycikgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZUxvYWRpbmcoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vIOafpeivolxyXG4gICAgICAgIGR0LnNlYXJjaC5zdWJzY3JpYmUoIHNlYXJjaERhdGEgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLl9zZWFyY2hTdGF0ZSA9IHNlYXJjaERhdGE7XHJcbiAgICAgICAgICAgIHRoaXMuc2VhcmNoLmVtaXQoc2VhcmNoRGF0YSk7XHJcbiAgICAgICAgICAgIHAuc2VhcmNoID0gc2VhcmNoRGF0YTtcclxuICAgICAgICAgICAgcC5wYWdlSW5mby5wYWdlU2l6ZSA9IGR0LnBhZ2VTaXplO1xyXG4gICAgICAgICAgICB0aGlzLmxvb2t1cENtcC5uYXZpZ2F0aW9uRmlsdGVyID0gbnVsbDtcclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLl9zb3J0U3RhdGUgJiYgdGhpcy5fc29ydFN0YXRlLnNvcnROYW1lKSB7XHJcbiAgICAgICAgICAgICAgICBwWydzb3J0TmFtZSddID0gdGhpcy5fc29ydFN0YXRlLnNvcnROYW1lO1xyXG4gICAgICAgICAgICAgICAgcFsnc29ydE9yZGVyJ10gPSB0aGlzLl9zb3J0U3RhdGUuc29ydE9yZGVyO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgZGVsZXRlIHBbJ3NvcnROYW1lJ107XHJcbiAgICAgICAgICAgICAgICBkZWxldGUgcFsnc29ydE9yZGVyJ107XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMubG9va3VwQ21wLmh0dHBNZ3IuZ2V0RGF0YShwLCAnbmF2c2VhcmNoJykuc3Vic2NyaWJlKGxvYWRUYWJsZURhdGEpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBjb25zdCBkYXRhVGFibGVSZUxvYWQgPSAoZGF0YSkgPT4ge1xyXG4gICAgICAgICAgICBkdC5sb2FkRGF0YSh7XHJcbiAgICAgICAgICAgICAgICBwYWdlU2l6ZTogZGF0YS5wYWdlSW5mby5wYWdlU2l6ZSxcclxuICAgICAgICAgICAgICAgIHBhZ2VJbmRleDogZGF0YS5wYWdlSW5mby5wYWdlSW5kZXgsXHJcbiAgICAgICAgICAgICAgICB0b3RhbDogZGF0YS50b3RhbCxcclxuICAgICAgICAgICAgICAgIGRhdGE6IGRhdGEuaXRlbXMsXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RMZWZ0RGF0YVRhYmxlUm93KGRhdGEuaXRlbXMsIGR0KTtcclxuICAgICAgICAgICAgZHQuY2QubWFya0ZvckNoZWNrKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLy8g5YiG6aG1XHJcbiAgICAgICAgZHQucGFnZUNoYW5nZWQuc3Vic2NyaWJlKGQgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnBhZ2VDaGFuZ2VkLmVtaXQoZCk7XHJcbiAgICAgICAgICAgIHRoaXMubG9va3VwQ21wLm5hdmlnYXRpb25GaWx0ZXIgPSBudWxsO1xyXG4gICAgICAgICAgICB0aGlzLmxvb2t1cENtcC5odHRwTWdyLmdldERhdGEoZCwgJ25hdnNlYXJjaCcpLnN1YnNjcmliZShsb2FkVGFibGVEYXRhKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgZHQucGFnZVNpemVDaGFuZ2VkLnN1YnNjcmliZSgoZSkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmxvb2t1cENtcC5uYXZpZ2F0aW9uRmlsdGVyID0gbnVsbDtcclxuICAgICAgICAgICAgdGhpcy5sb29rdXBDbXAuaHR0cE1nci5nZXREYXRhKGUsICduYXZzZWFyY2gnKS5zdWJzY3JpYmUobG9hZFRhYmxlRGF0YSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGR0LmNvbHVtblNvcnRlZC5zdWJzY3JpYmUoIChzb3J0OiB7c29ydE5hbWU6IHN0cmluZywgc29ydE9yZGVyOiBhbnl9KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHsgc29ydE5hbWUsIHNvcnRPcmRlciB9ID0gey4uLnNvcnR9O1xyXG4gICAgICAgICAgICB0aGlzLl9zb3J0U3RhdGUgPSBzb3J0O1xyXG4gICAgICAgICAgICB0aGlzLmxvb2t1cENtcC5uYXZpZ2F0aW9uRmlsdGVyID0gbnVsbDtcclxuICAgICAgICAgICAgY29uc3QgcGFyYW0gPSB7IFxyXG4gICAgICAgICAgICAgICAgc29ydE5hbWUsXHJcbiAgICAgICAgICAgICAgICBzb3J0T3JkZXIsXHJcbiAgICAgICAgICAgICAgICBzZWFyY2g6IHRoaXMuX3NlYXJjaFN0YXRlLCAgXHJcbiAgICAgICAgICAgICAgICBwYWdlSW5mbzoge1xyXG4gICAgICAgICAgICAgICAgICAgIHBhZ2VTaXplOiBkdC5wYWdlU2l6ZSxcclxuICAgICAgICAgICAgICAgICAgICBwYWdlSW5kZXg6IDFcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdGhpcy5sb29rdXBDbXAuaHR0cE1nci5nZXREYXRhKHBhcmFtLCAnbmF2c2VhcmNoJykuc3Vic2NyaWJlKGxvYWRUYWJsZURhdGEpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBkdC5jbGVhclNlYXJjaFZhbHVlLnN1YnNjcmliZSggKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLl9zZWFyY2hTdGF0ZSA9IG51bGw7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMuc2VsZWN0TGVmdERhdGFUYWJsZVJvdyh0aGlzLm5hdk9wdGlvbnMuaXRlbXMsIGR0KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGJ1aWxkUGFyYW1zKHBhcmFtczoge30pOiB7W2tleTogc3RyaW5nXTphbnl9IHtcclxuICAgICAgICByZXR1cm4geyAuLi5wYXJhbXMsIHRyZWVUb0xpc3Q6IHRoaXMubG9va3VwQ21wLnRyZWVUb0xpc3QsIG5hdlRyZWVUb0xpc3Q6IHRoaXMubG9va3VwQ21wLm5hdlRyZWVUb0xpc3R9O1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgaW5pdFRyZWVUYWJsZSh0dDogVHJlZVRhYmxlQ29tcG9uZW50KSB7XHJcbiAgICAgICAgdHQudmlydHVhbGl6ZWQgPSB0cnVlO1xyXG4gICAgICAgIHR0LmZhc3QgPSB0cnVlO1xyXG4gICAgICAgIHR0Lm5vZGVTZWxlY3RlZC5zdWJzY3JpYmUoZCA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWQuZW1pdCh7ZGF0YTogZC5ub2RlLmRhdGEsIG5vZGU6IGQubm9kZX0pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0dC5ub2RlVW5TZWxlY3Quc3Vic2NyaWJlKGQgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkLmVtaXQobnVsbCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHR0LmZpeGVkSGVhZGVyID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgLy8gdHQuZml0ID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLmxvb2t1cENtcC50cmVlTm9kZUhlbHBlci51cGRhdGVUcmVlTm9kZUV4cGFuZGVkKHRoaXMubmF2T3B0aW9ucy5pdGVtcywgdGhpcy5uYXZPcHRpb25zLnRyZWVJbmZvKTtcclxuXHJcbiAgICAgICAgdHQubG9hZERhdGFUeXBlID0gdGhpcy5uYXZPcHRpb25zLnRyZWVJbmZvLmxvYWREYXRhVHlwZTtcclxuICAgICAgICAvLyDmo4Dmn6XlrozmlbTmoJHov4fmu6TmnaHku7YgQnkgTHVjYXMgMjAyMDAzMDJcclxuICAgICAgICB0aGlzLm5hdk9wdGlvbnMuaXRlbXMgPSB0aGlzLmxvb2t1cENtcC5jaGVja05vZGVDYW5CZVNlbGVjdCh0aGlzLm5hdk9wdGlvbnMuaXRlbXMsIHRoaXMubmF2T3B0aW9ucy50cmVlSW5mby5sb2FkRGF0YVR5cGUgPT09ICdhbGwnKTtcclxuICAgICAgICB0dC5sb2FkRGF0YSh0aGlzLm5hdk9wdGlvbnMuaXRlbXMpO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5sb29rdXBDbXAubmF2U2VsZWN0ZWRJZHMpIHtcclxuICAgICAgICAgICAgdHQuc2VsZWN0Tm9kZSh0aGlzLmxvb2t1cENtcC5uYXZTZWxlY3RlZElkcyk7XHJcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmxvb2t1cENtcC5zZWxlY3RGaXJzdEluTmF2KSB7XHJcbiAgICAgICAgICAgIHR0LnNlbGVjdEZpcnN0Tm9kZSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5hbGxEYXRhID0gdGhpcy5uYXZPcHRpb25zLml0ZW1zO1xyXG5cclxuICAgICAgICBjb25zdCBsb2FkVHJlZURhdGEgPSB7XHJcbiAgICAgICAgICAgIG5leHQ6IChyZXNEYXRhOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VMb2FkaW5nKCk7XHJcbiAgICAgICAgICAgICAgICB0dC5jbGVhckFsbCgpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaXRlbXMgPSB0aGlzLmxvb2t1cENtcC5jaGVja05vZGVDYW5CZVNlbGVjdChyZXNEYXRhLml0ZW1zLCB0aGlzLm5hdk9wdGlvbnMudHJlZUluZm8ubG9hZERhdGFUeXBlID09PSAnYWxsJyAmJiAoIXRoaXMuX3NlYXJjaFN0YXRlIHx8ICF0aGlzLl9zZWFyY2hTdGF0ZS52YWx1ZSkpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChpdGVtcyAmJiBpdGVtcy5sZW5ndGggJiYgaXRlbXNbMF0uY2hpbGRyZW4gJiYgaXRlbXNbMF0uY2hpbGRyZW4ubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbXNbMF0uZXhwYW5kZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zWzBdLmNoaWxkcmVuID0gdGhpcy5sb29rdXBDbXAuZXhwYW5kRmlyc3ROb2RlKGl0ZW1zWzBdLmNoaWxkcmVuKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB0dC5sb2FkRGF0YShpdGVtcyk7XHJcbiAgICAgICAgICAgICAgICB0dC5yZXNpemUoKTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgZXJyb3I6IChlcnIpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VMb2FkaW5nKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuXHJcbiAgICAgICAgdHQuc2VhcmNoLnN1YnNjcmliZShzZWFyY2ggPT4ge1xyXG4gICAgICAgICAgICB0aGlzLl9zZWFyY2hTdGF0ZSA9IHNlYXJjaDtcclxuICAgICAgICAgICAgdGhpcy5sb29rdXBDbXAubmF2aWdhdGlvbkZpbHRlciA9IG51bGw7XHJcbiAgICAgICAgICAgIGNvbnN0IHAgPSB0aGlzLmJ1aWxkUGFyYW1zKHsgc2VhcmNoIH0pO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5fc29ydFN0YXRlICYmIHRoaXMuX3NvcnRTdGF0ZS5zb3J0TmFtZSkge1xyXG4gICAgICAgICAgICAgICAgcFsnc29ydE5hbWUnXSA9IHRoaXMuX3NvcnRTdGF0ZS5zb3J0TmFtZTtcclxuICAgICAgICAgICAgICAgIHBbJ3NvcnRPcmRlciddID0gdGhpcy5fc29ydFN0YXRlLnNvcnRPcmRlcjtcclxuICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgIHRoaXMubG9va3VwQ21wLmh0dHBNZ3IuZ2V0RGF0YShwLCAnbmF2c2VhcmNoJykuc3Vic2NyaWJlKGxvYWRUcmVlRGF0YSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHR0LmNvbHVtblNvcnRlZC5zdWJzY3JpYmUoIChzb3J0OiB7c29ydE5hbWU6IHN0cmluZywgc29ydE9yZGVyOiBhbnl9KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMubG9va3VwQ21wLm5hdmlnYXRpb25GaWx0ZXIgPSBudWxsO1xyXG4gICAgICAgICAgICBpZiAodHQubG9hZERhdGFUeXBlID09PSAnYWxsJykge1xyXG4gICAgICAgICAgICAgICAgdHQuY2xpZW50U29ydCgpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgeyBzb3J0TmFtZSwgc29ydE9yZGVyIH0gPSB7Li4uc29ydH07XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9zb3J0U3RhdGUgPSBzb3J0O1xyXG4gICAgICAgICAgICAgICAgLy8gY29uc3QgcGFyYW0gPSBPYmplY3QuYXNzaWduKHsgc29ydE5hbWUsIHNvcnRPcmRlciB9LCB0aGlzLl9zZWFyY2hTdGF0ZSk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBwYXJhbSA9IHRoaXMuYnVpbGRQYXJhbXMoeyBzb3J0TmFtZSwgc29ydE9yZGVyLCBzZWFyY2g6IHRoaXMuX3NlYXJjaFN0YXRlIH0pO1xyXG4gICAgICAgICAgICAgICAgbGV0IHJlcXVlc3RUeXBlOiBMT0FEX0RBVEFfVFlQRSA9ICduYXYnO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX3NlYXJjaFN0YXRlICYmIHRoaXMuX3NlYXJjaFN0YXRlLnZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdFR5cGUgPSAnbmF2c2VhcmNoJztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRoaXMubG9va3VwQ21wLmh0dHBNZ3IuZ2V0RGF0YShwYXJhbSwgcmVxdWVzdFR5cGUpLnN1YnNjcmliZShsb2FkVHJlZURhdGEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHR0LmNsZWFyU2VhcmNoVmFsdWUuc3Vic2NyaWJlKCAoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuX3NlYXJjaFN0YXRlID0gbnVsbDtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLl9zb3J0U3RhdGUgfHwgIXRoaXMuX3NvcnRTdGF0ZS5zb3J0TmFtZSkge1xyXG4gICAgICAgICAgICAgICAgdHQubG9hZERhdGEodGhpcy5hbGxEYXRhKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHAgPSB0aGlzLmJ1aWxkUGFyYW1zKHt9KTtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9zb3J0U3RhdGUgJiYgdGhpcy5fc29ydFN0YXRlLnNvcnROYW1lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcFsnc29ydE5hbWUnXSA9IHRoaXMuX3NvcnRTdGF0ZS5zb3J0TmFtZTtcclxuICAgICAgICAgICAgICAgICAgICBwWydzb3J0T3JkZXInXSA9IHRoaXMuX3NvcnRTdGF0ZS5zb3J0T3JkZXI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLmxvb2t1cENtcC5odHRwTWdyLmdldERhdGEocCwgJ25hdicpLnN1YnNjcmliZShsb2FkVHJlZURhdGEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG5cclxuICAgICAgICB0dC5leHBhbmQuc3Vic2NyaWJlKCh0bjogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMub25Ob2RlRXhwYW5kZWQodG4sIHR0KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgcHJpdmF0ZSBvbk5vZGVFeHBhbmRlZCh0bjogYW55LCB0dCkge1xyXG4gICAgICAgIGlmICh0bi5sZWFmKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCF0bi5jaGlsZHJlbiB8fCAhdG4uY2hpbGRyZW4ubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRyZWVJbmZvID0gdGhpcy5uYXZPcHRpb25zLnRyZWVJbmZvO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5uYXZPcHRpb25zLnRyZWVJbmZvLmxvYWREYXRhVHlwZSA9PT0gJ2FzeW5jJykge1xyXG4gICAgICAgICAgICAgICAgbGV0IHBhcmVudFBhdGggPSAnJztcclxuICAgICAgICAgICAgICAgIGxldCBwYXJlbnRMYXllciA9IC0xO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgeyBmaWVsZCA9ICcqJywgdmFsdWUgPSAnJyB9ID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIC4uLnR0LnNlYXJjaERhdGFcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgdG5bJ3Nob3dMb2FkaW5nJ10gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdHQuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRyZWVJbmZvLmxheWVyVHlwZSA9PT0gJ3BhcmVudElkJykge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIOeItklE5Yqg6L295pa55byPXHJcbiAgICAgICAgICAgICAgICAgICAgcGFyZW50UGF0aCA9IHRuWydpZCddO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCB0cmVlSW5mb0ZpZWxkID0gdHJlZUluZm8uZGF0YUZpZWxkO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0cmVlSW5mb0ZpZWxkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHBhcmVudFBhdGggPSB0bi5kYXRhW3RyZWVJbmZvRmllbGRdW3RyZWVJbmZvLnBhdGhGaWVsZF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHBhcmVudExheWVyID0gdG4uZGF0YVt0cmVlSW5mb0ZpZWxkXVt0cmVlSW5mby5sYXllckZpZWxkXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50UGF0aCA9IHRoaXMubG9va3VwQ21wLmdldFBhdGhDb2RlKHRuLmRhdGEsIHRyZWVJbmZvKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50TGF5ZXI9IHRoaXMubG9va3VwQ21wLmdldExheWVyRGF0YSh0bi5kYXRhLCB0cmVlSW5mbyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ+acquaJvuWIsOWIhue6p+S/oeaBr+OAgicpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMubG9va3VwQ21wLnVyaSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9va3VwQ21wLmV4cGFuZFRyZWVOb2RlLmVtaXQoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZTogdHQsIG5vZGU6IHRuLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRJZE9yUGF0aDogcGFyZW50UGF0aCwgcGFyZW50TGF5ZXIsIHNlYXJjaDogeyB2YWx1ZSwgZmllbGQgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLmdldENoaWxkcmVuKFxyXG4gICAgICAgICAgICAgICAgICAgIHBhcmVudFBhdGgsIHBhcmVudExheWVyLCB7c2VhcmNoRmllbGQ6IGZpZWxkID09PSAnKicgPyAnKicgOiBmaWVsZCwgc2VhcmNoVmFsdWU6IHZhbHVlfSwgdHRcclxuICAgICAgICAgICAgICAgICkucGlwZShcclxuICAgICAgICAgICAgICAgICAgICBzd2l0Y2hNYXAoKGRhdGE6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YSAmJiBkYXRhLml0ZW1zICYmIGRhdGEuaXRlbXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2YoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRDaGlsZHJlbihwYXJlbnRQYXRoLCBwYXJlbnRMYXllciwgeyBzZWFyY2hGaWVsZDogJyonLCBzZWFyY2hWYWx1ZTogJycgIH0sIHR0KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICkuc3Vic2NyaWJlKGRhdGEgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0dCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodG4gJiYgZGF0YS5pdGVtcyAmJiBkYXRhLml0ZW1zLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHQuYXBwZW5kQ2hpbGRyZW4oZGF0YS5pdGVtcywgdG4pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRuWydzaG93TG9hZGluZyddID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHR0LmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldENoaWxkcmVuKCBwYXJlbnRQYXRoLCBwYXJlbnRMYXllciwgc2VhcmNoRGF0YTogeyBzZWFyY2hGaWVsZDogc3RyaW5nOyBzZWFyY2hWYWx1ZTogc3RyaW5nIH0sIHR0ICk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICAgICAgY29uc3QgdXJpID0gdGhpcy5sb29rdXBDbXAuZ3JpZE9wdGlvbnMudXJpO1xyXG4gICAgICAgIGNvbnN0IHNlYXJjaCA9IHsgcGFyZW50TGF5ZXIsIGNhdGVnb3J5OiAnbmF2JywgLi4uc2VhcmNoRGF0YSB9O1xyXG4gICAgICAgIGlmICh0aGlzLm5hdk9wdGlvbnMudHJlZUluZm8ubGF5ZXJUeXBlID09PSAncGFyZW50SWQnKSB7XHJcbiAgICAgICAgICAgIHNlYXJjaFsncGFyZW50SWQnXSA9IHBhcmVudFBhdGg7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgc2VhcmNoWydwYXJlbnRQYXRoJ10gPSBwYXJlbnRQYXRoO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgcGFyYW06IGFueSA9IHRoaXMuYnVpbGRQYXJhbXMoe1xyXG4gICAgICAgICAgICBzZWFyY2hWYWx1ZTogSlNPTi5zdHJpbmdpZnkoc2VhcmNoKSxcclxuICAgICAgICAgICAgY3VzdG9tRGF0YTogdGhpcy5sb29rdXBDbXAuY3VzdG9tRGF0YSxcclxuICAgICAgICAgICAgZW5hYmxlRnVsbFRyZWU6IGZhbHNlLFxyXG4gICAgICAgICAgICBsb2FkVHJlZURhdGFUeXBlOiAnbGF5ZXJsb2FkJyxcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMubG9va3VwQ21wLmhlbHBJZCkge1xyXG4gICAgICAgICAgICBwYXJhbVsnaGVscElkJ10gPSB0aGlzLmxvb2t1cENtcC5oZWxwSWQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodHQgJiYgdHQuc29ydE5hbWUpIHtcclxuICAgICAgICAgICAgc2VhcmNoWydzb3J0TmFtZSddID0gdHQuc29ydE5hbWU7XHJcbiAgICAgICAgICAgIHNlYXJjaFsnc29ydE9yZGVyJ10gPSB0dC5zb3J0T3JkZXI7XHJcbiAgICAgICAgICAgIHBhcmFtLnNlYXJjaFZhbHVlID0gSlNPTi5zdHJpbmdpZnkoc2VhcmNoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLmxvb2t1cENtcC5odHRwLmdldERhdGEodXJpICwgcGFyYW0pO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBsb2FkRGF0YSgpIHtcclxuICAgICAgICB0aGlzLmNtcFJlZi5pbnN0YW5jZS5hbGxDb2x1bW5zVGl0bGUgPSB0aGlzLmxvb2t1cENtcC5hbGxDb2x1bW5zVGl0bGU7XHJcbiAgICAgICAgaWYgKCF0aGlzLmlzVHJlZUxpc3QoKSkge1xyXG4gICAgICAgICAgICBjb25zdCBkdCA9IHRoaXMuY21wUmVmLmluc3RhbmNlIGFzIERhdGFUYWJsZUNvbXBvbmVudDtcclxuICAgICAgICAgICAgdGhpcy5pbml0RGF0YVRhYmxlKGR0KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zdCB0dCA9IHRoaXMuY21wUmVmLmluc3RhbmNlIGFzIFRyZWVUYWJsZUNvbXBvbmVudDtcclxuICAgICAgICAgICAgdGhpcy5pbml0VHJlZVRhYmxlKHR0KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIl19