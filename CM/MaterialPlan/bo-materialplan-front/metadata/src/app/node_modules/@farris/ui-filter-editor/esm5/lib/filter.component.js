/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { LocaleService } from "@farris/ui-locale";
/*
 * @Author: 疯狂秀才(Lucas Huang)
 * @Date: 2018-12-04 10:43:42
 * @LastEditors: 疯狂秀才(Lucas Huang)
 * @LastEditTime: 2019-10-17 17:34:39
 * @Company: Inspur
 * @Version: v0.0.1
 */
import { Component, Input, EventEmitter, Output, Injector, ElementRef, ComponentFactoryResolver, TemplateRef, ViewChild, forwardRef, HostListener, HostBinding, ChangeDetectorRef, } from "@angular/core";
import { NG_VALUE_ACCESSOR } from "@angular/forms";
import { cloneDeep } from "lodash-es";
import { BsModalService } from "@farris/ui-modal";
import { LookupComponent } from "@farris/ui-lookup";
import { Compare, } from "@farris/ui-common/types";
import { FilterService } from "./services/filter.service";
import { FilterEditorComponent } from "./components/filter-editor.component";
import { CommonUtils } from "@farris/ui-common";
import { NotifyService } from "@farris/ui-notify";
/** @type {?} */
export var FILTER_LOOKUPGRID_VALUE_ACCESSOR = {
    provide: NG_VALUE_ACCESSOR,
    useExisting: forwardRef((/**
     * @return {?}
     */
    function () { return FilterComponent; })),
    multi: true,
};
/**
 * @record
 */
export function FILTER_FIELD_EDITOR() { }
if (false) {
    /** @type {?} */
    FILTER_FIELD_EDITOR.prototype.type;
    /** @type {?|undefined} */
    FILTER_FIELD_EDITOR.prototype.options;
}
var FilterComponent = /** @class */ (function (_super) {
    tslib_1.__extends(FilterComponent, _super);
    function FilterComponent(injector, cfr, modalService, el, filterService) {
        var _this = _super.call(this, injector, el) || this;
        _this.cfr = cfr;
        _this.modalService = modalService;
        _this.el = el;
        _this.filterService = filterService;
        _this.hostCls = "f-cmp-inputgroup";
        _this.text = "";
        _this.conditions = [];
        _this.originalData = [];
        /**
         * 字段数据
         */
        _this.columns = [];
        _this.showCode = false;
        _this.showSql = false;
        _this.enableExpress = false;
        _this.fieldEditor = { type: "select", options: {} };
        _this.enableClear = true;
        _this.returnType = "object";
        _this.insertType = "below";
        _this.openDialog = new EventEmitter();
        _this.showExpress = new EventEmitter();
        _this.showClearButton = false;
        _this.cd = null;
        _this.commonUtils = null;
        _this.notifySer = null;
        _this.filterService.conditionsChanged.subscribe((/**
         * @param {?} conditionList
         * @return {?}
         */
        function (conditionList) {
            _this.conditions = conditionList;
        }));
        _this.notifySer = _this.injector.get(NotifyService, null);
        _this.localeService = _this.injector.get(LocaleService);
        _this.cd = _this.injector.get(ChangeDetectorRef);
        _this.commonUtils =
            _this.injector.get(CommonUtils, null) || new CommonUtils();
        return _this;
    }
    /**
     * @return {?}
     */
    FilterComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () { };
    /**
     * @param {?} event
     * @return {?}
     */
    FilterComponent.prototype.onmouseover = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        this.showClearButton = true;
    };
    /**
     * @param {?} event
     * @return {?}
     */
    FilterComponent.prototype.onmouseleave = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        this.showClearButton = false;
    };
    /**
     * @return {?}
     */
    FilterComponent.prototype.showDialog = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (!this.disabled) {
            if (this.fieldEditor && this.fieldEditor.type === "combo-tree") {
                this.fieldEditor.options = this.fieldEditor.options || {};
                if (this.fieldEditor.options.autoWidth === undefined) {
                    this.fieldEditor.options.autoWidth = true;
                }
                if (!this.fieldEditor.options.columns) {
                    this.fieldEditor.options.columns = [
                        { field: "label", title: "label", width: 100 },
                    ];
                }
                if (!this.fieldEditor.options.textField) {
                    this.fieldEditor.options.textField = "label";
                }
                if (!this.fieldEditor.options.idField) {
                    this.fieldEditor.options.idField = "value";
                }
            }
            /** @type {?} */
            var filterEditorFactory = this.cfr.resolveComponentFactory(FilterEditorComponent);
            this.filterEditorRef = filterEditorFactory.create(this.injector);
            this.filterEditorRef.instance.columns = this.columns;
            this.filterEditorRef.instance.conditions = this.conditions;
            this.originalData = cloneDeep(this.conditions);
            this.dlgRef = this.modalService.show(this.filterEditorRef, {
                width: 800,
                height: 500,
                title: this.localeService.getValue("filterEditor.title"),
                enableScroll: false,
                minHeight: 398,
                minWidth: 798,
                iconCls: "f-icon f-icon-filter",
                buttons: this.btnRef,
                // dialogFooterStyles: { background: '#F4F6F9' },
                buttonAlign: "right",
                initialState: {
                    showCode: this.showCode,
                    showSql: this.showSql,
                    enableExpress: this.enableExpress,
                    fieldEditor: this.fieldEditor,
                    insertType: this.insertType,
                },
                closed: (/**
                 * @param {?} isCloseButtonClick
                 * @return {?}
                 */
                function (isCloseButtonClick) {
                    if (isCloseButtonClick) {
                        _this.cancel();
                    }
                }),
            });
            this.filterEditorRef.instance.height =
                this.dlgRef.dialog.instance.getContainerSize().height;
            this.filterEditorRef.instance.showExpress.subscribe((/**
             * @param {?} $event
             * @return {?}
             */
            function ($event) {
                _this.showExpress.emit($event);
            }));
            this.dlgRef.dialog.instance.resized.subscribe((/**
             * @param {?} size
             * @return {?}
             */
            function (size) {
                _this.filterEditorRef.instance.height = size.containerHeight;
            }));
            this.filterEditorRef.changeDetectorRef.detectChanges();
            this.dlgRef.dialog.changeDetectorRef.reattach();
            this.openDialog.emit();
        }
    };
    /**
     * @param {?} val
     * @return {?}
     */
    FilterComponent.prototype.writeValue = /**
     * @param {?} val
     * @return {?}
     */
    function (val) {
        if (val) {
            if (typeof val === "string") {
                val = JSON.parse(val);
            }
            this.conditions = val || [];
            this.text = this.commonUtils.buildSqlWhere(this.conditions);
        }
    };
    /**
     * @private
     * @return {?}
     */
    FilterComponent.prototype.checkSymbol = /**
     * @private
     * @return {?}
     */
    function () {
        return this.filterService.isValid(this.conditions, this.localeService);
    };
    /**
     * @return {?}
     */
    FilterComponent.prototype.save = /**
     * @return {?}
     */
    function () {
        if (this.conditions.length) {
            /** @type {?} */
            var checkResult = this.checkSymbol();
            if (typeof checkResult === "object") {
                var bracket = checkResult.bracket, relation = checkResult.relation, field = checkResult.field;
                if (!bracket.result || !relation.result || !field.result) {
                    /** @type {?} */
                    var msg = "";
                    if (!bracket.result) {
                        msg = bracket.msg;
                    }
                    else if (!relation.result) {
                        msg = relation.msg;
                    }
                    else if (!field.result) {
                        msg = field.msg;
                    }
                    if (msg) {
                        if (this.notifySer) {
                            this.notifySer.warning(msg);
                        }
                        else {
                            alert(msg);
                        }
                        return;
                    }
                }
            }
            this.conditions = this.conditions.filter((/**
             * @param {?} c
             * @return {?}
             */
            function (c) { return c.filterField; }));
            // 转换in 操作符的value 值
            this.conditions = this.conditions.map((/**
             * @param {?} con
             * @return {?}
             */
            function (con) {
                /** @type {?} */
                var cp = parseInt("" + con.compare, 10);
                if (cp === Compare.In || cp === Compare.NotIn) {
                    con.value = con.value.replace(/,/g, "\r\n");
                }
                return con;
            }));
            this.text = this.commonUtils.buildSqlWhere(this.conditions);
        }
        else {
            this.text = "";
        }
        if (this.cd) {
            this.cd.detectChanges();
        }
        this.closeDialog();
    };
    /**
     * @return {?}
     */
    FilterComponent.prototype.cancel = /**
     * @return {?}
     */
    function () {
        this.conditions = this.originalData;
        this.closeDialog();
    };
    /**
     * @return {?}
     */
    FilterComponent.prototype.closeDialog = /**
     * @return {?}
     */
    function () {
        this.updateModel();
        this.filterEditorRef = null;
        this.dlgRef.close();
    };
    /**
     * @return {?}
     */
    FilterComponent.prototype.clear = /**
     * @return {?}
     */
    function () {
        this.text = "";
        this.conditions = [];
        this.updateModel();
    };
    /**
     * @private
     * @return {?}
     */
    FilterComponent.prototype.updateModel = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var v = this.conditions;
        if (this.returnType === "string") {
            v = JSON.stringify(this.conditions);
        }
        this.onModelChange(v);
        this.onModelTouched(v);
    };
    FilterComponent.decorators = [
        { type: Component, args: [{
                    selector: "filter,filter-textbox",
                    template: "<div class=\"input-group\">\r\n    <input #txtbox\r\n        class=\"form-control\" \r\n        [value]=\"text\"\r\n        [readonly]=\"!editable || readonly\"\r\n        [class.f-state-disabled] = \"disabled\"\r\n        [class.f-state-readonly] = \"readonly\"\r\n        [class.f-state-editable] = \"!editable\"\r\n        [disabled]=\"disabled\"/>\r\n    <div class=\"input-group-append\" *ngIf=\"!readonly && !disabled\">\r\n        <span *ngIf=\"showClearButton && enableClear\" class=\"input-group-text input-group-clear\" (click)=\"clear()\">\r\n            <i class=\"f-icon modal_close\"></i>\r\n        </span>\r\n        <span class=\"f-select input-group-text\"  (click)=\"showDialog()\">\r\n            <i class=\"f-icon f-icon-lookup\"></i>\r\n        </span>\r\n    </div>\r\n</div>\r\n\r\n<ng-template #defaultButtonRef>\r\n    <button class=\"btn btn-outline-secondary\" (click)=\"cancel()\"> {{ 'filterEditor.cancelButton'|locale }} </button>&nbsp;\r\n    <button class=\"btn btn-primary\" (click)=\"save()\"> {{ 'filterEditor.okButton'| locale }} </button>\r\n</ng-template>",
                    providers: [FILTER_LOOKUPGRID_VALUE_ACCESSOR, FilterService],
                    styles: ["\n            .lookup-clear {\n                cursor: pointer;\n                background: #fff !important;\n            }\n            .lookup-clear:hover {\n                background: #e9ecef !important;\n            }\n        "]
                }] }
    ];
    /** @nocollapse */
    FilterComponent.ctorParameters = function () { return [
        { type: Injector },
        { type: ComponentFactoryResolver },
        { type: BsModalService },
        { type: ElementRef },
        { type: FilterService }
    ]; };
    FilterComponent.propDecorators = {
        hostCls: [{ type: HostBinding, args: ["class",] }],
        columns: [{ type: Input }],
        showCode: [{ type: Input }],
        showSql: [{ type: Input }],
        enableExpress: [{ type: Input }],
        fieldEditor: [{ type: Input }],
        enableClear: [{ type: Input }],
        returnType: [{ type: Input }],
        insertType: [{ type: Input }],
        openDialog: [{ type: Output }],
        showExpress: [{ type: Output }],
        btnRef: [{ type: ViewChild, args: ["defaultButtonRef",] }],
        textbox: [{ type: ViewChild, args: ["txtbox",] }],
        onmouseover: [{ type: HostListener, args: ["mouseover", ["$event"],] }],
        onmouseleave: [{ type: HostListener, args: ["mouseleave", ["$event"],] }]
    };
    return FilterComponent;
}(LookupComponent));
export { FilterComponent };
if (false) {
    /** @type {?} */
    FilterComponent.prototype.hostCls;
    /** @type {?} */
    FilterComponent.prototype.text;
    /** @type {?} */
    FilterComponent.prototype.conditions;
    /** @type {?} */
    FilterComponent.prototype.originalData;
    /**
     * 字段数据
     * @type {?}
     */
    FilterComponent.prototype.columns;
    /** @type {?} */
    FilterComponent.prototype.showCode;
    /** @type {?} */
    FilterComponent.prototype.showSql;
    /** @type {?} */
    FilterComponent.prototype.enableExpress;
    /** @type {?} */
    FilterComponent.prototype.fieldEditor;
    /** @type {?} */
    FilterComponent.prototype.enableClear;
    /** @type {?} */
    FilterComponent.prototype.returnType;
    /** @type {?} */
    FilterComponent.prototype.insertType;
    /** @type {?} */
    FilterComponent.prototype.openDialog;
    /** @type {?} */
    FilterComponent.prototype.showExpress;
    /** @type {?} */
    FilterComponent.prototype.btnRef;
    /** @type {?} */
    FilterComponent.prototype.textbox;
    /** @type {?} */
    FilterComponent.prototype.showClearButton;
    /** @type {?} */
    FilterComponent.prototype.cd;
    /** @type {?} */
    FilterComponent.prototype.dlgRef;
    /** @type {?} */
    FilterComponent.prototype.filterEditorRef;
    /** @type {?} */
    FilterComponent.prototype.localeService;
    /** @type {?} */
    FilterComponent.prototype.commonUtils;
    /** @type {?} */
    FilterComponent.prototype.notifySer;
    /**
     * @type {?}
     * @private
     */
    FilterComponent.prototype.cfr;
    /**
     * @type {?}
     * @private
     */
    FilterComponent.prototype.modalService;
    /** @type {?} */
    FilterComponent.prototype.el;
    /**
     * @type {?}
     * @private
     */
    FilterComponent.prototype.filterService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsdGVyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktZmlsdGVyLWVkaXRvci8iLCJzb3VyY2VzIjpbImxpYi9maWx0ZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG1CQUFtQixDQUFDOzs7Ozs7Ozs7QUFTbEQsT0FBTyxFQUNILFNBQVMsRUFDVCxLQUFLLEVBQ0wsWUFBWSxFQUNaLE1BQU0sRUFDTixRQUFRLEVBQ1IsVUFBVSxFQUNWLHdCQUF3QixFQUN4QixXQUFXLEVBQ1gsU0FBUyxFQUVULFVBQVUsRUFFVixZQUFZLEVBQ1osV0FBVyxFQUNYLGlCQUFpQixHQUNwQixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNuRCxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBQ3RDLE9BQU8sRUFBYyxjQUFjLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUM5RCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDcEQsT0FBTyxFQUVILE9BQU8sR0FFVixNQUFNLHlCQUF5QixDQUFDO0FBRWpDLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUMxRCxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSxzQ0FBc0MsQ0FBQztBQUM3RSxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDaEQsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG1CQUFtQixDQUFDOztBQUVsRCxNQUFNLEtBQU8sZ0NBQWdDLEdBQVE7SUFDakQsT0FBTyxFQUFFLGlCQUFpQjtJQUMxQixXQUFXLEVBQUUsVUFBVTs7O0lBQUMsY0FBTSxPQUFBLGVBQWUsRUFBZixDQUFlLEVBQUM7SUFDOUMsS0FBSyxFQUFFLElBQUk7Q0FDZDs7OztB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Y2UgfSBmcm9tIFwiQGZhcnJpcy91aS1sb2NhbGVcIjtcclxuLypcclxuICogQEF1dGhvcjog55av54uC56eA5omNKEx1Y2FzIEh1YW5nKVxyXG4gKiBARGF0ZTogMjAxOC0xMi0wNCAxMDo0Mzo0MlxyXG4gKiBATGFzdEVkaXRvcnM6IOeWr+eLguengOaJjShMdWNhcyBIdWFuZylcclxuICogQExhc3RFZGl0VGltZTogMjAxOS0xMC0xNyAxNzozNDozOVxyXG4gKiBAQ29tcGFueTogSW5zcHVyXHJcbiAqIEBWZXJzaW9uOiB2MC4wLjFcclxuICovXHJcbmltcG9ydCB7XHJcbiAgICBDb21wb25lbnQsXHJcbiAgICBJbnB1dCxcclxuICAgIEV2ZW50RW1pdHRlcixcclxuICAgIE91dHB1dCxcclxuICAgIEluamVjdG9yLFxyXG4gICAgRWxlbWVudFJlZixcclxuICAgIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcclxuICAgIFRlbXBsYXRlUmVmLFxyXG4gICAgVmlld0NoaWxkLFxyXG4gICAgQ29tcG9uZW50UmVmLFxyXG4gICAgZm9yd2FyZFJlZixcclxuICAgIE9uSW5pdCxcclxuICAgIEhvc3RMaXN0ZW5lcixcclxuICAgIEhvc3RCaW5kaW5nLFxyXG4gICAgQ2hhbmdlRGV0ZWN0b3JSZWYsXHJcbn0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcclxuaW1wb3J0IHsgTkdfVkFMVUVfQUNDRVNTT1IgfSBmcm9tIFwiQGFuZ3VsYXIvZm9ybXNcIjtcclxuaW1wb3J0IHsgY2xvbmVEZWVwIH0gZnJvbSBcImxvZGFzaC1lc1wiO1xyXG5pbXBvcnQgeyBCc01vZGFsUmVmLCBCc01vZGFsU2VydmljZSB9IGZyb20gXCJAZmFycmlzL3VpLW1vZGFsXCI7XHJcbmltcG9ydCB7IExvb2t1cENvbXBvbmVudCB9IGZyb20gXCJAZmFycmlzL3VpLWxvb2t1cFwiO1xyXG5pbXBvcnQge1xyXG4gICAgRmlsdGVyQ29uZGl0aW9uLFxyXG4gICAgQ29tcGFyZSxcclxuICAgIEZpbHRlclJlbGF0aW9uLFxyXG59IGZyb20gXCJAZmFycmlzL3VpLWNvbW1vbi90eXBlc1wiO1xyXG5cclxuaW1wb3J0IHsgRmlsdGVyU2VydmljZSB9IGZyb20gXCIuL3NlcnZpY2VzL2ZpbHRlci5zZXJ2aWNlXCI7XHJcbmltcG9ydCB7IEZpbHRlckVkaXRvckNvbXBvbmVudCB9IGZyb20gXCIuL2NvbXBvbmVudHMvZmlsdGVyLWVkaXRvci5jb21wb25lbnRcIjtcclxuaW1wb3J0IHsgQ29tbW9uVXRpbHMgfSBmcm9tIFwiQGZhcnJpcy91aS1jb21tb25cIjtcclxuaW1wb3J0IHsgTm90aWZ5U2VydmljZSB9IGZyb20gXCJAZmFycmlzL3VpLW5vdGlmeVwiO1xyXG5cclxuZXhwb3J0IGNvbnN0IEZJTFRFUl9MT09LVVBHUklEX1ZBTFVFX0FDQ0VTU09SOiBhbnkgPSB7XHJcbiAgICBwcm92aWRlOiBOR19WQUxVRV9BQ0NFU1NPUixcclxuICAgIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IEZpbHRlckNvbXBvbmVudCksXHJcbiAgICBtdWx0aTogdHJ1ZSxcclxufTtcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgRklMVEVSX0ZJRUxEX0VESVRPUiB7XHJcbiAgICB0eXBlOiBcInNlbGVjdFwiIHwgXCJjb21iby10cmVlXCIgfCBcImxvb2t1cFwiO1xyXG4gICAgb3B0aW9ucz86IGFueTtcclxufVxyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogXCJmaWx0ZXIsZmlsdGVyLXRleHRib3hcIixcclxuICAgIHRlbXBsYXRlVXJsOiBcImZpbHRlci5jb21wb25lbnQuaHRtbFwiLFxyXG4gICAgcHJvdmlkZXJzOiBbRklMVEVSX0xPT0tVUEdSSURfVkFMVUVfQUNDRVNTT1IsIEZpbHRlclNlcnZpY2VdLFxyXG4gICAgc3R5bGVzOiBbXHJcbiAgICAgICAgYFxyXG4gICAgICAgICAgICAubG9va3VwLWNsZWFyIHtcclxuICAgICAgICAgICAgICAgIGN1cnNvcjogcG9pbnRlcjtcclxuICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6ICNmZmYgIWltcG9ydGFudDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAubG9va3VwLWNsZWFyOmhvdmVyIHtcclxuICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6ICNlOWVjZWYgIWltcG9ydGFudDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIGAsXHJcbiAgICBdLFxyXG59KVxyXG5leHBvcnQgY2xhc3MgRmlsdGVyQ29tcG9uZW50IGV4dGVuZHMgTG9va3VwQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuICAgIEBIb3N0QmluZGluZyhcImNsYXNzXCIpIGhvc3RDbHMgPSBcImYtY21wLWlucHV0Z3JvdXBcIjtcclxuXHJcbiAgICB0ZXh0ID0gXCJcIjtcclxuICAgIGNvbmRpdGlvbnM6IEZpbHRlckNvbmRpdGlvbltdID0gW107XHJcbiAgICBvcmlnaW5hbERhdGE6IEZpbHRlckNvbmRpdGlvbltdID0gW107XHJcbiAgICAvKiog5a2X5q615pWw5o2uICovXHJcbiAgICBASW5wdXQoKSBjb2x1bW5zOiB7IGxhYmVsOiBzdHJpbmc7IHZhbHVlOiBzdHJpbmcgfVtdID0gW107XHJcbiAgICBASW5wdXQoKSBzaG93Q29kZSA9IGZhbHNlO1xyXG4gICAgQElucHV0KCkgc2hvd1NxbCA9IGZhbHNlO1xyXG4gICAgQElucHV0KCkgZW5hYmxlRXhwcmVzcyA9IGZhbHNlO1xyXG4gICAgQElucHV0KCkgZmllbGRFZGl0b3I6IEZJTFRFUl9GSUVMRF9FRElUT1IgPSB7IHR5cGU6IFwic2VsZWN0XCIsIG9wdGlvbnM6IHt9IH07XHJcbiAgICBASW5wdXQoKSBlbmFibGVDbGVhciA9IHRydWU7XHJcbiAgICBASW5wdXQoKSByZXR1cm5UeXBlOiBcIm9iamVjdFwiIHwgXCJzdHJpbmdcIiA9IFwib2JqZWN0XCI7XHJcbiAgICBASW5wdXQoKSBpbnNlcnRUeXBlOiBcImFib3ZlXCIgfCBcImJlbG93XCIgPSBcImJlbG93XCI7XHJcblxyXG4gICAgQE91dHB1dCgpIG9wZW5EaWFsb2cgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgICBAT3V0cHV0KCkgc2hvd0V4cHJlc3MgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgICBAVmlld0NoaWxkKFwiZGVmYXVsdEJ1dHRvblJlZlwiKSBidG5SZWY6IFRlbXBsYXRlUmVmPGFueT47XHJcbiAgICBAVmlld0NoaWxkKFwidHh0Ym94XCIpIHRleHRib3g6IEVsZW1lbnRSZWY8YW55PjtcclxuICAgIHNob3dDbGVhckJ1dHRvbiA9IGZhbHNlO1xyXG4gICAgY2Q6IENoYW5nZURldGVjdG9yUmVmID0gbnVsbDtcclxuICAgIGRsZ1JlZjogQnNNb2RhbFJlZjtcclxuICAgIGZpbHRlckVkaXRvclJlZjogQ29tcG9uZW50UmVmPEZpbHRlckVkaXRvckNvbXBvbmVudD47XHJcbiAgICBsb2NhbGVTZXJ2aWNlOiBMb2NhbGVTZXJ2aWNlO1xyXG5cclxuICAgIGNvbW1vblV0aWxzOiBDb21tb25VdGlscyA9IG51bGw7XHJcblxyXG4gICAgbm90aWZ5U2VyOiBOb3RpZnlTZXJ2aWNlID0gbnVsbDtcclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIGluamVjdG9yOiBJbmplY3RvcixcclxuICAgICAgICBwcml2YXRlIGNmcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxyXG4gICAgICAgIHByaXZhdGUgbW9kYWxTZXJ2aWNlOiBCc01vZGFsU2VydmljZSxcclxuICAgICAgICBwdWJsaWMgZWw6IEVsZW1lbnRSZWYsXHJcbiAgICAgICAgcHJpdmF0ZSBmaWx0ZXJTZXJ2aWNlOiBGaWx0ZXJTZXJ2aWNlXHJcbiAgICApIHtcclxuICAgICAgICBzdXBlcihpbmplY3RvciwgZWwpO1xyXG5cclxuICAgICAgICB0aGlzLmZpbHRlclNlcnZpY2UuY29uZGl0aW9uc0NoYW5nZWQuc3Vic2NyaWJlKChjb25kaXRpb25MaXN0KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuY29uZGl0aW9ucyA9IGNvbmRpdGlvbkxpc3Q7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMubm90aWZ5U2VyID0gdGhpcy5pbmplY3Rvci5nZXQoTm90aWZ5U2VydmljZSwgbnVsbCk7XHJcblxyXG4gICAgICAgIHRoaXMubG9jYWxlU2VydmljZSA9IHRoaXMuaW5qZWN0b3IuZ2V0KExvY2FsZVNlcnZpY2UpO1xyXG5cclxuICAgICAgICB0aGlzLmNkID0gdGhpcy5pbmplY3Rvci5nZXQoQ2hhbmdlRGV0ZWN0b3JSZWYpO1xyXG5cclxuICAgICAgICB0aGlzLmNvbW1vblV0aWxzID1cclxuICAgICAgICAgICAgdGhpcy5pbmplY3Rvci5nZXQoQ29tbW9uVXRpbHMsIG51bGwpIHx8IG5ldyBDb21tb25VdGlscygpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCkge31cclxuXHJcbiAgICBASG9zdExpc3RlbmVyKFwibW91c2VvdmVyXCIsIFtcIiRldmVudFwiXSlcclxuICAgIG9ubW91c2VvdmVyKGV2ZW50OiBhbnkpIHtcclxuICAgICAgICB0aGlzLnNob3dDbGVhckJ1dHRvbiA9IHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgQEhvc3RMaXN0ZW5lcihcIm1vdXNlbGVhdmVcIiwgW1wiJGV2ZW50XCJdKVxyXG4gICAgb25tb3VzZWxlYXZlKGV2ZW50OiBhbnkpIHtcclxuICAgICAgICB0aGlzLnNob3dDbGVhckJ1dHRvbiA9IGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIHNob3dEaWFsb2coKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmRpc2FibGVkKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmZpZWxkRWRpdG9yICYmIHRoaXMuZmllbGRFZGl0b3IudHlwZSA9PT0gXCJjb21iby10cmVlXCIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZmllbGRFZGl0b3Iub3B0aW9ucyA9IHRoaXMuZmllbGRFZGl0b3Iub3B0aW9ucyB8fCB7fTtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmZpZWxkRWRpdG9yLm9wdGlvbnMuYXV0b1dpZHRoID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmZpZWxkRWRpdG9yLm9wdGlvbnMuYXV0b1dpZHRoID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuZmllbGRFZGl0b3Iub3B0aW9ucy5jb2x1bW5zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5maWVsZEVkaXRvci5vcHRpb25zLmNvbHVtbnMgPSBbXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHsgZmllbGQ6IFwibGFiZWxcIiwgdGl0bGU6IFwibGFiZWxcIiwgd2lkdGg6IDEwMCB9LFxyXG4gICAgICAgICAgICAgICAgICAgIF07XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmZpZWxkRWRpdG9yLm9wdGlvbnMudGV4dEZpZWxkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5maWVsZEVkaXRvci5vcHRpb25zLnRleHRGaWVsZCA9IFwibGFiZWxcIjtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuZmllbGRFZGl0b3Iub3B0aW9ucy5pZEZpZWxkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5maWVsZEVkaXRvci5vcHRpb25zLmlkRmllbGQgPSBcInZhbHVlXCI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGZpbHRlckVkaXRvckZhY3RvcnkgPSB0aGlzLmNmci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShcclxuICAgICAgICAgICAgICAgIEZpbHRlckVkaXRvckNvbXBvbmVudFxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgICB0aGlzLmZpbHRlckVkaXRvclJlZiA9IGZpbHRlckVkaXRvckZhY3RvcnkuY3JlYXRlKHRoaXMuaW5qZWN0b3IpO1xyXG4gICAgICAgICAgICB0aGlzLmZpbHRlckVkaXRvclJlZi5pbnN0YW5jZS5jb2x1bW5zID0gdGhpcy5jb2x1bW5zO1xyXG4gICAgICAgICAgICB0aGlzLmZpbHRlckVkaXRvclJlZi5pbnN0YW5jZS5jb25kaXRpb25zID0gdGhpcy5jb25kaXRpb25zO1xyXG4gICAgICAgICAgICB0aGlzLm9yaWdpbmFsRGF0YSA9IGNsb25lRGVlcCh0aGlzLmNvbmRpdGlvbnMpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5kbGdSZWYgPSB0aGlzLm1vZGFsU2VydmljZS5zaG93KHRoaXMuZmlsdGVyRWRpdG9yUmVmLCB7XHJcbiAgICAgICAgICAgICAgICB3aWR0aDogODAwLFxyXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiA1MDAsXHJcbiAgICAgICAgICAgICAgICB0aXRsZTogdGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKFwiZmlsdGVyRWRpdG9yLnRpdGxlXCIpLFxyXG4gICAgICAgICAgICAgICAgZW5hYmxlU2Nyb2xsOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIG1pbkhlaWdodDogMzk4LFxyXG4gICAgICAgICAgICAgICAgbWluV2lkdGg6IDc5OCxcclxuICAgICAgICAgICAgICAgIGljb25DbHM6IFwiZi1pY29uIGYtaWNvbi1maWx0ZXJcIixcclxuICAgICAgICAgICAgICAgIGJ1dHRvbnM6IHRoaXMuYnRuUmVmLFxyXG4gICAgICAgICAgICAgICAgLy8gZGlhbG9nRm9vdGVyU3R5bGVzOiB7IGJhY2tncm91bmQ6ICcjRjRGNkY5JyB9LFxyXG4gICAgICAgICAgICAgICAgYnV0dG9uQWxpZ246IFwicmlnaHRcIixcclxuICAgICAgICAgICAgICAgIGluaXRpYWxTdGF0ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIHNob3dDb2RlOiB0aGlzLnNob3dDb2RlLFxyXG4gICAgICAgICAgICAgICAgICAgIHNob3dTcWw6IHRoaXMuc2hvd1NxbCxcclxuICAgICAgICAgICAgICAgICAgICBlbmFibGVFeHByZXNzOiB0aGlzLmVuYWJsZUV4cHJlc3MsXHJcbiAgICAgICAgICAgICAgICAgICAgZmllbGRFZGl0b3I6IHRoaXMuZmllbGRFZGl0b3IsXHJcbiAgICAgICAgICAgICAgICAgICAgaW5zZXJ0VHlwZTogdGhpcy5pbnNlcnRUeXBlLFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGNsb3NlZDogKGlzQ2xvc2VCdXR0b25DbGljazogYm9vbGVhbikgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpc0Nsb3NlQnV0dG9uQ2xpY2spIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jYW5jZWwoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuZmlsdGVyRWRpdG9yUmVmLmluc3RhbmNlLmhlaWdodCA9XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRsZ1JlZi5kaWFsb2cuaW5zdGFuY2UuZ2V0Q29udGFpbmVyU2l6ZSgpLmhlaWdodDtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuZmlsdGVyRWRpdG9yUmVmLmluc3RhbmNlLnNob3dFeHByZXNzLnN1YnNjcmliZSgoJGV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNob3dFeHByZXNzLmVtaXQoJGV2ZW50KTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmRsZ1JlZi5kaWFsb2cuaW5zdGFuY2UucmVzaXplZC5zdWJzY3JpYmUoKHNpemUpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZmlsdGVyRWRpdG9yUmVmLmluc3RhbmNlLmhlaWdodCA9IHNpemUuY29udGFpbmVySGVpZ2h0O1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuZmlsdGVyRWRpdG9yUmVmLmNoYW5nZURldGVjdG9yUmVmLmRldGVjdENoYW5nZXMoKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuZGxnUmVmLmRpYWxvZy5jaGFuZ2VEZXRlY3RvclJlZi5yZWF0dGFjaCgpO1xyXG4gICAgICAgICAgICB0aGlzLm9wZW5EaWFsb2cuZW1pdCgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB3cml0ZVZhbHVlKHZhbDogYW55KSB7XHJcbiAgICAgICAgaWYgKHZhbCkge1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbCA9PT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgICAgICAgICAgdmFsID0gSlNPTi5wYXJzZSh2YWwpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuY29uZGl0aW9ucyA9IHZhbCB8fCBbXTtcclxuICAgICAgICAgICAgdGhpcy50ZXh0ID0gdGhpcy5jb21tb25VdGlscy5idWlsZFNxbFdoZXJlKHRoaXMuY29uZGl0aW9ucyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY2hlY2tTeW1ib2woKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZmlsdGVyU2VydmljZS5pc1ZhbGlkKHRoaXMuY29uZGl0aW9ucywgdGhpcy5sb2NhbGVTZXJ2aWNlKTtcclxuICAgIH1cclxuXHJcbiAgICBzYXZlKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmNvbmRpdGlvbnMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNoZWNrUmVzdWx0ID0gdGhpcy5jaGVja1N5bWJvbCgpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBjaGVja1Jlc3VsdCA9PT0gXCJvYmplY3RcIikge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgeyBicmFja2V0LCByZWxhdGlvbiwgZmllbGQgfSA9IGNoZWNrUmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgaWYgKCFicmFja2V0LnJlc3VsdCB8fCAhcmVsYXRpb24ucmVzdWx0IHx8ICFmaWVsZC5yZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgbXNnID0gXCJcIjtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIWJyYWNrZXQucmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1zZyA9IGJyYWNrZXQubXNnO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIXJlbGF0aW9uLnJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtc2cgPSByZWxhdGlvbi5tc2c7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICghZmllbGQucmVzdWx0KXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbXNnID0gZmllbGQubXNnO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1zZykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5ub3RpZnlTZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubm90aWZ5U2VyLndhcm5pbmcobXNnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0KG1zZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5jb25kaXRpb25zID0gdGhpcy5jb25kaXRpb25zLmZpbHRlcigoYykgPT4gYy5maWx0ZXJGaWVsZCk7XHJcblxyXG4gICAgICAgICAgICAvLyDovazmjaJpbiDmk43kvZznrKbnmoR2YWx1ZSDlgLxcclxuICAgICAgICAgICAgdGhpcy5jb25kaXRpb25zID0gdGhpcy5jb25kaXRpb25zLm1hcCgoY29uKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBjcCA9IHBhcnNlSW50KFwiXCIgKyBjb24uY29tcGFyZSwgMTApO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNwID09PSBDb21wYXJlLkluIHx8IGNwID09PSBDb21wYXJlLk5vdEluKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uLnZhbHVlID0gY29uLnZhbHVlLnJlcGxhY2UoLywvZywgXCJcXHJcXG5cIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY29uO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMudGV4dCA9IHRoaXMuY29tbW9uVXRpbHMuYnVpbGRTcWxXaGVyZSh0aGlzLmNvbmRpdGlvbnMpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMudGV4dCA9IFwiXCI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5jZCkge1xyXG4gICAgICAgICAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuY2xvc2VEaWFsb2coKTtcclxuICAgIH1cclxuXHJcbiAgICBjYW5jZWwoKSB7XHJcbiAgICAgICAgdGhpcy5jb25kaXRpb25zID0gdGhpcy5vcmlnaW5hbERhdGE7XHJcbiAgICAgICAgdGhpcy5jbG9zZURpYWxvZygpO1xyXG4gICAgfVxyXG5cclxuICAgIGNsb3NlRGlhbG9nKCkge1xyXG4gICAgICAgIHRoaXMudXBkYXRlTW9kZWwoKTtcclxuICAgICAgICB0aGlzLmZpbHRlckVkaXRvclJlZiA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5kbGdSZWYuY2xvc2UoKTtcclxuICAgIH1cclxuXHJcbiAgICBjbGVhcigpIHtcclxuICAgICAgICB0aGlzLnRleHQgPSBcIlwiO1xyXG4gICAgICAgIHRoaXMuY29uZGl0aW9ucyA9IFtdO1xyXG4gICAgICAgIHRoaXMudXBkYXRlTW9kZWwoKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHVwZGF0ZU1vZGVsKCkge1xyXG4gICAgICAgIGxldCB2OiBhbnkgPSB0aGlzLmNvbmRpdGlvbnM7XHJcbiAgICAgICAgaWYgKHRoaXMucmV0dXJuVHlwZSA9PT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgICAgICB2ID0gSlNPTi5zdHJpbmdpZnkodGhpcy5jb25kaXRpb25zKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMub25Nb2RlbENoYW5nZSh2KTtcclxuICAgICAgICB0aGlzLm9uTW9kZWxUb3VjaGVkKHYpO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==