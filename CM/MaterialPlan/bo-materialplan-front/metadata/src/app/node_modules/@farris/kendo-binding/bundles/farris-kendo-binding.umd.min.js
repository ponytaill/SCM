!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@farris/ui-common/number"),require("@progress/kendo-angular-dropdowns"),require("lodash-es"),require("@farris/extend-file-upload"),require("rxjs"),require("rxjs/operators"),require("primeng/treetable"),require("@farris/ui-common/date"),require("@farris/ui-editor"),require("@gsp-cmp/querysolution"),require("@farris/ui-text"),require("@farris/ui-list-view"),require("@farris/ui-list-filter"),require("@farris/ui-filter"),require("@farris/ui-view-change"),require("@farris/ui-html-editor"),require("@farris/ui-section"),require("@farris/ui-input-group"),require("@farris/ui-datepicker"),require("@farris/ui-time-picker"),require("@farris/ui-number-spinner"),require("@farris/ui-combo-list"),require("@farris/ui-lookup"),require("@farris/ui-datagrid"),require("@farris/ui-treetable"),require("@farris/ui-wizard"),require("@farris/discussion-group"),require("@farris/ui-list-nav"),require("@farris/ui-multi-select"),require("@farris/ui-scrollspy"),require("@farris/ui-combo-lookup"),require("@gsp-svc/formdoc-upload"),require("@farris/ui-locale"),require("@farris/ui-common/column"),require("@farris/devkit"),require("bignumber.js"),require("moment"),require("@farris/ui-dialog"),require("@angular/core"),require("@angular/common"),require("@progress/kendo-angular-grid"),require("@farris/ui-common")):"function"==typeof define&&define.amd?define("@farris/kendo-binding",["exports","@farris/ui-common/number","@progress/kendo-angular-dropdowns","lodash-es","@farris/extend-file-upload","rxjs","rxjs/operators","primeng/treetable","@farris/ui-common/date","@farris/ui-editor","@gsp-cmp/querysolution","@farris/ui-text","@farris/ui-list-view","@farris/ui-list-filter","@farris/ui-filter","@farris/ui-view-change","@farris/ui-html-editor","@farris/ui-section","@farris/ui-input-group","@farris/ui-datepicker","@farris/ui-time-picker","@farris/ui-number-spinner","@farris/ui-combo-list","@farris/ui-lookup","@farris/ui-datagrid","@farris/ui-treetable","@farris/ui-wizard","@farris/discussion-group","@farris/ui-list-nav","@farris/ui-multi-select","@farris/ui-scrollspy","@farris/ui-combo-lookup","@gsp-svc/formdoc-upload","@farris/ui-locale","@farris/ui-common/column","@farris/devkit","bignumber.js","moment","@farris/ui-dialog","@angular/core","@angular/common","@progress/kendo-angular-grid","@farris/ui-common"],t):t((e.farris=e.farris||{},e.farris["kendo-binding"]={}),e.number,e.kendoAngularDropdowns,e.lodashEs,e.extendFileUpload,e.rxjs,e.rxjs.operators,e.treetable,e.date,e.uiEditor,e.querysolution,e.uiText,e.uiListView,e.uiListFilter,e.uiFilter,e.uiViewChange,e.uiHtmlEditor,e.uiSection,e.uiInputGroup,e.uiDatepicker,e.uiTimePicker,e.uiNumberSpinner,e.uiComboList,e.uiLookup,e.uiDatagrid,e.uiTreetable,e.uiWizard,e.discussionGroup,e.uiListNav,e.uiMultiSelect,e.uiScrollspy,e.uiComboLookup,e.formdocUpload,e.uiLocale,e.column,e.devkit,e.bignumber_js,e.moment,e.uiDialog,e.ng.core,e.ng.common,e.kendoAngularGrid,e.uiCommon)}(this,function(e,t,i,n,r,u,b,o,a,s,p,l,d,c,h,f,g,m,y,v,C,x,D,I,S,w,E,P,R,O,L,M,F,T,k,N,j,V,H,B,A,K,_){"use strict";V=V&&V.hasOwnProperty("default")?V["default"]:V;var z=(G.prototype.convertFrom=function(e){return e.split(this.separator)},G.prototype.convertTo=function(e){return e.join(this.separator)},G);function G(e){void 0===e&&(e=","),this.separator=e}var q=(U.prototype.convertFrom=function(e){return!0===N.DateUtil.isEmptyDateString(e)?null:N.DateUtil.parse(e)},U.prototype.convertTo=function(e){if(!e)return null;if("[object Date]"!==Object.prototype.toString.call(e))return e;var t=e.getFullYear().toString();t=t.length<4?"0".repeat(4-t.length)+t:t;var i=(e.getMonth()+1).toString();i=1===i.length?"0"+i:i;var n=e.getDate().toString();n=1===n.length?"0"+n:n;var r=e.getHours().toString();r=1===r.length?"0"+r:r;var o=e.getMinutes().toString();o=1===o.length?"0"+o:o;var a=e.getSeconds().toString();return t+"-"+i+"-"+n+" "+r+":"+o+":"+(a=1===a.length?"0"+a:a)},U);function U(e){this.format=e}var $=(W.prototype.convertFrom=function(e){return Object.assign({},e)},W.prototype.convertTo=function(e){return e},W);function W(){}var J=(Y.prototype.convertFrom=function(e){return e?JSON.parse(e):[]},Y.prototype.convertTo=function(e){return JSON.stringify(e)},Y);function Y(){}var Q=function(e,t){return(Q=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};function X(e,t){function i(){this.constructor=e}Q(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}var Z=function(){return(Z=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function ee(e){var t="function"==typeof Symbol&&e[Symbol.iterator],i=0;return t?t.call(e):{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}}}function te(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var n,r,o=i.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(i=o["return"])&&i.call(o)}finally{if(r)throw r.error}}return a}function ie(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(te(arguments[t]));return e}var ne=(re.prototype.getColumnFormat=function(e,t){var i=this.getValue(e,t.dataField),n=t.dataType;return"enum"===n?this.getEnumText(i,t):"boolean"===n?i?"是":"否":"date"===n?this.getFormatDate(i,t):"number"===n?this.getFormatNumber(i,t):this.getMultiText(i,t)},re.prototype.getValue=function(e,t){return t.indexOf(".")<0?e[t]:t.split(".").reduce(function(e,t){return e[t]},e)},re.prototype.getEnumText=function(t,e){var i,n=e.enumData;if(n)return n.forEach(function(e){e.value===t&&(i=e.name)}),i},re.prototype.getFormatDate=function(e,t){if(!0===N.DateUtil.isEmptyDateString(e))return"";var i=t.format;return i?this.dateService.formatTo(e,i):e},re.prototype.getFormatNumber=function(e,t){var i;if(t&&t.format?i=parseInt(t.format.substr(1),10):t&&t.editor&&(i=t.editor.precision),isNaN(i)&&(i=2),!e&&0!==e)return"";var n={prefix:t.prefix?t.prefix:"",suffix:t.suffix?t.suffix:"",precision:i,thousand:",",stripZeros:!1};return this.numberService.formatMoney(e,n)},re.prototype.getMultiText=function(e,t){var i=e;if(""===i||i||(i=""),"string"!=typeof i)throw new Error(typeof i+"类型值不合法，无法进行格式化");return i=i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;").replace(/\'/g,"&#39;").replace(/\//g,"&#x2F;"),t.editor&&"MultiTextBox"===t.editor.type&&-1<i.indexOf("\n")?i.replace(/\n/g,"<br>"):i},re.decorators=[{type:B.Injectable}],re.ctorParameters=function(){return[{type:a.DateTimeHelperService},{type:t.NumberHelperService}]},re);function re(e,t){this.dateService=e,this.numberService=t}var oe=(ae.prototype.setFormat=function(e){e.columns.forEach(function(e){var t=e.dataType;e.formatter||("date"===t?e.formatter={type:"datetime",options:{format:e.format}}:"number"===t?e.formatter={type:"number",options:{prefix:e.prefix?e.prefix:"",suffix:e.suffix?e.suffix:"",precision:e.precision,thousand:",",stripZeros:!1}}:"enum"===t?e.formatter={type:"enum",options:{data:e.enumData,valueField:"value",textField:"name"}}:"boolean"===t&&(e.formatter={type:"enum",options:{data:[{name:"是",value:!0},{name:"否",value:!1}],valueField:"value",textField:"name"}}))})},ae.decorators=[{type:B.Injectable}],ae.ctorParameters=function(){return[]},ae);function ae(){}var se=(pe.prototype.transform=function(e,t){if(!0===N.DateUtil.isEmptyDateString(e))return null;if(e.includes("年")){var i=e.replace("年","-").replace("月","-").replace("日","");return new Date(i)}return new Date(e)},pe.decorators=[{type:B.Pipe,args:[{name:"parseStrToDate"}]}],pe);function pe(){}var le,de=(X(ue,le=K.BaseFilterCellComponent),Object.defineProperty(ue.prototype,"selectedValue",{get:function(){var e=this.filterByField(this.column.dataField);return e?e.value:null},enumerable:!0,configurable:!0}),Object.defineProperty(ue.prototype,"defaultItem",{get:function(){return{value:null,name:"全部"}},enumerable:!0,configurable:!0}),ue.prototype.ngOnInit=function(){this.dropdownList.valueField="value",this.dropdownList.textField="name",this.dropdownList.valuePrimitive=!0,this.dropdownList.defaultItem=this.defaultItem,this.dropdownList.value=this.selectedValue,"enum"===this.column.dataType?this.dropdownList.data=this.column.enumData:"boolean"===this.column.dataType&&(this.dropdownList.data=[{value:!0,name:"是"},{value:!1,name:"否"}])},ue.prototype.onChange=function(e){this.applyFilter(null===e?this.removeFilter(this.column.dataField):this.updateFilter({field:this.column.dataField,operator:"eq",value:e}))},ue.prototype.getValue=function(e,t){return t.indexOf(".")<0?e[t]:t.split(".").reduce(function(e,t){return e[t]},e)},ue.decorators=[{type:B.Directive,args:[{selector:"[kendogridFilter]"}]}],ue.ctorParameters=function(){return[{type:i.DropDownListComponent},{type:K.FilterService}]},ue.propDecorators={filter:[{type:B.Input}],column:[{type:B.Input}],onChange:[{type:B.HostListener,args:["valueChange",["$event"]]}]},ue);function ue(e,t){var i=le.call(this,t)||this;return i.dropdownList=e,i.filterService=t,i}var ce=(he.prototype.transform=function(e,t){if(!this.viewModel.form||!this.viewModel.form.get(t))return{year:"年",month:"月",day:"日"};var i=this.viewModel.form.get(t).value,n=i;return n=n&&i.toISOString(),!0===N.DateUtil.isEmptyDateString(n)&&"yyyy年MM月dd日"===e?{year:" ",month:" ",day:" "}:{year:"年",month:"月",day:"日"}},he.decorators=[{type:B.Pipe,args:[{name:"dateFormatPlaceholder"}]}],he.ctorParameters=function(){return[{type:N.ViewModel}]},he);function he(e){this.viewModel=e}var fe=(ge.prototype.transform=function(e,t){if(!e&&0!==e)return"";if("number"!==t.dataType)return e;var i=t.format;return e.toFixed(Number(i.substring(1)))},ge.decorators=[{type:B.Pipe,args:[{name:"formatTotal"}]}],ge);function ge(){}var me=(Object.defineProperty(ye.prototype,"field",{get:function(){return this.column.field},enumerable:!0,configurable:!0}),Object.defineProperty(ye.prototype,"aggrType",{get:function(){var e="none";return"boolean"==typeof this.aggregate?this.aggregate&&(e="sum"):"string"==typeof this.aggregate&&(e=this.aggregate),e},enumerable:!0,configurable:!0}),ye.prototype.recalculateSummary=function(e){var t=this,i=null;if("sum"===this.aggrType){var n=e.toJSON().map(function(e){return t.field.split(".").reduce(function(e,t){return e[t]},e)});n&&n.length&&(i=n.reduce(function(e,t){return e+t}))}else"count"===this.aggrType&&(i=e.length);this.updateFooter(i)},ye.prototype.updateFooter=function(e){this.aggregate&&(this.column.summary=e)},ye.decorators=[{type:B.Directive,args:[{selector:"[aggregate]"}]}],ye.ctorParameters=function(){return[{type:K.ColumnComponent},{type:B.NgZone}]},ye.propDecorators={aggregate:[{type:B.Input}]},ye);function ye(e,t){this.column=e,this.ngZone=t}var ve=(be.decorators=[{type:B.Directive,args:[{selector:"[farrisSummary]"}]}],be.ctorParameters=function(){return[{type:N.BindingData}]},be.propDecorators={summary:[{type:B.Input,args:["farrisSummary"]}]},be);function be(e){this.bindingData=e}var Ce=(xe.renderClickChangedRow=function(e,t){if(e){var i=t.currentRowIndex;this.addRowSelectedStyle(e,i);var n=t.lastRowIndex;this.checIfIsSameRelativeIndex(e,i,n)||this.removeRowSelectedStyle(e,n)}},xe.checIfIsSameRelativeIndex=function(e,t,i){var n=!1;return t===i?n=!0:Math.abs(t-i)%e.pageSize==0?n=!0:n},xe.checkIfEnablePaging=function(e){var t=!1;return e&&("boolean"==typeof e.pageable?t=e.pageable:"object"==typeof e.pageable&&(t=!0)),t},xe.renderSelectedChangeCheckbox=function(e,t){var i=t.index,n=this.getTrCollection(e);if(!(null==n||n.length<=0||n.length<i)){var r=n[i];r&&(t.selected?this.appendAtrributeValue(r,"class",this.CHECKBOXED_ROW_STYLE_NAME):this.removeAttributeSpecificValue(r,"class",this.CHECKBOXED_ROW_STYLE_NAME))}},xe.addRowSelectedStyle=function(e,t){if(e&&!(t<0)){var i=this.getRelativeRowInCurrentPage(e,t);i&&this.appendAtrributeValue(i,"class",this.CURRENT_ROW_STYLE_NAME)}},xe.removeRowSelectedStyle=function(e,t){if(e&&!(t<0)){var i=this.getRelativeRowInCurrentPage(e,t);i&&this.removeAttributeSpecificValue(i,"class",this.CURRENT_ROW_STYLE_NAME)}},xe.getRelativeRowInCurrentPage=function(e,t){var i=null;if(!e||t<0)return i;var n=e.wrapper;this.checkIfEnablePaging(e)&&(t%=e.pageSize);var r=this.getTrCollection(n);return null==r||r.length<=0?i:i=r[t]},xe.getTrCollection=function(e){if(!e||!e.nativeElement)return null;var t=e.nativeElement.getElementsByTagName("tbody");return!t||t.length<=0?null:t[0].getElementsByTagName("tr")},xe.appendAtrributeValue=function(e,t,i){var n=e.getAttribute(t);null===n||""===n||n.length<=0?n=i:n.indexOf(i)<0&&(n+=" "+i),e.setAttribute(t,n)},xe.removeAttributeSpecificValue=function(e,t,i){var n=e.getAttribute(t);if(n){var r=n.lastIndexOf(i);r<0||(n=n.substring(0,r-1)+" "+n.substring(r+i.length),e.setAttribute(t,n))}},xe.CURRENT_ROW_STYLE_NAME="f-state-selected",xe.CHECKBOXED_ROW_STYLE_NAME="f-state-checked",xe);function xe(){}var De,Ie=function rn(){},Se=(X(we,De=K.DataBindingDirective),Object.defineProperty(we.prototype,"gridOption",{get:function(){return this.grid.gridOption},enumerable:!0,configurable:!0}),Object.defineProperty(we.prototype,"len",{get:function(){return this.grid.columns.length},enumerable:!0,configurable:!0}),Object.defineProperty(we.prototype,"IsMultipleSelectionMode",{get:function(){return this.grid&&(this.grid.selectable?"multiple"===this.grid.selectable.mode?this.isMultipleSelectionMode=!0:this.isMultipleSelectionMode=!1:this.grid.selectableSettings&&"multiple"===this.grid.selectableSettings.mode&&(this.isMultipleSelectionMode=!0)),this.isMultipleSelectionMode},enumerable:!0,configurable:!0}),Object.defineProperty(we.prototype,"bindingList",{get:function(){if("/"===this.viewModel.bindingPath||!this.viewModel.bindingPath)return this.bindingData.list;var e=this.viewModel.bindingPath.substr(1),t=(e=e[0].toLowerCase()+e.substring(1,e.length)).split("/").filter(function(e){return""!==e});return this.bindingData.getValue(t)},enumerable:!0,configurable:!0}),we.prototype.getPagingInfo=function(){var e=this.viewModel.bindingPath,t=this.viewModel.bindingData.pagingInfo;return"/"===e||e.substr(1).split("/").filter(function(e){return!!e&&0<e.length}).map(function(e){return e.substring(0,e.length-1)}).forEach(function(e){t=t&&t[e]||{}}),t},we.prototype.ngOnInit=function(){var i=this;if(De.prototype.ngOnInit.call(this),this.initDataState(),this.refreshView(),this.bindingChangeSubscription=this.bindingData.changes.subscribe(function(e){i.refreshView(e),e.type!==N.ChangeType.Load||i.isMultipleSelectionMode&&i.checkIfChangeMatchBindingPath(e)&&(i.selectionDir.selectedKeys=[],i.viewModel.uiState.setPropertyValue("ids",i.selectionDir.selectedKeys),i.ngZone.runOutsideAngular(function(){setTimeout(function(){var e=new Ie,t=Ce.checkIfEnablePaging(i.grid);i.rowIndex=t?i.grid.skip:0,e.currentRowIndex=i.rowIndex,e.lastRowIndex=i.lastRowIndex,i.handleSelectedRowChange(e)},300)})),e.type===N.ChangeType.Remove&&i.syncDeletedKeys(e.value);var t=i.checkIfChangeMatchBindingPath(e);t&&i.handleSelectedKeyChange(i.bindingList.currentId),t&&i.checkCurrentRowIdExists()&&e.type===N.ChangeType.SelectionChanged&&!i.dataId&&i.renderCurrentRow(i.bindingList.currentId),e.type!==N.ChangeType.Load&&e.type!==N.ChangeType.SelectionChanged&&e.type!==N.ChangeType.Append&&e.type!==N.ChangeType.Remove||i.grid&&i.grid.changeDetectorRef&&i.grid.changeDetectorRef.detectChanges&&i.grid.changeDetectorRef.detectChanges()}),!0===this.editable&&null===this.form)throw Error("启用编辑时，必须指定form");if(this.grid&&this.farrisBindingGridOption&&this.farrisBindingGridOption.fields){var e=this.farrisBindingGridOption.fields;if(this.farrisBindingGridOption.lockable=function(e){return e.some(function(e){return e.frozen})},this.rowClass.emit(this.grid),e.forEach(function(e){e.linkedLabelEnabled&&!e.linkEvent&&(e.linkEvent=function(){}),e.getColumnFormat||(e.getColumnFormat=function(e,t){return i.kendogridFormatSer.getColumnFormat(e,t)}),e.getClassName||(e.getClassName=function(e,t){return""}),e.editor&&"LookupEdit"===e.editor.type&&(e.dictPicking||(e.dictPicking=function(e){return u.of(!0)}),e.dictPicked||(e.dictPicked=function(e){return i.cellClickHandler(i.cellClickParam),u.of(!0)}))}),this.bindingGridOption(),this.IsMultipleSelectionMode){var t=this;this.ngZone.runOutsideAngular(function(){setTimeout(function(){var e=new Ie;e.currentRowIndex=t.rowIndex,e.lastRowIndex=t.lastRowIndex,t.handleSelectedRowChange(e)},300)})}}},we.prototype.ngAfterViewInit=function(){},we.prototype.checkIfChangeMatchBindingPath=function(e){var t=!1;if(!e||!e.path)return t;var i=e.path;if(!i)return t;if(!this.bindingData&&!this.bindingData.bindingPath)return t;var n=this.bindingData.bindingPath.split("/");return n.length<=0||(0===i.length?"/"===this.bindingData.bindingPath&&(t=!0):1===e.path.length?2===n.length&&n[1]===e.path[0]&&(t=!0):2===e.path.length&&3===n.length&&n[1]===e.path[0]&&n[2]===e.path[1]&&(t=!0)),t},we.prototype.handleSelectedKeyChange=function(e){var t=this.selectionDir.selectedKeys;if(e){if((this.IsMultipleSelectionMode?this.currentRowId:0===this.selectionDir.selectedKeys.length?null:this.selectionDir.selectedKeys[0])!==e){var i={};i.currentRowId=e,this.currentRowId=e,this.emitSelectedRowChange(i)}}else 0<t.length&&-1===t.splice(0,t.length).indexOf(null)&&this.emitSelectedRowChange({currentRowId:null})},we.prototype.emitSelectedRowChange=function(e){if(!this.IsMultipleSelectionMode){var t=e.currentRowId;this.selectionDir.selectedKeys=[t],this.selectionDir.selectedKeysChange.emit(this.selectionDir.selectedKeys)}this.selectedRowChange.emit(e)},we.prototype.checkCurrentRowIdExists=function(){var e=!1;return this.bindingList&&this.bindingList.currentId&&0<this.bindingList.currentId.length&&(e=!0),e},we.prototype.syncDeletedKeys=function(e){var i=this;e&&e.forEach(function(e){var t=i.selectionDir.selectedKeys.indexOf(e);-1<t&&(i.selectionDir.selectedKeys.splice(t,1),0===i.selectionDir.selectedKeys.length&&i.emitSelectedRowChange({currentRowId:null}))})},we.prototype.renderCurrentRow=function(e){e&&""!==e&&(this.IsMultipleSelectionMode||this.renderSelectionRow(this.bindingList.currentId,this.selectionDir.selectedKeys))},we.prototype.ngOnChanges=function(e){De.prototype.ngOnChanges.call(this,e),this.refreshView()},we.prototype.ngOnDestroy=function(){this.bindingChangeSubscription&&this.bindingChangeSubscription.unsubscribe()},we.prototype.refreshView=function(e){this.refreshData(e),this.refreshSummary()},we.prototype.bindData=function(){},we.prototype.refreshData=function(e){var t=0,i=this.getPagingInfo()||{},n=i.pageIndex,r=void 0===n?1:n,o=i.pageSize,a=void 0===o?0:o;0<r&&(t=(r-1)*a),this.updatePager(a,t),this.endCellEdit(e),this.data=this.bindingList.toJSON({ignoreMultiLangInput:!0})},we.prototype.endCellEdit=function(e){var t=this.grid.isEditing;e&&e.type===N.ChangeType.Load&&t&&this.grid.cancelCell()},we.prototype.refreshSummary=function(){var t=this;this.aggrColumns&&this.aggrColumns.forEach(function(e){e.aggregate&&e.recalculateSummary(t.bindingList)})},we.prototype.onPageChange=function(e){var t=e||{},i=t.skip,n=void 0===i?0:i,r=t.take,o=void 0===r?0:r;this.bindingData.setPagingInfo(n,o,this.viewModel.bindingPath),Ce.removeRowSelectedStyle(this.grid,this.rowIndex)},we.prototype.resetPageInfo=function(){var e=(this.getPagingInfo()||{}).pageSize,t=void 0===e?0:e;this.bindingData.setPagingInfo(0,t,this.viewModel.bindingPath)},we.prototype.initDataState=function(){var e,t,i=[];if(this.groupAggrFields)try{for(var n=ee(this.groupAggrFields),r=n.next();!r.done;r=n.next()){var o=r.value;i.push({field:o,aggregate:"sum"})}}catch(s){e={error:s}}finally{try{r&&!r.done&&(t=n["return"])&&t.call(n)}finally{if(e)throw e.error}}var a=[];this.groupField&&a.push({field:this.groupField,aggregates:i}),this.group=a},we.prototype.onStateChange=function(e){e.skip!==this.currentSkip&&(e.skip=this.currentSkip),this.applyState(e),this.rebind()},we.prototype.process=function(e){e.skip=0;var t=this.getPagingInfo()||{},i=t.pageSize,n=void 0===i?0:i,r=t.total,o=void 0===r?0:r;0===e.take?e.take=this.bindingList.length:e.take=n;var a=e.take<this.bindingList.length;a&&(e.take=this.bindingList.length);var s=De.prototype.process.call(this,e);return s.total=Math.max(o,this.bindingList.length),a&&(s.total=o||1),s},we.prototype.selectedKeysChangeHandler=function(e){this.IsMultipleSelectionMode||this.setSelectionIdToBindingData(e[e.length-1]),this.viewModel.uiState.setPropertyValue("ids",this.selectionDir.selectedKeys)},we.prototype.selectionChangeHandler=function(e){this.IsMultipleSelectionMode&&this.handleSelectedCheckboxChange(this.grid.wrapper,e)},we.prototype.handleSelectedCheckboxChange=function(e,t){Ce.renderSelectedChangeCheckbox(e,t),this.selectedCheckboxChange.emit(t)},we.prototype.cellClickHandler=function(t){if(this.cellClickParam=t,this.cellClickEvent=t,this.rowIndex=t.rowIndex,this.columnIndex=t.columnIndex,this.sender=t.sender,this.IsMultipleSelectionMode&&!this.gridOption.groupable){var e=t.rowIndex;if(e!==this.lastRowIndex){var i=new Ie;i.currentRowIndex=e,i.lastRowIndex=this.lastRowIndex,this.handleSelectedRowChange(i)}}if(this.dataId=this.getSelectedIdFromGrid(t.dataItem),this.setSelectionIdToBindingData(this.dataId),this.isEditable()&&t.column.editTemplate&&"click"===t.type&&!t.isEdited){var n=this.getColumns(this.gridOption.fields),r=this.getColumns(n),o=r.findIndex(function(e){return e.dataField===t.column.field}),a=r.slice(0,o+1).filter(function(e){return!e.visible}).length;this.rowIndex=t.rowIndex,this.columnIndex=t.columnIndex+a,this.hiddenColLen=a,this.sender=t.sender,this.setEditable(this.rowIndex,this.columnIndex)}},we.prototype.handleSelectedRowChange=function(e){Ce.renderClickChangedRow(this.grid,e),this.rowIndex=e.currentRowIndex,this.lastRowIndex=e.currentRowIndex;var t=this.getPrimary(this.rowIndex);this.setSelectionIdToBindingData(t)},we.prototype.getPrimary=function(e){var t=this.grid.data;t&&!Array.isArray(t)&&t.hasOwnProperty("data")&&(t=t.data);var i=this.getPagingInfo()||{},n=i.pageIndex,r=void 0===n?1:n,o=i.pageSize,a=void 0===o?0:o,s=this.bindingList.skip,p=0===a||1===r?e:e-s;return t.length>p?t[p][this.bindingList.primaryKey]:null},we.prototype.cellCloseHandler=function(e){if(this.dialogSer.hasDialogOpened())e.preventDefault();else{if(this.rts){if(this.rts.getFormState("lookup.pending"))return void e.preventDefault();if(e.originalEvent&&this.rts.eventPath(e.originalEvent).find(function(e){return"FARRIS-DIALOG"===e.tagName}))return void e.preventDefault()}var t=e.formGroup,i=e.column,n=e.dataItem,r=(e.rowIndex,this.getColumns(this.gridOption.fields).find(function(e){return e.dataField===i.field})),o=t[r.editor.binding.path].value;r.getDynamicData&&(r=r.getDynamicData(n,r)),this.setValue(o,r)}},we.prototype.enterCell=function(e){var t=this;if(!e.shiftKey&&13===e.keyCode){if(e.preventDefault(),!this.sender)return;e.target.blur(),this.ngZone.runOutsideAngular(function(){setTimeout(function(){t.rts&&t.rts.getFormState("lookup.pending")?e.preventDefault():t.enterNextCell()},201)})}},we.prototype.bindingGridOption=function(){this.farrisBindingGridOption&&Object.defineProperty(this.grid,"gridOption",{value:this.farrisBindingGridOption})},we.prototype.updatePager=function(e,t){0===e?(this.currentSkip=0,this.pageSize=0,this.skip=0,this.grid.pageable=!1):(this.currentSkip=t,this.skip=t,this.pageSize=e,this.grid.pageable={buttonCount:10,info:!0,type:"numeric",pageSizes:!1,previousNext:!0})},we.prototype.setEditable=function(e,t){var i=this.grid.data.data,n=this.getPagingInfo()||{},r=n.pageIndex,o=void 0===r?1:r,a=n.pageSize,s=void 0===a?0:a,p=this.bindingList.skip,l=0===s||1===o?e:e-p,d=i[l];this.gridOption.groupable&&(d=this.getGroupItem(i,l));var u=this.getColumns(this.gridOption.fields),c=this.getColumns(u),h=t;this.grid.gridOption.showLineNumber&&(h-=1),this.grid.selectable&&"multiple"===this.grid.selectable.mode&&(h-=1);var f=c[h],g={dataItem:d,column:f,rowIndex:e,columnIndex:h};f&&!f.editable&&(f.editable=function(e){return!0}),f&&this.notReadOnly(f,g)&&(this.dataId=this.getSelectedIdFromGrid(d),this.setSelectionIdToBindingData(this.dataId),this.sender.editCell(e,t-this.hiddenColLen,this.viewModel.form))},we.prototype.updateIndex=function(e,t){var i=(t+1)%this.len;return i?{rowIndex:e,columnIndex:i}:{rowIndex:(e+1)%this.bindingList.toJSON().length,columnIndex:i}},we.prototype.notReadOnly=function(e,t){return!!e&&e.editable(t)&&!e.editor.readonly},we.prototype.setValue=function(e,t){var i=t.dataType,n=this.viewModel.bindingData,r=this.getFieldPaths(n.bindingPath,t.dataField);if("date"===i){var o=this.dateService.formatTo(e,"yyyy-MM-dd HH:mm:ss");o=o||"",this.viewModel.bindingData.setValue(r,o,!0,!0)}else this.viewModel.bindingData.setValue(r,e,!0,!0)},we.prototype.getGroupItem=function(e,t){var i=t;for(var n in e){if(i<e[n].items.length)return e[n].items[i];i-=e[n].items.length}},we.prototype.getValue=function(e,t){return t.indexOf(".")<0?e[t]:t.split(".").reduce(function(e,t){return e[t]},e)},we.prototype.getFieldPaths=function(e,t){return(1<e.length?e.substr(1).replace(/\//g,".")+"."+t:t).split(".")},we.prototype.enterNextCell=function(){var e=this,t=this.updateIndex(this.rowIndex,this.columnIndex);if(!t.columnIndex&&!t.rowIndex){var i=this.bindingList.toJSON().length;if(this.appendRow.emit(),this.appendRow.observers&&this.appendRow.observers.length)return void(this.interVal=setInterval(function(){e.bindingList.toJSON().length-1===i&&(e.setEditable(e.bindingList.toJSON().length-1,0),e.rowIndex=e.bindingList.toJSON().length-1,e.columnIndex=0,clearInterval(e.interVal))},0))}this.setEditable(t.rowIndex,t.columnIndex),this.rowIndex=t.rowIndex,this.columnIndex=t.columnIndex},we.prototype.getColumns=function(e){return e.some(function(e){return e.frozen})?ie(e.filter(function(e){return e.frozen}),e.filter(function(e){return!e.frozen})):e},we.prototype.renderSelectionRow=function(e,t){if(e&&""!==e){if(this.IsMultipleSelectionMode){if(0<=t.indexOf(e))return;t.push(e)}else{if(1===t.length&&t[0]===e)return;t.splice(0,t.length),t.push(e)}this.selectionDir.selectedKeysChange.emit(t)}},we.prototype.getSelectedIdFromGrid=function(e){return e[this.bindingList.primaryKey]},we.prototype.setSelectionIdToBindingData=function(e){this.bindingList.setCurrentId(e,!0)},we.prototype.isEditable=function(){return this.editable===undefined?!!this.viewModel.stateMachine&&this.viewModel.stateMachine.editable:this.editable},we.prototype.isDataChanged=function(){var e,t,i=!1,n=this.viewModel.frameContext.repository.entityCollection.toArray();try{for(var r=ee(n),o=r.next();!o.done;o=r.next())if(0<o.value.changes.length){i=!0;break}}catch(a){e={error:a}}finally{try{o&&!o.done&&(t=r["return"])&&t.call(r)}finally{if(e)throw e.error}}return i},we.decorators=[{type:B.Directive,args:[{selector:"[farrisBindingPath]"}]}],we.ctorParameters=function(){return[{type:N.BindingData},{type:N.UIState,decorators:[{type:B.Optional}]},{type:N.FrameEventBus,decorators:[{type:B.Optional}]},{type:N.ViewModel,decorators:[{type:B.Optional}]},{type:K.GridComponent},{type:K.SelectionDirective},{type:H.DialogService},{type:a.DateTimeHelperService},{type:ne},{type:_.RuntimeStateService},{type:B.NgZone}]},we.propDecorators={editable:[{type:B.Input,args:["farrisEditable"]}],form:[{type:B.Input,args:["farrisForm"]}],groupField:[{type:B.Input,args:["groupField"]}],groupAggrFields:[{type:B.Input,args:["groupAggrFields"]}],farrisBindingGridOption:[{type:B.Input}],rowClassName:[{type:B.Input}],appendRow:[{type:B.Output,args:["append-row"]}],sortChangeEvent:[{type:B.Output}],rowClass:[{type:B.Output}],selectedRowChange:[{type:B.Output}],selectedCheckboxChange:[{type:B.Output}],aggrColumns:[{type:B.ContentChildren,args:[me]}],onPageChange:[{type:B.HostListener,args:["pageChange",["$event"]]}],selectedKeysChangeHandler:[{type:B.HostListener,args:["selectedKeysChange",["$event"]]}],selectionChangeHandler:[{type:B.HostListener,args:["selectionChange",["$event"]]}],cellClickHandler:[{type:B.HostListener,args:["cellClick",["$event"]]}],cellCloseHandler:[{type:B.HostListener,args:["cellClose",["$event"]]}],enterCell:[{type:B.HostListener,args:["keydown",["$event"]]}]},we);function we(e,t,i,n,r,o,a,s,p,l,d){var u=De.call(this,r)||this;u.bindingData=e,u.uiState=t,u.eventBus=i,u.viewModel=n,u.grid=r,u.selectionDir=o,u.dialogSer=a,u.dateService=s,u.kendogridFormatSer=p,u.rts=l,u.ngZone=d,u.appendRow=new B.EventEmitter,u.sortChangeEvent=new B.EventEmitter,u.rowClass=new B.EventEmitter,u.hiddenColLen=0,u.rowIndex=0,u.columnIndex=0,u.currentSkip=0,u.isMultipleSelectionMode=!1,u.lastRowIndex=-1,u.selectedRowChange=new B.EventEmitter,u.selectedCheckboxChange=new B.EventEmitter,u.selectionDir.selectedKeys=[],u.viewModel.uiState.setPropertyValue("ids",u.selectionDir.selectedKeys);var c=u.viewModel.frameContext.getFormAppContext();return c&&c.hasOwnProperty("messagePipe")&&c.messagePipe.subscribe(function(e){u.grid.closeCell()}),u}var Ee=(Object.defineProperty(Pe.prototype,"expandLevel",{get:function(){return this.context&&this.context.hasOwnProperty("expandLevel")?this.context.expandLevel:-1},enumerable:!0,configurable:!0}),Object.defineProperty(Pe.prototype,"component",{get:function(){return this.context&&this.context.component},enumerable:!0,configurable:!0}),Object.defineProperty(Pe.prototype,"addTreeLoadCompleteListener",{get:function(){return this.context&&this.context.addTreeLoadCompleteListener||function(e){}},enumerable:!0,configurable:!0}),Pe.prototype.updateTreeNode=function(e,t){this.allNodesData=e,this.initLevelGroup(),this.buildNodesDataMap(t)},Pe.prototype.build=function(){var r=this,o=[],a={};return this.allNodesData.forEach(function(e){var t=e.id,i=r.getParentId(e);!0===r.isNewNode(e)&&r.expandParentNode(e);var n=r.buildNode(e);a[t]=a[t]||[],n.children=a[t],r.allNodesMap.set(e[r.primaryKey],n),i?(a[i]=a[i]||[],a[i].push(n)):o.push(n)}),o},Pe.prototype.build1=function(){var n,r=this;this.allNodesData.forEach(function(e){var t=r.getHierarchyInfo(e);if(t){var i=t.layer;isNaN(i)||(n===undefined?n=i:i<n&&(n=i))}});var e=n-1;return this.buildNodes("",e,this.allNodesData,this.allNodes),this.allNodes},Pe.prototype.buildNodes=function(e,t,o,a){var s=this;this.getChildNodesData(e,t).forEach(function(e){!0===s.isNewNode(e)&&s.expandParentNode(e);var t=s.buildNode(e);a.push(t),s.allNodesMap.set(e[s.primaryKey],t);var i=s.getHierarchyInfo(e),n=i.layer,r=i.path;s.buildNodes(r,n,o,t.children)})},Pe.prototype.buildNode=function(e){var t=this.isLeaf(e),i=this.shouldExpand(e);!this.isExpanded(e)&&i&&this.expandNode(e);var n=this.buildPaginationInfo(e),r={data:Object.assign({},e),children:[],expanded:i,leaf:t};return n&&(r.pagination=n),r},Pe.prototype.buildPaginationInfo=function(e){var t=null;if(this.frameContext){var i="_NODE_"+this.getPrimary(e)+"_PAGINATION_INFO_",n=this.frameContext.params.get(i)||null;n&&1<n.pageCount&&(t={pageIndex:n.pageIndex,pageSize:n.pageSize,total:n.totalCount})}return t},Pe.prototype.shouldExpand=function(e){var t=te([this.getNodeLayer(e),this.isLeaf(e)],2),i=t[0];if(t[1])return!1;var n=this.isExpanded(e);if(!n){var r=this.getPrimary(e);if(-1<this.nodesWaitExpand.findIndex(function(e){return e&&e.id===r}))return!1;if(-1<this.nodesShouldExpand.findIndex(function(e){return e===r}))return!0;if(-1===this.expandLevel)n=!1;else if(0===this.expandLevel)n=!0;else{n=i<=this.expandLevel;var o=this.getOldNode(e);o&&!o.expanded&&(n=!1)}}return n},Pe.prototype.expandNode=function(e){var t=te([this.getNodePath(e),this.getNodeLayer(e)],2),i=t[0],n=t[1],r=this.getChildNodesData(i,n);if(!r||r.length<1){var o=this.getPrimary(e);this.nodesWaitExpand.findIndex(function(e){return e&&e.id===o})<0&&this.nodesWaitExpand.push({id:o,expanded:!1})}},Pe.prototype.onTreeLoadComplete=function(){var e=this.nodesWaitExpand.findIndex(function(e){return!e.expanded}),t=this.nodesWaitExpand[e]||{},i=t.id;i&&this.component.findRowNode(i)&&(t.expanded=!0,this.component.expandNode(i))},Pe.prototype.getPrimary=function(e){return e[this.primaryKey]},Pe.prototype.getChildNodesData=function(r,o){var a=this,s=[];return this.allNodesData.forEach(function(e){var t=a.getHierarchyInfo(e);if(t){var i=t.layer,n=t.path;i===o+1&&n&&n.startsWith(r)&&s.push(e)}}),s},Pe.prototype.getHierarchyInfo=function(e){return this.getValue(e,this.hierarchyInfoKey)},Pe.prototype.initLevelGroup=function(){var i=this;this.levelGroup={},this.allNodesData.forEach(function(e){var t="level"+i.getHierarchyInfo(e).layer;i.levelGroup[t]?i.levelGroup[t].push(e):i.levelGroup[t]=[e]})},Pe.prototype.getParentId=function(e){var i=this,n=this.getHierarchyInfo(e),t=(this.levelGroup[this.getLevelGroupKey(n.layer-1)]||[]).find(function(e){var t=i.getHierarchyInfo(e);return!0!==t.isDetail&&n.path.startsWith(t.path)});return t?t.id:null},Pe.prototype.getLevelGroupKey=function(e){return"level"+e},Pe.prototype.getValue=function(e,t){if(-1===t.indexOf("/"))return e[t];var i=t.split("/").filter(function(e){return e});return i.length<1?e:i.reduce(function(e,t){return e&&e[t]},e)},Pe.prototype.getNodeLayer=function(e){return this.getHierarchyInfo(e).layer},Pe.prototype.getNodePath=function(e){return this.getHierarchyInfo(e).path},Pe.prototype.isExpanded=function(e){var t=this.getOldNode(e);return t?t.expanded:undefined},Pe.prototype.isLeaf=function(e){return this.getHierarchyInfo(e).isDetail},Pe.prototype.isNewNode=function(e){return 0!==this.allOldNodesMap.size&&!this.getOldNode(e)},Pe.prototype.expandParentNode=function(e){var t=this.getParentNode(e);t&&(t.leaf=!1,t.expanded=!0)},Pe.prototype.getParentNode=function(e){var n=this,t=this.getHierarchyInfo(e),r=t.layer,o=t.path;return Array.from(this.allNodesMap.values()).find(function(e){var t=n.getValue(e.data,n.hierarchyInfoKey).layer,i=n.getValue(e.data,n.hierarchyInfoKey).path;return r===t+1&&!0===o.startsWith(i)})},Pe.prototype.getOldNode=function(e){var t=e[this.primaryKey];return this.allOldNodesMap.get(t)},Pe.prototype.buildNodesDataMap=function(e){var t=this;e.forEach(function(e){t.allOldNodesMap.set(e.data[t.primaryKey],e),e.children&&t.buildNodesDataMap(e.children)})},Pe);function Pe(e,t,i,n,r){this.levelGroup={},this.nodesWaitExpand=[],this.primaryKey=i,this.hierarchyInfoKey=n,this.allNodes=[],this.allNodesData=e,this.context=r||{},this.nodesWaitExpand=[],this.nodesShouldExpand=r&&r.nodesShouldExpand||[],this.frameContext=r&&r.frameContext||null,this.addTreeLoadCompleteListener(this.onTreeLoadComplete.bind(this)),this.initLevelGroup(),this.allNodesMap=new Map,this.allOldNodesMap=new Map,this.buildNodesDataMap(t)}var Re=(Object.defineProperty(Oe.prototype,"expandLevel",{get:function(){return this.context&&this.context.hasOwnProperty("expandLevel")?this.context.expandLevel:-1},enumerable:!0,configurable:!0}),Object.defineProperty(Oe.prototype,"component",{get:function(){return this.context&&this.context.component},enumerable:!0,configurable:!0}),Object.defineProperty(Oe.prototype,"addTreeLoadCompleteListener",{get:function(){return this.context&&this.context.addTreeLoadCompleteListener||function(e){}},enumerable:!0,configurable:!0}),Oe.prototype.updateTreeNode=function(e,t){this.allNodesData=e,this.buildNodesDataMap(t)},Oe.prototype.build=function(){var r=this,o=[],a={},s={};return this.allNodesData.forEach(function(e){var t=e.id,i=r.getHierarchyInfo(e).parentElement;!0===r.isNewNode(e)&&r.expandParentNode(e);var n=r.buildNode(e);a[t]=a[t]||[],n.children=a[t],s[i]=s[i]||[],s[i].push(n),r.allNodesMap.set(e[r.primaryKey],n),i?(a[i]=a[i]||[],a[i].push(n)):o.push(n)}),(!o||o.length<1)&&this.allNodesData&&0<this.allNodesData.length&&Object.keys(s).forEach(function(t){r.allNodesData.find(function(e){return e.id===t})||(o=o.concat(s[t]))}),o},Oe.prototype.build1=function(){var n,r=this;this.allNodesData.forEach(function(e){var t=r.getHierarchyInfo(e);if(t){var i=t.layer;isNaN(i)||(n===undefined?n=i:i<n&&(n=i))}});var e=n-1;return this.buildNodes("",e,this.allNodesData,this.allNodes),this.allNodes},Oe.prototype.buildNodes=function(e,t,r,o){var a=this;this.getChildNodesData(e,t).forEach(function(e){!0===a.isNewNode(e)&&a.expandParentNode(e);var t=a.buildNode(e);o.push(t),a.allNodesMap.set(e[a.primaryKey],t);var i=a.getHierarchyInfo(e).layer,n=e[a.primaryKey];a.buildNodes(n,i,r,t.children)})},Oe.prototype.buildNode=function(e){var t=this.isLeaf(e),i=this.shouldExpand(e);!this.isExpanded(e)&&i&&this.expandNode(e);var n=this.buildPaginationInfo(e),r={data:Object.assign({},e),children:[],expanded:i,leaf:t};return n&&(r.pagination=n),r},Oe.prototype.buildPaginationInfo=function(e){var t=null;if(this.frameContext){var i="_NODE_"+this.getPrimary(e)+"_PAGINATION_INFO_",n=this.frameContext.params.get(i)||null;n&&1<n.pageCount&&(t={pageIndex:n.pageIndex,pageSize:n.pageSize,total:n.totalCount})}return t},Oe.prototype.shouldExpand=function(e){var t=te([this.isLeaf(e),this.getNodeLayer(e)],2),i=t[0],n=t[1];if(i)return!1;var r=this.isExpanded(e);if(!r){var o=this.getPrimary(e);if(-1<this.nodesWaitExpand.findIndex(function(e){return e&&e.id===o}))return!1;if(-1<this.nodesShouldExpand.findIndex(function(e){return e===o}))return!0;if(-1===this.expandLevel)r=!1;else if(0===this.expandLevel)r=!0;else{r=n<=this.expandLevel;var a=this.getOldNode(e);a&&!a.expanded&&(r=!1)}}return r},Oe.prototype.expandNode=function(e){var t=te([e[this.primaryKey],this.getNodeLayer(e)],2),i=t[0],n=t[1],r=this.getChildNodesData(i,n);if(!r||r.length<1){var o=this.getPrimary(e);this.nodesWaitExpand.findIndex(function(e){return e&&e.id===o})<0&&this.nodesWaitExpand.push({id:o,expanded:!1})}},Oe.prototype.onTreeLoadComplete=function(){var e=this.nodesWaitExpand.findIndex(function(e){return!e.expanded}),t=this.nodesWaitExpand[e]||{},i=t.id;i&&this.component.findRowNode(i)&&(t.expanded=!0,this.component.expandNode(i))},Oe.prototype.getPrimary=function(e){return e[this.primaryKey]},Oe.prototype.getChildNodesData=function(r,o){var a=this,s=[];return this.allNodesData.forEach(function(e){var t=a.getHierarchyInfo(e);if(t){var i=t.layer,n=t.parentElement;i!==o+1||n!==r&&(n||""!==r)||s.push(e)}}),s},Oe.prototype.getHierarchyInfo=function(e){return this.getValue(e,this.hierarchyInfoKey)},Oe.prototype.getValue=function(e,t){return-1===t.indexOf("/")?e[t]:t.split("/").filter(function(e){return e}).reduce(function(e,t){return e&&e[t]},e)},Oe.prototype.getNodeLayer=function(e){return this.getHierarchyInfo(e).layer},Oe.prototype.getNodeParentElement=function(e){return this.getHierarchyInfo(e).parentElement},Oe.prototype.isExpanded=function(e){var t=this.getOldNode(e);return t?t.expanded:undefined},Oe.prototype.isLeaf=function(e){return this.getHierarchyInfo(e).isDetail},Oe.prototype.isNewNode=function(e){return 0!==this.allOldNodesMap.size&&!this.getOldNode(e)},Oe.prototype.expandParentNode=function(e){var t=this.getParentNode(e);t&&(t.leaf=!1,t.expanded=!0)},Oe.prototype.getParentNode=function(e){var i=this,t=this.getHierarchyInfo(e),n=t.layer,r=t.parentElement;return Array.from(this.allNodesMap.values()).find(function(e){var t=i.getValue(e.data,i.hierarchyInfoKey).layer;return e.data[i.primaryKey]===r&&n===t+1})},Oe.prototype.getOldNode=function(e){var t=e[this.primaryKey];return this.allOldNodesMap.get(t)},Oe.prototype.buildNodesDataMap=function(e){var t=this;e.forEach(function(e){t.allOldNodesMap.set(e.data[t.primaryKey],e),e.children&&t.buildNodesDataMap(e.children)})},Oe);function Oe(e,t,i,n,r){this.nodesWaitExpand=[],this.primaryKey=i,this.hierarchyInfoKey=n,this.allNodes=[],this.allNodesData=e,this.context=r||{},this.nodesWaitExpand=[],this.nodesShouldExpand=r&&r.nodesShouldExpand||[],this.frameContext=r&&r.frameContext||null,this.addTreeLoadCompleteListener(this.onTreeLoadComplete.bind(this)),this.allNodesMap=new Map,this.allOldNodesMap=new Map,this.buildNodesDataMap(t)}var Le=(Me.getBuilder=function(e){var t=Ee;return e.hasOwnProperty("path")?t=Ee:e.hasOwnProperty("parentElement")&&(t=Re),t},Me);function Me(){}var Fe=(Object.defineProperty(Te.prototype,"bindingData",{get:function(){return this.frameContext.bindingData},enumerable:!0,configurable:!0}),Object.defineProperty(Te.prototype,"bindingList",{get:function(){return this.bindingData.list},enumerable:!0,configurable:!0}),Object.defineProperty(Te.prototype,"prop",{get:function(){return this._PROP},set:function(e){this._PROP=e},enumerable:!0,configurable:!0}),Object.defineProperty(Te.prototype,"viewModel",{get:function(){return this.frameContext.viewModel},enumerable:!0,configurable:!0}),Te.prototype.ngOnInit=function(){var i=this;this.frameContext.getVirtualRootFrameContext().setParam("hierarchyInfoKey",this.hierarchyInfoKey),this.bindData(),this.bindingData.changes.subscribe(function(e){!e||e.type!==N.ChangeType.ValueChanged&&e.type!==N.ChangeType.PaginationInfoChange?i.bindData():i.renderSubject.next(e);var t=i.bindingList.currentId;!i.frameContext.bindingData.rowSelectedEventSuspend&&t&&i.setSelectedIdToTree(i.bindingList.currentId),i.updateCheckedRows(e)}),this.treetableFormatSer.setFormat(this.treeTable),this.rowClass.emit(this.treeTable),this.cellClass.emit(this.treeTable),this.setComponentRef(),this.setNodePaginationInfo(),this.registerEvent()},Te.prototype.ngOnChanges=function(e){},Te.prototype.registerEvent=function(){var o=this;this.treeTable.columnSorted.subscribe(function(e){var t=e.sortName,i=void 0===t?null:t,n=e.sortOrder,r=void 0===n?null:n;!1===o.treeTable.remoteSort&&i&&r&&o.bindingList.sortBy(i,r),o.bindData()})},Te.prototype.setComponentRef=function(){var e=this.viewModel&&this.viewModel.frameContext&&this.viewModel.frameContext.getFormAppContext(),t=this.viewModel&&this.viewModel.frameContext&&this.viewModel.frameContext.frameId,i=this.treeTable&&this.treeTable.el.nativeElement.id||null;if(t&&i){var n=e&&e.componentRefs&&e.componentRefs.get(t)||new Map;e&&e.componentRefs&&e.componentRefs.set(t,n.set(i,this.treeTable))}},Te.prototype.setNodePaginationInfo=function(){if(this.frameContext){var e=this.treeTable.paginationForChildren||!1;this.frameContext.params.set("enableNodePagination",e);var t=this.nodePageSize||0;this.frameContext.params.set("nodePageSize",t)}},Te.prototype.bindData=function(){var e=this.treeTable.data,t=this.bindingList.toJSON({ignoreMultiLangInput:!0}),i=[];if((this.prop=t)&&0<t.length){var n=t[0][this.hierarchyInfoKey],r=this.builder;if(r||(this.builder=Le.getBuilder(n),r=this.builder),null==r)throw new Error("TreeTable builder is null!");var o=-1,a=this.treeTable.expandLevel;void 0!==a&&(o=a);var s=(this.frameContext.getVirtualRootFrameContext().params.get("_DEVKIT_expandRowIds")||"").split(",")||[],p={expandLevel:o,addTreeLoadCompleteListener:this.addTreeLoadCompleteListener.bind(this),component:this.treeTable,storage:this.storage,nodesShouldExpand:s,frameContext:this.frameContext};this.treeNodesBuilder=new r(t,e,this.bindingList.primaryKey,this.hierarchyInfoKey,p),i=this.treeNodesBuilder.build()}this.treeTable.data=i,this.updatePageInfo(this.treeTable),this.onTreeLoadComplete()},Te.prototype.onTreeLoadComplete=function(){this.listeners&&0<this.listeners.length&&this.listeners.forEach(function(e){e()})},Te.prototype.addTreeLoadCompleteListener=function(e){this.listeners.push(e)},Te.prototype.shouldComponentUpdate=function(e){return JSON.stringify(this.prop)!==JSON.stringify(e)},Te.prototype.getSelectedIdFromTree=function(){var e=this.treeTable.selectedRow;return e?e.data.id:null},Te.prototype.setSelectedIdToTree=function(e){if(e){var t=this.getSelectedIdFromTree(),i=this.frameContext.params.get("_NODE_PAGE_CHANGED_")||!1;t||!i?t!==e&&(this.treeTable.clearSelections(),this.treeTable.selectNode(e)):this.frameContext.params["delete"]("_NODE_PAGE_CHANGED_")}},Te.prototype.setCurrentIdToBindingList=function(e){var t=this.bindingData.list.currentId;this.treeTable.multiSelect||(this.setChecks(e),this.setCheckedRows([e])),t!==e&&this.bindingData.list.setCurrentId(e,!0)},Te.prototype.updateCheckedRows=function(e){if(e.type===N.ChangeType.Load)this.setCheckedRows();else if(e.type===N.ChangeType.ValueChanged||e.type===N.ChangeType.Remove){var t=this.getChecks();e.id&&t.includes(e.id)&&this.setCheckedRows()}},Te.prototype.setCheckedRows=function(e){var n=this;if(void 0===e&&(e=this.viewModel.uiState.ids||[]),Array.isArray(e)){var r=this.bindingList.toJSON(),o=this.viewModel.uiState.rows||new Map,a=new Map;e.forEach(function(t){var e=r.find(function(e){return e[n.bindingList.primaryKey]===t}),i=o.get(t);e?a.set(t,e):i&&a.set(t,i)}),this.viewModel.uiState.setPropertyValue("rows",a)}},Te.prototype.setChecks=function(e){"string"==typeof e&&(e=e.split(",").filter(function(e){return e})),this.viewModel.uiState.setPropertyValue("ids",e)},Te.prototype.getChecks=function(){return this.viewModel.uiState.ids||[]},Te.prototype.getPagingInfo=function(){var e=this.viewModel.bindingPath,t=this.viewModel.bindingData.pagingInfo;return"/"===e||e.substr(1).split("/").filter(function(e){return!!e&&0<e.length}).map(function(e){return e.substring(0,e.length-1)}).forEach(function(e){t=t&&t[e]}),t},Te.prototype.updatePageInfo=function(e){var t=this.getPagingInfo(),i=t.pageIndex,n=t.pageSize,r=t.total;0!==n?(e.pagination=!0,e.updatePageInfo({pageIndex:i,pageSize:n,total:r})):e.pagination=!1},Te.prototype.selectionChangeHandler=function(e){if(e&&e.node&&e.node.hasOwnProperty("data")){var t=this.treeTable.idField,i=e.node.data[t];this.setCurrentIdToBindingList(i)}},Te.prototype.checkValuesChange=function(e){this.setChecks(this.treeTable.checkValues),this.setCheckedRows()},Te.prototype.expandHandler=function(e){var t=e.data.id,i=this.frameContext.getVirtualRootFrameContext(),n=i.getParam("TREE_LATEST_EXPANDED_ID")||[];n.push(t),i.setParam("TREE_LATEST_EXPANDED_ID",n)},Te.prototype.onPageChanged=function(e){var t=e||{},i=t.pageSize,n=void 0===i?20:i,r=t.pageIndex,o=void 0===r?1:r;o<1&&(o=1);var a=(o-1)*n;this.bindingData.setPagingInfo(a,n,this.bindingData.bindingPath)},Te.prototype.onPageSizeChanged=function(e){var t=e||20;this.bindingData.setPagingInfo(0,t,this.bindingData.bindingPath)},Te.prototype.onNodePageChanged=function(e){var t=e.pageIndex,i=void 0===t?1:t,n=e.pageSize,r=(void 0===n&&this.nodePageSize,e.node),o=void 0===r?{}:r,a=o&&o.id||null;if(a){var s=this.frameContext.getVirtualRootFrameContext(),p=s.getParam("TREE_LATEST_EXPANDED_ID")||[];p.push(a),s.setParam("TREE_LATEST_EXPANDED_ID",p),this.frameContext.params.set("_NODE_"+a+"_PAGE_INDEX_",i),this.frameContext.params.set("_RELOAD_CHILDREN_",!0),this.frameContext.params.set("_NODE_PAGE_CHANGED_",!0)}},Te.decorators=[{type:B.Directive,args:[{selector:"[farrisTreeTableBinding]"}]}],Te.ctorParameters=function(){return[{type:w.TreeTableComponent},{type:oe},{type:N.FrameContext}]},Te.propDecorators={hierarchyInfoKey:[{type:B.Input,args:["farrisHierarchyInfoKey"]}],rowClassName:[{type:B.Input}],cellClassName:[{type:B.Input}],nodePageSize:[{type:B.Input,args:["nodePageSize"]}],rowClass:[{type:B.Output}],cellClass:[{type:B.Output}],selectionChangeHandler:[{type:B.HostListener,args:["nodeSelected",["$event"]]}],checkValuesChange:[{type:B.HostListener,args:["checkValuesChange",["$event"]]}],expandHandler:[{type:B.HostListener,args:["expand",["$event"]]}],onPageChanged:[{type:B.HostListener,args:["pageChanged",["$event"]]}],onPageSizeChanged:[{type:B.HostListener,args:["pageSizeChanged",["$event"]]}],onNodePageChanged:[{type:B.HostListener,args:["childsPageChanged",["$event"]]}]},Te);function Te(e,t,i){var n=this;this.treeTable=e,this.treetableFormatSer=t,this.frameContext=i,this.renderSubject=new u.Subject,this.nodePageSize=100,this.rowClass=new B.EventEmitter,this.cellClass=new B.EventEmitter,this._PROP=null,this.listeners=[],this.storage=[],this.viewModel.uiState.setPropertyValue("ids",this.treeTable.checkValues),this.renderSubject.pipe(b.debounceTime(500)).subscribe(function(){n.bindData()})}var ke=(Ne.prototype.mappingData=function(e,t,i){if(void 0===i&&(i=!1),t){var n=this.vm.frameContext.appContext;n.changeDetectionController.detach();var r,o,a,s=Object.keys(t);r=this.getBindingPathArray();var p=this.getMapFieldsPrimaryKey(t,r);o=p&&p.map(function(e){return e.primaryKey})||[],a=p&&p.map(function(e){return e.primaryField})||[],s=this.sortMapFieldKeys(s,o),e&&!i||s.reverse(),this.mapping(s,t,e,a,r,i),n.changeDetectionController.reattach()}},Ne.prototype.mapping=function(e,o,a,s,p,l){var d=this;void 0===l&&(l=!1),e.forEach(function(e){var t=d.getHelpValue(e,a),i=o[e].split(","),n=i.filter(function(e){return s.includes(e)}),r=i.filter(function(e){return!s.includes(e)});i=!a||l?[].concat(r).concat(n):[].concat(n).concat(r),d.updateTarget(i,p,a,t)})},Ne.prototype.updateTarget=function(e,t,i,n){var r=this;e.forEach(function(e){r.updateTargetValue(t,e,n,i)})},Ne.prototype.updateTargetValue=function(e,t,i,n){if(this.target){var r=t.split(".");this.setValue(this.target,r,i)}else r=e.concat(t.split(".")),n?this.vm.bindingData.setValue(r,i,!0,!0,null,{frameContext:this.vm.frameContext}):this.vm.bindingData.clearValue(r,!0,!0,{frameContext:this.vm.frameContext})},Ne.prototype.getHelpValue=function(t,e){var i=this,n="";return e&&(n=e instanceof Array?e.map(function(e){return i.getValue(t,e)}).join(","):this.getValue(t,e)),n},Ne.prototype.getValue=function(e,t){return-1===e.indexOf(".")?t[e]:e.split(".").reduce(function(e,t){return e[t]},t)},Ne.prototype.setValue=function(e,t,i){e&&(t.length<=1?e[t[0]]=i:t.slice(0,-1).reduce(function(e,t){return e.hasOwnProperty(t)||e.__proto__.hasOwnProperty(t)||(e[t]={}),e[t]},e)[t[t.length-1]]=i)},Ne.prototype.getBindingPathArray=function(){var e=this.vm.bindingPath;return e?e.split("/").filter(function(e){return""!==e}):[]},Ne.prototype.isNumberValue=function(e,t){var i=this.getValue(e,t);return n.isNumber(i)},Ne.prototype.getMapFieldsPrimaryKey=function(t,r){if(!t||Object.keys(t).length<1)return null;var o=[];try{var a=this.vm.frameContext.repository.entityTypeInfo;Object.keys(t).forEach(function(n){var e=t[n];e&&"string"==typeof e&&e.split(",").filter(function(e){return e}).forEach(function(e){var t=e.split(".");r&&0<r.length&&(t=r.concat(t));var i=a.getPropInfoByPath(t);i&&i.metadataInfo&&!0===i.metadataInfo.primary&&o.push({primaryKey:n,primaryField:e})})})}catch(e){console.error(e)}return o},Ne.prototype.sortMapFieldKeys=function(e,t){return!t||t.length<1||!e||e.length<1?e:(t=ie(new Set(t)),e=e.filter(function(e){return!t.includes(e)}),[].concat(t).concat(e))},Ne);function Ne(){}var je,Ve=(X(He,je=ke),He.prototype.ngOnInit=function(){var p=this;this.lookup.selectedData.subscribe(function(e){var t=p.mapfields||p.lookup.mapFields;p.mappingData(e,t)}),this.lookup.clearMappings.subscribe(function(e){var t=Object.assign({},p.mapfields||p.lookup.mapFields||{}),i=p.lookup.textField,n={},r=p.lookup.ngControl&&p.lookup.ngControl.name;if(r&&p.vm){var o=t[i],a=p.vm&&p.vm.form&&p.vm.form.ngFormControls&&p.vm.form.ngFormControls[r],s=a&&a.binding;o&&s&&(t[i]=o.split(",").filter(function(e){return e!==s}).join(","))}Object.keys(t).forEach(function(e){p.setValue(n,e.split("."),"")}),p.mappingData(n,t,!0)}),this.lookup.clear.subscribe(function(){var e=p.mapfields||p.lookup.mapFields;p.mappingData(null,e)})},He.decorators=[{type:B.Directive,args:[{selector:"[data-mapping]"}]}],He.ctorParameters=function(){return[{type:N.ViewModel,decorators:[{type:B.Optional}]},{type:I.LookupGridComponent,decorators:[{type:B.Optional},{type:B.Self}]}]},He.propDecorators={mapfields:[{type:B.Input,args:["data-mapping"]}],target:[{type:B.Input,args:["target"]}]},He);function He(e,t){var i=je.call(this)||this;return i.vm=e,i.lookup=t,i.target=null,i}var Be=(Ae.prototype.ngOnInit=function(){if(this.frameContext&&this.lookup&&!0===this.enableExtendLoadMethod){var e=this.frameContext.repository.apiUri,t=this.lookup.uri+"@"+e;this.frameContext.setParam(t,!0)}},Ae.decorators=[{type:B.Directive,args:[{selector:"[enableExtendLoadMethod]"}]}],Ae.ctorParameters=function(){return[{type:N.FrameContext,decorators:[{type:B.Optional}]},{type:I.LookupGridComponent,decorators:[{type:B.Optional},{type:B.Self}]}]},Ae.propDecorators={enableExtendLoadMethod:[{type:B.Input}]},Ae);function Ae(e,t){this.frameContext=e,this.lookup=t}var Ke=(Object.defineProperty(_e.prototype,"bindingObject",{get:function(){return this._bindingObject},set:function(e){this._bindingObject=e,!this.differ&&e&&this.differs&&"object"==typeof e&&(this.differ=this.differs.find(e).create())},enumerable:!0,configurable:!0}),_e.prototype.onValueChange=function(e){this.hostComboComponent&&this.bindingObject&&(e?(this.bindingObject.key=e.value,this.bindingObject.value=e.name):(this.bindingObject.key=null,this.bindingObject.value=null))},_e.prototype.ngOnInit=function(){this.hostComboComponent?this.hostComboComponent.valuePrimitive=!1:this.hostHelpComponent?this.bindObjectToHostLookup():this.hostComboListComponent?this.bindObjectToHostComboList():this.hostComboLookupComponent&&this.bindObjectToHostComboLookup()},_e.prototype.ngDoCheck=function(){this.differ&&"object"==typeof this.bindingObject?this.differ&&this.differ.diff(this.bindingObject)&&this.bindingChanges():this.bindingChanges()},_e.prototype.bindingChanges=function(){var e=this.bindingObject?this.bindingObject.value:null,t=this.bindingObject?this.bindingObject.key:null;if(this.hostComboComponent){this.hostComboComponent.text=e;var i=this.hostComboComponent.valueField,n=this.hostComboComponent.data.find(function(e){return e[i]===t});this.hostComboComponent.writeValue(n)}else this.hostHelpComponent?(this.hostHelpComponent.writeValue(e),this.hostHelpComponent.displayValue=t):this.hostComboListComponent?this.hostComboListComponent.writeValue(t):this.hostComboLookupComponent&&(this.hostComboLookupComponent.selectedValues=t,this.hostComboLookupComponent.writeValue(e))},_e.prototype.ngOnChanges=function(e){e.bindingObject&&!this.differ&&this.bindingChanges()},_e.prototype.bindObjectToHostLookup=function(){var r=this;this.hostHelpComponent&&(this.hostHelpComponent.selectedData.subscribe(function(e){return r.updateHelpBindingObject(e)}),this.hostHelpComponent.clear.subscribe(function(){r.updateHelpBindingObject(null)}),this.hostHelpComponent.nosearch&&this.hostHelpComponent.valueChanged.subscribe(function(e){var t,i=r.hostHelpComponent.idField,n=r.hostHelpComponent.textField;r.updateHelpBindingObject(((t={})[i]=e,t[n]=e,t))}))},_e.prototype.bindObjectToHostComboList=function(){var t=this;this.hostComboListComponent&&(this.hostComboListComponent.valueChange.subscribe(function(e){return t.updateHelpBindingObject(e.selections)}),this.hostComboListComponent.clear.subscribe(function(){t.updateHelpBindingObject(null)}))},_e.prototype.bindObjectToHostComboLookup=function(){var i=this;this.hostComboLookupComponent&&(this.hostComboLookupComponent.multiSelect?this.hostComboLookupComponent.valueChange.subscribe(function(e){return i.updateHelpBindingObject(e.selections)}):this.hostComboLookupComponent.selectChange.subscribe(function(e){var t=e;e.data&&(t=e.data),i.updateHelpBindingObject(t)}),this.hostComboLookupComponent.clear.subscribe(function(){i.updateHelpBindingObject(null)}))},_e.prototype.updateHelpBindingObject=function(e){var t,i;this.hostHelpComponent&&(t=this.hostHelpComponent.idField,i=this.hostHelpComponent.textField),this.hostComboListComponent&&(t=this.hostComboListComponent.idField,i=this.hostComboListComponent.textField),this.hostComboLookupComponent&&(t=this.hostComboLookupComponent.idField,i=this.hostComboLookupComponent.textField),this.emitUiStateBinding(e,t,i)},_e.prototype.emitUiStateBinding=function(e,t,i){var n={key:null,value:null};e&&(Array.isArray(e)?(n.key=e.map(function(e){return e[t]}).join(","),n.value=e.map(function(e){return-1<i.indexOf(".")?i.split(".").reduce(function(e,t){return e[t]},e):e[i]}).join(",")):(t&&(n.key=e[t]),i&&(-1<i.indexOf(".")?n.value=i.split(".").reduce(function(e,t){return e[t]},e):n.value=e[i]))),this.UIStateBindingChange.emit(n)},_e.decorators=[{type:B.Directive,args:[{selector:"[UIStateBinding]"}]}],_e.ctorParameters=function(){return[{type:i.ComboBoxComponent,decorators:[{type:B.Host},{type:B.Self},{type:B.Optional}]},{type:I.LookupGridComponent,decorators:[{type:B.Host},{type:B.Self},{type:B.Optional}]},{type:B.KeyValueDiffers,decorators:[{type:B.Optional}]},{type:D.ComboListComponent,decorators:[{type:B.Host},{type:B.Self},{type:B.Optional}]},{type:M.ComboLookupComponent,decorators:[{type:B.Host},{type:B.Self},{type:B.Optional}]}]},_e.propDecorators={bindingObject:[{type:B.Input,args:["UIStateBinding"]}],UIStateBindingChange:[{type:B.Output}],onValueChange:[{type:B.HostListener,args:["valueChange",["$event"]]}]},_e);function _e(e,t,i,n,r){this.hostComboComponent=e,this.hostHelpComponent=t,this.differs=i,this.hostComboListComponent=n,this.hostComboLookupComponent=r,this.differ=null,this.UIStateBindingChange=new B.EventEmitter}var ze=(Ge.prototype.ngOnInit=function(){},Ge.prototype.ngOnChanges=function(e){this.maskElement||this.createMaskElement(),e.kendoGridDisabled&&this.maskElement&&(this.kendoGridDisabled?this.renderer.removeStyle(this.maskElement,"display"):this.renderer.setStyle(this.maskElement,"display","none"))},Ge.prototype.createMaskElement=function(){this.maskElement=this.renderer.createElement("div"),this.renderer.setStyle(this.maskElement,"width","100%"),this.renderer.setStyle(this.maskElement,"height","100%"),this.renderer.setStyle(this.maskElement,"position","absolute"),this.renderer.setStyle(this.maskElement,"background-color","rgba(255,255,255,0.5)"),this.renderer.setStyle(this.maskElement,"z-index","3"),this.renderer.setStyle(this.maskElement,"display","none"),this.renderer.appendChild(this.el.nativeElement,this.maskElement)},Ge.decorators=[{type:B.Directive,args:[{selector:"[farrisDisabled]"}]}],Ge.ctorParameters=function(){return[{type:K.GridComponent},{type:B.ElementRef},{type:B.Renderer2}]},Ge.propDecorators={kendoGridDisabled:[{type:B.Input,args:["farrisDisabled"]}]},Ge);function Ge(e,t,i){this.grid=e,this.el=t,this.renderer=i}var qe=(Ue.decorators=[{type:B.Directive,args:[{selector:"[farrisSort]"}]}],Ue);function Ue(){}var $e=(We.decorators=[{type:B.Directive,args:[{selector:"[farris-textarea-edit]"}]}],We);function We(){}var Je=(Ye.decorators=[{type:B.Directive,args:[{selector:"[farrisDynamicColumnFormat]"}]}],Ye);function Ye(){}var Qe=(Xe.decorators=[{type:B.Directive,args:[{selector:"[farris-enter-edit]"}]}],Xe.propDecorators={farrisForm:[{type:B.Input,args:["form-group"]}]},Xe);function Xe(){}var Ze=(et.decorators=[{type:B.Directive,args:[{selector:"[farrisTreeTableFormat]"}]}],et);function et(){}var tt=(Object.defineProperty(it.prototype,"props",{get:function(){return this._PROPS},set:function(e){this._PROPS=e},enumerable:!0,configurable:!0}),it.prototype.ngOnInit=function(){var t=this,e=(this.getPagingInfo()||{}).pageSize,i=void 0===e?0:e;0!==i&&(!this.grid.pageList||this.grid.pageList.length<1)&&"function"==typeof this.grid.setPageList&&this.grid.setPageList([i,2*i,3*i,4*i]),this.setComponentRef(),this.bindData(),window.setTimeout(function(){t.updateSelectedRow()},0),this.registerBindingDataChangeEvent(),this.renderGridSubject.pipe(b.debounceTime(500)).subscribe(function(e){t.viewModel&&t.viewModel.frameContext&&!t.viewModel.frameContext.isDisposed&&t.bindData(e)})},it.prototype.ngOnChanges=function(e){this.bindData()},Object.defineProperty(it.prototype,"primaryKey",{get:function(){return this.bindingList.primaryKey},enumerable:!0,configurable:!0}),Object.defineProperty(it.prototype,"bindingList",{get:function(){if("/"===this.viewModel.bindingPath||!this.viewModel.bindingPath)return this.bindingData.list;var e=this.viewModel.bindingPath.substr(1),t=(e=e[0].toLowerCase()+e.substring(1,e.length)).split("/").filter(function(e){return""!==e});return this.bindingData.getValue(t)},enumerable:!0,configurable:!0}),it.prototype.setComponentRef=function(){var e=this.viewModel&&this.viewModel.frameContext&&this.viewModel.frameContext.getFormAppContext(),t=this.viewModel&&this.viewModel.frameContext&&this.viewModel.frameContext.frameId,i=this.grid&&this.grid.id;if(t&&i){var n=e&&e.componentRefs&&e.componentRefs.get(t)||new Map;e&&e.componentRefs&&e.componentRefs.set(t,n.set(i,this.grid))}},it.prototype.getPagingInfo=function(){var e=this.viewModel.bindingPath,t=this.viewModel.bindingData,i=t&&t.pagingInfo||{};if("/"===e)return i;var n=e.substr(1).split("/").filter(function(e){return!!e&&0<e.length}),r=n[n.length-1];r=r.substr(0,r.length-1);var o=n.slice(0,n.length-1),a=t.getValue(o),s=(i[""+r]||{}).pageSize,p=void 0===s?0:s;if(a&&a.currentId){var l=i[r+"_"+a.currentId]||{};return l.hasOwnProperty("totalCount")&&(l.total=l.totalCount),Object.keys(l).length<1&&(l.pageIndex=1,l.pageSize=p),l}return{pageIndex:1,pageSize:p}},it.prototype.shouldComponentUpdate=function(e,t){var i=this.buildProps(t);if(this.viewModel&&this.viewModel.frameContext&&this.viewModel.frameContext.appContext&&this.viewModel.frameContext.appContext.runMode===N.RunMode.highSpeed&&e&&(e.type===N.ChangeType.Load||e.type===N.ChangeType.Remove||e.type===N.ChangeType.PaginationInfoChange))return{result:!0,props:i};var n=this.buildGridProps();return JSON.stringify(i)===JSON.stringify(n)?{result:!1}:{result:!0,props:i}},it.prototype.registerEvent=function(){var l=this;this.grid&&this.grid.columnSorted&&this.grid.columnSorted.subscribe(function(e){if(l.grid.remoteSort){var t=l.grid&&l.grid.groupField||null,i=l.grid.sortName&&l.grid.sortName.split(",")||[],n=l.grid.sortOrder&&l.grid.sortOrder.split(",")||[];t&&(i.includes(t)||(i.splice(0,0,t),n.splice(0,0,"asc")));var r=l.viewModel&&l.viewModel.frameContext.repository.entityType||null;if(0<i.length&&r){var o=new N.DataTypeInfo(r);i=i.map(function(e){var t=e.split("."),i=o.getPropInfoByPath(t);return i&&i.metadataInfo.path||null})}var a=i.join(","),s=n.join(",")||"asc",p=l.viewModel&&l.viewModel.frameContext||null;p&&p.repository.sortConditionManager.setConditions(l.viewModel.bindingPath,a,s)}else l.sortFields=l.grid.sortName,l.sortDirections=l.grid.sortOrder,l.sortBindingList()}),this.grid&&this.grid.filterChanged&&this.grid.filterChanged.subscribe(function(e){if(l.filters=e,!l.grid.remoteFilter){if(0<l.bindingList.length&&!l.bindingList.currentId){var t=l.bindingList.getIdByIndex(0);l.bindingList.setCurrentId(t)}l.bindData()}})},it.prototype.sortBindingList=function(){var e=this.grid&&this.grid.groupField||null;if(e){var t=this.sortFields&&this.sortFields.split(",")||[];if(!t.includes(e)){t.splice(0,0,e);var i=this.sortDirections&&this.sortDirections.split(",")||[];i.splice(0,0,"asc"),this.sortFields=t.join(","),this.sortDirections=i.join(",")||"asc"}}this.sortFields&&this.sortDirections&&this.bindingList.sortBy(this.sortFields,this.sortDirections),this.bindData()},it.prototype.bindData=function(e){var t=this,i=this.grid&&this.grid.remoteFilter||!1;if(!this.sortFields||this.grid.editable||!e||"Load"!==e.type&&"SelectionChanged"!==e.type){(!0===this.grid.editable||e&&e.type===N.ChangeType.Append)&&this.filters&&0<Object.keys(this.filters).length&&!i&&(this.filters={},this.grid.clearCondition());var n=this.bindingList.toJSON();if(this.filters&&0<Object.keys(this.filters).length&&!i&&(n=this.grid.clientFilterService.executeFilter(n,this.filters)),this.filters&&0<Object.keys(this.filters).length&&!i&&(!e||e&&e.type!==N.ChangeType.SelectionChanged&&e.type!==N.ChangeType.GlobalSelectionChanged))if(n&&0<n.length){if(!n.find(function(e){return e[t.bindingList.primaryKey]===t.bindingList.currentId})){var r=n[0][this.bindingList.primaryKey];this.bindingList.setCurrentId(r,!0,!0)}}else this.bindingList.setCurrentId(null,!0,!0,!0),this.grid.multiSelect||this.setChecks([]);var o=this.shouldComponentUpdate(e,n);o.result&&(this.renderGrid(o.props),this.props=JSON.parse(JSON.stringify(o.props)))}else this.sortBindingList()},it.prototype.renderGrid=function(e){var t=e.pageIndex,i=e.pageSize,n=e.total,r=e.pagination,o=e.data,a=this.grid.virtualizedAsyncLoad||!1;this.grid.total=n,this.grid.pageSize=i,this.grid.pageIndex=t,this.grid.pagination=r,this.grid.controlPaginationState=!1,0===i&&(this.grid.pagination=!1,this.grid.pageIndex=1),a?this.grid.loadVirtualData({items:o,pageIndex:t,pageSize:i,total:n}):this.grid.loadData(o)},it.prototype.buildProps=function(e){var t;t=void 0!==e?e:this.bindingList.toJSON();var i=this.getPagingInfo()||{},n=i.pageIndex,r=void 0===n?1:n,o=i.pageSize,a=void 0===o?0:o,s=(this.getPagingInfo()||{}).total,p=void 0===s?0:s;return 0===a&&0===p&&(p=t.length),{data:t,pageIndex:r,pageSize:a,total:p,pagination:0!==a}},it.prototype.buildGridProps=function(){var e=this.grid.data||[],t={pageIndex:this.grid.pageIndex,pageSize:this.grid.pageSize},i=t.pageIndex,n=void 0===i?1:i,r=t.pageSize,o=void 0===r?0:r,a=this.grid.total||0;return 0===o&&0===a&&(a=e.length),{data:e,pageIndex:n,pageSize:o,total:a,pagination:this.grid.pagination}},it.prototype.onBindingDataChange=function(e){this.updateDataSource(e),this.updateSelectedRow(e),this.endCellEdit(e),this.updateCheckedRows(e),this.updateData(e)},it.prototype.updateDataSource=function(e){e&&e.type===N.ChangeType.ValueChanged?this.renderGridSubject.next(e):!e||e.type!==N.ChangeType.SelectionChanged&&e.type!==N.ChangeType.GlobalSelectionChanged?this.bindData(e):this.bindingList.currentId===(this.grid.selectedRow&&this.grid.selectedRow.id)&&0<this.grid.total||this.bindData(e)},it.prototype.endCellEdit=function(e){var t=this.grid.isEditing();e.type===N.ChangeType.Load&&t&&this.grid.endCellEdit()},it.prototype.updateSelectedRow=function(e){if(this.bindingList&&this.bindingList.currentId&&!(e&&e.type===N.ChangeType.PaginationInfoChange||this.viewModel&&!0===this.viewModel.frameContext.bindingData.rowSelectedEventSuspend)){var t=(this.grid.selectedRow||{}).id,i=void 0===t?null:t,n=this.bindingList.currentId;if(i!==n)this.selectGridRow(this.bindingList.currentId);else{var r=e&&e.path.toString()===this.viewModel.bindingPath.split("/").filter(function(e){return e}).toString();e&&e.type===N.ChangeType.Load&&r&&(this.grid.clearSelections(),this.grid.selectRow(n,!0,!0))}}},it.prototype.registerBindingDataChangeEvent=function(){var t=this;this.bindingDataChangeEvent=this.bindingData.changes.subscribe(function(e){t.onBindingDataChange(e)}),this.viewModel.frameContext.appContext.messagePipe.subscribe(function(e){"bindData"===e&&t.bindData()})},it.prototype.unRegisterBindingDataChangeEvent=function(){this.bindingDataChangeEvent&&"function"==typeof this.bindingDataChangeEvent.unsubscribe&&this.bindingDataChangeEvent.unsubscribe()},it.prototype.updateData=function(e){var t=this;if(e&&(e.type===N.ChangeType.SelectionChanged||e.type===N.ChangeType.Load)){var i=this.viewModel.bindingPath,n="/"+e.path.join("/"),r=this.viewModel.frameContext.appContext.params.get("retrieveing")||!1;if(!(e.path.length<1||"/"===i||i===n)&&i.startsWith(n)&&!r){var o=N.EntityPathConverter.toEntityPathArray(this.viewModel.bindingPath,this.bindingData),a=o.slice(0,o.length-1),s=this.bindingList.parent;if(s&&s[s.primaryKey]){var p=this.viewModel.bindingPath.split("/").filter(function(e){return e}),l=p[p.length-1],d="/"+(l=l.substr(0,l.length-1)),u=(this.viewModel.frameContext.repository.entityCollection.getPaginationConfigByPath(d)||{}).pageIndex,c=void 0===u?1:u,h=(this.viewModel.frameContext.repository.entityCollection.getPaginationConfigByPath(d)||{}).pageSize,f=void 0===h?0:h,g=e.path[e.path.length-1],m="/"+g.substring(0,g.length-1),y=(this.viewModel.frameContext.repository.entityCollection.getPaginationConfigByPath(m)||{}).pageSize,v=void 0===y?0:y;this.viewModel.frameContext.appContext.params.get("queryChild")&&(c=1),v+f!==0&&(this.viewModel.frameContext.appContext.params.set("forceQueryChild",!0),this.viewModel.frameContext.repository.queryChild(a,c,f).pipe(b.finalize(function(){return t.viewModel.frameContext.appContext.params["delete"]("forceQueryChild")})).subscribe())}}}},it.prototype.ngOnDestroy=function(){this.unRegisterBindingDataChangeEvent()},it.prototype.fireSelectedRowChange=function(e){this.selectedRowChange.emit(e)},it.prototype.clearCheckedRows=function(e){e.type===N.ChangeType.Load&&this.grid.multiSelect&&this.checkIfChangeMatchBindingPath(e)&&(this.setChecks([]),"function"==typeof this.grid.clearCheckeds&&this.grid.clearCheckeds())},it.prototype.setSelectionIdToBindingData=function(e){if(!e)return this.bindingList.currentId=e,void(this.grid.multiSelect||this.setChecks([]));this.bindingList.currentId!==e&&this.bindingList.setCurrentId(e,!0),this.grid.multiSelect||this.setChecks([e])},it.prototype.updateCheckedRows=function(e){if(e.type===N.ChangeType.Load)this.setCheckedRows();else if(e.type===N.ChangeType.ValueChanged){var t=this.getChecks();e.id&&t.includes(e.id)&&this.setCheckedRows()}},it.prototype.setChecks=function(e){this.viewModel.uiState.setPropertyValue("ids",e),this.setCheckedRows(e)},it.prototype.getChecks=function(){return this.viewModel.uiState.ids||[]},it.prototype.setCheckedRows=function(e){var n=this;if(void 0===e&&(e=this.viewModel.uiState.ids||[]),!Array.isArray(e)||e.length<1)this.viewModel.uiState.setPropertyValue("rows",null);else{var r=[];r=this.viewModel.frameContext.appContext.runMode===N.RunMode.highSpeed?this.grid.data||[]:this.bindingList.toJSON({ignoreMultiLangInput:!0});var o=this.viewModel.uiState.rows||new Map,a=new Map;e.forEach(function(t){var e=r.find(function(e){return e[n.primaryKey]===t}),i=o.get(t);e?a.set(t,e):i&&a.set(t,i)}),this.viewModel.uiState.setPropertyValue("rows",a)}},it.prototype.selectGridRow=function(e){this.grid.selectRow(e),this.grid.scrollToCurrentRow()},it.prototype.pageChangedHandler=function(e){var t=e.pageIndex,i=e.pageSize;t<1&&(t=1);var n=(t-1)*i;this.bindingData.setPagingInfo(n,i,this.bindingData.bindingPath)},it.prototype.selectedRowChanged=function(e){e.index;var t=e.data[this.primaryKey];this.setSelectionIdToBindingData(t),this.fireSelectedRowChange(e)},it.prototype.unSelected=function(e){if(e){var t=e.data;(void 0===t?{}:t)[this.primaryKey]===this.bindingList.currentId&&this.setSelectionIdToBindingData(null)}},it.prototype.checkedChanged=function(e){var t=(e=e||[]).map(function(e){return e.id});this.setChecks(t)},it.prototype.pageSizeChanged=function(e){e.pageIndex;var t=e.pageSize;this.bindingData.setPagingInfo(0,t,this.bindingData.bindingPath)},it.prototype.scrollY=function(e){var t=e.pager,i=e.pageSize,n=(t-1)*i;this.bindingData.setPagingInfo(n,i,this.bindingData.bindingPath)},it.prototype.filterChanged=function(e){this.filters=e},it.prototype.checkIfChangeMatchBindingPath=function(e){var t=!1;if(!e||!e.path)return t;var i=e.path;if(!i)return t;if(!this.bindingData&&!this.bindingData.bindingPath)return t;var n=this.bindingData.bindingPath.split("/");return n.length<=0||(0===i.length?"/"===this.bindingData.bindingPath&&(t=!0):1===e.path.length?2===n.length&&n[1]===e.path[0]&&(t=!0):2===e.path.length&&3===n.length&&n[1]===e.path[0]&&n[2]===e.path[1]&&(t=!0)),t},it.decorators=[{type:B.Directive,args:[{selector:"[farris-use-binding-data]"}]}],it.ctorParameters=function(){return[{type:N.BindingData},{type:N.ViewModel},{type:S.DatagridComponent}]},it.propDecorators={selectedRowChange:[{type:B.Output}],pageChangedHandler:[{type:B.HostListener,args:["pageChanged",["$event"]]}],selectedRowChanged:[{type:B.HostListener,args:["selectChanged",["$event"]]}],unSelected:[{type:B.HostListener,args:["unSelect",["$event"]]}],checkedChanged:[{type:B.HostListener,args:["checkedChange",["$event"]]}],pageSizeChanged:[{type:B.HostListener,args:["pageSizeChanged",["$event"]]}],scrollY:[{type:B.HostListener,args:["scrollYLoad",["$event"]]}],filterChanged:[{type:B.HostListener,args:["filterChanged",["$event"]]}]},it);function it(e,t,i){this.bindingData=e,this.viewModel=t,this.grid=i,this.sortFields=null,this.sortDirections=null,this.parentId=null,this.filters=null,this.renderGridSubject=new u.Subject,this.selectedRowChange=new B.EventEmitter,this.setChecks([]),this.registerEvent()}var nt=(rt.prototype.ngOnInit=function(){var t=this;this.multiSelectComponent.dataSource=[],Array.isArray(this.dataSource)?(this.multiSelectComponent.dataSource=this.dataSource,this.originalDataSource=this.dataSource):this.dataSource&&this.dataSource.changes&&this.dataSource.changes.subscribe(function(e){"Load"===e.type&&(t.originalDataSource=e.value,t.multiSelectComponent.isTree()?(t.fjmField?t.multiSelectComponent.dataSource=t.plainToTree(e.value,t.fjmField,1):t.fjdField&&(t.multiSelectComponent.dataSource=t.buildTreeNodesByFjd(e.value,t.fjdField)),t.multiSelectComponent.selections=t.getTreeSelectionsById(t.selectedId,t.originalDataSource)):(t.multiSelectComponent.dataSource=e.value,t.multiSelectComponent.selections=t.getListSelectionsById(t.selectedId,t.multiSelectComponent.dataSource)))}),this.selectIdBindingToUIStateField()},rt.prototype.selectIdBindingToUIStateField=function(){var t=this;this.multiSelectComponent&&this.multiSelectComponent.selectedIdChange&&this.multiSelectComponent.selectedIdChange.subscribe(function(e){t.selectedIdChanged.emit(e)})},rt.prototype.formatDataSource=function(e,n){var r=this;return e&&e.length?e.map(function(e){var t,i=e.toJSON?e.toJSON():e;return{data:Object.assign(Z({},i),(t={},t[""+r.idField]=e[r.idField],t[""+r.textField]=e[r.textField],t[""+r.valueField]=e[r.valueField],t[""+n]=e[n],t)),children:[]}}):[]},rt.prototype.plainToTree=function(e,t,i){var n=this.formatDataSource(e,t);if(!n.length)return[];if(!n[0].data[t])return[];var r=n.filter(function(e){return e.data[t].layer===i});return this.recursive(r,n,t,1),r},rt.prototype.recursive=function(e,s,p,l){var d=this;e.forEach(function(r){var o=r.data[p].path,a=r.data[p].layer;!1===r.data[p].isDetail&&s.forEach(function(e){if(e&&e.data&&e.data[p]&&e.data[p].path){var t=e.data[p].path,i=e.data[p].layer,n=void 0;t&&t.length>o.length&&(n=t.substr(0,4*Number(l))),o===n&&a===i-1&&r.children.push(e),!1===e.data[p].isDetail&&o===n&&d.recursive([e],s,p,Number(l)+1)}})})},rt.prototype.getListSelectionsById=function(t,i){var n=[],r=this;if("string"==typeof t&&t||"number"==typeof t){var e=i.find(function(e){return e&&e[r.idField]===t});e&&n.push(e)}else Array.isArray(t)&&i?t.forEach(function(t){var e=i.find(function(e){return e&&e[r.idField]===t});e&&n.push(e)}):n=[];return n},rt.prototype.getTreeSelectionsById=function(t,i){var n=[],r=this;if("string"==typeof t&&t||"number"==typeof t){var e=i.find(function(e){return e&&e[r.idField]===t});e&&n.push(e)}else Array.isArray(t)&&i?t.forEach(function(t){var e=i.find(function(e){return e&&e[r.idField]===t});e&&n.push(e)}):n=[];return n},rt.prototype.buildTreeNodesByFjd=function(e,i){var n=this,r=this.formatDataSource(e,i);return r.forEach(function(t){var e=r.find(function(e){return t.data[i].parentElement===e.data[n.idField]});e&&e.children.push(t)}),r.filter(function(e){return!e.data[i].parentElement})},rt.decorators=[{type:B.Directive,args:[{selector:"[multiSelectDataMapping]"}]}],rt.ctorParameters=function(){return[{type:N.ViewModel,decorators:[{type:B.Optional}]},{type:O.MultiSelectComponent,decorators:[{type:B.Host},{type:B.Self},{type:B.Optional}]}]},rt.propDecorators={dataSource:[{type:B.Input}],idField:[{type:B.Input}],textField:[{type:B.Input}],valueField:[{type:B.Input}],fjmField:[{type:B.Input}],fjdField:[{type:B.Input}],uiStateField:[{type:B.Input}],selectedId:[{type:B.Input}],selectedIdChanged:[{type:B.Output}]},rt);function rt(e,t){var i=this;this.vm=e,this.multiSelectComponent=t,this.selectedIdChanged=new B.EventEmitter,this.vm.uiState.changes.subscribe(function(e){i.selectedId=e.value})}var ot=(Object.defineProperty(at.prototype,"primaryKey",{get:function(){return this.bindingList.primaryKey},enumerable:!0,configurable:!0}),at.prototype.ngOnInit=function(){this.bindData(),this.registerBindingDataChangeEvent()},at.prototype.ngOnChanges=function(){this.bindData()},at.prototype.ngOnDestroy=function(){this.unRegisterBindingDataChangeEvent()},at.prototype.getPagingInfo=function(){var e=this.viewModel.bindingPath,t=this.viewModel.bindingData.pagingInfo;return"/"===e||e.substr(1).split("/").filter(function(e){return!!e&&0<e.length}).map(function(e){return e.substring(0,e.length-1)}).forEach(function(e){t=t&&t[e]}),t},at.prototype.setListViewPageProps=function(){var e=this.bindingList.toJSON(),t=this.getPagingInfo()||{},i=t.pageIndex,n=void 0===i?1:i,r=t.pageSize,o=void 0===r?0:r,a=(this.getPagingInfo()||{}).total,s=void 0===a?0:a;0===o&&0===s&&(s=e.length),this.listview.supportPaging=this.supportPaged;var p=this.listview.pageIndex=n,l=this.listview.pageSize=o,d=this.listview.total=s;0===o&&(this.listview.pageIndex=n,p=1,d=this.listview.total=s),this.listview.paginationOptions&&(this.listview.paginationOptions.itemsPerPage=l,this.listview.paginationOptions.currentPage=p,this.listview.paginationOptions.pageList=this.listview.pageList,this.listview.paginationOptions.totalItems=d);var u=this.listview.cdr;u&&u.detectChanges();var c=this.listview.pager&&this.listview.pager.paginationDirective;if(c&&c.service)try{c.service.instances[this.listview.pager.id]=Z({},this.listview.paginationOptions),c.service.setTotalItems(this.listview.pager.id,d),c.changeDetectorRef.detectChanges()}catch(h){}},Object.defineProperty(at.prototype,"bindingList",{get:function(){if("/"===this.viewModel.bindingPath||!this.viewModel.bindingPath)return this.bindingData.list;var e=this.viewModel.bindingPath.substr(1),t=(e=e[0].toLowerCase()+e.substring(1,e.length)).split("/").filter(function(e){return""!==e});return this.bindingData.getValue(t)},enumerable:!0,configurable:!0}),at.prototype.bindData=function(){this.setListViewPageProps();var e=this.bindingList.toArray();this.listview.setData(e)},at.prototype.fireSelectedRowChange=function(e){this.selectedRowChange.emit(e)},at.prototype.setSelectionIdToBindingData=function(e){this.bindingList.setCurrentId(e,!0)},at.prototype.onBindingDataChange=function(e){this.bindData(),this.updateSelectedRow(e)},at.prototype.updateSelectedRow=function(e){if(this.bindingList&&this.bindingList.currentId&&(!this.viewModel||!0!==this.viewModel.frameContext.bindingData.rowSelectedEventSuspend)){var t=(this.listview.clickItem||{}).id;(void 0===t?null:t)!==this.bindingList.currentId&&this.selectRow(this.bindingList.currentId)}},at.prototype.selectRow=function(e){this.listview&&"function"==typeof this.listview.selectRow&&this.listview.selectRow(e)},at.prototype.registerBindingDataChangeEvent=function(){var t=this;this.bindingDataChangeEvent=this.bindingData.changes.subscribe(function(e){t.onBindingDataChange(e)})},at.prototype.unRegisterBindingDataChangeEvent=function(){this.bindingDataChangeEvent.unsubscribe()},at.prototype.setChecks=function(e){this.viewModel.uiState.setPropertyValue("ids",e)},at.prototype.changeRow=function(e){var t=e.index,i=e.data;if(!1===e.checkChangeEvent||!e.hasOwnProperty("checkChangeEvent")){if(i&&Array.isArray(i)&&0<i.length){var n=i[0]&&i[0][this.primaryKey]||null;n&&this.setSelectionIdToBindingData(n)}this.listview.activeIndex=t,this.fireSelectedRowChange(e)}},at.prototype.pageChangedHandler=function(e){var t=e.pageInfo.pageIndex,i=e.pageInfo.pageSize;t<1&&(t=1);var n=(t-1)*i;this.bindingData.setPagingInfo(n,i,this.bindingData.bindingPath)},at.prototype.pageSizeChangedHandler=function(e){var t=e.pageInfo,i=t.pageIndex,n=t.pageSize,r=(i-1)*+n;this.bindingData.setPagingInfo(r,n,this.bindingData.bindingPath)},at.prototype.checkValuesChange=function(e){var t=e;this.setChecks(t)},at.decorators=[{type:B.Directive,args:[{selector:"[farrisListviewBinding]"}]}],at.ctorParameters=function(){return[{type:N.BindingData},{type:N.ViewModel},{type:d.ListViewComponent}]},at.propDecorators={supportPaged:[{type:B.Input}],selectedRowChange:[{type:B.Output}],changeRow:[{type:B.HostListener,args:["listClick",["$event"]]}],pageChangedHandler:[{type:B.HostListener,args:["pageChanged",["$event"]]}],pageSizeChangedHandler:[{type:B.HostListener,args:["pageSizeChanged",["$event"]]}],checkValuesChange:[{type:B.HostListener,args:["checkValuesChange",["$event"]]}]},at);function at(e,t,i){this.bindingData=e,this.viewModel=t,this.listview=i,this.supportPaged=!0,this.selectedRowChange=new B.EventEmitter}var st=(Object.defineProperty(pt.prototype,"bindingList",{get:function(){if("/"===this.viewModel.bindingPath||!this.viewModel.bindingPath)return this.bindingData.list;var e=this.viewModel.bindingPath.substr(1),t=(e=e[0].toLowerCase()+e.substring(1,e.length)).split("/").filter(function(e){return""!==e});return this.bindingData.getValue(t)},enumerable:!0,configurable:!0}),pt.prototype.ngOnInit=function(){this.apply()},pt.prototype.ngOnChanges=function(e){this.apply()},pt.prototype.ngOnDestroy=function(){this.detach()},pt.prototype.apply=function(){this.grid&&(this.handleGroupStatus(),this.gridEditable?(this.grid.editable=!0,this.grid.disableHeader(!0),this.handleBeginEditEvent(),this.handleAfterEditEvent(),this.handleEndEditEvent()):(this.grid.editable=!1,this.grid.disableHeader(!1),this.grid&&"function"==typeof this.grid.sort&&this.grid.sortName&&this.grid.sort(),this.detach()))},pt.prototype.handleGroupStatus=function(){if(!1!==this.disableGroupOnEditing){var e=this.grid&&this.grid.groupField||null;if(e)this.gridEditable&&(this.groupFields=[e],this.grid.setGroupFields(""));else if(this.groupFields&&0<this.groupFields.length){var t=this.groupFields.pop();0<this.groupFields.length&&(this.groupFields=[]),this.grid.setGroupFields(t)}}},pt.prototype.handleBeginEditEvent=function(){var l=this;this.beginEditSubscription=this.grid.beginEdit.subscribe(function(e){if(e){var t=e.column;if(t&&t.editor){var p=e.editor.componentRef.instance;if(!p||!p.instance)return;var i=p.instance.mapFields;if("lookup"===t.editor.type||"PersonnelSelector"===t.editor.type||"OrganizationSelector"===t.editor.type||"external-integration"===t.editor.type){var n=p.instance.selectedData;n&&n.subscribe(function(e){i=p.instance.mapFields,l.lookupMapping(e,i)});var r=p.instance.clearMappings;r&&r.subscribe(function(e){var t=Object.assign({},p.instance.mapFields),i=e&&e.value||null,n=p.column&&p.column.field,r=p.instance.textField,o={};if(n){var a=t[r];a&&(t[r]=a.split(",").filter(function(e){return e!==n}).join(","));var s=l.getBindingPathArray();l.bindingData.setValue(s.concat(n.split(".")),i,!0,!0)}Object.keys(t).forEach(function(e){l.setValue(o,e.split("."),"")}),l.lookupMapping(o,t,!0)})}"combo-lookup"===t.editor.type&&p.instance.valueChange.subscribe(function(e){i=p.instance.mapFields,l.lookupMapping(e.selections||[],i)}),p.instance.clear&&p.instance.clear.subscribe(function(){l.lookupMapping(null,i)}),"combolist"===t.editor.type&&i&&p.instance.valueChange.subscribe(function(e){var t=l.getBindingPathArray();l.viewModel.bindingData.setValue(t.concat(i.split(".")),p.instance.selectedValues,!0,!0)})}}})},pt.prototype.handleAfterEditEvent=function(){var r=this;this.grid.afterEdit=function(e,t,i,n){return r.dialogSer.hasDialogOpened()?u.of(!1):r.rts&&r.rts.getFormState("lookup.pending")?u.of(!1):n&&n.formControl?u.of(!0):u.of(!1)}},pt.prototype.handleEndEditEvent=function(){var l=this;this.endEditSubscription=this.grid&&this.grid.endEdit&&this.grid.endEdit.subscribe(function(e){var t=e||{},i=t.value,n=void 0===i?undefined:i,r=t.column,o=void 0===r?undefined:r,a=t.rowData,s=void 0===a?{}:a,p=s&&s[l.grid.idField]||null;l.updateBindingData(n,o,p)})},pt.prototype.updateBindingData=function(e,t,i){if(t){var n=t.dataType,r=t.field.split("."),o=t&&t.editor&&t.editor.options&&t.editor.options.bigNumber;if("date"===n){var a=void 0;a=e?this.dateService.formatTo(e,"yyyy-MM-dd"):e,this.updateBindingList(i,r.join("."),a)}else"datetime"===n?this.updateBindingList(i,r.join("."),e):"number"!==n||o?this.updateBindingList(i,r.join("."),e):null===e||e===undefined?this.updateBindingList(i,r.join("."),null):this.updateBindingList(i,r.join("."),Number(e))}},pt.prototype.updateBindingList=function(e,t,i){if(this.viewModel&&t){var n=t.split(".").filter(function(e){return e}),r=this.getBindingPathArray(),o=this.bindingData.getValue(r);if(o&&e===o.currentItem.primaryKeyValue){var a=r.concat(n);this.bindingData.setValue(a,i,!0,!0)}else{var s=this.bindingList.findById(e);if(s)if(n.length<2)s.setValue(t,i,!0,!0);else{var p=null,l=n.slice(0,n.length-1),d=n[n.length-1];l.forEach(function(e){p=p&&p[e]||s[e]}),p.setValue(d,i,!0,!0)}}}},pt.prototype.detach=function(){this.beginEditSubscription&&"function"==typeof this.beginEditSubscription.unsubscribe&&this.beginEditSubscription.unsubscribe(),this.endEditSubscription&&"function"==typeof this.endEditSubscription.unsubscribe&&this.endEditSubscription.unsubscribe()},pt.prototype.lookupMapping=function(o,a,e){var s=this;if(void 0===e&&(e=!1),a){var t=this.viewModel.frameContext.appContext;t.changeDetectionController.detach();var p=this.getBindingPathArray(),i=Object.keys(a),n=this.getMapFieldsPrimaryKey(a,p),r=n&&n.map(function(e){return e.primaryKey})||[],l=n&&n.map(function(e){return e.primaryField})||[];r&&0<r.length&&(r=ie(new Set(r)),i=this.sortMapFieldKeys(i,r)),o&&!e||i.reverse(),i.forEach(function(t){var i="";o&&(i=o instanceof Array?o.map(function(e){return s.getValue(t,e)}).join(","):s.getValue(t,o));var e=a[t].split(","),n=e.filter(function(e){return l.includes(e)}),r=e.filter(function(e){return!l.includes(e)});(e=o?[].concat(n).concat(r):[].concat(r).concat(n)).forEach(function(e){o?s.viewModel.bindingData.setValue(p.concat(e.split(".")),i,!0,!0):s.viewModel.bindingData.clearValue(p.concat(e.split(".")),!0,!0)})}),t.changeDetectionController.reattach()}},pt.prototype.getValue=function(e,t){return-1===e.indexOf(".")?t[e]:e.split(".").reduce(function(e,t){return e[t]},t)},pt.prototype.getBindingPathArray=function(){var e=this.viewModel.bindingPath;return e?e.split("/").filter(function(e){return""!==e}):[]},pt.prototype.isNumberValue=function(e,t){var i=this.getValue(e,t);return n.isNumber(i)},pt.prototype.getMapFieldsPrimaryKey=function(t,r){if(!t||Object.keys(t).length<1)return null;var o=[];try{var a=this.viewModel.frameContext.repository.entityTypeInfo;Object.keys(t).forEach(function(n){var e=t[n];e&&"string"==typeof e&&e.split(",").filter(function(e){return e}).forEach(function(e){var t=e.split(".");r&&0<r.length&&(t=r.concat(t));var i=a.getPropInfoByPath(t);i&&i.metadataInfo&&!0===i.metadataInfo.primary&&o.push({primaryKey:n,primaryField:e})})})}catch(e){console.error(e)}return o},pt.prototype.setValue=function(e,t,i){e&&(t.length<=1?e[t[0]]=i:t.slice(0,-1).reduce(function(e,t){return e.hasOwnProperty(t)||e.__proto__.hasOwnProperty(t)||(e[t]={}),e[t]},e)[t[t.length-1]]=i)},pt.prototype.sortMapFieldKeys=function(e,t){return!t||t.length<1||!e||e.length<1?e:(e=e.filter(function(e){return!t.includes(e)}),[].concat(t).concat(e))},pt.decorators=[{type:B.Directive,args:[{selector:"[farris-datagrid-editable]"}]}],pt.ctorParameters=function(){return[{type:N.BindingData},{type:N.ViewModel},{type:S.DatagridComponent},{type:a.DateTimeHelperService},{type:B.Injector},{type:_.RuntimeStateService},{type:H.DialogService},{type:B.NgZone}]},pt.propDecorators={gridEditable:[{type:B.Input,args:["farris-datagrid-editable"]}],disableGroupOnEditing:[{type:B.Input,args:["disableGroupOnEditing"]}]},pt);function pt(e,t,i,n,r,o,a,s){this.bindingData=e,this.viewModel=t,this.grid=i,this.dateService=n,this.injector=r,this.rts=o,this.dialogSer=a,this.ngZone=s,this.disableGroupOnEditing=!0,this.groupFields=[]}var lt=(dt.prototype.ngOnDestroy=function(){},dt);function dt(e){var t=this;this.appContext=e,this.messagePipe=this.appContext&&this.appContext.messagePipe,this.messagePipe&&this.messagePipe.subscribe(function(e){e&&"endEdit"===e.type&&t.endEdit(e)})}var ut,ct=(X(ht,ut=lt),ht.prototype.ngOnInit=function(){this.elementRef&&(this.nativeElement=this.elementRef.nativeElement)},ht.prototype.endEdit=function(e){if(this.nativeElement){var t=this.nativeElement.parentNode||this.nativeElement.parentElement,i=t&&Array.from(t.getElementsByTagName("input"))||[];i&&0<i.length&&i.forEach(function(e){e&&"function"==typeof e.blur&&e.blur()})}},ht.decorators=[{type:B.Directive,args:[{selector:"[input-end-edit]"}]}],ht.ctorParameters=function(){return[{type:N.AppContext},{type:B.ElementRef}]},ht);function ht(e,t){var i=ut.call(this,e)||this;return i.appContext=e,i.elementRef=t,i}var ft,gt=(X(mt,ft=lt),mt.prototype.endEdit=function(e){this.datagrid&&"function"==typeof this.datagrid.endCellEdit&&this.datagrid.endCellEdit()},mt.decorators=[{type:B.Directive,args:[{selector:"[farris-grid-end-edit]"}]}],mt.ctorParameters=function(){return[{type:N.AppContext},{type:S.DatagridComponent}]},mt);function mt(e,t){var i=ft.call(this,e)||this;return i.appContext=e,i.datagrid=t,i}var yt,vt=(X(bt,yt=lt),bt.prototype.endEdit=function(e){this.editor&&"function"==typeof this.editor.endEdit&&this.editor.endEdit()},bt.decorators=[{type:B.Directive,args:[{selector:"[html-editor-end-edit]"}]}],bt.ctorParameters=function(){return[{type:N.AppContext},{type:g.HtmlEditorComponent}]},bt);function bt(e,t){var i=yt.call(this,e)||this;return i.appContext=e,i.editor=t,i}var Ct,xt=(X(Dt,Ct=lt),Dt.prototype.endEdit=function(e){this.grid&&"function"==typeof this.grid.closeCell&&this.grid.closeCell()},Dt.decorators=[{type:B.Directive,args:[{selector:"[kendo-grid-end-edit]"}]}],Dt.ctorParameters=function(){return[{type:N.AppContext},{type:K.GridComponent}]},Dt);function Dt(e,t){var i=Ct.call(this,e)||this;return i.appContext=e,i.grid=t,i}var It=(St.prototype.execute=function(e,t){if(e&&""!==e&&"undefined"!==e){var i=this.viewModel;return t&&(i=i.frameContext.appContext.frameContextManager.getFrameContextById(t).viewModel),i[e]()}},St.decorators=[{type:B.Directive,args:[{selector:"[farris-remote-summary-command]"}]}],St.ctorParameters=function(){return[{type:N.ViewModel},{type:S.DatagridComponent}]},St.propDecorators={remoteSummaryCommand:[{type:B.Input,args:["farris-remote-summary-command"]}]},St);function St(e,t){var n=this;this.viewModel=e,this.grid=t;var i=this.viewModel.frameContext.getFormAppContext();i&&i.hasOwnProperty("messagePipe")&&i.messagePipe.subscribe(function(e){if("query"===(e&&e.type||null)&&n.remoteSummaryCommand&&"server"===n.grid.footerDataFrom){var t=n.remoteSummaryCommand.split("."),i=null;t.forEach(function(e){i=i&&i[e]||n[e]}),"function"==typeof i&&i().subscribe(function(e){n.grid.footerData=e})}})}var wt=(Object.defineProperty(Et.prototype,"focusState",{set:function(e){this._state.next(e)},enumerable:!0,configurable:!0}),Et.prototype.ngOnInit=function(){var t=this;this.selfEl=this.el.nativeElement,this._state.subscribe(function(e){!1===e&&t.selfEl&&("farris-html-editor"===t.selfEl.nodeName.toLowerCase()?t.setHtmlEditorFocus():t.setFocus())})},Et.prototype.setFocus=function(){var e=this.selfEl.querySelectorAll("input");e.length?e[0].focus():this.selfEl.focus()},Et.prototype.setHtmlEditorFocus=function(){var e=this.selfEl.querySelector('div[contenteditable="true"]'),t=window.getSelection();t.selectAllChildren(e),t.collapseToEnd()},Et.decorators=[{type:B.Directive,args:[{selector:"[farris-set-focus]"}]}],Et.ctorParameters=function(){return[{type:B.Renderer2},{type:B.Injector},{type:B.ElementRef}]},Et.propDecorators={focusState:[{type:B.Input}]},Et);function Et(e,t,i){this.rd=e,this.injector=t,this.el=i,this._state=new u.BehaviorSubject({})}var Pt=(Object.defineProperty(Rt.prototype,"bindingData",{get:function(){return this.frameContext.bindingData},enumerable:!0,configurable:!0}),Object.defineProperty(Rt.prototype,"bindingList",{get:function(){return this.bindingData.getList()},enumerable:!0,configurable:!0}),Rt.prototype.ngOnInit=function(){var t=this;this.bindData(),this.uploadAndPreviewComponent.orderField="fileSortOrder",this.bindingData.changes.subscribe(function(e){e.type!==N.ChangeType.Load&&e.type!==N.ChangeType.Append&&e.type!==N.ChangeType.Remove||t.bindData()})},Rt.prototype.ngOnChanges=function(e){},Rt.prototype.bindData=function(){var e=this.getFileInfos();this.componentRef&&(this.componentRef.fileInfos=e)},Rt.prototype.getFileInfos=function(){var r=this,e=this.bindingList.toJSON(),o=this.bindingList.primaryKey,a=[];return e.forEach(function(t){r.getValueByPath(t,o);var e=r.getValueByPath(t,r.fileIdKey),i={id:e,name:r.getValueByPath(t,r.fileNameKey),size:r.getValueByPath(t,r.fileSizeKey),createTime:r.getValueByPath(t,r.fileCreateTimeKey),originalData:t,extend:{metadataId:e}};if(r.extendFileInfo&&Array.isArray(r.extendFileInfo)&&0<r.extendFileInfo.length&&r.extendFileInfo.forEach(function(e){i[e.key]=r.getValueByPath(t,e.path)}),r.fileSortOrderKey){var n=r.getValueByPath(t,r.fileSortOrderKey);i.fileSortOrder=n}a.push(i)}),a},Rt.prototype.getValueByPath=function(e,t){var i=t.split("."),n=e;return i.forEach(function(e){n=n&&n[e]}),n},Rt.prototype.getUdtPaths=function(){var e=this.fileIdKey.split(".");return e.pop(),e},Object.defineProperty(Rt.prototype,"fileSizeKey",{get:function(){return this.getUdtPaths().concat(["fileSize"]).join(".")},enumerable:!0,configurable:!0}),Object.defineProperty(Rt.prototype,"fileCreateTimeKey",{get:function(){return this.getUdtPaths().concat(["fileCreateTime"]).join(".")},enumerable:!0,configurable:!0}),Object.defineProperty(Rt.prototype,"componentRef",{get:function(){return this.previewComponent||this.uploadAndPreviewComponent||null},enumerable:!0,configurable:!0}),Rt.decorators=[{type:B.Directive,args:[{selector:"[farrisFilePreviewBinding]"}]}],Rt.ctorParameters=function(){return[{type:r.FFilePreviewComponent,decorators:[{type:B.Optional}]},{type:N.FrameContext},{type:r.UploadAndPreviewComponent,decorators:[{type:B.Optional}]},{type:B.Injector,decorators:[{type:B.Optional}]}]},Rt.propDecorators={extendFileInfo:[{type:B.Input,args:["extendFileInfo"]}],fileIdKey:[{type:B.Input,args:["farrisFileIdKey"]}],fileSortOrderKey:[{type:B.Input,args:["farrisFileSortOrderKey"]}],fileNameKey:[{type:B.Input,args:["farrisFileNameKey"]}]},Rt);function Rt(e,t,i,n){this.previewComponent=e,this.frameContext=t,this.uploadAndPreviewComponent=i,this.injector=n}var Ot="DISCUSSION_REPLY_MESSAGE_INFO",Lt=(Mt.prototype.ngOnInit=function(){var t=this;this.discussionEditorComponent.replyUser=this.viewModel.frameContext.root.viewModel.uiState[Ot]||{},this.viewModel.frameContext.root.viewModel.uiState.changes.subscribe(function(e){e.field===Ot&&(t.discussionEditorComponent.replyUser=t.viewModel.frameContext.root.viewModel.uiState[Ot]||{})}),this.queryFrequentAtUsersCommand?this.queryFrequentAtUsers():this.queryAtUsers(),this.queryAllOrgs()},Mt.prototype.queryAllOrgs=function(){var t=this;this.execute(this.queryAllOrgsCommand).subscribe(function(e){e&&(t.discussionEditorComponent.sectionData=e)})},Mt.prototype.queryAtUsers=function(){var n=this;this.execute(this.userQueryCommand).subscribe(function(e){if(e){var t=e.users,i=void 0===t?[]:t;n.discussionEditorComponent.personnels=i}})},Mt.prototype.queryFrequentAtUsers=function(){var t=this;this.execute(this.queryFrequentAtUsersCommand).subscribe(function(e){e&&(t.discussionEditorComponent.personnels=e&&e.users||[])})},Mt.prototype.pageChangedHandler=function(e){var t=this,i=e||{},n=i.msgInfo,r=void 0===n?0:n,o=i.text,a=void 0===o?"":o,s=i.visibility,p=void 0===s?"ALL":s,l=i.parentId,d=void 0===l?null:l;1===r?this.execute(this.addCommentCommand,{text:a,parentId:d,visibility:p}).pipe(b.tap(function(){t.viewModel.frameContext.appContext.messagePipe.next("onCommentAdd")}),b.catchError(function(e){return u.EMPTY})).subscribe():(this.viewModel.frameContext.root.viewModel.uiState[Ot]={},this.discussionEditorComponent.replyUser={})},Mt.prototype.execute=function(e,t){var i=this;if(!e||""===e||"undefined"===e)return u.of(null);void 0===t&&(t={});var n=e.split("."),r=null;return n.forEach(function(e){r=r&&r[e]||i[e]}),"function"==typeof r?r(t):u.of(null)},Mt.decorators=[{type:B.Directive,args:[{selector:"[farris-discussion-editor-binding]"}]}],Mt.ctorParameters=function(){return[{type:B.Injector},{type:P.DiscussionEditorComponent},{type:N.ViewModel}]},Mt.propDecorators={userQueryCommand:[{type:B.Input,args:["userQueryCommand"]}],addCommentCommand:[{type:B.Input,args:["addCommentCommand"]}],queryAllOrgsCommand:[{type:B.Input,args:["queryAllOrgsCommand"]}],queryFrequentAtUsersCommand:[{type:B.Input,args:["queryFrequentAtUsersCommand"]}],pageChangedHandler:[{type:B.HostListener,args:["valueChange",["$event"]]}]},Mt);function Mt(e,t,i){this.injector=e,this.discussionEditorComponent=t,this.viewModel=i}var Ft=(Tt.prototype.ngOnInit=function(){var t=this;this.viewModel.frameContext.appContext.messagePipe.subscribe(function(e){"onCommentAdd"===e&&t.queryComments()}),this.viewModel.bindingData.changes.subscribe(function(e){e.type!==N.ChangeType.Load&&e.type!==N.ChangeType.SelectionChanged||t.queryComments()})},Tt.prototype.queryComments=function(e,t){var s=this;void 0===e&&(e=this.discussionListComponent.pageIndex-1||0),void 0===t&&(t=this.discussionListComponent.supportPaging?this.discussionListComponent.pageSize:1e4),this.execute(this.commentsQueryCommand,{pageIndex:e,pageSize:t}).pipe(b.catchError(function(e){return u.EMPTY})).subscribe(function(e){if(e){e.comments;var t=e.pageIndex,i=void 0===t?0:t,n=e.pageSize,r=void 0===n?10:n,o=e.totalCount,a=void 0===o?0:o;s.discussionListComponent.pageIndex=parseInt(i)+1,s.discussionListComponent.supportPaging&&(s.discussionListComponent.pageSize=r),s.discussionListComponent.total=a,s.discussionListDirective.discussionListData=e}})},Tt.prototype.replyMessagedHandler=function(e){this.viewModel.frameContext.root.viewModel.uiState.setPropertyValue("DISCUSSION_REPLY_MESSAGE_INFO",e)},Tt.prototype.pageChangedHandler=function(e){var t=e.pageInfo||{},i=t.pageIndex,n=void 0===i?1:i,r=t.pageSize,o=void 0===r?10:r;this.queryComments(n-1,o)},Tt.prototype.execute=function(e,t){var i=this;if(!e||""===e||"undefined"===e)return u.of(null);var n=e.split("."),r=null;return n.forEach(function(e){r=r&&r[e]||i[e]}),"function"==typeof r?r(t):u.of(null)},Tt.decorators=[{type:B.Directive,args:[{selector:"[farris-discussion-list-binding]"}]}],Tt.ctorParameters=function(){return[{type:B.Injector},{type:P.DiscussionListComponent},{type:N.ViewModel},{type:P.DiscussionListDirective}]},Tt.propDecorators={commentsQueryCommand:[{type:B.Input,args:["commentsQueryCommand"]}],replyMessagedHandler:[{type:B.HostListener,args:["replyMessage",["$event"]]}],pageChangedHandler:[{type:B.HostListener,args:["pageChanged",["$event"]]}]},Tt);function Tt(e,t,i,n){this.injector=e,this.discussionListComponent=t,this.viewModel=i,this.discussionListDirective=n}var kt=(Object.defineProperty(Nt.prototype,"bindingData",{get:function(){return this.frameContext.bindingData},enumerable:!0,configurable:!0}),Object.defineProperty(Nt.prototype,"bindingList",{get:function(){return this.bindingData.getList()},enumerable:!0,configurable:!0}),Nt.prototype.getHierarchyInfoField=function(){var e=this.hierarchyInfoKey.split("/");return e[e.length-1]},Nt.prototype.ngOnChanges=function(e){},Nt.prototype.ngOnInit=function(){var t=this;this.hierarchyInfoField=this.getHierarchyInfoField(),this.frameContext.getVirtualRootFrameContext().setParam("hierarchyInfoKey",this.hierarchyInfoKey),this.bindingData.changes.subscribe(function(e){t.bindData(e),t.updateSelectedRow(e)}),this.frameContext.viewModel.uiState.setPropertyValue("ids",[])},Nt.prototype.getEntityArr=function(){var e=this.frameContext.repository.entityCollection,t=this.frameContext.bindingData.bindingPath;if(!t||"/"===t)return e.toArray();var i=this.frameContext.bindingData.list,n=t.split("/").filter(function(e){return e}),r=[];return n.forEach(function(e){r.push(i.primaryKey+":"+i.currentId),r.push(e),i=i.currentItem[e]}),e.getEntitiesByPath(r).toArray()},Nt.prototype.setActualIndex=function(t,e){var i=this;if(!(t.length<1)){var n={index:0},r=t[0].primaryKey;e.forEach(function(e){i.traverseTree(e,n,t,r)})}},Nt.prototype.traverseTree=function(t,i,n,r){var o=this,e=n.find(function(e){return e[r]===t.data[r]});e&&(Object.defineProperty(e,"__ACTUAL_INDEX__",{value:i.index}),i.index++),t.children.forEach(function(e){o.traverseTree(e,i,n,r)})},Nt.prototype.handleChange=function(e){if(!e)return!1;switch(e.type){case N.ChangeType.SelectionChanged:case N.ChangeType.GlobalSelectionChanged:return this.handleSelectionChanged(e);case N.ChangeType.ValueChanged:return this.handleValueChanged(e);default:return!1}},Nt.prototype.handleSelectionChanged=function(e){if(e.type===N.ChangeType.SelectionChanged||e.type===N.ChangeType.GlobalSelectionChanged){var t=e.path,i=this.bindingData.bindingPath.split("/").filter(function(e){return e});if(t.length===i.length){for(var n=!0,r=0;r<t.length;r++)t[r]!==i[r]&&(n=!1);if(n)return!0}}return!1},Nt.prototype.handleValueChanged=function(e){var t,i,n,r;if(e.type!==N.ChangeType.ValueChanged)return!1;var o=e.path,a=this.bindingData.bindingPath.split("/").filter(function(e){return e});try{for(var s=ee(a),p=s.next();!p.done;p=s.next()){var l=p.value;if(0<o.length){if(l!==o[0])return!1;o.shift()}}}catch(b){t={error:b}}finally{try{p&&!p.done&&(i=s["return"])&&i.call(s)}finally{if(t)throw t.error}}var d=e.id;if(d){var u=this.bindingList.primaryKey,c=this.treeTable.value,h=null;try{for(var f=ee(c),g=f.next();!g.done;g=f.next()){var m=g.value,y=this.findTreeNodeById(m,u,d);if(y){h=y;break}}}catch(C){n={error:C}}finally{try{g&&!g.done&&(r=f["return"])&&r.call(f)}finally{if(n)throw n.error}}if(h&&1===o.length){var v=o.shift();if(h.data.hasOwnProperty(v)&&e.hasOwnProperty("value"))return h.data[v]=e.value,!0}}return!1},Nt.prototype.findTreeNodeById=function(e,t,i){var n,r;if(!e)return null;if(e.data.hasOwnProperty(t)&&e.data[t]===i)return e;if(e.children)try{for(var o=ee(e.children),a=o.next();!a.done;a=o.next()){var s=a.value,p=this.findTreeNodeById(s,t,i);if(p)return p}}catch(l){n={error:l}}finally{try{a&&!a.done&&(r=o["return"])&&r.call(o)}finally{if(n)throw n.error}}return null},Nt.prototype.bindData=function(e){if(!this.handleChange(e)){var t=this.treeTable.value,i=this.bindingList.toJSON({ignoreMultiLangInput:!0}),n=[];if(i&&0<i.length){var r=i[0][this.hierarchyInfoField],o=Le.getBuilder(r);if(null==o)throw new Error("TreeTable builder is null!");var a=-1,s=this.treeTable.expandLevel;void 0!==s&&(a=s);var p={expandLevel:a,component:this.treeTable};n=new o(i,t,this.bindingList.primaryKey,this.hierarchyInfoField,p).build();var l=this.getEntityArr();this.setActualIndex(l,n)}this.treeTable.lazy||(this.treeTable.totalRecords=this.treeTable._value?this.treeTable._value.length:0,"single"==this.treeTable.sortMode&&this.treeTable.sortField?this.treeTable.sortSingle():"multiple"==this.treeTable.sortMode&&this.treeTable.multiSortMeta?this.treeTable.sortMultiple():this.treeTable.hasFilter()&&this.treeTable._filter()),this.treeTable.tableService.onUIUpdate(n),this.treeTable.value=n,this.treeTable.updateSerializedValue()}},Nt.prototype.updateSelectedRow=function(e){var t=this.bindingList.currentId;if(this.treeTableSelectedEvent)return this.treeTableSelectedEvent=!1,void(this.selectedRowId=t);var i=this.treeTable.serializedValue,n=i&&i.find(function(e){return e&&e.node&&e.node.data&&e.node.data.id===t})||null;if(n){if(this.treeTable.isSelected(n.node)||t===this.selectedRowId)return;this.selectedRowId=t,this.treeTable.handleRowClick({rowNode:n,originalEvent:{target:{nodeName:""}}})}},Nt.prototype.onEditInitHandler=function(e){this.nodeSelectChange.emit(e.data);var t=e.data[this.idField];this.setCurrentIdToBindingList(t)},Nt.prototype.onEditCompleteHandler=function(e){var t=e.field,i=this.columns.find(function(e){return e.field===t});if(!(t&&i&&i.editor&&i.editor.options&&"EditorTypes.LOOKUP"===i.editor.options.type)&&e&&e.hasOwnProperty("data")){var n=e.data[this.frameContext.repository.primaryKey],r=this.getValue(t,e.data),o=(this.frameContext.viewModel.bindingPath||"/").split("/").filter(function(e){return e}),a=this.bindingData.getValue(o).findById(n),s=this.getValue(t,a),p=this.treeTable.columns.find(function(e){return e.field===t}),l=p&&p.dataType||null;if("date"===l||"datetime"===l){if(this.dateService){var d=p&&p.formatter&&p.formatter.options&&p.formatter.options.format||"yyyy-MM-dd";r=(r=this.dateService.formatTo(r,d))||null}}else"number"===l&&(r=Number(r));r!==s&&this.updateBindingList(n,t,r)}},Nt.prototype.onNodeExpandHandler=function(e){var t=e&&e.node&&e.node.id||null;if(t){var i=this.frameContext.getVirtualRootFrameContext(),n=i.getParam("TREE_LATEST_EXPANDED_ID")||[];n.push(t),i.setParam("TREE_LATEST_EXPANDED_ID",n)}},Nt.prototype.onNodeCollapseHandler=function(e){},Nt.prototype.onNodeSelectHandler=function(e){var t=e&&e.node&&e.node.data&&e.node.data[this.frameContext.repository.primaryKey]||null;t!==this.bindingList.currentId&&(this.treeTableSelectedEvent=!0,this.setCurrentIdToBindingList(t))},Nt.prototype.onNodeUnselectHandler=function(e){this.setCurrentIdToBindingList(null)},Nt.prototype.setNodeExpandedValue=function(e){if(e&&this.oldTreeNodeMap&&!(Object.keys(this.oldTreeNodeMap).length<=0))try{var t=e.node.data.id;this.oldTreeNodeMap[t].expanded=e.expanded}catch(i){console.warn("setNodeExpandedValue error:"+i.message)}},Nt.prototype.setCurrentIdToBindingList=function(e){this.bindingList.currentId!==e&&this.bindingList.setCurrentId(e,!0)},Nt.prototype.getPaths=function(){var e=[];if(this.frameContext.viewModel&&this.frameContext.viewModel.bindingPath&&"/"!==this.frameContext.viewModel.bindingPath){var t=this.frameContext.viewModel.bindingPath;return e=t.substring(1,t.length).split("/")}return e},Nt.prototype.updateBindingList=function(e,t,i){if(t){var n=t.split(".").filter(function(e){return e}),r=this.getBindingPathArray(),o=this.bindingData.getValue(r),a=r.concat(n);if(o&&e===o.currentItem.primaryKeyValue)this.bindingData.setValue(a,i,!0,!0);else{var s=this.bindingList.findById(e);if(s)if(n.length<2)s.setValue(t,i,!0,!0,undefined,this.bindingData.getValudChangeInvokerFactory()(a));else{var p=null,l=n.slice(0,n.length-1),d=n[n.length-1];l.forEach(function(e){p=p&&p[e]||s[e]}),p.setValue(d,i,!0,!0,undefined,this.bindingData.getValudChangeInvokerFactory()(a))}}}},Nt.prototype.getBindingPathArray=function(){var e=this.frameContext.viewModel.bindingPath;return e?e.split("/").filter(function(e){return""!==e}):[]},Nt.prototype.getValue=function(e,t){return-1===e.indexOf(".")?t[e]:e.split(".").reduce(function(e,t){return e[t]},t)},Nt.prototype.setChecks=function(e){this.frameContext.viewModel.uiState.setPropertyValue("ids",e)},Nt.decorators=[{type:B.Directive,args:[{selector:"[farrisPrimengTreeTableBinding]"}]}],Nt.ctorParameters=function(){return[{type:o.TreeTable},{type:N.FrameContext},{type:a.DateTimeHelperService}]},Nt.propDecorators={hierarchyInfoKey:[{type:B.Input,args:["farrisHierarchyInfoKey"]}],columns:[{type:B.Input,args:["columns"]}],idField:[{type:B.Input,args:["farrisPrimengTreeTableIdField"]}],nodeSelectChange:[{type:B.Output}],onEditInitHandler:[{type:B.HostListener,args:["onEditInit",["$event"]]}],onEditCompleteHandler:[{type:B.HostListener,args:["onEditComplete",["$event"]]}],onNodeExpandHandler:[{type:B.HostListener,args:["onNodeExpand",["$event"]]}],onNodeCollapseHandler:[{type:B.HostListener,args:["onNodeCollapse",["$event"]]}],onNodeSelectHandler:[{type:B.HostListener,args:["onNodeSelect",["$event"]]}],onNodeUnselectHandler:[{type:B.HostListener,args:["onNodeUnselect",["$event"]]}]},Nt);function Nt(e,t,i){this.treeTable=e,this.frameContext=t,this.dateService=i,this.selectedRowId=null,this.treeTableSelectedEvent=null,this.nodeSelectChange=new B.EventEmitter,this.oldTreeNodeMap={}}var jt=(Vt.prototype.ngOnDestroy=function(){this.updateValidateRule(!1)},Vt.prototype.ngOnChanges=function(e){this.updateValidateRule(this.requiredOn)},Vt.prototype.updateValidateRule=function(e){this.field&&this.frameContext.form.updateFieldValidateRule(this.field,e)},Vt.decorators=[{type:B.Directive,args:[{selector:"[farris-dynamic-required]"}]}],Vt.ctorParameters=function(){return[{type:N.FrameContext},{type:B.Injector}]},Vt.propDecorators={field:[{type:B.Input,args:["farris-dynamic-required"]}],requiredOn:[{type:B.Input,args:["requiredOn"]}]},Vt);function Vt(e,t){this.frameContext=e,this.injector=t,this.requiredOn=!1}var Ht=(Bt.prototype.ngOnInit=function(){this.setComponentRef()},Bt.prototype.setComponentRef=function(){var e=this.viewModel&&this.viewModel.frameContext&&this.viewModel.frameContext.getFormAppContext(),t=this.viewModel&&this.viewModel.frameContext&&this.viewModel.frameContext.frameId,i=this.editor,n=i&&i.injector&&i.injector.get(B.ElementRef,null),r=n&&n.nativeElement&&n.nativeElement.id||null;if(t&&r){var o=e&&e.componentRefs&&e.componentRefs.get(t)||new Map;e&&e.componentRefs&&e.componentRefs.set(t,o.set(r,this.editor))}},Bt.decorators=[{type:B.Directive,args:[{selector:"[farris-editor],[farris-editor-bind]"}]}],Bt.ctorParameters=function(){return[{type:N.ViewModel},{type:s.EditorComponent}]},Bt);function Bt(e,t){this.viewModel=e,this.editor=t}var At=(Kt.prototype.onQuery=function(e){this.frameContext&&(this.frameContext.repository.entityCollection.pageIndex=1)},Kt.decorators=[{type:B.Directive,args:[{selector:"[farris-querysolution-event-bind]"}]}],Kt.ctorParameters=function(){return[{type:B.Injector},{type:p.QuerySolutionComponent},{type:N.FrameContext}]},Kt.propDecorators={onQuery:[{type:B.HostListener,args:["queryEmitter"]}]},Kt);function Kt(e,t,i){this.injector=e,this.component=t,this.frameContext=i}var _t=(zt.prototype.ngOnInit=function(){this.localize()},zt.prototype.localize=function(){if(this.userSettings&&this.componentRef){var e=this.userSettings,t=e.dateFormat,i=void 0===t?null:t,n=e.timeFormat,r=void 0===n?null:n;if(null===i&&null===r)return;r&&r&&!0===this.componentRef.showTime?(this.componentRef.dateFormat=i+" "+r,this.componentRef.dateOpts.dateFormat=i+" "+r,this.componentRef.updateValue(this.componentRef.value)):i&&(this.componentRef.dateFormat=""+i,this.componentRef.dateOpts.dateFormat=""+i,this.componentRef.updateValue(this.componentRef.value))}},zt.decorators=[{type:B.Directive,args:[{selector:"[farris-date-localization]"}]}],zt.ctorParameters=function(){return[{type:B.Injector},{type:undefined,decorators:[{type:B.Inject,args:[N.UserSettingsToken]}]},{type:v.FarrisDatepickerComponent}]},zt);function zt(e,t,i){this.injector=e,this.userSettings=t,this.componentRef=i}var Gt=(qt.prototype.ngOnInit=function(){this.localize()},qt.prototype.localize=function(){},qt.decorators=[{type:B.Directive,args:[{selector:"[farris-number-localization]"}]}],qt.ctorParameters=function(){return[{type:B.Injector},{type:undefined,decorators:[{type:B.Inject,args:[N.UserSettingsToken]}]},{type:x.NumberSpinnerComponent}]},qt);function qt(e,t,i){this.injector=e,this.userSettings=t,this.componentRef=i}var Ut=($t.prototype.ngOnInit=function(){this.localize()},$t.prototype.localize=function(){if(this.userSettings&&this.componentRef){var e=this.userSettings.timeFormat,t=void 0===e?null:e;t&&(this.componentRef.format=t)}},$t.decorators=[{type:B.Directive,args:[{selector:"[farris-time-localization]"}]}],$t.ctorParameters=function(){return[{type:B.Injector},{type:undefined,decorators:[{type:B.Inject,args:[N.UserSettingsToken]}]},{type:C.TimePickerComponent}]},$t);function $t(e,t,i){this.injector=e,this.userSettings=t,this.componentRef=i}var Wt=(Jt.prototype.ngOnInit=function(){},Jt.prototype.transform=function(){var r=this;this.componentRef&&(this.componentRef.beforeWriteValue=function(e,t){var i=t.localizationType,n=void 0===i?null:i;return t.showTime,e?n&&e?(n=n.toLowerCase(),e=r.transformValue(e,n)):undefined:""})},Jt.prototype.transformValue=function(e,t){return"date"===t?this.transformDate(e):"datetime"===t?this.transformDateTime(e):e},Jt.prototype.transformDate=function(e){var t=this.userSettings&&this.userSettings.dateFormat||"YYYY-MM-DD";if(!t||!e)return e;var i=V(e);return i.isValid()?(t=this.parseDateFormat(t),i.format(t)):e},Jt.prototype.transformDateTime=function(e){var t=this.userSettings&&this.userSettings.dateFormat||"YYYY-MM-DD",i=this.userSettings&&this.userSettings.timeFormat||"HH:mm:ss";if(!t||!i)return e;var n=V(e);if(!n.isValid())return e;var r=(t=t&&this.parseDateFormat(t))+" "+(i=i&&this.parseTimeFormat(i));return n.format(r)},Jt.prototype.transformNumber=function(e){if(null===e||e===undefined||""===e)return"";var t=new j.BigNumber(e);if(!j.BigNumber.isBigNumber(t))return e;var i=t.isNegative(),n=this.buildNumberFormat(),r=this.numberFormat||{},o=r.negativeSign,a=void 0===o?null:o,s=r.numberDecimalDigits,p=void 0===s?null:s;return i&&null!==a?(n.prefix=a,t.absoluteValue().toFormat(p,null,n)):t.toFormat(p,null,n)},Jt.prototype.parseDateFormat=function(e){return e.replace(/y/g,"Y").replace(/d/g,"D")},Jt.prototype.parseTimeFormat=function(e){return e.replace(/M/g,"m")},Jt.prototype.buildNumberFormat=function(){if(this.numberFormat){var e=this.numberFormat,t=e.numberDecimalSeparator,i=void 0===t?null:t,n=e.numberGroupSeparator,r=void 0===n?null:n,o={groupSize:3};return null!==i&&(o.decimalSeparator=i),null!==r&&(o.groupSeparator=r),o}},Object.defineProperty(Jt.prototype,"numberFormat",{get:function(){return this.userSettings&&this.userSettings.numberFormat||null},enumerable:!0,configurable:!0}),Jt.decorators=[{type:B.Directive,args:[{selector:"[farris-text-localization]"}]}],Jt.ctorParameters=function(){return[{type:B.Injector},{type:undefined,decorators:[{type:B.Inject,args:[N.UserSettingsToken]}]},{type:l.TextComponent}]},Jt.propDecorators={localization:[{type:B.Input,args:["localization"]}]},Jt);function Jt(e,t,i){this.injector=e,this.userSettings=t,this.componentRef=i,this.transform()}var Yt=(Qt.prototype.ngOnInit=function(){if("number"==typeof this.index&&this.elementRef){var e=this.elementRef.nativeElement;if(e){var t=e.getAttribute("id");if(t){var i=t+"_"+this.index;this.elementRef.nativeElement.setAttribute("id",i),this.elementRef.nativeElement.setAttribute("name",i),this.elementRef.nativeElement.setAttribute("original_id",t)}}}},Qt.decorators=[{type:B.Directive,args:[{selector:"[farris-checkbox-modification]"}]}],Qt.ctorParameters=function(){return[{type:B.Injector},{type:B.ElementRef}]},Qt.propDecorators={index:[{type:B.Input}]},Qt);function Qt(e,t){this.injector=e,this.elementRef=t}var Xt=(Zt.prototype.ngOnInit=function(){if("number"==typeof this.index&&this.elementRef){var e=this.elementRef.nativeElement;if(e){var t=e.getAttribute("for");t&&this.elementRef.nativeElement.setAttribute("for",t+"_"+this.index)}}},Zt.decorators=[{type:B.Directive,args:[{selector:"[farris-label-modification]"}]}],Zt.ctorParameters=function(){return[{type:B.Injector},{type:B.ElementRef}]},Zt.propDecorators={index:[{type:B.Input}]},Zt);function Zt(e,t){this.injector=e,this.elementRef=t}var ei=(Object.defineProperty(ti.prototype,"lookupValue",{set:function(e){"lookup"===this.lookupType&&this.lookup?this.lookup.writeValue(e):"comboLookup"===this.lookupType&&this.comboLookup&&this.comboLookup.writeValue(e)},enumerable:!0,configurable:!0}),ti.decorators=[{type:B.Directive,args:[{selector:"[farris-lookup-binding]"}]}],ti.ctorParameters=function(){return[{type:I.LookupGridComponent,decorators:[{type:B.Optional}]},{type:M.ComboLookupComponent,decorators:[{type:B.Optional}]}]},ti.propDecorators={lookupType:[{type:B.Input}],lookupValue:[{type:B.Input,args:["farris-lookup-binding"]}]},ti);function ti(e,t){this.lookup=e,this.comboLookup=t}var ii=(ni.prototype.ngOnInit=function(){var e=this.elementRef&&this.elementRef.nativeElement&&this.elementRef.nativeElement.id;this.frameContext&&e&&this.frameContext.componentRefManager.add(e,this.component)},ni.prototype.ngOnDestroy=function(){},ni.prototype.ngAfterViewInit=function(){},ni.decorators=[{type:B.Directive,args:[{selector:"[listNavRef]"}]}],ni.ctorParameters=function(){return[{type:B.Injector},{type:R.ListNavComponent},{type:B.ElementRef},{type:N.FrameContext}]},ni);function ni(e,t,i,n){this.injector=e,this.component=t,this.elementRef=i,this.frameContext=n}var ri=(oi.prototype.ngOnInit=function(){var e=this.elementRef&&this.elementRef.nativeElement&&this.elementRef.nativeElement.id;this.frameContext&&e&&this.frameContext.componentRefManager.add(e,this.component)},oi.prototype.ngOnDestroy=function(){},oi.prototype.ngAfterViewInit=function(){},oi.decorators=[{type:B.Directive,args:[{selector:"[listViewRef]"}]}],oi.ctorParameters=function(){return[{type:B.Injector},{type:d.ListViewComponent},{type:B.ElementRef},{type:N.FrameContext}]},oi);function oi(e,t,i,n){this.injector=e,this.component=t,this.elementRef=i,this.frameContext=n}var ai=(si.prototype.ngOnInit=function(){var e=this.elementRef&&this.elementRef.nativeElement&&this.elementRef.nativeElement.id;this.frameContext&&e&&this.frameContext.componentRefManager.add(e,this.component)},si.prototype.ngOnDestroy=function(){},si.decorators=[{type:B.Directive,args:[{selector:"[listFilterRef]"}]}],si.ctorParameters=function(){return[{type:B.Injector},{type:c.ListFilterComponent},{type:B.ElementRef},{type:N.FrameContext}]},si);function si(e,t,i,n){this.injector=e,this.component=t,this.elementRef=i,this.frameContext=n}var pi=(li.prototype.ngOnInit=function(){var e=this.elementRef&&this.elementRef.nativeElement&&this.elementRef.nativeElement.id;this.frameContext&&e&&this.frameContext.componentRefManager.add(e,this.component)},li.prototype.ngOnDestroy=function(){},li.decorators=[{type:B.Directive,args:[{selector:"[filterRef]"}]}],li.ctorParameters=function(){return[{type:B.Injector},{type:h.FilterComponent},{type:B.ElementRef},{type:N.FrameContext}]},li);function li(e,t,i,n){this.injector=e,this.component=t,this.elementRef=i,this.frameContext=n}var di=(ui.prototype.ngOnInit=function(){var e=this.elementRef&&this.elementRef.nativeElement&&this.elementRef.nativeElement.id;this.frameContext&&e&&this.frameContext.componentRefManager.add(e,this.component)},ui.prototype.ngOnDestroy=function(){},ui.decorators=[{type:B.Directive,args:[{selector:"[viewChangeRef]"}]}],ui.ctorParameters=function(){return[{type:B.Injector},{type:f.ViewChangeComponent},{type:B.ElementRef},{type:N.FrameContext}]},ui);function ui(e,t,i,n){this.injector=e,this.component=t,this.elementRef=i,this.frameContext=n}var ci=(hi.prototype.ngOnInit=function(){var e=this.elementRef&&this.elementRef.nativeElement&&this.elementRef.nativeElement.id;this.frameContext&&e&&this.frameContext.componentRefManager.add(e,this.component)},hi.prototype.ngOnDestroy=function(){},hi.decorators=[{type:B.Directive,args:[{selector:"[htmlEditorRef]"}]}],hi.ctorParameters=function(){return[{type:B.Injector},{type:g.HtmlEditorComponent},{type:B.ElementRef},{type:N.FrameContext}]},hi);function hi(e,t,i,n){this.injector=e,this.component=t,this.elementRef=i,this.frameContext=n}var fi=(gi.prototype.ngOnInit=function(){var e=this.elementRef&&this.elementRef.nativeElement&&this.elementRef.nativeElement.id;this.frameContext&&e&&this.frameContext.componentRefManager.add(e,this.component)},gi.prototype.ngOnDestroy=function(){},gi.decorators=[{type:B.Directive,args:[{selector:"[sectionRef]"}]}],gi.ctorParameters=function(){return[{type:B.Injector},{type:m.FarrisSectionComponent},{type:B.ElementRef},{type:N.FrameContext}]},gi);function gi(e,t,i,n){this.injector=e,this.component=t,this.elementRef=i,this.frameContext=n}var mi=(yi.prototype.ngOnInit=function(){var e=this.elementRef&&this.elementRef.nativeElement&&this.elementRef.nativeElement.id;this.frameContext&&e&&this.frameContext.componentRefManager.add(e,this.component)},yi.prototype.ngOnDestroy=function(){},yi.decorators=[{type:B.Directive,args:[{selector:"[inputGroupRef]"}]}],yi.ctorParameters=function(){return[{type:B.Injector},{type:y.InputGroupComponent},{type:B.ElementRef},{type:N.FrameContext}]},yi);function yi(e,t,i,n){this.injector=e,this.component=t,this.elementRef=i,this.frameContext=n}var vi=(bi.prototype.ngOnInit=function(){var e=this.elementRef&&this.elementRef.nativeElement&&this.elementRef.nativeElement.id;this.frameContext&&e&&this.frameContext.componentRefManager.add(e,this.component)},bi.prototype.ngOnDestroy=function(){},bi.decorators=[{type:B.Directive,args:[{selector:"[datepickerRef]"}]}],bi.ctorParameters=function(){return[{type:B.Injector},{type:v.FarrisDatepickerComponent},{type:B.ElementRef},{type:N.FrameContext}]},bi);function bi(e,t,i,n){this.injector=e,this.component=t,this.elementRef=i,this.frameContext=n}var Ci=(xi.prototype.ngOnInit=function(){var e=this.elementRef&&this.elementRef.nativeElement&&this.elementRef.nativeElement.id;this.frameContext&&e&&this.frameContext.componentRefManager.add(e,this.component)},xi.prototype.ngOnDestroy=function(){},xi.decorators=[{type:B.Directive,args:[{selector:"[timePickerRef]"}]}],xi.ctorParameters=function(){return[{type:B.Injector},{type:C.TimePickerComponent},{type:B.ElementRef},{type:N.FrameContext}]},xi);function xi(e,t,i,n){this.injector=e,this.component=t,this.elementRef=i,this.frameContext=n}var Di=(Ii.prototype.ngOnInit=function(){var e=this.elementRef&&this.elementRef.nativeElement&&this.elementRef.nativeElement.id;this.frameContext&&e&&this.frameContext.componentRefManager.add(e,this.component)},Ii.prototype.ngOnDestroy=function(){},Ii.prototype.ngAfterViewInit=function(){},Ii.decorators=[{type:B.Directive,args:[{selector:"[numberSpinnerRef]"}]}],Ii.ctorParameters=function(){return[{type:B.Injector},{type:x.NumberSpinnerComponent},{type:B.ElementRef},{type:N.FrameContext}]},Ii);function Ii(e,t,i,n){this.injector=e,this.component=t,this.elementRef=i,this.frameContext=n}var Si=(wi.prototype.ngOnInit=function(){var e=this.elementRef&&this.elementRef.nativeElement&&this.elementRef.nativeElement.id;this.frameContext&&e&&this.frameContext.componentRefManager.add(e,this.component)},wi.prototype.ngOnDestroy=function(){},wi.decorators=[{type:B.Directive,args:[{selector:"[comboListRef]"}]}],wi.ctorParameters=function(){return[{type:B.Injector},{type:D.ComboListComponent},{type:B.ElementRef},{type:N.FrameContext}]},wi);function wi(e,t,i,n){this.injector=e,this.component=t,this.elementRef=i,this.frameContext=n}var Ei=(Pi.prototype.ngOnInit=function(){var e=this.elementRef&&this.elementRef.nativeElement&&this.elementRef.nativeElement.id;this.frameContext&&e&&this.frameContext.componentRefManager.add(e,this.component)},Pi.prototype.ngOnDestroy=function(){},Pi.decorators=[{type:B.Directive,args:[{selector:"[comboLookupRef]"}]}],Pi.ctorParameters=function(){return[{type:B.Injector},{type:M.ComboLookupComponent},{type:B.ElementRef},{type:N.FrameContext}]},Pi);function Pi(e,t,i,n){this.injector=e,this.component=t,this.elementRef=i,this.frameContext=n}var Ri=(Oi.prototype.ngOnInit=function(){var e=this.elementRef&&this.elementRef.nativeElement&&this.elementRef.nativeElement.id;this.frameContext&&e&&this.frameContext.componentRefManager.add(e,this.component)},Oi.prototype.ngOnDestroy=function(){},Oi.decorators=[{type:B.Directive,args:[{selector:"[lookupGridRef]"}]}],Oi.ctorParameters=function(){return[{type:B.Injector},{type:I.LookupGridComponent},{type:B.ElementRef},{type:N.FrameContext}]},Oi);function Oi(e,t,i,n){this.injector=e,this.component=t,this.elementRef=i,this.frameContext=n}var Li=(Mi.prototype.ngOnInit=function(){var e=this.elementRef&&this.elementRef.nativeElement&&this.elementRef.nativeElement.id;this.frameContext&&e&&this.frameContext.componentRefManager.add(e,this.component)},Mi.prototype.ngOnDestroy=function(){},Mi.decorators=[{type:B.Directive,args:[{selector:"[datagridRef]"}]}],Mi.ctorParameters=function(){return[{type:B.Injector},{type:S.DatagridComponent},{type:B.ElementRef},{type:N.FrameContext}]},Mi);function Mi(e,t,i,n){this.injector=e,this.component=t,this.elementRef=i,this.frameContext=n}var Fi=(Ti.prototype.ngOnInit=function(){var e=this.elementRef&&this.elementRef.nativeElement&&this.elementRef.nativeElement.id;this.frameContext&&e&&this.frameContext.componentRefManager.add(e,this.component)},Ti.prototype.ngOnDestroy=function(){},Ti.decorators=[{type:B.Directive,args:[{selector:"[treetableRef]"}]}],Ti.ctorParameters=function(){return[{type:B.Injector},{type:w.TreeTableComponent},{type:B.ElementRef},{type:N.FrameContext}]},Ti);function Ti(e,t,i,n){this.injector=e,this.component=t,this.elementRef=i,this.frameContext=n}var ki=(Ni.prototype.ngOnInit=function(){var e=this.elementRef&&this.elementRef.nativeElement&&this.elementRef.nativeElement.id;this.frameContext&&e&&this.frameContext.componentRefManager.add(e,this.component)},Ni.prototype.ngOnDestroy=function(){},Ni.decorators=[{type:B.Directive,args:[{selector:"[wizardRef]"}]}],Ni.ctorParameters=function(){return[{type:B.Injector},{type:E.WizardComponent},{type:B.ElementRef},{type:N.FrameContext}]},Ni);function Ni(e,t,i,n){this.injector=e,this.component=t,this.elementRef=i,this.frameContext=n}var ji=(Vi.prototype.ngOnInit=function(){var e=this.elementRef&&this.elementRef.nativeElement&&this.elementRef.nativeElement.id;this.frameContext&&e&&this.frameContext.componentRefManager.add(e,this.component)},Vi.prototype.ngOnDestroy=function(){},Vi.decorators=[{type:B.Directive,args:[{selector:"[discussionEditorRef]"}]}],Vi.ctorParameters=function(){return[{type:B.Injector},{type:P.DiscussionEditorComponent},{type:B.ElementRef},{type:N.FrameContext}]},Vi);function Vi(e,t,i,n){this.injector=e,this.component=t,this.elementRef=i,this.frameContext=n}var Hi=(Bi.prototype.ngOnInit=function(){var e=this.elementRef&&this.elementRef.nativeElement&&this.elementRef.nativeElement.id;this.frameContext&&e&&this.frameContext.componentRefManager.add(e,this.component)},Bi.prototype.ngOnDestroy=function(){},Bi.decorators=[{type:B.Directive,args:[{selector:"[discussionListRef]"}]}],Bi.ctorParameters=function(){return[{type:B.Injector},{type:P.DiscussionListComponent},{type:B.ElementRef},{type:N.FrameContext}]},Bi);function Bi(e,t,i,n){this.injector=e,this.component=t,this.elementRef=i,this.frameContext=n}var Ai=(Ki.prototype.ngOnInit=function(){var e=this.elementRef&&this.elementRef.nativeElement&&this.elementRef.nativeElement.id;this.frameContext&&e&&this.frameContext.componentRefManager.add(e,this.component)},Ki.prototype.ngOnDestroy=function(){},Ki.decorators=[{type:B.Directive,args:[{selector:"[navRef]"}]}],Ki.ctorParameters=function(){return[{type:B.Injector},{type:R.ListNavComponent},{type:B.ElementRef},{type:N.FrameContext}]},Ki);function Ki(e,t,i,n){this.injector=e,this.component=t,this.elementRef=i,this.frameContext=n}var _i=(zi.prototype.ngOnInit=function(){var e=this.elementRef&&this.elementRef.nativeElement&&this.elementRef.nativeElement.id;this.frameContext&&e&&this.frameContext.componentRefManager.add(e,this.component)},zi.prototype.ngOnDestroy=function(){},zi.decorators=[{type:B.Directive,args:[{selector:"[multiSelectRef]"}]}],zi.ctorParameters=function(){return[{type:B.Injector},{type:O.MultiSelectComponent},{type:B.ElementRef},{type:N.FrameContext}]},zi);function zi(e,t,i,n){this.injector=e,this.component=t,this.elementRef=i,this.frameContext=n}var Gi=(qi.prototype.ngOnInit=function(){var e=this.elementRef&&this.elementRef.nativeElement&&this.elementRef.nativeElement.id;this.frameContext&&e&&this.frameContext.componentRefManager.add(e,this.component)},qi.prototype.ngOnDestroy=function(){},qi.decorators=[{type:B.Directive,args:[{selector:"[scrollspyRef]"}]}],qi.ctorParameters=function(){return[{type:B.Injector},{type:L.ScrollspyComponent},{type:B.ElementRef},{type:N.FrameContext}]},qi);function qi(e,t,i,n){this.injector=e,this.component=t,this.elementRef=i,this.frameContext=n}var Ui,$i=(X(Wi,Ui=ke),Wi.prototype.ngOnInit=function(){var i=this;this.lookup.valueChange.subscribe(function(e){if(e.nosearch)i.onClearMapping();else{var t=e.selections&&0<e.selections.length?e.selections:null;i.onValueChange(t)}}),this.lookup.clear.subscribe(function(){var e=i.mapfields||i.lookup.mapFields;i.mappingData(null,e)})},Wi.prototype.onClearMapping=function(){var t=this,e=Object.assign({},this.mapfields||this.lookup.mapFields||{}),i=this.lookup.textField,n={},r=this.lookup.ngControl&&this.lookup.ngControl.name;if(r&&this.vm){var o=e[i],a=this.vm&&this.vm.form&&this.vm.form.ngFormControls&&this.vm.form.ngFormControls[r],s=a&&a.binding;if(o&&s){var p=o.split(",").filter(function(e){return e!==s}).join(",");p?e[i]=p:delete e[i]}}Object.keys(e).forEach(function(e){t.setValue(n,e.split("."),"")}),this.mappingData(n,e,!0)},Wi.prototype.onValueChange=function(e){var t=this.mapfields||this.lookup.mapFields;this.mappingData(e,t)},Wi.decorators=[{type:B.Directive,args:[{selector:"[combo-lookup-data-mapping]"}]}],Wi.ctorParameters=function(){return[{type:N.ViewModel,decorators:[{type:B.Optional}]},{type:M.ComboLookupComponent,decorators:[{type:B.Optional},{type:B.Self}]}]},Wi.propDecorators={mapfields:[{type:B.Input,args:["combo-lookup-data-mapping"]}],target:[{type:B.Input,args:["target"]}]},Wi);function Wi(e,t){var i=Ui.call(this)||this;return i.vm=e,i.lookup=t,i.target=null,i.lookup&&(i.lookup.useFormDataMapping=!0),i}var Ji=(Yi.prototype.transform=function(e,t){return void 0===t&&(t="default-root"),e?this.downloadService?this.downloadService.getDownloadUrl(e,t):(console.warn("因安全问题，附件下载提供安全校验机制，附件下载功能需重新编译。"),"/api/runtime/dfs/v1.0/formdoc/download/"+e):this.defaultPic},Yi.decorators=[{type:B.Pipe,args:[{name:"imageIdToUrl"}]}],Yi.ctorParameters=function(){return[{type:B.Injector,decorators:[{type:B.Optional}]}]},Yi);function Yi(e){this.injector=e,this.defaultPic="/platform/common/web/assets/imgs/no-pic.png",this.downloadService=this.injector&&this.injector.get(F.DownloadService,null)||null}var Qi=(Xi.prototype.transform=function(e,t){var i="";if(t&&e&&e.field){i=this.getValue(e.field,t);var n=e.formatter;return n?this.cfs.format(i,t,n):e.isMultilingualField?this.getMultiLanguageValue(i):i}return""},Xi.prototype.getMultiLanguageValue=function(e){if(e&&"object"==typeof e&&0<Object.keys(e).length){var t=e[this.localeService&&this.localeService.localeId||"zh-CHS"];return t===undefined?"":t}return""},Xi.prototype.getValue=function(e,t){return t?-1===e.indexOf(".")?t[e]:e.split(".").reduce(function(e,t){return e&&e[t]||null},t):""},Xi.prototype.isHelpColumn=function(e){return e&&e.editor&&e.editor.options&&"EditorTypes.LOOKUP"===e.editor.options.type||!1},Xi.prototype.getHelpColumnValue=function(e,t){var i=this.getHelpControlTextField(e),n=this.getHelpControlMapFields(e);if(i&&n&&0<Object.keys(n).length){var r=n[i];return this.getValue(r,t)}return""},Xi.prototype.getHelpControlTextField=function(e){return e&&e.editor&&e.editor.options&&e.editor.options.textField||""},Xi.prototype.getHelpControlMapFields=function(e){return e&&e.editor&&e.editor.options&&e.editor.options.mapFields||{}},Xi.decorators=[{type:B.Pipe,args:[{name:"formatPrimeNgTreeTableCellData",pure:!1}]}],Xi.ctorParameters=function(){return[{type:k.ColumnFormatService},{type:B.Injector,decorators:[{type:B.Optional}]}]},Xi);function Xi(e,t){this.cfs=e,this.injector=t,this.injector&&(this.localeService=this.injector.get(T.LocaleService))}var Zi=(en.prototype.transform=function(e,t){if(t)return"date"===(t=t.toLowerCase())?this.transformDate(e):"datetime"===t?this.transformDateTime(e):"number"===t?this.transformNumber(e):e},en.prototype.transformDate=function(e){var t=this.userSettings&&this.userSettings.dateFormat||null;if(!t||!e)return e;var i=V(e);return i.isValid()?(t=this.parseDateFormat(t),i.format(t)):e},en.prototype.transformDateTime=function(e){var t=this.userSettings&&this.userSettings.dateFormat||"",i=this.userSettings&&this.userSettings.timeFormat||"",n=V(e);if(!n.isValid())return e;var r=(t=t&&this.parseDateFormat(t))+" "+(i=i&&this.parseTimeFormat(i));return n.format(r)},en.prototype.transformNumber=function(e){if(null===e||e===undefined||""===e)return"";var t=new j.BigNumber(e);if(!j.BigNumber.isBigNumber(t))return e;var i=t.isNegative(),n=this.buildNumberFormat(),r=this.numberFormat,o=r.negativeSign,a=void 0===o?null:o,s=r.numberDecimalDigits,p=void 0===s?null:s;return i&&null!==a?(n.prefix=a,t.absoluteValue().toFormat(p,null,n)):t.toFormat(p,null,n)},en.prototype.parseDateFormat=function(e){return e.replace(/y/g,"Y").replace(/d/g,"D")},en.prototype.parseTimeFormat=function(e){return e.replace(/M/g,"m")},en.prototype.buildNumberFormat=function(){if(this.numberFormat){var e=this.numberFormat,t=e.numberDecimalSeparator,i=void 0===t?null:t,n=e.numberGroupSeparator,r=void 0===n?null:n,o={groupSize:3};return null!==i&&(o.decimalSeparator=i),null!==r&&(o.groupSeparator=r),o}},Object.defineProperty(en.prototype,"numberFormat",{get:function(){return this.userSettings&&this.userSettings.numberFormat||null},enumerable:!0,configurable:!0}),en.decorators=[{type:B.Pipe,args:[{name:"localization"}]}],en.ctorParameters=function(){return[{type:B.Injector,decorators:[{type:B.Optional}]},{type:undefined,decorators:[{type:B.Inject,args:[N.UserSettingsToken]}]}]},en);function en(e,t){this.injector=e,this.userSettings=t}var tn=(nn.decorators=[{type:B.NgModule,args:[{imports:[A.CommonModule,_.FarrisCommonModule.forRoot()],declarations:[Se,Fe,Ve,Be,Ke,ze,qe,Je,Qe,$e,Ze,se,me,ve,ce,Ji,Qi,tt,nt,ot,st,de,fe,ct,gt,vt,xt,It,Pt,wt,Lt,Ft,kt,jt,Ht,At,_t,Gt,Ut,Wt,Zi,Yt,Xt,ei,ii,ri,ai,di,pi,fi,ci,mi,vi,Ci,Di,Si,Ei,Ri,Li,Fi,ki,ji,Hi,Ai,_i,Gi,$i],providers:[H.DialogService,K.GridComponent,ne,oe],exports:[Se,Fe,Ve,Be,Ke,ze,qe,Je,Qe,$e,Ze,se,me,ce,Ji,Qi,tt,nt,ot,st,de,fe,ct,gt,vt,xt,It,Pt,wt,Lt,Ft,kt,jt,Ht,At,_t,Gt,Ut,Wt,Zi,Yt,Xt,ei,ii,ri,ai,di,pi,fi,ci,mi,vi,Ci,Di,Si,Ei,Ri,Li,Fi,ki,ji,Hi,Ai,_i,Gi,$i]}]}],nn);function nn(){}e.ɵa=ke,e.ɵb=lt,e.ArrayConverter=z,e.DateConverter=q,e.MultiLangConverter=$,e.FilterConditionsConverter=J,e.KendoGridBindingDirective=Se,e.FarrisTreeTableBindingDirective=Fe,e.LookupDataMappingDirective=Ve,e.LookupEnableExtendLoadMethodDirective=Be,e.UIStateBindingDirective=Ke,e.FarrisDisabledDirective=ze,e.FarrisSortDirective=qe,e.FarrisTextareaEditDirective=$e,e.FarrisDynamicColumnFormatDirective=Je,e.FarrisEditEnterDirective=Qe,e.FarrisTreeTableFormatDirective=Ze,e.GridColumnAggregateDirective=me,e.GridSummaryDirective=ve,e.FarrisDatagridUseBindingDataDirective=tt,e.MultiSelectDataMappingDirective=nt,e.FarrisListViewBindingDirective=ot,e.EditableDirective=st,e.InputEndEditDirective=ct,e.FarrisDataGridEndEditDirective=gt,e.HtmlEditorEndEditDirective=vt,e.KendoGridEndEditDirective=xt,e.FarrisDataGridRemoteSummaryDirective=It,e.FarrisSetFocusDirective=wt,e.FarrisFilePreviewBindingDirective=Pt,e.FarrisDiscussionEditorBindingDirective=Lt,e.FarrisDiscussionListBindingDirective=Ft,e.FarrisPrimengTreeTableBindingDirective=kt,e.FarrisDynamicRequiredDirective=jt,e.FarrisEditorDirective=Ht,e.FarrisQuerySolutionEventBindDirective=At,e.FarrisDateLocalizationDirective=_t,e.FarrisNumberLocalizationDirective=Gt,e.FarrisTimeLocalizationDirective=Ut,e.FarrisTextLocalizationDirective=Wt,e.FarrisCheckboxModificationDirective=Yt,e.FarrisLabelModificationDirective=Xt,e.FarrisLookupBindingDirective=ei,e.ListNavComponentRefDirective=ii,e.ListViewComponentRefDirective=ri,e.ListFilterComponentRefDirective=ai,e.FilterComponentRefDirective=pi,e.ViewChangeComponentRefDirective=di,e.HtmlEditorComponentRefDirective=ci,e.SectionComponentRefDirective=fi,e.InputGroupComponentRefDirective=mi,e.DatepickerComponentRefDirective=vi,e.TimePickerComponentRefDirective=Ci,e.NumberSpinnerComponentRefDirective=Di,e.ComboListComponentRefDirective=Si,e.ComboLookupComponentRefDirective=Ei,e.LookupGridComponentRefDirective=Ri,e.DatagridComponentRefDirective=Li,e.TreetableComponentRefDirective=Fi,e.WizardComponentRefDirective=ki,e.DiscussionEditorComponentRefDirective=ji,e.DiscussionListComponentRefDirective=Hi,e.NavComponentRefDirective=Ai,e.MultiSelectComponentRefDirective=_i,e.ScrollspyComponentRefDirective=Gi,e.ComboLookupDataMappingDirective=$i,e.ImageIdToUrlPipe=Ji,e.FormatPrimeNgTreeTableCellData=Qi,e.Localization=Zi,e.FarrisKendoGridFormatService=ne,e.FarrisTreetableFormatService=oe,e.StringToDatePipe=se,e.KendoGridFilterDirective=de,e.DateFormatPlaceholderPipe=ce,e.FormatTotalPipe=fe,e.KendoBindingModule=tn,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=farris-kendo-binding.umd.min.js.map