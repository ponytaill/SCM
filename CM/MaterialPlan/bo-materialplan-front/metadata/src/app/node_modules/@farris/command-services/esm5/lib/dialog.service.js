import * as tslib_1 from "tslib";
import { Injectable, ComponentFactoryResolver, ReflectiveInjector, InjectFlags, Injector, Optional } from '@angular/core';
import { BsModalService } from '@farris/ui-modal';
import { FarrisFormService } from './farris-form.service';
import { FrameContext } from '@farris/devkit';
import { of, Subject } from 'rxjs';
import { LanguageService } from './languag.service';
import { switchMap } from 'rxjs/operators';
/**
 * 弹窗服务
 * @scope FormModule
 */
var DialogService = /** @class */ (function () {
    function DialogService(modalService, farrisFormService, _componentFactoryResolver, frameContext, injector) {
        this.modalService = modalService;
        this.farrisFormService = farrisFormService;
        this._componentFactoryResolver = _componentFactoryResolver;
        this.frameContext = frameContext;
        this.injector = injector;
        this._providers = [];
        this.modals = {};
        this.setLanguageService();
    }
    /**
     * 设置语言服务
     */
    DialogService.prototype.setLanguageService = function () {
        // FrameContext不一定存在，不能直接用
        var frameContext = this.getFrameContext();
        if (frameContext) {
            var injector = this.frameContext.injector;
            this.languageService = injector.get(LanguageService, null, InjectFlags.Optional);
        }
        if (!this.languageService) {
            this.languageService = LanguageService.getInstance();
        }
    };
    /**
     * 兼容旧弹窗，获取frameContext
     */
    DialogService.prototype.getFrameContext = function () {
        if (this.frameContext) {
            return this.frameContext;
        }
        if (this['context'] && this['context']['frameContext']) {
            return this['context']['frameContext'];
        }
        return null;
    };
    /**
     * 兼容旧弹窗，获取ComponentFactoryResolver
     */
    DialogService.prototype.getComponentFactoryResolver = function () {
        var frameContext = this.getFrameContext();
        var componentFactoryResolver;
        if (frameContext) {
            componentFactoryResolver = frameContext.injector.get(ComponentFactoryResolver);
        }
        return componentFactoryResolver;
    };
    /**
     * 获取config转换成对象类型的配置
     * @param config 配置项
     */
    DialogService.prototype.getObjectTypeConfig = function (config) {
        var objectTypeConfig;
        if (typeof config === 'string') {
            if (config.length) {
                try {
                    objectTypeConfig = JSON.parse(config);
                }
                catch (_a) {
                    throw new Error(config + '不是合法的json字符串');
                }
            }
            else {
                objectTypeConfig = {};
            }
        }
        else if (typeof config === 'object') {
            objectTypeConfig = Object.assign({}, config);
        }
        else {
            throw new Error('填写对象格式或json字符串');
        }
        return objectTypeConfig;
    };
    /**
     * 创建模态框内组件实例，并返回模态框实例；做了兼容老表单处理
     * @param config 弹窗配置
     * @param compnent 弹窗内组件
     * @param uiStateObject 绑定弹窗内组件uiState
     */
    DialogService.prototype.createModalComponentRef = function (config, component, uiStateObject) {
        var componentRef;
        var modalRef;
        var frameContext = this.getFrameContext();
        var componentFactoryResolver = this.getComponentFactoryResolver();
        if (frameContext && componentFactoryResolver) {
            var contentCmptFactory = componentFactoryResolver.resolveComponentFactory(component);
            var modalContentInjector = ReflectiveInjector.resolveAndCreate(tslib_1.__spread(this._providers), frameContext.injector);
            componentRef = contentCmptFactory.create(modalContentInjector);
            if (componentRef && componentRef.instance && componentRef.instance.viewModel && componentRef.instance.viewModel.uiState) {
                if (typeof uiStateObject === 'object' && Object.keys(uiStateObject).length) {
                    Object.keys(uiStateObject).forEach(function (item) {
                        componentRef.instance.viewModel.uiState.setPropertyValue(item, uiStateObject[item]);
                    });
                }
                // 附加isDialog参数
                componentRef.instance.viewModel.uiState.setPropertyValue('DEVKIT_DIALOG', true);
            }
            modalRef = this.modalService.show(componentRef, config);
        }
        else {
            modalRef = this.modalService.show(component, config);
        }
        return modalRef;
    };
    /**
     *
     * @param config 模态框本身配置
     * @param modalId 模态框内组件的id
     * @param uiStateConfig 模态框内组件uiState上的字段及值
     */
    DialogService.prototype.openModal = function (config, modalId, uiStateConfig, callback) {
        var _this = this;
        if (config === void 0) { config = {}; }
        if (uiStateConfig === void 0) { uiStateConfig = {}; }
        var configObj = this.getObjectTypeConfig(config);
        var uiStateObject = this.getObjectTypeConfig(uiStateConfig);
        var innerCompopnent = this.farrisFormService.getControls(modalId);
        var modalRef;
        var modalConfig = {
            title: this.languageService.defaultDialogTitle,
            width: 760,
            height: 450,
            showButtons: false
        };
        modalConfig = Object.assign(modalConfig, configObj);
        var onClosingHandler = modalConfig.beforeClose;
        // tslint:disable: no-string-literal
        var cancelChanges = modalConfig['cancelChanges'] || false;
        modalConfig.beforeClose = function (ref) {
            // if (ref && ref.modalRef && ref.modalRef.content) {
            //   ref.modalRef.content.isDialogRootComponent = false;
            // }
            if (!!onClosingHandler && typeof onClosingHandler === 'function') {
                return onClosingHandler(ref).pipe(switchMap(function (result) {
                    if (result) {
                        if (cancelChanges) {
                            return _this.cancelChanges(ref);
                        }
                    }
                    return of(result);
                }));
            }
            if (cancelChanges) {
                return _this.cancelChanges(ref);
            }
            else {
                return of(true);
            }
        };
        var remote = modalConfig.remote || false;
        if (remote) {
            this.createRemoteForm(modalConfig, uiStateObject).subscribe(function (modalRef) {
                _this.modalRef = modalRef;
                if (modalRef && !!modalRef.content) {
                    modalRef.content.isDialogRootComponent = true;
                    modalRef.content.dialogRef = modalRef;
                }
                callback(modalRef);
            });
        }
        else {
            if (!innerCompopnent) {
                console.error("\u83B7\u53D6\u63A7\u4EF6\u5931\u8D25\uFF0CmodalId=" + modalId);
                return;
            }
            if (typeof innerCompopnent === 'string') {
                modalConfig.dialogType = 'iframe';
                modalRef = this.modalService.show(innerCompopnent, modalConfig);
            }
            else if (typeof innerCompopnent === 'function') {
                modalRef = this.createModalComponentRef(modalConfig, innerCompopnent, uiStateObject);
            }
            else if (typeof innerCompopnent === 'object') {
                // 如果是对象 且使用独立js加载
                // {"useIsolateJs":true,"modalInstance":f()}
                if (innerCompopnent.useIsolateJs) {
                    var parameter = {
                        injector: this.injector,
                        uiState: uiStateObject,
                        modalService: this.modalService,
                        dialogServiceInstance: this,
                        eventBus: this.frameContext.getVirtualRootFrameContext().eventBus,
                        componentCallback: this.componentModify,
                        modalInstanceCallback: this.modalInstanceCallback
                    };
                    // 会在内部进行
                    return innerCompopnent["modalInstance"](modalConfig, parameter);
                }
                else {
                    modalRef = this.modalService.show(innerCompopnent, modalConfig);
                }
            }
            this.modalRef = modalRef;
            if (modalRef && !!modalRef.content) {
                modalRef.content.isDialogRootComponent = true;
                modalRef.content.dialogRef = modalRef;
            }
            return modalRef;
        }
    };
    DialogService.prototype.componentModify = function (cmpRef, parameter) {
        if (cmpRef && cmpRef.instance && cmpRef.instance.viewModel && cmpRef.instance.viewModel.uiState) {
            if (parameter.uistate && typeof parameter.uistate === "string") {
                parameter.uistate = JSON.parse(parameter.uistate);
            }
            if (typeof parameter.uistate === 'object' && Object.keys(parameter.uistate).length) {
                Object.keys(parameter.uistate).forEach(function (item) {
                    cmpRef.instance.viewModel.uiState.setPropertyValue(item, parameter.uistate[item]);
                });
            }
            // 附加isDialog参数
            cmpRef.instance.viewModel.uiState.setPropertyValue('DEVKIT_DIALOG', true);
        }
    };
    DialogService.prototype.modalInstanceCallback = function (cmpRef, options, parameter) {
        if (parameter && parameter.modalService) {
            var modalRef = parameter.modalService.show(cmpRef, options);
            if (modalRef && !!modalRef.content) {
                modalRef.content.isDialogRootComponent = true;
                modalRef.content.dialogRef = modalRef;
            }
            return modalRef;
        }
    };
    /**
     * 打开类帮助表单
     * @param frameId
     * @param params
     * @param configs
     * @description 弹出表单和弹出远端表单区别为弹出表单需要配置字段映射
     */
    DialogService.prototype.openHelpModal = function (frameId, params, configs) {
        var _this = this;
        var events = this['context']['eventParam'] || {};
        // 卡片场景传递过来的事件是自定义对象，包含event和options。列表场景传递过来的事件参数是普通事件参数，在参数中携带了editor.options
        var event = events.event || events;
        var options = events.options || events.editor && events.editor.options || {};
        var context = events && events.context;
        var subject = new Subject();
        // modalId在两种场景下都需要，用来区分实例
        var _a = options.modalId, modalId = _a === void 0 ? null : _a;
        if (!configs) {
            configs = '{}';
        }
        if (typeof configs === 'string' && configs.length > 0) {
            configs = JSON.parse(configs);
        }
        var _b = configs || {}, _c = _b.remote, remote = _c === void 0 ? false : _c, _d = _b.currentRow, currentRow = _d === void 0 ? false : _d, _e = _b.areaResponse, areaResponse = _e === void 0 ? undefined : _e;
        // 支持areaResponse配置
        if (areaResponse !== undefined && options.areaResponse === undefined) {
            options.areaResponse = areaResponse;
        }
        if (remote) {
            var mapFields_1 = configs.mapFields || {};
            options.remote = remote + '?v=' + new Date().valueOf();
            this.openModal(options, modalId, params, function (dialogRef) {
                // 新增event参数（为了以后调用event中的formControl以适配列表中的智能输入框弹出表单）
                _this.modals[modalId] = { subject: subject, frameId: frameId, mapFields: mapFields_1, dialogRef: dialogRef, currentRow: currentRow, event: event, context: context };
            });
        }
        else {
            var dialogRef = this.openModal(options, modalId, params);
            var mapFields = options.mapFields || {};
            this.modals[modalId] = { subject: subject, frameId: frameId, mapFields: mapFields, dialogRef: dialogRef, currentRow: currentRow, event: event, context: context };
        }
        return subject;
    };
    /**
     * 打开带回调的弹窗
     * @param frameId frameId
     * @param params 参数
     * @param configs 配置
     * @returns
     */
    DialogService.prototype.openCallbackableModal = function (frameId, params, configs) {
        var _this = this;
        if (!configs) {
            configs = '{}';
        }
        if (typeof configs === 'string') {
            configs = JSON.parse(configs);
        }
        var events = this['context'] && this['context']['eventParam'] || {};
        var options = events.options;
        options.showButtons = true;
        options.buttons = [
            {
                text: this.languageService.confirm, cls: 'btn btn-primary', handle: function (event) {
                    var _a = (options || {}).modalId, modalId = _a === void 0 ? null : _a;
                    if (modalId) {
                        var modal = _this.modals[modalId];
                        var _b = modal || {}, _c = _b.subject, subject_1 = _c === void 0 ? null : _c, _d = _b.dialogRef, dialogRef = _d === void 0 ? null : _d, _e = _b.frameId, frameId_1 = _e === void 0 ? null : _e, _f = _b.handle, handle_1 = _f === void 0 ? null : _f, _g = _b.currentRow, currentRow_1 = _g === void 0 ? false : _g;
                        var formCmp = dialogRef.content; // 弹窗表单实例
                        if (!formCmp) {
                            throw new Error('不支持的表单类型');
                        }
                        var selectedItems = [];
                        if (currentRow_1 === true) {
                            var frameComtext = void 0;
                            if (formCmp.context) {
                                frameComtext = formCmp.context.appContext.frameContextManager.getFrameContextById(frameId_1);
                            }
                            else {
                                frameComtext = formCmp.appContext.frameContextManager.getFrameContextById(frameId_1);
                            }
                            if (!frameComtext) {
                                throw new Error("\u65E0\u6548\u7684frameId\uFF1A" + frameId_1 + "\uFF0C\u8BF7\u786E\u8BA4\u547D\u4EE4\u4E2DframeId\u6B63\u786E\u3002");
                            }
                            var bindingList = frameComtext.bindingData.getList();
                            var item = bindingList && bindingList.currentItem && bindingList.currentItem.toJSON();
                            selectedItems = [item];
                        }
                        else {
                            var rows = void 0;
                            // 如果context为空 那么尝试从对应的appcontext读取，主要目的是为了解析表单的弹出
                            if (formCmp.context) {
                                rows = formCmp.context.appContext.frameContextManager.getFrameContextById(frameId_1).uiState.rows || new Map();
                            }
                            else {
                                rows = formCmp.appContext.frameContextManager.getFrameContextById(frameId_1).uiState.rows || new Map();
                            }
                            selectedItems = Array.from(rows.values());
                        }
                        if (typeof handle_1 === 'function') {
                            handle_1(selectedItems);
                        }
                        if (subject_1) {
                            subject_1.next();
                        }
                        dialogRef.close(options);
                    }
                }
            },
            { text: this.languageService.cancel, cls: 'btn', handle: function (event) { return _this.cancel(options); } }
        ];
        var subject = new Subject();
        var _a = options.modalId, modalId = _a === void 0 ? null : _a;
        var _b = configs.remote, remote = _b === void 0 ? null : _b, _c = configs.currentRow, currentRow = _c === void 0 ? false : _c, _d = configs.areaResponse, areaResponse = _d === void 0 ? undefined : _d;
        var handle = options.handle;
        // 支持areaResponse配置
        if (areaResponse !== undefined && options.areaResponse === undefined) {
            options.areaResponse = areaResponse;
        }
        if (remote) {
            options.remote = remote + '?v=' + new Date().valueOf();
            this.openModal(options, modalId, params, function (dialogRef) {
                _this.modals[modalId] = { subject: subject, frameId: frameId, dialogRef: dialogRef, handle: handle, currentRow: currentRow, event: events.event };
            });
        }
        else {
            var dialogRef = this.openModal(options, modalId, params);
            this.modals[modalId] = { subject: subject, frameId: frameId, dialogRef: dialogRef, handle: handle, currentRow: currentRow, event: events.event };
        }
        return subject;
    };
    /**
     * 确认按钮事件
     * @param args
     */
    DialogService.prototype.confirm = function () {
        var _this = this;
        var events = this['context'] && this['context']['eventParam'] || {};
        var _a = (events || {}).modalId, modalId = _a === void 0 ? null : _a;
        if (modalId) {
            var modal = this.modals[modalId];
            var _b = modal || {}, _c = _b.subject, subject = _c === void 0 ? null : _c, _d = _b.dialogRef, dialogRef = _d === void 0 ? null : _d, _e = _b.mapFields, mapFields_2 = _e === void 0 ? {} : _e, _f = _b.frameId, frameId = _f === void 0 ? null : _f, _g = _b.currentRow, currentRow = _g === void 0 ? false : _g, _h = _b.event, event_1 = _h === void 0 ? null : _h, _j = _b.context, context_1 = _j === void 0 ? null : _j;
            var formCmp = dialogRef.content; // 弹窗表单实例
            if (!formCmp) {
                throw new Error('不支持的表单类型');
            }
            // const selectedIds = formCmp.context.appContext.frameContextManager.getFrameContextById(frameId).uiState.ids;
            var selectedItems_1 = [];
            if (currentRow === true) {
                var frameComtext = formCmp.context.appContext.frameContextManager.getFrameContextById(frameId);
                if (!frameComtext) {
                    throw new Error("\u65E0\u6548\u7684frameId\uFF1A" + frameId + "\uFF0C\u8BF7\u786E\u8BA4\u547D\u4EE4\u4E2DframeId\u6B63\u786E\u3002");
                }
                var bindingList = frameComtext.bindingData.getList();
                var item = bindingList && bindingList.currentItem && bindingList.currentItem.toJSON();
                if (item && Object.keys(item).length > 0) {
                    selectedItems_1 = [item];
                }
            }
            else {
                var rows = formCmp.context.appContext.frameContextManager.getFrameContextById(frameId).uiState.rows || new Map();
                selectedItems_1 = Array.from(rows.values());
            }
            // 映射字段数据
            // 获取触发弹框的编辑器的字段名称
            var editorField = undefined;
            if (event_1 && event_1.editor && event_1.editor.column) {
                editorField = event_1.editor.column.field;
            }
            if (selectedItems_1 && mapFields_2) {
                Object.keys(mapFields_2).forEach(function (k) {
                    var targetField = mapFields_2[k];
                    var sourceKeyArray = k.split('.').filter(function (p) { return p; }) || [];
                    var targetValue = selectedItems_1.map(function (r) {
                        return sourceKeyArray.reduce(function (target, key) {
                            if (target && (target.hasOwnProperty(key) || target['__proto__'].hasOwnProperty(key))) {
                                return target[key];
                            }
                            else {
                                return '';
                            }
                        }, r);
                    }).join(',');
                    if (targetField) {
                        var bindingPaths_1 = _this.frameContext.viewModel.bindingPath.split('/').filter(function (p) { return p; });
                        var targetFields = targetField.split(',').filter(function (p) { return p; });
                        targetFields.forEach(function (target) {
                            if (context_1) {
                                _this.setValueByPath(context_1, target, targetValue);
                            }
                            else {
                                var targetPath = target.split('.');
                                _this.frameContext.bindingData.setValue(bindingPaths_1.concat(targetPath), targetValue, true, true);
                            }
                        });
                    }
                });
            }
            if (subject) {
                subject.next();
            }
            dialogRef.close();
        }
    };
    /**
     * 取消按钮事件
     * @param args
     */
    DialogService.prototype.cancel = function (event) {
        var events = event || this['context'] && this['context']['eventParam'] || {};
        var _a = (events || {}).modalId, modalId = _a === void 0 ? null : _a;
        if (modalId) {
            var modal = this.modals[modalId];
            var _b = modal || {}, _c = _b.subject, subject = _c === void 0 ? null : _c, _d = _b.dialogRef, dialogRef = _d === void 0 ? null : _d;
            if (subject) {
                subject.next();
            }
            if (dialogRef) {
                dialogRef.close();
            }
        }
    };
    /**
     * 取消服务器变更集
     */
    DialogService.prototype.cancelChanges = function (ref) {
        if (ref && ref.modalRef && ref.modalRef.content) {
            var component = ref.modalRef.content;
            if (component && component.context) {
                var repository = component.context.repository || null;
                if (repository) {
                    return repository.cancelChanges().pipe(switchMap(function () { return of(true); }));
                }
            }
        }
        return of(true);
    };
    /**
     * 关闭该弹窗
     */
    DialogService.prototype.closeModal = function () {
        if (this.modalRef) {
            this.modalRef.close();
        }
    };
    /**
     * 创建远程表单实例
     * @param options dialog配置
     * @param uiState uistate
     */
    DialogService.prototype.createRemoteForm = function (options, uiState) {
        var _this = this;
        var remote = options.remote || false;
        var subject = new Subject();
        if (remote) {
            var moduleName_1 = options.moduleName || null;
            System.import(remote).then(function (module) {
                if (!moduleName_1) {
                    moduleName_1 = Object.keys(module).pop();
                }
                var moduleFactory = module[moduleName_1];
                var moduleRef = moduleFactory.create(_this.injector);
                var entryComponent = moduleRef['_bootstrapComponents'][0];
                if (entryComponent) {
                    var compFactory = moduleRef.componentFactoryResolver.resolveComponentFactory(entryComponent);
                    var componentRef_1 = compFactory.create(_this.injector);
                    if (componentRef_1 && componentRef_1.instance && componentRef_1.instance.viewModel && componentRef_1.instance.viewModel.uiState) {
                        if (typeof uiState === 'object' && Object.keys(uiState).length) {
                            Object.keys(uiState).forEach(function (item) {
                                componentRef_1.instance.viewModel.uiState.setPropertyValue(item, uiState[item]);
                            });
                        }
                        // 附加isDialog参数
                        componentRef_1.instance.viewModel.uiState.setPropertyValue('DEVKIT_DIALOG', true);
                    }
                    var modalRef = _this.modalService.show(componentRef_1, options);
                    subject.next(modalRef);
                }
                else {
                    throw new Error("\u65E0\u6CD5\u627E\u5230\u5165\u53E3\u8868\u5355\uFF01");
                }
            });
        }
        return subject;
    };
    DialogService.prototype.setValueByPath = function (target, path, value) {
        if (target) {
            var paths = path.split('.');
            if (paths.length <= 1) {
                target[path] = value;
            }
            else {
                paths.slice(0, -1).reduce(function (prev, path) {
                    if (!(prev.hasOwnProperty(path) || prev['__proto__'].hasOwnProperty(path))) {
                        prev[path] = {};
                    }
                    return prev[path];
                }, target)[paths[paths.length - 1]] = value;
            }
        }
    };
    DialogService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    DialogService.ctorParameters = function () { return [
        { type: BsModalService },
        { type: FarrisFormService },
        { type: ComponentFactoryResolver },
        { type: FrameContext },
        { type: Injector, decorators: [{ type: Optional }] }
    ]; };
    return DialogService;
}());
export { DialogService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGlhbG9nLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2NvbW1hbmQtc2VydmljZXMvIiwic291cmNlcyI6WyJsaWIvZGlhbG9nLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsd0JBQXdCLEVBQUUsa0JBQWtCLEVBQTBCLFdBQVcsRUFBbUIsUUFBUSxFQUFFLFFBQVEsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNuSyxPQUFPLEVBQUUsY0FBYyxFQUFnQixNQUFNLGtCQUFrQixDQUFDO0FBQ2hFLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQzFELE9BQU8sRUFBRSxZQUFZLEVBQStCLE1BQU0sZ0JBQWdCLENBQUM7QUFDM0UsT0FBTyxFQUFFLEVBQUUsRUFBYyxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDL0MsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ3BELE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUUzQzs7O0dBR0c7QUFDSDtJQVNFLHVCQUNVLFlBQTRCLEVBQzVCLGlCQUFvQyxFQUNwQyx5QkFBbUQsRUFDbkQsWUFBMkIsRUFDZixRQUFtQjtRQUovQixpQkFBWSxHQUFaLFlBQVksQ0FBZ0I7UUFDNUIsc0JBQWlCLEdBQWpCLGlCQUFpQixDQUFtQjtRQUNwQyw4QkFBeUIsR0FBekIseUJBQXlCLENBQTBCO1FBQ25ELGlCQUFZLEdBQVosWUFBWSxDQUFlO1FBQ2YsYUFBUSxHQUFSLFFBQVEsQ0FBVztRQVhqQyxlQUFVLEdBQWUsRUFBRSxDQUFDO1FBSTVCLFdBQU0sR0FBUSxFQUFFLENBQUM7UUFTdkIsSUFBSSxDQUFDLGtCQUFrQixFQUFFLENBQUM7SUFDNUIsQ0FBQztJQUVEOztPQUVHO0lBQ0ssMENBQWtCLEdBQTFCO1FBRUUsMEJBQTBCO1FBQzFCLElBQU0sWUFBWSxHQUFHLElB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WUFDSCxDQUFDLENBQUMsQ0FBQztTQUNKO1FBQ0QsT0FBTyxPQUFPLENBQUM7SUFDakIsQ0FBQztJQUNPLHNDQUFjLEdBQXRCLFVBQXVCLE1BQWMsRUFBRSxJQUFZLEVBQUUsS0FBVTtRQUM3RCxJQUFJLE1BQU0sRUFBRTtZQUNWLElBQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDOUIsSUFBSSxLQUFLLENBQUMsTUFBTSxJQUFJLENBQUMsRUFBRTtnQkFDckIsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLEtBQUssQ0FBQzthQUN0QjtpQkFBTTtnQkFDTCxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxVQUFDLElBQUksRUFBRSxJQUFJO29CQUNuQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxJQUFJLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRTt3QkFDMUUsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQztxQkFDakI7b0JBQ0QsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ3BCLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLEtBQUssQ0FBQzthQUM3QztTQUNGO0lBQ0gsQ0FBQzs7Z0JBcmhCRixVQUFVOzs7O2dCQVhGLGNBQWM7Z0JBQ2QsaUJBQWlCO2dCQUZMLHdCQUF3QjtnQkFHcEMsWUFBWTtnQkFIb0csUUFBUSx1QkEwQjVILFFBQVE7O0lBd2dCYixvQkFBQztDQUFBLEFBdGhCRCxJQXNoQkM7QUFFRCxPQUFPLEVBQUUsYUFBYSxFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlLCBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsIFJlZmxlY3RpdmVJbmplY3RvciwgUHJvdmlkZXIsIENvbXBvbmVudFJlZiwgSW5qZWN0RmxhZ3MsIE5nTW9kdWxlRmFjdG9yeSwgSW5qZWN0b3IsIE9wdGlvbmFsIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBCc01vZGFsU2VydmljZSwgTW9kYWxPcHRpb25zIH0gZnJvbSAnQGZhcnJpcy91aS1tb2RhbCc7XG5pbXBvcnQgeyBGYXJyaXNGb3JtU2VydmljZSB9IGZyb20gJy4vZmFycmlzLWZvcm0uc2VydmljZSc7XG5pbXBvcnQgeyBGcmFtZUNvbnRleHQsIEZyYW1lQ29tcG9uZW50LCBCaW5kaW5nTGlzdCB9IGZyb20gJ0BmYXJyaXMvZGV2a2l0JztcbmltcG9ydCB7IG9mLCBPYnNlcnZhYmxlLCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBMYW5ndWFnZVNlcnZpY2UgfSBmcm9tICcuL2xhbmd1YWcuc2VydmljZSc7XG5pbXBvcnQgeyBzd2l0Y2hNYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5kZWNsYXJlIGNvbnN0IFN5c3RlbTogYW55O1xuLyoqXG4gKiDlvLnnqpfmnI3liqFcbiAqIEBzY29wZSBGb3JtTW9kdWxlXG4gKi9cbkBJbmplY3RhYmxlKClcbmNsYXNzIERpYWxvZ1NlcnZpY2Uge1xuXG4gIHByaXZhdGUgX3Byb3ZpZGVyczogUHJvdmlkZXJbXSA9IFtdO1xuXG4gIHByaXZhdGUgbGFuZ3VhZ2VTZXJ2aWNlOiBMYW5ndWFnZVNlcnZpY2U7XG4gIHByaXZhdGUgbW9kYWxSZWY6IGFueTtcbiAgcHJpdmF0ZSBtb2RhbHM6IGFueSA9IHt9O1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgbW9kYWxTZXJ2aWNlOiBCc01vZGFsU2VydmljZSxcbiAgICBwcml2YXRlIGZhcnJpc0Zvcm1TZXJ2aWNlOiBGYXJyaXNGb3JtU2VydmljZSxcbiAgICBwcml2YXRlIF9jb21wb25lbnRGYWN0b3J5UmVzb2x2ZXI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcbiAgICBwcml2YXRlIGZyYW1lQ29udGV4dD86IEZyYW1lQ29udGV4dCxcbiAgICBAT3B0aW9uYWwoKSBwcml2YXRlIGluamVjdG9yPzogSW5qZWN0b3JcbiAgKSB7XG4gICAgdGhpcy5zZXRMYW5ndWFnZVNlcnZpY2UoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDorr7nva7or63oqIDmnI3liqFcbiAgICovXG4gIHByaXZhdGUgc2V0TGFuZ3VhZ2VTZXJ2aWNlKCkge1xuXG4gICAgLy8gRnJhbWVDb250ZXh05LiN5LiA5a6a5a2Y5Zyo77yM5LiN6IO955u05o6l55SoXG4gICAgY29uc3QgZnJhbWVDb250ZXh0ID0gdGhpcy5nZXRGcmFtZUNvbnRleHQoKTtcbiAgICBpZiAoZnJhbWVDb250ZXh0KSB7XG4gICAgICBjb25zdCBpbmplY3RvciA9IHRoaXMuZnJhbWVDb250ZXh0LmluamVjdG9yO1xuICAgICAgdGhpcy5sYW5ndWFnZVNlcnZpY2UgPSBpbmplY3Rvci5nZXQ8TGFuZ3VhZ2VTZXJ2aWNlPihMYW5ndWFnZVNlcnZpY2UsIG51bGwsIEluamVjdEZsYWdzLk9wdGlvbmFsKTtcbiAgICB9XG5cbiAgICBpZiAoIXRoaXMubGFuZ3VhZ2VTZXJ2aWNlKSB7XG4gICAgICB0aGlzLmxhbmd1YWdlU2VydmljZSA9IExhbmd1YWdlU2VydmljZS5nZXRJbnN0YW5jZSgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDlhbzlrrnml6flvLnnqpfvvIzojrflj5ZmcmFtZUNvbnRleHRcbiAgICovXG4gIHByaXZhdGUgZ2V0RnJhbWVDb250ZXh0KCkge1xuICAgIGlmICh0aGlzLmZyYW1lQ29udGV4dCkge1xuICAgICAgcmV0dXJuIHRoaXMuZnJhbWVDb250ZXh0XG4gICAgfVxuICAgIGlmICh0aGlzWydjb250ZXh0J10gJiYgdGhpc1snY29udGV4dCddWydmcmFtZUNvbnRleHQnXSkge1xuICAgICAgcmV0dXJuIHRoaXNbJ2NvbnRleHQnXVsnZnJhbWVDb250ZXh0J107XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG4gIC8qKlxuICAgKiDlhbzlrrnml6flvLnnqpfvvIzojrflj5ZDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXJcbiAgICovXG4gIHByaXZhdGUgZ2V0Q29tcG9uZW50RmFjdG9yeVJlc29sdmVyKCkge1xuICAgIGNvbnN0IGZyYW1lQ29udGV4dCA9IHRoaXMuZ2V0RnJhbWVDb250ZXh0KCk7XG4gICAgbGV0IGNvbXBvbmVudEZhY3RvcnlSZXNvbHZlcjogYW55O1xuICAgIGlmIChmcmFtZUNvbnRleHQpIHtcbiAgICAgIGNvbXBvbmVudEZhY3RvcnlSZXNvbHZlciA9IGZyYW1lQ29udGV4dC5pbmplY3Rvci5nZXQoQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyKTtcbiAgICB9XG4gICAgcmV0dXJuIGNvbXBvbmVudEZhY3RvcnlSZXNvbHZlcjtcbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5Zjb25maWfovazmjaLmiJDlr7nosaHnsbvlnovnmoTphY3nva5cbiAgICogQHBhcmFtIGNvbmZpZyDphY3nva7poblcbiAgICovXG4gIHByaXZhdGUgZ2V0T2JqZWN0VHlwZUNvbmZpZyhjb25maWc6IGFueSkge1xuICAgIGxldCBvYmplY3RUeXBlQ29uZmlnOiBhbnlcbiAgICBpZiAodHlwZW9mIGNvbmZpZyA9PT0gJ3N0cmluZycpIHtcbiAgICAgIGlmIChjb25maWcubGVuZ3RoKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgb2JqZWN0VHlwZUNvbmZpZyA9IEpTT04ucGFyc2UoY29uZmlnKTtcbiAgICAgICAgfSBjYXRjaCB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGNvbmZpZyArICfkuI3mmK/lkIjms5XnmoRqc29u5a2X56ym5LiyJyk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG9iamVjdFR5cGVDb25maWcgPSB7fTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBjb25maWcgPT09ICdvYmplY3QnKSB7XG4gICAgICBvYmplY3RUeXBlQ29uZmlnID0gT2JqZWN0LmFzc2lnbih7fSwgY29uZmlnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCfloavlhpnlr7nosaHmoLzlvI/miJZqc29u5a2X56ym5LiyJyk7XG4gICAgfVxuICAgIHJldHVybiBvYmplY3RUeXBlQ29uZmlnO1xuICB9XG5cbiAgLyoqXG4gICAqIOWIm+W7uuaooeaAgeahhuWGhee7hOS7tuWunuS+i++8jOW5tui/lOWbnuaooeaAgeahhuWunuS+i++8m+WBmuS6huWFvOWuueiAgeihqOWNleWkhOeQhlxuICAgKiBAcGFyYW0gY29uZmlnIOW8ueeql+mFjee9rlxuICAgKiBAcGFyYW0gY29tcG5lbnQg5by556qX5YaF57uE5Lu2XG4gICAqIEBwYXJhbSB1aVN0YXRlT2JqZWN0IOe7keWumuW8ueeql+WGhee7hOS7tnVpU3RhdGVcbiAgICovXG4gIHByaXZhdGUgY3JlYXRlTW9kYWxDb21wb25lbnRSZWYoY29uZmlnOiBhbnksIGNvbXBvbmVudDogYW55LCB1aVN0YXRlT2JqZWN0OiBhbnkpIHtcbiAgICBsZXQgY29tcG9uZW50UmVmOiBhbnk7XG4gICAgbGV0IG1vZGFsUmVmOiBhbnk7XG4gICAgY29uc3QgZnJhbWVDb250ZXh0ID0gdGhpcy5nZXRGcmFtZUNvbnRleHQoKTtcbiAgICBjb25zdCBjb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIgPSB0aGlzLmdldENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcigpO1xuICAgIGlmIChmcmFtZUNvbnRleHQgJiYgY29tcG9uZW50RmFjdG9yeVJlc29sdmVyKSB7XG4gICAgICBjb25zdCBjb250ZW50Q21wdEZhY3RvcnkgPSBjb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoY29tcG9uZW50KTtcbiAgICAgIGNvbnN0IG1vZGFsQ29udGVudEluamVjdG9yID0gUmVmbGVjdGl2ZUluamVjdG9yLnJlc29sdmVBbmRDcmVhdGUoWy4uLnRoaXMuX3Byb3ZpZGVyc10sIGZyYW1lQ29udGV4dC5pbmplY3Rvcik7XG4gICAgICBjb21wb25lbnRSZWYgPSBjb250ZW50Q21wdEZhY3RvcnkuY3JlYXRlKG1vZGFsQ29udGVudEluamVjdG9yKTtcbiAgICAgIGlmIChjb21wb25lbnRSZWYgJiYgY29tcG9uZW50UmVmLmluc3RhbmNlICYmIGNvbXBvbmVudFJlZi5pbnN0YW5jZS52aWV3TW9kZWwgJiYgY29tcG9uZW50UmVmLmluc3RhbmNlLnZpZXdNb2RlbC51aVN0YXRlKSB7XG4gICAgICAgIGlmICh0eXBlb2YgdWlTdGF0ZU9iamVjdCA9PT0gJ29iamVjdCcgJiYgT2JqZWN0LmtleXModWlTdGF0ZU9iamVjdCkubGVuZ3RoKSB7XG4gICAgICAgICAgT2JqZWN0LmtleXModWlTdGF0ZU9iamVjdCkuZm9yRWFjaChpdGVtID0+IHtcbiAgICAgICAgICAgIGNvbXBvbmVudFJlZi5pbnN0YW5jZS52aWV3TW9kZWwudWlTdGF0ZS5zZXRQcm9wZXJ0eVZhbHVlKGl0ZW0sIHVpU3RhdGVPYmplY3RbaXRlbV0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIC8vIOmZhOWKoGlzRGlhbG9n5Y+C5pWwXG4gICAgICAgIGNvbXBvbmVudFJlZi5pbnN0YW5jZS52aWV3TW9kZWwudWlTdGF0ZS5zZXRQcm9wZXJ0eVZhbHVlKCdERVZLSVRfRElBTE9HJywgdHJ1ZSk7XG4gICAgICB9XG4gICAgICBtb2RhbFJlZiA9IHRoaXMubW9kYWxTZXJ2aWNlLnNob3coY29tcG9uZW50UmVmLCBjb25maWcpO1xuICAgIH0gZWxzZSB7XG4gICAgICBtb2RhbFJlZiA9IHRoaXMubW9kYWxTZXJ2aWNlLnNob3coY29tcG9uZW50LCBjb25maWcpO1xuICAgIH1cbiAgICByZXR1cm4gbW9kYWxSZWY7XG4gIH1cbiAgLyoqXG4gICAqIFxuICAgKiBAcGFyYW0gY29uZmlnIOaooeaAgeahhuacrOi6q+mFjee9rlxuICAgKiBAcGFyYW0gbW9kYWxJZCDmqKHmgIHmoYblhoXnu4Tku7bnmoRpZFxuICAgKiBAcGFyYW0gdWlTdGF0ZUNvbmZpZyDmqKHmgIHmoYblhoXnu4Tku7Z1aVN0YXRl5LiK55qE5a2X5q615Y+K5YC8XG4gICAqL1xuICBwdWJsaWMgb3Blbk1vZGFsKGNvbmZpZzogYW55ID0ge30sIG1vZGFsSWQ6IHN0cmluZywgdWlTdGF0ZUNvbmZpZzogYW55ID0ge30sIGNhbGxiYWNrPzogKG1vZGFsUmVmOiBhbnkpID0+IGFueSkge1xuXG4gICAgY29uc3QgY29uZmlnT2JqID0gdGhpcy5nZXRPYmplY3RUeXBlQ29uZmlnKGNvbmZpZyk7XG4gICAgY29uc3QgdWlTdGF0ZU9iamVjdCA9IHRoaXMuZ2V0T2JqZWN0VHlwZUNvbmZpZyh1aVN0YXRlQ29uZmlnKTtcbiAgICBsZXQgaW5uZXJDb21wb3BuZW50ID0gdGhpcy5mYXJyaXNGb3JtU2VydmljZS5nZXRDb250cm9scyhtb2RhbElkKTtcbiAgICBsZXQgbW9kYWxSZWY6IGFueTtcbiAgICBsZXQgbW9kYWxDb25maWc6IGFueSA9IHtcbiAgICAgIHRpdGxlOiB0aGlzLmxhbmd1YWdlU2VydmljZS5kZWZhdWx0RGlhbG9nVGl0bGUsXG4gICAgICB3aWR0aDogNzYwLFxuICAgICAgaGVpZ2h0OiA0NTAsXG4gICAgICBzaG93QnV0dG9uczogZmFsc2VcbiAgICB9O1xuICAgIG1vZGFsQ29uZmlnID0gT2JqZWN0LmFzc2lnbihtb2RhbENvbmZpZywgY29uZmlnT2JqKTtcbiAgICBjb25zdCBvbkNsb3NpbmdIYW5kbGVyID0gbW9kYWxDb25maWcuYmVmb3JlQ2xvc2U7XG4gICAgLy8gdHNsaW50OmRpc2FibGU6IG5vLXN0cmluZy1saXRlcmFsXG4gICAgY29uc3QgY2FuY2VsQ2hhbmdlcyA9IG1vZGFsQ29uZmlnWydjYW5jZWxDaGFuZ2VzJ10gfHwgZmFsc2U7XG4gICAgbW9kYWxDb25maWcuYmVmb3JlQ2xvc2UgPSAocmVmKSA9PiB7XG4gICAgICAvLyBpZiAocmVmICYmIHJlZi5tb2RhbFJlZiAmJiByZWYubW9kYWxSZWYuY29udGVudCkge1xuICAgICAgLy8gICByZWYubW9kYWxSZWYuY29udGVudC5pc0RpYWxvZ1Jvb3RDb21wb25lbnQgPSBmYWxzZTtcbiAgICAgIC8vIH1cbiAgICAgIGlmICghIW9uQ2xvc2luZ0hhbmRsZXIgJiYgdHlwZW9mIG9uQ2xvc2luZ0hhbmRsZXIgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgcmV0dXJuIG9uQ2xvc2luZ0hhbmRsZXIocmVmKS5waXBlKFxuICAgICAgICAgIHN3aXRjaE1hcChyZXN1bHQgPT4ge1xuICAgICAgICAgICAgaWYgKHJlc3VsdCkge1xuICAgICAgICAgICAgICBpZiAoY2FuY2VsQ2hhbmdlcykge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNhbmNlbENoYW5nZXMocmVmKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG9mKHJlc3VsdCk7XG4gICAgICAgICAgfSlcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGlmIChjYW5jZWxDaGFuZ2VzKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNhbmNlbENoYW5nZXMocmVmKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBvZih0cnVlKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIGNvbnN0IHJlbW90ZSA9IG1vZGFsQ29uZmlnLnJlbW90ZSB8fCBmYWxzZTtcbiAgICBpZiAocmVtb3RlKSB7XG4gICAgICB0aGlzLmNyZWF0ZVJlbW90ZUZvcm0obW9kYWxDb25maWcsIHVpU3RhdGVPYmplY3QpLnN1YnNjcmliZShcbiAgICAgICAgKG1vZGFsUmVmOiBhbnkpID0+IHtcbiAgICAgICAgICB0aGlzLm1vZGFsUmVmID0gbW9kYWxSZWY7XG4gICAgICAgICAgaWYgKG1vZGFsUmVmICYmICEhbW9kYWxSZWYuY29udGVudCkge1xuICAgICAgICAgICAgbW9kYWxSZWYuY29udGVudC5pc0RpYWxvZ1Jvb3RDb21wb25lbnQgPSB0cnVlO1xuICAgICAgICAgICAgbW9kYWxSZWYuY29udGVudC5kaWFsb2dSZWYgPSBtb2RhbFJlZjtcbiAgICAgICAgICB9XG4gICAgICAgICAgY2FsbGJhY2sobW9kYWxSZWYpO1xuICAgICAgICB9XG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoIWlubmVyQ29tcG9wbmVudCkge1xuICAgICAgICBjb25zb2xlLmVycm9yKGDojrflj5bmjqfku7blpLHotKXvvIxtb2RhbElkPSR7bW9kYWxJZH1gKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaWYgKHR5cGVvZiBpbm5lckNvbXBvcG5lbnQgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIG1vZGFsQ29uZmlnLmRpYWxvZ1R5cGUgPSAnaWZyYW1lJztcbiAgICAgICAgbW9kYWxSZWYgPSB0aGlzLm1vZGFsU2VydmljZS5zaG93KGlubmVyQ29tcG9wbmVudCwgbW9kYWxDb25maWcpO1xuICAgICAgfSBlbHNlIGlmICh0eXBlb2YgaW5uZXJDb21wb3BuZW50ID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIG1vZGFsUmVmID0gdGhpcy5jcmVhdGVNb2RhbENvbXBvbmVudFJlZihtb2RhbENvbmZpZywgaW5uZXJDb21wb3BuZW50LCB1aVN0YXRlT2JqZWN0KTtcbiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGlubmVyQ29tcG9wbmVudCA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgLy8g5aaC5p6c5piv5a+56LGhIOS4lOS9v+eUqOeLrOeri2pz5Yqg6L29XG4gICAgICAgIC8vIHtcInVzZUlzb2xhdGVKc1wiOnRydWUsXCJtb2RhbEluc3RhbmNlXCI6ZigpfVxuICAgICAgICBpZiAoaW5uZXJDb21wb3BuZW50LnVzZUlzb2xhdGVKcykge1xuICAgICAgICAgIGNvbnN0IHBhcmFtZXRlciA9IHtcbiAgICAgICAgICAgIGluamVjdG9yOiB0aGlzLmluamVjdG9yLFxuICAgICAgICAgICAgdWlTdGF0ZTogdWlTdGF0ZU9iamVjdCxcbiAgICAgICAgICAgIG1vZGFsU2VydmljZTogdGhpcy5tb2RhbFNlcnZpY2UsXG4gICAgICAgICAgICBkaWFsb2dTZXJ2aWNlSW5zdGFuY2U6IHRoaXMsXG4gICAgICAgICAgICBldmVudEJ1czogdGhpcy5mcmFtZUNvbnRleHQuZ2V0VmlydHVhbFJvb3RGcmFtZUNvbnRleHQoKS5ldmVudEJ1cyxcbiAgICAgICAgICAgIGNvbXBvbmVudENhbGxiYWNrOiB0aGlzLmNvbXBvbmVudE1vZGlmeSxcbiAgICAgICAgICAgIG1vZGFsSW5zdGFuY2VDYWxsYmFjazogdGhpcy5tb2RhbEluc3RhbmNlQ2FsbGJhY2tcbiAgICAgICAgICB9O1xuICAgICAgICAgIC8vIOS8muWcqOWGhemDqOi/m+ihjFxuICAgICAgICAgIHJldHVybiBpbm5lckNvbXBvcG5lbnRbXCJtb2RhbEluc3RhbmNlXCJdKG1vZGFsQ29uZmlnLCBwYXJhbWV0ZXIpO1xuXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbW9kYWxSZWYgPSB0aGlzLm1vZGFsU2VydmljZS5zaG93KGlubmVyQ29tcG9wbmVudCwgbW9kYWxDb25maWcpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHRoaXMubW9kYWxSZWYgPSBtb2RhbFJlZjtcbiAgICAgIGlmIChtb2RhbFJlZiAmJiAhIW1vZGFsUmVmLmNvbnRlbnQpIHtcbiAgICAgICAgbW9kYWxSZWYuY29udGVudC5pc0RpYWxvZ1Jvb3RDb21wb25lbnQgPSB0cnVlO1xuICAgICAgICBtb2RhbFJlZi5jb250ZW50LmRpYWxvZ1JlZiA9IG1vZGFsUmVmO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG1vZGFsUmVmO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY29tcG9uZW50TW9kaWZ5KGNtcFJlZjogYW55LCBwYXJhbWV0ZXI6IHtcbiAgICB1aXN0YXRlOiBhbnlcbiAgfSkge1xuICAgIGlmIChjbXBSZWYgJiYgY21wUmVmLmluc3RhbmNlICYmIGNtcFJlZi5pbnN0YW5jZS52aWV3TW9kZWwgJiYgY21wUmVmLmluc3RhbmNlLnZpZXdNb2RlbC51aVN0YXRlKSB7XG4gICAgICBpZiAocGFyYW1ldGVyLnVpc3RhdGUgJiYgdHlwZW9mIHBhcmFtZXRlci51aXN0YXRlID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIHBhcmFtZXRlci51aXN0YXRlID0gSlNPTi5wYXJzZShwYXJhbWV0ZXIudWlzdGF0ZSk7XG4gICAgICB9XG4gICAgICBpZiAodHlwZW9mIHBhcmFtZXRlci51aXN0YXRlID09PSAnb2JqZWN0JyAmJiBPYmplY3Qua2V5cyhwYXJhbWV0ZXIudWlzdGF0ZSkubGVuZ3RoKSB7XG4gICAgICAgIE9iamVjdC5rZXlzKHBhcmFtZXRlci51aXN0YXRlKS5mb3JFYWNoKGl0ZW0gPT4ge1xuICAgICAgICAgIGNtcFJlZi5pbnN0YW5jZS52aWV3TW9kZWwudWlTdGF0ZS5zZXRQcm9wZXJ0eVZhbHVlKGl0ZW0sIHBhcmFtZXRlci51aXN0YXRlW2l0ZW1dKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICAvLyDpmYTliqBpc0RpYWxvZ+WPguaVsFxuICAgICAgY21wUmVmLmluc3RhbmNlLnZpZXdNb2RlbC51aVN0YXRlLnNldFByb3BlcnR5VmFsdWUoJ0RFVktJVF9ESUFMT0cnLCB0cnVlKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIG1vZGFsSW5zdGFuY2VDYWxsYmFjayhjbXBSZWY6IGFueSwgb3B0aW9uczogYW55LCBwYXJhbWV0ZXI6IGFueSkge1xuICAgIGlmIChwYXJhbWV0ZXIgJiYgcGFyYW1ldGVyLm1vZGFsU2VydmljZSkge1xuICAgICAgY29uc3QgbW9kYWxSZWYgPSBwYXJhbWV0ZXIubW9kYWxTZXJ2aWNlLnNob3coY21wUmVmLCBvcHRpb25zKTtcbiAgICAgIGlmIChtb2RhbFJlZiAmJiAhIW1vZGFsUmVmLmNvbnRlbnQpIHtcbiAgICAgICAgbW9kYWxSZWYuY29udGVudC5pc0RpYWxvZ1Jvb3RDb21wb25lbnQgPSB0cnVlO1xuICAgICAgICBtb2RhbFJlZi5jb250ZW50LmRpYWxvZ1JlZiA9IG1vZGFsUmVmO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG1vZGFsUmVmO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDmiZPlvIDnsbvluK7liqnooajljZVcbiAgICogQHBhcmFtIGZyYW1lSWQgXG4gICAqIEBwYXJhbSBwYXJhbXMgXG4gICAqIEBwYXJhbSBjb25maWdzIFxuICAgKiBAZGVzY3JpcHRpb24g5by55Ye66KGo5Y2V5ZKM5by55Ye66L+c56uv6KGo5Y2V5Yy65Yir5Li65by55Ye66KGo5Y2V6ZyA6KaB6YWN572u5a2X5q615pig5bCEXG4gICAqL1xuICBwdWJsaWMgb3BlbkhlbHBNb2RhbChmcmFtZUlkOiBzdHJpbmcsIHBhcmFtczogc3RyaW5nLCBjb25maWdzPzogYW55KSB7XG4gICAgY29uc3QgZXZlbnRzID0gdGhpc1snY29udGV4dCddWydldmVudFBhcmFtJ10gfHwge307XG4gICAgLy8g5Y2h54mH5Zy65pmv5Lyg6YCS6L+H5p2l55qE5LqL5Lu25piv6Ieq5a6a5LmJ5a+56LGh77yM5YyF5ZCrZXZlbnTlkoxvcHRpb25z44CC5YiX6KGo5Zy65pmv5Lyg6YCS6L+H5p2l55qE5LqL5Lu25Y+C5pWw5piv5pmu6YCa5LqL5Lu25Y+C5pWw77yM5Zyo5Y+C5pWw5Lit5pC65bim5LqGZWRpdG9yLm9wdGlvbnNcbiAgICBjb25zdCBldmVudCA9IGV2ZW50cy5ldmVudCB8fCBldmVudHM7XG4gICAgY29uc3Qgb3B0aW9ucyA9IGV2ZW50cy5vcHRpb25zIHx8IGV2ZW50cy5lZGl0b3IgJiYgZXZlbnRzLmVkaXRvci5vcHRpb25zIHx8IHt9O1xuICAgIGNvbnN0IGNvbnRleHQgPSBldmVudHMgJiYgZXZlbnRzLmNvbnRleHQ7XG4gICAgY29uc3Qgc3ViamVjdCA9IG5ldyBTdWJqZWN0PGFueT4oKTtcbiAgICAvLyBtb2RhbElk5Zyo5Lik56eN5Zy65pmv5LiL6YO96ZyA6KaB77yM55So5p2l5Yy65YiG5a6e5L6LXG4gICAgY29uc3QgeyBtb2RhbElkID0gbnVsbCB9ID0gb3B0aW9ucztcbiAgICBpZiAoIWNvbmZpZ3MpIHtcbiAgICAgIGNvbmZpZ3MgPSAne30nO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIGNvbmZpZ3MgPT09ICdzdHJpbmcnICYmIGNvbmZpZ3MubGVuZ3RoID4gMCkge1xuICAgICAgY29uZmlncyA9IEpTT04ucGFyc2UoY29uZmlncyk7XG4gICAgfVxuICAgIGNvbnN0IHsgcmVtb3RlID0gZmFsc2UsIGN1cnJlbnRSb3cgPSBmYWxzZSwgYXJlYVJlc3BvbnNlID0gdW5kZWZpbmVkIH0gPSBjb25maWdzIHx8IHt9O1xuICAgIC8vIOaUr+aMgWFyZWFSZXNwb25zZemFjee9rlxuICAgIGlmIChhcmVhUmVzcG9uc2UgIT09IHVuZGVmaW5lZCAmJiBvcHRpb25zLmFyZWFSZXNwb25zZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBvcHRpb25zLmFyZWFSZXNwb25zZSA9IGFyZWFSZXNwb25zZTtcbiAgICB9XG4gICAgaWYgKHJlbW90ZSkge1xuICAgICAgY29uc3QgbWFwRmllbGRzID0gY29uZmlncy5tYXBGaWVsZHMgfHwge307XG4gICAgICBvcHRpb25zLnJlbW90ZSA9IHJlbW90ZSArICc/dj0nICsgbmV3IERhdGUoKS52YWx1ZU9mKCk7XG4gICAgICB0aGlzLm9wZW5Nb2RhbChvcHRpb25zLCBtb2RhbElkLCBwYXJhbXMsIChkaWFsb2dSZWY6IGFueSkgPT4ge1xuICAgICAgICAvLyDmlrDlop5ldmVudOWPguaVsO+8iOS4uuS6huS7peWQjuiwg+eUqGV2ZW505Lit55qEZm9ybUNvbnRyb2zku6XpgILphY3liJfooajkuK3nmoTmmbrog73ovpPlhaXmoYblvLnlh7rooajljZXvvIlcbiAgICAgICAgdGhpcy5tb2RhbHNbbW9kYWxJZF0gPSB7IHN1YmplY3QsIGZyYW1lSWQ6IGZyYW1lSWQsIG1hcEZpZWxkcywgZGlhbG9nUmVmLCBjdXJyZW50Um93LCBldmVudDogZXZlbnQsIGNvbnRleHQgfTtcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBkaWFsb2dSZWYgPSB0aGlzLm9wZW5Nb2RhbChvcHRpb25zLCBtb2RhbElkLCBwYXJhbXMpO1xuICAgICAgY29uc3QgbWFwRmllbGRzID0gb3B0aW9ucy5tYXBGaWVsZHMgfHwge307XG4gICAgICB0aGlzLm1vZGFsc1ttb2RhbElkXSA9IHsgc3ViamVjdCwgZnJhbWVJZDogZnJhbWVJZCwgbWFwRmllbGRzLCBkaWFsb2dSZWYsIGN1cnJlbnRSb3csIGV2ZW50OiBldmVudCwgY29udGV4dCB9O1xuICAgIH1cbiAgICByZXR1cm4gc3ViamVjdDtcbiAgfVxuXG4gIC8qKlxuICAgKiDmiZPlvIDluKblm57osIPnmoTlvLnnqpdcbiAgICogQHBhcmFtIGZyYW1lSWQgZnJhbWVJZFxuICAgKiBAcGFyYW0gcGFyYW1zIOWPguaVsFxuICAgKiBAcGFyYW0gY29uZmlncyDphY3nva5cbiAgICogQHJldHVybnMgXG4gICAqL1xuICBwdWJsaWMgb3BlbkNhbGxiYWNrYWJsZU1vZGFsKGZyYW1lSWQ6IHN0cmluZywgcGFyYW1zPzogc3RyaW5nLCBjb25maWdzPzogYW55KSB7XG4gICAgaWYgKCFjb25maWdzKSB7XG4gICAgICBjb25maWdzID0gJ3t9JztcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBjb25maWdzID09PSAnc3RyaW5nJykge1xuICAgICAgY29uZmlncyA9IEpTT04ucGFyc2UoY29uZmlncyk7XG4gICAgfVxuICAgIGNvbnN0IGV2ZW50cyA9IHRoaXNbJ2NvbnRleHQnXSAmJiB0aGlzWydjb250ZXh0J11bJ2V2ZW50UGFyYW0nXSB8fCB7fTtcbiAgICBjb25zdCBvcHRpb25zID0gZXZlbnRzLm9wdGlvbnM7XG4gICAgb3B0aW9ucy5zaG93QnV0dG9ucyA9IHRydWU7XG4gICAgb3B0aW9ucy5idXR0b25zID0gW1xuICAgICAge1xuICAgICAgICB0ZXh0OiB0aGlzLmxhbmd1YWdlU2VydmljZS5jb25maXJtLCBjbHM6ICdidG4gYnRuLXByaW1hcnknLCBoYW5kbGU6IChldmVudDogYW55KSA9PiB7XG4gICAgICAgICAgY29uc3QgeyBtb2RhbElkID0gbnVsbCB9ID0gb3B0aW9ucyB8fCB7fTtcbiAgICAgICAgICBpZiAobW9kYWxJZCkge1xuICAgICAgICAgICAgY29uc3QgbW9kYWwgPSB0aGlzLm1vZGFsc1ttb2RhbElkXTtcbiAgICAgICAgICAgIGNvbnN0IHsgc3ViamVjdCA9IG51bGwsIGRpYWxvZ1JlZiA9IG51bGwsIGZyYW1lSWQgPSBudWxsLCBoYW5kbGUgPSBudWxsLCBjdXJyZW50Um93ID0gZmFsc2UgfSA9IG1vZGFsIHx8IHt9O1xuICAgICAgICAgICAgY29uc3QgZm9ybUNtcCA9IGRpYWxvZ1JlZi5jb250ZW50OyAvLyDlvLnnqpfooajljZXlrp7kvotcbiAgICAgICAgICAgIGlmICghZm9ybUNtcCkge1xuICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ+S4jeaUr+aMgeeahOihqOWNleexu+WeiycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IHNlbGVjdGVkSXRlbXMgPSBbXTtcbiAgICAgICAgICAgIGlmIChjdXJyZW50Um93ID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgIGxldCBmcmFtZUNvbXRleHQ6IEZyYW1lQ29udGV4dDtcbiAgICAgICAgICAgICAgaWYgKGZvcm1DbXAuY29udGV4dCkge1xuICAgICAgICAgICAgICAgIGZyYW1lQ29tdGV4dCA9IGZvcm1DbXAuY29udGV4dC5hcHBDb250ZXh0LmZyYW1lQ29udGV4dE1hbmFnZXIuZ2V0RnJhbWVDb250ZXh0QnlJZChmcmFtZUlkKSBhcyBGcmFtZUNvbnRleHQ7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZnJhbWVDb210ZXh0ID0gZm9ybUNtcC5hcHBDb250ZXh0LmZyYW1lQ29udGV4dE1hbmFnZXIuZ2V0RnJhbWVDb250ZXh0QnlJZChmcmFtZUlkKSBhcyBGcmFtZUNvbnRleHQ7XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICBpZiAoIWZyYW1lQ29tdGV4dCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihg5peg5pWI55qEZnJhbWVJZO+8miR7ZnJhbWVJZH3vvIzor7fnoa7orqTlkb3ku6TkuK1mcmFtZUlk5q2j56Gu44CCYCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgY29uc3QgYmluZGluZ0xpc3QgPSBmcmFtZUNvbXRleHQuYmluZGluZ0RhdGEuZ2V0TGlzdCgpIGFzIEJpbmRpbmdMaXN0O1xuICAgICAgICAgICAgICBjb25zdCBpdGVtID0gYmluZGluZ0xpc3QgJiYgYmluZGluZ0xpc3QuY3VycmVudEl0ZW0gJiYgYmluZGluZ0xpc3QuY3VycmVudEl0ZW0udG9KU09OKCk7XG4gICAgICAgICAgICAgIHNlbGVjdGVkSXRlbXMgPSBbaXRlbV07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBsZXQgcm93czogTWFwPHN0cmluZywgYW55PjtcbiAgICAgICAgICAgICAgLy8g5aaC5p6cY29udGV4dOS4uuepuiDpgqPkuYjlsJ3or5Xku47lr7nlupTnmoRhcHBjb250ZXh06K+75Y+W77yM5Li76KaB55uu55qE5piv5Li65LqG6Kej5p6Q6KGo5Y2V55qE5by55Ye6XG4gICAgICAgICAgICAgIGlmIChmb3JtQ21wLmNvbnRleHQpIHtcbiAgICAgICAgICAgICAgICByb3dzID0gZm9ybUNtcC5jb250ZXh0LmFwcENvbnRleHQuZnJhbWVDb250ZXh0TWFuYWdlci5nZXRGcmFtZUNvbnRleHRCeUlkKGZyYW1lSWQpLnVpU3RhdGUucm93cyB8fCBuZXcgTWFwPHN0cmluZywgYW55PigpO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJvd3MgPSBmb3JtQ21wLmFwcENvbnRleHQuZnJhbWVDb250ZXh0TWFuYWdlci5nZXRGcmFtZUNvbnRleHRCeUlkKGZyYW1lSWQpLnVpU3RhdGUucm93cyB8fCBuZXcgTWFwPHN0cmluZywgYW55PigpO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgc2VsZWN0ZWRJdGVtcyA9IEFycmF5LmZyb20ocm93cy52YWx1ZXMoKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodHlwZW9mIGhhbmRsZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICBoYW5kbGUoc2VsZWN0ZWRJdGVtcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoc3ViamVjdCkge1xuICAgICAgICAgICAgICBzdWJqZWN0Lm5leHQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGRpYWxvZ1JlZi5jbG9zZShvcHRpb25zKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB7IHRleHQ6IHRoaXMubGFuZ3VhZ2VTZXJ2aWNlLmNhbmNlbCwgY2xzOiAnYnRuJywgaGFuZGxlOiAoZXZlbnQ6IGFueSkgPT4gdGhpcy5jYW5jZWwob3B0aW9ucykgfVxuICAgIF07XG5cbiAgICBjb25zdCBzdWJqZWN0ID0gbmV3IFN1YmplY3Q8YW55PigpO1xuICAgIGNvbnN0IHsgbW9kYWxJZCA9IG51bGwgfSA9IG9wdGlvbnM7XG4gICAgY29uc3QgeyByZW1vdGUgPSBudWxsLCBjdXJyZW50Um93ID0gZmFsc2UsIGFyZWFSZXNwb25zZSA9IHVuZGVmaW5lZCB9ID0gY29uZmlncztcbiAgICBjb25zdCBoYW5kbGUgPSBvcHRpb25zLmhhbmRsZTtcbiAgICAvLyDmlK/mjIFhcmVhUmVzcG9uc2XphY3nva5cbiAgICBpZiAoYXJlYVJlc3BvbnNlICE9PSB1bmRlZmluZWQgJiYgb3B0aW9ucy5hcmVhUmVzcG9uc2UgPT09IHVuZGVmaW5lZCkge1xuICAgICAgb3B0aW9ucy5hcmVhUmVzcG9uc2UgPSBhcmVhUmVzcG9uc2U7XG4gICAgfVxuICAgIGlmIChyZW1vdGUpIHtcbiAgICAgIG9wdGlvbnMucmVtb3RlID0gcmVtb3RlICsgJz92PScgKyBuZXcgRGF0ZSgpLnZhbHVlT2YoKTtcbiAgICAgIHRoaXMub3Blbk1vZGFsKG9wdGlvbnMsIG1vZGFsSWQsIHBhcmFtcywgKGRpYWxvZ1JlZjogYW55KSA9PiB7XG4gICAgICAgIHRoaXMubW9kYWxzW21vZGFsSWRdID0geyBzdWJqZWN0LCBmcmFtZUlkOiBmcmFtZUlkLCBkaWFsb2dSZWYsIGhhbmRsZSwgY3VycmVudFJvdywgZXZlbnQ6IGV2ZW50cy5ldmVudCB9O1xuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IGRpYWxvZ1JlZiA9IHRoaXMub3Blbk1vZGFsKG9wdGlvbnMsIG1vZGFsSWQsIHBhcmFtcyk7XG4gICAgICB0aGlzLm1vZGFsc1ttb2RhbElkXSA9IHsgc3ViamVjdCwgZnJhbWVJZDogZnJhbWVJZCwgZGlhbG9nUmVmLCBoYW5kbGUsIGN1cnJlbnRSb3csIGV2ZW50OiBldmVudHMuZXZlbnQgfTtcbiAgICB9XG4gICAgcmV0dXJuIHN1YmplY3Q7XG4gIH1cblxuICAvKipcbiAgICog56Gu6K6k5oyJ6ZKu5LqL5Lu2XG4gICAqIEBwYXJhbSBhcmdzIFxuICAgKi9cbiAgcHVibGljIGNvbmZpcm0oKSB7XG4gICAgY29uc3QgZXZlbnRzID0gdGhpc1snY29udGV4dCddICYmIHRoaXNbJ2NvbnRleHQnXVsnZXZlbnRQYXJhbSddIHx8IHt9O1xuICAgIGNvbnN0IHsgbW9kYWxJZCA9IG51bGwgfSA9IGV2ZW50cyB8fCB7fTtcbiAgICBpZiAobW9kYWxJZCkge1xuICAgICAgY29uc3QgbW9kYWwgPSB0aGlzLm1vZGFsc1ttb2RhbElkXTtcbiAgICAgIGNvbnN0IHsgc3ViamVjdCA9IG51bGwsIGRpYWxvZ1JlZiA9IG51bGwsIG1hcEZpZWxkcyA9IHt9LCBmcmFtZUlkID0gbnVsbCwgY3VycmVudFJvdyA9IGZhbHNlLCBldmVudCA9IG51bGwsIGNvbnRleHQgPSBudWxsIH0gPSBtb2RhbCB8fCB7fTtcbiAgICAgIGNvbnN0IGZvcm1DbXAgPSBkaWFsb2dSZWYuY29udGVudDsgLy8g5by556qX6KGo5Y2V5a6e5L6LXG4gICAgICBpZiAoIWZvcm1DbXApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCfkuI3mlK/mjIHnmoTooajljZXnsbvlnosnKTtcbiAgICAgIH1cbiAgICAgIC8vIGNvbnN0IHNlbGVjdGVkSWRzID0gZm9ybUNtcC5jb250ZXh0LmFwcENvbnRleHQuZnJhbWVDb250ZXh0TWFuYWdlci5nZXRGcmFtZUNvbnRleHRCeUlkKGZyYW1lSWQpLnVpU3RhdGUuaWRzO1xuXG4gICAgICBsZXQgc2VsZWN0ZWRJdGVtcyA9IFtdO1xuICAgICAgaWYgKGN1cnJlbnRSb3cgPT09IHRydWUpIHtcbiAgICAgICAgY29uc3QgZnJhbWVDb210ZXh0ID0gZm9ybUNtcC5jb250ZXh0LmFwcENvbnRleHQuZnJhbWVDb250ZXh0TWFuYWdlci5nZXRGcmFtZUNvbnRleHRCeUlkKGZyYW1lSWQpIGFzIEZyYW1lQ29udGV4dDtcbiAgICAgICAgaWYgKCFmcmFtZUNvbXRleHQpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYOaXoOaViOeahGZyYW1lSWTvvJoke2ZyYW1lSWR977yM6K+356Gu6K6k5ZG95Luk5LitZnJhbWVJZOato+ehruOAgmApO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGJpbmRpbmdMaXN0ID0gZnJhbWVDb210ZXh0LmJpbmRpbmdEYXRhLmdldExpc3QoKSBhcyBCaW5kaW5nTGlzdDtcbiAgICAgICAgY29uc3QgaXRlbSA9IGJpbmRpbmdMaXN0ICYmIGJpbmRpbmdMaXN0LmN1cnJlbnRJdGVtICYmIGJpbmRpbmdMaXN0LmN1cnJlbnRJdGVtLnRvSlNPTigpO1xuICAgICAgICBpZiAoaXRlbSAmJiBPYmplY3Qua2V5cyhpdGVtKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgc2VsZWN0ZWRJdGVtcyA9IFtpdGVtXTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3Qgcm93czogTWFwPHN0cmluZywgYW55PiA9IGZvcm1DbXAuY29udGV4dC5hcHBDb250ZXh0LmZyYW1lQ29udGV4dE1hbmFnZXIuZ2V0RnJhbWVDb250ZXh0QnlJZChmcmFtZUlkKS51aVN0YXRlLnJvd3MgfHwgbmV3IE1hcDxzdHJpbmcsIGFueT4oKTtcbiAgICAgICAgc2VsZWN0ZWRJdGVtcyA9IEFycmF5LmZyb20ocm93cy52YWx1ZXMoKSk7XG4gICAgICB9XG5cbiAgICAgIC8vIOaYoOWwhOWtl+auteaVsOaNrlxuICAgICAgLy8g6I635Y+W6Kem5Y+R5by55qGG55qE57yW6L6R5Zmo55qE5a2X5q615ZCN56ewXG4gICAgICBsZXQgZWRpdG9yRmllbGQgPSB1bmRlZmluZWQ7XG4gICAgICBpZiAoZXZlbnQgJiYgZXZlbnQuZWRpdG9yICYmIGV2ZW50LmVkaXRvci5jb2x1bW4pIHtcbiAgICAgICAgZWRpdG9yRmllbGQgPSBldmVudC5lZGl0b3IuY29sdW1uLmZpZWxkO1xuICAgICAgfVxuICAgICAgaWYgKHNlbGVjdGVkSXRlbXMgJiYgbWFwRmllbGRzKSB7XG4gICAgICAgIE9iamVjdC5rZXlzKG1hcEZpZWxkcykuZm9yRWFjaChrID0+IHtcbiAgICAgICAgICBjb25zdCB0YXJnZXRGaWVsZDogc3RyaW5nID0gbWFwRmllbGRzW2tdO1xuICAgICAgICAgIGNvbnN0IHNvdXJjZUtleUFycmF5ID0gay5zcGxpdCgnLicpLmZpbHRlcihwID0+IHApIHx8IFtdO1xuICAgICAgICAgIGNvbnN0IHRhcmdldFZhbHVlID0gc2VsZWN0ZWRJdGVtcy5tYXAociA9PiB7XG4gICAgICAgICAgICByZXR1cm4gc291cmNlS2V5QXJyYXkucmVkdWNlKCh0YXJnZXQsIGtleSkgPT4ge1xuICAgICAgICAgICAgICBpZiAodGFyZ2V0ICYmICh0YXJnZXQuaGFzT3duUHJvcGVydHkoa2V5KSB8fCB0YXJnZXRbJ19fcHJvdG9fXyddLmhhc093blByb3BlcnR5KGtleSkpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRhcmdldFtrZXldO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgcik7XG4gICAgICAgICAgfSkuam9pbignLCcpO1xuICAgICAgICAgIGlmICh0YXJnZXRGaWVsZCkge1xuICAgICAgICAgICAgY29uc3QgYmluZGluZ1BhdGhzID0gdGhpcy5mcmFtZUNvbnRleHQudmlld01vZGVsLmJpbmRpbmdQYXRoLnNwbGl0KCcvJykuZmlsdGVyKHAgPT4gcCk7XG4gICAgICAgICAgICBjb25zdCB0YXJnZXRGaWVsZHMgPSB0YXJnZXRGaWVsZC5zcGxpdCgnLCcpLmZpbHRlcihwID0+IHApO1xuICAgICAgICAgICAgdGFyZ2V0RmllbGRzLmZvckVhY2godGFyZ2V0ID0+IHtcbiAgICAgICAgICAgICAgaWYgKGNvbnRleHQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldFZhbHVlQnlQYXRoKGNvbnRleHQsIHRhcmdldCwgdGFyZ2V0VmFsdWUpO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldFBhdGggPSB0YXJnZXQuc3BsaXQoJy4nKTtcbiAgICAgICAgICAgICAgICB0aGlzLmZyYW1lQ29udGV4dC5iaW5kaW5nRGF0YS5zZXRWYWx1ZShiaW5kaW5nUGF0aHMuY29uY2F0KHRhcmdldFBhdGgpLCB0YXJnZXRWYWx1ZSwgdHJ1ZSwgdHJ1ZSk7XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgfVxuICAgICAgaWYgKHN1YmplY3QpIHtcbiAgICAgICAgc3ViamVjdC5uZXh0KCk7XG4gICAgICB9XG4gICAgICBkaWFsb2dSZWYuY2xvc2UoKTtcbiAgICB9XG4gIH1cbiAgLyoqXG4gICAqIOWPlua2iOaMiemSruS6i+S7tlxuICAgKiBAcGFyYW0gYXJncyBcbiAgICovXG4gIHB1YmxpYyBjYW5jZWwoZXZlbnQ/OiBhbnkpIHtcbiAgICBjb25zdCBldmVudHMgPSBldmVudCB8fCB0aGlzWydjb250ZXh0J10gJiYgdGhpc1snY29udGV4dCddWydldmVudFBhcmFtJ10gfHwge307XG4gICAgY29uc3QgeyBtb2RhbElkID0gbnVsbCB9ID0gZXZlbnRzIHx8IHt9O1xuICAgIGlmIChtb2RhbElkKSB7XG4gICAgICBjb25zdCBtb2RhbCA9IHRoaXMubW9kYWxzW21vZGFsSWRdO1xuICAgICAgY29uc3QgeyBzdWJqZWN0ID0gbnVsbCwgZGlhbG9nUmVmID0gbnVsbCB9ID0gbW9kYWwgfHwge307XG4gICAgICBpZiAoc3ViamVjdCkge1xuICAgICAgICBzdWJqZWN0Lm5leHQoKTtcbiAgICAgIH1cbiAgICAgIGlmIChkaWFsb2dSZWYpIHtcbiAgICAgICAgZGlhbG9nUmVmLmNsb3NlKCk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIC8qKlxuICAgKiDlj5bmtojmnI3liqHlmajlj5jmm7Tpm4ZcbiAgICovXG4gIHByaXZhdGUgY2FuY2VsQ2hhbmdlcyhyZWY6IGFueSk6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xuICAgIGlmIChyZWYgJiYgcmVmLm1vZGFsUmVmICYmIHJlZi5tb2RhbFJlZi5jb250ZW50KSB7XG4gICAgICBjb25zdCBjb21wb25lbnQ6IEZyYW1lQ29tcG9uZW50ID0gcmVmLm1vZGFsUmVmLmNvbnRlbnQgYXMgRnJhbWVDb21wb25lbnQ7XG4gICAgICBpZiAoY29tcG9uZW50ICYmIGNvbXBvbmVudC5jb250ZXh0KSB7XG4gICAgICAgIGNvbnN0IHJlcG9zaXRvcnkgPSBjb21wb25lbnQuY29udGV4dC5yZXBvc2l0b3J5IHx8IG51bGw7XG4gICAgICAgIGlmIChyZXBvc2l0b3J5KSB7XG4gICAgICAgICAgcmV0dXJuIHJlcG9zaXRvcnkuY2FuY2VsQ2hhbmdlcygpLnBpcGUoc3dpdGNoTWFwKCgpID0+IG9mKHRydWUpKSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG9mKHRydWUpO1xuICB9XG4gIC8qKlxuICAgKiDlhbPpl63or6XlvLnnqpdcbiAgICovXG4gIGNsb3NlTW9kYWwoKSB7XG4gICAgaWYgKHRoaXMubW9kYWxSZWYpIHtcbiAgICAgIHRoaXMubW9kYWxSZWYuY2xvc2UoKTtcbiAgICB9XG4gIH1cbiAgLyoqXG4gICAqIOWIm+W7uui/nOeoi+ihqOWNleWunuS+i1xuICAgKiBAcGFyYW0gb3B0aW9ucyBkaWFsb2fphY3nva5cbiAgICogQHBhcmFtIHVpU3RhdGUgdWlzdGF0ZVxuICAgKi9cbiAgcHJpdmF0ZSBjcmVhdGVSZW1vdGVGb3JtKG9wdGlvbnM6IGFueSwgdWlTdGF0ZTogYW55KTogU3ViamVjdDxhbnk+IHtcbiAgICBjb25zdCByZW1vdGUgPSBvcHRpb25zLnJlbW90ZSB8fCBmYWxzZTtcbiAgICBjb25zdCBzdWJqZWN0ID0gbmV3IFN1YmplY3Q8YW55PigpO1xuICAgIGlmIChyZW1vdGUpIHtcbiAgICAgIGxldCBtb2R1bGVOYW1lID0gb3B0aW9ucy5tb2R1bGVOYW1lIHx8IG51bGw7XG4gICAgICBTeXN0ZW0uaW1wb3J0KHJlbW90ZSkudGhlbigobW9kdWxlOiBhbnkpID0+IHtcbiAgICAgICAgaWYgKCFtb2R1bGVOYW1lKSB7XG4gICAgICAgICAgbW9kdWxlTmFtZSA9IE9iamVjdC5rZXlzKG1vZHVsZSkucG9wKCk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbW9kdWxlRmFjdG9yeSA9IG1vZHVsZVttb2R1bGVOYW1lXSBhcyBOZ01vZHVsZUZhY3Rvcnk8YW55PjtcbiAgICAgICAgY29uc3QgbW9kdWxlUmVmID0gbW9kdWxlRmFjdG9yeS5jcmVhdGUodGhpcy5pbmplY3Rvcik7XG4gICAgICAgIGNvbnN0IGVudHJ5Q29tcG9uZW50ID0gbW9kdWxlUmVmWydfYm9vdHN0cmFwQ29tcG9uZW50cyddWzBdO1xuICAgICAgICBpZiAoZW50cnlDb21wb25lbnQpIHtcbiAgICAgICAgICBjb25zdCBjb21wRmFjdG9yeSA9IG1vZHVsZVJlZi5jb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoZW50cnlDb21wb25lbnQpO1xuICAgICAgICAgIGNvbnN0IGNvbXBvbmVudFJlZjogQ29tcG9uZW50UmVmPGFueT4gPSBjb21wRmFjdG9yeS5jcmVhdGUodGhpcy5pbmplY3Rvcik7XG5cbiAgICAgICAgICBpZiAoY29tcG9uZW50UmVmICYmIGNvbXBvbmVudFJlZi5pbnN0YW5jZSAmJiBjb21wb25lbnRSZWYuaW5zdGFuY2Uudmlld01vZGVsICYmIGNvbXBvbmVudFJlZi5pbnN0YW5jZS52aWV3TW9kZWwudWlTdGF0ZSkge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB1aVN0YXRlID09PSAnb2JqZWN0JyAmJiBPYmplY3Qua2V5cyh1aVN0YXRlKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgT2JqZWN0LmtleXModWlTdGF0ZSkuZm9yRWFjaChpdGVtID0+IHtcbiAgICAgICAgICAgICAgICBjb21wb25lbnRSZWYuaW5zdGFuY2Uudmlld01vZGVsLnVpU3RhdGUuc2V0UHJvcGVydHlWYWx1ZShpdGVtLCB1aVN0YXRlW2l0ZW1dKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyDpmYTliqBpc0RpYWxvZ+WPguaVsFxuICAgICAgICAgICAgY29tcG9uZW50UmVmLmluc3RhbmNlLnZpZXdNb2RlbC51aVN0YXRlLnNldFByb3BlcnR5VmFsdWUoJ0RFVktJVF9ESUFMT0cnLCB0cnVlKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3QgbW9kYWxSZWYgPSB0aGlzLm1vZGFsU2VydmljZS5zaG93KGNvbXBvbmVudFJlZiwgb3B0aW9ucyk7XG4gICAgICAgICAgc3ViamVjdC5uZXh0KG1vZGFsUmVmKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYOaXoOazleaJvuWIsOWFpeWPo+ihqOWNle+8gWApO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIHN1YmplY3Q7XG4gIH1cbiAgcHJpdmF0ZSBzZXRWYWx1ZUJ5UGF0aCh0YXJnZXQ6IG9iamVjdCwgcGF0aDogc3RyaW5nLCB2YWx1ZTogYW55KSB7XG4gICAgaWYgKHRhcmdldCkge1xuICAgICAgY29uc3QgcGF0aHMgPSBwYXRoLnNwbGl0KCcuJyk7XG4gICAgICBpZiAocGF0aHMubGVuZ3RoIDw9IDEpIHtcbiAgICAgICAgdGFyZ2V0W3BhdGhdID0gdmFsdWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBwYXRocy5zbGljZSgwLCAtMSkucmVkdWNlKChwcmV2LCBwYXRoKSA9PiB7XG4gICAgICAgICAgaWYgKCEocHJldi5oYXNPd25Qcm9wZXJ0eShwYXRoKSB8fCBwcmV2WydfX3Byb3RvX18nXS5oYXNPd25Qcm9wZXJ0eShwYXRoKSkpIHtcbiAgICAgICAgICAgIHByZXZbcGF0aF0gPSB7fTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHByZXZbcGF0aF07XG4gICAgICAgIH0sIHRhcmdldClbcGF0aHNbcGF0aHMubGVuZ3RoIC0gMV1dID0gdmFsdWU7XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCB7IERpYWxvZ1NlcnZpY2UgfTtcbiJdfQ==