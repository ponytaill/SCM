/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { ComponentFactoryResolver, Directive, HostListener, Injector, Input, NgZone, Renderer2 } from '@angular/core';
import { reqAnimFrame } from '@farris/ui-common';
import { InputGroupComponent } from '@farris/ui-input-group';
import { debounceTime, filter, map } from 'rxjs/operators';
import { LookupGridDisplayType } from '../lookup-displaytype';
import { LookupGridComponent } from '../lookup-grid.component';
import { LookupQuickSelectPanelComponent } from './quick-select-panel.component';
var LookupQuickSelectDirective = /** @class */ (function () {
    function LookupQuickSelectDirective(injector, ngzone, render, inputRef, lookupRef, cfr) {
        this.injector = injector;
        this.ngzone = ngzone;
        this.render = render;
        this.inputRef = inputRef;
        this.lookupRef = lookupRef;
        this.cfr = cfr;
        this.data = [];
    }
    /**
     * @return {?}
     */
    LookupQuickSelectDirective.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @return {?}
     */
    LookupQuickSelectDirective.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.options && this.options.enable) {
            this.inputRef.inputClick.subscribe((/**
             * @param {?} e
             * @return {?}
             */
            function (e) {
                e.stopPropagation();
                if (!_this.panelElement) {
                    // 执行帮助前
                    _this.lookupRef.dictPicking({
                        instance: _this,
                    }).subscribe((/**
                     * @param {?} pr
                     * @return {?}
                     */
                    function (pr) {
                        if (_this.lookupRef.displayType === LookupGridDisplayType.TreeList || (!_this.lookupRef.singleSelect && _this.lookupRef.viewType === 'text')) {
                            return;
                        }
                        var _a = _this.lookupRef.dialogMgr.checkDictPickingResult(pr), show = _a.show, customData = _a.customData, message = _a.message;
                        _this.lookupRef.customData = customData;
                        if (show) {
                            _this.createDataPanel();
                        }
                        else {
                            if (message) {
                                _this.lookupRef.notifyService.warning(message);
                            }
                        }
                    }));
                }
            }));
            this.inputRef.valueChange.pipe(debounceTime(200)).subscribe((/**
             * @param {?} val
             * @return {?}
             */
            function (val) {
                _this.lookupRef.dictPicking({ instance: _this }).subscribe((/**
                 * @param {?} pr
                 * @return {?}
                 */
                function (pr) {
                    if (_this.lookupRef.displayType === LookupGridDisplayType.TreeList || (!_this.lookupRef.singleSelect && _this.lookupRef.viewType === 'text')) {
                        return;
                    }
                    var _a = _this.lookupRef.dialogMgr.checkDictPickingResult(pr), show = _a.show, customData = _a.customData, message = _a.message;
                    _this.lookupRef.customData = customData;
                    if (!_this.panelElement) {
                        _this.createDataPanel();
                    }
                    else {
                        _this.panelElement.style.overflow = 'hidden';
                        _this.setPanelPosition(false);
                        _this.loadData();
                    }
                }));
            }));
            this.inputRef.keydownHandle.pipe(filter((/**
             * @param {?} event
             * @return {?}
             */
            function (event) {
                return event.key === 'Escape' || event.key === 'Tab' || event.key === 'F2';
            }))).subscribe((/**
             * @param {?} e
             * @return {?}
             */
            function (e) {
                _this.hide(e);
            }));
        }
    };
    /**
     * @return {?}
     */
    LookupQuickSelectDirective.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.lookupRef.overLayService.destory(this.lookupRef.el.nativeElement);
    };
    /**
     * @private
     * @return {?}
     */
    LookupQuickSelectDirective.prototype.removePanelElement = /**
     * @private
     * @return {?}
     */
    function () {
        document.body.removeChild(this.panelElement);
        this.panelElement = null;
    };
    /**
     * @private
     * @return {?}
     */
    LookupQuickSelectDirective.prototype.clearSearchValue = /**
     * @private
     * @return {?}
     */
    function () {
        this.lookupRef._searchState = {
            field: '*',
            //"*",
            value: ''
        };
    };
    /**
     * @param {?=} e
     * @param {?=} isMoreClick
     * @return {?}
     */
    LookupQuickSelectDirective.prototype.hide = /**
     * @param {?=} e
     * @param {?=} isMoreClick
     * @return {?}
     */
    function (e, isMoreClick) {
        var _this = this;
        if (isMoreClick === void 0) { isMoreClick = false; }
        reqAnimFrame((/**
         * @return {?}
         */
        function () {
            if (_this.panelElement) {
                if (e && (e.type === 'mousewheel' || e.type === 'wheel')) {
                    _this.removePanelElement();
                }
                else {
                    _this.panelElement.classList.remove('f-area-show');
                    setTimeout((/**
                     * @return {?}
                     */
                    function () {
                        _this.removePanelElement();
                    }), 120);
                }
                _this.lookupRef.overLayService.destory(_this.lookupRef.el.nativeElement);
                if (isMoreClick) {
                    return;
                }
                if (_this.lookupRef.tagInput) {
                    // this.lookupRef.tagInput.value = '';
                    _this.inputRef.value = '';
                    _this.clearSearchValue();
                }
                if (e && (e.key === 'F2' || _this.lookupRef.el.nativeElement.contains(e.target))) {
                    if (_this.data && _this.data.length) {
                        return;
                    }
                    else {
                        _this.clearSearchValue();
                    }
                }
                if (!_this.lookupRef.nosearch && _this.lookupRef.displayText !== _this.lookupRef.originalText) {
                    _this.lookupRef.onChanges(_this.lookupRef.originalText);
                }
            }
        }));
    };
    /**
     * @private
     * @param {?=} updateTopPosition
     * @return {?}
     */
    LookupQuickSelectDirective.prototype.setPanelPosition = /**
     * @private
     * @param {?=} updateTopPosition
     * @return {?}
     */
    function (updateTopPosition) {
        if (updateTopPosition === void 0) { updateTopPosition = true; }
        if (this.panelElement) {
            var _a = this.getPanelSize(), width = _a.width, left = _a.left, top_1 = _a.top, height = _a.height;
            this.panelElement.style.width = width + "px";
            this.panelElement.style.maxHeight = height + "px";
            if (updateTopPosition) {
                this.panelElement.style.top = top_1 + "px";
            }
            this.panelElement.style.left = left + "px";
            this.panelElement.style.zIndex = '10001';
        }
    };
    /**
     * @private
     * @return {?}
     */
    LookupQuickSelectDirective.prototype.createDataPanel = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        this.panelElement = document.createElement('div');
        this.panelElement.classList.add('overlay-pane', 'f-lookup_quick-panel', 'f-area-hide');
        document.body.appendChild(this.panelElement);
        this.setPanelPosition();
        this.panelElement.style.overflow = 'hidden';
        // this.panelElement.style.height = 'auto';
        // 创建数据展示组件
        /** @type {?} */
        var cmpFact = this.cfr.resolveComponentFactory(LookupQuickSelectPanelComponent);
        this.cmpRef = cmpFact.create(this.injector);
        this.cmpRef.instance.showMore = this.options.showMore;
        this.cmpRef.instance.textField = this.lookupRef.textField;
        this.cmpRef.instance.formatter = this.options.formatter;
        this.cmpRef.instance.maxItems = this.options.showItemsCount;
        // cmpRef.location.nativeElement.classList.add('farris-main-area');
        this.panelElement.appendChild(this.cmpRef.location.nativeElement);
        this.lookupRef.selectionMgr.initDisplayValue();
        this.cmpRef.changeDetectorRef.detectChanges();
        // more clicked 打开帮助窗口
        this.cmpRef.instance.moreClcik.subscribe((/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            _this.hide(e, true);
            _this.lookupRef.showDialog();
        }));
        this.cmpRef.instance.itemClick.subscribe((/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            var data = e.data;
            _this.selectItem(data);
        }));
        // 注册鼠标滚轮，点击事件，用于隐藏Panel
        this.lookupRef.overLayService.registerMouseEvent(this.lookupRef.el.nativeElement, (/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            if (!_this.panelElement || e.target['closest']('.f-lookup_quick-panel')) {
                return;
            }
            if (_this.lookupRef.inputGroup && _this.lookupRef.inputGroup.textbox.nativeElement === e.target) {
                return false;
            }
            if (_this.lookupRef.tagInput && _this.lookupRef.tagInput.textbox.nativeElement === e.target) {
                return false;
            }
            if (_this.cmpRef) {
                _this.cmpRef.destroy();
                _this.cmpRef = null;
            }
            _this.clearSearchValue();
            _this.hide(e);
        }));
        this.panelElement.classList.add('f-area-show');
        this.loadData();
    };
    /**
     * @private
     * @param {?} data
     * @return {?}
     */
    LookupQuickSelectDirective.prototype.selectItem = /**
     * @private
     * @param {?} data
     * @return {?}
     */
    function (data) {
        var _this = this;
        if (!data) {
            return;
        }
        if (this.lookupRef.viewType === 'tag') {
            /** @type {?} */
            var isSelect = this.lookupRef.selections.find((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n[_this.lookupRef.idField] === data[_this.lookupRef.idField]; }));
            if (!isSelect) {
                /** @type {?} */
                var selectItems = tslib_1.__spread(this.lookupRef.selections, [data]);
                this.lookupRef.selectItem(selectItems);
                this.lookupRef.lookupSelectionSer.loadSelections(selectItems);
            }
        }
        else {
            this.lookupRef.selectItem(data);
        }
        this.hide();
    };
    /**
     * @private
     * @return {?}
     */
    LookupQuickSelectDirective.prototype.calculationPanelHeight = /**
     * @private
     * @return {?}
     */
    function () {
        return this.options.showItemsCount * 30 + (this.options.showMore ? 50 : 0) + (this.options.footerHeight || 0) + 5;
    };
    /**
     * @private
     * @return {?}
     */
    LookupQuickSelectDirective.prototype.getInputSizeInfo = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var el = this.lookupRef.viewType === 'text' ? this.inputRef.inputGroup : this.lookupRef.tagbox;
        return el.nativeElement.getBoundingClientRect();
    };
    /**
     * @private
     * @return {?}
     */
    LookupQuickSelectDirective.prototype.getPanelSize = /**
     * @private
     * @return {?}
     */
    function () {
        var _a = this.getInputSizeInfo(), width = _a.width, height = _a.height, top = _a.top, left = _a.left;
        /** @type {?} */
        var bottom = window.innerHeight - height - top;
        /** @type {?} */
        var panelHeight = this.calculationPanelHeight();
        /** @type {?} */
        var h = top > bottom ? top : bottom;
        if (bottom > panelHeight) {
            top = top + height;
            // 面板由上向下展开
            this.panelElement.style.transformOrigin = '100% top';
        }
        else {
            if (top > bottom) {
                if (h < panelHeight) {
                    panelHeight = h - 10;
                    top = 10;
                }
                else {
                    top = top - parseInt('' + panelHeight, 10) - 5;
                }
                // 面板由下向上展开
                this.panelElement.style.transformOrigin = '100% bottom';
            }
            else {
                if (h < panelHeight) {
                    panelHeight = h - 10;
                }
                top = top + height;
            }
        }
        /** @type {?} */
        var minWidth = this.options.minWidth || 200;
        /** @type {?} */
        var _width = width < minWidth ? minWidth : width;
        if (window.innerWidth - left < _width) {
            left = left + width - _width;
        }
        return { width: _width, top: top, height: panelHeight, left: left };
    };
    /**
     * @private
     * @return {?}
     */
    LookupQuickSelectDirective.prototype.getData = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var p = {
            pageInfo: {
                pageSize: this.options.showItemsCount,
                pageIndex: 1,
            },
        };
        /** @type {?} */
        var t = "all";
        if (this.lookupRef.isTextChange) {
            this.lookupRef._searchState = {
                field: this.lookupRef.textField,
                //"*",
                value: this.lookupRef.displayText
            };
            p['search'] = this.lookupRef._searchState;
            t = 'search';
        }
        else {
            this.lookupRef._searchState = null;
        }
        if (this.lookupRef.viewType === 'tag') {
            if (this.lookupRef.tagInput.value !== '') {
                this.lookupRef._searchState = {
                    field: this.lookupRef.textField,
                    //"*",
                    value: this.lookupRef.tagInput.value
                };
                p['search'] = this.lookupRef._searchState;
                t = 'search';
            }
            else {
                this.lookupRef._searchState = null;
            }
            /** @type {?} */
            var vals = this.lookupRef.selectionMgr.getSelectedIds();
            if (vals && vals.length) {
                p["selectedInfo"] = {
                    selected: true,
                    selectedIds: vals,
                };
            }
        }
        return this.lookupRef.httpMgr.lookupRequest(p, t, true).pipe(map((/**
         * @param {?} restData
         * @return {?}
         */
        function (restData) {
            /** @type {?} */
            var _items = _this.lookupRef.items || [];
            if (restData) {
                if (_this.lookupRef.viewType === 'tag') {
                    _this.lookupRef.lookupSelectionSer.loadSelections(restData["selectedData"] || []);
                }
                _items = restData.items || [];
            }
            if (_this.lookupRef.displayText && _this.lookupRef.isTextChange) {
                /** @type {?} */
                var items = _items.filter((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) {
                    return n[_this.lookupRef.textField].indexOf(_this.lookupRef.displayText) > -1;
                })).slice(0, _this.options.showItemsCount);
                _items = items;
            }
            if (restData.displayType.toLowerCase().indexOf('treelist') > -1 && _items.length && _items[0].data) {
                return _items.map((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return n.data; })).slice(0, _this.options.showItemsCount);
            }
            return _items.slice(0, _this.options.showItemsCount);
        })));
    };
    /**
     * @private
     * @return {?}
     */
    LookupQuickSelectDirective.prototype.loadData = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var loadingRef = this.lookupRef.loadingService.show({ container: this.panelElement });
        this.getData().subscribe((/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            loadingRef.close();
            if (_this.cmpRef && _this.cmpRef.instance) {
                _this.cmpRef.instance.loadData(data);
                if (data.length < _this.options.showItemsCount) {
                    // let newHeight = data.length * 30 + (this.options.showMore ? 50: 0) + (this.options.footerHeight||0) + 5;
                    _this.data = data;
                    /** @type {?} */
                    var newHeight = _this.cmpRef.instance.itemsContainer.nativeElement.querySelector('ul').offsetHeight + 10;
                    if (!data || !data.length) {
                        newHeight = 55;
                    }
                    _this.cmpRef.instance.itemsContainer.nativeElement.style.height = newHeight + "px";
                    if (_this.panelElement) {
                        if (_this.panelElement.style.transformOrigin.indexOf('bottom') > -1) {
                            _this.panelElement.style.top = _this.getInputSizeInfo().top - newHeight - 5 + "px";
                        }
                        _this.panelElement.style.height = 'auto';
                    }
                }
                else {
                    _this.setPanelPosition();
                    _this.cmpRef.instance.itemsContainer.nativeElement.style.height = '100%';
                    if (_this.panelElement) {
                        _this.render.removeStyle(_this.panelElement, 'height');
                    }
                }
                if ((_this.lookupRef.isTextChange || (_this.lookupRef.tagInput && _this.lookupRef.tagInput.value !== '') ||
                    (_this.lookupRef.inputGroup && _this.lookupRef.inputGroup.value !== '' && _this.lookupRef.isTextChange)) && data && data.length) {
                    _this.cmpRef.instance.setActiveItem(0);
                }
                _this.panelElement.style.overflow = 'auto';
            }
        }));
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    LookupQuickSelectDirective.prototype.registerKeyboardEvent = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        var _this = this;
        if (!this.lookupRef.singleSelect && this.lookupRef.viewType !== 'tag') {
            return;
        }
        /** @type {?} */
        var rows = [];
        if (this.cmpRef) {
            rows = this.cmpRef.instance.data;
        }
        if (!rows || !rows.length) {
            return;
        }
        if ($event.code === 'ArrowUp' || $event.code === 'ArrowDown') {
            $event.preventDefault();
            $event.stopPropagation();
        }
        if ($event.code === 'Backspace' && this.lookupRef.viewType === 'tag' &&
            this.lookupRef.selections && this.lookupRef.selections.length &&
            this.lookupRef.tagInput && !this.lookupRef.tagInput.value && this.lookupRef.quickSelect.enableBackspace) {
            $event.preventDefault();
            $event.stopPropagation();
            /** @type {?} */
            var newdata = this.lookupRef.selections.slice(0, this.lookupRef.selections.length - 1);
            if (!newdata || !newdata.length) {
                this.lookupRef.clearValue(true);
            }
            else {
                this.lookupRef.selectItem(newdata);
            }
            this.lookupRef.lookupSelectionSer.loadSelections(newdata);
            this.setPanelPosition();
            return;
        }
        /** @type {?} */
        var idx = this.cmpRef.instance.activeIndex;
        /** @type {?} */
        var activeIndex = idx;
        /** @type {?} */
        var setActiveItem = (/**
         * @param {?} index
         * @return {?}
         */
        function (index) {
            activeIndex = index;
            _this.cmpRef.instance.setActiveItem(index);
        });
        if ($event.code === 'ArrowUp') { // up
            if (idx > -1) {
                /** @type {?} */
                var prevIdx = idx - 1;
                if (prevIdx < 0) {
                    prevIdx = rows.length - 1;
                }
                setActiveItem(prevIdx);
            }
            else {
                setActiveItem(rows.length - 1);
            }
        }
        if ($event.code === 'ArrowDown') { // down
            // down
            /** @type {?} */
            var nextIdx = idx + 1;
            if (nextIdx >= rows.length) {
                nextIdx = 0;
            }
            setActiveItem(nextIdx);
        }
        if ($event.key === 'Enter') {
            if (rows && rows.length && this.panelElement) {
                /** @type {?} */
                var data = rows[idx];
                this.selectItem(data);
            }
            else {
                this.inputRef.inputClick.emit($event);
            }
        }
    };
    LookupQuickSelectDirective.decorators = [
        { type: Directive, args: [{ selector: '[quick-select]' },] }
    ];
    /** @nocollapse */
    LookupQuickSelectDirective.ctorParameters = function () { return [
        { type: Injector },
        { type: NgZone },
        { type: Renderer2 },
        { type: InputGroupComponent },
        { type: LookupGridComponent },
        { type: ComponentFactoryResolver }
    ]; };
    LookupQuickSelectDirective.propDecorators = {
        options: [{ type: Input, args: ['quick-select',] }],
        registerKeyboardEvent: [{ type: HostListener, args: ['keydown', ['$event'],] }]
    };
    return LookupQuickSelectDirective;
}());
export { LookupQuickSelectDirective };
if (false) {
    /** @type {?} */
    LookupQuickSelectDirective.prototype.options;
    /**
     * @type {?}
     * @private
     */
    LookupQuickSelectDirective.prototype.panelElement;
    /**
     * @type {?}
     * @private
     */
    LookupQuickSelectDirective.prototype.cmpRef;
    /**
     * @type {?}
     * @private
     */
    LookupQuickSelectDirective.prototype.data;
    /**
     * @type {?}
     * @private
     */
    LookupQuickSelectDirective.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    LookupQuickSelectDirective.prototype.ngzone;
    /**
     * @type {?}
     * @private
     */
    LookupQuickSelectDirective.prototype.render;
    /**
     * @type {?}
     * @private
     */
    LookupQuickSelectDirective.prototype.inputRef;
    /**
     * @type {?}
     * @private
     */
    LookupQuickSelectDirective.prototype.lookupRef;
    /**
     * @type {?}
     * @private
     */
    LookupQuickSelectDirective.prototype.cfr;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9va3VwLXF1aWNrLXNlbGVjdC5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWxvb2t1cC8iLCJzb3VyY2VzIjpbImxpYi9xdWljay1zZWxlY3QvbG9va3VwLXF1aWNrLXNlbGVjdC5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQWlCLHdCQUF3QixFQUFnQixTQUFTLEVBQWMsWUFBWSxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUErQixTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDNUwsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ2pELE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBRTdELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRTNELE9BQU8sRUFBRSxxQkFBcUIsRUFBcUIsTUFBTSx1QkFBdUIsQ0FBQztBQUVqRixPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUMvRCxPQUFPLEVBQUUsK0JBQStCLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUVqRjtJQVFJLG9DQUFvQixRQUFrQixFQUFVLE1BQWMsRUFBVSxNQUFpQixFQUFVLFFBQTZCLEVBQVUsU0FBOEIsRUFDNUosR0FBNkI7UUFEckIsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUFVLFdBQU0sR0FBTixNQUFNLENBQVE7UUFBVSxXQUFNLEdBQU4sTUFBTSxDQUFXO1FBQVUsYUFBUSxHQUFSLFFBQVEsQ0FBcUI7UUFBVSxjQUFTLEdBQVQsU0FBUyxDQUFxQjtRQUM1SixRQUFHLEdBQUgsR0FBRyxDQUEwQjtRQUhqQyxTQUFJLEdBQUcsRUFBRSxDQUFDO0lBSWxCLENBQUM7Ozs7SUFFRCw2Q0FBUTs7O0lBQVI7SUFFQSxDQUFDOzs7O0lBRUQsb0RBQWU7OztJQUFm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OztnQkFYNkQsUUFBUTtnQkFBUyxNQUFNO2dCQUErQixTQUFTO2dCQUUzSixtQkFBbUI7Z0JBTW5CLG1CQUFtQjtnQkFSSix3QkFBd0I7OzswQkFhM0MsS0FBSyxTQUFDLGNBQWM7d0NBaVlwQixZQUFZLFNBQUMsU0FBUyxFQUFFLENBQUMsUUFBUSxDQUFDOztJQTRFdkMsaUNBQUM7Q0FBQSxBQS9jRCxJQStjQztTQTljWSwwQkFBMEI7OztJQUNuQyw2Q0FBa0Q7Ozs7O0lBQ2xELGtEQUFrQzs7Ozs7SUFDbEMsNENBQThEOzs7OztJQUU5RCwwQ0FBa0I7Ozs7O0lBRU4sOENBQTBCOzs7OztJQUFFLDRDQUFzQjs7Ozs7SUFBRSw0Q0FBeUI7Ozs7O0lBQUUsOENBQXFDOzs7OztJQUFFLCtDQUFzQzs7Ozs7SUFDcEsseUNBQXFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQWZ0ZXJWaWV3SW5pdCwgQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLCBDb21wb25lbnRSZWYsIERpcmVjdGl2ZSwgRWxlbWVudFJlZiwgSG9zdExpc3RlbmVyLCBJbmplY3RvciwgSW5wdXQsIE5nWm9uZSwgT25EZXN0cm95LCBPbkluaXQsIE9wdGlvbmFsLCBSZW5kZXJlcjIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgcmVxQW5pbUZyYW1lIH0gZnJvbSAnQGZhcnJpcy91aS1jb21tb24nO1xyXG5pbXBvcnQgeyBJbnB1dEdyb3VwQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1pbnB1dC1ncm91cCc7XHJcbmltcG9ydCB7IGZyb20sIGZyb21FdmVudCwgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBkZWJvdW5jZVRpbWUsIGZpbHRlciwgbWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5cclxuaW1wb3J0IHsgTG9va3VwR3JpZERpc3BsYXlUeXBlLCBRdWlja1NlbGVjdE9wdGlvbiB9IGZyb20gJy4uL2xvb2t1cC1kaXNwbGF5dHlwZSc7XHJcbmltcG9ydCB7IERpc3BsYXlJbmZvLCBMT0FEX0RBVEFfVFlQRSwgTG9va3VwR3JpZFJlc3VsdCwgUGlja2luZ1Jlc3VsdCB9IGZyb20gJy4uL2xvb2t1cC1ncmlkLW9wdGlvbnMnO1xyXG5pbXBvcnQgeyBMb29rdXBHcmlkQ29tcG9uZW50IH0gZnJvbSAnLi4vbG9va3VwLWdyaWQuY29tcG9uZW50JztcclxuaW1wb3J0IHsgTG9va3VwUXVpY2tTZWxlY3RQYW5lbENvbXBvbmVudCB9IGZyb20gJy4vcXVpY2stc2VsZWN0LXBhbmVsLmNvbXBvbmVudCc7XHJcblxyXG5ARGlyZWN0aXZlKHsgc2VsZWN0b3I6ICdbcXVpY2stc2VsZWN0XSd9KVxyXG5leHBvcnQgY2xhc3MgTG9va3VwUXVpY2tTZWxlY3REaXJlY3RpdmUgaW1wbGVtZW50cyBPbkluaXQsIEFmdGVyVmlld0luaXQsIE9uRGVzdHJveSB7XHJcbiAgICBASW5wdXQoJ3F1aWNrLXNlbGVjdCcpIG9wdGlvbnM6IFF1aWNrU2VsZWN0T3B0aW9uO1xyXG4gICAgcHJpdmF0ZSBwYW5lbEVsZW1lbnQ6IEhUTUxFbGVtZW50O1xyXG4gICAgcHJpdmF0ZSBjbXBSZWY6IENvbXBvbmVudFJlZjxMb29rdXBRdWlja1NlbGVjdFBhbmVsQ29tcG9uZW50PjtcclxuXHJcbiAgICBwcml2YXRlIGRhdGEgPSBbXTtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGluamVjdG9yOiBJbmplY3RvciwgcHJpdmF0ZSBuZ3pvbmU6IE5nWm9uZSwgcHJpdmF0ZSByZW5kZXI6IFJlbmRlcmVyMiwgcHJpdmF0ZSBpbnB1dFJlZjogSW5wdXRHcm91cENvbXBvbmVudCwgcHJpdmF0ZSBsb29rdXBSZWY6IExvb2t1cEdyaWRDb21wb25lbnQsXHJcbiAgICAgICAgcHJpdmF0ZSBjZnI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcikge1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgICAgIFxyXG4gICAgfVxyXG5cclxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcclxuICAgICAgICBpZiAodGhpcy5vcHRpb25zICYmIHRoaXMub3B0aW9ucy5lbmFibGUpIHtcclxuICAgICAgICAgICAgdGhpcy5pbnB1dFJlZi5pbnB1dENsaWNrLnN1YnNjcmliZSgoZTogTW91c2VFdmVudCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5wYW5lbEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyDmiafooYzluK7liqnliY1cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvb2t1cFJlZi5kaWN0UGlja2luZyh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGluc3RhbmNlOiB0aGlzLFxyXG4gICAgICAgICAgICAgICAgICAgIH0pLnN1YnNjcmliZSgocHI6IFBpY2tpbmdSZXN1bHQpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMubG9va3VwUmVmLmRpc3BsYXlUeXBlID09PSBMb29rdXBHcmlkRGlzcGxheVR5cGUuVHJlZUxpc3QgfHwgKCF0aGlzLmxvb2t1cFJlZi5zaW5nbGVTZWxlY3QgJiYgdGhpcy5sb29rdXBSZWYudmlld1R5cGUgPT09ICd0ZXh0JykpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB7IHNob3csIGN1c3RvbURhdGEsIG1lc3NhZ2UgfSA9IHRoaXMubG9va3VwUmVmLmRpYWxvZ01nci5jaGVja0RpY3RQaWNraW5nUmVzdWx0KHByKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb29rdXBSZWYuY3VzdG9tRGF0YSA9IGN1c3RvbURhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzaG93KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZURhdGFQYW5lbCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvb2t1cFJlZi5ub3RpZnlTZXJ2aWNlLndhcm5pbmcobWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuaW5wdXRSZWYudmFsdWVDaGFuZ2UucGlwZShcclxuICAgICAgICAgICAgICAgIGRlYm91bmNlVGltZSgyMDApXHJcbiAgICAgICAgICAgICkuc3Vic2NyaWJlKCh2YWw6IHN0cmluZykgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5sb29rdXBSZWYuZGljdFBpY2tpbmcoe2luc3RhbmNlOiB0aGlzfSkuc3Vic2NyaWJlKChwcjogUGlja2luZ1Jlc3VsdCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmxvb2t1cFJlZi5kaXNwbGF5VHlwZSA9PT0gTG9va3VwR3JpZERpc3BsYXlUeXBlLlRyZWVMaXN0IHx8ICghdGhpcy5sb29rdXBSZWYuc2luZ2xlU2VsZWN0ICYmIHRoaXMubG9va3VwUmVmLnZpZXdUeXBlID09PSAndGV4dCcpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgeyBzaG93LCBjdXN0b21EYXRhLCBtZXNzYWdlIH0gPSB0aGlzLmxvb2t1cFJlZi5kaWFsb2dNZ3IuY2hlY2tEaWN0UGlja2luZ1Jlc3VsdChwcik7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb29rdXBSZWYuY3VzdG9tRGF0YSA9IGN1c3RvbURhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLnBhbmVsRWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZURhdGFQYW5lbCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGFuZWxFbGVtZW50LnN0eWxlLm92ZXJmbG93ID0gJ2hpZGRlbic7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0UGFuZWxQb3NpdGlvbihmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9hZERhdGEoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuaW5wdXRSZWYua2V5ZG93bkhhbmRsZS5waXBlKFxyXG4gICAgICAgICAgICAgICAgZmlsdGVyKChldmVudDogS2V5Ym9hcmRFdmVudCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBldmVudC5rZXkgPT09ICdFc2NhcGUnIHx8IGV2ZW50LmtleSA9PT0gJ1RhYicgfHwgIGV2ZW50LmtleSA9PT0gJ0YyJztcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICkuc3Vic2NyaWJlKChlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmhpZGUoZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmxvb2t1cFJlZi5vdmVyTGF5U2VydmljZS5kZXN0b3J5KHRoaXMubG9va3VwUmVmLmVsLm5hdGl2ZUVsZW1lbnQpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgcmVtb3ZlUGFuZWxFbGVtZW50KCkge1xyXG4gICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQodGhpcy5wYW5lbEVsZW1lbnQpO1xyXG4gICAgICAgIHRoaXMucGFuZWxFbGVtZW50ID0gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNsZWFyU2VhcmNoVmFsdWUoKSB7XHJcbiAgICAgICAgdGhpcy5sb29rdXBSZWYuX3NlYXJjaFN0YXRlID0geyBcclxuICAgICAgICAgICAgZmllbGQ6ICcqJywgLy9cIipcIixcclxuICAgICAgICAgICAgdmFsdWU6ICcnXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGhpZGUoZT86IGFueSwgaXNNb3JlQ2xpY2sgPSBmYWxzZSkge1xyXG4gICAgICAgIHJlcUFuaW1GcmFtZSgoKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnBhbmVsRWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGUgJiYgKCBlLnR5cGUgPT09ICdtb3VzZXdoZWVsJyB8fCBlLnR5cGUgPT09ICd3aGVlbCcpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVQYW5lbEVsZW1lbnQoKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYW5lbEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnZi1hcmVhLXNob3cnKTtcclxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVQYW5lbEVsZW1lbnQoKTtcclxuICAgICAgICAgICAgICAgICAgICB9LDEyMCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIHRoaXMubG9va3VwUmVmLm92ZXJMYXlTZXJ2aWNlLmRlc3RvcnkodGhpcy5sb29rdXBSZWYuZWwubmF0aXZlRWxlbWVudCk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGlzTW9yZUNsaWNrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOyAgICAgICBcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5sb29rdXBSZWYudGFnSW5wdXQpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLmxvb2t1cFJlZi50YWdJbnB1dC52YWx1ZSA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5wdXRSZWYudmFsdWUgPSAnJztcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsZWFyU2VhcmNoVmFsdWUoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoZSAmJiAoZS5rZXkgPT09ICdGMicgfHwgdGhpcy5sb29rdXBSZWYuZWwubmF0aXZlRWxlbWVudC5jb250YWlucyhlLnRhcmdldCkpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZGF0YSAmJiB0aGlzLmRhdGEubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsZWFyU2VhcmNoVmFsdWUoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmxvb2t1cFJlZi5ub3NlYXJjaCAmJiB0aGlzLmxvb2t1cFJlZi5kaXNwbGF5VGV4dCAhPT0gdGhpcy5sb29rdXBSZWYub3JpZ2luYWxUZXh0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb29rdXBSZWYub25DaGFuZ2VzKHRoaXMubG9va3VwUmVmLm9yaWdpbmFsVGV4dClcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2V0UGFuZWxQb3NpdGlvbih1cGRhdGVUb3BQb3NpdGlvbiA9IHRydWUpIHtcclxuICAgICAgICBpZiAodGhpcy5wYW5lbEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgY29uc3QgeyB3aWR0aCwgbGVmdCwgdG9wLCBoZWlnaHQgfSA9IHRoaXMuZ2V0UGFuZWxTaXplKCk7XHJcbiAgICAgICAgICAgIHRoaXMucGFuZWxFbGVtZW50LnN0eWxlLndpZHRoID0gYCR7d2lkdGh9cHhgO1xyXG4gICAgICAgICAgICB0aGlzLnBhbmVsRWxlbWVudC5zdHlsZS5tYXhIZWlnaHQgPSBgJHtoZWlnaHR9cHhgO1xyXG4gICAgICAgICAgICBpZiAodXBkYXRlVG9wUG9zaXRpb24pIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucGFuZWxFbGVtZW50LnN0eWxlLnRvcCA9IGAke3RvcH1weGA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5wYW5lbEVsZW1lbnQuc3R5bGUubGVmdCA9IGAke2xlZnR9cHhgO1xyXG4gICAgICAgICAgICB0aGlzLnBhbmVsRWxlbWVudC5zdHlsZS56SW5kZXggPSAnMTAwMDEnO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNyZWF0ZURhdGFQYW5lbCgpIHtcclxuICAgICAgICB0aGlzLnBhbmVsRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgIHRoaXMucGFuZWxFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ292ZXJsYXktcGFuZScsICdmLWxvb2t1cF9xdWljay1wYW5lbCcsICdmLWFyZWEtaGlkZScpO1xyXG5cclxuICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMucGFuZWxFbGVtZW50KTtcclxuICAgICAgICB0aGlzLnNldFBhbmVsUG9zaXRpb24oKTtcclxuXHJcbiAgICAgICAgdGhpcy5wYW5lbEVsZW1lbnQuc3R5bGUub3ZlcmZsb3cgPSAnaGlkZGVuJztcclxuICAgICAgICAvLyB0aGlzLnBhbmVsRWxlbWVudC5zdHlsZS5oZWlnaHQgPSAnYXV0byc7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8g5Yib5bu65pWw5o2u5bGV56S657uE5Lu2XHJcbiAgICAgICAgY29uc3QgY21wRmFjdCA9IHRoaXMuY2ZyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KExvb2t1cFF1aWNrU2VsZWN0UGFuZWxDb21wb25lbnQpO1xyXG4gICAgICAgIHRoaXMuY21wUmVmID0gY21wRmFjdC5jcmVhdGUodGhpcy5pbmplY3Rvcik7XHJcbiAgICAgICAgXHJcbiAgICAgICAgdGhpcy5jbXBSZWYuaW5zdGFuY2Uuc2hvd01vcmUgPSB0aGlzLm9wdGlvbnMuc2hvd01vcmU7XHJcbiAgICAgICAgdGhpcy5jbXBSZWYuaW5zdGFuY2UudGV4dEZpZWxkID0gdGhpcy5sb29rdXBSZWYudGV4dEZpZWxkO1xyXG4gICAgICAgIHRoaXMuY21wUmVmLmluc3RhbmNlLmZvcm1hdHRlciA9IHRoaXMub3B0aW9ucy5mb3JtYXR0ZXI7XHJcbiAgICAgICAgdGhpcy5jbXBSZWYuaW5zdGFuY2UubWF4SXRlbXMgPSB0aGlzLm9wdGlvbnMuc2hvd0l0ZW1zQ291bnQ7XHJcblxyXG4gICAgICAgIC8vIGNtcFJlZi5sb2NhdGlvbi5uYXRpdmVFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2ZhcnJpcy1tYWluLWFyZWEnKTtcclxuICAgICAgICB0aGlzLnBhbmVsRWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLmNtcFJlZi5sb2NhdGlvbi5uYXRpdmVFbGVtZW50KTtcclxuXHJcbiAgICAgICAgdGhpcy5sb29rdXBSZWYuc2VsZWN0aW9uTWdyLmluaXREaXNwbGF5VmFsdWUoKTtcclxuICAgICAgICBcclxuICAgICAgICB0aGlzLmNtcFJlZi5jaGFuZ2VEZXRlY3RvclJlZi5kZXRlY3RDaGFuZ2VzKCk7XHJcblxyXG4gICAgICAgIC8vIG1vcmUgY2xpY2tlZCDmiZPlvIDluK7liqnnqpflj6NcclxuICAgICAgICB0aGlzLmNtcFJlZi5pbnN0YW5jZS5tb3JlQ2xjaWsuc3Vic2NyaWJlKChlKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuaGlkZShlLCB0cnVlKTtcclxuICAgICAgICAgICAgdGhpcy5sb29rdXBSZWYuc2hvd0RpYWxvZygpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLmNtcFJlZi5pbnN0YW5jZS5pdGVtQ2xpY2suc3Vic2NyaWJlKChlOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgeyBkYXRhIH0gPSBlO1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdEl0ZW0oZGF0YSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG5cclxuICAgICAgICAvLyDms6jlhozpvKDmoIfmu5rova7vvIzngrnlh7vkuovku7bvvIznlKjkuo7pmpDol49QYW5lbFxyXG4gICAgICAgIHRoaXMubG9va3VwUmVmLm92ZXJMYXlTZXJ2aWNlLnJlZ2lzdGVyTW91c2VFdmVudCh0aGlzLmxvb2t1cFJlZi5lbC5uYXRpdmVFbGVtZW50LCAoZTogTW91c2VFdmVudCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMucGFuZWxFbGVtZW50IHx8IGUudGFyZ2V0WydjbG9zZXN0J10oJy5mLWxvb2t1cF9xdWljay1wYW5lbCcpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmKHRoaXMubG9va3VwUmVmLmlucHV0R3JvdXAgJiYgdGhpcy5sb29rdXBSZWYuaW5wdXRHcm91cC50ZXh0Ym94Lm5hdGl2ZUVsZW1lbnQgPT09IGUudGFyZ2V0KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmKHRoaXMubG9va3VwUmVmLnRhZ0lucHV0ICYmIHRoaXMubG9va3VwUmVmLnRhZ0lucHV0LnRleHRib3gubmF0aXZlRWxlbWVudCA9PT0gZS50YXJnZXQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuY21wUmVmKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNtcFJlZi5kZXN0cm95KCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNtcFJlZiA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMuY2xlYXJTZWFyY2hWYWx1ZSgpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5oaWRlKGUpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLnBhbmVsRWxlbWVudC5jbGFzc0xpc3QuYWRkKCdmLWFyZWEtc2hvdycpO1xyXG5cclxuICAgICAgICB0aGlzLmxvYWREYXRhKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzZWxlY3RJdGVtKGRhdGE6IGFueSkge1xyXG4gICAgICAgIGlmICghZGF0YSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5sb29rdXBSZWYudmlld1R5cGUgPT09ICd0YWcnKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGlzU2VsZWN0ID0gdGhpcy5sb29rdXBSZWYuc2VsZWN0aW9ucy5maW5kKG4gPT4gblt0aGlzLmxvb2t1cFJlZi5pZEZpZWxkXSA9PT0gZGF0YVt0aGlzLmxvb2t1cFJlZi5pZEZpZWxkXSk7XHJcbiAgICAgICAgICAgIGlmICghaXNTZWxlY3QpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdEl0ZW1zOiBhbnkgPSBbLi4udGhpcy5sb29rdXBSZWYuc2VsZWN0aW9ucywgZGF0YV07XHJcbiAgICAgICAgICAgICAgICB0aGlzLmxvb2t1cFJlZi5zZWxlY3RJdGVtKHNlbGVjdEl0ZW1zKTtcclxuICAgICAgICAgICAgICAgIHRoaXMubG9va3VwUmVmLmxvb2t1cFNlbGVjdGlvblNlci5sb2FkU2VsZWN0aW9ucyhzZWxlY3RJdGVtcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmxvb2t1cFJlZi5zZWxlY3RJdGVtKGRhdGEpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmhpZGUoKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgcHJpdmF0ZSBjYWxjdWxhdGlvblBhbmVsSGVpZ2h0KCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLm9wdGlvbnMuc2hvd0l0ZW1zQ291bnQgKiAzMCArICh0aGlzLm9wdGlvbnMuc2hvd01vcmUgPyA1MDogMCkgKyAodGhpcy5vcHRpb25zLmZvb3RlckhlaWdodHx8MCkgKyA1O1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0SW5wdXRTaXplSW5mbygpIHtcclxuICAgICAgICBjb25zdCBlbDogYW55ID0gdGhpcy5sb29rdXBSZWYudmlld1R5cGUgPT09ICd0ZXh0JyA/IHRoaXMuaW5wdXRSZWYuaW5wdXRHcm91cCA6IHRoaXMubG9va3VwUmVmLnRhZ2JveDtcclxuICAgICAgICByZXR1cm4gZWwubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldFBhbmVsU2l6ZSgpIHtcclxuICAgICAgICBsZXQgeyB3aWR0aCwgaGVpZ2h0LCB0b3AsIGxlZnQgfSA9IHRoaXMuZ2V0SW5wdXRTaXplSW5mbygpO1xyXG4gICAgICAgIGNvbnN0IGJvdHRvbSA9IHdpbmRvdy5pbm5lckhlaWdodCAtIGhlaWdodCAtIHRvcDtcclxuICAgICAgICBsZXQgcGFuZWxIZWlnaHQgPSB0aGlzLmNhbGN1bGF0aW9uUGFuZWxIZWlnaHQoKTtcclxuXHJcbiAgICAgICAgY29uc3QgaCA9IHRvcCA+IGJvdHRvbSA/IHRvcCA6IGJvdHRvbTtcclxuICAgICAgICBpZiAoYm90dG9tID4gcGFuZWxIZWlnaHQpIHtcclxuICAgICAgICAgICAgdG9wID0gdG9wICsgaGVpZ2h0O1xyXG4gICAgICAgICAgICAvLyDpnaLmnb/nlLHkuIrlkJHkuIvlsZXlvIBcclxuICAgICAgICAgICAgdGhpcy5wYW5lbEVsZW1lbnQuc3R5bGUudHJhbnNmb3JtT3JpZ2luID0gJzEwMCUgdG9wJztcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAodG9wID4gYm90dG9tKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaCA8IHBhbmVsSGVpZ2h0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGFuZWxIZWlnaHQgPSBoIC0gMTA7XHJcbiAgICAgICAgICAgICAgICAgICAgdG9wID0gMTA7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRvcCA9IHRvcCAtIHBhcnNlSW50KCcnICsgcGFuZWxIZWlnaHQsIDEwKSAtIDU7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8g6Z2i5p2/55Sx5LiL5ZCR5LiK5bGV5byAXHJcbiAgICAgICAgICAgICAgICB0aGlzLnBhbmVsRWxlbWVudC5zdHlsZS50cmFuc2Zvcm1PcmlnaW4gPSAnMTAwJSBib3R0b20nO1xyXG5cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmIChoIDwgcGFuZWxIZWlnaHQpIHtcclxuICAgICAgICAgICAgICAgICAgICBwYW5lbEhlaWdodCA9IGggLSAxMDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRvcCA9IHRvcCArIGhlaWdodDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgbWluV2lkdGggPSB0aGlzLm9wdGlvbnMubWluV2lkdGggfHwgMjAwO1xyXG4gICAgICAgIGxldCBfd2lkdGggPSAgd2lkdGggPCBtaW5XaWR0aD8gbWluV2lkdGg6IHdpZHRoO1xyXG4gICAgICAgIGlmICh3aW5kb3cuaW5uZXJXaWR0aCAtIGxlZnQgPCBfd2lkdGgpIHtcclxuICAgICAgICAgICAgbGVmdCA9IGxlZnQgKyB3aWR0aCAtIF93aWR0aDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB7IHdpZHRoOiBfd2lkdGgsIHRvcCwgaGVpZ2h0OiBwYW5lbEhlaWdodCwgbGVmdCB9O1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0RGF0YSgpOiBPYnNlcnZhYmxlPEFycmF5PGFueT4+IHtcclxuICAgICAgICBsZXQgcDogYW55ID0ge1xyXG4gICAgICAgICAgICBwYWdlSW5mbzoge1xyXG4gICAgICAgICAgICAgICAgcGFnZVNpemU6IHRoaXMub3B0aW9ucy5zaG93SXRlbXNDb3VudCxcclxuICAgICAgICAgICAgICAgIHBhZ2VJbmRleDogMSxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICB9O1xyXG4gICAgICAgIGxldCB0OiBMT0FEX0RBVEFfVFlQRSA9IFwiYWxsXCI7XHJcbiAgICAgICAgaWYgKHRoaXMubG9va3VwUmVmLmlzVGV4dENoYW5nZSkge1xyXG4gICAgICAgICAgICB0aGlzLmxvb2t1cFJlZi5fc2VhcmNoU3RhdGUgPSB7IFxyXG4gICAgICAgICAgICAgICAgZmllbGQ6IHRoaXMubG9va3VwUmVmLnRleHRGaWVsZCwgLy9cIipcIixcclxuICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmxvb2t1cFJlZi5kaXNwbGF5VGV4dFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHBbJ3NlYXJjaCddID0gdGhpcy5sb29rdXBSZWYuX3NlYXJjaFN0YXRlO1xyXG4gICAgICAgICAgICB0ID0gJ3NlYXJjaCc7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5sb29rdXBSZWYuX3NlYXJjaFN0YXRlID0gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmxvb2t1cFJlZi52aWV3VHlwZSA9PT0gJ3RhZycpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMubG9va3VwUmVmLnRhZ0lucHV0LnZhbHVlICE9PSAnJykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5sb29rdXBSZWYuX3NlYXJjaFN0YXRlID0geyBcclxuICAgICAgICAgICAgICAgICAgICBmaWVsZDogdGhpcy5sb29rdXBSZWYudGV4dEZpZWxkLCAvL1wiKlwiLFxyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmxvb2t1cFJlZi50YWdJbnB1dC52YWx1ZVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcFsnc2VhcmNoJ10gPSB0aGlzLmxvb2t1cFJlZi5fc2VhcmNoU3RhdGU7XHJcbiAgICAgICAgICAgICAgICB0ID0gJ3NlYXJjaCc7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmxvb2t1cFJlZi5fc2VhcmNoU3RhdGUgPSBudWxsO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjb25zdCB2YWxzID0gdGhpcy5sb29rdXBSZWYuc2VsZWN0aW9uTWdyLmdldFNlbGVjdGVkSWRzKCk7XHJcbiAgICAgICAgICAgIGlmICh2YWxzICYmIHZhbHMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICBwW1wic2VsZWN0ZWRJbmZvXCJdID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkSWRzOiB2YWxzLFxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLmxvb2t1cFJlZi5odHRwTWdyLmxvb2t1cFJlcXVlc3QocCwgdCwgdHJ1ZSkucGlwZShcclxuICAgICAgICAgICAgbWFwKChyZXN0RGF0YTogTG9va3VwR3JpZFJlc3VsdCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgbGV0IF9pdGVtcyA9IHRoaXMubG9va3VwUmVmLml0ZW1zIHx8IFtdO1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3REYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMubG9va3VwUmVmLnZpZXdUeXBlID09PSAndGFnJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvb2t1cFJlZi5sb29rdXBTZWxlY3Rpb25TZXIubG9hZFNlbGVjdGlvbnMoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN0RGF0YVtcInNlbGVjdGVkRGF0YVwiXSB8fCBbXVxyXG4gICAgICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgX2l0ZW1zID0gcmVzdERhdGEuaXRlbXMgfHwgW107XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmxvb2t1cFJlZi5kaXNwbGF5VGV4dCAmJiB0aGlzLmxvb2t1cFJlZi5pc1RleHRDaGFuZ2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBpdGVtcyA9IF9pdGVtcy5maWx0ZXIobiA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuW3RoaXMubG9va3VwUmVmLnRleHRGaWVsZF0uaW5kZXhPZih0aGlzLmxvb2t1cFJlZi5kaXNwbGF5VGV4dCkgPiAtMTtcclxuICAgICAgICAgICAgICAgICAgICB9KS5zbGljZSgwLCB0aGlzLm9wdGlvbnMuc2hvd0l0ZW1zQ291bnQpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBfaXRlbXMgPSBpdGVtcztcclxuICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAocmVzdERhdGEuZGlzcGxheVR5cGUudG9Mb3dlckNhc2UoKS5pbmRleE9mKCd0cmVlbGlzdCcpID4gLTEgJiYgX2l0ZW1zLmxlbmd0aCAmJiBfaXRlbXNbMF0uZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBfaXRlbXMubWFwKG4gPT4gbi5kYXRhKS5zbGljZSgwLCB0aGlzLm9wdGlvbnMuc2hvd0l0ZW1zQ291bnQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBfaXRlbXMuc2xpY2UoMCwgdGhpcy5vcHRpb25zLnNob3dJdGVtc0NvdW50KTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgbG9hZERhdGEoKSB7XHJcbiAgICAgICAgY29uc3QgbG9hZGluZ1JlZiA9IHRoaXMubG9va3VwUmVmLmxvYWRpbmdTZXJ2aWNlLnNob3coe2NvbnRhaW5lcjogdGhpcy5wYW5lbEVsZW1lbnR9KTtcclxuICAgICAgICB0aGlzLmdldERhdGEoKS5zdWJzY3JpYmUoKGRhdGE6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICBsb2FkaW5nUmVmLmNsb3NlKCk7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmNtcFJlZiAmJiB0aGlzLmNtcFJlZi5pbnN0YW5jZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jbXBSZWYuaW5zdGFuY2UubG9hZERhdGEoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoZGF0YS5sZW5ndGggPCB0aGlzLm9wdGlvbnMuc2hvd0l0ZW1zQ291bnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBsZXQgbmV3SGVpZ2h0ID0gZGF0YS5sZW5ndGggKiAzMCArICh0aGlzLm9wdGlvbnMuc2hvd01vcmUgPyA1MDogMCkgKyAodGhpcy5vcHRpb25zLmZvb3RlckhlaWdodHx8MCkgKyA1O1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGF0YSA9IGRhdGE7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGxldCBuZXdIZWlnaHQgPSB0aGlzLmNtcFJlZi5pbnN0YW5jZS5pdGVtc0NvbnRhaW5lci5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ3VsJykub2Zmc2V0SGVpZ2h0ICsgMTA7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghZGF0YSB8fCAhZGF0YS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3SGVpZ2h0ID0gNTU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNtcFJlZi5pbnN0YW5jZS5pdGVtc0NvbnRhaW5lci5uYXRpdmVFbGVtZW50LnN0eWxlLmhlaWdodCA9IGAke25ld0hlaWdodH1weGA7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucGFuZWxFbGVtZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnBhbmVsRWxlbWVudC5zdHlsZS50cmFuc2Zvcm1PcmlnaW4uaW5kZXhPZignYm90dG9tJykgPiAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wYW5lbEVsZW1lbnQuc3R5bGUudG9wID0gYCR7dGhpcy5nZXRJbnB1dFNpemVJbmZvKCkudG9wIC0gbmV3SGVpZ2h0IC0gNX1weGAgO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGFuZWxFbGVtZW50LnN0eWxlLmhlaWdodCA9ICdhdXRvJztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0UGFuZWxQb3NpdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY21wUmVmLmluc3RhbmNlLml0ZW1zQ29udGFpbmVyLm5hdGl2ZUVsZW1lbnQuc3R5bGUuaGVpZ2h0ID0gJzEwMCUnO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnBhbmVsRWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5yZW1vdmVTdHlsZSh0aGlzLnBhbmVsRWxlbWVudCwgJ2hlaWdodCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoKHRoaXMubG9va3VwUmVmLmlzVGV4dENoYW5nZSB8fCAodGhpcy5sb29rdXBSZWYudGFnSW5wdXQgJiYgdGhpcy5sb29rdXBSZWYudGFnSW5wdXQudmFsdWUgIT09ICcnKSB8fCAgXHJcbiAgICAgICAgICAgICAgICAgICAgKHRoaXMubG9va3VwUmVmLmlucHV0R3JvdXAgJiYgdGhpcy5sb29rdXBSZWYuaW5wdXRHcm91cC52YWx1ZSAhPT0gJycgJiYgdGhpcy5sb29rdXBSZWYuaXNUZXh0Q2hhbmdlKSkgJiYgZGF0YSAmJiBkYXRhLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY21wUmVmLmluc3RhbmNlLnNldEFjdGl2ZUl0ZW0oMCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5wYW5lbEVsZW1lbnQuc3R5bGUub3ZlcmZsb3cgPSAnYXV0byc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgQEhvc3RMaXN0ZW5lcigna2V5ZG93bicsIFsnJGV2ZW50J10pXHJcbiAgICByZWdpc3RlcktleWJvYXJkRXZlbnQoJGV2ZW50OiBLZXlib2FyZEV2ZW50KSB7XHJcblxyXG4gICAgICAgIGlmICghdGhpcy5sb29rdXBSZWYuc2luZ2xlU2VsZWN0ICYmIHRoaXMubG9va3VwUmVmLnZpZXdUeXBlICE9PSAndGFnJykgIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IHJvd3M9IFtdO1xyXG4gICAgICAgIGlmICh0aGlzLmNtcFJlZikge1xyXG4gICAgICAgICAgICByb3dzID0gdGhpcy5jbXBSZWYuaW5zdGFuY2UuZGF0YTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICghcm93cyB8fCAhcm93cy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCRldmVudC5jb2RlID09PSAnQXJyb3dVcCcgfHwgJGV2ZW50LmNvZGUgPT09ICdBcnJvd0Rvd24nKSB7XHJcbiAgICAgICAgICAgICRldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgaWYgKCRldmVudC5jb2RlID09PSAnQmFja3NwYWNlJyAmJiB0aGlzLmxvb2t1cFJlZi52aWV3VHlwZSA9PT0gJ3RhZycgJiZcclxuICAgICAgICAgICAgdGhpcy5sb29rdXBSZWYuc2VsZWN0aW9ucyAmJiB0aGlzLmxvb2t1cFJlZi5zZWxlY3Rpb25zLmxlbmd0aCAmJlxyXG4gICAgICAgICAgICB0aGlzLmxvb2t1cFJlZi50YWdJbnB1dCAmJiAhdGhpcy5sb29rdXBSZWYudGFnSW5wdXQudmFsdWUgJiYgdGhpcy5sb29rdXBSZWYucXVpY2tTZWxlY3QuZW5hYmxlQmFja3NwYWNlKSB7XHJcbiAgICAgICAgICAgICRldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IG5ld2RhdGEgPSB0aGlzLmxvb2t1cFJlZi5zZWxlY3Rpb25zLnNsaWNlKDAsIHRoaXMubG9va3VwUmVmLnNlbGVjdGlvbnMubGVuZ3RoIC0gMSk7XHJcbiAgICAgICAgICAgIGlmICghbmV3ZGF0YSB8fCAhbmV3ZGF0YS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubG9va3VwUmVmLmNsZWFyVmFsdWUodHJ1ZSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmxvb2t1cFJlZi5zZWxlY3RJdGVtKG5ld2RhdGEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMubG9va3VwUmVmLmxvb2t1cFNlbGVjdGlvblNlci5sb2FkU2VsZWN0aW9ucyhuZXdkYXRhKTtcclxuICAgICAgICAgICAgdGhpcy5zZXRQYW5lbFBvc2l0aW9uKCk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBjb25zdCBpZHggPSB0aGlzLmNtcFJlZi5pbnN0YW5jZS5hY3RpdmVJbmRleDtcclxuICAgICAgICBsZXQgYWN0aXZlSW5kZXggPSBpZHg7XHJcblxyXG4gICAgICAgIGNvbnN0IHNldEFjdGl2ZUl0ZW0gPSAoaW5kZXgpID0+IHtcclxuICAgICAgICAgICAgYWN0aXZlSW5kZXggPSBpbmRleDtcclxuICAgICAgICAgICAgdGhpcy5jbXBSZWYuaW5zdGFuY2Uuc2V0QWN0aXZlSXRlbShpbmRleCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgaWYgKCRldmVudC5jb2RlID09PSAnQXJyb3dVcCcpIHsgIC8vIHVwXHJcbiAgICAgICAgICAgIGlmIChpZHggPiAtMSkge1xyXG4gICAgICAgICAgICAgICAgbGV0IHByZXZJZHggPSBpZHggLSAxO1xyXG4gICAgICAgICAgICAgICAgaWYgKHByZXZJZHggPCAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcHJldklkeCA9IHJvd3MubGVuZ3RoIC0gMTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHNldEFjdGl2ZUl0ZW0ocHJldklkeCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBzZXRBY3RpdmVJdGVtKHJvd3MubGVuZ3RoIC0gMSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCRldmVudC5jb2RlID09PSAnQXJyb3dEb3duJykgeyAvLyBkb3duXHJcbiAgICAgICAgICAgIGxldCBuZXh0SWR4ID0gaWR4ICsgMTtcclxuICAgICAgICAgICAgaWYgKG5leHRJZHggPj0gcm93cy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIG5leHRJZHggPSAwO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBzZXRBY3RpdmVJdGVtKG5leHRJZHgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYoJGV2ZW50LmtleSA9PT0gJ0VudGVyJykge1xyXG4gICAgICAgICAgICBpZiAocm93cyAmJiByb3dzLmxlbmd0aCAmJiB0aGlzLnBhbmVsRWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IHJvd3NbaWR4XTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0SXRlbShkYXRhKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5wdXRSZWYuaW5wdXRDbGljay5lbWl0KCRldmVudCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0iXX0=