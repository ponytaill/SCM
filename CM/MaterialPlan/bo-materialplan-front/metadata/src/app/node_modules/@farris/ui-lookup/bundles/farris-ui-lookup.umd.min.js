!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@farris/ui-shortcuts"),require("@farris/ui-common/types"),require("rxjs"),require("@angular/platform-browser"),require("lodash-es"),require("@angular/common"),require("@angular/forms"),require("@farris/ui-layout"),require("@farris/ui-dialog"),require("@farris/ui-messager"),require("@farris/ui-datatable"),require("@farris/ui-treetable"),require("@farris/ui-loading"),require("@angular/animations"),require("@farris/ui-locale"),require("@farris/ui-notify"),require("@farris/ui-context-menu"),require("@angular/core"),require("@farris/ui-common"),require("@farris/ui-input-group"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("@farris/ui-lookup",["exports","@farris/ui-shortcuts","@farris/ui-common/types","rxjs","@angular/platform-browser","lodash-es","@angular/common","@angular/forms","@farris/ui-layout","@farris/ui-dialog","@farris/ui-messager","@farris/ui-datatable","@farris/ui-treetable","@farris/ui-loading","@angular/animations","@farris/ui-locale","@farris/ui-notify","@farris/ui-context-menu","@angular/core","@farris/ui-common","@farris/ui-input-group","rxjs/operators"],t):t((e.farris=e.farris||{},e.farris["ui-lookup"]={}),e.uiShortcuts,e.types,e.rxjs,e.ng.platformBrowser,e.lodashEs,e.ng.common,e.ng.forms,e.uiLayout,e.uiDialog,e.uiMessager,e.uiDatatable,e.uiTreetable,e.uiLoading,e.ng.animations,e.uiLocale,e.uiNotify,e.uiContextMenu,e.ng.core,e.uiCommon,e.uiInputGroup,e.rxjs.operators)}(this,function(e,t,d,u,h,f,i,n,s,a,o,r,l,c,p,g,v,m,y,b,C,S){"use strict";var k=function(e,t){return(k=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};var I=function(){return(I=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var s in t=arguments[i])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)};function T(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var n,s,a=i.call(e),o=[];try{for(;(void 0===t||0<t--)&&!(n=a.next()).done;)o.push(n.value)}catch(r){s={error:r}}finally{try{n&&!n.done&&(i=a["return"])&&i.call(a)}finally{if(s)throw s.error}}return o}function x(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(T(arguments[t]));return e}var D="__favorite__",w={List:"LIST",TreeList:"TREELIST",NavList:"NAVLIST",NavTreeList:"NAVTREELIST"},F='<span class="f-icon f-icon-star f-lookup-favorite" style="line-height: 29px;"></span>',O='<span class="f-icon f-icon-star-outline f-lookup-favorite" style="line-height: 29px;"></span>',R='<span class="f-icon f-icon-apply-format f-lookup-unfavorite" style="line-height: 29px;"></span>',E='<span class="f-icon f-icon-apply-format f-lookup-unfavorite" style="line-height: 29px;"></span>',L="append item to favorite.",M="remove favorite.",P={enable:!1,showMore:!0,showItemsCount:10,footerHeight:0},N={provide:n.NG_VALUE_ACCESSOR,useExisting:y.forwardRef(function(){return z}),multi:!0},z=(Object.defineProperty(_.prototype,"content",{set:function(e){(this.dialog=e)&&this.dialogCreated.next(this.dialog)},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"isShow",{get:function(){return this._isShow},set:function(e){this._isShow=e,this.changeDetector.destroyed||this.changeDetector.detectChanges()},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"invalid",{get:function(){return this.ngControl.valid},enumerable:!0,configurable:!0}),_.prototype.ngOnInit=function(){this.initEvents(),this.ngControl=this.injector.get(n.NgControl,null)},_.prototype.ngOnDestroy=function(){this.lookupUnsubscribe()},_.prototype.ngAfterViewChecked=function(){var e=this;this.dialog&&this.dialog.closed.subscribe(function(){e.isShow=!1,e.dialog=null})},_.prototype.initEvents=function(){this.dictPicking||(this.dictPicking=function(){return u.of({showDialog:!0})}),this.dictPicked||(this.dictPicked=function(){return u.of({closeDialog:!0})}),this.beforeOpen||(this.beforeOpen=function(){return u.of(!0)}),this.beforeClose||(this.beforeClose=function(){return u.of(!0)}),this.dialogHeight||(this.dialogHeight=this.defaultDialogSize.height),this.dialogWidth||(this.dialogWidth=this.defaultDialogSize.width)},_.prototype.showDialog=function(){var t=this;return this.disabled||this.readonly||this.dictPicking().subscribe(function(e){!1!==e.showDialog&&(t.isShow=!0,t.ngZone.runOutsideAngular(function(){setTimeout(function(){return t.dialog.show()})}))}),!1},_.prototype.closeDialog=function(){this.isShow=!1,this.dialog&&this.dialog.close()},_.prototype.lookupUnsubscribe=function(){this.dictPickedSubscription&&this.dictPickedSubscription.unsubscribe(),this.dictPickingSubscription&&this.dictPickingSubscription.unsubscribe(),this.dialogCreatedSubscription&&this.dialogCreatedSubscription.unsubscribe()},_.prototype.onResizing=function(e){this.resizing.emit(e.size)},_.prototype.onResized=function(e){this.resized.emit(e.size)},_.prototype.onMaxDialog=function(e){this.dialogMaxed.emit(e.size)},_.prototype.writeValue=function(e){e?(this.displayText=e,this.displayValue=e,this.originalText=this.displayText):(this.displayText="",this.displayValue="",this.originalText="")},_.prototype.registerOnChange=function(e){this.onModelChange=e},_.prototype.registerOnTouched=function(e){this.onModelTouched=e},_.prototype.setDisabledState=function(e){this.disabled=e},_.decorators=[{type:y.Component,args:[{selector:"farris-lookup",template:'\n        <div\n            class="lookupbox input-group"\n            [ngClass]="{\n                \'f-state-disabled\': disabled,\n                \'f-state-readonly\': readonly,\n                \'f-state-editable\': !editable\n            }"\n        >\n            <input\n                class="form-control"\n                [value]="displayText"\n                [disabled]="disabled"\n                [readonly]="!editable || readonly"\n            />\n            <div class="input-group-append">\n                <span class="f-select input-group-text" (click)="showDialog()">\n                    <i class="f-icon f-icon-lookup"></i>\n                </span>\n            </div>\n        </div>\n        <farris-dialog\n            #dialog\n            *ngIf="isShow"\n            [title]="title"\n            [beforeOpen]="beforeOpen"\n            [beforeClose]="beforeClose"\n            [width]="dialogWidth"\n            [height]="dialogHeight"\n            [showButtons]="showButtons"\n            [showMaxButton]="showMaxButton"\n            [buttons]="buttonsRef || defaultButtonRef"\n            [buttonAlign]="buttonAlign"\n            (maxed)="onMaxDialog($event)"\n            (resized)="onResized($event)"\n            (resizing)="onResizing($event)"\n        >\n            <ng-content></ng-content>\n\n            <ng-template #defaultButtonRef>\n                <div style="width: 100%;">\n                    <button\n                        class="btn btn-secondary btn-lg"\n                        (click)="closeDialog()"\n                    >\n                        Cancel\n                    </button>\n                    <button class="btn btn-primary btn-lg">Ok</button>\n                </div>\n            </ng-template>\n        </farris-dialog>\n    ',providers:[N],styles:["\n            .input-group {\n                flex-wrap: nowrap;\n            }\n            :host-context(.ng-invalid) .form-control {\n                border-color: #ff0303;\n            }\n        "]}]}],_.ctorParameters=function(){return[{type:y.Injector},{type:y.ElementRef},{type:y.ChangeDetectorRef}]},_.propDecorators={hostCls:[{type:y.HostBinding,args:["class"]}],dialogWidth:[{type:y.Input}],dialogHeight:[{type:y.Input}],title:[{type:y.Input}],buttonAlign:[{type:y.Input}],buttonsRef:[{type:y.Input}],showButtons:[{type:y.Input}],showCloseButton:[{type:y.Input}],showMaxButton:[{type:y.Input}],resizable:[{type:y.Input}],draggable:[{type:y.Input}],disabled:[{type:y.Input}],editable:[{type:y.Input}],readonly:[{type:y.Input}],mapFields:[{type:y.Input}],valueField:[{type:y.Input}],textField:[{type:y.Input}],displayText:[{type:y.Input}],context:[{type:y.Input}],beforeOpen:[{type:y.Input}],beforeClose:[{type:y.Input}],dictPicking:[{type:y.Input}],dictPicked:[{type:y.Input}],dialogOpened:[{type:y.Output}],dialogClosed:[{type:y.Output}],dialogMaxed:[{type:y.Output}],resizing:[{type:y.Output}],resized:[{type:y.Output}],content:[{type:y.ViewChild,args:["dialog"]}]},_);function _(e,t,i){this.injector=e,this.el=t,this.changeDetector=i,this.hostCls="f-cmp-inputgroup",this.title="",this.buttonAlign="right",this.showButtons=!0,this.showCloseButton=!0,this.showMaxButton=!0,this.resizable=!0,this.draggable=!0,this.disabled=!1,this.editable=!0,this.readonly=!1,this.displayText="",this.dialogOpened=new y.EventEmitter,this.dialogClosed=new y.EventEmitter,this.dialogMaxed=new y.EventEmitter,this.resizing=new y.EventEmitter,this.resized=new y.EventEmitter,this.defaultDialogSize={width:550,height:570},this.dialogCreated=new u.Subject,this._isShow=!1,this.displayValue="",this.originalText="",this.onModelChange=function(e){},this.onModelTouched=function(e){},this.ngZone=this.injector.get(y.NgZone)}var V=function Pe(){},A={singleSelect:!0,showFilterBar:!0,pagination:!0,pageIndex:1,pageSize:10,pageList:[10,20,30,50,100]},j={title:"此处显示标题",favorites:"收藏夹",okText:"确定",cancelText:"取消",allColumns:"所有列"},H=new y.InjectionToken("Lookup Grid HTTP service"),B=(U.decorators=[{type:y.Injectable}],U.ctorParameters=function(){return[{type:b.CommonUtils}]},U);function U(e){var a=this;this.utils=e,this.lookupFieldMap=function(e,n,s){n&&Object.keys(n).forEach(function(t){var i="";e&&(i=e instanceof Array?e.map(function(e){return a.utils.getValue(t,e)}).join(","):a.utils.getValue(t,e)),n[t].split(",").forEach(function(e){var t=f.trim(e);a.utils.setValue(s,t,i)})})}}var q=(W.prototype.setActiveLookupInstance=function(e){this.rts&&this.rts.setLookupInstance(e)},W.prototype.destroy=function(){this.rts.destroy()},W.prototype.pendingStart=function(){this.rts&&(this.rts.updateFormState({lookup:{pending:!0}}),document.body.style["pointer-events"]="none")},W.prototype.pendingEnd=function(){this.rts&&(this.rts.updateFormState({lookup:{pending:!1}}),document.body.style["pointer-events"]="")},W.prototype.createFilterCondition=function(e,t){return{filterField:e,value:t,lbracket:"",rbracket:"",relation:d.FilterRelation.Or,compare:d.Compare.Like}},W.prototype.mergeCondition=function(e,t,i){var n=this;e=e?f.cloneDeep(e):{pagination:{pageIndex:1,pageSize:20},filterConditions:[],sortConditions:[]};var s=I({},i),a=s.field,o=void 0===a?"*":a,r=s.value,l=void 0===r?"":r;if(l)if("*"===o){if(t&&t.length){var c=t.map(function(e){return n.createFilterCondition(e,l)});if(c.length){c[0].lbracket="(";var p=c[c.length-1];p.rbracket=")",p.relation=d.FilterRelation.Empty}e.filterConditions&&e.filterConditions.length?(e.filterConditions[e.filterConditions.length-1].relation=d.FilterRelation.And,e.filterConditions=e.filterConditions.concat(c)):e.filterConditions=c}}else{var h=this.createFilterCondition(o,l);h.relation=d.FilterRelation.Empty,e.filterConditions&&e.filterConditions.length?(e.filterConditions[e.filterConditions.length-1].relation=d.FilterRelation.And,e.filterConditions.push(h)):e.filterConditions=[h]}return e},W.prototype.canSelectable=function(e){return!e.hasOwnProperty("farris_selectable")||!!e.farris_selectable},W.prototype.makeTreeWithParentID=function(e,a,o,r){var l=this;void 0===o&&(o="parentId"),void 0===r&&(r="id");var c=new Map,p=[],h=[];return e.forEach(function(e){var t={data:e,children:[],selectable:l.canSelectable(e),parent:null,parents:[]},i=e[r];c.set(i,t);var n=l.utils.getValue(o,e);if(n===a)p.push(t);else{var s=c.get(n);s?(t.parent=n,t.parents=x(s.parents,[n]),s.children.push(t)):h.push(t)}}),h.forEach(function(e){var t=l.utils.getValue(o,e.data),i=c.get(t);i&&(e.parent=t,e.parents=x(i.parents,[t]),i.children.push(e))}),p},W.prototype.makeTree=function(e,t){var a=this,o=t.dataField,r=t.layerField,l=t.pathField,c=new Map,p=[],h=[];return e.forEach(function(e){var t={data:e,children:[],selectable:a.canSelectable(e)},i=e[o][l];if(c.set(i,t),1===e[o][r])p.push(t);else{var n=i.substr(0,i.length-4),s=c.get(n);s?s.children.push(t):h.push(t)}}),h.forEach(function(e){var t=e.data[o][l],i=c.get(t.substr(0,t.length-4));i&&i.children.push(e)}),p},W.decorators=[{type:y.Injectable}],W.ctorParameters=function(){return[{type:b.CommonUtils},{type:b.RuntimeStateService},{type:y.NgZone}]},W);function W(e,t,i){this.utils=e,this.rts=t,this.ngZone=i}var G=(Object.defineProperty($.prototype,"personalConfigKey",{get:function(){return this._key},set:function(e){e?(this._key=this.buildKey(e),this.controlID?this._newKey=this.buildKey(this.controlID+"_"+e):this._newKey=this._key):this._newKey=this.buildKey(this.controlID)},enumerable:!0,configurable:!0}),$.prototype.buildKey=function(e){var t,i="";return i=location.hash?(t=location.hash.split("?"))?t[0]:"":(t=location.pathname.split("/"))?t[t.length-1]:"",this.idService.encrypt(i+e)},$.prototype.initPersonalConf=function(e){Object.assign(this,e)},$.prototype.getPersonalData=function(e){if(e&&(this._key=e),this.personalConfigKey){var t=localStorage.getItem(this.personalConfigKey);return t&&"undefined"!==t&&"null"!==t?(this.personalConf=t?JSON.parse(t):{},this._updatePersonalConfig(this.personalConf),this.controlID&&(this._key!==this._newKey&&localStorage.removeItem(this._key),this.savePersonalConfig(this.personalConf)),this.personalConf):null}return null},$.prototype.getQuickSelected=function(e){var t=this.getPersonalData(),i=t?t.quickSelected:null;if(e){if(i){var n=i[e];if(n&&n.length)return n}return null}return i},$.prototype.getDialogSize=function(){var e=this.getPersonalData();return e?e.size:null},$.prototype.updatePersonalConfig=function(e){var t=Object.assign(this.personalConf||{},e);this.savePersonalConfig(t)},$.prototype.savePersonalConfig=function(e){return!!this._newKey&&(localStorage.setItem(this._newKey,JSON.stringify(e)),this.personalConf=e,!0)},$.prototype.getActiveTabIndex=function(e){var t=this.getPersonalData();return e||(t&&t.tabIndex?t.tabIndex:"datalist")},$.prototype.updateQueckSelected=function(e,t){var i,n,s=this,a=this.getQuickSelected(t);if(a&&a.length){var o=[];a.forEach(function(t,i){s.singleSelect?t&&e&&t[s.idField]===e[s.idField]&&o.push(i):e&&e.forEach(function(e){t&&t[s.idField]===e[s.idField]&&o.push(i)})}),o.forEach(function(e){a[e]=null}),this.personalConf.quickSelected[t]=this.personalConf.quickSelected[t].filter(function(e){return null!==e}),this.singleSelect?this.personalConf.quickSelected[t].unshift(e):e&&e.forEach(function(e){s.personalConf.quickSelected[t].unshift(e)}),this.personalConf.quickSelected[t].length=5<this.personalConf.quickSelected[t].length?5:this.personalConf.quickSelected[t].length}else{var r=this.personalConf.quickSelected||{},l=void 0;l=this.singleSelect?Object.assign(r,((i={})[t]=[e],i)):(e.length=5<e.length?5:e.length,Object.assign(r,((n={})[t]=e,n))),this.personalConf.quickSelected=l}this.savePersonalConfig(this.personalConf)},$.prototype._updatePersonalConfig=function(e){if(e){var t=!1;e.favorite&&Array.isArray(e.favorite)&&(e.favorite={"zh-CHS":x(e.favorite)},delete e.favorite,t=!0),e.selected&&(Array.isArray(e.selected)&&(e.quickSelected={"zh-CHS":x(e.selected)}),delete e.selected,t=!0),t&&this.savePersonalConfig(e)}},$.decorators=[{type:y.Injectable}],$.ctorParameters=function(){return[{type:b.IdService}]},$);function $(e){this.idService=e,this.selectItemObser$=new u.Subject,this.displayType="LIST",this.singleSelect=!0,this._key="",this._newKey="",this.controlID=""}var K=function Ne(e){this.instance=e},J=(Q.prototype.getTreeInfo=function(e){if(e.data[this.treeInfo.dataField])return e.data[this.treeInfo.dataField];var t=e.data;if(t&&this.treeInfo.dataField){var i=this.treeInfo.dataField.toLowerCase(),n=Object.keys(e.data).find(function(e){return e.toLowerCase()===i});if(n)return t[n];this.instance.writeConsole("未找到树形信息数据字段【"+this.treeInfo.dataField+"】","error")}else this.instance.writeConsole("未找到树形信息数据字段【"+this.treeInfo.dataField+"】","error")},Q.prototype.getTreeNodeLayer=function(e){return this.getTreeInfo(e)[this.treeInfo.layerField]},Q.prototype.updateTreeNodeExpanded=function(e,t){var i=this;void 0===t&&(t=null),this.treeInfo=t||this.instance.treeInfo;var n=this.instance.expandLevel;-1!==n&&(this.flatAllNodes.length||(this.flatAllNodes=this.treeData2Flat(null,e,0,[])),e.forEach(function(e){e.expanded=i.shoudExpand(n,i.getTreeNodeLayer(e)),i.isSelectNodeParent(e)&&(e.expanded=!0),e.children&&e.children.length?i.updateTreeNodeExpanded(e.children,t):e.leaf=!0}))},Q.prototype.treeData2Flat=function(o,e,r,l){var c=this,p=this.instance.idField,h=[];return e&&e.length&&e.forEach(function(e,t){var i=[];if(o){var n=o.data[p],s=l||[];(i=i.concat(s.map(function(e){return e}))).push(n)}var a={id:e.data[p],node:e,level:r,parents:i};h.push(a),h=h.concat(c.treeData2Flat(e,e.children,r+1,i))}),h},Q.prototype.shoudExpand=function(e,t){return-1!==e&&(0===e||t<=e)},Q.prototype.isSelectNodeParent=function(e){var t=this;if(this.instance.navSelectedIds){var i=this.flatAllNodes.find(function(e){return e.id===t.instance.navSelectedIds}).parents;return!(!i||!i.length)&&i.includes(e.id)}return!1},Q.prototype.getLeafNode=function(e){return!e||e.children&&e.children.length?1===e.children.length?this.getLeafNode(e.children[0]):e.children:e},Q.prototype.flatTreeNodes=function(e,t){var i=this;return void 0===t&&(t=[]),(e=e||[]).reduce(function(e,t){return e.push(t),t.children&&t.children.length&&i.flatTreeNodes(t.children,e),e},t)},Q);function Q(e){this.instance=e,this.flatAllNodes=[]}var Z=(Y.prototype.getFavoriteColumns=function(){return this.instance.gridOptions.columns.map(function(e){var t=Object.assign({},e);return e.field===D&&(t.formatter=function(){return R}),t})},Y.prototype.initPersonalInfo=function(){if(this.instance.personalConfigService){var e=this.instance.el.nativeElement.id||this.instance.controlId;e||this.instance.writeConsole("LookupGrid - 未设置组件id, 收藏功能将不能正常，请设置组件id.");var t=this.getPersonalConfigKey(e);this.instance.personalConfigService.controlID=e,this.instance.personalConfigService.personalConfigKey=t;var i={displayType:this.instance.displayType,singleSelect:this.instance.singleSelect,idField:this.instance.idField,textField:this.instance.textField,mapFields:Object.assign({},this.instance.mapFields||{})};this.instance.personalConfigService.initPersonalConf(i),this.listenPersonalConfigHandler()}},Y.prototype.getPersonalConfigKey=function(e){var t=this;return this.instance.ngControl?this.instance.ngControl.name?this.instance.ngControl.name:this.instance.mapFields&&this.instance.mapFields.length?Object.keys(this.instance.mapFields).map(function(e){return t.instance.mapFields[e]}).join("_"):this.instance.textField:""},Y.prototype.initFavoriteComponentEvent=function(e){var a=this;switch(this.instance.displayType){case w.NavList:case w.NavTreeList:case w.List:var t=e.instance;t.remoteSort=!1,t.selectedRow.subscribe(function(e){a.instance.singleSelect&&a.lookupSelectionSer.clearSelections(),a.lookupSelectionSer.updateSelections(e.data)}),t.unSelectRow.subscribe(function(e){a.lookupSelectionSer.unSelect(e.data[a.instance.idField])}),t.singleSelect||t.checkAll.subscribe(function(e){a.lookupSelectionSer.updateSelections(t.data,e)}),t.cellClick.subscribe(function(t){if(t.col.field===D&&(t.event.stopPropagation(),t.event.target.classList.contains("f-lookup-unfavorite"))){if(a.instance.items){a.instance.items.forEach(function(e){e[a.instance.idField]===t.row[a.instance.idField]&&(e[D]=!1)});var e=a.instance.componentRef.instance;e&&e.loadData({pageSize:a.instance.gridOptions.pageSize,pageIndex:a.instance.gridOptions.pageIndex,total:a.instance.gridOptions.total,data:a.instance.gridOptions.items})}a.instance.favoriteItems=a.instance.favoriteItems.filter(function(e){return e[a.instance.idField]!==t.row[a.instance.idField]}),a.lookupSelectionSer.updateFavoriteData(t.row,M)}}),t.rowDblClick.subscribe(function(e){a.instance.gridOptions.singleSelect&&a.instance.selectItem(e)});break;case w.TreeList:if(e){var i=e.instance;i.remoteSort=!1,i.nodeSelected.subscribe(function(e){a.instance.singleSelect&&a.lookupSelectionSer.clearSelections(),a.lookupSelectionSer.updateSelections(e.node.data)}),i.nodeUnChecked.subscribe(function(e){e.nodes&&e.nodes.length?a.instance.multiSelMgr.remove(e.nodes.map(function(e){return e.id})):e&&e.node&&e.node.data&&e.node.data.id&&a.lookupSelectionSer.unSelect(e.node.data.id)}),i.nodeChecked.subscribe(function(e){a.instance.singleSelect||(e.nodes&&e.nodes.length?a.instance.multiSelMgr.updateSelections(e.nodes.map(function(e){return e.data})):Array.isArray(e.node)?a.instance.multiSelMgr.updateSelections(e.node.map(function(e){return e.data})):a.instance.multiSelMgr.updateSelections([e.node.data]))}),i.cellClick.subscribe(function(i){if(i.col.field===D&&(i.event.stopPropagation(),i.event.target.classList.contains("f-lookup-unfavorite"))){var n=a.instance;!function s(e){if(e){var t=!1;e.forEach(function(e){t||(e.data[n.idField]===i.node[n.idField]?(e.data[D]=!1,t=!0):e.children&&0<e.children.length&&s(e.children))})}}(a.instance.items),a.instance.componentRef.instance.loadData(a.instance.items),a.lookupSelectionSer.updateFavoriteData(i.node.data,M)}}),i.dblClick.subscribe(function(e){a.instance.gridOptions.singleSelect&&e.selectable&&a.instance.okButton&&a.instance.okButton.nativeElement.click()}),i.checkAll.subscribe(function(e){var t=e.instance.checkeds.map(function(e){return e.data});a.instance.multiSelMgr.updateSelections(t),a.instance.checkedChange.emit({data:t,isCheck:!0})}),i.unCheckAll.subscribe(function(){a.instance.multiSelMgr.clear(),a.instance.checkedChange.emit({data:[],isCheck:!1})})}}},Y.prototype.getFavoritData=function(){if(this.instance.personalConf){var e=this.instance.personalConf.favorite;return e&&e[this.instance.localService.localeId]?e[this.instance.localService.localeId]:[]}return[]},Y.prototype.getFavoritIds=function(){return this.getFavoritData()},Y.prototype._loadFavoriteData=function(e){void 0===e&&(e=null);var t=this.instance.favoritesComponentRef.instance;this.loadFavoriteDatatable(t,e),t.cd.markForCheck(),this.instance.closeLoading()},Y.prototype.loadFavoritesData=function(e){switch(void 0===e&&(e=null),this.getFavoritIds(),this.instance.displayType){case w.NavList:case w.NavTreeList:case w.List:var t=this.instance.favoritesComponentRef.instance;if("locale"===this.instance.favoriteDataFrom)e&&this._loadFavoriteData(e.items);else{var i=this.getFavoritData();this.loadFavoriteDatatable(t,e?e.items:i)}break;case w.TreeList:if(this.instance.favoritesComponentRef&&this.instance.favoritesComponentRef.instance instanceof l.TreeTableComponent){var n=this.instance.favoritesComponentRef.instance;this.bindFavTreetable(n),"locale"===this.instance.favoriteDataFrom?e&&this.loadFavoriteForTreeTable(e.items||[],n):e&&this.loadFavoriteForTreeTable(e.items,n)}}},Y.prototype.loadFavoriteDatatable=function(e,t){t!==undefined&&(this.instance.favoriteItems=t),e.columns&&!e.columns.length&&(e.columns=this.instance.favoriteColumns),e.loadData({total:0,pageSize:20,pageIndex:1,data:this.instance.favoriteItems}),this.instance.selectionMgr.selectCurrentValue(),e.cd.detectChanges()},Y.prototype.bindFavTreetable=function(e){var n=this;e.allColumnsTitle=this.instance.allColumnsTitle,e.idField=this.instance.idField;var t=this.instance.gridOptions.columns.map(function(e){var t=I({},e);return e.field===D&&(t.formatter=function(e,t){var i=n.getFavoritIds();return i&&i.length&&0<=i.findIndex(function(e){return e===t[n.instance.idField]})?R:""}),t});this.instance.favoriteColumns=t,e.columns=t,this.instance.gridOptions.treeInfo&&(e.onlySelectLeaf=this.instance.gridOptions.treeInfo.onlySelectLeaf),e.singleSelect||(e.checkOnSelect=!0,e.selectOnCheck=!0,e.showCheckbox=!0,this.instance.enableCascade?this.instance.ttEventMgr.cascadeValueChanged(this.instance.cascadeStatus):(e.cascadeCheck=!1,e.cascadeDown=!1,e.cascadeUp=!1))},Y.prototype.checkNodeIsLeaf=function(e){var t=this;return e&&e.length?e.map(function(e){return e.hasOwnProperty("addtional")&&(e.selectable=!e.addtional),e.children&&e.children.length?t.checkNodeIsLeaf(e.children):e.leaf=!0,e}):e},Y.prototype.initFavoriteTreeData=function(e){var t=this.instance.gridOptions.treeInfo;return t&&!t.treeDataIsInit&&(e="pathcode"===t.layerType.toLowerCase()?this.instance.lookupUtils.makeTree(e,t):this.instance.lookupUtils.makeTreeWithParentID(e,"",t.dataField+"."+t.parentField,this.instance.idField)),this.checkNodeIsLeaf(e)},Y.prototype.loadFavoriteForTreeTable=function(e,t){return e=this.initFavoriteTreeData(e),this.instance.favoriteItems=e,t.loadData(e),t.expandAll(),this.instance.selectionMgr.selectCurrentValue(),e},Y.prototype.updateFavoritesStatus=function(e){var i=this;if(e&&this.instance.useFavorite){var n=this.getFavoritIds();if(n&&n.length)if(this.instance.displayType!==w.TreeList)e.map(function(t){n&&n.length&&n.find(function(e){return e===t[i.instance.idField]})&&(t[D]=!0)});else{var s=this.instance;!function a(e){e.forEach(function(t){n&&n.length&&n.find(function(e){return e===t.data[s.idField]})&&(t.data[D]=!0),t.children&&0<t.children.length&&a(t.children)})}(e)}}},Y.prototype._updateFavorites=function(e,t){var i=this,n=this.instance.localService.localeId;this.instance.personalConf.favorite=this.instance.personalConf.favorite||{};var s=e.filter(function(e){return!e._addtional_}).map(function(e){return e[i.instance.idField]}).filter(function(e){return null!==e&&e!==undefined});return this.instance.personalConf.favorite[n]=s},Y.prototype.listenPersonalConfigHandler=function(){var o=this;this.lookupSelectionSer.favoriteItems$.subscribe(function(e){if(o.instance.favoritesComponentRef){var t=e.items,i=e.action,n=o._updateFavorites(t,i);if(o.instance.httpMgr.submitFavoriteData(i),o.instance.displayType===w.List||o.instance.displayType.includes("NAV")){var s=o.instance.favoritesComponentRef.instance;o.loadFavoriteDatatable(s,t)}else if(o.instance.displayType===w.TreeList){var a=o.instance.favoritesComponentRef.instance;o.instance.showLoading(),o.instance.httpMgr.getData({favoriteIds:n},"fav").subscribe(function(e){if(e){var t=e.items;o.loadFavoriteForTreeTable(t,a)}else o.instance.favoriteItems=[],a.loadData([]);o.instance.closeLoading()})}}})},Y);function Y(e){var a=this;this.instance=e,this.favoriteColumnFormatter=function(e,t){var i=e?F:O;if(a.instance.isTree()){var n=t[a.instance.idField];if(n){var s=a.instance.componentRef.instance.findRowNode(n);if(s)return s.node.selectable?i:""}}return i},this.lookupSelectionSer=this.instance.lookupSelectionSer}var X=(ee.prototype.destroy=function(){},ee.prototype.getBindingData=function(){var e=this.ins.bindingData;if(this.ins.ngControl&&this.ins.ngControl.formDirective&&this.ins.ngControl.formDirective.form&&this.ins.ngControl.formDirective.form.bindingData){var t=this.ins.ngControl.formDirective.form.bindingData;(e=t).getObject&&(e=t.getObject().toJSON())}return e},ee.prototype.initDisplayValue=function(){var e=this.getBindingData();if(e&&this.ins.mapFields){var t=this.ins.idField,i=this.ins.mapFields[t];if(i){-1<i.indexOf(",")&&(i=i.split(",")[0]);var n=this.ins.utils.getValue(i,e);n&&(this.ins.displayValue=n)}}},ee.prototype._clearSelections=function(){var e=this.getDataCmpInstance().cmpRefInstance;e&&(this.ins.isTree()?(e.clearAll(!1),e.cdRef.destroyed||e.cdRef.detectChanges()):(e.dtBody.selectedRowIndex=-1,e.dtBody.selections=undefined,e.cd.destroyed||e.cd.detectChanges()))},ee.prototype.selectCurrentValue=function(e){var t=this;if(void 0===e&&(e=[]),this.ins.enableToSelect){var i=this.getDataCmpInstance(),n=i.cmpRefInstance,s=i.items;if(n&&s&&s.length){if(this._clearSelections(),!e||!e.length){var a=this.ins.lookupSelectionSer.getSelections();a.length&&(e=a.map(function(e){return e[t.ins.idField]}))}e&&e.length&&(this.ins.isTree()?(this.selected4Treetable(n,e),n.cdRef.destroyed||n.cdRef.detectChanges()):(this.selected4Datatable(n,s,e),n.cd.destroyed||n.cd.detectChanges()))}}},ee.prototype.getDataCmpInstance=function(){var e=null,t=null;return"datalist"===this.ins.activeTab?this.ins.isTree()?t=(e=this.ins.lookupCmpMgr.getComponentInstance("treetable")).serializedValue:(t=this.ins.items,e=this.ins.lookupCmpMgr.getComponentInstance()):"favorite"===this.ins.activeTab&&(e=this.ins.lookupCmpMgr.getComponentInstance("fav"),t=this.ins.favoriteItems),{cmpRefInstance:e,items:t}},ee.prototype.selected4Datatable=function(i,e,n){var s=this;this.ins.singleSelect?e.forEach(function(e,t){e[s.ins.idField]===n[0]&&(i.dtBody.isSelected(e)||(i.dtBody.selectedRowIndex=-1,i.dtBody.selectedRow("",t,e)))}):n.forEach(function(t){e.find(function(e){return e[s.ins.idField]==t})&&i.checkRow(t)})},ee.prototype.selected4Treetable=function(e,t){this.ins.singleSelect?e.selectNode(t[0],!1,!1):(e.checkedNodes(t,!1,!1,!0),e.selectNodes(t))},ee.prototype.getSelectedIds=function(){var t=this,e=[],i=this.ins.multipleChoiceSeparator;if(!this.ins.singleSelect&&this.ins.displayValue&&-1<(""+this.ins.displayValue).indexOf(i)?e=this.ins.displayValue.split(i):null!==this.ins.displayValue&&""!==this.ins.displayValue&&this.ins.displayValue!==undefined&&(e=[this.ins.displayValue]),this.ins.showSelected){var n=this.ins.lookupSelectionSer.getSelections();e=n&&n.length?n.map(function(e){return e[t.ins.idField]}):[]}return e},ee);function ee(e){this.ins=e}var te=(ie.prototype.onSearch=function(e){var t=this;if(void 0===e&&(e={field:"*",value:""}),!e||"*"===e.field||e.value){var i={pageInfo:{pageIndex:1,pageSize:this.ins.gridOptions.pageSize},search:e};this.ins.uri?this.ins.searching||(this.ins.searching=!0,this.ins.httpMgr.getData(i,"list").pipe(S.catchError(function(e){return t.ins.searching=!1,u.of({_ERROR_:e})}),S.tap(function(){t.ins.searching=!1})).subscribe(function(e){if(t.ins.searching=!1,t.ins.closeLoading(),e._ERROR_)throw new Error(e._ERROR_);t._loadData(e)})):this.ins.search.emit(i)}else this.ins.messagerService.warning(this.ins.mustWriteSomething)},ie.prototype._loadData=function(e){var t=this.ins;t.closeLoading(),t.favHelper.updateFavoritesStatus(e.items),t.loadDataTableData(e),this.ins.selectionMgr.selectCurrentValue()},ie.prototype.bindDataTableEvent=function(){var o=this,r=this.ins,i=r.componentRef.instance;i.selectedRow.subscribe(function(e){o.ins.singleSelect&&o.lookupSelectionSer.clearSelections(),o.ins.checkedChange.emit({data:[e.data],isCheck:!0}),o.lookupSelectionSer.updateSelections([e.data]),i.cd.detectChanges()}),i.unSelectRow.subscribe(function(e){o.lookupSelectionSer.unSelect(e.data[r.idField]),o.ins.checkedChange.emit({data:[e.data],isCheck:!1})}),i.checkAll.subscribe(function(e){o.lookupSelectionSer.updateSelections(i.data,e),o.ins.checkedChange.emit({data:i.data,isCheck:e})}),i.pageChanged.subscribe(function(e){r.uri?r.httpMgr.getData(e,"list").subscribe(function(e){o._loadData(e)}):r.pagerChanged.emit(r.httpMgr.buildQueryParams(e,"list"))}),i.pageSizeChanged.subscribe(function(e){r.uri?r.httpMgr.getData(e,"list").subscribe(function(e){o._loadData(e)},function(e){r.closeLoading()}):r.pagerChanged.emit(r.httpMgr.buildQueryParams(e,"list"))}),i.search.subscribe(function(e){r._searchState=e,o.onSearch(e)}),i.rowDblClick.subscribe(function(e){r.gridOptions.singleSelect&&r.selectItem(e)}),i.cellClick.subscribe(function(t){if(t.col.field===D&&(t.event.stopPropagation(),t.event.target.classList.contains("f-lookup-favorite"))){r.items.forEach(function(e){r.utils.getValue(r.idField,e)===r.utils.getValue(r.idField,t.row)&&(e[D]=!e[D])}),i.loadData({pageSize:r.gridOptions.pageSize,pageIndex:r.gridOptions.pageIndex,total:r.gridOptions.total,data:r.gridOptions.items});var e=t.row[D]?L:M;o.ins.favoriteItems=e===L?x(o.ins.favoriteItems,[t.row]):o.ins.favoriteItems.filter(function(e){return r.utils.getValue(r.idField,e)!==r.utils.getValue(r.idField,t.row)}),o.lookupSelectionSer.updateFavoriteData(t.row,e)}}),i.columnSorted.subscribe(function(e){if(o.ins.remoteSort){var t=I({},e),i=t.sortName,n=t.sortOrder,s=o.ins.columns.find(function(e){return e.field===i}),a={sortName:s?s.fieldPath?s.fieldPath:s.field:i,sortOrder:n,search:r._searchState,pageInfo:{pageSize:r.pageSize,pageIndex:1}};r.httpMgr.getData(a,"search").subscribe(function(e){r.loadDataTableData(e),r.closeLoading()})}}),i.clearSearchValue.subscribe(function(){r._searchState=null,o.onSearch()})},ie);function ie(e){this.ins=e,this.lookupSelectionSer=this.ins.lookupSelectionSer}function ne(e){void 0===e&&(e=null),this.searchOnServer?this.isShow=!0:!1===e?this.cancelSelect():(this.setModelValue(this.displayText),this.runDictPickedEvent(null))}function se(){var s=this,a=this,e=function(e){s.isShow||!s.isTextChange||!s.displayText||s.nosearch&&!e.originalEvent||s.lookupUtils.rts.getFormState("lookup.pending")||(s.lookupUtils.pendingStart(),s.dictPickingSubscription=s.dictPicking({instance:s}).pipe(S.switchMap(function(e){var t=!0;return e!==undefined&&null!==e||(t=!0),"boolean"==typeof e&&(t=e),"object"==typeof e&&(t=e.showDialog===undefined||e.showDialog,e.data&&(s.customData=e.data)),t?s.httpMgr.getData({search:{field:"*",value:s.displayText,type:"equal"}},"search"):u.of({SHOWDIALOG:t,MESSAGE:e.message||""})})).subscribe(function(e){if(s.closeLoading(),s.lookupUtils.pendingEnd(),e.hasOwnProperty("SHOWDIALOG"))e.SHOWDIALOG&&e.MESSAGE&&s.notifyService.warning(e.MESSAGE);else if(!e.items||1!==e.items.length||e.items[0].children&&e.items[0].children.length)ne.bind(a,e)();else{var t=e.items[0];if(s.isTree()){var i=s.treeNodeHelper.getLeafNode(t),n=!1;if(s.treeInfo||s.setTreeInfo(e),"boolean"==typeof s.treeInfo.onlySelectLeaf?n=s.treeInfo.onlySelectLeaf:"string"==typeof s.treeInfo.onlySelectLeaf&&("yes"===s.treeInfo.onlySelectLeaf?n=!0:"no"===s.treeInfo.onlySelectLeaf?n=!1:"default"===s.treeInfo.onlySelectLeaf&&(n=e.treeInfo.onlySelectLeaf)),n&&!i.leaf)return void ne.bind(a,e)();if(Array.isArray(i))return void ne.bind(a,e)();t=i.data}s.singleSelect||(t=[t]),s.selectItem(t),s.dialogClosed.emit()}},function(e){s.closeLoading(),s.lookupUtils.pendingEnd(),s.messagerService.error(e?e.Message:e)}))},t=null;return this.inputGroup&&this.inputGroup.textbox&&!this.nosearch&&(this.lookupUtils.setActiveLookupInstance(this),t=this.render2.listen(this.inputGroup.textbox.nativeElement,"blur",e)),this.inputGroup&&(this.inputGroup.enterHandle.subscribe(e),this.inputGroup.keydownHandle.subscribe(function(e){("ArrowRight"===e.code?s.editable&&(e.target.value&&e.target.selectionStart!==e.target.value.length):e.code!==s.shortcutKey.open)||(e.stopPropagation(),e.preventDefault(),s.showDialog())})),t}var ae=(oe.prototype.searchTreeData=function(a){var o=this,r=this.ins.componentRef.instance;if(!this.ins.searching)return this.ins.searching=!0,this.ins.showLoading(),this.ins.httpMgr.getData({search:a,sortName:r.sortName,sortOrder:r.sortOrder},"search").pipe(S.tap(function(){o.ins.searching=!1}),S.catchError(function(e){return o.ins.searching=!1,u.of(e)})).subscribe(function(e){if(o.ins.closeLoading(),e){r.clearAll();var t=o.ins.gridOptions.treeInfo;t.treeDataIsInit||("pathcode"===t.layerType.toLowerCase()?o.ins.items=o.ins.lookupUtils.makeTree(o.ins.items,t):o.ins.items=o.ins.lookupUtils.makeTreeWithParentID(o.ins.items,"",t.dataField+"."+t.parentField,o.ins.idField));var i=function(e){return e&&e.length?e.map(function(e){return e.hasOwnProperty("addtional")&&(e.selectable=!e.addtional),e.children&&e.children.length&&i(e.children),e}):e},n=function(e){return e&&e.length?e.map(function(e){return e.children&&e.children.length&&(e.expanded=!0,n(e.children)),e}):e},s=i(e.items);s&&s.length&&s[0].children&&s[0].children.length&&(s[0].expanded=!0,s[0].children=n(s[0].children)),o.ins.items=s,o.ins.useFavorite&&o.ins.favHelper.updateFavoritesStatus(o.ins.items),r.loadData(o.ins.items),r.resize(),o.IS_SEARCH_RESULT=!0,o.ins.selectionMgr.selectCurrentValue()}o.ins.search.emit(a)})},oe.prototype.getChildren=function(e,t,i){var n=this.ins.gridOptions.uri,s=I({parentLayer:t,category:"children"},i);"parentId"===this.ins.treeInfo.layerType?s.parentId=e:s.parentPath=e;var a={searchValue:JSON.stringify(s),customData:this.ins.customData,enableFullTree:this.ins.enableFullTree,loadTreeDataType:this.ins.loadTreeDataType};this.IS_SEARCH_RESULT&&(a.enableFullTree=!1,a.loadTreeDataType="layerload","parentId"===this.ins.treeInfo.layerType&&(s.searchValue="",s.searchField="*"),a.searchValue=JSON.stringify(s)),this.ins.helpId&&(a.helpId=this.ins.helpId);var o=this.ins.componentRef.instance;return o&&o.sortName&&Object.assign(a,{sortName:o.sortName,sortOrder:o.sortOrder}),this.ins.http.getData(n,a)},oe.prototype.bindTreetableEvent=function(){var d=this,u=this.ins.componentRef.instance,t=function(e){d.ins.remoteSearch?(d.ins._searchState=e,d.searchTreeData(e)):d.ins.search.emit(e)},r=function(){return"default"===d.ins.loadTreeDataType?"all"===u.loadDataType:"loadall"===d.ins.loadTreeDataType};u.dblClickExpand=!this.ins.singleSelect,u.allColumnsTitle=this.ins.allColumnsTitle,u.idField=this.ins.idField,u.columns=this.ins.columns,u.searchFields=this.ins.gridOptions.searchFields,this.ins.treeInfo&&(u.loadDataType=this.ins.treeInfo.loadDataType,u.virtualized=!0,this.ins.isTextChange?this.ins.allData=[]:this.ins.allData=f.cloneDeep(this.ins.items)),this.ins.gridOptions.treeInfo&&(u.onlySelectLeaf=this.ins.gridOptions.treeInfo.onlySelectLeaf,u.loadDataType=this.ins.gridOptions.treeInfo.loadDataType),u.singleSelect||(u.checkOnSelect=!0,u.selectOnCheck=!0,u.showCheckbox=!0,u.showCheckAll=this.ins.showCheckAll,this.ins.enableCascade?this.cascadeValueChanged(this.ins.cascadeStatus):(u.cascadeCheck=!1,u.cascadeDown=!1,u.cascadeUp=!1)),u.enableFindText=this.ins.enableFindText,u.nodeSelected.subscribe(function(e){d.ins.singleSelect&&d.lookupSelectionSer.clearSelections(),d.lookupSelectionSer.updateSelections([e.node.data]),d.ins.checkedChange.emit({data:[e.node.data],isCheck:!0})}),u.nodeChecked.subscribe(function(e){if(!d.ins.singleSelect){var t=null;t=e.nodes&&e.nodes.length?e.nodes.map(function(e){return e.data}):Array.isArray(e.node)?e.node.map(function(e){return e.data}):[e.node.data],d.ins.multiSelMgr.updateSelections(t),d.ins.checkedChange.emit({data:t,isCheck:!0})}}),u.nodeUnChecked.subscribe(function(e){if(e&&e.node)if(d.ins.singleSelect){var t=d.ins.favoritesComponentRef&&d.ins.favoritesComponentRef.instance;t&&t.findRowNode(e.node.id)&&t.unSelectNode(e.node.id),d.ins.checkedChange.emit({data:[e.node.data],isCheck:!1})}else{if(d.ins.multiSelMgr.remove(e.node.id),"all"!==u.loadDataType&&"pathcode"===d.ins.treeInfo.layerType&&("enable"===d.ins.cascadeStatus||"down"===d.ins.cascadeStatus))if(e.node.children&&e.node.children.length){var i=e.node.children.map(function(e){return e.data});d.ins.lookupSelectionSer.updateSelections(i,!1)}else{var n=e.node.data[d.ins.treeInfo.dataField][d.ins.treeInfo.pathField];d.ins.lookupSelectionSer.unselectByPathcode(n)}e.nodes&&e.nodes.length?(d.ins.multiSelMgr.remove(e.nodes.map(function(e){return e.id})),d.ins.checkedChange.emit({data:e.nodes.map(function(e){return e.data}),isCheck:!1})):d.ins.checkedChange.emit({data:[e.node.data],isCheck:!1})}}),u.checkAll.subscribe(function(e){var t=e.instance.checkeds.map(function(e){return e.data});d.ins.multiSelMgr.updateSelections(t),d.ins.checkedChange.emit({data:t,isCheck:!0})}),u.unCheckAll.subscribe(function(){d.ins.multiSelMgr.clear(),d.ins.checkedChange.emit({data:[],isCheck:!1})}),u.search.subscribe(function(e){"*"===e.field||e.value?(e.value=e.value.trim(),t(e)):d.ins.messagerService.warning(d.ins.mustWriteSomething)}),u.cellClick.subscribe(function(t){if(t.col.field===D&&(t.event.stopPropagation(),t.event.target.classList.contains("f-lookup-favorite"))){var i=d.ins;!function n(e){e&&e.forEach(function(e){return i.utils.getValue(i.idField,e.data)===t.node.id?(e.data[D]=!e.data[D],!0):!!(e.children&&0<e.children.length)&&n(e.children)})}(d.ins.items),u.loadData(d.ins.items),d.lookupSelectionSer.updateFavoriteData(t.node.data,t.node.data[D]?L:M)}}),u.dblClick.subscribe(function(e){d.ins.gridOptions.singleSelect&&e.selectable&&d.ins.okButton&&d.ins.selectItem(e.data)});var i=r();return u.columnSorted.subscribe(function(e){if(r())u.clientSort();else{var t=I({},e),i=t.sortName,n=t.sortOrder,s=d.ins.columns.find(function(e){return e.field===i}),a=s?s.fieldPath?s.fieldPath:s.field:i,o=Object.assign({sortName:a,sortOrder:n},{search:d.ins._searchState});d.ins.httpMgr.getData(o,"search").subscribe(function(e){d.ins.items=e.items,d.ins.closeLoading(),u.clearAll();var t=d.ins.checkNodeCanBeSelect(e.items,!1);u.loadData(t),u.resize()})}}),u.clearSearchValue.subscribe(function(){d.ins._searchState=null,d.IS_SEARCH_RESULT=!1;var e=[];d.ins.allData&&d.ins.allData.length&&(e=d.ins.checkNodeCanBeSelect(d.ins.allData,i)),e&&e.length?(d.ins.items=e,d.ins.favHelper.updateFavoritesStatus(d.ins.items),u.loadData(e),d.ins.selectionMgr.selectCurrentValue()):t({field:"*",value:""})}),u.expand.subscribe(function(s){if(!s.leaf&&!s.showLoading)if(s.children&&s.children.length){if(!d.ins.singleSelect&&d.ins.enableCascade&&("enable"===d.ins.cascadeStatus||"down"===d.ins.cascadeStatus)&&d.ins.isGetAllChidlNodes){var e=u.findRowNode(s.id);u.propagateSelectionDown(e,e.isChecked);var t=s.children.filter(function(e){return e.selectable}).map(function(e){return e.data});d.ins.lookupSelectionSer.updateSelections(t,e.isChecked)}}else{var i=d.ins.gridOptions.treeInfo;if(("default"===d.ins.loadTreeDataType?"async"===u.loadDataType:"layerload"===d.ins.loadTreeDataType)||d.IS_SEARCH_RESULT){var n="",a=-1,o=I({},u.searchData),r=o.field,l=void 0===r?"*":r,c=o.value,p=void 0===c?"":c;if(s.showLoading=!0,u.detectChanges(),"parentId"===i.layerType)n=s.id;else{var h=i.dataField;h?(n=s.data[h][i.pathField],a=s.data[h][i.layerField]):d.ins.writeConsole("未找到分级信息。")}if(!d.ins.uri)return void d.ins.expandTreeNode.emit({instance:u,node:s,parentIdOrPath:n,parentLayer:a,search:{value:p,field:l}});d.ins.showLoading(),d.getChildren(n,a,{searchField:"*"===l?"*":l,searchValue:p}).subscribe(function(e){if(d.ins.closeLoading(),u){if(s&&e.items&&e.items.length){d.ins.useFavorite&&d.ins.favHelper.updateFavoritesStatus(e.items);var t=d.ins.checkNodeCanBeSelect(e.items,!1);if(u.appendChildren(t,s),"all"!==u.loadDataType&&!d.ins.singleSelect&&d.ins.isGetAllChidlNodes&&("enable"===d.ins.cascadeStatus||"down"===d.ins.cascadeStatus)){var i=u.findRowNode(s.id);u.propagateSelectionDown(i,i.isChecked);var n=e.items.filter(function(e){return!e.addtional});n&&n.length&&d.ins.lookupSelectionSer.updateSelections(n.map(function(e){return e.data}),i.isChecked)}}s.showLoading=!1,u.detectChanges(),u.psRef.directiveRef.update(),d.ins.selectionMgr.selectCurrentValue()}})}}}),i&&this.ins.items&&this.ins.treeNodeHelper.updateTreeNodeExpanded(this.ins.items),i},oe.prototype.cascadeValueChanged=function(e){var t=e,i="datalist"===this.ins.activeTab?"treetable":"fav",n=this.ins.lookupCmpMgr.getComponentInstance(i);if(n){switch(t){case"enable":n.cascadeCheck=!0,n.cascadeDown=!0,n.cascadeUp=!0;break;case"disable":n.cascadeCheck=!1,n.cascadeDown=!1,n.cascadeUp=!1;break;case"up":n.cascadeCheck=!0,n.cascadeUp=!0,n.cascadeDown=!1;break;case"down":n.cascadeCheck=!0,n.cascadeDown=!0,n.cascadeUp=!1;break;default:n.cascadeCheck=!0,n.cascadeDown=!0,n.cascadeUp=!0}this.ins.cascadeStatus=t||"enable"}},oe);function oe(e){this.ins=e,this.IS_SEARCH_RESULT=!1,this.lookupSelectionSer=this.ins.lookupSelectionSer}var re=(le.prototype.onSelectedTableCellClick=function(e){if(e.col.field===D&&(e.event.stopPropagation(),e.event.target.classList.contains("f-lookup-unfavorite"))){var t=e.row[this.ins.idField];if(this.ins.lookupSelectionSer.unSelect(t),this.ins.isTree()){var i=this.ins.lookupCmpMgr.getComponentInstance("treetable");if(i.unCheckedNode(t),i.unSelectNode(t),this.ins.useFavorite){var n=this.ins.lookupCmpMgr.getComponentInstance("fav");n.data&&n.data.length&&n.findRowNode(t)&&(n.unCheckedNode(t),n.unSelectNode(t))}}else if(this.ins.lookupCmpMgr.getComponentInstance().unCheckRow(t),this.ins.useFavorite){var s=this.ins.lookupCmpMgr.getComponentInstance("fav");s.data&&s.data.length&&s.unCheckRow(t)}}},le.prototype.initSelectedColumns=function(){var e=[];if(this.ins.showSelected&&!this.ins.singleSelect){var t=(e=f.cloneDeep(this.ins.gridOptions.columns)).find(function(e){return e.field===D});t?t.formatter=function(){return E}:e=e.concat([{field:D,width:80,formatter:function(){return E}}])}return e},le.prototype.updateSelections=function(e){Array.isArray(e)?this.ins.lookupSelectionSer.updateSelections(e,!0):this.ins.lookupSelectionSer.select(e)},le.prototype.remove=function(e){e&&this.ins.lookupSelectionSer.unSelect(e)},le.prototype.clear=function(){this.ins.lookupSelectionSer.clearSelections()},le.prototype.save=function(e){this.ins.showSelected&&(this.ins.personalConf.selections=e,this.ins.personalConfigService.savePersonalConfig(this.ins.personalConf))},le.prototype.loadData=function(){var e=this.ins.personalConf&&this.ins.personalConf.selections||[];e.length||(e=this.ins.lookupSelectionSer.getSelections()),this.ins.lookupSelectionSer.loadSelections(e)},le);function le(e){this.ins=e}var ce={tabIndex:"datalist",favorite:null,size:null},pe=(he.prototype.disablePagination=function(){return{pageIndex:1,pageSize:500}},he.prototype.buildQueryParams=function(e,t){void 0===t&&(t="all");var i={};this.ins.condition&&(i.condition=f.cloneDeep(this.ins.condition));var n={category:t};if("fav"!==t&&this.ins.isDoublleList()&&this.ins.navigationFilter&&"all"!==t&&this.ins.navigationFilter.idValue&&"textchange"!==t&&(i.relationFilter=x(this.ins.navigationFilter.idValue)),e){if("fav"!==t&&"selected"!==t||(e.pageInfo=this.disablePagination()),e.pageInfo&&(i.pageIndex=e.pageInfo.pageIndex,i.pageSize=e.pageInfo.pageSize),e.search){var s=e.search.field;s&&"*"===s&&(s="*"),e.search.value&&(e.search.value=e.search.value.trim()),n.searchField=s,n.searchValue=e.search.value,n.searchType=e.search.type||"like",""===e.search.value&&"search"===n.category&&(n.category="all")}e.sortName&&(n.sortName=e.sortName),e.sortOrder&&(n.sortOrder=e.sortOrder)}return"fav"===t&&e.favoriteIds&&(n.favoriteIds=e.favoriteIds),!this.ins.isTree()&&this.ins.displayType!==w.NavTreeList||(i.enableFullTree=this.ins.enableFullTree),"textchange"===t&&(i.enableFullTree=!1),"selected"===t&&(n.category="fav",i.enableFullTree=!1,n.favoriteIds=e.favoriteIds),i.searchValue=JSON.stringify(n),i.loadTreeDataType=this.ins.loadTreeDataType,i.customData=this.ins.customData,this.ins.helpId&&(i.helpId=this.ins.helpId),e.selectedInfo&&(i.selectedInfo=e.selectedInfo),i},he.prototype.getData=function(e,t){void 0===t&&(t="all");var i=this.ins.gridOptions.uri;this.ins.isDoublleList()&&this.ins.navigationFilter&&this.ins.navigationFilter.idValue&&"fav"!==t&&(t="list");var n=this.buildQueryParams(e,t);if(i||this.ins.beUri){if(this.ins.beUri&&this.ins.columns&&this.ins.columns.length){var s=this.ins.columns.map(function(e){return e.searchField}).filter(function(e){return e});if(n.condition||(n.condition={}),!this.ins.isTree()&&this.ins.pagination){var a=I({},n),o=a.pageSize,r=void 0===o?this.ins.pageSize||20:o,l=a.pageIndex;n.condition.pagination={pageSize:r,pageIndex:l}}else n.condition.pagination={isUsePagination:!1};var c=JSON.parse(n.searchValue);c.searchValue&&(n.condition=this.ins.lookupUtils.mergeCondition(n.condition,s,{field:c.searchField,value:c.searchValue}))}var p=this.ins.beUri||i;if(this.ins.http&&(this.ins.http.context=this.ins.context),this.ins._searchResult)return u.of(this.ins._searchResult);if("allChildren"!==t)return this.ins.http.getData(p,n);var h={searchValue:JSON.stringify({category:t}),parentsIds:e.parentsIds,customData:n.customData,helpId:n.helpId};return this.ins.http.getData(p,h)}return u.of(!1)},he.prototype.getSelecedItems=function(e){return this.getData({favoriteIds:e},"selected")},he.prototype.getPersonalConfig=function(){var t=f.cloneDeep(ce),e=this.ins.personalConfigService._newKey,i=this.ins.personalConfigService.getPersonalData(e);i&&Object.keys(i).length||(i=t);var n=u.of(i);return"locale"===this.ins.favoriteDataFrom||this.ins.isTabChanged?n:this.ins.http&&this.ins.http.getUserSettings?this.ins.http.getUserSettings(e).pipe(S.map(function(e){return e&&e.textValue?JSON.parse(e.textValue):t})):n},he.prototype.lookupRequest=function(o,r){var l=this;return void 0===r&&(r="all"),this.ins.usePersionalConf?this.getPersonalConfig().pipe(S.tap(function(e){l.ins.personalConf=e,l.ins.personalConfigService.savePersonalConfig(e),l.ins.isTabChanged||(l._originalPersonalConfig=f.cloneDeep(e))}),S.switchMap(function(e){var t=e.tabIndex,i=e.favorite,n=e.size;if(l.ins.isTabChanged||(l.ins.activeTab=t||"datalist"),n&&(l.ins.dialogWidth=n.width,l.ins.dialogHeight=n.height,l.ins.dialog.reSize({width:n.width,height:n.height})),"datalist"===l.ins.activeTab)return l.getData(o,r);if("favorite"===l.ins.activeTab){var s=i?i[l.ins.localService.localeId]:[];return s&&s.length||l.ins.isTabChanged?(o.favoriteIds=s,l.getData(o,"fav").pipe(S.switchMap(function(e){return e&&!e.items&&(e.items=[]),e.items.length?u.of(e):l.getData(o,"all").pipe(S.map(function(e){return e&&!e.items&&(e.items=[]),e.activeTab="datalist",e}))}))):l.getData(o,"all").pipe(S.map(function(e){return e&&!e.items&&(e.items=[]),e.activeTab="datalist",e}))}if("selected"===l.ins.activeTab){var a=(l.ins.displayValue?l.ins.displayValue.split(","):[]).filter(function(e){return e});return l.getSelecedItems(a)}})):this.getData(o,r)},he.prototype.submitFavoriteData=function(e){var t=this;if(JSON.stringify(this.ins.personalConf)!==JSON.stringify(this._originalPersonalConfig)){var i="";if(e===L?i=this.ins.addFavoriteSuccess:e===M&&(i=this.ins.delFavoriteSuccess),this.ins.personalConfigService.savePersonalConfig(this.ins.personalConf||{}),"locale"!==this.ins.favoriteDataFrom){this._originalPersonalConfig=f.cloneDeep(this.ins.personalConf);var n={configkey1:this.ins.personalConfigService.personalConfigKey,configkey2:"",configkey3:"",textvalue:JSON.stringify(this.ins.personalConf)};if(this.ins.http&&this.ins.http.saveUserSettings)return this.ins.savingFaoriteData=!0,this.ins.showLoading(),this.ins.http.saveUserSettings(n).subscribe(function(e){t.ins.savingFaoriteData=!1,t.ins.closeLoading(),i&&t.ins.notifyService.success(i)});i&&this.ins.notifyService.success(i)}else i&&this.ins.notifyService.success(i)}},he);function he(e){this.ins=e,this._originalPersonalConfig=ce}var de=(ue.prototype.ngOnInit=function(){},ue.prototype.createComponent=function(){var e=null;return e=this.isTreeList()?this.cfr.resolveComponentFactory(l.TreeTableComponent):this.cfr.resolveComponentFactory(r.DataTableComponent),this.navOptions.keepSelect=!1,this.navOptions.showFilterBar=!0,this.navOptions.width=this.lookupCmp.leftPanelWidth-2,this.cmpRef=this.cmpContainer.createComponent(e),this.isTreeList()?this.navOptions.fit=!0:(this.navOptions.fill=!0,this.cmpRef.instance.maxSize=5,this.cmpRef.instance.fill=!0),this.navOptions.pageInfo?(this.navOptions.pageInfo.pageList&&(this.navOptions.pageList=this.navOptions.pageInfo.pageList),this.navOptions.pagination=this.navOptions.pageInfo.enablePager,this.navOptions.pageIndex=this.navOptions.pageInfo.pageIndex,this.navOptions.pageSize=this.navOptions.pageInfo.pageSize):this.navOptions.pagination=!1,Object.assign(this.cmpRef.instance,this.navOptions),this.loadData(),u.of(this.cmpRef)},ue.prototype.update=function(){this.cd.detectChanges()},ue.prototype.resize=function(e){e&&(e.width=e.width-2,this.cmpRef.instance.resize(e))},ue.prototype.isTreeList=function(){return"treelist"===this.navOptions.displayType.toLowerCase()},ue.prototype.selectLeftDataTableRow=function(e,t){var i=this;if(e&&e.length){var n=null;this.lookupCmp.navSelectedIds?n=e.find(function(e){return e[t.idField]==i.lookupCmp.navSelectedIds}):this.lookupCmp.selectFirstInNav&&(n=e[0]),n&&(t.dtBody.selectedRowIndex=-1,t.dtBody.selectedRow("",0,n))}},ue.prototype.closeLoading=function(){this.lookupCmp.closeLoading()},ue.prototype.initDataTable=function(t){var a=this;t.loadData({pageSize:this.navOptions.pageSize,pageIndex:this.navOptions.pageIndex,total:this.navOptions.total,data:this.navOptions.items}),t.resize({width:320,height:this.navOptions.height}),t.selectedRow.subscribe(function(e){a.selected.emit({data:e.data})}),t.unSelectRow.subscribe(function(e){a.selected.emit(null)});var i={pageInfo:{pageIndex:1,pageSize:this.navOptions.pageSize},search:""},o={next:function(e){a.closeLoading(),n(e)},error:function(e){a.closeLoading()}};t.search.subscribe(function(e){a._searchState=e,a.search.emit(e),i.search=e,i.pageInfo.pageSize=t.pageSize,a.lookupCmp.navigationFilter=null,a.lookupCmp.httpMgr.getData(i,"navsearch").subscribe(o)});var n=function(e){t.loadData({pageSize:e.pageInfo.pageSize,pageIndex:e.pageInfo.pageIndex,total:e.total,data:e.items}),a.selectLeftDataTableRow(e.items,t),t.cd.markForCheck()};t.pageChanged.subscribe(function(e){a.pageChanged.emit(e),a.lookupCmp.navigationFilter=null,a.lookupCmp.httpMgr.getData(e,"navsearch").subscribe(o)}),t.pageSizeChanged.subscribe(function(e){a.lookupCmp.navigationFilter=null,a.lookupCmp.httpMgr.getData(e,"navsearch").subscribe(o)}),t.columnSorted.subscribe(function(e){var t=I({},e),i=t.sortName,n=t.sortOrder;a.lookupCmp.navigationFilter=null;var s=Object.assign({sortName:i,sortOrder:n},a._searchState);a.lookupCmp.httpMgr.getData(s,"navsearch").subscribe(o)}),t.clearSearchValue.subscribe(function(){a._searchState=null}),this.selectLeftDataTableRow(this.navOptions.items,t)},ue.prototype.initTreeTable=function(a){var o=this;a.virtualized=!0,a.nodeSelected.subscribe(function(e){o.selected.emit({data:e.node.data})}),a.nodeUnSelect.subscribe(function(e){o.selected.emit(null)}),a.fixedHeader=!0,this.lookupCmp.treeNodeHelper.updateTreeNodeExpanded(this.navOptions.items,this.navOptions.treeInfo),a.loadDataType=this.navOptions.treeInfo.loadDataType,this.navOptions.items=this.lookupCmp.checkNodeCanBeSelect(this.navOptions.items,"all"===this.navOptions.treeInfo.loadDataType),a.loadData(this.navOptions.items),this.lookupCmp.navSelectedIds?a.selectNode(this.lookupCmp.navSelectedIds):this.lookupCmp.selectFirstInNav&&a.selectFirstNode(),this.allData=this.navOptions.items;var r={next:function(e){o.closeLoading(),a.clearAll();var t=o.lookupCmp.checkNodeCanBeSelect(e.items,"all"===o.navOptions.treeInfo.loadDataType);a.loadData(t),a.resize()},error:function(e){o.closeLoading()}};a.search.subscribe(function(e){o._searchState=e,o.lookupCmp.navigationFilter=null,o.lookupCmp.httpMgr.getData({search:e},"navsearch").subscribe(r)}),a.columnSorted.subscribe(function(e){if(o.lookupCmp.navigationFilter=null,"all"===a.loadDataType)a.clientSort();else{var t=I({},e),i=t.sortName,n=t.sortOrder,s=Object.assign({sortName:i,sortOrder:n},o._searchState);o.lookupCmp.httpMgr.getData(s,"nav").subscribe(r)}}),a.clearSearchValue.subscribe(function(){o._searchState=null,a.loadData(o.allData)}),a.expand.subscribe(function(e){o.onNodeExpanded(e,a)})},ue.prototype.onNodeExpanded=function(t,i){if(!(t.leaf||t.children&&t.children.length)){var e=this.navOptions.treeInfo;if("async"===this.navOptions.treeInfo.loadDataType){var n="",s=-1,a=I({},i.searchData),o=a.field,r=void 0===o?"*":o,l=a.value,c=void 0===l?"":l;if(t.showLoading=!0,i.detectChanges(),"parentId"===e.layerType)n=t.id;else{var p=e.dataField;p?(n=t.data[p][e.pathField],s=t.data[p][e.layerField]):console.log("未找到分级信息。")}if(!this.lookupCmp.uri)return void this.lookupCmp.expandTreeNode.emit({instance:i,node:t,parentIdOrPath:n,parentLayer:s,search:{value:c,field:r}});this.getChildren(n,s,{searchField:"*"===r?"*":r,searchValue:c},i).subscribe(function(e){i&&(t&&e.items&&e.items.length&&i.appendChildren(e.items,t),t.showLoading=!1,i.detectChanges())})}}},ue.prototype.getChildren=function(e,t,i,n){var s=this.lookupCmp.gridOptions.uri,a=I({parentLayer:t,category:"nav"},i);"parentId"===this.navOptions.treeInfo.layerType?a.parentId=e:a.parentPath=e;var o={searchValue:JSON.stringify(a),customData:this.lookupCmp.customData,enableFullTree:!1,loadTreeDataType:"layerload"};return this.lookupCmp.helpId&&(o.helpId=this.lookupCmp.helpId),n&&n.sortName&&Object.assign(o,{sortName:n.sortName,sortOrder:n.sortOrder}),this.lookupCmp.http.getData(s,o)},ue.prototype.loadData=function(){if(this.cmpRef.instance.allColumnsTitle=this.lookupCmp.allColumnsTitle,this.isTreeList()){var e=this.cmpRef.instance;this.initTreeTable(e)}else{var t=this.cmpRef.instance;this.initDataTable(t)}},ue.decorators=[{type:y.Component,args:[{selector:"lookup-left",template:'<div style="height: 100%;position: relative;">\r\n    <ng-container #container></ng-container>\r\n</div>'}]}],ue.ctorParameters=function(){return[{type:y.ComponentFactoryResolver},{type:y.ChangeDetectorRef}]},ue.propDecorators={cmpContainer:[{type:y.ViewChild,args:["container",{read:y.ViewContainerRef}]}],selected:[{type:y.Output}],unselected:[{type:y.Output}],search:[{type:y.Output}],pageChanged:[{type:y.Output}]},ue);function ue(e,t){this.cfr=e,this.cd=t,this.selected=new y.EventEmitter,this.unselected=new y.EventEmitter,this.search=new y.EventEmitter,this.pageChanged=new y.EventEmitter,this._searchState=null,this.allData=null}var fe=(ge.prototype.getComponentInstance=function(e){if(void 0===e&&(e="datatable"),!this.ins.componentRef||!this.ins.componentRef.instance)return null;if("selected"===e)return this.ins.multiSelectDT;var t=this.ins.componentRef.instance;if("leftDataTable"===e||"leftTree"===e){var i=this.ins.leftComponentRef;if(!(i&&i.instance&&i.instance.cmpRef&&i.instance.cmpRef.instance))return null;t=this.ins.leftComponentRef.instance.cmpRef.instance}switch("fav"===e&&(t=this.ins.favoritesComponentRef.instance),e){case"leftDataTable":case"fav":case"datatable":return t;case"leftTree":case"treetable":return t;default:return this.ins.isTree(),t}},ge.prototype.createComponentWithServerData=function(e){this.ins.componentRef||(this.ins.idField=e.idField||this.ins.idField,this.ins.textField=e.textField||this.ins.textField,this.ins.valueField=e.valueField||this.ins.valueField,this.ins.displayType=e&&e.displayType||this.ins.displayType||"LIST",this.ins.componentRef=this.createContent(this.ins.gridOptions),this.createFavoriteComponent(),this.resizeComponent())},ge.prototype.createFavoriteComponent=function(){if(this.ins.useFavorite&&!this.ins.favoritesComponentRef){this.ins.favoriteColumns=this.ins.favHelper.getFavoriteColumns();var e=Object.assign({},this.ins.gridOptions,{showFilterBar:!1,pagination:!1,columns:this.ins.favoriteColumns||[]});this.ins.favoritesComponentRef=this.createFavoritesContent(e),this.resizeComponent("fav")}},ge.prototype.reloadTreeDataForExpand=function(i){var n=this,e=this.ins.gridOptions.uri,s=this.ins.componentRef.instance,t=I({},s.searchData),a=t.field,o=void 0===a?"*":a,r=t.value,l={category:"all",searchValue:void 0===r?"":r,searchField:o,layerNum:i},c={searchValue:JSON.stringify(l),customData:this.ins.customData,enableFullTree:this.ins.enableFullTree,loadTreeDataType:this.ins.loadTreeDataType};return this.ins.helpId&&(c.helpId=this.ins.helpId),s&&s.sortName&&Object.assign(c,{sortName:s.sortName,sortOrder:s.sortOrder}),this.ins.showLoading(),this.ins.http.getData(e,c).subscribe(function(e){n.ins.closeLoading();var t=n.ins.checkNodeCanBeSelect(e.items,-1===i);n.ins.items=t,s.loadData(t)})},ge.prototype.setTreeNodeExpandBy=function(e,n){var s=this;e&&e.length&&e.forEach(function(e){var t=e.data[s.ins.treeInfo.dataField].layer,i=t+n-1;e.expanded=t<=i||e.expanded,e.children&&e.children.length&&t+1<=i&&s.setTreeNodeExpandBy(e.children,n)})},ge.prototype.useContextMenuForTree=function(r){var l=this,e=this.ins.treeTableOptions,t=e.maxLevel,i=e.enableContextMenu,n=e.language;if(i&&t){for(var s=[],a=1;a<=t;a++){var o=n["expand"+a];s.push({id:31,code:a,title:o,handle:function(e){var t=e.menu.code;if(c())l.setTreeNodeExpandBy(l.ins.items,t),r.instance.updateSerializedValue();else{var i=l.ins.treeInfo,n=i.dataField,s=i.layerField,a=(l.ins.items||[])[0];if(a&&a.data){var o=l.ins.utils.getValue(n+"."+s,a.data)+t-1;l.reloadTreeDataForExpand(o)}}}})}var c=function(){return"default"===l.ins.loadTreeDataType?"all"===r.instance.loadDataType:"loadall"===l.ins.loadTreeDataType},p=[{id:1,code:"expandall",title:n.expandall,handle:function(e){r&&c()?r.instance.expandAll():l.reloadTreeDataForExpand(-1)}},{id:2,code:"collapseall",title:n.collapseall,handle:function(e){r&&r.instance.collapseAll()}},"-",{id:3,title:n.expandByLayer,children:s}];this.ins.treeTableOptions.contextMenuItems=p,r.instance.beforeShowContextMenu=function(){return u.of({show:!r.instance.state.searched})}}},ge.prototype.createContent=function(e){if(!this.ins.componentRef){var t=this.ins.getComponentType(),i=this.ins.cfr.resolveComponentFactory(t),n=null;n=this.ins.isDoublleList()?this.ins.centerContainer.createComponent(i):this.ins.contentContainer.createComponent(i),this.ins.isTree()?(e.fit=!0,e.pagination=!1,this.ins.useFavorite&&(e.fitColumns=!1,e.autoFitColumns=!0),this.useContextMenuForTree(n)):e.fill=!0;var s=this.ins.treeTableOptions||{};return Object.assign(n.instance,e,I({allColumnsTitle:this.ins.allColumnsTitle},s)),this.ins.componentRef=n,this.resizeComponent(),n}},ge.prototype.createFavoritesContent=function(e){var t,i=this.ins.getComponentType(),n=this.ins.cfr.resolveComponentFactory(i);return t=this.ins.favoritesContainer.createComponent(n),this.ins.isTree()?(e.fit=!0,e.pagination=!1):e.fill=!0,Object.assign(t.instance,e,{width:this.ins.dialog.size.width-20,height:this.ins.dialogMgr.getHeight()}),this.ins.favHelper.initFavoriteComponentEvent(t),t},ge.prototype.resizeComponent=function(e){void 0===e&&(e="datatable");var t={width:this.ins.dialog.size.width-20,height:this.ins.dialogMgr.getHeight()};!this.ins.isDoublleList()||"datatable"!==e&&"treetable"!==e||(t.width=this.ins.dialog.size.width-this.ins.leftPanelWidth-27),this.getComponentInstance(e).resize(t)},ge.prototype.createLeftComponent=function(e){var i=this,t=null;return this.ins.isDoublleList()&&(t=this.ins.cfr.resolveComponentFactory(de)),this.ins.leftComponentRef=this.ins.leftContainer.createComponent(t),e.height=this.ins.dialogMgr.getHeight(),this.ins.dialogWidth<this.ins.navLookupDialogMinWidth&&(this.ins.dialogWidth=this.ins.navLookupDialogMinWidth,this.ins.dialog.reSize({width:this.ins.dialogWidth}),this.ins.resizeCmp({width:this.ins.dialog.size.width})),e.width!==this.ins.leftPanel.width&&(this.ins.leftPanel.resize({width:this.ins.leftPanel.width,height:e.height}),this.ins.resizeCmp({width:this.ins.dialog.size.width})),this.ins.leftComponentRef.instance.lookupCmp=this.ins,this.ins.leftComponentRef.instance.navOptions=e,this.ins.leftComponentRef.instance.selected.pipe(S.debounceTime(100),S.switchMap(function(e){e&&e.data?i.ins.navigationFilter={selected:e.data,idValue:i.getNavigationFilter(e.data),searchField:"",searchValue:""}:i.ins.navigationFilter=undefined;var t={pageInfo:{pageIndex:i.ins.gridOptions.pageIndex,pageSize:i.ins.gridOptions.pageSize}};return Object.assign(t,{search:i.ins._searchState}),i.ins.httpMgr.getData(t,"list")})).subscribe(function(e){i.ins.closeLoading(),i.ins.loadDataWhenOpen=!0,i.ins.useFavorite&&!i.ins.isTree()&&i.ins.favHelper.updateFavoritesStatus(e.items),i.ins.loadDataTableData(e),setTimeout(function(){i.ins.selectionMgr.selectCurrentValue(),i.ins.changeDetector.detectChanges()})}),this.ins.leftComponentRef.instance.createComponent()},ge.prototype.getNavigationFilter=function(n){if(this.ins.navigationOptions.relations&&this.ins.navigationOptions.relations.length){var s=[];return this.ins.navigationOptions.relations.forEach(function(e){var t=e.groupField,i={fieldName:e.helpField,fieldValue:""};i.fieldValue=t.split(".").reduce(function(e,t){return e[t]},n),s.push(i)}),s}return""},ge);function ge(e){this.ins=e}var ve=(me.prototype.dialogClosed=function(){this.ins.displayText===this.ins.originalText||this.ins.nosearch||(this.ins.displayText=this.ins.originalText,this.ins.setModelValue(this.ins.displayText)),this.ins.componentRef&&(this.ins.componentRef.destroy(),this.ins.componentRef=null),this.ins.favoritesComponentRef&&(this.ins.favoritesComponentRef.destroy(),this.ins.favoritesComponentRef=null),this.ins.contentContainer&&this.ins.contentContainer.clear(),this.ins.centerContainer&&this.ins.centerContainer.clear(),this.ins.leftComponentRef&&(this.ins.leftComponentRef.destroy(),this.ins.leftComponentRef=null),this.ins.leftContainer&&this.ins.leftContainer.clear(),this.ins.isShow=!1,this.ins.isTextChange=!1,this.ins.dialog&&(this.ins.content=null),this.ins.navigationFilter=null,this.ins.lookupUtils.pendingEnd(),this.ins.helpId&&(this.ins.displayType=""),this.lookupInit&&(this.lookupInit.unsubscribe(),this.lookupInit=null),this.ins.favoriteItems=[],this.ins.isTabChanged=!1,this.ins.uri&&(this.ins.items=[]),this.ins._searchState=null,this.ins.pageIndex=1,this.ins.loadDataWhenOpen=this._loadDataWhenOpen,this.ins.navSelectedIds=this._navSelectedId,this.ins.selectFirstInNav=this._selectFirstInNav,this.ins.isGetAllChidlNodes=!1,this.ins.enableGetAllChildNodes=!0,this.ins.usePersionalConf&&"locale"!==this.ins.favoriteDataFrom&&this.ins.httpMgr.submitFavoriteData("dialog closed event."),this.keyDownHandler&&(this.keyDownHandler(),this.keyDownHandler=null),this.ins.inputGroup&&this.ins.inputGroup.focus(),this.ins.userInitialConfig.reset(),this.ins.treeInfo=this.ins._treeInfo_,this.ins.lookupUtils.destroy(),this.ins.dialogClosed.emit()},me.prototype.onDialogCreated=function(){var s=this;this._loadDataWhenOpen=this.ins.loadDataWhenOpen,this._navSelectedId=this.ins.navSelectedIds,this._selectFirstInNav=this.ins.selectFirstInNav,this.ins.dialogCreatedSubscription=this.ins.dialogCreated.subscribe(function(e){if(e){if(s.ins.dialogOpenedSubscription&&s.ins.dialogOpenedSubscription.unsubscribe(),s.ins.dialogClosedSubscription&&s.ins.dialogClosedSubscription.unsubscribe(),s.registerDialogEvent(),s.ins.isRecordSize){var t=s.ins.personalConfigService.getDialogSize();if(t){var i=t.width,n=t.height;s.ins.dialogWidth=i||s.ins.dialogWidth,s.ins.dialogHeight=n||s.ins.dialogHeight,e.width=s.ins.dialogWidth,e.height=s.ins.dialogHeight}}e.show()}})},me.prototype.checkDictPickingResult=function(e){var t,i,n,s=!0;return e!==undefined&&null!==e&&""!==e||(s=!0),"boolean"==typeof e&&(s=e),"object"==typeof e&&(s=e.showDialog===undefined||e.showDialog,e.hasOwnProperty("data")&&(t=e.data),i=e.selectedIds||null,e.message&&(n=e.message)),{show:s,customData:t,selectedIds:i,message:n}},me.prototype.canOpenDialog=function(e){var t=this.checkDictPickingResult(e),i=t.show,n=t.customData,s=t.selectedIds,a=t.message;this.ins.customData=n,this.ins.selectedIds=s||null,a&&this.ins.notifyService.warning(a),this.ins.isReady=!1,this.ins.isShow=i},me.prototype.getHeight=function(){return this.ins.dialog.size.contentHeight-this.ins.containerMargin.bottom-this.ins.containerMargin.top-(this.ins.useFavorite?40:0)},me.prototype.getMainGridSize=function(){return this.ins.isDoublleList()?{width:this.ins.dialog.size.width-this.ins.leftPanel.width-27,height:this.getHeight()}:{width:this.ins.dialog.size.width-this.ins.containerMargin.left-this.ins.containerMargin.right,height:this.getHeight()}},me.prototype.resetDialogContentHeight=function(){var e=this.ins.dialog.size,t=e.header,i=e.footer;return this.ins.dialogHeight-t-i-this.ins.containerMargin.bottom-this.ins.containerMargin.top},me.prototype.registerDialogEvent=function(){var t=this;this.ins.dialogOpenedSubscription=this.ins.dialog.opened.subscribe(function(){t.ins.dialogContentHeight=t.resetDialogContentHeight(),t.ins.gridOptions=Object.assign(t.ins.gridOptions,t.getMainGridSize()),t.ins.dialog.el.nativeElement.querySelector(".ps-content").style.height="100%",t.ins.displayType&&t.ins.customDisplayType&&(t.ins.componentRef=t.ins.lookupCmpMgr.createContent(t.ins.gridOptions),t.ins.lookupCmpMgr.createFavoriteComponent()),t.ins.initData(),t.ins.lookupUtils.pendingEnd(),t.ins.dialogOpened.emit()}),this.ins.subscriptions.push(this.ins.dialogOpenedSubscription),this.lookupInit=this.ins.lookupinitializationSubject.subscribe(function(){if(t.ins.loadDataWhenOpen=!0,t.registerShortcutKey(),t.ins.leftPanel){var e=t.ins.leftPanel.resizing.subscribe(function(e){t.ins.componentRef.instance.resize({width:t.ins.dialog.size.width-e.size.width-27,height:t.getHeight()}),t.ins.leftComponentRef.instance.resize(e.size)});t.ins.subscriptions.push(e)}}),this.ins.dialogClosedSubscription=this.ins.dialog.closed.subscribe(function(){t.ins.dialogMgr.dialogClosed()}),this.ins.subscriptions.push(this.ins.dialogClosedSubscription)},me.prototype.registerShortcutKey=function(){var c=this,e=this.ins.dialog.el.nativeElement.querySelector(".farris-modal");e&&this.ins.shortcutKey&&!this.keyDownHandler&&(this.keyDownHandler=this.ins.eventManager.addEventListener(e,"keydown",function(e){e.stopPropagation();var t=c.ins.shortcutKey,i=t.moveUp,n=t.moveDown,s=t.searchFocus,a=t.confirm,o=t.nextPager,r=t.prevPager;if([i,n,t.expand,t.collapse].includes(e.code))c.ins.componentRef.instance.onKeydownEvent(e);else if(e.key===a){if("INPUT"===e.target.nodeName&&!e.ctrlKey)return;c.ins.okButton.nativeElement.click()}else if(e.code===s)e.preventDefault(),c.ins.componentRef.instance.inputGroup.focus();else if(!c.ins.isTree()&&(e.code===o||e.code===r)){var l=e.code===o;c.paginationKeyDownHandler(l)}}))},me.prototype.paginationKeyDownHandler=function(e){void 0===e&&(e=!0);var t=this.ins.componentRef.instance,i=t.pageIndex,n=t.pageSize,s=t.total,a=i;e?a+=1:a-=1,(Math.ceil(s/n)<a||a<1)&&(a=i),this.ins.componentRef.instance.onPageChange({pageSize:n,pageIndex:a})},me);function me(e){this.ins=e,this.lookupInit=null,this._loadDataWhenOpen=!0,this._navSelectedId="",this._selectFirstInNav=!1,this.keyDownHandler=null}var ye=(Object.defineProperty(be.prototype,"idField",{get:function(){return this.ins.idField},enumerable:!0,configurable:!0}),be.prototype.initFavoriteItems=function(e){this.state.favoriteItems=e||[]},be.prototype.updateFavoriteData=function(t,e){var i=this;this.ins.savingFaoriteData||(this.state.favoriteItems=e===L?this.state.favoriteItems.concat([t]):this.state.favoriteItems.filter(function(e){return e[i.idField]!==t[i.idField]}),this.favoriteItems$.next({items:this.state.favoriteItems,action:e}))},be.prototype.loadSelections=function(e){this.state.selecteditems=x(e),this.state$.next(this.state)},be.prototype.getSelections=function(){return x(this.state.selecteditems)},be.prototype.select=function(e){e&&(this.state.selecteditems=x(this.state.selecteditems,[e]),this.state$.next(this.state))},be.prototype.unselectByPathcode=function(t){var e=this.ins.treeInfo,i=e.dataField,n=e.pathField;this.state.selecteditems=this.state.selecteditems.filter(function(e){return e[i][n]&&0!==e[i][n].indexOf(t)})},be.prototype.updateSelections=function(e,t){var i=this;void 0===t&&(t=!0),Array.isArray(e)||(e=[e]);var n=x(e),s=this.idField;if(t)this.state.selecteditems&&!this.state.selecteditems.length?this.state.selecteditems=n:n.map(function(e){return e[s]}).forEach(function(t,e){i.state.selecteditems.find(function(e){return e[s]==t})||i.state.selecteditems.push(n[e])});else if(e){var a=e.map(function(e){return e[s]});this.state.selecteditems=this.state.selecteditems.filter(function(e){return-1===a.indexOf(e[s])})}this.state$.next(this.state)},be.prototype.unSelect=function(t){var i=this;t&&(Array.isArray(t)?this.state.selecteditems=this.state.selecteditems.filter(function(e){return-1===t.indexOf(e[i.idField])}):this.state.selecteditems=this.state.selecteditems.filter(function(e){return e[i.idField]!=t}),this.state$.next(this.state))},be.prototype.clearSelections=function(){this.state.selecteditems=[],this.state$.next(this.state)},be);function be(e){this.ins=e,this.state={selecteditems:[],favoriteItems:[],quickItems:[]},this.state$=new u.BehaviorSubject(this.state),this.selected$=this.state$.pipe(S.switchMap(function(e){return u.of(e.selecteditems)})),this.favoriteItems$=new u.BehaviorSubject({items:this.state.favoriteItems,action:null}),this.quickItems$=this.state$.pipe(S.switchMap(function(e){return u.of(e.quickItems)}))}var Ce,Se={provide:n.NG_VALUE_ACCESSOR,useExisting:y.forwardRef(function(){return ke}),multi:!0},ke=(function ze(e,t){function i(){this.constructor=e}k(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}(Ie,Ce=z),Object.defineProperty(Ie.prototype,"displayType",{get:function(){return this._displayType},set:function(t){if(t){var e=Object.values(w).findIndex(function(e){return e===t.toUpperCase()});if(-1<e){var i=Object.keys(w);this._displayType=w[i[e]]}}else this._displayType=t},enumerable:!0,configurable:!0}),Object.defineProperty(Ie.prototype,"gridOptions",{get:function(){return this.useFavorite&&this.columns&&0<this.columns.length&&!this.columns.find(function(e){return e.field===D})&&this.columns.push({field:D,title:"",width:40,align:"center",fixed:"right",formatter:this.favHelper.favoriteColumnFormatter}),this._gridOptions=Object.assign(this._gridOptions,{singleSelect:this.singleSelect,idField:this.idField,uri:this.uri,showFilterBar:this.showFilterBar,pagination:this.pagination,pageIndex:this.pageIndex,pageSize:this.pageSize,pageList:this.pageList,total:this.total,items:this.items,columns:this.columns,resizableColumns:!0,fixedHeader:!0,hover:!0,treeInfo:this.treeInfo}),this._gridOptions},set:function(e){this._gridOptions=Object.assign({},this._gridOptions,e),this.selectedColumns=this.multiSelMgr.initSelectedColumns()},enumerable:!0,configurable:!0}),Object.defineProperty(Ie.prototype,"selections",{get:function(){var e=this.lookupSelectionSer.getSelections();return this.singleSelect?e[0]:e},enumerable:!0,configurable:!0}),Object.defineProperty(Ie.prototype,"usePersionalConf",{get:function(){return this.useFavorite||this.useTip||this.isRecordSize},enumerable:!0,configurable:!0}),Object.defineProperty(Ie.prototype,"displayTextList",{get:function(){return this.displayText?this.displayText.split(this.multipleChoiceSeparator):[]},enumerable:!0,configurable:!0}),Object.defineProperty(Ie.prototype,"userInitialConfig",{get:function(){return this._userSettings},enumerable:!0,configurable:!0}),Ie.prototype.writeConsole=function(e,t){void 0===t&&(t="warn"),this.debugSer&&this.debugSer[t](e)},Ie.prototype.cacheUserConfig=function(){var e=this;this._userSettings._title=this.title,this.displayInfo.title=this.title,this._userSettings._columns=this.deepClone(this.columns||[]),this._userSettings.getColumns=function(){return e._userSettings._columns},this._userSettings.reset=function(){e.title=e._userSettings._title,e.displayInfo.title=e.title,e.columns=e._userSettings.getColumns()}},Ie.prototype.deepClone=function(t){var i=this;if(null===t)return null;var n=Object.assign({},t);return Object.keys(n).forEach(function(e){return n[e]="object"==typeof t[e]?i.deepClone(t[e]):t[e]}),Array.isArray(t)?(n.length=t.length,Array.from(n)):n},Ie.prototype.ngOnInit=function(){Ce.prototype.ngOnInit.call(this),this.cacheUserConfig(),this.loadTreeDataType||(this.loadTreeDataType="default"),this.checkGridOptions(),this.displayInfo.title=this.title,this.http&&(this.http.context=this.context),this.allColumnsTitle=this.localService.getValue("lookup.allColumns"),this.mustWriteSomething=this.localService.getValue("lookup.mustWriteSomething"),this.mustChoosAdatarow=this.localService.getValue("lookup.mustChoosAdatarow"),this.addFavoriteSuccess=this.localService.getValue("lookup.favoriteInfo.addFav")||this.addFavoriteSuccess,this.delFavoriteSuccess=this.localService.getValue("lookup.favoriteInfo.cancelFav")||this.delFavoriteSuccess,this.dialogMgr.onDialogCreated(),this._treeInfo_=this.treeInfo?f.cloneDeep(this.treeInfo):null,this.quickSelect&&(this.quickSelect=Object.assign(P,this.quickSelect||{}))},Ie.prototype.ngOnDestroy=function(){Ce.prototype.ngOnDestroy.call(this),this.subscriptions.forEach(function(e){e&&(e.unsubscribe(),e=null)}),this.selectionMgr&&this.selectionMgr.destroy(),this.subscriptions=[],this.farrisInstances&&this.farrisInstances.destroy(this.el.nativeElement),this.lookupSearchInputEvent&&this.lookupSearchInputEvent(),this.lookupUtils.destroy(),this.overLayService.destory(this.el.nativeElement),this.overLayService=null},Ie.prototype.ngOnChanges=function(e){e.columns&&!e.columns.isFirstChange()&&this.cacheUserConfig()},Ie.prototype.ngAfterViewInit=function(){if(this.lookupSearchInputEvent=se.bind(this)(),this.usePersionalConf&&this.favHelper.initPersonalInfo(),this.useExtendInfo){var e=this.selectionMgr.getBindingData();this.updateExtendInfo(e,!1)}if("text"===this.viewType)this.render2.listen(this.inputGroup.textbox.nativeElement,"keydown.F2",this.showDialog.bind(this));else if(this.registerMouseEventForTagView(),this.tagboxHeight){var t=this.tagbox.nativeElement.querySelector(".multi-more"),i=this.tagboxHeight;"auto"!==i&&(i+="px",this.maxTagboxHeight&&this.render2.setStyle(t,"maxHeight",this.maxTagboxHeight+"px")),this.render2.setStyle(t,"height",i)}this.el&&this.farrisInstances&&this.farrisInstances.add(this.el.nativeElement,this)},Ie.prototype.createInstance=function(){this.http=this.injector.get(H,null),this.messagerService=this.injector.get(o.MessagerService),this.loadingService=this.injector.get(c.LoadingService),this.notifyService=this.injector.get(v.NotifyService,null),this.personalConfigService=this.injector.get(G,null),this.lookupSelectionSer=new ye(this),this.utilService=new K(this),this.localService=this.injector.get(g.LocaleService),this.treeNodeHelper=new J(this),this.favHelper=new Z(this),this.ttEventMgr=new ae(this),this.multiSelMgr=new re(this),this.httpMgr=new pe(this),this.lookupCmpMgr=new fe(this),this.dialogMgr=new ve(this),this.selectionMgr=new X(this),this.dtEventMgr=new te(this)},Ie.prototype.showDialog=function(){var t=this;return this.disabled||this.readonly||(this.selectionMgr.initDisplayValue(),this.dictPickingSubscription=this.dictPicking({instance:this}).subscribe(function(e){t.dialogMgr.canOpenDialog(e)})),!1},Ie.prototype.isDoublleList=function(){return this.displayType===w.NavList||this.displayType===w.NavTreeList},Ie.prototype.isTree=function(){return this.displayType.toUpperCase()===w.TreeList},Ie.prototype.onResized=function(e){this.resizeCmp(e.size),this.resized.emit(e.size)},Ie.prototype.onResizing=function(e){this.resizing.emit(e.size),this.resizeCmp(e.size),this.isDoublleList()&&this.leftComponentRef&&this.leftComponentRef.instance.resize({width:this.leftPanel.width,height:this.dialogMgr.getHeight()})},Ie.prototype.onMaxDialog=function(e){this.resizeCmp(e.size),this.leftPanel&&this.leftComponentRef.instance.resize({width:this.leftPanel.width,height:this.dialogMgr.getHeight()}),this.dialogHeight=e.size.height,this.dialogContentHeight=this.dialogMgr.resetDialogContentHeight(),this.dialogMaxed.emit(e.size)},Ie.prototype.resizeCmp=function(e){if(this.componentRef&&this.componentRef.instance){var t={width:(e=e||this.dialog.size).width-this.containerMargin.left-this.containerMargin.right,height:this.dialogMgr.getHeight()};this.useFavorite&&this.favoritesComponentRef&&this.favoritesComponentRef.instance.resize(t),this.isRecordSize&&(this.personalConf.size=this.dialog.size,this.personalConfigService.updatePersonalConfig({size:this.dialog.size})),this.isDoublleList()&&(t.width=e.width-this.leftPanel.width-27),this.componentRef.instance.resize(t)}},Ie.prototype.checkGridOptions=function(){this.gridOptions.idField||this.writeConsole("未设置主键字段 idField"),this.beforeSelectData||(this.beforeSelectData=function(){return u.of(!0)});var e=this.localService.getValue("lookup.contextMenu");this.treeTableOptions=Object.assign({language:e},this.defaultTreeTableOptions,this.treeTableOptions||{})},Ie.prototype.getComponentType=function(){switch(this.displayType||(this.displayType="LIST"),this.displayType){case w.List:case w.NavList:case w.NavTreeList:return r.DataTableComponent;case w.TreeList:return l.TreeTableComponent}},Ie.prototype.showLoading=function(e){if(void 0===e&&(e=""),this.dialog&&this.dialog.modalContent&&!this.loading){var t={container:this.dialog.modalContent,delay:200};e&&(t.message=e),this.loading=this.loadingService.show(t)}else this.loading=this.loadingService.show()},Ie.prototype.closeLoading=function(){this.loading&&(this.loading.close(),this.loading=null),this.loadingService.clearAll()},Ie.prototype.getSearchColumns=function(e){var i=e.columns||this.columns;return e.searchFields?e.searchFields.map(function(t){var e=i.find(function(e){return e.field.toLowerCase()===t.value.toLowerCase()});return e&&(t.label=e.title),t}):i?i.filter(function(e){return e.searchField}).map(function(e){return{label:e.title,value:e.field}}):[]},Ie.prototype.initOptions=function(e){var t=this,i=u.of(!0);if(this.gridOptions.searchFields=this.getSearchColumns(e),e){if(this.columns&&this.columns.length||!e.columns||!e.columns.length||(this.columns=e.columns),this.setLookupTitleText(e),this.isDoublleList()&&this.dialogWidth<this.navLookupDialogMinWidth&&!this.isRecordSize&&(this.dialogWidth=this.navLookupDialogMinWidth,this.dialog.reSize({width:this.dialogWidth})),this.customDisplayType||(this.displayType=e.displayType||this.displayType||"LIST",this.changeDetector.detectChanges(),this.lookupCmpMgr.createComponentWithServerData(e)),this.isDoublleList()&&e.navigation&&!this.leftComponentRef){if(this.navigationOptions=e.navigation,this.navigationOptions.hover=!0,this.navigationOptions.searchFields=this.getSearchColumns(this.navigationOptions),this.customNavFormatter&&(this.navigationOptions.columns.forEach(function(e){t.customNavFormatter[e.field]&&(e.formatter=t.customNavFormatter[e.field])}),this.navigationOptions.rowStyler=this.customNavFormatter.rowStyler,this.navigationOptions.cellStyler=this.customNavFormatter.cellStyler),this.displayType===w.NavTreeList){var n=this.navigationOptions.treeInfo.loadDataType;"default"!==this.loadTreeDataType&&(n="loadall"===this.loadTreeDataType?"all":"async"),this.navigationOptions.treeInfo.loadDataType=n}i=this.lookupCmpMgr.createLeftComponent(this.navigationOptions)}}else this.lookupCmpMgr.createContent(this.gridOptions),this.lookupCmpMgr.createFavoriteComponent();return this.isTextChange&&(this.componentRef.instance.searchData.value=this.displayText),this.customFormatter&&(this.columns.forEach(function(e){t.customFormatter[e.field]&&(e.formatter=t.customFormatter[e.field])}),this.customFormatter.rowStyler&&(this.componentRef.instance.rowStyler=this.customFormatter.rowStyler),this.customFormatter.cellStyler&&(this.componentRef.instance.cellStyler=this.customFormatter.cellStyler)),this.changeDetector.detectChanges(),i},Ie.prototype.setLookupTitleText=function(e){e.displayInfo&&(this.displayInfo=e.displayInfo),this.title&&"此处显示帮助标题"!==this.title&&(this.displayInfo.title=this.title),this.displayInfo&&e.title&&(this.displayInfo.title||(this.displayInfo.title=e.title))},Ie.prototype.showGetAllChildrenCheckbox=function(){this.isTree()&&this.treeInfo?this.enableGetAllChildNodes="all"!==this.treeInfo.loadDataType&&"pathcode"===this.treeInfo.layerType:this.enableGetAllChildNodes=!1},Ie.prototype.initData=function(){var i=this,e={next:function(t){if(null===t)return i.isShow=!1,void(i.dialog&&i.dialog.close());i.initOptions(t).subscribe(function(){if(i.selectedColumns=i.multiSelMgr.initSelectedColumns(),i.favoriteColumns=i.favHelper.getFavoriteColumns(),i.usePersionalConf&&(i.personalConfigService.getPersonalData()||i.personalConfigService.savePersonalConfig(i.personalConf)),i.isTabChanged||i.lookupSelectionSer.loadSelections(t.selectedItems||[]),i.isDoublleList()&&(i.navSelectedIds||i.selectFirstInNav)&&(i.loadDataWhenOpen=!1),t.activeTab&&!i.isTabChanged&&(i.activeTab="datalist"),i.loadData(t),i.isTree()){if("datalist"===i.activeTab){var e=i.componentRef.instance;e.searchData.value&&i.items&&i.items.length&&i.items[0].children&&i.items[0].children.length&&e.toggleExpand(i.items[0],!0,!1)}i.showGetAllChildrenCheckbox()}i.isTextChange=!1,i._searchResult=null,i.closeLoading(),i.isReady=!0,i.changeDetector.detectChanges(),i.lookupinitializationSubject.next()})},error:function(e){i.closeLoading(),i._searchResult=null,i.isTextChange=!1,i.hasError=!0,i.changeDetector.detectChanges(),"string"==typeof e?i.messagerService.error(e):e&&(e.Message?i.messagerService.error(e.Message):e.error?i.messagerService.error(e.error.Message):i.messagerService.error("应用服务器错误,请联系系统管理员！"))}},t={pageInfo:{pageSize:this.pageSize||20,pageIndex:1}},n="all";if(this.isTextChange&&(this._searchState={field:"*",value:this.displayText},t={search:this._searchState},n="search"),!this.isTabChanged&&this.enableToSelect){var s=this.selectionMgr.getSelectedIds();s&&s.length?t.selectedInfo={selected:!0,selectedIds:s}:this.selectedIds&&(t.selectedInfo={selected:!0,selectedIds:this.selectedIds})}this.showLoading(),this.hasError=!1,this.httpMgr.lookupRequest(t,n).pipe(S.map(function(e){return e?e.selectedItems=e.selectedData||[]:e&&"object"==typeof e&&(e.selectedItems=[]),null!==e&&e})).subscribe(e)},Ie.prototype.loadData=function(e,t){if(void 0===t&&(t=!0),"datalist"===this.activeTab)switch(this.useFavorite&&!this.isTree()&&this.favHelper.updateFavoritesStatus(e.items),this.displayType){case w.NavList:case w.NavTreeList:case w.List:this.loadDataTableData(e),t&&this.dtEventMgr.bindDataTableEvent();break;case w.TreeList:this.loadTreeTableData(e,t)}else"favorite"===this.activeTab&&this.loadFavData(e);this.selectionMgr.selectCurrentValue()},Ie.prototype.loadFavData=function(e){var t=this;if(this.useFavorite){if(this.isTree()){this.setTreeInfo(e);var i=this.favHelper.initFavoriteTreeData(e.items),n=this.treeNodeHelper.flatTreeNodes(i).map(function(e){return e.data._addtional_=e.addtional,e.data});this.lookupSelectionSer.initFavoriteItems(n),setTimeout(function(){t.favoritesComponentRef.instance.scrollToY(1)})}else this.lookupSelectionSer.initFavoriteItems(e.items);this.favHelper.loadFavoritesData(e)}},Ie.prototype.loadDataTableData=function(e){e&&(this.gridOptions?(e&&e.columns&&e.columns.length&&(this.gridOptions.columns&&this.gridOptions.columns.length||(this.columns=e.columns)),this.items=e.items,this.total=e.total||e.items.length,e.searchFields&&(this.gridOptions.searchFields=this.getSearchColumns(e)),e.pageInfo?(!e.pageInfo.pageList||this.pageList&&this.pageList.length||(this.pageList=e.pageInfo.pageList),this.pagination=e.pageInfo.enablePager,this.pageIndex=e.pageInfo.pageIndex,this.pageSize=e.pageInfo.pageSize):this.pagination=!1):this.gridOptions=e),this.updateDataTable(this.gridOptions)},Ie.prototype.updateDataTable=function(e){if(e){var t=this.componentRef.instance;t.columns&&0!==t.columns.length||(t.columns=this.gridOptions.columns),t.allColumnsTitle=this.allColumnsTitle,t.searchFields=e.searchFields,t.pagination=e.pagination,t.pageList=this.pageList,t.remoteSort=this.remoteSort,this.loadDataWhenOpen&&(t.loadData({pageSize:e.pageSize,pageIndex:this.gridOptions.pageIndex,total:this.gridOptions.total,data:this.gridOptions.items}),t.cd.markForCheck()),this.loadSuccess.emit()}},Ie.prototype.setTreeInfo=function(e){if(e){var t=null;if(e.treeInfo){var i=e.treeInfo.onlySelectLeaf,n="no";i!==undefined&&(n=i?"yes":"no"),t=I({},e.treeInfo,{onlySelectLeaf:n})}if(this.gridOptions.treeInfo){var s=this.gridOptions.treeInfo;s&&(s.onlySelectLeaf!==undefined&&null!==s.onlySelectLeaf||(s.onlySelectLeaf="no"),"boolean"==typeof s.onlySelectLeaf&&(s.onlySelectLeaf=s.onlySelectLeaf?"yes":"no"),"default"===this.loadTreeDataType?s.loadDataType=t.loadDataType:s.loadDataType="loadall"===this.loadTreeDataType?"all":"async","default"!==s.onlySelectLeaf&&(t=Object.assign(t,s)))}this.treeInfo=t}},Ie.prototype.loadTreeTableData=function(e,t){var i=this;void 0===t&&(t=!0);var n=e?e.items:this.gridOptions.items;if(this.items=n,e){this.setTreeInfo(e);var s=this.gridOptions.treeInfo;s.treeDataIsInit||("pathcode"===s.layerType.toLowerCase()?this.items=this.lookupUtils.makeTree(this.items,s):this.items=this.lookupUtils.makeTreeWithParentID(this.items,"",s.dataField+"."+s.parentField,this.idField))}if(this.componentRef.instance instanceof l.TreeTableComponent){var a=this.componentRef.instance;this.treeInfo&&(a.loadDataType=this.treeInfo.loadDataType),this.columns&&this.columns.length||(a.columns=e.columns||[],this.gridOptions.columns=a.columns),t&&this.ttEventMgr.bindTreetableEvent();var o="default"===i.loadTreeDataType?"all"===a.loadDataType:"loadall"===i.loadTreeDataType;this.items=this.checkNodeCanBeSelect(this.items,o),a.keepSelect=!0,this.useFavorite&&this.favHelper.updateFavoritesStatus(this.items),this.loadDataWhenOpen&&a.loadData(this.items),a.resize()}},Ie.prototype.checkNodeCanBeSelect=function(e,t){var i=this;return void 0===t&&(t=!1),e&&e.length?e.map(function(e){return e.hasOwnProperty("addtional")&&(e.selectable=!e.addtional),e.children&&e.children.length?i.checkNodeCanBeSelect(e.children,t):!t||i._searchState&&i._searchState.value||(e.leaf=!0),e}):e},Ie.prototype.onChanges=function(e){e?(this.displayText=e,this.isTextChange=this.originalText!==this.displayText,this.nosearch&&(this.setModelValue(e),this.clearMappings.emit({instance:this,value:e})),this.onModelTouched(e),this.valueChanged.emit(e),this.textChanged.emit(e)):this.onClear()},Ie.prototype.onClear=function(e){if(void 0===e&&(e=!0),this.isTextChange=!1,this.displayText="",this.displayValue="",this.originalText="",this.extendInfo="",this.setModelValue(""),this.mappingFn)this.mappingFn(null,this.mapFields);else if(this.mapFields){var t=this.selectionMgr.getBindingData();t&&this.defaultMapping.lookupFieldMap(null,this.mapFields,t)}this.multiSelMgr.clear(),e&&this.clear.emit()},Ie.prototype.clearValue=function(e){void 0===e&&(e=!0),this.onClear(e)},Ie.prototype.selectItem=function(e){var t=this,i=null;if(e?i=e:(i=this.selections)?Array.isArray(i)&&!i.length&&(i=null):i=null,this.okHandler)this.okHandler({data:i,instance:this});else if(this.beforeSelectData){var n=this.beforeSelectData({instance:this,data:i});n&&n.subscribe?n.subscribe(function(e){t._beforeSelectDataCallBack(e,i)}):this.writeConsole("帮助数据选中前事件未返回值或返回类型非Observable, 请检查","error")}else this._beforeSelectDataCallBack(!0,i)},Ie.prototype.getParentPathCode=function(n){for(var e,t,i=this.treeInfo,s=i.dataField,a=i.pathField,o=i.layerField,r=(e=n,t=function(e){return e[s][o]},Math.max.apply(Math,x(e.map("function"==typeof t?t:function(e){return e[t]})))),l=function(t){var e=n.filter(function(e){return e[s][o]===t});e&&e.length&&e.length<n.length&&e.forEach(function(e){var t=e[s][a],i=n.filter(function(e){return e[s][a]!==t&&0===e[s][a].indexOf(t)});i&&i.length&&(n=n.filter(function(e){return e[s][a]!==t}))})},c=1;c<=r;c++)l(c);return n},Ie.prototype._beforeSelectDataCallBack=function(e,s){var a=this,t=e,i="";if("boolean"==typeof e?t=e:"object"==typeof e?(t=e.canSelect,i=e.message):t=!1,s||(i=this.mustChoosAdatarow,t=!1),t){var n=u.of(s);if(!this.singleSelect&&this.enableCascade&&this.isTree()&&"all"!==this.treeInfo.loadDataType&&"pathcode"===this.treeInfo.layerType&&this.isGetAllChidlNodes){var o=this.getParentPathCode(s);o&&o.length&&(o=o.map(function(e){return e[a.treeInfo.dataField][a.treeInfo.pathField]}),this.showLoading(),n=this.httpMgr.getData({parentsIds:o},"allChildren").pipe(S.map(function(e){var t=e.items?e.items.map(function(e){return e.data}):[],i=x(s,t),n=i.map(function(e){return e[a.idField]});return(n=Array.from(new Set(n))).map(function(t){return i.find(function(e){return e[a.idField]===t})})})))}n.subscribe(function(e){a.closeLoading(),a.updateControlValue(e),a.useTip&&e&&a.useTip&&a.personalConfigService.updateQueckSelected(e,a.localService.localeId)})}else i&&(this.notifyService?this.notifyService.warning(i):this.messagerService.warning(i,"",!0,function(){a.dialog.el.nativeElement.click()}))},Ie.prototype.updateControlValue=function(e){if(e){if(this.setDisplayText(e),this.mappingFn?this.mappingFn(e,this.mapFields,this.bindingData):this.mapFields&&this.bindingData&&this.defaultMapping.lookupFieldMap(e,this.mapFields,this.bindingData),this.setModelValue(this.displayText),this.inDatagrid&&e){var t=Array.isArray(e)?e:[e];this.updateBindData(t)}this.selectedData.emit(e),this.runDictPickedEvent(e),this.isTextChange=!1}else document.activeElement&&document.activeElement.blur(),this.messagerService.warning(this.mustChoosAdatarow)},Ie.prototype.updateBindData=function(n){var s=this;if(this.mapFields){var e=Object.keys(this.mapFields);if(this.ngControl&&this.ngControl.formDirective&&this.ngControl.formDirective.form&&this.ngControl.formDirective.form.bindingData){var a=this.ngControl.formDirective.form.bindingData;a&&e.forEach(function(i){s.mapFields[i].split(",").forEach(function(e){var t=n.map(function(e){return s.utils.getValue(i,e)}).join(s.multipleChoiceSeparator);s.utils.setValue(a,e,t)})})}}},Ie.prototype.getExtendInfoFields=function(e){var i=this;if(void 0===e&&(e=!0),!this.extInfoFields)return this.writeConsole("未设置扩展字段。"),[];var t=this.extInfoFields.split(",");return e?t.map(function(t){var e=Object.keys(i.mapFields).find(function(e){return i.mapFields[e]===t});return e||(i.writeConsole("在帮助映射字段中未找到"+t),"")}):t},Ie.prototype.onUpdateExtendInfo=function(){var e=this.selectionMgr.getBindingData();this.updateExtendInfo(e,!1)},Ie.prototype.updateExtendInfo=function(e,t){var i=this;if(void 0===t&&(t=!0),e)if(this.extInfoFormatter)if(Array.isArray(e)){var n=e.map(function(e){return i.getExtendInfoText(e)});this.extendInfo=n.join("，")}else this.extendInfo=this.getExtendInfoText(e);else{var s=this.getExtendInfoFields(t);s&&s.length&&(Array.isArray(e)?(n=e.map(function(e){return i.getExtendInfoText(e,s)}),this.extendInfo=n.join("，")):this.extendInfo=this.getExtendInfoText(e,s))}},Ie.prototype.getExtendInfoText=function(n,e){var s=this;if(void 0===e&&(e=null),"function"==typeof this.extInfoFormatter)return this.extInfoFormatter({bindingData:n,instance:this});var a=[];return e.map(function(e){var t,i=s.utils.getValue(e,n);return a.push(i),(t={})[e]=i,t}),a.join(" ")},Ie.prototype.getDisplayText=function(e){var n=this,s=this.displayFields?this.displayFields.split(","):[this.textField],t=e.map(function(t){var i=[];return s.forEach(function(e){i.push(n.utils.getValue(e,t))}),i.join(n.displayTextSeparator)});return this.gridOptions.singleSelect?t.join(""):this.displayFields?t.map(function(e){return"["+e+"]"}).join(","):t.join(",")},Ie.prototype.setDisplayText=function(e){var t=this;if(this.originalText=this.displayText,this.gridOptions.singleSelect){if(this.displayFormatter)if(this.displayText=this.utils.getValue(this.textField,e),this.isTree()){var i=this.componentRef.instance;this.displayText=this.displayFormatter(this.displayText,[e],{lookup:this,tree:i})}else this.displayText=this.displayFormatter(this.displayText,[e],{lookup:this,datatable:this.componentRef.instance});else this.displayText=this.getDisplayText([e]);this.displayValue=e[this.valueField]}else e.length&&(this.displayFormatter?(this.displayText=e.map(function(e){return t.utils.getValue(t.textField,e)}).join(this.multipleChoiceSeparator),this.isTree()?(i=this.componentRef.instance,this.displayText=this.displayFormatter(this.displayText,e,{lookup:this,tree:i})):this.displayText=this.displayFormatter(this.displayText,e,{lookup:this,datatable:this.componentRef.instance})):this.displayText=this.getDisplayText(e),this.displayValue=e.map(function(e){return t.utils.getValue(t.valueField,e)}).join(this.multipleChoiceSeparator));this.originalText=this.displayText},Ie.prototype.runDictPickedEvent=function(t){var i=this;this.dictPicked?(this.okButton&&(this.okButton.nativeElement.disabled=!0),this.dictPickedSubscription=this.dictPicked(t).subscribe(function(e){i.okButton&&(i.okButton.nativeElement.disabled=!1),"boolean"==typeof e?e&&i.closeDialog(t):"object"!=typeof e||e.closeDialog===undefined||e.closeDialog?i.closeDialog(t):e.message?i.messagerService.warning(e.message):i.closeDialog(t)})):this.closeDialog(t)},Ie.prototype.focusToInput=function(){var e=this;this.zone.runOutsideAngular(function(){setTimeout(function(){e.inputGroup&&e.inputGroup.textbox&&e.inputGroup.textbox.nativeElement.focus()})})},Ie.prototype.closeDialog=function(e){void 0===e&&(e=null),this.isShow=!1,this.dialog&&this.dialog.close(),e&&this.multiSelMgr.save(e),this.focusToInput()},Ie.prototype.cancelSelect=function(){this.closeDialog(),this.isTextChange=!1,this.nosearch||(this.displayText=this.originalText,this.setModelValue(this.displayText)),this.cancelHandler&&this.cancelHandler(this)},Ie.prototype.setModelValue=function(e){this.onModelChange&&(this.onModelChange(e),this.valueChanged.emit(e))},Ie.prototype.onTabChange=function(e){var t=this;this.activeTab=e.tabIndex,this.personalConf.tabIndex=this.activeTab;var i=this.isTabChanged;if(this.isTabChanged=!0,this.personalConfigService.updatePersonalConfig({tabIndex:e.tabIndex}),"datalist"===this.activeTab){if(this.isDoublleList()&&!this.leftComponentRef){if(!this.navigationOptions)return void this.initData();this.lookupCmpMgr.createLeftComponent(this.navigationOptions)}this.items&&this.items.length||this._searchState&&this._searchState.value?i||(this.isTree()?this.loadTreeTableData():(this.loadDataTableData(),this.dtEventMgr.bindDataTableEvent())):this.initData(),this.showGetAllChildrenCheckbox()}else"favorite"===this.activeTab&&(this.isTree()?this.initData():this.favoriteItems&&this.favoriteItems.length&&this.favoriteItems.length===this.favHelper.getFavoritIds().length?i||this.favHelper._loadFavoriteData(this.favoriteItems):this.initData());this.changeDetector.detectChanges(),setTimeout(function(){if(t.resizeCmp(),t.isTree()){var e=t.componentRef.instance.state.scrollY;t.componentRef.instance.scrollToY(e,0),t.enableCascade&&t.ttEventMgr.cascadeValueChanged(t.cascadeStatus)}t.selectionMgr.selectCurrentValue()})},Ie.prototype.registerMouseEventForTagView=function(){this.enableClear&&(this.tagbox.nativeElement.addEventListener("mouseenter",this.onTagboxMouseEnter.bind(this)),this.tagbox.nativeElement.addEventListener("mouseleave",this.onTagboxMouseLeave.bind(this)))},Ie.prototype.toggleClearIcon=function(e,t){void 0===t&&(t=!1);var i=t?"":"none",n=e.target.querySelector(".input-group-clear");n&&(n.style.display=i)},Ie.prototype.onTagboxMouseEnter=function(e){this.displayText&&this.enableClear&&(this.readonly||this.disabled||(this.showTagboxClearButton=!0)),this.showTagboxClearButton&&this.toggleClearIcon(e,!0)},Ie.prototype.onTagboxMouseLeave=function(e){this.toggleClearIcon(e)},Ie.prototype.onRemoveSelectItem=function(e,t){e.stopPropagation();var i=Array.from(this.displayTextList),n=this.displayTextList.indexOf(t);if(i.splice(n,1),this.displayText=i.join(this.multipleChoiceSeparator),this.originalText=this.displayText,this.setModelValue(this.displayText),this.displayValue){var s=this.displayValue.split(this.multipleChoiceSeparator);s.splice(n,1),this.displayValue=s.join(this.multipleChoiceSeparator)}this.mapFields&&this.updateOtherFieldDataWhenTagremoved(n),this.tagRemoved.emit({removedIndex:n,instance:this})},Ie.prototype.updateOtherFieldDataWhenTagremoved=function(s){var a=this,e=Object.keys(this.mapFields),t=e.indexOf(this.textField);if(this.ngControl&&this.ngControl.formDirective&&this.ngControl.formDirective.form&&this.ngControl.formDirective.form.bindingData){var o=this.ngControl.formDirective.form.bindingData;if(o.setValue){var i=this.ngControl.formDirective.form.bindingPath,r=[];i&&(r=i.split("/").filter(function(e){return""!==e})),e.forEach(function(e){a.mapFields[e].split(",").forEach(function(e){var t=r.concat(e.split(".")),i=o.getValue(t).split(a.multipleChoiceSeparator);i.splice(s,1);var n=i.join(a.multipleChoiceSeparator);o.setValue(r.concat(t),n,!0,!0)})})}}else this.bindingData&&(-1<t&&e.splice(t,1),e.forEach(function(e){a.mapFields[e].split(",").forEach(function(e){var t=a.utils.getValue(e,a.bindingData).split(a.multipleChoiceSeparator);t.splice(s,1);var i=t.join(a.multipleChoiceSeparator);a.utils.setValue(a.bindingData,e,i)})}))},Ie.prototype.onAllChildNodesClick=function(e){this.isGetAllChidlNodes=!this.isGetAllChidlNodes},Ie.decorators=[{type:y.Component,args:[{selector:"farris-lookup-grid",template:'\x3c!--\r\n * @Author: 疯狂秀才(Lucas Huang)\r\n * @Date: 2019-06-16 13:44:59\r\n * @LastEditors: 疯狂秀才(Lucas Huang)\r\n * @LastEditTime: 2019-11-18 08:47:32\r\n * @QQ: 1055818239\r\n * @Version: v0.0.1\r\n --\x3e\r\n\r\n <input-group #inputgroup\r\n    *ngIf="viewType === \'text\'"\r\n    [groupText]="groupIcon"\r\n    [lookup-tip]= "useTip"\r\n    [(ngModel)]="displayText"\r\n    [disabled]="disabled"\r\n    [readonly]="readonly"\r\n    [editable]="editable"\r\n    [customCls]="\'lookupbox\'"\r\n    [placeholder]="\'lookup.placeholder\' | locale: \'请选择\': placeholder"\r\n    [enableClear]="enableClear"\r\n    [useExtendInfo]="useExtendInfo"\r\n    [extendInfo]="extendInfo"\r\n    [maxLength]="maxLength"\r\n    (updateExtendInfo)="onUpdateExtendInfo()"\r\n    [textAlign]="textAlign"\r\n    [value]="displayText"\r\n    (valueChange)="onChanges($event)"\r\n    (clickHandle)="showDialog()"\r\n    (clear)="onClear()"\r\n    [quick-select]="quickSelect"\r\n></input-group>\r\n\r\n\x3c!--Tag style--\x3e\r\n<div #tagbox class="input-group" [class.f-state-disabled]="disabled" [class.f-state-readonly]="readonly" *ngIf="viewType === \'tag\'" [attr.title]="displayText">\r\n    <div class="form-control f-cmp-inputgroup--multi-wrapper multi-more" style="height: auto; min-height: 24px;">\r\n        <div class="multi--content">\r\n            <span class="multi--item" *ngFor="let txt of displayTextList; let index" title="" style="cursor: default;padding: 0 5px;\r\n            background: #ebf7fe;\r\n            border: 1px solid #cfedff;\r\n            position: relative;\r\n            padding-right: 20px;\r\n            margin-right: 3px;margin-top: 1px;height:18px">\r\n                {{txt}}\r\n                <i class="f-icon f-icon-close" *ngIf="!readonly && !disabled" style="cursor: pointer;position:absolute; right: 2px" (click)="onRemoveSelectItem($event, txt)"></i>\r\n            </span>\r\n        </div>\r\n        \x3c!-- <div class="multi--more" *ngIf="selections && selections.length">\r\n            <i class="f-icon multi--more-icon"></i><span class="multi--more-text">{{selections.length}}</span>\r\n        </div> --\x3e\r\n    </div>\r\n    <div class="input-group-append" style="position: relative;" title="" >\r\n        <span class="input-group-text input-group-clear" style="display: none; padding: 0px 4px;position: absolute;right: 22px;height: 100%;" (click)="onClear()">\r\n            <i class="f-icon modal_close"></i>\r\n        </span>\r\n        <span class="input-group-text" (click)="showDialog()">\r\n            <span class="f-icon f-icon-lookup"></span>\r\n        </span>\r\n    </div>\r\n</div>\r\n\r\n\r\n<farris-dialog\r\n    #dialog\r\n    *ngIf="isShow"\r\n    [draggable]="draggable"\r\n    [resizable]="resizable"\r\n    [title]="displayInfo.title"\r\n    [beforeOpen]="beforeOpen"\r\n    [beforeClose]="beforeClose"\r\n    [(width)]="dialogWidth"\r\n    [(height)]="dialogHeight"\r\n    [showButtons]="showButtons"\r\n    [showMaxButton]="showMaxButton"\r\n    [showCloseButton]="true"\r\n    [buttons]="buttonsRef || defaultButtonRef"\r\n    [buttonAlign]="buttonAlign"\r\n    [enableScroll]="false"\r\n    [dialogHeaderHeight]="50"\r\n    (maxed)="onMaxDialog($event)"\r\n    (resized)="onResized($event)"\r\n    (resizing)="onResizing($event)"\r\n\r\n>\r\n\r\n\r\n    <div [ngStyle]="containerStyle" style="height: 100%;"> \x3c!-- [style.height.px]="dialogContentHeight" --\x3e\r\n        <lookup-tabs (tabChange)="onTabChange($event)" [enableFav]="useFavorite" [activeTab]="activeTab"\r\n            [enableSelected]="showSelected && !singleSelect" [selectedTotal]="(currentSelectedItems | async)?.length">\r\n            <div datalist class="d-flex f-utils-absolute-all ">   \x3c!-- [style.height.px]="useFavorite ? dialogContentHeight - 40 : dialogContentHeight"--\x3e\r\n                <layout [direction]="\'h\'" [fill]="true" *ngIf="isDoublleList()">\r\n                    <layout-panel #leftPanel [width]="leftPanelWidth" region="west" [minWidth]="10" [showBorder]="false" >\r\n                        <ng-container #leftContainer></ng-container>\r\n                    </layout-panel>\r\n                    <layout-panel region="center" [showBorder]="false">\r\n                        <ng-container #centerContainer></ng-container>\r\n                    </layout-panel>\r\n                </layout>\r\n                \r\n                <ng-container *ngIf="!isDoublleList()" #contentContainer></ng-container>\r\n            </div>\r\n            <div favorites  class="d-flex f-utils-absolute-all " *ngIf="useFavorite" >  \x3c!--[style.height.px]="dialogContentHeight - 40" --\x3e\r\n                <ng-container #favoritesContainer></ng-container>\r\n            </div>\r\n            <div selected class="d-flex f-utils-absolute-all "  *ngIf="showSelected" > \x3c!--[style.height.px]="dialogContentHeight - 40" --\x3e\r\n                <farris-datatable #multiSelectDT\r\n                    [height]="gridOptions?.height"\r\n                    [pagination]="false" [fill]="true"\r\n                    [columns]="selectedColumns"\r\n                    [data]="currentSelectedItems | async"\r\n                    [remoteSort]="false"\r\n                    (cellClick)="multiSelMgr?.onSelectedTableCellClick($event)"\r\n                >\r\n                </farris-datatable>\r\n            </div>\r\n        </lookup-tabs>\r\n\r\n    </div>\r\n</farris-dialog>\r\n\r\n<ng-template #defaultButtonRef>\r\n    \r\n    <div class="flex-fill" style="text-align: left;" *ngIf="isReady && enableCascade && displayType===\'TREELIST\' && singleSelect === false">\r\n        <select class="form-control" style="width: auto; display: inline-block" (ngModelChange)="ttEventMgr?.cascadeValueChanged($event)" [ngModel]="cascadeStatus" name="cascadeStatus">\r\n            <option value="enable">{{ \'lookup.cascade.enable\' | locale: \'同步选择\' }}</option>\r\n            <option value="up">{{ \'lookup.cascade.up\' | locale: \'包含上级\' }}</option>\r\n            <option value="down">{{ \'lookup.cascade.down\' | locale: \'包含下级\' }}</option>\r\n            <option value="disable" >{{ \'lookup.cascade.disable\' | locale: \'仅选择自身\' }}</option>\r\n        </select>\r\n\r\n\r\n        <div class="custom-control custom-checkbox custom-control-inline ml-3" *ngIf="enableGetAllChildNodes">\r\n            <input class="custom-control-input" type="checkbox" id="farris-lookup_get-all-child-nodes">\r\n            <label class="custom-control-label btn-link" for="farris-lookup_get-all-child-nodes" style="padding-left: 18px;"\r\n                (click)="onAllChildNodesClick($event)">{{\'lookup.getAllChilds\'|locale: \'获取所有子级数据\'}}</label>\r\n        </div>\r\n\r\n\x3c!-- \r\n        <button class="btn btn-link" style="display: inline-block;margin-left: 10px;padding-left: 0;"\r\n            *ngIf="enableGetAllChildNodes" (click)="onAllChildNodesClick($event)">\r\n            <span class="f-icon f-icon-checkbox"[class.f-icon-checkbox-checked]="isGetAllChidlNodes"\r\n                style="margin-right: 5px; font-size: 14px;color: #0089FF;"></span>{{\'lookup.getAllChilds\'|locale: \'获取所有子级数据\'}}</button> --\x3e\r\n\r\n    </div>\r\n\r\n    <button type="button" class="btn btn-secondary btn-lg" (click)="cancelSelect()" [disabled]="!(isReady || hasError)" >\r\n        {{ \'lookup.cancelText\' | locale: \'取消\' }}\r\n    </button>\r\n    <button #okbtn type="button" [disabled]="!isReady"  class="btn btn-primary btn-lg" (click)="selectItem()" >\r\n        {{ \'lookup.okText\' | locale: \'确定\' }}\r\n    </button>\r\n   \r\n    \r\n</ng-template>\r\n',providers:[Se,t.ShortcutsService,B,q,G],encapsulation:y.ViewEncapsulation.None,exportAs:"lookup",styles:[".input-group{flex-wrap:nowrap}.ng-dirty.ng-invalid>input-group>.lookupbox{border-color:#ff0303}.lookup-clear{cursor:pointer;background:#fff!important}.lookup-clear:hover{background:#e9ecef!important}.f-lookup-favorite{cursor:pointer;color:#ff9800}.f-lookup-unfavorite{cursor:pointer;color:#dd2438}.lookup-tip{position:absolute;min-width:200px;max-height:400px;padding:.25rem 0;z-index:7777;background:#fff;box-shadow:0 2px 8px 0 rgba(0,0,0,.15);border-radius:2px}.lookup-tip .lookup-tip-header{font-weight:700;padding:.25rem .475rem;border-radius:0}.lookup-tip ul{display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column;padding-left:0;margin-bottom:0}.lookup-tip ul li{position:relative;display:block;width:100%;margin-bottom:-1px;padding:.25rem .875rem;color:rgba(0,0,0,.85);background-color:#fff;cursor:pointer}.lookup-tip ul li:hover{background-color:#e6f7ff}.f-lookup_quick-panel{height:100%;z-index:10001;position:absolute;overflow:auto;background:#fff;margin-top:.25rem;box-shadow:0 2px 8px 0 #dedede;border-radius:3px}.f-lookup_quick-panel .list{margin:0 6px}.f-lookup_quick-panel .list-group-item{height:30px;padding:0 8px;line-height:30px;border:0;margin-bottom:0}.f-lookup_quick-panel .more{height:50px;text-align:center;line-height:50px}.f-lookup_quick-panel .norecord{height:100%;-webkit-box-pack:center;justify-content:center;-webkit-box-align:center;align-items:center;display:-webkit-box;display:flex;font-size:16px;color:#bec6db}"]}]}],Ie.ctorParameters=function(){return[{type:y.Injector},{type:y.ComponentFactoryResolver},{type:y.ElementRef},{type:b.CommonUtils},{type:B},{type:y.ChangeDetectorRef},{type:t.ShortcutsService},{type:q},{type:y.NgZone},{type:y.Renderer2}]},Ie.propDecorators={customDisplayType:[{type:y.Input}],viewType:[{type:y.Input}],displayType:[{type:y.Input}],enableClear:[{type:y.Input}],remoteSort:[{type:y.Input}],condition:[{type:y.Input}],showCheckAll:[{type:y.Input}],singleSelect:[{type:y.Input}],multipleChoiceSeparator:[{type:y.Input}],idField:[{type:y.Input}],uri:[{type:y.Input}],beUri:[{type:y.Input}],showFilterBar:[{type:y.Input}],pagination:[{type:y.Input}],pageIndex:[{type:y.Input}],pageSize:[{type:y.Input}],pageList:[{type:y.Input}],total:[{type:y.Input}],columns:[{type:y.Input}],remoteSearch:[{type:y.Input}],searchOnServer:[{type:y.Input}],nosearch:[{type:y.Input}],clearMappings:[{type:y.Output}],maxLength:[{type:y.Input}],mappingFn:[{type:y.Input}],items:[{type:y.Input}],favoriteItems:[{type:y.Input}],customData:[{type:y.Input}],bindingData:[{type:y.Input}],treeInfo:[{type:y.Input}],enableCascade:[{type:y.Input}],cascadeStatus:[{type:y.Input}],placeholder:[{type:y.Input}],showSelected:[{type:y.Input}],useFavorite:[{type:y.Input}],favoriteDataFrom:[{type:y.Input}],useTip:[{type:y.Input}],isRecordSize:[{type:y.Input}],userId:[{type:y.Input}],enableToSelect:[{type:y.Input}],enableFindText:[{type:y.Input}],expandLevel:[{type:y.Input}],navTreeTableOptions:[{type:y.Input}],treeTableOptions:[{type:y.Input}],dataTableOptions:[{type:y.Input}],loadTreeDataType:[{type:y.Input}],loadDataWhenOpen:[{type:y.Input}],navSelectedIds:[{type:y.Input}],selectFirstInNav:[{type:y.Input}],enableFullTree:[{type:y.Input}],displayFormatter:[{type:y.Input}],displayFields:[{type:y.Input}],displayTextSeparator:[{type:y.Input}],helpId:[{type:y.Input}],textAlign:[{type:y.Input}],enableTitle:[{type:y.Input}],useExtendInfo:[{type:y.Input}],extInfoFields:[{type:y.Input}],extInfoFormatter:[{type:y.Input}],extendInfo:[{type:y.Input}],customFormatter:[{type:y.Input}],customNavFormatter:[{type:y.Input}],okHandler:[{type:y.Input}],cancelHandler:[{type:y.Input}],tagboxHeight:[{type:y.Input}],maxTagboxHeight:[{type:y.Input}],enableGetAllChildNodes:[{type:y.Input}],shortcutKey:[{type:y.Input}],quickSelect:[{type:y.Input}],beforeSelectData:[{type:y.Input}],selectedData:[{type:y.Output}],clear:[{type:y.Output}],search:[{type:y.Output}],valueChanged:[{type:y.Output}],loadSuccess:[{type:y.Output}],pagerChanged:[{type:y.Output}],expandTreeNode:[{type:y.Output}],textChanged:[{type:y.Output}],checkedChange:[{type:y.Output}],tagRemoved:[{type:y.Output}],gridOptions:[{type:y.Input}],contentContainer:[{type:y.ViewChild,args:["contentContainer",{read:y.ViewContainerRef}]}],favoritesContainer:[{type:y.ViewChild,args:["favoritesContainer",{read:y.ViewContainerRef}]}],leftContainer:[{type:y.ViewChild,args:["leftContainer",{read:y.ViewContainerRef}]}],centerContainer:[{type:y.ViewChild,args:["centerContainer",{read:y.ViewContainerRef}]}],multiSelectDT:[{type:y.ViewChild,args:["multiSelectDT"]}],inputGroup:[{type:y.ViewChild,args:["inputgroup"]}],leftPanel:[{type:y.ViewChild,args:["leftPanel"]}],tagbox:[{type:y.ViewChild,args:["tagbox"]}],okButton:[{type:y.ViewChild,args:["okbtn"]}]},Ie);function Ie(e,t,i,n,s,a,o,r,l,c){var p=Ce.call(this,e,i,a)||this;return p.injector=e,p.cfr=t,p.el=i,p.utils=n,p.defaultMapping=s,p.changeDetector=a,p.shortcuts=o,p.lookupUtils=r,p.zone=l,p.render2=c,p.groupIcon='<i class="f-icon f-icon-lookup"></i>',p._displayType="",p.customDisplayType=!1,p.viewType="text",p.enableClear=!0,p.remoteSort=!0,p.showCheckAll=!1,p.singleSelect=!0,p.multipleChoiceSeparator=",",p.beUri="",p.showFilterBar=!0,p.pagination=!0,p.pageIndex=1,p.pageSize=20,p.pageList=[10,20,30,50,100],p.total=0,p.columns=[],p.remoteSearch=!0,p.searchOnServer=!0,p.nosearch=!1,p.clearMappings=new y.EventEmitter,p.favoriteItems=[],p.enableCascade=!1,p.cascadeStatus="enable",p.placeholder="",p.showSelected=!1,p.useFavorite=!1,p.favoriteDataFrom="remote",p.useTip=!1,p.isRecordSize=!1,p.enableToSelect=!0,p.enableFindText=!1,p.expandLevel=-1,p.navTreeTableOptions={},p.treeTableOptions={},p.dataTableOptions={},p.defaultTreeTableOptions={maxLevel:9,enableContextMenu:!1,contextMenuItems:[]},p.loadTreeDataType="default",p.loadDataWhenOpen=!0,p.navSelectedIds="",p.selectFirstInNav=!1,p.enableFullTree=!0,p.displayFormatter=undefined,p.displayFields="",p.displayTextSeparator="_",p.helpId="",p.textAlign="left",p.enableTitle=!0,p.useExtendInfo=!1,p.extInfoFields="",p.extendInfo="",p.customFormatter=null,p.customNavFormatter=null,p.okHandler=null,p.cancelHandler=null,p.tagboxHeight="auto",p.enableGetAllChildNodes=!0,p.shortcutKey={open:"ArrowRight",confirm:"Enter",searchFocus:"F3",moveUp:"ArrowUp",moveDown:"ArrowDown",expand:"ArrowRight",collapse:"ArrowLeft",nextPager:"PageDown",prevPager:"PageUp"},p.quickSelect=null,p.selectedData=new y.EventEmitter,p.clear=new y.EventEmitter,p.search=new y.EventEmitter,p.valueChanged=new y.EventEmitter,p.loadSuccess=new y.EventEmitter,p.pagerChanged=new y.EventEmitter,p.expandTreeNode=new y.EventEmitter,p.textChanged=new y.EventEmitter,p.checkedChange=new y.EventEmitter,p.tagRemoved=new y.EventEmitter,p.containerMargin={top:0,bottom:5,left:10,right:10},p.containerStyle={marginLeft:p.containerMargin.left+"px",marginRight:p.containerMargin.right+"px",marginTop:p.containerMargin.top+"px",marginBottom:p.containerMargin.bottom+"px"},p._gridOptions=A,p.leftPanelWidth=320,p.navLookupDialogMinWidth=960,p.navigationFilter=null,p.subscriptions=[],p.isTextChange=!1,p.isTabChanged=!1,p.displayInfo=Object.assign({},j),p.tabChangeSubscription=null,p.personalConf={},p.favoriteColumns=[],p._searchState=null,p.allData=[],p.allColumnsTitle="所有列",p.mustWriteSomething="请输入关键字后查询。",p.mustChoosAdatarow="请选择一条记录！",p.addFavoriteSuccess="收藏成功。",p.delFavoriteSuccess="移除收藏成功。",p.searching=!1,p._searchResult=null,p.lookupinitializationSubject=new u.Subject,p.currentSelectedItems=u.of([]),p.selectedColumns=[],p.activeTab="datalist",p.favHelper=null,p.ttEventMgr=null,p.multiSelMgr=null,p.httpMgr=null,p.lookupCmpMgr=null,p.dialogMgr=null,p.selectionMgr=null,p.dtEventMgr=null,p.lookupSelectionSer=null,p.controlId="",p.savingFaoriteData=!1,p.isReady=!1,p.showTagboxClearButton=!1,p.hasError=!1,p.isGetAllChidlNodes=!1,p.selectedIds=[],p.lookupSearchInputEvent=null,p.farrisInstances=null,p._userSettings={},p._treeInfo_=null,p.dialogContentHeight=0,p.debugSer=null,p.createInstance(),p.currentSelectedItems=p.lookupSelectionSer.selected$,p.eventManager=p.injector.get(h.EventManager),p.farrisInstances=p.injector.get(b.FarrisComponentInstanceService,null),p.overLayService=new b.OverLayHiddenService,p.debugSer=p.injector.get(b.DebugService,null),p.debugSer&&p.debugSer.useDebugMode(),p}var Te=(xe.prototype.ngOnChanges=function(e){e.activeTab&&!e.activeTab.isFirstChange()&&this.initInkBarPos(e.activeTab.currentValue)},xe.prototype.ngAfterViewInit=function(){var e=this;setTimeout(function(){e.initInkBarPos(e.activeTab)},300)},xe.prototype.navClickHandle=function(e,t){e.stopPropagation(),this.activeTab=t,this.tabChange.emit({event:e,tabIndex:t}),this.initInkBarPos(t)},xe.prototype.initInkBarPos=function(e){if(this.enableFav||this.enableSelected){var t=this.dataListNavRef.nativeElement.offsetWidth,i=0;"datalist"!==e&&(i=this.dataListNavRef.nativeElement.offsetWidth),"favorite"===e?t=this.favoriteNavRef.nativeElement.offsetWidth:"selected"===e&&(this.favoriteNavRef&&(i+=this.favoriteNavRef.nativeElement.offsetWidth),this.selectedNavRef?t=this.selectedNavRef.nativeElement.offsetWidth:this.activeTab="datalist"),this.inkBarRef.nativeElement.style="width: "+t+"px; transform: translate3d("+i+"px, 0px, 0px);"}},xe.prototype.ngOnInit=function(){},xe.decorators=[{type:y.Component,args:[{selector:"lookup-tabs",template:'<div class="lookup-tabs-nav" *ngIf="enableFav || enableSelected">\r\n    <div class="nav-item" [class.nav-item-selected]="activeTab === \'datalist\'" (click)="navClickHandle($event, \'datalist\')" #dataListNav>{{ \'lookup.datalist\' | locale: \'数据列表\' }}</div>\r\n    <div class="nav-item" [class.nav-item-selected]="activeTab === \'favorite\'" *ngIf="enableFav" (click)="navClickHandle($event, \'favorite\')" #favoriteNav>{{ \'lookup.favorites\' | locale: \'收藏夹\' }}</div>\r\n    <div class="nav-item" [class.nav-item-selected]="activeTab === \'selected\'"  *ngIf="enableSelected" (click)="navClickHandle($event, \'selected\')" #selectedNav>{{ \'lookup.selected\' | locale: \'已选数据\' }}\r\n        <div class="lookup-selected-total" style="background: #0068f3;display: inline-block;\r\n        color: white;border-radius: 10px;padding: 0 5px; text-align: center;">\r\n        {{ selectedTotal }}\r\n        </div>\r\n    </div>\r\n    <div class="tabs-ink-bar tabs-ink-bar-animated" #inkBar></div>\r\n</div>\r\n<div class="lookup-tabs-content">\r\n    <div class="lookup-datalist" style="height:100%"  @flyInOut *ngIf="activeTab === \'datalist\'">\r\n        <div style="height: 100%">\r\n            <ng-content select="[datalist]"></ng-content>\r\n        </div>\r\n    </div>\r\n    <div class="lookup-favorites" style="height:100%; padding-top: 5px;" @flyInOut *ngIf="activeTab === \'favorite\'" >\r\n        <div style="height: 100%">\r\n            <ng-content select="[favorites]"></ng-content>\r\n        </div>\r\n    </div>\r\n    <div class="lookup-selected" style="height:100%; padding-top: 5px;" @flyInOut *ngIf="activeTab === \'selected\'">\r\n        <div  style="height: 100%">\r\n            <ng-content select="[selected]"></ng-content>\r\n        </div>\r\n    </div>\r\n</div>',animations:[p.trigger("flyInOut",[p.transition(":enter",[p.style({opacity:0}),p.animate(".3s",p.style({opacity:1}))]),p.transition(":leave",[p.animate(".3s",p.style({opacity:0}))])])],styles:[":host{display:-webkit-box;display:flex;height:100%;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column}:host .lookup-tabs-nav{position:relative;display:inline-block;box-sizing:border-box;margin:0;padding-left:0;list-style:none;-webkit-transition:-webkit-transform .3s cubic-bezier(.645,.045,.355,1);transition:transform .3s cubic-bezier(.645,.045,.355,1);transition:transform .3s cubic-bezier(.645,.045,.355,1),-webkit-transform .3s cubic-bezier(.645,.045,.355,1)}:host .lookup-tabs-nav .nav-item{position:relative;display:inline-block;text-decoration:none;box-sizing:border-box;padding:.625rem .8125rem;color:inherit;cursor:pointer}:host .lookup-tabs-nav .nav-item-selected{color:#1890ff}:host .lookup-tabs-nav .tabs-ink-bar{position:absolute;bottom:1px;left:0;z-index:1;box-sizing:border-box;height:2px;background-color:#1890ff;-webkit-transform-origin:0 0;transform-origin:0 0}:host .lookup-tabs-nav .tabs-ink-bar-animated{-webkit-transition:width .3s cubic-bezier(.645,.045,.355,1),left .3s cubic-bezier(.71,.03,.35,1),-webkit-transform .3s cubic-bezier(.645,.045,.355,1);transition:transform .3s cubic-bezier(.645,.045,.355,1),width .3s cubic-bezier(.645,.045,.355,1),left .3s cubic-bezier(.71,.03,.35,1),-webkit-transform .3s cubic-bezier(.645,.045,.355,1)}:host .lookup-tabs-content{-webkit-box-flex:1;flex:1;border-top:1px solid #cecece;position:relative;top:-2px}"]}]}],xe.ctorParameters=function(){return[{type:y.Injector}]},xe.propDecorators={enableFav:[{type:y.Input}],enableSelected:[{type:y.Input}],selectedTotal:[{type:y.Input}],activeTab:[{type:y.Input}],tabChange:[{type:y.Output}],inkBarRef:[{type:y.ViewChild,args:["inkBar"]}],dataListNavRef:[{type:y.ViewChild,args:["dataListNav"]}],favoriteNavRef:[{type:y.ViewChild,args:["favoriteNav"]}],selectedNavRef:[{type:y.ViewChild,args:["selectedNav"]}]},xe);function xe(e){this.injector=e,this.enableFav=!1,this.enableSelected=!1,this.selectedTotal=0,this.activeTab="datalist",this.tabChange=new y.EventEmitter,this.render=null,this.el=null,this.personalConfigService=this.injector.get(G,null),this.render=this.injector.get(y.Renderer2),this.el=this.injector.get(y.ElementRef)}var De=(we.prototype.ngOnInit=function(){var t=this;this.tipText=this.localService.getValue("lookup.tipText"),this.enableTip=!1,this.enableTip&&(this.inputRef.iconMouseEnter.subscribe(function(e){t.creatPanel()}),this.inputRef.iconMouseLeave.pipe(S.delay(200)).subscribe(function(e){t.isInTipPanel||t.removePanel()}),this.inputRef.clickHandle.subscribe(function(e){t.removePanel()}))},we.prototype.ngAfterViewInit=function(){},we.prototype.getQuickSelectedByLocaleId=function(){var e=this.localService.localeId,t=this.personalConfigService.getPersonalData();if(t&&t.quickSelected){var i=t.quickSelected[e];if(i&&i.length)return i}return null},we.prototype.creatPanel=function(){var n=this;if(this.selected=this.getQuickSelectedByLocaleId(),!(this.tipPanel||!this.selected||this.selected&&0===this.selected.length)){var e=this.setPosition(),s=this.renderer.createElement("ul");this.personalConfigService.textField.split("."),this.selected.forEach(function(e,t){var i=n.renderer.createElement("li");i.innerHTML=n.find(e,n.personalConfigService.textField),n.renderer.setProperty(i,"id",t),n.renderer.appendChild(s,i)});var t=this.renderer.createElement("div");this.renderer.addClass(t,"lookup-tip-header"),t.innerHTML=this.tipText,this.tipPanel=this.renderer.createElement("div"),this.renderer.appendChild(this.tipPanel,t),this.renderer.appendChild(this.tipPanel,s),this.renderer.addClass(this.tipPanel,"lookup-tip"),this.renderer.setStyle(this.tipPanel,"top",e.top),this.renderer.setStyle(this.tipPanel,"left",e.left),this.renderer.setStyle(this.tipPanel,"width",e.width),this.renderer.appendChild(document.body,this.tipPanel),this.leaveEvent=this.renderer.listen(this.tipPanel,"mouseleave",function(){n.removePanel()}),this.enterEvent=this.renderer.listen(this.tipPanel,"mouseenter",function(){n.isInTipPanel=!0}),this.clickEvent=this.renderer.listen(this.tipPanel,"click",function(e){"LI"===e.target.nodeName&&n.selectItem(e.target.id)})}},we.prototype.removePanel=function(){document.body.contains(this.tipPanel)&&(this.renderer.removeChild(document.body,this.tipPanel),this.tipPanel=null,this.isInTipPanel=!1,this.leaveEvent(),this.enterEvent(),this.clickEvent())},we.prototype.setPosition=function(){var e=this.inputRef.inputGroup.nativeElement.getBoundingClientRect(),t=e.left,i=e.top,n=e.width;return{left:t+"px",top:i+e.height+"px",width:n+"px"}},we.prototype.selectItem=function(i){var e=this.selected.find(function(e,t){return Number(i)===t});this.removePanel(),this.personalConfigService.singleSelect?this.personalConfigService.selectItemObser$.next(e):this.personalConfigService.selectItemObser$.next([e])},we.prototype.find=function(e,t){var i=t.split("."),n=e[i[0]];return n instanceof Object?(i.shift(),this.find(n,i.join("."))):n},we.decorators=[{type:y.Directive,args:[{selector:"[lookup-tip]"}]}],we.ctorParameters=function(){return[{type:C.InputGroupComponent},{type:y.Renderer2},{type:y.Injector}]},we.propDecorators={enableTip:[{type:y.Input,args:["lookup-tip"]}]},we);function we(e,t,i){this.inputRef=e,this.renderer=t,this.injector=i,this.enableTip=!1,this.isInTipPanel=!1,this.tipText="您要找的是不是这些？",this.personalConfigService=this.injector.get(G,null),this.localService=this.injector.get(g.LocaleService)}var Fe=(Oe.prototype.onClick=function(e){e.stopPropagation()},Oe.prototype.ngOnInit=function(){},Oe.prototype.loadData=function(e){this.data=e,this.cdr.destroyed||this.cdr.detectChanges()},Oe.prototype.onMoreClick=function(e){e.stopPropagation(),this.moreClcik.emit(e)},Oe.prototype.formatData=function(e){return this.formatter(e)},Oe.prototype.onItemClick=function(e,t){this.itemClick.emit({data:t,evnet:e})},Oe.prototype.setActiveItem=function(e){this.activeIndex=e,this.cdr.destroyed||this.cdr.detectChanges()},Oe.decorators=[{type:y.Component,args:[{selector:"lookup-quick-select-panel",template:'<div class="d-flex flex-column" style="width: 100%;height: 100%;padding-top: 5px">\r\n    \x3c!-- <div class="header"></div> --\x3e\r\n    <div class="list f-utils-fill f-datalist" style="overflow: auto;">\r\n        <ul class="list-group list-group-flush p-0"  [class.h-100]="!data || !data.length">\r\n            <li class="list-group-item list-group-item-action" [class.active]="activeIndex === i" *ngFor="let item of data; index as i" (click)="onItemClick($event, item)">\r\n                <span *ngIf="!formatter">{{ item[textField] }}</span> \r\n                <span *ngIf="formatter" [innerHTML]="formatData(item) | safe:\'html\'"></span>\r\n            </li>\r\n\r\n            <li class="norecord" *ngIf="!data || !data.length">\r\n                未找到搜索内容\r\n            </li>\r\n        </ul>\r\n    </div>\r\n    <div class="more" *ngIf="showMore && data && data.length">\r\n        <button class="btn btn-link" (click)="onMoreClick($event)">显示更多</button>\r\n    </div>\r\n     \x3c!-- <div class="footer"></div> --\x3e\r\n</div>'}]}],Oe.ctorParameters=function(){return[{type:y.Injector},{type:y.ChangeDetectorRef}]},Oe.propDecorators={showMore:[{type:y.Input}],data:[{type:y.Input}],textField:[{type:y.Input}],formatter:[{type:y.Input}],moreClcik:[{type:y.Output}],itemClick:[{type:y.Output}],onClick:[{type:y.HostListener,args:["mousedown",["$event"]]}]},Oe);function Oe(e,t){this.injector=e,this.cdr=t,this.showMore=!0,this.data=[],this.textField="",this.moreClcik=new y.EventEmitter,this.itemClick=new y.EventEmitter,this.activeIndex=-1}var Re=(Ee.prototype.ngOnInit=function(){},Ee.prototype.ngAfterViewInit=function(){var a=this;this.options&&this.options.enable&&(this.inputRef.inputClick.subscribe(function(e){e.stopPropagation(),a.panelElement||a.lookupRef.dictPicking({instance:a}).subscribe(function(e){if(a.lookupRef.displayType!==w.TreeList&&a.lookupRef.singleSelect){var t=a.lookupRef.dialogMgr.checkDictPickingResult(e),i=t.show,n=t.customData,s=t.message;a.lookupRef.customData=n,i?a.createDataPanel():s&&a.lookupRef.notifyService.warning(s)}})}),this.inputRef.valueChange.pipe(S.debounceTime(200)).subscribe(function(e){a.lookupRef.dictPicking({instance:a}).subscribe(function(e){if(a.lookupRef.displayType!==w.TreeList&&a.lookupRef.singleSelect){var t=a.lookupRef.dialogMgr.checkDictPickingResult(e),i=(t.show,t.customData);t.message,a.lookupRef.customData=i,a.panelElement?a.loadData():a.createDataPanel()}})}),this.inputRef.keydownHandle.pipe(S.filter(function(e){return"Escape"===e.key||"Tab"===e.key||"ArrowRight"===e.key||"F2"===e.key})).subscribe(function(){a.hide()}))},Ee.prototype.ngOnDestroy=function(){this.lookupRef.overLayService.destory(this.lookupRef.el.nativeElement)},Ee.prototype.removePanelElement=function(){document.body.removeChild(this.panelElement),this.panelElement=null},Ee.prototype.hide=function(e){var t=this;b.reqAnimFrame(function(){t.panelElement&&(!e||"mousewheel"!==e.type&&"wheel"!==e.type?(t.panelElement.classList.remove("f-area-show"),setTimeout(function(){t.removePanelElement()},120)):t.removePanelElement(),t.lookupRef.overLayService.destory(t.lookupRef.el.nativeElement))})},Ee.prototype.createDataPanel=function(){var i=this;this.panelElement=document.createElement("div"),this.panelElement.classList.add("overlay-pane","f-lookup_quick-panel","f-area-hide"),document.body.appendChild(this.panelElement);var e=this.getPanelSize(),t=e.width,n=e.left,s=e.top,a=e.height;this.panelElement.style.width=t+"px",this.panelElement.style.height=a+"px",this.panelElement.style.top=s+"px",this.panelElement.style.left=n+"px",this.panelElement.style.zIndex="10001";var o=this.cfr.resolveComponentFactory(Fe);this.cmpRef=o.create(this.injector),this.cmpRef.instance.showMore=this.options.showMore,this.cmpRef.instance.textField=this.lookupRef.textField,this.cmpRef.instance.formatter=this.options.formatter,this.panelElement.appendChild(this.cmpRef.location.nativeElement),this.cmpRef.changeDetectorRef.detectChanges(),this.cmpRef.instance.moreClcik.subscribe(function(e){i.hide(e),i.lookupRef.showDialog()}),this.cmpRef.instance.itemClick.subscribe(function(e){var t=e.data;i.lookupRef.selectItem(t),i.hide()}),this.lookupRef.overLayService.registerMouseEvent(this.lookupRef.el.nativeElement,function(e){if(i.panelElement&&!e.target.closest(".f-lookup_quick-panel"))return i.cmpRef&&(i.cmpRef.destroy(),i.cmpRef=null),i.hide(e),i.lookupRef.inputGroup.textbox.nativeElement!==e.target&&void 0}),this.panelElement.classList.add("f-area-show"),this.loadData()},Ee.prototype.calculationPanelHeight=function(){return 30*this.options.showItemsCount+(this.options.showMore?50:0)+this.options.footerHeight+5},Ee.prototype.getInputSizeInfo=function(){return("text"===this.lookupRef.viewType?this.inputRef.inputGroup:this.lookupRef.tagbox).nativeElement.getBoundingClientRect()},Ee.prototype.getPanelSize=function(){var e=this.getInputSizeInfo(),t=e.width,i=e.height,n=e.top,s=e.left,a=window.innerHeight-i-n,o=this.calculationPanelHeight(),r=a<n?n:a;return o<a?(n+=i,this.panelElement.style.transformOrigin="100% top"):a<n?(n=r<o?(o=r-10,10):n-parseInt(""+o,10)-5,this.panelElement.style.transformOrigin="100% bottom"):(r<o&&(o=r-10),n+=i),{width:t,top:n,height:o,left:s}},Ee.prototype.getData=function(){var t=this,e={pageInfo:{pageSize:this.options.showItemsCount,pageIndex:1}},i="all";return this.lookupRef.isTextChange&&(this.lookupRef._searchState={field:this.lookupRef.textField,value:this.lookupRef.displayText},e={search:this.lookupRef._searchState},i="search"),this.lookupRef.httpMgr.lookupRequest(e,i).pipe(S.map(function(e){return e?e.items||[]:t.lookupRef.displayText&&t.lookupRef.isTextChange?t.lookupRef.items.filter(function(e){return-1<e[t.lookupRef.textField].indexOf(t.lookupRef.displayText)}).slice(0,t.options.showItemsCount):t.lookupRef.items.slice(0,t.options.showItemsCount)}))},Ee.prototype.loadData=function(){var t=this,i=this.lookupRef.loadingService.show({container:this.panelElement});this.getData().subscribe(function(e){t.cmpRef.instance.loadData(e),i.close()})},Ee.prototype.registerKeyboardEvent=function(e){var t=this;if(this.lookupRef.singleSelect){var i=[];if(this.cmpRef&&(i=this.cmpRef.instance.data),i&&i.length){"ArrowUp"!==e.code&&"ArrowDown"!==e.code||(e.preventDefault(),e.stopPropagation());var n=this.cmpRef.instance.activeIndex,s=function(e){t.cmpRef.instance.setActiveItem(e)};if("ArrowUp"===e.code)if(-1<n){var a=n-1;a<0&&(a=i.length-1),s(a)}else s(i.length-1);if("ArrowDown"===e.code){var o=n+1;o>=i.length&&(o=0),s(o)}if("Enter"===e.key&&i&&i.length){var r=i[n];this.lookupRef.selectItem(r),this.hide()}}}},Ee.decorators=[{type:y.Directive,args:[{selector:"[quick-select]"}]}],Ee.ctorParameters=function(){return[{type:y.Injector},{type:y.NgZone},{type:y.Renderer2},{type:C.InputGroupComponent},{type:ke},{type:y.ComponentFactoryResolver}]},Ee.propDecorators={options:[{type:y.Input,args:["quick-select"]}],registerKeyboardEvent:[{type:y.HostListener,args:["keydown",["$event"]]}]},Ee);function Ee(e,t,i,n,s,a){this.injector=e,this.ngzone=t,this.render=i,this.inputRef=n,this.lookupRef=s,this.cfr=a}var Le=(Me.decorators=[{type:y.NgModule,args:[{imports:[i.CommonModule,n.FormsModule,b.FarrisCommonModule.forRoot(),a.FarrisDialogModule.forRoot(),o.MessagerModule.forRoot(),v.NotifyModule.forRoot(),c.LoadingModule.forRoot({delay:1e3}),C.InputGroupModule,s.LayoutModule,r.DataTableModule,l.TreeTableModule,m.FarrisContextMenuModule,g.LocaleModule.forRoot()],exports:[ke,z],declarations:[ke,z,de,Te,De,Fe,Re],providers:[],entryComponents:[r.DataTableComponent,l.TreeTableComponent,de,Te,Fe]}]}],Me);function Me(){}e.LookupUtils=q,e.LookupDefaultMapping=B,e.LookupLeftComponent=de,e.LOOKUPGRID_VALUE_ACCESSOR=Se,e.LookupGridComponent=ke,e.DisplayInfo=V,e.lookupGridDefaults=A,e.displayInfoDefault=j,e.LOOKUPINPUT_VALUE_ACCESSOR=N,e.LookupComponent=z,e.ServerSideToken=H,e.LookupModule=Le,e.PersonalConfigService=G,e.LookupTabsComponent=Te,e.LookupTipDirective=De,e.LookupQuickSelectDirective=Re,e.LookupQuickSelectPanelComponent=Fe,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=farris-ui-lookup.umd.min.js.map