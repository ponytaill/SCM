import { Injectable } from '@angular/core';
import { FrameContext } from '@farris/devkit';
import { of } from 'rxjs';
import { tap, delay } from 'rxjs/operators';
/**
 * 结束表单编辑状态服务
 */
class EndEditService {
    constructor(frameContext) {
        this.frameContext = frameContext;
    }
    /**
     * 结束编辑
     */
    endEdit() {
        const appContext = this.frameContext && this.frameContext.getFormAppContext();
        return of(null).pipe(tap(() => {
            if (appContext) {
                appContext.messagePipe.next({ type: 'endEdit' });
            }
        }), 
        // todo: 不应该使用delay，应该串流
        delay(5));
    }
}
EndEditService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
EndEditService.ctorParameters = () => [
    { type: FrameContext }
];
export { EndEditService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW5kLWVkaXQuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvY29tbWFuZC1zZXJ2aWNlcy8iLCJzb3VyY2VzIjpbImxpYi9lbmQtZWRpdC5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFjLFlBQVksRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzFELE9BQU8sRUFBRSxFQUFFLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDMUIsT0FBTyxFQUFhLEdBQUcsRUFBRSxLQUFLLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUV2RDs7R0FFRztBQUNILE1BQ00sY0FBYztJQUNsQixZQUFvQixZQUEwQjtRQUExQixpQkFBWSxHQUFaLFlBQVksQ0FBYztJQUM5QyxDQUFDO0lBQ0Q7O09BRUc7SUFDSSxPQUFPO1FBQ1osTUFBTSxVQUFVLEdBQWUsSUFBSSxDQUFDLFlBQVksSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDLGlCQUFpQixFQUFFLENBQUM7UUFDMUYsT0FBTyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUNsQixHQUFHLENBQUMsR0FBRyxFQUFFO1lBQ1AsSUFBSSxVQUFVLEVBQUU7Z0JBQ2QsVUFBVSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLENBQUMsQ0FBQzthQUNsRDtRQUNILENBQUMsQ0FBQztRQUNGLHdCQUF3QjtRQUN4QixLQUFLLENBQUMsQ0FBQyxDQUFDLENBQ1QsQ0FBQztJQUNKLENBQUM7OztZQWxCRixVQUFVOzs7O1lBUFUsWUFBWTs7QUEyQmpDLE9BQU8sRUFBRSxjQUFjLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgQXBwQ29udGV4dCwgRnJhbWVDb250ZXh0IH0gZnJvbSAnQGZhcnJpcy9kZXZraXQnO1xyXG5pbXBvcnQgeyBvZiB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBjb25jYXRNYXAsIHRhcCwgZGVsYXkgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcblxyXG4vKipcclxuICog57uT5p2f6KGo5Y2V57yW6L6R54q25oCB5pyN5YqhXHJcbiAqL1xyXG5ASW5qZWN0YWJsZSgpXHJcbmNsYXNzIEVuZEVkaXRTZXJ2aWNlIHtcclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGZyYW1lQ29udGV4dDogRnJhbWVDb250ZXh0KSB7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOe7k+adn+e8lui+kVxyXG4gICAqL1xyXG4gIHB1YmxpYyBlbmRFZGl0KCkge1xyXG4gICAgY29uc3QgYXBwQ29udGV4dDogQXBwQ29udGV4dCA9IHRoaXMuZnJhbWVDb250ZXh0ICYmIHRoaXMuZnJhbWVDb250ZXh0LmdldEZvcm1BcHBDb250ZXh0KCk7XHJcbiAgICByZXR1cm4gb2YobnVsbCkucGlwZShcclxuICAgICAgdGFwKCgpID0+IHtcclxuICAgICAgICBpZiAoYXBwQ29udGV4dCkge1xyXG4gICAgICAgICAgYXBwQ29udGV4dC5tZXNzYWdlUGlwZS5uZXh0KHsgdHlwZTogJ2VuZEVkaXQnIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfSksXHJcbiAgICAgIC8vIHRvZG86IOS4jeW6lOivpeS9v+eUqGRlbGF577yM5bqU6K+l5Liy5rWBXHJcbiAgICAgIGRlbGF5KDUpXHJcbiAgICApO1xyXG4gIH1cclxufVxyXG5leHBvcnQgeyBFbmRFZGl0U2VydmljZSB9O1xyXG4iXX0=