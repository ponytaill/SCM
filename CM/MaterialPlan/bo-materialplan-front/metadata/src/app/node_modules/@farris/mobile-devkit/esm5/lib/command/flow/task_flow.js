/*
 * @Author: Witt
 * @Date: 2018-10-17 14:13:40
 * @Last Modified by: Witt
 * @Last Modified time: 2018-10-17 16:08:34
 */
import { TaskNode } from './task_node';
import { TaskLink } from './task_link';
/**
 * 任务执行流程
 */
var TaskFlow = /** @class */ (function () {
    function TaskFlow() {
        /**
         * 节点集合
         */
        this.nodes = [];
        /**
         * 边集合
         */
        this.links = [];
        // #endregion
    }
    // #region 节点操作
    /**
     * 添加节点
     */
    TaskFlow.prototype.addNode = function (name, func) {
        var node = new TaskNode(name, func);
        this.nodes.push(node);
    };
    /**
     * 批量添加链接
     */
    TaskFlow.prototype.addNodes = function (nodes) {
        this.nodes = this.nodes.concat(nodes);
    };
    /**
     * 在目标节点之前插入一个节点
     * @param target 目标节点名称
     * @param name 名称
     * @param func 函数
     */
    TaskFlow.prototype.insertNode = function (target, name, func) {
        var index = this.findNodeIndex(target);
        var node = this.createNode(name, func);
        this.nodes.splice(index, 0, node);
    };
    /**
     * 在目标节点之前插入一个节点
     */
    TaskFlow.prototype.appendNode = function (target, name, func) {
        var index = this.findNodeIndex(target) + 1;
        var node = this.createNode(name, func);
        this.nodes.splice(index, 0, node);
    };
    /**
     * 获取节点索引
     * @param name 名称
     */
    TaskFlow.prototype.findNodeIndex = function (name) {
        return this.nodes.findIndex(function (node) {
            return node.name === name;
        });
    };
    /**
     * 创建任务节点
     * @param name 名称
     * @param func 函数
     */
    TaskFlow.prototype.createNode = function (name, func) {
        var node = new TaskNode(name, func);
        return node;
    };
    // #endregion
    // #region 链接操作
    /**
     * 添加链接
     * @param name 名称
     * @param func 函数
     */
    TaskFlow.prototype.addLink = function (from, to, condition) {
        var link = this.createLink(from, to, condition);
        this.links.push(link);
    };
    /**
     * 批量添加链接
     */
    TaskFlow.prototype.addLinks = function (links) {
        this.links = this.links.concat(links);
    };
    /**
     * 创建链接
     */
    TaskFlow.prototype.createLink = function (from, to, condition) {
        var link = new TaskLink(from, to, condition);
        return link;
    };
    // #endregion
    // #region 流程控制
    /**
     * 获取下一个节点
     * @param from    源节点名称
     * @param context 上下文
     */
    TaskFlow.prototype.getNext = function (from, context) {
        if (!from) {
            return this.nodes.shift();
        }
        // 符合满足条件的边
        var nextLink = this.links.find(function (link) {
            return link.from === from && link.canLink(context);
        });
        if (!nextLink) {
            return;
        }
        return this.nodes.find(function (node) {
            return node.name === nextLink.to;
        });
    };
    // #endregion
    // #region 其他方法
    /**
     * 克隆任务流
     */
    TaskFlow.prototype.clone = function () {
        var taskFlow = new TaskFlow();
        taskFlow.addNodes(this.nodes);
        taskFlow.addLinks(this.links);
        return taskFlow;
    };
    return TaskFlow;
}());
export { TaskFlow };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFza19mbG93LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9tb2JpbGUtZGV2a2l0LyIsInNvdXJjZXMiOlsibGliL2NvbW1hbmQvZmxvdy90YXNrX2Zsb3cudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7O0dBS0c7QUFFSCxPQUFPLEVBQVksUUFBUSxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBQ2pELE9BQU8sRUFBWSxRQUFRLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFHakQ7O0dBRUc7QUFDSDtJQUFBO1FBRUU7O1dBRUc7UUFDSyxVQUFLLEdBQWUsRUFBRSxDQUFDO1FBRS9COztXQUVHO1FBQ0ssVUFBSyxHQUFlLEVBQUUsQ0FBQztRQXFJL0IsYUFBYTtJQUNmLENBQUM7SUFuSUMsZUFBZTtJQUVmOztPQUVHO0lBQ0ksMEJBQU8sR0FBZCxVQUFlLElBQVksRUFBRSxJQUFjO1FBQ3pDLElBQU0sSUFBSSxHQUFHLElBQUksUUFBUSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztRQUN0QyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUN4QixDQUFDO0lBR0Q7O09BRUc7SUFDSSwyQkFBUSxHQUFmLFVBQWdCLEtBQWlCO1FBQy9CLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDeEMsQ0FBQztJQUVEOzs7OztPQUtHO0lBQ0ksNkJBQVUsR0FBakIsVUFBa0IsTUFBYyxFQUFFLElBQVksRUFBRSxJQUFjO1FBQzVELElBQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDekMsSUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDekMsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQztJQUNwQyxDQUFDO0lBRUQ7O09BRUc7SUFDSSw2QkFBVSxHQUFqQixVQUFrQixNQUFjLEVBQUUsSUFBWSxFQUFFLElBQWM7UUFDNUQsSUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDN0MsSUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDekMsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQztJQUNwQyxDQUFDO0lBRUQ7OztPQUdHO0lBQ0ssZ0NBQWEsR0FBckIsVUFBc0IsSUFBWTtRQUNoQyxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLFVBQUMsSUFBYztZQUN6QyxPQUFPLElBQUksQ0FBQyxJQUFJLEtBQUssSUFBSSxDQUFDO1FBQzVCLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVEOzs7O09BSUc7SUFDSyw2QkFBVSxHQUFsQixVQUFtQixJQUFZLEVBQUUsSUFBYztRQUM3QyxJQUFNLElBQUksR0FBRyxJQUFJLFFBQVEsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDdEMsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBRUQsYUFBYTtJQUdiLGVBQWU7SUFFZjs7OztPQUlHO0lBQ0ksMEJBQU8sR0FBZCxVQUFlLElBQVksRUFBRSxFQUFVLEVBQUUsU0FBMkI7UUFDbEUsSUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLEVBQUUsRUFBRSxFQUFFLFNBQVMsQ0FBQyxDQUFDO1FBQ2xELElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3hCLENBQUM7SUFFRDs7T0FFRztJQUNJLDJCQUFRLEdBQWYsVUFBZ0IsS0FBaUI7UUFDL0IsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUN4QyxDQUFDO0lBRUQ7O09BRUc7SUFDSyw2QkFBVSxHQUFsQixVQUFtQixJQUFZLEVBQUUsRUFBVSxFQUFFLFNBQTJCO1FBQ3RFLElBQU0sSUFBSSxHQUFHLElBQUksUUFBUSxDQUFDLElBQUksRUFBRSxFQUFFLEVBQUUsU0FBUyxDQUFDLENBQUM7UUFDL0MsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBRUQsYUFBYTtJQUdiLGVBQWU7SUFDZjs7OztPQUlHO0lBQ0gsMEJBQU8sR0FBUCxVQUFRLElBQWEsRUFBRSxPQUF3QjtRQUM3QyxJQUFJLENBQUMsSUFBSSxFQUFFO1lBQ1QsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssRUFBRSxDQUFDO1NBQzNCO1FBRUQsV0FBVztRQUNYLElBQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFVBQUMsSUFBYztZQUM5QyxPQUFPLElBQUksQ0FBQyxJQUFJLEtBQUssSUFBSSxJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDckQsQ0FBQyxDQUFDLENBQUM7UUFDSCxJQUFJLENBQUMsUUFBUSxFQUFFO1lBQ2IsT0FBTztTQUNSO1FBRUQsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxVQUFDLElBQWM7WUFDcEMsT0FBTyxJQUFJLENBQUMsSUFBSSxLQUFLLFFBQVEsQ0FBQyxFQUFFLENBQUM7UUFDbkMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsYUFBYTtJQUViLGVBQWU7SUFFZjs7T0FFRztJQUNILHdCQUFLLEdBQUw7UUFDRSxJQUFNLFFBQVEsR0FBRyxJQUFJLFFBQVEsRUFBRSxDQUFDO1FBQ2hDLFFBQVEsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzlCLFFBQVEsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzlCLE9BQU8sUUFBUSxDQUFDO0lBQ2xCLENBQUM7SUFHSCxlQUFDO0FBQUQsQ0FBQyxBQWhKRCxJQWdKQztBQUVELE9BQU8sRUFBRSxRQUFRLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXHJcbiAqIEBBdXRob3I6IFdpdHRcclxuICogQERhdGU6IDIwMTgtMTAtMTcgMTQ6MTM6NDBcclxuICogQExhc3QgTW9kaWZpZWQgYnk6IFdpdHRcclxuICogQExhc3QgTW9kaWZpZWQgdGltZTogMjAxOC0xMC0xNyAxNjowODozNFxyXG4gKi9cclxuXHJcbmltcG9ydCB7IFRhc2tGdW5jLCBUYXNrTm9kZSB9IGZyb20gJy4vdGFza19ub2RlJztcclxuaW1wb3J0IHsgTGlua0Z1bmMsIFRhc2tMaW5rIH0gZnJvbSAnLi90YXNrX2xpbmsnO1xyXG5pbXBvcnQgeyBDb21tYW5kQ29udGV4dCB9IGZyb20gJy4uL2NvbW1hbmRfY29udGV4dCc7XHJcblxyXG4vKipcclxuICog5Lu75Yqh5omn6KGM5rWB56iLXHJcbiAqL1xyXG5jbGFzcyBUYXNrRmxvdyB7XHJcblxyXG4gIC8qKlxyXG4gICAqIOiKgueCuembhuWQiFxyXG4gICAqL1xyXG4gIHByaXZhdGUgbm9kZXM6IFRhc2tOb2RlW10gPSBbXTtcclxuXHJcbiAgLyoqXHJcbiAgICog6L656ZuG5ZCIXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBsaW5rczogVGFza0xpbmtbXSA9IFtdO1xyXG5cclxuXHJcbiAgLy8gI3JlZ2lvbiDoioLngrnmk43kvZxcclxuXHJcbiAgLyoqXHJcbiAgICog5re75Yqg6IqC54K5XHJcbiAgICovXHJcbiAgcHVibGljIGFkZE5vZGUobmFtZTogc3RyaW5nLCBmdW5jOiBUYXNrRnVuYyk6IHZvaWQge1xyXG4gICAgY29uc3Qgbm9kZSA9IG5ldyBUYXNrTm9kZShuYW1lLCBmdW5jKTtcclxuICAgIHRoaXMubm9kZXMucHVzaChub2RlKTtcclxuICB9XHJcblxyXG5cclxuICAvKipcclxuICAgKiDmibnph4/mt7vliqDpk77mjqVcclxuICAgKi9cclxuICBwdWJsaWMgYWRkTm9kZXMobm9kZXM6IFRhc2tOb2RlW10pIHtcclxuICAgIHRoaXMubm9kZXMgPSB0aGlzLm5vZGVzLmNvbmNhdChub2Rlcyk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlnKjnm67moIfoioLngrnkuYvliY3mj5LlhaXkuIDkuKroioLngrlcclxuICAgKiBAcGFyYW0gdGFyZ2V0IOebruagh+iKgueCueWQjeensFxyXG4gICAqIEBwYXJhbSBuYW1lIOWQjeensFxyXG4gICAqIEBwYXJhbSBmdW5jIOWHveaVsFxyXG4gICAqL1xyXG4gIHB1YmxpYyBpbnNlcnROb2RlKHRhcmdldDogc3RyaW5nLCBuYW1lOiBzdHJpbmcsIGZ1bmM6IFRhc2tGdW5jKTogdm9pZCB7XHJcbiAgICBjb25zdCBpbmRleCA9IHRoaXMuZmluZE5vZGVJbmRleCh0YXJnZXQpO1xyXG4gICAgY29uc3Qgbm9kZSA9IHRoaXMuY3JlYXRlTm9kZShuYW1lLCBmdW5jKTtcclxuICAgIHRoaXMubm9kZXMuc3BsaWNlKGluZGV4LCAwLCBub2RlKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWcqOebruagh+iKgueCueS5i+WJjeaPkuWFpeS4gOS4quiKgueCuVxyXG4gICAqL1xyXG4gIHB1YmxpYyBhcHBlbmROb2RlKHRhcmdldDogc3RyaW5nLCBuYW1lOiBzdHJpbmcsIGZ1bmM6IFRhc2tGdW5jKSB7XHJcbiAgICBjb25zdCBpbmRleCA9IHRoaXMuZmluZE5vZGVJbmRleCh0YXJnZXQpICsgMTtcclxuICAgIGNvbnN0IG5vZGUgPSB0aGlzLmNyZWF0ZU5vZGUobmFtZSwgZnVuYyk7XHJcbiAgICB0aGlzLm5vZGVzLnNwbGljZShpbmRleCwgMCwgbm9kZSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDojrflj5boioLngrnntKLlvJVcclxuICAgKiBAcGFyYW0gbmFtZSDlkI3np7BcclxuICAgKi9cclxuICBwcml2YXRlIGZpbmROb2RlSW5kZXgobmFtZTogc3RyaW5nKTogbnVtYmVyIHtcclxuICAgIHJldHVybiB0aGlzLm5vZGVzLmZpbmRJbmRleCgobm9kZTogVGFza05vZGUpID0+IHtcclxuICAgICAgcmV0dXJuIG5vZGUubmFtZSA9PT0gbmFtZTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Yib5bu65Lu75Yqh6IqC54K5XHJcbiAgICogQHBhcmFtIG5hbWUg5ZCN56ewXHJcbiAgICogQHBhcmFtIGZ1bmMg5Ye95pWwXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBjcmVhdGVOb2RlKG5hbWU6IHN0cmluZywgZnVuYzogVGFza0Z1bmMpOiBUYXNrTm9kZSB7XHJcbiAgICBjb25zdCBub2RlID0gbmV3IFRhc2tOb2RlKG5hbWUsIGZ1bmMpO1xyXG4gICAgcmV0dXJuIG5vZGU7XHJcbiAgfVxyXG5cclxuICAvLyAjZW5kcmVnaW9uXHJcblxyXG5cclxuICAvLyAjcmVnaW9uIOmTvuaOpeaTjeS9nFxyXG5cclxuICAvKipcclxuICAgKiDmt7vliqDpk77mjqVcclxuICAgKiBAcGFyYW0gbmFtZSDlkI3np7BcclxuICAgKiBAcGFyYW0gZnVuYyDlh73mlbBcclxuICAgKi9cclxuICBwdWJsaWMgYWRkTGluayhmcm9tOiBzdHJpbmcsIHRvOiBzdHJpbmcsIGNvbmRpdGlvbjogc3RyaW5nIHwgYm9vbGVhbikge1xyXG4gICAgY29uc3QgbGluayA9IHRoaXMuY3JlYXRlTGluayhmcm9tLCB0bywgY29uZGl0aW9uKTtcclxuICAgIHRoaXMubGlua3MucHVzaChsaW5rKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaJuemHj+a3u+WKoOmTvuaOpVxyXG4gICAqL1xyXG4gIHB1YmxpYyBhZGRMaW5rcyhsaW5rczogVGFza0xpbmtbXSkge1xyXG4gICAgdGhpcy5saW5rcyA9IHRoaXMubGlua3MuY29uY2F0KGxpbmtzKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWIm+W7uumTvuaOpVxyXG4gICAqL1xyXG4gIHByaXZhdGUgY3JlYXRlTGluayhmcm9tOiBzdHJpbmcsIHRvOiBzdHJpbmcsIGNvbmRpdGlvbjogc3RyaW5nIHwgYm9vbGVhbikge1xyXG4gICAgY29uc3QgbGluayA9IG5ldyBUYXNrTGluayhmcm9tLCB0bywgY29uZGl0aW9uKTtcclxuICAgIHJldHVybiBsaW5rO1xyXG4gIH1cclxuXHJcbiAgLy8gI2VuZHJlZ2lvblxyXG5cclxuXHJcbiAgLy8gI3JlZ2lvbiDmtYHnqIvmjqfliLZcclxuICAvKipcclxuICAgKiDojrflj5bkuIvkuIDkuKroioLngrlcclxuICAgKiBAcGFyYW0gZnJvbSAgICDmupDoioLngrnlkI3np7BcclxuICAgKiBAcGFyYW0gY29udGV4dCDkuIrkuIvmlodcclxuICAgKi9cclxuICBnZXROZXh0KGZyb20/OiBzdHJpbmcsIGNvbnRleHQ/OiBDb21tYW5kQ29udGV4dCk6IFRhc2tOb2RlIHtcclxuICAgIGlmICghZnJvbSkge1xyXG4gICAgICByZXR1cm4gdGhpcy5ub2Rlcy5zaGlmdCgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOespuWQiOa7oei2s+adoeS7tueahOi+uVxyXG4gICAgY29uc3QgbmV4dExpbmsgPSB0aGlzLmxpbmtzLmZpbmQoKGxpbms6IFRhc2tMaW5rKSA9PiB7XHJcbiAgICAgIHJldHVybiBsaW5rLmZyb20gPT09IGZyb20gJiYgbGluay5jYW5MaW5rKGNvbnRleHQpO1xyXG4gICAgfSk7XHJcbiAgICBpZiAoIW5leHRMaW5rKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdGhpcy5ub2Rlcy5maW5kKChub2RlOiBUYXNrTm9kZSkgPT4ge1xyXG4gICAgICByZXR1cm4gbm9kZS5uYW1lID09PSBuZXh0TGluay50bztcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLy8gI2VuZHJlZ2lvblxyXG5cclxuICAvLyAjcmVnaW9uIOWFtuS7luaWueazlVxyXG5cclxuICAvKipcclxuICAgKiDlhYvpmobku7vliqHmtYFcclxuICAgKi9cclxuICBjbG9uZSgpIHtcclxuICAgIGNvbnN0IHRhc2tGbG93ID0gbmV3IFRhc2tGbG93KCk7XHJcbiAgICB0YXNrRmxvdy5hZGROb2Rlcyh0aGlzLm5vZGVzKTtcclxuICAgIHRhc2tGbG93LmFkZExpbmtzKHRoaXMubGlua3MpO1xyXG4gICAgcmV0dXJuIHRhc2tGbG93O1xyXG4gIH1cclxuXHJcbiAgLy8gI2VuZHJlZ2lvblxyXG59XHJcblxyXG5leHBvcnQgeyBUYXNrRmxvdyB9O1xyXG4iXX0=