/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Directive, Input, Injector, ElementRef, HostListener } from '@angular/core';
import { NgControl } from '@angular/forms';
export class TextareaAutoSizeDirective {
    /**
     * @param {?} el
     * @param {?} ngControl
     * @param {?} injector
     */
    constructor(el, ngControl, injector) {
        this.el = el;
        this.ngControl = ngControl;
        this.injector = injector;
        this.enable = true;
        this.previousValue = null;
        this.isUserResized = false;
        this.textarea = this.el.nativeElement;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.init();
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (changes.enable && !changes.enable.isFirstChange()) {
            this.sizeToFit();
        }
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        this.minHeight = this.textarea.getBoundingClientRect().height;
    }
    /**
     * @private
     * @return {?}
     */
    init() {
        if (this.enable) {
            this.document = this.textarea.ownerDocument;
            this.documentElement = this.document.documentElement;
            if (this.textarea) {
                if (this.textarea.value) {
                    this.sizeToFit();
                }
            }
            if (this.ngControl) {
                this.ngControl.valueChanges.subscribe((/**
                 * @param {?} v
                 * @return {?}
                 */
                v => {
                    if (v !== this.previousValue) {
                        this.sizeToFit();
                    }
                }));
            }
        }
    }
    /**
     * @return {?}
     */
    onInput() {
        this.sizeToFit();
    }
    /**
     * @return {?}
     */
    onValueChange() {
        this.sizeToFit();
    }
    /**
     * @private
     * @return {?}
     */
    overflowOffset() {
        /** @type {?} */
        let offsetTop = 0;
        /** @type {?} */
        let el = this.textarea;
        while (el !== document.body && el !== null) {
            offsetTop += el.offsetTop || 0;
            el = el.offsetParent;
        }
        /** @type {?} */
        const top = offsetTop - document.defaultView.pageYOffset;
        /** @type {?} */
        const bottom = this.documentElement.clientHeight - (top + this.textarea.offsetHeight);
        return { top, bottom };
    }
    /**
     * @private
     * @return {?}
     */
    sizeToFit() {
        if (!this.enable) {
            return;
        }
        /** @type {?} */
        const textarea = this.textarea;
        /** @type {?} */
        const viewportMarginBottom = 100;
        if (this.isUserResized) {
            return;
        }
        if (this.textarea.value === this.previousValue) {
            return;
        }
        if (this.textarea.offsetWidth <= 0 && this.textarea.offsetHeight <= 0) {
            return;
        }
        // const { top, bottom } = this.overflowOffset();
        // if (top < 0 || bottom < 0) {
        //     return;
        // }
        /** @type {?} */
        const textareaStyle = getComputedStyle(textarea);
        /** @type {?} */
        const topBorderWidth = Number(textareaStyle.borderTopWidth.replace(/px/, ''));
        /** @type {?} */
        const bottomBorderWidth = Number(textareaStyle.borderBottomWidth.replace(/px/, ''));
        /** @type {?} */
        const isBorderBox = textareaStyle.boxSizing === 'border-box';
        /** @type {?} */
        const borderAddOn = isBorderBox ? topBorderWidth + bottomBorderWidth : 0;
        // const maxHeight = Number(textareaStyle.height.replace(/px/, '')) + bottom;
        // const adjustedViewportMarginBottom = bottom < viewportMarginBottom ? bottom : viewportMarginBottom;
        // textarea.style.maxHeight = `${maxHeight - adjustedViewportMarginBottom}px`;
        if (this.maxHeight) {
            textarea.style.maxHeight = `${this.maxHeight}px`;
        }
        /** @type {?} */
        const container = textarea.parentElement;
        if (container instanceof HTMLElement) {
            /** @type {?} */
            const containerHeight = container.style.height;
            container.style.height = getComputedStyle(container).height;
            textarea.style.height = 'auto';
            /** @type {?} */
            let h = textarea.scrollHeight + borderAddOn;
            if (this.minHeight > h) {
                h = this.minHeight;
            }
            textarea.style.height = `${h}px`;
            container.style.height = containerHeight;
        }
        this.previousValue = textarea.value;
    }
}
TextareaAutoSizeDirective.decorators = [
    { type: Directive, args: [{
                selector: '[auto-size]',
            },] }
];
/** @nocollapse */
TextareaAutoSizeDirective.ctorParameters = () => [
    { type: ElementRef },
    { type: NgControl },
    { type: Injector }
];
TextareaAutoSizeDirective.propDecorators = {
    enable: [{ type: Input, args: ['auto-size',] }],
    maxHeight: [{ type: Input }],
    onInput: [{ type: HostListener, args: ['input',] }],
    onValueChange: [{ type: HostListener, args: ['change',] }]
};
if (false) {
    /** @type {?} */
    TextareaAutoSizeDirective.prototype.enable;
    /** @type {?} */
    TextareaAutoSizeDirective.prototype.maxHeight;
    /**
     * @type {?}
     * @private
     */
    TextareaAutoSizeDirective.prototype.previousValue;
    /**
     * @type {?}
     * @private
     */
    TextareaAutoSizeDirective.prototype.isUserResized;
    /**
     * @type {?}
     * @private
     */
    TextareaAutoSizeDirective.prototype.textarea;
    /**
     * @type {?}
     * @private
     */
    TextareaAutoSizeDirective.prototype.document;
    /**
     * @type {?}
     * @private
     */
    TextareaAutoSizeDirective.prototype.documentElement;
    /**
     * @type {?}
     * @private
     */
    TextareaAutoSizeDirective.prototype.minHeight;
    /**
     * @type {?}
     * @private
     */
    TextareaAutoSizeDirective.prototype.el;
    /**
     * @type {?}
     * @private
     */
    TextareaAutoSizeDirective.prototype.ngControl;
    /**
     * @type {?}
     * @private
     */
    TextareaAutoSizeDirective.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGV4dGFyZWEtYXV0b3NpemUuZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1mb3Jtcy8iLCJzb3VyY2VzIjpbImxpYi90ZXh0YXJlYS1hdXRvc2l6ZS5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBVSxVQUFVLEVBQUUsWUFBWSxFQUEyQyxNQUFNLGVBQWUsQ0FBQztBQUN0SSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFLM0MsTUFBTSxPQUFPLHlCQUF5Qjs7Ozs7O0lBWWxDLFlBQW9CLEVBQWMsRUFBVSxTQUFvQixFQUFVLFFBQWtCO1FBQXhFLE9BQUUsR0FBRixFQUFFLENBQVk7UUFBVSxjQUFTLEdBQVQsU0FBUyxDQUFXO1FBQVUsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQVh4RSxXQUFNLEdBQUcsSUFBSSxDQUFDO1FBRzFCLGtCQUFhLEdBQUcsSUFBSSxDQUFDO1FBQ3JCLGtCQUFhLEdBQUcsS0FBSyxDQUFDO1FBUTFCLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQyxhQUFhLENBQUM7SUFDMUMsQ0FBQzs7OztJQUVELFFBQVE7UUFDSixJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDaEIsQ0FBQzs7Ozs7SUFFRCxXQUFXLENBQUMsT0FBc0I7UUFDOUIsSUFBSSxPQUFPLENBQUMsTUFBTSxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxhQUFhLEVBQUUsRUFBRTtZQUNuRCxJQUFJLENBQUMsU0FBUyxFQUFFLENBQUM7U0FDcEI7SUFDTCxDQUFDOzs7O0lBRUQsZUFBZTtRQUNYLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxxQkFBcUIsRUFBRSxDQUFDLE1BQU0sQ0FBQztJQUNsRSxDQUFDOzs7OztJQUVPLElBQUk7UUFDUixJQUFJLElBQUksQ0FBQyxNQUFNLEVBQUU7WUFDYixJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsYUFBYSxDQUFDO1lBQzVDLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxlQUFlLENBQUM7WUFDckQsSUFBSSxJQUFJLENBQUMsUUFBUSxFQUFFO2dCQUNmLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLEVBQUU7b0JBQ3JCLElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQztpQkFDcEI7YUFDSjtZQUVELElBQUksSUFBSSxDQUFDLFNBQVMsRUFBRTtnQkFDaEIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxZQUFZLENBQUMsU0FBUzs7OztnQkFBQyxDQUFDLENBQUMsRUFBRTtvQkFDdEMsSUFBSSxDQUFDLEtBQUssSUFBSSxDQUFDLGFBQWEsRUFBRTt3QkFDMUIsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO3FCQUNwQjtnQkFDTCxDQUFDLEVBQUMsQ0FBQzthQUNOO1NBQ0o7SUFDTCxDQUFDOzs7O0lBR0QsT0FBTztRQUNILElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQztJQUNyQixDQUFDOzs7O0lBR0QsYUFBYTtRQUNULElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQztJQUNyQixDQUFDOzs7OztJQUdPLGNBQWM7O1lBQ2QsU0FBUyxHQUFHLENBQUM7O1lBQ2IsRUFBRSxHQUFHLElBQUksQ0FBQyxRQUFRO1FBRXRCLE9BQU8sRUFBRSxLQUFLLFFBQVEsQ0FBQyxJQUFJLElBQUksRUFBRSxLQUFLLElBQUksRUFBRTtZQUN4QyxTQUFTLElBQUksRUFBRSxDQUFDLFNBQVMsSUFBSSxDQUFDLENBQUM7WUFDL0IsRUFBRSxHQUFHLEVBQUUsQ0FBQyxZQUFZLENBQUM7U0FDeEI7O2NBRUssR0FBRyxHQUFHLFNBQVMsR0FBRyxRQUFRLENBQUMsV0FBVyxDQUFDLFdBQVc7O2NBQ2xELE1BQU0sR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLFlBQVksR0FBRyxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLFlBQVksQ0FBQztRQUNyRixPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sRUFBRSxDQUFDO0lBQzNCLENBQUM7Ozs7O0lBRU8sU0FBUztRQUNiLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFO1lBQ2QsT0FBTztTQUNWOztjQUVLLFFBQVEsR0FBRyxJQUFJLENBQUMsUUFBUTs7Y0FDeEIsb0JBQW9CLEdBQUcsR0FBRztRQUNoQyxJQUFJLElBQUksQ0FBQyxhQUFhLEVBQUU7WUFBRSxPQUFPO1NBQUU7UUFDbkMsSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssS0FBSyxJQUFJLENBQUMsYUFBYSxFQUFFO1lBQUUsT0FBTztTQUFFO1FBQzNELElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxXQUFXLElBQUksQ0FBQyxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsWUFBWSxJQUFJLENBQUMsRUFBRTtZQUFFLE9BQU87U0FBRTs7Ozs7O2NBTzVFLGFBQWEsR0FBRyxnQkFBZ0IsQ0FBQyxRQUFRLENBQUM7O2NBRTFDLGNBQWMsR0FBRyxNQUFNLENBQUMsYUFBYSxDQUFDLGNBQWMsQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxDQUFDOztjQUN2RSxpQkFBaUIsR0FBRyxNQUFNLENBQUMsYUFBYSxDQUFDLGlCQUFpQixDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLENBQUM7O2NBRTdFLFdBQVcsR0FBRyxhQUFhLENBQUMsU0FBUyxLQUFLLFlBQVk7O2NBQ3RELFdBQVcsR0FBRyxXQUFXLENBQUMsQ0FBQyxDQUFDLGNBQWMsR0FBRyxpQkFBaUIsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUV4RSw2RUFBNkU7UUFDN0Usc0dBQXNHO1FBQ3RHLDhFQUE4RTtRQUU5RSxJQUFJLElBQUksQ0FBQyxTQUFTLEVBQUU7WUFDaEIsUUFBUSxDQUFDLEtBQUssQ0FBQyxTQUFTLEdBQUcsR0FBRyxJQUFJLENBQUMsU0FBUyxJQUFJLENBQUM7U0FDcEQ7O2NBRUssU0FBUyxHQUFHLFFBQVEsQ0FBQyxhQUFhO1FBQ3hDLElBQUksU0FBUyxZQUFZLFdBQVcsRUFBRTs7a0JBQzVCLGVBQWUsR0FBRyxTQUFTLENBQUMsS0FBSyxDQUFDLE1BQU07WUFDOUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsZ0JBQWdCLENBQUMsU0FBUyxDQUFDLENBQUMsTUFBTSxDQUFDO1lBQzVELFFBQVEsQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQzs7Z0JBRTNCLENBQUMsR0FBRyxRQUFRLENBQUMsWUFBWSxHQUFHLFdBQVc7WUFDM0MsSUFBSSxJQUFJLENBQUMsU0FBUyxHQUFHLENBQUMsRUFBRTtnQkFDcEIsQ0FBQyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUM7YUFDdEI7WUFDRCxRQUFRLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDO1lBQ2pDLFNBQVMsQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLGVBQWUsQ0FBQztTQUM1QztRQUVELElBQUksQ0FBQyxhQUFhLEdBQUcsUUFBUSxDQUFDLEtBQUssQ0FBQztJQUN4QyxDQUFDOzs7WUE3SEosU0FBUyxTQUFDO2dCQUNQLFFBQVEsRUFBRSxhQUFhO2FBQzFCOzs7O1lBTDRDLFVBQVU7WUFDOUMsU0FBUztZQURTLFFBQVE7OztxQkFPOUIsS0FBSyxTQUFDLFdBQVc7d0JBQ2pCLEtBQUs7c0JBZ0RMLFlBQVksU0FBQyxPQUFPOzRCQUtwQixZQUFZLFNBQUMsUUFBUTs7OztJQXREdEIsMkNBQWtDOztJQUNsQyw4Q0FBMkI7Ozs7O0lBRTNCLGtEQUE2Qjs7Ozs7SUFDN0Isa0RBQThCOzs7OztJQUU5Qiw2Q0FBaUI7Ozs7O0lBQ2pCLDZDQUFpQjs7Ozs7SUFDakIsb0RBQXdCOzs7OztJQUN4Qiw4Q0FBa0I7Ozs7O0lBRU4sdUNBQXNCOzs7OztJQUFFLDhDQUE0Qjs7Ozs7SUFBRSw2Q0FBMEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEaXJlY3RpdmUsIElucHV0LCBJbmplY3RvciwgT25Jbml0LCBFbGVtZW50UmVmLCBIb3N0TGlzdGVuZXIsIEFmdGVyVmlld0luaXQsIE9uQ2hhbmdlcywgU2ltcGxlQ2hhbmdlcyB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBOZ0NvbnRyb2wgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XHJcblxyXG5ARGlyZWN0aXZlKHtcclxuICAgIHNlbGVjdG9yOiAnW2F1dG8tc2l6ZV0nLFxyXG59KVxyXG5leHBvcnQgY2xhc3MgVGV4dGFyZWFBdXRvU2l6ZURpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCwgT25DaGFuZ2Vze1xyXG4gICAgQElucHV0KCdhdXRvLXNpemUnKSBlbmFibGUgPSB0cnVlO1xyXG4gICAgQElucHV0KCkgbWF4SGVpZ2h0OiBudW1iZXI7XHJcblxyXG4gICAgcHJpdmF0ZSBwcmV2aW91c1ZhbHVlID0gbnVsbDtcclxuICAgIHByaXZhdGUgaXNVc2VyUmVzaXplZCA9IGZhbHNlO1xyXG5cclxuICAgIHByaXZhdGUgdGV4dGFyZWE7XHJcbiAgICBwcml2YXRlIGRvY3VtZW50O1xyXG4gICAgcHJpdmF0ZSBkb2N1bWVudEVsZW1lbnQ7XHJcbiAgICBwcml2YXRlIG1pbkhlaWdodDtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGVsOiBFbGVtZW50UmVmLCBwcml2YXRlIG5nQ29udHJvbDogTmdDb250cm9sLCBwcml2YXRlIGluamVjdG9yOiBJbmplY3Rvcikge1xyXG4gICAgICAgIHRoaXMudGV4dGFyZWEgPSB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQ7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKSB7XHJcbiAgICAgICAgdGhpcy5pbml0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xyXG4gICAgICAgIGlmIChjaGFuZ2VzLmVuYWJsZSAmJiAhY2hhbmdlcy5lbmFibGUuaXNGaXJzdENoYW5nZSgpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2l6ZVRvRml0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcclxuICAgICAgICB0aGlzLm1pbkhlaWdodCA9IHRoaXMudGV4dGFyZWEuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkuaGVpZ2h0O1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgaW5pdCgpIHtcclxuICAgICAgICBpZiAodGhpcy5lbmFibGUpIHtcclxuICAgICAgICAgICAgdGhpcy5kb2N1bWVudCA9IHRoaXMudGV4dGFyZWEub3duZXJEb2N1bWVudDtcclxuICAgICAgICAgICAgdGhpcy5kb2N1bWVudEVsZW1lbnQgPSB0aGlzLmRvY3VtZW50LmRvY3VtZW50RWxlbWVudDtcclxuICAgICAgICAgICAgaWYgKHRoaXMudGV4dGFyZWEpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnRleHRhcmVhLnZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaXplVG9GaXQoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMubmdDb250cm9sKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm5nQ29udHJvbC52YWx1ZUNoYW5nZXMuc3Vic2NyaWJlKHYgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh2ICE9PSB0aGlzLnByZXZpb3VzVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaXplVG9GaXQoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBASG9zdExpc3RlbmVyKCdpbnB1dCcpXHJcbiAgICBvbklucHV0KCkge1xyXG4gICAgICAgIHRoaXMuc2l6ZVRvRml0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgQEhvc3RMaXN0ZW5lcignY2hhbmdlJylcclxuICAgIG9uVmFsdWVDaGFuZ2UoKSB7XHJcbiAgICAgICAgdGhpcy5zaXplVG9GaXQoKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgcHJpdmF0ZSBvdmVyZmxvd09mZnNldCgpIHtcclxuICAgICAgICBsZXQgb2Zmc2V0VG9wID0gMDtcclxuICAgICAgICBsZXQgZWwgPSB0aGlzLnRleHRhcmVhO1xyXG5cclxuICAgICAgICB3aGlsZSAoZWwgIT09IGRvY3VtZW50LmJvZHkgJiYgZWwgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgb2Zmc2V0VG9wICs9IGVsLm9mZnNldFRvcCB8fCAwO1xyXG4gICAgICAgICAgICBlbCA9IGVsLm9mZnNldFBhcmVudDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHRvcCA9IG9mZnNldFRvcCAtIGRvY3VtZW50LmRlZmF1bHRWaWV3LnBhZ2VZT2Zmc2V0O1xyXG4gICAgICAgIGNvbnN0IGJvdHRvbSA9IHRoaXMuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCAtICh0b3AgKyB0aGlzLnRleHRhcmVhLm9mZnNldEhlaWdodCk7XHJcbiAgICAgICAgcmV0dXJuIHsgdG9wLCBib3R0b20gfTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNpemVUb0ZpdCgpIHtcclxuICAgICAgICBpZiAoIXRoaXMuZW5hYmxlKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHRleHRhcmVhID0gdGhpcy50ZXh0YXJlYTtcclxuICAgICAgICBjb25zdCB2aWV3cG9ydE1hcmdpbkJvdHRvbSA9IDEwMDtcclxuICAgICAgICBpZiAodGhpcy5pc1VzZXJSZXNpemVkKSB7IHJldHVybjsgfVxyXG4gICAgICAgIGlmICh0aGlzLnRleHRhcmVhLnZhbHVlID09PSB0aGlzLnByZXZpb3VzVmFsdWUpIHsgcmV0dXJuOyB9XHJcbiAgICAgICAgaWYgKHRoaXMudGV4dGFyZWEub2Zmc2V0V2lkdGggPD0gMCAmJiB0aGlzLnRleHRhcmVhLm9mZnNldEhlaWdodCA8PSAwKSB7IHJldHVybjsgfVxyXG5cclxuICAgICAgICAvLyBjb25zdCB7IHRvcCwgYm90dG9tIH0gPSB0aGlzLm92ZXJmbG93T2Zmc2V0KCk7XHJcbiAgICAgICAgLy8gaWYgKHRvcCA8IDAgfHwgYm90dG9tIDwgMCkge1xyXG4gICAgICAgIC8vICAgICByZXR1cm47XHJcbiAgICAgICAgLy8gfVxyXG5cclxuICAgICAgICBjb25zdCB0ZXh0YXJlYVN0eWxlID0gZ2V0Q29tcHV0ZWRTdHlsZSh0ZXh0YXJlYSk7XHJcblxyXG4gICAgICAgIGNvbnN0IHRvcEJvcmRlcldpZHRoID0gTnVtYmVyKHRleHRhcmVhU3R5bGUuYm9yZGVyVG9wV2lkdGgucmVwbGFjZSgvcHgvLCAnJykpO1xyXG4gICAgICAgIGNvbnN0IGJvdHRvbUJvcmRlcldpZHRoID0gTnVtYmVyKHRleHRhcmVhU3R5bGUuYm9yZGVyQm90dG9tV2lkdGgucmVwbGFjZSgvcHgvLCAnJykpO1xyXG5cclxuICAgICAgICBjb25zdCBpc0JvcmRlckJveCA9IHRleHRhcmVhU3R5bGUuYm94U2l6aW5nID09PSAnYm9yZGVyLWJveCc7XHJcbiAgICAgICAgY29uc3QgYm9yZGVyQWRkT24gPSBpc0JvcmRlckJveCA/IHRvcEJvcmRlcldpZHRoICsgYm90dG9tQm9yZGVyV2lkdGggOiAwO1xyXG5cclxuICAgICAgICAvLyBjb25zdCBtYXhIZWlnaHQgPSBOdW1iZXIodGV4dGFyZWFTdHlsZS5oZWlnaHQucmVwbGFjZSgvcHgvLCAnJykpICsgYm90dG9tO1xyXG4gICAgICAgIC8vIGNvbnN0IGFkanVzdGVkVmlld3BvcnRNYXJnaW5Cb3R0b20gPSBib3R0b20gPCB2aWV3cG9ydE1hcmdpbkJvdHRvbSA/IGJvdHRvbSA6IHZpZXdwb3J0TWFyZ2luQm90dG9tO1xyXG4gICAgICAgIC8vIHRleHRhcmVhLnN0eWxlLm1heEhlaWdodCA9IGAke21heEhlaWdodCAtIGFkanVzdGVkVmlld3BvcnRNYXJnaW5Cb3R0b219cHhgO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5tYXhIZWlnaHQpIHtcclxuICAgICAgICAgICAgdGV4dGFyZWEuc3R5bGUubWF4SGVpZ2h0ID0gYCR7dGhpcy5tYXhIZWlnaHR9cHhgO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgY29udGFpbmVyID0gdGV4dGFyZWEucGFyZW50RWxlbWVudDtcclxuICAgICAgICBpZiAoY29udGFpbmVyIGluc3RhbmNlb2YgSFRNTEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgY29uc3QgY29udGFpbmVySGVpZ2h0ID0gY29udGFpbmVyLnN0eWxlLmhlaWdodDtcclxuICAgICAgICAgICAgY29udGFpbmVyLnN0eWxlLmhlaWdodCA9IGdldENvbXB1dGVkU3R5bGUoY29udGFpbmVyKS5oZWlnaHQ7XHJcbiAgICAgICAgICAgIHRleHRhcmVhLnN0eWxlLmhlaWdodCA9ICdhdXRvJztcclxuXHJcbiAgICAgICAgICAgIGxldCBoID0gdGV4dGFyZWEuc2Nyb2xsSGVpZ2h0ICsgYm9yZGVyQWRkT247XHJcbiAgICAgICAgICAgIGlmICh0aGlzLm1pbkhlaWdodCA+IGgpIHtcclxuICAgICAgICAgICAgICAgIGggPSB0aGlzLm1pbkhlaWdodDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0ZXh0YXJlYS5zdHlsZS5oZWlnaHQgPSBgJHtofXB4YDtcclxuICAgICAgICAgICAgY29udGFpbmVyLnN0eWxlLmhlaWdodCA9IGNvbnRhaW5lckhlaWdodDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMucHJldmlvdXNWYWx1ZSA9IHRleHRhcmVhLnZhbHVlO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==