import { Directive, HostListener, EventEmitter, Output } from '@angular/core';
import { Subject } from 'rxjs';
import { BindingData, ChangeType, ViewModel, DataTypeInfo, EntityPathConverter, RunMode } from '@farris/devkit';
import { DatagridComponent } from '@farris/ui-datagrid';
import { debounceTime, finalize } from 'rxjs/operators';
// tslint:disable: max-line-length
/*
 * 使用绑定数据指令
 */
export class FarrisDatagridUseBindingDataDirective {
    constructor(bindingData, viewModel, grid) {
        this.bindingData = bindingData;
        this.viewModel = viewModel;
        this.grid = grid;
        // 排序字段
        this.sortFields = null;
        // 排序方向
        this.sortDirections = null;
        this.parentId = null;
        /**
         * 过滤条件
         */
        this.filters = null;
        /**
         * 渲染grid
         */
        this.renderGridSubject = new Subject();
        /**
         * 选中行切换事件
         */
        this.selectedRowChange = new EventEmitter();
        this.setChecks([]);
        this.registerEvent();
    }
    get props() {
        return this._PROPS;
    }
    set props(value) {
        this._PROPS = value;
    }
    // #region Ng Event
    ngOnInit() {
        const { pageSize = 0 } = this.getPagingInfo() || {};
        if (pageSize !== 0) {
            // 启用分页
            if ((!this.grid.pageList || this.grid.pageList.length < 1) && typeof this.grid['setPageList'] === 'function') {
                this.grid['setPageList']([pageSize, pageSize * 2, pageSize * 3, pageSize * 4]);
            }
        }
        this.setComponentRef();
        this.bindData();
        window.setTimeout(() => {
            this.updateSelectedRow();
        }, 0);
        this.registerBindingDataChangeEvent();
        this.renderGridSubject.pipe(debounceTime(500)).subscribe((change) => {
            if (!this.viewModel || !this.viewModel.frameContext || this.viewModel.frameContext.isDisposed) {
                return;
            }
            this.bindData(change);
        });
    }
    ngOnChanges(changes) {
        this.bindData();
    }
    // #endregion
    /**
     * 主键
     */
    get primaryKey() {
        return this.bindingList.primaryKey;
    }
    /**
     * 获取绑定数据
     */
    get bindingList() {
        // 根实体
        if (this.viewModel.bindingPath === '/' || !this.viewModel.bindingPath) {
            return this.bindingData.list;
        }
        // 子实体
        let bindingPath = this.viewModel.bindingPath.substr(1);
        bindingPath = bindingPath[0].toLowerCase() + bindingPath.substring(1, bindingPath.length);
        const paths = bindingPath.split('/');
        const filteredPaths = paths.filter((part) => {
            return part !== '';
        });
        return this.bindingData.getValue(filteredPaths);
    }
    /**
     * 设置组件引用
     */
    setComponentRef() {
        const appContext = this.viewModel && this.viewModel.frameContext && this.viewModel.frameContext.getFormAppContext();
        const frameId = this.viewModel && this.viewModel.frameContext && this.viewModel.frameContext.frameId;
        const id = this.grid && this.grid.id;
        // 如果frameId不存在或farris grid没有id属性，说明不符合使用场景
        if (!frameId || !id) {
            return;
        }
        const map = appContext && appContext.componentRefs && appContext.componentRefs.get(frameId) || new Map();
        appContext && appContext.componentRefs && appContext.componentRefs.set(frameId, map.set(id, this.grid));
    }
    /**
     * 获取分页信息
     */
    getPagingInfo() {
        const bindingPath = this.viewModel.bindingPath;
        const bindingData = this.viewModel.bindingData;
        let pagingInfo = bindingData && bindingData.pagingInfo || {};
        if (bindingPath === '/') {
            return pagingInfo;
        }
        else {
            const bindingPaths = bindingPath.substr(1).split('/').filter(item => !!item && item.length > 0);
            // 从表及从从表分页和数据是关联的，因为不同的从表行有不同的从从表数据，分页信息的结构为nodeCode_parentId:{分页信息}且分页信息是平级的
            // {pagination:{a_pid:{pageSize:2,pageIndex:1},b_pid:{pageSize:2,pageIndex:1}}}
            // 取出当前路径下实体的nodeCode
            let nodeCode = bindingPaths[bindingPaths.length - 1];
            nodeCode = nodeCode.substr(0, nodeCode.length - 1);
            // 获取当前实体上级的主键
            // const result = pagingInfo[nodeCode] || {};
            // if (result.hasOwnProperty('totalCount')) {
            //   result.total = result.totalCount;
            // }
            // return result;
            const paths = bindingPaths.slice(0, bindingPaths.length - 1);
            const bindingList = bindingData.getValue(paths);
            const { pageSize = 0 } = pagingInfo[`${nodeCode}`] || {};
            // 上级表有数据
            if (bindingList && bindingList.currentId) {
                const key = `${nodeCode}_${bindingList.currentId}`;
                // const key = nodeCode;
                const result = pagingInfo[key] || {};
                if (result.hasOwnProperty('totalCount')) {
                    result.total = result.totalCount;
                }
                // 上级表虽然有数据，但上级表当前行的下级表可能没有数据，这就导致获取不到分页信息，所以需要在返回前对结果进行处理，如果没有分页信息的话起码应该返回分页大小及当前页码
                if (Object.keys(result).length < 1) {
                    result.pageIndex = 1;
                    result.pageSize = pageSize;
                }
                return result;
            }
            else {
                // 上级表没有数据，此时需要获取当前表的分页信息，如分页大小。当前页默认为1即可。
                return { pageIndex: 1, pageSize };
            }
        }
    }
    // #region Input
    /**
     * 组件是否需要更新
     * @param props 当前属性
     * @param nextProps 新属性
     * @param change 变更
     */
    shouldComponentUpdate(change, data) {
        const props = this.buildProps(data);
        if (this.viewModel && this.viewModel.frameContext && this.viewModel.frameContext.appContext && this.viewModel.frameContext.appContext.runMode === RunMode.highSpeed && change) {
            if (change.type === ChangeType.Load || change.type === ChangeType.Remove || change.type === ChangeType.PaginationInfoChange) {
                return { result: true, props };
            }
        }
        const gridProps = this.buildGridProps();
        if (JSON.stringify(props) === JSON.stringify(gridProps)) {
            return { result: false };
        }
        return { result: true, props };
    }
    registerEvent() {
        // 排序事件
        this.grid && this.grid.columnSorted && this.grid.columnSorted.subscribe((event) => {
            const isRemoteSort = this.grid.remoteSort;
            // 本地排序
            if (!isRemoteSort) {
                this.sortFields = this.grid.sortName;
                this.sortDirections = this.grid.sortOrder;
                this.sortBindingList();
                // this.props = this.buildProps();
            }
            else {
                // 服务器端排序
                const groupField = this.grid && this.grid.groupField || null;
                let sortFields = this.grid.sortName && this.grid.sortName.split(',') || [];
                const sortDirection = this.grid.sortOrder && this.grid.sortOrder.split(',') || [];
                if (groupField) {
                    if (!sortFields.includes(groupField)) {
                        sortFields.splice(0, 0, groupField);
                        sortDirection.splice(0, 0, 'asc');
                    }
                }
                // 获取当前entity上所有object属性
                const entityType = this.viewModel && this.viewModel.frameContext.repository.entityType || null;
                if (sortFields.length > 0) {
                    if (entityType) {
                        const dataTypeInfo = new DataTypeInfo(entityType);
                        sortFields = sortFields.map(field => {
                            //if (field && field.indexOf('.') !== -1) {
                            const paths = field.split('.');
                            const propInfo = dataTypeInfo.getPropInfoByPath(paths);
                            const originalField = propInfo && propInfo.metadataInfo['path'] || null;
                            return originalField;
                            //}
                            //return field;
                        });
                    }
                }
                // 遍历属性，根据datafield转换为originalDataField
                const fields = sortFields.join(',');
                const directions = sortDirection.join(',') || 'asc';
                const frameContext = this.viewModel && this.viewModel.frameContext || null;
                if (frameContext) {
                    frameContext.repository.sortConditionManager.setConditions(this.viewModel.bindingPath, fields, directions);
                }
            }
        });
        // 过滤事件
        this.grid && this.grid.filterChanged && this.grid.filterChanged.subscribe((event) => {
            this.filters = event;
            if (!this.grid.remoteFilter) {
                if (this.bindingList.length > 0 && !this.bindingList.currentId) {
                    const id = this.bindingList.getIdByIndex(0);
                    this.bindingList.setCurrentId(id);
                }
                this.bindData();
            }
        });
    }
    /**
     * 对bindingList排序
     */
    sortBindingList() {
        const groupField = this.grid && this.grid.groupField || null;
        if (groupField) {
            const arrSortFields = this.sortFields && this.sortFields.split(',') || [];
            if (!arrSortFields.includes(groupField)) {
                arrSortFields.splice(0, 0, groupField);
                const arrSortDirection = this.sortDirections && this.sortDirections.split(',') || [];
                arrSortDirection.splice(0, 0, 'asc');
                this.sortFields = arrSortFields.join(',');
                this.sortDirections = arrSortDirection.join(',') || 'asc';
            }
        }
        if (this.sortFields && this.sortDirections) {
            this.bindingList.sortBy(this.sortFields, this.sortDirections);
            // this.props = this.buildProps();
        }
        this.bindData();
    }
    // #endregion
    // #region 数据绑定部分
    /**
     * 更新数据
     * @param change? 变更
     */
    bindData(change) {
        const isRemoteFilter = this.grid && this.grid.remoteFilter || false;
        // 先执行排序
        if (this.sortFields && !this.grid.editable && change && (change.type === 'Load' || change.type === 'SelectionChanged')) {
            this.sortBindingList();
            return;
        }
        // 新增数据时清空表格筛选条件
        if ((this.grid.editable === true || change && change.type === ChangeType.Append) && this.filters && Object.keys(this.filters).length > 0 && !isRemoteFilter) {
            this.filters = {};
            this.grid.clearCondition();
        }
        // 再toJSON
        let data = this.bindingList.toJSON();
        if (this.filters && Object.keys(this.filters).length > 0 && !isRemoteFilter) {
            data = this.grid.clientFilterService.executeFilter(data, this.filters);
        }
        if (this.filters && Object.keys(this.filters).length > 0 && !isRemoteFilter && (!change || change && change.type !== ChangeType.SelectionChanged && change.type !== ChangeType.GlobalSelectionChanged)) {
            if (data && data.length > 0) {
                // 判断当前行是否在过滤后的数据中
                const row = data.find(item => item[this.bindingList.primaryKey] === this.bindingList.currentId);
                if (!row) {
                    const firstRowId = data[0][this.bindingList.primaryKey];
                    this.bindingList.setCurrentId(firstRowId, true, true);
                }
            }
            else {
                // 本地过滤完之后没有数据了
                // this.bindingList.currentId = null;
                this.bindingList.setCurrentId(null, true, true, true);
                // 单选时清空ids
                if (!this.grid.multiSelect) {
                    this.setChecks([]);
                }
            }
        }
        const result = this.shouldComponentUpdate(change, data);
        if (!result.result) {
            return;
        }
        // const nextProps = this.buildProps(result);
        this.renderGrid(result.props);
        this.props = JSON.parse(JSON.stringify(result.props));
    }
    /**
     * 渲染grid
     * @param props 属性
     */
    renderGrid(props) {
        const { pageIndex, pageSize, total, pagination, data } = props;
        const virtualizedLoad = this.grid.virtualizedAsyncLoad || false;
        this.grid.total = total;
        this.grid.pageSize = pageSize;
        this.grid.pageIndex = pageIndex;
        this.grid.pagination = pagination;
        this.grid.controlPaginationState = false;
        // this.endCellEdit();
        if (pageSize === 0) {
            this.grid.pagination = false;
            this.grid.pageIndex = 1;
            // 修复不分页时grid启用分组仍会重新邦数的问题
            // this.grid.pageSize = total;
        }
        if (virtualizedLoad) {
            this.grid.loadVirtualData({
                items: data,
                pageIndex,
                pageSize,
                total
            });
        }
        else {
            this.grid.loadData(data);
        }
    }
    /**
     * 构造表格数据属性
     */
    buildProps(datas) {
        let data;
        if (typeof (datas) !== 'undefined') {
            data = datas;
        }
        else {
            data = this.bindingList.toJSON();
        }
        // let skip = 0;
        let { pageIndex = 1, pageSize = 0 } = this.getPagingInfo() || {};
        let { total = 0 } = this.getPagingInfo() || {};
        // if (pageIndex > 0) {
        //   skip = (pageIndex - 1) * pageSize;
        // }
        if (pageSize === 0 && total === 0) {
            total = data.length;
        }
        return { data, pageIndex, pageSize, total, pagination: pageSize !== 0 };
    }
    /**
     * 计算grid状态
     */
    buildGridProps() {
        const data = this.grid.data || [];
        let skip = 0;
        const { pageIndex = 1, pageSize = 0 } = { pageIndex: this.grid.pageIndex, pageSize: this.grid.pageSize };
        let total = this.grid.total || 0;
        if (pageIndex > 0) {
            skip = (pageIndex - 1) * pageSize;
        }
        if (pageSize === 0 && total === 0) {
            total = data.length;
        }
        return { data, pageIndex, pageSize, total, pagination: this.grid.pagination };
    }
    /**
     * 数据源发生变更
     * @param change 变更
     */
    onBindingDataChange(change) {
        this.updateDataSource(change);
        this.updateSelectedRow(change);
        // this.updateGrid(change);
        // 不清除勾选行，需要保留勾选状态
        // this.clearCheckedRows(change);
        this.endCellEdit(change);
        // 更新勾选行数据
        this.updateCheckedRows(change);
        this.updateData(change);
    }
    /**
     * 更新数据
     */
    updateDataSource(change) {
        /*if (change) {
          const isMatch = this.checkIfChangeMatchBindingPath(change);
          if (!isMatch) {
            return;
          }
        }*/
        if (change && change.type === ChangeType.ValueChanged) {
            this.renderGridSubject.next(change);
        }
        else if (change && (change.type === ChangeType.SelectionChanged || change.type === ChangeType.GlobalSelectionChanged)) {
            if (this.bindingList.currentId === (this.grid.selectedRow && this.grid.selectedRow.id) && this.grid.total > 0) {
            }
            else {
                this.bindData(change);
            }
        }
        else {
            this.bindData(change);
        }
    }
    // private endCellEdit() {
    //   const isEditing = this.grid.isEditing();
    //   if (isEditing) {
    //     this.grid.endCellEdit();
    //   }
    // }
    endCellEdit(change) {
        const isEditing = this.grid.isEditing();
        if (change.type === ChangeType.Load && isEditing) {
            this.grid.endCellEdit();
        }
    }
    /**
     * 设置grid当前选择行
     * @param change 变更
     */
    updateSelectedRow(change) {
        if (!this.bindingList || !this.bindingList.currentId) {
            return;
        }
        // 页码切换时不执行当前行切换
        if (change && change.type === ChangeType.PaginationInfoChange) {
            return;
        }
        if (this.viewModel && this.viewModel.frameContext.bindingData.rowSelectedEventSuspend === true) {
            return;
        }
        const { id: gridSelectedRowId = null } = this.grid.selectedRow || {};
        const currentId = this.bindingList.currentId;
        // grid当前行与bingingList当前行一致，无须切换
        if (gridSelectedRowId === currentId) {
            const isMatch = change && (change.path.toString() === this.viewModel.bindingPath.split('/').filter(p => p).toString());
            if (change && change.type === ChangeType.Load && isMatch) {
                this.grid.clearSelections();
                this.grid.selectRow(currentId, true, true);
            }
            return;
        }
        this.selectGridRow(this.bindingList.currentId);
    }
    /**
     * 注册bindingdata变化事件
     */
    registerBindingDataChangeEvent() {
        this.bindingDataChangeEvent = this.bindingData.changes.subscribe((change) => {
            this.onBindingDataChange(change);
        });
        this.viewModel.frameContext.appContext.messagePipe.subscribe(message => {
            if (message === 'bindData') {
                this.bindData();
            }
        });
    }
    /**
     * 取消bindingdata变化订阅
     */
    unRegisterBindingDataChangeEvent() {
        if (this.bindingDataChangeEvent && typeof (this.bindingDataChangeEvent.unsubscribe) === 'function') {
            this.bindingDataChangeEvent.unsubscribe();
        }
    }
    /**
     * 触发页码切换事件
     * @description 本方法适用场景仅为父级grid数据重新load，需要触发该grid重新取数使用。其他场景请勿使用
     * @TODO: 待重构，控制下级数据加载应该依赖表格的行切换事件，临时这样处理，后续提供LoadChildren事件
     */
    updateData(change) {
        if (!(change && (change.type === ChangeType.SelectionChanged || change.type === ChangeType.Load))) {
            return;
        }
        const bindingPath = this.viewModel.bindingPath;
        const eventBindingPath = '/' + change.path.join('/');
        const isRetrieve = this.viewModel.frameContext.appContext.params.get('retrieveing') || false;
        if (change.path.length < 1 || bindingPath === '/' || bindingPath === eventBindingPath || !bindingPath.startsWith(eventBindingPath)) {
            return;
        }
        // retrieve时会自动带回从表第一页及从表第一行的从从表数据，所以不需要再去单独请求
        if (isRetrieve) {
            return;
        }
        const fullPaths = EntityPathConverter.toEntityPathArray(this.viewModel.bindingPath, this.bindingData);
        const paths = fullPaths.slice(0, fullPaths.length - 1);
        const parent = this.bindingList.parent;
        const parentId = parent && parent[parent.primaryKey];
        // 上级表没有数据
        if (!parentId) {
            return;
        }
        // 获取nodecode
        const bindingPaths = this.viewModel.bindingPath.split('/').filter(item => item);
        let nodeCode = bindingPaths[bindingPaths.length - 1];
        nodeCode = nodeCode.substr(0, nodeCode.length - 1);
        // const configPath = `/${nodeCode}_${parentId}`;
        const configPath = `/${nodeCode}`;
        let { pageIndex = 1 } = this.viewModel.frameContext.repository.entityCollection.getPaginationConfigByPath(configPath) || {};
        const { pageSize = 0 } = this.viewModel.frameContext.repository.entityCollection.getPaginationConfigByPath(configPath) || {};
        const parentNodeCode = change.path[change.path.length - 1];
        const parentConfigPath = '/' + parentNodeCode.substring(0, parentNodeCode.length - 1);
        const { pageSize: parentPageSize = 0 } = this.viewModel.frameContext.repository.entityCollection.getPaginationConfigByPath(parentConfigPath) || {};
        const isQueryChild = this.viewModel.frameContext.appContext.params.get('queryChild') || false;
        if (isQueryChild) {
            // this.viewModel.frameContext.appContext.params.delete('queryChild');
            pageIndex = 1;
        }
        // 当上级表切换行时
        if (parentPageSize + pageSize !== 0) {
            this.viewModel.frameContext.appContext.params.set('forceQueryChild', true);
            this.viewModel.frameContext.repository.queryChild(paths, pageIndex, pageSize).pipe(finalize(() => this.viewModel.frameContext.appContext.params.delete('forceQueryChild'))).subscribe();
        }
    }
    ngOnDestroy() {
        this.unRegisterBindingDataChangeEvent();
    }
    // #endregion
    // #region 事件发射器
    /**
     * 发射选中行切换事件
     * @description 统一单选模式和多选模式下的行切换事件
     */
    fireSelectedRowChange(selectedRowContext) {
        this.selectedRowChange.emit(selectedRowContext);
    }
    /**
     * 清空选定行
     * @param change 变更
     */
    clearCheckedRows(change) {
        if (change.type === ChangeType.Load && this.grid.multiSelect) {
            const isMatch = this.checkIfChangeMatchBindingPath(change);
            if (isMatch) {
                this.setChecks([]);
                if (typeof (this.grid.clearCheckeds) === 'function') {
                    this.grid.clearCheckeds();
                }
            }
        }
    }
    // #endregion
    // #region 通信
    /**
     * 设置BindingList的当前行
     * @param id 当前行内码
     */
    setSelectionIdToBindingData(id) {
        // 如果当前行不存在，则强制设置
        if (!id) {
            this.bindingList.currentId = id;
            if (!this.grid.multiSelect) {
                this.setChecks([]);
            }
            return;
        }
        if (this.bindingList.currentId !== id) {
            this.bindingList.setCurrentId(id, true);
        }
        // 单选模式下将当前行设置到ids
        if (!this.grid.multiSelect) {
            this.setChecks([id]);
        }
    }
    updateCheckedRows(changes) {
        if (changes.type === ChangeType.Load) {
            this.setCheckedRows();
        }
        else if (changes.type === ChangeType.ValueChanged) {
            const ids = this.getChecks();
            if (changes.id && ids.includes(changes.id)) {
                this.setCheckedRows();
            }
        }
    }
    /**
     * 设置选择行
     */
    setChecks(ids) {
        this.viewModel.uiState.setPropertyValue('ids', ids);
        this.setCheckedRows(ids);
    }
    /**
     * 获取勾选行id数组
     * @returns
     */
    getChecks() {
        return this.viewModel.uiState['ids'] || [];
    }
    /**
     * 更新勾选行数据
     */
    setCheckedRows(ids) {
        // 高速模式时不再设置rows
        // if (this.viewModel.frameContext.appContext.runMode === RunMode.highSpeed) {
        //   return;
        // }
        if (typeof ids === 'undefined') {
            ids = this.viewModel.uiState['ids'] || [];
        }
        if (!Array.isArray(ids) || ids.length < 1) {
            // 此时ids没有值，rows中也不应该有
            this.viewModel.uiState.setPropertyValue('rows', null);
            return;
        }
        let list = [];
        // TODO：rows中数据在高速模式和普通模式下多语字段的值表现不一致，高速模式下多语字段值为对象，普通模式为当前语言。暂不处理高速模式场景
        if (this.viewModel.frameContext.appContext.runMode === RunMode.highSpeed) {
            list = this.grid.data || [];
        }
        else {
            list = this.bindingList.toJSON({ ignoreMultiLangInput: true });
        }
        const rows = this.viewModel.uiState['rows'] || new Map();
        const result = new Map();
        ids.forEach((id) => {
            const item = list.find(item => item[this.primaryKey] === id);
            const otherPageItem = rows.get(id);
            if (item) {
                result.set(id, item);
            }
            else if (otherPageItem) {
                result.set(id, otherPageItem);
            }
        });
        this.viewModel.uiState.setPropertyValue('rows', result);
    }
    /**
     * 选中grid行
     * @param id id
     */
    selectGridRow(id) {
        this.grid.selectRow(id);
        this.grid.scrollToCurrentRow();
    }
    // #endregion
    // #region 事件处理器
    /**
     * 页码切换事件
     * @param event event
     */
    pageChangedHandler(event) {
        let { pageIndex, pageSize } = event;
        if (pageIndex < 1) {
            pageIndex = 1;
        }
        const skip = (pageIndex - 1) * pageSize;
        this.bindingData.setPagingInfo(skip, pageSize, this.bindingData.bindingPath);
    }
    /**
     * 行切换事件
     * @param event event
     */
    selectedRowChanged(event) {
        const { index, data } = event;
        const id = data[this.primaryKey];
        this.setSelectionIdToBindingData(id);
        this.fireSelectedRowChange(event);
    }
    /**
     * 取消行选择事件
     * @param event event
     */
    unSelected(event) {
        if (!event) {
            return;
        }
        const { data = {} } = event;
        const id = data[this.primaryKey];
        const currentId = this.bindingList.currentId;
        if (id === currentId) {
            this.setSelectionIdToBindingData(null);
        }
        // this.fireSelectedRowChange(event);
    }
    /**
     * 勾选行发生变化
     * @param event event
     */
    checkedChanged(event) {
        event = event || [];
        const ids = event.map(item => item.id);
        this.setChecks(ids);
    }
    /**
     * 分页大小变更事件
     * @param event event
     */
    pageSizeChanged(event) {
        const { pageIndex, pageSize } = event;
        const skip = 0; //(pageIndex - 1) * pageSize;
        // this.bindingList.setPaginationInfo(skip, pageSize);
        this.bindingData.setPagingInfo(skip, pageSize, this.bindingData.bindingPath);
    }
    /**
     * grid滚动加载数据
     * @param event event
     */
    scrollY(event) {
        const { pager: pageIndex, pageSize } = event;
        const skip = (pageIndex - 1) * pageSize;
        this.bindingData.setPagingInfo(skip, pageSize, this.bindingData.bindingPath);
    }
    filterChanged(event) {
        this.filters = event;
    }
    // #endregion
    checkIfChangeMatchBindingPath(change) {
        let isMatch = false;
        if (!change || !change.path) {
            return isMatch;
        }
        const changePathArray = change.path;
        if (!changePathArray) {
            return isMatch;
        }
        if (!(this.bindingData) && !(this.bindingData.bindingPath)) {
            return isMatch;
        }
        const bingdingPathArray = this.bindingData.bindingPath.split('/');
        if (bingdingPathArray.length <= 0) {
            return isMatch;
        }
        if (changePathArray.length === 0) { // 主表
            if (this.bindingData.bindingPath === '/') {
                isMatch = true;
            }
        }
        else if (change.path.length === 1) { // 主从表
            if (bingdingPathArray.length === 2 && bingdingPathArray[1] === change.path[0]) {
                isMatch = true;
            }
        }
        else if (change.path.length === 2) { // 主从从表
            if (bingdingPathArray.length === 3 && bingdingPathArray[1] === change.path[0] && bingdingPathArray[2] === change.path[1]) {
                isMatch = true;
            }
        }
        return isMatch;
    }
}
FarrisDatagridUseBindingDataDirective.decorators = [
    { type: Directive, args: [{
                selector: '[farris-use-binding-data]'
            },] }
];
/** @nocollapse */
FarrisDatagridUseBindingDataDirective.ctorParameters = () => [
    { type: BindingData },
    { type: ViewModel },
    { type: DatagridComponent }
];
FarrisDatagridUseBindingDataDirective.propDecorators = {
    selectedRowChange: [{ type: Output }],
    pageChangedHandler: [{ type: HostListener, args: ['pageChanged', ['$event'],] }],
    selectedRowChanged: [{ type: HostListener, args: ['selectChanged', ['$event'],] }],
    unSelected: [{ type: HostListener, args: ['unSelect', ['$event'],] }],
    checkedChanged: [{ type: HostListener, args: ['checkedChange', ['$event'],] }],
    pageSizeChanged: [{ type: HostListener, args: ['pageSizeChanged', ['$event'],] }],
    scrollY: [{ type: HostListener, args: ['scrollYLoad', ['$event'],] }],
    filterChanged: [{ type: HostListener, args: ['filterChanged', ['$event'],] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmFycmlzLWRhdGFncmlkLXVzZS1iaW5kaW5nLWRhdGEuZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9rZW5kby1iaW5kaW5nLyIsInNvdXJjZXMiOlsibGliL2RpcmVjdGl2ZXMvZmFycmlzLWRhdGFncmlkL2ZhcnJpcy1kYXRhZ3JpZC11c2UtYmluZGluZy1kYXRhLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUErQyxZQUFZLEVBQ3BFLFlBQVksRUFBRSxNQUFNLEVBQ3JCLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxPQUFPLEVBQWdCLE1BQU0sTUFBTSxDQUFDO0FBQzdDLE9BQU8sRUFBRSxXQUFXLEVBQXVCLFVBQVUsRUFBRSxTQUFTLEVBQStDLFlBQVksRUFBaUIsbUJBQW1CLEVBQUUsT0FBTyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDak0sT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDeEQsT0FBTyxFQUFFLFlBQVksRUFBRSxRQUFRLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUN4RCxrQ0FBa0M7QUFFbEM7O0dBRUc7QUFJSCxNQUFNLE9BQU8scUNBQXFDO0lBMkJoRCxZQUFtQixXQUF3QixFQUFTLFNBQW9CLEVBQVMsSUFBdUI7UUFBckYsZ0JBQVcsR0FBWCxXQUFXLENBQWE7UUFBUyxjQUFTLEdBQVQsU0FBUyxDQUFXO1FBQVMsU0FBSSxHQUFKLElBQUksQ0FBbUI7UUF6QnhHLE9BQU87UUFDQyxlQUFVLEdBQVcsSUFBSSxDQUFDO1FBQ2xDLE9BQU87UUFDQyxtQkFBYyxHQUFXLElBQUksQ0FBQztRQUM5QixhQUFRLEdBQVcsSUFBSSxDQUFDO1FBQ2hDOztXQUVHO1FBQ0ssWUFBTyxHQUFRLElBQUksQ0FBQztRQVE1Qjs7V0FFRztRQUNLLHNCQUFpQixHQUFpQixJQUFJLE9BQU8sRUFBTyxDQUFDO1FBQzdEOztXQUVH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cywgT25EZXN0cm95LCBTaW1wbGVDaGFuZ2VzLCBIb3N0TGlzdGVuZXIsXHJcbiAgRXZlbnRFbWl0dGVyLCBPdXRwdXRcclxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgU3ViamVjdCwgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IEJpbmRpbmdEYXRhLCBCaW5kaW5nTGlzdCwgQ2hhbmdlLCBDaGFuZ2VUeXBlLCBWaWV3TW9kZWwsIEFwcENvbnRleHQsIEZyYW1lQ29udGV4dCwgRmllbGRNZXRhZGF0YVV0aWwsIERhdGFUeXBlSW5mbywgQmluZGluZ09iamVjdCwgRW50aXR5UGF0aENvbnZlcnRlciwgUnVuTW9kZSB9IGZyb20gJ0BmYXJyaXMvZGV2a2l0JztcclxuaW1wb3J0IHsgRGF0YWdyaWRDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLWRhdGFncmlkJztcclxuaW1wb3J0IHsgZGVib3VuY2VUaW1lLCBmaW5hbGl6ZSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuLy8gdHNsaW50OmRpc2FibGU6IG1heC1saW5lLWxlbmd0aFxyXG5cclxuLypcclxuICog5L2/55So57uR5a6a5pWw5o2u5oyH5LukXHJcbiAqL1xyXG5ARGlyZWN0aXZlKHtcclxuICBzZWxlY3RvcjogJ1tmYXJyaXMtdXNlLWJpbmRpbmctZGF0YV0nXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBGYXJyaXNEYXRhZ3JpZFVzZUJpbmRpbmdEYXRhRGlyZWN0aXZlIGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMsIE9uRGVzdHJveSB7XHJcbiAgcHJpdmF0ZSBfUFJPUFM6IHsgW3Byb3BOYW1lOiBzdHJpbmddOiBhbnkgfTtcclxuICAvLyDmjpLluo/lrZfmrrVcclxuICBwcml2YXRlIHNvcnRGaWVsZHM6IHN0cmluZyA9IG51bGw7XHJcbiAgLy8g5o6S5bqP5pa55ZCRXHJcbiAgcHJpdmF0ZSBzb3J0RGlyZWN0aW9uczogc3RyaW5nID0gbnVsbDtcclxuICBwcml2YXRlIHBhcmVudElkOiBzdHJpbmcgPSBudWxsO1xyXG4gIC8qKlxyXG4gICAqIOi/h+a7pOadoeS7tlxyXG4gICAqL1xyXG4gIHByaXZhdGUgZmlsdGVyczogYW55ID0gbnVsbDtcclxuICBwcm90ZWN0ZWQgZ2V0IHByb3BzKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX1BST1BTO1xyXG4gIH1cclxuICBwcm90ZWN0ZWQgc2V0IHByb3BzKHZhbHVlKSB7XHJcbiAgICB0aGlzLl9QUk9QUyA9IHZhbHVlO1xyXG4gIH1cclxuICBwcm90ZWN0ZWQgYmluZGluZ0RhdGFDaGFuZ2VFdmVudDogU3Vic2NyaXB0aW9uO1xyXG4gIC8qKlxyXG4gICAqIOa4suafk2dyaWRcclxuICAgKi9cclxuICBwcml2YXRlIHJlbmRlckdyaWRTdWJqZWN0OiBTdWJqZWN0PGFueT4gPSBuZXcgU3ViamVjdDxhbnk+KCk7XHJcbiAgLyoqXHJcbiAgICog6YCJ5Lit6KGM5YiH5o2i5LqL5Lu2XHJcbiAgICovXHJcbiAgQE91dHB1dCgpIHNlbGVjdGVkUm93Q2hhbmdlOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG5cclxuICBjb25zdHJ1Y3RvcihwdWJsaWMgYmluZGluZ0RhdGE6IEJpbmRpbmdEYXRhLCBwdWJsaWMgdmlld01vZGVsOiBWaWV3TW9kZWwsIHB1YmxpYyBncmlkOiBEYXRhZ3JpZENvbXBvbmVudCkge1xyXG4gICAgdGhpcy5zZXRDaGVja3MoW10pO1xyXG4gICAgdGhpcy5yZWdpc3RlckV2ZW50KCk7XHJcbiAgfVxyXG5cclxuICAvLyAjcmVnaW9uIE5nIEV2ZW50XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gICAgY29uc3QgeyBwYWdlU2l6ZSA9IDAgfSA9IHRoaXMuZ2V0UGFnaW5nSW5mbygpIHx8IHt9O1xyXG4gICAgaWYgKHBhZ2VTaXplICE9PSAwKSB7XHJcbiAgICAgIC8vIOWQr+eUqOWIhumhtVxyXG4gICAgICBpZiAoKCF0aGlzLmdyaWQucGFnZUxpc3QgfHwgdGhpcy5ncmlkLnBhZ2VMaXN0Lmxlbmd0aCA8IDEpICYmIHR5cGVvZiB0aGlzLmdyaWRbJ3NldFBhZ2VMaXN0J10gPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICB0aGlzLmdyaWRbJ3NldFBhZ2VMaXN0J10oW3BhZ2VTaXplLCBwYWdlU2l6ZSAqIDIsIHBhZ2VTaXplICogMywgcGFnZVNpemUgKiA0XSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHRoaXMuc2V0Q29tcG9uZW50UmVmKCk7XHJcbiAgICB0aGlzLmJpbmREYXRhKCk7XHJcbiAgICB3aW5kb3cuc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgIHRoaXMudXBkYXRlU2VsZWN0ZWRSb3coKTtcclxuICAgIH0sIDApO1xyXG4gICAgdGhpcy5yZWdpc3RlckJpbmRpbmdEYXRhQ2hhbmdlRXZlbnQoKTtcclxuICAgIHRoaXMucmVuZGVyR3JpZFN1YmplY3QucGlwZShcclxuICAgICAgZGVib3VuY2VUaW1lKDUwMClcclxuICAgICkuc3Vic2NyaWJlKChjaGFuZ2U6IENoYW5nZSkgPT4ge1xyXG4gICAgICBpZiAoIXRoaXMudmlld01vZGVsIHx8ICF0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQgfHwgdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LmlzRGlzcG9zZWQpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5iaW5kRGF0YShjaGFuZ2UpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XHJcbiAgICB0aGlzLmJpbmREYXRhKCk7XHJcbiAgfVxyXG5cclxuICAvLyAjZW5kcmVnaW9uXHJcblxyXG5cclxuICAvKipcclxuICAgKiDkuLvplK5cclxuICAgKi9cclxuICBwcm90ZWN0ZWQgZ2V0IHByaW1hcnlLZXkoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5iaW5kaW5nTGlzdC5wcmltYXJ5S2V5O1xyXG4gIH1cclxuICAvKipcclxuICAgKiDojrflj5bnu5HlrprmlbDmja5cclxuICAgKi9cclxuICBwcm90ZWN0ZWQgZ2V0IGJpbmRpbmdMaXN0KCk6IEJpbmRpbmdMaXN0IHtcclxuICAgIC8vIOagueWunuS9k1xyXG4gICAgaWYgKHRoaXMudmlld01vZGVsLmJpbmRpbmdQYXRoID09PSAnLycgfHwgIXRoaXMudmlld01vZGVsLmJpbmRpbmdQYXRoKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLmJpbmRpbmdEYXRhLmxpc3Q7XHJcbiAgICB9XHJcbiAgICAvLyDlrZDlrp7kvZNcclxuICAgIGxldCBiaW5kaW5nUGF0aCA9IHRoaXMudmlld01vZGVsLmJpbmRpbmdQYXRoLnN1YnN0cigxKTtcclxuICAgIGJpbmRpbmdQYXRoID0gYmluZGluZ1BhdGhbMF0udG9Mb3dlckNhc2UoKSArIGJpbmRpbmdQYXRoLnN1YnN0cmluZygxLCBiaW5kaW5nUGF0aC5sZW5ndGgpO1xyXG4gICAgY29uc3QgcGF0aHMgPSBiaW5kaW5nUGF0aC5zcGxpdCgnLycpO1xyXG5cclxuICAgIGNvbnN0IGZpbHRlcmVkUGF0aHMgPSBwYXRocy5maWx0ZXIoKHBhcnQ6IHN0cmluZykgPT4ge1xyXG4gICAgICByZXR1cm4gcGFydCAhPT0gJyc7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiB0aGlzLmJpbmRpbmdEYXRhLmdldFZhbHVlKGZpbHRlcmVkUGF0aHMpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDorr7nva7nu4Tku7blvJXnlKhcclxuICAgKi9cclxuICBwcml2YXRlIHNldENvbXBvbmVudFJlZigpIHtcclxuICAgIGNvbnN0IGFwcENvbnRleHQgPSB0aGlzLnZpZXdNb2RlbCAmJiB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQgJiYgdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LmdldEZvcm1BcHBDb250ZXh0KCk7XHJcbiAgICBjb25zdCBmcmFtZUlkID0gdGhpcy52aWV3TW9kZWwgJiYgdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0ICYmIHRoaXMudmlld01vZGVsLmZyYW1lQ29udGV4dC5mcmFtZUlkO1xyXG4gICAgY29uc3QgaWQgPSB0aGlzLmdyaWQgJiYgdGhpcy5ncmlkLmlkO1xyXG4gICAgLy8g5aaC5p6cZnJhbWVJZOS4jeWtmOWcqOaIlmZhcnJpcyBncmlk5rKh5pyJaWTlsZ7mgKfvvIzor7TmmI7kuI3nrKblkIjkvb/nlKjlnLrmma9cclxuICAgIGlmICghZnJhbWVJZCB8fCAhaWQpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgY29uc3QgbWFwID0gYXBwQ29udGV4dCAmJiBhcHBDb250ZXh0LmNvbXBvbmVudFJlZnMgJiYgYXBwQ29udGV4dC5jb21wb25lbnRSZWZzLmdldChmcmFtZUlkKSB8fCBuZXcgTWFwPHN0cmluZywgYW55PigpO1xyXG4gICAgYXBwQ29udGV4dCAmJiBhcHBDb250ZXh0LmNvbXBvbmVudFJlZnMgJiYgYXBwQ29udGV4dC5jb21wb25lbnRSZWZzLnNldChmcmFtZUlkLCBtYXAuc2V0KGlkLCB0aGlzLmdyaWQpKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6I635Y+W5YiG6aG15L+h5oGvXHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIGdldFBhZ2luZ0luZm8oKSB7XHJcbiAgICBjb25zdCBiaW5kaW5nUGF0aCA9IHRoaXMudmlld01vZGVsLmJpbmRpbmdQYXRoO1xyXG4gICAgY29uc3QgYmluZGluZ0RhdGEgPSB0aGlzLnZpZXdNb2RlbC5iaW5kaW5nRGF0YTtcclxuICAgIGxldCBwYWdpbmdJbmZvID0gYmluZGluZ0RhdGEgJiYgYmluZGluZ0RhdGEucGFnaW5nSW5mbyB8fCB7fTtcclxuICAgIGlmIChiaW5kaW5nUGF0aCA9PT0gJy8nKSB7XHJcbiAgICAgIHJldHVybiBwYWdpbmdJbmZvO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY29uc3QgYmluZGluZ1BhdGhzID0gYmluZGluZ1BhdGguc3Vic3RyKDEpLnNwbGl0KCcvJykuZmlsdGVyKGl0ZW0gPT4gISFpdGVtICYmIGl0ZW0ubGVuZ3RoID4gMCk7XHJcbiAgICAgIC8vIOS7juihqOWPiuS7juS7juihqOWIhumhteWSjOaVsOaNruaYr+WFs+iBlOeahO+8jOWboOS4uuS4jeWQjOeahOS7juihqOihjOacieS4jeWQjOeahOS7juS7juihqOaVsOaNru+8jOWIhumhteS/oeaBr+eahOe7k+aehOS4um5vZGVDb2RlX3BhcmVudElkOnvliIbpobXkv6Hmga995LiU5YiG6aG15L+h5oGv5piv5bmz57qn55qEXHJcbiAgICAgIC8vIHtwYWdpbmF0aW9uOnthX3BpZDp7cGFnZVNpemU6MixwYWdlSW5kZXg6MX0sYl9waWQ6e3BhZ2VTaXplOjIscGFnZUluZGV4OjF9fX1cclxuICAgICAgLy8g5Y+W5Ye65b2T5YmN6Lev5b6E5LiL5a6e5L2T55qEbm9kZUNvZGVcclxuICAgICAgbGV0IG5vZGVDb2RlID0gYmluZGluZ1BhdGhzW2JpbmRpbmdQYXRocy5sZW5ndGggLSAxXTtcclxuICAgICAgbm9kZUNvZGUgPSBub2RlQ29kZS5zdWJzdHIoMCwgbm9kZUNvZGUubGVuZ3RoIC0gMSk7XHJcbiAgICAgIC8vIOiOt+WPluW9k+WJjeWunuS9k+S4iue6p+eahOS4u+mUrlxyXG4gICAgICAvLyBjb25zdCByZXN1bHQgPSBwYWdpbmdJbmZvW25vZGVDb2RlXSB8fCB7fTtcclxuICAgICAgLy8gaWYgKHJlc3VsdC5oYXNPd25Qcm9wZXJ0eSgndG90YWxDb3VudCcpKSB7XHJcbiAgICAgIC8vICAgcmVzdWx0LnRvdGFsID0gcmVzdWx0LnRvdGFsQ291bnQ7XHJcbiAgICAgIC8vIH1cclxuICAgICAgLy8gcmV0dXJuIHJlc3VsdDtcclxuXHJcbiAgICAgIGNvbnN0IHBhdGhzID0gYmluZGluZ1BhdGhzLnNsaWNlKDAsIGJpbmRpbmdQYXRocy5sZW5ndGggLSAxKTtcclxuICAgICAgY29uc3QgYmluZGluZ0xpc3QgPSBiaW5kaW5nRGF0YS5nZXRWYWx1ZShwYXRocykgYXMgQmluZGluZ0xpc3Q7XHJcbiAgICAgIGNvbnN0IHsgcGFnZVNpemUgPSAwIH0gPSBwYWdpbmdJbmZvW2Ake25vZGVDb2RlfWBdIHx8IHt9O1xyXG4gICAgICAvLyDkuIrnuqfooajmnInmlbDmja5cclxuICAgICAgaWYgKGJpbmRpbmdMaXN0ICYmIGJpbmRpbmdMaXN0LmN1cnJlbnRJZCkge1xyXG4gICAgICAgIGNvbnN0IGtleSA9IGAke25vZGVDb2RlfV8ke2JpbmRpbmdMaXN0LmN1cnJlbnRJZH1gO1xyXG4gICAgICAgIC8vIGNvbnN0IGtleSA9IG5vZGVDb2RlO1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IHBhZ2luZ0luZm9ba2V5XSB8fCB7fTtcclxuICAgICAgICBpZiAocmVzdWx0Lmhhc093blByb3BlcnR5KCd0b3RhbENvdW50JykpIHtcclxuICAgICAgICAgIHJlc3VsdC50b3RhbCA9IHJlc3VsdC50b3RhbENvdW50O1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyDkuIrnuqfooajomb3nhLbmnInmlbDmja7vvIzkvYbkuIrnuqfooajlvZPliY3ooYznmoTkuIvnuqfooajlj6/og73msqHmnInmlbDmja7vvIzov5nlsLHlr7zoh7Tojrflj5bkuI3liLDliIbpobXkv6Hmga/vvIzmiYDku6XpnIDopoHlnKjov5Tlm57liY3lr7nnu5Pmnpzov5vooYzlpITnkIbvvIzlpoLmnpzmsqHmnInliIbpobXkv6Hmga/nmoTor53otbfnoIHlupTor6Xov5Tlm57liIbpobXlpKflsI/lj4rlvZPliY3pobXnoIFcclxuICAgICAgICBpZiAoT2JqZWN0LmtleXMocmVzdWx0KS5sZW5ndGggPCAxKSB7XHJcbiAgICAgICAgICByZXN1bHQucGFnZUluZGV4ID0gMTtcclxuICAgICAgICAgIHJlc3VsdC5wYWdlU2l6ZSA9IHBhZ2VTaXplO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIOS4iue6p+ihqOayoeacieaVsOaNru+8jOatpOaXtumcgOimgeiOt+WPluW9k+WJjeihqOeahOWIhumhteS/oeaBr++8jOWmguWIhumhteWkp+Wwj+OAguW9k+WJjemhtem7mOiupOS4ujHljbPlj6/jgIJcclxuICAgICAgICByZXR1cm4geyBwYWdlSW5kZXg6IDEsIHBhZ2VTaXplIH07XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vICNyZWdpb24gSW5wdXRcclxuICAvKipcclxuICAgKiDnu4Tku7bmmK/lkKbpnIDopoHmm7TmlrBcclxuICAgKiBAcGFyYW0gcHJvcHMg5b2T5YmN5bGe5oCnXHJcbiAgICogQHBhcmFtIG5leHRQcm9wcyDmlrDlsZ7mgKdcclxuICAgKiBAcGFyYW0gY2hhbmdlIOWPmOabtFxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBzaG91bGRDb21wb25lbnRVcGRhdGUoY2hhbmdlOiBDaGFuZ2UsIGRhdGE6IGFueSwpOiB7IHJlc3VsdDogYm9vbGVhbiwgcHJvcHM/OiBhbnkgfSB7XHJcbiAgICBjb25zdCBwcm9wcyA9IHRoaXMuYnVpbGRQcm9wcyhkYXRhKTtcclxuICAgIGlmICh0aGlzLnZpZXdNb2RlbCAmJiB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQgJiYgdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LmFwcENvbnRleHQgJiYgdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LmFwcENvbnRleHQucnVuTW9kZSA9PT0gUnVuTW9kZS5oaWdoU3BlZWQgJiYgY2hhbmdlKSB7XHJcbiAgICAgIGlmIChjaGFuZ2UudHlwZSA9PT0gQ2hhbmdlVHlwZS5Mb2FkIHx8IGNoYW5nZS50eXBlID09PSBDaGFuZ2VUeXBlLlJlbW92ZSB8fCBjaGFuZ2UudHlwZSA9PT0gQ2hhbmdlVHlwZS5QYWdpbmF0aW9uSW5mb0NoYW5nZSkge1xyXG4gICAgICAgIHJldHVybiB7IHJlc3VsdDogdHJ1ZSwgcHJvcHMgfTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgY29uc3QgZ3JpZFByb3BzID0gdGhpcy5idWlsZEdyaWRQcm9wcygpO1xyXG4gICAgaWYgKEpTT04uc3RyaW5naWZ5KHByb3BzKSA9PT0gSlNPTi5zdHJpbmdpZnkoZ3JpZFByb3BzKSkge1xyXG4gICAgICByZXR1cm4geyByZXN1bHQ6IGZhbHNlIH07XHJcbiAgICB9XHJcbiAgICByZXR1cm4geyByZXN1bHQ6IHRydWUsIHByb3BzIH07XHJcbiAgfVxyXG4gIHByb3RlY3RlZCByZWdpc3RlckV2ZW50KCkge1xyXG4gICAgLy8g5o6S5bqP5LqL5Lu2XHJcbiAgICB0aGlzLmdyaWQgJiYgdGhpcy5ncmlkLmNvbHVtblNvcnRlZCAmJiB0aGlzLmdyaWQuY29sdW1uU29ydGVkLnN1YnNjcmliZSgoZXZlbnQ6IGFueSkgPT4ge1xyXG4gICAgICBjb25zdCBpc1JlbW90ZVNvcnQgPSB0aGlzLmdyaWQucmVtb3RlU29ydDtcclxuICAgICAgLy8g5pys5Zyw5o6S5bqPXHJcbiAgICAgIGlmICghaXNSZW1vdGVTb3J0KSB7XHJcbiAgICAgICAgdGhpcy5zb3J0RmllbGRzID0gdGhpcy5ncmlkLnNvcnROYW1lO1xyXG4gICAgICAgIHRoaXMuc29ydERpcmVjdGlvbnMgPSB0aGlzLmdyaWQuc29ydE9yZGVyO1xyXG4gICAgICAgIHRoaXMuc29ydEJpbmRpbmdMaXN0KCk7XHJcbiAgICAgICAgLy8gdGhpcy5wcm9wcyA9IHRoaXMuYnVpbGRQcm9wcygpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIOacjeWKoeWZqOerr+aOkuW6j1xyXG4gICAgICAgIGNvbnN0IGdyb3VwRmllbGQgPSB0aGlzLmdyaWQgJiYgdGhpcy5ncmlkLmdyb3VwRmllbGQgfHwgbnVsbDtcclxuICAgICAgICBsZXQgc29ydEZpZWxkcyA9IHRoaXMuZ3JpZC5zb3J0TmFtZSAmJiB0aGlzLmdyaWQuc29ydE5hbWUuc3BsaXQoJywnKSB8fCBbXTtcclxuICAgICAgICBjb25zdCBzb3J0RGlyZWN0aW9uID0gdGhpcy5ncmlkLnNvcnRPcmRlciAmJiB0aGlzLmdyaWQuc29ydE9yZGVyLnNwbGl0KCcsJykgfHwgW107XHJcbiAgICAgICAgaWYgKGdyb3VwRmllbGQpIHtcclxuICAgICAgICAgIGlmICghc29ydEZpZWxkcy5pbmNsdWRlcyhncm91cEZpZWxkKSkge1xyXG4gICAgICAgICAgICBzb3J0RmllbGRzLnNwbGljZSgwLCAwLCBncm91cEZpZWxkKTtcclxuICAgICAgICAgICAgc29ydERpcmVjdGlvbi5zcGxpY2UoMCwgMCwgJ2FzYycpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICAvLyDojrflj5blvZPliY1lbnRpdHnkuIrmiYDmnIlvYmplY3TlsZ7mgKdcclxuICAgICAgICBjb25zdCBlbnRpdHlUeXBlID0gdGhpcy52aWV3TW9kZWwgJiYgdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LnJlcG9zaXRvcnkuZW50aXR5VHlwZSB8fCBudWxsO1xyXG5cclxuICAgICAgICBpZiAoc29ydEZpZWxkcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICBpZiAoZW50aXR5VHlwZSkge1xyXG4gICAgICAgICAgICBjb25zdCBkYXRhVHlwZUluZm8gPSBuZXcgRGF0YVR5cGVJbmZvKGVudGl0eVR5cGUpO1xyXG4gICAgICAgICAgICBzb3J0RmllbGRzID0gc29ydEZpZWxkcy5tYXAoZmllbGQgPT4ge1xyXG4gICAgICAgICAgICAgIC8vaWYgKGZpZWxkICYmIGZpZWxkLmluZGV4T2YoJy4nKSAhPT0gLTEpIHtcclxuICAgICAgICAgICAgICBjb25zdCBwYXRocyA9IGZpZWxkLnNwbGl0KCcuJyk7XHJcbiAgICAgICAgICAgICAgY29uc3QgcHJvcEluZm8gPSBkYXRhVHlwZUluZm8uZ2V0UHJvcEluZm9CeVBhdGgocGF0aHMpO1xyXG4gICAgICAgICAgICAgIGNvbnN0IG9yaWdpbmFsRmllbGQgPSBwcm9wSW5mbyAmJiBwcm9wSW5mby5tZXRhZGF0YUluZm9bJ3BhdGgnXSB8fCBudWxsO1xyXG4gICAgICAgICAgICAgIHJldHVybiBvcmlnaW5hbEZpZWxkO1xyXG4gICAgICAgICAgICAgIC8vfVxyXG4gICAgICAgICAgICAgIC8vcmV0dXJuIGZpZWxkO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgLy8g6YGN5Y6G5bGe5oCn77yM5qC55o2uZGF0YWZpZWxk6L2s5o2i5Li6b3JpZ2luYWxEYXRhRmllbGRcclxuICAgICAgICBjb25zdCBmaWVsZHMgPSBzb3J0RmllbGRzLmpvaW4oJywnKTtcclxuICAgICAgICBjb25zdCBkaXJlY3Rpb25zID0gc29ydERpcmVjdGlvbi5qb2luKCcsJykgfHwgJ2FzYyc7XHJcbiAgICAgICAgY29uc3QgZnJhbWVDb250ZXh0OiBGcmFtZUNvbnRleHQgPSB0aGlzLnZpZXdNb2RlbCAmJiB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQgfHwgbnVsbDtcclxuICAgICAgICBpZiAoZnJhbWVDb250ZXh0KSB7XHJcbiAgICAgICAgICBmcmFtZUNvbnRleHQucmVwb3NpdG9yeS5zb3J0Q29uZGl0aW9uTWFuYWdlci5zZXRDb25kaXRpb25zKHRoaXMudmlld01vZGVsLmJpbmRpbmdQYXRoLCBmaWVsZHMsIGRpcmVjdGlvbnMpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICAvLyDov4fmu6Tkuovku7ZcclxuICAgIHRoaXMuZ3JpZCAmJiB0aGlzLmdyaWQuZmlsdGVyQ2hhbmdlZCAmJiB0aGlzLmdyaWQuZmlsdGVyQ2hhbmdlZC5zdWJzY3JpYmUoKGV2ZW50OiBhbnkpID0+IHtcclxuICAgICAgdGhpcy5maWx0ZXJzID0gZXZlbnQ7XHJcbiAgICAgIGlmICghdGhpcy5ncmlkLnJlbW90ZUZpbHRlcikge1xyXG4gICAgICAgIGlmICh0aGlzLmJpbmRpbmdMaXN0Lmxlbmd0aCA+IDAgJiYgIXRoaXMuYmluZGluZ0xpc3QuY3VycmVudElkKSB7XHJcbiAgICAgICAgICBjb25zdCBpZCA9IHRoaXMuYmluZGluZ0xpc3QuZ2V0SWRCeUluZGV4KDApO1xyXG4gICAgICAgICAgdGhpcy5iaW5kaW5nTGlzdC5zZXRDdXJyZW50SWQoaWQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmJpbmREYXRhKCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5a+5YmluZGluZ0xpc3TmjpLluo9cclxuICAgKi9cclxuICBwcml2YXRlIHNvcnRCaW5kaW5nTGlzdCgpIHtcclxuICAgIGNvbnN0IGdyb3VwRmllbGQgPSB0aGlzLmdyaWQgJiYgdGhpcy5ncmlkLmdyb3VwRmllbGQgfHwgbnVsbDtcclxuICAgIGlmIChncm91cEZpZWxkKSB7XHJcbiAgICAgIGNvbnN0IGFyclNvcnRGaWVsZHMgPSB0aGlzLnNvcnRGaWVsZHMgJiYgdGhpcy5zb3J0RmllbGRzLnNwbGl0KCcsJykgfHwgW107XHJcbiAgICAgIGlmICghYXJyU29ydEZpZWxkcy5pbmNsdWRlcyhncm91cEZpZWxkKSkge1xyXG4gICAgICAgIGFyclNvcnRGaWVsZHMuc3BsaWNlKDAsIDAsIGdyb3VwRmllbGQpO1xyXG4gICAgICAgIGNvbnN0IGFyclNvcnREaXJlY3Rpb24gPSB0aGlzLnNvcnREaXJlY3Rpb25zICYmIHRoaXMuc29ydERpcmVjdGlvbnMuc3BsaXQoJywnKSB8fCBbXTtcclxuICAgICAgICBhcnJTb3J0RGlyZWN0aW9uLnNwbGljZSgwLCAwLCAnYXNjJyk7XHJcbiAgICAgICAgdGhpcy5zb3J0RmllbGRzID0gYXJyU29ydEZpZWxkcy5qb2luKCcsJyk7XHJcbiAgICAgICAgdGhpcy5zb3J0RGlyZWN0aW9ucyA9IGFyclNvcnREaXJlY3Rpb24uam9pbignLCcpIHx8ICdhc2MnO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5zb3J0RmllbGRzICYmIHRoaXMuc29ydERpcmVjdGlvbnMpIHtcclxuICAgICAgdGhpcy5iaW5kaW5nTGlzdC5zb3J0QnkodGhpcy5zb3J0RmllbGRzLCB0aGlzLnNvcnREaXJlY3Rpb25zKTtcclxuICAgICAgLy8gdGhpcy5wcm9wcyA9IHRoaXMuYnVpbGRQcm9wcygpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5iaW5kRGF0YSgpO1xyXG4gIH1cclxuICAvLyAjZW5kcmVnaW9uXHJcblxyXG4gIC8vICNyZWdpb24g5pWw5o2u57uR5a6a6YOo5YiGXHJcbiAgLyoqXHJcbiAgICog5pu05paw5pWw5o2uXHJcbiAgICogQHBhcmFtIGNoYW5nZT8g5Y+Y5pu0XHJcbiAgICovXHJcbiAgYmluZERhdGEoY2hhbmdlPzogQ2hhbmdlKSB7XHJcbiAgICBjb25zdCBpc1JlbW90ZUZpbHRlciA9IHRoaXMuZ3JpZCAmJiB0aGlzLmdyaWQucmVtb3RlRmlsdGVyIHx8IGZhbHNlO1xyXG4gICAgLy8g5YWI5omn6KGM5o6S5bqPXHJcbiAgICBpZiAodGhpcy5zb3J0RmllbGRzICYmICF0aGlzLmdyaWQuZWRpdGFibGUgJiYgY2hhbmdlICYmIChjaGFuZ2UudHlwZSA9PT0gJ0xvYWQnIHx8IGNoYW5nZS50eXBlID09PSAnU2VsZWN0aW9uQ2hhbmdlZCcpKSB7XHJcbiAgICAgIHRoaXMuc29ydEJpbmRpbmdMaXN0KCk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIC8vIOaWsOWinuaVsOaNruaXtua4heepuuihqOagvOetm+mAieadoeS7tlxyXG4gICAgaWYgKCh0aGlzLmdyaWQuZWRpdGFibGUgPT09IHRydWUgfHwgY2hhbmdlICYmIGNoYW5nZS50eXBlID09PSBDaGFuZ2VUeXBlLkFwcGVuZCkgJiYgdGhpcy5maWx0ZXJzICYmIE9iamVjdC5rZXlzKHRoaXMuZmlsdGVycykubGVuZ3RoID4gMCAmJiAhaXNSZW1vdGVGaWx0ZXIpIHtcclxuICAgICAgdGhpcy5maWx0ZXJzID0ge307XHJcbiAgICAgIHRoaXMuZ3JpZC5jbGVhckNvbmRpdGlvbigpO1xyXG4gICAgfVxyXG4gICAgLy8g5YaNdG9KU09OXHJcbiAgICBsZXQgZGF0YTogYW55ID0gdGhpcy5iaW5kaW5nTGlzdC50b0pTT04oKTtcclxuICAgIGlmICh0aGlzLmZpbHRlcnMgJiYgT2JqZWN0LmtleXModGhpcy5maWx0ZXJzKS5sZW5ndGggPiAwICYmICFpc1JlbW90ZUZpbHRlcikge1xyXG4gICAgICBkYXRhID0gdGhpcy5ncmlkLmNsaWVudEZpbHRlclNlcnZpY2UuZXhlY3V0ZUZpbHRlcihkYXRhLCB0aGlzLmZpbHRlcnMpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0aGlzLmZpbHRlcnMgJiYgT2JqZWN0LmtleXModGhpcy5maWx0ZXJzKS5sZW5ndGggPiAwICYmICFpc1JlbW90ZUZpbHRlciAmJiAoIWNoYW5nZSB8fCBjaGFuZ2UgJiYgY2hhbmdlLnR5cGUgIT09IENoYW5nZVR5cGUuU2VsZWN0aW9uQ2hhbmdlZCAmJiBjaGFuZ2UudHlwZSAhPT0gQ2hhbmdlVHlwZS5HbG9iYWxTZWxlY3Rpb25DaGFuZ2VkKSkge1xyXG4gICAgICBpZiAoZGF0YSAmJiBkYXRhLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAvLyDliKTmlq3lvZPliY3ooYzmmK/lkKblnKjov4fmu6TlkI7nmoTmlbDmja7kuK1cclxuICAgICAgICBjb25zdCByb3cgPSAoZGF0YSBhcyBbXSkuZmluZChpdGVtID0+IGl0ZW1bdGhpcy5iaW5kaW5nTGlzdC5wcmltYXJ5S2V5XSA9PT0gdGhpcy5iaW5kaW5nTGlzdC5jdXJyZW50SWQpO1xyXG4gICAgICAgIGlmICghcm93KSB7XHJcbiAgICAgICAgICBjb25zdCBmaXJzdFJvd0lkID0gZGF0YVswXVt0aGlzLmJpbmRpbmdMaXN0LnByaW1hcnlLZXldO1xyXG4gICAgICAgICAgdGhpcy5iaW5kaW5nTGlzdC5zZXRDdXJyZW50SWQoZmlyc3RSb3dJZCwgdHJ1ZSwgdHJ1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIOacrOWcsOi/h+a7pOWujOS5i+WQjuayoeacieaVsOaNruS6hlxyXG4gICAgICAgIC8vIHRoaXMuYmluZGluZ0xpc3QuY3VycmVudElkID0gbnVsbDtcclxuICAgICAgICB0aGlzLmJpbmRpbmdMaXN0LnNldEN1cnJlbnRJZChudWxsLCB0cnVlLCB0cnVlLCB0cnVlKTtcclxuICAgICAgICAvLyDljZXpgInml7bmuIXnqbppZHNcclxuICAgICAgICBpZiAoIXRoaXMuZ3JpZC5tdWx0aVNlbGVjdCkge1xyXG4gICAgICAgICAgdGhpcy5zZXRDaGVja3MoW10pO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgY29uc3QgcmVzdWx0ID0gdGhpcy5zaG91bGRDb21wb25lbnRVcGRhdGUoY2hhbmdlLCBkYXRhKTtcclxuICAgIGlmICghcmVzdWx0LnJlc3VsdCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICAvLyBjb25zdCBuZXh0UHJvcHMgPSB0aGlzLmJ1aWxkUHJvcHMocmVzdWx0KTtcclxuICAgIHRoaXMucmVuZGVyR3JpZChyZXN1bHQucHJvcHMpO1xyXG4gICAgdGhpcy5wcm9wcyA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkocmVzdWx0LnByb3BzKSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOa4suafk2dyaWRcclxuICAgKiBAcGFyYW0gcHJvcHMg5bGe5oCnXHJcbiAgICovXHJcbiAgcHJpdmF0ZSByZW5kZXJHcmlkKHByb3BzOiBhbnkpIHtcclxuICAgIGNvbnN0IHsgcGFnZUluZGV4LCBwYWdlU2l6ZSwgdG90YWwsIHBhZ2luYXRpb24sIGRhdGEgfSA9IHByb3BzO1xyXG4gICAgY29uc3QgdmlydHVhbGl6ZWRMb2FkID0gdGhpcy5ncmlkLnZpcnR1YWxpemVkQXN5bmNMb2FkIHx8IGZhbHNlO1xyXG4gICAgdGhpcy5ncmlkLnRvdGFsID0gdG90YWw7XHJcbiAgICB0aGlzLmdyaWQucGFnZVNpemUgPSBwYWdlU2l6ZTtcclxuICAgIHRoaXMuZ3JpZC5wYWdlSW5kZXggPSBwYWdlSW5kZXg7XHJcbiAgICB0aGlzLmdyaWQucGFnaW5hdGlvbiA9IHBhZ2luYXRpb247XHJcbiAgICB0aGlzLmdyaWQuY29udHJvbFBhZ2luYXRpb25TdGF0ZSA9IGZhbHNlO1xyXG4gICAgLy8gdGhpcy5lbmRDZWxsRWRpdCgpO1xyXG4gICAgaWYgKHBhZ2VTaXplID09PSAwKSB7XHJcbiAgICAgIHRoaXMuZ3JpZC5wYWdpbmF0aW9uID0gZmFsc2U7XHJcbiAgICAgIHRoaXMuZ3JpZC5wYWdlSW5kZXggPSAxO1xyXG4gICAgICAvLyDkv67lpI3kuI3liIbpobXml7Zncmlk5ZCv55So5YiG57uE5LuN5Lya6YeN5paw6YKm5pWw55qE6Zeu6aKYXHJcbiAgICAgIC8vIHRoaXMuZ3JpZC5wYWdlU2l6ZSA9IHRvdGFsO1xyXG4gICAgfVxyXG4gICAgaWYgKHZpcnR1YWxpemVkTG9hZCkge1xyXG4gICAgICB0aGlzLmdyaWQubG9hZFZpcnR1YWxEYXRhKHtcclxuICAgICAgICBpdGVtczogZGF0YSxcclxuICAgICAgICBwYWdlSW5kZXgsXHJcbiAgICAgICAgcGFnZVNpemUsXHJcbiAgICAgICAgdG90YWxcclxuICAgICAgfSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLmdyaWQubG9hZERhdGEoZGF0YSk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOaehOmAoOihqOagvOaVsOaNruWxnuaAp1xyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBidWlsZFByb3BzKGRhdGFzPzogQXJyYXk8YW55Pikge1xyXG4gICAgbGV0IGRhdGE7XHJcbiAgICBpZiAodHlwZW9mIChkYXRhcykgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgIGRhdGEgPSBkYXRhcztcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGRhdGEgPSB0aGlzLmJpbmRpbmdMaXN0LnRvSlNPTigpO1xyXG4gICAgfVxyXG4gICAgLy8gbGV0IHNraXAgPSAwO1xyXG4gICAgbGV0IHsgcGFnZUluZGV4ID0gMSwgcGFnZVNpemUgPSAwIH0gPSB0aGlzLmdldFBhZ2luZ0luZm8oKSB8fCB7fTtcclxuICAgIGxldCB7IHRvdGFsID0gMCB9ID0gdGhpcy5nZXRQYWdpbmdJbmZvKCkgfHwge307XHJcbiAgICAvLyBpZiAocGFnZUluZGV4ID4gMCkge1xyXG4gICAgLy8gICBza2lwID0gKHBhZ2VJbmRleCAtIDEpICogcGFnZVNpemU7XHJcbiAgICAvLyB9XHJcbiAgICBpZiAocGFnZVNpemUgPT09IDAgJiYgdG90YWwgPT09IDApIHtcclxuICAgICAgdG90YWwgPSBkYXRhLmxlbmd0aDtcclxuICAgIH1cclxuICAgIHJldHVybiB7IGRhdGEsIHBhZ2VJbmRleCwgcGFnZVNpemUsIHRvdGFsLCBwYWdpbmF0aW9uOiBwYWdlU2l6ZSAhPT0gMCB9O1xyXG4gIH1cclxuICAvKipcclxuICAgKiDorqHnrpdncmlk54q25oCBXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBidWlsZEdyaWRQcm9wcygpIHtcclxuICAgIGNvbnN0IGRhdGEgPSB0aGlzLmdyaWQuZGF0YSB8fCBbXTtcclxuICAgIGxldCBza2lwID0gMDtcclxuICAgIGNvbnN0IHsgcGFnZUluZGV4ID0gMSwgcGFnZVNpemUgPSAwIH0gPSB7IHBhZ2VJbmRleDogdGhpcy5ncmlkLnBhZ2VJbmRleCwgcGFnZVNpemU6IHRoaXMuZ3JpZC5wYWdlU2l6ZSB9O1xyXG4gICAgbGV0IHRvdGFsID0gdGhpcy5ncmlkLnRvdGFsIHx8IDA7XHJcbiAgICBpZiAocGFnZUluZGV4ID4gMCkge1xyXG4gICAgICBza2lwID0gKHBhZ2VJbmRleCAtIDEpICogcGFnZVNpemU7XHJcbiAgICB9XHJcbiAgICBpZiAocGFnZVNpemUgPT09IDAgJiYgdG90YWwgPT09IDApIHtcclxuICAgICAgdG90YWwgPSBkYXRhLmxlbmd0aDtcclxuICAgIH1cclxuICAgIHJldHVybiB7IGRhdGEsIHBhZ2VJbmRleCwgcGFnZVNpemUsIHRvdGFsLCBwYWdpbmF0aW9uOiB0aGlzLmdyaWQucGFnaW5hdGlvbiB9O1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmlbDmja7mupDlj5HnlJ/lj5jmm7RcclxuICAgKiBAcGFyYW0gY2hhbmdlIOWPmOabtFxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBvbkJpbmRpbmdEYXRhQ2hhbmdlKGNoYW5nZTogQ2hhbmdlKSB7XHJcbiAgICB0aGlzLnVwZGF0ZURhdGFTb3VyY2UoY2hhbmdlKTtcclxuICAgIHRoaXMudXBkYXRlU2VsZWN0ZWRSb3coY2hhbmdlKTtcclxuICAgIC8vIHRoaXMudXBkYXRlR3JpZChjaGFuZ2UpO1xyXG4gICAgLy8g5LiN5riF6Zmk5Yu+6YCJ6KGM77yM6ZyA6KaB5L+d55WZ5Yu+6YCJ54q25oCBXHJcbiAgICAvLyB0aGlzLmNsZWFyQ2hlY2tlZFJvd3MoY2hhbmdlKTtcclxuICAgIHRoaXMuZW5kQ2VsbEVkaXQoY2hhbmdlKTtcclxuICAgIC8vIOabtOaWsOWLvumAieihjOaVsOaNrlxyXG4gICAgdGhpcy51cGRhdGVDaGVja2VkUm93cyhjaGFuZ2UpO1xyXG4gICAgdGhpcy51cGRhdGVEYXRhKGNoYW5nZSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOabtOaWsOaVsOaNrlxyXG4gICAqL1xyXG4gIHByaXZhdGUgdXBkYXRlRGF0YVNvdXJjZShjaGFuZ2U6IENoYW5nZSkge1xyXG4gICAgLyppZiAoY2hhbmdlKSB7XHJcbiAgICAgIGNvbnN0IGlzTWF0Y2ggPSB0aGlzLmNoZWNrSWZDaGFuZ2VNYXRjaEJpbmRpbmdQYXRoKGNoYW5nZSk7XHJcbiAgICAgIGlmICghaXNNYXRjaCkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgfSovXHJcbiAgICBpZiAoY2hhbmdlICYmIGNoYW5nZS50eXBlID09PSBDaGFuZ2VUeXBlLlZhbHVlQ2hhbmdlZCkge1xyXG4gICAgICB0aGlzLnJlbmRlckdyaWRTdWJqZWN0Lm5leHQoY2hhbmdlKTtcclxuICAgIH0gZWxzZSBpZiAoY2hhbmdlICYmIChjaGFuZ2UudHlwZSA9PT0gQ2hhbmdlVHlwZS5TZWxlY3Rpb25DaGFuZ2VkIHx8IGNoYW5nZS50eXBlID09PSBDaGFuZ2VUeXBlLkdsb2JhbFNlbGVjdGlvbkNoYW5nZWQpKSB7XHJcbiAgICAgIGlmICh0aGlzLmJpbmRpbmdMaXN0LmN1cnJlbnRJZCA9PT0gKHRoaXMuZ3JpZC5zZWxlY3RlZFJvdyAmJiB0aGlzLmdyaWQuc2VsZWN0ZWRSb3cuaWQpICYmIHRoaXMuZ3JpZC50b3RhbCA+IDApIHtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLmJpbmREYXRhKGNoYW5nZSk7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuYmluZERhdGEoY2hhbmdlKTtcclxuICAgIH1cclxuICB9XHJcbiAgLy8gcHJpdmF0ZSBlbmRDZWxsRWRpdCgpIHtcclxuICAvLyAgIGNvbnN0IGlzRWRpdGluZyA9IHRoaXMuZ3JpZC5pc0VkaXRpbmcoKTtcclxuICAvLyAgIGlmIChpc0VkaXRpbmcpIHtcclxuICAvLyAgICAgdGhpcy5ncmlkLmVuZENlbGxFZGl0KCk7XHJcbiAgLy8gICB9XHJcbiAgLy8gfVxyXG4gIHByaXZhdGUgZW5kQ2VsbEVkaXQoY2hhbmdlOiBDaGFuZ2UpIHtcclxuICAgIGNvbnN0IGlzRWRpdGluZyA9IHRoaXMuZ3JpZC5pc0VkaXRpbmcoKTtcclxuICAgIGlmIChjaGFuZ2UudHlwZSA9PT0gQ2hhbmdlVHlwZS5Mb2FkICYmIGlzRWRpdGluZykge1xyXG4gICAgICB0aGlzLmdyaWQuZW5kQ2VsbEVkaXQoKTtcclxuICAgIH1cclxuICB9XHJcbiAgLyoqXHJcbiAgICog6K6+572uZ3JpZOW9k+WJjemAieaLqeihjFxyXG4gICAqIEBwYXJhbSBjaGFuZ2Ug5Y+Y5pu0XHJcbiAgICovXHJcbiAgcHJpdmF0ZSB1cGRhdGVTZWxlY3RlZFJvdyhjaGFuZ2U/OiBDaGFuZ2UpIHtcclxuICAgIGlmICghdGhpcy5iaW5kaW5nTGlzdCB8fCAhdGhpcy5iaW5kaW5nTGlzdC5jdXJyZW50SWQpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgLy8g6aG156CB5YiH5o2i5pe25LiN5omn6KGM5b2T5YmN6KGM5YiH5o2iXHJcbiAgICBpZiAoY2hhbmdlICYmIGNoYW5nZS50eXBlID09PSBDaGFuZ2VUeXBlLlBhZ2luYXRpb25JbmZvQ2hhbmdlKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLnZpZXdNb2RlbCAmJiB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQuYmluZGluZ0RhdGEucm93U2VsZWN0ZWRFdmVudFN1c3BlbmQgPT09IHRydWUpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgY29uc3QgeyBpZDogZ3JpZFNlbGVjdGVkUm93SWQgPSBudWxsIH0gPSB0aGlzLmdyaWQuc2VsZWN0ZWRSb3cgfHwge307XHJcbiAgICBjb25zdCBjdXJyZW50SWQgPSB0aGlzLmJpbmRpbmdMaXN0LmN1cnJlbnRJZDtcclxuICAgIC8vIGdyaWTlvZPliY3ooYzkuI5iaW5naW5nTGlzdOW9k+WJjeihjOS4gOiHtO+8jOaXoOmhu+WIh+aNolxyXG4gICAgaWYgKGdyaWRTZWxlY3RlZFJvd0lkID09PSBjdXJyZW50SWQpIHtcclxuICAgICAgY29uc3QgaXNNYXRjaCA9IGNoYW5nZSAmJiAoY2hhbmdlLnBhdGgudG9TdHJpbmcoKSA9PT0gdGhpcy52aWV3TW9kZWwuYmluZGluZ1BhdGguc3BsaXQoJy8nKS5maWx0ZXIocCA9PiBwKS50b1N0cmluZygpKTtcclxuICAgICAgaWYgKGNoYW5nZSAmJiBjaGFuZ2UudHlwZSA9PT0gQ2hhbmdlVHlwZS5Mb2FkICYmIGlzTWF0Y2gpIHtcclxuICAgICAgICB0aGlzLmdyaWQuY2xlYXJTZWxlY3Rpb25zKCk7XHJcbiAgICAgICAgdGhpcy5ncmlkLnNlbGVjdFJvdyhjdXJyZW50SWQsIHRydWUsIHRydWUpO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHRoaXMuc2VsZWN0R3JpZFJvdyh0aGlzLmJpbmRpbmdMaXN0LmN1cnJlbnRJZCk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOazqOWGjGJpbmRpbmdkYXRh5Y+Y5YyW5LqL5Lu2XHJcbiAgICovXHJcbiAgcHJpdmF0ZSByZWdpc3RlckJpbmRpbmdEYXRhQ2hhbmdlRXZlbnQoKSB7XHJcbiAgICB0aGlzLmJpbmRpbmdEYXRhQ2hhbmdlRXZlbnQgPSB0aGlzLmJpbmRpbmdEYXRhLmNoYW5nZXMuc3Vic2NyaWJlKChjaGFuZ2U6IENoYW5nZSkgPT4ge1xyXG4gICAgICB0aGlzLm9uQmluZGluZ0RhdGFDaGFuZ2UoY2hhbmdlKTtcclxuICAgIH0pO1xyXG4gICAgdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LmFwcENvbnRleHQubWVzc2FnZVBpcGUuc3Vic2NyaWJlKG1lc3NhZ2UgPT4ge1xyXG4gICAgICBpZiAobWVzc2FnZSA9PT0gJ2JpbmREYXRhJykge1xyXG4gICAgICAgIHRoaXMuYmluZERhdGEoKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWPlua2iGJpbmRpbmdkYXRh5Y+Y5YyW6K6i6ZiFXHJcbiAgICovXHJcbiAgcHJpdmF0ZSB1blJlZ2lzdGVyQmluZGluZ0RhdGFDaGFuZ2VFdmVudCgpIHtcclxuICAgIGlmICh0aGlzLmJpbmRpbmdEYXRhQ2hhbmdlRXZlbnQgJiYgdHlwZW9mICh0aGlzLmJpbmRpbmdEYXRhQ2hhbmdlRXZlbnQudW5zdWJzY3JpYmUpID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgIHRoaXMuYmluZGluZ0RhdGFDaGFuZ2VFdmVudC51bnN1YnNjcmliZSgpO1xyXG4gICAgfVxyXG4gIH1cclxuICAvKipcclxuICAgKiDop6blj5HpobXnoIHliIfmjaLkuovku7ZcclxuICAgKiBAZGVzY3JpcHRpb24g5pys5pa55rOV6YCC55So5Zy65pmv5LuF5Li654i257qnZ3JpZOaVsOaNrumHjeaWsGxvYWTvvIzpnIDopoHop6blj5Hor6Vncmlk6YeN5paw5Y+W5pWw5L2/55So44CC5YW25LuW5Zy65pmv6K+35Yu/5L2/55SoXHJcbiAgICogQFRPRE86IOW+hemHjeaehO+8jOaOp+WItuS4i+e6p+aVsOaNruWKoOi9veW6lOivpeS+nei1luihqOagvOeahOihjOWIh+aNouS6i+S7tu+8jOS4tOaXtui/meagt+WkhOeQhu+8jOWQjue7reaPkOS+m0xvYWRDaGlsZHJlbuS6i+S7tlxyXG4gICAqL1xyXG4gIHByaXZhdGUgdXBkYXRlRGF0YShjaGFuZ2U/OiBDaGFuZ2UpIHtcclxuICAgIGlmICghKGNoYW5nZSAmJiAoY2hhbmdlLnR5cGUgPT09IENoYW5nZVR5cGUuU2VsZWN0aW9uQ2hhbmdlZCB8fCBjaGFuZ2UudHlwZSA9PT0gQ2hhbmdlVHlwZS5Mb2FkKSkpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgY29uc3QgYmluZGluZ1BhdGggPSB0aGlzLnZpZXdNb2RlbC5iaW5kaW5nUGF0aDtcclxuICAgIGNvbnN0IGV2ZW50QmluZGluZ1BhdGggPSAnLycgKyBjaGFuZ2UucGF0aC5qb2luKCcvJyk7XHJcbiAgICBjb25zdCBpc1JldHJpZXZlID0gdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LmFwcENvbnRleHQucGFyYW1zLmdldCgncmV0cmlldmVpbmcnKSB8fCBmYWxzZTtcclxuICAgIGlmIChjaGFuZ2UucGF0aC5sZW5ndGggPCAxIHx8IGJpbmRpbmdQYXRoID09PSAnLycgfHwgYmluZGluZ1BhdGggPT09IGV2ZW50QmluZGluZ1BhdGggfHwgIWJpbmRpbmdQYXRoLnN0YXJ0c1dpdGgoZXZlbnRCaW5kaW5nUGF0aCkpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgLy8gcmV0cmlldmXml7bkvJroh6rliqjluKblm57ku47ooajnrKzkuIDpobXlj4rku47ooajnrKzkuIDooYznmoTku47ku47ooajmlbDmja7vvIzmiYDku6XkuI3pnIDopoHlho3ljrvljZXni6zor7fmsYJcclxuICAgIGlmIChpc1JldHJpZXZlKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGNvbnN0IGZ1bGxQYXRocyA9IEVudGl0eVBhdGhDb252ZXJ0ZXIudG9FbnRpdHlQYXRoQXJyYXkodGhpcy52aWV3TW9kZWwuYmluZGluZ1BhdGgsIHRoaXMuYmluZGluZ0RhdGEpO1xyXG4gICAgY29uc3QgcGF0aHMgPSBmdWxsUGF0aHMuc2xpY2UoMCwgZnVsbFBhdGhzLmxlbmd0aCAtIDEpO1xyXG4gICAgY29uc3QgcGFyZW50ID0gdGhpcy5iaW5kaW5nTGlzdC5wYXJlbnQ7XHJcbiAgICBjb25zdCBwYXJlbnRJZCA9IHBhcmVudCAmJiBwYXJlbnRbcGFyZW50LnByaW1hcnlLZXldO1xyXG4gICAgLy8g5LiK57qn6KGo5rKh5pyJ5pWw5o2uXHJcbiAgICBpZiAoIXBhcmVudElkKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIC8vIOiOt+WPlm5vZGVjb2RlXHJcbiAgICBjb25zdCBiaW5kaW5nUGF0aHMgPSB0aGlzLnZpZXdNb2RlbC5iaW5kaW5nUGF0aC5zcGxpdCgnLycpLmZpbHRlcihpdGVtID0+IGl0ZW0pO1xyXG4gICAgbGV0IG5vZGVDb2RlID0gYmluZGluZ1BhdGhzW2JpbmRpbmdQYXRocy5sZW5ndGggLSAxXTtcclxuICAgIG5vZGVDb2RlID0gbm9kZUNvZGUuc3Vic3RyKDAsIG5vZGVDb2RlLmxlbmd0aCAtIDEpO1xyXG4gICAgLy8gY29uc3QgY29uZmlnUGF0aCA9IGAvJHtub2RlQ29kZX1fJHtwYXJlbnRJZH1gO1xyXG4gICAgY29uc3QgY29uZmlnUGF0aCA9IGAvJHtub2RlQ29kZX1gO1xyXG4gICAgbGV0IHsgcGFnZUluZGV4ID0gMSB9ID0gdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5nZXRQYWdpbmF0aW9uQ29uZmlnQnlQYXRoKGNvbmZpZ1BhdGgpIHx8IHt9O1xyXG4gICAgY29uc3QgeyBwYWdlU2l6ZSA9IDAgfSA9IHRoaXMudmlld01vZGVsLmZyYW1lQ29udGV4dC5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24uZ2V0UGFnaW5hdGlvbkNvbmZpZ0J5UGF0aChjb25maWdQYXRoKSB8fCB7fTtcclxuXHJcbiAgICBjb25zdCBwYXJlbnROb2RlQ29kZSA9IGNoYW5nZS5wYXRoW2NoYW5nZS5wYXRoLmxlbmd0aCAtIDFdO1xyXG4gICAgY29uc3QgcGFyZW50Q29uZmlnUGF0aCA9ICcvJyArIHBhcmVudE5vZGVDb2RlLnN1YnN0cmluZygwLCBwYXJlbnROb2RlQ29kZS5sZW5ndGggLSAxKTtcclxuICAgIGNvbnN0IHsgcGFnZVNpemU6IHBhcmVudFBhZ2VTaXplID0gMCB9ID0gdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5nZXRQYWdpbmF0aW9uQ29uZmlnQnlQYXRoKHBhcmVudENvbmZpZ1BhdGgpIHx8IHt9O1xyXG4gICAgY29uc3QgaXNRdWVyeUNoaWxkID0gdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LmFwcENvbnRleHQucGFyYW1zLmdldCgncXVlcnlDaGlsZCcpIHx8IGZhbHNlO1xyXG4gICAgaWYgKGlzUXVlcnlDaGlsZCkge1xyXG4gICAgICAvLyB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQuYXBwQ29udGV4dC5wYXJhbXMuZGVsZXRlKCdxdWVyeUNoaWxkJyk7XHJcbiAgICAgIHBhZ2VJbmRleCA9IDE7XHJcbiAgICB9XHJcbiAgICAvLyDlvZPkuIrnuqfooajliIfmjaLooYzml7ZcclxuICAgIGlmIChwYXJlbnRQYWdlU2l6ZSArIHBhZ2VTaXplICE9PSAwKSB7XHJcbiAgICAgIHRoaXMudmlld01vZGVsLmZyYW1lQ29udGV4dC5hcHBDb250ZXh0LnBhcmFtcy5zZXQoJ2ZvcmNlUXVlcnlDaGlsZCcsIHRydWUpO1xyXG4gICAgICB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQucmVwb3NpdG9yeS5xdWVyeUNoaWxkKHBhdGhzLCBwYWdlSW5kZXgsIHBhZ2VTaXplKS5waXBlKFxyXG4gICAgICAgIGZpbmFsaXplKCgpID0+IHRoaXMudmlld01vZGVsLmZyYW1lQ29udGV4dC5hcHBDb250ZXh0LnBhcmFtcy5kZWxldGUoJ2ZvcmNlUXVlcnlDaGlsZCcpKVxyXG4gICAgICApLnN1YnNjcmliZSgpO1xyXG4gICAgfVxyXG4gIH1cclxuICBuZ09uRGVzdHJveSgpIHtcclxuICAgIHRoaXMudW5SZWdpc3RlckJpbmRpbmdEYXRhQ2hhbmdlRXZlbnQoKTtcclxuICB9XHJcbiAgLy8gI2VuZHJlZ2lvblxyXG5cclxuICAvLyAjcmVnaW9uIOS6i+S7tuWPkeWwhOWZqFxyXG5cclxuICAvKipcclxuICAgKiDlj5HlsITpgInkuK3ooYzliIfmjaLkuovku7ZcclxuICAgKiBAZGVzY3JpcHRpb24g57uf5LiA5Y2V6YCJ5qih5byP5ZKM5aSa6YCJ5qih5byP5LiL55qE6KGM5YiH5o2i5LqL5Lu2XHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIGZpcmVTZWxlY3RlZFJvd0NoYW5nZShzZWxlY3RlZFJvd0NvbnRleHQ6IGFueSkge1xyXG4gICAgdGhpcy5zZWxlY3RlZFJvd0NoYW5nZS5lbWl0KHNlbGVjdGVkUm93Q29udGV4dCk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOa4heepuumAieWumuihjFxyXG4gICAqIEBwYXJhbSBjaGFuZ2Ug5Y+Y5pu0XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBjbGVhckNoZWNrZWRSb3dzKGNoYW5nZTogQ2hhbmdlKSB7XHJcbiAgICBpZiAoY2hhbmdlLnR5cGUgPT09IENoYW5nZVR5cGUuTG9hZCAmJiB0aGlzLmdyaWQubXVsdGlTZWxlY3QpIHtcclxuICAgICAgY29uc3QgaXNNYXRjaCA9IHRoaXMuY2hlY2tJZkNoYW5nZU1hdGNoQmluZGluZ1BhdGgoY2hhbmdlKTtcclxuICAgICAgaWYgKGlzTWF0Y2gpIHtcclxuICAgICAgICB0aGlzLnNldENoZWNrcyhbXSk7XHJcbiAgICAgICAgaWYgKHR5cGVvZiAodGhpcy5ncmlkLmNsZWFyQ2hlY2tlZHMpID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICB0aGlzLmdyaWQuY2xlYXJDaGVja2VkcygpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gI2VuZHJlZ2lvblxyXG5cclxuXHJcblxyXG4gIC8vICNyZWdpb24g6YCa5L+hXHJcblxyXG4gIC8qKlxyXG4gICAqIOiuvue9rkJpbmRpbmdMaXN055qE5b2T5YmN6KGMXHJcbiAgICogQHBhcmFtIGlkIOW9k+WJjeihjOWGheeggVxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBzZXRTZWxlY3Rpb25JZFRvQmluZGluZ0RhdGEoaWQ6IHN0cmluZyk6IHZvaWQge1xyXG4gICAgLy8g5aaC5p6c5b2T5YmN6KGM5LiN5a2Y5Zyo77yM5YiZ5by65Yi26K6+572uXHJcbiAgICBpZiAoIWlkKSB7XHJcbiAgICAgIHRoaXMuYmluZGluZ0xpc3QuY3VycmVudElkID0gaWQ7XHJcbiAgICAgIGlmICghdGhpcy5ncmlkLm11bHRpU2VsZWN0KSB7XHJcbiAgICAgICAgdGhpcy5zZXRDaGVja3MoW10pO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLmJpbmRpbmdMaXN0LmN1cnJlbnRJZCAhPT0gaWQpIHtcclxuICAgICAgdGhpcy5iaW5kaW5nTGlzdC5zZXRDdXJyZW50SWQoaWQsIHRydWUpO1xyXG4gICAgfVxyXG4gICAgLy8g5Y2V6YCJ5qih5byP5LiL5bCG5b2T5YmN6KGM6K6+572u5YiwaWRzXHJcbiAgICBpZiAoIXRoaXMuZ3JpZC5tdWx0aVNlbGVjdCkge1xyXG4gICAgICB0aGlzLnNldENoZWNrcyhbaWRdKTtcclxuICAgIH1cclxuICB9XHJcbiAgcHJpdmF0ZSB1cGRhdGVDaGVja2VkUm93cyhjaGFuZ2VzOiBDaGFuZ2UpIHtcclxuICAgIGlmIChjaGFuZ2VzLnR5cGUgPT09IENoYW5nZVR5cGUuTG9hZCkge1xyXG4gICAgICB0aGlzLnNldENoZWNrZWRSb3dzKCk7XHJcbiAgICB9IGVsc2UgaWYgKGNoYW5nZXMudHlwZSA9PT0gQ2hhbmdlVHlwZS5WYWx1ZUNoYW5nZWQpIHtcclxuICAgICAgY29uc3QgaWRzID0gdGhpcy5nZXRDaGVja3MoKTtcclxuICAgICAgaWYgKGNoYW5nZXMuaWQgJiYgaWRzLmluY2x1ZGVzKGNoYW5nZXMuaWQpKSB7XHJcbiAgICAgICAgdGhpcy5zZXRDaGVja2VkUm93cygpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiuvue9rumAieaLqeihjFxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBzZXRDaGVja3MoaWRzOiBzdHJpbmdbXSkge1xyXG4gICAgdGhpcy52aWV3TW9kZWwudWlTdGF0ZS5zZXRQcm9wZXJ0eVZhbHVlKCdpZHMnLCBpZHMpO1xyXG4gICAgdGhpcy5zZXRDaGVja2VkUm93cyhpZHMpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDojrflj5bli77pgInooYxpZOaVsOe7hFxyXG4gICAqIEByZXR1cm5zIFxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBnZXRDaGVja3MoKTogc3RyaW5nW10ge1xyXG4gICAgcmV0dXJuIHRoaXMudmlld01vZGVsLnVpU3RhdGVbJ2lkcyddIHx8IFtdO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmm7TmlrDli77pgInooYzmlbDmja5cclxuICAgKi9cclxuICBwcm90ZWN0ZWQgc2V0Q2hlY2tlZFJvd3MoaWRzPzogc3RyaW5nW10pIHtcclxuICAgIC8vIOmrmOmAn+aooeW8j+aXtuS4jeWGjeiuvue9rnJvd3NcclxuICAgIC8vIGlmICh0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQuYXBwQ29udGV4dC5ydW5Nb2RlID09PSBSdW5Nb2RlLmhpZ2hTcGVlZCkge1xyXG4gICAgLy8gICByZXR1cm47XHJcbiAgICAvLyB9XHJcbiAgICBpZiAodHlwZW9mIGlkcyA9PT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgaWRzID0gdGhpcy52aWV3TW9kZWwudWlTdGF0ZVsnaWRzJ10gfHwgW107XHJcbiAgICB9XHJcbiAgICBpZiAoIUFycmF5LmlzQXJyYXkoaWRzKSB8fCBpZHMubGVuZ3RoIDwgMSkge1xyXG4gICAgICAvLyDmraTml7ZpZHPmsqHmnInlgLzvvIxyb3dz5Lit5Lmf5LiN5bqU6K+l5pyJXHJcbiAgICAgIHRoaXMudmlld01vZGVsLnVpU3RhdGUuc2V0UHJvcGVydHlWYWx1ZSgncm93cycsIG51bGwpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBsZXQgbGlzdCA9IFtdO1xyXG4gICAgLy8gVE9ET++8mnJvd3PkuK3mlbDmja7lnKjpq5jpgJ/mqKHlvI/lkozmma7pgJrmqKHlvI/kuIvlpJror63lrZfmrrXnmoTlgLzooajnjrDkuI3kuIDoh7TvvIzpq5jpgJ/mqKHlvI/kuIvlpJror63lrZfmrrXlgLzkuLrlr7nosaHvvIzmma7pgJrmqKHlvI/kuLrlvZPliY3or63oqIDjgILmmoLkuI3lpITnkIbpq5jpgJ/mqKHlvI/lnLrmma9cclxuICAgIGlmICh0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQuYXBwQ29udGV4dC5ydW5Nb2RlID09PSBSdW5Nb2RlLmhpZ2hTcGVlZCkge1xyXG4gICAgICBsaXN0ID0gdGhpcy5ncmlkLmRhdGEgfHwgW107XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBsaXN0ID0gdGhpcy5iaW5kaW5nTGlzdC50b0pTT04oe2lnbm9yZU11bHRpTGFuZ0lucHV0OiB0cnVlfSk7XHJcbiAgICB9XHJcbiAgICBjb25zdCByb3dzOiBNYXA8c3RyaW5nLCBhbnk+ID0gdGhpcy52aWV3TW9kZWwudWlTdGF0ZVsncm93cyddIHx8IG5ldyBNYXA8c3RyaW5nLCBhbnk+KCk7XHJcblxyXG4gICAgY29uc3QgcmVzdWx0ID0gbmV3IE1hcDxzdHJpbmcsIGFueT4oKTtcclxuICAgIGlkcy5mb3JFYWNoKChpZDogYW55KSA9PiB7XHJcbiAgICAgIGNvbnN0IGl0ZW0gPSBsaXN0LmZpbmQoaXRlbSA9PiBpdGVtW3RoaXMucHJpbWFyeUtleV0gPT09IGlkKTtcclxuICAgICAgY29uc3Qgb3RoZXJQYWdlSXRlbSA9IHJvd3MuZ2V0KGlkKTtcclxuICAgICAgaWYgKGl0ZW0pIHtcclxuICAgICAgICByZXN1bHQuc2V0KGlkLCBpdGVtKTtcclxuICAgICAgfSBlbHNlIGlmIChvdGhlclBhZ2VJdGVtKSB7XHJcbiAgICAgICAgcmVzdWx0LnNldChpZCwgb3RoZXJQYWdlSXRlbSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgdGhpcy52aWV3TW9kZWwudWlTdGF0ZS5zZXRQcm9wZXJ0eVZhbHVlKCdyb3dzJywgcmVzdWx0KTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6YCJ5LitZ3JpZOihjFxyXG4gICAqIEBwYXJhbSBpZCBpZFxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBzZWxlY3RHcmlkUm93KGlkOiBhbnkpIHtcclxuICAgIHRoaXMuZ3JpZC5zZWxlY3RSb3coaWQpO1xyXG4gICAgdGhpcy5ncmlkLnNjcm9sbFRvQ3VycmVudFJvdygpO1xyXG4gIH1cclxuICAvLyAjZW5kcmVnaW9uXHJcbiAgLy8gI3JlZ2lvbiDkuovku7blpITnkIblmahcclxuXHJcbiAgLyoqXHJcbiAgICog6aG156CB5YiH5o2i5LqL5Lu2XHJcbiAgICogQHBhcmFtIGV2ZW50IGV2ZW50XHJcbiAgICovXHJcbiAgQEhvc3RMaXN0ZW5lcigncGFnZUNoYW5nZWQnLCBbJyRldmVudCddKVxyXG4gIHB1YmxpYyBwYWdlQ2hhbmdlZEhhbmRsZXIoZXZlbnQ6IGFueSkge1xyXG4gICAgbGV0IHsgcGFnZUluZGV4LCBwYWdlU2l6ZSB9ID0gZXZlbnQ7XHJcbiAgICBpZiAocGFnZUluZGV4IDwgMSkge1xyXG4gICAgICBwYWdlSW5kZXggPSAxO1xyXG4gICAgfVxyXG4gICAgY29uc3Qgc2tpcCA9IChwYWdlSW5kZXggLSAxKSAqIHBhZ2VTaXplO1xyXG4gICAgdGhpcy5iaW5kaW5nRGF0YS5zZXRQYWdpbmdJbmZvKHNraXAsIHBhZ2VTaXplLCB0aGlzLmJpbmRpbmdEYXRhLmJpbmRpbmdQYXRoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOihjOWIh+aNouS6i+S7tlxyXG4gICAqIEBwYXJhbSBldmVudCBldmVudFxyXG4gICAqL1xyXG4gIEBIb3N0TGlzdGVuZXIoJ3NlbGVjdENoYW5nZWQnLCBbJyRldmVudCddKVxyXG4gIHB1YmxpYyBzZWxlY3RlZFJvd0NoYW5nZWQoZXZlbnQ6IGFueSkge1xyXG4gICAgY29uc3QgeyBpbmRleCwgZGF0YSB9ID0gZXZlbnQ7XHJcbiAgICBjb25zdCBpZCA9IGRhdGFbdGhpcy5wcmltYXJ5S2V5XTtcclxuICAgIHRoaXMuc2V0U2VsZWN0aW9uSWRUb0JpbmRpbmdEYXRhKGlkKTtcclxuICAgIHRoaXMuZmlyZVNlbGVjdGVkUm93Q2hhbmdlKGV2ZW50KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWPlua2iOihjOmAieaLqeS6i+S7tlxyXG4gICAqIEBwYXJhbSBldmVudCBldmVudFxyXG4gICAqL1xyXG4gIEBIb3N0TGlzdGVuZXIoJ3VuU2VsZWN0JywgWyckZXZlbnQnXSlcclxuICBwdWJsaWMgdW5TZWxlY3RlZChldmVudDogYW55KSB7XHJcbiAgICBpZiAoIWV2ZW50KSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGNvbnN0IHsgZGF0YSA9IHt9IH0gPSBldmVudDtcclxuICAgIGNvbnN0IGlkID0gZGF0YVt0aGlzLnByaW1hcnlLZXldO1xyXG4gICAgY29uc3QgY3VycmVudElkID0gdGhpcy5iaW5kaW5nTGlzdC5jdXJyZW50SWQ7XHJcbiAgICBpZiAoaWQgPT09IGN1cnJlbnRJZCkge1xyXG4gICAgICB0aGlzLnNldFNlbGVjdGlvbklkVG9CaW5kaW5nRGF0YShudWxsKTtcclxuICAgIH1cclxuICAgIC8vIHRoaXMuZmlyZVNlbGVjdGVkUm93Q2hhbmdlKGV2ZW50KTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5Yu+6YCJ6KGM5Y+R55Sf5Y+Y5YyWXHJcbiAgICogQHBhcmFtIGV2ZW50IGV2ZW50XHJcbiAgICovXHJcbiAgQEhvc3RMaXN0ZW5lcignY2hlY2tlZENoYW5nZScsIFsnJGV2ZW50J10pXHJcbiAgcHVibGljIGNoZWNrZWRDaGFuZ2VkKGV2ZW50OiBhbnkpIHtcclxuICAgIGV2ZW50ID0gZXZlbnQgfHwgW107XHJcbiAgICBjb25zdCBpZHMgPSBldmVudC5tYXAoaXRlbSA9PiBpdGVtLmlkKTtcclxuICAgIHRoaXMuc2V0Q2hlY2tzKGlkcyk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWIhumhteWkp+Wwj+WPmOabtOS6i+S7tlxyXG4gICAqIEBwYXJhbSBldmVudCBldmVudFxyXG4gICAqL1xyXG4gIEBIb3N0TGlzdGVuZXIoJ3BhZ2VTaXplQ2hhbmdlZCcsIFsnJGV2ZW50J10pXHJcbiAgcHVibGljIHBhZ2VTaXplQ2hhbmdlZChldmVudDogYW55KSB7XHJcbiAgICBjb25zdCB7IHBhZ2VJbmRleCwgcGFnZVNpemUgfSA9IGV2ZW50O1xyXG4gICAgY29uc3Qgc2tpcCA9IDA7Ly8ocGFnZUluZGV4IC0gMSkgKiBwYWdlU2l6ZTtcclxuICAgIC8vIHRoaXMuYmluZGluZ0xpc3Quc2V0UGFnaW5hdGlvbkluZm8oc2tpcCwgcGFnZVNpemUpO1xyXG4gICAgdGhpcy5iaW5kaW5nRGF0YS5zZXRQYWdpbmdJbmZvKHNraXAsIHBhZ2VTaXplLCB0aGlzLmJpbmRpbmdEYXRhLmJpbmRpbmdQYXRoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIGdyaWTmu5rliqjliqDovb3mlbDmja5cclxuICAgKiBAcGFyYW0gZXZlbnQgZXZlbnRcclxuICAgKi9cclxuICBASG9zdExpc3RlbmVyKCdzY3JvbGxZTG9hZCcsIFsnJGV2ZW50J10pXHJcbiAgcHVibGljIHNjcm9sbFkoZXZlbnQ6IGFueSkge1xyXG4gICAgY29uc3QgeyBwYWdlcjogcGFnZUluZGV4LCBwYWdlU2l6ZSB9ID0gZXZlbnQ7XHJcbiAgICBjb25zdCBza2lwID0gKHBhZ2VJbmRleCAtIDEpICogcGFnZVNpemU7XHJcbiAgICB0aGlzLmJpbmRpbmdEYXRhLnNldFBhZ2luZ0luZm8oc2tpcCwgcGFnZVNpemUsIHRoaXMuYmluZGluZ0RhdGEuYmluZGluZ1BhdGgpO1xyXG4gIH1cclxuICBASG9zdExpc3RlbmVyKCdmaWx0ZXJDaGFuZ2VkJywgWyckZXZlbnQnXSlcclxuICBwdWJsaWMgZmlsdGVyQ2hhbmdlZChldmVudDogYW55KSB7XHJcbiAgICB0aGlzLmZpbHRlcnMgPSBldmVudDtcclxuICB9XHJcbiAgLy8gI2VuZHJlZ2lvblxyXG4gIHByaXZhdGUgY2hlY2tJZkNoYW5nZU1hdGNoQmluZGluZ1BhdGgoY2hhbmdlOiBDaGFuZ2UpOiBib29sZWFuIHtcclxuICAgIGxldCBpc01hdGNoID0gZmFsc2U7XHJcbiAgICBpZiAoIWNoYW5nZSB8fCAhY2hhbmdlLnBhdGgpIHtcclxuICAgICAgcmV0dXJuIGlzTWF0Y2g7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgY2hhbmdlUGF0aEFycmF5ID0gY2hhbmdlLnBhdGg7XHJcbiAgICBpZiAoIWNoYW5nZVBhdGhBcnJheSkge1xyXG4gICAgICByZXR1cm4gaXNNYXRjaDtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoISh0aGlzLmJpbmRpbmdEYXRhKSAmJiAhKHRoaXMuYmluZGluZ0RhdGEuYmluZGluZ1BhdGgpKSB7XHJcbiAgICAgIHJldHVybiBpc01hdGNoO1xyXG4gICAgfVxyXG4gICAgY29uc3QgYmluZ2RpbmdQYXRoQXJyYXkgPSB0aGlzLmJpbmRpbmdEYXRhLmJpbmRpbmdQYXRoLnNwbGl0KCcvJyk7XHJcbiAgICBpZiAoYmluZ2RpbmdQYXRoQXJyYXkubGVuZ3RoIDw9IDApIHtcclxuICAgICAgcmV0dXJuIGlzTWF0Y2g7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGNoYW5nZVBhdGhBcnJheS5sZW5ndGggPT09IDApIHsgLy8g5Li76KGoXHJcbiAgICAgIGlmICh0aGlzLmJpbmRpbmdEYXRhLmJpbmRpbmdQYXRoID09PSAnLycpIHtcclxuICAgICAgICBpc01hdGNoID0gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIGlmIChjaGFuZ2UucGF0aC5sZW5ndGggPT09IDEpIHsvLyDkuLvku47ooahcclxuICAgICAgaWYgKGJpbmdkaW5nUGF0aEFycmF5Lmxlbmd0aCA9PT0gMiAmJiBiaW5nZGluZ1BhdGhBcnJheVsxXSA9PT0gY2hhbmdlLnBhdGhbMF0pIHtcclxuICAgICAgICBpc01hdGNoID0gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIGlmIChjaGFuZ2UucGF0aC5sZW5ndGggPT09IDIpIHsgLy8g5Li75LuO5LuO6KGoXHJcbiAgICAgIGlmIChiaW5nZGluZ1BhdGhBcnJheS5sZW5ndGggPT09IDMgJiYgYmluZ2RpbmdQYXRoQXJyYXlbMV0gPT09IGNoYW5nZS5wYXRoWzBdICYmIGJpbmdkaW5nUGF0aEFycmF5WzJdID09PSBjaGFuZ2UucGF0aFsxXSkge1xyXG4gICAgICAgIGlzTWF0Y2ggPSB0cnVlO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGlzTWF0Y2g7XHJcbiAgfVxyXG5cclxufVxyXG4iXX0=