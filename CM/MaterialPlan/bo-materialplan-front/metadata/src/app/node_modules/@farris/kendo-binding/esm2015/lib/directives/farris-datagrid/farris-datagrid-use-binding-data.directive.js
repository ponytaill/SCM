import { Directive, HostListener, EventEmitter, Output } from '@angular/core';
import { Subject } from 'rxjs';
import { BindingData, ChangeType, ViewModel, DataTypeInfo, EntityPathConverter, RunMode, ComponentType } from '@farris/devkit';
import { DatagridComponent } from '@farris/ui-datagrid';
import { debounceTime, finalize } from 'rxjs/operators';
// tslint:disable: max-line-length
/*
 * 使用绑定数据指令
 */
export class FarrisDatagridUseBindingDataDirective {
    constructor(bindingData, viewModel, grid) {
        this.bindingData = bindingData;
        this.viewModel = viewModel;
        this.grid = grid;
        // 排序字段
        this.sortFields = null;
        // 排序方向
        this.sortDirections = null;
        this.parentId = null;
        /**
         * 过滤条件
         */
        this.filters = null;
        /**
         * 渲染grid
         */
        this.renderGridSubject = new Subject();
        /**
         * 选中行切换事件
         */
        this.selectedRowChange = new EventEmitter();
        this.setChecks([]);
        this.registerEvent();
    }
    get props() {
        return this._PROPS;
    }
    set props(value) {
        this._PROPS = value;
    }
    // #region Ng Event
    ngOnInit() {
        const { pageSize = 0 } = this.getPagingInfo() || {};
        if (pageSize !== 0) {
            // 启用分页
            if ((!this.grid.pageList || this.grid.pageList.length < 1) && typeof this.grid['setPageList'] === 'function') {
                this.grid['setPageList']([pageSize, pageSize * 2, pageSize * 3, pageSize * 4]);
            }
        }
        this.setComponentRef();
        this.bindData();
        window.setTimeout(() => {
            this.updateSelectedRow();
        }, 0);
        this.registerBindingDataChangeEvent();
        this.renderGridSubject.pipe(debounceTime(500)).subscribe((change) => {
            if (!this.viewModel || !this.viewModel.frameContext || this.viewModel.frameContext.isDisposed) {
                return;
            }
            this.bindData(change);
        });
        if (this.viewModel && this.viewModel.frameContext && this.viewModel.frameContext.frameComponent) {
            this.viewModel.frameContext.frameComponent.componentType = ComponentType.farrisDataGridComponent;
        }
    }
    ngOnChanges(changes) {
        this.bindData();
    }
    // #endregion
    /**
     * 主键
     */
    get primaryKey() {
        return this.bindingList.primaryKey;
    }
    /**
     * 获取绑定数据
     */
    get bindingList() {
        // 根实体
        if (this.viewModel.bindingPath === '/' || !this.viewModel.bindingPath) {
            return this.bindingData.list;
        }
        // 子实体
        let bindingPath = this.viewModel.bindingPath.substr(1);
        bindingPath = bindingPath[0].toLowerCase() + bindingPath.substring(1, bindingPath.length);
        const paths = bindingPath.split('/');
        const filteredPaths = paths.filter((part) => {
            return part !== '';
        });
        return this.bindingData.getValue(filteredPaths);
    }
    /**
     * 设置组件引用
     */
    setComponentRef() {
        const appContext = this.viewModel && this.viewModel.frameContext && this.viewModel.frameContext.getFormAppContext();
        const frameId = this.viewModel && this.viewModel.frameContext && this.viewModel.frameContext.frameId;
        const id = this.grid && this.grid.id;
        // 如果frameId不存在或farris grid没有id属性，说明不符合使用场景
        if (!frameId || !id) {
            return;
        }
        const map = appContext && appContext.componentRefs && appContext.componentRefs.get(frameId) || new Map();
        appContext && appContext.componentRefs && appContext.componentRefs.set(frameId, map.set(id, this.grid));
    }
    /**
     * 获取分页信息
     */
    getPagingInfo() {
        const bindingPath = this.viewModel.bindingPath;
        const bindingData = this.viewModel.bindingData;
        let pagingInfo = bindingData && bindingData.pagingInfo || {};
        if (bindingPath === '/') {
            return pagingInfo;
        }
        else {
            const bindingPaths = bindingPath.substr(1).split('/').filter(item => !!item && item.length > 0);
            // 从表及从从表分页和数据是关联的，因为不同的从表行有不同的从从表数据，分页信息的结构为nodeCode_parentId:{分页信息}且分页信息是平级的
            // {pagination:{a_pid:{pageSize:2,pageIndex:1},b_pid:{pageSize:2,pageIndex:1}}}
            // 取出当前路径下实体的nodeCode
            let nodeCode = bindingPaths[bindingPaths.length - 1];
            nodeCode = nodeCode.substr(0, nodeCode.length - 1);
            // 获取当前实体上级的主键
            // const result = pagingInfo[nodeCode] || {};
            // if (result.hasOwnProperty('totalCount')) {
            //   result.total = result.totalCount;
            // }
            // return result;
            const paths = bindingPaths.slice(0, bindingPaths.length - 1);
            const bindingList = bindingData.getValue(paths);
            const { pageSize = 0 } = pagingInfo[`${nodeCode}`] || {};
            // 上级表有数据
            if (bindingList && bindingList.currentId) {
                const key = `${nodeCode}_${bindingList.currentId}`;
                // const key = nodeCode;
                const result = pagingInfo[key] || {};
                if (result.hasOwnProperty('totalCount')) {
                    result.total = result.totalCount;
                }
                // 上级表虽然有数据，但上级表当前行的下级表可能没有数据，这就导致获取不到分页信息，所以需要在返回前对结果进行处理，如果没有分页信息的话起码应该返回分页大小及当前页码
                if (Object.keys(result).length < 1) {
                    result.pageIndex = 1;
                    result.pageSize = pageSize;
                }
                return result;
            }
            else {
                // 上级表没有数据，此时需要获取当前表的分页信息，如分页大小。当前页默认为1即可。
                return { pageIndex: 1, pageSize };
            }
        }
    }
    // #region Input
    /**
     * 组件是否需要更新
     * @param props 当前属性
     * @param nextProps 新属性
     * @param change 变更
     */
    shouldComponentUpdate(change, data) {
        const props = this.buildProps(data);
        if (this.viewModel && this.viewModel.frameContext && this.viewModel.frameContext.appContext && this.viewModel.frameContext.appContext.runMode === RunMode.highSpeed && change) {
            if (change.type === ChangeType.Load || change.type === ChangeType.Remove || change.type === ChangeType.PaginationInfoChange) {
                return { result: true, props };
            }
        }
        const gridProps = this.buildGridProps();
        if (JSON.stringify(props) === JSON.stringify(gridProps)) {
            return { result: false };
        }
        return { result: true, props };
    }
    registerEvent() {
        // 排序事件
        this.grid && this.grid.columnSorted && this.grid.columnSorted.subscribe((event) => {
            const isRemoteSort = this.grid.remoteSort;
            // 本地排序
            if (!isRemoteSort) {
                this.sortFields = this.grid.sortName;
                this.sortDirections = this.grid.sortOrder;
                this.sortBindingList();
                // this.props = this.buildProps();
            }
            else {
                // 服务器端排序
                const groupField = this.grid && this.grid.groupField || null;
                let sortFields = this.grid.sortName && this.grid.sortName.split(',') || [];
                const sortDirection = this.grid.sortOrder && this.grid.sortOrder.split(',') || [];
                if (groupField) {
                    if (!sortFields.includes(groupField)) {
                        sortFields.splice(0, 0, groupField);
                        sortDirection.splice(0, 0, 'asc');
                    }
                }
                // 获取当前entity上所有object属性
                const entityType = this.viewModel && this.viewModel.frameContext.repository.entityType || null;
                if (sortFields.length > 0) {
                    if (entityType) {
                        const dataTypeInfo = new DataTypeInfo(entityType);
                        sortFields = sortFields.map(field => {
                            //if (field && field.indexOf('.') !== -1) {
                            const paths = field.split('.');
                            const propInfo = dataTypeInfo.getPropInfoByPath(paths);
                            const originalField = propInfo && propInfo.metadataInfo['path'] || null;
                            return originalField;
                            //}
                            //return field;
                        });
                    }
                }
                // 遍历属性，根据datafield转换为originalDataField
                const fields = sortFields.join(',');
                const directions = sortDirection.join(',') || 'asc';
                const frameContext = this.viewModel && this.viewModel.frameContext || null;
                if (frameContext) {
                    frameContext.repository.sortConditionManager.setConditions(this.viewModel.bindingPath, fields, directions);
                }
            }
        });
        // 过滤事件
        this.grid && this.grid.filterChanged && this.grid.filterChanged.subscribe((event) => {
            this.filters = event;
            if (!this.grid.remoteFilter) {
                if (this.bindingList.length > 0 && !this.bindingList.currentId) {
                    const id = this.bindingList.getIdByIndex(0);
                    this.bindingList.setCurrentId(id);
                }
                this.bindData();
            }
        });
    }
    /**
     * 对bindingList排序
     */
    sortBindingList() {
        const groupField = this.grid && this.grid.groupField || null;
        if (groupField) {
            const arrSortFields = this.sortFields && this.sortFields.split(',') || [];
            if (!arrSortFields.includes(groupField)) {
                arrSortFields.splice(0, 0, groupField);
                const arrSortDirection = this.sortDirections && this.sortDirections.split(',') || [];
                arrSortDirection.splice(0, 0, 'asc');
                this.sortFields = arrSortFields.join(',');
                this.sortDirections = arrSortDirection.join(',') || 'asc';
            }
        }
        if (this.sortFields && this.sortDirections) {
            this.bindingList.sortBy(this.sortFields, this.sortDirections);
            // this.props = this.buildProps();
        }
        this.bindData();
    }
    // #endregion
    // #region 数据绑定部分
    /**
     * 更新数据
     * @param change? 变更
     */
    bindData(change) {
        const isRemoteFilter = this.grid && this.grid.remoteFilter || false;
        // 先执行排序
        if (this.sortFields && !this.grid.editable && change && (change.type === 'Load' || change.type === 'SelectionChanged')) {
            this.sortBindingList();
            return;
        }
        // 新增数据时清空表格筛选条件
        if ((this.grid.editable === true || change && change.type === ChangeType.Append) && this.filters && Object.keys(this.filters).length > 0 && !isRemoteFilter) {
            this.filters = {};
            this.grid.clearCondition();
        }
        // 再toJSON
        let data = this.bindingList.toJSON();
        if (this.filters && Object.keys(this.filters).length > 0 && !isRemoteFilter) {
            data = this.grid.clientFilterService.executeFilter(data, this.filters);
        }
        if (this.filters && Object.keys(this.filters).length > 0 && !isRemoteFilter && (!change || change && change.type !== ChangeType.SelectionChanged && change.type !== ChangeType.GlobalSelectionChanged)) {
            if (data && data.length > 0) {
                // 判断当前行是否在过滤后的数据中
                const row = data.find(item => item[this.bindingList.primaryKey] === this.bindingList.currentId);
                if (!row) {
                    const firstRowId = data[0][this.bindingList.primaryKey];
                    this.bindingList.setCurrentId(firstRowId, true, true);
                }
            }
            else {
                // 本地过滤完之后没有数据了
                // this.bindingList.currentId = null;
                this.bindingList.setCurrentId(null, true, true, true);
                // 单选时清空ids
                if (!this.grid.multiSelect) {
                    this.setChecks([]);
                }
            }
        }
        const result = this.shouldComponentUpdate(change, data);
        if (!result.result) {
            return;
        }
        // const nextProps = this.buildProps(result);
        this.renderGrid(result.props);
        this.props = JSON.parse(JSON.stringify(result.props));
    }
    /**
     * 渲染grid
     * @param props 属性
     */
    renderGrid(props) {
        const { pageIndex, pageSize, total, pagination, data } = props;
        const virtualizedLoad = this.grid.virtualizedAsyncLoad || false;
        this.grid.total = total;
        this.grid.pageSize = pageSize;
        this.grid.pageIndex = pageIndex;
        this.grid.pagination = pagination;
        this.grid.controlPaginationState = false;
        // this.endCellEdit();
        if (pageSize === 0) {
            this.grid.pagination = false;
            this.grid.pageIndex = 1;
            // 修复不分页时grid启用分组仍会重新邦数的问题
            // this.grid.pageSize = total;
        }
        if (virtualizedLoad) {
            this.grid.loadVirtualData({
                items: data,
                pageIndex,
                pageSize,
                total
            });
        }
        else {
            this.grid.loadData(data);
        }
    }
    /**
     * 构造表格数据属性
     */
    buildProps(datas) {
        let data;
        if (typeof (datas) !== 'undefined') {
            data = datas;
        }
        else {
            data = this.bindingList.toJSON();
        }
        // let skip = 0;
        let { pageIndex = 1, pageSize = 0 } = this.getPagingInfo() || {};
        let { total = 0 } = this.getPagingInfo() || {};
        // if (pageIndex > 0) {
        //   skip = (pageIndex - 1) * pageSize;
        // }
        if (pageSize === 0 && total === 0) {
            total = data.length;
        }
        return { data, pageIndex, pageSize, total, pagination: pageSize !== 0 };
    }
    /**
     * 计算grid状态
     */
    buildGridProps() {
        const data = this.grid.data || [];
        let skip = 0;
        const { pageIndex = 1, pageSize = 0 } = { pageIndex: this.grid.pageIndex, pageSize: this.grid.pageSize };
        let total = this.grid.total || 0;
        if (pageIndex > 0) {
            skip = (pageIndex - 1) * pageSize;
        }
        if (pageSize === 0 && total === 0) {
            total = data.length;
        }
        return { data, pageIndex, pageSize, total, pagination: this.grid.pagination };
    }
    /**
     * 数据源发生变更
     * @param change 变更
     */
    onBindingDataChange(change) {
        this.updateDataSource(change);
        this.updateSelectedRow(change);
        // this.updateGrid(change);
        // 不清除勾选行，需要保留勾选状态
        // this.clearCheckedRows(change);
        this.endCellEdit(change);
        // 更新勾选行数据
        this.updateCheckedRows(change);
        this.updateData(change);
    }
    /**
     * 更新数据
     */
    updateDataSource(change) {
        /*if (change) {
          const isMatch = this.checkIfChangeMatchBindingPath(change);
          if (!isMatch) {
            return;
          }
        }*/
        if (change && change.type === ChangeType.ValueChanged) {
            this.renderGridSubject.next(change);
        }
        else if (change && (change.type === ChangeType.SelectionChanged || change.type === ChangeType.GlobalSelectionChanged)) {
            if (this.bindingList.currentId === (this.grid.selectedRow && this.grid.selectedRow.id) && this.grid.total > 0) {
            }
            else {
                this.bindData(change);
            }
        }
        else {
            this.bindData(change);
        }
    }
    // private endCellEdit() {
    //   const isEditing = this.grid.isEditing();
    //   if (isEditing) {
    //     this.grid.endCellEdit();
    //   }
    // }
    endCellEdit(change) {
        const isEditing = this.grid.isEditing();
        if (change.type === ChangeType.Load && isEditing) {
            this.grid.endCellEdit();
        }
    }
    /**
     * 设置grid当前选择行
     * @param change 变更
     */
    updateSelectedRow(change) {
        if (!this.bindingList || !this.bindingList.currentId) {
            return;
        }
        // 页码切换时不执行当前行切换
        if (change && change.type === ChangeType.PaginationInfoChange) {
            return;
        }
        if (this.viewModel && this.viewModel.frameContext.bindingData.rowSelectedEventSuspend === true) {
            return;
        }
        const { id: gridSelectedRowId = null } = this.grid.selectedRow || {};
        const currentId = this.bindingList.currentId;
        // grid当前行与bingingList当前行一致，无须切换
        if (gridSelectedRowId === currentId) {
            const isMatch = change && (change.path.toString() === this.viewModel.bindingPath.split('/').filter(p => p).toString());
            if (change && change.type === ChangeType.Load && isMatch) {
                this.grid.clearSelections();
                this.grid.selectRow(currentId, true, true);
            }
            return;
        }
        this.selectGridRow(this.bindingList.currentId);
    }
    /**
     * 注册bindingdata变化事件
     */
    registerBindingDataChangeEvent() {
        this.bindingDataChangeEvent = this.bindingData.changes.subscribe((change) => {
            this.onBindingDataChange(change);
        });
        this.viewModel.frameContext.appContext.messagePipe.subscribe(message => {
            if (message === 'bindData') {
                this.bindData();
            }
        });
    }
    /**
     * 取消bindingdata变化订阅
     */
    unRegisterBindingDataChangeEvent() {
        if (this.bindingDataChangeEvent && typeof (this.bindingDataChangeEvent.unsubscribe) === 'function') {
            this.bindingDataChangeEvent.unsubscribe();
        }
    }
    /**
     * 触发页码切换事件
     * @description 本方法适用场景仅为父级grid数据重新load，需要触发该grid重新取数使用。其他场景请勿使用
     * @TODO: 待重构，控制下级数据加载应该依赖表格的行切换事件，临时这样处理，后续提供LoadChildren事件
     */
    updateData(change) {
        if (!(change && (change.type === ChangeType.SelectionChanged || change.type === ChangeType.Load))) {
            return;
        }
        const bindingPath = this.viewModel.bindingPath;
        const eventBindingPath = '/' + change.path.join('/');
        const isRetrieve = this.viewModel.frameContext.appContext.params.get('retrieveing') || false;
        if (change.path.length < 1 || bindingPath === '/' || bindingPath === eventBindingPath || !bindingPath.startsWith(eventBindingPath)) {
            return;
        }
        // retrieve时会自动带回从表第一页及从表第一行的从从表数据，所以不需要再去单独请求
        if (isRetrieve) {
            return;
        }
        const fullPaths = EntityPathConverter.toEntityPathArray(this.viewModel.bindingPath, this.bindingData);
        const paths = fullPaths.slice(0, fullPaths.length - 1);
        const parent = this.bindingList.parent;
        const parentId = parent && parent[parent.primaryKey];
        // 上级表没有数据
        if (!parentId) {
            return;
        }
        // 获取nodecode
        const bindingPaths = this.viewModel.bindingPath.split('/').filter(item => item);
        let nodeCode = bindingPaths[bindingPaths.length - 1];
        nodeCode = nodeCode.substr(0, nodeCode.length - 1);
        // const configPath = `/${nodeCode}_${parentId}`;
        const configPath = `/${nodeCode}`;
        let { pageIndex = 1 } = this.viewModel.frameContext.repository.entityCollection.getPaginationConfigByPath(configPath) || {};
        const { pageSize = 0 } = this.viewModel.frameContext.repository.entityCollection.getPaginationConfigByPath(configPath) || {};
        const parentNodeCode = change.path[change.path.length - 1];
        const parentConfigPath = '/' + parentNodeCode.substring(0, parentNodeCode.length - 1);
        const { pageSize: parentPageSize = 0 } = this.viewModel.frameContext.repository.entityCollection.getPaginationConfigByPath(parentConfigPath) || {};
        const isQueryChild = this.viewModel.frameContext.appContext.params.get('queryChild') || false;
        if (isQueryChild) {
            // this.viewModel.frameContext.appContext.params.delete('queryChild');
            pageIndex = 1;
        }
        // 当上级表切换行时
        if (parentPageSize + pageSize !== 0) {
            this.viewModel.frameContext.appContext.params.set('forceQueryChild', true);
            this.viewModel.frameContext.repository.queryChild(paths, pageIndex, pageSize).pipe(finalize(() => this.viewModel.frameContext.appContext.params.delete('forceQueryChild'))).subscribe();
        }
    }
    ngOnDestroy() {
        this.unRegisterBindingDataChangeEvent();
    }
    // #endregion
    // #region 事件发射器
    /**
     * 发射选中行切换事件
     * @description 统一单选模式和多选模式下的行切换事件
     */
    fireSelectedRowChange(selectedRowContext) {
        this.selectedRowChange.emit(selectedRowContext);
    }
    /**
     * 清空选定行
     * @param change 变更
     */
    clearCheckedRows(change) {
        if (change.type === ChangeType.Load && this.grid.multiSelect) {
            const isMatch = this.checkIfChangeMatchBindingPath(change);
            if (isMatch) {
                this.setChecks([]);
                if (typeof (this.grid.clearCheckeds) === 'function') {
                    this.grid.clearCheckeds();
                }
            }
        }
    }
    // #endregion
    // #region 通信
    /**
     * 设置BindingList的当前行
     * @param id 当前行内码
     */
    setSelectionIdToBindingData(id) {
        // 如果当前行不存在，则强制设置
        if (!id) {
            this.bindingList.currentId = id;
            if (!this.grid.multiSelect) {
                this.setChecks([]);
            }
            return;
        }
        if (this.bindingList.currentId !== id) {
            this.bindingList.setCurrentId(id, true);
        }
        // 单选模式下将当前行设置到ids
        if (!this.grid.multiSelect) {
            this.setChecks([id]);
        }
    }
    updateCheckedRows(changes) {
        if (changes.type === ChangeType.Load) {
            this.setCheckedRows();
        }
        else if (changes.type === ChangeType.ValueChanged) {
            const ids = this.getChecks();
            if (changes.id && ids.includes(changes.id)) {
                this.setCheckedRows();
            }
        }
    }
    /**
     * 设置选择行
     */
    setChecks(ids) {
        this.viewModel.uiState.setPropertyValue('ids', ids);
        this.setCheckedRows(ids);
    }
    /**
     * 获取勾选行id数组
     * @returns
     */
    getChecks() {
        return this.viewModel.uiState['ids'] || [];
    }
    /**
     * 更新勾选行数据
     */
    setCheckedRows(ids) {
        // 高速模式时不再设置rows
        // if (this.viewModel.frameContext.appContext.runMode === RunMode.highSpeed) {
        //   return;
        // }
        if (typeof ids === 'undefined') {
            ids = this.viewModel.uiState['ids'] || [];
        }
        if (!Array.isArray(ids) || ids.length < 1) {
            // 此时ids没有值，rows中也不应该有
            this.viewModel.uiState.setPropertyValue('rows', null);
            return;
        }
        let list = [];
        // TODO：rows中数据在高速模式和普通模式下多语字段的值表现不一致，高速模式下多语字段值为对象，普通模式为当前语言。暂不处理高速模式场景
        if (this.viewModel.frameContext.appContext.runMode === RunMode.highSpeed) {
            list = this.grid.data || [];
        }
        else {
            list = this.bindingList.toJSON({ ignoreMultiLangInput: true });
        }
        const rows = this.viewModel.uiState['rows'] || new Map();
        const result = new Map();
        ids.forEach((id) => {
            const item = list.find(item => item[this.primaryKey] === id);
            const otherPageItem = rows.get(id);
            if (item) {
                result.set(id, item);
            }
            else if (otherPageItem) {
                result.set(id, otherPageItem);
            }
        });
        this.viewModel.uiState.setPropertyValue('rows', result);
    }
    /**
     * 选中grid行
     * @param id id
     */
    selectGridRow(id) {
        this.grid.selectRow(id);
        this.grid.scrollToCurrentRow();
    }
    // #endregion
    // #region 事件处理器
    /**
     * 页码切换事件
     * @param event event
     */
    pageChangedHandler(event) {
        let { pageIndex, pageSize } = event;
        if (pageIndex < 1) {
            pageIndex = 1;
        }
        const skip = (pageIndex - 1) * pageSize;
        this.bindingData.setPagingInfo(skip, pageSize, this.bindingData.bindingPath);
    }
    /**
     * 行切换事件
     * @param event event
     */
    selectedRowChanged(event) {
        const { index, data } = event;
        const id = data[this.primaryKey];
        this.setSelectionIdToBindingData(id);
        this.fireSelectedRowChange(event);
    }
    /**
     * 取消行选择事件
     * @param event event
     */
    unSelected(event) {
        if (!event) {
            return;
        }
        const { data = {} } = event;
        const id = data[this.primaryKey];
        const currentId = this.bindingList.currentId;
        if (id === currentId) {
            this.setSelectionIdToBindingData(null);
        }
        // this.fireSelectedRowChange(event);
    }
    /**
     * 勾选行发生变化
     * @param event event
     */
    checkedChanged(event) {
        event = event || [];
        const ids = event.map(item => item.id);
        this.setChecks(ids);
    }
    /**
     * 分页大小变更事件
     * @param event event
     */
    pageSizeChanged(event) {
        const { pageIndex, pageSize } = event;
        const skip = 0; //(pageIndex - 1) * pageSize;
        // this.bindingList.setPaginationInfo(skip, pageSize);
        this.bindingData.setPagingInfo(skip, pageSize, this.bindingData.bindingPath);
    }
    /**
     * grid滚动加载数据
     * @param event event
     */
    scrollY(event) {
        const { pager: pageIndex, pageSize } = event;
        const skip = (pageIndex - 1) * pageSize;
        this.bindingData.setPagingInfo(skip, pageSize, this.bindingData.bindingPath);
    }
    filterChanged(event) {
        this.filters = event;
    }
    // #endregion
    checkIfChangeMatchBindingPath(change) {
        let isMatch = false;
        if (!change || !change.path) {
            return isMatch;
        }
        const changePathArray = change.path;
        if (!changePathArray) {
            return isMatch;
        }
        if (!(this.bindingData) && !(this.bindingData.bindingPath)) {
            return isMatch;
        }
        const bingdingPathArray = this.bindingData.bindingPath.split('/');
        if (bingdingPathArray.length <= 0) {
            return isMatch;
        }
        if (changePathArray.length === 0) { // 主表
            if (this.bindingData.bindingPath === '/') {
                isMatch = true;
            }
        }
        else if (change.path.length === 1) { // 主从表
            if (bingdingPathArray.length === 2 && bingdingPathArray[1] === change.path[0]) {
                isMatch = true;
            }
        }
        else if (change.path.length === 2) { // 主从从表
            if (bingdingPathArray.length === 3 && bingdingPathArray[1] === change.path[0] && bingdingPathArray[2] === change.path[1]) {
                isMatch = true;
            }
        }
        return isMatch;
    }
}
FarrisDatagridUseBindingDataDirective.decorators = [
    { type: Directive, args: [{
                selector: '[farris-use-binding-data]'
            },] }
];
/** @nocollapse */
FarrisDatagridUseBindingDataDirective.ctorParameters = () => [
    { type: BindingData },
    { type: ViewModel },
    { type: DatagridComponent }
];
FarrisDatagridUseBindingDataDirective.propDecorators = {
    selectedRowChange: [{ type: Output }],
    pageChangedHandler: [{ type: HostListener, args: ['pageChanged', ['$event'],] }],
    selectedRowChanged: [{ type: HostListener, args: ['selectChanged', ['$event'],] }],
    unSelected: [{ type: HostListener, args: ['unSelect', ['$event'],] }],
    checkedChanged: [{ type: HostListener, args: ['checkedChange', ['$event'],] }],
    pageSizeChanged: [{ type: HostListener, args: ['pageSizeChanged', ['$event'],] }],
    scrollY: [{ type: HostListener, args: ['scrollYLoad', ['$event'],] }],
    filterChanged: [{ type: HostListener, args: ['filterChanged', ['$event'],] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmFycmlzLWRhdGFncmlkLXVzZS1iaW5kaW5nLWRhdGEuZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9rZW5kby1iaW5kaW5nLyIsInNvdXJjZXMiOlsibGliL2RpcmVjdGl2ZXMvZmFycmlzLWRhdGFncmlkL2ZhcnJpcy1kYXRhZ3JpZC11c2UtYmluZGluZy1kYXRhLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUErQyxZQUFZLEVBQ3BFLFlBQVksRUFBRSxNQUFNLEVBQ3JCLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxPQUFPLEVBQWdCLE1BQU0sTUFBTSxDQUFDO0FBQzdDLE9BQU8sRUFBRSxXQUFXLEVBQXVCLFVBQVUsRUFBRSxTQUFTLEVBQStDLFlBQVksRUFBaUIsbUJBQW1CLEVBQUUsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ2hOLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3hELE9BQU8sRUFBRSxZQUFZLEVBQUUsUUFBUSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDeEQsa0NBQWtDO0FBRWxDOztHQUVHO0FBSUgsTUFBTSxPQUFPLHFDQUFxQztJQTJCaEQsWUFBbUIsV0FBd0IsRUFBUyxTQUFvQixFQUFTLElBQXVCO1FBQXJGLGdCQUFXLEdBQVgsV0FBVyxDQUFhO1FBQVMsY0FBUyxHQUFULFNBQVMsQ0FBVztRQUFTLFNBQUksR0FBSixJQUFJLENBQW1CO1FBekJ4RyxPQUFPO1FBQ0MsZUFBVSxHQUFXLElBQUksQ0FBQztRQUNsQyxPQUFPO1FBQ0MsbUJBQWMsR0FBVyxJQUFJLENBQUM7UUFDOUIsYUFBUSxHQUFXLElBQUksQ0FBQztRQUNoQzs7V0FFRztRQUNLLFlBQU8sR0FBUSxJQUFJLENBQUM7UUFRNUI7O1dBRUc7UUFDSyxzQkFBaUIsR0FBaUIsSUFBSSxPQUFPLEVBQU8sQ0FBQztR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Q0FBQzs4QkFVeEMsWUFBWSxTQUFDLGlCQUFpQixFQUFFLENBQUMsUUFBUSxDQUFDO3NCQVkxQyxZQUFZLFNBQUMsYUFBYSxFQUFFLENBQUMsUUFBUSxDQUFDOzRCQU10QyxZQUFZLFNBQUMsZUFBZSxFQUFFLENBQUMsUUFBUSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICBEaXJlY3RpdmUsIE9uSW5pdCwgT25DaGFuZ2VzLCBPbkRlc3Ryb3ksIFNpbXBsZUNoYW5nZXMsIEhvc3RMaXN0ZW5lcixcclxuICBFdmVudEVtaXR0ZXIsIE91dHB1dFxyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBTdWJqZWN0LCBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgQmluZGluZ0RhdGEsIEJpbmRpbmdMaXN0LCBDaGFuZ2UsIENoYW5nZVR5cGUsIFZpZXdNb2RlbCwgQXBwQ29udGV4dCwgRnJhbWVDb250ZXh0LCBGaWVsZE1ldGFkYXRhVXRpbCwgRGF0YVR5cGVJbmZvLCBCaW5kaW5nT2JqZWN0LCBFbnRpdHlQYXRoQ29udmVydGVyLCBSdW5Nb2RlLCBDb21wb25lbnRUeXBlIH0gZnJvbSAnQGZhcnJpcy9kZXZraXQnO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZENvbXBvbmVudCB9IGZyb20gJ0BmYXJyaXMvdWktZGF0YWdyaWQnO1xyXG5pbXBvcnQgeyBkZWJvdW5jZVRpbWUsIGZpbmFsaXplIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG4vLyB0c2xpbnQ6ZGlzYWJsZTogbWF4LWxpbmUtbGVuZ3RoXHJcblxyXG4vKlxyXG4gKiDkvb/nlKjnu5HlrprmlbDmja7mjIfku6RcclxuICovXHJcbkBEaXJlY3RpdmUoe1xyXG4gIHNlbGVjdG9yOiAnW2ZhcnJpcy11c2UtYmluZGluZy1kYXRhXSdcclxufSlcclxuZXhwb3J0IGNsYXNzIEZhcnJpc0RhdGFncmlkVXNlQmluZGluZ0RhdGFEaXJlY3RpdmUgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcywgT25EZXN0cm95IHtcclxuICBwcml2YXRlIF9QUk9QUzogeyBbcHJvcE5hbWU6IHN0cmluZ106IGFueSB9O1xyXG4gIC8vIOaOkuW6j+Wtl+autVxyXG4gIHByaXZhdGUgc29ydEZpZWxkczogc3RyaW5nID0gbnVsbDtcclxuICAvLyDmjpLluo/mlrnlkJFcclxuICBwcml2YXRlIHNvcnREaXJlY3Rpb25zOiBzdHJpbmcgPSBudWxsO1xyXG4gIHByaXZhdGUgcGFyZW50SWQ6IHN0cmluZyA9IG51bGw7XHJcbiAgLyoqXHJcbiAgICog6L+H5ruk5p2h5Lu2XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBmaWx0ZXJzOiBhbnkgPSBudWxsO1xyXG4gIHByb3RlY3RlZCBnZXQgcHJvcHMoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fUFJPUFM7XHJcbiAgfVxyXG4gIHByb3RlY3RlZCBzZXQgcHJvcHModmFsdWUpIHtcclxuICAgIHRoaXMuX1BST1BTID0gdmFsdWU7XHJcbiAgfVxyXG4gIHByb3RlY3RlZCBiaW5kaW5nRGF0YUNoYW5nZUV2ZW50OiBTdWJzY3JpcHRpb247XHJcbiAgLyoqXHJcbiAgICog5riy5p+TZ3JpZFxyXG4gICAqL1xyXG4gIHByaXZhdGUgcmVuZGVyR3JpZFN1YmplY3Q6IFN1YmplY3Q8YW55PiA9IG5ldyBTdWJqZWN0PGFueT4oKTtcclxuICAvKipcclxuICAgKiDpgInkuK3ooYzliIfmjaLkuovku7ZcclxuICAgKi9cclxuICBAT3V0cHV0KCkgc2VsZWN0ZWRSb3dDaGFuZ2U6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBiaW5kaW5nRGF0YTogQmluZGluZ0RhdGEsIHB1YmxpYyB2aWV3TW9kZWw6IFZpZXdNb2RlbCwgcHVibGljIGdyaWQ6IERhdGFncmlkQ29tcG9uZW50KSB7XHJcbiAgICB0aGlzLnNldENoZWNrcyhbXSk7XHJcbiAgICB0aGlzLnJlZ2lzdGVyRXZlbnQoKTtcclxuICB9XHJcblxyXG4gIC8vICNyZWdpb24gTmcgRXZlbnRcclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICBjb25zdCB7IHBhZ2VTaXplID0gMCB9ID0gdGhpcy5nZXRQYWdpbmdJbmZvKCkgfHwge307XHJcbiAgICBpZiAocGFnZVNpemUgIT09IDApIHtcclxuICAgICAgLy8g5ZCv55So5YiG6aG1XHJcbiAgICAgIGlmICgoIXRoaXMuZ3JpZC5wYWdlTGlzdCB8fCB0aGlzLmdyaWQucGFnZUxpc3QubGVuZ3RoIDwgMSkgJiYgdHlwZW9mIHRoaXMuZ3JpZFsnc2V0UGFnZUxpc3QnXSA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgIHRoaXMuZ3JpZFsnc2V0UGFnZUxpc3QnXShbcGFnZVNpemUsIHBhZ2VTaXplICogMiwgcGFnZVNpemUgKiAzLCBwYWdlU2l6ZSAqIDRdKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgdGhpcy5zZXRDb21wb25lbnRSZWYoKTtcclxuICAgIHRoaXMuYmluZERhdGEoKTtcclxuICAgIHdpbmRvdy5zZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgdGhpcy51cGRhdGVTZWxlY3RlZFJvdygpO1xyXG4gICAgfSwgMCk7XHJcbiAgICB0aGlzLnJlZ2lzdGVyQmluZGluZ0RhdGFDaGFuZ2VFdmVudCgpO1xyXG4gICAgdGhpcy5yZW5kZXJHcmlkU3ViamVjdC5waXBlKFxyXG4gICAgICBkZWJvdW5jZVRpbWUoNTAwKVxyXG4gICAgKS5zdWJzY3JpYmUoKGNoYW5nZTogQ2hhbmdlKSA9PiB7XHJcbiAgICAgIGlmICghdGhpcy52aWV3TW9kZWwgfHwgIXRoaXMudmlld01vZGVsLmZyYW1lQ29udGV4dCB8fCB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQuaXNEaXNwb3NlZCkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICB0aGlzLmJpbmREYXRhKGNoYW5nZSk7XHJcbiAgICB9KTtcclxuICAgIGlmICh0aGlzLnZpZXdNb2RlbCAmJiB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQgJiYgdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LmZyYW1lQ29tcG9uZW50KSB7XHJcbiAgICAgIHRoaXMudmlld01vZGVsLmZyYW1lQ29udGV4dC5mcmFtZUNvbXBvbmVudC5jb21wb25lbnRUeXBlID0gQ29tcG9uZW50VHlwZS5mYXJyaXNEYXRhR3JpZENvbXBvbmVudDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcclxuICAgIHRoaXMuYmluZERhdGEoKTtcclxuICB9XHJcblxyXG4gIC8vICNlbmRyZWdpb25cclxuXHJcblxyXG4gIC8qKlxyXG4gICAqIOS4u+mUrlxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBnZXQgcHJpbWFyeUtleSgpIHtcclxuICAgIHJldHVybiB0aGlzLmJpbmRpbmdMaXN0LnByaW1hcnlLZXk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiOt+WPlue7keWumuaVsOaNrlxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBnZXQgYmluZGluZ0xpc3QoKTogQmluZGluZ0xpc3Qge1xyXG4gICAgLy8g5qC55a6e5L2TXHJcbiAgICBpZiAodGhpcy52aWV3TW9kZWwuYmluZGluZ1BhdGggPT09ICcvJyB8fCAhdGhpcy52aWV3TW9kZWwuYmluZGluZ1BhdGgpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuYmluZGluZ0RhdGEubGlzdDtcclxuICAgIH1cclxuICAgIC8vIOWtkOWunuS9k1xyXG4gICAgbGV0IGJpbmRpbmdQYXRoID0gdGhpcy52aWV3TW9kZWwuYmluZGluZ1BhdGguc3Vic3RyKDEpO1xyXG4gICAgYmluZGluZ1BhdGggPSBiaW5kaW5nUGF0aFswXS50b0xvd2VyQ2FzZSgpICsgYmluZGluZ1BhdGguc3Vic3RyaW5nKDEsIGJpbmRpbmdQYXRoLmxlbmd0aCk7XHJcbiAgICBjb25zdCBwYXRocyA9IGJpbmRpbmdQYXRoLnNwbGl0KCcvJyk7XHJcblxyXG4gICAgY29uc3QgZmlsdGVyZWRQYXRocyA9IHBhdGhzLmZpbHRlcigocGFydDogc3RyaW5nKSA9PiB7XHJcbiAgICAgIHJldHVybiBwYXJ0ICE9PSAnJztcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIHRoaXMuYmluZGluZ0RhdGEuZ2V0VmFsdWUoZmlsdGVyZWRQYXRocyk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiuvue9rue7hOS7tuW8leeUqFxyXG4gICAqL1xyXG4gIHByaXZhdGUgc2V0Q29tcG9uZW50UmVmKCkge1xyXG4gICAgY29uc3QgYXBwQ29udGV4dCA9IHRoaXMudmlld01vZGVsICYmIHRoaXMudmlld01vZGVsLmZyYW1lQ29udGV4dCAmJiB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQuZ2V0Rm9ybUFwcENvbnRleHQoKTtcclxuICAgIGNvbnN0IGZyYW1lSWQgPSB0aGlzLnZpZXdNb2RlbCAmJiB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQgJiYgdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LmZyYW1lSWQ7XHJcbiAgICBjb25zdCBpZCA9IHRoaXMuZ3JpZCAmJiB0aGlzLmdyaWQuaWQ7XHJcbiAgICAvLyDlpoLmnpxmcmFtZUlk5LiN5a2Y5Zyo5oiWZmFycmlzIGdyaWTmsqHmnIlpZOWxnuaAp++8jOivtOaYjuS4jeespuWQiOS9v+eUqOWcuuaZr1xyXG4gICAgaWYgKCFmcmFtZUlkIHx8ICFpZCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBjb25zdCBtYXAgPSBhcHBDb250ZXh0ICYmIGFwcENvbnRleHQuY29tcG9uZW50UmVmcyAmJiBhcHBDb250ZXh0LmNvbXBvbmVudFJlZnMuZ2V0KGZyYW1lSWQpIHx8IG5ldyBNYXA8c3RyaW5nLCBhbnk+KCk7XHJcbiAgICBhcHBDb250ZXh0ICYmIGFwcENvbnRleHQuY29tcG9uZW50UmVmcyAmJiBhcHBDb250ZXh0LmNvbXBvbmVudFJlZnMuc2V0KGZyYW1lSWQsIG1hcC5zZXQoaWQsIHRoaXMuZ3JpZCkpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDojrflj5bliIbpobXkv6Hmga9cclxuICAgKi9cclxuICBwcm90ZWN0ZWQgZ2V0UGFnaW5nSW5mbygpIHtcclxuICAgIGNvbnN0IGJpbmRpbmdQYXRoID0gdGhpcy52aWV3TW9kZWwuYmluZGluZ1BhdGg7XHJcbiAgICBjb25zdCBiaW5kaW5nRGF0YSA9IHRoaXMudmlld01vZGVsLmJpbmRpbmdEYXRhO1xyXG4gICAgbGV0IHBhZ2luZ0luZm8gPSBiaW5kaW5nRGF0YSAmJiBiaW5kaW5nRGF0YS5wYWdpbmdJbmZvIHx8IHt9O1xyXG4gICAgaWYgKGJpbmRpbmdQYXRoID09PSAnLycpIHtcclxuICAgICAgcmV0dXJuIHBhZ2luZ0luZm87XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zdCBiaW5kaW5nUGF0aHMgPSBiaW5kaW5nUGF0aC5zdWJzdHIoMSkuc3BsaXQoJy8nKS5maWx0ZXIoaXRlbSA9PiAhIWl0ZW0gJiYgaXRlbS5sZW5ndGggPiAwKTtcclxuICAgICAgLy8g5LuO6KGo5Y+K5LuO5LuO6KGo5YiG6aG15ZKM5pWw5o2u5piv5YWz6IGU55qE77yM5Zug5Li65LiN5ZCM55qE5LuO6KGo6KGM5pyJ5LiN5ZCM55qE5LuO5LuO6KGo5pWw5o2u77yM5YiG6aG15L+h5oGv55qE57uT5p6E5Li6bm9kZUNvZGVfcGFyZW50SWQ6e+WIhumhteS/oeaBr33kuJTliIbpobXkv6Hmga/mmK/lubPnuqfnmoRcclxuICAgICAgLy8ge3BhZ2luYXRpb246e2FfcGlkOntwYWdlU2l6ZToyLHBhZ2VJbmRleDoxfSxiX3BpZDp7cGFnZVNpemU6MixwYWdlSW5kZXg6MX19fVxyXG4gICAgICAvLyDlj5blh7rlvZPliY3ot6/lvoTkuIvlrp7kvZPnmoRub2RlQ29kZVxyXG4gICAgICBsZXQgbm9kZUNvZGUgPSBiaW5kaW5nUGF0aHNbYmluZGluZ1BhdGhzLmxlbmd0aCAtIDFdO1xyXG4gICAgICBub2RlQ29kZSA9IG5vZGVDb2RlLnN1YnN0cigwLCBub2RlQ29kZS5sZW5ndGggLSAxKTtcclxuICAgICAgLy8g6I635Y+W5b2T5YmN5a6e5L2T5LiK57qn55qE5Li76ZSuXHJcbiAgICAgIC8vIGNvbnN0IHJlc3VsdCA9IHBhZ2luZ0luZm9bbm9kZUNvZGVdIHx8IHt9O1xyXG4gICAgICAvLyBpZiAocmVzdWx0Lmhhc093blByb3BlcnR5KCd0b3RhbENvdW50JykpIHtcclxuICAgICAgLy8gICByZXN1bHQudG90YWwgPSByZXN1bHQudG90YWxDb3VudDtcclxuICAgICAgLy8gfVxyXG4gICAgICAvLyByZXR1cm4gcmVzdWx0O1xyXG5cclxuICAgICAgY29uc3QgcGF0aHMgPSBiaW5kaW5nUGF0aHMuc2xpY2UoMCwgYmluZGluZ1BhdGhzLmxlbmd0aCAtIDEpO1xyXG4gICAgICBjb25zdCBiaW5kaW5nTGlzdCA9IGJpbmRpbmdEYXRhLmdldFZhbHVlKHBhdGhzKSBhcyBCaW5kaW5nTGlzdDtcclxuICAgICAgY29uc3QgeyBwYWdlU2l6ZSA9IDAgfSA9IHBhZ2luZ0luZm9bYCR7bm9kZUNvZGV9YF0gfHwge307XHJcbiAgICAgIC8vIOS4iue6p+ihqOacieaVsOaNrlxyXG4gICAgICBpZiAoYmluZGluZ0xpc3QgJiYgYmluZGluZ0xpc3QuY3VycmVudElkKSB7XHJcbiAgICAgICAgY29uc3Qga2V5ID0gYCR7bm9kZUNvZGV9XyR7YmluZGluZ0xpc3QuY3VycmVudElkfWA7XHJcbiAgICAgICAgLy8gY29uc3Qga2V5ID0gbm9kZUNvZGU7XHJcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gcGFnaW5nSW5mb1trZXldIHx8IHt9O1xyXG4gICAgICAgIGlmIChyZXN1bHQuaGFzT3duUHJvcGVydHkoJ3RvdGFsQ291bnQnKSkge1xyXG4gICAgICAgICAgcmVzdWx0LnRvdGFsID0gcmVzdWx0LnRvdGFsQ291bnQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIOS4iue6p+ihqOiZveeEtuacieaVsOaNru+8jOS9huS4iue6p+ihqOW9k+WJjeihjOeahOS4i+e6p+ihqOWPr+iDveayoeacieaVsOaNru+8jOi/meWwseWvvOiHtOiOt+WPluS4jeWIsOWIhumhteS/oeaBr++8jOaJgOS7pemcgOimgeWcqOi/lOWbnuWJjeWvuee7k+aenOi/m+ihjOWkhOeQhu+8jOWmguaenOayoeacieWIhumhteS/oeaBr+eahOivnei1t+eggeW6lOivpei/lOWbnuWIhumhteWkp+Wwj+WPiuW9k+WJjemhteeggVxyXG4gICAgICAgIGlmIChPYmplY3Qua2V5cyhyZXN1bHQpLmxlbmd0aCA8IDEpIHtcclxuICAgICAgICAgIHJlc3VsdC5wYWdlSW5kZXggPSAxO1xyXG4gICAgICAgICAgcmVzdWx0LnBhZ2VTaXplID0gcGFnZVNpemU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8g5LiK57qn6KGo5rKh5pyJ5pWw5o2u77yM5q2k5pe26ZyA6KaB6I635Y+W5b2T5YmN6KGo55qE5YiG6aG15L+h5oGv77yM5aaC5YiG6aG15aSn5bCP44CC5b2T5YmN6aG16buY6K6k5Li6MeWNs+WPr+OAglxyXG4gICAgICAgIHJldHVybiB7IHBhZ2VJbmRleDogMSwgcGFnZVNpemUgfTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gI3JlZ2lvbiBJbnB1dFxyXG4gIC8qKlxyXG4gICAqIOe7hOS7tuaYr+WQpumcgOimgeabtOaWsFxyXG4gICAqIEBwYXJhbSBwcm9wcyDlvZPliY3lsZ7mgKdcclxuICAgKiBAcGFyYW0gbmV4dFByb3BzIOaWsOWxnuaAp1xyXG4gICAqIEBwYXJhbSBjaGFuZ2Ug5Y+Y5pu0XHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIHNob3VsZENvbXBvbmVudFVwZGF0ZShjaGFuZ2U6IENoYW5nZSwgZGF0YTogYW55LCk6IHsgcmVzdWx0OiBib29sZWFuLCBwcm9wcz86IGFueSB9IHtcclxuICAgIGNvbnN0IHByb3BzID0gdGhpcy5idWlsZFByb3BzKGRhdGEpO1xyXG4gICAgaWYgKHRoaXMudmlld01vZGVsICYmIHRoaXMudmlld01vZGVsLmZyYW1lQ29udGV4dCAmJiB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQuYXBwQ29udGV4dCAmJiB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQuYXBwQ29udGV4dC5ydW5Nb2RlID09PSBSdW5Nb2RlLmhpZ2hTcGVlZCAmJiBjaGFuZ2UpIHtcclxuICAgICAgaWYgKGNoYW5nZS50eXBlID09PSBDaGFuZ2VUeXBlLkxvYWQgfHwgY2hhbmdlLnR5cGUgPT09IENoYW5nZVR5cGUuUmVtb3ZlIHx8IGNoYW5nZS50eXBlID09PSBDaGFuZ2VUeXBlLlBhZ2luYXRpb25JbmZvQ2hhbmdlKSB7XHJcbiAgICAgICAgcmV0dXJuIHsgcmVzdWx0OiB0cnVlLCBwcm9wcyB9O1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBjb25zdCBncmlkUHJvcHMgPSB0aGlzLmJ1aWxkR3JpZFByb3BzKCk7XHJcbiAgICBpZiAoSlNPTi5zdHJpbmdpZnkocHJvcHMpID09PSBKU09OLnN0cmluZ2lmeShncmlkUHJvcHMpKSB7XHJcbiAgICAgIHJldHVybiB7IHJlc3VsdDogZmFsc2UgfTtcclxuICAgIH1cclxuICAgIHJldHVybiB7IHJlc3VsdDogdHJ1ZSwgcHJvcHMgfTtcclxuICB9XHJcbiAgcHJvdGVjdGVkIHJlZ2lzdGVyRXZlbnQoKSB7XHJcbiAgICAvLyDmjpLluo/kuovku7ZcclxuICAgIHRoaXMuZ3JpZCAmJiB0aGlzLmdyaWQuY29sdW1uU29ydGVkICYmIHRoaXMuZ3JpZC5jb2x1bW5Tb3J0ZWQuc3Vic2NyaWJlKChldmVudDogYW55KSA9PiB7XHJcbiAgICAgIGNvbnN0IGlzUmVtb3RlU29ydCA9IHRoaXMuZ3JpZC5yZW1vdGVTb3J0O1xyXG4gICAgICAvLyDmnKzlnLDmjpLluo9cclxuICAgICAgaWYgKCFpc1JlbW90ZVNvcnQpIHtcclxuICAgICAgICB0aGlzLnNvcnRGaWVsZHMgPSB0aGlzLmdyaWQuc29ydE5hbWU7XHJcbiAgICAgICAgdGhpcy5zb3J0RGlyZWN0aW9ucyA9IHRoaXMuZ3JpZC5zb3J0T3JkZXI7XHJcbiAgICAgICAgdGhpcy5zb3J0QmluZGluZ0xpc3QoKTtcclxuICAgICAgICAvLyB0aGlzLnByb3BzID0gdGhpcy5idWlsZFByb3BzKCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8g5pyN5Yqh5Zmo56uv5o6S5bqPXHJcbiAgICAgICAgY29uc3QgZ3JvdXBGaWVsZCA9IHRoaXMuZ3JpZCAmJiB0aGlzLmdyaWQuZ3JvdXBGaWVsZCB8fCBudWxsO1xyXG4gICAgICAgIGxldCBzb3J0RmllbGRzID0gdGhpcy5ncmlkLnNvcnROYW1lICYmIHRoaXMuZ3JpZC5zb3J0TmFtZS5zcGxpdCgnLCcpIHx8IFtdO1xyXG4gICAgICAgIGNvbnN0IHNvcnREaXJlY3Rpb24gPSB0aGlzLmdyaWQuc29ydE9yZGVyICYmIHRoaXMuZ3JpZC5zb3J0T3JkZXIuc3BsaXQoJywnKSB8fCBbXTtcclxuICAgICAgICBpZiAoZ3JvdXBGaWVsZCkge1xyXG4gICAgICAgICAgaWYgKCFzb3J0RmllbGRzLmluY2x1ZGVzKGdyb3VwRmllbGQpKSB7XHJcbiAgICAgICAgICAgIHNvcnRGaWVsZHMuc3BsaWNlKDAsIDAsIGdyb3VwRmllbGQpO1xyXG4gICAgICAgICAgICBzb3J0RGlyZWN0aW9uLnNwbGljZSgwLCAwLCAnYXNjJyk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIOiOt+WPluW9k+WJjWVudGl0eeS4iuaJgOaciW9iamVjdOWxnuaAp1xyXG4gICAgICAgIGNvbnN0IGVudGl0eVR5cGUgPSB0aGlzLnZpZXdNb2RlbCAmJiB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQucmVwb3NpdG9yeS5lbnRpdHlUeXBlIHx8IG51bGw7XHJcblxyXG4gICAgICAgIGlmIChzb3J0RmllbGRzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgIGlmIChlbnRpdHlUeXBlKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGRhdGFUeXBlSW5mbyA9IG5ldyBEYXRhVHlwZUluZm8oZW50aXR5VHlwZSk7XHJcbiAgICAgICAgICAgIHNvcnRGaWVsZHMgPSBzb3J0RmllbGRzLm1hcChmaWVsZCA9PiB7XHJcbiAgICAgICAgICAgICAgLy9pZiAoZmllbGQgJiYgZmllbGQuaW5kZXhPZignLicpICE9PSAtMSkge1xyXG4gICAgICAgICAgICAgIGNvbnN0IHBhdGhzID0gZmllbGQuc3BsaXQoJy4nKTtcclxuICAgICAgICAgICAgICBjb25zdCBwcm9wSW5mbyA9IGRhdGFUeXBlSW5mby5nZXRQcm9wSW5mb0J5UGF0aChwYXRocyk7XHJcbiAgICAgICAgICAgICAgY29uc3Qgb3JpZ2luYWxGaWVsZCA9IHByb3BJbmZvICYmIHByb3BJbmZvLm1ldGFkYXRhSW5mb1sncGF0aCddIHx8IG51bGw7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIG9yaWdpbmFsRmllbGQ7XHJcbiAgICAgICAgICAgICAgLy99XHJcbiAgICAgICAgICAgICAgLy9yZXR1cm4gZmllbGQ7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICAvLyDpgY3ljoblsZ7mgKfvvIzmoLnmja5kYXRhZmllbGTovazmjaLkuLpvcmlnaW5hbERhdGFGaWVsZFxyXG4gICAgICAgIGNvbnN0IGZpZWxkcyA9IHNvcnRGaWVsZHMuam9pbignLCcpO1xyXG4gICAgICAgIGNvbnN0IGRpcmVjdGlvbnMgPSBzb3J0RGlyZWN0aW9uLmpvaW4oJywnKSB8fCAnYXNjJztcclxuICAgICAgICBjb25zdCBmcmFtZUNvbnRleHQ6IEZyYW1lQ29udGV4dCA9IHRoaXMudmlld01vZGVsICYmIHRoaXMudmlld01vZGVsLmZyYW1lQ29udGV4dCB8fCBudWxsO1xyXG4gICAgICAgIGlmIChmcmFtZUNvbnRleHQpIHtcclxuICAgICAgICAgIGZyYW1lQ29udGV4dC5yZXBvc2l0b3J5LnNvcnRDb25kaXRpb25NYW5hZ2VyLnNldENvbmRpdGlvbnModGhpcy52aWV3TW9kZWwuYmluZGluZ1BhdGgsIGZpZWxkcywgZGlyZWN0aW9ucyk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIC8vIOi/h+a7pOS6i+S7tlxyXG4gICAgdGhpcy5ncmlkICYmIHRoaXMuZ3JpZC5maWx0ZXJDaGFuZ2VkICYmIHRoaXMuZ3JpZC5maWx0ZXJDaGFuZ2VkLnN1YnNjcmliZSgoZXZlbnQ6IGFueSkgPT4ge1xyXG4gICAgICB0aGlzLmZpbHRlcnMgPSBldmVudDtcclxuICAgICAgaWYgKCF0aGlzLmdyaWQucmVtb3RlRmlsdGVyKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuYmluZGluZ0xpc3QubGVuZ3RoID4gMCAmJiAhdGhpcy5iaW5kaW5nTGlzdC5jdXJyZW50SWQpIHtcclxuICAgICAgICAgIGNvbnN0IGlkID0gdGhpcy5iaW5kaW5nTGlzdC5nZXRJZEJ5SW5kZXgoMCk7XHJcbiAgICAgICAgICB0aGlzLmJpbmRpbmdMaXN0LnNldEN1cnJlbnRJZChpZCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuYmluZERhdGEoKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlr7liaW5kaW5nTGlzdOaOkuW6j1xyXG4gICAqL1xyXG4gIHByaXZhdGUgc29ydEJpbmRpbmdMaXN0KCkge1xyXG4gICAgY29uc3QgZ3JvdXBGaWVsZCA9IHRoaXMuZ3JpZCAmJiB0aGlzLmdyaWQuZ3JvdXBGaWVsZCB8fCBudWxsO1xyXG4gICAgaWYgKGdyb3VwRmllbGQpIHtcclxuICAgICAgY29uc3QgYXJyU29ydEZpZWxkcyA9IHRoaXMuc29ydEZpZWxkcyAmJiB0aGlzLnNvcnRGaWVsZHMuc3BsaXQoJywnKSB8fCBbXTtcclxuICAgICAgaWYgKCFhcnJTb3J0RmllbGRzLmluY2x1ZGVzKGdyb3VwRmllbGQpKSB7XHJcbiAgICAgICAgYXJyU29ydEZpZWxkcy5zcGxpY2UoMCwgMCwgZ3JvdXBGaWVsZCk7XHJcbiAgICAgICAgY29uc3QgYXJyU29ydERpcmVjdGlvbiA9IHRoaXMuc29ydERpcmVjdGlvbnMgJiYgdGhpcy5zb3J0RGlyZWN0aW9ucy5zcGxpdCgnLCcpIHx8IFtdO1xyXG4gICAgICAgIGFyclNvcnREaXJlY3Rpb24uc3BsaWNlKDAsIDAsICdhc2MnKTtcclxuICAgICAgICB0aGlzLnNvcnRGaWVsZHMgPSBhcnJTb3J0RmllbGRzLmpvaW4oJywnKTtcclxuICAgICAgICB0aGlzLnNvcnREaXJlY3Rpb25zID0gYXJyU29ydERpcmVjdGlvbi5qb2luKCcsJykgfHwgJ2FzYyc7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGlmICh0aGlzLnNvcnRGaWVsZHMgJiYgdGhpcy5zb3J0RGlyZWN0aW9ucykge1xyXG4gICAgICB0aGlzLmJpbmRpbmdMaXN0LnNvcnRCeSh0aGlzLnNvcnRGaWVsZHMsIHRoaXMuc29ydERpcmVjdGlvbnMpO1xyXG4gICAgICAvLyB0aGlzLnByb3BzID0gdGhpcy5idWlsZFByb3BzKCk7XHJcbiAgICB9XHJcbiAgICB0aGlzLmJpbmREYXRhKCk7XHJcbiAgfVxyXG4gIC8vICNlbmRyZWdpb25cclxuXHJcbiAgLy8gI3JlZ2lvbiDmlbDmja7nu5Hlrprpg6jliIZcclxuICAvKipcclxuICAgKiDmm7TmlrDmlbDmja5cclxuICAgKiBAcGFyYW0gY2hhbmdlPyDlj5jmm7RcclxuICAgKi9cclxuICBiaW5kRGF0YShjaGFuZ2U/OiBDaGFuZ2UpIHtcclxuICAgIGNvbnN0IGlzUmVtb3RlRmlsdGVyID0gdGhpcy5ncmlkICYmIHRoaXMuZ3JpZC5yZW1vdGVGaWx0ZXIgfHwgZmFsc2U7XHJcbiAgICAvLyDlhYjmiafooYzmjpLluo9cclxuICAgIGlmICh0aGlzLnNvcnRGaWVsZHMgJiYgIXRoaXMuZ3JpZC5lZGl0YWJsZSAmJiBjaGFuZ2UgJiYgKGNoYW5nZS50eXBlID09PSAnTG9hZCcgfHwgY2hhbmdlLnR5cGUgPT09ICdTZWxlY3Rpb25DaGFuZ2VkJykpIHtcclxuICAgICAgdGhpcy5zb3J0QmluZGluZ0xpc3QoKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgLy8g5paw5aKe5pWw5o2u5pe25riF56m66KGo5qC8562b6YCJ5p2h5Lu2XHJcbiAgICBpZiAoKHRoaXMuZ3JpZC5lZGl0YWJsZSA9PT0gdHJ1ZSB8fCBjaGFuZ2UgJiYgY2hhbmdlLnR5cGUgPT09IENoYW5nZVR5cGUuQXBwZW5kKSAmJiB0aGlzLmZpbHRlcnMgJiYgT2JqZWN0LmtleXModGhpcy5maWx0ZXJzKS5sZW5ndGggPiAwICYmICFpc1JlbW90ZUZpbHRlcikge1xyXG4gICAgICB0aGlzLmZpbHRlcnMgPSB7fTtcclxuICAgICAgdGhpcy5ncmlkLmNsZWFyQ29uZGl0aW9uKCk7XHJcbiAgICB9XHJcbiAgICAvLyDlho10b0pTT05cclxuICAgIGxldCBkYXRhOiBhbnkgPSB0aGlzLmJpbmRpbmdMaXN0LnRvSlNPTigpO1xyXG4gICAgaWYgKHRoaXMuZmlsdGVycyAmJiBPYmplY3Qua2V5cyh0aGlzLmZpbHRlcnMpLmxlbmd0aCA+IDAgJiYgIWlzUmVtb3RlRmlsdGVyKSB7XHJcbiAgICAgIGRhdGEgPSB0aGlzLmdyaWQuY2xpZW50RmlsdGVyU2VydmljZS5leGVjdXRlRmlsdGVyKGRhdGEsIHRoaXMuZmlsdGVycyk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMuZmlsdGVycyAmJiBPYmplY3Qua2V5cyh0aGlzLmZpbHRlcnMpLmxlbmd0aCA+IDAgJiYgIWlzUmVtb3RlRmlsdGVyICYmICghY2hhbmdlIHx8IGNoYW5nZSAmJiBjaGFuZ2UudHlwZSAhPT0gQ2hhbmdlVHlwZS5TZWxlY3Rpb25DaGFuZ2VkICYmIGNoYW5nZS50eXBlICE9PSBDaGFuZ2VUeXBlLkdsb2JhbFNlbGVjdGlvbkNoYW5nZWQpKSB7XHJcbiAgICAgIGlmIChkYXRhICYmIGRhdGEubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIC8vIOWIpOaWreW9k+WJjeihjOaYr+WQpuWcqOi/h+a7pOWQjueahOaVsOaNruS4rVxyXG4gICAgICAgIGNvbnN0IHJvdyA9IChkYXRhIGFzIFtdKS5maW5kKGl0ZW0gPT4gaXRlbVt0aGlzLmJpbmRpbmdMaXN0LnByaW1hcnlLZXldID09PSB0aGlzLmJpbmRpbmdMaXN0LmN1cnJlbnRJZCk7XHJcbiAgICAgICAgaWYgKCFyb3cpIHtcclxuICAgICAgICAgIGNvbnN0IGZpcnN0Um93SWQgPSBkYXRhWzBdW3RoaXMuYmluZGluZ0xpc3QucHJpbWFyeUtleV07XHJcbiAgICAgICAgICB0aGlzLmJpbmRpbmdMaXN0LnNldEN1cnJlbnRJZChmaXJzdFJvd0lkLCB0cnVlLCB0cnVlKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8g5pys5Zyw6L+H5ruk5a6M5LmL5ZCO5rKh5pyJ5pWw5o2u5LqGXHJcbiAgICAgICAgLy8gdGhpcy5iaW5kaW5nTGlzdC5jdXJyZW50SWQgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuYmluZGluZ0xpc3Quc2V0Q3VycmVudElkKG51bGwsIHRydWUsIHRydWUsIHRydWUpO1xyXG4gICAgICAgIC8vIOWNlemAieaXtua4heepumlkc1xyXG4gICAgICAgIGlmICghdGhpcy5ncmlkLm11bHRpU2VsZWN0KSB7XHJcbiAgICAgICAgICB0aGlzLnNldENoZWNrcyhbXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBjb25zdCByZXN1bHQgPSB0aGlzLnNob3VsZENvbXBvbmVudFVwZGF0ZShjaGFuZ2UsIGRhdGEpO1xyXG4gICAgaWYgKCFyZXN1bHQucmVzdWx0KSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIC8vIGNvbnN0IG5leHRQcm9wcyA9IHRoaXMuYnVpbGRQcm9wcyhyZXN1bHQpO1xyXG4gICAgdGhpcy5yZW5kZXJHcmlkKHJlc3VsdC5wcm9wcyk7XHJcbiAgICB0aGlzLnByb3BzID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShyZXN1bHQucHJvcHMpKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5riy5p+TZ3JpZFxyXG4gICAqIEBwYXJhbSBwcm9wcyDlsZ7mgKdcclxuICAgKi9cclxuICBwcml2YXRlIHJlbmRlckdyaWQocHJvcHM6IGFueSkge1xyXG4gICAgY29uc3QgeyBwYWdlSW5kZXgsIHBhZ2VTaXplLCB0b3RhbCwgcGFnaW5hdGlvbiwgZGF0YSB9ID0gcHJvcHM7XHJcbiAgICBjb25zdCB2aXJ0dWFsaXplZExvYWQgPSB0aGlzLmdyaWQudmlydHVhbGl6ZWRBc3luY0xvYWQgfHwgZmFsc2U7XHJcbiAgICB0aGlzLmdyaWQudG90YWwgPSB0b3RhbDtcclxuICAgIHRoaXMuZ3JpZC5wYWdlU2l6ZSA9IHBhZ2VTaXplO1xyXG4gICAgdGhpcy5ncmlkLnBhZ2VJbmRleCA9IHBhZ2VJbmRleDtcclxuICAgIHRoaXMuZ3JpZC5wYWdpbmF0aW9uID0gcGFnaW5hdGlvbjtcclxuICAgIHRoaXMuZ3JpZC5jb250cm9sUGFnaW5hdGlvblN0YXRlID0gZmFsc2U7XHJcbiAgICAvLyB0aGlzLmVuZENlbGxFZGl0KCk7XHJcbiAgICBpZiAocGFnZVNpemUgPT09IDApIHtcclxuICAgICAgdGhpcy5ncmlkLnBhZ2luYXRpb24gPSBmYWxzZTtcclxuICAgICAgdGhpcy5ncmlkLnBhZ2VJbmRleCA9IDE7XHJcbiAgICAgIC8vIOS/ruWkjeS4jeWIhumhteaXtmdyaWTlkK/nlKjliIbnu4Tku43kvJrph43mlrDpgqbmlbDnmoTpl67pophcclxuICAgICAgLy8gdGhpcy5ncmlkLnBhZ2VTaXplID0gdG90YWw7XHJcbiAgICB9XHJcbiAgICBpZiAodmlydHVhbGl6ZWRMb2FkKSB7XHJcbiAgICAgIHRoaXMuZ3JpZC5sb2FkVmlydHVhbERhdGEoe1xyXG4gICAgICAgIGl0ZW1zOiBkYXRhLFxyXG4gICAgICAgIHBhZ2VJbmRleCxcclxuICAgICAgICBwYWdlU2l6ZSxcclxuICAgICAgICB0b3RhbFxyXG4gICAgICB9KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuZ3JpZC5sb2FkRGF0YShkYXRhKTtcclxuICAgIH1cclxuICB9XHJcbiAgLyoqXHJcbiAgICog5p6E6YCg6KGo5qC85pWw5o2u5bGe5oCnXHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIGJ1aWxkUHJvcHMoZGF0YXM/OiBBcnJheTxhbnk+KSB7XHJcbiAgICBsZXQgZGF0YTtcclxuICAgIGlmICh0eXBlb2YgKGRhdGFzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgZGF0YSA9IGRhdGFzO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgZGF0YSA9IHRoaXMuYmluZGluZ0xpc3QudG9KU09OKCk7XHJcbiAgICB9XHJcbiAgICAvLyBsZXQgc2tpcCA9IDA7XHJcbiAgICBsZXQgeyBwYWdlSW5kZXggPSAxLCBwYWdlU2l6ZSA9IDAgfSA9IHRoaXMuZ2V0UGFnaW5nSW5mbygpIHx8IHt9O1xyXG4gICAgbGV0IHsgdG90YWwgPSAwIH0gPSB0aGlzLmdldFBhZ2luZ0luZm8oKSB8fCB7fTtcclxuICAgIC8vIGlmIChwYWdlSW5kZXggPiAwKSB7XHJcbiAgICAvLyAgIHNraXAgPSAocGFnZUluZGV4IC0gMSkgKiBwYWdlU2l6ZTtcclxuICAgIC8vIH1cclxuICAgIGlmIChwYWdlU2l6ZSA9PT0gMCAmJiB0b3RhbCA9PT0gMCkge1xyXG4gICAgICB0b3RhbCA9IGRhdGEubGVuZ3RoO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHsgZGF0YSwgcGFnZUluZGV4LCBwYWdlU2l6ZSwgdG90YWwsIHBhZ2luYXRpb246IHBhZ2VTaXplICE9PSAwIH07XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiuoeeul2dyaWTnirbmgIFcclxuICAgKi9cclxuICBwcml2YXRlIGJ1aWxkR3JpZFByb3BzKCkge1xyXG4gICAgY29uc3QgZGF0YSA9IHRoaXMuZ3JpZC5kYXRhIHx8IFtdO1xyXG4gICAgbGV0IHNraXAgPSAwO1xyXG4gICAgY29uc3QgeyBwYWdlSW5kZXggPSAxLCBwYWdlU2l6ZSA9IDAgfSA9IHsgcGFnZUluZGV4OiB0aGlzLmdyaWQucGFnZUluZGV4LCBwYWdlU2l6ZTogdGhpcy5ncmlkLnBhZ2VTaXplIH07XHJcbiAgICBsZXQgdG90YWwgPSB0aGlzLmdyaWQudG90YWwgfHwgMDtcclxuICAgIGlmIChwYWdlSW5kZXggPiAwKSB7XHJcbiAgICAgIHNraXAgPSAocGFnZUluZGV4IC0gMSkgKiBwYWdlU2l6ZTtcclxuICAgIH1cclxuICAgIGlmIChwYWdlU2l6ZSA9PT0gMCAmJiB0b3RhbCA9PT0gMCkge1xyXG4gICAgICB0b3RhbCA9IGRhdGEubGVuZ3RoO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHsgZGF0YSwgcGFnZUluZGV4LCBwYWdlU2l6ZSwgdG90YWwsIHBhZ2luYXRpb246IHRoaXMuZ3JpZC5wYWdpbmF0aW9uIH07XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOaVsOaNrua6kOWPkeeUn+WPmOabtFxyXG4gICAqIEBwYXJhbSBjaGFuZ2Ug5Y+Y5pu0XHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIG9uQmluZGluZ0RhdGFDaGFuZ2UoY2hhbmdlOiBDaGFuZ2UpIHtcclxuICAgIHRoaXMudXBkYXRlRGF0YVNvdXJjZShjaGFuZ2UpO1xyXG4gICAgdGhpcy51cGRhdGVTZWxlY3RlZFJvdyhjaGFuZ2UpO1xyXG4gICAgLy8gdGhpcy51cGRhdGVHcmlkKGNoYW5nZSk7XHJcbiAgICAvLyDkuI3muIXpmaTli77pgInooYzvvIzpnIDopoHkv53nlZnli77pgInnirbmgIFcclxuICAgIC8vIHRoaXMuY2xlYXJDaGVja2VkUm93cyhjaGFuZ2UpO1xyXG4gICAgdGhpcy5lbmRDZWxsRWRpdChjaGFuZ2UpO1xyXG4gICAgLy8g5pu05paw5Yu+6YCJ6KGM5pWw5o2uXHJcbiAgICB0aGlzLnVwZGF0ZUNoZWNrZWRSb3dzKGNoYW5nZSk7XHJcbiAgICB0aGlzLnVwZGF0ZURhdGEoY2hhbmdlKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5pu05paw5pWw5o2uXHJcbiAgICovXHJcbiAgcHJpdmF0ZSB1cGRhdGVEYXRhU291cmNlKGNoYW5nZTogQ2hhbmdlKSB7XHJcbiAgICAvKmlmIChjaGFuZ2UpIHtcclxuICAgICAgY29uc3QgaXNNYXRjaCA9IHRoaXMuY2hlY2tJZkNoYW5nZU1hdGNoQmluZGluZ1BhdGgoY2hhbmdlKTtcclxuICAgICAgaWYgKCFpc01hdGNoKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICB9Ki9cclxuICAgIGlmIChjaGFuZ2UgJiYgY2hhbmdlLnR5cGUgPT09IENoYW5nZVR5cGUuVmFsdWVDaGFuZ2VkKSB7XHJcbiAgICAgIHRoaXMucmVuZGVyR3JpZFN1YmplY3QubmV4dChjaGFuZ2UpO1xyXG4gICAgfSBlbHNlIGlmIChjaGFuZ2UgJiYgKGNoYW5nZS50eXBlID09PSBDaGFuZ2VUeXBlLlNlbGVjdGlvbkNoYW5nZWQgfHwgY2hhbmdlLnR5cGUgPT09IENoYW5nZVR5cGUuR2xvYmFsU2VsZWN0aW9uQ2hhbmdlZCkpIHtcclxuICAgICAgaWYgKHRoaXMuYmluZGluZ0xpc3QuY3VycmVudElkID09PSAodGhpcy5ncmlkLnNlbGVjdGVkUm93ICYmIHRoaXMuZ3JpZC5zZWxlY3RlZFJvdy5pZCkgJiYgdGhpcy5ncmlkLnRvdGFsID4gMCkge1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMuYmluZERhdGEoY2hhbmdlKTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5iaW5kRGF0YShjaGFuZ2UpO1xyXG4gICAgfVxyXG4gIH1cclxuICAvLyBwcml2YXRlIGVuZENlbGxFZGl0KCkge1xyXG4gIC8vICAgY29uc3QgaXNFZGl0aW5nID0gdGhpcy5ncmlkLmlzRWRpdGluZygpO1xyXG4gIC8vICAgaWYgKGlzRWRpdGluZykge1xyXG4gIC8vICAgICB0aGlzLmdyaWQuZW5kQ2VsbEVkaXQoKTtcclxuICAvLyAgIH1cclxuICAvLyB9XHJcbiAgcHJpdmF0ZSBlbmRDZWxsRWRpdChjaGFuZ2U6IENoYW5nZSkge1xyXG4gICAgY29uc3QgaXNFZGl0aW5nID0gdGhpcy5ncmlkLmlzRWRpdGluZygpO1xyXG4gICAgaWYgKGNoYW5nZS50eXBlID09PSBDaGFuZ2VUeXBlLkxvYWQgJiYgaXNFZGl0aW5nKSB7XHJcbiAgICAgIHRoaXMuZ3JpZC5lbmRDZWxsRWRpdCgpO1xyXG4gICAgfVxyXG4gIH1cclxuICAvKipcclxuICAgKiDorr7nva5ncmlk5b2T5YmN6YCJ5oup6KGMXHJcbiAgICogQHBhcmFtIGNoYW5nZSDlj5jmm7RcclxuICAgKi9cclxuICBwcml2YXRlIHVwZGF0ZVNlbGVjdGVkUm93KGNoYW5nZT86IENoYW5nZSkge1xyXG4gICAgaWYgKCF0aGlzLmJpbmRpbmdMaXN0IHx8ICF0aGlzLmJpbmRpbmdMaXN0LmN1cnJlbnRJZCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICAvLyDpobXnoIHliIfmjaLml7bkuI3miafooYzlvZPliY3ooYzliIfmjaJcclxuICAgIGlmIChjaGFuZ2UgJiYgY2hhbmdlLnR5cGUgPT09IENoYW5nZVR5cGUuUGFnaW5hdGlvbkluZm9DaGFuZ2UpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMudmlld01vZGVsICYmIHRoaXMudmlld01vZGVsLmZyYW1lQ29udGV4dC5iaW5kaW5nRGF0YS5yb3dTZWxlY3RlZEV2ZW50U3VzcGVuZCA9PT0gdHJ1ZSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBjb25zdCB7IGlkOiBncmlkU2VsZWN0ZWRSb3dJZCA9IG51bGwgfSA9IHRoaXMuZ3JpZC5zZWxlY3RlZFJvdyB8fCB7fTtcclxuICAgIGNvbnN0IGN1cnJlbnRJZCA9IHRoaXMuYmluZGluZ0xpc3QuY3VycmVudElkO1xyXG4gICAgLy8gZ3JpZOW9k+WJjeihjOS4jmJpbmdpbmdMaXN05b2T5YmN6KGM5LiA6Ie077yM5peg6aG75YiH5o2iXHJcbiAgICBpZiAoZ3JpZFNlbGVjdGVkUm93SWQgPT09IGN1cnJlbnRJZCkge1xyXG4gICAgICBjb25zdCBpc01hdGNoID0gY2hhbmdlICYmIChjaGFuZ2UucGF0aC50b1N0cmluZygpID09PSB0aGlzLnZpZXdNb2RlbC5iaW5kaW5nUGF0aC5zcGxpdCgnLycpLmZpbHRlcihwID0+IHApLnRvU3RyaW5nKCkpO1xyXG4gICAgICBpZiAoY2hhbmdlICYmIGNoYW5nZS50eXBlID09PSBDaGFuZ2VUeXBlLkxvYWQgJiYgaXNNYXRjaCkge1xyXG4gICAgICAgIHRoaXMuZ3JpZC5jbGVhclNlbGVjdGlvbnMoKTtcclxuICAgICAgICB0aGlzLmdyaWQuc2VsZWN0Um93KGN1cnJlbnRJZCwgdHJ1ZSwgdHJ1ZSk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy5zZWxlY3RHcmlkUm93KHRoaXMuYmluZGluZ0xpc3QuY3VycmVudElkKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5rOo5YaMYmluZGluZ2RhdGHlj5jljJbkuovku7ZcclxuICAgKi9cclxuICBwcml2YXRlIHJlZ2lzdGVyQmluZGluZ0RhdGFDaGFuZ2VFdmVudCgpIHtcclxuICAgIHRoaXMuYmluZGluZ0RhdGFDaGFuZ2VFdmVudCA9IHRoaXMuYmluZGluZ0RhdGEuY2hhbmdlcy5zdWJzY3JpYmUoKGNoYW5nZTogQ2hhbmdlKSA9PiB7XHJcbiAgICAgIHRoaXMub25CaW5kaW5nRGF0YUNoYW5nZShjaGFuZ2UpO1xyXG4gICAgfSk7XHJcbiAgICB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQuYXBwQ29udGV4dC5tZXNzYWdlUGlwZS5zdWJzY3JpYmUobWVzc2FnZSA9PiB7XHJcbiAgICAgIGlmIChtZXNzYWdlID09PSAnYmluZERhdGEnKSB7XHJcbiAgICAgICAgdGhpcy5iaW5kRGF0YSgpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5Y+W5raIYmluZGluZ2RhdGHlj5jljJborqLpmIVcclxuICAgKi9cclxuICBwcml2YXRlIHVuUmVnaXN0ZXJCaW5kaW5nRGF0YUNoYW5nZUV2ZW50KCkge1xyXG4gICAgaWYgKHRoaXMuYmluZGluZ0RhdGFDaGFuZ2VFdmVudCAmJiB0eXBlb2YgKHRoaXMuYmluZGluZ0RhdGFDaGFuZ2VFdmVudC51bnN1YnNjcmliZSkgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgdGhpcy5iaW5kaW5nRGF0YUNoYW5nZUV2ZW50LnVuc3Vic2NyaWJlKCk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOinpuWPkemhteeggeWIh+aNouS6i+S7tlxyXG4gICAqIEBkZXNjcmlwdGlvbiDmnKzmlrnms5XpgILnlKjlnLrmma/ku4XkuLrniLbnuqdncmlk5pWw5o2u6YeN5pawbG9hZO+8jOmcgOimgeinpuWPkeivpWdyaWTph43mlrDlj5bmlbDkvb/nlKjjgILlhbbku5blnLrmma/or7fli7/kvb/nlKhcclxuICAgKiBAVE9ETzog5b6F6YeN5p6E77yM5o6n5Yi25LiL57qn5pWw5o2u5Yqg6L295bqU6K+l5L6d6LWW6KGo5qC855qE6KGM5YiH5o2i5LqL5Lu277yM5Li05pe26L+Z5qC35aSE55CG77yM5ZCO57ut5o+Q5L6bTG9hZENoaWxkcmVu5LqL5Lu2XHJcbiAgICovXHJcbiAgcHJpdmF0ZSB1cGRhdGVEYXRhKGNoYW5nZT86IENoYW5nZSkge1xyXG4gICAgaWYgKCEoY2hhbmdlICYmIChjaGFuZ2UudHlwZSA9PT0gQ2hhbmdlVHlwZS5TZWxlY3Rpb25DaGFuZ2VkIHx8IGNoYW5nZS50eXBlID09PSBDaGFuZ2VUeXBlLkxvYWQpKSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBjb25zdCBiaW5kaW5nUGF0aCA9IHRoaXMudmlld01vZGVsLmJpbmRpbmdQYXRoO1xyXG4gICAgY29uc3QgZXZlbnRCaW5kaW5nUGF0aCA9ICcvJyArIGNoYW5nZS5wYXRoLmpvaW4oJy8nKTtcclxuICAgIGNvbnN0IGlzUmV0cmlldmUgPSB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQuYXBwQ29udGV4dC5wYXJhbXMuZ2V0KCdyZXRyaWV2ZWluZycpIHx8IGZhbHNlO1xyXG4gICAgaWYgKGNoYW5nZS5wYXRoLmxlbmd0aCA8IDEgfHwgYmluZGluZ1BhdGggPT09ICcvJyB8fCBiaW5kaW5nUGF0aCA9PT0gZXZlbnRCaW5kaW5nUGF0aCB8fCAhYmluZGluZ1BhdGguc3RhcnRzV2l0aChldmVudEJpbmRpbmdQYXRoKSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICAvLyByZXRyaWV2ZeaXtuS8muiHquWKqOW4puWbnuS7juihqOesrOS4gOmhteWPiuS7juihqOesrOS4gOihjOeahOS7juS7juihqOaVsOaNru+8jOaJgOS7peS4jemcgOimgeWGjeWOu+WNleeLrOivt+axglxyXG4gICAgaWYgKGlzUmV0cmlldmUpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgY29uc3QgZnVsbFBhdGhzID0gRW50aXR5UGF0aENvbnZlcnRlci50b0VudGl0eVBhdGhBcnJheSh0aGlzLnZpZXdNb2RlbC5iaW5kaW5nUGF0aCwgdGhpcy5iaW5kaW5nRGF0YSk7XHJcbiAgICBjb25zdCBwYXRocyA9IGZ1bGxQYXRocy5zbGljZSgwLCBmdWxsUGF0aHMubGVuZ3RoIC0gMSk7XHJcbiAgICBjb25zdCBwYXJlbnQgPSB0aGlzLmJpbmRpbmdMaXN0LnBhcmVudDtcclxuICAgIGNvbnN0IHBhcmVudElkID0gcGFyZW50ICYmIHBhcmVudFtwYXJlbnQucHJpbWFyeUtleV07XHJcbiAgICAvLyDkuIrnuqfooajmsqHmnInmlbDmja5cclxuICAgIGlmICghcGFyZW50SWQpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgLy8g6I635Y+Wbm9kZWNvZGVcclxuICAgIGNvbnN0IGJpbmRpbmdQYXRocyA9IHRoaXMudmlld01vZGVsLmJpbmRpbmdQYXRoLnNwbGl0KCcvJykuZmlsdGVyKGl0ZW0gPT4gaXRlbSk7XHJcbiAgICBsZXQgbm9kZUNvZGUgPSBiaW5kaW5nUGF0aHNbYmluZGluZ1BhdGhzLmxlbmd0aCAtIDFdO1xyXG4gICAgbm9kZUNvZGUgPSBub2RlQ29kZS5zdWJzdHIoMCwgbm9kZUNvZGUubGVuZ3RoIC0gMSk7XHJcbiAgICAvLyBjb25zdCBjb25maWdQYXRoID0gYC8ke25vZGVDb2RlfV8ke3BhcmVudElkfWA7XHJcbiAgICBjb25zdCBjb25maWdQYXRoID0gYC8ke25vZGVDb2RlfWA7XHJcbiAgICBsZXQgeyBwYWdlSW5kZXggPSAxIH0gPSB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmdldFBhZ2luYXRpb25Db25maWdCeVBhdGgoY29uZmlnUGF0aCkgfHwge307XHJcbiAgICBjb25zdCB7IHBhZ2VTaXplID0gMCB9ID0gdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5nZXRQYWdpbmF0aW9uQ29uZmlnQnlQYXRoKGNvbmZpZ1BhdGgpIHx8IHt9O1xyXG5cclxuICAgIGNvbnN0IHBhcmVudE5vZGVDb2RlID0gY2hhbmdlLnBhdGhbY2hhbmdlLnBhdGgubGVuZ3RoIC0gMV07XHJcbiAgICBjb25zdCBwYXJlbnRDb25maWdQYXRoID0gJy8nICsgcGFyZW50Tm9kZUNvZGUuc3Vic3RyaW5nKDAsIHBhcmVudE5vZGVDb2RlLmxlbmd0aCAtIDEpO1xyXG4gICAgY29uc3QgeyBwYWdlU2l6ZTogcGFyZW50UGFnZVNpemUgPSAwIH0gPSB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmdldFBhZ2luYXRpb25Db25maWdCeVBhdGgocGFyZW50Q29uZmlnUGF0aCkgfHwge307XHJcbiAgICBjb25zdCBpc1F1ZXJ5Q2hpbGQgPSB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQuYXBwQ29udGV4dC5wYXJhbXMuZ2V0KCdxdWVyeUNoaWxkJykgfHwgZmFsc2U7XHJcbiAgICBpZiAoaXNRdWVyeUNoaWxkKSB7XHJcbiAgICAgIC8vIHRoaXMudmlld01vZGVsLmZyYW1lQ29udGV4dC5hcHBDb250ZXh0LnBhcmFtcy5kZWxldGUoJ3F1ZXJ5Q2hpbGQnKTtcclxuICAgICAgcGFnZUluZGV4ID0gMTtcclxuICAgIH1cclxuICAgIC8vIOW9k+S4iue6p+ihqOWIh+aNouihjOaXtlxyXG4gICAgaWYgKHBhcmVudFBhZ2VTaXplICsgcGFnZVNpemUgIT09IDApIHtcclxuICAgICAgdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LmFwcENvbnRleHQucGFyYW1zLnNldCgnZm9yY2VRdWVyeUNoaWxkJywgdHJ1ZSk7XHJcbiAgICAgIHRoaXMudmlld01vZGVsLmZyYW1lQ29udGV4dC5yZXBvc2l0b3J5LnF1ZXJ5Q2hpbGQocGF0aHMsIHBhZ2VJbmRleCwgcGFnZVNpemUpLnBpcGUoXHJcbiAgICAgICAgZmluYWxpemUoKCkgPT4gdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LmFwcENvbnRleHQucGFyYW1zLmRlbGV0ZSgnZm9yY2VRdWVyeUNoaWxkJykpXHJcbiAgICAgICkuc3Vic2NyaWJlKCk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIG5nT25EZXN0cm95KCkge1xyXG4gICAgdGhpcy51blJlZ2lzdGVyQmluZGluZ0RhdGFDaGFuZ2VFdmVudCgpO1xyXG4gIH1cclxuICAvLyAjZW5kcmVnaW9uXHJcblxyXG4gIC8vICNyZWdpb24g5LqL5Lu25Y+R5bCE5ZmoXHJcblxyXG4gIC8qKlxyXG4gICAqIOWPkeWwhOmAieS4reihjOWIh+aNouS6i+S7tlxyXG4gICAqIEBkZXNjcmlwdGlvbiDnu5/kuIDljZXpgInmqKHlvI/lkozlpJrpgInmqKHlvI/kuIvnmoTooYzliIfmjaLkuovku7ZcclxuICAgKi9cclxuICBwcm90ZWN0ZWQgZmlyZVNlbGVjdGVkUm93Q2hhbmdlKHNlbGVjdGVkUm93Q29udGV4dDogYW55KSB7XHJcbiAgICB0aGlzLnNlbGVjdGVkUm93Q2hhbmdlLmVtaXQoc2VsZWN0ZWRSb3dDb250ZXh0KTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5riF56m66YCJ5a6a6KGMXHJcbiAgICogQHBhcmFtIGNoYW5nZSDlj5jmm7RcclxuICAgKi9cclxuICBwcml2YXRlIGNsZWFyQ2hlY2tlZFJvd3MoY2hhbmdlOiBDaGFuZ2UpIHtcclxuICAgIGlmIChjaGFuZ2UudHlwZSA9PT0gQ2hhbmdlVHlwZS5Mb2FkICYmIHRoaXMuZ3JpZC5tdWx0aVNlbGVjdCkge1xyXG4gICAgICBjb25zdCBpc01hdGNoID0gdGhpcy5jaGVja0lmQ2hhbmdlTWF0Y2hCaW5kaW5nUGF0aChjaGFuZ2UpO1xyXG4gICAgICBpZiAoaXNNYXRjaCkge1xyXG4gICAgICAgIHRoaXMuc2V0Q2hlY2tzKFtdKTtcclxuICAgICAgICBpZiAodHlwZW9mICh0aGlzLmdyaWQuY2xlYXJDaGVja2VkcykgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgIHRoaXMuZ3JpZC5jbGVhckNoZWNrZWRzKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyAjZW5kcmVnaW9uXHJcblxyXG5cclxuXHJcbiAgLy8gI3JlZ2lvbiDpgJrkv6FcclxuXHJcbiAgLyoqXHJcbiAgICog6K6+572uQmluZGluZ0xpc3TnmoTlvZPliY3ooYxcclxuICAgKiBAcGFyYW0gaWQg5b2T5YmN6KGM5YaF56CBXHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIHNldFNlbGVjdGlvbklkVG9CaW5kaW5nRGF0YShpZDogc3RyaW5nKTogdm9pZCB7XHJcbiAgICAvLyDlpoLmnpzlvZPliY3ooYzkuI3lrZjlnKjvvIzliJnlvLrliLborr7nva5cclxuICAgIGlmICghaWQpIHtcclxuICAgICAgdGhpcy5iaW5kaW5nTGlzdC5jdXJyZW50SWQgPSBpZDtcclxuICAgICAgaWYgKCF0aGlzLmdyaWQubXVsdGlTZWxlY3QpIHtcclxuICAgICAgICB0aGlzLnNldENoZWNrcyhbXSk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMuYmluZGluZ0xpc3QuY3VycmVudElkICE9PSBpZCkge1xyXG4gICAgICB0aGlzLmJpbmRpbmdMaXN0LnNldEN1cnJlbnRJZChpZCwgdHJ1ZSk7XHJcbiAgICB9XHJcbiAgICAvLyDljZXpgInmqKHlvI/kuIvlsIblvZPliY3ooYzorr7nva7liLBpZHNcclxuICAgIGlmICghdGhpcy5ncmlkLm11bHRpU2VsZWN0KSB7XHJcbiAgICAgIHRoaXMuc2V0Q2hlY2tzKFtpZF0pO1xyXG4gICAgfVxyXG4gIH1cclxuICBwcml2YXRlIHVwZGF0ZUNoZWNrZWRSb3dzKGNoYW5nZXM6IENoYW5nZSkge1xyXG4gICAgaWYgKGNoYW5nZXMudHlwZSA9PT0gQ2hhbmdlVHlwZS5Mb2FkKSB7XHJcbiAgICAgIHRoaXMuc2V0Q2hlY2tlZFJvd3MoKTtcclxuICAgIH0gZWxzZSBpZiAoY2hhbmdlcy50eXBlID09PSBDaGFuZ2VUeXBlLlZhbHVlQ2hhbmdlZCkge1xyXG4gICAgICBjb25zdCBpZHMgPSB0aGlzLmdldENoZWNrcygpO1xyXG4gICAgICBpZiAoY2hhbmdlcy5pZCAmJiBpZHMuaW5jbHVkZXMoY2hhbmdlcy5pZCkpIHtcclxuICAgICAgICB0aGlzLnNldENoZWNrZWRSb3dzKCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbiAgLyoqXHJcbiAgICog6K6+572u6YCJ5oup6KGMXHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIHNldENoZWNrcyhpZHM6IHN0cmluZ1tdKSB7XHJcbiAgICB0aGlzLnZpZXdNb2RlbC51aVN0YXRlLnNldFByb3BlcnR5VmFsdWUoJ2lkcycsIGlkcyk7XHJcbiAgICB0aGlzLnNldENoZWNrZWRSb3dzKGlkcyk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluWLvumAieihjGlk5pWw57uEXHJcbiAgICogQHJldHVybnMgXHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIGdldENoZWNrcygpOiBzdHJpbmdbXSB7XHJcbiAgICByZXR1cm4gdGhpcy52aWV3TW9kZWwudWlTdGF0ZVsnaWRzJ10gfHwgW107XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOabtOaWsOWLvumAieihjOaVsOaNrlxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBzZXRDaGVja2VkUm93cyhpZHM/OiBzdHJpbmdbXSkge1xyXG4gICAgLy8g6auY6YCf5qih5byP5pe25LiN5YaN6K6+572ucm93c1xyXG4gICAgLy8gaWYgKHRoaXMudmlld01vZGVsLmZyYW1lQ29udGV4dC5hcHBDb250ZXh0LnJ1bk1vZGUgPT09IFJ1bk1vZGUuaGlnaFNwZWVkKSB7XHJcbiAgICAvLyAgIHJldHVybjtcclxuICAgIC8vIH1cclxuICAgIGlmICh0eXBlb2YgaWRzID09PSAndW5kZWZpbmVkJykge1xyXG4gICAgICBpZHMgPSB0aGlzLnZpZXdNb2RlbC51aVN0YXRlWydpZHMnXSB8fCBbXTtcclxuICAgIH1cclxuICAgIGlmICghQXJyYXkuaXNBcnJheShpZHMpIHx8IGlkcy5sZW5ndGggPCAxKSB7XHJcbiAgICAgIC8vIOatpOaXtmlkc+ayoeacieWAvO+8jHJvd3PkuK3kuZ/kuI3lupTor6XmnIlcclxuICAgICAgdGhpcy52aWV3TW9kZWwudWlTdGF0ZS5zZXRQcm9wZXJ0eVZhbHVlKCdyb3dzJywgbnVsbCk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGxldCBsaXN0ID0gW107XHJcbiAgICAvLyBUT0RP77yacm93c+S4reaVsOaNruWcqOmrmOmAn+aooeW8j+WSjOaZrumAmuaooeW8j+S4i+WkmuivreWtl+auteeahOWAvOihqOeOsOS4jeS4gOiHtO+8jOmrmOmAn+aooeW8j+S4i+WkmuivreWtl+auteWAvOS4uuWvueixoe+8jOaZrumAmuaooeW8j+S4uuW9k+WJjeivreiogOOAguaaguS4jeWkhOeQhumrmOmAn+aooeW8j+WcuuaZr1xyXG4gICAgaWYgKHRoaXMudmlld01vZGVsLmZyYW1lQ29udGV4dC5hcHBDb250ZXh0LnJ1bk1vZGUgPT09IFJ1bk1vZGUuaGlnaFNwZWVkKSB7XHJcbiAgICAgIGxpc3QgPSB0aGlzLmdyaWQuZGF0YSB8fCBbXTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGxpc3QgPSB0aGlzLmJpbmRpbmdMaXN0LnRvSlNPTih7IGlnbm9yZU11bHRpTGFuZ0lucHV0OiB0cnVlIH0pO1xyXG4gICAgfVxyXG4gICAgY29uc3Qgcm93czogTWFwPHN0cmluZywgYW55PiA9IHRoaXMudmlld01vZGVsLnVpU3RhdGVbJ3Jvd3MnXSB8fCBuZXcgTWFwPHN0cmluZywgYW55PigpO1xyXG5cclxuICAgIGNvbnN0IHJlc3VsdCA9IG5ldyBNYXA8c3RyaW5nLCBhbnk+KCk7XHJcbiAgICBpZHMuZm9yRWFjaCgoaWQ6IGFueSkgPT4ge1xyXG4gICAgICBjb25zdCBpdGVtID0gbGlzdC5maW5kKGl0ZW0gPT4gaXRlbVt0aGlzLnByaW1hcnlLZXldID09PSBpZCk7XHJcbiAgICAgIGNvbnN0IG90aGVyUGFnZUl0ZW0gPSByb3dzLmdldChpZCk7XHJcbiAgICAgIGlmIChpdGVtKSB7XHJcbiAgICAgICAgcmVzdWx0LnNldChpZCwgaXRlbSk7XHJcbiAgICAgIH0gZWxzZSBpZiAob3RoZXJQYWdlSXRlbSkge1xyXG4gICAgICAgIHJlc3VsdC5zZXQoaWQsIG90aGVyUGFnZUl0ZW0pO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIHRoaXMudmlld01vZGVsLnVpU3RhdGUuc2V0UHJvcGVydHlWYWx1ZSgncm93cycsIHJlc3VsdCk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOmAieS4rWdyaWTooYxcclxuICAgKiBAcGFyYW0gaWQgaWRcclxuICAgKi9cclxuICBwcm90ZWN0ZWQgc2VsZWN0R3JpZFJvdyhpZDogYW55KSB7XHJcbiAgICB0aGlzLmdyaWQuc2VsZWN0Um93KGlkKTtcclxuICAgIHRoaXMuZ3JpZC5zY3JvbGxUb0N1cnJlbnRSb3coKTtcclxuICB9XHJcbiAgLy8gI2VuZHJlZ2lvblxyXG4gIC8vICNyZWdpb24g5LqL5Lu25aSE55CG5ZmoXHJcblxyXG4gIC8qKlxyXG4gICAqIOmhteeggeWIh+aNouS6i+S7tlxyXG4gICAqIEBwYXJhbSBldmVudCBldmVudFxyXG4gICAqL1xyXG4gIEBIb3N0TGlzdGVuZXIoJ3BhZ2VDaGFuZ2VkJywgWyckZXZlbnQnXSlcclxuICBwdWJsaWMgcGFnZUNoYW5nZWRIYW5kbGVyKGV2ZW50OiBhbnkpIHtcclxuICAgIGxldCB7IHBhZ2VJbmRleCwgcGFnZVNpemUgfSA9IGV2ZW50O1xyXG4gICAgaWYgKHBhZ2VJbmRleCA8IDEpIHtcclxuICAgICAgcGFnZUluZGV4ID0gMTtcclxuICAgIH1cclxuICAgIGNvbnN0IHNraXAgPSAocGFnZUluZGV4IC0gMSkgKiBwYWdlU2l6ZTtcclxuICAgIHRoaXMuYmluZGluZ0RhdGEuc2V0UGFnaW5nSW5mbyhza2lwLCBwYWdlU2l6ZSwgdGhpcy5iaW5kaW5nRGF0YS5iaW5kaW5nUGF0aCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDooYzliIfmjaLkuovku7ZcclxuICAgKiBAcGFyYW0gZXZlbnQgZXZlbnRcclxuICAgKi9cclxuICBASG9zdExpc3RlbmVyKCdzZWxlY3RDaGFuZ2VkJywgWyckZXZlbnQnXSlcclxuICBwdWJsaWMgc2VsZWN0ZWRSb3dDaGFuZ2VkKGV2ZW50OiBhbnkpIHtcclxuICAgIGNvbnN0IHsgaW5kZXgsIGRhdGEgfSA9IGV2ZW50O1xyXG4gICAgY29uc3QgaWQgPSBkYXRhW3RoaXMucHJpbWFyeUtleV07XHJcbiAgICB0aGlzLnNldFNlbGVjdGlvbklkVG9CaW5kaW5nRGF0YShpZCk7XHJcbiAgICB0aGlzLmZpcmVTZWxlY3RlZFJvd0NoYW5nZShldmVudCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlj5bmtojooYzpgInmi6nkuovku7ZcclxuICAgKiBAcGFyYW0gZXZlbnQgZXZlbnRcclxuICAgKi9cclxuICBASG9zdExpc3RlbmVyKCd1blNlbGVjdCcsIFsnJGV2ZW50J10pXHJcbiAgcHVibGljIHVuU2VsZWN0ZWQoZXZlbnQ6IGFueSkge1xyXG4gICAgaWYgKCFldmVudCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBjb25zdCB7IGRhdGEgPSB7fSB9ID0gZXZlbnQ7XHJcbiAgICBjb25zdCBpZCA9IGRhdGFbdGhpcy5wcmltYXJ5S2V5XTtcclxuICAgIGNvbnN0IGN1cnJlbnRJZCA9IHRoaXMuYmluZGluZ0xpc3QuY3VycmVudElkO1xyXG4gICAgaWYgKGlkID09PSBjdXJyZW50SWQpIHtcclxuICAgICAgdGhpcy5zZXRTZWxlY3Rpb25JZFRvQmluZGluZ0RhdGEobnVsbCk7XHJcbiAgICB9XHJcbiAgICAvLyB0aGlzLmZpcmVTZWxlY3RlZFJvd0NoYW5nZShldmVudCk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWLvumAieihjOWPkeeUn+WPmOWMllxyXG4gICAqIEBwYXJhbSBldmVudCBldmVudFxyXG4gICAqL1xyXG4gIEBIb3N0TGlzdGVuZXIoJ2NoZWNrZWRDaGFuZ2UnLCBbJyRldmVudCddKVxyXG4gIHB1YmxpYyBjaGVja2VkQ2hhbmdlZChldmVudDogYW55KSB7XHJcbiAgICBldmVudCA9IGV2ZW50IHx8IFtdO1xyXG4gICAgY29uc3QgaWRzID0gZXZlbnQubWFwKGl0ZW0gPT4gaXRlbS5pZCk7XHJcbiAgICB0aGlzLnNldENoZWNrcyhpZHMpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDliIbpobXlpKflsI/lj5jmm7Tkuovku7ZcclxuICAgKiBAcGFyYW0gZXZlbnQgZXZlbnRcclxuICAgKi9cclxuICBASG9zdExpc3RlbmVyKCdwYWdlU2l6ZUNoYW5nZWQnLCBbJyRldmVudCddKVxyXG4gIHB1YmxpYyBwYWdlU2l6ZUNoYW5nZWQoZXZlbnQ6IGFueSkge1xyXG4gICAgY29uc3QgeyBwYWdlSW5kZXgsIHBhZ2VTaXplIH0gPSBldmVudDtcclxuICAgIGNvbnN0IHNraXAgPSAwOy8vKHBhZ2VJbmRleCAtIDEpICogcGFnZVNpemU7XHJcbiAgICAvLyB0aGlzLmJpbmRpbmdMaXN0LnNldFBhZ2luYXRpb25JbmZvKHNraXAsIHBhZ2VTaXplKTtcclxuICAgIHRoaXMuYmluZGluZ0RhdGEuc2V0UGFnaW5nSW5mbyhza2lwLCBwYWdlU2l6ZSwgdGhpcy5iaW5kaW5nRGF0YS5iaW5kaW5nUGF0aCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBncmlk5rua5Yqo5Yqg6L295pWw5o2uXHJcbiAgICogQHBhcmFtIGV2ZW50IGV2ZW50XHJcbiAgICovXHJcbiAgQEhvc3RMaXN0ZW5lcignc2Nyb2xsWUxvYWQnLCBbJyRldmVudCddKVxyXG4gIHB1YmxpYyBzY3JvbGxZKGV2ZW50OiBhbnkpIHtcclxuICAgIGNvbnN0IHsgcGFnZXI6IHBhZ2VJbmRleCwgcGFnZVNpemUgfSA9IGV2ZW50O1xyXG4gICAgY29uc3Qgc2tpcCA9IChwYWdlSW5kZXggLSAxKSAqIHBhZ2VTaXplO1xyXG4gICAgdGhpcy5iaW5kaW5nRGF0YS5zZXRQYWdpbmdJbmZvKHNraXAsIHBhZ2VTaXplLCB0aGlzLmJpbmRpbmdEYXRhLmJpbmRpbmdQYXRoKTtcclxuICB9XHJcbiAgQEhvc3RMaXN0ZW5lcignZmlsdGVyQ2hhbmdlZCcsIFsnJGV2ZW50J10pXHJcbiAgcHVibGljIGZpbHRlckNoYW5nZWQoZXZlbnQ6IGFueSkge1xyXG4gICAgdGhpcy5maWx0ZXJzID0gZXZlbnQ7XHJcbiAgfVxyXG4gIC8vICNlbmRyZWdpb25cclxuICBwcml2YXRlIGNoZWNrSWZDaGFuZ2VNYXRjaEJpbmRpbmdQYXRoKGNoYW5nZTogQ2hhbmdlKTogYm9vbGVhbiB7XHJcbiAgICBsZXQgaXNNYXRjaCA9IGZhbHNlO1xyXG4gICAgaWYgKCFjaGFuZ2UgfHwgIWNoYW5nZS5wYXRoKSB7XHJcbiAgICAgIHJldHVybiBpc01hdGNoO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGNoYW5nZVBhdGhBcnJheSA9IGNoYW5nZS5wYXRoO1xyXG4gICAgaWYgKCFjaGFuZ2VQYXRoQXJyYXkpIHtcclxuICAgICAgcmV0dXJuIGlzTWF0Y2g7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCEodGhpcy5iaW5kaW5nRGF0YSkgJiYgISh0aGlzLmJpbmRpbmdEYXRhLmJpbmRpbmdQYXRoKSkge1xyXG4gICAgICByZXR1cm4gaXNNYXRjaDtcclxuICAgIH1cclxuICAgIGNvbnN0IGJpbmdkaW5nUGF0aEFycmF5ID0gdGhpcy5iaW5kaW5nRGF0YS5iaW5kaW5nUGF0aC5zcGxpdCgnLycpO1xyXG4gICAgaWYgKGJpbmdkaW5nUGF0aEFycmF5Lmxlbmd0aCA8PSAwKSB7XHJcbiAgICAgIHJldHVybiBpc01hdGNoO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChjaGFuZ2VQYXRoQXJyYXkubGVuZ3RoID09PSAwKSB7IC8vIOS4u+ihqFxyXG4gICAgICBpZiAodGhpcy5iaW5kaW5nRGF0YS5iaW5kaW5nUGF0aCA9PT0gJy8nKSB7XHJcbiAgICAgICAgaXNNYXRjaCA9IHRydWU7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSBpZiAoY2hhbmdlLnBhdGgubGVuZ3RoID09PSAxKSB7Ly8g5Li75LuO6KGoXHJcbiAgICAgIGlmIChiaW5nZGluZ1BhdGhBcnJheS5sZW5ndGggPT09IDIgJiYgYmluZ2RpbmdQYXRoQXJyYXlbMV0gPT09IGNoYW5nZS5wYXRoWzBdKSB7XHJcbiAgICAgICAgaXNNYXRjaCA9IHRydWU7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSBpZiAoY2hhbmdlLnBhdGgubGVuZ3RoID09PSAyKSB7IC8vIOS4u+S7juS7juihqFxyXG4gICAgICBpZiAoYmluZ2RpbmdQYXRoQXJyYXkubGVuZ3RoID09PSAzICYmIGJpbmdkaW5nUGF0aEFycmF5WzFdID09PSBjaGFuZ2UucGF0aFswXSAmJiBiaW5nZGluZ1BhdGhBcnJheVsyXSA9PT0gY2hhbmdlLnBhdGhbMV0pIHtcclxuICAgICAgICBpc01hdGNoID0gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBpc01hdGNoO1xyXG4gIH1cclxuXHJcbn1cclxuIl19