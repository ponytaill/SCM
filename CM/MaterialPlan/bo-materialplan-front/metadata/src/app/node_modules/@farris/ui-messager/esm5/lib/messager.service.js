/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
/*
 * @Author: 疯狂秀才(Lucas Huang)
 * @LastEditors: 疯狂秀才(Lucas Huang)
 * @Company: Inspur
 * @Version: v0.0.15
 * @Date: 2019-04-02 11:48:08
 * @LastEditTime: 2019-10-26 16:38:34
 */
import { Injectable, Injector, NgZone } from "@angular/core";
import { Subject, of } from "rxjs";
import { BsModalService } from "@farris/ui-modal";
import { MessagerDefaultConfig, MESSAGER_DEFAULT_CONFIG, } from "./messager.config";
import { MessagerComponent } from "./messager.component";
import { LocaleService } from "@farris/ui-locale";
import { format } from "date-fns";
var MessagerService = /** @class */ (function () {
    function MessagerService(bsModalService, injector) {
        this.bsModalService = bsModalService;
        this.injector = injector;
        this.version = "0.0.15";
        this.currentId = -1;
        this.modals = [];
        this.defaultMessagerConfig = null;
        /** @type {?} */
        var config = this.injector.get(MESSAGER_DEFAULT_CONFIG) || MessagerDefaultConfig;
        this.defaultMessagerConfig = Object.assign({}, MessagerDefaultConfig, config);
        this.ngZone = this.injector.get(NgZone);
        this.localeService = this.injector.get(LocaleService);
    }
    Object.defineProperty(MessagerService.prototype, "okText", {
        get: /**
         * @return {?}
         */
        function () {
            return this.localeService.getValue("messager.ok");
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(MessagerService.prototype, "cancelText", {
        get: /**
         * @return {?}
         */
        function () {
            return this.localeService.getValue("messager.cancel");
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(MessagerService.prototype, "yesText", {
        get: /**
         * @return {?}
         */
        function () {
            return this.localeService.getValue("messager.yes");
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(MessagerService.prototype, "noText", {
        get: /**
         * @return {?}
         */
        function () {
            return this.localeService.getValue("messager.no");
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(MessagerService.prototype, "titleText", {
        get: /**
         * @return {?}
         */
        function () {
            return this.localeService.getValue("messager.title");
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(MessagerService.prototype, "errorTitle", {
        get: /**
         * @return {?}
         */
        function () {
            return this.localeService.getValue("messager.errorTitle");
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} str
     * @return {?}
     */
    MessagerService.prototype.escapeHtml = /**
     * @param {?} str
     * @return {?}
     */
    function (str) {
        if (str === null || str === undefined) {
            return "";
        }
        return str
            .replace(/&/g, "&amp;")
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;")
            .replace(/\"/g, "&quot;")
            .replace(/\'/g, "&#39;")
            .replace(/\//g, "&#x2F;");
    };
    /**
     * 显示信息提示框
     * @param msgtype 消息类别
     * @param message 提示消息一
     * @param opts 参数 提供属性 fitContent:true支持自动适应宽度
     * @param submsg 提示消息二级
     */
    /**
     * 显示信息提示框
     * @param {?} msgtype 消息类别
     * @param {?} message 提示消息一
     * @param {?=} opts 参数 提供属性 fitContent:true支持自动适应宽度
     * @param {?=} submsg 提示消息二级
     * @return {?}
     */
    MessagerService.prototype.show = /**
     * 显示信息提示框
     * @param {?} msgtype 消息类别
     * @param {?} message 提示消息一
     * @param {?=} opts 参数 提供属性 fitContent:true支持自动适应宽度
     * @param {?=} submsg 提示消息二级
     * @return {?}
     */
    function (msgtype, message, opts, submsg) {
        var _this = this;
        if (submsg === void 0) { submsg = ""; }
        if (document.activeElement) {
            ((/** @type {?} */ (document.activeElement))).blur();
        }
        /** @type {?} */
        var modalHeight = 180;
        /** @type {?} */
        var defaultOpts = {
            safeHtml: true,
            title: this.titleText,
            width: 390,
            height: modalHeight,
            showButtons: false,
            showMaxButton: false,
            resizable: false,
            initialState: {
                okText: this.okText,
                okHandle: (/**
                 * @return {?}
                 */
                function () {
                    _this.close();
                }),
            },
            class: "modal-message " +
                (msgtype ? "modal-message-type-" + msgtype : ""),
            showHeader: false,
        };
        defaultOpts = Object.assign({}, this.defaultMessagerConfig, defaultOpts);
        /** @type {?} */
        var extendOpts = {};
        switch (msgtype) {
            case "prompt":
                // 弹出对话类型
                extendOpts = { showHeader: true, modalHeight: 260 };
                break;
            case "error":
                // 错误
                extendOpts = {
                    title: this.errorTitle,
                    width: 446,
                    showHeader: true,
                    showMaxButton: true,
                    fitContent: true,
                };
                break;
            case "exception":
                extendOpts = {
                    safeHtml: false,
                    title: this.errorTitle,
                    width: 446,
                    showHeader: true,
                    fitContent: true,
                };
                break;
            default:
                // 默认其他
                extendOpts = { width: submsg ? 446 : 390, fitContent: true };
        }
        Object.assign(defaultOpts, extendOpts);
        if (opts) {
            Object.assign(defaultOpts, opts);
        }
        if (message && defaultOpts.safeHtml) {
            message = this.escapeHtml(message);
        }
        Object.assign(defaultOpts.initialState, {
            type: msgtype,
            message: message,
            msg: submsg,
            exception: opts && opts["exception"] ? opts["exception"] : null,
            showLines: opts && opts["showLines"] ? opts["showLines"] : 3,
            readonly: opts && opts["readonly"] ? opts["readonly"] : false,
        });
        if (defaultOpts["buttons"] && defaultOpts["buttons"].length) {
            if (!defaultOpts.initialState["buttons"] ||
                !defaultOpts.initialState["buttons"].length) {
                defaultOpts.initialState["buttons"] = defaultOpts["buttons"];
            }
        }
        /** @type {?} */
        var _modal = this.bsModalService.show(MessagerComponent, defaultOpts);
        // _modal.content.buttons = defaultOpts['buttons'] || [];
        this.confirmSubject = new Subject();
        if (this.modals.length > 0) {
            /** @type {?} */
            var modalContainerComponent = _modal.dialog;
            modalContainerComponent.instance.isShown = true;
            modalContainerComponent.instance.moveTo(15 * this.modals.length, 15 * this.modals.length);
        }
        this.ngZone.runOutsideAngular((/**
         * @return {?}
         */
        function () {
            // 第1个按钮获取焦点
            setTimeout((/**
             * @return {?}
             */
            function () {
                /** @type {?} */
                var btnOk = _modal.content.btnOkEl
                    ? _modal.content.btnOkEl.nativeElement
                    : null;
                if (btnOk) {
                    btnOk["focus"]();
                }
                else {
                    /** @type {?} */
                    var btns = _modal.dialog.location.nativeElement.querySelectorAll(".modal-footer button");
                    if (btns.length) {
                        btns.item(0)["focus"]();
                    }
                }
                /** @type {?} */
                var overlays = Array.from(document.body.querySelectorAll('body>div, body>farris-dialog>.farris-modal,body>.farris-modal')).filter((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return n; })).map((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) {
                    return window.getComputedStyle(n).zIndex;
                })).filter((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return n && n !== 'auto'; })).map((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) {
                    return parseInt(n, 10);
                }));
                /** @type {?} */
                var maxZindex = Math.max.apply(Math, tslib_1.__spread(overlays));
                _modal.dialog.location.nativeElement.style.zIndex = maxZindex + 1;
            }));
        }));
        this.msgMgr(_modal);
        return _modal;
    };
    /**
     * @private
     * @param {?} ref
     * @return {?}
     */
    MessagerService.prototype.msgMgr = /**
     * @private
     * @param {?} ref
     * @return {?}
     */
    function (ref) {
        var _this = this;
        /** @type {?} */
        var id = this.bsModalService.getModalsCount() + 1000;
        if (this.modals.length === 0) {
            this.modals.push({ id: id, ref: ref });
        }
        else {
            if (!this.getModalById(id)) {
                this.modals.push({ id: id, ref: ref });
            }
            else {
                this.getModalById(id).ref = ref;
            }
        }
        /** @type {?} */
        var cmp = this.getModalCmp();
        cmp.closed.subscribe((/**
         * @param {?} level
         * @return {?}
         */
        function (level) {
            _this.removeMessager(id);
            _this.confirmSubject.unsubscribe();
        }));
        this.currentId = id;
    };
    /**
     * @param {?} message
     * @param {?} okCallback
     * @param {?=} cancelCallback
     * @param {?=} msg
     * @param {?=} fitContent
     * @return {?}
     */
    MessagerService.prototype.question = /**
     * @param {?} message
     * @param {?} okCallback
     * @param {?=} cancelCallback
     * @param {?=} msg
     * @param {?=} fitContent
     * @return {?}
     */
    function (message, okCallback, cancelCallback, msg, fitContent) {
        if (fitContent === void 0) { fitContent = true; }
        /** @type {?} */
        var questionDlg = this.show("question", message, {
            initialState: {
                okText: this.yesText,
                okHandle: (/**
                 * @return {?}
                 */
                function () {
                    questionDlg.close();
                    if (okCallback) {
                        okCallback();
                    }
                }),
                cancelText: this.noText,
                cancelHandle: (/**
                 * @return {?}
                 */
                function () {
                    questionDlg.close();
                    if (cancelCallback) {
                        cancelCallback();
                    }
                }),
            },
            fitContent: fitContent,
        }, msg);
        return questionDlg;
    };
    /**
     * @param {?} messager
     * @param {?} btns
     * @param {?=} msg
     * @param {?=} fitContent
     * @return {?}
     */
    MessagerService.prototype.question2 = /**
     * @param {?} messager
     * @param {?} btns
     * @param {?=} msg
     * @param {?=} fitContent
     * @return {?}
     */
    function (messager, btns, msg, fitContent) {
        if (fitContent === void 0) { fitContent = true; }
        return this.show("question", messager, {
            initialState: {
                buttons: btns,
            },
            fitContent: fitContent,
        }, msg);
    };
    /**
     * 2020年3月7日因为textarea高度在不同浏览器下不一样，固定高度可能会出现滚动条
     * @param title 标题
     * @param msg 信息
     * @param fitContent 自适应内容
     */
    /**
     * 2020年3月7日因为textarea高度在不同浏览器下不一样，固定高度可能会出现滚动条
     * @param {?} title 标题
     * @param {?=} msg 信息
     * @param {?=} fitContent 自适应内容
     * @return {?}
     */
    MessagerService.prototype.prompt = /**
     * 2020年3月7日因为textarea高度在不同浏览器下不一样，固定高度可能会出现滚动条
     * @param {?} title 标题
     * @param {?=} msg 信息
     * @param {?=} fitContent 自适应内容
     * @return {?}
     */
    function (title, msg, fitContent) {
        if (fitContent === void 0) { fitContent = true; }
        /** @type {?} */
        var promptSubject = new Subject();
        /** @type {?} */
        var dlg = this.show("prompt", msg, {
            title: title,
            initialState: {
                okText: this.okText,
                okHandle: (/**
                 * @return {?}
                 */
                function () {
                    /** @type {?} */
                    var mc = (/** @type {?} */ (dlg.content));
                    dlg.close();
                    promptSubject.next(mc.promptText.nativeElement.value);
                }),
                cancelText: this.cancelText,
                cancelHandle: (/**
                 * @return {?}
                 */
                function () {
                    dlg.close();
                    promptSubject.next(false);
                }),
            },
            fitContent: fitContent,
            closed: (/**
             * @return {?}
             */
            function () {
                promptSubject.unsubscribe();
            }),
        }, msg);
        return promptSubject;
    };
    /**
     * @param {?} title
     * @param {?=} msg
     * @param {?=} opts
     * @return {?}
     */
    MessagerService.prototype.prompt2 = /**
     * @param {?} title
     * @param {?=} msg
     * @param {?=} opts
     * @return {?}
     */
    function (title, msg, opts) {
        var _this = this;
        /** @type {?} */
        var promptSubject = new Subject();
        /** @type {?} */
        var _opts = {
            showOkButton: true,
            showCloseButton: true,
            showFontSize: false,
            fontSize: 18,
            readonly: false,
            saveSize: false,
            closeWhenever: true,
        };
        if (!opts) {
            opts = _opts;
        }
        else {
            opts = Object.assign(_opts, opts);
        }
        /** @type {?} */
        var _dialogOpts = {
            title: title,
            initialState: {
                showOkButton: opts.showOkButton === undefined ? true : opts.showOkButton,
                showCancelButton: opts.showCancelButton === undefined
                    ? true
                    : opts.showCancelButton,
                okText: this.okText,
                okHandle: (/**
                 * @return {?}
                 */
                function () {
                    /** @type {?} */
                    var mc = (/** @type {?} */ (dlg.content));
                    /** @type {?} */
                    var val = mc.promptText.nativeElement.value;
                    if (opts.closeWhenever) {
                        dlg.close();
                        promptSubject.next(val);
                    }
                    else {
                        promptSubject.next({ val: val, dlg: dlg });
                    }
                }),
                cancelText: this.cancelText,
                cancelHandle: (/**
                 * @return {?}
                 */
                function () {
                    dlg.close();
                    promptSubject.next(false);
                }),
                showFontSize: opts.showFontSize,
                fontSize: opts.fontSize || 18,
                enableWordCount: !!opts.enableWordCount,
                countType: opts.countType || "length",
                maxLength: opts.maxLength,
                inputType: opts.inputType || "textarea",
                placeholder: opts.placeholder || "",
            },
            fitContent: false,
            showMaxButton: true,
            resizable: true,
            class: "",
            closed: (/**
             * @return {?}
             */
            function () {
                promptSubject.unsubscribe();
            }),
            opened: (/**
             * @return {?}
             */
            function () {
                if (opts.inputType !== "textarea") {
                    return;
                }
                else {
                    setTimeout((/**
                     * @return {?}
                     */
                    function () {
                        /** @type {?} */
                        var textareaEle = dlg.content.promptText.nativeElement;
                        textareaEle.closest("section").style.padding = "15px";
                        textareaEle.style.resize = "none";
                        textareaEle.style.height = "100%";
                        if (opts.readonly) {
                            textareaEle.readOnly = true;
                        }
                    }));
                }
            }),
            beforeClose: (/**
             * @param {?} modalRef
             * @return {?}
             */
            function (modalRef) {
                if (opts.saveSize && !dlg.dialog.instance.isMax) {
                    /** @type {?} */
                    var data = {
                        fontSize: dlg.content.fontSize,
                        width: modalRef.config.width,
                        height: modalRef.config.height,
                    };
                    _this.saveTextAreaSizeInfo(data);
                }
                return of(true);
            }),
        };
        /** @type {?} */
        var dialogOpts = _dialogOpts;
        if (opts) {
            dialogOpts = Object.assign(dialogOpts, opts);
        }
        /** @type {?} */
        var dlg = this.show("prompt", msg, dialogOpts, msg);
        if (opts.inputType && dlg.content.promptText) {
            dlg.content.promptText.nativeElement.focus();
        }
        return promptSubject;
    };
    /**
     * @return {?}
     */
    MessagerService.prototype.getKeyString = /**
     * @return {?}
     */
    function () {
        // 一台终端共用一个配置
        // 保留最后一次的设置，
        // 保存窗口大小，字体大小
        return "IGIX-FARRIS-UI-TEXTAREA-ZOOM-SETTINGS";
    };
    /**
     * @private
     * @param {?} data
     * @return {?}
     */
    MessagerService.prototype.saveTextAreaSizeInfo = /**
     * @private
     * @param {?} data
     * @return {?}
     */
    function (data) {
        if (window.localStorage) {
            /** @type {?} */
            var key = this.getKeyString();
            localStorage.setItem(key, JSON.stringify(data));
        }
    };
    /**
     * @param {?} message
     * @param {?=} msg
     * @param {?=} fitContent
     * @return {?}
     */
    MessagerService.prototype.confirm = /**
     * @param {?} message
     * @param {?=} msg
     * @param {?=} fitContent
     * @return {?}
     */
    function (message, msg, fitContent) {
        if (fitContent === void 0) { fitContent = true; }
        /** @type {?} */
        var confirmSubject = new Subject();
        /** @type {?} */
        var _msg = typeof msg === "number" ? null : msg;
        /** @type {?} */
        var confirmDlg = this.show("question", message, {
            initialState: {
                okText: this.okText,
                okHandle: (/**
                 * @return {?}
                 */
                function () {
                    confirmDlg.close();
                    confirmSubject.next(true);
                }),
                cancelText: this.cancelText,
                cancelHandle: (/**
                 * @return {?}
                 */
                function () {
                    confirmDlg.close();
                    confirmSubject.next(false);
                }),
            },
            fitContent: fitContent,
            closed: (/**
             * @return {?}
             */
            function () {
                confirmSubject.unsubscribe();
            }),
        }, _msg);
        if (msg && typeof msg === "number") {
            confirmDlg.dialog.location.nativeElement.style.zIndex = msg;
        }
        return confirmSubject.asObservable();
    };
    /**
     * @param {?} message
     * @param {?=} callback
     * @param {?=} msg
     * @param {?=} fitContent
     * @return {?}
     */
    MessagerService.prototype.info = /**
     * @param {?} message
     * @param {?=} callback
     * @param {?=} msg
     * @param {?=} fitContent
     * @return {?}
     */
    function (message, callback, msg, fitContent) {
        if (fitContent === void 0) { fitContent = true; }
        /** @type {?} */
        var infoDlg = this.show("info", message, {
            initialState: {
                okText: this.okText,
                okHandle: (/**
                 * @return {?}
                 */
                function () {
                    infoDlg.close();
                    if (callback) {
                        callback();
                    }
                }),
            },
            fitContent: fitContent,
        }, msg);
        return infoDlg;
    };
    /** 操作成功提示，
     * message: 提示信息
     * msg: 2级信息
     * fitCountent: 默认为true
     * callback: 确定事件回调
     */
    /**
     * 操作成功提示，
     * message: 提示信息
     * msg: 2级信息
     * fitCountent: 默认为true
     * callback: 确定事件回调
     * @param {?} message
     * @param {?=} msg
     * @param {?=} fitContent
     * @param {?=} callback
     * @return {?}
     */
    MessagerService.prototype.success = /**
     * 操作成功提示，
     * message: 提示信息
     * msg: 2级信息
     * fitCountent: 默认为true
     * callback: 确定事件回调
     * @param {?} message
     * @param {?=} msg
     * @param {?=} fitContent
     * @param {?=} callback
     * @return {?}
     */
    function (message, msg, fitContent, callback) {
        if (fitContent === void 0) { fitContent = true; }
        if (callback === void 0) { callback = null; }
        /** @type {?} */
        var successDlg = this.show("success", message, {
            initialState: {
                okText: this.okText,
                okHandle: (/**
                 * @return {?}
                 */
                function () {
                    successDlg.close();
                    if (callback) {
                        callback();
                    }
                }),
            },
            fitContent: fitContent,
        }, msg);
        return successDlg;
    };
    /** 提示错误信息，
     * message: 提示信息
     * msg: 2级信息
     * fitCountent: 默认为true
     * callback: 确定事件回调
     */
    /**
     * 提示错误信息，
     * message: 提示信息
     * msg: 2级信息
     * fitCountent: 默认为true
     * callback: 确定事件回调
     * @param {?} message
     * @param {?=} msg
     * @param {?=} fitContent
     * @param {?=} callback
     * @param {?=} safeHtml
     * @return {?}
     */
    MessagerService.prototype.error = /**
     * 提示错误信息，
     * message: 提示信息
     * msg: 2级信息
     * fitCountent: 默认为true
     * callback: 确定事件回调
     * @param {?} message
     * @param {?=} msg
     * @param {?=} fitContent
     * @param {?=} callback
     * @param {?=} safeHtml
     * @return {?}
     */
    function (message, msg, fitContent, callback, safeHtml) {
        if (fitContent === void 0) { fitContent = true; }
        if (callback === void 0) { callback = null; }
        if (safeHtml === void 0) { safeHtml = true; }
        /** @type {?} */
        var errorDlg = this.show("error", message, {
            safeHtml: safeHtml,
            initialState: {
                okText: this.okText,
                okHandle: (/**
                 * @return {?}
                 */
                function () {
                    errorDlg.close();
                    if (callback) {
                        callback();
                    }
                }),
            },
            fitContent: fitContent,
        }, msg);
        return errorDlg;
    };
    /**
     * @param {?} message
     * @param {?=} msg
     * @param {?=} fitContent
     * @param {?=} callback
     * @return {?}
     */
    MessagerService.prototype.warning = /**
     * @param {?} message
     * @param {?=} msg
     * @param {?=} fitContent
     * @param {?=} callback
     * @return {?}
     */
    function (message, msg, fitContent, callback) {
        if (fitContent === void 0) { fitContent = true; }
        if (callback === void 0) { callback = null; }
        /** @type {?} */
        var warningDlg = this.show("warning", message, {
            initialState: {
                okText: this.okText,
                okHandle: (/**
                 * @return {?}
                 */
                function () {
                    warningDlg.close();
                    if (callback) {
                        callback();
                    }
                }),
            },
            fitContent: fitContent,
        }, msg);
        return warningDlg;
    };
    /**
     * @param {?} type
     * @param {?} title
     * @param {?=} message
     * @param {?=} callback
     * @return {?}
     */
    MessagerService.prototype.showHtmlMsg = /**
     * @param {?} type
     * @param {?} title
     * @param {?=} message
     * @param {?=} callback
     * @return {?}
     */
    function (type, title, message, callback) {
        if (callback === void 0) { callback = null; }
        /** @type {?} */
        var msgDlg = this.show(type, title, {
            safeHtml: false,
            initialState: {
                okText: this.okText,
                okHandle: (/**
                 * @return {?}
                 */
                function () {
                    msgDlg.close();
                    if (callback) {
                        callback();
                    }
                }),
            },
            fitContent: true,
        }, message);
        return msgDlg;
    };
    /**
     * @private
     * @return {?}
     */
    MessagerService.prototype.close = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.modals.length) {
            /** @type {?} */
            var msgbox = this.getModalById(this.currentId);
            if (msgbox) {
                msgbox.ref.close();
            }
        }
    };
    /**
     * @private
     * @param {?} id
     * @return {?}
     */
    MessagerService.prototype.getModalById = /**
     * @private
     * @param {?} id
     * @return {?}
     */
    function (id) {
        return this.modals.find((/**
         * @param {?} item
         * @return {?}
         */
        function (item) { return item.id === id; }));
    };
    /**
     * @private
     * @return {?}
     */
    MessagerService.prototype.getModalCmp = /**
     * @private
     * @return {?}
     */
    function () {
        return this.bsModalService.getCurrentModalContainer().instance;
    };
    /**
     * @private
     * @param {?} id
     * @return {?}
     */
    MessagerService.prototype.removeMessager = /**
     * @private
     * @param {?} id
     * @return {?}
     */
    function (id) {
        this.modals = this.modals.filter((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n.id !== id; }));
        if (!this.modals.length) {
            this.currentId = -1;
        }
        else {
            this.currentId = this.modals[this.modals.length - 1].id;
        }
    };
    /**
     * @private
     * @param {?} text
     * @return {?}
     */
    MessagerService.prototype.copyToClipboard = /**
     * @private
     * @param {?} text
     * @return {?}
     */
    function (text) {
        /** @type {?} */
        var windowRef = window;
        if (windowRef.clipboardData && windowRef.clipboardData.setData) {
            return windowRef.clipboardData.setData("Text", text);
        }
        else if (document.queryCommandSupported && document.queryCommandSupported("copy")) {
            /** @type {?} */
            var textarea = document.createElement("textarea");
            textarea.textContent = text;
            textarea.style.position = "fixed";
            document.body.appendChild(textarea);
            textarea.select();
            try {
                return document.execCommand("copy");
            }
            catch (ex) {
            }
            finally {
                document.body.removeChild(textarea);
            }
        }
        return false;
    };
    /**
     * @param {?} error
     * @param {?=} opts
     * @return {?}
     */
    MessagerService.prototype.exception = /**
     * @param {?} error
     * @param {?=} opts
     * @return {?}
     */
    function (error, opts) {
        var _this = this;
        if (opts === void 0) { opts = { width: 440, height: 200, log: false }; }
        /** @type {?} */
        var exceptionMsg = error.Message || "";
        /** @type {?} */
        var date = error.date || format(new Date(), 'yyyy-MM-dd HH:mm:ss');
        /** @type {?} */
        var localDate = date;
        // 发生时间
        /** @type {?} */
        var happenedTime = this.localeService.getValue('messager.exception.happend');
        // 详细信息
        /** @type {?} */
        var detailInfo = this.localeService.getValue('messager.exception.detail');
        /** @type {?} */
        var detail = error.Detail ||
            error.Message + "\r\n" + happenedTime + "\uFF1A" + localDate + "\r\n" + detailInfo + "\uFF1A" + error.innerMessage ||
            "";
        /** @type {?} */
        var innerMessage = error.innerMessage || null;
        /** @type {?} */
        var defaultOptions = { width: 440, height: 200, log: false };
        /** @type {?} */
        var exoptions = defaultOptions;
        if (opts) {
            exoptions = Object.assign({}, defaultOptions, opts);
        }
        /** @type {?} */
        var bsModalRef;
        /** @type {?} */
        var options = {
            showMaxButton: false,
            buttons: [
                {
                    text: this.localeService.getValue('messager.exception.roger'),
                    cls: "btn btn-primary btn-lg",
                    handle: (/**
                     * @return {?}
                     */
                    function () {
                        bsModalRef.close();
                    }),
                },
            ],
            // showHeader: false,
            width: exoptions.width,
            height: exoptions.height,
            safeHtml: false,
            exception: {
                date: localDate,
                message: innerMessage,
                copyButton: {
                    text: this.localeService.getValue('messager.exception.copy'),
                    onClick: (/**
                     * @param {?} e
                     * @return {?}
                     */
                    function (e) {
                        /** @type {?} */
                        var result = _this.copyToClipboard(detail);
                        /** @type {?} */
                        var text = result
                            ? _this.localeService.getValue('messager.exception.copySuccess')
                            : _this.localeService.getValue('messager.exception.copyFailed');
                        bsModalRef.content.showMiniNotify(text, 1500);
                    }),
                },
            },
        };
        if (exoptions.log) {
            console.error(error);
        }
        // this.displayError(error);
        bsModalRef = this.show("exception", exceptionMsg, options);
    };
    MessagerService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    MessagerService.ctorParameters = function () { return [
        { type: BsModalService },
        { type: Injector }
    ]; };
    return MessagerService;
}());
export { MessagerService };
if (false) {
    /** @type {?} */
    MessagerService.prototype.version;
    /** @type {?} */
    MessagerService.prototype.currentId;
    /** @type {?} */
    MessagerService.prototype.modals;
    /**
     * @type {?}
     * @private
     */
    MessagerService.prototype.defaultMessagerConfig;
    /**
     * @type {?}
     * @private
     */
    MessagerService.prototype.confirmSubject;
    /**
     * @type {?}
     * @private
     */
    MessagerService.prototype.ngZone;
    /**
     * @type {?}
     * @private
     */
    MessagerService.prototype.localeService;
    /**
     * @type {?}
     * @private
     */
    MessagerService.prototype.bsModalService;
    /**
     * @type {?}
     * @private
     */
    MessagerService.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWVzc2FnZXIuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktbWVzc2FnZXIvIiwic291cmNlcyI6WyJsaWIvbWVzc2FnZXIuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBU0EsT0FBTyxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzdELE9BQU8sRUFBRSxPQUFPLEVBQWMsRUFBRSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQy9DLE9BQU8sRUFBRSxjQUFjLEVBQTRCLE1BQU0sa0JBQWtCLENBQUM7QUFDNUUsT0FBTyxFQUVILHFCQUFxQixFQUNyQix1QkFBdUIsR0FFMUIsTUFBTSxtQkFBbUIsQ0FBQztBQUMzQixPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUN6RCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFFbEQsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUVsQztJQVlJLHlCQUNZLGNBQThCLEVBQzlCLFFBQWtCO1FBRGxCLG1CQUFjLEdBQWQsY0FBYyxDQUFnQjtRQUM5QixhQUFRLEdBQVIsUUFBUSxDQUFVO1FBWjlCLFlBQU8sR0FBRyxRQUFRLENBQUM7UUFDbkIsY0FBUyxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQ2YsV0FBTSxHQUFzQyxFQUFFLENBQUM7UUFDdkMsMEJBQXFCLEdBQW1CLElBQUksQ0FBQzs7WUFXM0MsTUFBTSxHQUNSLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLHVCQUF1QixDQUFDLElBQUkscUJBQXFCO1FBQ3ZFLElBQUksQ0FBQyxxQkFBcUIsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUN0QyxFQUFFLEVBQ0YscUJBQXFCLEVBQ3JCLE1BQU0sQ0FDVCxDQUFDO1FBQ0YsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsUUFBUSxD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QSxBQXZzQkQsSUF1c0JDO1NBdHNCWSxlQUFlOzs7SUFDeEIsa0NBQW1COztJQUNuQixvQ0FBZTs7SUFDZixpQ0FBK0M7Ozs7O0lBQy9DLGdEQUFxRDs7Ozs7SUFFckQseUNBQXVCOzs7OztJQUN2QixpQ0FBdUI7Ozs7O0lBRXZCLHdDQUFxQzs7Ozs7SUFHakMseUNBQXNDOzs7OztJQUN0QyxtQ0FBMEIiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxyXG4gKiBAQXV0aG9yOiDnlq/ni4Lnp4DmiY0oTHVjYXMgSHVhbmcpXHJcbiAqIEBMYXN0RWRpdG9yczog55av54uC56eA5omNKEx1Y2FzIEh1YW5nKVxyXG4gKiBAQ29tcGFueTogSW5zcHVyXHJcbiAqIEBWZXJzaW9uOiB2MC4wLjE1XHJcbiAqIEBEYXRlOiAyMDE5LTA0LTAyIDExOjQ4OjA4XHJcbiAqIEBMYXN0RWRpdFRpbWU6IDIwMTktMTAtMjYgMTY6Mzg6MzRcclxuICovXHJcblxyXG5pbXBvcnQgeyBJbmplY3RhYmxlLCBJbmplY3RvciwgTmdab25lIH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcclxuaW1wb3J0IHsgU3ViamVjdCwgT2JzZXJ2YWJsZSwgb2YgfSBmcm9tIFwicnhqc1wiO1xyXG5pbXBvcnQgeyBCc01vZGFsU2VydmljZSwgQnNNb2RhbFJlZiwgRGlhbG9nQnV0dG9uIH0gZnJvbSBcIkBmYXJyaXMvdWktbW9kYWxcIjtcclxuaW1wb3J0IHtcclxuICAgIE1lc3NhZ2VyQ29uZmlnLFxyXG4gICAgTWVzc2FnZXJEZWZhdWx0Q29uZmlnLFxyXG4gICAgTUVTU0FHRVJfREVGQVVMVF9DT05GSUcsXHJcbiAgICBTZXJ2ZXJFeGNlcHRpb25FbnRpdHksXHJcbn0gZnJvbSBcIi4vbWVzc2FnZXIuY29uZmlnXCI7XHJcbmltcG9ydCB7IE1lc3NhZ2VyQ29tcG9uZW50IH0gZnJvbSBcIi4vbWVzc2FnZXIuY29tcG9uZW50XCI7XHJcbmltcG9ydCB7IExvY2FsZVNlcnZpY2UgfSBmcm9tIFwiQGZhcnJpcy91aS1sb2NhbGVcIjtcclxuaW1wb3J0IHsgdW5lc2NhcGVJZGVudGlmaWVyIH0gZnJvbSBcIkBhbmd1bGFyL2NvbXBpbGVyXCI7XHJcbmltcG9ydCB7IGZvcm1hdCB9IGZyb20gXCJkYXRlLWZuc1wiO1xyXG5cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgTWVzc2FnZXJTZXJ2aWNlIHtcclxuICAgIHZlcnNpb24gPSBcIjAuMC4xNVwiO1xyXG4gICAgY3VycmVudElkID0gLTE7XHJcbiAgICBtb2RhbHM6IHsgaWQ6IG51bWJlcjsgcmVmOiBCc01vZGFsUmVmIH1bXSA9IFtdO1xyXG4gICAgcHJpdmF0ZSBkZWZhdWx0TWVzc2FnZXJDb25maWc6IE1lc3NhZ2VyQ29uZmlnID0gbnVsbDtcclxuXHJcbiAgICBwcml2YXRlIGNvbmZpcm1TdWJqZWN0O1xyXG4gICAgcHJpdmF0ZSBuZ1pvbmU6IE5nWm9uZTtcclxuXHJcbiAgICBwcml2YXRlIGxvY2FsZVNlcnZpY2U6IExvY2FsZVNlcnZpY2U7XHJcblxyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgcHJpdmF0ZSBic01vZGFsU2VydmljZTogQnNNb2RhbFNlcnZpY2UsXHJcbiAgICAgICAgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3JcclxuICAgICkge1xyXG4gICAgICAgIGNvbnN0IGNvbmZpZyA9XHJcbiAgICAgICAgICAgIHRoaXMuaW5qZWN0b3IuZ2V0KE1FU1NBR0VSX0RFRkFVTFRfQ09ORklHKSB8fCBNZXNzYWdlckRlZmF1bHRDb25maWc7XHJcbiAgICAgICAgdGhpcy5kZWZhdWx0TWVzc2FnZXJDb25maWcgPSBPYmplY3QuYXNzaWduKFxyXG4gICAgICAgICAgICB7fSxcclxuICAgICAgICAgICAgTWVzc2FnZXJEZWZhdWx0Q29uZmlnLFxyXG4gICAgICAgICAgICBjb25maWdcclxuICAgICAgICApO1xyXG4gICAgICAgIHRoaXMubmdab25lID0gdGhpcy5pbmplY3Rvci5nZXQoTmdab25lKTtcclxuICAgICAgICB0aGlzLmxvY2FsZVNlcnZpY2UgPSB0aGlzLmluamVjdG9yLmdldChMb2NhbGVTZXJ2aWNlKTtcclxuICAgIH1cclxuICAgIGdldCBva1RleHQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZShcIm1lc3NhZ2VyLm9rXCIpO1xyXG4gICAgfVxyXG4gICAgZ2V0IGNhbmNlbFRleHQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZShcIm1lc3NhZ2VyLmNhbmNlbFwiKTtcclxuICAgIH1cclxuICAgIGdldCB5ZXNUZXh0KCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmxvY2FsZVNlcnZpY2UuZ2V0VmFsdWUoXCJtZXNzYWdlci55ZXNcIik7XHJcbiAgICB9XHJcbiAgICBnZXQgbm9UZXh0KCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmxvY2FsZVNlcnZpY2UuZ2V0VmFsdWUoXCJtZXNzYWdlci5ub1wiKTtcclxuICAgIH1cclxuICAgIGdldCB0aXRsZVRleHQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZShcIm1lc3NhZ2VyLnRpdGxlXCIpO1xyXG4gICAgfVxyXG4gICAgZ2V0IGVycm9yVGl0bGUoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZShcIm1lc3NhZ2VyLmVycm9yVGl0bGVcIik7XHJcbiAgICB9XHJcblxyXG4gICAgZXNjYXBlSHRtbChzdHIpIHtcclxuICAgICAgICBpZiAoc3RyID09PSBudWxsIHx8IHN0ciA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBcIlwiO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gc3RyXHJcbiAgICAgICAgICAgIC5yZXBsYWNlKC8mL2csIFwiJmFtcDtcIilcclxuICAgICAgICAgICAgLnJlcGxhY2UoLzwvZywgXCImbHQ7XCIpXHJcbiAgICAgICAgICAgIC5yZXBsYWNlKC8+L2csIFwiJmd0O1wiKVxyXG4gICAgICAgICAgICAucmVwbGFjZSgvXFxcIi9nLCBcIiZxdW90O1wiKVxyXG4gICAgICAgICAgICAucmVwbGFjZSgvXFwnL2csIFwiJiMzOTtcIilcclxuICAgICAgICAgICAgLnJlcGxhY2UoL1xcLy9nLCBcIiYjeDJGO1wiKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOaYvuekuuS/oeaBr+aPkOekuuahhlxyXG4gICAgICogQHBhcmFtIG1zZ3R5cGUg5raI5oGv57G75YirXHJcbiAgICAgKiBAcGFyYW0gbWVzc2FnZSDmj5DnpLrmtojmga/kuIBcclxuICAgICAqIEBwYXJhbSBvcHRzIOWPguaVsCDmj5DkvpvlsZ7mgKcgZml0Q29udGVudDp0cnVl5pSv5oyB6Ieq5Yqo6YCC5bqU5a695bqmXHJcbiAgICAgKiBAcGFyYW0gc3VibXNnIOaPkOekuua2iOaBr+S6jOe6p1xyXG4gICAgICovXHJcbiAgICBzaG93KG1zZ3R5cGU6IHN0cmluZywgbWVzc2FnZTogc3RyaW5nLCBvcHRzPzoge30sIHN1Ym1zZyA9IFwiXCIpIHtcclxuICAgICAgICBpZiAoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCkge1xyXG4gICAgICAgICAgICAoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCBhcyBhbnkpLmJsdXIoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgbW9kYWxIZWlnaHQgPSAxODA7XHJcbiAgICAgICAgbGV0IGRlZmF1bHRPcHRzID0ge1xyXG4gICAgICAgICAgICBzYWZlSHRtbDogdHJ1ZSxcclxuICAgICAgICAgICAgdGl0bGU6IHRoaXMudGl0bGVUZXh0LFxyXG4gICAgICAgICAgICB3aWR0aDogMzkwLFxyXG4gICAgICAgICAgICBoZWlnaHQ6IG1vZGFsSGVpZ2h0LFxyXG4gICAgICAgICAgICBzaG93QnV0dG9uczogZmFsc2UsXHJcbiAgICAgICAgICAgIHNob3dNYXhCdXR0b246IGZhbHNlLFxyXG4gICAgICAgICAgICByZXNpemFibGU6IGZhbHNlLFxyXG4gICAgICAgICAgICBpbml0aWFsU3RhdGU6IHtcclxuICAgICAgICAgICAgICAgIG9rVGV4dDogdGhpcy5va1RleHQsXHJcbiAgICAgICAgICAgICAgICBva0hhbmRsZTogKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGNsYXNzOlxyXG4gICAgICAgICAgICAgICAgXCJtb2RhbC1tZXNzYWdlIFwiICtcclxuICAgICAgICAgICAgICAgIChtc2d0eXBlID8gXCJtb2RhbC1tZXNzYWdlLXR5cGUtXCIgKyBtc2d0eXBlIDogXCJcIiksXHJcbiAgICAgICAgICAgIHNob3dIZWFkZXI6IGZhbHNlLFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgZGVmYXVsdE9wdHMgPSBPYmplY3QuYXNzaWduKFxyXG4gICAgICAgICAgICB7fSxcclxuICAgICAgICAgICAgdGhpcy5kZWZhdWx0TWVzc2FnZXJDb25maWcsXHJcbiAgICAgICAgICAgIGRlZmF1bHRPcHRzXHJcbiAgICAgICAgKTtcclxuICAgICAgICBsZXQgZXh0ZW5kT3B0cyA9IHt9O1xyXG5cclxuICAgICAgICBzd2l0Y2ggKG1zZ3R5cGUpIHtcclxuICAgICAgICAgICAgY2FzZSBcInByb21wdFwiOlxyXG4gICAgICAgICAgICAgICAgLy8g5by55Ye65a+56K+d57G75Z6LXHJcbiAgICAgICAgICAgICAgICBleHRlbmRPcHRzID0geyBzaG93SGVhZGVyOiB0cnVlLCBtb2RhbEhlaWdodDogMjYwIH07XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBcImVycm9yXCI6XHJcbiAgICAgICAgICAgICAgICAvLyDplJnor69cclxuICAgICAgICAgICAgICAgIGV4dGVuZE9wdHMgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHRoaXMuZXJyb3JUaXRsZSxcclxuICAgICAgICAgICAgICAgICAgICB3aWR0aDogNDQ2LFxyXG4gICAgICAgICAgICAgICAgICAgIHNob3dIZWFkZXI6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgc2hvd01heEJ1dHRvbjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICBmaXRDb250ZW50OiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIFwiZXhjZXB0aW9uXCI6XHJcbiAgICAgICAgICAgICAgICBleHRlbmRPcHRzID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHNhZmVIdG1sOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogdGhpcy5lcnJvclRpdGxlLFxyXG4gICAgICAgICAgICAgICAgICAgIHdpZHRoOiA0NDYsXHJcbiAgICAgICAgICAgICAgICAgICAgc2hvd0hlYWRlcjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICBmaXRDb250ZW50OiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgLy8g6buY6K6k5YW25LuWXHJcbiAgICAgICAgICAgICAgICBleHRlbmRPcHRzID0geyB3aWR0aDogc3VibXNnID8gNDQ2IDogMzkwLCBmaXRDb250ZW50OiB0cnVlIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIE9iamVjdC5hc3NpZ24oZGVmYXVsdE9wdHMsIGV4dGVuZE9wdHMpO1xyXG4gICAgICAgIGlmIChvcHRzKSB7XHJcbiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oZGVmYXVsdE9wdHMsIG9wdHMpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKG1lc3NhZ2UgJiYgZGVmYXVsdE9wdHMuc2FmZUh0bWwpIHtcclxuICAgICAgICAgICAgbWVzc2FnZSA9IHRoaXMuZXNjYXBlSHRtbChtZXNzYWdlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIE9iamVjdC5hc3NpZ24oZGVmYXVsdE9wdHMuaW5pdGlhbFN0YXRlLCB7XHJcbiAgICAgICAgICAgIHR5cGU6IG1zZ3R5cGUsXHJcbiAgICAgICAgICAgIG1lc3NhZ2UsXHJcbiAgICAgICAgICAgIG1zZzogc3VibXNnLFxyXG4gICAgICAgICAgICBleGNlcHRpb246IG9wdHMgJiYgb3B0c1tcImV4Y2VwdGlvblwiXSA/IG9wdHNbXCJleGNlcHRpb25cIl0gOiBudWxsLFxyXG4gICAgICAgICAgICBzaG93TGluZXM6IG9wdHMgJiYgb3B0c1tcInNob3dMaW5lc1wiXSA/IG9wdHNbXCJzaG93TGluZXNcIl0gOiAzLFxyXG4gICAgICAgICAgICByZWFkb25seTogb3B0cyAmJiBvcHRzW1wicmVhZG9ubHlcIl0gPyBvcHRzW1wicmVhZG9ubHlcIl0gOiBmYWxzZSxcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaWYgKGRlZmF1bHRPcHRzW1wiYnV0dG9uc1wiXSAmJiBkZWZhdWx0T3B0c1tcImJ1dHRvbnNcIl0ubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGlmIChcclxuICAgICAgICAgICAgICAgICFkZWZhdWx0T3B0cy5pbml0aWFsU3RhdGVbXCJidXR0b25zXCJdIHx8XHJcbiAgICAgICAgICAgICAgICAhZGVmYXVsdE9wdHMuaW5pdGlhbFN0YXRlW1wiYnV0dG9uc1wiXS5sZW5ndGhcclxuICAgICAgICAgICAgKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0T3B0cy5pbml0aWFsU3RhdGVbXCJidXR0b25zXCJdID0gZGVmYXVsdE9wdHNbXCJidXR0b25zXCJdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IF9tb2RhbCA9IHRoaXMuYnNNb2RhbFNlcnZpY2Uuc2hvdyhNZXNzYWdlckNvbXBvbmVudCwgZGVmYXVsdE9wdHMpO1xyXG4gICAgICAgIC8vIF9tb2RhbC5jb250ZW50LmJ1dHRvbnMgPSBkZWZhdWx0T3B0c1snYnV0dG9ucyddIHx8IFtdO1xyXG4gICAgICAgIHRoaXMuY29uZmlybVN1YmplY3QgPSBuZXcgU3ViamVjdDxib29sZWFuPigpO1xyXG4gICAgICAgIGlmICh0aGlzLm1vZGFscy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vZGFsQ29udGFpbmVyQ29tcG9uZW50ID0gX21vZGFsLmRpYWxvZztcclxuICAgICAgICAgICAgbW9kYWxDb250YWluZXJDb21wb25lbnQuaW5zdGFuY2UuaXNTaG93biA9IHRydWU7XHJcbiAgICAgICAgICAgIG1vZGFsQ29udGFpbmVyQ29tcG9uZW50Lmluc3RhbmNlLm1vdmVUbyhcclxuICAgICAgICAgICAgICAgIDE1ICogdGhpcy5tb2RhbHMubGVuZ3RoLFxyXG4gICAgICAgICAgICAgICAgMTUgKiB0aGlzLm1vZGFscy5sZW5ndGhcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcclxuICAgICAgICAgICAgLy8g56ysMeS4quaMiemSruiOt+WPlueEpueCuVxyXG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGJ0bk9rID0gX21vZGFsLmNvbnRlbnQuYnRuT2tFbFxyXG4gICAgICAgICAgICAgICAgICAgID8gX21vZGFsLmNvbnRlbnQuYnRuT2tFbC5uYXRpdmVFbGVtZW50XHJcbiAgICAgICAgICAgICAgICAgICAgOiBudWxsO1xyXG4gICAgICAgICAgICAgICAgaWYgKGJ0bk9rKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYnRuT2tbXCJmb2N1c1wiXSgpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBidG5zID1cclxuICAgICAgICAgICAgICAgICAgICAgICAgX21vZGFsLmRpYWxvZy5sb2NhdGlvbi5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIi5tb2RhbC1mb290ZXIgYnV0dG9uXCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYnRucy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnRucy5pdGVtKDApW1wiZm9jdXNcIl0oKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3Qgb3ZlcmxheXMgPSBBcnJheS5mcm9tKGRvY3VtZW50LmJvZHkucXVlcnlTZWxlY3RvckFsbCgnYm9keT5kaXYsIGJvZHk+ZmFycmlzLWRpYWxvZz4uZmFycmlzLW1vZGFsLGJvZHk+LmZhcnJpcy1tb2RhbCcpKS5maWx0ZXIobiA9PiBuKS5tYXAobiA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKG4pLnpJbmRleDtcclxuICAgICAgICAgICAgICAgIH0pLmZpbHRlcihuID0+IG4gJiYgbiE9PSAnYXV0bycpLm1hcChuID0+IHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VJbnQobiwgMTApO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBtYXhaaW5kZXggPSBNYXRoLm1heCguLi5vdmVybGF5cyk7XHJcbiAgICAgICAgICAgICAgICBfbW9kYWwuZGlhbG9nLmxvY2F0aW9uLm5hdGl2ZUVsZW1lbnQuc3R5bGUuekluZGV4ID0gbWF4WmluZGV4ICsgMTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMubXNnTWdyKF9tb2RhbCk7XHJcbiAgICAgICAgcmV0dXJuIF9tb2RhbDtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIG1zZ01ncihyZWY6IEJzTW9kYWxSZWYpIHtcclxuICAgICAgICBjb25zdCBpZCA9IHRoaXMuYnNNb2RhbFNlcnZpY2UuZ2V0TW9kYWxzQ291bnQoKSArIDEwMDA7XHJcbiAgICAgICAgaWYgKHRoaXMubW9kYWxzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICB0aGlzLm1vZGFscy5wdXNoKHsgaWQsIHJlZiB9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuZ2V0TW9kYWxCeUlkKGlkKSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5tb2RhbHMucHVzaCh7IGlkLCByZWYgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmdldE1vZGFsQnlJZChpZCkucmVmID0gcmVmO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBjbXAgPSB0aGlzLmdldE1vZGFsQ21wKCk7XHJcblxyXG4gICAgICAgIGNtcC5jbG9zZWQuc3Vic2NyaWJlKChsZXZlbDogbnVtYmVyKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlTWVzc2FnZXIoaWQpO1xyXG4gICAgICAgICAgICB0aGlzLmNvbmZpcm1TdWJqZWN0LnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMuY3VycmVudElkID0gaWQ7XHJcbiAgICB9XHJcblxyXG4gICAgcXVlc3Rpb24oXHJcbiAgICAgICAgbWVzc2FnZTogc3RyaW5nLFxyXG4gICAgICAgIG9rQ2FsbGJhY2s6ICgpID0+IHZvaWQsXHJcbiAgICAgICAgY2FuY2VsQ2FsbGJhY2s/OiAoKSA9PiB2b2lkLFxyXG4gICAgICAgIG1zZz86IHN0cmluZyxcclxuICAgICAgICBmaXRDb250ZW50ID0gdHJ1ZVxyXG4gICAgKSB7XHJcbiAgICAgICAgY29uc3QgcXVlc3Rpb25EbGcgPSB0aGlzLnNob3coXHJcbiAgICAgICAgICAgIFwicXVlc3Rpb25cIixcclxuICAgICAgICAgICAgbWVzc2FnZSxcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaW5pdGlhbFN0YXRlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2tUZXh0OiB0aGlzLnllc1RleHQsXHJcbiAgICAgICAgICAgICAgICAgICAgb2tIYW5kbGU6ICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcXVlc3Rpb25EbGcuY2xvc2UoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9rQ2FsbGJhY2spIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9rQ2FsbGJhY2soKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgY2FuY2VsVGV4dDogdGhpcy5ub1RleHQsXHJcbiAgICAgICAgICAgICAgICAgICAgY2FuY2VsSGFuZGxlOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXN0aW9uRGxnLmNsb3NlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjYW5jZWxDYWxsYmFjaykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FuY2VsQ2FsbGJhY2soKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgZml0Q29udGVudCxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgbXNnXHJcbiAgICAgICAgKTtcclxuICAgICAgICByZXR1cm4gcXVlc3Rpb25EbGc7XHJcbiAgICB9XHJcblxyXG4gICAgcXVlc3Rpb24yKFxyXG4gICAgICAgIG1lc3NhZ2VyOiBzdHJpbmcsXHJcbiAgICAgICAgYnRuczogRGlhbG9nQnV0dG9uW10sXHJcbiAgICAgICAgbXNnPzogc3RyaW5nLFxyXG4gICAgICAgIGZpdENvbnRlbnQgPSB0cnVlXHJcbiAgICApIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5zaG93KFxyXG4gICAgICAgICAgICBcInF1ZXN0aW9uXCIsXHJcbiAgICAgICAgICAgIG1lc3NhZ2VyLFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpbml0aWFsU3RhdGU6IHtcclxuICAgICAgICAgICAgICAgICAgICBidXR0b25zOiBidG5zLFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGZpdENvbnRlbnQsXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIG1zZ1xyXG4gICAgICAgICk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIDIwMjDlubQz5pyIN+aXpeWboOS4unRleHRhcmVh6auY5bqm5Zyo5LiN5ZCM5rWP6KeI5Zmo5LiL5LiN5LiA5qC377yM5Zu65a6a6auY5bqm5Y+v6IO95Lya5Ye6546w5rua5Yqo5p2hXHJcbiAgICAgKiBAcGFyYW0gdGl0bGUg5qCH6aKYXHJcbiAgICAgKiBAcGFyYW0gbXNnIOS/oeaBr1xyXG4gICAgICogQHBhcmFtIGZpdENvbnRlbnQg6Ieq6YCC5bqU5YaF5a65XHJcbiAgICAgKi9cclxuICAgIHByb21wdCh0aXRsZTogc3RyaW5nLCBtc2c/OiBzdHJpbmcsIGZpdENvbnRlbnQgPSB0cnVlKSB7XHJcbiAgICAgICAgY29uc3QgcHJvbXB0U3ViamVjdCA9IG5ldyBTdWJqZWN0KCk7XHJcbiAgICAgICAgY29uc3QgZGxnID0gdGhpcy5zaG93KFxyXG4gICAgICAgICAgICBcInByb21wdFwiLFxyXG4gICAgICAgICAgICBtc2csXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHRpdGxlLFxyXG4gICAgICAgICAgICAgICAgaW5pdGlhbFN0YXRlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2tUZXh0OiB0aGlzLm9rVGV4dCxcclxuICAgICAgICAgICAgICAgICAgICBva0hhbmRsZTogKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtYyA9IGRsZy5jb250ZW50IGFzIE1lc3NhZ2VyQ29tcG9uZW50O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkbGcuY2xvc2UoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcHJvbXB0U3ViamVjdC5uZXh0KG1jLnByb21wdFRleHQubmF0aXZlRWxlbWVudC52YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICBjYW5jZWxUZXh0OiB0aGlzLmNhbmNlbFRleHQsXHJcbiAgICAgICAgICAgICAgICAgICAgY2FuY2VsSGFuZGxlOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRsZy5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9tcHRTdWJqZWN0Lm5leHQoZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgZml0Q29udGVudCxcclxuICAgICAgICAgICAgICAgIGNsb3NlZDogKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHByb21wdFN1YmplY3QudW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIG1zZ1xyXG4gICAgICAgICk7XHJcblxyXG4gICAgICAgIHJldHVybiBwcm9tcHRTdWJqZWN0O1xyXG4gICAgfVxyXG5cclxuICAgIHByb21wdDIodGl0bGU6IHN0cmluZywgbXNnPzogc3RyaW5nLCBvcHRzPzogYW55KSB7XHJcbiAgICAgICAgY29uc3QgcHJvbXB0U3ViamVjdCA9IG5ldyBTdWJqZWN0KCk7XHJcblxyXG4gICAgICAgIGNvbnN0IF9vcHRzID0ge1xyXG4gICAgICAgICAgICBzaG93T2tCdXR0b246IHRydWUsXHJcbiAgICAgICAgICAgIHNob3dDbG9zZUJ1dHRvbjogdHJ1ZSxcclxuICAgICAgICAgICAgc2hvd0ZvbnRTaXplOiBmYWxzZSxcclxuICAgICAgICAgICAgZm9udFNpemU6IDE4LFxyXG4gICAgICAgICAgICByZWFkb25seTogZmFsc2UsXHJcbiAgICAgICAgICAgIHNhdmVTaXplOiBmYWxzZSxcclxuICAgICAgICAgICAgY2xvc2VXaGVuZXZlcjogdHJ1ZSxcclxuICAgICAgICB9O1xyXG4gICAgICAgIGlmICghb3B0cykge1xyXG4gICAgICAgICAgICBvcHRzID0gX29wdHM7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgb3B0cyA9IE9iamVjdC5hc3NpZ24oX29wdHMsIG9wdHMpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgX2RpYWxvZ09wdHMgPSB7XHJcbiAgICAgICAgICAgIHRpdGxlLFxyXG4gICAgICAgICAgICBpbml0aWFsU3RhdGU6IHtcclxuICAgICAgICAgICAgICAgIHNob3dPa0J1dHRvbjpcclxuICAgICAgICAgICAgICAgICAgICBvcHRzLnNob3dPa0J1dHRvbiA9PT0gdW5kZWZpbmVkID8gdHJ1ZSA6IG9wdHMuc2hvd09rQnV0dG9uLFxyXG4gICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjpcclxuICAgICAgICAgICAgICAgICAgICBvcHRzLnNob3dDYW5jZWxCdXR0b24gPT09IHVuZGVmaW5lZFxyXG4gICAgICAgICAgICAgICAgICAgICAgICA/IHRydWVcclxuICAgICAgICAgICAgICAgICAgICAgICAgOiBvcHRzLnNob3dDYW5jZWxCdXR0b24sXHJcbiAgICAgICAgICAgICAgICBva1RleHQ6IHRoaXMub2tUZXh0LFxyXG4gICAgICAgICAgICAgICAgb2tIYW5kbGU6ICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBtYyA9IGRsZy5jb250ZW50IGFzIE1lc3NhZ2VyQ29tcG9uZW50O1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbCA9IG1jLnByb21wdFRleHQubmF0aXZlRWxlbWVudC52YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAob3B0cy5jbG9zZVdoZW5ldmVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRsZy5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9tcHRTdWJqZWN0Lm5leHQodmFsKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9tcHRTdWJqZWN0Lm5leHQoeyB2YWwsIGRsZyB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgY2FuY2VsVGV4dDogdGhpcy5jYW5jZWxUZXh0LFxyXG4gICAgICAgICAgICAgICAgY2FuY2VsSGFuZGxlOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGxnLmNsb3NlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcHJvbXB0U3ViamVjdC5uZXh0KGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBzaG93Rm9udFNpemU6IG9wdHMuc2hvd0ZvbnRTaXplLFxyXG4gICAgICAgICAgICAgICAgZm9udFNpemU6IG9wdHMuZm9udFNpemUgfHwgMTgsXHJcbiAgICAgICAgICAgICAgICBlbmFibGVXb3JkQ291bnQ6ICEhb3B0cy5lbmFibGVXb3JkQ291bnQsXHJcbiAgICAgICAgICAgICAgICBjb3VudFR5cGU6IG9wdHMuY291bnRUeXBlIHx8IFwibGVuZ3RoXCIsXHJcbiAgICAgICAgICAgICAgICBtYXhMZW5ndGg6IG9wdHMubWF4TGVuZ3RoLFxyXG4gICAgICAgICAgICAgICAgaW5wdXRUeXBlOiBvcHRzLmlucHV0VHlwZSB8fCBcInRleHRhcmVhXCIsXHJcbiAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcjogb3B0cy5wbGFjZWhvbGRlciB8fCBcIlwiLFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBmaXRDb250ZW50OiBmYWxzZSxcclxuICAgICAgICAgICAgc2hvd01heEJ1dHRvbjogdHJ1ZSxcclxuICAgICAgICAgICAgcmVzaXphYmxlOiB0cnVlLFxyXG4gICAgICAgICAgICBjbGFzczogXCJcIixcclxuICAgICAgICAgICAgY2xvc2VkOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBwcm9tcHRTdWJqZWN0LnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIG9wZW5lZDogKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKG9wdHMuaW5wdXRUeXBlICE9PSBcInRleHRhcmVhXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0ZXh0YXJlYUVsZSA9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkbGcuY29udGVudC5wcm9tcHRUZXh0Lm5hdGl2ZUVsZW1lbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHRhcmVhRWxlLmNsb3Nlc3QoXCJzZWN0aW9uXCIpLnN0eWxlLnBhZGRpbmcgPSBcIjE1cHhcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dGFyZWFFbGUuc3R5bGUucmVzaXplID0gXCJub25lXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHRhcmVhRWxlLnN0eWxlLmhlaWdodCA9IFwiMTAwJVwiO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wdHMucmVhZG9ubHkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHRhcmVhRWxlLnJlYWRPbmx5ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBiZWZvcmVDbG9zZTogKG1vZGFsUmVmOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChvcHRzLnNhdmVTaXplICYmICFkbGcuZGlhbG9nLmluc3RhbmNlLmlzTWF4KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9udFNpemU6IGRsZy5jb250ZW50LmZvbnRTaXplLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogbW9kYWxSZWYuY29uZmlnLndpZHRoLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IG1vZGFsUmVmLmNvbmZpZy5oZWlnaHQsXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNhdmVUZXh0QXJlYVNpemVJbmZvKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgbGV0IGRpYWxvZ09wdHMgPSBfZGlhbG9nT3B0cztcclxuICAgICAgICBpZiAob3B0cykge1xyXG4gICAgICAgICAgICBkaWFsb2dPcHRzID0gT2JqZWN0LmFzc2lnbihkaWFsb2dPcHRzLCBvcHRzKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGRsZyA9IHRoaXMuc2hvdyhcInByb21wdFwiLCBtc2csIGRpYWxvZ09wdHMsIG1zZyk7XHJcblxyXG4gICAgICAgIGlmIChvcHRzLmlucHV0VHlwZSAmJiBkbGcuY29udGVudC5wcm9tcHRUZXh0KSB7XHJcbiAgICAgICAgICAgIGRsZy5jb250ZW50LnByb21wdFRleHQubmF0aXZlRWxlbWVudC5mb2N1cygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHByb21wdFN1YmplY3Q7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0S2V5U3RyaW5nKCkge1xyXG4gICAgICAgIC8vIOS4gOWPsOe7iOerr+WFseeUqOS4gOS4qumFjee9rlxyXG4gICAgICAgIC8vIOS/neeVmeacgOWQjuS4gOasoeeahOiuvue9ru+8jFxyXG4gICAgICAgIC8vIOS/neWtmOeql+WPo+Wkp+Wwj++8jOWtl+S9k+Wkp+Wwj1xyXG4gICAgICAgIHJldHVybiBcIklHSVgtRkFSUklTLVVJLVRFWFRBUkVBLVpPT00tU0VUVElOR1NcIjtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNhdmVUZXh0QXJlYVNpemVJbmZvKGRhdGEpIHtcclxuICAgICAgICBpZiAod2luZG93LmxvY2FsU3RvcmFnZSkge1xyXG4gICAgICAgICAgICBjb25zdCBrZXkgPSB0aGlzLmdldEtleVN0cmluZygpO1xyXG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShrZXksIEpTT04uc3RyaW5naWZ5KGRhdGEpKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY29uZmlybShtZXNzYWdlOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT47XHJcbiAgICBjb25maXJtKG1lc3NhZ2U6IHN0cmluZywgbXNnPzogc3RyaW5nIHwgbnVtYmVyLCAgZml0Q29udGVudD86IGJvb2xlYW4pOiBPYnNlcnZhYmxlPGFueT47XHJcbiAgICBjb25maXJtKG1lc3NhZ2U6IHN0cmluZywgbXNnPzogc3RyaW5nLCBmaXRDb250ZW50ID0gdHJ1ZSk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICAgICAgY29uc3QgY29uZmlybVN1YmplY3QgPSBuZXcgU3ViamVjdCgpO1xyXG5cclxuICAgICAgICBjb25zdCBfbXNnID0gdHlwZW9mIG1zZyA9PT0gXCJudW1iZXJcIiA/IG51bGwgOiBtc2c7XHJcbiAgICAgICAgY29uc3QgY29uZmlybURsZyA9IHRoaXMuc2hvdyhcclxuICAgICAgICAgICAgXCJxdWVzdGlvblwiLFxyXG4gICAgICAgICAgICBtZXNzYWdlLFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpbml0aWFsU3RhdGU6IHtcclxuICAgICAgICAgICAgICAgICAgICBva1RleHQ6IHRoaXMub2tUZXh0LFxyXG4gICAgICAgICAgICAgICAgICAgIG9rSGFuZGxlOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpcm1EbGcuY2xvc2UoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlybVN1YmplY3QubmV4dCh0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIGNhbmNlbFRleHQ6IHRoaXMuY2FuY2VsVGV4dCxcclxuICAgICAgICAgICAgICAgICAgICBjYW5jZWxIYW5kbGU6ICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlybURsZy5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25maXJtU3ViamVjdC5uZXh0KGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGZpdENvbnRlbnQsXHJcbiAgICAgICAgICAgICAgICBjbG9zZWQ6ICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25maXJtU3ViamVjdC51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgX21zZ1xyXG4gICAgICAgICk7XHJcblxyXG4gICAgICAgIGlmIChtc2cgJiYgdHlwZW9mIG1zZyA9PT0gXCJudW1iZXJcIikge1xyXG4gICAgICAgICAgICBjb25maXJtRGxnLmRpYWxvZy5sb2NhdGlvbi5uYXRpdmVFbGVtZW50LnN0eWxlLnpJbmRleCA9IG1zZztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBjb25maXJtU3ViamVjdC5hc09ic2VydmFibGUoKTtcclxuICAgIH1cclxuXHJcbiAgICBpbmZvKFxyXG4gICAgICAgIG1lc3NhZ2U6IHN0cmluZyxcclxuICAgICAgICBjYWxsYmFjaz86ICgpID0+IHZvaWQsXHJcbiAgICAgICAgbXNnPzogc3RyaW5nLFxyXG4gICAgICAgIGZpdENvbnRlbnQgPSB0cnVlXHJcbiAgICApIHtcclxuICAgICAgICBjb25zdCBpbmZvRGxnID0gdGhpcy5zaG93KFxyXG4gICAgICAgICAgICBcImluZm9cIixcclxuICAgICAgICAgICAgbWVzc2FnZSxcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaW5pdGlhbFN0YXRlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2tUZXh0OiB0aGlzLm9rVGV4dCxcclxuICAgICAgICAgICAgICAgICAgICBva0hhbmRsZTogKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbmZvRGxnLmNsb3NlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgZml0Q29udGVudCxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgbXNnXHJcbiAgICAgICAgKTtcclxuICAgICAgICByZXR1cm4gaW5mb0RsZztcclxuICAgIH1cclxuXHJcbiAgICAvKiog5pON5L2c5oiQ5Yqf5o+Q56S677yMXHJcbiAgICAgKiBtZXNzYWdlOiDmj5DnpLrkv6Hmga9cclxuICAgICAqIG1zZzogMue6p+S/oeaBr1xyXG4gICAgICogZml0Q291bnRlbnQ6IOm7mOiupOS4unRydWVcclxuICAgICAqIGNhbGxiYWNrOiDnoa7lrprkuovku7blm57osINcclxuICAgICAqL1xyXG4gICAgc3VjY2VzcyhcclxuICAgICAgICBtZXNzYWdlOiBzdHJpbmcsXHJcbiAgICAgICAgbXNnPzogc3RyaW5nLFxyXG4gICAgICAgIGZpdENvbnRlbnQgPSB0cnVlLFxyXG4gICAgICAgIGNhbGxiYWNrOiAoKSA9PiB2b2lkID0gbnVsbFxyXG4gICAgKSB7XHJcbiAgICAgICAgY29uc3Qgc3VjY2Vzc0RsZyA9IHRoaXMuc2hvdyhcclxuICAgICAgICAgICAgXCJzdWNjZXNzXCIsXHJcbiAgICAgICAgICAgIG1lc3NhZ2UsXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGluaXRpYWxTdGF0ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIG9rVGV4dDogdGhpcy5va1RleHQsXHJcbiAgICAgICAgICAgICAgICAgICAgb2tIYW5kbGU6ICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2Vzc0RsZy5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGZpdENvbnRlbnQsXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIG1zZ1xyXG4gICAgICAgICk7XHJcblxyXG4gICAgICAgIHJldHVybiBzdWNjZXNzRGxnO1xyXG4gICAgfVxyXG4gICAgLyoqIOaPkOekuumUmeivr+S/oeaBr++8jFxyXG4gICAgICogbWVzc2FnZTog5o+Q56S65L+h5oGvXHJcbiAgICAgKiBtc2c6IDLnuqfkv6Hmga9cclxuICAgICAqIGZpdENvdW50ZW50OiDpu5jorqTkuLp0cnVlXHJcbiAgICAgKiBjYWxsYmFjazog56Gu5a6a5LqL5Lu25Zue6LCDXHJcbiAgICAgKi9cclxuICAgIGVycm9yKFxyXG4gICAgICAgIG1lc3NhZ2U6IHN0cmluZyxcclxuICAgICAgICBtc2c/OiBzdHJpbmcsXHJcbiAgICAgICAgZml0Q29udGVudCA9IHRydWUsXHJcbiAgICAgICAgY2FsbGJhY2s6ICgpID0+IHZvaWQgPSBudWxsLFxyXG4gICAgICAgIHNhZmVIdG1sID0gdHJ1ZVxyXG4gICAgKSB7XHJcbiAgICAgICAgY29uc3QgZXJyb3JEbGcgPSB0aGlzLnNob3coXHJcbiAgICAgICAgICAgIFwiZXJyb3JcIixcclxuICAgICAgICAgICAgbWVzc2FnZSxcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgc2FmZUh0bWwsXHJcbiAgICAgICAgICAgICAgICBpbml0aWFsU3RhdGU6IHtcclxuICAgICAgICAgICAgICAgICAgICBva1RleHQ6IHRoaXMub2tUZXh0LFxyXG4gICAgICAgICAgICAgICAgICAgIG9rSGFuZGxlOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yRGxnLmNsb3NlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgZml0Q29udGVudCxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgbXNnXHJcbiAgICAgICAgKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGVycm9yRGxnO1xyXG4gICAgfVxyXG5cclxuICAgIHdhcm5pbmcoXHJcbiAgICAgICAgbWVzc2FnZTogc3RyaW5nLFxyXG4gICAgICAgIG1zZz86IHN0cmluZyxcclxuICAgICAgICBmaXRDb250ZW50ID0gdHJ1ZSxcclxuICAgICAgICBjYWxsYmFjazogKCkgPT4gdm9pZCA9IG51bGxcclxuICAgICkge1xyXG4gICAgICAgIGNvbnN0IHdhcm5pbmdEbGcgPSB0aGlzLnNob3coXHJcbiAgICAgICAgICAgIFwid2FybmluZ1wiLFxyXG4gICAgICAgICAgICBtZXNzYWdlLFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpbml0aWFsU3RhdGU6IHtcclxuICAgICAgICAgICAgICAgICAgICBva1RleHQ6IHRoaXMub2tUZXh0LFxyXG4gICAgICAgICAgICAgICAgICAgIG9rSGFuZGxlOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdhcm5pbmdEbGcuY2xvc2UoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBmaXRDb250ZW50LFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBtc2dcclxuICAgICAgICApO1xyXG4gICAgICAgIHJldHVybiB3YXJuaW5nRGxnO1xyXG4gICAgfVxyXG5cclxuICAgIHNob3dIdG1sTXNnKFxyXG4gICAgICAgIHR5cGU6IFwid2FybmluZ1wiIHwgXCJpbmZvXCIgfCBcImVycm9yXCIgfCBcInN1Y2Nlc3NcIixcclxuICAgICAgICB0aXRsZTogc3RyaW5nLFxyXG4gICAgICAgIG1lc3NhZ2U/OiBzdHJpbmcsXHJcbiAgICAgICAgY2FsbGJhY2s6ICgpID0+IHZvaWQgPSBudWxsXHJcbiAgICApIHtcclxuICAgICAgICBjb25zdCBtc2dEbGcgPSB0aGlzLnNob3coXHJcbiAgICAgICAgICAgIHR5cGUsXHJcbiAgICAgICAgICAgIHRpdGxlLFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBzYWZlSHRtbDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBpbml0aWFsU3RhdGU6IHtcclxuICAgICAgICAgICAgICAgICAgICBva1RleHQ6IHRoaXMub2tUZXh0LFxyXG4gICAgICAgICAgICAgICAgICAgIG9rSGFuZGxlOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1zZ0RsZy5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGZpdENvbnRlbnQ6IHRydWUsXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIG1lc3NhZ2VcclxuICAgICAgICApO1xyXG4gICAgICAgIHJldHVybiBtc2dEbGc7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjbG9zZSgpIHtcclxuICAgICAgICBpZiAodGhpcy5tb2RhbHMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1zZ2JveCA9IHRoaXMuZ2V0TW9kYWxCeUlkKHRoaXMuY3VycmVudElkKTtcclxuICAgICAgICAgICAgaWYgKG1zZ2JveCkge1xyXG4gICAgICAgICAgICAgICAgbXNnYm94LnJlZi5jbG9zZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0TW9kYWxCeUlkKGlkOiBudW1iZXIpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5tb2RhbHMuZmluZCgoaXRlbSkgPT4gaXRlbS5pZCA9PT0gaWQpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0TW9kYWxDbXAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuYnNNb2RhbFNlcnZpY2UuZ2V0Q3VycmVudE1vZGFsQ29udGFpbmVyKCkuaW5zdGFuY2U7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSByZW1vdmVNZXNzYWdlcihpZCkge1xyXG4gICAgICAgIHRoaXMubW9kYWxzID0gdGhpcy5tb2RhbHMuZmlsdGVyKChuKSA9PiBuLmlkICE9PSBpZCk7XHJcbiAgICAgICAgaWYgKCF0aGlzLm1vZGFscy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgdGhpcy5jdXJyZW50SWQgPSAtMTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRJZCA9IHRoaXMubW9kYWxzW3RoaXMubW9kYWxzLmxlbmd0aCAtIDFdLmlkO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNvcHlUb0NsaXBib2FyZCh0ZXh0KTogYm9vbGVhbiB7XHJcbiAgICAgICAgY29uc3Qgd2luZG93UmVmOiBhbnkgPSB3aW5kb3c7XHJcbiAgICAgICAgaWYgKHdpbmRvd1JlZi5jbGlwYm9hcmREYXRhICYmIHdpbmRvd1JlZi5jbGlwYm9hcmREYXRhLnNldERhdGEpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHdpbmRvd1JlZi5jbGlwYm9hcmREYXRhLnNldERhdGEoXCJUZXh0XCIsIHRleHQpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoZG9jdW1lbnQucXVlcnlDb21tYW5kU3VwcG9ydGVkICYmIGRvY3VtZW50LnF1ZXJ5Q29tbWFuZFN1cHBvcnRlZChcImNvcHlcIikpIHtcclxuICAgICAgICAgICAgdmFyIHRleHRhcmVhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRleHRhcmVhXCIpO1xyXG4gICAgICAgICAgICB0ZXh0YXJlYS50ZXh0Q29udGVudCA9IHRleHQ7XHJcbiAgICAgICAgICAgIHRleHRhcmVhLnN0eWxlLnBvc2l0aW9uID0gXCJmaXhlZFwiO1xyXG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRleHRhcmVhKTtcclxuICAgICAgICAgICAgdGV4dGFyZWEuc2VsZWN0KCk7XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZG9jdW1lbnQuZXhlY0NvbW1hbmQoXCJjb3B5XCIpO1xyXG4gICAgICAgICAgICB9IGNhdGNoIChleCkge1xyXG4gICAgICAgICAgICB9IGZpbmFsbHkge1xyXG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZCh0ZXh0YXJlYSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIGV4Y2VwdGlvbihlcnJvcjogU2VydmVyRXhjZXB0aW9uRW50aXR5LCBvcHRzID0ge3dpZHRoOiA0NDAsIGhlaWdodDogMjAwLCBsb2c6IGZhbHNlfSk6IHZvaWQge1xyXG4gICAgICAgIGNvbnN0IGV4Y2VwdGlvbk1zZyA9IGVycm9yLk1lc3NhZ2UgfHwgXCJcIjtcclxuICAgICAgICBjb25zdCBkYXRlID0gZXJyb3IuZGF0ZSB8fCBmb3JtYXQobmV3IERhdGUoKSwgJ3l5eXktTU0tZGQgSEg6bW06c3MnKVxyXG4gICAgICAgIGNvbnN0IGxvY2FsRGF0ZSA9IGRhdGU7XHJcbiAgICAgICAgLy8g5Y+R55Sf5pe26Ze0XHJcbiAgICAgICAgY29uc3QgaGFwcGVuZWRUaW1lID0gdGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKCdtZXNzYWdlci5leGNlcHRpb24uaGFwcGVuZCcpO1xyXG4gICAgICAgIC8vIOivpue7huS/oeaBr1xyXG4gICAgICAgIGNvbnN0IGRldGFpbEluZm8gPSB0aGlzLmxvY2FsZVNlcnZpY2UuZ2V0VmFsdWUoJ21lc3NhZ2VyLmV4Y2VwdGlvbi5kZXRhaWwnKTtcclxuICAgICAgICBjb25zdCBkZXRhaWwgPVxyXG4gICAgICAgICAgICBlcnJvci5EZXRhaWwgfHxcclxuICAgICAgICAgICAgYCR7ZXJyb3IuTWVzc2FnZX1cXHJcXG4ke2hhcHBlbmVkVGltZX3vvJoke2xvY2FsRGF0ZX1cXHJcXG4ke2RldGFpbEluZm9977yaJHtlcnJvci5pbm5lck1lc3NhZ2V9YCB8fFxyXG4gICAgICAgICAgICBcIlwiO1xyXG5cclxuICAgICAgICBjb25zdCBpbm5lck1lc3NhZ2UgPSBlcnJvci5pbm5lck1lc3NhZ2UgfHwgbnVsbDtcclxuXHJcbiAgICAgICAgY29uc3QgZGVmYXVsdE9wdGlvbnMgPSB7d2lkdGg6IDQ0MCwgaGVpZ2h0OiAyMDAsIGxvZzogZmFsc2V9O1xyXG4gICAgICAgIGxldCBleG9wdGlvbnMgPSBkZWZhdWx0T3B0aW9ucztcclxuICAgICAgICBpZiAob3B0cykge1xyXG4gICAgICAgICAgICBleG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHt9LCBkZWZhdWx0T3B0aW9ucywgb3B0cyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgYnNNb2RhbFJlZjogQnNNb2RhbFJlZjtcclxuICAgICAgICBjb25zdCBvcHRpb25zID0ge1xyXG4gICAgICAgICAgICBzaG93TWF4QnV0dG9uOiBmYWxzZSxcclxuICAgICAgICAgICAgYnV0dG9uczogW1xyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZSgnbWVzc2FnZXIuZXhjZXB0aW9uLnJvZ2VyJyksXHJcbiAgICAgICAgICAgICAgICAgICAgY2xzOiBcImJ0biBidG4tcHJpbWFyeSBidG4tbGdcIixcclxuICAgICAgICAgICAgICAgICAgICBoYW5kbGU6ICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnNNb2RhbFJlZi5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBdLFxyXG4gICAgICAgICAgICAvLyBzaG93SGVhZGVyOiBmYWxzZSxcclxuICAgICAgICAgICAgd2lkdGg6IGV4b3B0aW9ucy53aWR0aCxcclxuICAgICAgICAgICAgaGVpZ2h0OiBleG9wdGlvbnMuaGVpZ2h0LFxyXG4gICAgICAgICAgICBzYWZlSHRtbDogZmFsc2UsXHJcbiAgICAgICAgICAgIGV4Y2VwdGlvbjoge1xyXG4gICAgICAgICAgICAgICAgZGF0ZTogbG9jYWxEYXRlLFxyXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogaW5uZXJNZXNzYWdlLFxyXG4gICAgICAgICAgICAgICAgY29weUJ1dHRvbjoge1xyXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZSgnbWVzc2FnZXIuZXhjZXB0aW9uLmNvcHknKSxcclxuICAgICAgICAgICAgICAgICAgICBvbkNsaWNrOiAoZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSB0aGlzLmNvcHlUb0NsaXBib2FyZChkZXRhaWwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0ZXh0ID0gcmVzdWx0XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZSgnbWVzc2FnZXIuZXhjZXB0aW9uLmNvcHlTdWNjZXNzJylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogdGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKCdtZXNzYWdlci5leGNlcHRpb24uY29weUZhaWxlZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBic01vZGFsUmVmLmNvbnRlbnQuc2hvd01pbmlOb3RpZnkodGV4dCwgMTUwMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgfTtcclxuICAgICAgICBpZiAoZXhvcHRpb25zLmxvZykge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gdGhpcy5kaXNwbGF5RXJyb3IoZXJyb3IpO1xyXG4gICAgICAgIGJzTW9kYWxSZWYgPSB0aGlzLnNob3coXHJcbiAgICAgICAgICAgIFwiZXhjZXB0aW9uXCIsXHJcbiAgICAgICAgICAgIGV4Y2VwdGlvbk1zZyxcclxuICAgICAgICAgICAgb3B0aW9uc1xyXG4gICAgICAgICk7XHJcbiAgICB9XHJcbn1cclxuIl19