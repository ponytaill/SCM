// tslint:disable: max-line-length
import { Injectable, Optional } from '@angular/core';
import { Repository, FrameContext, PARENT_CLASS, ChangeType, DataPropGroup } from '@farris/devkit';
import { tap, switchMap } from 'rxjs/operators';
import { EMPTY, Subject } from 'rxjs';
import { zip } from 'rxjs/observable/zip';
import { empty } from 'rxjs/observable/empty';
import { of } from 'rxjs/observable/of';
import { VerifyDetailService } from '@farris/ui-verify-detail';
import { FormNotifyService } from './form-notify.service';
import { LanguageService } from './languag.service';
/**
 * 表单验证服务
 * @scope FrameComponent
 */
class ValidationService {
    /**
     * 构造函数
     */
    constructor(repository, frameContext, notifyService, languageService) {
        this.repository = repository;
        this.frameContext = frameContext;
        this.notifyService = notifyService;
        this.languageService = languageService;
        this.validationResults = new Subject();
        this.validationAllResult = new Subject();
        if (!this.languageService) {
            this.languageService = new LanguageService();
        }
    }
    /**
     * 验证表单内的所有表单
     */
    validate() {
        this.repository.getList().subscribe((result) => {
            for (const entity of result) {
                entity.validate().subscribe((result) => {
                    if (!result.isValid) {
                        alert(result.message);
                        this.validationResults.next(result);
                    }
                });
            }
        });
        return this.validationResults;
    }
    /**
     * 校验当前行
     */
    validateCurrentRow() {
        const entityTypeInfo = this.repository.entityTypeInfo;
        // 组合表单只校验当前按钮所在的表单
        const primaryValue = this.frameContext.bindingData.list.currentId;
        if (!primaryValue) {
            return of(true);
        }
        // 首先校验实体不能为空规则
        const entity = this.repository.entityCollection.getEntityById(primaryValue);
        if (!entity) {
            return of(true);
        }
        const isEntityValid = this.validateEntityAllowEmptyRule(entityTypeInfo);
        if (!isEntityValid) {
            return EMPTY;
        }
        const entities = [entity];
        const namespace = this.frameContext.namespace;
        let frameContexts = [];
        // 修复使用相同be创建的vo的组合表单校验时多个表单校验规则被合并的问题
        // TODO: 目前未考虑组合表单统一保存的场景，后续支持组合表单统一保存时再修改
        if (namespace !== null) {
            // 存在命名空间，说明表单较新，可以依赖该特性
            frameContexts = this.frameContext.appContext.frameContextManager.getFrameContextsByNamespace(namespace);
        }
        else {
            // 表单较老，获取所有的上下文，在校验阶段过滤规则
            frameContexts = this.frameContext.appContext.frameContextManager.getFrameContexts();
        }
        const isModal = this.isInDialog();
        const hasOwnVerifyDetailService = this.hasOwnVerifyDetailService();
        let rootViewModel = this.frameContext.root.viewModel;
        if (isModal && hasOwnVerifyDetailService) {
            rootViewModel = this.frameContext.getVirtualRootFrameContext().viewModel;
        }
        let toValidate = false;
        const formErrors = [];
        frameContexts.forEach((frameContext) => {
            if (frameContext.form && frameContext.form.enableValidate) {
                toValidate = true;
            }
        });
        if (!toValidate || entities.length < 1) {
            return of(true);
        }
        rootViewModel.verifyInformations = [];
        let formValid = true;
        let entityValid = true;
        const formValidationRules = new Map();
        frameContexts.forEach((formContext) => {
            const bindingObject = formContext.bindingData.getObject();
            // 通知所有bindingData,
            bindingObject && bindingObject.setShowValidationMsg(true);
            if (formContext.form && formContext.form.enableValidate) {
                // 获取当前表单上的所有验证规则
                const currentFormValidationRules = formContext.form.getValidationRules();
                currentFormValidationRules.forEach((rules, path) => {
                    if (formValidationRules.has(path)) {
                        rules.forEach(rule => formValidationRules.get(path).push(rule));
                    }
                    else {
                        formValidationRules.set(path, [...rules]);
                    }
                });
                formContext.form.setShowValidationMsg(true);
                // 逐个调用表单的验证，验证前端表单规则
                if (!formContext.form.isFormValid()) {
                    formErrors.push(formContext.form);
                    formValid = false;
                }
            }
        });
        // 验证所有实体
        const observableList = entities.map((entity) => {
            const index = this.frameContext.bindingData.list.getIndexById(entity.primaryValue);
            return entity.validate(undefined, undefined, formValidationRules, null, this.frameContext);
        });
        const result$ = zip(...observableList).pipe(tap((resultList) => {
            frameContexts.forEach((formContext) => {
                if (!formContext.form.enableValidate) {
                    return;
                }
                const handleErrors = (errors) => {
                    errors.forEach((validationError) => {
                        if (validationError.children && validationError.children.length) {
                            handleErrors(validationError.children);
                        }
                        const errMsgObj = {};
                        let id = '';
                        const findId = (target) => {
                            if (target && target.data && target.data.id) {
                                id = target.data.id;
                                return;
                            }
                            else if (target[PARENT_CLASS]) {
                                findId(target[PARENT_CLASS]);
                            }
                        };
                        findId(validationError.target);
                        // 实体验证出错，需要将错误展示到界面上
                        // 实体不一定是当前行
                        let parentPathData = {
                            path: [],
                            isUdt: false,
                            isGrid: false
                        };
                        if (validationError.target) {
                            parentPathData = validationError.target.getPaths();
                        }
                        const bindingPath = '/' + parentPathData.path.join('/');
                        if (validationError.constraints) {
                            Object.keys(validationError.constraints).forEach(key => {
                                errMsgObj[key] = {
                                    name: validationError.constraints[key]
                                };
                                // if (this.frameContext.viewModel.bindingPath === bindingPath) {
                                //   rootViewModel['verifyInformations'].push({
                                //     id: id,
                                //     title: key,
                                //     msg: validationError.constraints[key],
                                //     type: 'warn'
                                //   })
                                // }
                            });
                        }
                        const paths = parentPathData.path.concat(validationError.property);
                        //if (this.frameContext.viewModel.bindingPath === bindingPath) {
                        // 将错误信息更新到formControl上
                        formContext.bindingData.changes.next({
                            type: ChangeType.UpdateErrors,
                            id,
                            path: paths,
                            isUdt: parentPathData.isUdt,
                            isGrid: parentPathData.isGrid,
                            value: validationError.value,
                            errors: errMsgObj
                        });
                        //}
                    });
                };
                // 展开验证结果
                const isValidList = resultList.map((result) => result.isValid);
                // 保存前先调用实体上的验证规则，全部通过之后才保存
                // 实体验证通过
                if (isValidList.filter(x => x).length === observableList.length) {
                    // 将错误信息更新到formControl上
                    formContext.bindingData.changes.next({
                        type: ChangeType.UpdateErrors,
                        path: []
                    });
                    // 验证成功后隐藏输入时的验证
                    if (formValid) {
                        const bindingObject = formContext.bindingData.getObject();
                        bindingObject && bindingObject.setShowValidationMsg(false);
                        const form = formContext.form;
                        if (form) {
                            form.setShowValidationMsg(false);
                        }
                    }
                }
                else {
                    // 实体验证有错误
                    entityValid = false;
                    resultList.forEach((result) => {
                        if (result.isValid) {
                            // 清除验证通过的错误
                            formContext.bindingData.changes.next({
                                type: ChangeType.UpdateErrors,
                                path: []
                            });
                        }
                        else {
                            handleErrors(result.errors);
                        }
                    });
                }
            });
        }), switchMap((resultList) => {
            let isValidated = true;
            const errors = [];
            resultList.forEach((result) => {
                if (!result.isValid) {
                    isValidated = false;
                }
                errors.push(...result.errors);
            });
            if (errors.length > 0) {
                this.collectValidationErrors(rootViewModel, errors, this.frameContext.namespace);
            }
            // rootViewModel.verifycationChanged.next(rootViewModel.verifyInformations);
            let verifyInformations = rootViewModel.verifyInformations;
            if (isModal && hasOwnVerifyDetailService) {
                verifyInformations = rootViewModel.verifyInformations.filter(item => item.namespace === namespace);
            }
            rootViewModel.verifycationChanged.next(verifyInformations);
            if (isValidated && !formValid) {
                // 实体校验通过但表单校验不通过，此时实体和表单存在校验规则不一致的情况
                console.warn('实体和控件校验规则不一致，会导致命令执行中断！');
            }
            if (isValidated && formValid) {
                return of(true);
            }
            else {
                return empty();
            }
        }));
        return result$;
    }
    /**
     * 调用表单和实体上的验证规则, 通过后调用回调cb
     */
    validateAll() {
        const entityTypeInfo = this.repository.entityTypeInfo;
        // 组合表单只校验当前按钮所在的表单
        const entities = this.repository.entityCollection.getAllEntities();
        const namespace = this.frameContext.namespace;
        let frameContexts = [];
        if (namespace !== null) {
            // 存在命名空间，说明表单较新，可以依赖该特性
            frameContexts = this.frameContext.appContext.frameContextManager.getFrameContextsByNamespace(namespace);
        }
        else {
            // 表单较老，获取所有的上下文，在校验阶段过滤规则
            frameContexts = this.frameContext.appContext.frameContextManager.getFrameContexts();
        }
        const isEntityValid = this.validateEntityAllowEmptyRule(entityTypeInfo);
        if (!isEntityValid) {
            return EMPTY;
        }
        let toValidate = false;
        const formErrors = [];
        frameContexts.forEach((frameContext) => {
            if (frameContext.form && frameContext.form.enableValidate) {
                toValidate = true;
            }
        });
        if (!toValidate || entities.length < 1) {
            return of(true);
        }
        const isModal = this.isInDialog();
        const hasOwnVerifyDetailService = this.hasOwnVerifyDetailService();
        let rootViewModel = this.frameContext.root.viewModel;
        if (isModal && hasOwnVerifyDetailService) {
            rootViewModel = this.frameContext.getVirtualRootFrameContext().viewModel;
        }
        let formValid = true;
        let entityValid = true;
        const formValidationRules = new Map();
        frameContexts.forEach((formContext) => {
            const bindingObject = formContext.bindingData.getObject();
            // 通知所有bindingData,
            bindingObject && bindingObject.setShowValidationMsg(true);
            if (formContext.form && formContext.form.enableValidate) {
                // 获取当前表单上的所有验证规则
                const currentFormValidationRules = formContext.form.getValidationRules();
                currentFormValidationRules.forEach((rules, path) => {
                    if (formValidationRules.has(path)) {
                        rules.forEach(rule => formValidationRules.get(path).push(rule));
                    }
                    else {
                        formValidationRules.set(path, [...rules]);
                    }
                });
                formContext.form.setShowValidationMsg(true);
                // 逐个调用表单的验证，验证前端表单规则
                if (!formContext.form.isFormValid()) {
                    formErrors.push(formContext.form);
                    formValid = false;
                }
            }
        });
        // 触发所有实体的validate事件
        const isMultiEntityValiate = entities.length > 0;
        // 验证所有实体
        const observableList = entities.map((entity, index) => entity.validate(undefined, undefined, formValidationRules, isMultiEntityValiate ? index : null, this.frameContext));
        const result$ = zip(...observableList).pipe(tap((resultList) => {
            frameContexts.forEach((formContext) => {
                if (!formContext.form.enableValidate) {
                    return;
                }
                const handleErrors = (errors) => {
                    errors.forEach((validationError) => {
                        if (validationError.children && validationError.children.length) {
                            handleErrors(validationError.children);
                        }
                        const errMsgObj = {};
                        let id = '';
                        const findId = (target) => {
                            if (target && target.data && target.data.id) {
                                id = target.data.id;
                                return;
                            }
                            else if (target[PARENT_CLASS]) {
                                findId(target[PARENT_CLASS]);
                            }
                        };
                        findId(validationError.target);
                        // 实体验证出错，需要将错误展示到界面上
                        // 实体不一定是当前行
                        let parentPathData = {
                            path: [],
                            isUdt: false,
                            isGrid: false
                        };
                        if (validationError.target) {
                            parentPathData = validationError.target.getPaths();
                        }
                        const bindingPath = '/' + parentPathData.path.join('/');
                        if (validationError.constraints) {
                            Object.keys(validationError.constraints).forEach(key => {
                                errMsgObj[key] = {
                                    name: validationError.constraints[key]
                                };
                                // if (this.frameContext.viewModel.bindingPath === bindingPath) {
                                //   rootViewModel['verifyInformations'].push({
                                //     id: id,
                                //     title: key,
                                //     msg: validationError.constraints[key],
                                //     type: 'warn'
                                //   })
                                // }
                            });
                        }
                        const paths = parentPathData.path.concat(validationError.property);
                        //if (this.frameContext.viewModel.bindingPath === bindingPath) {
                        // 将错误信息更新到formControl上
                        formContext.bindingData.changes.next({
                            type: ChangeType.UpdateErrors,
                            id,
                            path: paths,
                            isUdt: parentPathData.isUdt,
                            isGrid: parentPathData.isGrid,
                            value: validationError.value,
                            errors: errMsgObj
                        });
                        //}
                    });
                };
                // 展开验证结果
                const isValidList = resultList.map((result) => result.isValid);
                // 保存前先调用实体上的验证规则，全部通过之后才保存
                // 实体验证通过
                if (isValidList.filter(x => x).length === observableList.length) {
                    // 将错误信息更新到formControl上
                    formContext.bindingData.changes.next({
                        type: ChangeType.UpdateErrors,
                        path: []
                    });
                    // 验证成功后隐藏输入时的验证
                    if (formValid) {
                        const bindingObject = formContext.bindingData.getObject();
                        bindingObject && bindingObject.setShowValidationMsg(false);
                        const form = formContext.form;
                        if (form) {
                            form.setShowValidationMsg(false);
                        }
                    }
                }
                else {
                    // 实体验证有错误
                    entityValid = false;
                    resultList.forEach((result) => {
                        if (result.isValid) {
                            // 清除验证通过的错误
                            formContext.bindingData.changes.next({
                                type: ChangeType.UpdateErrors,
                                path: []
                            });
                        }
                        else {
                            handleErrors(result.errors);
                        }
                    });
                }
            });
        }), switchMap((resultList) => {
            let isValidated = true;
            const errors = [];
            resultList.forEach((result) => {
                if (!result.isValid) {
                    isValidated = false;
                }
                errors.push(...result.errors);
            });
            if (errors.length > 0) {
                this.collectValidationErrors(rootViewModel, errors, this.frameContext.namespace);
            }
            let verifyInformations = rootViewModel.verifyInformations;
            if (isModal && hasOwnVerifyDetailService) {
                verifyInformations = rootViewModel.verifyInformations.filter(item => item.namespace === namespace);
            }
            // 因为校验累加的缘故，导致之前的校验信息一直存在，只能通过校验结果来确定是否还有错误信息
            if (isValidated && formValid) {
                verifyInformations = rootViewModel.verifyInformations = [];
            }
            rootViewModel.verifycationChanged.next(verifyInformations);
            if (isValidated && formValid) {
                return of(true);
            }
            else {
                return empty();
            }
        }));
        return result$;
    }
    /**
     * 校验实体是否满足不能为空的规则
     * @param entity 主实体
     */
    validateEntityAllowEmptyRule(entityTypeInfo) {
        // 确认实体各个层级中是否存在不能为空的规则
        const paths = this.getNotAllowEmptyBindingPaths(entityTypeInfo);
        if (!paths || paths.length < 1) {
            return true;
        }
        // 找到所有不合法的bindingPaths
        const invalidPaths = paths.filter((path) => {
            const bindingPaths = path.split('/').filter(p => p);
            const bindingList = this.frameContext.bindingData.getValue(bindingPaths);
            if (!bindingList || bindingList.length < 1) {
                return true;
            }
            return false;
        });
        // 有实体必填，但实体数据为空
        if (invalidPaths.length > 0) {
            const tableNames = [];
            invalidPaths.forEach((path) => {
                //const frameContexts = this.getFrameContextByBindingPath(path.split('/'));
                //const frameComponents = frameContexts.map(frameContext => frameContext.frameComponent);
                // 找到所有容器类组件
                //const containerComponents = frameComponents.filter(frameComponent => [ComponentType.farrisDataGridComponent, ComponentType.farrisTreeTalbeComponent, ComponentType.kendoGridComponent, ComponentType.primengTreeComponent].includes(frameComponent.componentType));
                //if (!(!containerComponents || containerComponents.length < 1)) {
                const viewModelName = this.getViewModelNameByBindingPaths(path.split('/')) || `绑定路径${path}`;
                tableNames.push(viewModelName);
                //}
            });
            if (this.notifyService) {
                this.notifyService.error(`${tableNames.join('，')} ${this.languageService.tableCanNotEmpty}`, { hideTitle: true });
            }
            return false;
        }
        return true;
    }
    /**
     *
     * @param bindingPaths path不能为空或/，不支持主表
     */
    getViewModelNameByBindingPaths(bindingPaths) {
        const namespace = this.frameContext.namespace;
        let frameContexts = null;
        if (namespace !== null) {
            // 存在命名空间，说明表单较新，可以依赖该特性
            frameContexts = this.frameContext.appContext.frameContextManager.getFrameContextsByNamespace(namespace);
        }
        else {
            // 表单较老，获取所有的上下文，在校验阶段过滤规则
            frameContexts = this.frameContext.appContext.frameContextManager.getFrameContexts();
        }
        const bindingPath = bindingPaths.filter(p => p).join('/');
        const frameContext = frameContexts.find((frameContext) => frameContext.viewModel && frameContext.viewModel.bindingPath.split('/').filter(p => p).join('/') === bindingPath);
        const viewModelName = frameContext && frameContext.form && frameContext.form.formGroupName || '';
        return viewModelName;
    }
    /**
     * 遍历获取所有不能为空的实体的绑定路径
     * @param entityTypeInfo
     * @param results
     * @returns
     */
    getNotAllowEmptyBindingPaths(entityTypeInfo, results = []) {
        if (!entityTypeInfo) {
            return;
        }
        this.deepFirstTraversalEntityTypeInfo(entityTypeInfo, results);
        return results;
    }
    deepFirstTraversalEntityTypeInfo(entityTypeInfo, result = [], previousValue = []) {
        // 确认当前实体是否必填
        const isAllowEmpty = this.isAllowEmpty(entityTypeInfo.entityInfo.allowEmpty, previousValue);
        if (isAllowEmpty === false) {
            if (previousValue.length < 1) {
                result.push('');
            }
            else {
                result.push(previousValue.join('/'));
            }
        }
        // 获取所有子表
        const list = entityTypeInfo.getPropInfosByGroup(DataPropGroup.List);
        if (list && list.length > 0) {
            list.forEach((propInfo) => {
                const typeInfo = propInfo.typeInfo;
                if (typeInfo && typeInfo.entityInfo) {
                    previousValue.push(typeInfo.entityInfo.nodeCode);
                    this.deepFirstTraversalEntityTypeInfo(typeInfo, result, previousValue);
                }
            });
        }
        // 没有下级了，此时应该清空游标，将收集到的路径放到结果集中
        if (previousValue && previousValue.length > 0) {
            previousValue.pop();
        }
    }
    isAllowEmpty(value, paths) {
        if (value === undefined || value === true || value === '') {
            return true;
        }
        // 开发者定义了不能为空的规则
        const frameContexts = this.getFrameContextByBindingPath(paths);
        let caller = this.frameContext.frameComponent;
        if (!frameContexts || frameContexts.length < 1) {
            // 定义了规则但对应的Frame没有渲染
            console.warn(`绑定路径 ${paths.join('/')} 定义了不能为空的规则，但找不到该绑定路径对应的组件。请确保组件显隐与必填一致。`);
        }
        else {
            caller = frameContexts.pop().frameComponent;
        }
        if (typeof value === 'boolean') {
            return value;
        }
        else if (typeof value === 'string') {
            value = value.trim().startsWith('return') ? value : `return ${value}`;
            const factory = new Function(`
        var viewModel = this.viewModel;
        var bindingData = this.bindingData;
        var context = this.context;
        ${value}
      `);
            return factory.apply(caller);
        }
        else {
            console.warn(`无效的必填规则。`);
        }
    }
    collectValidationErrors(rootViewModel, errors, namespace, filter = true) {
        if (filter) {
            rootViewModel.verifyInformations = rootViewModel.verifyInformations.filter(item => item.namespace !== namespace);
        }
        errors.forEach((validationError) => {
            if (validationError.children && validationError.children.length) {
                this.collectValidationErrors(rootViewModel, validationError.children, namespace, false);
            }
            let id = '';
            const findId = (target) => {
                if (target && target.data && target.data.id) {
                    id = target.data.id;
                    return;
                }
                else if (target[PARENT_CLASS]) {
                    findId(target[PARENT_CLASS]);
                }
            };
            findId(validationError.target);
            if (validationError.constraints) {
                const validationResultTypes = Object.keys(validationError.constraints);
                if (validationResultTypes.length) {
                    const offset = rootViewModel.verifyInformations.filter(item => item.namespace === namespace).length;
                    let index = rootViewModel.verifyInformations.findIndex(item => item.namespace === namespace);
                    index = index === -1 ? 0 : index + offset;
                    rootViewModel.verifyInformations.splice(index, 0, {
                        id: id,
                        namespace,
                        targetField: validationError.field,
                        index: validationError.index,
                        title: validationError.propertyName,
                        msg: validationError.constraints[validationResultTypes[0]],
                        frameContext: validationError.frameContext,
                        fullPath: validationError.fullPath,
                        type: validationResultTypes[0] === 'required' ? 'empty' : 'error'
                    });
                }
            }
        });
    }
    /**
     * 重置校验信息（仅当前表单）
     */
    resetValidation() {
        const isDialog = this.isInDialog();
        let rootViewModel = this.frameContext.root.viewModel;
        if (isDialog) {
            rootViewModel = this.frameContext.getVirtualRootFrameContext().viewModel;
        }
        let verifyInformations = rootViewModel.verifyInformations;
        if (verifyInformations.length) {
            const namespace = this.frameContext.namespace;
            if (namespace !== null) {
                verifyInformations = rootViewModel.verifyInformations.filter(item => item.namespace !== namespace);
            }
            rootViewModel.verifyInformations = verifyInformations;
            //rootViewModel.verifyInformations.splice(0, rootViewModel.verifyInformations.length);
        }
        if (rootViewModel && rootViewModel.verifycationChanged) {
            rootViewModel.verifycationChanged.next(verifyInformations);
        }
        return of(null);
    }
    /**
     * 是否在弹窗内部
     */
    isInDialog() {
        return this.frameContext && this.frameContext.getVirtualRootFrameContext() && this.frameContext.getVirtualRootFrameContext().frameComponent && this.frameContext.getVirtualRootFrameContext().frameComponent['isDialogRootComponent'] || false;
    }
    /**
     * 拥有独自的校验提示服务
     */
    hasOwnVerifyDetailService() {
        return this.frameContext.injector.get(VerifyDetailService, null) !== this.frameContext.root.appContext.injector.get(VerifyDetailService, null);
        ;
    }
    /**
     * 通过bindingPath获取所有匹配的frameContext
     * @param bindingPath
     * @returns
     */
    getFrameContextByBindingPath(bindingPaths) {
        const bindingPath = bindingPaths.filter(p => p).join('/');
        return this.frameContext.appContext.frameContextManager.getFrameContexts().filter(frameContext => frameContext.viewModel.bindingPath.split('/').filter(p => p).join('/') === bindingPath);
    }
    filterDataGridComponent() { }
}
ValidationService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
ValidationService.ctorParameters = () => [
    { type: Repository },
    { type: FrameContext },
    { type: FormNotifyService, decorators: [{ type: Optional }] },
    { type: LanguageService, decorators: [{ type: Optional }] }
];
export { ValidationService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmFsaWRhdGlvbi5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9jb21tYW5kLXNlcnZpY2VzLyIsInNvdXJjZXMiOlsibGliL3ZhbGlkYXRpb24uc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxrQ0FBa0M7QUFDbEMsT0FBTyxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDckQsT0FBTyxFQUFFLFVBQVUsRUFBVSxZQUFZLEVBQUUsWUFBWSxFQUFFLFVBQVUsRUFBNEUsYUFBYSxFQUE0QyxNQUFNLGdCQUFnQixDQUFDO0FBQy9OLE9BQU8sRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDaEQsT0FBTyxFQUFFLEtBQUssRUFBYyxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDbEQsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQzFDLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUM5QyxPQUFPLEVBQUUsRUFBRSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDeEMsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDL0QsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDMUQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBRXBEOzs7R0FHRztBQUVILE1BQ00saUJBQWlCO0lBSXJCOztPQUVHO0lBQ0gsWUFDVSxVQUEyQixFQUMzQixZQUEwQixFQUNkLGFBQWdDLEVBQ2hDLGVBQWdDO1FBSDVDLGVBQVUsR0FBVixVQUFVLENBQWlCO1FBQzNCLGlCQUFZLEdBQVosWUFBWSxDQUFjO1FBQ2Qsa0JBQWEsR0FBYixhQUFhLENBQW1CO1FBQ2hDLG9CQUFlLEdBQWYsZUFBZSxDQUFpQjtRQVQ5QyxzQkFBaUIsR0FBRyxJQUFJLE9BQU8sRUFB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QUFDLElBQUksQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBc0IsbUJBQW1CLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFBQSxDQUFDO0lBQzVMLENBQUM7SUFDRDs7OztPQUlHO0lBQ0ssNEJBQTRCLENBQUMsWUFBc0I7UUFDekQsTUFBTSxXQUFXLEdBQUcsWUFBWSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUMxRCxPQUFPLElBQUksQ0FBQyxZQUFZLENBQUMsVUFBVSxDQUFDLG1CQUFtQixDQUFDLGdCQUFnQixFQUFFLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxFQUFFLENBQUMsWUFBWSxDQUFDLFNBQVMsQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxXQUFXLENBQUMsQ0FBQztJQUM1TCxDQUFDO0lBQ08sdUJBQXVCLEtBQUssQ0FBQzs7O1lBanBCdEMsVUFBVTs7OztZQWZGLFVBQVU7WUFBVSxZQUFZO1lBT2hDLGlCQUFpQix1QkFtQnJCLFFBQVE7WUFsQkosZUFBZSx1QkFtQm5CLFFBQVE7O0FBd29CYixPQUFPLEVBQUUsaUJBQWlCLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vIHRzbGludDpkaXNhYmxlOiBtYXgtbGluZS1sZW5ndGhcclxuaW1wb3J0IHsgSW5qZWN0YWJsZSwgT3B0aW9uYWwgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgUmVwb3NpdG9yeSwgRW50aXR5LCBGcmFtZUNvbnRleHQsIFBBUkVOVF9DTEFTUywgQ2hhbmdlVHlwZSwgVmFsaWRhdGlvblJlc3VsdCwgVmFsaWRhdGlvbkVycm9yLCBWYWxpZGF0ZVJ1bGUsIFZpZXdNb2RlbCwgRGF0YVR5cGVJbmZvLCBEYXRhUHJvcEdyb3VwLCBEYXRhUHJvcEluZm8sIEJpbmRpbmdMaXN0LCBDb21wb25lbnRUeXBlIH0gZnJvbSAnQGZhcnJpcy9kZXZraXQnO1xyXG5pbXBvcnQgeyB0YXAsIHN3aXRjaE1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgRU1QVFksIE9ic2VydmFibGUsIFN1YmplY3QgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgemlwIH0gZnJvbSAncnhqcy9vYnNlcnZhYmxlL3ppcCc7XHJcbmltcG9ydCB7IGVtcHR5IH0gZnJvbSAncnhqcy9vYnNlcnZhYmxlL2VtcHR5JztcclxuaW1wb3J0IHsgb2YgfSBmcm9tICdyeGpzL29ic2VydmFibGUvb2YnO1xyXG5pbXBvcnQgeyBWZXJpZnlEZXRhaWxTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS12ZXJpZnktZGV0YWlsJztcclxuaW1wb3J0IHsgRm9ybU5vdGlmeVNlcnZpY2UgfSBmcm9tICcuL2Zvcm0tbm90aWZ5LnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBMYW5ndWFnZVNlcnZpY2UgfSBmcm9tICcuL2xhbmd1YWcuc2VydmljZSc7XHJcblxyXG4vKipcclxuICog6KGo5Y2V6aqM6K+B5pyN5YqhXHJcbiAqIEBzY29wZSBGcmFtZUNvbXBvbmVudFxyXG4gKi9cclxuXHJcbkBJbmplY3RhYmxlKClcclxuY2xhc3MgVmFsaWRhdGlvblNlcnZpY2Uge1xyXG5cclxuICBwcml2YXRlIHZhbGlkYXRpb25SZXN1bHRzID0gbmV3IFN1YmplY3Q8YW55PigpO1xyXG4gIHByaXZhdGUgdmFsaWRhdGlvbkFsbFJlc3VsdCA9IG5ldyBTdWJqZWN0PGFueT4oKTtcclxuICAvKipcclxuICAgKiDmnoTpgKDlh73mlbBcclxuICAgKi9cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgcmVwb3NpdG9yeTogUmVwb3NpdG9yeTxhbnk+LFxyXG4gICAgcHJpdmF0ZSBmcmFtZUNvbnRleHQ6IEZyYW1lQ29udGV4dCxcclxuICAgIEBPcHRpb25hbCgpIHByaXZhdGUgbm90aWZ5U2VydmljZTogRm9ybU5vdGlmeVNlcnZpY2UsXHJcbiAgICBAT3B0aW9uYWwoKSBwcml2YXRlIGxhbmd1YWdlU2VydmljZTogTGFuZ3VhZ2VTZXJ2aWNlXHJcbiAgKSB7XHJcbiAgICBpZiAoIXRoaXMubGFuZ3VhZ2VTZXJ2aWNlKSB7XHJcbiAgICAgIHRoaXMubGFuZ3VhZ2VTZXJ2aWNlID0gbmV3IExhbmd1YWdlU2VydmljZSgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6aqM6K+B6KGo5Y2V5YaF55qE5omA5pyJ6KGo5Y2VXHJcbiAgICovXHJcbiAgcHVibGljIHZhbGlkYXRlKCkge1xyXG4gICAgdGhpcy5yZXBvc2l0b3J5LmdldExpc3QoKS5zdWJzY3JpYmUoXHJcbiAgICAgIChyZXN1bHQ6IEVudGl0eVtdKSA9PiB7XHJcbiAgICAgICAgZm9yIChjb25zdCBlbnRpdHkgb2YgcmVzdWx0KSB7XHJcbiAgICAgICAgICBlbnRpdHkudmFsaWRhdGUoKS5zdWJzY3JpYmUoKHJlc3VsdDogVmFsaWRhdGlvblJlc3VsdCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoIXJlc3VsdC5pc1ZhbGlkKSB7XHJcbiAgICAgICAgICAgICAgYWxlcnQocmVzdWx0Lm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgIHRoaXMudmFsaWRhdGlvblJlc3VsdHMubmV4dChyZXN1bHQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICk7XHJcbiAgICByZXR1cm4gdGhpcy52YWxpZGF0aW9uUmVzdWx0cztcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5qCh6aqM5b2T5YmN6KGMXHJcbiAgICovXHJcbiAgcHVibGljIHZhbGlkYXRlQ3VycmVudFJvdygpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgY29uc3QgZW50aXR5VHlwZUluZm8gPSB0aGlzLnJlcG9zaXRvcnkuZW50aXR5VHlwZUluZm87XHJcbiAgICAvLyDnu4TlkIjooajljZXlj6rmoKHpqozlvZPliY3mjInpkq7miYDlnKjnmoTooajljZVcclxuICAgIGNvbnN0IHByaW1hcnlWYWx1ZSA9IHRoaXMuZnJhbWVDb250ZXh0LmJpbmRpbmdEYXRhLmxpc3QuY3VycmVudElkO1xyXG4gICAgaWYgKCFwcmltYXJ5VmFsdWUpIHtcclxuICAgICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gICAgfVxyXG4gICAgLy8g6aaW5YWI5qCh6aqM5a6e5L2T5LiN6IO95Li656m66KeE5YiZXHJcbiAgICBjb25zdCBlbnRpdHkgPSB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5nZXRFbnRpdHlCeUlkKHByaW1hcnlWYWx1ZSk7XHJcbiAgICBpZiAoIWVudGl0eSkge1xyXG4gICAgICByZXR1cm4gb2YodHJ1ZSk7XHJcbiAgICB9XHJcbiAgICBjb25zdCBpc0VudGl0eVZhbGlkID0gdGhpcy52YWxpZGF0ZUVudGl0eUFsbG93RW1wdHlSdWxlKGVudGl0eVR5cGVJbmZvKTtcclxuICAgIGlmICghaXNFbnRpdHlWYWxpZCkge1xyXG4gICAgICByZXR1cm4gRU1QVFk7XHJcbiAgICB9XHJcbiAgICBjb25zdCBlbnRpdGllczogRW50aXR5W10gPSBbZW50aXR5XTtcclxuICAgIGNvbnN0IG5hbWVzcGFjZSA9IHRoaXMuZnJhbWVDb250ZXh0Lm5hbWVzcGFjZTtcclxuICAgIGxldCBmcmFtZUNvbnRleHRzID0gW107XHJcbiAgICAvLyDkv67lpI3kvb/nlKjnm7jlkIxiZeWIm+W7uueahHZv55qE57uE5ZCI6KGo5Y2V5qCh6aqM5pe25aSa5Liq6KGo5Y2V5qCh6aqM6KeE5YiZ6KKr5ZCI5bm255qE6Zeu6aKYXHJcbiAgICAvLyBUT0RPOiDnm67liY3mnKrogIPomZHnu4TlkIjooajljZXnu5/kuIDkv53lrZjnmoTlnLrmma/vvIzlkI7nu63mlK/mjIHnu4TlkIjooajljZXnu5/kuIDkv53lrZjml7blho3kv67mlLlcclxuICAgIGlmIChuYW1lc3BhY2UgIT09IG51bGwpIHtcclxuICAgICAgLy8g5a2Y5Zyo5ZG95ZCN56m66Ze077yM6K+05piO6KGo5Y2V6L6D5paw77yM5Y+v5Lul5L6d6LWW6K+l54m55oCnXHJcbiAgICAgIGZyYW1lQ29udGV4dHMgPSB0aGlzLmZyYW1lQ29udGV4dC5hcHBDb250ZXh0LmZyYW1lQ29udGV4dE1hbmFnZXIuZ2V0RnJhbWVDb250ZXh0c0J5TmFtZXNwYWNlKG5hbWVzcGFjZSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvLyDooajljZXovoPogIHvvIzojrflj5bmiYDmnInnmoTkuIrkuIvmlofvvIzlnKjmoKHpqozpmLbmrrXov4fmu6Top4TliJlcclxuICAgICAgZnJhbWVDb250ZXh0cyA9IHRoaXMuZnJhbWVDb250ZXh0LmFwcENvbnRleHQuZnJhbWVDb250ZXh0TWFuYWdlci5nZXRGcmFtZUNvbnRleHRzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgaXNNb2RhbCA9IHRoaXMuaXNJbkRpYWxvZygpO1xyXG4gICAgY29uc3QgaGFzT3duVmVyaWZ5RGV0YWlsU2VydmljZSA9IHRoaXMuaGFzT3duVmVyaWZ5RGV0YWlsU2VydmljZSgpO1xyXG4gICAgbGV0IHJvb3RWaWV3TW9kZWwgPSB0aGlzLmZyYW1lQ29udGV4dC5yb290LnZpZXdNb2RlbDtcclxuICAgIGlmIChpc01vZGFsICYmIGhhc093blZlcmlmeURldGFpbFNlcnZpY2UpIHtcclxuICAgICAgcm9vdFZpZXdNb2RlbCA9IHRoaXMuZnJhbWVDb250ZXh0LmdldFZpcnR1YWxSb290RnJhbWVDb250ZXh0KCkudmlld01vZGVsO1xyXG4gICAgfVxyXG5cclxuICAgIGxldCB0b1ZhbGlkYXRlID0gZmFsc2U7XHJcbiAgICBjb25zdCBmb3JtRXJyb3JzID0gW107XHJcbiAgICBmcmFtZUNvbnRleHRzLmZvckVhY2goKGZyYW1lQ29udGV4dDogRnJhbWVDb250ZXh0KSA9PiB7XHJcbiAgICAgIGlmIChmcmFtZUNvbnRleHQuZm9ybSAmJiBmcmFtZUNvbnRleHQuZm9ybS5lbmFibGVWYWxpZGF0ZSkge1xyXG4gICAgICAgIHRvVmFsaWRhdGUgPSB0cnVlO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIGlmICghdG9WYWxpZGF0ZSB8fCBlbnRpdGllcy5sZW5ndGggPCAxKSB7XHJcbiAgICAgIHJldHVybiBvZih0cnVlKTtcclxuICAgIH1cclxuICAgIHJvb3RWaWV3TW9kZWwudmVyaWZ5SW5mb3JtYXRpb25zID0gW107XHJcbiAgICBsZXQgZm9ybVZhbGlkID0gdHJ1ZTtcclxuICAgIGxldCBlbnRpdHlWYWxpZCA9IHRydWU7XHJcbiAgICBjb25zdCBmb3JtVmFsaWRhdGlvblJ1bGVzID0gbmV3IE1hcDxzdHJpbmcsIFZhbGlkYXRlUnVsZVtdPigpO1xyXG4gICAgZnJhbWVDb250ZXh0cy5mb3JFYWNoKChmb3JtQ29udGV4dDogRnJhbWVDb250ZXh0KSA9PiB7XHJcbiAgICAgIGNvbnN0IGJpbmRpbmdPYmplY3QgPSBmb3JtQ29udGV4dC5iaW5kaW5nRGF0YS5nZXRPYmplY3QoKTtcclxuICAgICAgLy8g6YCa55+l5omA5pyJYmluZGluZ0RhdGEsXHJcbiAgICAgIGJpbmRpbmdPYmplY3QgJiYgYmluZGluZ09iamVjdC5zZXRTaG93VmFsaWRhdGlvbk1zZyh0cnVlKTtcclxuICAgICAgaWYgKGZvcm1Db250ZXh0LmZvcm0gJiYgZm9ybUNvbnRleHQuZm9ybS5lbmFibGVWYWxpZGF0ZSkge1xyXG4gICAgICAgIC8vIOiOt+WPluW9k+WJjeihqOWNleS4iueahOaJgOaciemqjOivgeinhOWImVxyXG4gICAgICAgIGNvbnN0IGN1cnJlbnRGb3JtVmFsaWRhdGlvblJ1bGVzID0gZm9ybUNvbnRleHQuZm9ybS5nZXRWYWxpZGF0aW9uUnVsZXMoKTtcclxuICAgICAgICBjdXJyZW50Rm9ybVZhbGlkYXRpb25SdWxlcy5mb3JFYWNoKChydWxlcywgcGF0aCkgPT4ge1xyXG4gICAgICAgICAgaWYgKGZvcm1WYWxpZGF0aW9uUnVsZXMuaGFzKHBhdGgpKSB7XHJcbiAgICAgICAgICAgIHJ1bGVzLmZvckVhY2gocnVsZSA9PiBmb3JtVmFsaWRhdGlvblJ1bGVzLmdldChwYXRoKS5wdXNoKHJ1bGUpKTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGZvcm1WYWxpZGF0aW9uUnVsZXMuc2V0KHBhdGgsIFsuLi5ydWxlc10pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGZvcm1Db250ZXh0LmZvcm0uc2V0U2hvd1ZhbGlkYXRpb25Nc2codHJ1ZSk7XHJcbiAgICAgICAgLy8g6YCQ5Liq6LCD55So6KGo5Y2V55qE6aqM6K+B77yM6aqM6K+B5YmN56uv6KGo5Y2V6KeE5YiZXHJcbiAgICAgICAgaWYgKCFmb3JtQ29udGV4dC5mb3JtLmlzRm9ybVZhbGlkKCkpIHtcclxuICAgICAgICAgIGZvcm1FcnJvcnMucHVzaChmb3JtQ29udGV4dC5mb3JtKTtcclxuICAgICAgICAgIGZvcm1WYWxpZCA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8g6aqM6K+B5omA5pyJ5a6e5L2TXHJcbiAgICBjb25zdCBvYnNlcnZhYmxlTGlzdCA9IGVudGl0aWVzLm1hcCgoZW50aXR5OiBFbnRpdHkpID0+IHtcclxuICAgICAgY29uc3QgaW5kZXggPSB0aGlzLmZyYW1lQ29udGV4dC5iaW5kaW5nRGF0YS5saXN0LmdldEluZGV4QnlJZChlbnRpdHkucHJpbWFyeVZhbHVlKTtcclxuICAgICAgcmV0dXJuIGVudGl0eS52YWxpZGF0ZSh1bmRlZmluZWQsIHVuZGVmaW5lZCwgZm9ybVZhbGlkYXRpb25SdWxlcywgbnVsbCwgdGhpcy5mcmFtZUNvbnRleHQpO1xyXG4gICAgfSk7XHJcbiAgICBjb25zdCByZXN1bHQkID0gemlwKC4uLm9ic2VydmFibGVMaXN0KS5waXBlKFxyXG4gICAgICB0YXAoKHJlc3VsdExpc3QpID0+IHtcclxuICAgICAgICBmcmFtZUNvbnRleHRzLmZvckVhY2goKGZvcm1Db250ZXh0OiBGcmFtZUNvbnRleHQpID0+IHtcclxuICAgICAgICAgIGlmICghZm9ybUNvbnRleHQuZm9ybS5lbmFibGVWYWxpZGF0ZSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBjb25zdCBoYW5kbGVFcnJvcnMgPSAoZXJyb3JzOiBWYWxpZGF0aW9uRXJyb3JbXSkgPT4ge1xyXG4gICAgICAgICAgICBlcnJvcnMuZm9yRWFjaCgodmFsaWRhdGlvbkVycm9yOiBWYWxpZGF0aW9uRXJyb3IpID0+IHtcclxuICAgICAgICAgICAgICBpZiAodmFsaWRhdGlvbkVycm9yLmNoaWxkcmVuICYmIHZhbGlkYXRpb25FcnJvci5jaGlsZHJlbi5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIGhhbmRsZUVycm9ycyh2YWxpZGF0aW9uRXJyb3IuY2hpbGRyZW4pO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBjb25zdCBlcnJNc2dPYmogPSB7fTtcclxuICAgICAgICAgICAgICBsZXQgaWQgPSAnJztcclxuICAgICAgICAgICAgICBjb25zdCBmaW5kSWQgPSAodGFyZ2V0OiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmICh0YXJnZXQgJiYgdGFyZ2V0LmRhdGEgJiYgdGFyZ2V0LmRhdGEuaWQpIHtcclxuICAgICAgICAgICAgICAgICAgaWQgPSB0YXJnZXQuZGF0YS5pZDtcclxuICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0YXJnZXRbUEFSRU5UX0NMQVNTXSkge1xyXG4gICAgICAgICAgICAgICAgICBmaW5kSWQodGFyZ2V0W1BBUkVOVF9DTEFTU10pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgZmluZElkKHZhbGlkYXRpb25FcnJvci50YXJnZXQpO1xyXG5cclxuICAgICAgICAgICAgICAvLyDlrp7kvZPpqozor4Hlh7rplJnvvIzpnIDopoHlsIbplJnor6/lsZXnpLrliLDnlYzpnaLkuIpcclxuICAgICAgICAgICAgICAvLyDlrp7kvZPkuI3kuIDlrprmmK/lvZPliY3ooYxcclxuICAgICAgICAgICAgICBsZXQgcGFyZW50UGF0aERhdGEgPSB7XHJcbiAgICAgICAgICAgICAgICBwYXRoOiBbXSxcclxuICAgICAgICAgICAgICAgIGlzVWR0OiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIGlzR3JpZDogZmFsc2VcclxuICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgIGlmICh2YWxpZGF0aW9uRXJyb3IudGFyZ2V0KSB7XHJcbiAgICAgICAgICAgICAgICBwYXJlbnRQYXRoRGF0YSA9IHZhbGlkYXRpb25FcnJvci50YXJnZXQuZ2V0UGF0aHMoKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgY29uc3QgYmluZGluZ1BhdGggPSAnLycgKyBwYXJlbnRQYXRoRGF0YS5wYXRoLmpvaW4oJy8nKTtcclxuICAgICAgICAgICAgICBpZiAodmFsaWRhdGlvbkVycm9yLmNvbnN0cmFpbnRzKSB7XHJcbiAgICAgICAgICAgICAgICBPYmplY3Qua2V5cyh2YWxpZGF0aW9uRXJyb3IuY29uc3RyYWludHMpLmZvckVhY2goa2V5ID0+IHtcclxuICAgICAgICAgICAgICAgICAgZXJyTXNnT2JqW2tleV0gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogdmFsaWRhdGlvbkVycm9yLmNvbnN0cmFpbnRzW2tleV1cclxuICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgLy8gaWYgKHRoaXMuZnJhbWVDb250ZXh0LnZpZXdNb2RlbC5iaW5kaW5nUGF0aCA9PT0gYmluZGluZ1BhdGgpIHtcclxuICAgICAgICAgICAgICAgICAgLy8gICByb290Vmlld01vZGVsWyd2ZXJpZnlJbmZvcm1hdGlvbnMnXS5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgLy8gICAgIGlkOiBpZCxcclxuICAgICAgICAgICAgICAgICAgLy8gICAgIHRpdGxlOiBrZXksXHJcbiAgICAgICAgICAgICAgICAgIC8vICAgICBtc2c6IHZhbGlkYXRpb25FcnJvci5jb25zdHJhaW50c1trZXldLFxyXG4gICAgICAgICAgICAgICAgICAvLyAgICAgdHlwZTogJ3dhcm4nXHJcbiAgICAgICAgICAgICAgICAgIC8vICAgfSlcclxuICAgICAgICAgICAgICAgICAgLy8gfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIGNvbnN0IHBhdGhzID0gcGFyZW50UGF0aERhdGEucGF0aC5jb25jYXQodmFsaWRhdGlvbkVycm9yLnByb3BlcnR5KTtcclxuXHJcbiAgICAgICAgICAgICAgLy9pZiAodGhpcy5mcmFtZUNvbnRleHQudmlld01vZGVsLmJpbmRpbmdQYXRoID09PSBiaW5kaW5nUGF0aCkge1xyXG4gICAgICAgICAgICAgIC8vIOWwhumUmeivr+S/oeaBr+abtOaWsOWIsGZvcm1Db250cm9s5LiKXHJcbiAgICAgICAgICAgICAgZm9ybUNvbnRleHQuYmluZGluZ0RhdGEuY2hhbmdlcy5uZXh0KHtcclxuICAgICAgICAgICAgICAgIHR5cGU6IENoYW5nZVR5cGUuVXBkYXRlRXJyb3JzLFxyXG4gICAgICAgICAgICAgICAgaWQsXHJcbiAgICAgICAgICAgICAgICBwYXRoOiBwYXRocyxcclxuICAgICAgICAgICAgICAgIGlzVWR0OiBwYXJlbnRQYXRoRGF0YS5pc1VkdCxcclxuICAgICAgICAgICAgICAgIGlzR3JpZDogcGFyZW50UGF0aERhdGEuaXNHcmlkLFxyXG4gICAgICAgICAgICAgICAgdmFsdWU6IHZhbGlkYXRpb25FcnJvci52YWx1ZSxcclxuICAgICAgICAgICAgICAgIGVycm9yczogZXJyTXNnT2JqXHJcbiAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgLy99XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfTtcclxuICAgICAgICAgIC8vIOWxleW8gOmqjOivgee7k+aenFxyXG4gICAgICAgICAgY29uc3QgaXNWYWxpZExpc3QgPSByZXN1bHRMaXN0Lm1hcCgocmVzdWx0OiBWYWxpZGF0aW9uUmVzdWx0KSA9PiByZXN1bHQuaXNWYWxpZCk7XHJcbiAgICAgICAgICAvLyDkv53lrZjliY3lhYjosIPnlKjlrp7kvZPkuIrnmoTpqozor4Hop4TliJnvvIzlhajpg6jpgJrov4fkuYvlkI7miY3kv53lrZhcclxuICAgICAgICAgIC8vIOWunuS9k+mqjOivgemAmui/h1xyXG4gICAgICAgICAgaWYgKGlzVmFsaWRMaXN0LmZpbHRlcih4ID0+IHgpLmxlbmd0aCA9PT0gb2JzZXJ2YWJsZUxpc3QubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIC8vIOWwhumUmeivr+S/oeaBr+abtOaWsOWIsGZvcm1Db250cm9s5LiKXHJcbiAgICAgICAgICAgIGZvcm1Db250ZXh0LmJpbmRpbmdEYXRhLmNoYW5nZXMubmV4dCh7XHJcbiAgICAgICAgICAgICAgdHlwZTogQ2hhbmdlVHlwZS5VcGRhdGVFcnJvcnMsXHJcbiAgICAgICAgICAgICAgcGF0aDogW11cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIC8vIOmqjOivgeaIkOWKn+WQjumakOiXj+i+k+WFpeaXtueahOmqjOivgVxyXG4gICAgICAgICAgICBpZiAoZm9ybVZhbGlkKSB7XHJcbiAgICAgICAgICAgICAgY29uc3QgYmluZGluZ09iamVjdCA9IGZvcm1Db250ZXh0LmJpbmRpbmdEYXRhLmdldE9iamVjdCgpO1xyXG4gICAgICAgICAgICAgIGJpbmRpbmdPYmplY3QgJiYgYmluZGluZ09iamVjdC5zZXRTaG93VmFsaWRhdGlvbk1zZyhmYWxzZSk7XHJcbiAgICAgICAgICAgICAgY29uc3QgZm9ybSA9IGZvcm1Db250ZXh0LmZvcm07XHJcbiAgICAgICAgICAgICAgaWYgKGZvcm0pIHtcclxuICAgICAgICAgICAgICAgIGZvcm0uc2V0U2hvd1ZhbGlkYXRpb25Nc2coZmFsc2UpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8g5a6e5L2T6aqM6K+B5pyJ6ZSZ6K+vXHJcbiAgICAgICAgICAgIGVudGl0eVZhbGlkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHJlc3VsdExpc3QuZm9yRWFjaCgocmVzdWx0OiBWYWxpZGF0aW9uUmVzdWx0KSA9PiB7XHJcbiAgICAgICAgICAgICAgaWYgKHJlc3VsdC5pc1ZhbGlkKSB7XHJcbiAgICAgICAgICAgICAgICAvLyDmuIXpmaTpqozor4HpgJrov4fnmoTplJnor69cclxuICAgICAgICAgICAgICAgIGZvcm1Db250ZXh0LmJpbmRpbmdEYXRhLmNoYW5nZXMubmV4dCh7XHJcbiAgICAgICAgICAgICAgICAgIHR5cGU6IENoYW5nZVR5cGUuVXBkYXRlRXJyb3JzLFxyXG4gICAgICAgICAgICAgICAgICBwYXRoOiBbXVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGhhbmRsZUVycm9ycyhyZXN1bHQuZXJyb3JzKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KSxcclxuICAgICAgc3dpdGNoTWFwKChyZXN1bHRMaXN0KSA9PiB7XHJcbiAgICAgICAgbGV0IGlzVmFsaWRhdGVkID0gdHJ1ZTtcclxuICAgICAgICBjb25zdCBlcnJvcnMgPSBbXTtcclxuICAgICAgICByZXN1bHRMaXN0LmZvckVhY2goKHJlc3VsdDogVmFsaWRhdGlvblJlc3VsdCkgPT4ge1xyXG4gICAgICAgICAgaWYgKCFyZXN1bHQuaXNWYWxpZCkge1xyXG4gICAgICAgICAgICBpc1ZhbGlkYXRlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgZXJyb3JzLnB1c2goLi4ucmVzdWx0LmVycm9ycyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgaWYgKGVycm9ycy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICB0aGlzLmNvbGxlY3RWYWxpZGF0aW9uRXJyb3JzKHJvb3RWaWV3TW9kZWwsIGVycm9ycywgdGhpcy5mcmFtZUNvbnRleHQubmFtZXNwYWNlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gcm9vdFZpZXdNb2RlbC52ZXJpZnljYXRpb25DaGFuZ2VkLm5leHQocm9vdFZpZXdNb2RlbC52ZXJpZnlJbmZvcm1hdGlvbnMpO1xyXG4gICAgICAgIGxldCB2ZXJpZnlJbmZvcm1hdGlvbnMgPSByb290Vmlld01vZGVsLnZlcmlmeUluZm9ybWF0aW9ucztcclxuICAgICAgICBpZiAoaXNNb2RhbCAmJiBoYXNPd25WZXJpZnlEZXRhaWxTZXJ2aWNlKSB7XHJcbiAgICAgICAgICB2ZXJpZnlJbmZvcm1hdGlvbnMgPSByb290Vmlld01vZGVsLnZlcmlmeUluZm9ybWF0aW9ucy5maWx0ZXIoaXRlbSA9PiBpdGVtLm5hbWVzcGFjZSA9PT0gbmFtZXNwYWNlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcm9vdFZpZXdNb2RlbC52ZXJpZnljYXRpb25DaGFuZ2VkLm5leHQodmVyaWZ5SW5mb3JtYXRpb25zKTtcclxuICAgICAgICBpZiAoaXNWYWxpZGF0ZWQgJiYgIWZvcm1WYWxpZCkge1xyXG4gICAgICAgICAgLy8g5a6e5L2T5qCh6aqM6YCa6L+H5L2G6KGo5Y2V5qCh6aqM5LiN6YCa6L+H77yM5q2k5pe25a6e5L2T5ZKM6KGo5Y2V5a2Y5Zyo5qCh6aqM6KeE5YiZ5LiN5LiA6Ie055qE5oOF5Ya1XHJcbiAgICAgICAgICBjb25zb2xlLndhcm4oJ+WunuS9k+WSjOaOp+S7tuagoemqjOinhOWImeS4jeS4gOiHtO+8jOS8muWvvOiHtOWRveS7pOaJp+ihjOS4reaWre+8gScpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoaXNWYWxpZGF0ZWQgJiYgZm9ybVZhbGlkKSB7XHJcbiAgICAgICAgICByZXR1cm4gb2YodHJ1ZSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHJldHVybiBlbXB0eSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgICByZXR1cm4gcmVzdWx0JDtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6LCD55So6KGo5Y2V5ZKM5a6e5L2T5LiK55qE6aqM6K+B6KeE5YiZLCDpgJrov4flkI7osIPnlKjlm57osINjYlxyXG4gICAqL1xyXG4gIHZhbGlkYXRlQWxsKCk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBjb25zdCBlbnRpdHlUeXBlSW5mbyA9IHRoaXMucmVwb3NpdG9yeS5lbnRpdHlUeXBlSW5mbztcclxuICAgIC8vIOe7hOWQiOihqOWNleWPquagoemqjOW9k+WJjeaMiemSruaJgOWcqOeahOihqOWNlVxyXG4gICAgY29uc3QgZW50aXRpZXM6IEVudGl0eVtdID0gdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24uZ2V0QWxsRW50aXRpZXMoKTtcclxuICAgIGNvbnN0IG5hbWVzcGFjZSA9IHRoaXMuZnJhbWVDb250ZXh0Lm5hbWVzcGFjZTtcclxuICAgIGxldCBmcmFtZUNvbnRleHRzID0gW107XHJcbiAgICBpZiAobmFtZXNwYWNlICE9PSBudWxsKSB7XHJcbiAgICAgIC8vIOWtmOWcqOWRveWQjeepuumXtO+8jOivtOaYjuihqOWNlei+g+aWsO+8jOWPr+S7peS+nei1luivpeeJueaAp1xyXG4gICAgICBmcmFtZUNvbnRleHRzID0gdGhpcy5mcmFtZUNvbnRleHQuYXBwQ29udGV4dC5mcmFtZUNvbnRleHRNYW5hZ2VyLmdldEZyYW1lQ29udGV4dHNCeU5hbWVzcGFjZShuYW1lc3BhY2UpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8g6KGo5Y2V6L6D6ICB77yM6I635Y+W5omA5pyJ55qE5LiK5LiL5paH77yM5Zyo5qCh6aqM6Zi25q616L+H5ruk6KeE5YiZXHJcbiAgICAgIGZyYW1lQ29udGV4dHMgPSB0aGlzLmZyYW1lQ29udGV4dC5hcHBDb250ZXh0LmZyYW1lQ29udGV4dE1hbmFnZXIuZ2V0RnJhbWVDb250ZXh0cygpO1xyXG4gICAgfVxyXG4gICAgY29uc3QgaXNFbnRpdHlWYWxpZCA9IHRoaXMudmFsaWRhdGVFbnRpdHlBbGxvd0VtcHR5UnVsZShlbnRpdHlUeXBlSW5mbyk7XHJcbiAgICBpZiAoIWlzRW50aXR5VmFsaWQpIHtcclxuICAgICAgcmV0dXJuIEVNUFRZO1xyXG4gICAgfVxyXG4gICAgbGV0IHRvVmFsaWRhdGUgPSBmYWxzZTtcclxuICAgIGNvbnN0IGZvcm1FcnJvcnMgPSBbXTtcclxuICAgIGZyYW1lQ29udGV4dHMuZm9yRWFjaCgoZnJhbWVDb250ZXh0OiBGcmFtZUNvbnRleHQpID0+IHtcclxuICAgICAgaWYgKGZyYW1lQ29udGV4dC5mb3JtICYmIGZyYW1lQ29udGV4dC5mb3JtLmVuYWJsZVZhbGlkYXRlKSB7XHJcbiAgICAgICAgdG9WYWxpZGF0ZSA9IHRydWU7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgaWYgKCF0b1ZhbGlkYXRlIHx8IGVudGl0aWVzLmxlbmd0aCA8IDEpIHtcclxuICAgICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gICAgfVxyXG4gICAgY29uc3QgaXNNb2RhbCA9IHRoaXMuaXNJbkRpYWxvZygpO1xyXG4gICAgY29uc3QgaGFzT3duVmVyaWZ5RGV0YWlsU2VydmljZSA9IHRoaXMuaGFzT3duVmVyaWZ5RGV0YWlsU2VydmljZSgpO1xyXG4gICAgbGV0IHJvb3RWaWV3TW9kZWwgPSB0aGlzLmZyYW1lQ29udGV4dC5yb290LnZpZXdNb2RlbDtcclxuICAgIGlmIChpc01vZGFsICYmIGhhc093blZlcmlmeURldGFpbFNlcnZpY2UpIHtcclxuICAgICAgcm9vdFZpZXdNb2RlbCA9IHRoaXMuZnJhbWVDb250ZXh0LmdldFZpcnR1YWxSb290RnJhbWVDb250ZXh0KCkudmlld01vZGVsO1xyXG4gICAgfVxyXG5cclxuICAgIGxldCBmb3JtVmFsaWQgPSB0cnVlO1xyXG4gICAgbGV0IGVudGl0eVZhbGlkID0gdHJ1ZTtcclxuICAgIGNvbnN0IGZvcm1WYWxpZGF0aW9uUnVsZXMgPSBuZXcgTWFwPHN0cmluZywgVmFsaWRhdGVSdWxlW10+KCk7XHJcbiAgICBmcmFtZUNvbnRleHRzLmZvckVhY2goKGZvcm1Db250ZXh0OiBGcmFtZUNvbnRleHQpID0+IHtcclxuICAgICAgY29uc3QgYmluZGluZ09iamVjdCA9IGZvcm1Db250ZXh0LmJpbmRpbmdEYXRhLmdldE9iamVjdCgpO1xyXG4gICAgICAvLyDpgJrnn6XmiYDmnIliaW5kaW5nRGF0YSxcclxuICAgICAgYmluZGluZ09iamVjdCAmJiBiaW5kaW5nT2JqZWN0LnNldFNob3dWYWxpZGF0aW9uTXNnKHRydWUpO1xyXG4gICAgICBpZiAoZm9ybUNvbnRleHQuZm9ybSAmJiBmb3JtQ29udGV4dC5mb3JtLmVuYWJsZVZhbGlkYXRlKSB7XHJcbiAgICAgICAgLy8g6I635Y+W5b2T5YmN6KGo5Y2V5LiK55qE5omA5pyJ6aqM6K+B6KeE5YiZXHJcbiAgICAgICAgY29uc3QgY3VycmVudEZvcm1WYWxpZGF0aW9uUnVsZXMgPSBmb3JtQ29udGV4dC5mb3JtLmdldFZhbGlkYXRpb25SdWxlcygpO1xyXG4gICAgICAgIGN1cnJlbnRGb3JtVmFsaWRhdGlvblJ1bGVzLmZvckVhY2goKHJ1bGVzLCBwYXRoKSA9PiB7XHJcbiAgICAgICAgICBpZiAoZm9ybVZhbGlkYXRpb25SdWxlcy5oYXMocGF0aCkpIHtcclxuICAgICAgICAgICAgcnVsZXMuZm9yRWFjaChydWxlID0+IGZvcm1WYWxpZGF0aW9uUnVsZXMuZ2V0KHBhdGgpLnB1c2gocnVsZSkpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgZm9ybVZhbGlkYXRpb25SdWxlcy5zZXQocGF0aCwgWy4uLnJ1bGVzXSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgZm9ybUNvbnRleHQuZm9ybS5zZXRTaG93VmFsaWRhdGlvbk1zZyh0cnVlKTtcclxuICAgICAgICAvLyDpgJDkuKrosIPnlKjooajljZXnmoTpqozor4HvvIzpqozor4HliY3nq6/ooajljZXop4TliJlcclxuICAgICAgICBpZiAoIWZvcm1Db250ZXh0LmZvcm0uaXNGb3JtVmFsaWQoKSkge1xyXG4gICAgICAgICAgZm9ybUVycm9ycy5wdXNoKGZvcm1Db250ZXh0LmZvcm0pO1xyXG4gICAgICAgICAgZm9ybVZhbGlkID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIC8vIOinpuWPkeaJgOacieWunuS9k+eahHZhbGlkYXRl5LqL5Lu2XHJcbiAgICBjb25zdCBpc011bHRpRW50aXR5VmFsaWF0ZSA9IGVudGl0aWVzLmxlbmd0aCA+IDA7XHJcblxyXG4gICAgLy8g6aqM6K+B5omA5pyJ5a6e5L2TXHJcbiAgICBjb25zdCBvYnNlcnZhYmxlTGlzdCA9IGVudGl0aWVzLm1hcCgoZW50aXR5OiBFbnRpdHksIGluZGV4OiBudW1iZXIpID0+XHJcbiAgICAgIGVudGl0eS52YWxpZGF0ZSh1bmRlZmluZWQsIHVuZGVmaW5lZCwgZm9ybVZhbGlkYXRpb25SdWxlcywgaXNNdWx0aUVudGl0eVZhbGlhdGUgPyBpbmRleCA6IG51bGwsIHRoaXMuZnJhbWVDb250ZXh0KSk7XHJcbiAgICBjb25zdCByZXN1bHQkID0gemlwKC4uLm9ic2VydmFibGVMaXN0KS5waXBlKFxyXG4gICAgICB0YXAoKHJlc3VsdExpc3QpID0+IHtcclxuICAgICAgICBmcmFtZUNvbnRleHRzLmZvckVhY2goKGZvcm1Db250ZXh0OiBGcmFtZUNvbnRleHQpID0+IHtcclxuICAgICAgICAgIGlmICghZm9ybUNvbnRleHQuZm9ybS5lbmFibGVWYWxpZGF0ZSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBjb25zdCBoYW5kbGVFcnJvcnMgPSAoZXJyb3JzOiBWYWxpZGF0aW9uRXJyb3JbXSkgPT4ge1xyXG4gICAgICAgICAgICBlcnJvcnMuZm9yRWFjaCgodmFsaWRhdGlvbkVycm9yOiBWYWxpZGF0aW9uRXJyb3IpID0+IHtcclxuICAgICAgICAgICAgICBpZiAodmFsaWRhdGlvbkVycm9yLmNoaWxkcmVuICYmIHZhbGlkYXRpb25FcnJvci5jaGlsZHJlbi5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIGhhbmRsZUVycm9ycyh2YWxpZGF0aW9uRXJyb3IuY2hpbGRyZW4pO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBjb25zdCBlcnJNc2dPYmogPSB7fTtcclxuICAgICAgICAgICAgICBsZXQgaWQgPSAnJztcclxuICAgICAgICAgICAgICBjb25zdCBmaW5kSWQgPSAodGFyZ2V0OiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmICh0YXJnZXQgJiYgdGFyZ2V0LmRhdGEgJiYgdGFyZ2V0LmRhdGEuaWQpIHtcclxuICAgICAgICAgICAgICAgICAgaWQgPSB0YXJnZXQuZGF0YS5pZDtcclxuICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0YXJnZXRbUEFSRU5UX0NMQVNTXSkge1xyXG4gICAgICAgICAgICAgICAgICBmaW5kSWQodGFyZ2V0W1BBUkVOVF9DTEFTU10pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgZmluZElkKHZhbGlkYXRpb25FcnJvci50YXJnZXQpO1xyXG5cclxuICAgICAgICAgICAgICAvLyDlrp7kvZPpqozor4Hlh7rplJnvvIzpnIDopoHlsIbplJnor6/lsZXnpLrliLDnlYzpnaLkuIpcclxuICAgICAgICAgICAgICAvLyDlrp7kvZPkuI3kuIDlrprmmK/lvZPliY3ooYxcclxuICAgICAgICAgICAgICBsZXQgcGFyZW50UGF0aERhdGEgPSB7XHJcbiAgICAgICAgICAgICAgICBwYXRoOiBbXSxcclxuICAgICAgICAgICAgICAgIGlzVWR0OiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIGlzR3JpZDogZmFsc2VcclxuICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgIGlmICh2YWxpZGF0aW9uRXJyb3IudGFyZ2V0KSB7XHJcbiAgICAgICAgICAgICAgICBwYXJlbnRQYXRoRGF0YSA9IHZhbGlkYXRpb25FcnJvci50YXJnZXQuZ2V0UGF0aHMoKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgY29uc3QgYmluZGluZ1BhdGggPSAnLycgKyBwYXJlbnRQYXRoRGF0YS5wYXRoLmpvaW4oJy8nKTtcclxuICAgICAgICAgICAgICBpZiAodmFsaWRhdGlvbkVycm9yLmNvbnN0cmFpbnRzKSB7XHJcbiAgICAgICAgICAgICAgICBPYmplY3Qua2V5cyh2YWxpZGF0aW9uRXJyb3IuY29uc3RyYWludHMpLmZvckVhY2goa2V5ID0+IHtcclxuICAgICAgICAgICAgICAgICAgZXJyTXNnT2JqW2tleV0gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogdmFsaWRhdGlvbkVycm9yLmNvbnN0cmFpbnRzW2tleV1cclxuICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgLy8gaWYgKHRoaXMuZnJhbWVDb250ZXh0LnZpZXdNb2RlbC5iaW5kaW5nUGF0aCA9PT0gYmluZGluZ1BhdGgpIHtcclxuICAgICAgICAgICAgICAgICAgLy8gICByb290Vmlld01vZGVsWyd2ZXJpZnlJbmZvcm1hdGlvbnMnXS5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgLy8gICAgIGlkOiBpZCxcclxuICAgICAgICAgICAgICAgICAgLy8gICAgIHRpdGxlOiBrZXksXHJcbiAgICAgICAgICAgICAgICAgIC8vICAgICBtc2c6IHZhbGlkYXRpb25FcnJvci5jb25zdHJhaW50c1trZXldLFxyXG4gICAgICAgICAgICAgICAgICAvLyAgICAgdHlwZTogJ3dhcm4nXHJcbiAgICAgICAgICAgICAgICAgIC8vICAgfSlcclxuICAgICAgICAgICAgICAgICAgLy8gfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIGNvbnN0IHBhdGhzID0gcGFyZW50UGF0aERhdGEucGF0aC5jb25jYXQodmFsaWRhdGlvbkVycm9yLnByb3BlcnR5KTtcclxuXHJcbiAgICAgICAgICAgICAgLy9pZiAodGhpcy5mcmFtZUNvbnRleHQudmlld01vZGVsLmJpbmRpbmdQYXRoID09PSBiaW5kaW5nUGF0aCkge1xyXG4gICAgICAgICAgICAgIC8vIOWwhumUmeivr+S/oeaBr+abtOaWsOWIsGZvcm1Db250cm9s5LiKXHJcbiAgICAgICAgICAgICAgZm9ybUNvbnRleHQuYmluZGluZ0RhdGEuY2hhbmdlcy5uZXh0KHtcclxuICAgICAgICAgICAgICAgIHR5cGU6IENoYW5nZVR5cGUuVXBkYXRlRXJyb3JzLFxyXG4gICAgICAgICAgICAgICAgaWQsXHJcbiAgICAgICAgICAgICAgICBwYXRoOiBwYXRocyxcclxuICAgICAgICAgICAgICAgIGlzVWR0OiBwYXJlbnRQYXRoRGF0YS5pc1VkdCxcclxuICAgICAgICAgICAgICAgIGlzR3JpZDogcGFyZW50UGF0aERhdGEuaXNHcmlkLFxyXG4gICAgICAgICAgICAgICAgdmFsdWU6IHZhbGlkYXRpb25FcnJvci52YWx1ZSxcclxuICAgICAgICAgICAgICAgIGVycm9yczogZXJyTXNnT2JqXHJcbiAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgLy99XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfTtcclxuICAgICAgICAgIC8vIOWxleW8gOmqjOivgee7k+aenFxyXG4gICAgICAgICAgY29uc3QgaXNWYWxpZExpc3QgPSByZXN1bHRMaXN0Lm1hcCgocmVzdWx0OiBWYWxpZGF0aW9uUmVzdWx0KSA9PiByZXN1bHQuaXNWYWxpZCk7XHJcbiAgICAgICAgICAvLyDkv53lrZjliY3lhYjosIPnlKjlrp7kvZPkuIrnmoTpqozor4Hop4TliJnvvIzlhajpg6jpgJrov4fkuYvlkI7miY3kv53lrZhcclxuICAgICAgICAgIC8vIOWunuS9k+mqjOivgemAmui/h1xyXG4gICAgICAgICAgaWYgKGlzVmFsaWRMaXN0LmZpbHRlcih4ID0+IHgpLmxlbmd0aCA9PT0gb2JzZXJ2YWJsZUxpc3QubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIC8vIOWwhumUmeivr+S/oeaBr+abtOaWsOWIsGZvcm1Db250cm9s5LiKXHJcbiAgICAgICAgICAgIGZvcm1Db250ZXh0LmJpbmRpbmdEYXRhLmNoYW5nZXMubmV4dCh7XHJcbiAgICAgICAgICAgICAgdHlwZTogQ2hhbmdlVHlwZS5VcGRhdGVFcnJvcnMsXHJcbiAgICAgICAgICAgICAgcGF0aDogW11cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIC8vIOmqjOivgeaIkOWKn+WQjumakOiXj+i+k+WFpeaXtueahOmqjOivgVxyXG4gICAgICAgICAgICBpZiAoZm9ybVZhbGlkKSB7XHJcbiAgICAgICAgICAgICAgY29uc3QgYmluZGluZ09iamVjdCA9IGZvcm1Db250ZXh0LmJpbmRpbmdEYXRhLmdldE9iamVjdCgpO1xyXG4gICAgICAgICAgICAgIGJpbmRpbmdPYmplY3QgJiYgYmluZGluZ09iamVjdC5zZXRTaG93VmFsaWRhdGlvbk1zZyhmYWxzZSk7XHJcbiAgICAgICAgICAgICAgY29uc3QgZm9ybSA9IGZvcm1Db250ZXh0LmZvcm07XHJcbiAgICAgICAgICAgICAgaWYgKGZvcm0pIHtcclxuICAgICAgICAgICAgICAgIGZvcm0uc2V0U2hvd1ZhbGlkYXRpb25Nc2coZmFsc2UpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8g5a6e5L2T6aqM6K+B5pyJ6ZSZ6K+vXHJcbiAgICAgICAgICAgIGVudGl0eVZhbGlkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHJlc3VsdExpc3QuZm9yRWFjaCgocmVzdWx0OiBWYWxpZGF0aW9uUmVzdWx0KSA9PiB7XHJcbiAgICAgICAgICAgICAgaWYgKHJlc3VsdC5pc1ZhbGlkKSB7XHJcbiAgICAgICAgICAgICAgICAvLyDmuIXpmaTpqozor4HpgJrov4fnmoTplJnor69cclxuICAgICAgICAgICAgICAgIGZvcm1Db250ZXh0LmJpbmRpbmdEYXRhLmNoYW5nZXMubmV4dCh7XHJcbiAgICAgICAgICAgICAgICAgIHR5cGU6IENoYW5nZVR5cGUuVXBkYXRlRXJyb3JzLFxyXG4gICAgICAgICAgICAgICAgICBwYXRoOiBbXVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGhhbmRsZUVycm9ycyhyZXN1bHQuZXJyb3JzKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KSxcclxuICAgICAgc3dpdGNoTWFwKChyZXN1bHRMaXN0KSA9PiB7XHJcbiAgICAgICAgbGV0IGlzVmFsaWRhdGVkID0gdHJ1ZTtcclxuICAgICAgICBjb25zdCBlcnJvcnMgPSBbXTtcclxuICAgICAgICByZXN1bHRMaXN0LmZvckVhY2goKHJlc3VsdDogVmFsaWRhdGlvblJlc3VsdCkgPT4ge1xyXG4gICAgICAgICAgaWYgKCFyZXN1bHQuaXNWYWxpZCkge1xyXG4gICAgICAgICAgICBpc1ZhbGlkYXRlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgZXJyb3JzLnB1c2goLi4ucmVzdWx0LmVycm9ycyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgaWYgKGVycm9ycy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICB0aGlzLmNvbGxlY3RWYWxpZGF0aW9uRXJyb3JzKHJvb3RWaWV3TW9kZWwsIGVycm9ycywgdGhpcy5mcmFtZUNvbnRleHQubmFtZXNwYWNlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IHZlcmlmeUluZm9ybWF0aW9ucyA9IHJvb3RWaWV3TW9kZWwudmVyaWZ5SW5mb3JtYXRpb25zO1xyXG4gICAgICAgIGlmIChpc01vZGFsICYmIGhhc093blZlcmlmeURldGFpbFNlcnZpY2UpIHtcclxuICAgICAgICAgIHZlcmlmeUluZm9ybWF0aW9ucyA9IHJvb3RWaWV3TW9kZWwudmVyaWZ5SW5mb3JtYXRpb25zLmZpbHRlcihpdGVtID0+IGl0ZW0ubmFtZXNwYWNlID09PSBuYW1lc3BhY2UpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyDlm6DkuLrmoKHpqozntK/liqDnmoTnvJjmlYXvvIzlr7zoh7TkuYvliY3nmoTmoKHpqozkv6Hmga/kuIDnm7TlrZjlnKjvvIzlj6rog73pgJrov4fmoKHpqoznu5PmnpzmnaXnoa7lrprmmK/lkKbov5jmnInplJnor6/kv6Hmga9cclxuICAgICAgICBpZiAoaXNWYWxpZGF0ZWQgJiYgZm9ybVZhbGlkKSB7XHJcbiAgICAgICAgICB2ZXJpZnlJbmZvcm1hdGlvbnMgPSByb290Vmlld01vZGVsLnZlcmlmeUluZm9ybWF0aW9ucyA9IFtdO1xyXG4gICAgICAgIH1cclxuICAgICAgICByb290Vmlld01vZGVsLnZlcmlmeWNhdGlvbkNoYW5nZWQubmV4dCh2ZXJpZnlJbmZvcm1hdGlvbnMpO1xyXG4gICAgICAgIGlmIChpc1ZhbGlkYXRlZCAmJiBmb3JtVmFsaWQpIHtcclxuICAgICAgICAgIHJldHVybiBvZih0cnVlKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgcmV0dXJuIGVtcHR5KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICAgIHJldHVybiByZXN1bHQkO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmoKHpqozlrp7kvZPmmK/lkKbmu6HotrPkuI3og73kuLrnqbrnmoTop4TliJlcclxuICAgKiBAcGFyYW0gZW50aXR5IOS4u+WunuS9k1xyXG4gICAqL1xyXG4gIHByaXZhdGUgdmFsaWRhdGVFbnRpdHlBbGxvd0VtcHR5UnVsZShlbnRpdHlUeXBlSW5mbzogRGF0YVR5cGVJbmZvKSB7XHJcbiAgICAvLyDnoa7orqTlrp7kvZPlkITkuKrlsYLnuqfkuK3mmK/lkKblrZjlnKjkuI3og73kuLrnqbrnmoTop4TliJlcclxuICAgIGNvbnN0IHBhdGhzID0gdGhpcy5nZXROb3RBbGxvd0VtcHR5QmluZGluZ1BhdGhzKGVudGl0eVR5cGVJbmZvKTtcclxuICAgIGlmICghcGF0aHMgfHwgcGF0aHMubGVuZ3RoIDwgMSkge1xyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuICAgIC8vIOaJvuWIsOaJgOacieS4jeWQiOazleeahGJpbmRpbmdQYXRoc1xyXG4gICAgY29uc3QgaW52YWxpZFBhdGhzID0gcGF0aHMuZmlsdGVyKChwYXRoOiBzdHJpbmcpID0+IHtcclxuICAgICAgY29uc3QgYmluZGluZ1BhdGhzID0gcGF0aC5zcGxpdCgnLycpLmZpbHRlcihwID0+IHApO1xyXG4gICAgICBjb25zdCBiaW5kaW5nTGlzdCA9IHRoaXMuZnJhbWVDb250ZXh0LmJpbmRpbmdEYXRhLmdldFZhbHVlKGJpbmRpbmdQYXRocykgYXMgQmluZGluZ0xpc3Q7XHJcbiAgICAgIGlmICghYmluZGluZ0xpc3QgfHwgYmluZGluZ0xpc3QubGVuZ3RoIDwgMSkge1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH0pO1xyXG4gICAgLy8g5pyJ5a6e5L2T5b+F5aGr77yM5L2G5a6e5L2T5pWw5o2u5Li656m6XHJcbiAgICBpZiAoaW52YWxpZFBhdGhzLmxlbmd0aCA+IDApIHtcclxuICAgICAgY29uc3QgdGFibGVOYW1lcyA9IFtdO1xyXG4gICAgICBpbnZhbGlkUGF0aHMuZm9yRWFjaCgocGF0aDogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgLy9jb25zdCBmcmFtZUNvbnRleHRzID0gdGhpcy5nZXRGcmFtZUNvbnRleHRCeUJpbmRpbmdQYXRoKHBhdGguc3BsaXQoJy8nKSk7XHJcbiAgICAgICAgLy9jb25zdCBmcmFtZUNvbXBvbmVudHMgPSBmcmFtZUNvbnRleHRzLm1hcChmcmFtZUNvbnRleHQgPT4gZnJhbWVDb250ZXh0LmZyYW1lQ29tcG9uZW50KTtcclxuICAgICAgICAvLyDmib7liLDmiYDmnInlrrnlmajnsbvnu4Tku7ZcclxuICAgICAgICAvL2NvbnN0IGNvbnRhaW5lckNvbXBvbmVudHMgPSBmcmFtZUNvbXBvbmVudHMuZmlsdGVyKGZyYW1lQ29tcG9uZW50ID0+IFtDb21wb25lbnRUeXBlLmZhcnJpc0RhdGFHcmlkQ29tcG9uZW50LCBDb21wb25lbnRUeXBlLmZhcnJpc1RyZWVUYWxiZUNvbXBvbmVudCwgQ29tcG9uZW50VHlwZS5rZW5kb0dyaWRDb21wb25lbnQsIENvbXBvbmVudFR5cGUucHJpbWVuZ1RyZWVDb21wb25lbnRdLmluY2x1ZGVzKGZyYW1lQ29tcG9uZW50LmNvbXBvbmVudFR5cGUpKTtcclxuICAgICAgICAvL2lmICghKCFjb250YWluZXJDb21wb25lbnRzIHx8IGNvbnRhaW5lckNvbXBvbmVudHMubGVuZ3RoIDwgMSkpIHtcclxuICAgICAgICBjb25zdCB2aWV3TW9kZWxOYW1lID0gdGhpcy5nZXRWaWV3TW9kZWxOYW1lQnlCaW5kaW5nUGF0aHMocGF0aC5zcGxpdCgnLycpKSB8fCBg57uR5a6a6Lev5b6EJHtwYXRofWA7XHJcbiAgICAgICAgdGFibGVOYW1lcy5wdXNoKHZpZXdNb2RlbE5hbWUpO1xyXG4gICAgICAgIC8vfVxyXG4gICAgICB9KTtcclxuICAgICAgaWYgKHRoaXMubm90aWZ5U2VydmljZSkge1xyXG4gICAgICAgIHRoaXMubm90aWZ5U2VydmljZS5lcnJvcihgJHt0YWJsZU5hbWVzLmpvaW4oJ++8jCcpfSAke3RoaXMubGFuZ3VhZ2VTZXJ2aWNlLnRhYmxlQ2FuTm90RW1wdHl9YCwgeyBoaWRlVGl0bGU6IHRydWUgfSk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRydWU7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIFxyXG4gICAqIEBwYXJhbSBiaW5kaW5nUGF0aHMgcGF0aOS4jeiDveS4uuepuuaIli/vvIzkuI3mlK/mjIHkuLvooahcclxuICAgKi9cclxuICBwcml2YXRlIGdldFZpZXdNb2RlbE5hbWVCeUJpbmRpbmdQYXRocyhiaW5kaW5nUGF0aHM6IHN0cmluZ1tdKSB7XHJcbiAgICBjb25zdCBuYW1lc3BhY2UgPSB0aGlzLmZyYW1lQ29udGV4dC5uYW1lc3BhY2U7XHJcbiAgICBsZXQgZnJhbWVDb250ZXh0czogRnJhbWVDb250ZXh0W10gPSBudWxsO1xyXG4gICAgaWYgKG5hbWVzcGFjZSAhPT0gbnVsbCkge1xyXG4gICAgICAvLyDlrZjlnKjlkb3lkI3nqbrpl7TvvIzor7TmmI7ooajljZXovoPmlrDvvIzlj6/ku6Xkvp3otZbor6XnibnmgKdcclxuICAgICAgZnJhbWVDb250ZXh0cyA9IHRoaXMuZnJhbWVDb250ZXh0LmFwcENvbnRleHQuZnJhbWVDb250ZXh0TWFuYWdlci5nZXRGcmFtZUNvbnRleHRzQnlOYW1lc3BhY2UobmFtZXNwYWNlKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIC8vIOihqOWNlei+g+iAge+8jOiOt+WPluaJgOacieeahOS4iuS4i+aWh++8jOWcqOagoemqjOmYtuautei/h+a7pOinhOWImVxyXG4gICAgICBmcmFtZUNvbnRleHRzID0gdGhpcy5mcmFtZUNvbnRleHQuYXBwQ29udGV4dC5mcmFtZUNvbnRleHRNYW5hZ2VyLmdldEZyYW1lQ29udGV4dHMoKTtcclxuICAgIH1cclxuICAgIGNvbnN0IGJpbmRpbmdQYXRoID0gYmluZGluZ1BhdGhzLmZpbHRlcihwID0+IHApLmpvaW4oJy8nKTtcclxuICAgIGNvbnN0IGZyYW1lQ29udGV4dCA9IGZyYW1lQ29udGV4dHMuZmluZCgoZnJhbWVDb250ZXh0OiBGcmFtZUNvbnRleHQpID0+IGZyYW1lQ29udGV4dC52aWV3TW9kZWwgJiYgZnJhbWVDb250ZXh0LnZpZXdNb2RlbC5iaW5kaW5nUGF0aC5zcGxpdCgnLycpLmZpbHRlcihwID0+IHApLmpvaW4oJy8nKSA9PT0gYmluZGluZ1BhdGgpO1xyXG4gICAgY29uc3Qgdmlld01vZGVsTmFtZSA9IGZyYW1lQ29udGV4dCAmJiBmcmFtZUNvbnRleHQuZm9ybSAmJiBmcmFtZUNvbnRleHQuZm9ybS5mb3JtR3JvdXBOYW1lIHx8ICcnO1xyXG4gICAgcmV0dXJuIHZpZXdNb2RlbE5hbWU7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOmBjeWOhuiOt+WPluaJgOacieS4jeiDveS4uuepuueahOWunuS9k+eahOe7keWumui3r+W+hFxyXG4gICAqIEBwYXJhbSBlbnRpdHlUeXBlSW5mbyBcclxuICAgKiBAcGFyYW0gcmVzdWx0cyBcclxuICAgKiBAcmV0dXJucyBcclxuICAgKi9cclxuICBwcml2YXRlIGdldE5vdEFsbG93RW1wdHlCaW5kaW5nUGF0aHMoZW50aXR5VHlwZUluZm86IERhdGFUeXBlSW5mbywgcmVzdWx0czogc3RyaW5nW10gPSBbXSk6IHN0cmluZ1tdIHtcclxuICAgIGlmICghZW50aXR5VHlwZUluZm8pIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy5kZWVwRmlyc3RUcmF2ZXJzYWxFbnRpdHlUeXBlSW5mbyhlbnRpdHlUeXBlSW5mbywgcmVzdWx0cyk7XHJcbiAgICByZXR1cm4gcmVzdWx0cztcclxuICB9XHJcbiAgcHJpdmF0ZSBkZWVwRmlyc3RUcmF2ZXJzYWxFbnRpdHlUeXBlSW5mbyhlbnRpdHlUeXBlSW5mbzogRGF0YVR5cGVJbmZvLCByZXN1bHQ6IHN0cmluZ1tdID0gW10sIHByZXZpb3VzVmFsdWU6IHN0cmluZ1tdID0gW10pIHtcclxuICAgIC8vIOehruiupOW9k+WJjeWunuS9k+aYr+WQpuW/heWhq1xyXG4gICAgY29uc3QgaXNBbGxvd0VtcHR5ID0gdGhpcy5pc0FsbG93RW1wdHkoZW50aXR5VHlwZUluZm8uZW50aXR5SW5mby5hbGxvd0VtcHR5LCBwcmV2aW91c1ZhbHVlKTtcclxuICAgIGlmIChpc0FsbG93RW1wdHkgPT09IGZhbHNlKSB7XHJcbiAgICAgIGlmIChwcmV2aW91c1ZhbHVlLmxlbmd0aCA8IDEpIHtcclxuICAgICAgICByZXN1bHQucHVzaCgnJyk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmVzdWx0LnB1c2gocHJldmlvdXNWYWx1ZS5qb2luKCcvJykpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICAvLyDojrflj5bmiYDmnInlrZDooahcclxuICAgIGNvbnN0IGxpc3QgPSBlbnRpdHlUeXBlSW5mby5nZXRQcm9wSW5mb3NCeUdyb3VwKERhdGFQcm9wR3JvdXAuTGlzdCk7XHJcbiAgICBpZiAobGlzdCAmJiBsaXN0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgbGlzdC5mb3JFYWNoKChwcm9wSW5mbzogRGF0YVByb3BJbmZvKSA9PiB7XHJcbiAgICAgICAgY29uc3QgdHlwZUluZm8gPSBwcm9wSW5mby50eXBlSW5mbztcclxuICAgICAgICBpZiAodHlwZUluZm8gJiYgdHlwZUluZm8uZW50aXR5SW5mbykge1xyXG4gICAgICAgICAgcHJldmlvdXNWYWx1ZS5wdXNoKHR5cGVJbmZvLmVudGl0eUluZm8ubm9kZUNvZGUpO1xyXG4gICAgICAgICAgdGhpcy5kZWVwRmlyc3RUcmF2ZXJzYWxFbnRpdHlUeXBlSW5mbyh0eXBlSW5mbywgcmVzdWx0LCBwcmV2aW91c1ZhbHVlKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgLy8g5rKh5pyJ5LiL57qn5LqG77yM5q2k5pe25bqU6K+l5riF56m65ri45qCH77yM5bCG5pS26ZuG5Yiw55qE6Lev5b6E5pS+5Yiw57uT5p6c6ZuG5LitXHJcbiAgICBpZiAocHJldmlvdXNWYWx1ZSAmJiBwcmV2aW91c1ZhbHVlLmxlbmd0aCA+IDApIHtcclxuICAgICAgcHJldmlvdXNWYWx1ZS5wb3AoKTtcclxuICAgIH1cclxuICB9XHJcbiAgcHJpdmF0ZSBpc0FsbG93RW1wdHkodmFsdWU6IHN0cmluZyB8IGJvb2xlYW4sIHBhdGhzOiBzdHJpbmdbXSkge1xyXG4gICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09IHRydWUgfHwgdmFsdWUgPT09ICcnKSB7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG4gICAgLy8g5byA5Y+R6ICF5a6a5LmJ5LqG5LiN6IO95Li656m655qE6KeE5YiZXHJcbiAgICBjb25zdCBmcmFtZUNvbnRleHRzID0gdGhpcy5nZXRGcmFtZUNvbnRleHRCeUJpbmRpbmdQYXRoKHBhdGhzKTtcclxuICAgIGxldCBjYWxsZXIgPSB0aGlzLmZyYW1lQ29udGV4dC5mcmFtZUNvbXBvbmVudDtcclxuICAgIGlmICghZnJhbWVDb250ZXh0cyB8fCBmcmFtZUNvbnRleHRzLmxlbmd0aCA8IDEpIHtcclxuICAgICAgLy8g5a6a5LmJ5LqG6KeE5YiZ5L2G5a+55bqU55qERnJhbWXmsqHmnInmuLLmn5NcclxuICAgICAgY29uc29sZS53YXJuKGDnu5Hlrprot6/lvoQgJHtwYXRocy5qb2luKCcvJyl9IOWumuS5ieS6huS4jeiDveS4uuepuueahOinhOWIme+8jOS9huaJvuS4jeWIsOivpee7keWumui3r+W+hOWvueW6lOeahOe7hOS7tuOAguivt+ehruS/nee7hOS7tuaYvumakOS4juW/heWhq+S4gOiHtOOAgmApO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY2FsbGVyID0gZnJhbWVDb250ZXh0cy5wb3AoKS5mcmFtZUNvbXBvbmVudDtcclxuICAgIH1cclxuICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xyXG4gICAgICByZXR1cm4gdmFsdWU7XHJcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgdmFsdWUgPSB2YWx1ZS50cmltKCkuc3RhcnRzV2l0aCgncmV0dXJuJykgPyB2YWx1ZSA6IGByZXR1cm4gJHt2YWx1ZX1gO1xyXG4gICAgICBjb25zdCBmYWN0b3J5ID0gbmV3IEZ1bmN0aW9uKGBcclxuICAgICAgICB2YXIgdmlld01vZGVsID0gdGhpcy52aWV3TW9kZWw7XHJcbiAgICAgICAgdmFyIGJpbmRpbmdEYXRhID0gdGhpcy5iaW5kaW5nRGF0YTtcclxuICAgICAgICB2YXIgY29udGV4dCA9IHRoaXMuY29udGV4dDtcclxuICAgICAgICAke3ZhbHVlfVxyXG4gICAgICBgKTtcclxuICAgICAgcmV0dXJuIGZhY3RvcnkuYXBwbHkoY2FsbGVyKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnNvbGUud2Fybihg5peg5pWI55qE5b+F5aGr6KeE5YiZ44CCYCk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIGNvbGxlY3RWYWxpZGF0aW9uRXJyb3JzKHJvb3RWaWV3TW9kZWw6IFZpZXdNb2RlbCwgZXJyb3JzOiBWYWxpZGF0aW9uRXJyb3JbXSwgbmFtZXNwYWNlOiBzdHJpbmcsIGZpbHRlcjogYm9vbGVhbiA9IHRydWUpIHtcclxuICAgIGlmIChmaWx0ZXIpIHtcclxuICAgICAgcm9vdFZpZXdNb2RlbC52ZXJpZnlJbmZvcm1hdGlvbnMgPSByb290Vmlld01vZGVsLnZlcmlmeUluZm9ybWF0aW9ucy5maWx0ZXIoaXRlbSA9PiBpdGVtLm5hbWVzcGFjZSAhPT0gbmFtZXNwYWNlKTtcclxuICAgIH1cclxuICAgIGVycm9ycy5mb3JFYWNoKCh2YWxpZGF0aW9uRXJyb3I6IFZhbGlkYXRpb25FcnJvcikgPT4ge1xyXG4gICAgICBpZiAodmFsaWRhdGlvbkVycm9yLmNoaWxkcmVuICYmIHZhbGlkYXRpb25FcnJvci5jaGlsZHJlbi5sZW5ndGgpIHtcclxuICAgICAgICB0aGlzLmNvbGxlY3RWYWxpZGF0aW9uRXJyb3JzKHJvb3RWaWV3TW9kZWwsIHZhbGlkYXRpb25FcnJvci5jaGlsZHJlbiwgbmFtZXNwYWNlLCBmYWxzZSk7XHJcbiAgICAgIH1cclxuICAgICAgbGV0IGlkID0gJyc7XHJcbiAgICAgIGNvbnN0IGZpbmRJZCA9ICh0YXJnZXQ6IGFueSkgPT4ge1xyXG4gICAgICAgIGlmICh0YXJnZXQgJiYgdGFyZ2V0LmRhdGEgJiYgdGFyZ2V0LmRhdGEuaWQpIHtcclxuICAgICAgICAgIGlkID0gdGFyZ2V0LmRhdGEuaWQ7XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfSBlbHNlIGlmICh0YXJnZXRbUEFSRU5UX0NMQVNTXSkge1xyXG4gICAgICAgICAgZmluZElkKHRhcmdldFtQQVJFTlRfQ0xBU1NdKTtcclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcbiAgICAgIGZpbmRJZCh2YWxpZGF0aW9uRXJyb3IudGFyZ2V0KTtcclxuICAgICAgaWYgKHZhbGlkYXRpb25FcnJvci5jb25zdHJhaW50cykge1xyXG4gICAgICAgIGNvbnN0IHZhbGlkYXRpb25SZXN1bHRUeXBlcyA9IE9iamVjdC5rZXlzKHZhbGlkYXRpb25FcnJvci5jb25zdHJhaW50cyk7XHJcbiAgICAgICAgaWYgKHZhbGlkYXRpb25SZXN1bHRUeXBlcy5sZW5ndGgpIHtcclxuICAgICAgICAgIGNvbnN0IG9mZnNldCA9IHJvb3RWaWV3TW9kZWwudmVyaWZ5SW5mb3JtYXRpb25zLmZpbHRlcihpdGVtID0+IGl0ZW0ubmFtZXNwYWNlID09PSBuYW1lc3BhY2UpLmxlbmd0aDtcclxuICAgICAgICAgIGxldCBpbmRleCA9IHJvb3RWaWV3TW9kZWwudmVyaWZ5SW5mb3JtYXRpb25zLmZpbmRJbmRleChpdGVtID0+IGl0ZW0ubmFtZXNwYWNlID09PSBuYW1lc3BhY2UpO1xyXG4gICAgICAgICAgaW5kZXggPSBpbmRleCA9PT0gLTEgPyAwIDogaW5kZXggKyBvZmZzZXQ7XHJcbiAgICAgICAgICByb290Vmlld01vZGVsLnZlcmlmeUluZm9ybWF0aW9ucy5zcGxpY2UoaW5kZXgsIDAsIHtcclxuICAgICAgICAgICAgaWQ6IGlkLFxyXG4gICAgICAgICAgICBuYW1lc3BhY2UsXHJcbiAgICAgICAgICAgIHRhcmdldEZpZWxkOiB2YWxpZGF0aW9uRXJyb3IuZmllbGQsXHJcbiAgICAgICAgICAgIGluZGV4OiB2YWxpZGF0aW9uRXJyb3IuaW5kZXgsXHJcbiAgICAgICAgICAgIHRpdGxlOiB2YWxpZGF0aW9uRXJyb3IucHJvcGVydHlOYW1lLFxyXG4gICAgICAgICAgICBtc2c6IHZhbGlkYXRpb25FcnJvci5jb25zdHJhaW50c1t2YWxpZGF0aW9uUmVzdWx0VHlwZXNbMF1dLFxyXG4gICAgICAgICAgICBmcmFtZUNvbnRleHQ6IHZhbGlkYXRpb25FcnJvci5mcmFtZUNvbnRleHQsXHJcbiAgICAgICAgICAgIGZ1bGxQYXRoOiB2YWxpZGF0aW9uRXJyb3IuZnVsbFBhdGgsXHJcbiAgICAgICAgICAgIHR5cGU6IHZhbGlkYXRpb25SZXN1bHRUeXBlc1swXSA9PT0gJ3JlcXVpcmVkJyA/ICdlbXB0eScgOiAnZXJyb3InXHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDph43nva7moKHpqozkv6Hmga/vvIjku4XlvZPliY3ooajljZXvvIlcclxuICAgKi9cclxuICBwdWJsaWMgcmVzZXRWYWxpZGF0aW9uKCk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBjb25zdCBpc0RpYWxvZyA9IHRoaXMuaXNJbkRpYWxvZygpO1xyXG4gICAgbGV0IHJvb3RWaWV3TW9kZWwgPSB0aGlzLmZyYW1lQ29udGV4dC5yb290LnZpZXdNb2RlbDtcclxuICAgIGlmIChpc0RpYWxvZykge1xyXG4gICAgICByb290Vmlld01vZGVsID0gdGhpcy5mcmFtZUNvbnRleHQuZ2V0VmlydHVhbFJvb3RGcmFtZUNvbnRleHQoKS52aWV3TW9kZWw7XHJcbiAgICB9XHJcbiAgICBsZXQgdmVyaWZ5SW5mb3JtYXRpb25zID0gcm9vdFZpZXdNb2RlbC52ZXJpZnlJbmZvcm1hdGlvbnM7XHJcbiAgICBpZiAodmVyaWZ5SW5mb3JtYXRpb25zLmxlbmd0aCkge1xyXG4gICAgICBjb25zdCBuYW1lc3BhY2UgPSB0aGlzLmZyYW1lQ29udGV4dC5uYW1lc3BhY2U7XHJcbiAgICAgIGlmIChuYW1lc3BhY2UgIT09IG51bGwpIHtcclxuICAgICAgICB2ZXJpZnlJbmZvcm1hdGlvbnMgPSByb290Vmlld01vZGVsLnZlcmlmeUluZm9ybWF0aW9ucy5maWx0ZXIoaXRlbSA9PiBpdGVtLm5hbWVzcGFjZSAhPT0gbmFtZXNwYWNlKTtcclxuICAgICAgfVxyXG4gICAgICByb290Vmlld01vZGVsLnZlcmlmeUluZm9ybWF0aW9ucyA9IHZlcmlmeUluZm9ybWF0aW9ucztcclxuICAgICAgLy9yb290Vmlld01vZGVsLnZlcmlmeUluZm9ybWF0aW9ucy5zcGxpY2UoMCwgcm9vdFZpZXdNb2RlbC52ZXJpZnlJbmZvcm1hdGlvbnMubGVuZ3RoKTtcclxuICAgIH1cclxuICAgIGlmIChyb290Vmlld01vZGVsICYmIHJvb3RWaWV3TW9kZWwudmVyaWZ5Y2F0aW9uQ2hhbmdlZCkge1xyXG4gICAgICByb290Vmlld01vZGVsLnZlcmlmeWNhdGlvbkNoYW5nZWQubmV4dCh2ZXJpZnlJbmZvcm1hdGlvbnMpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIG9mKG51bGwpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmmK/lkKblnKjlvLnnqpflhoXpg6hcclxuICAgKi9cclxuICBwcml2YXRlIGlzSW5EaWFsb2coKSB7XHJcbiAgICByZXR1cm4gdGhpcy5mcmFtZUNvbnRleHQgJiYgdGhpcy5mcmFtZUNvbnRleHQuZ2V0VmlydHVhbFJvb3RGcmFtZUNvbnRleHQoKSAmJiB0aGlzLmZyYW1lQ29udGV4dC5nZXRWaXJ0dWFsUm9vdEZyYW1lQ29udGV4dCgpLmZyYW1lQ29tcG9uZW50ICYmIHRoaXMuZnJhbWVDb250ZXh0LmdldFZpcnR1YWxSb290RnJhbWVDb250ZXh0KCkuZnJhbWVDb21wb25lbnRbJ2lzRGlhbG9nUm9vdENvbXBvbmVudCddIHx8IGZhbHNlO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmi6XmnInni6zoh6rnmoTmoKHpqozmj5DnpLrmnI3liqFcclxuICAgKi9cclxuICBwcml2YXRlIGhhc093blZlcmlmeURldGFpbFNlcnZpY2UoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5mcmFtZUNvbnRleHQuaW5qZWN0b3IuZ2V0PFZlcmlmeURldGFpbFNlcnZpY2U+KFZlcmlmeURldGFpbFNlcnZpY2UsIG51bGwpICE9PSB0aGlzLmZyYW1lQ29udGV4dC5yb290LmFwcENvbnRleHQuaW5qZWN0b3IuZ2V0PFZlcmlmeURldGFpbFNlcnZpY2U+KFZlcmlmeURldGFpbFNlcnZpY2UsIG51bGwpOztcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6YCa6L+HYmluZGluZ1BhdGjojrflj5bmiYDmnInljLnphY3nmoRmcmFtZUNvbnRleHRcclxuICAgKiBAcGFyYW0gYmluZGluZ1BhdGggXHJcbiAgICogQHJldHVybnMgXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXRGcmFtZUNvbnRleHRCeUJpbmRpbmdQYXRoKGJpbmRpbmdQYXRoczogc3RyaW5nW10pOiBGcmFtZUNvbnRleHRbXSB7XHJcbiAgICBjb25zdCBiaW5kaW5nUGF0aCA9IGJpbmRpbmdQYXRocy5maWx0ZXIocCA9PiBwKS5qb2luKCcvJyk7XHJcbiAgICByZXR1cm4gdGhpcy5mcmFtZUNvbnRleHQuYXBwQ29udGV4dC5mcmFtZUNvbnRleHRNYW5hZ2VyLmdldEZyYW1lQ29udGV4dHMoKS5maWx0ZXIoZnJhbWVDb250ZXh0ID0+IGZyYW1lQ29udGV4dC52aWV3TW9kZWwuYmluZGluZ1BhdGguc3BsaXQoJy8nKS5maWx0ZXIocCA9PiBwKS5qb2luKCcvJykgPT09IGJpbmRpbmdQYXRoKTtcclxuICB9XHJcbiAgcHJpdmF0ZSBmaWx0ZXJEYXRhR3JpZENvbXBvbmVudCgpIHsgfVxyXG59XHJcblxyXG5leHBvcnQgeyBWYWxpZGF0aW9uU2VydmljZSB9O1xyXG4iXX0=