/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*
 * @Author: 疯狂秀才(Lucas Huang)
 * @Date: 2019-08-06 07:43:07
 * @LastEditors: 疯狂秀才(Lucas Huang)
 * @LastEditTime: 2019-11-19 15:48:27
 * @QQ: 1055818239
 * @Version: v0.0.1
 */
import { Directive, Input, ElementRef, Renderer2, ContentChild, Injector, forwardRef, Inject, NgZone } from '@angular/core';
import { filter, debounceTime, takeUntil } from 'rxjs/operators';
import { DatagridService } from './../../services/datagrid.service';
import { DatagridCellComponent } from './datagrid-cell.component';
import { DatagridBodyComponent } from './datagrid-body.component';
import { DatagridRowDirective } from './datagrid-row.directive';
import { DatagridFacadeService } from '../../services/datagrid-facade.service';
import { DatagridComponent } from '../../datagrid.component';
import { CELL_SELECTED_CLS, CELL_EDITING_CLS, ALLOW_EDIT_CELL_HIGHLIGHT_CLS } from '../../types/constant';
import { of, noop, Subject } from 'rxjs';
import { Utils } from '../../utils/utils';
export class DatagridCellEditableDirective {
    /**
     * @param {?} injector
     * @param {?} el
     * @param {?} render
     * @param {?} dg
     * @param {?} ngZone
     */
    constructor(injector, el, render, dg, ngZone) {
        this.injector = injector;
        this.el = el;
        this.render = render;
        this.dg = dg;
        this.ngZone = ngZone;
        // private _readonly$ = null;
        this.cellEditorCreatedSubscription = null;
        this.cellEditorDestorySubscription = null;
        this.destroy$ = new Subject();
        this.dgb = this.injector.get(DatagridBodyComponent);
        this.dr = this.injector.get(DatagridRowDirective);
        this.dfs = this.injector.get(DatagridFacadeService);
        this.dgs = this.injector.get(DatagridService);
        if (!this.cellEditorCreatedSubscription) {
            this.cellEditorCreatedSubscription = this.dgs.cellEditorCreated.pipe(takeUntil(this.destroy$)).pipe(filter((/**
             * @param {?} __0
             * @return {?}
             */
            ({ column, editorRef, cellEditorRef, templateRef }) => {
                return column.field === this.column.field && this.dg.selectedRow.id === this.dr.rowId;
            }))).subscribe((/**
             * @param {?} __0
             * @return {?}
             */
            ({ editorRef, cellEditorRef, templateRef }) => {
                if (editorRef) {
                    this['editor'] = editorRef.instance;
                    this['formControl'] = (/** @type {?} */ (this.editor.formControl));
                    this.cellEditorRef = cellEditorRef;
                    this.emitBeginEdit();
                }
                else {
                    this['formControl'] = (/** @type {?} */ (this.dr.form.get(this.column.field)));
                    this.bindEditorInputEvent();
                    this.dg.beginEdit.emit({ editor: null, column: this.column, rowData: this.rowData, gridInstance: this.dg, template: templateRef });
                }
            }));
        }
        this.dg.dgs.cellEditorDestory.pipe(takeUntil(this.destroy$)).pipe(filter((/**
         * @param {?} __0
         * @return {?}
         */
        ({ column }) => {
            return this.dg.selectedRow && column.field === this.column.field && this.dg.selectedRow.id === this.dr.rowId;
        }))).subscribe((/**
         * @param {?} e
         * @return {?}
         */
        (e) => {
            if (this.dg.editMode === 'cell') {
                this.dg.selectedRow.editors = [];
                if (this.dg.currentCell) {
                    this.dg.currentCell.editor = null;
                    this.dg.currentCell.cellEditorRef = null;
                }
            }
            this.unBindEditorInputEvent();
            this.cellEditorRef = null;
            this.formControl = null;
            this.editor = null;
        }));
    }
    /**
     * @return {?}
     */
    ngOnInit() {
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (changes.rowData && !changes.rowData.isFirstChange()) {
            this.setCellClsWithEditorType();
        }
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        this.initCellEvent();
        this.setCellClsWithEditorType();
    }
    /**
     * @private
     * @return {?}
     */
    initCellEvent() {
        // this.cellclick = this.render.listen(this.el.nativeElement, 'click', (e) => this.onClickCell(e));
        if (this.column && (this.column.editor || this.column.editorTemplate)) {
            if (!this.dg.clickToEdit) {
                this.celldblclick = this.render.listen(this.el.nativeElement, 'dblclick', (/**
                 * @param {?} e
                 * @return {?}
                 */
                (e) => {
                    this.onDblClickCell(e);
                }));
            }
            this.el.nativeElement.edit = (/**
             * @param {?} e
             * @return {?}
             */
            (e) => this.onClickCell(e));
            this.el.nativeElement.editCell = (/**
             * @param {?} e
             * @return {?}
             */
            (e) => {
                this.openCellEditor();
            });
        }
        else {
            this.clickTimer = 0;
        }
        this.el.nativeElement.gridCellData = { rowData: this.rowData, rowIndex: this.dr.rowIndex };
        this.el.nativeElement.closeEdit = (/**
         * @return {?}
         */
        () => this.closeEditingCell());
        this.el.nativeElement.selectCell = (/**
         * @param {?} e
         * @param {?} el
         * @return {?}
         */
        (e, el) => {
            if (this.dg.disableRow && this.dg.disableRow(this.rowData, this.dr.rowIndex)) {
                return;
            }
            if (this.dg.currentCell && this.dg.currentCell.cellElement.id === el.id && !this.dg.keepSelect) {
                this.dg.cancelSelectCell();
            }
            else {
                this.selectCell(this.column.field, el);
                this.dg.cellClick.emit({ column: this.column, rowData: this.rowData, gridInstance: this.dg, event: e });
            }
        });
        this.el.nativeElement.cancelSelected = (/**
         * @return {?}
         */
        () => {
            // DomHandler.removeClass(this.el.nativeElement, CELL_SELECTED_CLS);
            // DomHandler.removeClass(this.el.nativeElement, CELL_EDITING_CLS);
            this.render.removeClass(this.el.nativeElement, CELL_SELECTED_CLS);
            this.render.removeClass(this.el.nativeElement, CELL_EDITING_CLS);
        });
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.destroy$.next();
        this.destroy$.complete();
        if (this.cellclick) {
            this.cellclick();
        }
        if (this.celldblclick) {
            this.celldblclick();
        }
        this.unBindEditorInputEvent();
        if (this.bindCellEventSubscription) {
            this.bindCellEventSubscription.unsubscribe();
            this.bindCellEventSubscription = null;
        }
        if (this.cellEditorCreatedSubscription) {
            this.cellEditorCreatedSubscription.unsubscribe();
            this.cellEditorCreatedSubscription = null;
        }
        if (this.cellEditorDestorySubscription) {
            this.cellEditorDestorySubscription.unsubscribe();
            this.cellEditorDestorySubscription = null;
        }
        this.editor = null;
        this.cellEditorRef = null;
        this.formControl = null;
        if (this.el) {
            this.el.nativeElement.cancelSelected = noop;
            this.el.nativeElement.selectCell = noop;
            this.el.nativeElement.closeEdit = noop;
            this.el.nativeElement.gridCellData = noop;
            this.el.nativeElement.edit = noop;
            this.el.nativeElement.selectCell = noop;
            this.el = null;
        }
    }
    /**
     * @private
     * @return {?}
     */
    isDifferentCell() {
        if (!this.dg.currentCell) {
            return true;
        }
        else {
            if (!this.dg.selectedRow || this.dg.selectedRow.index !== this.dr.rowIndex) {
                return true;
            }
            else {
                if (this.dr.rowIndex !== this.dg.currentCell.rowIndex) {
                    return true;
                }
                else {
                    return this.dg.currentCell.field !== this.column.field;
                }
            }
        }
    }
    /**
     * @private
     * @param {?} event
     * @return {?}
     */
    onClickCell(event) {
        // 关闭其他Grid 的编辑器
        document.body.click();
        this.dg.beforeClickCell.emit({ rowIndex: this.dr.rowIndex, rowData: this.rowData, column: this.column, gridInstance: this.dg });
        if (this.dr.disabled) {
            return;
        }
        // 20210422
        // if (this.dg.closeOtherGridEditor) {
        //     document.body.click();
        // }
        if (this.dg.disabled) {
            return;
        }
        else {
            if (!this.dg.editable || this.isReadonly()) {
                if (this.dg.enableHighlightCell) {
                    event.stopPropagation();
                    this.dg.endEditing();
                    this.selectCell(this.column.field);
                }
                return;
            }
            else {
                if (this.dg.editMode === 'row') {
                    return;
                }
            }
        }
        if (this.dg.selectionMode === 'default' && event) {
            if (event.ctrlKey || event.shiftKey) {
                return;
            }
        }
        event.stopPropagation();
        if (event.target['nodeName'] === 'INPUT') {
            return;
        }
        if (this.dg.clickToEdit && !this.dg.dblclickRow.observers.length) {
            this.dg.clickDelay = 0;
        }
        this.render.addClass(this.dg.el.nativeElement, 'f-datagrid-unselect');
        if (!this.dg.isSingleClick && this.dg.editMode) {
            this.dg.isSingleClick = true;
            this.clickTimer = setTimeout((/**
             * @return {?}
             */
            () => {
                if (this.dg.isSingleClick && this.dg.editable && this.dg.editMode === 'cell') {
                    this.dg.isSingleClick = false;
                    clearTimeout(this.clickTimer);
                    // if (!this.closeEditingCell()) {
                    //     return;
                    // }
                    this.closeEditingCell().pipe(takeUntil(this.destroy$)).subscribe((/**
                     * @param {?} f
                     * @return {?}
                     */
                    (f) => {
                        if (f) {
                            if (this.dg.clickToEdit) {
                                this.openCellEditor();
                            }
                            else {
                                this.selectCell(this.column.field);
                            }
                            this.render.removeClass(this.dg.el.nativeElement, 'f-datagrid-unselect');
                            event.preventDefault();
                        }
                    }));
                }
            }), this.dg.clickDelay);
        }
    }
    /**
     * @private
     * @param {?} event
     * @return {?}
     */
    onDblClickCell(event) {
        if (this.dg.disabled || this.isReadonly()) {
            return;
        }
        if (event.target['nodeName'] === 'INPUT' || event.target['nodeName'] === 'TEXTAREA') {
            return;
        }
        if (this.dg.editable && this.dg.editMode === 'cell') {
            // if (!this.closeEditingCell()) {
            //     return;
            // }
            this.closeEditingCell().pipe(takeUntil(this.destroy$)).subscribe((/**
             * @param {?} f
             * @return {?}
             */
            f => {
                if (f) {
                    setTimeout((/**
                     * @return {?}
                     */
                    () => {
                        this.openCellEditor();
                    }));
                }
            }));
        }
        if (this.clickTimer) {
            this.dg.isSingleClick = false;
            clearTimeout(this.clickTimer);
            this.clickTimer = null;
        }
    }
    /**
     * @param {?=} col
     * @return {?}
     */
    isReadonly(col = this.column) {
        if (this.dg.editable) {
            // 参与合并的单元格不允许编辑
            if (this.dg.mergeCell && this.dg.mergeFields.indexOf(col.field) > -1) {
                return true;
            }
            return this.getReadonlyValue(col);
        }
        else {
            return true;
        }
    }
    /**
     * @private
     * @param {?=} col
     * @return {?}
     */
    getReadonlyValue(col = this.column) {
        if (col.readonly !== undefined) {
            if (typeof col.readonly === 'boolean') {
                return col.readonly;
            }
            else if (typeof col.readonly === 'function') {
                return col.readonly(this.rowData);
            }
        }
        return false;
    }
    /**
     * @return {?}
     */
    openCellEditor() {
        // 当前行禁用，不允许编辑。
        if (this.dr.disabled) {
            return;
        }
        if ((!this.column.editor && !this.column.editorTemplate) || !this.dg.editable || this.isReadonly()) {
            if (this.dg.selectionMode === 'default' && this.dg.multiSelect) {
                this.dg.clearCheckeds();
            }
            this.selectCell(this.column.field);
            return;
        }
        /** @type {?} */
        const beforeEditEvent = this.dg.beforeEdit({ rowIndex: this.dr.rowIndex, rowData: this.rowData, column: this.column, gridInstance: this.dg });
        if (!beforeEditEvent || !beforeEditEvent.subscribe) {
            this.dg.writeConsole('please return an Observable Type.');
            return;
        }
        if (this.dg.currentCell) {
            if (!this.dg.currentCell.cellRef || this.dg.currentCell.cellRef.column.field !== this.column.field) {
                this.dg.currentCell.cellRef = this.dc;
            }
        }
        beforeEditEvent.pipe(takeUntil(this.destroy$)).subscribe((/**
         * @param {?} flag
         * @return {?}
         */
        (flag) => {
            if (flag) {
                if (this.isDifferentCell()) {
                    if (this.dg.selectionMode === 'default' && this.dg.multiSelect) {
                        this.dg.clearCheckeds();
                    }
                    this.selectCell(this.column.field);
                }
                this.dfs.editCell();
                // this.emitBeginEdit();
            }
            else {
                this.selectCell(this.column.field);
            }
        }));
    }
    /**
     * @private
     * @return {?}
     */
    emitBeginEdit() {
        /** @type {?} */
        const _cellEditorRef = this.cellEditorRef || this.dc.cellEditor;
        this.render.removeClass(this.dg.el.nativeElement, 'f-datagrid-unselect');
        if (this.dg.editMode === 'cell') {
            this.dg.selectedRow.editors = [this.editor];
            this.dg.currentCell.editor = this.editor;
            this.dg.currentCell.cellEditorRef = _cellEditorRef;
            this.bindEditorInputEvent();
            this.render.addClass(this.el.nativeElement, CELL_EDITING_CLS);
            // this.formControl.setValue(this.dc.value);
            this.dg.beginEdit.emit({ editor: _cellEditorRef, column: this.column, rowData: this.rowData, gridInstance: this.dg });
            if (this.column.editor.type === 'textarea' && this.column.editor.options && this.column.editor.options.editType === 'dialog') {
                this.editor.showDialog();
            }
        }
        if (this.dr && !this.dg.nowrap) {
            this.dr.updateRowHeight();
        }
    }
    /**
     * @return {?}
     */
    closeEditingCell() {
        if (!this.dg.isCellEditing()) {
            return of(true);
        }
        /** @type {?} */
        let currentCell = null;
        /** @type {?} */
        let editor = null;
        if (this.dg.currentCell) {
            // this.dg.currentCell.isEditing = false;
            // this.dfs.getCurrentCell().isEditing = false;
            currentCell = (/** @type {?} */ (this.dg.currentCell.cellRef));
            if (currentCell) {
                if (!currentCell.isEditing) {
                    return of(true);
                }
                if (currentCell.cellEditor && currentCell.cellEditor.componentRef && !currentCell.column.editorTemplate) {
                    editor = currentCell.cellEditor.componentRef.instance;
                    if (editor) {
                        // 执行blur 事件
                        if (editor.inputElement) {
                            /** @type {?} */
                            const domName = editor.inputElement.nodeName;
                            /** @type {?} */
                            const blurFn = editor.options && editor.options.onBlur;
                            if (blurFn) {
                                if ((domName === 'INPUT' || domName === 'TEXTAREA') && this.dg['focusElement'] === editor.inputElement) {
                                    blurFn({ editorRef: editor, rowData: currentCell.rowData });
                                }
                            }
                            if (editor.inputElement.blur) {
                                editor.inputElement.blur();
                            }
                            this.dg['focusElement'] = null;
                        }
                        if (editor.blur) {
                            editor.blur();
                        }
                        if (editor.pending) {
                            return of(false);
                        }
                        if (editor.formControl) {
                            if (editor.formControl.pending) {
                                return of(false);
                            }
                            if (editor.formControl && editor.formControl.invalid && !this.dg.endEditByInvalid) {
                                return of(false);
                            }
                        }
                        else {
                            return of(true);
                        }
                    }
                    else {
                        return of(true);
                    }
                }
            }
        }
        else {
            return of(true);
        }
        this.dg.isSingleClick = false;
        /** @type {?} */
        const _col_ = (editor || currentCell).column;
        /** @type {?} */
        const afterEditEvent = this.dg.afterEdit(currentCell.rowIndex, currentCell.rowData, _col_, editor);
        if (!afterEditEvent || !afterEditEvent.subscribe) {
            this.dg.writeConsole('please return an Observable Type.');
            return;
        }
        /** @type {?} */
        let cellEndEdit = of(undefined);
        afterEditEvent.pipe(takeUntil(this.destroy$)).subscribe((/**
         * @param {?} flag
         * @return {?}
         */
        (flag) => {
            if (flag) {
                /** @type {?} */
                let val = currentCell.value;
                if (currentCell && currentCell.formControl && val !== currentCell.formControl.value) {
                    val = currentCell.formControl.value;
                    currentCell.isEditing = false;
                    currentCell.updateValue(val);
                }
                this.dfs.endEditCell();
                this.dgs.onEndCellEdit(this.dfs.getCurrentCell());
                this.unBindEditorInputEvent();
                // 移除编辑样式
                this.render.removeClass(this.el.nativeElement, CELL_EDITING_CLS);
                if (this.dg.selectedRow) {
                    this.dg.selectedRow.editors = [];
                }
                // this.dg.selectedRow.data = this.rowData;
                // 更新行样式或者单元格样式
                this.dfs.rowUpdate$.next({ index: currentCell.rowIndex, data: currentCell.rowData, cellRef: currentCell });
                this.dg.endEdit.emit({ rowIndex: currentCell.rowIndex, rowData: currentCell.rowData, column: _col_, value: val });
                // 更新footerData
                this.dgs.refreshFooterData.emit();
                cellEndEdit = of(true);
                // 刷新行数据
                // this.dr.refresh();
                if (this.dg.selectedRow && this.dg.selectedRow.dr) {
                    this.dg.selectedRow.dr.refresh();
                }
            }
            else {
                if (currentCell && currentCell.cellEditor) {
                    editor = currentCell.cellEditor.componentRef.instance;
                    editor.inputElement.focus();
                    cellEndEdit = of(false);
                }
                else {
                    cellEndEdit = of(true);
                }
            }
        }));
        return cellEndEdit;
    }
    /**
     * @return {?}
     */
    cancelCellEditing() {
        if (this.dg.currentCell && this.dg.currentCell.isEditing && this.dg.selectedRow.index > -1) {
            // this.dfs.resetRow(this.dg.selectedRow.id);
            this.dc.rowData = this.dg.selectedRow.data;
            this.formControl.reset(Utils.getValue(this.column.field, this.dc.rowData));
            this.closeEditingCell();
        }
    }
    /**
     * @return {?}
     */
    bindEditorInputEvent() {
        /** @type {?} */
        const ceRef = this.cellEditorRef || this.dc.cellEditor;
        /** @type {?} */
        let input = null;
        if (ceRef) {
            input = ceRef.componentRef.instance.inputElement;
        }
        else {
            if (this.column.editorTemplate) {
                input = this.dc.el.nativeElement.querySelector('input,textarea');
            }
        }
        if (input) {
            input.focus();
            if (this.dg.selectOnEditing && this.column.editorTemplate) {
                setTimeout((/**
                 * @return {?}
                 */
                () => {
                    if (input.select) {
                        input.select();
                    }
                }));
            }
            this.editorInputKeydownEvent = this.render.listen(input, 'keydown', (/**
             * @param {?} e
             * @return {?}
             */
            (e) => {
                this.onKeyDownForInput(e);
            }));
        }
    }
    /**
     * @return {?}
     */
    unBindEditorInputEvent() {
        if (this.editorInputKeydownEvent) {
            this.editorInputKeydownEvent();
            this.editorInputKeydownEvent = null;
        }
    }
    /**
     * @param {?} e
     * @return {?}
     */
    onKeyDownForInput(e) {
        /** @type {?} */
        const keyCode = e.keyCode;
        if (e.altKey || e.ctrlKey) {
            return;
        }
        if ((this.editor && this.editor.stopPropagation) || keyCode === 13 || this.column.editorTemplate) {
            e.stopPropagation();
        }
        switch (keyCode) {
            case 32: // SPACE
                if (this.column.editor.type === 'switch') {
                    e.preventDefault();
                    this.editor.instance.updateChecked(e, false);
                }
                break;
            case 13: // Enter
                this.closeEditingCell().pipe(takeUntil(this.destroy$)).pipe(debounceTime(100)).subscribe((/**
                 * @param {?} f
                 * @return {?}
                 */
                f => {
                    if (f) {
                        this.dg.dgContainer.nativeElement.focus();
                        /** @type {?} */
                        const enterParam = { gird: this.dg, cell: this.dg.currentCell, event: e };
                        if (this.column.onEnterHandler) {
                            this.column.onEnterHandler(enterParam);
                        }
                        else {
                            /** @type {?} */
                            const nextTd = this.dg.currentCell.cellElement.nextElementSibling;
                            if (this.dg.currentCell.lastRow && !nextTd) {
                                this.dg.lastCellEnterHandle.emit(enterParam);
                            }
                        }
                    }
                }));
                break;
            case 27: // ESC
                this.cancelCellEditing();
                break;
            case 9: // Tab
                e.stopPropagation();
                this.dg.clickDelay = 0;
                if (e.shiftKey) {
                    this.closeEditingCell().pipe(takeUntil(this.destroy$)).subscribe((/**
                     * @param {?} f
                     * @return {?}
                     */
                    f => {
                        if (f) {
                            this.movePrevCellAndEdit();
                        }
                    }));
                }
                else {
                    this.closeEditingCell().pipe(takeUntil(this.destroy$)).subscribe((/**
                     * @param {?} f
                     * @return {?}
                     */
                    f => {
                        if (f) {
                            this.moveNextCellAndEdit(e);
                        }
                    }));
                    e.preventDefault();
                }
                break;
            case 40: // ↓
                /** 选中下一行，且当前列进入编辑态; 仅普通文本输入框支持 */
                if (this.column.editor.type === 'textbox') {
                    this.closeEditingCell().pipe(takeUntil(this.destroy$)).subscribe((/**
                     * @param {?} f
                     * @return {?}
                     */
                    f => {
                        if (f) {
                            this.selectNextRowAndEditCell(this.column.field, 'down');
                        }
                    }));
                    e.preventDefault();
                }
                break;
            case 38: // ↑
                /** 选中上一行，且当前列进入编辑态; 仅普通文本输入框支持 */
                if (this.column.editor.type === 'textbox') {
                    this.closeEditingCell().pipe(takeUntil(this.destroy$)).subscribe((/**
                     * @param {?} f
                     * @return {?}
                     */
                    f => {
                        if (f) {
                            this.selectNextRowAndEditCell(this.column.field, 'up');
                        }
                    }));
                    e.preventDefault();
                }
                break;
        }
    }
    /**
     * @private
     * @param {?} field
     * @param {?=} tdElement
     * @return {?}
     */
    selectCell(field, tdElement) {
        this.closeEditingCell().subscribe((/**
         * @param {?} t
         * @return {?}
         */
        t => {
            if (!t) {
                return;
            }
            tdElement = tdElement || this.el.nativeElement;
            this.clearCellSelectedClass();
            if (field !== this.dg.ControlPanelFeild) {
                this.render.addClass(tdElement, CELL_SELECTED_CLS);
            }
            // this.dr.drHover.setRowHoverCls(false);
            this.dfs.setCurrentCell(this.dr, field, tdElement, this.dc);
            if (!this.dg.fast) {
                this.moveScrollbar(tdElement);
            }
        }));
    }
    /**
     * @private
     * @param {?} td
     * @return {?}
     */
    moveScrollbar(td) {
        /** @type {?} */
        const tdPosLeft = td.offsetLeft + td.offsetWidth;
        /** @type {?} */
        const containerWidth = this.dg.width - this.dgb.columnsGroup.leftFixedWidth;
        /** @type {?} */
        const tdRect = td.getBoundingClientRect();
        /** @type {?} */
        const scrollContainer = this.dgb.ps.elementRef.nativeElement;
        /** @type {?} */
        const psContainer = scrollContainer.getBoundingClientRect();
        /** @type {?} */
        const scrollTop = scrollContainer.scrollTop;
        /** @type {?} */
        const scrollLeft = scrollContainer.scrollLeft;
        /** @type {?} */
        const scrollbarXLeft = this.dgb.ps.elementRef.nativeElement.scrollLeft;
        if (tdPosLeft > containerWidth) {
            /** @type {?} */
            const x = tdPosLeft - containerWidth + 2;
            if (x > scrollbarXLeft) {
                this.dgb.ps.scrollToX(x);
            }
        }
        else {
            if (tdRect.x < psContainer.x) {
                /** @type {?} */
                const x = scrollLeft - tdRect.x;
                this.dgb.ps.scrollToX(x);
            }
        }
        /** @type {?} */
        const tdPosTop = tdRect.top - psContainer.top + tdRect.height;
        if (tdPosTop > psContainer.height) {
            /** @type {?} */
            const y = tdPosTop - psContainer.height;
            this.dgb.ps.scrollToY(scrollTop + y);
        }
        else {
            if (tdRect.y < psContainer.y) {
                this.dgb.ps.scrollToY(scrollTop - (psContainer.y - tdRect.y));
            }
        }
    }
    /**
     * @private
     * @param {?=} event
     * @return {?}
     */
    moveNextCellAndEdit(event) {
        // if (!this.closeEditingCell()) {
        //     return;
        // }
        /** @type {?} */
        const fieldIndex = this.dfs.getColumnIndex(this.column.field);
        if (fieldIndex + 1 < this.dgb.columnsGroup.normalColumns.length) {
            /** @type {?} */
            const nextColumn = this.dgb.columnsGroup.normalColumns[fieldIndex + 1];
            /** @type {?} */
            const nextTd = this.dg.currentCell.cellElement.nextElementSibling;
            if (nextColumn && ((!nextColumn.editor && !nextColumn.editorTemplate) || this.isReadonly(nextColumn))) {
                if (nextTd) {
                    nextTd.selectCell(event, nextTd);
                }
                return;
            }
            if (nextTd) {
                nextTd.focus();
                if (nextColumn.editor || nextColumn.editorTemplate) {
                    nextTd.editCell();
                    this.dgs.onCellEdit(nextTd);
                }
            }
        }
        else {
            // next row's first cell to editing
            /** @type {?} */
            const nextTr = this.dg.currentCell.cellElement.parentElement.nextElementSibling;
            if (nextTr && nextTr.tagName === 'TR') {
                // nextTr.children.find(td => td.editCell).editCell();
                /** @type {?} */
                let firstEditor = false;
                /** @type {?} */
                let i = 0;
                while (!firstEditor) {
                    firstEditor = !!nextTr.children[i].editCell;
                    if (!firstEditor) {
                        i++;
                    }
                }
                if (this.dg.selectionMode === 'default') {
                    this.dg.clearCheckeds();
                }
                nextTr.children[i].editCell();
            }
        }
    }
    /**
     * @private
     * @return {?}
     */
    movePrevCellAndEdit() {
        // if (!this.closeEditingCell()) {
        //     return;
        // }
        /** @type {?} */
        const fieldIndex = this.dfs.getColumnIndex(this.column.field);
        if (fieldIndex - 1 >= 0) {
            /** @type {?} */
            const nextColumn = this.dgb.columnsGroup.normalColumns[fieldIndex - 1];
            if (nextColumn && this.isReadonly(nextColumn)) {
                return;
            }
            /** @type {?} */
            const nextTd = this.dg.currentCell.cellElement.previousElementSibling;
            if (nextTd) {
                // this.selectCell(nextColumn.field, nextTd);
                nextTd.focus();
                if (nextColumn.editor) {
                    // this.dfs.editCell();
                    nextTd.click();
                    this.dgs.onCellEdit(nextTd);
                }
            }
        }
    }
    /**
     * @private
     * @param {?} cellFieldName
     * @param {?} dir
     * @return {?}
     */
    selectNextRowAndEditCell(cellFieldName, dir) {
        /** @type {?} */
        const p = dir === 'down' ? 'nextElementSibling' : 'previousElementSibling';
        /** @type {?} */
        const nextTr = this.dg.currentCell.cellElement.parentElement[p];
        if (nextTr && nextTr.tagName === 'TR') {
            /** @type {?} */
            const td = Array.from(nextTr.children).find((/**
             * @param {?} td
             * @return {?}
             */
            (td) => td.getAttribute('field') == cellFieldName));
            if (td && td.editCell) {
                if (this.dg.selectionMode === 'default') {
                    this.dg.clearCheckeds();
                }
                td.editCell();
            }
        }
    }
    /**
     * @private
     * @return {?}
     */
    clearCellSelectedClass() {
        // if (this.dg.currentCell) {
        //     DomHandler.removeClass(this.dg.currentCell.cellElement, CELL_SELECTED_CLS);
        //     this.render.removeClass(this.dg.currentCell.cellElement, CELL_EDITING_CLS);
        //     const selectedCell = this.dg.el.nativeElement.querySelectorAll('.' + CELL_SELECTED_CLS);
        //     if (selectedCell.length) {
        //         selectedCell.forEach(n => {
        //             this.render.removeClass(n, CELL_SELECTED_CLS);
        //         });
        //     }
        // }
        this.dg.removeCellSelectedCls();
    }
    /**
     * @private
     * @return {?}
     */
    setCellClsWithEditorType() {
        // 设置当前选中单元格样式
        if (this.dg.currentCell && this.dg.enableHighlightCell) {
            if (this.dg.currentCell.field === this.column.field && this.dg.currentCell.rowId === this.rowData[this.dg.idField] && !this.dc.isEditing) {
                this.clearCellSelectedClass();
                this.render.addClass(this.el.nativeElement, CELL_SELECTED_CLS);
            }
        }
        if (!this.dg.enableEditCellStyle) {
            return;
        }
        /** @type {?} */
        const td = this.el.nativeElement;
        this.cleanOtherEditorIcon(td);
        // 当前行禁用，不允许编辑。
        if (this.dr.disabled) {
            return;
        }
        if (!this.column.editor) {
            return;
        }
        if (this.isReadonly()) {
            return;
        }
        /** @type {?} */
        const editorType = this.column.editor.type;
        /** @type {?} */
        const cls = this.column.align === 'right' ? 'allow-edit-cell-left' : 'allow-edit-cell';
        this.render.addClass(td, cls);
        this.render.addClass(td, ALLOW_EDIT_CELL_HIGHLIGHT_CLS[editorType]);
    }
    /**
     * @private
     * @param {?} td
     * @return {?}
     */
    cleanOtherEditorIcon(td) {
        /** @type {?} */
        const values = Object.values(ALLOW_EDIT_CELL_HIGHLIGHT_CLS);
        values.forEach((/**
         * @param {?} v
         * @return {?}
         */
        v => {
            if (td.className.indexOf(v) > -1) {
                td.className = td.className.replace('allow-edit-cell-left', '').replace('allow-edit-cell', '');
                td.className = td.className.replace(v, '');
            }
        }));
    }
}
DatagridCellEditableDirective.decorators = [
    { type: Directive, args: [{
                selector: '[cell-editable]',
                exportAs: 'cellEditable'
            },] }
];
/** @nocollapse */
DatagridCellEditableDirective.ctorParameters = () => [
    { type: Injector },
    { type: ElementRef },
    { type: Renderer2 },
    { type: DatagridComponent, decorators: [{ type: Inject, args: [forwardRef((/**
                     * @return {?}
                     */
                    () => DatagridComponent)),] }] },
    { type: NgZone }
];
DatagridCellEditableDirective.propDecorators = {
    rowData: [{ type: Input, args: ['cell-editable',] }],
    column: [{ type: Input }],
    dc: [{ type: ContentChild, args: [DatagridCellComponent,] }]
};
if (false) {
    /** @type {?} */
    DatagridCellEditableDirective.prototype.rowData;
    /** @type {?} */
    DatagridCellEditableDirective.prototype.column;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.clickTimer;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.cellclick;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.celldblclick;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.bindCellEventSubscription;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.editorInputKeydownEvent;
    /** @type {?} */
    DatagridCellEditableDirective.prototype.editor;
    /** @type {?} */
    DatagridCellEditableDirective.prototype.formControl;
    /** @type {?} */
    DatagridCellEditableDirective.prototype.cellEditorRef;
    /** @type {?} */
    DatagridCellEditableDirective.prototype.dc;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.dgb;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.dr;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.dfs;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.dgs;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.cellEditorCreatedSubscription;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.cellEditorDestorySubscription;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.destroy$;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.injector;
    /** @type {?} */
    DatagridCellEditableDirective.prototype.el;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.render;
    /** @type {?} */
    DatagridCellEditableDirective.prototype.dg;
    /** @type {?} */
    DatagridCellEditableDirective.prototype.ngZone;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YWdyaWQtY2VsbC1lZGl0YWJsZS5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWRhdGFncmlkLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvYm9keS9kYXRhZ3JpZC1jZWxsLWVkaXRhYmxlLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFRQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFVLFlBQVksRUFBYSxRQUFRLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBaUIsTUFBTSxFQUE0QixNQUFNLGVBQWUsQ0FBQztBQUV4TCxPQUFPLEVBQUUsTUFBTSxFQUE0QixZQUFZLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDM0YsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG1DQUFtQyxDQUFDO0FBQ3BFLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ2xFLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ2xFLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBRWhFLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLHdDQUF3QyxDQUFDO0FBQy9FLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQzdELE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxnQkFBZ0IsRUFBRSw2QkFBNkIsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBRTFHLE9BQU8sRUFBRSxFQUFFLEVBQWlCLElBQUksRUFBRSxPQUFPLEVBQUcsTUFBTSxNQUFNLENBQUM7QUFDekQsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBTTFDLE1BQU0sT0FBTyw2QkFBNkI7Ozs7Ozs7O0lBd0N0QyxZQUNZLFFBQWtCLEVBQVMsRUFBYyxFQUFVLE1BQWlC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OztJQUNyQywrQ0FBNEI7Ozs7O0lBRTVCLG1EQUF3Qjs7Ozs7SUFFeEIsa0RBQXVCOzs7OztJQUN2QixxREFBMEI7Ozs7O0lBQzFCLGtFQUFnRDs7Ozs7SUFFaEQsZ0VBQXFDOztJQUNyQywrQ0FBWTs7SUFDWixvREFBeUI7O0lBQ3pCLHNEQUFtQjs7SUFpQm5CLDJDQUErRDs7Ozs7SUFDL0QsNENBQW1DOzs7OztJQUNuQywyQ0FBaUM7Ozs7O0lBQ2pDLDRDQUFtQzs7Ozs7SUFDbkMsNENBQTZCOzs7OztJQUc3QixzRUFBNkM7Ozs7O0lBQzdDLHNFQUE2Qzs7Ozs7SUFDN0MsaURBQWlDOzs7OztJQUU3QixpREFBMEI7O0lBQUUsMkNBQXFCOzs7OztJQUFFLCtDQUF5Qjs7SUFDNUUsMkNBQXlFOztJQUFFLCtDQUFxQiIsInNvdXJjZXNDb250ZW50IjpbIi8qXHJcbiAqIEBBdXRob3I6IOeWr+eLguengOaJjShMdWNhcyBIdWFuZylcclxuICogQERhdGU6IDIwMTktMDgtMDYgMDc6NDM6MDdcclxuICogQExhc3RFZGl0b3JzOiDnlq/ni4Lnp4DmiY0oTHVjYXMgSHVhbmcpXHJcbiAqIEBMYXN0RWRpdFRpbWU6IDIwMTktMTEtMTkgMTU6NDg6MjdcclxuICogQFFROiAxMDU1ODE4MjM5XHJcbiAqIEBWZXJzaW9uOiB2MC4wLjFcclxuICovXHJcbmltcG9ydCB7IERpcmVjdGl2ZSwgSW5wdXQsIEVsZW1lbnRSZWYsIFJlbmRlcmVyMiwgT25Jbml0LCBDb250ZW50Q2hpbGQsIE9uRGVzdHJveSwgSW5qZWN0b3IsIGZvcndhcmRSZWYsIEluamVjdCwgQWZ0ZXJWaWV3SW5pdCwgTmdab25lLCBPbkNoYW5nZXMsIFNpbXBsZUNoYW5nZXMgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgRm9ybUNvbnRyb2wgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XHJcbmltcG9ydCB7IGZpbHRlciwgbWFwLCBzd2l0Y2hNYXAsIHRha2VMYXN0LCBkZWJvdW5jZVRpbWUsIHRha2VVbnRpbCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgRGF0YWdyaWRTZXJ2aWNlIH0gZnJvbSAnLi8uLi8uLi9zZXJ2aWNlcy9kYXRhZ3JpZC5zZXJ2aWNlJztcclxuaW1wb3J0IHsgRGF0YWdyaWRDZWxsQ29tcG9uZW50IH0gZnJvbSAnLi9kYXRhZ3JpZC1jZWxsLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IERhdGFncmlkQm9keUNvbXBvbmVudCB9IGZyb20gJy4vZGF0YWdyaWQtYm9keS5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZFJvd0RpcmVjdGl2ZSB9IGZyb20gJy4vZGF0YWdyaWQtcm93LmRpcmVjdGl2ZSc7XHJcbmltcG9ydCB7IERhdGFDb2x1bW4gfSBmcm9tICcuLy4uLy4uL3R5cGVzL2RhdGEtY29sdW1uJztcclxuaW1wb3J0IHsgRGF0YWdyaWRGYWNhZGVTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvZGF0YWdyaWQtZmFjYWRlLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZENvbXBvbmVudCB9IGZyb20gJy4uLy4uL2RhdGFncmlkLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IENFTExfU0VMRUNURURfQ0xTLCBDRUxMX0VESVRJTkdfQ0xTLCBBTExPV19FRElUX0NFTExfSElHSExJR0hUX0NMUyB9IGZyb20gJy4uLy4uL3R5cGVzL2NvbnN0YW50JztcclxuaW1wb3J0IHsgRG9tSGFuZGxlciB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL2RvbWhhbmRsZXInO1xyXG5pbXBvcnQgeyBvZiwgU3Vic2NyaXB0aW9uLCAgbm9vcCwgU3ViamVjdCAgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgVXRpbHMgfSBmcm9tICcuLi8uLi91dGlscy91dGlscyc7XHJcblxyXG5ARGlyZWN0aXZlKHtcclxuICAgIHNlbGVjdG9yOiAnW2NlbGwtZWRpdGFibGVdJyxcclxuICAgIGV4cG9ydEFzOiAnY2VsbEVkaXRhYmxlJ1xyXG59KVxyXG5leHBvcnQgY2xhc3MgRGF0YWdyaWRDZWxsRWRpdGFibGVEaXJlY3RpdmUgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSwgT25DaGFuZ2VzLCBBZnRlclZpZXdJbml0IHtcclxuICAgIEBJbnB1dCgnY2VsbC1lZGl0YWJsZScpIHJvd0RhdGE6IGFueTtcclxuICAgIEBJbnB1dCgpIGNvbHVtbjogRGF0YUNvbHVtbjtcclxuXHJcbiAgICBwcml2YXRlIGNsaWNrVGltZXI6IGFueTtcclxuXHJcbiAgICBwcml2YXRlIGNlbGxjbGljazogYW55O1xyXG4gICAgcHJpdmF0ZSBjZWxsZGJsY2xpY2s6IGFueTtcclxuICAgIHByaXZhdGUgYmluZENlbGxFdmVudFN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xyXG5cclxuICAgIHByaXZhdGUgZWRpdG9ySW5wdXRLZXlkb3duRXZlbnQ6IGFueTtcclxuICAgIGVkaXRvcjogYW55O1xyXG4gICAgZm9ybUNvbnRyb2w6IEZvcm1Db250cm9sO1xyXG4gICAgY2VsbEVkaXRvclJlZjogYW55O1xyXG4gICAgLy8gZ2V0IGVkaXRvcigpIHtcclxuICAgIC8vICAgICBpZiAodGhpcy5kYy5jZWxsRWRpdG9yKSB7XHJcbiAgICAvLyAgICAgICAgIGNvbnN0IF9lZGl0b3IgPSB0aGlzLmRjLmNlbGxFZGl0b3IuY29tcG9uZW50UmVmLmluc3RhbmNlO1xyXG4gICAgLy8gICAgICAgICB0aGlzLmRnLnBlbmRpbmcgPSBfZWRpdG9yLnBlbmRpbmc7XHJcbiAgICAvLyAgICAgICAgIHJldHVybiBfZWRpdG9yO1xyXG4gICAgLy8gICAgIH1cclxuICAgIC8vICAgICByZXR1cm4gbnVsbDtcclxuICAgIC8vIH1cclxuXHJcbiAgICAvLyBnZXQgZm9ybUNvbnRyb2woKSB7XHJcbiAgICAvLyAgICAgaWYgKHRoaXMuZWRpdG9yKSB7XHJcbiAgICAvLyAgICAgICAgIHJldHVybiB0aGlzLmVkaXRvci5mb3JtQ29udHJvbCBhcyBGb3JtQ29udHJvbDtcclxuICAgIC8vICAgICB9XHJcbiAgICAvLyAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAvLyB9XHJcblxyXG4gICAgQENvbnRlbnRDaGlsZChEYXRhZ3JpZENlbGxDb21wb25lbnQpIGRjOiBEYXRhZ3JpZENlbGxDb21wb25lbnQ7XHJcbiAgICBwcml2YXRlIGRnYjogRGF0YWdyaWRCb2R5Q29tcG9uZW50O1xyXG4gICAgcHJpdmF0ZSBkcjogRGF0YWdyaWRSb3dEaXJlY3RpdmU7XHJcbiAgICBwcml2YXRlIGRmczogRGF0YWdyaWRGYWNhZGVTZXJ2aWNlO1xyXG4gICAgcHJpdmF0ZSBkZ3M6IERhdGFncmlkU2VydmljZTtcclxuXHJcbiAgICAvLyBwcml2YXRlIF9yZWFkb25seSQgPSBudWxsO1xyXG4gICAgcHJpdmF0ZSBjZWxsRWRpdG9yQ3JlYXRlZFN1YnNjcmlwdGlvbiA9IG51bGw7XHJcbiAgICBwcml2YXRlIGNlbGxFZGl0b3JEZXN0b3J5U3Vic2NyaXB0aW9uID0gbnVsbDtcclxuICAgIHByaXZhdGUgZGVzdHJveSQgPSBuZXcgU3ViamVjdCgpO1xyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IsIHB1YmxpYyBlbDogRWxlbWVudFJlZiwgcHJpdmF0ZSByZW5kZXI6IFJlbmRlcmVyMixcclxuICAgICAgICBASW5qZWN0KGZvcndhcmRSZWYoKCkgPT4gRGF0YWdyaWRDb21wb25lbnQpKSBwdWJsaWMgZGc6IERhdGFncmlkQ29tcG9uZW50LCBwdWJsaWMgbmdab25lOiBOZ1pvbmUpIHtcclxuICAgICAgICB0aGlzLmRnYiA9IHRoaXMuaW5qZWN0b3IuZ2V0KERhdGFncmlkQm9keUNvbXBvbmVudCk7XHJcbiAgICAgICAgdGhpcy5kciA9IHRoaXMuaW5qZWN0b3IuZ2V0KERhdGFncmlkUm93RGlyZWN0aXZlKTtcclxuICAgICAgICB0aGlzLmRmcyA9IHRoaXMuaW5qZWN0b3IuZ2V0KERhdGFncmlkRmFjYWRlU2VydmljZSk7XHJcbiAgICAgICAgdGhpcy5kZ3MgPSB0aGlzLmluamVjdG9yLmdldChEYXRhZ3JpZFNlcnZpY2UpO1xyXG5cclxuXHJcbiAgICAgICAgaWYgKCF0aGlzLmNlbGxFZGl0b3JDcmVhdGVkU3Vic2NyaXB0aW9uKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2VsbEVkaXRvckNyZWF0ZWRTdWJzY3JpcHRpb24gPSB0aGlzLmRncy5jZWxsRWRpdG9yQ3JlYXRlZC5waXBlKFxyXG4gICAgICAgICAgICAgICAgdGFrZVVudGlsKHRoaXMuZGVzdHJveSQpXHJcbiAgICAgICAgICAgICkucGlwZShcclxuICAgICAgICAgICAgICAgIGZpbHRlcigoeyBjb2x1bW4sIGVkaXRvclJlZiwgY2VsbEVkaXRvclJlZiwgdGVtcGxhdGVSZWYgfSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjb2x1bW4uZmllbGQgPT09IHRoaXMuY29sdW1uLmZpZWxkICYmIHRoaXMuZGcuc2VsZWN0ZWRSb3cuaWQgPT09IHRoaXMuZHIucm93SWQ7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICApLnN1YnNjcmliZSgoeyBlZGl0b3JSZWYsIGNlbGxFZGl0b3JSZWYsIHRlbXBsYXRlUmVmIH0pID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChlZGl0b3JSZWYpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzWydlZGl0b3InXSA9IGVkaXRvclJlZi5pbnN0YW5jZTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzWydmb3JtQ29udHJvbCddID0gdGhpcy5lZGl0b3IuZm9ybUNvbnRyb2wgYXMgRm9ybUNvbnRyb2w7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jZWxsRWRpdG9yUmVmID0gY2VsbEVkaXRvclJlZjtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmVtaXRCZWdpbkVkaXQoKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpc1snZm9ybUNvbnRyb2wnXSA9IHRoaXMuZHIuZm9ybS5nZXQodGhpcy5jb2x1bW4uZmllbGQpIGFzIEZvcm1Db250cm9sO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYmluZEVkaXRvcklucHV0RXZlbnQoKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRnLmJlZ2luRWRpdC5lbWl0KHsgZWRpdG9yOiBudWxsLCBjb2x1bW46IHRoaXMuY29sdW1uLCByb3dEYXRhOiB0aGlzLnJvd0RhdGEsIGdyaWRJbnN0YW5jZTogdGhpcy5kZywgdGVtcGxhdGU6IHRlbXBsYXRlUmVmIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgdGhpcy5kZy5kZ3MuY2VsbEVkaXRvckRlc3RvcnkucGlwZShcclxuICAgICAgICAgICAgdGFrZVVudGlsKHRoaXMuZGVzdHJveSQpXHJcbiAgICAgICAgKS5waXBlKFxyXG4gICAgICAgICAgICBmaWx0ZXIoKHsgY29sdW1uIH0pID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmRnLnNlbGVjdGVkUm93ICYmIGNvbHVtbi5maWVsZCA9PT0gdGhpcy5jb2x1bW4uZmllbGQgJiYgdGhpcy5kZy5zZWxlY3RlZFJvdy5pZCA9PT0gdGhpcy5kci5yb3dJZDtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICApLnN1YnNjcmliZSgoZTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmRnLmVkaXRNb2RlID09PSAnY2VsbCcpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGcuc2VsZWN0ZWRSb3cuZWRpdG9ycyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZGcuY3VycmVudENlbGwpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRnLmN1cnJlbnRDZWxsLmVkaXRvciA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZy5jdXJyZW50Q2VsbC5jZWxsRWRpdG9yUmVmID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLnVuQmluZEVkaXRvcklucHV0RXZlbnQoKTtcclxuICAgICAgICAgICAgdGhpcy5jZWxsRWRpdG9yUmVmID0gbnVsbDtcclxuICAgICAgICAgICAgdGhpcy5mb3JtQ29udHJvbCA9IG51bGw7XHJcbiAgICAgICAgICAgIHRoaXMuZWRpdG9yID0gbnVsbDtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKSB7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xyXG4gICAgICAgIGlmIChjaGFuZ2VzLnJvd0RhdGEgJiYgIWNoYW5nZXMucm93RGF0YS5pc0ZpcnN0Q2hhbmdlKCkpIHtcclxuICAgICAgICAgICAgdGhpcy5zZXRDZWxsQ2xzV2l0aEVkaXRvclR5cGUoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbmdBZnRlclZpZXdJbml0KCkge1xyXG4gICAgICAgIHRoaXMuaW5pdENlbGxFdmVudCgpO1xyXG4gICAgICAgIHRoaXMuc2V0Q2VsbENsc1dpdGhFZGl0b3JUeXBlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBpbml0Q2VsbEV2ZW50KCkge1xyXG4gICAgICAgIC8vIHRoaXMuY2VsbGNsaWNrID0gdGhpcy5yZW5kZXIubGlzdGVuKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgJ2NsaWNrJywgKGUpID0+IHRoaXMub25DbGlja0NlbGwoZSkpO1xyXG4gICAgICAgIGlmICh0aGlzLmNvbHVtbiAmJiAodGhpcy5jb2x1bW4uZWRpdG9yIHx8IHRoaXMuY29sdW1uLmVkaXRvclRlbXBsYXRlKSkge1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuZGcuY2xpY2tUb0VkaXQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2VsbGRibGNsaWNrID0gdGhpcy5yZW5kZXIubGlzdGVuKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgJ2RibGNsaWNrJywgKGUpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm9uRGJsQ2xpY2tDZWxsKGUpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5lbC5uYXRpdmVFbGVtZW50LmVkaXQgPSAoZSkgPT4gdGhpcy5vbkNsaWNrQ2VsbChlKTtcclxuICAgICAgICAgICAgdGhpcy5lbC5uYXRpdmVFbGVtZW50LmVkaXRDZWxsID0gKGUpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMub3BlbkNlbGxFZGl0b3IoKTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmNsaWNrVGltZXIgPSAwO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuZ3JpZENlbGxEYXRhID0geyByb3dEYXRhOiB0aGlzLnJvd0RhdGEsIHJvd0luZGV4OiB0aGlzLmRyLnJvd0luZGV4IH07XHJcbiAgICAgICAgdGhpcy5lbC5uYXRpdmVFbGVtZW50LmNsb3NlRWRpdCA9ICgpID0+IHRoaXMuY2xvc2VFZGl0aW5nQ2VsbCgpO1xyXG4gICAgICAgIHRoaXMuZWwubmF0aXZlRWxlbWVudC5zZWxlY3RDZWxsID0gKGUsIGVsKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmRnLmRpc2FibGVSb3cgJiYgdGhpcy5kZy5kaXNhYmxlUm93KHRoaXMucm93RGF0YSwgdGhpcy5kci5yb3dJbmRleCkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuZGcuY3VycmVudENlbGwgJiYgdGhpcy5kZy5jdXJyZW50Q2VsbC5jZWxsRWxlbWVudC5pZCA9PT0gZWwuaWQgJiYgIXRoaXMuZGcua2VlcFNlbGVjdCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kZy5jYW5jZWxTZWxlY3RDZWxsKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdENlbGwodGhpcy5jb2x1bW4uZmllbGQsIGVsKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGcuY2VsbENsaWNrLmVtaXQoeyBjb2x1bW46IHRoaXMuY29sdW1uLCByb3dEYXRhOiB0aGlzLnJvd0RhdGEsIGdyaWRJbnN0YW5jZTogdGhpcy5kZywgZXZlbnQ6IGUgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIHRoaXMuZWwubmF0aXZlRWxlbWVudC5jYW5jZWxTZWxlY3RlZCA9ICgpID0+IHtcclxuICAgICAgICAgICAgLy8gRG9tSGFuZGxlci5yZW1vdmVDbGFzcyh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsIENFTExfU0VMRUNURURfQ0xTKTtcclxuICAgICAgICAgICAgLy8gRG9tSGFuZGxlci5yZW1vdmVDbGFzcyh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsIENFTExfRURJVElOR19DTFMpO1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlci5yZW1vdmVDbGFzcyh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsIENFTExfU0VMRUNURURfQ0xTKTtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXIucmVtb3ZlQ2xhc3ModGhpcy5lbC5uYXRpdmVFbGVtZW50LCBDRUxMX0VESVRJTkdfQ0xTKTtcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25EZXN0cm95KCkge1xyXG4gICAgICAgIHRoaXMuZGVzdHJveSQubmV4dCgpO1xyXG4gICAgICAgIHRoaXMuZGVzdHJveSQuY29tcGxldGUoKTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuY2VsbGNsaWNrKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2VsbGNsaWNrKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5jZWxsZGJsY2xpY2spIHtcclxuICAgICAgICAgICAgdGhpcy5jZWxsZGJsY2xpY2soKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMudW5CaW5kRWRpdG9ySW5wdXRFdmVudCgpO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5iaW5kQ2VsbEV2ZW50U3Vic2NyaXB0aW9uKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYmluZENlbGxFdmVudFN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICB0aGlzLmJpbmRDZWxsRXZlbnRTdWJzY3JpcHRpb24gPSBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuY2VsbEVkaXRvckNyZWF0ZWRTdWJzY3JpcHRpb24pIHtcclxuICAgICAgICAgICAgdGhpcy5jZWxsRWRpdG9yQ3JlYXRlZFN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICB0aGlzLmNlbGxFZGl0b3JDcmVhdGVkU3Vic2NyaXB0aW9uID0gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmNlbGxFZGl0b3JEZXN0b3J5U3Vic2NyaXB0aW9uKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2VsbEVkaXRvckRlc3RvcnlTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgdGhpcy5jZWxsRWRpdG9yRGVzdG9yeVN1YnNjcmlwdGlvbiA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmVkaXRvciA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5jZWxsRWRpdG9yUmVmID0gbnVsbDtcclxuICAgICAgICB0aGlzLmZvcm1Db250cm9sID0gbnVsbDtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZWwpIHtcclxuICAgICAgICAgICAgdGhpcy5lbC5uYXRpdmVFbGVtZW50LmNhbmNlbFNlbGVjdGVkID0gbm9vcDtcclxuICAgICAgICAgICAgdGhpcy5lbC5uYXRpdmVFbGVtZW50LnNlbGVjdENlbGwgPSBub29wO1xyXG4gICAgICAgICAgICB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuY2xvc2VFZGl0ID0gbm9vcDtcclxuICAgICAgICAgICAgdGhpcy5lbC5uYXRpdmVFbGVtZW50LmdyaWRDZWxsRGF0YSA9IG5vb3A7XHJcbiAgICAgICAgICAgIHRoaXMuZWwubmF0aXZlRWxlbWVudC5lZGl0ID0gbm9vcDtcclxuICAgICAgICAgICAgdGhpcy5lbC5uYXRpdmVFbGVtZW50LnNlbGVjdENlbGwgPSBub29wO1xyXG4gICAgICAgICAgICB0aGlzLmVsID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBpc0RpZmZlcmVudENlbGwoKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmRnLmN1cnJlbnRDZWxsKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5kZy5zZWxlY3RlZFJvdyB8fCB0aGlzLmRnLnNlbGVjdGVkUm93LmluZGV4ICE9PSB0aGlzLmRyLnJvd0luZGV4KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRyLnJvd0luZGV4ICE9PSB0aGlzLmRnLmN1cnJlbnRDZWxsLnJvd0luZGV4KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmRnLmN1cnJlbnRDZWxsLmZpZWxkICE9PSB0aGlzLmNvbHVtbi5maWVsZDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIG9uQ2xpY2tDZWxsKGV2ZW50OiBhbnkpIHtcclxuICAgICAgICAvLyDlhbPpl63lhbbku5ZHcmlkIOeahOe8lui+keWZqFxyXG4gICAgICAgIGRvY3VtZW50LmJvZHkuY2xpY2soKTtcclxuXHJcbiAgICAgICAgdGhpcy5kZy5iZWZvcmVDbGlja0NlbGwuZW1pdCh7IHJvd0luZGV4OiB0aGlzLmRyLnJvd0luZGV4LCByb3dEYXRhOiB0aGlzLnJvd0RhdGEsIGNvbHVtbjogdGhpcy5jb2x1bW4sIGdyaWRJbnN0YW5jZTogdGhpcy5kZyB9KTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZHIuZGlzYWJsZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gMjAyMTA0MjJcclxuICAgICAgICAvLyBpZiAodGhpcy5kZy5jbG9zZU90aGVyR3JpZEVkaXRvcikge1xyXG4gICAgICAgIC8vICAgICBkb2N1bWVudC5ib2R5LmNsaWNrKCk7XHJcbiAgICAgICAgLy8gfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5kZy5kaXNhYmxlZCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLmRnLmVkaXRhYmxlIHx8IHRoaXMuaXNSZWFkb25seSgpKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kZy5lbmFibGVIaWdobGlnaHRDZWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZy5lbmRFZGl0aW5nKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RDZWxsKHRoaXMuY29sdW1uLmZpZWxkKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRnLmVkaXRNb2RlID09PSAncm93Jykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZGcuc2VsZWN0aW9uTW9kZSA9PT0gJ2RlZmF1bHQnICYmIGV2ZW50KSB7XHJcbiAgICAgICAgICAgIGlmIChldmVudC5jdHJsS2V5IHx8IGV2ZW50LnNoaWZ0S2V5KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICBpZiAoZXZlbnQudGFyZ2V0Wydub2RlTmFtZSddID09PSAnSU5QVVQnKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBpZiAodGhpcy5kZy5jbGlja1RvRWRpdCAmJiAhdGhpcy5kZy5kYmxjbGlja1Jvdy5vYnNlcnZlcnMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGcuY2xpY2tEZWxheSA9IDA7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgdGhpcy5yZW5kZXIuYWRkQ2xhc3ModGhpcy5kZy5lbC5uYXRpdmVFbGVtZW50LCAnZi1kYXRhZ3JpZC11bnNlbGVjdCcpO1xyXG5cclxuICAgICAgICBpZiAoIXRoaXMuZGcuaXNTaW5nbGVDbGljayAmJiB0aGlzLmRnLmVkaXRNb2RlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGcuaXNTaW5nbGVDbGljayA9IHRydWU7XHJcbiAgICAgICAgICAgIHRoaXMuY2xpY2tUaW1lciA9IHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZGcuaXNTaW5nbGVDbGljayAmJiB0aGlzLmRnLmVkaXRhYmxlICYmIHRoaXMuZGcuZWRpdE1vZGUgPT09ICdjZWxsJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGcuaXNTaW5nbGVDbGljayA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLmNsaWNrVGltZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGlmICghdGhpcy5jbG9zZUVkaXRpbmdDZWxsKCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIH1cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlRWRpdGluZ0NlbGwoKS5waXBlKHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKSkuc3Vic2NyaWJlKChmOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGYpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmRnLmNsaWNrVG9FZGl0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vcGVuQ2VsbEVkaXRvcigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdENlbGwodGhpcy5jb2x1bW4uZmllbGQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIucmVtb3ZlQ2xhc3ModGhpcy5kZy5lbC5uYXRpdmVFbGVtZW50LCAnZi1kYXRhZ3JpZC11bnNlbGVjdCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCB0aGlzLmRnLmNsaWNrRGVsYXkpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIG9uRGJsQ2xpY2tDZWxsKGV2ZW50OiBNb3VzZUV2ZW50KSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZGcuZGlzYWJsZWQgfHwgdGhpcy5pc1JlYWRvbmx5KCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGV2ZW50LnRhcmdldFsnbm9kZU5hbWUnXSA9PT0gJ0lOUFVUJyB8fCBldmVudC50YXJnZXRbJ25vZGVOYW1lJ10gPT09ICdURVhUQVJFQScpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5kZy5lZGl0YWJsZSAmJiB0aGlzLmRnLmVkaXRNb2RlID09PSAnY2VsbCcpIHtcclxuICAgICAgICAgICAgLy8gaWYgKCF0aGlzLmNsb3NlRWRpdGluZ0NlbGwoKSkge1xyXG4gICAgICAgICAgICAvLyAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAvLyB9XHJcbiAgICAgICAgICAgIHRoaXMuY2xvc2VFZGl0aW5nQ2VsbCgpLnBpcGUodGFrZVVudGlsKHRoaXMuZGVzdHJveSQpKS5zdWJzY3JpYmUoZiA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZikge1xyXG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9wZW5DZWxsRWRpdG9yKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5jbGlja1RpbWVyKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGcuaXNTaW5nbGVDbGljayA9IGZhbHNlO1xyXG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5jbGlja1RpbWVyKTtcclxuICAgICAgICAgICAgdGhpcy5jbGlja1RpbWVyID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaXNSZWFkb25seShjb2wgPSB0aGlzLmNvbHVtbikge1xyXG4gICAgICAgIGlmICh0aGlzLmRnLmVkaXRhYmxlKSB7XHJcbiAgICAgICAgICAgIC8vIOWPguS4juWQiOW5tueahOWNleWFg+agvOS4jeWFgeiuuOe8lui+kVxyXG4gICAgICAgICAgICBpZiAodGhpcy5kZy5tZXJnZUNlbGwgJiYgdGhpcy5kZy5tZXJnZUZpZWxkcy5pbmRleE9mKGNvbC5maWVsZCkgPiAtMSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0UmVhZG9ubHlWYWx1ZShjb2wpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldFJlYWRvbmx5VmFsdWUoY29sID0gdGhpcy5jb2x1bW4pIHtcclxuICAgICAgICBpZiAoY29sLnJlYWRvbmx5ICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBjb2wucmVhZG9ubHkgPT09ICdib29sZWFuJykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbC5yZWFkb25seTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgY29sLnJlYWRvbmx5ID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY29sLnJlYWRvbmx5KHRoaXMucm93RGF0YSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIG9wZW5DZWxsRWRpdG9yKCkge1xyXG4gICAgICAgIC8vIOW9k+WJjeihjOemgeeUqO+8jOS4jeWFgeiuuOe8lui+keOAglxyXG4gICAgICAgIGlmICh0aGlzLmRyLmRpc2FibGVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICgoIXRoaXMuY29sdW1uLmVkaXRvciAmJiAhdGhpcy5jb2x1bW4uZWRpdG9yVGVtcGxhdGUpIHx8ICF0aGlzLmRnLmVkaXRhYmxlIHx8IHRoaXMuaXNSZWFkb25seSgpKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmRnLnNlbGVjdGlvbk1vZGUgPT09ICdkZWZhdWx0JyAmJiB0aGlzLmRnLm11bHRpU2VsZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRnLmNsZWFyQ2hlY2tlZHMoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdENlbGwodGhpcy5jb2x1bW4uZmllbGQpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBiZWZvcmVFZGl0RXZlbnQgPSB0aGlzLmRnLmJlZm9yZUVkaXQoeyByb3dJbmRleDogdGhpcy5kci5yb3dJbmRleCwgcm93RGF0YTogdGhpcy5yb3dEYXRhLCBjb2x1bW46IHRoaXMuY29sdW1uLCBncmlkSW5zdGFuY2U6IHRoaXMuZGcgfSk7XHJcbiAgICAgICAgaWYgKCFiZWZvcmVFZGl0RXZlbnQgfHwgIWJlZm9yZUVkaXRFdmVudC5zdWJzY3JpYmUpIHtcclxuICAgICAgICAgICAgdGhpcy5kZy53cml0ZUNvbnNvbGUoJ3BsZWFzZSByZXR1cm4gYW4gT2JzZXJ2YWJsZSBUeXBlLicpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5kZy5jdXJyZW50Q2VsbCkge1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuZGcuY3VycmVudENlbGwuY2VsbFJlZiB8fCB0aGlzLmRnLmN1cnJlbnRDZWxsLmNlbGxSZWYuY29sdW1uLmZpZWxkICE9PSB0aGlzLmNvbHVtbi5maWVsZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kZy5jdXJyZW50Q2VsbC5jZWxsUmVmID0gdGhpcy5kYztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGJlZm9yZUVkaXRFdmVudC5waXBlKHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKSkuc3Vic2NyaWJlKChmbGFnKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChmbGFnKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0RpZmZlcmVudENlbGwoKSkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kZy5zZWxlY3Rpb25Nb2RlID09PSAnZGVmYXVsdCcgJiYgdGhpcy5kZy5tdWx0aVNlbGVjdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRnLmNsZWFyQ2hlY2tlZHMoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0Q2VsbCh0aGlzLmNvbHVtbi5maWVsZCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5kZnMuZWRpdENlbGwoKTtcclxuICAgICAgICAgICAgICAgIC8vIHRoaXMuZW1pdEJlZ2luRWRpdCgpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RDZWxsKHRoaXMuY29sdW1uLmZpZWxkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZW1pdEJlZ2luRWRpdCgpIHtcclxuXHJcbiAgICAgICAgY29uc3QgX2NlbGxFZGl0b3JSZWYgPSB0aGlzLmNlbGxFZGl0b3JSZWYgfHwgdGhpcy5kYy5jZWxsRWRpdG9yO1xyXG5cclxuICAgICAgICB0aGlzLnJlbmRlci5yZW1vdmVDbGFzcyh0aGlzLmRnLmVsLm5hdGl2ZUVsZW1lbnQsICdmLWRhdGFncmlkLXVuc2VsZWN0Jyk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmRnLmVkaXRNb2RlID09PSAnY2VsbCcpIHtcclxuICAgICAgICAgICAgdGhpcy5kZy5zZWxlY3RlZFJvdy5lZGl0b3JzID0gW3RoaXMuZWRpdG9yXTtcclxuICAgICAgICAgICAgdGhpcy5kZy5jdXJyZW50Q2VsbC5lZGl0b3IgPSB0aGlzLmVkaXRvcjtcclxuICAgICAgICAgICAgdGhpcy5kZy5jdXJyZW50Q2VsbC5jZWxsRWRpdG9yUmVmID0gX2NlbGxFZGl0b3JSZWY7XHJcbiAgICAgICAgICAgIHRoaXMuYmluZEVkaXRvcklucHV0RXZlbnQoKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyLmFkZENsYXNzKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgQ0VMTF9FRElUSU5HX0NMUyk7XHJcblxyXG4gICAgICAgICAgICAvLyB0aGlzLmZvcm1Db250cm9sLnNldFZhbHVlKHRoaXMuZGMudmFsdWUpO1xyXG4gICAgICAgICAgICB0aGlzLmRnLmJlZ2luRWRpdC5lbWl0KHsgZWRpdG9yOiBfY2VsbEVkaXRvclJlZiwgY29sdW1uOiB0aGlzLmNvbHVtbiwgcm93RGF0YTogdGhpcy5yb3dEYXRhLCBncmlkSW5zdGFuY2U6IHRoaXMuZGcgfSk7XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5jb2x1bW4uZWRpdG9yLnR5cGUgPT09ICd0ZXh0YXJlYScgJiYgdGhpcy5jb2x1bW4uZWRpdG9yLm9wdGlvbnMgJiYgdGhpcy5jb2x1bW4uZWRpdG9yLm9wdGlvbnMuZWRpdFR5cGUgPT09ICdkaWFsb2cnKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmVkaXRvci5zaG93RGlhbG9nKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmRyICYmICF0aGlzLmRnLm5vd3JhcCkge1xyXG4gICAgICAgICAgICB0aGlzLmRyLnVwZGF0ZVJvd0hlaWdodCgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjbG9zZUVkaXRpbmdDZWxsKCkge1xyXG4gICAgICAgIGlmICghdGhpcy5kZy5pc0NlbGxFZGl0aW5nKCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IGN1cnJlbnRDZWxsID0gbnVsbDtcclxuICAgICAgICBsZXQgZWRpdG9yOiBhbnkgPSBudWxsO1xyXG4gICAgICAgIGlmICh0aGlzLmRnLmN1cnJlbnRDZWxsKSB7XHJcbiAgICAgICAgICAgIC8vIHRoaXMuZGcuY3VycmVudENlbGwuaXNFZGl0aW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgIC8vIHRoaXMuZGZzLmdldEN1cnJlbnRDZWxsKCkuaXNFZGl0aW5nID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICBjdXJyZW50Q2VsbCA9IHRoaXMuZGcuY3VycmVudENlbGwuY2VsbFJlZiBhcyBEYXRhZ3JpZENlbGxDb21wb25lbnQ7XHJcbiAgICAgICAgICAgIGlmIChjdXJyZW50Q2VsbCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFjdXJyZW50Q2VsbC5pc0VkaXRpbmcpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2YodHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRDZWxsLmNlbGxFZGl0b3IgJiYgY3VycmVudENlbGwuY2VsbEVkaXRvci5jb21wb25lbnRSZWYgJiYgIWN1cnJlbnRDZWxsLmNvbHVtbi5lZGl0b3JUZW1wbGF0ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGVkaXRvciA9IGN1cnJlbnRDZWxsLmNlbGxFZGl0b3IuY29tcG9uZW50UmVmLmluc3RhbmNlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoZWRpdG9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOaJp+ihjGJsdXIg5LqL5Lu2XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlZGl0b3IuaW5wdXRFbGVtZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkb21OYW1lID0gZWRpdG9yLmlucHV0RWxlbWVudC5ub2RlTmFtZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGJsdXJGbiA9ICBlZGl0b3Iub3B0aW9ucyAmJiBlZGl0b3Iub3B0aW9ucy5vbkJsdXI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYmx1ckZuKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChkb21OYW1lID09PSAnSU5QVVQnIHx8IGRvbU5hbWUgPT09ICdURVhUQVJFQScpICYmICB0aGlzLmRnWydmb2N1c0VsZW1lbnQnXSA9PT0gZWRpdG9yLmlucHV0RWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBibHVyRm4oeyBlZGl0b3JSZWY6IGVkaXRvciwgcm93RGF0YTogY3VycmVudENlbGwucm93RGF0YX0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlZGl0b3IuaW5wdXRFbGVtZW50LmJsdXIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZGl0b3IuaW5wdXRFbGVtZW50LmJsdXIoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRnWydmb2N1c0VsZW1lbnQnXSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlZGl0b3IuYmx1cikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWRpdG9yLmJsdXIoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVkaXRvci5wZW5kaW5nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2YoZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWRpdG9yLmZvcm1Db250cm9sKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWRpdG9yLmZvcm1Db250cm9sLnBlbmRpbmcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2YoZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlZGl0b3IuZm9ybUNvbnRyb2wgJiYgZWRpdG9yLmZvcm1Db250cm9sLmludmFsaWQgJiYgIXRoaXMuZGcuZW5kRWRpdEJ5SW52YWxpZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvZihmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2YodHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2YodHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5kZy5pc1NpbmdsZUNsaWNrID0gZmFsc2U7XHJcbiAgICAgICAgY29uc3QgX2NvbF8gPSAoZWRpdG9yIHx8IGN1cnJlbnRDZWxsKS5jb2x1bW47XHJcbiAgICAgICAgY29uc3QgYWZ0ZXJFZGl0RXZlbnQgPSB0aGlzLmRnLmFmdGVyRWRpdChjdXJyZW50Q2VsbC5yb3dJbmRleCwgY3VycmVudENlbGwucm93RGF0YSwgX2NvbF8sIGVkaXRvcik7XHJcbiAgICAgICAgaWYgKCFhZnRlckVkaXRFdmVudCB8fCAhYWZ0ZXJFZGl0RXZlbnQuc3Vic2NyaWJlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGcud3JpdGVDb25zb2xlKCdwbGVhc2UgcmV0dXJuIGFuIE9ic2VydmFibGUgVHlwZS4nKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IGNlbGxFbmRFZGl0ID0gb2YodW5kZWZpbmVkKTtcclxuXHJcbiAgICAgICAgYWZ0ZXJFZGl0RXZlbnQucGlwZSh0YWtlVW50aWwodGhpcy5kZXN0cm95JCkpLnN1YnNjcmliZSgoZmxhZzogYm9vbGVhbikgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZmxhZykge1xyXG4gICAgICAgICAgICAgICAgbGV0IHZhbCA9IGN1cnJlbnRDZWxsLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRDZWxsICYmIGN1cnJlbnRDZWxsLmZvcm1Db250cm9sICYmIHZhbCAhPT0gY3VycmVudENlbGwuZm9ybUNvbnRyb2wudmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YWwgPSBjdXJyZW50Q2VsbC5mb3JtQ29udHJvbC52YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50Q2VsbC5pc0VkaXRpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50Q2VsbC51cGRhdGVWYWx1ZSh2YWwpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGhpcy5kZnMuZW5kRWRpdENlbGwoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGdzLm9uRW5kQ2VsbEVkaXQodGhpcy5kZnMuZ2V0Q3VycmVudENlbGwoKSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnVuQmluZEVkaXRvcklucHV0RXZlbnQoKTtcclxuICAgICAgICAgICAgICAgIC8vIOenu+mZpOe8lui+keagt+W8j1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIucmVtb3ZlQ2xhc3ModGhpcy5lbC5uYXRpdmVFbGVtZW50LCBDRUxMX0VESVRJTkdfQ0xTKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kZy5zZWxlY3RlZFJvdykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGcuc2VsZWN0ZWRSb3cuZWRpdG9ycyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy8gdGhpcy5kZy5zZWxlY3RlZFJvdy5kYXRhID0gdGhpcy5yb3dEYXRhO1xyXG4gICAgICAgICAgICAgICAgLy8g5pu05paw6KGM5qC35byP5oiW6ICF5Y2V5YWD5qC85qC35byPXHJcbiAgICAgICAgICAgICAgICB0aGlzLmRmcy5yb3dVcGRhdGUkLm5leHQoeyBpbmRleDogY3VycmVudENlbGwucm93SW5kZXgsIGRhdGE6IGN1cnJlbnRDZWxsLnJvd0RhdGEsIGNlbGxSZWY6IGN1cnJlbnRDZWxsIH0pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kZy5lbmRFZGl0LmVtaXQoeyByb3dJbmRleDogY3VycmVudENlbGwucm93SW5kZXgsIHJvd0RhdGE6IGN1cnJlbnRDZWxsLnJvd0RhdGEsIGNvbHVtbjogX2NvbF8sIHZhbHVlOiB2YWwgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8g5pu05pawZm9vdGVyRGF0YVxyXG4gICAgICAgICAgICAgICAgdGhpcy5kZ3MucmVmcmVzaEZvb3RlckRhdGEuZW1pdCgpO1xyXG4gICAgICAgICAgICAgICAgY2VsbEVuZEVkaXQgPSBvZih0cnVlKTtcclxuICAgICAgICAgICAgICAgIC8vIOWIt+aWsOihjOaVsOaNrlxyXG4gICAgICAgICAgICAgICAgLy8gdGhpcy5kci5yZWZyZXNoKCk7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kZy5zZWxlY3RlZFJvdyAmJiB0aGlzLmRnLnNlbGVjdGVkUm93LmRyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZy5zZWxlY3RlZFJvdy5kci5yZWZyZXNoKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRDZWxsICYmIGN1cnJlbnRDZWxsLmNlbGxFZGl0b3IpIHtcclxuICAgICAgICAgICAgICAgICAgICBlZGl0b3IgPSBjdXJyZW50Q2VsbC5jZWxsRWRpdG9yLmNvbXBvbmVudFJlZi5pbnN0YW5jZTtcclxuICAgICAgICAgICAgICAgICAgICBlZGl0b3IuaW5wdXRFbGVtZW50LmZvY3VzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY2VsbEVuZEVkaXQgPSBvZihmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGNlbGxFbmRFZGl0ID0gb2YodHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gY2VsbEVuZEVkaXQ7XHJcbiAgICB9XHJcblxyXG4gICAgY2FuY2VsQ2VsbEVkaXRpbmcoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZGcuY3VycmVudENlbGwgJiYgdGhpcy5kZy5jdXJyZW50Q2VsbC5pc0VkaXRpbmcgJiYgdGhpcy5kZy5zZWxlY3RlZFJvdy5pbmRleCA+IC0xKSB7XHJcbiAgICAgICAgICAgIC8vIHRoaXMuZGZzLnJlc2V0Um93KHRoaXMuZGcuc2VsZWN0ZWRSb3cuaWQpO1xyXG4gICAgICAgICAgICB0aGlzLmRjLnJvd0RhdGEgPSB0aGlzLmRnLnNlbGVjdGVkUm93LmRhdGE7XHJcbiAgICAgICAgICAgIHRoaXMuZm9ybUNvbnRyb2wucmVzZXQoVXRpbHMuZ2V0VmFsdWUodGhpcy5jb2x1bW4uZmllbGQsIHRoaXMuZGMucm93RGF0YSkpO1xyXG4gICAgICAgICAgICB0aGlzLmNsb3NlRWRpdGluZ0NlbGwoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGJpbmRFZGl0b3JJbnB1dEV2ZW50KCkge1xyXG4gICAgICAgIGNvbnN0IGNlUmVmID0gdGhpcy5jZWxsRWRpdG9yUmVmIHx8IHRoaXMuZGMuY2VsbEVkaXRvcjtcclxuICAgICAgICBsZXQgaW5wdXQgPSBudWxsO1xyXG4gICAgICAgIGlmIChjZVJlZikge1xyXG4gICAgICAgICAgICBpbnB1dCA9IGNlUmVmLmNvbXBvbmVudFJlZi5pbnN0YW5jZS5pbnB1dEVsZW1lbnQ7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuY29sdW1uLmVkaXRvclRlbXBsYXRlKSB7XHJcbiAgICAgICAgICAgICAgICBpbnB1dCA9IHRoaXMuZGMuZWwubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCdpbnB1dCx0ZXh0YXJlYScpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChpbnB1dCkge1xyXG4gICAgICAgICAgICBpbnB1dC5mb2N1cygpO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5kZy5zZWxlY3RPbkVkaXRpbmcgJiYgdGhpcy5jb2x1bW4uZWRpdG9yVGVtcGxhdGUpIHtcclxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpbnB1dC5zZWxlY3QpIHsgaW5wdXQuc2VsZWN0KCk7IH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLmVkaXRvcklucHV0S2V5ZG93bkV2ZW50ID0gdGhpcy5yZW5kZXIubGlzdGVuKGlucHV0LCAna2V5ZG93bicsIChlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm9uS2V5RG93bkZvcklucHV0KGUpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdW5CaW5kRWRpdG9ySW5wdXRFdmVudCgpIHtcclxuICAgICAgICBpZiAodGhpcy5lZGl0b3JJbnB1dEtleWRvd25FdmVudCkge1xyXG4gICAgICAgICAgICB0aGlzLmVkaXRvcklucHV0S2V5ZG93bkV2ZW50KCk7XHJcbiAgICAgICAgICAgIHRoaXMuZWRpdG9ySW5wdXRLZXlkb3duRXZlbnQgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBvbktleURvd25Gb3JJbnB1dChlOiBLZXlib2FyZEV2ZW50KSB7XHJcbiAgICAgICAgY29uc3Qga2V5Q29kZSA9IGUua2V5Q29kZTtcclxuICAgICAgICBpZiAoZS5hbHRLZXkgfHwgZS5jdHJsS2V5KSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCh0aGlzLmVkaXRvciAmJiB0aGlzLmVkaXRvci5zdG9wUHJvcGFnYXRpb24pIHx8IGtleUNvZGUgPT09IDEzIHx8IHRoaXMuY29sdW1uLmVkaXRvclRlbXBsYXRlKSB7XHJcbiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzd2l0Y2ggKGtleUNvZGUpIHtcclxuICAgICAgICAgICAgY2FzZSAzMjogIC8vIFNQQUNFXHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jb2x1bW4uZWRpdG9yLnR5cGUgPT09ICdzd2l0Y2gnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZWRpdG9yLmluc3RhbmNlLnVwZGF0ZUNoZWNrZWQoZSwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgMTM6ICAvLyBFbnRlclxyXG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZUVkaXRpbmdDZWxsKCkucGlwZSh0YWtlVW50aWwodGhpcy5kZXN0cm95JCkpLnBpcGUoXHJcbiAgICAgICAgICAgICAgICAgICAgZGVib3VuY2VUaW1lKDEwMClcclxuICAgICAgICAgICAgICAgICkuc3Vic2NyaWJlKGYgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChmKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGcuZGdDb250YWluZXIubmF0aXZlRWxlbWVudC5mb2N1cygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBlbnRlclBhcmFtID0geyBnaXJkOiB0aGlzLmRnLCBjZWxsOiB0aGlzLmRnLmN1cnJlbnRDZWxsLCBldmVudDogZSB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jb2x1bW4ub25FbnRlckhhbmRsZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29sdW1uLm9uRW50ZXJIYW5kbGVyKGVudGVyUGFyYW0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV4dFRkID0gdGhpcy5kZy5jdXJyZW50Q2VsbC5jZWxsRWxlbWVudC5uZXh0RWxlbWVudFNpYmxpbmc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kZy5jdXJyZW50Q2VsbC5sYXN0Um93ICYmICFuZXh0VGQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRnLmxhc3RDZWxsRW50ZXJIYW5kbGUuZW1pdChlbnRlclBhcmFtKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgMjc6IC8vIEVTQ1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jYW5jZWxDZWxsRWRpdGluZygpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgOTogLy8gVGFiXHJcbiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kZy5jbGlja0RlbGF5ID0gMDtcclxuICAgICAgICAgICAgICAgIGlmIChlLnNoaWZ0S2V5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZUVkaXRpbmdDZWxsKCkucGlwZSh0YWtlVW50aWwodGhpcy5kZXN0cm95JCkpLnN1YnNjcmliZShmID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGYpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW92ZVByZXZDZWxsQW5kRWRpdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VFZGl0aW5nQ2VsbCgpLnBpcGUodGFrZVVudGlsKHRoaXMuZGVzdHJveSQpKS5zdWJzY3JpYmUoZiA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vdmVOZXh0Q2VsbEFuZEVkaXQoZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSA0MDogLy8g4oaTXHJcbiAgICAgICAgICAgICAgICAvKiog6YCJ5Lit5LiL5LiA6KGM77yM5LiU5b2T5YmN5YiX6L+b5YWl57yW6L6R5oCBOyDku4Xmma7pgJrmlofmnKzovpPlhaXmoYbmlK/mjIEgKi9cclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbHVtbi5lZGl0b3IudHlwZSA9PT0gJ3RleHRib3gnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZUVkaXRpbmdDZWxsKCkucGlwZSh0YWtlVW50aWwodGhpcy5kZXN0cm95JCkpLnN1YnNjcmliZShmID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGYpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0TmV4dFJvd0FuZEVkaXRDZWxsKHRoaXMuY29sdW1uLmZpZWxkLCAnZG93bicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgMzg6IC8vIOKGkVxyXG4gICAgICAgICAgICAgICAgLyoqIOmAieS4reS4iuS4gOihjO+8jOS4lOW9k+WJjeWIl+i/m+WFpee8lui+keaAgTsg5LuF5pmu6YCa5paH5pys6L6T5YWl5qGG5pSv5oyBICovXHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jb2x1bW4uZWRpdG9yLnR5cGUgPT09ICd0ZXh0Ym94Jykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VFZGl0aW5nQ2VsbCgpLnBpcGUodGFrZVVudGlsKHRoaXMuZGVzdHJveSQpKS5zdWJzY3JpYmUoZiA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdE5leHRSb3dBbmRFZGl0Q2VsbCh0aGlzLmNvbHVtbi5maWVsZCwgJ3VwJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzZWxlY3RDZWxsKGZpZWxkOiBzdHJpbmcsIHRkRWxlbWVudD86IGFueSkge1xyXG4gICAgICAgIHRoaXMuY2xvc2VFZGl0aW5nQ2VsbCgpLnN1YnNjcmliZSh0ID0+IHtcclxuICAgICAgICAgICAgaWYgKCF0KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGRFbGVtZW50ID0gdGRFbGVtZW50IHx8IHRoaXMuZWwubmF0aXZlRWxlbWVudDtcclxuICAgICAgICAgICAgdGhpcy5jbGVhckNlbGxTZWxlY3RlZENsYXNzKCk7XHJcblxyXG4gICAgICAgICAgICBpZiAoZmllbGQgIT09IHRoaXMuZGcuQ29udHJvbFBhbmVsRmVpbGQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyLmFkZENsYXNzKHRkRWxlbWVudCwgQ0VMTF9TRUxFQ1RFRF9DTFMpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyB0aGlzLmRyLmRySG92ZXIuc2V0Um93SG92ZXJDbHMoZmFsc2UpO1xyXG4gICAgICAgICAgICB0aGlzLmRmcy5zZXRDdXJyZW50Q2VsbCh0aGlzLmRyLCBmaWVsZCwgdGRFbGVtZW50LCB0aGlzLmRjKTtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLmRnLmZhc3QpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubW92ZVNjcm9sbGJhcih0ZEVsZW1lbnQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBtb3ZlU2Nyb2xsYmFyKHRkOiBhbnkpIHtcclxuICAgICAgICBjb25zdCB0ZFBvc0xlZnQgPSB0ZC5vZmZzZXRMZWZ0ICsgdGQub2Zmc2V0V2lkdGg7XHJcbiAgICAgICAgY29uc3QgY29udGFpbmVyV2lkdGggPSB0aGlzLmRnLndpZHRoIC0gdGhpcy5kZ2IuY29sdW1uc0dyb3VwLmxlZnRGaXhlZFdpZHRoO1xyXG4gICAgICAgIGNvbnN0IHRkUmVjdCA9IHRkLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gICAgICAgIGNvbnN0IHNjcm9sbENvbnRhaW5lciA9IHRoaXMuZGdiLnBzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudDtcclxuICAgICAgICBjb25zdCBwc0NvbnRhaW5lciA9IHNjcm9sbENvbnRhaW5lci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgICAgICBjb25zdCBzY3JvbGxUb3AgPSBzY3JvbGxDb250YWluZXIuc2Nyb2xsVG9wO1xyXG4gICAgICAgIGNvbnN0IHNjcm9sbExlZnQgPSBzY3JvbGxDb250YWluZXIuc2Nyb2xsTGVmdDtcclxuICAgICAgICBjb25zdCBzY3JvbGxiYXJYTGVmdCA9IHRoaXMuZGdiLnBzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5zY3JvbGxMZWZ0O1xyXG4gICAgICAgIGlmICh0ZFBvc0xlZnQgPiBjb250YWluZXJXaWR0aCkge1xyXG4gICAgICAgICAgICBjb25zdCB4ID0gdGRQb3NMZWZ0IC0gY29udGFpbmVyV2lkdGggKyAyO1xyXG4gICAgICAgICAgICBpZiAoeCA+IHNjcm9sbGJhclhMZWZ0KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRnYi5wcy5zY3JvbGxUb1goeCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAodGRSZWN0LnggPCBwc0NvbnRhaW5lci54KSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB4ID0gc2Nyb2xsTGVmdCAtIHRkUmVjdC54O1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kZ2IucHMuc2Nyb2xsVG9YKHgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCB0ZFBvc1RvcCA9IHRkUmVjdC50b3AgLSBwc0NvbnRhaW5lci50b3AgKyB0ZFJlY3QuaGVpZ2h0O1xyXG4gICAgICAgIGlmICh0ZFBvc1RvcCA+IHBzQ29udGFpbmVyLmhlaWdodCkge1xyXG4gICAgICAgICAgICBjb25zdCB5ID0gdGRQb3NUb3AgLSBwc0NvbnRhaW5lci5oZWlnaHQ7XHJcbiAgICAgICAgICAgIHRoaXMuZGdiLnBzLnNjcm9sbFRvWShzY3JvbGxUb3AgKyB5KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAodGRSZWN0LnkgPCBwc0NvbnRhaW5lci55KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRnYi5wcy5zY3JvbGxUb1koc2Nyb2xsVG9wIC0gKHBzQ29udGFpbmVyLnkgLSB0ZFJlY3QueSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgbW92ZU5leHRDZWxsQW5kRWRpdChldmVudD86IGFueSkge1xyXG4gICAgICAgIC8vIGlmICghdGhpcy5jbG9zZUVkaXRpbmdDZWxsKCkpIHtcclxuICAgICAgICAvLyAgICAgcmV0dXJuO1xyXG4gICAgICAgIC8vIH1cclxuICAgICAgICBjb25zdCBmaWVsZEluZGV4ID0gdGhpcy5kZnMuZ2V0Q29sdW1uSW5kZXgodGhpcy5jb2x1bW4uZmllbGQpO1xyXG4gICAgICAgIGlmIChmaWVsZEluZGV4ICsgMSA8IHRoaXMuZGdiLmNvbHVtbnNHcm91cC5ub3JtYWxDb2x1bW5zLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBjb25zdCBuZXh0Q29sdW1uID0gdGhpcy5kZ2IuY29sdW1uc0dyb3VwLm5vcm1hbENvbHVtbnNbZmllbGRJbmRleCArIDFdO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgbmV4dFRkID0gdGhpcy5kZy5jdXJyZW50Q2VsbC5jZWxsRWxlbWVudC5uZXh0RWxlbWVudFNpYmxpbmc7XHJcbiAgICAgICAgICAgIGlmIChuZXh0Q29sdW1uICYmICgoIW5leHRDb2x1bW4uZWRpdG9yICYmICFuZXh0Q29sdW1uLmVkaXRvclRlbXBsYXRlKSB8fCB0aGlzLmlzUmVhZG9ubHkobmV4dENvbHVtbikpKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAobmV4dFRkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV4dFRkLnNlbGVjdENlbGwoZXZlbnQsIG5leHRUZCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChuZXh0VGQpIHtcclxuICAgICAgICAgICAgICAgIG5leHRUZC5mb2N1cygpO1xyXG4gICAgICAgICAgICAgICAgaWYgKG5leHRDb2x1bW4uZWRpdG9yIHx8IG5leHRDb2x1bW4uZWRpdG9yVGVtcGxhdGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBuZXh0VGQuZWRpdENlbGwoKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRncy5vbkNlbGxFZGl0KG5leHRUZCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBuZXh0IHJvdydzIGZpcnN0IGNlbGwgdG8gZWRpdGluZ1xyXG4gICAgICAgICAgICBjb25zdCBuZXh0VHIgPSB0aGlzLmRnLmN1cnJlbnRDZWxsLmNlbGxFbGVtZW50LnBhcmVudEVsZW1lbnQubmV4dEVsZW1lbnRTaWJsaW5nO1xyXG4gICAgICAgICAgICBpZiAobmV4dFRyICYmIG5leHRUci50YWdOYW1lID09PSAnVFInKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBuZXh0VHIuY2hpbGRyZW4uZmluZCh0ZCA9PiB0ZC5lZGl0Q2VsbCkuZWRpdENlbGwoKTtcclxuICAgICAgICAgICAgICAgIGxldCBmaXJzdEVkaXRvciA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgbGV0IGkgPSAwO1xyXG4gICAgICAgICAgICAgICAgd2hpbGUgKCFmaXJzdEVkaXRvcikge1xyXG4gICAgICAgICAgICAgICAgICAgIGZpcnN0RWRpdG9yID0gISFuZXh0VHIuY2hpbGRyZW5baV0uZWRpdENlbGw7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFmaXJzdEVkaXRvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpKys7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZGcuc2VsZWN0aW9uTW9kZSA9PT0gJ2RlZmF1bHQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZy5jbGVhckNoZWNrZWRzKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBuZXh0VHIuY2hpbGRyZW5baV0uZWRpdENlbGwoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIG1vdmVQcmV2Q2VsbEFuZEVkaXQoKSB7XHJcbiAgICAgICAgLy8gaWYgKCF0aGlzLmNsb3NlRWRpdGluZ0NlbGwoKSkge1xyXG4gICAgICAgIC8vICAgICByZXR1cm47XHJcbiAgICAgICAgLy8gfVxyXG4gICAgICAgIGNvbnN0IGZpZWxkSW5kZXggPSB0aGlzLmRmcy5nZXRDb2x1bW5JbmRleCh0aGlzLmNvbHVtbi5maWVsZCk7XHJcbiAgICAgICAgaWYgKGZpZWxkSW5kZXggLSAxID49IDApIHtcclxuICAgICAgICAgICAgY29uc3QgbmV4dENvbHVtbiA9IHRoaXMuZGdiLmNvbHVtbnNHcm91cC5ub3JtYWxDb2x1bW5zW2ZpZWxkSW5kZXggLSAxXTtcclxuICAgICAgICAgICAgaWYgKG5leHRDb2x1bW4gJiYgdGhpcy5pc1JlYWRvbmx5KG5leHRDb2x1bW4pKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29uc3QgbmV4dFRkID0gdGhpcy5kZy5jdXJyZW50Q2VsbC5jZWxsRWxlbWVudC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nO1xyXG4gICAgICAgICAgICBpZiAobmV4dFRkKSB7XHJcbiAgICAgICAgICAgICAgICAvLyB0aGlzLnNlbGVjdENlbGwobmV4dENvbHVtbi5maWVsZCwgbmV4dFRkKTtcclxuICAgICAgICAgICAgICAgIG5leHRUZC5mb2N1cygpO1xyXG4gICAgICAgICAgICAgICAgaWYgKG5leHRDb2x1bW4uZWRpdG9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5kZnMuZWRpdENlbGwoKTtcclxuICAgICAgICAgICAgICAgICAgICBuZXh0VGQuY2xpY2soKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRncy5vbkNlbGxFZGl0KG5leHRUZCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzZWxlY3ROZXh0Um93QW5kRWRpdENlbGwoY2VsbEZpZWxkTmFtZTogc3RyaW5nLCBkaXI6ICdkb3duJyB8ICd1cCcpIHtcclxuICAgICAgICBjb25zdCBwID0gZGlyID09PSAnZG93bicgPyAnbmV4dEVsZW1lbnRTaWJsaW5nJzogJ3ByZXZpb3VzRWxlbWVudFNpYmxpbmcnO1xyXG4gICAgICAgIGNvbnN0IG5leHRUciA9IHRoaXMuZGcuY3VycmVudENlbGwuY2VsbEVsZW1lbnQucGFyZW50RWxlbWVudFtwXTtcclxuICAgICAgICBpZiAobmV4dFRyICYmIG5leHRUci50YWdOYW1lID09PSAnVFInKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRkOiBhbnkgPSBBcnJheS5mcm9tKG5leHRUci5jaGlsZHJlbikuZmluZCgodGQ6IGFueSkgPT4gdGQuZ2V0QXR0cmlidXRlKCdmaWVsZCcpID09IGNlbGxGaWVsZE5hbWUpO1xyXG4gICAgICAgICAgICBpZiAodGQgJiYgdGQuZWRpdENlbGwpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRnLnNlbGVjdGlvbk1vZGUgPT09ICdkZWZhdWx0JyApIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRnLmNsZWFyQ2hlY2tlZHMoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRkLmVkaXRDZWxsKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjbGVhckNlbGxTZWxlY3RlZENsYXNzKCkge1xyXG4gICAgICAgIC8vIGlmICh0aGlzLmRnLmN1cnJlbnRDZWxsKSB7XHJcbiAgICAgICAgLy8gICAgIERvbUhhbmRsZXIucmVtb3ZlQ2xhc3ModGhpcy5kZy5jdXJyZW50Q2VsbC5jZWxsRWxlbWVudCwgQ0VMTF9TRUxFQ1RFRF9DTFMpO1xyXG4gICAgICAgIC8vICAgICB0aGlzLnJlbmRlci5yZW1vdmVDbGFzcyh0aGlzLmRnLmN1cnJlbnRDZWxsLmNlbGxFbGVtZW50LCBDRUxMX0VESVRJTkdfQ0xTKTtcclxuXHJcbiAgICAgICAgLy8gICAgIGNvbnN0IHNlbGVjdGVkQ2VsbCA9IHRoaXMuZGcuZWwubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuJyArIENFTExfU0VMRUNURURfQ0xTKTtcclxuICAgICAgICAvLyAgICAgaWYgKHNlbGVjdGVkQ2VsbC5sZW5ndGgpIHtcclxuICAgICAgICAvLyAgICAgICAgIHNlbGVjdGVkQ2VsbC5mb3JFYWNoKG4gPT4ge1xyXG4gICAgICAgIC8vICAgICAgICAgICAgIHRoaXMucmVuZGVyLnJlbW92ZUNsYXNzKG4sIENFTExfU0VMRUNURURfQ0xTKTtcclxuICAgICAgICAvLyAgICAgICAgIH0pO1xyXG4gICAgICAgIC8vICAgICB9XHJcbiAgICAgICAgLy8gfVxyXG5cclxuICAgICAgICB0aGlzLmRnLnJlbW92ZUNlbGxTZWxlY3RlZENscygpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2V0Q2VsbENsc1dpdGhFZGl0b3JUeXBlKCkge1xyXG5cclxuICAgICAgICAvLyDorr7nva7lvZPliY3pgInkuK3ljZXlhYPmoLzmoLflvI9cclxuICAgICAgICBpZiAodGhpcy5kZy5jdXJyZW50Q2VsbCAmJiB0aGlzLmRnLmVuYWJsZUhpZ2hsaWdodENlbGwpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZGcuY3VycmVudENlbGwuZmllbGQgPT09IHRoaXMuY29sdW1uLmZpZWxkICYmIHRoaXMuZGcuY3VycmVudENlbGwucm93SWQgPT09IHRoaXMucm93RGF0YVt0aGlzLmRnLmlkRmllbGRdICYmICF0aGlzLmRjLmlzRWRpdGluZykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jbGVhckNlbGxTZWxlY3RlZENsYXNzKCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5hZGRDbGFzcyh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsIENFTExfU0VMRUNURURfQ0xTKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGlmICghdGhpcy5kZy5lbmFibGVFZGl0Q2VsbFN0eWxlKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHRkID0gdGhpcy5lbC5uYXRpdmVFbGVtZW50O1xyXG4gICAgICAgIHRoaXMuY2xlYW5PdGhlckVkaXRvckljb24odGQpO1xyXG4gICAgICAgIC8vIOW9k+WJjeihjOemgeeUqO+8jOS4jeWFgeiuuOe8lui+keOAglxyXG4gICAgICAgIGlmICh0aGlzLmRyLmRpc2FibGVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICghdGhpcy5jb2x1bW4uZWRpdG9yKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmlzUmVhZG9ubHkoKSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBlZGl0b3JUeXBlID0gdGhpcy5jb2x1bW4uZWRpdG9yLnR5cGU7XHJcbiAgICAgICAgY29uc3QgY2xzID0gdGhpcy5jb2x1bW4uYWxpZ24gPT09ICdyaWdodCcgPyAnYWxsb3ctZWRpdC1jZWxsLWxlZnQnIDogJ2FsbG93LWVkaXQtY2VsbCc7XHJcbiAgICAgICAgdGhpcy5yZW5kZXIuYWRkQ2xhc3ModGQsIGNscyk7XHJcbiAgICAgICAgdGhpcy5yZW5kZXIuYWRkQ2xhc3ModGQsIEFMTE9XX0VESVRfQ0VMTF9ISUdITElHSFRfQ0xTW2VkaXRvclR5cGVdKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNsZWFuT3RoZXJFZGl0b3JJY29uKHRkKSB7XHJcbiAgICAgICAgY29uc3QgdmFsdWVzID0gT2JqZWN0LnZhbHVlcyhBTExPV19FRElUX0NFTExfSElHSExJR0hUX0NMUyk7XHJcbiAgICAgICAgdmFsdWVzLmZvckVhY2godiA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0ZC5jbGFzc05hbWUuaW5kZXhPZih2KSA+IC0xKSB7XHJcbiAgICAgICAgICAgICAgICB0ZC5jbGFzc05hbWUgPSB0ZC5jbGFzc05hbWUucmVwbGFjZSgnYWxsb3ctZWRpdC1jZWxsLWxlZnQnLCAnJykucmVwbGFjZSgnYWxsb3ctZWRpdC1jZWxsJywgJycpO1xyXG4gICAgICAgICAgICAgICAgdGQuY2xhc3NOYW1lID0gdGQuY2xhc3NOYW1lLnJlcGxhY2UodiwgJycpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn1cclxuIl19