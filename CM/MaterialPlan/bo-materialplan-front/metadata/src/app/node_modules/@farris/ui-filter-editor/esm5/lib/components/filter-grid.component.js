/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
/*
 * @Author: 疯狂秀才(lucas huang)
 * @Date: 2018-11-13 14:55:34
 * @LastEditors: 疯狂秀才(Lucas Huang)
 * @LastEditTime: 2019-11-30 10:18:12
 * @Company: Inspur
 * @Version: v0.0.1
 */
import { Component, ElementRef, Renderer2, ViewChild, Input, EventEmitter, Output } from '@angular/core';
import { MessagerService } from '@farris/ui-messager';
import { LeftBracket, RighttBracket, Relation, CompareOperators, Compare, FilterRelation, ExpressValueType } from '@farris/ui-common/types';
import { FilterService } from './../services/filter.service';
var FilterGridComponent = /** @class */ (function () {
    function FilterGridComponent(el, render, filterService, messagerService) {
        this.el = el;
        this.render = render;
        this.filterService = filterService;
        this.messagerService = messagerService;
        this.LeftBracketData = LeftBracket;
        this.RighttBracketData = RighttBracket;
        this.relationData = Relation;
        this.operators = CompareOperators;
        this.columnSizeData = [60, 50, 120, 100, 60, 120, 50, 50];
        this.groupIcon = '<i class="f-icon f-icon-lookup"></i>';
        this.conditions = [];
        this.columns = [];
        this.enableExpress = false;
        this.enableFrontExpress = false;
        this.showExpress = new EventEmitter();
        this.currentCondition = null;
        this.newCondition = {
            filterField: '',
            value: '',
            lbracket: '',
            rbracket: '',
            relation: FilterRelation.Empty,
            compare: Compare.Equal,
            expresstype: ExpressValueType.Value
        };
        this.localeService = null;
        this.localeService = this.messagerService['localeService'];
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    FilterGridComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
    };
    /**
     * @return {?}
     */
    FilterGridComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        if (!this.fieldEditor) {
            this.fieldEditor = { type: 'select', options: {} };
        }
        this.initRelationData();
        if (!this.conditions || !this.conditions.length) {
            /** @type {?} */
            var firstCon = Object.assign({}, this.newCondition);
            this.conditions = [firstCon];
            this.changeConditionList();
        }
    };
    /**
     * @private
     * @return {?}
     */
    FilterGridComponent.prototype.initRelationData = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.localeService) {
            /** @type {?} */
            var andStr = this.localeService.getValue('filterEditor.relationValue.and');
            /** @type {?} */
            var orStr = this.localeService.getValue('filterEditor.relationValue.or');
            this.relationData = [
                { label: '', value: 0 },
                { label: andStr, value: 1 },
                { label: orStr, value: 2 }
            ];
        }
    };
    /**
     * @param {?} index
     * @return {?}
     */
    FilterGridComponent.prototype.insertCondition = /**
     * @param {?} index
     * @return {?}
     */
    function (index) {
        /** @type {?} */
        var _newCondition = Object.assign({}, this.newCondition);
        if (index === 0) {
            this.conditions.unshift(_newCondition);
        }
        else {
            this.conditions.splice(index, 0, _newCondition);
        }
        this.changeConditionList();
    };
    /**
     * @param {?} index
     * @return {?}
     */
    FilterGridComponent.prototype.removeCondition = /**
     * @param {?} index
     * @return {?}
     */
    function (index) {
        this.conditions.splice(index, 1);
        this.changeConditionList();
        if (this.currentCondition) {
            if (index === this.currentCondition.index) {
                this.currentCondition = null;
            }
        }
    };
    /**
     * @return {?}
     */
    FilterGridComponent.prototype.onAddFilter = /**
     * @return {?}
     */
    function () {
        this.conditions = tslib_1.__spread(this.conditions, [Object.assign({}, this.newCondition)]);
        this.changeConditionList();
    };
    /**
     * @return {?}
     */
    FilterGridComponent.prototype.onClear = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.messagerService.question('确认要清空当前所有条件吗？', (/**
         * @return {?}
         */
        function () {
            _this.conditions = [];
            _this.changeConditionList();
        }));
    };
    /**
     * @return {?}
     */
    FilterGridComponent.prototype.onMoveTop = /**
     * @return {?}
     */
    function () {
        if (this.currentCondition) {
            this.conditions.unshift(this.currentCondition.condition);
            this.conditions.splice(this.currentCondition.index + 1, 1);
            this.currentCondition.index = 0;
            this.changeConditionList();
        }
    };
    /**
     * @return {?}
     */
    FilterGridComponent.prototype.onMovePrev = /**
     * @return {?}
     */
    function () {
        var _a;
        if (this.currentCondition) {
            /** @type {?} */
            var index = this.currentCondition.index;
            /** @type {?} */
            var tempArr = this.conditions.splice(index, 1);
            (_a = this.conditions).splice.apply(_a, tslib_1.__spread([index - 1, 0], tempArr));
            this.currentCondition.index = index - 1;
            this.changeConditionList();
        }
    };
    /**
     * @return {?}
     */
    FilterGridComponent.prototype.onMoveNext = /**
     * @return {?}
     */
    function () {
        var _a;
        if (this.currentCondition) {
            /** @type {?} */
            var index = this.currentCondition.index;
            /** @type {?} */
            var tempArr = this.conditions.splice(index, 1);
            (_a = this.conditions).splice.apply(_a, tslib_1.__spread([index + 1, 0], tempArr));
            this.currentCondition.index = index + 1;
            this.changeConditionList();
        }
    };
    /**
     * @return {?}
     */
    FilterGridComponent.prototype.onMoveBottom = /**
     * @return {?}
     */
    function () {
        if (this.currentCondition) {
            this.conditions.push(this.currentCondition.condition);
            this.conditions.splice(this.currentCondition.index, 1);
            this.currentCondition.index = this.conditions.length - 1;
            this.changeConditionList();
        }
    };
    /**
     * @private
     * @return {?}
     */
    FilterGridComponent.prototype.changeConditionList = /**
     * @private
     * @return {?}
     */
    function () {
        this.filterService.conditionsChanged.next(this.conditions);
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    FilterGridComponent.prototype.selected = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        // console.log($event);
        this.currentCondition = $event;
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    FilterGridComponent.prototype.isSelected = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        if (this.currentCondition) {
            return this.currentCondition.index === $event;
        }
        return false;
    };
    /**
     * @param {?} $event
     * @param {?} condition
     * @param {?} value
     * @return {?}
     */
    FilterGridComponent.prototype.showExpressDialog = /**
     * @param {?} $event
     * @param {?} condition
     * @param {?} value
     * @return {?}
     */
    function ($event, condition, value) {
        /** @type {?} */
        var type = condition.expresstype === 1 ? 'express' : 'frontExpress';
        this.showExpress.emit({ event: $event, condition: condition, value: value, type: type });
    };
    /**
     * @param {?} $event
     * @param {?} condition
     * @return {?}
     */
    FilterGridComponent.prototype.onComboSelectChange = /**
     * @param {?} $event
     * @param {?} condition
     * @return {?}
     */
    function ($event, condition) {
        if ($event) {
            var data = $event.data;
            if (data) {
                condition.filterField = data['value'];
            }
        }
    };
    FilterGridComponent.decorators = [
        { type: Component, args: [{
                    selector: 'filter-grid',
                    template: "<div class=\"table-header \">\r\n    <table class=\"table table-bordered\" style=\"margin-bottom: 0\">\r\n        <colgroup>\r\n            <col *ngFor=\"let s of columnSizeData\" [style.width]=\" s + 'px'\">\r\n        </colgroup>\r\n        <thead>\r\n            <tr>\r\n                <th></th>\r\n                <th><b>{{ 'filterEditor.leftBrackets' | locale }}</b></th>\r\n                <th><b>{{ 'filterEditor.field' | locale }}</b></th>\r\n                <th><b>{{ 'filterEditor.operator' | locale }}</b></th>\r\n                <th><b>{{ 'filterEditor.valueType' | locale }}</b></th>\r\n                <th><b>{{ 'filterEditor.value' | locale }}</b></th>\r\n                <th><b>{{ 'filterEditor.rightBrackets' | locale }}</b></th>\r\n                <th><b>{{ 'filterEditor.relation' | locale }}</b></th>\r\n            </tr>\r\n        </thead>\r\n    </table>\r\n</div>\r\n<div class=\"table-body flex-fill\" style=\"overflow: hidden\" #tablebodybox>\r\n    <perfect-scrollbar [config]=\"{}\">\r\n        <table class=\"table table-bordered\" style=\"margin-bottom: 0;\">\r\n            <colgroup>\r\n                <col *ngFor=\"let s of columnSizeData\" [style.width]=\" s + 'px'\">\r\n            </colgroup>\r\n            <tbody>\r\n                <tr *ngFor=\"let condition of conditions; let index=index;\" (click)=\"selected({'index':index, 'condition': condition})\" [class.selected]=\"isSelected(index)\" >\r\n                    <td>\r\n                        <button type=\"button\" (click)=\"insertCondition(index)\" class=\"k-button k-button-icon k-flat\"><span class=\"k-icon k-i-plus\"></span></button>\r\n                        <button type=\"button\" (click)=\"removeCondition(index)\" class=\"k-button k-button-icon k-flat\"><span class=\"k-icon k-i-minus\"></span></button>\r\n                    </td>\r\n                    <td>\r\n                        <select class=\"form-control filter-select\" [(ngModel)]=\"condition.lbracket\" name=\"lbracket\">\r\n                            <option *ngFor=\"let item of LeftBracketData\" [value]=\"item\">{{ item }}</option>\r\n                        </select>\r\n                    </td>\r\n                    <td>\r\n                        <select *ngIf=\"fieldEditor.type === 'select'\" class=\"form-control filter-select\" [(ngModel)]=\"condition.filterField\" name=\"filterField\">\r\n                            <option *ngFor=\"let col of columns\" [value]=\"col.value\">{{ col.label }}</option>\r\n                        </select>\r\n\r\n                        <farris-combo-lookup *ngIf=\"fieldEditor.type === 'combo-tree'\" name=\"filterField\"\r\n                            [idField]=\"fieldEditor?.options?.idField ||'value'\"\r\n                            [textField]=\"fieldEditor?.options?.textField ||'label'\"\r\n                            [displayType]=\"'LOOKUPTREELIST'\" [useValue]=\"true\"\r\n                            [useTreeView]=\"true\"\r\n                            [columns]=\"fieldEditor?.options?.columns || []\"\r\n                            [data]=\"columns\"\r\n                            [(ngModel)]=\"condition.filterField\"\r\n                            [remoteSearch]=\"false\"\r\n                            [autoWidth]=\"fieldEditor?.options?.autoWidth\"\r\n                            [panelWidth]=\"fieldEditor?.options?.panelWidth || 200\">\r\n                        </farris-combo-lookup>\r\n\r\n\r\n                    </td>\r\n                    <td>\r\n                        <select class=\"form-control filter-select\" name=\"compare\" [(ngModel)]=\"condition.compare\">\r\n                            <option *ngFor=\"let item of operators\" [value]=\"item.value\">{{item.label}}</option>\r\n                        </select>\r\n                    </td>\r\n                    <td>\r\n                        <select class=\"form-control filter-select\" name=\"expresstype\" [(ngModel)]=\"condition.expresstype\">\r\n                            <option [value]=\"0\">{{'filterEditor.expressType.value' | locale }}</option>\r\n                            <option [value]=\"1\" *ngIf=\"enableExpress\" >{{'filterEditor.expressType.express' | locale }}</option>\r\n                            <option [value]=\"'frontExpress'\" *ngIf=\"enableFrontExpress\" >{{'filterEditor.expressType.frontExpress' | locale }}</option>\r\n                        </select>\r\n                    </td>\r\n                    <td>\r\n                        <input-group name=\"value\" [(ngModel)]=\"condition.value\" [groupText]=\"condition.expresstype == 1||condition.expresstype==='frontExpress'?groupIcon: ''\"\r\n                        (clickHandle)=\"showExpressDialog($event, condition, condition.value)\"></input-group>\r\n                    </td>\r\n                    <td>\r\n                        <select class=\"form-control filter-select\"  [(ngModel)]=\"condition.rbracket\" name=\"rbracket\">\r\n                            <option *ngFor=\"let item of RighttBracketData\" [value]=\"item\">{{ item }}</option>\r\n                        </select>\r\n                    </td>\r\n                    <td>\r\n                        <select class=\"form-control filter-select\" [(ngModel)]=\"condition.relation\" name=\"relation\">\r\n                            <option *ngFor=\"let item of relationData\" [value]=\"item.value\">{{ item.label }}</option>\r\n                        </select>\r\n                    </td>\r\n                </tr>\r\n            </tbody>\r\n        </table>\r\n    </perfect-scrollbar>\r\n</div>\r\n<div style=\"flex-shrink: 0;\">\r\n<filter-footer\r\n(addFilter)=\"onAddFilter()\"\r\n(clearFilter)=\"onClear()\"\r\n(moveTop)=\"onMoveTop()\"\r\n(movePrev)=\"onMovePrev()\"\r\n(moveNext)=\"onMoveNext()\"\r\n(moveBottom)=\"onMoveBottom()\"></filter-footer>\r\n</div>\r\n",
                    styles: ["\n        .filter-select { width:100%; padding-left: 0; padding-right: 0; }\n        .selected { background: #c2e4ff; }\n        "]
                }] }
    ];
    /** @nocollapse */
    FilterGridComponent.ctorParameters = function () { return [
        { type: ElementRef },
        { type: Renderer2 },
        { type: FilterService },
        { type: MessagerService }
    ]; };
    FilterGridComponent.propDecorators = {
        conditions: [{ type: Input }],
        columns: [{ type: Input }],
        enableExpress: [{ type: Input }],
        enableFrontExpress: [{ type: Input }],
        height: [{ type: Input }],
        fieldEditor: [{ type: Input }],
        showExpress: [{ type: Output }],
        tablebodybox: [{ type: ViewChild, args: ['tablebodybox',] }]
    };
    return FilterGridComponent;
}());
export { FilterGridComponent };
if (false) {
    /** @type {?} */
    FilterGridComponent.prototype.LeftBracketData;
    /** @type {?} */
    FilterGridComponent.prototype.RighttBracketData;
    /** @type {?} */
    FilterGridComponent.prototype.relationData;
    /** @type {?} */
    FilterGridComponent.prototype.operators;
    /** @type {?} */
    FilterGridComponent.prototype.columnSizeData;
    /** @type {?} */
    FilterGridComponent.prototype.groupIcon;
    /** @type {?} */
    FilterGridComponent.prototype.conditions;
    /** @type {?} */
    FilterGridComponent.prototype.columns;
    /** @type {?} */
    FilterGridComponent.prototype.enableExpress;
    /** @type {?} */
    FilterGridComponent.prototype.enableFrontExpress;
    /** @type {?} */
    FilterGridComponent.prototype.height;
    /** @type {?} */
    FilterGridComponent.prototype.fieldEditor;
    /** @type {?} */
    FilterGridComponent.prototype.showExpress;
    /** @type {?} */
    FilterGridComponent.prototype.tablebodybox;
    /** @type {?} */
    FilterGridComponent.prototype.currentCondition;
    /**
     * @type {?}
     * @private
     */
    FilterGridComponent.prototype.newCondition;
    /** @type {?} */
    FilterGridComponent.prototype.localeService;
    /**
     * @type {?}
     * @private
     */
    FilterGridComponent.prototype.el;
    /**
     * @type {?}
     * @private
     */
    FilterGridComponent.prototype.render;
    /**
     * @type {?}
     * @private
     */
    FilterGridComponent.prototype.filterService;
    /**
     * @type {?}
     * @private
     */
    FilterGridComponent.prototype.messagerService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsdGVyLWdyaWQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1maWx0ZXItZWRpdG9yLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvZmlsdGVyLWdyaWQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFVQSxPQUFPLEVBQUUsU0FBUyxFQUFVLFVBQVUsRUFBRSxTQUFTLEVBQWUsU0FBUyxFQUFFLEtBQUssRUFDbEQsWUFBWSxFQUFFLE1BQU0sRUFBYSxNQUFNLGVBQWUsQ0FBQztBQUNyRixPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDdEQsT0FBTyxFQUFFLFdBQVcsRUFBRSxhQUFhLEVBQUUsUUFBUSxFQUFFLGdCQUFnQixFQUN2RCxPQUFPLEVBQUUsY0FBYyxFQUFFLGdCQUFnQixFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFDbkYsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBRTdEO0lBOENJLDZCQUNZLEVBQWMsRUFBVSxNQUFpQixFQUFVLGFBQTRCLEVBQy9FLGVBQWdDO1FBRGhDLE9BQUUsR0FBRixFQUFFLENBQVk7UUFBVSxXQUFNLEdBQU4sTUFBTSxDQUFXO1FBQVUsa0JBQWEsR0FBYixhQUFhLENBQWU7UUFDL0Usb0JBQWUsR0FBZixlQUFlLENBQWlCO1FBcEM1QyxvQkFBZSxHQUFHLFdBQVcsQ0FBQztRQUM5QixzQkFBaUIsR0FBRyxhQUFhLENBQUM7UUFDbEMsaUJBQVksR0FBRyxRQUFRLENBQUM7UUFDeEIsY0FBUyxHQUFHLGdCQUFnQixDQUFDO1FBRTdCLG1CQUFjLEdBQUcsQ0FBQyxFQUFFLEVBQUUsRUFBRSxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsRUFBRSxFQUFFLEdBQUcsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDckQsY0FBUyxHQUFHLHNDQUFzQyxDQUFDO1FBRTFDLGVBQVUsR0FB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MkIsVUFBVTtnQkFBRSxTQUFTO2dCQUt4QyxhQUFhO2dCQUhiLGVBQWU7Ozs2QkF5Qm5CLEtBQUs7MEJBQ0wsS0FBSztnQ0FDTCxLQUFLO3FDQUNMLEtBQUs7eUJBQ0wsS0FBSzs4QkFDTCxLQUFLOzhCQUVMLE1BQU07K0JBRU4sU0FBUyxTQUFDLGNBQWM7O0lBMko3QiwwQkFBQztDQUFBLEFBeExELElBd0xDO1NBN0tZLG1CQUFtQjs7O0lBQzVCLDhDQUE4Qjs7SUFDOUIsZ0RBQWtDOztJQUNsQywyQ0FBd0I7O0lBQ3hCLHdDQUE2Qjs7SUFFN0IsNkNBQXFEOztJQUNyRCx3Q0FBbUQ7O0lBRW5ELHlDQUE0Qzs7SUFDNUMsc0NBQXdEOztJQUN4RCw0Q0FBK0I7O0lBQy9CLGlEQUFvQzs7SUFDcEMscUNBQXdCOztJQUN4QiwwQ0FBcUI7O0lBRXJCLDBDQUEyQzs7SUFFM0MsMkNBQW9EOztJQUVwRCwrQ0FBdUU7Ozs7O0lBRXZFLDJDQVFFOztJQUdGLDRDQUFvQzs7Ozs7SUFHaEMsaUNBQXNCOzs7OztJQUFFLHFDQUF5Qjs7Ozs7SUFBRSw0Q0FBb0M7Ozs7O0lBQ3ZGLDhDQUF3QyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IExvY2FsZVNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWxvY2FsZSc7XHJcbi8qXHJcbiAqIEBBdXRob3I6IOeWr+eLguengOaJjShsdWNhcyBodWFuZylcclxuICogQERhdGU6IDIwMTgtMTEtMTMgMTQ6NTU6MzRcclxuICogQExhc3RFZGl0b3JzOiDnlq/ni4Lnp4DmiY0oTHVjYXMgSHVhbmcpXHJcbiAqIEBMYXN0RWRpdFRpbWU6IDIwMTktMTEtMzAgMTA6MTg6MTJcclxuICogQENvbXBhbnk6IEluc3B1clxyXG4gKiBAVmVyc2lvbjogdjAuMC4xXHJcbiAqL1xyXG5cclxuaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIEVsZW1lbnRSZWYsIFJlbmRlcmVyMiwgSG9zdEJpbmRpbmcsIFZpZXdDaGlsZCwgSW5wdXQsXHJcbiAgICBPbkNoYW5nZXMsIFNpbXBsZUNoYW5nZXMsIEV2ZW50RW1pdHRlciwgT3V0cHV0LCBPcHRpb25hbCAgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgTWVzc2FnZXJTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1tZXNzYWdlcic7XHJcbmltcG9ydCB7IExlZnRCcmFja2V0LCBSaWdodHRCcmFja2V0LCBSZWxhdGlvbiwgQ29tcGFyZU9wZXJhdG9ycywgRmlsdGVyQ29uZGl0aW9uLFxyXG4gICAgICAgIENvbXBhcmUsIEZpbHRlclJlbGF0aW9uLCBFeHByZXNzVmFsdWVUeXBlIH0gZnJvbSAnQGZhcnJpcy91aS1jb21tb24vdHlwZXMnO1xyXG5pbXBvcnQgeyBGaWx0ZXJTZXJ2aWNlIH0gZnJvbSAnLi8uLi9zZXJ2aWNlcy9maWx0ZXIuc2VydmljZSc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAnZmlsdGVyLWdyaWQnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcuL2ZpbHRlci1ncmlkLmNvbXBvbmVudC5odG1sJyxcclxuICAgIHN0eWxlczogW1xyXG4gICAgICAgIGBcclxuICAgICAgICAuZmlsdGVyLXNlbGVjdCB7IHdpZHRoOjEwMCU7IHBhZGRpbmctbGVmdDogMDsgcGFkZGluZy1yaWdodDogMDsgfVxyXG4gICAgICAgIC5zZWxlY3RlZCB7IGJhY2tncm91bmQ6ICNjMmU0ZmY7IH1cclxuICAgICAgICBgXHJcbiAgICBdXHJcbn0pXHJcblxyXG5leHBvcnQgY2xhc3MgRmlsdGVyR3JpZENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzIHtcclxuICAgIExlZnRCcmFja2V0RGF0YSA9IExlZnRCcmFja2V0O1xyXG4gICAgUmlnaHR0QnJhY2tldERhdGEgPSBSaWdodHRCcmFja2V0O1xyXG4gICAgcmVsYXRpb25EYXRhID0gUmVsYXRpb247XHJcbiAgICBvcGVyYXRvcnMgPSBDb21wYXJlT3BlcmF0b3JzO1xyXG5cclxuICAgIGNvbHVtblNpemVEYXRhID0gWzYwLCA1MCwgMTIwLCAxMDAsIDYwLCAxMjAsIDUwLCA1MF07XHJcbiAgICBncm91cEljb24gPSAnPGkgY2xhc3M9XCJmLWljb24gZi1pY29uLWxvb2t1cFwiPjwvaT4nO1xyXG5cclxuICAgIEBJbnB1dCgpIGNvbmRpdGlvbnM6IEZpbHRlckNvbmRpdGlvbltdID0gW107XHJcbiAgICBASW5wdXQoKSBjb2x1bW5zOiB7bGFiZWw6IHN0cmluZywgdmFsdWU6IHN0cmluZ31bXSA9IFtdO1xyXG4gICAgQElucHV0KCkgZW5hYmxlRXhwcmVzcyA9IGZhbHNlO1xyXG4gICAgQElucHV0KCkgZW5hYmxlRnJvbnRFeHByZXNzID0gZmFsc2U7XHJcbiAgICBASW5wdXQoKSBoZWlnaHQ6IG51bWJlcjtcclxuICAgIEBJbnB1dCgpIGZpZWxkRWRpdG9yO1xyXG5cclxuICAgIEBPdXRwdXQoKSBzaG93RXhwcmVzcyA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuXHJcbiAgICBAVmlld0NoaWxkKCd0YWJsZWJvZHlib3gnKSB0YWJsZWJvZHlib3g6IEVsZW1lbnRSZWY7XHJcblxyXG4gICAgY3VycmVudENvbmRpdGlvbjogeyBpbmRleDogbnVtYmVyLCBjb25kaXRpb246IEZpbHRlckNvbmRpdGlvbiB9ID0gbnVsbDtcclxuXHJcbiAgICBwcml2YXRlIG5ld0NvbmRpdGlvbjogRmlsdGVyQ29uZGl0aW9uID0ge1xyXG4gICAgICAgIGZpbHRlckZpZWxkOiAnJyxcclxuICAgICAgICB2YWx1ZTogJycsXHJcbiAgICAgICAgbGJyYWNrZXQ6ICcnLFxyXG4gICAgICAgIHJicmFja2V0OiAnJyxcclxuICAgICAgICByZWxhdGlvbjogRmlsdGVyUmVsYXRpb24uRW1wdHksXHJcbiAgICAgICAgY29tcGFyZTogQ29tcGFyZS5FcXVhbCxcclxuICAgICAgICBleHByZXNzdHlwZTogRXhwcmVzc1ZhbHVlVHlwZS5WYWx1ZVxyXG4gICAgfTtcclxuXHJcblxyXG4gICAgbG9jYWxlU2VydmljZTogTG9jYWxlU2VydmljZSA9IG51bGw7XHJcblxyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgcHJpdmF0ZSBlbDogRWxlbWVudFJlZiwgcHJpdmF0ZSByZW5kZXI6IFJlbmRlcmVyMiwgcHJpdmF0ZSBmaWx0ZXJTZXJ2aWNlOiBGaWx0ZXJTZXJ2aWNlLFxyXG4gICAgICAgIHByaXZhdGUgbWVzc2FnZXJTZXJ2aWNlOiBNZXNzYWdlclNlcnZpY2UpIHtcclxuICAgICAgICAgICAgdGhpcy5sb2NhbGVTZXJ2aWNlID0gdGhpcy5tZXNzYWdlclNlcnZpY2VbJ2xvY2FsZVNlcnZpY2UnXTtcclxuICAgICAgICB9XHJcblxyXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBuZ09uSW5pdCgpIHtcclxuXHJcbiAgICAgICAgaWYgKCF0aGlzLmZpZWxkRWRpdG9yKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZmllbGRFZGl0b3IgPSB7IHR5cGU6ICdzZWxlY3QnLCBvcHRpb25zOiB7fX07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmluaXRSZWxhdGlvbkRhdGEoKTtcclxuICAgICAgICBpZiAoIXRoaXMuY29uZGl0aW9ucyB8fCAhdGhpcy5jb25kaXRpb25zLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBjb25zdCBmaXJzdENvbiA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMubmV3Q29uZGl0aW9uKTtcclxuICAgICAgICAgICAgdGhpcy5jb25kaXRpb25zID0gW2ZpcnN0Q29uXTtcclxuICAgICAgICAgICAgdGhpcy5jaGFuZ2VDb25kaXRpb25MaXN0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgaW5pdFJlbGF0aW9uRGF0YSgpIHtcclxuICAgICAgICBpZiAodGhpcy5sb2NhbGVTZXJ2aWNlKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGFuZFN0ciA9IHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZSgnZmlsdGVyRWRpdG9yLnJlbGF0aW9uVmFsdWUuYW5kJyk7XHJcbiAgICAgICAgICAgIGNvbnN0IG9yU3RyID0gdGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKCdmaWx0ZXJFZGl0b3IucmVsYXRpb25WYWx1ZS5vcicpO1xyXG4gICAgICAgICAgICB0aGlzLnJlbGF0aW9uRGF0YSA9IFtcclxuICAgICAgICAgICAgICAgIHsgbGFiZWw6ICcnLCB2YWx1ZTogMH0sXHJcbiAgICAgICAgICAgICAgICB7IGxhYmVsOiBhbmRTdHIsIHZhbHVlOiAxfSxcclxuICAgICAgICAgICAgICAgIHsgbGFiZWw6IG9yU3RyLCB2YWx1ZTogMn1cclxuICAgICAgICAgICAgXTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaW5zZXJ0Q29uZGl0aW9uKGluZGV4OiBudW1iZXIpIHtcclxuICAgICAgICBjb25zdCBfbmV3Q29uZGl0aW9uID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5uZXdDb25kaXRpb24pO1xyXG4gICAgICAgIGlmIChpbmRleCAgPT09IDApIHtcclxuICAgICAgICAgICAgdGhpcy5jb25kaXRpb25zLnVuc2hpZnQoX25ld0NvbmRpdGlvbik7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5jb25kaXRpb25zLnNwbGljZShpbmRleCwgMCwgX25ld0NvbmRpdGlvbik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmNoYW5nZUNvbmRpdGlvbkxpc3QoKTtcclxuICAgIH1cclxuXHJcbiAgICByZW1vdmVDb25kaXRpb24oaW5kZXg6IG51bWJlcikge1xyXG4gICAgICAgIHRoaXMuY29uZGl0aW9ucy5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgICAgIHRoaXMuY2hhbmdlQ29uZGl0aW9uTGlzdCgpO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5jdXJyZW50Q29uZGl0aW9uKSB7XHJcbiAgICAgICAgICAgIGlmIChpbmRleCA9PT0gdGhpcy5jdXJyZW50Q29uZGl0aW9uLmluZGV4KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRDb25kaXRpb24gPSBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9uQWRkRmlsdGVyKCkge1xyXG4gICAgICAgIHRoaXMuY29uZGl0aW9ucyA9IFsuLi50aGlzLmNvbmRpdGlvbnMsIE9iamVjdC5hc3NpZ24oe30sIHRoaXMubmV3Q29uZGl0aW9uKV07XHJcbiAgICAgICAgdGhpcy5jaGFuZ2VDb25kaXRpb25MaXN0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgb25DbGVhcigpIHtcclxuICAgICAgICB0aGlzLm1lc3NhZ2VyU2VydmljZS5xdWVzdGlvbign56Gu6K6k6KaB5riF56m65b2T5YmN5omA5pyJ5p2h5Lu25ZCX77yfJywgKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmNvbmRpdGlvbnMgPSBbXTtcclxuICAgICAgICAgICAgdGhpcy5jaGFuZ2VDb25kaXRpb25MaXN0KCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgb25Nb3ZlVG9wKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmN1cnJlbnRDb25kaXRpb24pIHtcclxuICAgICAgICAgICAgdGhpcy5jb25kaXRpb25zLnVuc2hpZnQodGhpcy5jdXJyZW50Q29uZGl0aW9uLmNvbmRpdGlvbik7XHJcbiAgICAgICAgICAgIHRoaXMuY29uZGl0aW9ucy5zcGxpY2UodGhpcy5jdXJyZW50Q29uZGl0aW9uLmluZGV4ICsgMSwgMSk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRDb25kaXRpb24uaW5kZXggPSAwO1xyXG4gICAgICAgICAgICB0aGlzLmNoYW5nZUNvbmRpdGlvbkxpc3QoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgb25Nb3ZlUHJldigpIHtcclxuICAgICAgICBpZiAodGhpcy5jdXJyZW50Q29uZGl0aW9uKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5jdXJyZW50Q29uZGl0aW9uLmluZGV4O1xyXG4gICAgICAgICAgICBjb25zdCB0ZW1wQXJyID0gdGhpcy5jb25kaXRpb25zLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgICAgICAgIHRoaXMuY29uZGl0aW9ucy5zcGxpY2UoaW5kZXggLSAxLCAwLCAuLi50ZW1wQXJyKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuY3VycmVudENvbmRpdGlvbi5pbmRleCA9IGluZGV4IC0gMTtcclxuICAgICAgICAgICAgdGhpcy5jaGFuZ2VDb25kaXRpb25MaXN0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgb25Nb3ZlTmV4dCgpIHtcclxuICAgICAgICBpZiAodGhpcy5jdXJyZW50Q29uZGl0aW9uKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5jdXJyZW50Q29uZGl0aW9uLmluZGV4O1xyXG4gICAgICAgICAgICBjb25zdCB0ZW1wQXJyID0gdGhpcy5jb25kaXRpb25zLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgICAgICAgIHRoaXMuY29uZGl0aW9ucy5zcGxpY2UoaW5kZXggKyAxLCAwLCAuLi50ZW1wQXJyKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuY3VycmVudENvbmRpdGlvbi5pbmRleCA9IGluZGV4ICsgMTtcclxuICAgICAgICAgICAgdGhpcy5jaGFuZ2VDb25kaXRpb25MaXN0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgb25Nb3ZlQm90dG9tKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmN1cnJlbnRDb25kaXRpb24pIHtcclxuICAgICAgICAgICAgdGhpcy5jb25kaXRpb25zLnB1c2godGhpcy5jdXJyZW50Q29uZGl0aW9uLmNvbmRpdGlvbik7XHJcbiAgICAgICAgICAgIHRoaXMuY29uZGl0aW9ucy5zcGxpY2UodGhpcy5jdXJyZW50Q29uZGl0aW9uLmluZGV4LCAxKTtcclxuICAgICAgICAgICAgdGhpcy5jdXJyZW50Q29uZGl0aW9uLmluZGV4ID0gdGhpcy5jb25kaXRpb25zLmxlbmd0aCAtIDE7XHJcbiAgICAgICAgICAgIHRoaXMuY2hhbmdlQ29uZGl0aW9uTGlzdCgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNoYW5nZUNvbmRpdGlvbkxpc3QoKSB7XHJcbiAgICAgICAgdGhpcy5maWx0ZXJTZXJ2aWNlLmNvbmRpdGlvbnNDaGFuZ2VkLm5leHQodGhpcy5jb25kaXRpb25zKTtcclxuICAgIH1cclxuXHJcbiAgICBzZWxlY3RlZCgkZXZlbnQpIHtcclxuICAgICAgICAvLyBjb25zb2xlLmxvZygkZXZlbnQpO1xyXG4gICAgICAgIHRoaXMuY3VycmVudENvbmRpdGlvbiA9ICRldmVudDtcclxuICAgIH1cclxuXHJcbiAgICBpc1NlbGVjdGVkKCRldmVudDogbnVtYmVyKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuY3VycmVudENvbmRpdGlvbikge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50Q29uZGl0aW9uLmluZGV4ID09PSAkZXZlbnQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBzaG93RXhwcmVzc0RpYWxvZygkZXZlbnQsIGNvbmRpdGlvbiwgdmFsdWUpIHtcclxuICAgICAgICBjb25zdCB0eXBlID0gY29uZGl0aW9uLmV4cHJlc3N0eXBlID09PSAxID8gJ2V4cHJlc3MnIDogJ2Zyb250RXhwcmVzcyc7XHJcbiAgICAgICAgdGhpcy5zaG93RXhwcmVzcy5lbWl0KHsgZXZlbnQ6ICRldmVudCwgY29uZGl0aW9uLCB2YWx1ZSwgdHlwZSB9KTtcclxuICAgIH1cclxuXHJcbiAgICBvbkNvbWJvU2VsZWN0Q2hhbmdlKCRldmVudCwgIGNvbmRpdGlvbikge1xyXG4gICAgICAgIGlmICgkZXZlbnQpIHtcclxuICAgICAgICAgICAgY29uc3QgeyBkYXRhIH0gPSAkZXZlbnQ7XHJcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICBjb25kaXRpb24uZmlsdGVyRmllbGQgPSBkYXRhWyd2YWx1ZSddO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiJdfQ==