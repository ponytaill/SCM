/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { of } from 'rxjs';
import { debounceTime, switchMap } from 'rxjs/operators';
import { LookupGridDisplayType } from '../lookup-displaytype';
import { LookupLeftComponent } from '../lookup-left.component';
export class LookupComponentManager {
    /**
     * @param {?} ins
     */
    constructor(ins) {
        this.ins = ins;
    }
    /**
     * @param {?=} type
     * @return {?}
     */
    getComponentInstance(type = 'datatable') {
        if (!this.ins.componentRef || !this.ins.componentRef.instance) {
            return null;
        }
        if (type === 'selected') {
            return this.ins.multiSelectDT;
        }
        /** @type {?} */
        let ins = this.ins.componentRef.instance;
        if (type === 'leftDataTable' || type === 'leftTree') {
            /** @type {?} */
            const leftRef = this.ins.leftComponentRef;
            if (!leftRef || !leftRef.instance || !leftRef.instance.cmpRef || !leftRef.instance.cmpRef.instance) {
                return null;
            }
            ins = this.ins.leftComponentRef.instance.cmpRef.instance;
        }
        if (type === 'fav') {
            ins = this.ins.favoritesComponentRef.instance;
        }
        switch (type) {
            case 'leftDataTable':
            case 'fav':
            case 'datatable':
                return (/** @type {?} */ (ins));
            case 'leftTree':
            case 'treetable':
                return (/** @type {?} */ (ins));
            default:
                if (this.ins.isTree()) {
                    return (/** @type {?} */ (ins));
                }
                return (/** @type {?} */ (ins));
        }
    }
    /**
     * @param {?} data
     * @return {?}
     */
    createComponentWithServerData(data) {
        if (this.ins.componentRef) {
            return;
        }
        this.ins.idField = data.idField || this.ins.idField;
        this.ins.textField = data.textField || this.ins.textField;
        this.ins.valueField = data.valueField || this.ins.valueField;
        this.ins.displayType = (data && data.displayType) || this.ins.displayType || 'LIST';
        /** @type {?} */
        const dtyp = this.ins.displayType.toUpperCase();
        if (this.ins.isDoublleList()) {
            if (this.ins.navTreeToList && dtyp === LookupGridDisplayType.NavTreeList) {
                this.ins.displayType = LookupGridDisplayType.NavList;
            }
            if (this.ins.treeToList) {
                if (dtyp === LookupGridDisplayType.NavListTree) {
                    this.ins.displayType = LookupGridDisplayType.NavList;
                }
            }
        }
        else {
            if (this.ins.treeToList) {
                if (dtyp === LookupGridDisplayType.TreeList) {
                    this.ins.displayType = 'LIST';
                }
                else {
                    if (dtyp === LookupGridDisplayType.NavListTree) {
                        this.ins.displayType = LookupGridDisplayType.NavList;
                    }
                }
            }
        }
        if (this.ins.isDoublleList() && this.ins.navTreeToList) {
            if (dtyp === LookupGridDisplayType.NavTreeList) {
                this.ins.displayType = LookupGridDisplayType.NavList;
            }
        }
        this.ins.changeDetector.detectChanges();
        this.ins.componentRef = this.createContent(this.ins.gridOptions);
        this.createFavoriteComponent();
        this.resizeComponent();
    }
    /**
     * @return {?}
     */
    createFavoriteComponent() {
        if (this.ins.useFavorite && !this.ins.favoritesComponentRef) {
            this.ins.favoriteColumns = this.ins.favHelper.getFavoriteColumns();
            /** @type {?} */
            const favoritesOptions = Object.assign({}, this.ins.gridOptions, {
                showFilterBar: false,
                pagination: false,
                columns: this.ins.favoriteColumns || []
            });
            this.ins.favoritesComponentRef = this.createFavoritesContent(favoritesOptions);
            this.resizeComponent('fav');
        }
    }
    /**
     * @private
     * @param {?} expandLevel
     * @return {?}
     */
    reloadTreeDataForExpand(expandLevel) {
        /** @type {?} */
        const uri = this.ins.gridOptions.uri;
        /** @type {?} */
        const tt = (/** @type {?} */ (this.ins.componentRef.instance));
        const { field = '*', value = '' } = Object.assign({}, tt.searchData);
        /** @type {?} */
        const search = { category: 'all', searchValue: value, searchField: field, layerNum: expandLevel };
        /** @type {?} */
        const param = {
            searchValue: JSON.stringify(search),
            customData: this.ins.customData,
            enableFullTree: this.ins.enableFullTree,
            loadTreeDataType: this.ins.loadTreeDataType
        };
        if (this.ins.helpId) {
            param['helpId'] = this.ins.helpId;
        }
        if (tt && tt.sortName) {
            Object.assign(param, {
                sortName: tt.sortName,
                sortOrder: tt.sortOrder
            });
        }
        this.ins.showLoading();
        return this.ins.http.getData(uri, param).subscribe((/**
         * @param {?} data
         * @return {?}
         */
        (data) => {
            this.ins.closeLoading();
            /** @type {?} */
            const nodes = this.ins.checkNodeCanBeSelect(data.items, expandLevel === -1);
            this.ins.items = nodes;
            tt.loadData(nodes);
        }));
    }
    /**
     * @private
     * @param {?} nodes
     * @param {?} level
     * @return {?}
     */
    setTreeNodeExpandBy(nodes, level) {
        if (!nodes || !nodes.length) {
            return;
        }
        nodes.forEach((/**
         * @param {?} n
         * @return {?}
         */
        (n) => {
            /** @type {?} */
            const layer = n.data[this.ins.treeInfo.dataField].layer;
            /** @type {?} */
            const expandLayer = layer + level - 1;
            n.expanded = layer <= expandLayer ? true : n.expanded;
            if (n.children && n.children.length && layer + 1 <= expandLayer) {
                this.setTreeNodeExpandBy(n.children, level);
            }
        }));
    }
    // 启用树帮助右键菜单功能
    /**
     * @private
     * @param {?} cmpRef
     * @return {?}
     */
    useContextMenuForTree(cmpRef) {
        const { maxLevel, enableContextMenu, language } = this.ins.treeTableOptions;
        if (enableContextMenu && maxLevel) {
            /** @type {?} */
            const levelMenus = [];
            for (let i = 1; i <= maxLevel; i++) {
                /** @type {?} */
                const title = language['expand' + i];
                levelMenus.push({ id: 30 + 1, code: i, title, handle: (/**
                     * @param {?} t
                     * @return {?}
                     */
                    (t) => {
                        // 发送请求获取数据
                        /** @type {?} */
                        const level = t.menu.code;
                        if (isLoadAllTreeData()) {
                            this.setTreeNodeExpandBy(this.ins.items, level);
                            cmpRef.instance.updateSerializedValue();
                        }
                        else {
                            const { dataField, layerField } = this.ins.treeInfo;
                            /** @type {?} */
                            const firstNodeData = (this.ins.items || [])[0];
                            if (firstNodeData && firstNodeData.data) {
                                /** @type {?} */
                                const minLayer = this.ins.utils.getValue(`${dataField}.${layerField}`, firstNodeData.data);
                                /** @type {?} */
                                let _level = minLayer + level - 1;
                                this.reloadTreeDataForExpand(_level);
                            }
                        }
                    }) });
            }
            /** @type {?} */
            const isLoadAllTreeData = (/**
             * @return {?}
             */
            () => {
                if (this.ins.loadTreeDataType === 'default') {
                    return cmpRef.instance.loadDataType === 'all';
                }
                else {
                    return this.ins.loadTreeDataType === 'loadall';
                }
            });
            /** @type {?} */
            const contextMenus = [
                {
                    id: 6, code: 'checkchildnodes', title: '勾选下级数据',
                    visible: (/**
                     * @param {?} e
                     * @return {?}
                     */
                    (e) => {
                        // console.log(e);
                        return !e.data.node.selectable && !this.ins.singleSelect && e.data.node.children && e.data.node.children.length;
                    }),
                    handle: (/**
                     * @param {?} t
                     * @return {?}
                     */
                    (t) => {
                        if (cmpRef) {
                            /** @type {?} */
                            const nodeIds = cmpRef.instance.getChildNodes(t.data.id).filter((/**
                             * @param {?} n
                             * @return {?}
                             */
                            n => n.selectable)).map((/**
                             * @param {?} n
                             * @return {?}
                             */
                            n => n[this.ins.idField]));
                            // const nodeIds = t.data.node.children.map(n => n[this.ins.idField]);
                            cmpRef.instance.checkedNodes(nodeIds);
                            cmpRef.instance.selectNodes(nodeIds);
                        }
                    })
                },
                {
                    id: 5, code: 'uncheckchildnodes', title: '取消勾选下级数据',
                    visible: (/**
                     * @param {?} e
                     * @return {?}
                     */
                    (e) => {
                        // console.log(e);
                        return !e.data.node.selectable && !this.ins.singleSelect && e.data.node.children && e.data.node.children.length;
                    }),
                    handle: (/**
                     * @param {?} t
                     * @return {?}
                     */
                    (t) => {
                        if (cmpRef) {
                            // const nodeIds = t.data.node.children.map(n => n[this.ins.idField]);
                            /** @type {?} */
                            const nodeIds = cmpRef.instance.getChildNodes(t.data.id).filter((/**
                             * @param {?} n
                             * @return {?}
                             */
                            n => n.selectable)).map((/**
                             * @param {?} n
                             * @return {?}
                             */
                            n => n[this.ins.idField]));
                            cmpRef.instance.unCheckedNodes(nodeIds);
                            cmpRef.instance.unSelectNodes(nodeIds);
                        }
                    })
                },
                '-',
                {
                    id: 1, code: 'expandall', title: language.expandall, handle: (/**
                     * @param {?} t
                     * @return {?}
                     */
                    (t) => {
                        if (cmpRef && isLoadAllTreeData()) {
                            cmpRef.instance.expandAll();
                        }
                        else {
                            // 发送请求获取数据
                            this.reloadTreeDataForExpand(-1);
                        }
                    })
                },
                { id: 2, code: 'collapseall', title: language.collapseall, handle: (/**
                     * @param {?} t
                     * @return {?}
                     */
                    (t) => {
                        if (cmpRef) {
                            cmpRef.instance.collapseAll();
                        }
                    }) },
                '-',
                {
                    id: 3, title: language.expandByLayer,
                    children: levelMenus
                }
            ];
            this.ins.treeTableOptions.contextMenuItems = contextMenus;
            cmpRef.instance.beforeShowContextMenu = (/**
             * @return {?}
             */
            () => {
                return of({ show: !cmpRef.instance.state.searched });
            });
        }
    }
    /**
     * @private
     * @return {?}
     */
    getSpaceWidth() {
        return this.ins.layoutFormat === 'default' ? 20 : 48;
    }
    /**
     * @param {?} opts
     * @return {?}
     */
    createContent(opts) {
        if (this.ins.componentRef) {
            return;
        }
        /** @type {?} */
        const type = this.ins.getComponentType();
        /** @type {?} */
        const cmpFac = this.ins.cfr.resolveComponentFactory(type);
        /** @type {?} */
        let cmpRef = null;
        if (this.ins.isDoublleList()) {
            cmpRef = this.ins.centerContainer.createComponent(cmpFac);
        }
        else {
            cmpRef = this.ins.contentContainer.createComponent(cmpFac);
        }
        if (this.ins.isTree()) {
            opts.fit = true;
            opts.pagination = false;
            opts.fast = true;
            if (this.ins.useFavorite) {
                opts.fitColumns = false;
                opts.autoFitColumns = true;
            }
            this.useContextMenuForTree(cmpRef);
        }
        else {
            opts.fill = true;
        }
        /** @type {?} */
        const ttOpts = this.ins.treeTableOptions || {};
        Object.assign(cmpRef.instance, opts, Object.assign({ allColumnsTitle: this.ins.allColumnsTitle }, ttOpts));
        this.ins.componentRef = cmpRef;
        this.resizeComponent();
        return cmpRef;
    }
    // 创建收藏CMP
    /**
     * @param {?} opts
     * @return {?}
     */
    createFavoritesContent(opts) {
        /** @type {?} */
        const type = this.ins.getComponentType();
        /** @type {?} */
        const cmpFac = this.ins.cfr.resolveComponentFactory(type);
        /** @type {?} */
        let cmpRef = null;
        cmpRef = this.ins.favoritesContainer.createComponent(cmpFac);
        if (this.ins.isTree()) {
            opts.fit = true;
            opts.pagination = false;
        }
        else {
            opts.fill = true;
        }
        Object.assign(cmpRef.instance, opts, {
            width: this.ins.dialog.size.width - this.getSpaceWidth(),
            height: this.ins.dialogMgr.getHeight()
        });
        // 订阅收藏夹列表中组件的相关事件
        this.ins.favHelper.initFavoriteComponentEvent(cmpRef);
        return cmpRef;
    }
    /**
     * @param {?=} type
     * @return {?}
     */
    resizeComponent(type = 'datatable') {
        /** @type {?} */
        const size = {
            width: this.ins.dialog.size.width - this.getSpaceWidth(),
            height: this.ins.dialogMgr.getHeight()
        };
        if (this.ins.isDoublleList() && (type === 'datatable' || type === 'treetable')) {
            size.width = this.ins.dialog.size.width - this.ins.leftPanelWidth - (this.ins.layoutFormat === 'default' ? 20 : 48) - 7;
        }
        this.getComponentInstance(type).resize(size);
    }
    /**
     * @private
     * @param {?} node
     * @return {?}
     */
    getChildNodes(node) {
        /** @type {?} */
        const nodes = [];
        if (node.selectable || node.selectable === undefined) {
            nodes.push(node);
        }
        if (node.children && node.children.length) {
            node.children.forEach((/**
             * @param {?} n
             * @return {?}
             */
            n => {
                nodes.push(...this.getChildNodes(n));
            }));
        }
        return nodes;
    }
    /**
     * 创建左侧组件
     * @param {?} ops
     * @return {?}
     */
    createLeftComponent(ops) {
        /** @type {?} */
        let dtFac = null;
        if (this.ins.isDoublleList()) {
            dtFac = this.ins.cfr.resolveComponentFactory(LookupLeftComponent);
        }
        this.ins.leftComponentRef = this.ins.leftContainer.createComponent(dtFac);
        ops.height = this.ins.dialogMgr.getHeight();
        if (this.ins.dialogWidth < this.ins.navLookupDialogMinWidth) {
            this.ins.dialogWidth = this.ins.navLookupDialogMinWidth;
            this.ins.dialog.reSize({ width: this.ins.dialogWidth });
            this.ins.resizeCmp({ width: this.ins.dialog.size.width });
        }
        if (ops.width !== this.ins.leftPanel.width) {
            // 默认 1 : 2
            this.ins.leftPanel.resize({
                width: this.ins.leftPanel.width,
                height: ops.height
            });
            this.ins.resizeCmp({ width: this.ins.dialog.size.width });
        }
        // this.resizeComponent();
        this.ins.leftComponentRef.instance.lookupCmp = this.ins;
        this.ins.leftComponentRef.instance.navOptions = ops;
        this.ins.leftComponentRef.instance.selected
            .pipe(debounceTime(100), switchMap((/**
         * @param {?} d
         * @return {?}
         */
        (d) => {
            if (d && d.data) {
                this.ins.navigationFilter = {
                    selected: d.data,
                    idValue: this.getNavigationFilter(d.data),
                    searchField: '',
                    searchValue: ''
                };
            }
            else {
                this.ins.navigationFilter = undefined;
            }
            // 加载右侧数据
            /** @type {?} */
            const p = {
                pageInfo: {
                    pageIndex: this.ins.gridOptions.pageIndex,
                    pageSize: this.ins.gridOptions.pageSize
                }
            };
            if (this.ins.includeSubordinates && d && d.node && ops.treeInfo) {
                const { layerType, pathField, loadDataType, dataField } = ops.treeInfo;
                if (loadDataType === 'all') {
                    /** @type {?} */
                    const rowDatas = this.getChildNodes(d.node).map((/**
                     * @param {?} n
                     * @return {?}
                     */
                    n => n.data));
                    this.ins.navigationFilter.idValue = this.getNavigationFilter(rowDatas);
                }
                else {
                    if (layerType == 'pathcode') {
                        // p['navNodePathCode'] = d.data[dataField][pathField];
                        p['navNodePathCode'] = this.ins.getPathCode(d.data, ops.treeInfo);
                        this.ins['navNodePathCode'] = p['navNodePathCode'];
                    }
                }
            }
            else {
                this.ins['navNodePathCode'] = '';
            }
            /** @type {?} */
            const dataCmpRef = this.getComponentInstance();
            const { sortName, sortOrder } = dataCmpRef;
            Object.assign(p, { search: this.ins._searchState, sortName, sortOrder });
            return this.ins.httpMgr.getData(p, 'list');
        })))
            .subscribe((/**
         * @param {?} res
         * @return {?}
         */
        res => {
            this.ins.closeLoading();
            this.ins.loadDataWhenOpen = true;
            // if (this.ins.useFavorite && !this.ins.isTree()) {
            //     this.ins.favHelper.updateFavoritesStatus(res.items);
            // }
            // this.ins.loadDataTableData(res);
            this.ins.loadData(res, false);
            setTimeout((/**
             * @return {?}
             */
            () => {
                // 选中数据
                this.ins.selectionMgr.selectCurrentValue();
                this.ins.changeDetector.detectChanges();
            }));
        }));
        return this.ins.leftComponentRef.instance.createComponent();
    }
    // 获取关联数据, 右侧数据中 关联各字段的值
    /**
     * @private
     * @param {?} navRow
     * @return {?}
     */
    getNavigationFilter(navRow) {
        if (this.ins.navigationOptions.relations && this.ins.navigationOptions.relations.length) {
            /** @type {?} */
            const result = [];
            this.ins.navigationOptions.relations.forEach((/**
             * @param {?} r
             * @return {?}
             */
            r => {
                /** @type {?} */
                const k = r.groupField;
                /** @type {?} */
                const dField = r.helpField;
                /** @type {?} */
                const rf = { fieldName: dField, fieldValue: '' };
                if (Array.isArray(navRow)) {
                    /** @type {?} */
                    const vals = navRow.map((/**
                     * @param {?} n
                     * @return {?}
                     */
                    n => {
                        return k.split('.').reduce((/**
                         * @param {?} o
                         * @param {?} c
                         * @return {?}
                         */
                        (o, c) => {
                            return o[c];
                        }), n);
                    }));
                    rf.fieldValue = vals.join(',');
                }
                else {
                    rf.fieldValue = k.split('.').reduce((/**
                     * @param {?} o
                     * @param {?} c
                     * @return {?}
                     */
                    (o, c) => {
                        return o[c];
                    }), navRow);
                }
                result.push(rf);
            }));
            return result;
        }
        return '';
    }
}
if (false) {
    /**
     * @type {?}
     * @private
     */
    LookupComponentManager.prototype.ins;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9va3VwLWNvbXBvbmVudC5tYW5hZ2VyLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1sb29rdXAvIiwic291cmNlcyI6WyJsaWIvc2VydmljZXMvbG9va3VwLWNvbXBvbmVudC5tYW5hZ2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFJQSxPQUFPLEVBQUUsRUFBRSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQzFCLE9BQU8sRUFBRSxZQUFZLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDekQsT0FBTyxFQUF5QixxQkFBcUIsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBRXJGLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBRy9ELE1BQU0sT0FBTyxzQkFBc0I7Ozs7SUFDL0IsWUFBb0IsR0FBd0I7UUFBeEIsUUFBRyxHQUFILEdBQUcsQ0FBcUI7SUFBRyxDQUFDOzs7OztJQUVoRCxvQkFBb0IsQ0FBQyxPQUE4QixXQUFXO1FBQzFELElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLFlBQVksSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDLFFBQVEsRUFBRTtZQUMzRCxPQUFPLElBQUksQ0FBQztTQUNmO1FBRUQsSUFBSSxJQUFJLEtBQUssVUFBVSxFQUFFO1lBQ3JCLE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxhQUFhLENBQUM7U0FDakM7O1lBRUcsR0FBRyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDLFFBQVE7UUFFeEMsSUFBSSxJQUFJLEtBQUssZUFBZSxJQUFJLElBQUksS0FBSyxVQUFVLEVBQUU7O2tCQUMzQyxPQUFPLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0I7WUFDekMsSUFBSSxDQUFDLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxRQUFRLElBQUksQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLE1BQU0sSUFBSSxDQUFD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OztzQkFDaEIsTUFBTSxHQUFHLENBQUMsQ0FBQyxTQUFTOztzQkFDcEIsRUFBRSxHQUFRLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRSxVQUFVLEVBQUUsRUFBRSxFQUFFO2dCQUVyRCxJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEVBQUU7OzBCQUNqQixJQUFJLEdBQUcsTUFBTSxDQUFDLEdBQUc7Ozs7b0JBQUMsQ0FBQyxDQUFDLEVBQUU7d0JBQ3hCLE9BQU8sQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxNQUFNOzs7Ozt3QkFBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRTs0QkFDaEMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7d0JBQ2hCLENBQUMsR0FBRSxDQUFDLENBQUMsQ0FBQztvQkFDVixDQUFDLEVBQUM7b0JBQ0YsRUFBRSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2lCQUNsQztxQkFBTTtvQkFDSCxFQUFFLENBQUMsVUFBVSxHQUFHLENBQUMsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsTUFBTTs7Ozs7b0JBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUU7d0JBQ3pDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO29CQUNoQixDQUFDLEdBQUUsTUFBTSxDQUFDLENBQUM7aUJBQ2Q7Z0JBRUQsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUNwQixDQUFDLEVBQUMsQ0FBQztZQUNILE9BQU8sTUFBTSxDQUFDO1NBQ2pCO1FBRUQsT0FBTyxFQUFFLENBQUM7SUFDZCxDQUFDO0NBQ0o7Ozs7OztJQTlkZSxxQ0FBZ0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnRSZWYgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgRGF0YVRhYmxlQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1kYXRhdGFibGUnO1xyXG5pbXBvcnQgeyBPUFRTIH0gZnJvbSAnQGZhcnJpcy91aS1kYXRlcGlja2VyL3B1YmxpYy1hcGknO1xyXG5pbXBvcnQgeyBUcmVlTm9kZSwgVHJlZVRhYmxlQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS10cmVldGFibGUnO1xyXG5pbXBvcnQgeyBvZiB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBkZWJvdW5jZVRpbWUsIHN3aXRjaE1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgQ29tcG9uZW50SW5zdGFuY2VUeXBlLCBMb29rdXBHcmlkRGlzcGxheVR5cGUgfSBmcm9tICcuLi9sb29rdXAtZGlzcGxheXR5cGUnO1xyXG5pbXBvcnQgeyBMb29rdXBHcmlkQ29tcG9uZW50IH0gZnJvbSAnLi4vbG9va3VwLWdyaWQuY29tcG9uZW50JztcclxuaW1wb3J0IHsgTG9va3VwTGVmdENvbXBvbmVudCB9IGZyb20gJy4uL2xvb2t1cC1sZWZ0LmNvbXBvbmVudCc7XHJcblxyXG5cclxuZXhwb3J0IGNsYXNzIExvb2t1cENvbXBvbmVudE1hbmFnZXIge1xyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBpbnM6IExvb2t1cEdyaWRDb21wb25lbnQpIHt9XHJcblxyXG4gICAgZ2V0Q29tcG9uZW50SW5zdGFuY2UodHlwZTogQ29tcG9uZW50SW5zdGFuY2VUeXBlID0gJ2RhdGF0YWJsZScpIHtcclxuICAgICAgICBpZiAoIXRoaXMuaW5zLmNvbXBvbmVudFJlZiB8fCAhdGhpcy5pbnMuY29tcG9uZW50UmVmLmluc3RhbmNlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHR5cGUgPT09ICdzZWxlY3RlZCcpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW5zLm11bHRpU2VsZWN0RFQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgaW5zID0gdGhpcy5pbnMuY29tcG9uZW50UmVmLmluc3RhbmNlO1xyXG5cclxuICAgICAgICBpZiAodHlwZSA9PT0gJ2xlZnREYXRhVGFibGUnIHx8IHR5cGUgPT09ICdsZWZ0VHJlZScpIHtcclxuICAgICAgICAgICAgY29uc3QgbGVmdFJlZiA9IHRoaXMuaW5zLmxlZnRDb21wb25lbnRSZWY7XHJcbiAgICAgICAgICAgIGlmICghbGVmdFJlZiB8fCAhbGVmdFJlZi5pbnN0YW5jZSB8fCAhbGVmdFJlZi5pbnN0YW5jZS5jbXBSZWYgfHwgIWxlZnRSZWYuaW5zdGFuY2UuY21wUmVmLmluc3RhbmNlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpbnMgPSB0aGlzLmlucy5sZWZ0Q29tcG9uZW50UmVmLmluc3RhbmNlLmNtcFJlZi5pbnN0YW5jZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0eXBlID09PSAnZmF2Jykge1xyXG4gICAgICAgICAgICBpbnMgPSB0aGlzLmlucy5mYXZvcml0ZXNDb21wb25lbnRSZWYuaW5zdGFuY2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcclxuICAgICAgICAgICAgY2FzZSAnbGVmdERhdGFUYWJsZSc6XHJcbiAgICAgICAgICAgIGNhc2UgJ2Zhdic6XHJcbiAgICAgICAgICAgIGNhc2UgJ2RhdGF0YWJsZSc6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaW5zIGFzIERhdGFUYWJsZUNvbXBvbmVudDtcclxuICAgICAgICAgICAgY2FzZSAnbGVmdFRyZWUnOlxyXG4gICAgICAgICAgICBjYXNlICd0cmVldGFibGUnOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGlucyBhcyBUcmVlVGFibGVDb21wb25lbnQ7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pbnMuaXNUcmVlKCkpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW5zIGFzIFRyZWVUYWJsZUNvbXBvbmVudDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiBpbnMgYXMgRGF0YVRhYmxlQ29tcG9uZW50O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjcmVhdGVDb21wb25lbnRXaXRoU2VydmVyRGF0YShkYXRhOiBhbnkpIHtcclxuICAgICAgICBpZiAodGhpcy5pbnMuY29tcG9uZW50UmVmKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5pbnMuaWRGaWVsZCA9IGRhdGEuaWRGaWVsZCB8fCB0aGlzLmlucy5pZEZpZWxkO1xyXG4gICAgICAgIHRoaXMuaW5zLnRleHRGaWVsZCA9IGRhdGEudGV4dEZpZWxkIHx8IHRoaXMuaW5zLnRleHRGaWVsZDtcclxuICAgICAgICB0aGlzLmlucy52YWx1ZUZpZWxkID0gZGF0YS52YWx1ZUZpZWxkIHx8IHRoaXMuaW5zLnZhbHVlRmllbGQ7XHJcblxyXG4gICAgICAgIHRoaXMuaW5zLmRpc3BsYXlUeXBlID0gKGRhdGEgJiYgZGF0YS5kaXNwbGF5VHlwZSkgfHwgdGhpcy5pbnMuZGlzcGxheVR5cGUgfHwgJ0xJU1QnO1xyXG5cclxuICAgICAgICBjb25zdCBkdHlwID0gdGhpcy5pbnMuZGlzcGxheVR5cGUudG9VcHBlckNhc2UoKTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuaW5zLmlzRG91YmxsZUxpc3QoKSkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5pbnMubmF2VHJlZVRvTGlzdCAmJiBkdHlwID09PSBMb29rdXBHcmlkRGlzcGxheVR5cGUuTmF2VHJlZUxpc3QpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5zLmRpc3BsYXlUeXBlID0gTG9va3VwR3JpZERpc3BsYXlUeXBlLk5hdkxpc3Q7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmlucy50cmVlVG9MaXN0KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZHR5cCA9PT0gIExvb2t1cEdyaWREaXNwbGF5VHlwZS5OYXZMaXN0VHJlZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zLmRpc3BsYXlUeXBlID0gTG9va3VwR3JpZERpc3BsYXlUeXBlLk5hdkxpc3Q7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuaW5zLnRyZWVUb0xpc3QpIHtcclxuICAgICAgICAgICAgICAgIGlmIChkdHlwID09PSBMb29rdXBHcmlkRGlzcGxheVR5cGUuVHJlZUxpc3QpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5kaXNwbGF5VHlwZSA9ICdMSVNUJztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGR0eXAgPT09ICBMb29rdXBHcmlkRGlzcGxheVR5cGUuTmF2TGlzdFRyZWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMuZGlzcGxheVR5cGUgPSBMb29rdXBHcmlkRGlzcGxheVR5cGUuTmF2TGlzdDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiBcclxuXHJcbiAgICAgICAgXHJcblxyXG4gICAgICAgIGlmICh0aGlzLmlucy5pc0RvdWJsbGVMaXN0KCkgJiYgdGhpcy5pbnMubmF2VHJlZVRvTGlzdCkge1xyXG4gICAgICAgICAgICBpZiAoZHR5cCA9PT0gTG9va3VwR3JpZERpc3BsYXlUeXBlLk5hdlRyZWVMaXN0KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlucy5kaXNwbGF5VHlwZSA9IExvb2t1cEdyaWREaXNwbGF5VHlwZS5OYXZMaXN0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmlucy5jaGFuZ2VEZXRlY3Rvci5kZXRlY3RDaGFuZ2VzKCk7XHJcblxyXG4gICAgICAgIHRoaXMuaW5zLmNvbXBvbmVudFJlZiA9IHRoaXMuY3JlYXRlQ29udGVudCh0aGlzLmlucy5ncmlkT3B0aW9ucyk7XHJcbiAgICAgICAgdGhpcy5jcmVhdGVGYXZvcml0ZUNvbXBvbmVudCgpO1xyXG5cclxuICAgICAgICB0aGlzLnJlc2l6ZUNvbXBvbmVudCgpO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBjcmVhdGVGYXZvcml0ZUNvbXBvbmVudCgpIHtcclxuICAgICAgICBpZiAodGhpcy5pbnMudXNlRmF2b3JpdGUgJiYgIXRoaXMuaW5zLmZhdm9yaXRlc0NvbXBvbmVudFJlZikge1xyXG4gICAgICAgICAgICB0aGlzLmlucy5mYXZvcml0ZUNvbHVtbnMgPSB0aGlzLmlucy5mYXZIZWxwZXIuZ2V0RmF2b3JpdGVDb2x1bW5zKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGZhdm9yaXRlc09wdGlvbnMgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLmlucy5ncmlkT3B0aW9ucywge1xyXG4gICAgICAgICAgICAgICAgc2hvd0ZpbHRlckJhcjogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBwYWdpbmF0aW9uOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIGNvbHVtbnM6IHRoaXMuaW5zLmZhdm9yaXRlQ29sdW1ucyB8fCBbXVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdGhpcy5pbnMuZmF2b3JpdGVzQ29tcG9uZW50UmVmID0gdGhpcy5jcmVhdGVGYXZvcml0ZXNDb250ZW50KGZhdm9yaXRlc09wdGlvbnMpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5yZXNpemVDb21wb25lbnQoJ2ZhdicpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG4gICAgcHJpdmF0ZSByZWxvYWRUcmVlRGF0YUZvckV4cGFuZChleHBhbmRMZXZlbCkge1xyXG4gICAgICAgIGNvbnN0IHVyaSA9IHRoaXMuaW5zLmdyaWRPcHRpb25zLnVyaTtcclxuICAgICAgICBjb25zdCB0dCA9IHRoaXMuaW5zLmNvbXBvbmVudFJlZi5pbnN0YW5jZSBhcyBUcmVlVGFibGVDb21wb25lbnQ7XHJcbiAgICAgICAgY29uc3QgeyBmaWVsZCA9ICcqJywgdmFsdWUgPSAnJyB9ID0ge1xyXG4gICAgICAgICAgICAuLi50dC5zZWFyY2hEYXRhXHJcbiAgICAgICAgfTtcclxuICAgICAgICBjb25zdCBzZWFyY2ggPSB7IGNhdGVnb3J5OiAnYWxsJywgc2VhcmNoVmFsdWU6IHZhbHVlLCBzZWFyY2hGaWVsZDogZmllbGQsIGxheWVyTnVtOiBleHBhbmRMZXZlbCB9O1xyXG5cclxuXHJcbiAgICAgICAgY29uc3QgcGFyYW0gPSB7XHJcbiAgICAgICAgICAgIHNlYXJjaFZhbHVlOiBKU09OLnN0cmluZ2lmeShzZWFyY2gpLFxyXG4gICAgICAgICAgICBjdXN0b21EYXRhOiB0aGlzLmlucy5jdXN0b21EYXRhLFxyXG4gICAgICAgICAgICBlbmFibGVGdWxsVHJlZTogdGhpcy5pbnMuZW5hYmxlRnVsbFRyZWUsXHJcbiAgICAgICAgICAgIGxvYWRUcmVlRGF0YVR5cGU6IHRoaXMuaW5zLmxvYWRUcmVlRGF0YVR5cGVcclxuICAgICAgICB9O1xyXG5cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuaW5zLmhlbHBJZCkge1xyXG4gICAgICAgICAgICBwYXJhbVsnaGVscElkJ10gPSB0aGlzLmlucy5oZWxwSWQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodHQgJiYgdHQuc29ydE5hbWUpIHtcclxuICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihwYXJhbSwge1xyXG4gICAgICAgICAgICAgICAgc29ydE5hbWU6IHR0LnNvcnROYW1lLFxyXG4gICAgICAgICAgICAgICAgc29ydE9yZGVyOiB0dC5zb3J0T3JkZXJcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaW5zLnNob3dMb2FkaW5nKCk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5zLmh0dHAuZ2V0RGF0YSh1cmksIHBhcmFtKS5zdWJzY3JpYmUoKGRhdGE6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmlucy5jbG9zZUxvYWRpbmcoKTtcclxuICAgICAgICAgICAgY29uc3Qgbm9kZXMgPSB0aGlzLmlucy5jaGVja05vZGVDYW5CZVNlbGVjdChkYXRhLml0ZW1zLCBleHBhbmRMZXZlbCA9PT0gLTEpO1xyXG4gICAgICAgICAgICB0aGlzLmlucy5pdGVtcyA9IG5vZGVzO1xyXG4gICAgICAgICAgICB0dC5sb2FkRGF0YShub2Rlcyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzZXRUcmVlTm9kZUV4cGFuZEJ5KG5vZGVzOiBUcmVlTm9kZVtdLCBsZXZlbCkge1xyXG4gICAgICAgIGlmICghbm9kZXMgfHwgIW5vZGVzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG5vZGVzLmZvckVhY2goKG46IFRyZWVOb2RlKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGxheWVyID0gbi5kYXRhW3RoaXMuaW5zLnRyZWVJbmZvLmRhdGFGaWVsZF0ubGF5ZXI7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBleHBhbmRMYXllciA9IGxheWVyICsgbGV2ZWwgLSAxO1xyXG5cclxuICAgICAgICAgICAgbi5leHBhbmRlZCA9IGxheWVyIDw9IGV4cGFuZExheWVyID8gdHJ1ZSA6IG4uZXhwYW5kZWQ7XHJcbiAgICAgICAgICAgIGlmIChuLmNoaWxkcmVuICYmIG4uY2hpbGRyZW4ubGVuZ3RoICYmIGxheWVyICsgMSA8PSBleHBhbmRMYXllcikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRUcmVlTm9kZUV4cGFuZEJ5KG4uY2hpbGRyZW4sIGxldmVsKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOWQr+eUqOagkeW4ruWKqeWPs+mUruiPnOWNleWKn+iDvVxyXG4gICAgcHJpdmF0ZSB1c2VDb250ZXh0TWVudUZvclRyZWUoY21wUmVmOiBDb21wb25lbnRSZWY8YW55Pikge1xyXG4gICAgICAgIGNvbnN0IHsgbWF4TGV2ZWwsIGVuYWJsZUNvbnRleHRNZW51LCBsYW5ndWFnZSB9ID0gdGhpcy5pbnMudHJlZVRhYmxlT3B0aW9ucztcclxuICAgICAgICBpZiAoZW5hYmxlQ29udGV4dE1lbnUgJiYgbWF4TGV2ZWwpIHtcclxuICAgICAgICAgICAgY29uc3QgbGV2ZWxNZW51cyA9IFtdO1xyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8PSBtYXhMZXZlbDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB0aXRsZSA9IGxhbmd1YWdlWydleHBhbmQnICsgaV07XHJcbiAgICAgICAgICAgICAgICBsZXZlbE1lbnVzLnB1c2goeyBpZDogMzAgKyAxLCBjb2RlOiBpLCB0aXRsZSwgaGFuZGxlOiAodCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIOWPkemAgeivt+axguiOt+WPluaVsOaNrlxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGxldmVsID0gdC5tZW51LmNvZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTG9hZEFsbFRyZWVEYXRhKCkgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0VHJlZU5vZGVFeHBhbmRCeSh0aGlzLmlucy5pdGVtcywgbGV2ZWwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjbXBSZWYuaW5zdGFuY2UudXBkYXRlU2VyaWFsaXplZFZhbHVlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgeyBkYXRhRmllbGQsIGxheWVyRmllbGQgfSA9IHRoaXMuaW5zLnRyZWVJbmZvO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmaXJzdE5vZGVEYXRhID0gKHRoaXMuaW5zLml0ZW1zIHx8IFtdKVswXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpcnN0Tm9kZURhdGEgJiYgZmlyc3ROb2RlRGF0YS5kYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtaW5MYXllciA9IHRoaXMuaW5zLnV0aWxzLmdldFZhbHVlKGAke2RhdGFGaWVsZH0uJHtsYXllckZpZWxkfWAsIGZpcnN0Tm9kZURhdGEuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgX2xldmVsID0gbWluTGF5ZXIgKyBsZXZlbCAtIDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbG9hZFRyZWVEYXRhRm9yRXhwYW5kKF9sZXZlbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjb25zdCBpc0xvYWRBbGxUcmVlRGF0YSA9ICgpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlucy5sb2FkVHJlZURhdGFUeXBlID09PSAnZGVmYXVsdCcpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY21wUmVmLmluc3RhbmNlLmxvYWREYXRhVHlwZSA9PT0gJ2FsbCc7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmlucy5sb2FkVHJlZURhdGFUeXBlID09PSAnbG9hZGFsbCc7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBjb25zdCBjb250ZXh0TWVudXMgPSBbXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWQ6NiwgY29kZTogJ2NoZWNrY2hpbGRub2RlcycsIHRpdGxlOiAn5Yu+6YCJ5LiL57qn5pWw5o2uJyxcclxuICAgICAgICAgICAgICAgICAgICB2aXNpYmxlOiAoZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICFlLmRhdGEubm9kZS5zZWxlY3RhYmxlICYmICF0aGlzLmlucy5zaW5nbGVTZWxlY3QgJiYgZS5kYXRhLm5vZGUuY2hpbGRyZW4gJiYgZS5kYXRhLm5vZGUuY2hpbGRyZW4ubGVuZ3RoXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICBoYW5kbGU6ICh0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjbXBSZWYpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG5vZGVJZHMgPSBjbXBSZWYuaW5zdGFuY2UuZ2V0Q2hpbGROb2Rlcyh0LmRhdGEuaWQpLmZpbHRlcihuID0+IG4uc2VsZWN0YWJsZSkubWFwKG4gPT4gblt0aGlzLmlucy5pZEZpZWxkXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjb25zdCBub2RlSWRzID0gdC5kYXRhLm5vZGUuY2hpbGRyZW4ubWFwKG4gPT4gblt0aGlzLmlucy5pZEZpZWxkXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbXBSZWYuaW5zdGFuY2UuY2hlY2tlZE5vZGVzKG5vZGVJZHMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY21wUmVmLmluc3RhbmNlLnNlbGVjdE5vZGVzKG5vZGVJZHMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBpZDo1LCBjb2RlOiAndW5jaGVja2NoaWxkbm9kZXMnLCB0aXRsZTogJ+WPlua2iOWLvumAieS4i+e6p+aVsOaNricsXHJcbiAgICAgICAgICAgICAgICAgICAgdmlzaWJsZTogKGUpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAhZS5kYXRhLm5vZGUuc2VsZWN0YWJsZSAmJiAhdGhpcy5pbnMuc2luZ2xlU2VsZWN0ICYmIGUuZGF0YS5ub2RlLmNoaWxkcmVuICYmIGUuZGF0YS5ub2RlLmNoaWxkcmVuLmxlbmd0aFxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlOiAodCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY21wUmVmKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjb25zdCBub2RlSWRzID0gdC5kYXRhLm5vZGUuY2hpbGRyZW4ubWFwKG4gPT4gblt0aGlzLmlucy5pZEZpZWxkXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBub2RlSWRzID0gY21wUmVmLmluc3RhbmNlLmdldENoaWxkTm9kZXModC5kYXRhLmlkKS5maWx0ZXIobiA9PiBuLnNlbGVjdGFibGUpLm1hcChuID0+IG5bdGhpcy5pbnMuaWRGaWVsZF0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY21wUmVmLmluc3RhbmNlLnVuQ2hlY2tlZE5vZGVzKG5vZGVJZHMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY21wUmVmLmluc3RhbmNlLnVuU2VsZWN0Tm9kZXMobm9kZUlkcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgJy0nLFxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGlkOiAxLCBjb2RlOiAnZXhwYW5kYWxsJywgdGl0bGU6IGxhbmd1YWdlLmV4cGFuZGFsbCwgaGFuZGxlOiAodCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY21wUmVmICYmIGlzTG9hZEFsbFRyZWVEYXRhKCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNtcFJlZi5pbnN0YW5jZS5leHBhbmRBbGwoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIOWPkemAgeivt+axguiOt+WPluaVsOaNrlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWxvYWRUcmVlRGF0YUZvckV4cGFuZCgtMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgeyBpZDogMiwgY29kZTogJ2NvbGxhcHNlYWxsJywgdGl0bGU6IGxhbmd1YWdlLmNvbGxhcHNlYWxsLCBoYW5kbGU6ICh0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNtcFJlZikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjbXBSZWYuaW5zdGFuY2UuY29sbGFwc2VBbGwoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IH0sXHJcbiAgICAgICAgICAgICAgICAnLScsXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWQ6IDMsIHRpdGxlOiBsYW5ndWFnZS5leHBhbmRCeUxheWVyLFxyXG4gICAgICAgICAgICAgICAgICAgIGNoaWxkcmVuOiBsZXZlbE1lbnVzXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIF07XHJcbiAgICAgICAgICAgIHRoaXMuaW5zLnRyZWVUYWJsZU9wdGlvbnMuY29udGV4dE1lbnVJdGVtcyA9IGNvbnRleHRNZW51cztcclxuXHJcbiAgICAgICAgICAgIGNtcFJlZi5pbnN0YW5jZS5iZWZvcmVTaG93Q29udGV4dE1lbnUgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gb2Yoe3Nob3c6ICFjbXBSZWYuaW5zdGFuY2Uuc3RhdGUuc2VhcmNoZWR9KTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRTcGFjZVdpZHRoKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmlucy5sYXlvdXRGb3JtYXQgPT09ICdkZWZhdWx0JyA/IDIwIDogNDg7XHJcbiAgICB9XHJcblxyXG4gICAgY3JlYXRlQ29udGVudChvcHRzOiBhbnkpOiBDb21wb25lbnRSZWY8YW55PiB7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmlucy5jb21wb25lbnRSZWYpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgdHlwZSA9IHRoaXMuaW5zLmdldENvbXBvbmVudFR5cGUoKTtcclxuXHJcbiAgICAgICAgY29uc3QgY21wRmFjID0gdGhpcy5pbnMuY2ZyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KHR5cGUpO1xyXG4gICAgICAgIGxldCBjbXBSZWY6IENvbXBvbmVudFJlZjxhbnk+ID0gbnVsbDtcclxuICAgICAgICBpZiAodGhpcy5pbnMuaXNEb3VibGxlTGlzdCgpKSB7XHJcbiAgICAgICAgICAgIGNtcFJlZiA9IHRoaXMuaW5zLmNlbnRlckNvbnRhaW5lci5jcmVhdGVDb21wb25lbnQoY21wRmFjKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjbXBSZWYgPSB0aGlzLmlucy5jb250ZW50Q29udGFpbmVyLmNyZWF0ZUNvbXBvbmVudChjbXBGYWMpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuaW5zLmlzVHJlZSgpKSB7XHJcbiAgICAgICAgICAgIG9wdHMuZml0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgb3B0cy5wYWdpbmF0aW9uID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICBvcHRzLmZhc3QgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuaW5zLnVzZUZhdm9yaXRlKSB7XHJcbiAgICAgICAgICAgICAgICBvcHRzLmZpdENvbHVtbnMgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIG9wdHMuYXV0b0ZpdENvbHVtbnMgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLnVzZUNvbnRleHRNZW51Rm9yVHJlZShjbXBSZWYpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIG9wdHMuZmlsbCA9IHRydWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCB0dE9wdHMgPSB0aGlzLmlucy50cmVlVGFibGVPcHRpb25zIHx8IHt9O1xyXG4gICAgICAgIE9iamVjdC5hc3NpZ24oY21wUmVmLmluc3RhbmNlLCBvcHRzLCB7IGFsbENvbHVtbnNUaXRsZTogdGhpcy5pbnMuYWxsQ29sdW1uc1RpdGxlLCAuLi50dE9wdHMgfSk7XHJcblxyXG4gICAgICAgIHRoaXMuaW5zLmNvbXBvbmVudFJlZiA9IGNtcFJlZjtcclxuICAgICAgICB0aGlzLnJlc2l6ZUNvbXBvbmVudCgpO1xyXG4gICAgICAgIHJldHVybiBjbXBSZWY7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5Yib5bu65pS26JePQ01QXHJcbiAgICBjcmVhdGVGYXZvcml0ZXNDb250ZW50KG9wdHM6IGFueSk6IENvbXBvbmVudFJlZjxhbnk+IHtcclxuXHJcbiAgICAgICAgY29uc3QgdHlwZSA9IHRoaXMuaW5zLmdldENvbXBvbmVudFR5cGUoKTtcclxuXHJcbiAgICAgICAgY29uc3QgY21wRmFjID0gdGhpcy5pbnMuY2ZyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KHR5cGUpO1xyXG4gICAgICAgIGxldCBjbXBSZWYgPSBudWxsO1xyXG4gICAgICAgIGNtcFJlZiA9IHRoaXMuaW5zLmZhdm9yaXRlc0NvbnRhaW5lci5jcmVhdGVDb21wb25lbnQoY21wRmFjKTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuaW5zLmlzVHJlZSgpKSB7XHJcbiAgICAgICAgICAgIG9wdHMuZml0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgb3B0cy5wYWdpbmF0aW9uID0gZmFsc2U7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgb3B0cy5maWxsID0gdHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIE9iamVjdC5hc3NpZ24oY21wUmVmLmluc3RhbmNlLCBvcHRzLCB7XHJcbiAgICAgICAgICAgIHdpZHRoOiB0aGlzLmlucy5kaWFsb2cuc2l6ZS53aWR0aCAtIHRoaXMuZ2V0U3BhY2VXaWR0aCgpLFxyXG4gICAgICAgICAgICBoZWlnaHQ6IHRoaXMuaW5zLmRpYWxvZ01nci5nZXRIZWlnaHQoKVxyXG4gICAgICAgIH0pO1xyXG5cclxuXHJcbiAgICAgICAgLy8g6K6i6ZiF5pS26JeP5aS55YiX6KGo5Lit57uE5Lu255qE55u45YWz5LqL5Lu2XHJcbiAgICAgICAgdGhpcy5pbnMuZmF2SGVscGVyLmluaXRGYXZvcml0ZUNvbXBvbmVudEV2ZW50KGNtcFJlZik7XHJcblxyXG4gICAgICAgIHJldHVybiBjbXBSZWY7XHJcbiAgICB9XHJcblxyXG4gICAgcmVzaXplQ29tcG9uZW50KHR5cGU6IENvbXBvbmVudEluc3RhbmNlVHlwZSA9ICdkYXRhdGFibGUnKSB7XHJcbiAgICAgICAgY29uc3Qgc2l6ZSA9IHtcclxuICAgICAgICAgICAgd2lkdGg6IHRoaXMuaW5zLmRpYWxvZy5zaXplLndpZHRoIC0gdGhpcy5nZXRTcGFjZVdpZHRoKCksXHJcbiAgICAgICAgICAgIGhlaWdodDogdGhpcy5pbnMuZGlhbG9nTWdyLmdldEhlaWdodCgpXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuaW5zLmlzRG91YmxsZUxpc3QoKSAmJiAodHlwZSA9PT0gJ2RhdGF0YWJsZScgfHwgdHlwZSA9PT0gJ3RyZWV0YWJsZScpKSB7XHJcbiAgICAgICAgICAgIHNpemUud2lkdGggPSB0aGlzLmlucy5kaWFsb2cuc2l6ZS53aWR0aCAtIHRoaXMuaW5zLmxlZnRQYW5lbFdpZHRoIC0gKHRoaXMuaW5zLmxheW91dEZvcm1hdCA9PT0gJ2RlZmF1bHQnID8gMjAgOiA0OCkgLSA3O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5nZXRDb21wb25lbnRJbnN0YW5jZSh0eXBlKS5yZXNpemUoc2l6ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRDaGlsZE5vZGVzKG5vZGU6IFRyZWVOb2RlKSB7XHJcbiAgICAgICAgY29uc3Qgbm9kZXM6IGFueSA9IFtdO1xyXG4gICAgICAgIGlmIChub2RlLnNlbGVjdGFibGUgfHwgbm9kZS5zZWxlY3RhYmxlID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgbm9kZXMucHVzaChub2RlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG5vZGUuY2hpbGRyZW4gJiYgbm9kZS5jaGlsZHJlbi5sZW5ndGgpIHtcclxuICAgICAgICAgICAgbm9kZS5jaGlsZHJlbi5mb3JFYWNoKG4gPT4ge1xyXG4gICAgICAgICAgICAgICAgbm9kZXMucHVzaCguLi50aGlzLmdldENoaWxkTm9kZXMobikpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIG5vZGVzO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKiDliJvlu7rlt6bkvqfnu4Tku7YgKi9cclxuICAgIGNyZWF0ZUxlZnRDb21wb25lbnQob3BzOiBhbnkpIHtcclxuICAgICAgICBsZXQgZHRGYWMgPSBudWxsO1xyXG4gICAgICAgIGlmICh0aGlzLmlucy5pc0RvdWJsbGVMaXN0KCkpIHtcclxuICAgICAgICAgICAgZHRGYWMgPSB0aGlzLmlucy5jZnIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoTG9va3VwTGVmdENvbXBvbmVudCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaW5zLmxlZnRDb21wb25lbnRSZWYgPSB0aGlzLmlucy5sZWZ0Q29udGFpbmVyLmNyZWF0ZUNvbXBvbmVudChkdEZhYyk7XHJcbiAgICAgICAgb3BzLmhlaWdodCA9IHRoaXMuaW5zLmRpYWxvZ01nci5nZXRIZWlnaHQoKTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuaW5zLmRpYWxvZ1dpZHRoIDwgdGhpcy5pbnMubmF2TG9va3VwRGlhbG9nTWluV2lkdGgpIHtcclxuICAgICAgICAgICAgdGhpcy5pbnMuZGlhbG9nV2lkdGggPSB0aGlzLmlucy5uYXZMb29rdXBEaWFsb2dNaW5XaWR0aDtcclxuICAgICAgICAgICAgdGhpcy5pbnMuZGlhbG9nLnJlU2l6ZSh7IHdpZHRoOiB0aGlzLmlucy5kaWFsb2dXaWR0aCB9KTtcclxuICAgICAgICAgICAgdGhpcy5pbnMucmVzaXplQ21wKHsgd2lkdGg6IHRoaXMuaW5zLmRpYWxvZy5zaXplLndpZHRoIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKG9wcy53aWR0aCAhPT0gdGhpcy5pbnMubGVmdFBhbmVsLndpZHRoKSB7XHJcbiAgICAgICAgICAgIC8vIOm7mOiupCAxIDogMlxyXG4gICAgICAgICAgICB0aGlzLmlucy5sZWZ0UGFuZWwucmVzaXplKHtcclxuICAgICAgICAgICAgICAgIHdpZHRoOiB0aGlzLmlucy5sZWZ0UGFuZWwud2lkdGgsXHJcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IG9wcy5oZWlnaHRcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zLnJlc2l6ZUNtcCh7IHdpZHRoOiB0aGlzLmlucy5kaWFsb2cuc2l6ZS53aWR0aCB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIHRoaXMucmVzaXplQ29tcG9uZW50KCk7XHJcblxyXG4gICAgICAgIHRoaXMuaW5zLmxlZnRDb21wb25lbnRSZWYuaW5zdGFuY2UubG9va3VwQ21wID0gdGhpcy5pbnM7XHJcbiAgICAgICAgdGhpcy5pbnMubGVmdENvbXBvbmVudFJlZi5pbnN0YW5jZS5uYXZPcHRpb25zID0gb3BzO1xyXG5cclxuXHJcbiAgICAgICAgdGhpcy5pbnMubGVmdENvbXBvbmVudFJlZi5pbnN0YW5jZS5zZWxlY3RlZFxyXG4gICAgICAgICAgICAucGlwZShcclxuICAgICAgICAgICAgICAgIGRlYm91bmNlVGltZSgxMDApLFxyXG4gICAgICAgICAgICAgICAgc3dpdGNoTWFwKChkOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZCAmJiBkLmRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMubmF2aWdhdGlvbkZpbHRlciA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkOiBkLmRhdGEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZFZhbHVlOiB0aGlzLmdldE5hdmlnYXRpb25GaWx0ZXIoZC5kYXRhKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlYXJjaEZpZWxkOiAnJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlYXJjaFZhbHVlOiAnJ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zLm5hdmlnYXRpb25GaWx0ZXIgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIC8vIOWKoOi9veWPs+S+p+aVsOaNrlxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2VJbmZvOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWdlSW5kZXg6IHRoaXMuaW5zLmdyaWRPcHRpb25zLnBhZ2VJbmRleCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2VTaXplOiB0aGlzLmlucy5ncmlkT3B0aW9ucy5wYWdlU2l6ZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaW5zLmluY2x1ZGVTdWJvcmRpbmF0ZXMgJiYgZCAmJiBkLm5vZGUgJiYgb3BzLnRyZWVJbmZvKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHtsYXllclR5cGUsIHBhdGhGaWVsZCwgbG9hZERhdGFUeXBlLCBkYXRhRmllbGR9ID0gb3BzLnRyZWVJbmZvXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsb2FkRGF0YVR5cGUgPT09ICdhbGwnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByb3dEYXRhcyA9IHRoaXMuZ2V0Q2hpbGROb2RlcyhkLm5vZGUpLm1hcChuID0+IG4uZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5uYXZpZ2F0aW9uRmlsdGVyLmlkVmFsdWUgPSB0aGlzLmdldE5hdmlnYXRpb25GaWx0ZXIocm93RGF0YXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxheWVyVHlwZSA9PSAncGF0aGNvZGUnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gcFsnbmF2Tm9kZVBhdGhDb2RlJ10gPSBkLmRhdGFbZGF0YUZpZWxkXVtwYXRoRmllbGRdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBbJ25hdk5vZGVQYXRoQ29kZSddID0gdGhpcy5pbnMuZ2V0UGF0aENvZGUoZC5kYXRhLCBvcHMudHJlZUluZm8pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zWyduYXZOb2RlUGF0aENvZGUnXSA9IHBbJ25hdk5vZGVQYXRoQ29kZSddO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zWyduYXZOb2RlUGF0aENvZGUnXSA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0YUNtcFJlZiA9IHRoaXMuZ2V0Q29tcG9uZW50SW5zdGFuY2UoKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCB7IHNvcnROYW1lLCBzb3J0T3JkZXIgfSA9IGRhdGFDbXBSZWY7XHJcbiAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihwLCB7IHNlYXJjaDogdGhpcy5pbnMuX3NlYXJjaFN0YXRlLCBzb3J0TmFtZSwgc29ydE9yZGVyIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmlucy5odHRwTWdyLmdldERhdGEocCwgJ2xpc3QnKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIClcclxuICAgICAgICAgICAgLnN1YnNjcmliZShyZXMgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnMuY2xvc2VMb2FkaW5nKCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlucy5sb2FkRGF0YVdoZW5PcGVuID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBpZiAodGhpcy5pbnMudXNlRmF2b3JpdGUgJiYgIXRoaXMuaW5zLmlzVHJlZSgpKSB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgdGhpcy5pbnMuZmF2SGVscGVyLnVwZGF0ZUZhdm9yaXRlc1N0YXR1cyhyZXMuaXRlbXMpO1xyXG4gICAgICAgICAgICAgICAgLy8gfVxyXG4gICAgICAgICAgICAgICAgLy8gdGhpcy5pbnMubG9hZERhdGFUYWJsZURhdGEocmVzKTtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnMubG9hZERhdGEocmVzLCBmYWxzZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8g6YCJ5Lit5pWw5o2uXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMuc2VsZWN0aW9uTWdyLnNlbGVjdEN1cnJlbnRWYWx1ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zLmNoYW5nZURldGVjdG9yLmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5zLmxlZnRDb21wb25lbnRSZWYuaW5zdGFuY2UuY3JlYXRlQ29tcG9uZW50KCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g6I635Y+W5YWz6IGU5pWw5o2uLCDlj7PkvqfmlbDmja7kuK0g5YWz6IGU5ZCE5a2X5q6155qE5YC8XHJcbiAgICBwcml2YXRlIGdldE5hdmlnYXRpb25GaWx0ZXIobmF2Um93OiBhbnkpIHtcclxuICAgICAgICBpZiAodGhpcy5pbnMubmF2aWdhdGlvbk9wdGlvbnMucmVsYXRpb25zICYmIHRoaXMuaW5zLm5hdmlnYXRpb25PcHRpb25zLnJlbGF0aW9ucy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gW107XHJcbiAgICAgICAgICAgIHRoaXMuaW5zLm5hdmlnYXRpb25PcHRpb25zLnJlbGF0aW9ucy5mb3JFYWNoKHIgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgayA9IHIuZ3JvdXBGaWVsZDtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGRGaWVsZCA9IHIuaGVscEZpZWxkO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcmY6IGFueSA9IHsgZmllbGROYW1lOiBkRmllbGQsIGZpZWxkVmFsdWU6ICcnIH07XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkobmF2Um93KSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbHMgPSBuYXZSb3cubWFwKG4gPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gay5zcGxpdCgnLicpLnJlZHVjZSgobywgYykgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9bY107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIG4pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHJmLmZpZWxkVmFsdWUgPSB2YWxzLmpvaW4oJywnKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmYuZmllbGRWYWx1ZSA9IGsuc3BsaXQoJy4nKS5yZWR1Y2UoKG8sIGMpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9bY107XHJcbiAgICAgICAgICAgICAgICAgICAgfSwgbmF2Um93KTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICByZXN1bHQucHVzaChyZik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==