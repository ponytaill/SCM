/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { LocaleService } from '@farris/ui-locale';
import { Injectable, Injector, EventEmitter } from '@angular/core';
import { Compare } from '@farris/ui-common/types';
import { DatagridFacadeService } from './datagrid-facade.service';
import { Utils } from './../utils/utils';
import { ColumnFilterType } from '../types/data-column';
import { DatagridColumnsHelper } from './datagrid-columns.helper';
export class DatagridFilterService {
    /**
     * @param {?} dfs
     * @param {?} localeSer
     * @param {?} inject
     */
    constructor(dfs, localeSer, inject) {
        this.dfs = dfs;
        this.localeSer = localeSer;
        this.inject = inject;
        this.removeField = new EventEmitter();
    }
    /**
     * @param {?} rowData
     * @param {?} conditions
     * @return {?}
     */
    validateRowData(rowData, conditions) {
        if (!conditions || Object.keys(conditions).length === 0) {
            return true;
        }
        return this.checkAllFieldInRowData(rowData, conditions);
    }
    /**
     * @param {?} data
     * @param {?} conditions
     * @return {?}
     */
    executeFilter(data, conditions) {
        if (this.dfs.getState().enableSmartFilter) {
            return this.executeSmartFilter(data, conditions);
        }
        if (data && data.length) {
            return data.filter((/**
             * @param {?} n
             * @return {?}
             */
            n => this.validateRowData(n, conditions)));
        }
        return data;
    }
    /**
     * @private
     * @param {?} fieldDataValue
     * @param {?} operator
     * @param {?} targetValue
     * @return {?}
     */
    getCompareResult(fieldDataValue, operator, targetValue) {
        /** @type {?} */
        const op = parseInt('' + operator, 10);
        switch (op) {
            case Compare.Equal:
                return fieldDataValue == targetValue;
            case Compare.NotEqual:
                return ('' + fieldDataValue).toLowerCase() !== ('' + targetValue).toLowerCase();
            case Compare.Greater:
                return fieldDataValue > targetValue;
            case Compare.GreaterOrEqual:
                return fieldDataValue >= targetValue;
            case Compare.Less:
                return fieldDataValue < targetValue;
            case Compare.LessOrEqual:
                return fieldDataValue <= targetValue;
            case Compare.Like:
                return ('' + fieldDataValue).toLowerCase().indexOf(targetValue.toLowerCase()) > -1;
            case Compare.NotLike:
                return ('' + fieldDataValue).toLowerCase().indexOf(targetValue.toLowerCase()) === -1;
            case Compare.In:
                targetValue = targetValue || [];
                return targetValue.findIndex((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => n == fieldDataValue)) > -1;
            case 1001: // Empty
                return fieldDataValue === '' || fieldDataValue === null;
            case 1002: // NotEmpty
                return fieldDataValue !== '' && fieldDataValue !== null;
            case 1003: // Null
                return fieldDataValue === null;
            case 1004: // NotNull
                return fieldDataValue !== null;
        }
    }
    /**
     * @private
     * @param {?} result1
     * @param {?} relation
     * @param {?} result2
     * @return {?}
     */
    getRelationResult(result1, relation, result2) {
        /** @type {?} */
        const _relation = relation.toLowerCase();
        if (_relation === 'and') {
            return result1 && result2;
        }
        else {
            return result1 || result2;
        }
    }
    /**
     * @private
     * @param {?} resultObj
     * @return {?}
     */
    checkAllFieldResult(resultObj) {
        if (!resultObj) {
            return true;
        }
        return Object.values(resultObj).reduce((/**
         * @param {?} c
         * @param {?} n
         * @return {?}
         */
        (c, n) => {
            return c && n;
        }), true);
    }
    /**
     * @private
     * @param {?} rowData
     * @param {?} conditions
     * @return {?}
     */
    checkAllFieldInRowData(rowData, conditions) {
        // this.state = conditions;
        /** @type {?} */
        let resultObj = null;
        if (conditions) {
            /** @type {?} */
            const fields = Object.keys(conditions);
            resultObj = {};
            fields.forEach((/**
             * @param {?} field
             * @return {?}
             */
            field => {
                /** @type {?} */
                let fieldValue = Utils.getValue(field, rowData);
                /** @type {?} */
                const columnObj = this.dfs.getColumn(field);
                if (columnObj && columnObj.isMultilingualField) {
                    fieldValue = Utils.getMultilingualValue(fieldValue, this.localeSer.localeId);
                }
                /** @type {?} */
                const where = conditions[field];
                const { value1, operator1, relation, operator2, value2 } = where;
                if (where) {
                    /** @type {?} */
                    const result = this.getCompareResult(fieldValue, operator1, value1);
                    resultObj[field] = result;
                    if (relation) {
                        /** @type {?} */
                        const result2 = this.getCompareResult(fieldValue, operator2, value2);
                        resultObj[field] = this.getRelationResult(result, relation, result2);
                    }
                }
            }));
        }
        return this.checkAllFieldResult(resultObj);
    }
    /**
     * @param {?} field
     * @return {?}
     */
    removeFilterField(field) {
        this.removeField.emit(field);
    }
    /**
     * @param {?} conditions
     * @return {?}
     */
    convertFilterCondition2String(conditions) {
        if (!conditions) {
            return '';
        }
        /** @type {?} */
        let str = '';
        /** @type {?} */
        const andText = this.localeSer.getValue('datagrid.filter.and');
        /** @type {?} */
        const orText = this.localeSer.getValue('datagrid.filter.or');
        /** @type {?} */
        const and = `<span class='badge badge-success'>${andText}</span>`;
        /** @type {?} */
        const and2 = `<span class='badge badge-info'>${andText}</span>`;
        /** @type {?} */
        const or = `<span class='badge badge-warning'>${orText}</span>`;
        /** @type {?} */
        const lbracket = `<b>〔</b>`;
        /** @type {?} */
        const rbracket = `<b>〕</b>`;
        /** @type {?} */
        const ellipsis = `[ <span class="ellipsis" title="$title$">  $value$<i class="f-icon f-icon-lookup"></i></span> ]`;
        str = Object.keys(conditions).reduce((/**
         * @param {?} c
         * @param {?} r
         * @return {?}
         */
        (c, r) => {
            /** @type {?} */
            const filter = conditions[r];
            /** @type {?} */
            const col = this.dfs.getColumn(r);
            /** @type {?} */
            const t = `<b>${col.title}</b>`;
            /** @type {?} */
            let s = ` ${t} ${this.getCompareString(filter.operator1)} ${Utils.escapeValue(filter.value1)}  `;
            if (filter.operator1 == Compare.In) {
                /** @type {?} */
                let txt = filter.value1;
                /** @type {?} */
                let txt2 = txt;
                if (col.filter.type === ColumnFilterType.enum) {
                    /** @type {?} */
                    const enumOpts = DatagridColumnsHelper.getFilterEnumOptions(col);
                    txt = DatagridColumnsHelper.getEnumText(enumOpts, filter.value1);
                    txt2 = txt.split(',').slice(0, 2).join(',');
                }
                else {
                    txt2 = txt.slice(0, 2).join(',');
                }
                s = ` ${t} ${this.getCompareString(filter.operator1)} [ ${txt} ]  `;
                if (filter.value1.length > 2) {
                    s = ` ${t} ${this.getCompareString(filter.operator1)} ${ellipsis.replace('$title$', txt).replace('$value$', txt2)}  `;
                }
            }
            else {
                if (filter.operator1 == Compare.Equal && Array.isArray(filter.value1)) {
                    if (!filter.value1.length) {
                        s = ` ${t} ${this.getCompareString(filter.operator1)} ''  `;
                    }
                }
            }
            if (filter.relation) {
                /** @type {?} */
                const s2 = `${t} ${this.getCompareString(filter.operator2)} ${filter.value2}`;
                s = `${lbracket} ${s} ${filter.relation === 'and' ? and2 : or} ${s2} ${rbracket}`;
            }
            return `${c} <span class="filter-field filter-column-${r}"> ${s} AND </span>`;
        }), '');
        /** @type {?} */
        const lastANDidx = str.lastIndexOf('AND');
        /** @type {?} */
        let resultStr = str.substr(0, lastANDidx);
        resultStr += str.substr(lastANDidx + 3);
        return resultStr.replace(/AND/g, and).replace(/OR/g, or);
    }
    /**
     * @private
     * @param {?} operator
     * @return {?}
     */
    getCompareString(operator) {
        /** @type {?} */
        const op = parseInt('' + operator, 10);
        /** @type {?} */
        let code = '';
        switch (op) {
            case Compare.Equal:
            case Compare.NotEqual:
            case Compare.Greater:
            case Compare.GreaterOrEqual:
            case Compare.Less:
            case Compare.LessOrEqual:
            case Compare.Like:
            case Compare.NotLike:
            case Compare.In:
                code = Compare[op];
                code = code[0].toLowerCase() + code.substr(1);
                return this.localeSer.getValue('datagrid.filter.operators.' + code);
            case 1001: // Empty
                return ' ' + this.localeSer.getValue('datagrid.filter.operators.empty');
            case 1002: // NotEmpty
                return ' ' + this.localeSer.getValue('datagrid.filter.operators.notEmpty');
            case 1003: // Null
                return ' ' + this.localeSer.getValue('datagrid.filter.operators.null');
            case 1004: // NotNull
                return ' ' + this.localeSer.getValue('datagrid.filter.operators.notNull');
        }
    }
    /**
     * @param {?} condition
     * @return {?}
     */
    convert2FilterArray(condition) {
        /** @type {?} */
        const filterArr = [];
        if (condition) {
            /** @type {?} */
            const fields = Object.keys(condition);
            if (fields && fields.length) {
                fields.forEach((/**
                 * @param {?} field
                 * @return {?}
                 */
                field => {
                    /** @type {?} */
                    const obj = { filterField: field, value: '', lbracket: '', rbracket: '', relation: 1, compare: 0 };
                    /** @type {?} */
                    const conditionVal = condition[field];
                    if (typeof conditionVal === 'object') {
                        obj.compare = conditionVal.operator1;
                        obj.value = conditionVal.value1;
                        filterArr.push(obj);
                        if (conditionVal.value2) {
                            obj.lbracket = '(';
                            obj.relation = conditionVal.relation === 'and' ? 1 : 2;
                            /** @type {?} */
                            const obj2 = { filterField: field, value: '', lbracket: '', rbracket: ')', relation: 1, compare: 0 };
                            obj2.compare = conditionVal.operator2;
                            obj2.value = conditionVal.value2;
                            filterArr.push(obj2);
                        }
                        else {
                            if (conditionVal.operator2) {
                                /** @type {?} */
                                const op2 = parseInt('' + conditionVal.operator2, 10);
                                if (op2 === 1001 || op2 === 1002) {
                                    obj.lbracket = '(';
                                    obj.relation = conditionVal.relation === 'and' ? 1 : 2;
                                    /** @type {?} */
                                    const obj2 = { filterField: field, value: '', lbracket: '', rbracket: ')', relation: 1, compare: 0 };
                                    obj2.compare = op2 === 1001 ? Compare.Equal : Compare.NotEqual;
                                    obj2.value = '';
                                    filterArr.push(obj2);
                                }
                            }
                        }
                    }
                    return obj;
                }));
            }
        }
        if (filterArr.length) {
            this.checkEnumTypeFilters(filterArr);
            filterArr[filterArr.length - 1].relation = 0;
        }
        return filterArr;
    }
    /**
     * @private
     * @param {?} filterArr
     * @return {?}
     */
    checkEnumTypeFilters(filterArr) {
        /** @type {?} */
        const enumFilters = {};
        filterArr.forEach((/**
         * @param {?} f
         * @param {?} i
         * @return {?}
         */
        (f, i) => {
            /** @type {?} */
            const enumFilterArr = this.convertEnumTypeFilter(f);
            if (enumFilterArr && enumFilterArr.length) {
                enumFilters[f.filterField] = enumFilterArr;
            }
        }));
        /** @type {?} */
        const keys = Object.keys(enumFilters);
        if (keys.length) {
            keys.forEach((/**
             * @param {?} k
             * @return {?}
             */
            (k) => {
                /** @type {?} */
                const i = filterArr.findIndex((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => n.filterField === k));
                filterArr.splice(i, 1, ...enumFilters[k]);
            }));
        }
        return filterArr;
    }
    // 将enum 类型的条件转换多个条件
    /**
     * @private
     * @param {?} filter
     * @return {?}
     */
    convertEnumTypeFilter(filter) {
        if (filter) {
            /** @type {?} */
            const col = (/** @type {?} */ (this.dfs.getColumn(filter.filterField)));
            if (col && col.filter && col.filter.type === ColumnFilterType.enum) {
                if (Array.isArray(filter.value) && filter.value.length) {
                    if (filter.value.length === 1) {
                        filter.compare = Compare.Equal;
                        filter.value = filter.value[0];
                        return [];
                    }
                    else {
                        // > 1
                        /** @type {?} */
                        let filterArr = filter.value.map((/**
                         * @param {?} val
                         * @return {?}
                         */
                        (val) => {
                            return {
                                filterField: filter.filterField,
                                value: val,
                                lbracket: '',
                                rbracket: '',
                                relation: 2,
                                // or
                                compare: 0
                            };
                        }));
                        filterArr[0].lbracket = '(';
                        filterArr[filter.value.length - 1].rbracket = ')';
                        filterArr[filter.value.length - 1].relation = 1;
                        return filterArr;
                    }
                }
            }
        }
        return [];
    }
    /**
     * @param {?} col
     * @return {?}
     */
    createColumnFilterOptions(col) {
        /** @type {?} */
        let filterTypeOptions = {
            type: ColumnFilterType.string,
            enableOperator: true
        };
        if (col.editor) {
            switch (col.editor.type) {
                case 'textarea':
                case 'textbox':
                case 'language-textbox':
                    filterTypeOptions = {
                        type: ColumnFilterType.string,
                        enableOperator: true
                    };
                    break;
                case 'checkbox':
                case 'switch':
                    filterTypeOptions = {
                        type: ColumnFilterType.boolean,
                        enableOperator: false
                    };
                    break;
                case 'numberbox':
                    filterTypeOptions = {
                        type: ColumnFilterType.number,
                        enableOperator: true
                    };
                    break;
                case 'combolist':
                case 'select':
                    filterTypeOptions = {
                        type: ColumnFilterType.enum,
                        enableOperator: true,
                        options: col.editor.options
                    };
                    break;
                case 'datepicker':
                    filterTypeOptions = {
                        type: col['dataType'] === 'datetime' ? ColumnFilterType.datetime : ColumnFilterType.date,
                        enableOperator: true,
                        options: {
                            dateFormat: col.editor.options.dateFormat,
                            returnFormat: col.editor.options.returnFormat
                        }
                    };
                    break;
                case 'timepicker':
                    filterTypeOptions = {
                        type: ColumnFilterType.time,
                        enableOperator: true
                    };
                    break;
            }
        }
        else if (col.formatter) {
            if (typeof col.formatter === 'object' && Object.keys(col.formatter).length) {
                /** @type {?} */
                const options = col.formatter['options'];
                switch (col.formatter['type']) {
                    case 'number':
                        filterTypeOptions = {
                            type: ColumnFilterType.number,
                            enableOperator: true
                        };
                        break;
                    case 'enum':
                        filterTypeOptions = {
                            type: ColumnFilterType.enum,
                            enableOperator: true,
                            options
                        };
                        break;
                    case 'boolean':
                        filterTypeOptions = {
                            type: ColumnFilterType.boolean,
                            enableOperator: false
                        };
                        break;
                    case 'datetime':
                        /** @type {?} */
                        let tye = ColumnFilterType.datetime;
                        /** @type {?} */
                        let fmt = 'yyyy-MM-dd';
                        /** @type {?} */
                        let returnFmt = 'yyyy-MM-dd';
                        if (options && options.format) {
                            fmt = options.format;
                            if (fmt.indexOf('HH:') == -1) {
                                tye = ColumnFilterType.date;
                            }
                            else {
                                returnFmt += ' HH:mm';
                                if (fmt.indexOf('ss') > -1) {
                                    returnFmt += ':ss';
                                }
                            }
                        }
                        else {
                            tye = ColumnFilterType.date;
                        }
                        filterTypeOptions = {
                            type: tye,
                            enableOperator: true
                        };
                        filterTypeOptions.options = { dateFormat: fmt, returnFormat: returnFmt };
                        break;
                    default:
                        filterTypeOptions = {
                            type: ColumnFilterType.string,
                            enableOperator: true
                        };
                }
            }
        }
        else {
            filterTypeOptions = {
                type: ColumnFilterType.string,
                enableOperator: true
            };
        }
        return filterTypeOptions;
    }
    //#region  Smart Filter
    /**
     * @param {?} conditions
     * @return {?}
     */
    convertSmartFilter2EntityFilter(conditions) {
        if (conditions && conditions.length) {
            return conditions.map((/**
             * @param {?} n
             * @return {?}
             */
            n => {
                return n;
            }));
        }
        return [];
    }
    /**
     * @private
     * @param {?} rowData
     * @param {?} conditions
     * @return {?}
     */
    validateRowData2(rowData, conditions) {
        if (!conditions || conditions.length === 0) {
            return true;
        }
        return this.checkRowDataWithCondition(rowData, conditions);
    }
    /**
     * @private
     * @param {?} rowData
     * @param {?} conditions
     * @return {?}
     */
    checkRowDataWithCondition(rowData, conditions) {
        /** @type {?} */
        let resultObj = null;
        if (conditions) {
            resultObj = {};
            conditions.forEach((/**
             * @param {?} condition
             * @return {?}
             */
            condition => {
                /** @type {?} */
                const field = condition.FilterField;
                /** @type {?} */
                let fieldValue = Utils.getValue(field, rowData);
                /** @type {?} */
                const columnObj = this.dfs.getColumn(field);
                if (columnObj && columnObj.isMultilingualField) {
                    fieldValue = Utils.getMultilingualValue(fieldValue, this.localeSer.localeId);
                }
                /** @type {?} */
                const where = condition;
                const { Value, Relation, Compare: operator1 } = where;
                if (where) {
                    /** @type {?} */
                    const r = this.getCompareResult(fieldValue, operator1, Value);
                    if (resultObj[field] === undefined) {
                        resultObj[field] = [r];
                    }
                    else {
                        resultObj[field].push(r);
                    }
                }
            }));
        }
        // return this.checkAllFieldResult(resultObj);
        /** @type {?} */
        const fields = Object.keys(resultObj);
        /** @type {?} */
        const result = [];
        fields.forEach((/**
         * @param {?} f
         * @return {?}
         */
        (f) => {
            /** @type {?} */
            const _filters = conditions.filter((/**
             * @param {?} n
             * @return {?}
             */
            n => n.FilterField === f));
            if (resultObj[f].length === 1) {
                result.push(resultObj[f][0]);
            }
            else {
                if (_filters[0].Relation === 1 && resultObj[f].length === 2) { // and
                    result.push(resultObj[f][0] && resultObj[f][1]);
                }
                else { // or
                    result.push(resultObj[f].indexOf(true) > -1);
                }
            }
        }));
        return result.indexOf(false) === -1;
    }
    /**
     * @param {?} data
     * @param {?} conditions
     * @return {?}
     */
    executeSmartFilter(data, conditions) {
        if (data && data.length) {
            return data.filter((/**
             * @param {?} n
             * @return {?}
             */
            n => this.validateRowData2(n, conditions)));
        }
        return data;
    }
}
DatagridFilterService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
DatagridFilterService.ctorParameters = () => [
    { type: DatagridFacadeService },
    { type: LocaleService },
    { type: Injector }
];
if (false) {
    /** @type {?} */
    DatagridFilterService.prototype.removeField;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterService.prototype.dfs;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterService.prototype.localeSer;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterService.prototype.inject;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YWdyaWQtZmlsdGVyLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWRhdGFncmlkLyIsInNvdXJjZXMiOlsibGliL3NlcnZpY2VzL2RhdGFncmlkLWZpbHRlci5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDbEQsT0FBTyxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsWUFBWSxFQUFZLE1BQU0sZUFBZSxDQUFDO0FBQzdFLE9BQU8sRUFBRSxPQUFPLEVBQW1CLE1BQU0seUJBQXlCLENBQUM7QUFDbkUsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDbEUsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQ3pDLE9BQU8sRUFBYyxnQkFBZ0IsRUFBMEQsTUFBTSxzQkFBc0IsQ0FBQztBQUM1SCxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUdsRSxNQUFNLE9BQU8scUJBQXFCOzs7Ozs7SUFHOUIsWUFBb0IsR0FBMEIsRUFBVSxTQUF3QixFQUFVLE1BQWdCO1FBQXRGLFFBQUcsR0FBSCxHQUFHLENBQXVCO1FBQVUsY0FBUyxHQUFULFNBQVMsQ0FBZTtRQUFVLFdBQU0sR0FBTixNQUFNLENBQVU7UUFGMUcsZ0JBQVcsR0FBRyxJQUFJLFlBQVksRUFBVSxDQUFDO0lBR3pDLENBQUM7Ozs7OztJQUVELGVBQWUsQ0FBQyxPQUFZLEVBQUUsVUFBc0Q7UUFDaEYsSUFBSSxDQUFDLFVBQVUsSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7WUFDckQsT0FBTyxJQUFJLENBQUM7U0FDZjtRQUNELE9BQU8sSUFBSSxDQUFDLHNCQUFzQixDQUFDLE9BQU8sRUFBRSxVQUFVLENBQUMsQ0FBQztJQUM1RCxDQUFDOzs7Ozs7SUFFRCxhQUFhLENBQUMsSUFBUSxFQUFFLFVBQWU7UUFDbkMsSUFBSyxJQUFJLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxDQUFDLGlCQUFpQixFQUFFO1lBQ3hDLE9BQU8sSUFBSSxDQUFDLGtCQUFrQixDQUFDLElBQUksRUFBRSxVQUFVLENBQUMsQ0FBQztTQUNwRDtRQUVELElBQUksSUFBSSxJQUFJLElBQUksQ0FBQyxNQUFNLEVBQUU7WUFDckIsT0FBTyxJQUFJLENBQUMsTUFBTTs7OztZQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDLEVBQUUsVUFBVSxDQUFDLEVBQUMsQ0FBQztTQUNoRTtRQUNELE9BQU8sSUFBSSxDQUFDO0lBQ2hCLENBQUM7Ozs7Ozs7O0lBRU8sZ0JBQWdCLENBQUMsY0FBbUIsRUFBRSxRQUFpQixFQUFFLFdBQWdCOztjQUN2RSxFQUFFLEdBQUcsUUFBUSxDQUFDLEVBQUUsR0FBRyxRQUFRLEVBQUUsRUFBRSxDQUFDO1FBQ3RDLFFBQVEsRUFBRSxFQUFFO1lBQ1IsS0FBSyxPQUFPLENBQUMsS0FBSztnQkFDZCxPQUFPLGNBQWMsSUFBSSxXQUFXLENBQUM7WUFDekMsS0FBSyxPQUFPLENBQUMsUUFBUTtnQkFDakIsT0FBTyxDQUFDLEVBQUUsR0FBRyxjQUFjLENBQUMsQ0FBQyxXQUFXLEVBQUUsS0FBSyxDQUFDLEVBQUUsR0FBRyxXQUFXLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUNwRixLQUFLLE9BQU8sQ0FBQyxPQUFPO2dCQUNoQixPQUFPLGNBQWMsR0FBRyxXQUFXLENBQUM7WUFDeEMsS0FBSyxPQUFPLENBQUMsY0FBYztnQkFDdkIsT0FBTyxjQUFjLElBQUksV0FBVyxDQUFDO1lBQ3pDLEtBQUssT0FBTyxDQUFDLElBQUk7Z0JBQ2IsT0FBTyxjQUFjLEdBQUcsV0FBVyxDQUFDO1lBQ3hDLEtBQUssT0FBTyxDQUFDLFdBQVc7Z0JBQ3BCLE9BQU8sY0FBYyxJQUFJLFdBQVcsQ0FBQztZQUN6QyxLQUFLLE9BQU8sQ0FBQyxJQUFJO2dCQUNiLE9BQU8sQ0FBQyxFQUFFLEdBQUcsY0FBYyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ3ZGLEtBQUssT0FBTyxDQUFDLE9BQU87Z0JBQ2hCLE9BQU8sQ0FBQyxFQUFFLEdBQUcsY0FBYyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1lBQ3pGLEtBQUssT0FBTyxDQUFDLEVBQUU7Z0JBQ1gsV0FBVyxHQUFHLFdBQVcsSUFBSSxFQUFFLENBQUM7Z0JBQ2hDLE9BQU8sV0FBVyxDQUFDLFNBQVM7Ozs7Z0JBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksY0FBYyxFQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDakUsS0FBSyxJQUFJLEVBQUUsUUFBUTtnQkFDZixPQUFPLGNBQWMsS0FBSyxFQUFFLElBQUksY0FBYyxLQUFLLElBQUksQ0FBQztZQUM1RCxLQUFLLElBQUksRUFBRyxXQUFXO2dCQUNuQixPQUFPLGNBQWMsS0FBSyxFQUFFLElBQUksY0FBYyxLQUFLLElBQUksQ0FBQztZQUM1RCxLQUFLLElBQUksRUFBRSxPQUFPO2dCQUNkLE9BQU8sY0FBYyxLQUFLLElBQUksQ0FBQztZQUNuQyxLQUFLLElBQUksRUFBRSxVQUFVO2dCQUNqQixPQUFPLGNBQWMsS0FBSyxJQUFJLENBQUM7U0FDdEM7SUFDTCxDQUFDOzs7Ozs7OztJQUVPLGlCQUFpQixDQUFDLE9BQWdCLEVBQUUsUUFBc0IsRUFBRSxPQUFnQjs7Y0FDMUUsU0FBUyxHQUFHLFFBQVEsQ0FBQyxXQUFXLEVBQUU7UUFDeEMsSUFBSSxTQUFTLEtBQUssS0FBSyxFQUFFO1lBQ3JCLE9BQU8sT0FBTyxJQUFJLE9BQU8sQ0FBQztTQUM3QjthQUFNO1lBQ0gsT0FBTyxPQUFPLElBQUksT0FBTyxDQUFDO1NBQzdCO0lBQ0wsQ0FBQzs7Ozs7O0lBRU8sbUJBQW1CLENBQUMsU0FBcUM7UUFDN0QsSUFBSSxDQUFDLFNBQVMsRUFBRTtZQUNaLE9BQU8sSUFBSSxDQUFDO1NBQ2Y7UUFFRCxPQUFPLE1BQU0sQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsTUFBTTs7Ozs7UUFBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUM1QyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDbEIsQ0FBQyxHQUFFLElBQUksQ0FBQyxDQUFDO0lBQ2IsQ0FBQzs7Ozs7OztJQUVPLHNCQUFzQixDQUFDLE9BQVksRUFBRSxVQUFzRDs7O1lBRTNGLFNBQVMsR0FBRyxJQUFJO1FBQ3BCLElBQUksVUFBVSxFQUFFOztrQkFDTixNQUFNLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUM7WUFDdEMsU0FBUyxHQUFHLEVBQUUsQ0FBQztZQUNmLE1BQU0sQ0FBQyxPQUFPOzs7O1lBQUMsS0FBSyxDQUFDLEVBQUU7O29CQUNmLFVBQVUsR0FBRyxLQUFLLENBQUMsUUFBUSxDQUFDLEtBQUssRUFBRSxPQUFPLENBQUM7O3NCQUN6QyxTQUFTLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDO2dCQUMzQyxJQUFJLFNBQVMsSUFBSSxTQUFTLENBQUMsbUJBQW1CLEVBQUU7b0JBQzVDLFVBQVUsR0FBRyxLQUFLLENBQUMsb0JBQW9CLENBQUMsVUFBVSxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLENBQUM7aUJBQ2hGOztzQkFFSyxLQUFLLEdBQUcsVUFBVSxDQUFDLEtBQUssQ0FBQztzQkFDekIsRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLFFBQVEsRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLEdBQUcsS0FBSztnQkFDaEUsSUFBSSxLQUFLLEVBQUU7OzBCQUNELE1BQU0sR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsVUFBVSxFQUFFLFNBQVMsRUFBRSxNQUFNLENBQUM7b0JBQ25FLFNBQVMsQ0FBQyxLQUFLLENBQUMsR0FBRyxNQUFNLENBQUM7b0JBQzFCLElBQUksUUFBUSxFQUFFOzs4QkFDSixPQUFPLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUFDLFVBQVUsRUFBRSxTQUFTLEVBQUUsTUFBTSxDQUFDO3dCQUNwRSxTQUFTLENBQUMsS0FBSyxDQUFDLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixDQUFDLE1BQU0sRUFBRSxRQUFRLEVBQUUsT0FBTyxDQUFDLENBQUM7cUJBQ3hFO2lCQUNKO1lBRUwsQ0FBQyxFQUFDLENBQUM7U0FDTjtRQUVELE9BQU8sSUFBSSxDQUFDLG1CQUFtQixDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQy9DLENBQUM7Ozs7O0lBRUQsaUJBQWlCLENBQUMsS0FBSztRQUNuQixJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUNqQyxDQUFDOzs7OztJQUVELDZCQUE2QixDQUFDLFVBQWU7UUFDekMsSUFBSSxDQUFDLFVBQVUsRUFBRTtZQUNiLE9BQU8sRUFBRSxDQUFDO1NBQ2I7O1lBQ0csR0FBRyxHQUFHLEVBQUU7O2NBQ04sT0FBTyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLHFCQUFxQixDQUFDOztjQUN4RCxNQUFNLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsb0JBQW9CLENBQUM7O2NBQ3RELEdBQUcsR0FBRyxxQ0FBcUMsT0FBTyxTQUFTOztjQUMzRCxJQUFJLEdBQUcsa0NBQWtDLE9BQU8sU0FBUzs7Y0FDekQsRUFBRSxHQUFHLHFDQUFxQyxNQUFNLFNBQVM7O2NBQ3pELFFBQVEsR0FBRyxVQUFVOztjQUNyQixRQUFRLEdBQUcsVUFBVTs7Y0FDckIsUUFBUSxHQUFHLGlHQUFpRztRQUVsSCxHQUFHLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxNQUFNOzs7OztRQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFOztrQkFDcEMsTUFBTSxHQUFHLFVBQVUsQ0FBQyxDQUFDLENBQUM7O2tCQUN0QixHQUFHLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDOztrQkFDM0IsQ0FBQyxHQUFHLE1BQU0sR0FBRyxDQUFDLEtBQUssTUFBTTs7Z0JBRTNCLENBQUMsR0FBRyxJQUFJLENBQUMsSUFBSSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxJQUFJLEtBQUssQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJO1lBQ2hHLElBQUksTUFBTSxDQUFDLFNBQVMsSUFBSSxPQUFPLENBQUMsRUFBRSxFQUFFOztvQkFDNUIsR0FBRyxHQUFHLE1BQU0sQ0FBQyxNQUFNOztvQkFDbkIsSUFBSSxHQUFHLEdBQUc7Z0JBQ2QsSUFBSSxHQUFHLENBQUMsTUFBTSxDQUFDLElBQUksS0FBSyxnQkFBZ0IsQ0FBQyxJQUFJLEVBQUU7OzBCQUNyQyxRQUFRLEdBQUcscUJBQXFCLENBQUMsb0JBQW9CLENBQUMsR0FBRyxDQUFDO29CQUNoRSxHQUFHLEdBQUcscUJBQXFCLENBQUMsV0FBVyxDQUFDLFFBQVEsRUFBRSxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUM7b0JBQ2pFLElBQUksR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2lCQUMvQztxQkFBTTtvQkFDSCxJQUFJLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2lCQUNwQztnQkFFRCxDQUFDLEdBQUcsSUFBSSxDQUFDLElBQUksSUFBSSxDQUFDLGdCQUFnQixDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztnQkFDcEUsSUFBSSxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7b0JBQzFCLENBQUMsR0FBRyxJQUFJLENBQUMsSUFBSSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxJQUFJLFFBQVEsQ0FBQyxPQUFPLENBQUMsU0FBUyxFQUFFLEdBQUcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQztpQkFDekg7YUFDSjtpQkFBTTtnQkFDSCxJQUFJLE1BQU0sQ0FBQyxTQUFTLElBQUksT0FBTyxDQUFDLEtBQUssSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRTtvQkFDbkUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFO3dCQUN2QixDQUFDLEdBQUcsSUFBSSxDQUFDLElBQUksSUFBSSxDQUFDLGdCQUFnQixDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDO3FCQUMvRDtpQkFDSjthQUNKO1lBQ0QsSUFBSSxNQUFNLENBQUMsUUFBUSxFQUFFOztzQkFDWCxFQUFFLEdBQUcsR0FBRyxDQUFDLElBQUksSUFBSSxDQUFDLGdCQUFnQixDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsSUFBSSxNQUFNLENBQUMsTUFBTSxFQUFFO2dCQUM3RSxDQUFDLEdBQUcsR0FBRyxRQUFRLElBQUksQ0FBQyxJQUFJLE1BQU0sQ0FBQyxRQUFRLEtBQUssS0FBSyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsSUFBSSxFQUFFLElBQUksUUFBUSxFQUFFLENBQUM7YUFDckY7WUFDRCxPQUFPLEdBQUcsQ0FBQyw0Q0FBNEMsQ0FBQyxNQUFNLENBQUMsY0FBYyxDQUFDO1FBQ2xGLENBQUMsR0FBRSxFQUFFLENBQUMsQ0FBQzs7Y0FDRCxVQUFVLEdBQUcsR0FBRyxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUM7O1lBQ3JDLFNBQVMsR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxVQUFVLENBQUM7UUFDekMsU0FBUyxJQUFJLEdBQUcsQ0FBQyxNQUFNLENBQUMsVUFBVSxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQ3hDLE9BQU8sU0FBUyxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUUsR0FBRyxDQUFDLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQztJQUM3RCxDQUFDOzs7Ozs7SUFFTyxnQkFBZ0IsQ0FBQyxRQUFpQjs7Y0FDaEMsRUFBRSxHQUFHLFFBQVEsQ0FBQyxFQUFFLEdBQUcsUUFBUSxFQUFFLEVBQUUsQ0FBQzs7WUFDbEMsSUFBSSxHQUFHLEVBQUU7UUFDYixRQUFRLEVBQUUsRUFBRTtZQUNSLEtBQUssT0FBTyxDQUFDLEtBQUssQ0FBQztZQUNuQixLQUFLLE9BQU8sQ0FBQyxRQUFRLENBQUM7WUFDdEIsS0FBSyxPQUFPLENBQUMsT0FBTyxDQUFDO1lBQ3JCLEtBQUssT0FBTyxDQUFDLGNBQWMsQ0FBQztZQUM1QixLQUFLLE9BQU8sQ0FBQyxJQUFJLENBQUM7WUFDbEIsS0FBSyxPQUFPLENBQUMsV0FBVyxDQUFDO1lBQ3pCLEtBQUssT0FBTyxDQUFDLElBQUksQ0FBQztZQUNsQixLQUFLLE9BQU8sQ0FBQyxPQUFPLENBQUM7WUFDckIsS0FBSyxPQUFPLENBQUMsRUFBRTtnQkFDWCxJQUFJLEdBQUcsT0FBTyxDQUFDLEVBQUUsQ0FBQyxDQUFDO2dCQUNuQixJQUFJLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLFdBQVcsRUFBRSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQzlDLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsNEJBQTRCLEdBQUcsSUFBSSxDQUFDLENBQUM7WUFDeEUsS0FBSyxJQUFJLEVBQUUsUUFBUTtnQkFDZixPQUFPLEdBQUcsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxpQ0FBaUMsQ0FBQyxDQUFDO1lBQzVFLEtBQUssSUFBSSxFQUFHLFdBQVc7Z0JBQ25CLE9BQU8sR0FBRyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLG9DQUFvQyxDQUFDLENBQUM7WUFDL0UsS0FBSyxJQUFJLEVBQUUsT0FBTztnQkFDZCxPQUFPLEdBQUcsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxnQ0FBZ0MsQ0FBQyxDQUFDO1lBQzNFLEtBQUssSUFBSSxFQUFFLFVBQVU7Z0JBQ2pCLE9BQU8sR0FBRyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLG1DQUFtQyxDQUFDLENBQUM7U0FDakY7SUFDTCxDQUFDOzs7OztJQUdELG1CQUFtQixDQUFDLFNBQW1DOztjQUM3QyxTQUFTLEdBQUcsRUFBRTtRQUNwQixJQUFJLFNBQVMsRUFBRTs7a0JBQ0wsTUFBTSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDO1lBQ3JDLElBQUksTUFBTSxJQUFJLE1BQU0sQ0FBQyxNQUFNLEVBQUU7Z0JBQ3pCLE1BQU0sQ0FBQyxPQUFPOzs7O2dCQUFDLEtBQUssQ0FBQyxFQUFFOzswQkFDYixHQUFHLEdBQUcsRUFBRSxXQUFXLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUUsUUFBUSxFQUFFLEVBQUUsRUFBRSxRQUFRLEVBQUUsRUFBRSxFQUFFLFFBQVEsRUFBRSxDQUFDLEVBQUUsT0FBTyxFQUFFLENBQUMsRUFBRTs7MEJBQzVGLFlBQVksR0FBRyxTQUFTLENBQUMsS0FBSyxDQUFDO29CQUNyQyxJQUFJLE9BQU8sWUFBWSxLQUFLLFFBQVEsRUFBRTt3QkFDbEMsR0FBRyxDQUFDLE9BQU8sR0FBRyxZQUFZLENBQUMsU0FBUyxDQUFDO3dCQUNyQyxHQUFHLENBQUMsS0FBSyxHQUFHLFlBQVksQ0FBQyxNQUFNLENBQUM7d0JBQ2hDLFNBQVMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7d0JBQ3BCLElBQUksWUFBWSxDQUFDLE1BQU0sRUFBRTs0QkFDckIsR0FBRyxDQUFDLFFBQVEsR0FBRyxHQUFHLENBQUM7NEJBQ25CLEdBQUcsQ0FBQyxRQUFRLEdBQUcsWUFBWSxDQUFDLFFBQVEsS0FBSyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDOztrQ0FFakQsSUFBSSxHQUFHLEVBQUUsV0FBVyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsRUFBRSxFQUFFLFFBQVEsRUFBRSxFQUFFLEVBQUUsUUFBUSxFQUFFLEdBQUcsRUFBRSxRQUFRLEVBQUUsQ0FBQyxFQUFFLE9BQU8sRUFBRSxDQUFDLEVBQUU7NEJBQ3BHLElBQUksQ0FBQyxPQUFPLEdBQUcsWUFBWSxDQUFDLFNBQVMsQ0FBQzs0QkFDdEMsSUFBSSxDQUFDLEtBQUssR0FBRyxZQUFZLENBQUMsTUFBTSxDQUFDOzRCQUVqQyxTQUFTLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO3lCQUN4Qjs2QkFBTTs0QkFDSCxJQUFJLFlBQVksQ0FBQyxTQUFTLEVBQUU7O3NDQUNsQixHQUFHLEdBQUcsUUFBUSxDQUFDLEVBQUUsR0FBRyxZQUFZLENBQUMsU0FBUyxFQUFFLEVBQUUsQ0FBQztnQ0FDckQsSUFBSSxHQUFHLEtBQUssSUFBSSxJQUFJLEdBQUcsS0FBSyxJQUFJLEVBQUU7b0NBQzlCLEdBQUcsQ0FBQyxRQUFRLEdBQUcsR0FBRyxDQUFDO29DQUNuQixHQUFHLENBQUMsUUFBUSxHQUFHLFlBQVksQ0FBQyxRQUFRLEtBQUssS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQzs7MENBRWpELElBQUksR0FBRyxFQUFFLFdBQVcsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRSxRQUFRLEVBQUUsRUFBRSxFQUFFLFFBQVEsRUFBRSxHQUFHLEVBQUUsUUFBUSxFQUFFLENBQUMsRUFBRSxPQUFPLEVBQUUsQ0FBQyxFQUFFO29DQUNwRyxJQUFJLENBQUMsT0FBTyxHQUFHLEdBQUcsS0FBSyxJQUFJLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUM7b0NBQy9ELElBQUksQ0FBQyxLQUFLLEdBQUcsRUFBRSxDQUFDO29DQUVoQixTQUFTLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO2lDQUN4Qjs2QkFDSjt5QkFDSjtxQkFDSjtvQkFDRCxPQUFPLEdBQUcsQ0FBQztnQkFDZixDQUFDLEVBQUMsQ0FBQzthQUNOO1NBQ0o7UUFFRCxJQUFJLFNBQVMsQ0FBQyxNQUFNLEVBQUU7WUFDbEIsSUFBSSxDQUFDLG9CQUFvQixDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQ3JDLFNBQVMsQ0FBQyxTQUFTLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLFFBQVEsR0FBRyxDQUFDLENBQUM7U0FDaEQ7UUFFRCxPQUFPLFNBQVMsQ0FBQztJQUNyQixDQUFDOzs7Ozs7SUFFTyxvQkFBb0IsQ0FBQyxTQUE0Qjs7Y0FDL0MsV0FBVyxHQUF5QixFQUFHO1FBQzdDLFNBQVMsQ0FBQyxPQUFPOzs7OztRQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFOztrQkFDakIsYUFBYSxHQUFHLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLENBQUM7WUFDbkQsSUFBSSxhQUFhLElBQUksYUFBYSxDQUFDLE1BQU0sRUFBRTtnQkFDdkMsV0FBVyxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUMsR0FBRyxhQUFhLENBQUE7YUFDN0M7UUFDTCxDQUFDLEVBQUMsQ0FBQzs7Y0FFRyxJQUFJLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUM7UUFDckMsSUFBSSxJQUFJLENBQUMsTUFBTSxFQUFFO1lBQ2IsSUFBSSxDQUFDLE9BQU87Ozs7WUFBQyxDQUFDLENBQUMsRUFBRSxFQUFFOztzQkFDVCxDQUFDLEdBQUcsU0FBUyxDQUFDLFNBQVM7Ozs7Z0JBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsV0FBVyxLQUFLLENBQUMsRUFBQztnQkFDdkQsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEdBQUcsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDOUMsQ0FBQyxFQUFDLENBQUE7U0FDTDtRQUVELE9BQU8sU0FBUyxDQUFDO0lBQ3JCLENBQUM7Ozs7Ozs7SUFHTyxxQkFBcUIsQ0FBQyxNQUF1QjtRQUNqRCxJQUFJLE1BQU0sRUFBRTs7a0JBQ0YsR0FBRyxHQUFHLG1CQUFBLElBQUksQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsRUFBYztZQUNoRSxJQUFJLEdBQUcsSUFBSSxHQUFHLENBQUMsTUFBTSxJQUFJLEdBQUcsQ0FBQyxNQUFNLENBQUMsSUFBSSxLQUFNLGdCQUFnQixDQUFDLElBQUksRUFBRztnQkFDbEUsSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxNQUFNLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRTtvQkFDcEQsSUFBSSxNQUFNLENBQUMsS0FBSyxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7d0JBQzNCLE1BQU0sQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDLEtBQUssQ0FBQzt3QkFDL0IsTUFBTSxDQUFDLEtBQUssR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO3dCQUMvQixPQUFPLEVBQUUsQ0FBQztxQkFDYjt5QkFBTTs7OzRCQUVDLFNBQVMsR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDLEdBQUc7Ozs7d0JBQUMsQ0FBQyxHQUFRLEVBQUUsRUFBRTs0QkFDMUMsT0FBTztnQ0FDSCxXQUFXLEVBQUUsTUFBTSxDQUFDLFdBQVc7Z0NBQy9CLEtBQUssRUFBRSxHQUFHO2dDQUNWLFFBQVEsRUFBRSxFQUFFO2dDQUNaLFFBQVEsRUFBRSxFQUFFO2dDQUNaLFFBQVEsRUFBRSxDQUFDOztnQ0FDWCxPQUFPLEVBQUUsQ0FBQzs2QkFDYixDQUFBO3dCQUNMLENBQUMsRUFBQzt3QkFDRixTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxHQUFHLEdBQUcsQ0FBQzt3QkFDNUIsU0FBUyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFFLENBQUMsQ0FBQyxDQUFDLFFBQVEsR0FBRyxHQUFHLENBQUM7d0JBQ2pELFNBQVMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRSxDQUFDLENBQUMsQ0FBQyxRQUFRLEdBQUcsQ0FBQyxDQUFDO3dCQUMvQyxPQUFPLFNBQVMsQ0FBQztxQkFDcEI7aUJBQ0o7YUFDSjtTQUNKO1FBRUQsT0FBTyxFQUFFLENBQUM7SUFDZCxDQUFDOzs7OztJQUVELHlCQUF5QixDQUFDLEdBQWU7O1lBQ2pDLGlCQUFpQixHQUFpQjtZQUNsQyxJQUFJLEVBQUUsZ0JBQWdCLENBQUMsTUFBTTtZQUM3QixjQUFjLEVBQUUsSUFBSTtTQUN2QjtRQUNELElBQUksR0FBRyxDQUFDLE1BQU0sRUFBRTtZQUNaLFFBQVEsR0FBRyxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUU7Z0JBQ3JCLEtBQUssVUFBVSxDQUFDO2dCQUNoQixLQUFLLFNBQVMsQ0FBQztnQkFDZixLQUFLLGtCQUFrQjtvQkFDbkIsaUJBQWlCLEdBQUc7d0JBQ2hCLElBQUksRUFBRSxnQkFBZ0IsQ0FBQyxNQUFNO3dCQUM3QixjQUFjLEVBQUUsSUFBSTtxQkFDdkIsQ0FBQztvQkFDRixNQUFNO2dCQUNWLEtBQUssVUFBVSxDQUFDO2dCQUNoQixLQUFLLFFBQVE7b0JBQ1QsaUJBQWlCLEdBQUc7d0JBQ2hCLElBQUksRUFBRSxnQkFBZ0IsQ0FBQyxPQUFPO3dCQUM5QixjQUFjLEVBQUUsS0FBSztxQkFDeEIsQ0FBQztvQkFDRixNQUFNO2dCQUNWLEtBQUssV0FBVztvQkFDWixpQkFBaUIsR0FBRzt3QkFDaEIsSUFBSSxFQUFFLGdCQUFnQixDQUFDLE1BQU07d0JBQzdCLGNBQWMsRUFBRSxJQUFJO3FCQUN2QixDQUFDO29CQUNGLE1BQU07Z0JBQ1YsS0FBSyxXQUFXLENBQUM7Z0JBQ2pCLEtBQUssUUFBUTtvQkFDVCxpQkFBaUIsR0FBRzt3QkFDaEIsSUFBSSxFQUFFLGdCQUFnQixDQUFDLElBQUk7d0JBQzNCLGNBQWMsRUFBRSxJQUFJO3dCQUNwQixPQUFPLEVBQUUsR0FBRyxDQUFDLE1BQU0sQ0FBQyxPQUFPO3FCQUM5QixDQUFDO29CQUNGLE1BQU07Z0JBQ1YsS0FBSyxZQUFZO29CQUNiLGlCQUFpQixHQUFHO3dCQUNoQixJQUFJLEVBQUUsR0FBRyxDQUFDLFVBQVUsQ0FBQyxLQUFLLFVBQVUsQ0FBQyxDQUFDLENBQUMsZ0JBQWdCLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJO3dCQUN4RixjQUFjLEVBQUUsSUFBSTt3QkFDcEIsT0FBTyxFQUFFOzRCQUNMLFVBQVUsRUFBRSxHQUFHLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxVQUFVOzRCQUN6QyxZQUFZLEVBQUUsR0FBRyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsWUFBWTt5QkFDaEQ7cUJBQ0osQ0FBQztvQkFDRixNQUFNO2dCQUNWLEtBQUssWUFBWTtvQkFDYixpQkFBaUIsR0FBRzt3QkFDaEIsSUFBSSxFQUFFLGdCQUFnQixDQUFDLElBQUk7d0JBQzNCLGNBQWMsRUFBRSxJQUFJO3FCQUN2QixDQUFDO29CQUNGLE1BQU07YUFFYjtTQUNKO2FBQU0sSUFBSSxHQUFHLENBQUMsU0FBUyxFQUFFO1lBQ3RCLElBQUksT0FBTyxHQUFHLENBQUMsU0FBUyxLQUFLLFFBQVEsSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQyxNQUFNLEVBQUU7O3NCQUNsRSxPQUFPLEdBQVEsR0FBRyxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUM7Z0JBQzdDLFFBQVEsR0FBRyxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsRUFBRTtvQkFDM0IsS0FBSyxRQUFRO3dCQUNULGlCQUFpQixHQUFHOzRCQUNoQixJQUFJLEVBQUUsZ0JBQWdCLENBQUMsTUFBTTs0QkFDN0IsY0FBYyxFQUFFLElBQUk7eUJBQ3ZCLENBQUM7d0JBQ0YsTUFBTTtvQkFDVixLQUFLLE1BQU07d0JBQ1AsaUJBQWlCLEdBQUc7NEJBQ2hCLElBQUksRUFBRSxnQkFBZ0IsQ0FBQyxJQUFJOzRCQUMzQixjQUFjLEVBQUUsSUFBSTs0QkFDcEIsT0FBTzt5QkFDVixDQUFDO3dCQUNGLE1BQU07b0JBQ1YsS0FBSyxTQUFTO3dCQUNWLGlCQUFpQixHQUFHOzRCQUNoQixJQUFJLEVBQUUsZ0JBQWdCLENBQUMsT0FBTzs0QkFDOUIsY0FBYyxFQUFFLEtBQUs7eUJBQ3hCLENBQUM7d0JBQ0YsTUFBTTtvQkFDVixLQUFLLFVBQVU7OzRCQUNQLEdBQUcsR0FBRyxnQkFBZ0IsQ0FBQyxRQUFROzs0QkFDL0IsR0FBRyxHQUFHLFlBQVk7OzRCQUNsQixTQUFTLEdBQUcsWUFBWTt3QkFDNUIsSUFBSSxPQUFPLElBQUksT0FBTyxDQUFDLE1BQU0sRUFBRTs0QkFDM0IsR0FBRyxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUM7NEJBQ3JCLElBQUksR0FBRyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRTtnQ0FDMUIsR0FBRyxHQUFHLGdCQUFnQixDQUFDLElBQUksQ0FBQzs2QkFDL0I7aUNBQU07Z0NBQ0gsU0FBUyxJQUFJLFFBQVEsQ0FBQztnQ0FDdEIsSUFBSSxHQUFHLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFO29DQUN4QixTQUFTLElBQUksS0FBSyxDQUFDO2lDQUN0Qjs2QkFDSjt5QkFDSjs2QkFBTTs0QkFDSCxHQUFHLEdBQUcsZ0JBQWdCLENBQUMsSUFBSSxDQUFDO3lCQUMvQjt3QkFDRCxpQkFBaUIsR0FBRzs0QkFDaEIsSUFBSSxFQUFFLEdBQUc7NEJBQ1QsY0FBYyxFQUFFLElBQUk7eUJBQ3ZCLENBQUM7d0JBRUYsaUJBQWlCLENBQUMsT0FBTyxHQUFHLEVBQUUsVUFBVSxFQUFFLEdBQUcsRUFBRSxZQUFZLEVBQUUsU0FBUyxFQUFFLENBQUM7d0JBQ3pFLE1BQU07b0JBQ1Y7d0JBQ0ksaUJBQWlCLEdBQUc7NEJBQ2hCLElBQUksRUFBRSxnQkFBZ0IsQ0FBQyxNQUFNOzRCQUM3QixjQUFjLEVBQUUsSUFBSTt5QkFDdkIsQ0FBQztpQkFDVDthQUNKO1NBQ0o7YUFBTTtZQUNILGlCQUFpQixHQUFHO2dCQUNoQixJQUFJLEVBQUUsZ0JBQWdCLENBQUMsTUFBTTtnQkFDN0IsY0FBYyxFQUFFLElBQUk7YUFDdkIsQ0FBQztTQUNMO1FBQ0QsT0FBTyxpQkFBaUIsQ0FBQztJQUM3QixDQUFDOzs7Ozs7SUFJRCwrQkFBK0IsQ0FBQyxVQUFpQjtRQUM3QyxJQUFJLFVBQVUsSUFBSSxVQUFVLENBQUMsTUFBTSxFQUFFO1lBQ2pDLE9BQU8sVUFBVSxDQUFDLEdBQUc7Ozs7WUFBQyxDQUFDLENBQUMsRUFBRTtnQkFDdEIsT0FBTyxDQUFDLENBQUM7WUFDYixDQUFDLEVBQUMsQ0FBQztTQUNOO1FBRUQsT0FBTyxFQUFFLENBQUM7SUFDZCxDQUFDOzs7Ozs7O0lBRU8sZ0JBQWdCLENBQUMsT0FBWSxFQUFFLFVBQWU7UUFDbEQsSUFBSSxDQUFDLFVBQVUsSUFBSSxVQUFVLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtZQUN4QyxPQUFPLElBQUksQ0FBQztTQUNmO1FBQ0QsT0FBTyxJQUFJLENBQUMseUJBQXlCLENBQUMsT0FBTyxFQUFFLFVBQVUsQ0FBQyxDQUFDO0lBQy9ELENBQUM7Ozs7Ozs7SUFFTyx5QkFBeUIsQ0FBQyxPQUFZLEVBQUUsVUFBVTs7WUFDbEQsU0FBUyxHQUFHLElBQUk7UUFDcEIsSUFBSSxVQUFVLEVBQUU7WUFDWixTQUFTLEdBQUcsRUFBRSxDQUFDO1lBQ2YsVUFBVSxDQUFDLE9BQU87Ozs7WUFBQyxTQUFTLENBQUMsRUFBRTs7c0JBQ3JCLEtBQUssR0FBRyxTQUFTLENBQUMsV0FBVzs7b0JBQy9CLFVBQVUsR0FBRyxLQUFLLENBQUMsUUFBUSxDQUFDLEtBQUssRUFBRSxPQUFPLENBQUM7O3NCQUN6QyxTQUFTLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDO2dCQUMzQyxJQUFJLFNBQVMsSUFBSSxTQUFTLENBQUMsbUJBQW1CLEVBQUU7b0JBQzVDLFVBQVUsR0FBRyxLQUFLLENBQUMsb0JBQW9CLENBQUMsVUFBVSxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLENBQUM7aUJBQ2hGOztzQkFFSyxLQUFLLEdBQUcsU0FBUztzQkFDakIsRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLE9BQU8sRUFBRSxTQUFTLEVBQUUsR0FBRyxLQUFLO2dCQUNyRCxJQUFJLEtBQUssRUFBRTs7MEJBQ0QsQ0FBQyxHQUFHLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxVQUFVLEVBQUUsU0FBUyxFQUFFLEtBQUssQ0FBQztvQkFDN0QsSUFBSSxTQUFTLENBQUMsS0FBSyxDQUFDLEtBQUssU0FBUyxFQUFFO3dCQUNoQyxTQUFTLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBRSxDQUFDLENBQUUsQ0FBQztxQkFDNUI7eUJBQU07d0JBQ0gsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztxQkFDNUI7aUJBQ0o7WUFFTCxDQUFDLEVBQUMsQ0FBQztTQUNOOzs7Y0FHSyxNQUFNLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUM7O2NBQy9CLE1BQU0sR0FBRyxFQUFFO1FBQ2pCLE1BQU0sQ0FBQyxPQUFPOzs7O1FBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRTs7a0JBQ1osUUFBUSxHQUFHLFVBQVUsQ0FBQyxNQUFNOzs7O1lBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsV0FBVyxLQUFLLENBQUMsRUFBQztZQUM1RCxJQUFJLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO2dCQUMzQixNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO2FBQ2hDO2lCQUFNO2dCQUNILElBQUksUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsS0FBSyxDQUFDLElBQUksU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUUsRUFBRyxNQUFNO29CQUNsRSxNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztpQkFDbkQ7cUJBQU0sRUFBRyxLQUFLO29CQUNYLE1BQU0sQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO2lCQUNoRDthQUNKO1FBQ0wsQ0FBQyxFQUFDLENBQUM7UUFFSCxPQUFPLE1BQU0sQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7SUFDeEMsQ0FBQzs7Ozs7O0lBRUQsa0JBQWtCLENBQUMsSUFBUSxFQUFFLFVBQWlCO1FBQzFDLElBQUksSUFBSSxJQUFJLElBQUksQ0FBQyxNQUFNLEVBQUU7WUFDckIsT0FBTyxJQUFJLENBQUMsTUFBTTs7OztZQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLENBQUMsRUFBRSxVQUFVLENBQUMsRUFBQyxDQUFDO1NBQ2pFO1FBQ0QsT0FBTyxJQUFJLENBQUM7SUFDaEIsQ0FBQzs7O1lBbmVKLFVBQVU7Ozs7WUFMRixxQkFBcUI7WUFIckIsYUFBYTtZQUNELFFBQVE7Ozs7SUFTekIsNENBQXlDOzs7OztJQUU3QixvQ0FBa0M7Ozs7O0lBQUUsMENBQWdDOzs7OztJQUFFLHVDQUF3QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IExvY2FsZVNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWxvY2FsZSc7XHJcbmltcG9ydCB7IEluamVjdGFibGUsIEluamVjdG9yLCBFdmVudEVtaXR0ZXIsIE9wdGlvbmFsIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IENvbXBhcmUsIEZpbHRlckNvbmRpdGlvbiB9IGZyb20gJ0BmYXJyaXMvdWktY29tbW9uL3R5cGVzJztcclxuaW1wb3J0IHsgRGF0YWdyaWRGYWNhZGVTZXJ2aWNlIH0gZnJvbSAnLi9kYXRhZ3JpZC1mYWNhZGUuc2VydmljZSc7XHJcbmltcG9ydCB7IFV0aWxzIH0gZnJvbSAnLi8uLi91dGlscy91dGlscyc7XHJcbmltcG9ydCB7IERhdGFDb2x1bW4sIENvbHVtbkZpbHRlclR5cGUsIENvbHVtbkZpbHRlciwgRmlsdGVyQ29uZGl0aW9uIGFzIENsaWVudEZpbHRlckNvbmRpdGlvbiB9IGZyb20gJy4uL3R5cGVzL2RhdGEtY29sdW1uJztcclxuaW1wb3J0IHsgRGF0YWdyaWRDb2x1bW5zSGVscGVyIH0gZnJvbSAnLi9kYXRhZ3JpZC1jb2x1bW5zLmhlbHBlcic7XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBEYXRhZ3JpZEZpbHRlclNlcnZpY2Uge1xyXG4gICAgcmVtb3ZlRmllbGQgPSBuZXcgRXZlbnRFbWl0dGVyPHN0cmluZz4oKTtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGRmczogRGF0YWdyaWRGYWNhZGVTZXJ2aWNlLCBwcml2YXRlIGxvY2FsZVNlcjogTG9jYWxlU2VydmljZSwgcHJpdmF0ZSBpbmplY3Q6IEluamVjdG9yKSB7XHJcbiAgICB9XHJcblxyXG4gICAgdmFsaWRhdGVSb3dEYXRhKHJvd0RhdGE6IGFueSwgY29uZGl0aW9uczogeyBbZmllbGQ6IHN0cmluZ106IENsaWVudEZpbHRlckNvbmRpdGlvbiB9KSB7XHJcbiAgICAgICAgaWYgKCFjb25kaXRpb25zIHx8IE9iamVjdC5rZXlzKGNvbmRpdGlvbnMpLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2hlY2tBbGxGaWVsZEluUm93RGF0YShyb3dEYXRhLCBjb25kaXRpb25zKTtcclxuICAgIH1cclxuXHJcbiAgICBleGVjdXRlRmlsdGVyKGRhdGE6IFtdLCBjb25kaXRpb25zOiBhbnkpOiBhbnlbXSB7XHJcbiAgICAgICAgaWYgKCB0aGlzLmRmcy5nZXRTdGF0ZSgpLmVuYWJsZVNtYXJ0RmlsdGVyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmV4ZWN1dGVTbWFydEZpbHRlcihkYXRhLCBjb25kaXRpb25zKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChkYXRhICYmIGRhdGEubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBkYXRhLmZpbHRlcihuID0+IHRoaXMudmFsaWRhdGVSb3dEYXRhKG4sIGNvbmRpdGlvbnMpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRDb21wYXJlUmVzdWx0KGZpZWxkRGF0YVZhbHVlOiBhbnksIG9wZXJhdG9yOiBDb21wYXJlLCB0YXJnZXRWYWx1ZTogYW55KSB7XHJcbiAgICAgICAgY29uc3Qgb3AgPSBwYXJzZUludCgnJyArIG9wZXJhdG9yLCAxMCk7XHJcbiAgICAgICAgc3dpdGNoIChvcCkge1xyXG4gICAgICAgICAgICBjYXNlIENvbXBhcmUuRXF1YWw6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmllbGREYXRhVmFsdWUgPT0gdGFyZ2V0VmFsdWU7XHJcbiAgICAgICAgICAgIGNhc2UgQ29tcGFyZS5Ob3RFcXVhbDpcclxuICAgICAgICAgICAgICAgIHJldHVybiAoJycgKyBmaWVsZERhdGFWYWx1ZSkudG9Mb3dlckNhc2UoKSAhPT0gKCcnICsgdGFyZ2V0VmFsdWUpLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgICAgICAgIGNhc2UgQ29tcGFyZS5HcmVhdGVyOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpZWxkRGF0YVZhbHVlID4gdGFyZ2V0VmFsdWU7XHJcbiAgICAgICAgICAgIGNhc2UgQ29tcGFyZS5HcmVhdGVyT3JFcXVhbDpcclxuICAgICAgICAgICAgICAgIHJldHVybiBmaWVsZERhdGFWYWx1ZSA+PSB0YXJnZXRWYWx1ZTtcclxuICAgICAgICAgICAgY2FzZSBDb21wYXJlLkxlc3M6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmllbGREYXRhVmFsdWUgPCB0YXJnZXRWYWx1ZTtcclxuICAgICAgICAgICAgY2FzZSBDb21wYXJlLkxlc3NPckVxdWFsOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpZWxkRGF0YVZhbHVlIDw9IHRhcmdldFZhbHVlO1xyXG4gICAgICAgICAgICBjYXNlIENvbXBhcmUuTGlrZTpcclxuICAgICAgICAgICAgICAgIHJldHVybiAoJycgKyBmaWVsZERhdGFWYWx1ZSkudG9Mb3dlckNhc2UoKS5pbmRleE9mKHRhcmdldFZhbHVlLnRvTG93ZXJDYXNlKCkpID4gLTE7XHJcbiAgICAgICAgICAgIGNhc2UgQ29tcGFyZS5Ob3RMaWtlOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuICgnJyArIGZpZWxkRGF0YVZhbHVlKS50b0xvd2VyQ2FzZSgpLmluZGV4T2YodGFyZ2V0VmFsdWUudG9Mb3dlckNhc2UoKSkgPT09IC0xO1xyXG4gICAgICAgICAgICBjYXNlIENvbXBhcmUuSW46XHJcbiAgICAgICAgICAgICAgICB0YXJnZXRWYWx1ZSA9IHRhcmdldFZhbHVlIHx8IFtdO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRhcmdldFZhbHVlLmZpbmRJbmRleCggbiA9PiBuID09IGZpZWxkRGF0YVZhbHVlKSA+IC0xO1xyXG4gICAgICAgICAgICBjYXNlIDEwMDE6IC8vIEVtcHR5XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmllbGREYXRhVmFsdWUgPT09ICcnIHx8IGZpZWxkRGF0YVZhbHVlID09PSBudWxsO1xyXG4gICAgICAgICAgICBjYXNlIDEwMDI6ICAvLyBOb3RFbXB0eVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpZWxkRGF0YVZhbHVlICE9PSAnJyAmJiBmaWVsZERhdGFWYWx1ZSAhPT0gbnVsbDtcclxuICAgICAgICAgICAgY2FzZSAxMDAzOiAvLyBOdWxsXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmllbGREYXRhVmFsdWUgPT09IG51bGw7XHJcbiAgICAgICAgICAgIGNhc2UgMTAwNDogLy8gTm90TnVsbFxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpZWxkRGF0YVZhbHVlICE9PSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldFJlbGF0aW9uUmVzdWx0KHJlc3VsdDE6IGJvb2xlYW4sIHJlbGF0aW9uOiAnYW5kJyB8ICdvcicsIHJlc3VsdDI6IGJvb2xlYW4pIHtcclxuICAgICAgICBjb25zdCBfcmVsYXRpb24gPSByZWxhdGlvbi50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICAgIGlmIChfcmVsYXRpb24gPT09ICdhbmQnKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQxICYmIHJlc3VsdDI7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDEgfHwgcmVzdWx0MjtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjaGVja0FsbEZpZWxkUmVzdWx0KHJlc3VsdE9iajogeyBba2V5OiBzdHJpbmddOiBib29sZWFuIH0pIHtcclxuICAgICAgICBpZiAoIXJlc3VsdE9iaikge1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBPYmplY3QudmFsdWVzKHJlc3VsdE9iaikucmVkdWNlKChjLCBuKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiBjICYmIG47XHJcbiAgICAgICAgfSwgdHJ1ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjaGVja0FsbEZpZWxkSW5Sb3dEYXRhKHJvd0RhdGE6IGFueSwgY29uZGl0aW9uczogeyBbZmllbGQ6IHN0cmluZ106IENsaWVudEZpbHRlckNvbmRpdGlvbiB9KSB7XHJcbiAgICAgICAgLy8gdGhpcy5zdGF0ZSA9IGNvbmRpdGlvbnM7XHJcbiAgICAgICAgbGV0IHJlc3VsdE9iaiA9IG51bGw7XHJcbiAgICAgICAgaWYgKGNvbmRpdGlvbnMpIHtcclxuICAgICAgICAgICAgY29uc3QgZmllbGRzID0gT2JqZWN0LmtleXMoY29uZGl0aW9ucyk7XHJcbiAgICAgICAgICAgIHJlc3VsdE9iaiA9IHt9O1xyXG4gICAgICAgICAgICBmaWVsZHMuZm9yRWFjaChmaWVsZCA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgZmllbGRWYWx1ZSA9IFV0aWxzLmdldFZhbHVlKGZpZWxkLCByb3dEYXRhKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNvbHVtbk9iaiA9IHRoaXMuZGZzLmdldENvbHVtbihmaWVsZCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoY29sdW1uT2JqICYmIGNvbHVtbk9iai5pc011bHRpbGluZ3VhbEZpZWxkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZmllbGRWYWx1ZSA9IFV0aWxzLmdldE11bHRpbGluZ3VhbFZhbHVlKGZpZWxkVmFsdWUsIHRoaXMubG9jYWxlU2VyLmxvY2FsZUlkKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCB3aGVyZSA9IGNvbmRpdGlvbnNbZmllbGRdO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgeyB2YWx1ZTEsIG9wZXJhdG9yMSwgcmVsYXRpb24sIG9wZXJhdG9yMiwgdmFsdWUyIH0gPSB3aGVyZTtcclxuICAgICAgICAgICAgICAgIGlmICh3aGVyZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMuZ2V0Q29tcGFyZVJlc3VsdChmaWVsZFZhbHVlLCBvcGVyYXRvcjEsIHZhbHVlMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0T2JqW2ZpZWxkXSA9IHJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVsYXRpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0MiA9IHRoaXMuZ2V0Q29tcGFyZVJlc3VsdChmaWVsZFZhbHVlLCBvcGVyYXRvcjIsIHZhbHVlMik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdE9ialtmaWVsZF0gPSB0aGlzLmdldFJlbGF0aW9uUmVzdWx0KHJlc3VsdCwgcmVsYXRpb24sIHJlc3VsdDIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2hlY2tBbGxGaWVsZFJlc3VsdChyZXN1bHRPYmopO1xyXG4gICAgfVxyXG5cclxuICAgIHJlbW92ZUZpbHRlckZpZWxkKGZpZWxkKSB7XHJcbiAgICAgICAgdGhpcy5yZW1vdmVGaWVsZC5lbWl0KGZpZWxkKTtcclxuICAgIH1cclxuXHJcbiAgICBjb252ZXJ0RmlsdGVyQ29uZGl0aW9uMlN0cmluZyhjb25kaXRpb25zOiBhbnkpIHtcclxuICAgICAgICBpZiAoIWNvbmRpdGlvbnMpIHtcclxuICAgICAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgc3RyID0gJyc7XHJcbiAgICAgICAgY29uc3QgYW5kVGV4dCA9IHRoaXMubG9jYWxlU2VyLmdldFZhbHVlKCdkYXRhZ3JpZC5maWx0ZXIuYW5kJyk7XHJcbiAgICAgICAgY29uc3Qgb3JUZXh0ID0gdGhpcy5sb2NhbGVTZXIuZ2V0VmFsdWUoJ2RhdGFncmlkLmZpbHRlci5vcicpO1xyXG4gICAgICAgIGNvbnN0IGFuZCA9IGA8c3BhbiBjbGFzcz0nYmFkZ2UgYmFkZ2Utc3VjY2Vzcyc+JHthbmRUZXh0fTwvc3Bhbj5gO1xyXG4gICAgICAgIGNvbnN0IGFuZDIgPSBgPHNwYW4gY2xhc3M9J2JhZGdlIGJhZGdlLWluZm8nPiR7YW5kVGV4dH08L3NwYW4+YDtcclxuICAgICAgICBjb25zdCBvciA9IGA8c3BhbiBjbGFzcz0nYmFkZ2UgYmFkZ2Utd2FybmluZyc+JHtvclRleHR9PC9zcGFuPmA7XHJcbiAgICAgICAgY29uc3QgbGJyYWNrZXQgPSBgPGI+44CUPC9iPmA7XHJcbiAgICAgICAgY29uc3QgcmJyYWNrZXQgPSBgPGI+44CVPC9iPmA7XHJcbiAgICAgICAgY29uc3QgZWxsaXBzaXMgPSBgWyA8c3BhbiBjbGFzcz1cImVsbGlwc2lzXCIgdGl0bGU9XCIkdGl0bGUkXCI+ICAkdmFsdWUkPGkgY2xhc3M9XCJmLWljb24gZi1pY29uLWxvb2t1cFwiPjwvaT48L3NwYW4+IF1gO1xyXG5cclxuICAgICAgICBzdHIgPSBPYmplY3Qua2V5cyhjb25kaXRpb25zKS5yZWR1Y2UoKGMsIHIpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgZmlsdGVyID0gY29uZGl0aW9uc1tyXTtcclxuICAgICAgICAgICAgY29uc3QgY29sID0gdGhpcy5kZnMuZ2V0Q29sdW1uKHIpO1xyXG4gICAgICAgICAgICBjb25zdCB0ID0gYDxiPiR7Y29sLnRpdGxlfTwvYj5gO1xyXG5cclxuICAgICAgICAgICAgbGV0IHMgPSBgICR7dH0gJHt0aGlzLmdldENvbXBhcmVTdHJpbmcoZmlsdGVyLm9wZXJhdG9yMSl9ICR7VXRpbHMuZXNjYXBlVmFsdWUoZmlsdGVyLnZhbHVlMSl9ICBgO1xyXG4gICAgICAgICAgICBpZiAoZmlsdGVyLm9wZXJhdG9yMSA9PSBDb21wYXJlLkluKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgdHh0ID0gZmlsdGVyLnZhbHVlMTtcclxuICAgICAgICAgICAgICAgIGxldCB0eHQyID0gdHh0O1xyXG4gICAgICAgICAgICAgICAgaWYgKGNvbC5maWx0ZXIudHlwZSA9PT0gQ29sdW1uRmlsdGVyVHlwZS5lbnVtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZW51bU9wdHMgPSBEYXRhZ3JpZENvbHVtbnNIZWxwZXIuZ2V0RmlsdGVyRW51bU9wdGlvbnMoY29sKTtcclxuICAgICAgICAgICAgICAgICAgICB0eHQgPSBEYXRhZ3JpZENvbHVtbnNIZWxwZXIuZ2V0RW51bVRleHQoZW51bU9wdHMsIGZpbHRlci52YWx1ZTEpO1xyXG4gICAgICAgICAgICAgICAgICAgIHR4dDIgPSB0eHQuc3BsaXQoJywnKS5zbGljZSgwLCAyKS5qb2luKCcsJyk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHR4dDIgPSB0eHQuc2xpY2UoMCwgMikuam9pbignLCcpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHMgPSBgICR7dH0gJHt0aGlzLmdldENvbXBhcmVTdHJpbmcoZmlsdGVyLm9wZXJhdG9yMSl9IFsgJHt0eHR9IF0gIGA7XHJcbiAgICAgICAgICAgICAgICBpZiAoZmlsdGVyLnZhbHVlMS5sZW5ndGggPiAyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcyA9IGAgJHt0fSAke3RoaXMuZ2V0Q29tcGFyZVN0cmluZyhmaWx0ZXIub3BlcmF0b3IxKX0gJHtlbGxpcHNpcy5yZXBsYWNlKCckdGl0bGUkJywgdHh0KS5yZXBsYWNlKCckdmFsdWUkJywgdHh0Mil9ICBgO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKGZpbHRlci5vcGVyYXRvcjEgPT0gQ29tcGFyZS5FcXVhbCAmJiBBcnJheS5pc0FycmF5KGZpbHRlci52YWx1ZTEpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFmaWx0ZXIudmFsdWUxLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzID0gYCAke3R9ICR7dGhpcy5nZXRDb21wYXJlU3RyaW5nKGZpbHRlci5vcGVyYXRvcjEpfSAnJyAgYDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGZpbHRlci5yZWxhdGlvbikge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgczIgPSBgJHt0fSAke3RoaXMuZ2V0Q29tcGFyZVN0cmluZyhmaWx0ZXIub3BlcmF0b3IyKX0gJHtmaWx0ZXIudmFsdWUyfWA7XHJcbiAgICAgICAgICAgICAgICBzID0gYCR7bGJyYWNrZXR9ICR7c30gJHtmaWx0ZXIucmVsYXRpb24gPT09ICdhbmQnID8gYW5kMiA6IG9yfSAke3MyfSAke3JicmFja2V0fWA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGAke2N9IDxzcGFuIGNsYXNzPVwiZmlsdGVyLWZpZWxkIGZpbHRlci1jb2x1bW4tJHtyfVwiPiAke3N9IEFORCA8L3NwYW4+YDtcclxuICAgICAgICB9LCAnJyk7XHJcbiAgICAgICAgY29uc3QgbGFzdEFORGlkeCA9IHN0ci5sYXN0SW5kZXhPZignQU5EJyk7XHJcbiAgICAgICAgbGV0IHJlc3VsdFN0ciA9IHN0ci5zdWJzdHIoMCwgbGFzdEFORGlkeCk7XHJcbiAgICAgICAgcmVzdWx0U3RyICs9IHN0ci5zdWJzdHIobGFzdEFORGlkeCArIDMpO1xyXG4gICAgICAgIHJldHVybiByZXN1bHRTdHIucmVwbGFjZSgvQU5EL2csIGFuZCkucmVwbGFjZSgvT1IvZywgb3IpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0Q29tcGFyZVN0cmluZyhvcGVyYXRvcjogQ29tcGFyZSkge1xyXG4gICAgICAgIGNvbnN0IG9wID0gcGFyc2VJbnQoJycgKyBvcGVyYXRvciwgMTApO1xyXG4gICAgICAgIGxldCBjb2RlID0gJyc7XHJcbiAgICAgICAgc3dpdGNoIChvcCkge1xyXG4gICAgICAgICAgICBjYXNlIENvbXBhcmUuRXF1YWw6XHJcbiAgICAgICAgICAgIGNhc2UgQ29tcGFyZS5Ob3RFcXVhbDpcclxuICAgICAgICAgICAgY2FzZSBDb21wYXJlLkdyZWF0ZXI6XHJcbiAgICAgICAgICAgIGNhc2UgQ29tcGFyZS5HcmVhdGVyT3JFcXVhbDpcclxuICAgICAgICAgICAgY2FzZSBDb21wYXJlLkxlc3M6XHJcbiAgICAgICAgICAgIGNhc2UgQ29tcGFyZS5MZXNzT3JFcXVhbDpcclxuICAgICAgICAgICAgY2FzZSBDb21wYXJlLkxpa2U6XHJcbiAgICAgICAgICAgIGNhc2UgQ29tcGFyZS5Ob3RMaWtlOlxyXG4gICAgICAgICAgICBjYXNlIENvbXBhcmUuSW46XHJcbiAgICAgICAgICAgICAgICBjb2RlID0gQ29tcGFyZVtvcF07XHJcbiAgICAgICAgICAgICAgICBjb2RlID0gY29kZVswXS50b0xvd2VyQ2FzZSgpICsgY29kZS5zdWJzdHIoMSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5sb2NhbGVTZXIuZ2V0VmFsdWUoJ2RhdGFncmlkLmZpbHRlci5vcGVyYXRvcnMuJyArIGNvZGUpO1xyXG4gICAgICAgICAgICBjYXNlIDEwMDE6IC8vIEVtcHR5XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gJyAnICsgdGhpcy5sb2NhbGVTZXIuZ2V0VmFsdWUoJ2RhdGFncmlkLmZpbHRlci5vcGVyYXRvcnMuZW1wdHknKTtcclxuICAgICAgICAgICAgY2FzZSAxMDAyOiAgLy8gTm90RW1wdHlcclxuICAgICAgICAgICAgICAgIHJldHVybiAnICcgKyB0aGlzLmxvY2FsZVNlci5nZXRWYWx1ZSgnZGF0YWdyaWQuZmlsdGVyLm9wZXJhdG9ycy5ub3RFbXB0eScpO1xyXG4gICAgICAgICAgICBjYXNlIDEwMDM6IC8vIE51bGxcclxuICAgICAgICAgICAgICAgIHJldHVybiAnICcgKyB0aGlzLmxvY2FsZVNlci5nZXRWYWx1ZSgnZGF0YWdyaWQuZmlsdGVyLm9wZXJhdG9ycy5udWxsJyk7XHJcbiAgICAgICAgICAgIGNhc2UgMTAwNDogLy8gTm90TnVsbFxyXG4gICAgICAgICAgICAgICAgcmV0dXJuICcgJyArIHRoaXMubG9jYWxlU2VyLmdldFZhbHVlKCdkYXRhZ3JpZC5maWx0ZXIub3BlcmF0b3JzLm5vdE51bGwnKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGNvbnZlcnQyRmlsdGVyQXJyYXkoY29uZGl0aW9uOiB7IFtmaWVsZDogc3RyaW5nXTogYW55IH0pOiBGaWx0ZXJDb25kaXRpb25bXSB7XHJcbiAgICAgICAgY29uc3QgZmlsdGVyQXJyID0gW107XHJcbiAgICAgICAgaWYgKGNvbmRpdGlvbikge1xyXG4gICAgICAgICAgICBjb25zdCBmaWVsZHMgPSBPYmplY3Qua2V5cyhjb25kaXRpb24pO1xyXG4gICAgICAgICAgICBpZiAoZmllbGRzICYmIGZpZWxkcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIGZpZWxkcy5mb3JFYWNoKGZpZWxkID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBvYmogPSB7IGZpbHRlckZpZWxkOiBmaWVsZCwgdmFsdWU6ICcnLCBsYnJhY2tldDogJycsIHJicmFja2V0OiAnJywgcmVsYXRpb246IDEsIGNvbXBhcmU6IDAgfTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb25kaXRpb25WYWwgPSBjb25kaXRpb25bZmllbGRdO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgY29uZGl0aW9uVmFsID09PSAnb2JqZWN0Jykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmouY29tcGFyZSA9IGNvbmRpdGlvblZhbC5vcGVyYXRvcjE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai52YWx1ZSA9IGNvbmRpdGlvblZhbC52YWx1ZTE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlckFyci5wdXNoKG9iaik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb25kaXRpb25WYWwudmFsdWUyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoubGJyYWNrZXQgPSAnKCc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoucmVsYXRpb24gPSBjb25kaXRpb25WYWwucmVsYXRpb24gPT09ICdhbmQnID8gMSA6IDI7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgb2JqMiA9IHsgZmlsdGVyRmllbGQ6IGZpZWxkLCB2YWx1ZTogJycsIGxicmFja2V0OiAnJywgcmJyYWNrZXQ6ICcpJywgcmVsYXRpb246IDEsIGNvbXBhcmU6IDAgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iajIuY29tcGFyZSA9IGNvbmRpdGlvblZhbC5vcGVyYXRvcjI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoyLnZhbHVlID0gY29uZGl0aW9uVmFsLnZhbHVlMjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJBcnIucHVzaChvYmoyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb25kaXRpb25WYWwub3BlcmF0b3IyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3AyID0gcGFyc2VJbnQoJycgKyBjb25kaXRpb25WYWwub3BlcmF0b3IyLCAxMCk7IC8vICBFbXB0eTogMTAwMSwgTm90RW1wdHk6IDEwMDJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob3AyID09PSAxMDAxIHx8IG9wMiA9PT0gMTAwMikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoubGJyYWNrZXQgPSAnKCc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5yZWxhdGlvbiA9IGNvbmRpdGlvblZhbC5yZWxhdGlvbiA9PT0gJ2FuZCcgPyAxIDogMjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG9iajIgPSB7IGZpbHRlckZpZWxkOiBmaWVsZCwgdmFsdWU6ICcnLCBsYnJhY2tldDogJycsIHJicmFja2V0OiAnKScsIHJlbGF0aW9uOiAxLCBjb21wYXJlOiAwIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iajIuY29tcGFyZSA9IG9wMiA9PT0gMTAwMSA/IENvbXBhcmUuRXF1YWwgOiBDb21wYXJlLk5vdEVxdWFsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoyLnZhbHVlID0gJyc7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJBcnIucHVzaChvYmoyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9iajtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoZmlsdGVyQXJyLmxlbmd0aCkge1xyXG4gICAgICAgICAgICB0aGlzLmNoZWNrRW51bVR5cGVGaWx0ZXJzKGZpbHRlckFycik7XHJcbiAgICAgICAgICAgIGZpbHRlckFycltmaWx0ZXJBcnIubGVuZ3RoIC0gMV0ucmVsYXRpb24gPSAwO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGZpbHRlckFycjtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNoZWNrRW51bVR5cGVGaWx0ZXJzKGZpbHRlckFycjogRmlsdGVyQ29uZGl0aW9uW10pIHtcclxuICAgICAgICBjb25zdCBlbnVtRmlsdGVyczp7W2tleTpzdHJpbmddOiBhbnlbXX0gPSB7IH07XHJcbiAgICAgICAgZmlsdGVyQXJyLmZvckVhY2goKGYsIGkpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgZW51bUZpbHRlckFyciA9IHRoaXMuY29udmVydEVudW1UeXBlRmlsdGVyKGYpO1xyXG4gICAgICAgICAgICBpZiAoZW51bUZpbHRlckFyciAmJiBlbnVtRmlsdGVyQXJyLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgZW51bUZpbHRlcnNbZi5maWx0ZXJGaWVsZF0gPSBlbnVtRmlsdGVyQXJyXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKGVudW1GaWx0ZXJzKTtcclxuICAgICAgICBpZiAoa2V5cy5sZW5ndGgpIHtcclxuICAgICAgICAgICAga2V5cy5mb3JFYWNoKChrKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBpID0gZmlsdGVyQXJyLmZpbmRJbmRleChuID0+IG4uZmlsdGVyRmllbGQgPT09IGspO1xyXG4gICAgICAgICAgICAgICAgZmlsdGVyQXJyLnNwbGljZShpLCAxLCAuLi5lbnVtRmlsdGVyc1trXSk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gZmlsdGVyQXJyO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOWwhmVudW0g57G75Z6L55qE5p2h5Lu26L2s5o2i5aSa5Liq5p2h5Lu2XHJcbiAgICBwcml2YXRlIGNvbnZlcnRFbnVtVHlwZUZpbHRlcihmaWx0ZXI6IEZpbHRlckNvbmRpdGlvbikgOiBGaWx0ZXJDb25kaXRpb25bXSB7XHJcbiAgICAgICAgaWYgKGZpbHRlcikge1xyXG4gICAgICAgICAgICBjb25zdCBjb2wgPSB0aGlzLmRmcy5nZXRDb2x1bW4oZmlsdGVyLmZpbHRlckZpZWxkKSBhcyBEYXRhQ29sdW1uO1xyXG4gICAgICAgICAgICBpZiAoY29sICYmIGNvbC5maWx0ZXIgJiYgY29sLmZpbHRlci50eXBlID09PSAgQ29sdW1uRmlsdGVyVHlwZS5lbnVtKSAge1xyXG4gICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoZmlsdGVyLnZhbHVlKSAmJiBmaWx0ZXIudmFsdWUubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbHRlci52YWx1ZS5sZW5ndGggPT09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyLmNvbXBhcmUgPSBDb21wYXJlLkVxdWFsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXIudmFsdWUgPSBmaWx0ZXIudmFsdWVbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbXTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyA+IDFcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGZpbHRlckFyciA9IGZpbHRlci52YWx1ZS5tYXAoKHZhbDogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlckZpZWxkOiBmaWx0ZXIuZmlsdGVyRmllbGQsIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB2YWwsIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxicmFja2V0OiAnJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByYnJhY2tldDogJycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVsYXRpb246IDIsICAvLyBvclxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBhcmU6IDBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlckFyclswXS5sYnJhY2tldCA9ICcoJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyQXJyW2ZpbHRlci52YWx1ZS5sZW5ndGggLTFdLnJicmFja2V0ID0gJyknO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJBcnJbZmlsdGVyLnZhbHVlLmxlbmd0aCAtMV0ucmVsYXRpb24gPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmlsdGVyQXJyO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIFtdO1xyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZUNvbHVtbkZpbHRlck9wdGlvbnMoY29sOiBEYXRhQ29sdW1uKSB7XHJcbiAgICAgICAgbGV0IGZpbHRlclR5cGVPcHRpb25zOiBDb2x1bW5GaWx0ZXIgPSB7XHJcbiAgICAgICAgICAgIHR5cGU6IENvbHVtbkZpbHRlclR5cGUuc3RyaW5nLFxyXG4gICAgICAgICAgICBlbmFibGVPcGVyYXRvcjogdHJ1ZVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgaWYgKGNvbC5lZGl0b3IpIHtcclxuICAgICAgICAgICAgc3dpdGNoIChjb2wuZWRpdG9yLnR5cGUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgJ3RleHRhcmVhJzpcclxuICAgICAgICAgICAgICAgIGNhc2UgJ3RleHRib3gnOlxyXG4gICAgICAgICAgICAgICAgY2FzZSAnbGFuZ3VhZ2UtdGV4dGJveCc6XHJcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyVHlwZU9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IENvbHVtbkZpbHRlclR5cGUuc3RyaW5nLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbmFibGVPcGVyYXRvcjogdHJ1ZVxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdjaGVja2JveCc6XHJcbiAgICAgICAgICAgICAgICBjYXNlICdzd2l0Y2gnOlxyXG4gICAgICAgICAgICAgICAgICAgIGZpbHRlclR5cGVPcHRpb25zID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBDb2x1bW5GaWx0ZXJUeXBlLmJvb2xlYW4sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVuYWJsZU9wZXJhdG9yOiBmYWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdudW1iZXJib3gnOlxyXG4gICAgICAgICAgICAgICAgICAgIGZpbHRlclR5cGVPcHRpb25zID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBDb2x1bW5GaWx0ZXJUeXBlLm51bWJlcixcclxuICAgICAgICAgICAgICAgICAgICAgICAgZW5hYmxlT3BlcmF0b3I6IHRydWVcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnY29tYm9saXN0JzpcclxuICAgICAgICAgICAgICAgIGNhc2UgJ3NlbGVjdCc6XHJcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyVHlwZU9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IENvbHVtbkZpbHRlclR5cGUuZW51bSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZW5hYmxlT3BlcmF0b3I6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnM6IGNvbC5lZGl0b3Iub3B0aW9uc1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdkYXRlcGlja2VyJzpcclxuICAgICAgICAgICAgICAgICAgICBmaWx0ZXJUeXBlT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogY29sWydkYXRhVHlwZSddID09PSAnZGF0ZXRpbWUnID8gQ29sdW1uRmlsdGVyVHlwZS5kYXRldGltZSA6IENvbHVtbkZpbHRlclR5cGUuZGF0ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZW5hYmxlT3BlcmF0b3I6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnM6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGVGb3JtYXQ6IGNvbC5lZGl0b3Iub3B0aW9ucy5kYXRlRm9ybWF0LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuRm9ybWF0OiBjb2wuZWRpdG9yLm9wdGlvbnMucmV0dXJuRm9ybWF0XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAndGltZXBpY2tlcic6XHJcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyVHlwZU9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IENvbHVtbkZpbHRlclR5cGUudGltZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZW5hYmxlT3BlcmF0b3I6IHRydWVcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSBpZiAoY29sLmZvcm1hdHRlcikge1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIGNvbC5mb3JtYXR0ZXIgPT09ICdvYmplY3QnICYmIE9iamVjdC5rZXlzKGNvbC5mb3JtYXR0ZXIpLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgb3B0aW9uczogYW55ID0gY29sLmZvcm1hdHRlclsnb3B0aW9ucyddO1xyXG4gICAgICAgICAgICAgICAgc3dpdGNoIChjb2wuZm9ybWF0dGVyWyd0eXBlJ10pIHtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJUeXBlT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IENvbHVtbkZpbHRlclR5cGUubnVtYmVyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5hYmxlT3BlcmF0b3I6IHRydWVcclxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnZW51bSc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlclR5cGVPcHRpb25zID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogQ29sdW1uRmlsdGVyVHlwZS5lbnVtLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5hYmxlT3BlcmF0b3I6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJUeXBlT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IENvbHVtbkZpbHRlclR5cGUuYm9vbGVhbixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuYWJsZU9wZXJhdG9yOiBmYWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdkYXRldGltZSc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCB0eWUgPSBDb2x1bW5GaWx0ZXJUeXBlLmRhdGV0aW1lO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgZm10ID0gJ3l5eXktTU0tZGQnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgcmV0dXJuRm10ID0gJ3l5eXktTU0tZGQnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLmZvcm1hdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm10ID0gb3B0aW9ucy5mb3JtYXQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZm10LmluZGV4T2YoJ0hIOicpID09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHllID0gQ29sdW1uRmlsdGVyVHlwZS5kYXRlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5GbXQgKz0gJyBISDptbSc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZtdC5pbmRleE9mKCdzcycpID4gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuRm10ICs9ICc6c3MnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5ZSA9IENvbHVtbkZpbHRlclR5cGUuZGF0ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJUeXBlT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IHR5ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuYWJsZU9wZXJhdG9yOiB0cnVlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJUeXBlT3B0aW9ucy5vcHRpb25zID0geyBkYXRlRm9ybWF0OiBmbXQsIHJldHVybkZvcm1hdDogcmV0dXJuRm10IH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlclR5cGVPcHRpb25zID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogQ29sdW1uRmlsdGVyVHlwZS5zdHJpbmcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmFibGVPcGVyYXRvcjogdHJ1ZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgZmlsdGVyVHlwZU9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgICAgICB0eXBlOiBDb2x1bW5GaWx0ZXJUeXBlLnN0cmluZyxcclxuICAgICAgICAgICAgICAgIGVuYWJsZU9wZXJhdG9yOiB0cnVlXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBmaWx0ZXJUeXBlT3B0aW9ucztcclxuICAgIH1cclxuXHJcbiAgICAvLyNyZWdpb24gIFNtYXJ0IEZpbHRlclxyXG5cclxuICAgIGNvbnZlcnRTbWFydEZpbHRlcjJFbnRpdHlGaWx0ZXIoY29uZGl0aW9uczogYW55W10pIHtcclxuICAgICAgICBpZiAoY29uZGl0aW9ucyAmJiBjb25kaXRpb25zLmxlbmd0aCkge1xyXG4gICAgICAgICAgICByZXR1cm4gY29uZGl0aW9ucy5tYXAobiA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbjtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gW107XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSB2YWxpZGF0ZVJvd0RhdGEyKHJvd0RhdGE6IGFueSwgY29uZGl0aW9uczogYW55KSB7XHJcbiAgICAgICAgaWYgKCFjb25kaXRpb25zIHx8IGNvbmRpdGlvbnMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5jaGVja1Jvd0RhdGFXaXRoQ29uZGl0aW9uKHJvd0RhdGEsIGNvbmRpdGlvbnMpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY2hlY2tSb3dEYXRhV2l0aENvbmRpdGlvbihyb3dEYXRhOiBhbnksIGNvbmRpdGlvbnMpIHtcclxuICAgICAgICBsZXQgcmVzdWx0T2JqID0gbnVsbDtcclxuICAgICAgICBpZiAoY29uZGl0aW9ucykge1xyXG4gICAgICAgICAgICByZXN1bHRPYmogPSB7fTtcclxuICAgICAgICAgICAgY29uZGl0aW9ucy5mb3JFYWNoKGNvbmRpdGlvbiA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBmaWVsZCA9IGNvbmRpdGlvbi5GaWx0ZXJGaWVsZDtcclxuICAgICAgICAgICAgICAgIGxldCBmaWVsZFZhbHVlID0gVXRpbHMuZ2V0VmFsdWUoZmllbGQsIHJvd0RhdGEpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgY29sdW1uT2JqID0gdGhpcy5kZnMuZ2V0Q29sdW1uKGZpZWxkKTtcclxuICAgICAgICAgICAgICAgIGlmIChjb2x1bW5PYmogJiYgY29sdW1uT2JqLmlzTXVsdGlsaW5ndWFsRmllbGQpIHtcclxuICAgICAgICAgICAgICAgICAgICBmaWVsZFZhbHVlID0gVXRpbHMuZ2V0TXVsdGlsaW5ndWFsVmFsdWUoZmllbGRWYWx1ZSwgdGhpcy5sb2NhbGVTZXIubG9jYWxlSWQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IHdoZXJlID0gY29uZGl0aW9uO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgeyBWYWx1ZSwgUmVsYXRpb24sIENvbXBhcmU6IG9wZXJhdG9yMSB9ID0gd2hlcmU7XHJcbiAgICAgICAgICAgICAgICBpZiAod2hlcmUpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCByID0gdGhpcy5nZXRDb21wYXJlUmVzdWx0KGZpZWxkVmFsdWUsIG9wZXJhdG9yMSwgVmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHRPYmpbZmllbGRdID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0T2JqW2ZpZWxkXSA9IFsgciBdO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdE9ialtmaWVsZF0ucHVzaChyKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIHJldHVybiB0aGlzLmNoZWNrQWxsRmllbGRSZXN1bHQocmVzdWx0T2JqKTtcclxuICAgICAgICBjb25zdCBmaWVsZHMgPSBPYmplY3Qua2V5cyhyZXN1bHRPYmopO1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IFtdO1xyXG4gICAgICAgIGZpZWxkcy5mb3JFYWNoKCAoZikgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBfZmlsdGVycyA9IGNvbmRpdGlvbnMuZmlsdGVyKG4gPT4gbi5GaWx0ZXJGaWVsZCA9PT0gZik7XHJcbiAgICAgICAgICAgIGlmIChyZXN1bHRPYmpbZl0ubGVuZ3RoID09PSAxKSB7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQucHVzaChyZXN1bHRPYmpbZl1bMF0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKF9maWx0ZXJzWzBdLlJlbGF0aW9uID09PSAxICYmIHJlc3VsdE9ialtmXS5sZW5ndGggPT09IDIpIHsgIC8vIGFuZFxyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHJlc3VsdE9ialtmXVswXSAmJiByZXN1bHRPYmpbZl1bMV0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHsgIC8vIG9yXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gocmVzdWx0T2JqW2ZdLmluZGV4T2YodHJ1ZSkgPiAtMSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdC5pbmRleE9mKGZhbHNlKSA9PT0gLTE7XHJcbiAgICB9XHJcblxyXG4gICAgZXhlY3V0ZVNtYXJ0RmlsdGVyKGRhdGE6IFtdLCBjb25kaXRpb25zOiBhbnlbXSkge1xyXG4gICAgICAgIGlmIChkYXRhICYmIGRhdGEubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBkYXRhLmZpbHRlcihuID0+IHRoaXMudmFsaWRhdGVSb3dEYXRhMihuLCBjb25kaXRpb25zKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBkYXRhO1xyXG4gICAgfVxyXG5cclxuICAgIC8vI2VuZHJlZ2lvblxyXG59XHJcbiJdfQ==