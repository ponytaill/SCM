import * as tslib_1 from "tslib";
/**
 * 应用上下文
 * @author Witt<jiwt@inspur.com>
 * @todo
 * 1、parnet和AppContextManager是否必要？按理说就是应该隔离上下文，表单之间通过事件通讯进行交互；
 */
import { Injectable, Injector, Optional, SkipSelf } from '@angular/core';
import { Router } from '@angular/router';
import { Context } from '../context/index';
import { BindingData, BindingDataFactory } from '../binding-data';
import { FrameContextManager } from './frame_contex_manager';
import { FrameComponentRefresher } from './frame_component_refresher';
import { RepositoryManager } from './repository_mananger';
import { BindingDataManager } from './binding_data_manager';
import { ChangeDetectionController } from './change_detection_controller';
import { AppContextManager } from './app_context_manager';
import { Subject } from 'rxjs';
import { ComponentManager } from './component_manager';
import { UID } from '../misc/uid';
import { FORM_ID } from './tokens';
import { ContextMetadataBuilder } from './app_metadata_collector';
import { StateMachine } from '../state-machine';
import { CommandVariableParser, DataVariableParser, FrameIdVariableParser, StateMachineVariableParser, UIStateVariableParser, VariableParseService } from '../variable';
import { ViewModelManager } from './view_model_manager';
import { Repository } from '../repository';
import { UIState } from '../ui-state';
import { ContextMetadataManager } from './render_context_metadata_manager';
import { Form } from '../form';
import { ViewModel } from '../view-model';
import { FrameContext } from '../frame/frame_context';
import { NAMESPACE, FRAME_ID } from '../frame/tokens';
import { DEVKIT_RUN_MODE, RunMode } from '../core';
import { RunModeService } from '../misc/run_mode_service';
var AppContext = /** @class */ (function (_super) {
    tslib_1.__extends(AppContext, _super);
    /**
     * 构造函数
     */
    function AppContext(injector, appContextManager, parent) {
        var _this = _super.call(this) || this;
        _this.typeName = 'AppContext';
        /**
         * 是否已经销毁
         */
        _this.isFormDestoryed = false;
        /**
         * 应用程序标识
         */
        _this.applicationId = null;
        _this.token = null;
        /**
         * 是否使用独立的eventBus
         * @memberof AppContext
         */
        _this.useIsoluteEventBus = false;
        /**
         * 应用上下文元数据描述
         */
        _this.metadata = {};
        _this.disposed = false;
        _this.destorySignal = new Subject();
        _this.injector = injector;
        _this.appContextManager = appContextManager;
        _this.formId = _this.injector && _this.injector.get(FORM_ID, null) || null;
        // 默认运行模式为兼容模式
        _this.runMode = _this.injector && _this.injector.get(DEVKIT_RUN_MODE, RunMode.compatible) || RunMode.compatible;
        RunModeService.setRunMode(_this.runMode);
        _this.params.set('formId', _this.formId);
        _this.params.set('appId', _this.ApplicationId);
        _this.params.set('token', _this.Token);
        // 确定父子关系
        if (!parent) {
            _this.parent = null;
            _this.root = _this;
        }
        else {
            _this.parent = parent;
            _this.root = parent.root;
        }
        _this.registerToManager();
        _this.frameContextManager = new FrameContextManager(_this);
        _this.frameComponentRefresher = new FrameComponentRefresher();
        _this.repositoryManager = new RepositoryManager();
        _this.bindingDataManager = new BindingDataManager();
        _this.changeDetectionController = new ChangeDetectionController(_this.frameContextManager);
        _this.messagePipe = new Subject();
        _this.componentRefs = new Map();
        _this.componentManager = new ComponentManager(_this);
        _this.contextMetadataManager = new ContextMetadataManager();
        _this.opened = false;
        // this.sortConditionManager = new SortConditionManager();
        // this.filterConditionManager = new FilterConditionManager();
        _this.router = _this.injector && _this.injector.get(Router);
        _this.viewModelManager = new ViewModelManager();
        _this.contextMetadataBuilder = new ContextMetadataBuilder();
        _this.variableParseService = new VariableParseService([
            new FrameIdVariableParser(),
            new DataVariableParser(),
            new UIStateVariableParser(),
            new StateMachineVariableParser(),
            new CommandVariableParser()
        ]);
        return _this;
    }
    Object.defineProperty(AppContext.prototype, "frameContexts", {
        /**
         * 已废弃：请使用FrameContextManager的getFrameContextMap方法代替。
         * @deprecated
         * @summary
         * 已经有运行时直接用中括号访问该属性的场景，虽然是private，但要进行兼容。
         */
        get: function () {
            return this.frameContextManager.getFrameContextMap();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(AppContext.prototype, "formModule", {
        get: function () {
            return this.formMetadataContent ? this.formMetadataContent.module : null;
        },
        enumerable: true,
        configurable: true
    });
    AppContext.prototype.dispose = function (options) {
        if (this.disposed) {
            return;
        }
        this.isFormDestoryed = true;
        this.disposed = true;
        this.router = null;
        this.unregisterFromManager();
        this.componentRefs.clear();
        if (this.stateMachine) {
            this.stateMachine.dispose();
            this.stateMachine = null;
        }
        this.frameComponentRefresher.dispose();
        this.frameContextManager.dispose();
        this.repositoryManager.dispose();
        this.viewModelManager.dispose();
        this.bindingDataManager.dispose();
        if (this.messagePipe) {
            this.messagePipe.complete();
            this.messagePipe = null;
        }
        this.injector = null;
        if (this.destorySignal) {
            this.destorySignal.next();
            this.destorySignal.complete();
        }
    };
    AppContext.prototype.ngOnDestroy = function () {
        this.dispose();
    };
    /**
     * 由表单元数据、状态机元数据、前端构件元数据初始化解析型应用上下文
     * @param formMetadataContent 表单元数据
     * @param stateMachineMetadata 状态机元数据
     * @param controllers 前端构件元数据
     */
    AppContext.prototype.initializeByMetadata = function (formMetadataContent, stateMachineMetadata, controllers, options) {
        this.metadata = this.contextMetadataBuilder.buildAppContextMetadata(formMetadataContent, stateMachineMetadata);
        if (!this.stateMachine) {
            // 避免由于组合表单，获取到父级状态机实例的问题
            // this.stateMachine = this.injector.get(StateMachine, new StateMachine());
            this.stateMachine = new StateMachine();
        }
        this.formMetadataContent = formMetadataContent;
        this.controllers = controllers;
        this.dynamicOptions = options;
    };
    /**
     * Register current AppContext instance to AppContextManager
     */
    AppContext.prototype.registerToManager = function () {
        if (!this.appContextManager) {
            return;
        }
        this.appContextManager.registerAppContext(this);
    };
    /**
     * Unregister current AppContext instance from AppContextManager
     */
    AppContext.prototype.unregisterFromManager = function () {
        if (!this.appContextManager) {
            return;
        }
        this.appContextManager.unregisterAppContext(this);
    };
    /**
     * 注册FrameContext
     */
    AppContext.prototype.regFrameContext = function (frameContext) {
        var repository = frameContext.repository;
        var repositoryName = repository.name;
        // Repository
        if (this.repositoryManager.ifRepositoryExits(repositoryName) === false) {
            this.repositoryManager.regRepository(repositoryName, repository);
        }
        // BindingData
        if (this.bindingDataManager.ifBindingDataExits(repositoryName) === false) {
            var bindingData = null;
            // 仅高速模式下使用bindingDataManager
            if (this.runMode === RunMode.highSpeed) {
                bindingData = BindingDataFactory.createFromRepository(repository, '/');
                this.bindingDataManager.regBindingData(repositoryName, bindingData);
            }
        }
        // 考虑路由再次进入的时候，AppContext没有被注销，但Component被再次构造的场景
        this.frameContextManager.regFrameContext(frameContext);
    };
    AppContext.prototype.regContextMetadata = function (componentId, contextMetadata) {
        if (!this.contextMetadataManager.exsit(componentId)) {
            this.contextMetadataManager.register(componentId, contextMetadata);
        }
    };
    /**
     * 获取整个表单的AppContext
     */
    AppContext.prototype.getFormAppContext = function () {
        return this;
    };
    /**
     * 销毁表单
     * @todo: 临时解决表单关闭后对象没有销毁亦获取不到销毁时机的问题,应依赖angular本身的销毁机制
     */
    AppContext.prototype.destory = function () {
        this.dispose();
    };
    Object.defineProperty(AppContext.prototype, "isDestoryed", {
        get: function () {
            return this.isFormDestoryed;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(AppContext.prototype, "ApplicationId", {
        /**
         * 应用id
         */
        get: function () {
            if (!!this.applicationId) {
                return this.applicationId;
            }
            this.applicationId = UID.create();
            return this.applicationId;
        },
        set: function (appId) {
            this.applicationId = appId;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(AppContext.prototype, "Token", {
        get: function () {
            if (!!this.token) {
                return this.token;
            }
            this.token = UID.create();
            return this.token;
        },
        set: function (token) {
            this.token = token;
        },
        enumerable: true,
        configurable: true
    });
    // #region 弃用的老方法
    /**
     * 已废弃：请使用FrameComponentRefresher的refreshComponent方法代替。
     * @deprecated
     */
    AppContext.prototype.registerCommandHandler = function (frameId, component) {
        this.frameComponentRefresher.regFrameComponent(frameId, component);
    };
    /**
     * 已废弃：请使用FrameComponentRefresher的refreshComponent方法代替。
     * @deprecated
     */
    AppContext.prototype.refresh = function () {
        this.frameComponentRefresher.refreshComponents();
    };
    /**
     * 已废弃：请使用FrameContextManager的getFrameContextById方法代替。
     * @deprecated
     */
    AppContext.prototype.getFrameContext = function (frameId) {
        return this.frameContextManager.getFrameContextById(frameId);
    };
    AppContext.prototype.getContextById = function (identify) {
        var context = this.frameContextManager.getFrameContextById(identify);
        return context;
    };
    /**
     * 已废弃：请使用FrameContextManager的getFrameContextMap方法代替。
     * @deprecated
     */
    AppContext.prototype.getAllFrameContexts = function () {
        return this.frameContextManager.getFrameContextMap();
    };
    /**
     * 处理行变更
     */
    AppContext.prototype.handleSelectChange = function (change, srcFrameContext) {
        var force = change.force || false;
        this.frameContexts.forEach(function (targetFrameContext) {
            // 相同的FrameCotnext或者Repository不一致的情况下，不同步
            if (targetFrameContext === srcFrameContext
                || targetFrameContext.repository !== srcFrameContext.repository) {
                return;
            }
            var bindingData = targetFrameContext.bindingData;
            var bindingList = bindingData.getValue(change.path);
            var currentId = change.value['id'];
            if (bindingList && bindingList.currentId !== currentId || force) {
                // 设置当前行，但不对外广播
                bindingList.setCurrentId(currentId, true, false, force);
            }
        });
    };
    // #endregion
    AppContext.prototype.buildRenderViewContext = function (componentId) {
        // 提取视图模型集合
        var viewModels = this.formModule.viewmodels;
        // 提取组件描述集合
        var viewComponents = this.formModule.components;
        // 提取schema节点
        var schema = this.formModule.schemas[0];
        // 查找匹配指定标识的组件节点
        var matchedComponent = viewComponents.find(function (component) { return component.id === componentId; });
        // 匹配指定组件的视图模型节点
        var matchedViewModel = viewModels.find(function (viewModel) { return matchedComponent.viewModel === viewModel.id; });
        // 查找匹配视图模型的父节点
        var parentViewModel = viewModels.find(function (viewModel) { return viewModel.id === matchedViewModel.parent; });
        var parentComponentId = '';
        // 如果匹配上上级视图模型，提上级视图标识
        if (parentViewModel) {
            var parentComponent = viewComponents.find(function (component) { return component.viewModel === parentViewModel.id; });
            if (parentComponent) {
                parentComponentId = parentComponent.id;
            }
        }
        // 如果存在上级组件，提取器上下文对象。
        // const parentViewContext = parentComponentId ? this.getContextById(parentComponentId) : null;
        // this.buildRenderViewContextRecursively(matchedViewModel, parentViewContext, schema);
        this.buildRenderViewContextRecursively(matchedViewModel, schema);
    };
    AppContext.prototype.buildRenderViewContextRecursively = function (viewModel, schema) {
        var _this = this;
        var controllers = this.controllers;
        var viewComponents = this.formModule.components;
        var matchedComponent = viewComponents.find(function (component) { return component.viewModel === viewModel.id; });
        var contextMetadata = this.contextMetadataBuilder.buildViewContextMetadata(matchedComponent, viewModel, schema, controllers, this.dynamicOptions);
        // const commandHandlers: CommandHandler[] = this.buildCommandHandlers(viewModel.commands, controllers);
        // const commandHandlerExtends: CommandHandlerExtender[] = [];
        // const viewContext = new ViewComponentContext();
        //   contextMetadata,
        //   this,
        //   parent,
        //   this.injector
        // );
        // this.regFrameContext(viewContext);
        // viewContext.init();
        var contextMetadataId = (this.namespace ? (this.namespace + '_') : '') + matchedComponent.id;
        contextMetadata.namespace = this.namespace || '';
        this.regContextMetadata(contextMetadataId, contextMetadata);
        var viewModels = this.formModule.viewmodels;
        var subViewModels = viewModels.filter(function (subViewModel) { return subViewModel.parent === viewModel.id; });
        if (subViewModels && subViewModels.length) {
            subViewModels.forEach(function (subViewModel) {
                _this.buildRenderViewContextRecursively(subViewModel, schema);
            });
        }
    };
    AppContext.prototype.getComponentProviders = function (componentId) {
        var contextMetadata = this.contextMetadataManager.getContextMetadataByName(componentId);
        var bindingData = new BindingData();
        var form = new Form();
        var namespace = contextMetadata.namespace;
        var repository = this.repository || this.injector.get(Repository, null);
        var stateMachine = this.stateMachine;
        var uiState = new UIState();
        var viewModel = new ViewModel();
        viewModel.setMetadata(contextMetadata);
        return [
            { provide: FRAME_ID, useValue: componentId },
            { provide: NAMESPACE, useValue: namespace },
            { provide: FrameContext, useClass: FrameContext },
            { provide: AppContext, useValue: this },
            { provide: BindingData, useValue: bindingData },
            { provide: Form, useValue: form },
            { provide: Repository, useValue: repository },
            { provide: StateMachine, useValue: stateMachine },
            { provide: UIState, useValue: uiState },
            { provide: ViewModel, useValue: viewModel },
            {
                provide: VariableParseService, useValue: new VariableParseService([
                    new FrameIdVariableParser(),
                    new DataVariableParser(),
                    new UIStateVariableParser(),
                    new StateMachineVariableParser(),
                    new CommandVariableParser()
                ])
            }
        ];
    };
    AppContext.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    AppContext.ctorParameters = function () { return [
        { type: Injector, decorators: [{ type: Optional }] },
        { type: AppContextManager, decorators: [{ type: Optional }] },
        { type: AppContext, decorators: [{ type: Optional }, { type: SkipSelf }] }
    ]; };
    return AppContext;
}(Context));
export { AppContext };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwX2NvbnRleHQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2RldmtpdC8iLCJzb3VyY2VzIjpbImxpYi9hcHAvYXBwX2NvbnRleHQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOzs7OztHQUtHO0FBQ0gsT0FBTyxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBMEIsTUFBTSxlQUFlLENBQUM7QUFDakcsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ3pDLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUMzQyxPQUFPLEVBQUUsV0FBVyxFQUFFLGtCQUFrQixFQUF1QixNQUFNLGlCQUFpQixDQUFDO0FBQ3ZGLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQzdELE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBQ3RFLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQzFELE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQzVELE9BQU8sRUFBRSx5QkFBeUIsRUFBRSxNQUFNLCtCQUErQixDQUFDO0FBQzFFLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQzFELE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDL0IsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDdkQsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLGFBQWEsQ0FBQztBQUNsQyxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sVUFBVSxDQUFDO0FBQ25DLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBR2xFLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUVoRCxPQUFPLEVB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aG9yIFdpdHQ8aml3dEBpbnNwdXIuY29tPlxyXG4gKiBAdG9kb1xyXG4gKiAx44CBcGFybmV05ZKMQXBwQ29udGV4dE1hbmFnZXLmmK/lkKblv4XopoHvvJ/mjInnkIbor7TlsLHmmK/lupTor6XpmpTnprvkuIrkuIvmlofvvIzooajljZXkuYvpl7TpgJrov4fkuovku7bpgJrorq/ov5vooYzkuqTkupLvvJtcclxuICovXHJcbmltcG9ydCB7IEluamVjdGFibGUsIEluamVjdG9yLCBPcHRpb25hbCwgU2tpcFNlbGYsIEluamVjdEZsYWdzLCBPbkRlc3Ryb3kgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgUm91dGVyIH0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcclxuaW1wb3J0IHsgQ29udGV4dCB9IGZyb20gJy4uL2NvbnRleHQvaW5kZXgnO1xyXG5pbXBvcnQgeyBCaW5kaW5nRGF0YSwgQmluZGluZ0RhdGFGYWN0b3J5LCBCaW5kaW5nTGlzdCwgQ2hhbmdlIH0gZnJvbSAnLi4vYmluZGluZy1kYXRhJztcclxuaW1wb3J0IHsgRnJhbWVDb250ZXh0TWFuYWdlciB9IGZyb20gJy4vZnJhbWVfY29udGV4X21hbmFnZXInO1xyXG5pbXBvcnQgeyBGcmFtZUNvbXBvbmVudFJlZnJlc2hlciB9IGZyb20gJy4vZnJhbWVfY29tcG9uZW50X3JlZnJlc2hlcic7XHJcbmltcG9ydCB7IFJlcG9zaXRvcnlNYW5hZ2VyIH0gZnJvbSAnLi9yZXBvc2l0b3J5X21hbmFuZ2VyJztcclxuaW1wb3J0IHsgQmluZGluZ0RhdGFNYW5hZ2VyIH0gZnJvbSAnLi9iaW5kaW5nX2RhdGFfbWFuYWdlcic7XHJcbmltcG9ydCB7IENoYW5nZURldGVjdGlvbkNvbnRyb2xsZXIgfSBmcm9tICcuL2NoYW5nZV9kZXRlY3Rpb25fY29udHJvbGxlcic7XHJcbmltcG9ydCB7IEFwcENvbnRleHRNYW5hZ2VyIH0gZnJvbSAnLi9hcHBfY29udGV4dF9tYW5hZ2VyJztcclxuaW1wb3J0IHsgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBDb21wb25lbnRNYW5hZ2VyIH0gZnJvbSAnLi9jb21wb25lbnRfbWFuYWdlcic7XHJcbmltcG9ydCB7IFVJRCB9IGZyb20gJy4uL21pc2MvdWlkJztcclxuaW1wb3J0IHsgRk9STV9JRCB9IGZyb20gJy4vdG9rZW5zJztcclxuaW1wb3J0IHsgQ29udGV4dE1ldGFkYXRhQnVpbGRlciB9IGZyb20gJy4vYXBwX21ldGFkYXRhX2NvbGxlY3Rvcic7XHJcbmltcG9ydCB7IEZvcm1Nb2R1bGUsIElGb3JtVmlld01vZGVsLCBJU3RhdGVNYWNoaW5lIH0gZnJvbSAnLi4vc2NoZW1hL2Zvcm0tbWV0YWRhdGEnO1xyXG5pbXBvcnQgeyBDb21tYW5kQ29udHJvbGxlciB9IGZyb20gJy4uL2NvbW1hbmQnO1xyXG5pbXBvcnQgeyBTdGF0ZU1hY2hpbmUgfSBmcm9tICcuLi9zdGF0ZS1tYWNoaW5lJztcclxuaW1wb3J0IHsgSUNvbnRleHRNZXRhZGF0YSB9IGZyb20gJy4vYXBwX21ldGFkYXRhJztcclxuaW1wb3J0IHtcclxuICBDb21tYW5kVmFyaWFibGVQYXJzZXIsIERhdGFWYXJpYWJsZVBhcnNlciwgRnJhbWVJZFZhcmlhYmxlUGFyc2VyLFxyXG4gIFN0YXRlTWFjaGluZVZhcmlhYmxlUGFyc2VyLCBVSVN0YXRlVmFyaWFibGVQYXJzZXIsIFZhcmlhYmxlUGFyc2VTZXJ2aWNlXHJcbn0gZnJvbSAnLi4vdmFyaWFibGUnO1xyXG5pbXBvcnQgeyBWaWV3TW9kZWxNYW5hZ2VyIH0gZnJvbSAnLi92aWV3X21vZGVsX21hbmFnZXInO1xyXG5pbXBvcnQgeyBSZXBvc2l0b3J5IH0gZnJvbSAnLi4vcmVwb3NpdG9yeSc7XHJcbmltcG9ydCB7IEVudGl0eSB9IGZyb20gJy4uL2VudGl0eSc7XHJcbmltcG9ydCB7IFVJU3RhdGUgfSBmcm9tICcuLi91aS1zdGF0ZSc7XHJcbmltcG9ydCB7IFNjaGVtYSB9IGZyb20gJy4uL3NjaGVtYSc7XHJcbmltcG9ydCB7IENvbnRleHRNZXRhZGF0YU1hbmFnZXIgfSBmcm9tICcuL3JlbmRlcl9jb250ZXh0X21ldGFkYXRhX21hbmFnZXInO1xyXG5pbXBvcnQgeyBGb3JtIH0gZnJvbSAnLi4vZm9ybSc7XHJcbmltcG9ydCB7IFZpZXdNb2RlbCB9IGZyb20gJy4uL3ZpZXctbW9kZWwnO1xyXG5pbXBvcnQgeyBGcmFtZUNvbnRleHQgfSBmcm9tICcuLi9mcmFtZS9mcmFtZV9jb250ZXh0JztcclxuaW1wb3J0IHsgTkFNRVNQQUNFLCBGUkFNRV9JRCB9IGZyb20gJy4uL2ZyYW1lL3Rva2Vucyc7XHJcbmltcG9ydCB7IEV2ZW50QnVzIH0gZnJvbSAnLi4vZXZlbnQtYnVzLW5ldyc7XHJcbmltcG9ydCB7IERFVktJVF9SVU5fTU9ERSwgUnVuTW9kZSB9IGZyb20gJy4uL2NvcmUnO1xyXG5pbXBvcnQgeyBSdW5Nb2RlU2VydmljZSB9IGZyb20gJy4uL21pc2MvcnVuX21vZGVfc2VydmljZSc7XHJcbmltcG9ydCB7IElEaXNwb3NhYmxlIH0gZnJvbSAnLi4vY29yZSc7XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmNsYXNzIEFwcENvbnRleHQgZXh0ZW5kcyBDb250ZXh0IGltcGxlbWVudHMgT25EZXN0cm95LCBJRGlzcG9zYWJsZSB7XHJcbiAgcHVibGljIHR5cGVOYW1lID0gJ0FwcENvbnRleHQnO1xyXG4gIC8qKlxyXG4gICAqIOazqOWFpeWZqFxyXG4gICAqL1xyXG4gIHB1YmxpYyBpbmplY3RvcjogSW5qZWN0b3I7XHJcbiAgLyoqXHJcbiAgICog5qC55bqU55So5LiK5LiL5paHXHJcbiAgICovXHJcbiAgcHVibGljIHJvb3Q6IEFwcENvbnRleHQ7XHJcbiAgLyoqXHJcbiAgICog5LiK57qn5bqU55So5LiK5LiL5paHXHJcbiAgICovXHJcbiAgcHVibGljIHBhcmVudDogQXBwQ29udGV4dDtcclxuICAvKipcclxuICAgKiDlupTnlKjkuIrkuIvmlofnrqHnkIblmahcclxuICAgKi9cclxuICBwdWJsaWMgYXBwQ29udGV4dE1hbmFnZXI6IEFwcENvbnRleHRNYW5hZ2VyO1xyXG4gIC8qKlxyXG4gICAqIEZyYW1lQ29udGV4dOeuoeeQhuWZqFxyXG4gICAqL1xyXG4gIHB1YmxpYyBmcmFtZUNvbnRleHRNYW5hZ2VyOiBGcmFtZUNvbnRleHRNYW5hZ2VyO1xyXG4gIC8qKlxyXG4gICAqIEZyYW1lQ29tcG9uZW505Yi35paw5ZmoXHJcbiAgICovXHJcbiAgcHVibGljIGZyYW1lQ29tcG9uZW50UmVmcmVzaGVyOiBGcmFtZUNvbXBvbmVudFJlZnJlc2hlcjtcclxuICAvKipcclxuICAgKiBSZXBvc2l0b3J5566h55CG5ZmoXHJcbiAgICovXHJcbiAgcHVibGljIHJlcG9zaXRvcnlNYW5hZ2VyOiBSZXBvc2l0b3J5TWFuYWdlcjtcclxuICAvKipcclxuICAgKiDnu5HlrprmlbDmja7nrqHnkIblmahcclxuICAgKi9cclxuICBwdWJsaWMgYmluZGluZ0RhdGFNYW5hZ2VyOiBCaW5kaW5nRGF0YU1hbmFnZXI7XHJcbiAgLyoqXHJcbiAgICog6KeG5Zu+5qih5Z6L566h55CG5ZmoXHJcbiAgICovXHJcbiAgcHVibGljIHZpZXdNb2RlbE1hbmFnZXI6IFZpZXdNb2RlbE1hbmFnZXI7XHJcblxyXG4gIHB1YmxpYyBjb250ZXh0TWV0YWRhdGFNYW5hZ2VyOiBDb250ZXh0TWV0YWRhdGFNYW5hZ2VyO1xyXG4gIC8qKlxyXG4gICAqIOWPmOabtOajgOa1i+aOp+WItuWZqFxyXG4gICAqL1xyXG4gIHB1YmxpYyBjaGFuZ2VEZXRlY3Rpb25Db250cm9sbGVyOiBDaGFuZ2VEZXRlY3Rpb25Db250cm9sbGVyO1xyXG4gIC8qKlxyXG4gICAqIOaYr+WQpuW3sue7j+mUgOavgVxyXG4gICAqL1xyXG4gIHB1YmxpYyBpc0Zvcm1EZXN0b3J5ZWQgPSBmYWxzZTtcclxuICAvKipcclxuICAgKiDlupTnlKjnqIvluo/moIfor4ZcclxuICAgKi9cclxuICBwdWJsaWMgYXBwbGljYXRpb25JZDogc3RyaW5nID0gbnVsbDtcclxuXHJcbiAgcHJpdmF0ZSB0b2tlbjogc3RyaW5nID0gbnVsbDtcclxuICAvKipcclxuICAgKiDmmK/lkKbkvb/nlKjni6znq4vnmoRldmVudEJ1c1xyXG4gICAqIEBtZW1iZXJvZiBBcHBDb250ZXh0XHJcbiAgICovXHJcbiAgcHVibGljIHVzZUlzb2x1dGVFdmVudEJ1cyA9IGZhbHNlO1xyXG5cclxuICAvKipcclxuICAgKiDni6znq4vnmoRldmVudEJ1c+WunuS+i1xyXG4gICAqXHJcbiAgICogQHR5cGUge0V2ZW50QnVzfVxyXG4gICAqIEBtZW1iZXJvZiBBcHBDb250ZXh0XHJcbiAgICovXHJcbiAgcHVibGljIGlzb2x1dGVFdmVudEJ1czogRXZlbnRCdXM7XHJcbiAgLyoqXHJcbiAgICog5bey5bqf5byD77ya6K+35L2/55SoRnJhbWVDb250ZXh0TWFuYWdlcueahGdldEZyYW1lQ29udGV4dE1hcOaWueazleS7o+abv+OAglxyXG4gICAqIEBkZXByZWNhdGVkXHJcbiAgICogQHN1bW1hcnlcclxuICAgKiDlt7Lnu4/mnInov5DooYzml7bnm7TmjqXnlKjkuK3mi6zlj7forr/pl67or6XlsZ7mgKfnmoTlnLrmma/vvIzomb3nhLbmmK9wcml2YXRl77yM5L2G6KaB6L+b6KGM5YW85a6544CCXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXQgZnJhbWVDb250ZXh0cygpOiBNYXA8c3RyaW5nLCBhbnk+IHtcclxuICAgIHJldHVybiB0aGlzLmZyYW1lQ29udGV4dE1hbmFnZXIuZ2V0RnJhbWVDb250ZXh0TWFwKCk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOa2iOaBr+euoemBk1xyXG4gICAqL1xyXG4gIHB1YmxpYyBtZXNzYWdlUGlwZTogU3ViamVjdDxhbnk+O1xyXG4gIC8qKlxyXG4gICAqIOihqOWNlUlkXHJcbiAgICovXHJcbiAgcHVibGljIGZvcm1JZDogc3RyaW5nO1xyXG4gIC8qKlxyXG4gICAqIOe7hOS7tuWunuS+i+aVsOe7hFxyXG4gICAqL1xyXG4gIHB1YmxpYyBjb21wb25lbnRSZWZzOiBNYXA8c3RyaW5nLCBNYXA8c3RyaW5nLCBhbnk+PjtcclxuICAvKipcclxuICAgKiDop4blm77nu4Tku7bnrqHnkIblmahcclxuICAgKi9cclxuICBwdWJsaWMgY29tcG9uZW50TWFuYWdlcjogQ29tcG9uZW50TWFuYWdlcjtcclxuICAvKipcclxuICAgKiDorrDlvZVjb25maXJt5by556qX5piv5ZCm5omT5byAXHJcbiAgICovXHJcbiAgcHVibGljIG9wZW5lZDogYm9vbGVhbjtcclxuICAvKipcclxuICAgKiDmjpLluo/mnaHku7bnrqHnkIblmahcclxuICAgKi9cclxuICAvLyBwdWJsaWMgc29ydENvbmRpdGlvbk1hbmFnZXI6IFNvcnRDb25kaXRpb25NYW5hZ2VyO1xyXG4gIC8qKlxyXG4gICAqIOi/h+a7pOadoeS7tueuoeeQhuWZqFxyXG4gICAqL1xyXG4gIC8vIHB1YmxpYyBmaWx0ZXJDb25kaXRpb25NYW5hZ2VyOiBGaWx0ZXJDb25kaXRpb25NYW5hZ2VyO1xyXG5cclxuICBwcm90ZWN0ZWQgY29udGV4dE1ldGFkYXRhQnVpbGRlcjogQ29udGV4dE1ldGFkYXRhQnVpbGRlcjtcclxuICAvKipcclxuICAgKiDlupTnlKjkuIrkuIvmloflhYPmlbDmja7mj4/ov7BcclxuICAgKi9cclxuICBwdWJsaWMgbWV0YWRhdGE6IElDb250ZXh0TWV0YWRhdGEgPSB7fTtcclxuICAvKipcclxuICAgKiDlupTnlKjnqIvluo/kuIrkuIvmloflhajlsYDnirbmgIFcclxuICAgKi9cclxuICBwdWJsaWMgdWlTdGF0ZTogVUlTdGF0ZTtcclxuICAvKipcclxuICAgKiDlrp7kvZPku5PlupNcclxuICAgKi9cclxuICBwdWJsaWMgcmVwb3NpdG9yeTogUmVwb3NpdG9yeTxFbnRpdHk+O1xyXG5cclxuICAvKipcclxuICAgKiDnirbmgIHmnLpcclxuICAgKi9cclxuICBwdWJsaWMgc3RhdGVNYWNoaW5lOiBTdGF0ZU1hY2hpbmU7XHJcblxyXG4gIHB1YmxpYyB2YXJpYWJsZVBhcnNlU2VydmljZTogVmFyaWFibGVQYXJzZVNlcnZpY2U7XHJcblxyXG4gIHB1YmxpYyBuYW1lc3BhY2U6IHN0cmluZztcclxuXHJcbiAgcHVibGljIHJvdXRlcjogUm91dGVyO1xyXG5cclxuICBwdWJsaWMgZm9ybU1ldGFkYXRhQ29udGVudDogYW55O1xyXG4gIC8qKlxyXG4gICAqIOaOp+WItuWZqOi/kOihjOaooeW8j++8jOaUr+aMgWNvbXBhdGlibGUgfCBoaWdoU3BlZWRcclxuICAgKi9cclxuICBwdWJsaWMgcnVuTW9kZTogUnVuTW9kZTtcclxuXHJcbiAgcHVibGljIGdldCBmb3JtTW9kdWxlKCk6IEZvcm1Nb2R1bGUge1xyXG4gICAgcmV0dXJuIHRoaXMuZm9ybU1ldGFkYXRhQ29udGVudCA/IHRoaXMuZm9ybU1ldGFkYXRhQ29udGVudC5tb2R1bGUgOiBudWxsO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGNvbnRyb2xsZXJzOiB7IFtpZDogc3RyaW5nXTogQ29tbWFuZENvbnRyb2xsZXIgfTtcclxuXHJcbiAgLyoqXHJcbiAgICog5bqU55So5LiK5LiL5paH6ZSA5q+B5L+h5Y+3XHJcbiAgICovXHJcbiAgcHVibGljIGRlc3RvcnlTaWduYWw6IFN1YmplY3Q8YW55PjtcclxuICBwdWJsaWMgZGlzcG9zZWQ6IGJvb2xlYW4gPSBmYWxzZTtcclxuXHJcbiAgcHJpdmF0ZSBkeW5hbWljT3B0aW9uczogYW55O1xyXG5cclxuICAvKipcclxuICAgKiDmnoTpgKDlh73mlbBcclxuICAgKi9cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIEBPcHRpb25hbCgpIGluamVjdG9yOiBJbmplY3RvcixcclxuICAgIEBPcHRpb25hbCgpIGFwcENvbnRleHRNYW5hZ2VyOiBBcHBDb250ZXh0TWFuYWdlcixcclxuICAgIEBPcHRpb25hbCgpIEBTa2lwU2VsZigpIHBhcmVudDogQXBwQ29udGV4dFxyXG4gICkge1xyXG4gICAgc3VwZXIoKTtcclxuICAgIHRoaXMuZGVzdG9yeVNpZ25hbCA9IG5ldyBTdWJqZWN0PGFueT4oKTtcclxuICAgIHRoaXMuaW5qZWN0b3IgPSBpbmplY3RvcjtcclxuICAgIHRoaXMuYXBwQ29udGV4dE1hbmFnZXIgPSBhcHBDb250ZXh0TWFuYWdlcjtcclxuICAgIHRoaXMuZm9ybUlkID0gdGhpcy5pbmplY3RvciAmJiB0aGlzLmluamVjdG9yLmdldChGT1JNX0lELCBudWxsKSB8fCBudWxsO1xyXG4gICAgLy8g6buY6K6k6L+Q6KGM5qih5byP5Li65YW85a655qih5byPXHJcbiAgICB0aGlzLnJ1bk1vZGUgPSB0aGlzLmluamVjdG9yICYmIHRoaXMuaW5qZWN0b3IuZ2V0PFJ1bk1vZGU+KERFVktJVF9SVU5fTU9ERSwgUnVuTW9kZS5jb21wYXRpYmxlKSB8fCBSdW5Nb2RlLmNvbXBhdGlibGU7XHJcbiAgICBSdW5Nb2RlU2VydmljZS5zZXRSdW5Nb2RlKHRoaXMucnVuTW9kZSk7XHJcbiAgICB0aGlzLnBhcmFtcy5zZXQoJ2Zvcm1JZCcsIHRoaXMuZm9ybUlkKTtcclxuICAgIHRoaXMucGFyYW1zLnNldCgnYXBwSWQnLCB0aGlzLkFwcGxpY2F0aW9uSWQpO1xyXG4gICAgdGhpcy5wYXJhbXMuc2V0KCd0b2tlbicsIHRoaXMuVG9rZW4pO1xyXG4gICAgLy8g56Gu5a6a54i25a2Q5YWz57O7XHJcbiAgICBpZiAoIXBhcmVudCkge1xyXG4gICAgICB0aGlzLnBhcmVudCA9IG51bGw7XHJcbiAgICAgIHRoaXMucm9vdCA9IHRoaXM7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLnBhcmVudCA9IHBhcmVudDtcclxuICAgICAgdGhpcy5yb290ID0gcGFyZW50LnJvb3Q7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5yZWdpc3RlclRvTWFuYWdlcigpO1xyXG5cclxuICAgIHRoaXMuZnJhbWVDb250ZXh0TWFuYWdlciA9IG5ldyBGcmFtZUNvbnRleHRNYW5hZ2VyKHRoaXMpO1xyXG4gICAgdGhpcy5mcmFtZUNvbXBvbmVudFJlZnJlc2hlciA9IG5ldyBGcmFtZUNvbXBvbmVudFJlZnJlc2hlcigpO1xyXG4gICAgdGhpcy5yZXBvc2l0b3J5TWFuYWdlciA9IG5ldyBSZXBvc2l0b3J5TWFuYWdlcigpO1xyXG4gICAgdGhpcy5iaW5kaW5nRGF0YU1hbmFnZXIgPSBuZXcgQmluZGluZ0RhdGFNYW5hZ2VyKCk7XHJcbiAgICB0aGlzLmNoYW5nZURldGVjdGlvbkNvbnRyb2xsZXIgPSBuZXcgQ2hhbmdlRGV0ZWN0aW9uQ29udHJvbGxlcih0aGlzLmZyYW1lQ29udGV4dE1hbmFnZXIpO1xyXG4gICAgdGhpcy5tZXNzYWdlUGlwZSA9IG5ldyBTdWJqZWN0PGFueT4oKTtcclxuICAgIHRoaXMuY29tcG9uZW50UmVmcyA9IG5ldyBNYXA8c3RyaW5nLCBNYXA8c3RyaW5nLCBhbnk+PigpO1xyXG4gICAgdGhpcy5jb21wb25lbnRNYW5hZ2VyID0gbmV3IENvbXBvbmVudE1hbmFnZXIodGhpcyk7XHJcbiAgICB0aGlzLmNvbnRleHRNZXRhZGF0YU1hbmFnZXIgPSBuZXcgQ29udGV4dE1ldGFkYXRhTWFuYWdlcigpO1xyXG5cclxuICAgIHRoaXMub3BlbmVkID0gZmFsc2U7XHJcbiAgICAvLyB0aGlzLnNvcnRDb25kaXRpb25NYW5hZ2VyID0gbmV3IFNvcnRDb25kaXRpb25NYW5hZ2VyKCk7XHJcbiAgICAvLyB0aGlzLmZpbHRlckNvbmRpdGlvbk1hbmFnZXIgPSBuZXcgRmlsdGVyQ29uZGl0aW9uTWFuYWdlcigpO1xyXG4gICAgdGhpcy5yb3V0ZXIgPSB0aGlzLmluamVjdG9yICYmIHRoaXMuaW5qZWN0b3IuZ2V0KFJvdXRlcik7XHJcbiAgICB0aGlzLnZpZXdNb2RlbE1hbmFnZXIgPSBuZXcgVmlld01vZGVsTWFuYWdlcigpO1xyXG4gICAgdGhpcy5jb250ZXh0TWV0YWRhdGFCdWlsZGVyID0gbmV3IENvbnRleHRNZXRhZGF0YUJ1aWxkZXIoKTtcclxuICAgIHRoaXMudmFyaWFibGVQYXJzZVNlcnZpY2UgPSBuZXcgVmFyaWFibGVQYXJzZVNlcnZpY2UoW1xyXG4gICAgICBuZXcgRnJhbWVJZFZhcmlhYmxlUGFyc2VyKCksXHJcbiAgICAgIG5ldyBEYXRhVmFyaWFibGVQYXJzZXIoKSxcclxuICAgICAgbmV3IFVJU3RhdGVWYXJpYWJsZVBhcnNlcigpLFxyXG4gICAgICBuZXcgU3RhdGVNYWNoaW5lVmFyaWFibGVQYXJzZXIoKSxcclxuICAgICAgbmV3IENvbW1hbmRWYXJpYWJsZVBhcnNlcigpXHJcbiAgICBdKTtcclxuICB9XHJcbiAgZGlzcG9zZShvcHRpb25zPzogYW55KSB7XHJcbiAgICBpZiAodGhpcy5kaXNwb3NlZCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB0aGlzLmlzRm9ybURlc3RvcnllZCA9IHRydWU7XHJcbiAgICB0aGlzLmRpc3Bvc2VkID0gdHJ1ZTtcclxuICAgIHRoaXMucm91dGVyID0gbnVsbDtcclxuICAgIHRoaXMudW5yZWdpc3RlckZyb21NYW5hZ2VyKCk7XHJcbiAgICB0aGlzLmNvbXBvbmVudFJlZnMuY2xlYXIoKTtcclxuICAgIGlmICh0aGlzLnN0YXRlTWFjaGluZSkge1xyXG4gICAgICB0aGlzLnN0YXRlTWFjaGluZS5kaXNwb3NlKCk7XHJcbiAgICAgIHRoaXMuc3RhdGVNYWNoaW5lID0gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmZyYW1lQ29tcG9uZW50UmVmcmVzaGVyLmRpc3Bvc2UoKTtcclxuICAgIHRoaXMuZnJhbWVDb250ZXh0TWFuYWdlci5kaXNwb3NlKCk7XHJcbiAgICB0aGlzLnJlcG9zaXRvcnlNYW5hZ2VyLmRpc3Bvc2UoKTtcclxuICAgIHRoaXMudmlld01vZGVsTWFuYWdlci5kaXNwb3NlKCk7XHJcbiAgICB0aGlzLmJpbmRpbmdEYXRhTWFuYWdlci5kaXNwb3NlKCk7XHJcbiAgICBpZiAodGhpcy5tZXNzYWdlUGlwZSkge1xyXG4gICAgICB0aGlzLm1lc3NhZ2VQaXBlLmNvbXBsZXRlKCk7XHJcbiAgICAgIHRoaXMubWVzc2FnZVBpcGUgPSBudWxsO1xyXG4gICAgfVxyXG4gICAgdGhpcy5pbmplY3RvciA9IG51bGw7XHJcbiAgICBpZiAodGhpcy5kZXN0b3J5U2lnbmFsKSB7XHJcbiAgICAgIHRoaXMuZGVzdG9yeVNpZ25hbC5uZXh0KCk7XHJcbiAgICAgIHRoaXMuZGVzdG9yeVNpZ25hbC5jb21wbGV0ZSgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XHJcbiAgICB0aGlzLmRpc3Bvc2UoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOeUseihqOWNleWFg+aVsOaNruOAgeeKtuaAgeacuuWFg+aVsOaNruOAgeWJjeerr+aehOS7tuWFg+aVsOaNruWIneWni+WMluino+aekOWei+W6lOeUqOS4iuS4i+aWh1xyXG4gICAqIEBwYXJhbSBmb3JtTWV0YWRhdGFDb250ZW50IOihqOWNleWFg+aVsOaNrlxyXG4gICAqIEBwYXJhbSBzdGF0ZU1hY2hpbmVNZXRhZGF0YSDnirbmgIHmnLrlhYPmlbDmja5cclxuICAgKiBAcGFyYW0gY29udHJvbGxlcnMg5YmN56uv5p6E5Lu25YWD5pWw5o2uXHJcbiAgICovXHJcbiAgcHVibGljIGluaXRpYWxpemVCeU1ldGFkYXRhKFxyXG4gICAgZm9ybU1ldGFkYXRhQ29udGVudDogYW55LFxyXG4gICAgc3RhdGVNYWNoaW5lTWV0YWRhdGE6IElTdGF0ZU1hY2hpbmUsXHJcbiAgICBjb250cm9sbGVyczogeyBbaWQ6IHN0cmluZ106IENvbW1hbmRDb250cm9sbGVyIH0sXHJcbiAgICBvcHRpb25zOiB7XHJcbiAgICAgIHZhbHVlQ29udmVydGVyTWFwPzogYW55XHJcbiAgICB9XHJcbiAgKSB7XHJcbiAgICB0aGlzLm1ldGFkYXRhID0gdGhpcy5jb250ZXh0TWV0YWRhdGFCdWlsZGVyLmJ1aWxkQXBwQ29udGV4dE1ldGFkYXRhKGZvcm1NZXRhZGF0YUNvbnRlbnQsIHN0YXRlTWFjaGluZU1ldGFkYXRhKTtcclxuICAgIGlmICghdGhpcy5zdGF0ZU1hY2hpbmUpIHtcclxuICAgICAgLy8g6YG/5YWN55Sx5LqO57uE5ZCI6KGo5Y2V77yM6I635Y+W5Yiw54i257qn54q25oCB5py65a6e5L6L55qE6Zeu6aKYXHJcbiAgICAgIC8vIHRoaXMuc3RhdGVNYWNoaW5lID0gdGhpcy5pbmplY3Rvci5nZXQoU3RhdGVNYWNoaW5lLCBuZXcgU3RhdGVNYWNoaW5lKCkpO1xyXG4gICAgICB0aGlzLnN0YXRlTWFjaGluZSA9IG5ldyBTdGF0ZU1hY2hpbmUoKTtcclxuICAgIH1cclxuICAgIHRoaXMuZm9ybU1ldGFkYXRhQ29udGVudCA9IGZvcm1NZXRhZGF0YUNvbnRlbnQ7XHJcbiAgICB0aGlzLmNvbnRyb2xsZXJzID0gY29udHJvbGxlcnM7XHJcbiAgICB0aGlzLmR5bmFtaWNPcHRpb25zID0gb3B0aW9ucztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlZ2lzdGVyIGN1cnJlbnQgQXBwQ29udGV4dCBpbnN0YW5jZSB0byBBcHBDb250ZXh0TWFuYWdlclxyXG4gICAqL1xyXG4gIHB1YmxpYyByZWdpc3RlclRvTWFuYWdlcigpIHtcclxuICAgIGlmICghdGhpcy5hcHBDb250ZXh0TWFuYWdlcikge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB0aGlzLmFwcENvbnRleHRNYW5hZ2VyLnJlZ2lzdGVyQXBwQ29udGV4dCh0aGlzKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFVucmVnaXN0ZXIgY3VycmVudCBBcHBDb250ZXh0IGluc3RhbmNlIGZyb20gQXBwQ29udGV4dE1hbmFnZXJcclxuICAgKi9cclxuICBwdWJsaWMgdW5yZWdpc3RlckZyb21NYW5hZ2VyKCkge1xyXG4gICAgaWYgKCF0aGlzLmFwcENvbnRleHRNYW5hZ2VyKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHRoaXMuYXBwQ29udGV4dE1hbmFnZXIudW5yZWdpc3RlckFwcENvbnRleHQodGhpcyk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDms6jlhoxGcmFtZUNvbnRleHRcclxuICAgKi9cclxuICBwdWJsaWMgcmVnRnJhbWVDb250ZXh0KGZyYW1lQ29udGV4dDogYW55KTogdm9pZCB7XHJcbiAgICBjb25zdCByZXBvc2l0b3J5ID0gZnJhbWVDb250ZXh0LnJlcG9zaXRvcnk7XHJcbiAgICBjb25zdCByZXBvc2l0b3J5TmFtZSA9IHJlcG9zaXRvcnkubmFtZTtcclxuXHJcbiAgICAvLyBSZXBvc2l0b3J5XHJcbiAgICBpZiAodGhpcy5yZXBvc2l0b3J5TWFuYWdlci5pZlJlcG9zaXRvcnlFeGl0cyhyZXBvc2l0b3J5TmFtZSkgPT09IGZhbHNlKSB7XHJcbiAgICAgIHRoaXMucmVwb3NpdG9yeU1hbmFnZXIucmVnUmVwb3NpdG9yeShyZXBvc2l0b3J5TmFtZSwgcmVwb3NpdG9yeSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQmluZGluZ0RhdGFcclxuICAgIGlmICh0aGlzLmJpbmRpbmdEYXRhTWFuYWdlci5pZkJpbmRpbmdEYXRhRXhpdHMocmVwb3NpdG9yeU5hbWUpID09PSBmYWxzZSkge1xyXG4gICAgICBsZXQgYmluZGluZ0RhdGEgPSBudWxsO1xyXG4gICAgICAvLyDku4Xpq5jpgJ/mqKHlvI/kuIvkvb/nlKhiaW5kaW5nRGF0YU1hbmFnZXJcclxuICAgICAgaWYgKHRoaXMucnVuTW9kZSA9PT0gUnVuTW9kZS5oaWdoU3BlZWQpIHtcclxuICAgICAgICBiaW5kaW5nRGF0YSA9IEJpbmRpbmdEYXRhRmFjdG9yeS5jcmVhdGVGcm9tUmVwb3NpdG9yeShyZXBvc2l0b3J5LCAnLycpO1xyXG4gICAgICAgIHRoaXMuYmluZGluZ0RhdGFNYW5hZ2VyLnJlZ0JpbmRpbmdEYXRhKHJlcG9zaXRvcnlOYW1lLCBiaW5kaW5nRGF0YSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyDogIPomZHot6/nlLHlho3mrKHov5vlhaXnmoTml7blgJnvvIxBcHBDb250ZXh05rKh5pyJ6KKr5rOo6ZSA77yM5L2GQ29tcG9uZW506KKr5YaN5qyh5p6E6YCg55qE5Zy65pmvXHJcbiAgICB0aGlzLmZyYW1lQ29udGV4dE1hbmFnZXIucmVnRnJhbWVDb250ZXh0KGZyYW1lQ29udGV4dCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgcmVnQ29udGV4dE1ldGFkYXRhKGNvbXBvbmVudElkOiBzdHJpbmcsIGNvbnRleHRNZXRhZGF0YTogSUNvbnRleHRNZXRhZGF0YSkge1xyXG4gICAgaWYgKCF0aGlzLmNvbnRleHRNZXRhZGF0YU1hbmFnZXIuZXhzaXQoY29tcG9uZW50SWQpKSB7XHJcbiAgICAgIHRoaXMuY29udGV4dE1ldGFkYXRhTWFuYWdlci5yZWdpc3Rlcihjb21wb25lbnRJZCwgY29udGV4dE1ldGFkYXRhKTtcclxuICAgIH1cclxuICB9XHJcbiAgLyoqXHJcbiAgICog6I635Y+W5pW05Liq6KGo5Y2V55qEQXBwQ29udGV4dFxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRGb3JtQXBwQ29udGV4dCgpIHtcclxuICAgIHJldHVybiB0aGlzO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDplIDmr4HooajljZVcclxuICAgKiBAdG9kbzog5Li05pe26Kej5Yaz6KGo5Y2V5YWz6Zet5ZCO5a+56LGh5rKh5pyJ6ZSA5q+B5Lqm6I635Y+W5LiN5Yiw6ZSA5q+B5pe25py655qE6Zeu6aKYLOW6lOS+nei1lmFuZ3VsYXLmnKzouqvnmoTplIDmr4HmnLrliLZcclxuICAgKi9cclxuICBwdWJsaWMgZGVzdG9yeSgpIHtcclxuICAgIHRoaXMuZGlzcG9zZSgpO1xyXG4gIH1cclxuICBwdWJsaWMgZ2V0IGlzRGVzdG9yeWVkKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuaXNGb3JtRGVzdG9yeWVkO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDlupTnlKhpZFxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXQgQXBwbGljYXRpb25JZCgpIHtcclxuICAgIGlmICghIXRoaXMuYXBwbGljYXRpb25JZCkge1xyXG4gICAgICByZXR1cm4gdGhpcy5hcHBsaWNhdGlvbklkO1xyXG4gICAgfVxyXG4gICAgdGhpcy5hcHBsaWNhdGlvbklkID0gVUlELmNyZWF0ZSgpO1xyXG4gICAgcmV0dXJuIHRoaXMuYXBwbGljYXRpb25JZDtcclxuICB9XHJcbiAgcHVibGljIHNldCBBcHBsaWNhdGlvbklkKGFwcElkOiBzdHJpbmcpIHtcclxuICAgIHRoaXMuYXBwbGljYXRpb25JZCA9IGFwcElkO1xyXG4gIH1cclxuICBwdWJsaWMgZ2V0IFRva2VuKCkge1xyXG4gICAgaWYgKCEhdGhpcy50b2tlbikge1xyXG4gICAgICByZXR1cm4gdGhpcy50b2tlbjtcclxuICAgIH1cclxuICAgIHRoaXMudG9rZW4gPSBVSUQuY3JlYXRlKCk7XHJcbiAgICByZXR1cm4gdGhpcy50b2tlbjtcclxuICB9XHJcbiAgcHVibGljIHNldCBUb2tlbih0b2tlbjogc3RyaW5nKSB7XHJcbiAgICB0aGlzLnRva2VuID0gdG9rZW47XHJcbiAgfVxyXG4gIC8vICNyZWdpb24g5byD55So55qE6ICB5pa55rOVXHJcblxyXG4gIC8qKlxyXG4gICAqIOW3suW6n+W8g++8muivt+S9v+eUqEZyYW1lQ29tcG9uZW50UmVmcmVzaGVy55qEcmVmcmVzaENvbXBvbmVudOaWueazleS7o+abv+OAglxyXG4gICAqIEBkZXByZWNhdGVkXHJcbiAgICovXHJcbiAgcHVibGljIHJlZ2lzdGVyQ29tbWFuZEhhbmRsZXIoZnJhbWVJZDogc3RyaW5nLCBjb21wb25lbnQ6IGFueSkge1xyXG4gICAgdGhpcy5mcmFtZUNvbXBvbmVudFJlZnJlc2hlci5yZWdGcmFtZUNvbXBvbmVudChmcmFtZUlkLCBjb21wb25lbnQpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDlt7Llup/lvIPvvJror7fkvb/nlKhGcmFtZUNvbXBvbmVudFJlZnJlc2hlcueahHJlZnJlc2hDb21wb25lbnTmlrnms5Xku6Pmm7/jgIJcclxuICAgKiBAZGVwcmVjYXRlZFxyXG4gICAqL1xyXG4gIHB1YmxpYyByZWZyZXNoKCkge1xyXG4gICAgdGhpcy5mcmFtZUNvbXBvbmVudFJlZnJlc2hlci5yZWZyZXNoQ29tcG9uZW50cygpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5bey5bqf5byD77ya6K+35L2/55SoRnJhbWVDb250ZXh0TWFuYWdlcueahGdldEZyYW1lQ29udGV4dEJ5SWTmlrnms5Xku6Pmm7/jgIJcclxuICAgKiBAZGVwcmVjYXRlZFxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRGcmFtZUNvbnRleHQoZnJhbWVJZDogc3RyaW5nKTogYW55IHtcclxuICAgIHJldHVybiB0aGlzLmZyYW1lQ29udGV4dE1hbmFnZXIuZ2V0RnJhbWVDb250ZXh0QnlJZChmcmFtZUlkKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRDb250ZXh0QnlJZChpZGVudGlmeTogc3RyaW5nKTogYW55IHtcclxuICAgIGNvbnN0IGNvbnRleHQgPSB0aGlzLmZyYW1lQ29udGV4dE1hbmFnZXIuZ2V0RnJhbWVDb250ZXh0QnlJZChpZGVudGlmeSk7XHJcbiAgICByZXR1cm4gY29udGV4dDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOW3suW6n+W8g++8muivt+S9v+eUqEZyYW1lQ29udGV4dE1hbmFnZXLnmoRnZXRGcmFtZUNvbnRleHRNYXDmlrnms5Xku6Pmm7/jgIJcclxuICAgKiBAZGVwcmVjYXRlZFxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRBbGxGcmFtZUNvbnRleHRzKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuZnJhbWVDb250ZXh0TWFuYWdlci5nZXRGcmFtZUNvbnRleHRNYXAoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWkhOeQhuihjOWPmOabtFxyXG4gICAqL1xyXG4gIHB1YmxpYyBoYW5kbGVTZWxlY3RDaGFuZ2UoY2hhbmdlOiBDaGFuZ2UsIHNyY0ZyYW1lQ29udGV4dDogYW55KSB7XHJcbiAgICBjb25zdCBmb3JjZSA9IGNoYW5nZS5mb3JjZSB8fCBmYWxzZTtcclxuICAgIHRoaXMuZnJhbWVDb250ZXh0cy5mb3JFYWNoKCh0YXJnZXRGcmFtZUNvbnRleHQpID0+IHtcclxuICAgICAgLy8g55u45ZCM55qERnJhbWVDb3RuZXh05oiW6ICFUmVwb3NpdG9yeeS4jeS4gOiHtOeahOaDheWGteS4i++8jOS4jeWQjOatpVxyXG4gICAgICBpZiAodGFyZ2V0RnJhbWVDb250ZXh0ID09PSBzcmNGcmFtZUNvbnRleHRcclxuICAgICAgICB8fCB0YXJnZXRGcmFtZUNvbnRleHQucmVwb3NpdG9yeSAhPT0gc3JjRnJhbWVDb250ZXh0LnJlcG9zaXRvcnkpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IGJpbmRpbmdEYXRhID0gdGFyZ2V0RnJhbWVDb250ZXh0LmJpbmRpbmdEYXRhO1xyXG4gICAgICBjb25zdCBiaW5kaW5nTGlzdDogQmluZGluZ0xpc3QgPSBiaW5kaW5nRGF0YS5nZXRWYWx1ZShjaGFuZ2UucGF0aCk7XHJcbiAgICAgIGNvbnN0IGN1cnJlbnRJZCA9IGNoYW5nZS52YWx1ZVsnaWQnXTtcclxuICAgICAgaWYgKGJpbmRpbmdMaXN0ICYmIGJpbmRpbmdMaXN0LmN1cnJlbnRJZCAhPT0gY3VycmVudElkIHx8IGZvcmNlKSB7XHJcblxyXG4gICAgICAgIC8vIOiuvue9ruW9k+WJjeihjO+8jOS9huS4jeWvueWkluW5v+aSrVxyXG4gICAgICAgIGJpbmRpbmdMaXN0LnNldEN1cnJlbnRJZChjdXJyZW50SWQsIHRydWUsIGZhbHNlLCBmb3JjZSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLy8gI2VuZHJlZ2lvblxyXG5cclxuICBwdWJsaWMgYnVpbGRSZW5kZXJWaWV3Q29udGV4dChjb21wb25lbnRJZDogc3RyaW5nKSB7XHJcblxyXG4gICAgLy8g5o+Q5Y+W6KeG5Zu+5qih5Z6L6ZuG5ZCIXHJcbiAgICBjb25zdCB2aWV3TW9kZWxzID0gdGhpcy5mb3JtTW9kdWxlLnZpZXdtb2RlbHM7XHJcbiAgICAvLyDmj5Dlj5bnu4Tku7bmj4/ov7Dpm4blkIhcclxuICAgIGNvbnN0IHZpZXdDb21wb25lbnRzID0gdGhpcy5mb3JtTW9kdWxlLmNvbXBvbmVudHM7XHJcbiAgICAvLyDmj5Dlj5ZzY2hlbWHoioLngrlcclxuICAgIGNvbnN0IHNjaGVtYSA9IHRoaXMuZm9ybU1vZHVsZS5zY2hlbWFzWzBdO1xyXG4gICAgLy8g5p+l5om+5Yy56YWN5oyH5a6a5qCH6K+G55qE57uE5Lu26IqC54K5XHJcbiAgICBjb25zdCBtYXRjaGVkQ29tcG9uZW50ID0gdmlld0NvbXBvbmVudHMuZmluZChjb21wb25lbnQgPT4gY29tcG9uZW50LmlkID09PSBjb21wb25lbnRJZCk7XHJcbiAgICAvLyDljLnphY3mjIflrprnu4Tku7bnmoTop4blm77mqKHlnovoioLngrlcclxuICAgIGNvbnN0IG1hdGNoZWRWaWV3TW9kZWwgPSB2aWV3TW9kZWxzLmZpbmQodmlld01vZGVsID0+IG1hdGNoZWRDb21wb25lbnQudmlld01vZGVsID09PSB2aWV3TW9kZWwuaWQpO1xyXG4gICAgLy8g5p+l5om+5Yy56YWN6KeG5Zu+5qih5Z6L55qE54i26IqC54K5XHJcbiAgICBjb25zdCBwYXJlbnRWaWV3TW9kZWwgPSB2aWV3TW9kZWxzLmZpbmQodmlld01vZGVsID0+IHZpZXdNb2RlbC5pZCA9PT0gbWF0Y2hlZFZpZXdNb2RlbC5wYXJlbnQpO1xyXG4gICAgbGV0IHBhcmVudENvbXBvbmVudElkID0gJyc7XHJcbiAgICAvLyDlpoLmnpzljLnphY3kuIrkuIrnuqfop4blm77mqKHlnovvvIzmj5DkuIrnuqfop4blm77moIfor4ZcclxuICAgIGlmIChwYXJlbnRWaWV3TW9kZWwpIHtcclxuICAgICAgY29uc3QgcGFyZW50Q29tcG9uZW50ID0gdmlld0NvbXBvbmVudHMuZmluZChjb21wb25lbnQgPT4gY29tcG9uZW50LnZpZXdNb2RlbCA9PT0gcGFyZW50Vmlld01vZGVsLmlkKTtcclxuICAgICAgaWYgKHBhcmVudENvbXBvbmVudCkge1xyXG4gICAgICAgIHBhcmVudENvbXBvbmVudElkID0gcGFyZW50Q29tcG9uZW50LmlkO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICAvLyDlpoLmnpzlrZjlnKjkuIrnuqfnu4Tku7bvvIzmj5Dlj5blmajkuIrkuIvmloflr7nosaHjgIJcclxuICAgIC8vIGNvbnN0IHBhcmVudFZpZXdDb250ZXh0ID0gcGFyZW50Q29tcG9uZW50SWQgPyB0aGlzLmdldENvbnRleHRCeUlkKHBhcmVudENvbXBvbmVudElkKSA6IG51bGw7XHJcbiAgICAvLyB0aGlzLmJ1aWxkUmVuZGVyVmlld0NvbnRleHRSZWN1cnNpdmVseShtYXRjaGVkVmlld01vZGVsLCBwYXJlbnRWaWV3Q29udGV4dCwgc2NoZW1hKTtcclxuICAgIHRoaXMuYnVpbGRSZW5kZXJWaWV3Q29udGV4dFJlY3Vyc2l2ZWx5KG1hdGNoZWRWaWV3TW9kZWwsIHNjaGVtYSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGJ1aWxkUmVuZGVyVmlld0NvbnRleHRSZWN1cnNpdmVseSh2aWV3TW9kZWw6IElGb3JtVmlld01vZGVsLCBzY2hlbWE6IFNjaGVtYSkge1xyXG4gICAgY29uc3QgY29udHJvbGxlcnMgPSB0aGlzLmNvbnRyb2xsZXJzO1xyXG4gICAgY29uc3Qgdmlld0NvbXBvbmVudHMgPSB0aGlzLmZvcm1Nb2R1bGUuY29tcG9uZW50cztcclxuICAgIGNvbnN0IG1hdGNoZWRDb21wb25lbnQgPSB2aWV3Q29tcG9uZW50cy5maW5kKGNvbXBvbmVudCA9PiBjb21wb25lbnQudmlld01vZGVsID09PSB2aWV3TW9kZWwuaWQpO1xyXG4gICAgY29uc3QgY29udGV4dE1ldGFkYXRhID0gdGhpcy5jb250ZXh0TWV0YWRhdGFCdWlsZGVyLmJ1aWxkVmlld0NvbnRleHRNZXRhZGF0YShtYXRjaGVkQ29tcG9uZW50LCB2aWV3TW9kZWwsIHNjaGVtYSwgY29udHJvbGxlcnMsdGhpcy5keW5hbWljT3B0aW9ucyk7XHJcbiAgICAvLyBjb25zdCBjb21tYW5kSGFuZGxlcnM6IENvbW1hbmRIYW5kbGVyW10gPSB0aGlzLmJ1aWxkQ29tbWFuZEhhbmRsZXJzKHZpZXdNb2RlbC5jb21tYW5kcywgY29udHJvbGxlcnMpO1xyXG4gICAgLy8gY29uc3QgY29tbWFuZEhhbmRsZXJFeHRlbmRzOiBDb21tYW5kSGFuZGxlckV4dGVuZGVyW10gPSBbXTtcclxuICAgIC8vIGNvbnN0IHZpZXdDb250ZXh0ID0gbmV3IFZpZXdDb21wb25lbnRDb250ZXh0KCk7XHJcbiAgICAvLyAgIGNvbnRleHRNZXRhZGF0YSxcclxuICAgIC8vICAgdGhpcyxcclxuICAgIC8vICAgcGFyZW50LFxyXG4gICAgLy8gICB0aGlzLmluamVjdG9yXHJcbiAgICAvLyApO1xyXG4gICAgLy8gdGhpcy5yZWdGcmFtZUNvbnRleHQodmlld0NvbnRleHQpO1xyXG4gICAgLy8gdmlld0NvbnRleHQuaW5pdCgpO1xyXG5cclxuICAgIGNvbnN0IGNvbnRleHRNZXRhZGF0YUlkID0gKHRoaXMubmFtZXNwYWNlID8gKHRoaXMubmFtZXNwYWNlICsgJ18nKSA6ICcnKSArIG1hdGNoZWRDb21wb25lbnQuaWQ7XHJcbiAgICBjb250ZXh0TWV0YWRhdGEubmFtZXNwYWNlID0gdGhpcy5uYW1lc3BhY2UgfHwgJyc7XHJcbiAgICB0aGlzLnJlZ0NvbnRleHRNZXRhZGF0YShjb250ZXh0TWV0YWRhdGFJZCwgY29udGV4dE1ldGFkYXRhKTtcclxuXHJcbiAgICBjb25zdCB2aWV3TW9kZWxzID0gdGhpcy5mb3JtTW9kdWxlLnZpZXdtb2RlbHM7XHJcbiAgICBjb25zdCBzdWJWaWV3TW9kZWxzID0gdmlld01vZGVscy5maWx0ZXIoc3ViVmlld01vZGVsID0+IHN1YlZpZXdNb2RlbC5wYXJlbnQgPT09IHZpZXdNb2RlbC5pZCk7XHJcbiAgICBpZiAoc3ViVmlld01vZGVscyAmJiBzdWJWaWV3TW9kZWxzLmxlbmd0aCkge1xyXG4gICAgICBzdWJWaWV3TW9kZWxzLmZvckVhY2goc3ViVmlld01vZGVsID0+IHtcclxuICAgICAgICB0aGlzLmJ1aWxkUmVuZGVyVmlld0NvbnRleHRSZWN1cnNpdmVseShzdWJWaWV3TW9kZWwsIHNjaGVtYSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldENvbXBvbmVudFByb3ZpZGVycyhjb21wb25lbnRJZDogc3RyaW5nKTogYW55W10ge1xyXG4gICAgY29uc3QgY29udGV4dE1ldGFkYXRhID0gdGhpcy5jb250ZXh0TWV0YWRhdGFNYW5hZ2VyLmdldENvbnRleHRNZXRhZGF0YUJ5TmFtZShjb21wb25lbnRJZCk7XHJcbiAgICBjb25zdCBiaW5kaW5nRGF0YSA9IG5ldyBCaW5kaW5nRGF0YSgpO1xyXG4gICAgY29uc3QgZm9ybSA9IG5ldyBGb3JtKCk7XHJcbiAgICBjb25zdCBuYW1lc3BhY2UgPSBjb250ZXh0TWV0YWRhdGEubmFtZXNwYWNlO1xyXG4gICAgY29uc3QgcmVwb3NpdG9yeSA9IHRoaXMucmVwb3NpdG9yeSB8fCB0aGlzLmluamVjdG9yLmdldChSZXBvc2l0b3J5LCBudWxsKTtcclxuICAgIGNvbnN0IHN0YXRlTWFjaGluZSA9IHRoaXMuc3RhdGVNYWNoaW5lO1xyXG4gICAgY29uc3QgdWlTdGF0ZSA9IG5ldyBVSVN0YXRlKCk7XHJcbiAgICBjb25zdCB2aWV3TW9kZWwgPSBuZXcgVmlld01vZGVsKCk7XHJcbiAgICB2aWV3TW9kZWwuc2V0TWV0YWRhdGEoY29udGV4dE1ldGFkYXRhKTtcclxuICAgIHJldHVybiBbXHJcbiAgICAgIHsgcHJvdmlkZTogRlJBTUVfSUQsIHVzZVZhbHVlOiBjb21wb25lbnRJZCB9LFxyXG4gICAgICB7IHByb3ZpZGU6IE5BTUVTUEFDRSwgdXNlVmFsdWU6IG5hbWVzcGFjZSB9LFxyXG4gICAgICB7IHByb3ZpZGU6IEZyYW1lQ29udGV4dCwgdXNlQ2xhc3M6IEZyYW1lQ29udGV4dCB9LFxyXG4gICAgICB7IHByb3ZpZGU6IEFwcENvbnRleHQsIHVzZVZhbHVlOiB0aGlzIH0sXHJcbiAgICAgIHsgcHJvdmlkZTogQmluZGluZ0RhdGEsIHVzZVZhbHVlOiBiaW5kaW5nRGF0YSB9LFxyXG4gICAgICB7IHByb3ZpZGU6IEZvcm0sIHVzZVZhbHVlOiBmb3JtIH0sXHJcbiAgICAgIHsgcHJvdmlkZTogUmVwb3NpdG9yeSwgdXNlVmFsdWU6IHJlcG9zaXRvcnkgfSxcclxuICAgICAgeyBwcm92aWRlOiBTdGF0ZU1hY2hpbmUsIHVzZVZhbHVlOiBzdGF0ZU1hY2hpbmUgfSxcclxuICAgICAgeyBwcm92aWRlOiBVSVN0YXRlLCB1c2VWYWx1ZTogdWlTdGF0ZSB9LFxyXG4gICAgICB7IHByb3ZpZGU6IFZpZXdNb2RlbCwgdXNlVmFsdWU6IHZpZXdNb2RlbCB9LFxyXG4gICAgICB7XHJcbiAgICAgICAgcHJvdmlkZTogVmFyaWFibGVQYXJzZVNlcnZpY2UsIHVzZVZhbHVlOiBuZXcgVmFyaWFibGVQYXJzZVNlcnZpY2UoW1xyXG4gICAgICAgICAgbmV3IEZyYW1lSWRWYXJpYWJsZVBhcnNlcigpLFxyXG4gICAgICAgICAgbmV3IERhdGFWYXJpYWJsZVBhcnNlcigpLFxyXG4gICAgICAgICAgbmV3IFVJU3RhdGVWYXJpYWJsZVBhcnNlcigpLFxyXG4gICAgICAgICAgbmV3IFN0YXRlTWFjaGluZVZhcmlhYmxlUGFyc2VyKCksXHJcbiAgICAgICAgICBuZXcgQ29tbWFuZFZhcmlhYmxlUGFyc2VyKClcclxuICAgICAgICBdKVxyXG4gICAgICB9XHJcbiAgICBdO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IHsgQXBwQ29udGV4dCB9O1xyXG4iXX0=