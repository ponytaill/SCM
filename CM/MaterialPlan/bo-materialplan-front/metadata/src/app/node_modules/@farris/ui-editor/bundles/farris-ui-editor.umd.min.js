!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/router"),require("@farris/ui-common"),require("@angular/core"),require("@angular/common"),require("@angular/forms")):"function"==typeof define&&define.amd?define("@farris/ui-editor",["exports","@angular/router","@farris/ui-common","@angular/core","@angular/common","@angular/forms"],e):e((t.farris=t.farris||{},t.farris["ui-editor"]={}),t.ng.router,t.uiCommon,t.ng.core,t.ng.common,t.ng.forms)}(this,function(t,s,a,u,e,n){"use strict";var l=(i.decorators=[{type:u.Injectable,args:[{providedIn:"root"}]}],i.ctorParameters=function(){return[]},i.ngInjectableDef=u.defineInjectable({factory:function(){return new i},token:i,providedIn:"root"}),i);function i(){}var o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};var r=function(){return(r=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},d=function(){var t="undefined"!=typeof window?window:undefined;return t&&t.tinymce?t.tinymce:null},p=(c.propDecorators={onBeforePaste:[{type:u.Output}],onBlur:[{type:u.Output}],onClick:[{type:u.Output}],onContextMenu:[{type:u.Output}],onCopy:[{type:u.Output}],onCut:[{type:u.Output}],onDblclick:[{type:u.Output}],onDrag:[{type:u.Output}],onDragDrop:[{type:u.Output}],onDragEnd:[{type:u.Output}],onDragGesture:[{type:u.Output}],onDragOver:[{type:u.Output}],onDrop:[{type:u.Output}],onFocus:[{type:u.Output}],onFocusIn:[{type:u.Output}],onFocusOut:[{type:u.Output}],onKeyDown:[{type:u.Output}],onKeyPress:[{type:u.Output}],onKeyUp:[{type:u.Output}],onMouseDown:[{type:u.Output}],onMouseEnter:[{type:u.Output}],onMouseLeave:[{type:u.Output}],onMouseMove:[{type:u.Output}],onMouseOut:[{type:u.Output}],onMouseOver:[{type:u.Output}],onMouseUp:[{type:u.Output}],onPaste:[{type:u.Output}],onSelectionChange:[{type:u.Output}],onActivate:[{type:u.Output}],onAddUndo:[{type:u.Output}],onBeforeAddUndo:[{type:u.Output}],onBeforeExecCommand:[{type:u.Output}],onBeforeGetContent:[{type:u.Output}],onBeforeRenderUI:[{type:u.Output}],onBeforeSetContent:[{type:u.Output}],onChange:[{type:u.Output}],onClearUndos:[{type:u.Output}],onDeactivate:[{type:u.Output}],onDirty:[{type:u.Output}],onExecCommand:[{type:u.Output}],onGetContent:[{type:u.Output}],onHide:[{type:u.Output}],onInit:[{type:u.Output}],onLoadContent:[{type:u.Output}],onNodeChange:[{type:u.Output}],onPostProcess:[{type:u.Output}],onPostRender:[{type:u.Output}],onPreInit:[{type:u.Output}],onPreProcess:[{type:u.Output}],onProgressState:[{type:u.Output}],onRedo:[{type:u.Output}],onRemove:[{type:u.Output}],onReset:[{type:u.Output}],onSaveContent:[{type:u.Output}],onSetAttrib:[{type:u.Output}],onObjectResizeStart:[{type:u.Output}],onObjectResized:[{type:u.Output}],onObjectSelected:[{type:u.Output}],onSetContent:[{type:u.Output}],onShow:[{type:u.Output}],onSubmit:[{type:u.Output}],onUndo:[{type:u.Output}],onVisualAid:[{type:u.Output}]},c);function c(){this.onBeforePaste=new u.EventEmitter,this.onBlur=new u.EventEmitter,this.onClick=new u.EventEmitter,this.onContextMenu=new u.EventEmitter,this.onCopy=new u.EventEmitter,this.onCut=new u.EventEmitter,this.onDblclick=new u.EventEmitter,this.onDrag=new u.EventEmitter,this.onDragDrop=new u.EventEmitter,this.onDragEnd=new u.EventEmitter,this.onDragGesture=new u.EventEmitter,this.onDragOver=new u.EventEmitter,this.onDrop=new u.EventEmitter,this.onFocus=new u.EventEmitter,this.onFocusIn=new u.EventEmitter,this.onFocusOut=new u.EventEmitter,this.onKeyDown=new u.EventEmitter,this.onKeyPress=new u.EventEmitter,this.onKeyUp=new u.EventEmitter,this.onMouseDown=new u.EventEmitter,this.onMouseEnter=new u.EventEmitter,this.onMouseLeave=new u.EventEmitter,this.onMouseMove=new u.EventEmitter,this.onMouseOut=new u.EventEmitter,this.onMouseOver=new u.EventEmitter,this.onMouseUp=new u.EventEmitter,this.onPaste=new u.EventEmitter,this.onSelectionChange=new u.EventEmitter,this.onActivate=new u.EventEmitter,this.onAddUndo=new u.EventEmitter,this.onBeforeAddUndo=new u.EventEmitter,this.onBeforeExecCommand=new u.EventEmitter,this.onBeforeGetContent=new u.EventEmitter,this.onBeforeRenderUI=new u.EventEmitter,this.onBeforeSetContent=new u.EventEmitter,this.onChange=new u.EventEmitter,this.onClearUndos=new u.EventEmitter,this.onDeactivate=new u.EventEmitter,this.onDirty=new u.EventEmitter,this.onExecCommand=new u.EventEmitter,this.onGetContent=new u.EventEmitter,this.onHide=new u.EventEmitter,this.onInit=new u.EventEmitter,this.onLoadContent=new u.EventEmitter,this.onNodeChange=new u.EventEmitter,this.onPostProcess=new u.EventEmitter,this.onPostRender=new u.EventEmitter,this.onPreInit=new u.EventEmitter,this.onPreProcess=new u.EventEmitter,this.onProgressState=new u.EventEmitter,this.onRedo=new u.EventEmitter,this.onRemove=new u.EventEmitter,this.onReset=new u.EventEmitter,this.onSaveContent=new u.EventEmitter,this.onSetAttrib=new u.EventEmitter,this.onObjectResizeStart=new u.EventEmitter,this.onObjectResized=new u.EventEmitter,this.onObjectSelected=new u.EventEmitter,this.onSetContent=new u.EventEmitter,this.onShow=new u.EventEmitter,this.onSubmit=new u.EventEmitter,this.onUndo=new u.EventEmitter,this.onVisualAid=new u.EventEmitter}var h,m,y=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],f=function(n,i){y.forEach(function(t){var e=n[t];i.on(t.substring(2),function(t){return n.ngZone.run(function(){return e.emit({event:t,editor:i})})})})},E=0,g=function(t){var e=(new Date).getTime();return t+"_"+Math.floor(1e9*Math.random())+ ++E+String(e)},v=function(t){return void 0!==t&&"textarea"===t.tagName.toLowerCase()},_=function(t){return void 0===t||""===t?[]:Array.isArray(t)?t:t.split(" ")},b=function(t,e){return _(t).concat(_(e))},O=function(){},w=function(t){return null===t||t===undefined},C=function(){return{listeners:[],scriptId:g("tiny-script"),scriptLoaded:!1}},S=(h=C(),{load:function(t,e,n){h.scriptLoaded?n():(h.listeners.push(n),t.getElementById(h.scriptId)||function(t,e,n,i){var o=e.createElement("script");o.referrerPolicy="origin",o.type="application/javascript",o.id=t,o.src=n;var r=function(){o.removeEventListener("load",r),i()};o.addEventListener("load",r),e.head&&e.head.appendChild(o)}(h.scriptId,t,e,function(){h.listeners.forEach(function(t){return t()}),h.scriptLoaded=!0}))},reinitialize:function(){h=C()}}),I=new u.InjectionToken("TINYMCE_SCRIPT_SRC"),P={provide:n.NG_VALUE_ACCESSOR,useExisting:u.forwardRef(function(){return F}),multi:!0},F=(function R(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(M,m=p),Object.defineProperty(M.prototype,"disabledClass",{get:function(){return this._disabled},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"readonlyClass",{get:function(){return this._readOnly},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"disabled",{get:function(){return this._disabled},set:function(t){this._disabled=t,this._editor&&this._editor.initialized&&(this._editor.setMode(t?"readonly":"design"),this.setDivElement(t),this.editorBlured())},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"readOnly",{get:function(){return this._readOnly},set:function(t){this._readOnly=t,this._editor&&this._editor.initialized&&(this._editor.setMode(t?"readonly":"design"),this.setDivElement(t),this.editorBlured())},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"editor",{get:function(){return this._editor},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"fontFamilyList",{get:function(){return this._fontFamilyList},set:function(t){t&&(this._fontFamilyList=t)},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"defaultFontFamily",{get:function(){return this._defaultFontFamily},set:function(t){t&&(this._defaultFontFamily=t)},enumerable:!0,configurable:!0}),M.prototype.ngOnInit=function(){var o=this;this.init={selector:"textarea",menubar:!1,inline:!1,plugins:["advlist autolink lists link image charmap print preview anchor textcolor powerpaste","searchreplace visualblocks code fullscreen","insertdatetime media table image imagetools code help nonbreaking"],language:this.localeIds[this.currentLocale],toolbar:"undo redo | formatselect fontsizeselect fontselect |                         bold italic underline strikethrough forecolor backcolor link |                         alignleft aligncenter alignright alignjustify |                         bullist numlist outdent indent table image | removeformat",min_height:100,block_formats:"Paragraph=p;Heading 1=h1;Heading 2=h2;Heading 3=h3;Heading 4=h4;Heading 5=h5;Heading 6=h6",fontsize_formats:"12px 14px 16px 18px 24px 36px 48px 56px 72px",font_formats:"微软雅黑=Microsoft YaHei,Helvetica Neue,PingFang SC,sans-serif;苹果苹方=PingFang SC,Microsoft YaHei,sans-serif;                            宋体=simsun,serif;仿宋体=FangSong,serif;黑体=SimHei,sans-serif;Arial=arial,helvetica,sans-serif;                            Arial Black=arial black,avant garde;Book Antiqua=book antiqua,palatino;",images_upload_url:"postAcceptor.php",images_upload_handler:function(t,e,n){if(o.beforeUpload)o.beforeUpload(t).subscribe(function(t){e(t)},function(t){n(t)});else{var i=new FileReader;i.readAsDataURL(t.blob()),i.onload=function(){}}},branding:!1,readonly:!1,setup:null,end_container_on_empty_block:!0,powerpaste_word_import:"propmt",powerpaste_html_import:"propmt",powerpaste_allow_local_images:!0,paste_data_images:!0,autoresize_min_height:100,autoresize_max_height:this.maxHeight,autoresize_on_init:!0,autoresize_overflow_padding:0,nonbreaking_force_tab:!0,default_link_target:"_blank"}},M.prototype.editorBlured=function(){var e=this;setTimeout(function(){var t=e._editor.iframeElement.contentWindow.document.getElementsByClassName(e.editorBodyCls);t&&t.length&&t[0].blur()},0)},M.prototype.writeValue=function(t){this._editor&&this._editor.initialized?(this._editor.setContent(w(t)?"":t),this._divElement.innerHTML=w(t)?"":t):this.initialValue=null===t?undefined:t,!this.__WEBPAGEURL__&&this.router&&(this.__WEBPAGEURL__=this.router.url)},M.prototype.registerOnChange=function(t){this.onChangeCallback=t},M.prototype.registerOnTouched=function(t){this.onTouchedCallback=t},M.prototype.setDisabledState=function(t){this._editor?this._editor.setMode(t?"readonly":"design"):t&&(this.init=r({},this.init,{readonly:!0}))},M.prototype.ngAfterViewInit=function(){e.isPlatformBrowser(this.platformId)&&(this.editorId=this.editorId||g("tiny-angular"),this.inline="undefined"!=typeof this.inline?"boolean"!=typeof this.inline||this.inline:this.init&&this.init.inline,this.createElement(),this.init.selector="#"+this.editorId,d()?this.initialise():this._element&&this._element.ownerDocument&&S.load(this._element.ownerDocument,this.getScriptSrc(),this.initialise),this._elementRef.nativeElement.querySelect)},M.prototype.ngOnDestroy=function(){this.__WEBPAGEURL__="",this._editor&&(this._editor.remove(),this._editor=null,this._divElement=null),this.overLayService&&(this.overLayService.destory(this._elementRef.nativeElement),this.overLayService=null)},M.prototype.createElement=function(){var t="string"==typeof this.tagName?this.tagName:"div";this._element=document.createElement(this.inline?t:"textarea"),this._element.setAttribute("class","d-none"),this._divElement=document.createElement("div"),this.showBorder?this._divElement.className="farris-editor-placeholder":this._divElement.className="farris-editor-placeholder farris-editor-placeholder-border",this.maxHeight&&this._render.setStyle(this._divElement,"max-height",this.maxHeight+"px"),this._element&&(this._element.id=this.editorId,v(this._element)&&(this._element.style.visibility="hidden"),this._elementRef.nativeElement.appendChild(this._element),this._elementRef.nativeElement.appendChild(this._divElement))},M.prototype.initialise=function(n){var i=this;void 0===n&&(n=!0);var t=r({},this.init,{target:this._element,inline:this.inline,plugins:b(this.init&&this.init.plugins,this.plugins),toolbar:this.init&&this.init.toolbar,height:this.height,autoresize_max_height:this.maxHeight,max_height:this.maxHeight,setup:function(t){(i._editor=t).on("init",function(e){i.initEditor(t,n),i._readOnly||i._disabled?i._editor.setMode("readonly"):i._editor.setMode("design"),setTimeout(function(){i.setDivElement(i._readOnly||i._disabled),e.target.editorCommands.execCommand("fontName",!1,i.defaultFontFamily);var t=function(){var t=document.querySelectorAll('[aria-label="Inline toolbar"]');t&&t.length&&t.forEach(function(t){t.style.display="none"})};i._elementRef.nativeElement.querySelector(".mce-container-body").addEventListener("click",t),i.overLayService.registerMouseEvent(i._elementRef.nativeElement,t,{mouseDown:!1,scroll:!0})},0)}),t.on("PastePostProcess",function(t){i.replaceFontFamily(t.node)}),f(i,t),i.init&&"function"==typeof i.init.setup&&i.init.setup(t)}});this.customToolbar&&(t.toolbar=a.Convert2HtmlEditorToolbars("advanced",this.toolbar)),v(this._element)&&(this._element.style.visibility=""),this.ngZone.runOutsideAngular(function(){setTimeout(function(){d().init(t)},100)})},M.prototype.refresh=function(){this.editor&&this.editor.destroy(),this.initialise(!1)},M.prototype.setToolbar=function(t){this.toolbar=t,this.refresh()},M.prototype.setDivElement=function(t){t?(this._divElement.classList.remove("d-none"),this._render.removeStyle(this._divElement,"height")):(this._divElement.classList.add("d-none"),this._render.setStyle(this._divElement,"height",this.height+"px"))},M.prototype.getScriptSrc=function(){return w(this.tinymceScriptSrc)?"https://cdn.tiny.cloud/1/"+this.apiKey+"/tinymce/"+this.cloudChannel+"/tinymce.min.js":this.tinymceScriptSrc},M.prototype.initEditor=function(t,e){var n=this;t.on("blur",function(){return n.ngZone.run(function(){return n.onTouchedCallback()})}),t.on(this.modelEvents,function(){n.ngZone.run(function(){n.onChangeCallback(t.getContent({format:n.outputFormat})),n._divElement.innerHTML=t.getContent({format:n.outputFormat})})}),"string"==typeof this.initialValue&&e&&this.ngZone.run(function(){t.setContent(n.initialValue),n._divElement.innerHTML=n.initialValue,n.onChangeCallback(t.getContent({format:n.outputFormat}))})},M.prototype.replaceFontFamily=function(t){if(t.children&&t.children.length)for(var e=0;e<t.children.length;e++)this.replaceFontFamily(t.children[e]);var n=t.style.fontFamily,i=t.getAttribute("face");if(n){var o=n.split(","),r=this.getFontFamilyArray(o);t.style.fontFamily=r}if(i){var s=i.split(",");r=this.getFontFamilyArray(s),t.setAttribute("face",r)}},M.prototype.getFontFamilyArray=function(t,n){var i=this;void 0===n&&(n=this._fontFamilyList);var o=[];t.forEach(function(e){n.find(function(t){return t===i.trim(e)})&&o.push(i.trim(e))});var e=o.join(",");return e=e||this._defaultFontFamily},M.prototype.trim=function(t){return t.replace(/^\s*|\s*$/g,"")},M.decorators=[{type:u.Component,args:[{selector:"farris-editor",template:"<ng-template></ng-template>",providers:[P],encapsulation:u.ViewEncapsulation.None,styles:[":host{display:block}.farris-editor .mce-tinymce .mce-toolbar .mce-btn-group>div{white-space:pre-wrap}.farris-editor .mce-tinymce{box-sizing:border-box;box-shadow:none}.farris-editor .mce-panel,.farris-editor .mce-tinymce{border-color:#d8dce6}.farris-editor.farris-editor-disabled .mce-statusbar,.farris-editor.farris-editor-disabled .mce-top-part,.farris-editor.farris-editor-readonly .mce-statusbar,.farris-editor.farris-editor-readonly .mce-top-part{display:none}.farris-editor.farris-editor-disabled .mce-edit-area,.farris-editor.farris-editor-readonly .mce-edit-area{border-top:none}.farris-editor.farris-editor-disabled.farris-editor-border .mce-tinymce,.farris-editor.farris-editor-readonly.farris-editor-border .mce-tinymce{border-width:0 0 1px!important}"]}]}],M.ctorParameters=function(){return[{type:u.ElementRef},{type:u.NgZone},{type:Object,decorators:[{type:u.Inject,args:[u.PLATFORM_ID]}]},{type:u.Injector,decorators:[{type:u.Optional}]},{type:String,decorators:[{type:u.Optional},{type:u.Inject,args:[I]}]}]},M.propDecorators={rootClass:[{type:u.HostBinding,args:["class"]}],disabledClass:[{type:u.HostBinding,args:["class.farris-editor-disabled"]}],readonlyClass:[{type:u.HostBinding,args:["class.farris-editor-readonly"]}],disabled:[{type:u.Input}],customToolbar:[{type:u.Input}],readOnly:[{type:u.Input}],cloudChannel:[{type:u.Input}],apiKey:[{type:u.Input}],editorId:[{type:u.Input}],initialValue:[{type:u.Input}],outputFormat:[{type:u.Input}],inline:[{type:u.Input}],tagName:[{type:u.Input}],plugins:[{type:u.Input}],toolbar:[{type:u.Input}],modelEvents:[{type:u.Input}],height:[{type:u.Input}],autoresizeMaxHeight:[{type:u.Input}],maxHeight:[{type:u.Input}],showBorder:[{type:u.Input},{type:u.HostBinding,args:["class.farris-editor-border"]}],fontFamilyList:[{type:u.Input}],defaultFontFamily:[{type:u.Input}],beforeUpload:[{type:u.Input}]},M);function M(t,e,n,i,o){var r=m.call(this)||this;return r.platformId=n,r.injector=i,r.tinymceScriptSrc=o,r.rootClass="farris-editor",r.customToolbar=!1,r.localeIds={en:"es","zh-CHS":"zh_CN"},r.currentLocale="zh-CHS",r.cloudChannel="5",r.apiKey="no-api-key",r.editorId="",r.modelEvents="change keyup undo redo",r.height=100,r.autoresizeMaxHeight=800,r.maxHeight=800,r.showBorder=!0,r._fontFamilyList=["Microsoft YaHei","Helvetica Neue","PingFang SC","sans-serif","simsun","serif","SimHei","arial","helvetica","arial black","avant garde","book antiqua","palatino","FangSong"],r._defaultFontFamily="Microsoft YaHei",r.onTouchedCallback=O,r.onChangeCallback=O,r.__WEBPAGEURL__="",r.editorBodyCls="mce-content-body",r.overLayService=null,r._elementRef=t,r.ngZone=e,r._render=r.injector.get(u.Renderer2),r.initialise=r.initialise.bind(r),r.injector&&(r.currentLocale=r.injector.get(u.LOCALE_ID),r.editorService=r.injector.get(l),r.router=r.injector.get(s.Router,null),r.router&&r.router.events.subscribe(function(t){t instanceof s.NavigationStart?r.__WEBPAGEURL__||(r.__WEBPAGEURL__=t.url):t instanceof s.NavigationEnd&&r.__WEBPAGEURL__===t.url&&r.editor&&(r.editor.destroy(),r.initialise(!1))})),r.overLayService=new a.OverLayHiddenService,r}var D=(x.forRoot=function(t){return{ngModule:x,providers:[{provide:I,useValue:t}]}},x.decorators=[{type:u.NgModule,args:[{declarations:[F],imports:[e.CommonModule,n.FormsModule],exports:[F],providers:[l]}]}],x);function x(){}t.EditorService=l,t.TINYMCE_SCRIPT_SRC=I,t.EditorComponent=F,t.EditorModule=D,t.Events=p,t.validEvents=y,t.getTinymce=d,t.ScriptLoader=S,t.bindHandlers=f,t.uuid=g,t.isTextarea=v,t.normalizePluginArray=_,t.mergePlugins=b,t.noop=O,t.isNullOrUndefined=w,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=farris-ui-editor.umd.min.js.map