/**
 * @fileoverview added by tsickle
 * Generated from: lib/service/f-file-uploader.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { EventEmitter, Optional } from "@angular/core";
import { Observable, Subject } from "rxjs";
import { mergeMap, finalize } from "rxjs/operators";
import { FFileUtils } from "../utils/index";
import { UploadStatus, UploadServerService, } from "../model/index";
var FFileUploaderService = /** @class */ (function () {
    function FFileUploaderService(uploadServerSer) {
        var _this = this;
        this.uploadServerSer = uploadServerSer;
        this.allowedContentTypes = ["*"];
        //默认不限制,0代表不限制 Number.POSITIVE_INFINITY
        this.maxUploads = 0;
        /**
         * 单位M，默认是12M,0代表不限制
         */
        this.maxFileSize = 12;
        this.concurrency = Number.POSITIVE_INFINITY;
        this.uploadedCount = 0;
        this.extendServerConfig = null;
        this.queue = [];
        this.serviceEvents = new EventEmitter();
        this.uploadScheduler = new Subject();
        this.subs = [];
        this.uploadScheduler
            .pipe(mergeMap((/**
         * @param {?} upload
         * @return {?}
         */
        function (upload) {
            return _this.serverMethod(upload);
        }), this.concurrency))
            .subscribe((/**
         * @param {?} uploadOutput
         * @return {?}
         */
        function (uploadOutput) {
            // if (uploadOutput.type == 'removed' || uploadOutput.type == 'done') {
            //   // 删除或者done移除
            //   const subIndex = this.subs.findIndex(sub => sub.id === uploadOutput.file.id);
            //   if (subIndex > -1 && this.subs[subIndex].sub) {
            //     this.subs[subIndex].sub.unsubscribe();
            //   }
            //   this.subs.splice(subIndex, 1);
            // }
            if (uploadOutput.type == "removed") {
                // 事件中返回的都是
                _this.queue = _this.queue.filter((/**
                 * @param {?} item
                 * @return {?}
                 */
                function (item) { return item.progress.status !== UploadStatus.Remove; }));
                if (!uploadOutput.hasOwnProperty("message")) {
                    uploadOutput["message"] = "被删除";
                }
            }
            if (uploadOutput.type == "error") {
                // 上传失败的附件移除
                _this.queue = _this.queue.filter((/**
                 * @param {?} queueItem
                 * @return {?}
                 */
                function (queueItem) {
                    return (uploadOutput.files.findIndex((/**
                     * @param {?} item
                     * @return {?}
                     */
                    function (item) { return queueItem.id == item.id; })) <
                        0);
                }));
            }
            _this.serviceEvents.emit(uploadOutput);
        }));
    }
    /**
     * @param {?} options
     * @return {?}
     */
    FFileUploaderService.prototype.setOptions = /**
     * @param {?} options
     * @return {?}
     */
    function (options) {
        // 重置文件大小、类型、个数限制
        if (options) {
            for (var prop in options) {
                this[prop] = options[prop];
            }
        }
    };
    /**
     * @param {?} incomingFiles
     * @return {?}
     */
    FFileUploaderService.prototype.handleFiles = /**
     * @param {?} incomingFiles
     * @return {?}
     */
    function (incomingFiles) {
        var _this = this;
        /** @type {?} */
        var allowedIncomingFiles = [].reduce.call(incomingFiles, (/**
         * @param {?} acc
         * @param {?} checkFile
         * @param {?} i
         * @return {?}
         */
        function (acc, checkFile, i) {
            /** @type {?} */
            var futureQueueLength = acc.length + _this.queue.length + 1;
            /** @type {?} */
            var judgeResult = _this.rejectedReason(checkFile.name, checkFile.type, futureQueueLength, checkFile.size);
            if (judgeResult.allowed) {
                acc = acc.concat(checkFile);
            }
            else {
                // 不符合当前文件类型或者内容超出限制，抛出事件
                /** @type {?} */
                var rejectedFile = FFileUtils.makeUploadFile(checkFile, i);
                _this.serviceEvents.emit({
                    type: "rejected",
                    file: rejectedFile,
                    message: judgeResult.message,
                });
            }
            return acc;
        }), []);
        // 构造文件结构，并单个抛出事件
        [].map.call(allowedIncomingFiles, (/**
         * @param {?} file
         * @param {?} i
         * @return {?}
         */
        function (file, i) {
            /** @type {?} */
            var uploadFile = FFileUtils.makeUploadFile(file, i);
            _this.queue.push(uploadFile);
            _this.serviceEvents.emit({ type: "addedToQueue", file: uploadFile });
        }));
        // 所有的文件都已经添加，抛出事件
        this.serviceEvents.emit({ type: "allAddedToQueue" });
    };
    /**
     * @private
     * @param {?} name
     * @param {?} type
     * @param {?} queuelength
     * @param {?} size
     * @return {?}
     */
    FFileUploaderService.prototype.rejectedReason = /**
     * @private
     * @param {?} name
     * @param {?} type
     * @param {?} queuelength
     * @param {?} size
     * @return {?}
     */
    function (name, type, queuelength, size) {
        /** @type {?} */
        var allowed = false;
        /** @type {?} */
        var message = "";
        // 已存在同名文件
        /** @type {?} */
        var findDuplicateIndex = this.queue.findIndex((/**
         * @param {?} file
         * @return {?}
         */
        function (file) { return file.name == name; }));
        if (findDuplicateIndex > -1) {
            message = "上传失败：已存在同名文件";
        }
        else if (!this.isContentTypeAllowed(name)) {
            message =
                "上传失败：只允许上传" +
                    this.allowedContentTypes.join(",") +
                    "类型的文档";
        }
        else if (this.maxUploads > 0 &&
            (this.maxUploads <= this.uploadedCount ||
                queuelength + this.uploadedCount > this.maxUploads)) {
            message = "上传失败：文件总个数超出" + this.maxUploads + "限制";
        }
        else if (!this.isFileSizeAllowed(size)) {
            message = "上传失败：单个文件大小超出" + this.maxFileSize + "MB的限制";
        }
        else if (size == 0) {
            message = "上传失败：不允许文件为空";
        }
        else {
            allowed = true;
        }
        return {
            allowed: allowed,
            message: message,
        };
    };
    /**
     * 从前端传来事件，进行服务器端方法类型判断
     * @param input
     */
    /**
     * 从前端传来事件，进行服务器端方法类型判断
     * @param {?} input
     * @return {?}
     */
    FFileUploaderService.prototype.initInputEvents = /**
     * 从前端传来事件，进行服务器端方法类型判断
     * @param {?} input
     * @return {?}
     */
    function (input) {
        var _this = this;
        //debugger
        return input.subscribe((/**
         * @param {?} event
         * @return {?}
         */
        function (event) {
            //debugger
            switch (event.type) {
                case 'sliceUpload':
                    /** @type {?} */
                    var _files = _this.queue.filter((/**
                     * @param {?} file
                     * @return {?}
                     */
                    function (file) { return file.progress.status === UploadStatus.Queue && (!event.file || file.fileIndex === event.file.fileIndex); }));
                    if (_files.length > 0) {
                        _this.uploadScheduler.next({
                            files: _files,
                            event: event,
                            file: null,
                        });
                    }
                    break;
                case "upload":
                case "multipartUpload":
                    /** @type {?} */
                    var uploadFileIndex = _this.queue.findIndex((/**
                     * @param {?} file
                     * @return {?}
                     */
                    function (file) { return file === event.file; }));
                    if (uploadFileIndex !== -1 && event.file) {
                        _this.uploadScheduler.next({
                            files: [_this.queue[uploadFileIndex]],
                            event: event,
                            file: null,
                        });
                    }
                    break;
                case "uploadAll":
                    /** @type {?} */
                    var files = _this.queue.filter((/**
                     * @param {?} file
                     * @return {?}
                     */
                    function (file) { return file.progress.status === UploadStatus.Queue; }));
                    if (files.length > 0) {
                        event.type = "upload";
                        _this.uploadScheduler.next({
                            files: files,
                            event: event,
                            file: null,
                        });
                    }
                    break;
                case "cancel":
                    /** @type {?} */
                    var id_1 = event.id || null;
                    if (!id_1) {
                        return;
                    }
                    /** @type {?} */
                    var fileIndex = _this.queue.findIndex((/**
                     * @param {?} file
                     * @return {?}
                     */
                    function (file) { return file.id === id_1; }));
                    if (fileIndex !== -1) {
                        _this.serviceEvents.emit({
                            type: "cancelled",
                            files: [_this.queue[fileIndex]],
                            message: "已取消附件上传",
                        });
                        _this.queue.splice(fileIndex, 1);
                    }
                    break;
                    // case 'cancel':
                    // debugger
                    // const id = event.id || null;
                    // if (!id) {
                    //   return;
                    // }
                    // const subs = this.subs.filter(sub => sub.id === id);
                    // subs.forEach(sub => {
                    //   if (sub.sub) {
                    //     sub.sub.unsubscribe();
                    //     const fileIndex = this.queue.findIndex(file => file.id === id);
                    //     if (fileIndex !== -1) {
                    //       this.queue[fileIndex].progress.status = UploadStatus.Cancelled;
                    //       this.serviceEvents.emit({ type: 'cancelled', file: this.queue[fileIndex] });
                    //     }
                    //   }
                    // });
                    break;
                // case 'cancelAll':
                //   this.subs.forEach(sub => {
                //     if (sub.sub) {
                //       sub.sub.unsubscribe();
                //     }
                //     const file = this.queue.find(uploadFile => uploadFile.id === sub.id);
                //     if (file) {
                //       file.progress.status = UploadStatus.Cancelled;
                //       this.serviceEvents.emit({ type: 'cancelled', file: file });
                //     }
                //   });
                //   break;
                case "hide":
                    if (!event.id) {
                        return;
                    }
                    /** @type {?} */
                    var ids_1 = event.id.split(",");
                    _this.queue = _this.queue.filter((/**
                     * @param {?} file
                     * @return {?}
                     */
                    function (file) {
                        /** @type {?} */
                        var tIndex = ids_1.findIndex((/**
                         * @param {?} tId
                         * @return {?}
                         */
                        function (tId) { return tId == file.id; }));
                        return tIndex > -1 ? false : true;
                    }));
                    break;
                case "cancelAll":
                    // 取消，直接从队列中移除，不用修改状态
                    /** @type {?} */
                    var queueFiles = _this.queue.filter((/**
                     * @param {?} uploadFile
                     * @return {?}
                     */
                    function (uploadFile) { return uploadFile.progress.status === UploadStatus.Queue; }));
                    if (queueFiles.length) {
                        _this.serviceEvents.emit({
                            type: "cancelled",
                            files: queueFiles,
                            message: "已取消附件上传",
                        });
                        _this.queue = _this.queue.filter((/**
                         * @param {?} uploadFile
                         * @return {?}
                         */
                        function (uploadFile) { return uploadFile.progress.status != UploadStatus.Queue; }));
                    }
                    break;
                case "remove":
                    if (!event.id) {
                        return;
                    }
                    /** @type {?} */
                    var removeIndex = _this.queue.findIndex((/**
                     * @param {?} file
                     * @return {?}
                     */
                    function (file) { return file.id === event.id; }));
                    if (removeIndex !== -1) {
                        // 得有个开始删除和已经删除
                        _this.queue[removeIndex].progress.status = UploadStatus.Remove;
                        _this.uploadScheduler.next({
                            files: [_this.queue[removeIndex]],
                            event: event,
                            file: null,
                        });
                    }
                    break;
                case "removeAll":
                    /** @type {?} */
                    var removeQueueFiles = _this.queue.filter((/**
                     * @param {?} uploadFile
                     * @return {?}
                     */
                    function (uploadFile) { return uploadFile.progress.status === UploadStatus.Queue; }));
                    if (removeQueueFiles.length) {
                        _this.serviceEvents.emit({
                            type: "cancelled",
                            files: removeQueueFiles,
                            message: "删除附件成功",
                        });
                        _this.queue = _this.queue.filter((/**
                         * @param {?} uploadFile
                         * @return {?}
                         */
                        function (uploadFile) { return uploadFile.progress.status != UploadStatus.Queue; }));
                    }
                    // 正在上传的附件是如何处理
                    // const doneFiles = this.queue.filter(uploadFile => uploadFile.progress.status === UploadStatus.Done);
                    if (_this.queue.length) {
                        event.type = "remove";
                        _this.queue.map((/**
                         * @param {?} item
                         * @return {?}
                         */
                        function (item) { return (item.progress.status = UploadStatus.Remove); }));
                        _this.uploadScheduler.next({
                            files: _this.queue,
                            event: event,
                            file: null,
                        });
                    }
                    break;
            }
        }));
    };
    /**
     * @param {?} extendSer
     * @return {?}
     */
    FFileUploaderService.prototype.setExtendServerConfig = /**
     * @param {?} extendSer
     * @return {?}
     */
    function (extendSer) {
        this.extendServerConfig = extendSer;
    };
    /**
     * @param {?} upload
     * @return {?}
     */
    FFileUploaderService.prototype.serverMethod = /**
     * @param {?} upload
     * @return {?}
     */
    function (upload) {
        var _this = this;
        return new Observable((/**
         * @param {?} observer
         * @return {?}
         */
        function (observer) {
            /** @type {?} */
            var sub;
            /** @type {?} */
            var ids = upload.files.map((/**
             * @param {?} fileItem
             * @return {?}
             */
            function (fileItem) { return fileItem.id; }));
            switch (upload.event.type) {
                case 'sliceUpload':
                    sub = _this.upload(upload.files, upload.event);
                    break;
                case "upload":
                    sub = _this.upload(upload.files, upload.event);
                    break;
                case "multipartUpload":
                    sub = _this.multipartUpload(upload.files[0], upload.event);
                    break;
                // case 'uploadAll':
                //   ids = upload.files.map(fileItem => fileItem.id);
                //   sub = this.uploadAll(upload.files, upload.event);
                //   break;
                case "remove":
                    sub = _this.remove(upload.files, upload.event);
                    break;
                // case 'removeAll':
                //   ids = upload.files.map(fileItem => fileItem.id);
                //   sub = this.removeAll(upload.files, upload.event);
                //   break;
                default:
                    sub = null;
            }
            if (!sub) {
                return;
            }
            sub.pipe(finalize((/**
             * @return {?}
             */
            function () {
                // debugger;
                if (!observer.closed) {
                    observer.complete();
                }
            }))).subscribe((/**
             * @param {?} output
             * @return {?}
             */
            function (output) {
                // debugger;
                observer.next(output);
            }), (/**
             * @param {?} err
             * @return {?}
             */
            function (err) {
                observer.next(err);
            }), (/**
             * @return {?}
             */
            function () {
                observer.complete();
            }));
            _this.subs.push({ ids: ids, sub: sub, id: "" });
            // switch (upload.event.type) {
            //   case 'uploadAll':
            //     this.subs.push({ ids: ids, sub: sub, id: '' });
            //     break;
            //   case 'removeAll':
            //     this.subs.push({ ids: ids, sub: sub, id: '' });
            //     break;
            //   default:
            // }
        }));
    };
    /**
     * 单个文件上传
     * @param file
     * @param event
     */
    // uploadFile(file: UploadFile, event: UploadInput): Observable<UploadOutput> {
    //   const uploadFile = <BlobFile>file.nativeFile;
    //   const uploadIndex = this.queue.findIndex(outFile => outFile.nativeFile === uploadFile);
    //   // 已经被取消的不能被上传
    //   if (this.queue[uploadIndex].progress.status === UploadStatus.Cancelled) {
    //     return new Observable(observer => {
    //       observer.complete();
    //     });
    //   }
    //   // 抛出开始上传的事件
    //   this.serviceEvents.emit({ type: 'start', files: [file] });
    //   return this.uploadServerSer.upload(file, event, this.extendServerConfig);
    // }
    /**
     * 单个文件上传
     * @param {?} file
     * @param {?} event
     * @return {?}
     */
    // uploadFile(file: UploadFile, event: UploadInput): Observable<UploadOutput> {
    //   const uploadFile = <BlobFile>file.nativeFile;
    //   const uploadIndex = this.queue.findIndex(outFile => outFile.nativeFile === uploadFile);
    //   // 已经被取消的不能被上传
    //   if (this.queue[uploadIndex].progress.status === UploadStatus.Cancelled) {
    //     return new Observable(observer => {
    //       observer.complete();
    //     });
    //   }
    //   // 抛出开始上传的事件
    //   this.serviceEvents.emit({ type: 'start', files: [file] });
    //   return this.uploadServerSer.upload(file, event, this.extendServerConfig);
    // }
    FFileUploaderService.prototype.multipartUpload = /**
     * 单个文件上传
     * @param {?} file
     * @param {?} event
     * @return {?}
     */
    // uploadFile(file: UploadFile, event: UploadInput): Observable<UploadOutput> {
    //   const uploadFile = <BlobFile>file.nativeFile;
    //   const uploadIndex = this.queue.findIndex(outFile => outFile.nativeFile === uploadFile);
    //   // 已经被取消的不能被上传
    //   if (this.queue[uploadIndex].progress.status === UploadStatus.Cancelled) {
    //     return new Observable(observer => {
    //       observer.complete();
    //     });
    //   }
    //   // 抛出开始上传的事件
    //   this.serviceEvents.emit({ type: 'start', files: [file] });
    //   return this.uploadServerSer.upload(file, event, this.extendServerConfig);
    // }
    function (file, event) {
        // 抛出开始上传的事件
        this.serviceEvents.emit({ type: "start", files: [file] });
        return this.uploadServerSer.multipartUpload(file, event, this.extendServerConfig);
    };
    /**
     * @param {?} files
     * @param {?} event
     * @return {?}
     */
    FFileUploaderService.prototype.upload = /**
     * @param {?} files
     * @param {?} event
     * @return {?}
     */
    function (files, event) {
        // 抛出开始上传的事件
        this.serviceEvents.emit({ type: "start", files: files });
        return this.uploadServerSer.upload(files, event, this.extendServerConfig);
    };
    /**
     * @param {?} files
     * @param {?} event
     * @return {?}
     */
    FFileUploaderService.prototype.remove = /**
     * @param {?} files
     * @param {?} event
     * @return {?}
     */
    function (files, event) {
        return this.uploadServerSer.remove(files, event, this.extendServerConfig);
    };
    // removeAll(files: UploadFile[], event: UploadInput): Observable<UploadOutput> {
    //   return this.uploadServerSer.removeAll(files, event, this.extendServerConfig);
    // }
    // 重置
    // removeAll(files: UploadFile[], event: UploadInput): Observable<UploadOutput> {
    //   return this.uploadServerSer.removeAll(files, event, this.extendServerConfig);
    // }
    // 重置
    /**
     * @return {?}
     */
    FFileUploaderService.prototype.reset = 
    // removeAll(files: UploadFile[], event: UploadInput): Observable<UploadOutput> {
    //   return this.uploadServerSer.removeAll(files, event, this.extendServerConfig);
    // }
    // 重置
    /**
     * @return {?}
     */
    function () {
        this.queue = [];
        //this.uploadScheduler = new Subject();
        // this.subs.forEach(sub => {
        //   if (sub.sub) {
        //     sub.sub.unsubscribe();
        //   }
        // });
        this.subs = [];
    };
    // 暂时
    // 暂时
    /**
     * @param {?} contentTypes
     * @return {?}
     */
    FFileUploaderService.prototype.setContentTypes = 
    // 暂时
    /**
     * @param {?} contentTypes
     * @return {?}
     */
    function (contentTypes) {
        if (typeof contentTypes !== "undefined" && contentTypes instanceof Array) {
            if (contentTypes.find((/**
             * @param {?} type
             * @return {?}
             */
            function (type) { return type === "*"; })) !== undefined) {
                this.allowedContentTypes = ["*"];
            }
            else {
                this.allowedContentTypes = contentTypes;
            }
            return;
        }
        this.allowedContentTypes = ["*"];
    };
    /**
     * @return {?}
     */
    FFileUploaderService.prototype.allContentTypesAllowed = /**
     * @return {?}
     */
    function () {
        return (this.allowedContentTypes.find((/**
         * @param {?} type
         * @return {?}
         */
        function (type) { return type === "*"; })) !==
            undefined);
    };
    /**
     *
     * @param name
     */
    /**
     *
     * @param {?} name
     * @return {?}
     */
    FFileUploaderService.prototype.isContentTypeAllowed = /**
     *
     * @param {?} name
     * @return {?}
     */
    function (name) {
        if (this.allContentTypesAllowed()) {
            return true;
        }
        // 附件没有后缀
        if (name.lastIndexOf(".") < 0) {
            return false;
        }
        /** @type {?} */
        var namesuffix = name.substr(name.lastIndexOf("."));
        // 简化计算
        return (this.allowedContentTypes.findIndex((/**
         * @param {?} item
         * @return {?}
         */
        function (item) { return item.toLowerCase() == namesuffix.toLowerCase(); })) > -1);
    };
    /**
     * @param {?} fileSize
     * @return {?}
     */
    FFileUploaderService.prototype.isFileSizeAllowed = /**
     * @param {?} fileSize
     * @return {?}
     */
    function (fileSize) {
        if (!this.maxFileSize) {
            return true;
        }
        // fileSize是b单位 maxFileSize是MB单位
        return fileSize <= this.maxFileSize * 1024 * 1024; // * 8
    };
    /** @nocollapse */
    FFileUploaderService.ctorParameters = function () { return [
        { type: UploadServerService, decorators: [{ type: Optional }] }
    ]; };
    return FFileUploaderService;
}());
export { FFileUploaderService };
if (false) {
    /** @type {?} */
    FFileUploaderService.prototype.queue;
    /** @type {?} */
    FFileUploaderService.prototype.serviceEvents;
    /** @type {?} */
    FFileUploaderService.prototype.uploadScheduler;
    /** @type {?} */
    FFileUploaderService.prototype.subs;
    /** @type {?} */
    FFileUploaderService.prototype.allowedContentTypes;
    /** @type {?} */
    FFileUploaderService.prototype.maxUploads;
    /**
     * 单位M，默认是12M,0代表不限制
     * @type {?}
     */
    FFileUploaderService.prototype.maxFileSize;
    /** @type {?} */
    FFileUploaderService.prototype.concurrency;
    /** @type {?} */
    FFileUploaderService.prototype.uploadedCount;
    /**
     * @type {?}
     * @private
     */
    FFileUploaderService.prototype.extendServerConfig;
    /**
     * @type {?}
     * @private
     */
    FFileUploaderService.prototype.uploadServerSer;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZi1maWxlLXVwbG9hZGVyLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2V4dGVuZC1maWxlLXVwbG9hZC8iLCJzb3VyY2VzIjpbImxpYi9zZXJ2aWNlL2YtZmlsZS11cGxvYWRlci5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFlBQVksRUFBRSxRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDdkQsT0FBTyxFQUFFLFVBQVUsRUFBRSxPQUFPLEVBQW9CLE1BQU0sTUFBTSxDQUFDO0FBQzdELE9BQU8sRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDcEQsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzVDLE9BQU8sRUFJSCxZQUFZLEVBRVosbUJBQW1CLEdBRXRCLE1BQU0sZ0JBQWdCLENBQUM7QUFHeEI7SUFpQkksOEJBQWdDLGVBQW9DO1FBQXBFLGlCQXlDQztRQXpDK0Isb0JBQWUsR0FBZixlQUFlLENBQXFCO1FBUnBFLHdCQUFtQixHQUFhLENBQUMsR0FBRyxDQUFDLENBQUM7O1FBRXRDLGVBQVUsR0FBVyxDQUFDLENBQUM7Ozs7UUFFdkIsZ0JBQVcsR0FBVyxFQUFFLENBQUM7UUFDekIsZ0JBQVcsR0FBVyxNQUFNLENBQUMsaUJBQWlCLENBQUM7UUFDL0Msa0JBQWEsR0FBVyxDQUFDLENBQUM7UUFDbEIsdUJBQWtCLEdBQUcsSUFBSSxDQUFDO1FBRTlCLElBQUksQ0FBQyxLQUFLLEdBQUcsRUFBRSxDQUFDO1FBQ2hCLElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSxZQUFZLEVBQWdCLENBQUM7UUFDdEQsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLE9BQU8sRUFBRSxDQUFDO1FBQ3JDLElBQUksQ0FBQyxJQUFJLEdBQUcsRUFBRSxDQUFDO1FBRWYsSUFBSSxDQUFDLGVBQWU7YUFDZixJQUFJLENBQ0QsUUFBUTs7OztRQUFD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Q0FBQztTQUNmO1FBQ0QsU0FBUztRQUNULElBQUksSUFBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEVBQUU7WUFDM0IsT0FBTyxLQUFLLENBQUM7U0FDaEI7O1lBQ0csVUFBVSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNuRCxPQUFPO1FBQ1AsT0FBTyxDQUNILElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxTQUFTOzs7O1FBQzlCLFVBQUMsSUFBSSxJQUFLLE9BQUEsSUFBSSxDQUFDLFdBQVcsRUFBRSxJQUFJLFVBQVUsQ0FBQyxXQUFXLEVBQUUsRUFBOUMsQ0FBOEMsRUFDM0QsR0FBRyxDQUFDLENBQUMsQ0FDVCxDQUFDO0lBQ04sQ0FBQzs7Ozs7SUFFRCxnREFBaUI7Ozs7SUFBakIsVUFBa0IsUUFBZ0I7UUFDOUIsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUU7WUFDbkIsT0FBTyxJQUFJLENBQUM7U0FDZjtRQUNELGdDQUFnQztRQUNoQyxPQUFPLFFBQVEsSUFBSSxJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksR0FBRyxJQUFJLENBQUMsQ0FBQyxNQUFNO0lBQzdELENBQUM7OztnQkFqZUQsbUJBQW1CLHVCQXNCTixRQUFROztJQTRjekIsMkJBQUM7Q0FBQSxBQTdkRCxJQTZkQztTQTdkWSxvQkFBb0I7OztJQUM3QixxQ0FBb0I7O0lBQ3BCLDZDQUEwQzs7SUFDMUMsK0NBSUc7O0lBQ0gsb0NBQTBEOztJQUMxRCxtREFBc0M7O0lBRXRDLDBDQUF1Qjs7Ozs7SUFFdkIsMkNBQXlCOztJQUN6QiwyQ0FBK0M7O0lBQy9DLDZDQUEwQjs7Ozs7SUFDMUIsa0RBQWtDOzs7OztJQUN0QiwrQ0FBd0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFdmVudEVtaXR0ZXIsIE9wdGlvbmFsIH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgU3ViamVjdCwgU3Vic2NyaXB0aW9uLCBvZiB9IGZyb20gXCJyeGpzXCI7XHJcbmltcG9ydCB7IG1lcmdlTWFwLCBmaW5hbGl6ZSB9IGZyb20gXCJyeGpzL29wZXJhdG9yc1wiO1xyXG5pbXBvcnQgeyBGRmlsZVV0aWxzIH0gZnJvbSBcIi4uL3V0aWxzL2luZGV4XCI7XHJcbmltcG9ydCB7XHJcbiAgICBVcGxvYWRGaWxlLFxyXG4gICAgVXBsb2FkT3V0cHV0LFxyXG4gICAgVXBsb2FkSW5wdXQsXHJcbiAgICBVcGxvYWRTdGF0dXMsXHJcbiAgICBCbG9iRmlsZSxcclxuICAgIFVwbG9hZFNlcnZlclNlcnZpY2UsXHJcbiAgICBVcGxvYWRlck9wdGlvbnMsXHJcbn0gZnJvbSBcIi4uL21vZGVsL2luZGV4XCI7XHJcbmltcG9ydCAqIGFzIGUgZnJvbSBcImV4cHJlc3NcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBGRmlsZVVwbG9hZGVyU2VydmljZSB7XHJcbiAgICBxdWV1ZTogVXBsb2FkRmlsZVtdO1xyXG4gICAgc2VydmljZUV2ZW50czogRXZlbnRFbWl0dGVyPFVwbG9hZE91dHB1dD47XHJcbiAgICB1cGxvYWRTY2hlZHVsZXI6IFN1YmplY3Q8e1xyXG4gICAgICAgIGZpbGU6IFVwbG9hZEZpbGU7XHJcbiAgICAgICAgZXZlbnQ6IFVwbG9hZElucHV0O1xyXG4gICAgICAgIGZpbGVzPzogVXBsb2FkRmlsZVtdO1xyXG4gICAgfT47XHJcbiAgICBzdWJzOiB7IGlkOiBzdHJpbmc7IHN1YjogU3Vic2NyaXB0aW9uOyBpZHM/OiBzdHJpbmdbXSB9W107XHJcbiAgICBhbGxvd2VkQ29udGVudFR5cGVzOiBzdHJpbmdbXSA9IFtcIipcIl07XHJcbiAgICAvL+m7mOiupOS4jemZkOWItiww5Luj6KGo5LiN6ZmQ5Yi2IE51bWJlci5QT1NJVElWRV9JTkZJTklUWVxyXG4gICAgbWF4VXBsb2FkczogbnVtYmVyID0gMDtcclxuICAgIC8qKiDljZXkvY1N77yM6buY6K6k5pivMTJNLDDku6PooajkuI3pmZDliLYgKi9cclxuICAgIG1heEZpbGVTaXplOiBudW1iZXIgPSAxMjtcclxuICAgIGNvbmN1cnJlbmN5OiBudW1iZXIgPSBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFk7XHJcbiAgICB1cGxvYWRlZENvdW50OiBudW1iZXIgPSAwO1xyXG4gICAgcHJpdmF0ZSBleHRlbmRTZXJ2ZXJDb25maWcgPSBudWxsO1xyXG4gICAgY29uc3RydWN0b3IoQE9wdGlvbmFsKCkgcHJpdmF0ZSB1cGxvYWRTZXJ2ZXJTZXI6IFVwbG9hZFNlcnZlclNlcnZpY2UpIHtcclxuICAgICAgICB0aGlzLnF1ZXVlID0gW107XHJcbiAgICAgICAgdGhpcy5zZXJ2aWNlRXZlbnRzID0gbmV3IEV2ZW50RW1pdHRlcjxVcGxvYWRPdXRwdXQ+KCk7XHJcbiAgICAgICAgdGhpcy51cGxvYWRTY2hlZHVsZXIgPSBuZXcgU3ViamVjdCgpO1xyXG4gICAgICAgIHRoaXMuc3VicyA9IFtdO1xyXG5cclxuICAgICAgICB0aGlzLnVwbG9hZFNjaGVkdWxlclxyXG4gICAgICAgICAgICAucGlwZShcclxuICAgICAgICAgICAgICAgIG1lcmdlTWFwKCh1cGxvYWQpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zZXJ2ZXJNZXRob2QodXBsb2FkKTtcclxuICAgICAgICAgICAgICAgIH0sIHRoaXMuY29uY3VycmVuY3kpXHJcbiAgICAgICAgICAgIClcclxuICAgICAgICAgICAgLnN1YnNjcmliZSgodXBsb2FkT3V0cHV0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAvLyBpZiAodXBsb2FkT3V0cHV0LnR5cGUgPT0gJ3JlbW92ZWQnIHx8IHVwbG9hZE91dHB1dC50eXBlID09ICdkb25lJykge1xyXG4gICAgICAgICAgICAgICAgLy8gICAvLyDliKDpmaTmiJbogIVkb25l56e76ZmkXHJcbiAgICAgICAgICAgICAgICAvLyAgIGNvbnN0IHN1YkluZGV4ID0gdGhpcy5zdWJzLmZpbmRJbmRleChzdWIgPT4gc3ViLmlkID09PSB1cGxvYWRPdXRwdXQuZmlsZS5pZCk7XHJcbiAgICAgICAgICAgICAgICAvLyAgIGlmIChzdWJJbmRleCA+IC0xICYmIHRoaXMuc3Vic1tzdWJJbmRleF0uc3ViKSB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgdGhpcy5zdWJzW3N1YkluZGV4XS5zdWIudW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgICAgIC8vICAgfVxyXG4gICAgICAgICAgICAgICAgLy8gICB0aGlzLnN1YnMuc3BsaWNlKHN1YkluZGV4LCAxKTtcclxuICAgICAgICAgICAgICAgIC8vIH1cclxuICAgICAgICAgICAgICAgIGlmICh1cGxvYWRPdXRwdXQudHlwZSA9PSBcInJlbW92ZWRcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIOS6i+S7tuS4rei/lOWbnueahOmDveaYr1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucXVldWUgPSB0aGlzLnF1ZXVlLmZpbHRlcihcclxuICAgICAgICAgICAgICAgICAgICAgICAgKGl0ZW0pID0+IGl0ZW0ucHJvZ3Jlc3Muc3RhdHVzICE9PSBVcGxvYWRTdGF0dXMuUmVtb3ZlXHJcbiAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIXVwbG9hZE91dHB1dC5oYXNPd25Qcm9wZXJ0eShcIm1lc3NhZ2VcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXBsb2FkT3V0cHV0W1wibWVzc2FnZVwiXSA9IFwi6KKr5Yig6ZmkXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHVwbG9hZE91dHB1dC50eXBlID09IFwiZXJyb3JcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIOS4iuS8oOWksei0peeahOmZhOS7tuenu+mZpFxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucXVldWUgPSB0aGlzLnF1ZXVlLmZpbHRlcigocXVldWVJdGVtKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWRPdXRwdXQuZmlsZXMuZmluZEluZGV4KChpdGVtKSA9PiBxdWV1ZUl0ZW0uaWQgPT0gaXRlbS5pZCkgPFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgMFxyXG4gICAgICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXJ2aWNlRXZlbnRzLmVtaXQodXBsb2FkT3V0cHV0KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBzZXRPcHRpb25zKG9wdGlvbnM6IFVwbG9hZGVyT3B0aW9ucykge1xyXG4gICAgICAgIC8vIOmHjee9ruaWh+S7tuWkp+Wwj+OAgeexu+Wei+OAgeS4quaVsOmZkOWItlxyXG4gICAgICAgIGlmIChvcHRpb25zKSB7XHJcbiAgICAgICAgICAgIGZvciAobGV0IHByb3AgaW4gb3B0aW9ucykge1xyXG4gICAgICAgICAgICAgICAgdGhpc1twcm9wXSA9IG9wdGlvbnNbcHJvcF07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBoYW5kbGVGaWxlcyhpbmNvbWluZ0ZpbGVzOiBGaWxlTGlzdCk6IHZvaWQge1xyXG4gICAgICAgIGNvbnN0IGFsbG93ZWRJbmNvbWluZ0ZpbGVzOiBGaWxlW10gPSBbXS5yZWR1Y2UuY2FsbChcclxuICAgICAgICAgICAgaW5jb21pbmdGaWxlcyxcclxuICAgICAgICAgICAgKGFjYzogRmlsZVtdLCBjaGVja0ZpbGU6IEZpbGUsIGk6IG51bWJlcikgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZnV0dXJlUXVldWVMZW5ndGggPSBhY2MubGVuZ3RoICsgdGhpcy5xdWV1ZS5sZW5ndGggKyAxO1xyXG4gICAgICAgICAgICAgICAgbGV0IGp1ZGdlUmVzdWx0ID0gdGhpcy5yZWplY3RlZFJlYXNvbihcclxuICAgICAgICAgICAgICAgICAgICBjaGVja0ZpbGUubmFtZSxcclxuICAgICAgICAgICAgICAgICAgICBjaGVja0ZpbGUudHlwZSxcclxuICAgICAgICAgICAgICAgICAgICBmdXR1cmVRdWV1ZUxlbmd0aCxcclxuICAgICAgICAgICAgICAgICAgICBjaGVja0ZpbGUuc2l6ZVxyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgIGlmIChqdWRnZVJlc3VsdC5hbGxvd2VkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYWNjID0gYWNjLmNvbmNhdChjaGVja0ZpbGUpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyDkuI3nrKblkIjlvZPliY3mlofku7bnsbvlnovmiJbogIXlhoXlrrnotoXlh7rpmZDliLbvvIzmipvlh7rkuovku7ZcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCByZWplY3RlZEZpbGU6IFVwbG9hZEZpbGUgPSBGRmlsZVV0aWxzLm1ha2VVcGxvYWRGaWxlKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGVja0ZpbGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlcclxuICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VydmljZUV2ZW50cy5lbWl0KHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJyZWplY3RlZFwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWxlOiByZWplY3RlZEZpbGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGp1ZGdlUmVzdWx0Lm1lc3NhZ2UsXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYWNjO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBbXVxyXG4gICAgICAgICk7XHJcblxyXG4gICAgICAgIC8vIOaehOmAoOaWh+S7tue7k+aehO+8jOW5tuWNleS4quaKm+WHuuS6i+S7tlxyXG4gICAgICAgIFtdLm1hcC5jYWxsKGFsbG93ZWRJbmNvbWluZ0ZpbGVzLCAoZmlsZTogRmlsZSwgaTogbnVtYmVyKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHVwbG9hZEZpbGU6IFVwbG9hZEZpbGUgPSBGRmlsZVV0aWxzLm1ha2VVcGxvYWRGaWxlKGZpbGUsIGkpO1xyXG4gICAgICAgICAgICB0aGlzLnF1ZXVlLnB1c2godXBsb2FkRmlsZSk7XHJcbiAgICAgICAgICAgIHRoaXMuc2VydmljZUV2ZW50cy5lbWl0KHsgdHlwZTogXCJhZGRlZFRvUXVldWVcIiwgZmlsZTogdXBsb2FkRmlsZSB9KTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8g5omA5pyJ55qE5paH5Lu26YO95bey57uP5re75Yqg77yM5oqb5Ye65LqL5Lu2XHJcbiAgICAgICAgdGhpcy5zZXJ2aWNlRXZlbnRzLmVtaXQoeyB0eXBlOiBcImFsbEFkZGVkVG9RdWV1ZVwiIH0pO1xyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSByZWplY3RlZFJlYXNvbihuYW1lLCB0eXBlLCBxdWV1ZWxlbmd0aCwgc2l6ZSkge1xyXG4gICAgICAgIGxldCBhbGxvd2VkID0gZmFsc2U7XHJcbiAgICAgICAgbGV0IG1lc3NhZ2UgPSBcIlwiO1xyXG4gICAgICAgIC8vIOW3suWtmOWcqOWQjOWQjeaWh+S7tlxyXG4gICAgICAgIGxldCBmaW5kRHVwbGljYXRlSW5kZXggPSB0aGlzLnF1ZXVlLmZpbmRJbmRleCgoZmlsZSkgPT4gZmlsZS5uYW1lID09IG5hbWUpO1xyXG4gICAgICAgIGlmIChmaW5kRHVwbGljYXRlSW5kZXggPiAtMSkge1xyXG4gICAgICAgICAgICBtZXNzYWdlID0gXCLkuIrkvKDlpLHotKXvvJrlt7LlrZjlnKjlkIzlkI3mlofku7ZcIjtcclxuICAgICAgICB9IGVsc2UgaWYgKCF0aGlzLmlzQ29udGVudFR5cGVBbGxvd2VkKG5hbWUpKSB7XHJcbiAgICAgICAgICAgIG1lc3NhZ2UgPVxyXG4gICAgICAgICAgICAgICAgXCLkuIrkvKDlpLHotKXvvJrlj6rlhYHorrjkuIrkvKBcIiArXHJcbiAgICAgICAgICAgICAgICB0aGlzLmFsbG93ZWRDb250ZW50VHlwZXMuam9pbihcIixcIikgK1xyXG4gICAgICAgICAgICAgICAgXCLnsbvlnovnmoTmlofmoaNcIjtcclxuICAgICAgICB9IGVsc2UgaWYgKFxyXG4gICAgICAgICAgICB0aGlzLm1heFVwbG9hZHMgPiAwICYmXHJcbiAgICAgICAgICAgICh0aGlzLm1heFVwbG9hZHMgPD0gdGhpcy51cGxvYWRlZENvdW50IHx8XHJcbiAgICAgICAgICAgICAgICBxdWV1ZWxlbmd0aCArIHRoaXMudXBsb2FkZWRDb3VudCA+IHRoaXMubWF4VXBsb2FkcylcclxuICAgICAgICApIHtcclxuICAgICAgICAgICAgbWVzc2FnZSA9IFwi5LiK5Lyg5aSx6LSl77ya5paH5Lu25oC75Liq5pWw6LaF5Ye6XCIgKyB0aGlzLm1heFVwbG9hZHMgKyBcIumZkOWItlwiO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoIXRoaXMuaXNGaWxlU2l6ZUFsbG93ZWQoc2l6ZSkpIHtcclxuICAgICAgICAgICAgbWVzc2FnZSA9IFwi5LiK5Lyg5aSx6LSl77ya5Y2V5Liq5paH5Lu25aSn5bCP6LaF5Ye6XCIgKyB0aGlzLm1heEZpbGVTaXplICsgXCJNQueahOmZkOWItlwiO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoc2l6ZSA9PSAwKSB7XHJcbiAgICAgICAgICAgIG1lc3NhZ2UgPSBcIuS4iuS8oOWksei0pe+8muS4jeWFgeiuuOaWh+S7tuS4uuepulwiO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGFsbG93ZWQgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBhbGxvd2VkLFxyXG4gICAgICAgICAgICBtZXNzYWdlLFxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOS7juWJjeerr+S8oOadpeS6i+S7tu+8jOi/m+ihjOacjeWKoeWZqOerr+aWueazleexu+Wei+WIpOaWrVxyXG4gICAgICogQHBhcmFtIGlucHV0XHJcbiAgICAgKi9cclxuICAgIGluaXRJbnB1dEV2ZW50cyhpbnB1dDogRXZlbnRFbWl0dGVyPFVwbG9hZElucHV0Pik6IFN1YnNjcmlwdGlvbiB7XHJcbiAgICAgICAgLy9kZWJ1Z2dlclxyXG4gICAgICAgIHJldHVybiBpbnB1dC5zdWJzY3JpYmUoKGV2ZW50OiBVcGxvYWRJbnB1dCkgPT4ge1xyXG4gICAgICAgICAgICAvL2RlYnVnZ2VyXHJcbiAgICAgICAgICAgIHN3aXRjaCAoZXZlbnQudHlwZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnc2xpY2VVcGxvYWQnOlxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IF9maWxlcyA9IHRoaXMucXVldWUuZmlsdGVyKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAoZmlsZSkgPT4gZmlsZS5wcm9ncmVzcy5zdGF0dXMgPT09IFVwbG9hZFN0YXR1cy5RdWV1ZSAmJiAoIWV2ZW50LmZpbGUgfHwgZmlsZS5maWxlSW5kZXggPT09IGV2ZW50LmZpbGUuZmlsZUluZGV4IClcclxuICAgICAgICAgICAgICAgICAgICApO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoX2ZpbGVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51cGxvYWRTY2hlZHVsZXIubmV4dCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlczogX2ZpbGVzLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQ6IGV2ZW50LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZTogbnVsbCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBcInVwbG9hZFwiOlxyXG4gICAgICAgICAgICAgICAgY2FzZSBcIm11bHRpcGFydFVwbG9hZFwiOlxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHVwbG9hZEZpbGVJbmRleCA9IHRoaXMucXVldWUuZmluZEluZGV4KFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAoZmlsZSkgPT4gZmlsZSA9PT0gZXZlbnQuZmlsZVxyXG4gICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHVwbG9hZEZpbGVJbmRleCAhPT0gLTEgJiYgZXZlbnQuZmlsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVwbG9hZFNjaGVkdWxlci5uZXh0KHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVzOiBbdGhpcy5xdWV1ZVt1cGxvYWRGaWxlSW5kZXhdXSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50OiBldmVudCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGU6IG51bGwsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgXCJ1cGxvYWRBbGxcIjpcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWxlcyA9IHRoaXMucXVldWUuZmlsdGVyKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAoZmlsZSkgPT4gZmlsZS5wcm9ncmVzcy5zdGF0dXMgPT09IFVwbG9hZFN0YXR1cy5RdWV1ZVxyXG4gICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQudHlwZSA9IFwidXBsb2FkXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudXBsb2FkU2NoZWR1bGVyLm5leHQoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZXM6IGZpbGVzLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQ6IGV2ZW50LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZTogbnVsbCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBcImNhbmNlbFwiOlxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGlkID0gZXZlbnQuaWQgfHwgbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIWlkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZmlsZUluZGV4ID0gdGhpcy5xdWV1ZS5maW5kSW5kZXgoKGZpbGUpID0+IGZpbGUuaWQgPT09IGlkKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZmlsZUluZGV4ICE9PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlcnZpY2VFdmVudHMuZW1pdCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImNhbmNlbGxlZFwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZXM6IFt0aGlzLnF1ZXVlW2ZpbGVJbmRleF1dLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogXCLlt7Llj5bmtojpmYTku7bkuIrkvKBcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucXVldWUuc3BsaWNlKGZpbGVJbmRleCwgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGNhc2UgJ2NhbmNlbCc6XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gZGVidWdnZXJcclxuICAgICAgICAgICAgICAgICAgICAvLyBjb25zdCBpZCA9IGV2ZW50LmlkIHx8IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgKCFpZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIH1cclxuICAgICAgICAgICAgICAgICAgICAvLyBjb25zdCBzdWJzID0gdGhpcy5zdWJzLmZpbHRlcihzdWIgPT4gc3ViLmlkID09PSBpZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gc3Vicy5mb3JFYWNoKHN1YiA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gICBpZiAoc3ViLnN1Yikge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vICAgICBzdWIuc3ViLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgIGNvbnN0IGZpbGVJbmRleCA9IHRoaXMucXVldWUuZmluZEluZGV4KGZpbGUgPT4gZmlsZS5pZCA9PT0gaWQpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vICAgICBpZiAoZmlsZUluZGV4ICE9PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vICAgICAgIHRoaXMucXVldWVbZmlsZUluZGV4XS5wcm9ncmVzcy5zdGF0dXMgPSBVcGxvYWRTdGF0dXMuQ2FuY2VsbGVkO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vICAgICAgIHRoaXMuc2VydmljZUV2ZW50cy5lbWl0KHsgdHlwZTogJ2NhbmNlbGxlZCcsIGZpbGU6IHRoaXMucXVldWVbZmlsZUluZGV4XSB9KTtcclxuICAgICAgICAgICAgICAgICAgICAvLyAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIC8vICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIC8vIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgLy8gY2FzZSAnY2FuY2VsQWxsJzpcclxuICAgICAgICAgICAgICAgIC8vICAgdGhpcy5zdWJzLmZvckVhY2goc3ViID0+IHtcclxuICAgICAgICAgICAgICAgIC8vICAgICBpZiAoc3ViLnN1Yikge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgc3ViLnN1Yi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICAgICAgLy8gICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyAgICAgY29uc3QgZmlsZSA9IHRoaXMucXVldWUuZmluZCh1cGxvYWRGaWxlID0+IHVwbG9hZEZpbGUuaWQgPT09IHN1Yi5pZCk7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgaWYgKGZpbGUpIHtcclxuICAgICAgICAgICAgICAgIC8vICAgICAgIGZpbGUucHJvZ3Jlc3Muc3RhdHVzID0gVXBsb2FkU3RhdHVzLkNhbmNlbGxlZDtcclxuICAgICAgICAgICAgICAgIC8vICAgICAgIHRoaXMuc2VydmljZUV2ZW50cy5lbWl0KHsgdHlwZTogJ2NhbmNlbGxlZCcsIGZpbGU6IGZpbGUgfSk7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy8gICB9KTtcclxuICAgICAgICAgICAgICAgIC8vICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwiaGlkZVwiOlxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghZXZlbnQuaWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBsZXQgaWRzID0gZXZlbnQuaWQuc3BsaXQoXCIsXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucXVldWUgPSB0aGlzLnF1ZXVlLmZpbHRlcigoZmlsZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgdEluZGV4ID0gaWRzLmZpbmRJbmRleCgodElkKSA9PiB0SWQgPT0gZmlsZS5pZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0SW5kZXggPiAtMSA/IGZhbHNlIDogdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgXCJjYW5jZWxBbGxcIjpcclxuICAgICAgICAgICAgICAgICAgICAvLyDlj5bmtojvvIznm7TmjqXku47pmJ/liJfkuK3np7vpmaTvvIzkuI3nlKjkv67mlLnnirbmgIFcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBxdWV1ZUZpbGVzID0gdGhpcy5xdWV1ZS5maWx0ZXIoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICh1cGxvYWRGaWxlKSA9PiB1cGxvYWRGaWxlLnByb2dyZXNzLnN0YXR1cyA9PT0gVXBsb2FkU3RhdHVzLlF1ZXVlXHJcbiAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocXVldWVGaWxlcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXJ2aWNlRXZlbnRzLmVtaXQoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJjYW5jZWxsZWRcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVzOiBxdWV1ZUZpbGVzLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogXCLlt7Llj5bmtojpmYTku7bkuIrkvKBcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucXVldWUgPSB0aGlzLnF1ZXVlLmZpbHRlcihcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICh1cGxvYWRGaWxlKSA9PiB1cGxvYWRGaWxlLnByb2dyZXNzLnN0YXR1cyAhPSBVcGxvYWRTdGF0dXMuUXVldWVcclxuICAgICAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwicmVtb3ZlXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFldmVudC5pZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlbW92ZUluZGV4ID0gdGhpcy5xdWV1ZS5maW5kSW5kZXgoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIChmaWxlKSA9PiBmaWxlLmlkID09PSBldmVudC5pZFxyXG4gICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlbW92ZUluZGV4ICE9PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyDlvpfmnInkuKrlvIDlp4vliKDpmaTlkozlt7Lnu4/liKDpmaRcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5xdWV1ZVtyZW1vdmVJbmRleF0ucHJvZ3Jlc3Muc3RhdHVzID0gVXBsb2FkU3RhdHVzLlJlbW92ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51cGxvYWRTY2hlZHVsZXIubmV4dCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlczogW3RoaXMucXVldWVbcmVtb3ZlSW5kZXhdXSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50OiBldmVudCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGU6IG51bGwsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgXCJyZW1vdmVBbGxcIjpcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCByZW1vdmVRdWV1ZUZpbGVzID0gdGhpcy5xdWV1ZS5maWx0ZXIoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICh1cGxvYWRGaWxlKSA9PiB1cGxvYWRGaWxlLnByb2dyZXNzLnN0YXR1cyA9PT0gVXBsb2FkU3RhdHVzLlF1ZXVlXHJcbiAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVtb3ZlUXVldWVGaWxlcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXJ2aWNlRXZlbnRzLmVtaXQoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJjYW5jZWxsZWRcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVzOiByZW1vdmVRdWV1ZUZpbGVzLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogXCLliKDpmaTpmYTku7bmiJDlip9cIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucXVldWUgPSB0aGlzLnF1ZXVlLmZpbHRlcihcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICh1cGxvYWRGaWxlKSA9PiB1cGxvYWRGaWxlLnByb2dyZXNzLnN0YXR1cyAhPSBVcGxvYWRTdGF0dXMuUXVldWVcclxuICAgICAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgLy8g5q2j5Zyo5LiK5Lyg55qE6ZmE5Lu25piv5aaC5L2V5aSE55CGXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gY29uc3QgZG9uZUZpbGVzID0gdGhpcy5xdWV1ZS5maWx0ZXIodXBsb2FkRmlsZSA9PiB1cGxvYWRGaWxlLnByb2dyZXNzLnN0YXR1cyA9PT0gVXBsb2FkU3RhdHVzLkRvbmUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnF1ZXVlLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBldmVudC50eXBlID0gXCJyZW1vdmVcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5xdWV1ZS5tYXAoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoaXRlbSkgPT4gKGl0ZW0ucHJvZ3Jlc3Muc3RhdHVzID0gVXBsb2FkU3RhdHVzLlJlbW92ZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51cGxvYWRTY2hlZHVsZXIubmV4dCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlczogdGhpcy5xdWV1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50OiBldmVudCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGU6IG51bGwsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHNldEV4dGVuZFNlcnZlckNvbmZpZyhleHRlbmRTZXIpIHtcclxuICAgICAgICB0aGlzLmV4dGVuZFNlcnZlckNvbmZpZyA9IGV4dGVuZFNlcjtcclxuICAgIH1cclxuXHJcbiAgICBzZXJ2ZXJNZXRob2QodXBsb2FkOiB7XHJcbiAgICAgICAgZmlsZTogVXBsb2FkRmlsZTtcclxuICAgICAgICBldmVudDogVXBsb2FkSW5wdXQ7XHJcbiAgICAgICAgZmlsZXM/OiBVcGxvYWRGaWxlW107XHJcbiAgICB9KTogT2JzZXJ2YWJsZTxVcGxvYWRPdXRwdXQ+IHtcclxuICAgICAgICByZXR1cm4gbmV3IE9ic2VydmFibGUoKG9ic2VydmVyKSA9PiB7XHJcbiAgICAgICAgICAgIGxldCBzdWI7XHJcbiAgICAgICAgICAgIGxldCBpZHMgPSB1cGxvYWQuZmlsZXMubWFwKChmaWxlSXRlbSkgPT4gZmlsZUl0ZW0uaWQpO1xyXG4gICAgICAgICAgICBzd2l0Y2ggKHVwbG9hZC5ldmVudC50eXBlKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdzbGljZVVwbG9hZCc6XHJcbiAgICAgICAgICAgICAgICAgICAgc3ViID0gdGhpcy51cGxvYWQodXBsb2FkLmZpbGVzLCB1cGxvYWQuZXZlbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBcInVwbG9hZFwiOlxyXG4gICAgICAgICAgICAgICAgICAgIHN1YiA9IHRoaXMudXBsb2FkKHVwbG9hZC5maWxlcywgdXBsb2FkLmV2ZW50KTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgXCJtdWx0aXBhcnRVcGxvYWRcIjpcclxuICAgICAgICAgICAgICAgICAgICBzdWIgPSB0aGlzLm11bHRpcGFydFVwbG9hZCh1cGxvYWQuZmlsZXNbMF0sIHVwbG9hZC5ldmVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAvLyBjYXNlICd1cGxvYWRBbGwnOlxyXG4gICAgICAgICAgICAgICAgLy8gICBpZHMgPSB1cGxvYWQuZmlsZXMubWFwKGZpbGVJdGVtID0+IGZpbGVJdGVtLmlkKTtcclxuICAgICAgICAgICAgICAgIC8vICAgc3ViID0gdGhpcy51cGxvYWRBbGwodXBsb2FkLmZpbGVzLCB1cGxvYWQuZXZlbnQpO1xyXG4gICAgICAgICAgICAgICAgLy8gICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgXCJyZW1vdmVcIjpcclxuICAgICAgICAgICAgICAgICAgICBzdWIgPSB0aGlzLnJlbW92ZSh1cGxvYWQuZmlsZXMsIHVwbG9hZC5ldmVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAvLyBjYXNlICdyZW1vdmVBbGwnOlxyXG4gICAgICAgICAgICAgICAgLy8gICBpZHMgPSB1cGxvYWQuZmlsZXMubWFwKGZpbGVJdGVtID0+IGZpbGVJdGVtLmlkKTtcclxuICAgICAgICAgICAgICAgIC8vICAgc3ViID0gdGhpcy5yZW1vdmVBbGwodXBsb2FkLmZpbGVzLCB1cGxvYWQuZXZlbnQpO1xyXG4gICAgICAgICAgICAgICAgLy8gICBicmVhaztcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgc3ViID0gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIXN1Yikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHN1Yi5waXBlKGZpbmFsaXplKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIC8vIGRlYnVnZ2VyO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFvYnNlcnZlci5jbG9zZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KSkuc3Vic2NyaWJlKFxyXG4gICAgICAgICAgICAgICAgICAgIChvdXRwdXQpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gZGVidWdnZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLm5leHQob3V0cHV0KTtcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIChlcnIpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIubmV4dChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIHRoaXMuc3Vicy5wdXNoKHsgaWRzOiBpZHMsIHN1Yjogc3ViLCBpZDogXCJcIiB9KTtcclxuICAgICAgICAgICAgLy8gc3dpdGNoICh1cGxvYWQuZXZlbnQudHlwZSkge1xyXG4gICAgICAgICAgICAvLyAgIGNhc2UgJ3VwbG9hZEFsbCc6XHJcbiAgICAgICAgICAgIC8vICAgICB0aGlzLnN1YnMucHVzaCh7IGlkczogaWRzLCBzdWI6IHN1YiwgaWQ6ICcnIH0pO1xyXG4gICAgICAgICAgICAvLyAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIC8vICAgY2FzZSAncmVtb3ZlQWxsJzpcclxuICAgICAgICAgICAgLy8gICAgIHRoaXMuc3Vicy5wdXNoKHsgaWRzOiBpZHMsIHN1Yjogc3ViLCBpZDogJycgfSk7XHJcbiAgICAgICAgICAgIC8vICAgICBicmVhaztcclxuICAgICAgICAgICAgLy8gICBkZWZhdWx0OlxyXG5cclxuICAgICAgICAgICAgLy8gfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDljZXkuKrmlofku7bkuIrkvKBcclxuICAgICAqIEBwYXJhbSBmaWxlXHJcbiAgICAgKiBAcGFyYW0gZXZlbnRcclxuICAgICAqL1xyXG4gICAgLy8gdXBsb2FkRmlsZShmaWxlOiBVcGxvYWRGaWxlLCBldmVudDogVXBsb2FkSW5wdXQpOiBPYnNlcnZhYmxlPFVwbG9hZE91dHB1dD4ge1xyXG4gICAgLy8gICBjb25zdCB1cGxvYWRGaWxlID0gPEJsb2JGaWxlPmZpbGUubmF0aXZlRmlsZTtcclxuICAgIC8vICAgY29uc3QgdXBsb2FkSW5kZXggPSB0aGlzLnF1ZXVlLmZpbmRJbmRleChvdXRGaWxlID0+IG91dEZpbGUubmF0aXZlRmlsZSA9PT0gdXBsb2FkRmlsZSk7XHJcblxyXG4gICAgLy8gICAvLyDlt7Lnu4/ooqvlj5bmtojnmoTkuI3og73ooqvkuIrkvKBcclxuICAgIC8vICAgaWYgKHRoaXMucXVldWVbdXBsb2FkSW5kZXhdLnByb2dyZXNzLnN0YXR1cyA9PT0gVXBsb2FkU3RhdHVzLkNhbmNlbGxlZCkge1xyXG4gICAgLy8gICAgIHJldHVybiBuZXcgT2JzZXJ2YWJsZShvYnNlcnZlciA9PiB7XHJcbiAgICAvLyAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xyXG4gICAgLy8gICAgIH0pO1xyXG4gICAgLy8gICB9XHJcbiAgICAvLyAgIC8vIOaKm+WHuuW8gOWni+S4iuS8oOeahOS6i+S7tlxyXG4gICAgLy8gICB0aGlzLnNlcnZpY2VFdmVudHMuZW1pdCh7IHR5cGU6ICdzdGFydCcsIGZpbGVzOiBbZmlsZV0gfSk7XHJcbiAgICAvLyAgIHJldHVybiB0aGlzLnVwbG9hZFNlcnZlclNlci51cGxvYWQoZmlsZSwgZXZlbnQsIHRoaXMuZXh0ZW5kU2VydmVyQ29uZmlnKTtcclxuICAgIC8vIH1cclxuICAgIG11bHRpcGFydFVwbG9hZChcclxuICAgICAgICBmaWxlOiBVcGxvYWRGaWxlLFxyXG4gICAgICAgIGV2ZW50OiBVcGxvYWRJbnB1dFxyXG4gICAgKTogT2JzZXJ2YWJsZTxVcGxvYWRPdXRwdXQ+IHtcclxuICAgICAgICAvLyDmipvlh7rlvIDlp4vkuIrkvKDnmoTkuovku7ZcclxuICAgICAgICB0aGlzLnNlcnZpY2VFdmVudHMuZW1pdCh7IHR5cGU6IFwic3RhcnRcIiwgZmlsZXM6IFtmaWxlXSB9KTtcclxuICAgICAgICByZXR1cm4gdGhpcy51cGxvYWRTZXJ2ZXJTZXIubXVsdGlwYXJ0VXBsb2FkKFxyXG4gICAgICAgICAgICBmaWxlLFxyXG4gICAgICAgICAgICBldmVudCxcclxuICAgICAgICAgICAgdGhpcy5leHRlbmRTZXJ2ZXJDb25maWdcclxuICAgICAgICApO1xyXG4gICAgfVxyXG4gICAgdXBsb2FkKGZpbGVzOiBVcGxvYWRGaWxlW10sIGV2ZW50OiBVcGxvYWRJbnB1dCk6IE9ic2VydmFibGU8VXBsb2FkT3V0cHV0PiB7XHJcbiAgICAgICAgLy8g5oqb5Ye65byA5aeL5LiK5Lyg55qE5LqL5Lu2XHJcbiAgICAgICAgdGhpcy5zZXJ2aWNlRXZlbnRzLmVtaXQoeyB0eXBlOiBcInN0YXJ0XCIsIGZpbGVzOiBmaWxlcyB9KTtcclxuICAgICAgICByZXR1cm4gdGhpcy51cGxvYWRTZXJ2ZXJTZXIudXBsb2FkKGZpbGVzLCBldmVudCwgdGhpcy5leHRlbmRTZXJ2ZXJDb25maWcpO1xyXG4gICAgfVxyXG5cclxuICAgIHJlbW92ZShmaWxlczogVXBsb2FkRmlsZVtdLCBldmVudDogVXBsb2FkSW5wdXQpOiBPYnNlcnZhYmxlPFVwbG9hZE91dHB1dD4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnVwbG9hZFNlcnZlclNlci5yZW1vdmUoZmlsZXMsIGV2ZW50LCB0aGlzLmV4dGVuZFNlcnZlckNvbmZpZyk7XHJcbiAgICB9XHJcbiAgICAvLyByZW1vdmVBbGwoZmlsZXM6IFVwbG9hZEZpbGVbXSwgZXZlbnQ6IFVwbG9hZElucHV0KTogT2JzZXJ2YWJsZTxVcGxvYWRPdXRwdXQ+IHtcclxuICAgIC8vICAgcmV0dXJuIHRoaXMudXBsb2FkU2VydmVyU2VyLnJlbW92ZUFsbChmaWxlcywgZXZlbnQsIHRoaXMuZXh0ZW5kU2VydmVyQ29uZmlnKTtcclxuICAgIC8vIH1cclxuICAgIC8vIOmHjee9rlxyXG4gICAgcmVzZXQoKSB7XHJcbiAgICAgICAgdGhpcy5xdWV1ZSA9IFtdO1xyXG4gICAgICAgIC8vdGhpcy51cGxvYWRTY2hlZHVsZXIgPSBuZXcgU3ViamVjdCgpO1xyXG4gICAgICAgIC8vIHRoaXMuc3Vicy5mb3JFYWNoKHN1YiA9PiB7XHJcbiAgICAgICAgLy8gICBpZiAoc3ViLnN1Yikge1xyXG4gICAgICAgIC8vICAgICBzdWIuc3ViLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgLy8gICB9XHJcbiAgICAgICAgLy8gfSk7XHJcbiAgICAgICAgdGhpcy5zdWJzID0gW107XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5pqC5pe2XHJcbiAgICBzZXRDb250ZW50VHlwZXMoY29udGVudFR5cGVzOiBzdHJpbmdbXSk6IHZvaWQge1xyXG4gICAgICAgIGlmICh0eXBlb2YgY29udGVudFR5cGVzICE9PSBcInVuZGVmaW5lZFwiICYmIGNvbnRlbnRUeXBlcyBpbnN0YW5jZW9mIEFycmF5KSB7XHJcbiAgICAgICAgICAgIGlmIChjb250ZW50VHlwZXMuZmluZCgodHlwZTogc3RyaW5nKSA9PiB0eXBlID09PSBcIipcIikgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hbGxvd2VkQ29udGVudFR5cGVzID0gW1wiKlwiXTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuYWxsb3dlZENvbnRlbnRUeXBlcyA9IGNvbnRlbnRUeXBlcztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuYWxsb3dlZENvbnRlbnRUeXBlcyA9IFtcIipcIl07XHJcbiAgICB9XHJcblxyXG4gICAgYWxsQ29udGVudFR5cGVzQWxsb3dlZCgpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gKFxyXG4gICAgICAgICAgICB0aGlzLmFsbG93ZWRDb250ZW50VHlwZXMuZmluZCgodHlwZTogc3RyaW5nKSA9PiB0eXBlID09PSBcIipcIikgIT09XHJcbiAgICAgICAgICAgIHVuZGVmaW5lZFxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gbmFtZVxyXG4gICAgICovXHJcbiAgICBpc0NvbnRlbnRUeXBlQWxsb3dlZChuYW1lOiBzdHJpbmcpOiBib29sZWFuIHtcclxuICAgICAgICBpZiAodGhpcy5hbGxDb250ZW50VHlwZXNBbGxvd2VkKCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIOmZhOS7tuayoeacieWQjue8gFxyXG4gICAgICAgIGlmIChuYW1lLmxhc3RJbmRleE9mKFwiLlwiKSA8IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgbmFtZXN1ZmZpeCA9IG5hbWUuc3Vic3RyKG5hbWUubGFzdEluZGV4T2YoXCIuXCIpKTtcclxuICAgICAgICAvLyDnroDljJborqHnrpdcclxuICAgICAgICByZXR1cm4gKFxyXG4gICAgICAgICAgICB0aGlzLmFsbG93ZWRDb250ZW50VHlwZXMuZmluZEluZGV4KFxyXG4gICAgICAgICAgICAgICAgKGl0ZW0pID0+IGl0ZW0udG9Mb3dlckNhc2UoKSA9PSBuYW1lc3VmZml4LnRvTG93ZXJDYXNlKClcclxuICAgICAgICAgICAgKSA+IC0xXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBpc0ZpbGVTaXplQWxsb3dlZChmaWxlU2l6ZTogbnVtYmVyKTogYm9vbGVhbiB7XHJcbiAgICAgICAgaWYgKCF0aGlzLm1heEZpbGVTaXplKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBmaWxlU2l6ZeaYr2LljZXkvY0gbWF4RmlsZVNpemXmmK9NQuWNleS9jVxyXG4gICAgICAgIHJldHVybiBmaWxlU2l6ZSA8PSB0aGlzLm1heEZpbGVTaXplICogMTAyNCAqIDEwMjQ7IC8vICogOFxyXG4gICAgfVxyXG59XHJcbiJdfQ==