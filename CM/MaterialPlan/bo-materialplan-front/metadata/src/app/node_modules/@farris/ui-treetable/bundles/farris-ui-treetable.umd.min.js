!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@farris/ui-input-group"),require("@angular/common"),require("resize-observer-polyfill"),require("lodash-es"),require("@farris/ui-perfect-scrollbar"),require("@angular/forms"),require("@farris/ui-common/column"),require("@farris/ui-common/events"),require("@angular/platform-browser"),require("@farris/ui-locale"),require("@farris/ui-pagination"),require("rxjs/operators"),require("rxjs"),require("@farris/ui-common"),require("@farris/ui-context-menu"),require("@angular/core")):"function"==typeof define&&define.amd?define("@farris/ui-treetable",["exports","@farris/ui-input-group","@angular/common","resize-observer-polyfill","lodash-es","@farris/ui-perfect-scrollbar","@angular/forms","@farris/ui-common/column","@farris/ui-common/events","@angular/platform-browser","@farris/ui-locale","@farris/ui-pagination","rxjs/operators","rxjs","@farris/ui-common","@farris/ui-context-menu","@angular/core"],t):t((e.farris=e.farris||{},e.farris["ui-treetable"]={}),e.uiInputGroup,e.ng.common,e.ResizeObserver,e.lodashEs,e.uiPerfectScrollbar,e.ng.forms,e.column,e.events,e.ng.platformBrowser,e.uiLocale,e.uiPagination,e.rxjs.operators,e.rxjs,e.uiCommon,e.uiContextMenu,e.ng.core)}(this,function(e,t,n,i,o,s,r,l,a,d,h,c,u,p,f,g,m){"use strict";i=i&&i.hasOwnProperty("default")?i["default"]:i;var y=function(){return(y=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)};function b(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,s,o=n.call(e),r=[];try{for(;(void 0===t||0<t--)&&!(i=o.next()).done;)r.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(n=o["return"])&&n.call(o)}finally{if(s)throw s.error}}return r}function v(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(b(arguments[t]));return e}var w=(C.prototype.addShortcut=function(e){var n=this,i=y({},this.defaults,e);-1<i.keys.indexOf("ctrl")&&(i.keys=i.keys.replace("ctrl","control"));var s="keydown."+i.keys;return i.description&&this.hotkeys.set(i.keys,i.description),new p.Observable(function(t){var e=n.eventManager.addEventListener(i.element,s,function(e){e.preventDefault(),t.next(e)});return function(){e(),n.hotkeys["delete"](i.keys)}})},C.decorators=[{type:m.Injectable,args:[{providedIn:"root"}]}],C.ctorParameters=function(){return[{type:d.EventManager}]},C.ngInjectableDef=m.defineInjectable({factory:function(){return new C(m.inject(d.EventManager))},token:C,providedIn:"root"}),C);function C(e){this.eventManager=e,this.hotkeys=new Map,this.defaults={element:document}}var x=(k.prototype.onSelectionChange=function(e){this.selectionSource.next(e)},k.prototype.onDblClick=function(e){this.dblClickSource.next(e)},k.prototype.onChangeCheckboxStatus=function(e){this.changeCheckboxStatus.next(e)},k.prototype.onInsert=function(e,t){this.insertNode.next(e)},k.prototype.onRemove=function(e){this.removeNode.next(e)},k.prototype.onUpdate=function(e){this.updateNode.next(e)},k.prototype.columnIsVisible=function(e,t){return e.visible===undefined||("function"==typeof e.visible?e.visible(t):e.visible)},k.prototype.checkColumnsForGroupHeader=function(e,t){var n=[];return e&&e.length&&(n=this.getDataColumns(e)),{columns:n}},k.prototype.getDataFields=function(e,n){var i=0,s=0;return e.forEach(function(e){var t=e.colspan||1;i+t<=n&&(i+=t,s++)}),e.splice(0,s)},k.prototype.getDataColumns=function(n){var i=this;if(!n||!n.length)return[];for(var s=[],e=function(e){var t=n[e];n[e]&&!n[e].length&&(t=v(s),s=[]),t.forEach(function(t){!t.field&&t.colspan&&1<t.colspan?(t.halign&&(t.hAlign=t.halign),i.getDataFields(n[e+1],t.colspan).forEach(function(t){s.includes(function(e){return e.field===t.field})||s.push(t)})):s.includes(function(e){return e.field===t.field})||s.push(t)})},t=0;t<n.length;t++)e(t);return s.filter(function(e){return!e.colspan||1===e.colspan})},k.decorators=[{type:m.Injectable}],k);function k(){this.selectionSource=new p.Subject,this.dblClickSource=new p.Subject,this.changeCheckboxStatus=new p.Subject,this.removeNode=new p.Subject,this.insertNode=new p.Subject,this.updateNode=new p.Subject,this.selectionSource$=this.selectionSource.asObservable(),this.dblClickSource$=this.dblClickSource.asObservable(),this.changeCheckboxStatus$=this.changeCheckboxStatus.asObservable(),this.insertNode$=this.insertNode.asObservable(),this.removeNode$=this.removeNode.asObservable(),this.updateNode$=this.updateNode.asObservable()}var S=(I.prototype.getTableHeight=function(){return this.tt.height},I.prototype.getTableHeaderHeight=function(){return this.tt.headerBox.nativeElement.getBoundingClientRect().height},I.prototype.getTableBodyHeight=function(){return this.tt.height-this.getTableHeaderHeight()},I.prototype.getTableWidth=function(){return this.tt.width},I.prototype.getRowHeight=function(){return this.tt.rowHeight},I.prototype.getRowNodes=function(e){for(var t=0,n=[],i=0,s=0,o=this.tt.getCurrentAllRowNodes(),r=this.getRowHeight(),l=e,a=l+this.getTableHeight()+r,d=0;d<o.length;d++){var c=o[d];c.visible&&((t+=r)+r<l?i+=r:a<t?s+=r:n.push(c))}return{data:n,topHideHeight:i,bottomHideHeight:s}},I);function I(e){this.tt=e}var N=(E.prototype.research=function(e){void 0===e&&(e="client");var t=this.ttInstance.searchData,n=t.field,i=t.value;this.allNodes=[],this.search(n,i,e)},E.prototype.search=function(e,t,n){var i=this;switch(void 0===n&&(n="client"),this.allNodes.length||(this.allNodes=o.cloneDeep(this.ttInstance.state.rowNodes)),n){case"server":this.searchOnServer(e,t);break;default:if(""!==t&&t!==undefined){var s=this.searchOnClient(e,t,this.allNodes);this.ttInstance.state.searchRowNodes=null,this._updateSerializedValues(s)}else this.ttInstance.updateSerializedValue();this.ttInstance.checkeds&&this.ttInstance.checkeds.length?this.ttInstance.checkedNodes(this.ttInstance.checkeds.map(function(e){return e.data[i.ttInstance.idField]})):(this.ttInstance.resize(),this.ttInstance.detectChanges(),this.ttInstance.psRef&&this.ttInstance.psRef.directiveRef.update())}},E.prototype._updateSerializedValues=function(e){var t=this,n=e.map(function(e){return v(e.parents,[e.id])}).flat(),i=Array.from(new Set(n)),s=this.allNodes.filter(function(t){return i.some(function(e){return e==t.id})}).map(function(e){return e.expanded=!0,t.ttInstance.updateNodeProperty(e.id,{expanded:!0}),e});this.ttInstance.serializedValue=this.resetTreeData(null,s),this.ttInstance.state.searchRowNodes=this.ttInstance.serializedValue},E.prototype.findParent=function(t,e){var n=this,i=[];if(t&&e&&e.length){var s=e.find(function(e){return e.id===t.data[n.ttInstance.idField]});i.push(s),s.parent&&(i=i.concat(this.findParent(s.parent,e)))}return i},E.prototype.searchExpression=function(n,i,e){var s=this;return void 0===e&&(e=[]),(e.length?e:this.ttInstance.columns.map(function(e){return e.field})).map(function(e){var t=""+s.getValue(e,n.node.data);if(t!==undefined)return"number"==typeof t?t===parseFloat(i):-1<t.indexOf(i);s.ttInstance.writeConsole("不存在列 "+e)}).reduce(function(e,t){return e||t},!1)},E.prototype.getValue=function(e,t){if(e){if(!(-1<e.indexOf(".")))return t[e];try{return e.split(".").reduce(function(e,t){return e?e[t]:null},t)}catch(n){this.ttInstance.writeConsole("字段 "+e+" 不存在。")}}},E.prototype.getFindTextTotal=function(e,i,t){var s,o,r=this,n=[e];return"*"===e?n=this.ttInstance.columns.map(function(e){return e.field}):-1<e.indexOf(",")&&(n=e.split(",").map(function(e){return e.trim()})),s=n,o=0,t.forEach(function(n){s.forEach(function(e){var t=""+r.getValue(e,n.node.data);t!==undefined&&-1<t.indexOf(i)&&o++})}),o},E.prototype.searchOnClient=function(t,n,e){var i=this;return n?"*"===t?e.filter(function(e){return i.searchExpression(e,n)}):-1<t.indexOf(",")?e.filter(function(e){return i.searchExpression(e,n,t.split(",").map(function(e){return e.trim()}))}):(n=n.toLowerCase(),-1===t.indexOf(".")?e.filter(function(e){return-1<(""+e.node.data[t]).toLowerCase().indexOf(n)}):e.filter(function(e){return-1<(""+i.getValue(t,e.node.data)).toLowerCase().indexOf(n)})):[]},E.prototype.findParents=function(e,t){var n=this,i=[];return e.forEach(function(e){i=i.concat(n.findParent(e.node,t))}),Array.from(new Set(i))},E.prototype.resetTreeData=function(t,n){var i=this,s=[],e=[];return null===t?e=n.filter(function(e){return e.parent===t}):(t.node.expanded=!0,(e=n.filter(function(e){return e.parent&&e.parent.data[i.ttInstance.idField]===t.id})).length?t.node.children=e.map(function(e){return e.node}):t.node.children=[]),e.forEach(function(e){e.visible=!0,s.push(e),s=s.concat(i.resetTreeData(e,n))}),s},E.prototype.searchOnServer=function(e,t){},E);function E(e){this.ttInstance=e,this.allNodes=[]}var R="__nodespagerbar__",T=(O.decorators=[{type:m.Directive,args:[{selector:"tt-column, [tt-column]"}]}],O.propDecorators={field:[{type:m.Input}],title:[{type:m.Input}],width:[{type:m.Input}],hAlign:[{type:m.Input}],align:[{type:m.Input}],formatter:[{type:m.Input}]},O);function O(){}var z=(Object.defineProperty(V.prototype,"groupColumns",{get:function(){return this._groupColumns},set:function(e){this._groupColumns=e||[],this.columns=this.ttService.checkColumnsForGroupHeader(e.map(function(e){return v(e)}),this).columns},enumerable:!0,configurable:!0}),Object.defineProperty(V.prototype,"data",{get:function(){return this._data},set:function(e){this._data=e,this.updateSerializedValue(),this.initNodeStatus(),this.setNewColumnsWidth(),this.loadDataSuccess()},enumerable:!0,configurable:!0}),Object.defineProperty(V.prototype,"allCheckbox",{set:function(e){this.headerCheckboxCmp=e},enumerable:!0,configurable:!0}),Object.defineProperty(V.prototype,"selections",{get:function(){return this._selections},set:function(e){var t=this;if(e&&e.length){this._selections=e.filter(function(e){return e&&t.findRowNode(e.id)});var n=this._selections.map(function(e){return e.id});(n.length!==this.selectValues.length||n.length===this.selectValues.length&&this.difference(n,this.selectValues).length)&&(this.selectValues=n,setTimeout(function(){t.selectValuesChange.emit(n)}))}else this._selections=[],this.selectValues=[],this.selectValuesChange.emit([])},enumerable:!0,configurable:!0}),Object.defineProperty(V.prototype,"selectedRow",{get:function(){return this._selectedRow},set:function(e){(this._selectedRow=e)?this.selectValue!==e.id&&(this.selectValue=e.id,this.selectValueChange.emit(e.id)):(this.selectValue=null,this.selectValueChange.emit(null))},enumerable:!0,configurable:!0}),Object.defineProperty(V.prototype,"checkeds",{get:function(){return this._checkeds},set:function(e){var t=this;if(e&&e.length){this._checkeds=e.filter(function(e){return t.findRowNode(e.id)});var n=this._checkeds.map(function(e){return e.id});this.checkValues=this.checkValues||[],(n.length!==this.checkValues.length||n.length===this.checkValues.length&&this.difference(n,this.checkValues).length)&&(this.checkValues=n,setTimeout(function(){t.checkValuesChange.emit(n)}))}else this._checkeds=[],this.checkValues=[],this.checkValuesChange.emit([])},enumerable:!0,configurable:!0}),V.prototype.writeConsole=function(e,t){void 0===t&&(t="warn"),this.debugSer&&this.debugSer[t](e)},V.prototype.checkOptons=function(){var e=this;if(this.nowrap||(this.virtualized=!1),setTimeout(function(){e.reSetSize(),e.setScorllBodyHeight()}),this.multiSelect&&(this.singleSelect=!1),this.singleSelect&&this.showCheckbox&&(this.checkOnSelect=!0,this.selectOnCheck=!0),this.beforeSortColumn||(this.beforeSortColumn=function(){return p.of(!0)}),this.fit){this.renderer.addClass(this.el.nativeElement,"f-utils-fill-flex-column");var t=this.el.nativeElement.parentElement||this.el.nativeElement.parentNode;t&&this.renderer.setStyle(t,"overflow","hidden")}this.beforeClickNode||(this.beforeClickNode=function(){return p.of(!0)}),this.beforeCheckAll||(this.beforeCheckAll=function(){return p.of(!0)}),this.beforeUnCheckAll||(this.beforeUnCheckAll=function(){return p.of(!0)}),this.autoWidth&&(this.fitColumns=!1,this.resizableColumns=!1),this.disabledRow||(this.disabledRow=function(){return!1})},V.prototype.ngOnInit=function(){var r=this;this.id="Treetable-"+this._UUID,this.styleElement=this.utils.createStyleSheet(this.styleSheetId),this.checkColumnOption(),this.checkOptons(),this.ngZone&&this.ngZone.runOutsideAngular(function(){r.el.nativeElement.parentElement&&(r.ro=new i(function(e,t){if(e&&e[0]){var n=e[0].contentRect,i=n.width,s=n.height,o=e[0].target;r.fit&&o.offsetParent&&r.resize({width:i,height:r.showBorder?s-2:s})}}),r.ro.observe(r.el.nativeElement.parentElement))}),this.paginationOptions=this.initPaginationOptions()},V.prototype.ngOnDestroy=function(){this.ro&&(this.el.nativeElement.parentElement&&this.ro.unobserve(this.el.nativeElement.parentElement),this.ro.disconnect(),this.ro=null),this.findKeysHandler&&this.findKeysHandler.unsubscribe(),this.utils.removeStyleSheet(this.styleSheetId),this.styleElement=null,this.farrisInstances&&this.farrisInstances.destroy(this.el.nativeElement),this.ttService=null,this.destroy$.next(),this.destroy$.complete()},V.prototype.ngOnChanges=function(e){e.data&&!e.data.isFirstChange()&&(this.isDataChanged=e.data.currentValue!==e.data.previousValue),e.multiSelect&&!e.multiSelect.isFirstChange()&&(this.singleSelect=!e.multiSelect.currentValue,this.singleSelect&&this.showCheckbox&&(this.selectOnCheck=!0,this.checkOnSelect=!0)),e.disabled&&!e.disabled.isFirstChange()&&(this.hovered=!e.disabled.currentValue),e.enableFindText&&!e.enableFindText.isFirstChange()&&this.setFindText(e.enableFindText.currentValue),e.selectValue&&!e.selectValue.isFirstChange()&&this.selectNode(e.selectValue.currentValue),e.selectValues&&!e.selectValues.isFirstChange()&&this.selectNodes(e.selectValues.currentValue),e.checkValues&&!e.checkValues.isFirstChange()&&this.checkedNodes(e.checkValues.currentValue),e.pageIndex===undefined||e.pageIndex.isFirstChange()||(this.paginationOptions=Object.assign(this.paginationOptions,{currentPage:this.pageIndex})),e.pageSize===undefined||e.pageSize.isFirstChange()||(this.paginationOptions=Object.assign(this.paginationOptions,{itemsPerPage:this.pageSize})),e.pageList===undefined||e.pageList.isFirstChange()||(this.paginationOptions=Object.assign(this.paginationOptions,{pageList:this.pageList})),e.total===undefined||e.total.isFirstChange()||(this.paginationOptions=Object.assign(this.paginationOptions,{totalItems:this.total})),e.fitColumns&&!e.fitColumns.isFirstChange()&&this.setTableWidth(this.allColumnsWidth()),e.columns&&!e.columns.isFirstChange()&&this.checkColumnOption(),e.showBorder&&e.showBorder.isFirstChange()},V.prototype.ngAfterViewChecked=function(){},V.prototype.ngAfterContentInit=function(){var t=this;this.templates.forEach(function(e){switch(e.getType()){case"header":t.headerTemplate=e.template;break;case"body":t.bodyTemplate=e.template}}),this.columnsRef.length&&(this.columns=this.ttc2columns(this.columnsRef),this.columnsRef.changes.subscribe(function(e){t.columns=t.ttc2columns(e)}))},V.prototype.ngAfterViewInit=function(){this.containerElement=this.el.nativeElement.querySelector(".farris-treetable"),this.registerShortcuts(),this.setNewColumnsWidth(),this.setRightFixedColumnShadow(),this.el&&this.farrisInstances&&this.farrisInstances.add(this.el.nativeElement,this),this.bodyTemplate&&this.utils.appendCssRules(["#"+this.id+" .farris-treetable .farris-treetable-tbody td {padding: .25rem 0.75rem;}"],this.styleElement.sheet),this.loadDataSuccess()},V.prototype.loadDataSuccess=function(){var e=this;p.timer(this.loadedTimer).pipe(u.takeUntil(this.destroy$)).subscribe(function(){e.psRef&&e.psRef.directiveRef&&e.psRef.directiveRef.update(),e.loadedData.emit()})},V.prototype.setNewColumnsWidth=function(){var o=this;if(this.autoWidth){var r=[],e=[];this.showHeader&&this.headerTable&&(r=Array.from(this.headerTable.nativeElement.querySelectorAll("th"))),this.serializedValue&&this.serializedValue.length&&this.bodyTable&&(e=Array.from(this.bodyTable.nativeElement.querySelector("tr").querySelectorAll("td"))),e.forEach(function(e,t){var n=e.getAttribute("field"),i=e.getBoundingClientRect().width.toFixed(2),s=o.columns.find(function(e){return e.field===n});s&&s.width!==undefined&&(i=i>s.width?i:s.width,e.style.minWidth=i+"px"),r[t].style.width=i+"px"})}},V.prototype.columnIsVisible=function(e){return this.ttService.columnIsVisible(e,this)},V.prototype.columnCssName=function(e){return"#"+this.id+' .treetable-cell[field="'+e.field+'"], #'+this.id+' .treetable-header-cell[field="'+e.field+'"]:not(.group-header-cell)'},V.prototype.sortColumnsByFixed=function(e){void 0===e&&(e=!0);var n=this.columns.filter(function(e){return"left"===e.fixed}),t=this.columns.filter(function(e){return!e.fixed||"center"===e.fixed}),i=this.columns.filter(function(e){return"right"===e.fixed});if(n&&n.length&&n.forEach(function(e,t){e.left=t?n[t-1].width:0}),i&&i.length){var s=i.reduce(function(e,t){return e+t.width},0);i.forEach(function(e,t){s-=e.width,e.right=s})}e&&(this.columns=n.concat(t).concat(i))},V.prototype.checkColumnOption=function(){var r=this,l=[];this.fitColumns||this.sortColumnsByFixed(),this.columns.forEach(function(e,t){e.visible===undefined&&(e.visible=!0),e.halign&&(e.hAlign=e.halign),e.width===undefined&&(e.width=100),e.id||(e.id="treetable-header-"+(e.field||t))});var a=this.allColumnsWidth(),d=0,e=this.columns.filter(function(e){return"right"===e.fixed});e&&e.length?(e[0].rightShadowCol=!0,e[e.length-1].lastColumn=!0):this.columns&&this.columns.length&&(this.columns[this.columns.length-1].lastColumn=!0);var t=this.columns.filter(function(e){return"left"===e.fixed});t&&t.length&&(t[t.length-1].leftShadowCol=!0),this.columns.forEach(function(e,t){var n=r.columnIsVisible(e),i=r.columnCssName(e),s=r.utils.getCssRule(i,r.styleElement.sheet);if(s)s.style.display=n?"":"none";else{var o=i+" { ";o+=n?"":"display: none;",r.fitColumns?o+="width: "+(e.width/a*100).toFixed(2)+"%;":(o+="width: "+e.width+"px;",e.fixed&&("left"===e.fixed&&(o+="left: "+e.left+"px",d++),"right"===e.fixed&&(o+="right: "+e.right+"px",d++))),o+="}",l.push(o)}}),l.length&&this.utils.appendCssRules(l,this.styleElement.sheet),this.setTableWidth(a),this.paginationForChildren&&this.columns.push({field:R,width:160,title:"",align:"center",template:this.nodesPagerBar}),this.fixedColumns=!!d},V.prototype.setTableWidth=function(e){this.headerTable&&this.bodyTable&&(this.fitColumns||this.autoFitColumns?(this.headerTable.nativeElement.style.width="100%",this.bodyTable.nativeElement.style.width="100%"):(this.headerTable.nativeElement.style.width=e+"px",this.bodyTable.nativeElement.style.width=e+"px"))},V.prototype.allColumnsWidth=function(){var n=this;return this.columns.reduce(function(e,t){return n.columnIsVisible(t)?e+t.width:e},0)},V.prototype.onPageChange=function(e){this.pageChanged.emit(e)},V.prototype.onPageSizeChange=function(e){this.pageSizeChanged.emit(e)},V.prototype.updatePageInfo=function(e){if(e&&Object.keys(e).length){var t={};e.total!==undefined&&(t.totalItems=e.total),e.pageIndex!==undefined&&(t.currentPage=e.pageIndex),e.pageSize!==undefined&&(t.itemsPerPage=e.pageSize),e.pageList!==undefined&&(t.pageList=e.pageList),this.paginationOptions=Object.assign(this.paginationOptions,t)}},V.prototype.initPaginationOptions=function(){return{id:"Farris-TreeTable-Pagination_"+this._UUID,itemsPerPage:this.pageSize,currentPage:this.pageIndex,pageList:this.pageList,totalItems:this.total,remote:this.pagerOnServer}},V.prototype.getNodeText=function(e,t){if(!e.isMultilingualField)return this.utils.getValue(e.field,t,!0);var n=this.utils.getValue(e.field,t);if(this.localeService){var i=this.localeService.localeId||"zh-CHS";return n&&"object"==typeof n&&0<Object.keys(n).length?n[i]:n}},V.prototype.initNodeStatus=function(){this.singleSelect?this.selectValue&&this.selectNode(this.selectValue,!1):(this.checkValues&&this.checkValues.length&&this.checkedNodes(this.checkValues,!1,!1),this.selectValues&&this.selectValues.length&&!this.onlySelectSelf&&this.selectNodes(this.selectValues,!1,!1))},V.prototype.registerShortcuts=function(){var e=this;this.showFilterBar&&this._hotKeys&&this._hotKeys.addShortcut({keys:"enter",element:this.inputGroup.textbox.nativeElement}).subscribe(function(){e.onSearch()}),this.setFindText(this.enableFindText)},V.prototype.setFindText=function(e){var t=this;void 0===e&&(e=!0),this.enableFindText=e,this.enableFindText&&this._hotKeys?this.findKeysHandler=this._hotKeys.addShortcut({keys:"control.shift.f"}).subscribe(function(e){t.enableFindText&&(t.showFindInput=!0,t.detectChanges())}):(this.showFindInput&&(this.showFindInput=!1,this.cdRef.detectChanges()),this.findKeysHandler&&(this.findKeysHandler.unsubscribe(),this.findKeysHandler=null))},V.prototype.getCustomCls=function(e,t,n){void 0===t&&(t=""),void 0===n&&(n="row");var i={},s=this.rowStyler;if("cell"===n&&(s=this.cellStyler),s){var o=s(e.node,t);if(o){var r=[];if("string"==typeof o?r=[o]:Array.isArray(o)&&(r=o),r.length){var l={};return r.forEach(function(e){l[""+e]=!0}),y({},l,i)}return o}return i}return i},V.prototype.getRowCls=function(e,t){return this.getCustomCls(e,"row")},V.prototype.getCellCls=function(e,t){return this.getCustomCls(e,t,"cell")},V.prototype.getRealColWidth=function(e){var n=this;if(this.columns&&this.columns.length&&this.fitColumns){var t=this.columns.reduce(function(e,t){return e+(n.columnIsVisible(t)&&(e.field!==R||e.fixedWidth)?t.width:0)},0);return this.columnIsVisible(e)?e.field===R||e.fixedWidth?(e.width||120)+"px":(e.width/t*100).toFixed(2)+"%":0}return e.width+"px"},V.prototype.onResized=function(){this.resizeSer.windowResized()},V.prototype.setRightFixedColumnShadow=function(){if(this.psRef&&this.psRef.directiveRef){var e=this.psRef.directiveRef.instance;if(!e)return;if(e.containerWidth+e.scrollbarXLeft<e.contentWidth){var t=this.columns.filter(function(e){return"right"===e.fixed}),n="#"+this.id+".f-treetable--fixed-columns";if(t&&t.length){var i=n+" [r-tt-shadow-col]::before{\n                        box-shadow:#d9d9d9 -12px 0px 8px -12px inset;\n                    }";this.utils.appendCssRules([i],this.styleElement.sheet)}}}},V.prototype.setFixedColumnShadow=function(e,t){var n=this.columns.filter(function(e){return"left"===e.fixed}),i=this.columns.filter(function(e){return"right"===e.fixed}),s="#"+this.id+".f-treetable--fixed-columns",o="",r="",l="",a="";if(n&&n.length&&(l=(o=s+' [field="'+n[n.length-1].field+'"]::after')+"{\n                box-shadow:#d9d9d9 12px 0px 8px -12px inset;\n            }"),i&&i.length&&(a=(r=s+" [r-tt-shadow-col]::before")+"{\n                box-shadow:#d9d9d9 -12px 0px 8px -12px inset;\n            }"),0===e)o&&this.utils.removeCssRule(o,this.styleElement.sheet);else if((e+t.srcElement.offsetWidth).toFixed()==t.srcElement.scrollWidth)r&&this.utils.removeCssRule(r,this.styleElement.sheet);else{var d=[];l&&d.push(l),a&&d.push(a),this.utils.appendCssRules(d,this.styleElement.sheet)}},V.prototype.onScrollX=function(e){if(this.showHeader&&this.headerBox){var t=e.srcElement.scrollLeft;this.state.scrollX=t,this.headerBox.nativeElement.scrollLeft=t,this.setFixedColumnShadow(t,e)}},V.prototype.onScrollY=function(e){if(this.virtualized){var t=e.target.scrollTop;this.renderData(t)}},V.prototype.renderData=function(e){var t=this.scrollLoader.getRowNodes(e),n=t.data,i=t.topHideHeight,s=t.bottomHideHeight;this.state.scrollY=e,this.serializedValue=n,this.topHideHeight=i,this.bottomHideHeight=s,this.setNewColumnsWidth(),this.detectChanges()},V.prototype.onSearchValueChange=function(e){e||this.onClearSearchValue()},V.prototype.onClearSearchValue=function(){this.searchData.value="",this.state.searched=!1,this.clearSearchValue.emit()},V.prototype.onCellClick=function(e,t,n){this.cellClick.emit({event:e,col:t,node:n})},V.prototype.trackByFn=function(e,t){return t.id},V.prototype.formatData=function(e,t,n){var i=this.getNodeText(e,t);return this.colFormatSer.format(i,t,n)},V.prototype.columnsChanged=function(){this.checkColumnOption(),this.detectChanges()},V.prototype.ttc2columns=function(e){return e.map(function(e){return{field:e.field,title:e.title,align:e.align,hAlign:e.hAlign,width:e.width,formatter:e.formatter}})},V.prototype.reSetSize=function(){if(this.fit){var e=this.el.nativeElement.parentNode;if(this.width=e.offsetWidth,this.height=e.offsetHeight,this.el.nativeElement.style.height){var t=this.el.nativeElement.style.height;-1<t.indexOf("px")&&0<(t=parseInt(t.replace("px",""),10))&&(this.height=t)}}},V.prototype.renderVirtualRowNodes=function(e){var t=this;if(void 0===e&&(e=null),this.virtualized){var n=e||this.state.scrollY,i=this.scrollLoader.getRowNodes(n);this.serializedValue=i.data,this.topHideHeight=i.topHideHeight,this.bottomHideHeight=i.bottomHideHeight,this.detectChanges(),e&&this.ngZone.runOutsideAngular(function(){setTimeout(function(){t.psRef.directiveRef.elementRef.nativeElement.scrollTop=e},20)})}},V.prototype.updateSerializedValue=function(e){void 0===e&&(e=null),this.serializedValue=[],this.searchHandle.allNodes=[],this.state.rowNodes=[],this.serializeNodes(null,this.data,0,!0),this.virtualized&&this.fixedHeader?this.renderVirtualRowNodes(e):(this.serializedValue=this.state.rowNodes,this.detectChanges())},V.prototype.serializeNodes=function(u,p,f,g,m){var y=this;if(p&&p.length){if(!p[0].data)return;p.forEach(function(e,t){e.parent=u,e.hasOwnProperty("selectable")||(e.selectable=!0),e.hasOwnProperty("showIcon")||(e.showIcon=!0),"yes"===y.onlySelectLeaf&&e.selectable&&(e.selectable=!!e.leaf);var n=e.data[y.idField];e.id=n;var i=-1<y.findIndexInSelection(e),s=-1<y.findIndexInCheckeds(e),o=t===p.length-1,r=0===t,l=[],a=null;if(u){var d=u.data[y.idField],c=m||[];(l=l.concat(c.map(function(e){return e}))).push(d),a=y.state.rowNodes.find(function(e){return e.id===u.id})}var h={id:n,node:e,parent:u,level:f,visible:g&&(!u||u.expanded),isSelected:i,isChecked:s,parents:l,parentRowNode:a,index:y.state.rowNodes.length,last:o,first:r};y.state.rowNodes.push(h),y.serializeNodes(e,e.children,f+1,h.visible,l)})}},V.prototype.isSelected=function(t){var n=this;return this.singleSelect?!(!t||!this.selectedRow)&&t.data[this.idField]===this.selectedRow.data[this.idField]:!(!this.selections||!this.selections.length)&&-1<this.selections.findIndex(function(e){return e.data[n.idField]===t.data[n.idField]})},V.prototype.isChecked=function(t){var n=this;return!(!t||!this.checkeds)&&this.checkeds instanceof Array&&-1<this.checkeds.findIndex(function(e){return e.data[n.idField]===t.data[n.idField]})},V.prototype.unSelectedCurrentRowEmit=function(){var e=this.selectedRow;e&&this.nodeUnSelect.emit({node:e,type:"row",instance:this})},V.prototype._singleSelectNode=function(e){this.clearSelections(),this.selectedRow=e.rowNode.node,this.selectRowIndex=e.rowIndex,this.selections=[e.rowNode.node],e.rowNode.isSelected=!0,this.showCheckbox&&(e.rowNode.isChecked=!0,this.clearCheckeds(),this.setCheckeds(e.rowNode));var t={originalEvent:e.originalEvent,node:e.rowNode.node,type:"row",index:e.rowIndex,parents:e.rowNode.parents,instance:this};this.nodeSelected.emit(t)},V.prototype._singleUnSelectNode=function(e){this.selectedRow=null,this.selectRowIndex=-1,e.rowNode.isSelected=!1,e.rowNode.isChecked=!1,this.selections=[],this.nodeUnSelect.emit({originalEvent:e.originalEvent,node:e.rowNode.node,type:"row",parents:e.rowNode.parents,instance:this})},V.prototype.__singleSelectNode=function(e,t){void 0===t&&(t=!1),t?this.keepSelect||this._singleUnSelectNode(e):(this.unSelectedCurrentRowEmit(),this._singleSelectNode(e))},V.prototype.__multiSelectNode=function(e,t){var n=e.rowNode;t?(this.unSelectedCurrentRowEmit(),this.singleSelectWhenMultiSelect(n,!0),this.nodeSelected.emit({originalEvent:e.originalEvent,node:n.node,type:"row",index:e.rowIndex,parents:n.parents,instance:this})):this.keepSelect||(this.singleSelectWhenMultiSelect(n,!1),this.nodeUnSelect.emit({originalEvent:e.originalEvent,node:n.node,type:"row",index:e.rowIndex,parents:n.parents,instance:this}))},V.prototype.handleRowClick=function(e){var t=e.rowNode;t.node.elementRef=e.originalEvent.target;var n=this.isSelected(t.node);if(this.singleSelect)this.__singleSelectNode(e,n);else{if(t.indeterminate=!1,this.onlySelectSelf)this.__multiSelectNode(e,!n);else{t.isSelected=!n,this.state.rowNodes.find(function(e){return e.id===t.id}).isSelected=!n,this.setSelections(t);var i={originalEvent:e.originalEvent,node:t.node,type:"row",index:e.rowIndex,parents:t.parents,instance:this};if(t.isSelected?this.nodeSelected.emit(i):this.nodeUnSelect.emit(i),this.checkOnSelect){t.isChecked=!n,this.state.rowNodes.find(function(e){return e.id===t.id}).isChecked=!n,this.setCheckeds(t);var s=this.cascadeNodes(t,t.isChecked);this.ttService.onChangeCheckboxStatus(t),t.isChecked?this.nodeChecked.emit({originalEvent:e,node:t.node,nodes:s,instance:this}):this.nodeUnChecked.emit({originalEvent:e,node:t.node,nodes:s,instance:this})}}if(this.checkOnSelect){var o=this.checkeds.map(function(e){return e.id});this.checkValues=o,this.checkValuesChange.emit(o)}}this.detectChanges()},V.prototype.singleSelectWhenMultiSelect=function(e,t){this.checkOnSelect&&(e.isChecked=t,this.setCheckeds(e),this.cascadeNodes(e,e.isChecked),e.isChecked?this.nodeChecked.emit({originalEvent:event,node:e.node,instance:this}):this.nodeUnChecked.emit({originalEvent:event,node:e.node,instance:this})),this.clearSelections(),this.onlySelectSelf&&(this.selectedRow=e.node),e.isSelected=t,this.setSelections(e)},V.prototype.selectWhenChecked=function(t,e,n){t.isChecked=e,this.setCheckeds(t,!1),this.selectOnCheck&&(this.onlySelectSelf&&(e||this.selectedRow&&this.selectedRow.id===t.id)&&this.clearSelections(),this.singleSelect&&this.showCheckbox&&this.clearCheckeds(),t.isSelected=e,this.setSelections(t),this.state.rowNodes.find(function(e){return e.id===t.id}).isSelected=e,t.isSelected?this.nodeSelected.emit({originalEvent:n,node:t.node,instance:this,type:"checkbox"}):this.nodeUnSelect.emit({originalEvent:n,node:t.node,instance:this,type:"checkbox"}))},V.prototype.isInArray=function(t,e){var n=this;return(!e||0!==e.length)&&-1<e.findIndex(function(e){return e.data[n.idField]===t.id})},V.prototype.setSelections=function(t){var n=this;if(t.isSelected)this.selections||(this.selections=[]),this.isInArray(t,this.selections)||this.selections.push(t.node);else if(this.selections){var e=this.selections.findIndex(function(e){return e.data[n.idField]===t.node.data[n.idField]});-1!==e&&this.selections.splice(e,1)}},V.prototype.setCheckeds=function(t,e){var n=this;if(void 0===e&&(e=!0),t.isChecked)this.checkeds||(this.checkeds=[]),this.isInArray(t,this.checkeds)||this.checkeds.push(t.node);else if(this.checkeds){var i=this.checkeds.findIndex(function(e){return e.data[n.idField]===t.node.data[n.idField]});-1!==i&&this.checkeds.splice(i,1)}e&&(this.checkeds=v(this.checkeds))},V.prototype.getDiffrentData=function(e){var n=this;if(e.length){var i=[];return e.forEach(function(t){-1===i.findIndex(function(e){return e.data[n.idField]===t.data[n.idField]})&&i.push(t)}),i}return e},V.prototype.cascadeCheckedNode=function(e,t,n){void 0===n&&(n=!1);var i=[];return!e.node.selectable&&e.node.selectable!==undefined||(e.isChecked=t,this.setCheckeds(e,!1),this.selectOnCheck&&(n&&(t=2!==this.isIndeterminate(e)&&t),e.isSelected=t,this.setSelections(e)),this.isInArray(e,i)||i.push(e.node)),i},V.prototype.propagateSelectionDown=function(e,i){var s=this,o=this.cascadeCheckedNode(e,i);return this.cascadeCheck&&this.cascadeDown&&e.node.children&&e.node.children.length&&e.node.children.forEach(function(t,e){var n=s.state.rowNodes.find(function(e){return e.id===t.data[s.idField]});n&&n.node.selectable&&(n.indeterminate=!1,n.isChecked=i,o=o.concat(s.propagateSelectionDown(n,i)),s.ttService.onChangeCheckboxStatus(n))}),o},V.prototype.propagateSelectionUp=function(e,s){var o=this,r=this.cascadeCheckedNode(e,s);if(this.cascadeCheck&&this.cascadeUp&&e.node.parent&&e.parents&&e.parents.length){var l=[];e.parents.forEach(function(e,t){var n=o.findRowNode(e);if(n&&n.node.selectable){var i=o.cascadeCheckedNode(n,s,!0);i.length&&r.push(i[0]),l.push(n)}}),l.reverse().forEach(function(e){o.updateCheckboxStatus(e)})}return r},V.prototype.updateNodeStatus=function(){var i=this;if(this.state.searched){var e=this.state.searchRowNodes;if(!e)return;e.forEach(function(t){var e=i.state.rowNodes.find(function(e){return e.id===t.id}),n=!!e&&e.isChecked;t.indeterminate=!1,t.isChecked=n,i.selectOnCheck&&(e.isSelected!=t.isChecked&&(e.isSelected=e.isChecked),t.isSelected=e.isSelected)})}else this.selectOnCheck&&this.state.rowNodes.forEach(function(e){i.onlySelectSelf?i.selections&&i.selections.length&&i.selections[0].id===e.id?e.isSelected=!0:e.isSelected=!1:e.isSelected!=e.isChecked&&(e.isSelected=e.isChecked)})},V.prototype.cascadeNodes=function(e,t){var n=this.propagateSelectionDown(e,t);return n=n.concat(this.propagateSelectionUp(e,t)),n=this.getDiffrentData(n),this.updateNodeStatus(),this.updateAllCheckboxStatus(),n},V.prototype.toggleNodeWithCheckbox=function(e,t,n){this.state.rowNodes.find(function(e){return e.id===t.id}).isChecked=n,t.indeterminate=!1;var i=this.cascadeNodes(t,n);this.ttService.onChangeCheckboxStatus(t),n?this.nodeChecked.emit({originalEvent:e,node:t.node,nodes:i,instance:this}):this.nodeUnChecked.emit({originalEvent:e,node:t.node,nodes:i,instance:this}),this.selectWhenChecked(t,n,e),this.onlySelectSelf&&n&&(this.selectedRow=t.node),this.checkeds=v(this.checkeds),this.detectChanges(),e.stopPropagation()},V.prototype.toggleNodesWithCheckbox=function(e,t){t?this.data&&this.data.length&&this.checkAllNodes({originalEvent:e,checked:t,instance:this}):(this.selections=null,this.unCheckAllNodes({originalEvent:e,checked:t,instance:this})),this.detectChanges()},V.prototype.updateAllCheckboxStatus=function(){var e=this.isIndeterminate();this.showCheckAll&&!this.singleSelect&&this.showCheckbox&&e!==undefined&&this.headerCheckboxCmp&&(this.headerCheckboxCmp.chkAll.nativeElement.indeterminate=2===e,this.headerCheckboxCmp.checked=1===e)},V.prototype.updateParentCheckboxStatus=function(e){var n=this,i=[];e.parents.forEach(function(e){var t=n.findRowNode(e);t&&i.push(t)}),i.reverse().forEach(function(e){n.updateCheckboxStatus(e)})},V.prototype.updateParentsCheckStatus=function(e){var t=this,n=[];e.forEach(function(e){n=v(n,e)}),n=Array.from(new Set(n)),this.findRowNodes(n).sort(function(e,t){return t.level-e.level}).forEach(function(e){t.updateCheckboxStatus(e)})},V.prototype.updateCheckboxStatus=function(e){var t=this.isIndeterminate(e);t!==undefined&&e.node.selectable&&(e.indeterminate=2===t,this.ttService.onChangeCheckboxStatus(e))},V.prototype.isIndeterminate=function(e){var t=this.getCheckboxStatus(e);if(t!==undefined){var n=!1;n=2!==t&&!!t,e&&e.node.selectable&&(e.isChecked=n,this.setCheckeds(e,!1))}return t},V.prototype.getCheckboxStatus=function(n){var e,i=this,s=0,o=0,t=[];return e=(t=n?n.node.children||[]:this.state.rowNodes).length,t.forEach(function(e){var t=e;n&&(t=i.findRowNode(e.data[i.idField])),t&&!t.indeterminate&&(t.isChecked?o++:s++)}),0===e?undefined:s===e?0:o===e?1:2},V.prototype.findIndexIn=function(n,e){var i=this,t=-1;return e&&e.length&&(t=e.findIndex(function(e,t){return i.equals(e,n)})),t},V.prototype.findIndexInCheckeds=function(e){return this.findIndexIn(e,this.checkeds)},V.prototype.findIndexInSelection=function(e){return this.findIndexIn(e,this.selections)},V.prototype.equals=function(e,t){return e.data[this.idField]===t.data[this.idField]},V.prototype.toggleExpand=function(e,n,i){var s=this;if(void 0===n&&(n=!1),void 0===i&&(i=!0),e){if(e.expanded=!e.expanded,this.updateNodeProperty(e.id,{expanded:e.expanded}),this.toggleVisible(e),this.virtualized&&e.children&&e.children.length&&this.renderVirtualRowNodes(),e.expanded){if(!(i||e.children&&e.children.length))return void(e.expanded=!e.expanded);this.expand.emit(e)}else this.collapse.emit(e);n&&e.children&&e.children.length&&e.children.forEach(function(e,t){s.toggleExpand(e,n,i)})}else this.data&&this.data.length&&this.data.forEach(function(e){s.toggleExpand(e)});this.setNewColumnsWidth()},V.prototype.toggleVisible=function(t){var s=this,e=this.findRowNode(t.id);if(e){var n=e.id;this.state.rowNodes.filter(function(e){return-1<e.parents.indexOf(n)}).forEach(function(e){!function(t,e){var n=s.findRowNode(t.parent.data[s.idField]);t.visible=n?n.visible&&n.node.expanded:e;var i=s.serializedValue.find(function(e){return e.id===t.id});i&&(i.visible=t.visible)}(e,t.expanded)})}},V.prototype.expandNode=function(e,t,n){if(void 0===t&&(t=!0),void 0===n&&(n=!0),e){var i=this.findRowNode(e);i?(i.node.expanded=!0,this.toggleVisible(i.node),n&&(this.virtualized?i.node.children&&i.node.children.length&&this.renderVirtualRowNodes():this.detectChanges()),t&&this.expand.emit(i.node),this.setNewColumnsWidth()):this.writeConsole("Con't find tree node widh id:"+e,"error")}},V.prototype.expandAll=function(){this.state.rowNodes=this.state.rowNodes.map(function(e){return e.node.expanded=!0,e.visible=!0,e}),this.virtualized?this.renderVirtualRowNodes():this.serializedValue=this.state.rowNodes,this.setNewColumnsWidth(),this.expandAllNodes.emit(),this.detectChanges()},V.prototype.expandNodes=function(e){},V.prototype.expandAllNodesBy=function(t){t&&(t.node.expanded=!0,t.visible=!0,this.state.rowNodes.filter(function(e){return-1<e.parents.indexOf(t.id)}).forEach(function(e){e.visible=!0,e.node.expanded=!0}),this.detectChanges(),this.setNewColumnsWidth())},V.prototype.collapseNode=function(e){if(e){var t=this.findRowNode(e);t?(t.node.expanded=!1,this.toggleVisible(t.node),this.detectChanges(),this.setNewColumnsWidth(),this.collapse.emit(t.node)):this.writeConsole("Con't find tree node widh id:"+e,"error")}},V.prototype.collapseAll=function(){this.state.rowNodes=this.state.rowNodes.map(function(e){return e.node.expanded=!1,e.visible=!e.parent,e}),this.virtualized?this.renderVirtualRowNodes():this.serializedValue=this.state.rowNodes,this.collapseAllNodes.emit(),this.detectChanges(),this.setNewColumnsWidth()},V.prototype.getContainerOffset=function(){var e=this.containerElement.getBoundingClientRect();return{left:e.left+document.body.scrollLeft,top:e.top+document.body.scrollTop}},V.prototype.onColumnResizeBegin=function(e){var t=Math.round(this.getContainerOffset().left);this.lastResizerHelperX=e.pageX-t+this.containerElement.scrollLeft,e.preventDefault()},V.prototype.onColumnResize=function(e){if(this.resizableColumns){var t=this.getContainerOffset().left;this.renderer.addClass(this.containerElement,"ui-unselectable-text"),this.resizerHelperVC.nativeElement.style.height=this.containerElement.offsetHeight+"px",this.resizerHelperVC.nativeElement.style.top="0px",this.resizerHelperVC.nativeElement.style.left=e.pageX-t+"px",this.resizerHelperVC.nativeElement.style.display="block"}},V.prototype.onColumnResizeEnd=function(e,t){var n=this.resizerHelperVC.nativeElement.offsetLeft-this.lastResizerHelperX,i=t.offsetWidth+n,s=t.style.minWidth||15,o=-1;if(t.id)o=this.columns.findIndex(function(e){return e.id===t.id});else{var r=t.getAttribute("field");r&&(o=this.columns.findIndex(function(e){return e.field===r}))}if(this.fitColumns){if(s<i){for(d=t.nextElementSibling;!d.offsetParent;)d=d.nextElementSibling;if(d){var l=d.offsetWidth-n,a=d.style.minWidth||15;15<i&&a<l&&(this.resizeColGroup(this.headerTable.nativeElement,o,i,l),this.resizeColGroup(this.bodyTable.nativeElement,o,i,l))}}}else{this.resizeColGroup(this.headerTable.nativeElement,o,i,0),this.resizeColGroup(this.bodyTable.nativeElement,o,i,0),this.columns[o]&&(this.columns[o].width=i),this.sortColumnsByFixed(!1),this.setTableWidth(this.allColumnsWidth());var d,c=this.columns[o];if(c){var h=this.columnCssName(c)+"{width:"+i+"px}";this.utils.appendCssRules([h],this.styleElement.sheet)}(d=this.columns[o+1])&&d.fixed&&(h=this.columnCssName(d)+"{"+d.fixed+":"+d[d.fixed]+"px}",this.utils.appendCssRules([h],this.styleElement.sheet))}this.resizerHelperVC.nativeElement.style.display="none",this.renderer.removeClass(this.containerElement,"ui-unselectable-text"),this.psRef.directiveRef.update()},V.prototype.resizeColGroup=function(e,t,n,i){if(e){var s="COLGROUP"===e.children[0].nodeName?e.children[0]:null;if(!s)throw new Error("Scrollable tables require a colgroup to support resizable columns");var o=s.children[t],r=o.nextElementSibling;o.style.width=n+"px",r&&i&&this.fitColumns&&(r.style.width=i+"px")}},V.prototype.onSearch=function(){this.state.searchRowNodes=null,this.state.searched=!!this.searchData.value,this.searchData.value&&(this.searchData.value=this.searchData.value.trim()),this.search.emit(this.searchData)},V.prototype.insert=function(e,t){t?(t.children||(t.children=[]),t.children.push(e),this.expandNode(t.data[this.idField]),this.appendNew.emit({parent:t})):this.data.push(e),this.updateSerializedValue()},V.prototype.append=function(e,t){e&&e[this.idField]?this.insert({data:e,id:e[this.idField]},t):this.writeConsole("Please set id value.","warn")},V.prototype.emitAppendNew=function(e){if(this.virtualized){var t=this.psRef.directiveRef.elementRef.nativeElement.scrollTop;this.updateSerializedValue(t)}else this.updateSerializedValue()},V.prototype.appendChildren=function(e,t,n){var i;if(void 0===n&&(n=!0),e&&e.length){if(!t)throw new Error("未找到父级节点");(i=t.children).push.apply(i,v(e)),this.emitAppendNew(t),n&&this.appendNew.emit({parent:t})}else this.updateSerializedValue(),this.writeConsole("添加子节点的数据为空","warn")},V.prototype.loadChildren=function(e,t,n){void 0===n&&(n=!0),t&&(t.children=e||[],this.emitAppendNew(t),n&&this.appendNew.emit({parent:t}))},V.prototype.remove=function(t){var n=this;if(t){var e=this.findRowNode(t);e&&(this.selectValue===t&&(this.selectedRow=null,this.selectValue=null),e.parent?o.remove(e.parent.children,function(e){return e.data[n.idField]===t}):(o.remove(this.state.rowNodes,function(e){return e.id===t}),this.data=this.data.filter(function(e){return e.data[n.idField]!==t})),this.updateSerializedValue(),this.detectChanges(),this.ttService.onRemove(e),this.removed.emit(e))}},V.prototype.update=function(e,t){if(e&&t){var n=this.findRowNode(e);n&&(n.node.data=o.extend(n.node.data,t),this.detectChanges(),this.ttService.onUpdate(n),this.updated.emit(n))}},V.prototype.updateNodeProperty=function(e,t){var n=this.findRowNode(e);n&&t&&Object.keys(t).forEach(function(e){n.node[e]=t[e]})},V.prototype.setScorllBodyHeight=function(){if(this.scorllBodyHeight=this.height,this.showFilterBar&&(this.scorllBodyHeight=this.scorllBodyHeight-46),this.fixedHeader&&this.showHeader)if(this.headerBox&&(this.headerWrap||this.useGroupHeader)){var e=this.headerBox.nativeElement.clientHeight;this.scorllBodyHeight=this.scorllBodyHeight-e}else this.scorllBodyHeight=this.scorllBodyHeight-this.headerHeight;this.pagination&&(this.scorllBodyHeight=this.scorllBodyHeight-this.pagerHeight),this.detectChanges()},V.prototype.resize=function(e){if(e){var t=parseInt(""+e.width,10),n=parseInt(""+e.height,10);if(this.width===t&&this.height===n)return this.state.scrollY&&this.psRef.directiveRef.scrollToY(this.state.scrollY),void(this.state.scrollX&&this.psRef.directiveRef.scrollToX(this.state.scrollX));this.width=t,this.height=n}this.setScorllBodyHeight(),this.data&&this.data.length&&this.renderVirtualRowNodes()},V.prototype.loadData=function(e){this.data=e},V.prototype.empty=function(){this.data=[]},V.prototype.getCurrentAllRowNodes=function(){return this.state.searched&&this.state.searchRowNodes&&this.state.searchRowNodes.length&&this.state.searchRowNodes||this.state.rowNodes},V.prototype.clearAll=function(e){var t=this;return void 0===e&&(e=!0),this.state.rowNodes.filter(function(e){return e.indeterminate}).forEach(function(e){e.indeterminate=!1,t.ttService.onChangeCheckboxStatus(e)}),this.state.rowNodes=this.state.rowNodes.map(function(e){return e.isChecked=!1,e.isSelected=!1,e.indeterminate=!1,e}),this.state.searched&&this.state.searchRowNodes&&this.state.searchRowNodes.length&&(this.serializedValue=this.state.searchRowNodes.map(function(e){return e.isChecked=!1,e.isSelected=!1,e.indeterminate=!1,e})),this.checkeds=[],this.selections=[],this.selectedRow=undefined,this.showCheckAll&&this.headerCheckboxCmp&&(this.headerCheckboxCmp.chkAll.nativeElement.indeterminate=!1,this.headerCheckboxCmp.checked=!1),e&&this.detectChanges(),this},V.prototype.detectChanges=function(){return this.cdRef.markForCheck(),this.cdRef.destroyed||this.cdRef.detectChanges(),this},V.prototype.clearCheckeds=function(){var t=this;return this.checkeds&&this.checkeds.length&&this.findRowNodes(this.checkeds.map(function(e){return e.data[t.idField]})).forEach(function(e){e.isChecked=!1}),this.checkeds=[],this.showCheckAll&&this.headerCheckboxCmp&&(this.headerCheckboxCmp.chkAll.nativeElement.indeterminate=!1,this.headerCheckboxCmp.checked=!1),this},V.prototype.clearSelections=function(){var t=this;if(this.serializedValue&&this.serializedValue.length&&this.serializedValue.forEach(function(e){e.isSelected=!1}),this.state.rowNodes.forEach(function(e){e.isSelected=!1}),this.selections&&this.selections.length){var e=this.selections.map(function(e){return e.data[t.idField]});this.findRowNodes(e).forEach(function(e){e.isSelected=!1,t.singleSelect&&(e.isChecked=!1)})}return this.selections=undefined,this.selectedRow=undefined,this},V.prototype.selectFirstNode=function(){if(this.state.rowNodes&&this.state.rowNodes.length){var e=this.state.rowNodes.find(function(e){return e.node.selectable});e&&this.selectNode(e.id)}},V.prototype.scrollToCurrentRow=function(e){var t="rownode-"+e,n=this.el.nativeElement.querySelector("#"+t)||document.getElementById(t);if(n&&n.closest(".farris-treetable")&&n.closest(".farris-treetable").id===this.id){if(!this.isElementInViewport(n)){if(n.scrollIntoViewIfNeeded)return n.scrollIntoViewIfNeeded(),!0;this.utils.getBrowserType().ff&&this.utils.getFFVer()<58?n.scrollIntoView():n.scrollIntoView({block:"nearest",inline:"nearest"})}return!0}return!1},V.prototype.isElementInViewport=function(e){var t=this.el.nativeElement.querySelector(".farris-treetable-body");if(!t)return!1;var n=t.getBoundingClientRect().height,i=e.offsetTop+this.topHideHeight-this.psRef.directiveRef.elementRef.nativeElement.scrollTop;return 0<=i&&i<=n},V.prototype.scrollToCurrentNode=function(){var t=this;if(this.selectedRow){var n=this.selectedRow.id;if(!this.scrollToCurrentRow(n)){var e=this.findRowNode(n),i=Math.ceil(this.scorllBodyHeight/this.rowHeight)+1;e.parents&&e.parents.length&&e.parents.forEach(function(e){t.expandNode(e,!1,!1)});var s=this.state.rowNodes.filter(function(e){return e.visible}).findIndex(function(e){return e.id===n});if(s<i)return this.virtualized&&this.renderData(0),void setTimeout(function(){t.scrollToCurrentRow(n)});var o=s*this.rowHeight;this.virtualized?this.renderData(o-this.rowHeight):this.scrollToY(o-this.rowHeight),this.scrollToCurrentRow(n)}}},V.prototype.selectNode=function(e,t,n){var i=this;if(void 0===t&&(t=!0),void 0===n&&(n=!0),!e)return this;var s=this.findRowNode(e),o=!this.selectedRow||this.selectedRow&&e!==this.selectedRow.id;return s&&o?(s.isSelected=!0,this.singleSelect||this.onlySelectSelf?(this.clearSelections(),this.selections=[s.node],this.checkOnSelect&&this.showCheckbox&&(s.isChecked=!0,this.multiSelect?this.setCheckeds(s):(this.clearCheckeds(),this.checkeds=[s.node]),this.cascadeCheck&&this.cascadeUp&&this.updateParentCheckboxStatus(s))):this.setSelections(s),this.selectedRow=s.node,this.selectNodeChangedSubject.next(e),this.nodeSelected.emit({node:s.node,instance:this}),this.serializedValue.find(function(e){return e.id==i.selectedRow.id})&&(this.serializedValue.find(function(e){return e.id==i.selectedRow.id}).isSelected=!0),t&&this.detectChanges(),n&&this.fixedHeader&&this.scrollToCurrentNode()):s||(this.selectedRow=null,this.writeConsole("未找到ID为 "+e+" 的数据！！")),this},V.prototype.unSelectNode=function(e,t){void 0===t&&(t=!0);var n=this.findRowNode(e);n?(n.isSelected=!1,this.singleSelect?(this.clearSelections(),this.selectedRow=null,n.isChecked=!1,this.selections=[]):this.onlySelectSelf?this.selections=[]:this.setSelections(n),t&&this.detectChanges(),this.nodeUnSelect.emit({node:n.node,instance:this})):this.writeConsole("未找到ID为"+e+"的数据！！")},V.prototype.selectNodes=function(e,t,n){var i=this;if(void 0===t&&(t=!0),void 0===n&&(n=!1),e&&e.length){var s=this.findRowNodes(e).map(function(e){return e.isSelected=!0,i.setSelections(e),e.node});this.selections=v(this.selections),t&&this.detectChanges(),this.selectNodeChangedSubject.next(e.join(",")),n&&this.nodeSelected.emit({node:s,instance:this})}return this},V.prototype.unSelectNodes=function(e){var t=this;if(e&&e.length){var n=this.findRowNodes(e);n&&n.length&&(n.forEach(function(e){e.isSelected=!1,t.setSelections(e)}),this.selections=v(this.selections),this.detectChanges(),this.nodeUnSelect.emit({node:n.map(function(e){return e.node}),instance:this}))}else this.clearSelections(),this.detectChanges()},V.prototype.checkedNode=function(e,t,n){if(void 0===t&&(t=!0),void 0===n&&(n=!0),this.isEnableMultiSelect()){var i=this.findRowNode(e);i?(i.isChecked=!0,this.isChecked(i.node)||(this.setCheckeds(i,!1),t&&this.cascadeCheck&&this.cascadeUp&&this.updateParentCheckboxStatus(i)),n&&this.detectChanges(),this.nodeChecked.emit({originalEvent:null,node:i.node,instance:this})):this.writeConsole("未找到ID为"+e+"的数据！！")}},V.prototype.unCheckedNode=function(t,e){if(void 0===e&&(e=!0),this.isEnableMultiSelect()){var n=this.findRowNode(t);if(n)if(n.isChecked=!1,this.setCheckeds(n),this.selectOnCheck&&(n.isSelected=!1,this.setSelections(n)),this.selectedRow&&this.selectedRow.id===t&&(this.selectedRow=null),this.singleSelect||!this.cascadeCheck)this.updateNodeStatus(),e&&this.cascadeCheck&&this.cascadeUp&&this.updateParentCheckboxStatus(n),this.checkValues&&(this.checkValues=this.checkValues.filter(function(e){return e!==t}),this.checkValuesChange.emit(this.checkValues)),this.detectChanges(),this.nodeUnChecked.emit({node:n,instance:this});else{var i=this.cascadeNodes(n,!1);this.checkeds=v(this.checkeds),this.checkValuesChange.emit(this.checkValues),this.detectChanges(),this.nodeUnChecked.emit({node:n,nodes:i,instance:this})}else this.writeConsole("未找到ID为"+t+"的数据！！")}},V.prototype._checkedNodes=function(e,t){var n=this,i=[],s=this.findRowNodes(e).map(function(e){return i.push(e.parents),e.isChecked=t,n.setCheckeds(e,!1),e.node});return this.checkeds=v(this.checkeds),this.cascadeCheck&&this.cascadeUp&&this.updateParentsCheckStatus(i),s},V.prototype.checkedNodes=function(e,t,n,i){if(void 0===t&&(t=!0),void 0===n&&(n=!0),this.isEnableMultiSelect()&&e&&e.length){var s=this.cascadeCheck;i&&s&&(this.cascadeCheck=!1);var o=this._checkedNodes(e,!0);i&&s&&(this.cascadeCheck=!0),this.updateAllCheckboxStatus(),t&&this.detectChanges(),n&&this.nodeChecked.emit({originalEvent:null,node:o,nodes:o,instance:this})}},V.prototype.unCheckedNodes=function(e,t,n){if(void 0===n&&(n=!0),e&&e.length){var i=this.cascadeCheck;t&&i&&(this.cascadeCheck=!1);var s=this._checkedNodes(e,!1);t&&i&&(this.cascadeCheck=!0),this.detectChanges(),n&&this.nodeUnChecked.emit({originalEvent:null,node:s,nodes:s,instance:this})}else this.clearCheckeds(),this.detectChanges()},V.prototype.findRowNode=function(t){return t&&this.state.rowNodes?this.state.rowNodes.find(function(e){return e.id===t}):undefined},V.prototype.findNode=function(e){return this.findRowNode(e)},V.prototype.getRoot=function(e){var t=this.findRowNode(e);return t?t.parents&&t.parents.length?this.findRowNode(t.parents[0]):t:null},V.prototype.findRowNodes=function(t){return this.state.rowNodes.filter(function(e){return-1<t.indexOf(e.id)})},V.prototype.checkAllNodes=function(e){var n=this,t=this.getCurrentAllRowNodes();t=t.filter(function(e){return e.node.selectable||e.node.selectable===undefined}),this.checkeds=t.map(function(e){return e.indeterminate=!1,n.ttService.onChangeCheckboxStatus(e),!e.node.selectable&&e.node.selectable!==undefined||(e.isChecked=!0),e.node}),this.selectOnCheck&&!this.onlySelectSelf&&(this.selections=t.map(function(e){return!e.node.selectable&&e.node.selectable!==undefined||(e.isSelected=!0),e.node})),this.state.searched&&t.forEach(function(t){var e=n.state.rowNodes.find(function(e){return e.id===t.id});e&&(e.isSelected=t.isSelected,e.isChecked=t.isChecked)}),this.checkAll.emit(e),this.detectChanges()},V.prototype.unCheckAllNodes=function(e){this.clearAll(),this.unCheckAll.emit(e),this.detectChanges()},V.prototype.isEnableMultiSelect=function(){return!this.singleSelect||!!this.showCheckbox},V.prototype.getNodeIconFromData=function(e){var t=null,n=null,i=null;if(this.useIconFromData&&this.iconField){var s="";"string"==typeof this.iconField?n=i=t=e[s=this.iconField]?e[s]:this.utils.getValue(s,e.data):(this.iconField.leaf&&(t=this.utils.getValue(this.iconField.leaf,e.data)),this.iconField.expand&&(n=this.utils.getValue(this.iconField.expand,e.data)),this.iconField.collapse&&(i=this.utils.getValue(this.iconField.collapse,e.data)),n&&!i&&(i=n),!n&&i&&(n=i))}return{leaf:t,expand:n,collapse:i}},V.prototype.getTreeIcon=function(e){var t=e,n=this.leafIcon||"file",i=this.expandIcon||"folder-open",s=this.collapseIcon||"folder";if(t.showLoading)return{"f-loading-round":!0};if(t.icon&&(n=t.icon),t.expandedIcon&&(i=t.expandedIcon),t.collapsedIcon&&(s=t.collapsedIcon),this.useIconFromData){var o=this.getNodeIconFromData(e),r=o.leaf,l=o.expand,a=o.collapse;this.whenDataIconEmptyUseDefault?(r&&(n=r),l&&(i=l),a&&(s=a)):(n=r||"",i=l||"",s=a||"")}var d=!(t.leaf&&(!t.children||!t.children.length)||t.expanded),c=!!t.expanded,h=t.leaf===undefined?!t.children||!t.children.length:t.leaf,u={};return h&&n?u[n]=h:t.expanded&&i?u[i]=c:s&&(u[s]=d),this.iconCls&&(u[this.iconCls]=!0),u},V.prototype.compare=function(e,t){return"string"==typeof e?e.localeCompare(t):e===t?0:t<e?1:-1},V.prototype._sort=function(r,l){var a=0,d=this.sortName.split(","),c=this.sortOrder.split(",");if(!this.sortName)return a;for(var e=function(e){var t=d[e],n=c[e],i=h.columns.find(function(e){return e.field===t}).sorter||h.compare,s=h.utils.getValue(t,r.data);null!==s&&s!==undefined||(s="");var o=h.utils.getValue(t,l.data);if(null!==o&&o!==undefined||(o=""),0!==(a=i(s,o)))return{value:a*("asc"===n?1:-1)}},h=this,t=0;t<d.length;t++){var n=e(t);if("object"==typeof n)return n.value}return a},V.prototype.clientSort=function(){var t=this,e=this.data.sort(this._sort.bind(this)),n=function(e){return(e=e.sort(t._sort.bind(t))).forEach(function(e){e.children&&e.children.length&&(e.children=e.children.sort(t._sort.bind(t)),n(e.children))}),e};e.forEach(function(e){e.children=n(e.children)}),this.loadData(e)},V.prototype.onSortColumnClick=function(e,t){var n=this;if(t.sortable){var i=this.sortName,s=this.sortOrder,o=[],r=[];i&&(o=i.split(","),r=s.split(","));var l,a=t.order||"asc",d=a,c=o.findIndex(function(e){return e===t.field});if(0<=c){var h="asc"===r[c]?"desc":"asc";d=h,this.multiSort&&"asc"===d?(d=undefined,o.splice(c,1),r.splice(c,1)):r[c]=h}else this.multiSort?(o.push(t.field),r.push(a)):(o=[t.field],r=[a]);t.order=d,this.sortName=o.join(","),this.sortOrder=r.join(","),this.multiSort||((l=this.columns)&&l.length&&l.forEach(function(t){t.order=undefined;var e=o.findIndex(function(e){return e===t.field});0<=e&&(t.order=r[e])}),this.cdRef.detectChanges()),this.beforeSortColumn(this.sortName,this.sortOrder).subscribe(function(){n.remoteSort||n.clientSort(),n.columnSorted.emit({sortName:n.sortName,sortOrder:n.sortOrder})})}},V.prototype.findKeyWords=function(e){var n=this,t=e.value,i=e.field;if(this.findField=i,t&&2<=t.length){if(this.findValue=t,!i)return void this.writeConsole("Please set a field for the FindField property.","warn");var s=this.searchHandle.searchOnClient(i,t,this.state.rowNodes);if(s&&s.length){this.findResult=s.sort(function(e,t){return e.index===t.index?0:e.index>t.index?1:-1});var o=s[0].index;this.findCount=s.length;var r=this.searchHandle.findParents(s,this.state.rowNodes);this.findCurrent=1,v(r,s).forEach(function(e){n.expandNode(e.id)});var l=0;this.state.rowNodes.forEach(function(e,t){e.visible&&t<o&&(l+=n.rowHeight)}),this.psRef&&this.psRef.directiveRef&&this.psRef.directiveRef.scrollToY(l-30),this.highLightKeywords()}else this.findResult=[],this.findCurrent=0,this.findCount=0}else this.resetFindText(),this.cdRef.detectChanges()},V.prototype.closeFindPanel=function(){this.showFindInput=!1,this.resetFindText(),this.cdRef.detectChanges()},V.prototype.highLightKeywords=function(){var t=this;this.ngZone.runOutsideAngular(function(){setTimeout(function(){var e=t.el.nativeElement.querySelectorAll(".search-highlight");e.length&&(t.cdRef.detectChanges(),t.renderer.addClass(e[0],"active"))},100)})},V.prototype.resetFindText=function(){this.findValue="",this.findCurrent=0,this.findCount=0,this.findResult=[]},V.prototype.nextFindValue=function(e){var n=this;if(this.findResult&&this.findResult.length){var t=Array.from(this.el.nativeElement.querySelectorAll(".search-highlight"));this.findCurrent===this.findResult.length?this.findCurrent=1:e?(this.findCurrent=this.findCurrent+e,-1===e&&this.findCurrent<=0&&(this.findCurrent=1)):this.findCurrent++;var i=this.el.nativeElement.querySelector(".search-highlight.active"),s=t.indexOf(i);if(i&&this.renderer.removeClass(i,"active"),this.virtualized)if(t[s+=e||1])this.renderer.addClass(t[s],"active");else{var o=this.findResult[this.findCurrent-1],r=0;this.state.rowNodes.forEach(function(e,t){e.visible&&o.index>t&&(r+=n.rowHeight)}),this.psRef&&this.psRef.directiveRef&&this.psRef.directiveRef.scrollToY(r-30,200),this.ngZone.runOutsideAngular(function(){setTimeout(function(){var e=n.el.nativeElement.querySelectorAll(".search-highlight");n.renderer.addClass(e[0],"active")},100)})}else{var l=t[this.findCurrent-1];if(l&&(this.renderer.addClass(l,"active"),this.psRef&&this.psRef.directiveRef)){var a=l.closest("td").offsetTop-30;this.psRef.directiveRef.scrollToY(a,200)}}this.cdRef.detectChanges()}},V.prototype.scrollToY=function(e,t){void 0===t&&(t=200),this.state.scrollY=e||0,this.psRef.directiveRef.scrollToY(e,t)},V.prototype.showOrHideColumn=function(t,n){Array.isArray(t)?this.columns.forEach(function(e){-1<t.indexOf(e.field)&&(e.visible=!n)}):this.columns.forEach(function(e){t===e.field&&(e.visible=!n)}),this.columnsChanged()},V.prototype.showColumn=function(e){this.showOrHideColumn(e,!1)},V.prototype.hideColumn=function(e){this.showOrHideColumn(e,!0)},V.prototype.showChildsLoading=function(e){var t,n=this.columns.filter(function(e){return!1!==e.visible}).length,i=((t={})[this.idField]="正在加载中....",t.__colspan__=n,t);this.loadChildren([{data:i,__childs_loading__:!0}],e,!1)},V.prototype.onChildsPageChanged=function(e){this.childsPageChanged.emit(e)},V.prototype.trId2DataId=function(e){return e.id.replace("rownode-","")},V.prototype.onKeydownEvent=function(e){var t=this;if(e&&this.singleSelect&&this.data&&this.data.length&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)&&"INPUT"!==e.target.nodeName){var n;e.stopPropagation(),e.preventDefault(),this.inputGroup.textbox.nativeElement.blur();var i=Array.from(this.bodyTable.nativeElement.querySelectorAll("tr")),s=i.length,o=-1;if(this.selectedRow&&(o=i.findIndex(function(e){return t.trId2DataId(e)===t.selectedRow.id})),"ArrowDown"===e.code)n=o+1;else{if("ArrowUp"!==e.code)return void(!this.selectedRow||"ArrowRight"!==e.code&&"ArrowLeft"!==e.code||this.toggleExpand(this.selectedRow));-1!==o&&(n=o-1)}if(0<=n&&n<s){var r=i[n];if(r){var l=this.trId2DataId(r);this.selectNode(l),r.scrollIntoView({block:"nearest"})}}}},V.prototype.getChildNodes=function(e){var t=this,n=[];if(e){var i=this.findRowNode(e);return i&&i.node.children&&i.node.children.length&&i.node.children.forEach(function(e){e.node.selectable&&(n.push(e),n=n.concat(t.getChildNodes(e.id)))}),n}return[]},V.prototype.getParentNodes=function(e){var n=this,i=[];if(e){var t=this.findRowNode(e);return t&&t.parents&&t.parents.length&&t.parents.forEach(function(e){var t=n.findRowNode(e);t&&t.node.selectable&&i.push(t)}),i}return[]},V.decorators=[{type:m.Component,args:[{selector:"farris-treetable",template:'\x3c!--\r\n * @Author: 疯狂秀才(Lucas Huang)\r\n * @Date: 2019-06-03 20:00:11\r\n * @LastEditors: 疯狂秀才(Lucas Huang)\r\n * @LastEditTime: 2019-11-28 14:23:52\r\n * @QQ: 1055818239\r\n * @Version: v0.0.1\r\n --\x3e\r\n<div class="filter-row" style="width: 100%;" *ngIf="showFilterBar">\r\n    <form style="display: flex; width: 100%;">\r\n        <div class="search-fields" style="padding-left:0;" [style.display]="showSearchField ? \'\': \'none\'">\r\n            <select class="custom-select" [(ngModel)]="searchData.field" name="field">\r\n                <option value="*">{{allColumnsTitle}}</option>\r\n                <option *ngFor="let col of searchFields" value="{{col.value}}">{{ col.label }}</option>\r\n            </select>\r\n        </div>\r\n        <div class="search-text flex-fill" style="padding-right: 0px;">\r\n            <input-group #inputGroup [groupText]="searchButtonText" name="searchValue" [(ngModel)]="searchData.value"\r\n                (clear)="onClearSearchValue()" (valueChange)="onSearchValueChange($event)" (clickHandle)="onSearch()"\r\n                (keydownHandle)="onKeydownEvent($event)"></input-group>\r\n        </div>\r\n    </form>\r\n</div>\r\n\r\n<ng-content select="tt-column"></ng-content>\r\n\r\n<ng-template #tdcell let-col let-serializedNode="rowNode" let-left="left">\r\n\r\n    <ng-container *ngIf="enableFindText">\r\n        <span *ngIf="!col.formatter" style="width: 100%;"\r\n            [innerHTML]="getNodeText(col, serializedNode.node.data) | highlight: findValue: col.field :findField"></span>\r\n        <span *ngIf="col.formatter" style="width: 100%;" \r\n            [innerHTML]="formatData(col, serializedNode.node.data, col.formatter) | safe: \'html\' "></span>\r\n    </ng-container>\r\n\r\n    <ng-container *ngIf="!enableFindText">\r\n        <span *ngIf="!col.formatter" style="width: 100%;"\r\n            [innerHTML]="getNodeText(col, serializedNode.node.data)"></span>\r\n        <span *ngIf="col.formatter" style="width: 100%;" \r\n            [innerHTML]="formatData(col, serializedNode.node.data, col.formatter) | safe: \'html\' "></span>\r\n    </ng-container>\r\n</ng-template>\r\n\r\n<ng-template #tbodyrows>\r\n    <ng-template ngFor let-serializedNode let-rowIndex="index" [ngForTrackBy]="trackByFn" [ngForOf]="pagination ? (serializedValue | paginate: paginationOptions) : serializedValue">\r\n        <tr *ngIf="serializedNode.visible" #row="row" \r\n            [attr.id]=" \'rownode-\' + serializedNode.id" class="f-treetable-row"\r\n            [selectRow]="serializedNode" [rowIndex]="rowIndex" [dblclick]="true" [dblclickNode]="serializedNode"\r\n            [selectRowDisabled]="serializedNode.node | disablenode: disabledRow"\r\n            [customRowStyle]="serializedNode"\r\n            [class.f-treetable-disable-row]="serializedNode.node | disablenode: disabledRow"\r\n            [class.farris-table-selectedrow]="serializedNode.isSelected">\r\n\r\n            <td *ngIf="serializedNode.node.data[\'__colspan__\']"  [attr.colspan]=" serializedNode.node.data[\'__colspan__\'] || 0">\r\n                <childs-loading></childs-loading>\r\n            </td>\r\n\r\n            <ng-container *ngIf="!serializedNode.node.data[\'__colspan__\']">\r\n                <td *ngFor="let col of columns; let i = index;"\r\n                    [customCellStyle]="col" [rowNode]="serializedNode" [rowIndex]="rowIndex"\r\n                    [style.textAlign]="col!.align || \'left\'" \r\n                    (click)="onCellClick($event, col, serializedNode.node)"\r\n                    class="treetable-cell" [attr.field]="col.field"\r\n                    [attr.colspan]=" serializedNode.node.data[\'__cellspan__\'] || 0"\r\n                    [attr.title]="col | tipmsg: serializedNode.node"\r\n                    [class.f-treetable--fixed-left]="fixedHeader && col.fixed && col.fixed === \'left\'"\r\n                    [class.f-treetable--fixed-right]="fixedHeader && col.fixed && col.fixed === \'right\'"\r\n                    [attr.r-tt-shadow-col]="col.rightShadowCol"\r\n                    [attr.l-tt-shadow-col]="col.leftShadowCol"\r\n                >\r\n\r\n                    <div class="treetable-cell-content d-flex">\r\n                        <farris-treeTableToggler style="float: left"\r\n                            [showLines]="showLines"\r\n                            [indentSpacing]="indentSpacing"\r\n                            [disabled]="serializedNode.node | disablenode: disabledRow: disabled"\r\n                            [rowNode]="serializedNode" *ngIf="i == 0"></farris-treeTableToggler>\r\n                        \r\n                        <div class="flex-grow-1 text">\r\n                            <ng-container *ngIf="!col.template">\r\n                                <ng-container *ngTemplateOutlet="tdcell; context: {$implicit: col, node: serializedNode.node, rowNode: serializedNode, rowData: serializedNode.node.data  }" ></ng-container>\r\n                            </ng-container>\r\n            \r\n                            <ng-container *ngIf="col.template"\r\n                                [ngTemplateOutlet]="col.template"\r\n                                [ngTemplateOutletContext]="{$implicit: { column: col, node: serializedNode.node, rowNode: serializedNode, rowData:  serializedNode.node.data  }}">\r\n                            </ng-container>\r\n                        </div>\r\n                    </div>\r\n                </td>\r\n            </ng-container>\r\n        </tr>\r\n    </ng-template>\r\n</ng-template>\r\n\r\n<ng-template #tbody>\r\n    <tbody class="farris-treetable-tbody"\r\n        [farris-context-menus]="contextMenuItems" [disabled]="!enableContextMenu" \r\n        [activeDomName]="\'tr\'" [beforeShowContextMenu]="onBeforeShowContextMenu"\r\n        [menuClass]="\'f-treetable-context-menu\'">\r\n        <ng-container *ngTemplateOutlet="tbodyrows"></ng-container>\r\n    </tbody>\r\n</ng-template>\r\n\r\n\x3c!--单行表头模板--\x3e\r\n<ng-template #headerCells let-cols>\r\n    <ng-template ngFor let-col [ngForOf]="cols" let-i="index" let-first="first" let-last="last">\r\n        <th [resizable-column]="(!col.lastColumn || !last) && (!col.colspan || col.colspan == 1)" [style.textAlign]="col!.hAlign || \'left\'" #th \r\n            class="treetable-header-cell"\r\n            [class.f-treetable--fixed-left]="col.fixed && col.fixed === \'left\'"\r\n            [class.f-treetable--fixed-right]="col.fixed && col.fixed === \'right\'"\r\n            [attr.field]="col.field || \'\'"\r\n            [attr.r-tt-shadow-col]="col.rightShadowCol"\r\n            [attr.l-tt-shadow-col]="col.leftShadowCol"\r\n            [attr.colspan]="col.colspan" \r\n            [attr.rowspan]="col.rowspan"\r\n            [class.group-header-cell]="col.colspan && col.colspan > 1"\r\n            [attr.id]="col.id"\r\n            >\r\n      \r\n            <div class="d-flex" style="line-height: 1.25em;" [style.padding-right.px]="col.sortable ? 10: 0">\r\n                <ng-container *ngIf="!singleSelect && showCheckAll && first && showCheckbox && !last">\r\n                    <tt-header-checkbox #allCheckbox></tt-header-checkbox>\r\n                </ng-container>\r\n                <ng-container *ngIf="col.headTemplate"\r\n                    [ngTemplateOutlet]="col.headTemplate"\r\n                    [ngTemplateOutletContext]="{$implicit: { column: col}}">\r\n                </ng-container>\r\n                <ng-container *ngIf="!col.headTemplate">\r\n                    <span style="overflow: hidden;width: 100%;" *ngIf="!headerWrap">{{ col.title }}</span>\r\n                    <span style="white-space: pre-wrap;width: 100%;"  *ngIf="headerWrap">{{ col.title }}</span>\r\n                </ng-container>\r\n                <ng-container *ngIf="col.sortable">\r\n                    <span class="f-treetable-sort"\r\n                        [class.f-treetable-sort-asc]="col.order === \'asc\'"\r\n                        [class.f-treetable-sort-desc]="col.order === \'desc\'"\r\n                        (click)="onSortColumnClick($event, col)" *ngIf="col.order"></span>\r\n                    <span class="f-treetable-sort" (click)="onSortColumnClick($event, col)" *ngIf="!col.order"></span>\r\n                </ng-container>\r\n\r\n            </div>\r\n        </th>\r\n    </ng-template>\r\n</ng-template>\r\n\r\n\x3c!--多行表头模板--\x3e\r\n<ng-template #groupHeader>\r\n    <tr *ngFor="let cols of groupColumns">\r\n        <ng-container *ngTemplateOutlet="headerCells; context: {$implicit: cols}"></ng-container>\r\n    </tr>\r\n</ng-template>\r\n\r\n\r\n<ng-template #scorllview>\r\n    <div class="farris-treetable fixed" [attr.id]="id" [class.f-treetable--fixed-columns]="fixedColumns"\r\n        [class.farris-treetable-nowrap]="!nowrap" [class.table-bordered]="showBorder"\r\n        [ngClass]="{\'farris-treetable-disabled\': disabled, \'flex-fill\': fit}"\r\n        [class.farris-treetable-showlines]="showLinesOnHover && showLines" [style.width]="fit ? \'100%\' : width + \'px\'"\r\n        >\r\n        <div #headerBox class="farris-treetable-header" *ngIf="showHeader && columns" style="overflow: hidden; background-color: #f7f8fb">\r\n            <table #headerTable class="table" >\r\n                <colgroup *ngIf="!autoWidth">\r\n                    <ng-container *ngFor="let col of columns">\r\n                        <col *ngIf="columnIsVisible(col)" [style.width]="getRealColWidth(col)" />\r\n                    </ng-container>\r\n                </colgroup>\r\n                <thead class="farris-treetable-thead" [class.header-wrap]="headerWrap">\r\n                    <ng-container *ngIf="!headerTemplate">\r\n                        <tr *ngIf="!useGroupHeader; else groupHeader">\r\n                            <ng-container *ngTemplateOutlet="headerCells; context: {$implicit: columns}"></ng-container>\r\n                        </tr>\r\n                    </ng-container>\r\n\r\n                    <ng-container *ngIf="headerTemplate">\r\n                        <ng-container *ngTemplateOutlet="headerTemplate; context: {$implicit: columns}"></ng-container>\r\n                    </ng-container>\r\n                </thead>\r\n            </table>\r\n            \x3c!-- 客户端查询定位工具条 --\x3e\r\n            <find-input *ngIf="showFindInput" [columns]="columns" [current]="findCurrent" [count]="findCount"\r\n                (valueChanged)="findKeyWords($event)" (close)="closeFindPanel()" (enterHandler)="nextFindValue($event)">\r\n            </find-input>\r\n\r\n        </div>\r\n\r\n        <div class="farris-treetable-body">\r\n            <perfect-scrollbar #perfectScrollbar [config]="{minScrollbarLength: 15}" (psScrollX)="onScrollX($event)"\r\n                (psScrollY)="onScrollY($event)" [style.height]="scorllBodyHeight + \'px\'">\r\n                <div *ngIf="topHideHeight && virtualized" [style.height]="topHideHeight + \'px\'"> </div>\r\n                <table #bodyTable class="table" [style.tableLayout]="autoWidth? \'auto\': \'fixed\'"\r\n                    [ngClass]="{\'table-striped\': striped, \'table-hover\': hovered, \'f-table-norecords\': (!serializedValue || !serializedValue.length) }">\r\n                    <colgroup>\r\n                        <ng-container *ngFor="let col of columns">\r\n                            <col *ngIf="columnIsVisible(col)" [style.width]="getRealColWidth(col)" />\r\n                        </ng-container>\r\n                    </colgroup>\r\n\r\n                    <ng-container *ngIf="!serializedValue || !serializedValue.length">\r\n                        <tbody class="farris-treetable-tbody">\r\n                            <tr class="f-table-norecords-row">\r\n                                <td [attr.align]="\'center\'" class="farris-treetable-emptydata" [attr.colspan]="columns.length">\r\n                                    <div class="f-table-norecords-content" >\r\n                                        {{ \'treetable.emptyMessage\' | locale }}\r\n                                    </div>\r\n                                </td>\r\n                            </tr>\r\n                        </tbody>\r\n                    </ng-container>\r\n\r\n                    <ng-container *ngIf="serializedValue && serializedValue.length">\r\n                        <ng-container *ngIf="bodyTemplate">\r\n                            <tbody class="farris-treetable-tbody" treeTableBody [columns]="columns" [template]="bodyTemplate"></tbody>\r\n                        </ng-container>\r\n\r\n                        <ng-container #defaultBodyTemplate *ngIf="!bodyTemplate">\r\n                            <ng-container *ngTemplateOutlet="tbody"></ng-container>\r\n                        </ng-container>\r\n                    </ng-container>\r\n                </table>\r\n                <div *ngIf="bottomHideHeight && virtualized" [style.height]="bottomHideHeight + \'px\'"> </div>\r\n            </perfect-scrollbar>\r\n        </div>\r\n\r\n        \x3c!-- 分页条 --\x3e\r\n        <div *ngIf="pagination" #tablePager class="farris-table-pager" [ngStyle]=" { \'opacity\': (disabled ? 0.6 : 1), \'pointer-events\': (disabled? \'none\': \'\')  }">\r\n            <pagination-controls #pager [id]="paginationOptions?.id"\r\n                [maxSize]="pagerLabelSize" [directionLinks]="true"\r\n                [autoHide]="false" [responsive]="true"\r\n                [previousLabel]="\' \'" [nextLabel]="\' \'"\r\n                [showPageInfo]="showPageInfo" [showPageNumber]="showPageNumber" [showPageList]="showPageList"\r\n                (pageChange)="onPageChange($event)" [showGotoInput]="showGotoInput"\r\n                (pageSizeChange)="onPageSizeChange($event)"\r\n                >\r\n            </pagination-controls>\r\n        </div>\r\n\r\n        <div #resizerHelper class="column-resizer-helper" *ngIf="resizableColumns"></div>\r\n    </div>\r\n</ng-template>\r\n\r\n<ng-template #nodespagerbar let-ctx>\r\n    <nodes-pager [context]="ctx" [disabled]="disabled" (pageChange)="onChildsPageChanged($event)" [showTotal]="showTotalForChildren"></nodes-pager>\r\n</ng-template>\r\n\r\n\r\n\r\n<div class="farris-treetable" [class.table-bordered]="showBorder" [attr.id]="id"\r\n    [class.farris-treetable-showlines]="showLinesOnHover && showLines" \r\n    [class.farris-treetable-nowrap]="!nowrap"  *ngIf="!fixedHeader; else scorllview">\r\n    <table class="table" [style.tableLayout]="autoWidth? \'auto\': \'fixed\'"\r\n        [ngClass]="{\'table-striped\': striped, \'table-hover\': hovered, \'f-table-norecords\': (!serializedValue || !serializedValue.length) }">\r\n        <thead class="farris-treetable-thead" *ngIf="showHeader" [class.header-wrap]="headerWrap">\r\n            <ng-container *ngIf="!headerTemplate && columns">\r\n                <th *ngFor="let col of columns;let isFirst=first" [style.textAlign]="col!.hAlign || \'left\'" class="treetable-header-cell" [attr.field]="col.field">\r\n                    <div class="d-flex">\r\n                        <ng-container *ngIf="!singleSelect && showCheckAll && isFirst && showCheckbox">\r\n                            <tt-header-checkbox #allCheckbox class="f-cmp-treetable-toggler"></tt-header-checkbox>\r\n                        </ng-container>\r\n\r\n                        <ng-container *ngIf="!col.headTemplate">\r\n                            <div class="flex-grow-1 text" [style.whiteSpace]="headerWrap ? \'pre-wrap\': \'\'">{{col.title}}</div>\r\n                        </ng-container>\r\n        \r\n                        <ng-container *ngIf="col.headTemplate"\r\n                            [ngTemplateOutlet]="col.headTemplate"\r\n                            [ngTemplateOutletContext]="{$implicit: { column: col}}">\r\n                        </ng-container>\r\n                        \r\n                    </div>\r\n                </th>\r\n            </ng-container>\r\n            <ng-container *ngIf="headerTemplate">\r\n                <ng-container *ngTemplateOutlet="headerTemplate; context: {$implicit: columns}"></ng-container>\r\n            </ng-container>\r\n        </thead>\r\n        <ng-container *ngIf="serializedValue && serializedValue.length">\r\n             \x3c!-- 客户端查询定位工具条 --\x3e\r\n             <find-input *ngIf="showFindInput" [current]="findCurrent" [count]="findCount"\r\n             (valueChanged)="findKeyWords($event)" (close)="closeFindPanel()"  [columns]="columns"\r\n             (enterHandler)="nextFindValue($event)"></find-input>\r\n            <ng-container *ngIf="bodyTemplate">\r\n                <tbody class="farris-treetable-tbody" treeTableBody [columns]="columns" [template]="bodyTemplate">\r\n                </tbody>\r\n            </ng-container>\r\n            <ng-container *ngIf="!bodyTemplate">\r\n                <ng-container *ngTemplateOutlet="tbody"></ng-container>\r\n            </ng-container>\r\n        </ng-container>\r\n        <ng-container *ngIf="!serializedValue || !serializedValue.length">\r\n            <tbody class="farris-treetable-tbody">\r\n                <tr class="f-table-norecords-row" style="height: 200px">\r\n                    <td [attr.align]="\'center\'" class="farris-treetable-emptydata" [attr.colspan]="columns.length">\r\n                        <div class="f-table-norecords-content" >\r\n                            {{ \'treetable.emptyMessage\' | locale }}\r\n                        </div>\r\n                    </td>\r\n                </tr>\r\n            </tbody>\r\n        </ng-container>\r\n    </table>\r\n</div>\r\n\r\n',exportAs:"treeTable",encapsulation:m.ViewEncapsulation.None,changeDetection:m.ChangeDetectionStrategy.OnPush,styles:["\n        .farris-treetable {\n            position: relative;\n        }\n        .resizable-column {\n            background-clip: padding-box;\n            position: relative;\n        }\n        .column-resizer {\n            display: block;\n            position: absolute!important;\n            top: 0;\n            right: 0;\n            margin: 0;\n            width: .5em;\n            height: 100%;\n            padding: 0;\n            cursor: col-resize;\n            border: 1px solid transparent;\n        }\n        .column-resizer-helper {\n            width: 1px;\n            position: absolute;\n            z-index: 10;\n            display: none;\n            border-right: 1px dashed #1890ff;\n        }\n\n        .farris-treetable-disabled .farris-treetable-body .table tr{\n            opacity: 0.4;\n            cursor: not-allowed;\n        }\n        .farris-treetable-disabled .table tr.farris-table-selectedrow{\n            opacity: 1;\n            cursor: default;\n        }\n\n        .custom-checkbox .custom-control-input:indeterminate~.custom-control-label::after {\n            background-image: url(\"data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 4 4'%3e%3cpath stroke='%23fff' d='M0 2h4'/%3e%3c/svg%3e\");\n            background-color: #1890ff;\n        }\n        .unselectable-text {\n            -webkit-user-select: none;\n            -moz-user-select: none;\n            -o-user-select: none;\n            -ms-user-select: none;\n            user-select: none\n        }\n        .search-highlight {\n            background-color: #FFFF1F;\n        }\n        .search-highlight.active{\n            background-color: #FF901C;\n        }\n\n\n                \n        .f-treetable--fixed-columns .treetable-header-cell {\n            vertical-align: middle;\n        }\n\n        .f-treetable--fixed-columns .ps__rail-x,\n        .f-treetable--fixed-columns .ps__rail-y {\n            z-index: 3;\n        }\n\n        .f-treetable--fixed-left,\n        .f-treetable--fixed-right {\n            position: sticky !important;\n            z-index: 2;\n            background-color: #ffffff;\n            overflow: inherit !important;\n        }\n        .treetable-header-cell.f-treetable--fixed-left,\n        .treetable-header-cell.f-treetable--fixed-right {\n            background-color: #f7f8fb;\n        }\n\n        .f-treetable--fixed-columns\n            tr\n            th.f-treetable--fixed-left[l-tt-shadow-col]::after,\n        .f-treetable--fixed-columns td.f-treetable--fixed-left::after,\n        .f-treetable--fixed-right::before {\n            pointer-events: none;\n            content: \"\";\n            width: 36px !important;\n            display: inline-block !important;\n            position: absolute !important;\n            margin-top: 0 !important;\n            top: 0 !important;\n            height: 100% !important;\n            bottom: -1px !important;\n            transition: box-shadow 0.2s cubic-bezier(0.4, 0, 0.2, 1);\n            background-color: transparent !important;\n        }\n\n        .f-treetable--fixed-columns\n            tr\n            th.f-treetable--fixed-left:not([l-tt-shadow-col])::after {\n            content: \"\";\n            position: absolute;\n            right: 0;\n            top: 50%;\n            margin-top: calc(-1.125rem / 2);\n            display: block;\n            height: 1.125rem;\n            width: 1px;\n            background-color: #e6e9f0;\n            box-shadow: none;\n        }\n\n        .f-treetable--fixed-columns\n            tr\n            th.f-treetable--fixed-left[l-tt-shadow-col]::after,\n        .f-treetable--fixed-columns tr td.f-treetable--fixed-left::after {\n            right: -36px !important;\n        }\n\n        .f-treetable--fixed-columns .f-treetable--fixed-right::before {\n            left: -36px !important;\n        }\n\n        .f-treetable--fixed-columns .table-hover tbody tr:hover td {\n            background-color: #edf5ff;\n        }\n\n        .f-treetable--fixed-columns\n            .farris-treetable-tbody\n            tr.farris-table-selectedrow\n            td {\n            background-color: #dae9ff;\n            color: #424347;\n        }\n\n        .f-treetable--fixed-columns\n            .farris-treetable-tbody\n            tr.f-treetable-disable-row\n            td {\n            background: #fafafc;\n        }\n\n        .f-treetable--fixed-columns.table-bordered\n            tr\n            th.f-treetable--fixed-left[l-tt-shadow-col],\n        .f-treetable--fixed-columns.table-bordered tr th.f-treetable--fixed-right,\n        .f-treetable--fixed-columns.table-bordered tr td.f-treetable--fixed-left,\n        .f-treetable--fixed-columns.table-bordered tr td.f-treetable--fixed-right {\n            border-right: 0;\n            box-shadow: inset -1px 0px 0px #eaecf3;\n        }\n\n        .f-treetable--fixed-columns.table-bordered tr td,\n        .f-treetable--fixed-columns.table-bordered tr td {\n            border-left: 0;\n        }\n\n    "]}]}],V.ctorParameters=function(){return[{type:x},{type:m.ElementRef},{type:a.ResizeService},{type:m.Renderer2},{type:f.CommonUtils},{type:l.ColumnFormatService},{type:w},{type:m.ChangeDetectorRef},{type:m.NgZone},{type:m.Injector}]},V.propDecorators={width:[{type:m.Input}],height:[{type:m.Input}],showFilterBar:[{type:m.Input}],showSearchField:[{type:m.Input}],headerHeight:[{type:m.Input}],headerWrap:[{type:m.Input}],rowHeight:[{type:m.Input}],columns:[{type:m.Input}],groupColumns:[{type:m.Input}],useGroupHeader:[{type:m.Input}],fitColumns:[{type:m.Input}],autoFitColumns:[{type:m.Input}],searchFields:[{type:m.Input}],allColumnsTitle:[{type:m.Input}],showLines:[{type:m.Input}],showLinesOnHover:[{type:m.Input}],multiSelect:[{type:m.Input}],singleSelect:[{type:m.Input}],showCheckbox:[{type:m.Input}],idField:[{type:m.Input}],showBorder:[{type:m.Input}],showCheckAll:[{type:m.Input}],showHeader:[{type:m.Input}],striped:[{type:m.Input}],hovered:[{type:m.Input}],disabled:[{type:m.Input}],disabledRow:[{type:m.Input}],loadDataType:[{type:m.Input}],fixedHeader:[{type:m.Input}],checkOnSelect:[{type:m.Input}],selectOnCheck:[{type:m.Input}],onlySelectSelf:[{type:m.Input}],resizableColumns:[{type:m.Input}],fit:[{type:m.Input}],cascadeCheck:[{type:m.Input}],cascadeDown:[{type:m.Input}],cascadeUp:[{type:m.Input}],emptyMessage:[{type:m.Input}],indentSpacing:[{type:m.Input}],keepSelect:[{type:m.Input}],virtualized:[{type:m.Input}],onlySelectLeaf:[{type:m.Input}],showIcon:[{type:m.Input}],leafIcon:[{type:m.Input}],expandIcon:[{type:m.Input}],collapseIcon:[{type:m.Input}],foldIcon:[{type:m.Input}],unfoldIcon:[{type:m.Input}],useIconFromData:[{type:m.Input}],whenDataIconEmptyUseDefault:[{type:m.Input}],iconField:[{type:m.Input}],iconCls:[{type:m.Input}],remoteSort:[{type:m.Input}],sortName:[{type:m.Input}],sortOrder:[{type:m.Input}],multiSort:[{type:m.Input}],beforeSortColumn:[{type:m.Input}],rowStyler:[{type:m.Input}],cellStyler:[{type:m.Input}],enableFindText:[{type:m.Input}],findField:[{type:m.Input}],expandLevel:[{type:m.Input}],selectValue:[{type:m.Input}],selectValueChange:[{type:m.Output}],dblClickExpand:[{type:m.Input}],selectValues:[{type:m.Input}],selectValuesChange:[{type:m.Output}],nowrap:[{type:m.Input}],checkValues:[{type:m.Input}],checkValuesChange:[{type:m.Output}],beforeNodeSelected:[{type:m.Input}],beforeNodeUnSelected:[{type:m.Input}],beforeNodeChecked:[{type:m.Input}],beforeNodeUnChecked:[{type:m.Input}],beforeCheckAll:[{type:m.Input}],beforeUnCheckAll:[{type:m.Input}],beforeClickNode:[{type:m.Input}],pagination:[{type:m.Input}],paginationForChildren:[{type:m.Input}],pagerViewMode:[{type:m.Input}],pagerOnServer:[{type:m.Input}],pageList:[{type:m.Input}],pageIndex:[{type:m.Input}],pageSize:[{type:m.Input}],pagerHeight:[{type:m.Input}],showPageList:[{type:m.Input}],showPageInfo:[{type:m.Input}],showPageNumber:[{type:m.Input}],pagerLabelSize:[{type:m.Input}],showGotoInput:[{type:m.Input}],showTotalForChildren:[{type:m.Input}],total:[{type:m.Input}],enableContextMenu:[{type:m.Input}],contextMenuItems:[{type:m.Input}],beforeShowContextMenu:[{type:m.Input}],pageSizeChanged:[{type:m.Output}],pageChanged:[{type:m.Output}],columnSorted:[{type:m.Output}],nodeSelected:[{type:m.Output}],nodeUnSelect:[{type:m.Output}],nodeChecked:[{type:m.Output}],nodeUnChecked:[{type:m.Output}],checkAll:[{type:m.Output}],unCheckAll:[{type:m.Output}],search:[{type:m.Output}],dblClick:[{type:m.Output}],loadedData:[{type:m.Output}],expand:[{type:m.Output}],collapse:[{type:m.Output}],expandAllNodes:[{type:m.Output}],collapseAllNodes:[{type:m.Output}],appendNew:[{type:m.Output}],removed:[{type:m.Output}],updated:[{type:m.Output}],clearSearchValue:[{type:m.Output}],cellClick:[{type:m.Output}],childsPageChanged:[{type:m.Output}],loadedTimer:[{type:m.Input}],data:[{type:m.Input}],autoWidth:[{type:m.Input}],templates:[{type:m.ContentChildren,args:[f.FarrisTemplateDirective]}],columnsRef:[{type:m.ContentChildren,args:[T]}],headerBox:[{type:m.ViewChild,args:["headerBox"]}],resizerHelperVC:[{type:m.ViewChild,args:["resizerHelper"]}],headerTable:[{type:m.ViewChild,args:["headerTable"]}],bodyTable:[{type:m.ViewChild,args:["bodyTable"]}],inputGroup:[{type:m.ViewChild,args:["inputGroup"]}],psRef:[{type:m.ViewChild,args:[s.PerfectScrollbarComponent]}],allCheckbox:[{type:m.ViewChild,args:["allCheckbox"]}],nodesPagerBar:[{type:m.ViewChild,args:["nodespagerbar"]}],onResized:[{type:m.HostListener,args:["window:resize"]}]},V);function V(e,t,n,i,s,o,r,l,a,d){var c=this;this.ttService=e,this.el=t,this.resizeSer=n,this.renderer=i,this.utils=s,this.colFormatSer=o,this.shortcuts=r,this.cdRef=l,this.ngZone=a,this.injector=d,this.id="",this.width=500,this.height=400,this.showFilterBar=!1,this.showSearchField=!0,this.headerHeight=35,this.headerWrap=!1,this.rowHeight=29,this.columns=[],this._groupColumns=[],this.useGroupHeader=!1,this.fitColumns=!0,this.autoFitColumns=!1,this.allColumnsTitle="所有列",this.showLines=!1,this.showLinesOnHover=!1,this.multiSelect=!1,this.singleSelect=!0,this.showCheckbox=!1,this.showBorder=!0,this.showCheckAll=!0,this.showHeader=!0,this.striped=!1,this.hovered=!0,this.disabled=!1,this.loadDataType="all",this.fixedHeader=!1,this.checkOnSelect=!1,this.selectOnCheck=!1,this.onlySelectSelf=!1,this.resizableColumns=!0,this.fit=!1,this.cascadeCheck=!0,this.cascadeDown=!0,this.cascadeUp=!0,this.emptyMessage="暂无数据",this.indentSpacing=16,this.keepSelect=!0,this.virtualized=!1,this.onlySelectLeaf="default",this.showIcon=!1,this.leafIcon="file",this.expandIcon="folder-open",this.collapseIcon="folder",this.foldIcon="treetable-toggler",this.unfoldIcon="extanded treetable-toggler",this.useIconFromData=!1,this.whenDataIconEmptyUseDefault=!0,this.iconField="",this.remoteSort=!0,this.enableFindText=!1,this.expandLevel=-1,this.selectValue="",this.selectValueChange=new m.EventEmitter,this.dblClickExpand=!0,this.selectValues=[],this.selectValuesChange=new m.EventEmitter,this.nowrap=!0,this.checkValues=[],this.checkValuesChange=new m.EventEmitter,this.pagination=!1,this.paginationForChildren=!1,this.pagerViewMode="default",this.pagerOnServer=!0,this.pageList=[10,20,30,50,100],this.pageIndex=1,this.pageSize=20,this.pagerHeight=56,this.showPageList=!1,this.showPageInfo=!0,this.showPageNumber=!0,this.pagerLabelSize=7,this.showGotoInput=!1,this.showTotalForChildren=!1,this.total=0,this.enableContextMenu=!1,this.contextMenuItems=[],this.pageSizeChanged=new m.EventEmitter,this.pageChanged=new m.EventEmitter,this.columnSorted=new m.EventEmitter,this.nodeSelected=new m.EventEmitter,this.nodeUnSelect=new m.EventEmitter,this.nodeChecked=new m.EventEmitter,this.nodeUnChecked=new m.EventEmitter,this.checkAll=new m.EventEmitter,this.unCheckAll=new m.EventEmitter,this.search=new m.EventEmitter,this.dblClick=new m.EventEmitter,this.loadedData=new m.EventEmitter,this.expand=new m.EventEmitter,this.collapse=new m.EventEmitter,this.expandAllNodes=new m.EventEmitter,this.collapseAllNodes=new m.EventEmitter,this.appendNew=new m.EventEmitter,this.removed=new m.EventEmitter,this.updated=new m.EventEmitter,this.clearSearchValue=new m.EventEmitter,this.cellClick=new m.EventEmitter,this.childsPageChanged=new m.EventEmitter,this.loadedTimer=100,this._data=[],this.autoWidth=!1,this._selections=[],this.selectRowIndex=-1,this._selectedRow=null,this._checkeds=[],this.searchData={field:"*",value:""},this.searchButtonText='<i class="f-icon f-icon-search"></i>',this.showFindInput=!1,this.isDataChanged=!1,this.topHideHeight=0,this.bottomHideHeight=0,this.state={searchRowNodes:null,searched:!1,rowNodes:[],scrollY:0,scrollX:0},this.findValue="",this.findCount=0,this.findCurrent=0,this.findResult=[],this.ro=null,this.findKeysHandler=null,this._hotKeys=null,this.styleSheetId="treetable-style-",this.paginationOptions={id:"Farris-TreeTable-Pagination_",itemsPerPage:this.pageSize,currentPage:this.pageIndex,pageList:this.pageList,totalItems:this.total,remote:this.pagerOnServer},this.selectNodeChangedSubject=new p.BehaviorSubject(null),this._UUID="",this.fixedColumns=!1,this.destroy$=new p.Subject,this.farrisInstances=null,this.difference=function(e,n){return e.filter(function(t){return!n.some(function(e){return e==t})})},this.debugSer=null,this.onBeforeShowContextMenu=function(e){var s=e.contextMenuDom,t=e.event.target.id;if(s){t=c.trId2DataId(s);var o=c.findRowNode(t),n=p.of({show:!0});return c.beforeShowContextMenu&&(n=c.beforeShowContextMenu({data:o,tree:c})),n.pipe(u.switchMap(function(e){if(e.show){e.menus&&(c.contextMenuItems=e.menus,c.detectChanges());var t=s.closest(".farris-treetable").offsetWidth,n=s.offsetWidth,i=n<t?n:t;return p.of({show:!0,data:{data:o,tree:c},focusTargetWidth:i})}return p.of({show:!1})}))}return p.of({show:!1})},this.searchHandle=new N(this),this.scrollLoader=new S(this),this.injector&&(this._hotKeys=this.injector.get(w,null),this.localeService=this.injector.get(h.LocaleService,null),this.idService=this.injector.get(f.IdService,null),this.farrisInstances=this.injector.get(f.FarrisComponentInstanceService,null)),this.idService?(this._UUID=this.idService.uuid(),this.styleSheetId+=this.idService.uuid()):(this._UUID=(""+Math.random()).slice(2),this.styleSheetId+=(""+Math.random()).slice(2)),this.ttService=new x,this.debugSer=this.injector.get(f.DebugService,null),this.debugSer&&this.debugSer.useDebugMode()}var F=(D.decorators=[{type:m.Component,args:[{selector:"[treeTableBody]",template:'\n        <ng-template ngFor let-serializedNode let-rowIndex="index" [ngForOf]="tt.serializedValue">\n            <ng-container *ngIf="serializedNode.visible">\n                <ng-container\n                    *ngTemplateOutlet="template;\n                        context: {$implicit: serializedNode, node: serializedNode.node,\n                        rowData: serializedNode.node.data, rowIndex: rowIndex, columns: columns}">\n                </ng-container>\n            </ng-container>\n        </ng-template>\n    '}]}],D.ctorParameters=function(){return[{type:z}]},D.propDecorators={columns:[{type:m.Input}],template:[{type:m.Input}]},D);function D(e){this.tt=e}var H=(Object.defineProperty(L.prototype,"offsetWidth",{get:function(){return this.togglerEl.nativeElement.parentElement.offsetWidth},enumerable:!0,configurable:!0}),L.prototype.ngOnInit=function(){var t=this;this.treeNodeIcon=this.tt.getTreeIcon(this.rowNode.node),this.isShowTriangle=this.showTriangle(),this.noChilds=this.hasChildren();var e=this.tt.expand.subscribe(function(e){t.rowNode.id===e.data[t.tt.idField]&&(t.updateIcon(t.rowNode.node),t.tt.psRef&&t.tt.psRef.directiveRef.update(),t.tt.detectChanges())}),n=this.tt.collapse.subscribe(function(e){t.rowNode.id===e.data[t.tt.idField]&&(t.updateIcon(t.rowNode.node),t.tt.psRef&&t.tt.psRef.directiveRef.update(),t.tt.detectChanges())}),i=this.tt.appendNew.subscribe(function(e){e.parent&&(t.rowNode.id===e.parent.data[t.tt.idField]&&(!t.rowNode.node.leaf&&t.rowNode.node.leaf!==undefined||(t.rowNode.node.leaf=!1)),t.updateIcon(t.rowNode.node))});this.subscriptions=[e,n,i]},L.prototype.ngOnChanges=function(e){e.showLines&&!e.showLines.isFirstChange()&&(this.showLines?this.render.setStyle(this.togglerEl.nativeElement,"display",this.isShowTriangle?"":"none"):this.render.removeStyle(this.togglerEl.nativeElement,"display"),this.reSetLines()),e.rowNode&&!e.rowNode.isFirstChange()&&(this.updateIcon(this.rowNode.node),!!e.rowNode.currentValue.node.children.length!=!!e.rowNode.previousValue.node.children.length&&this.reSetLines())},L.prototype.ngAfterViewInit=function(){var e=this;setTimeout(function(){e.reSetLines()})},L.prototype.ngDoCheck=function(){},L.prototype.ngAfterViewChecked=function(){},L.prototype.ngOnDestroy=function(){this.unAllSubscriptions()},L.prototype.unAllSubscriptions=function(){this.subscriptions.forEach(function(e){e.unsubscribe()}),this.subscriptions=[]},L.prototype.hasChildren=function(){var e=this.rowNode.node;return!1===e.leaf||0!==this.rowNode.level||e.children&&0<e.children.length},L.prototype.showTriangle=function(){var e=this.rowNode.node;return"all"===this.tt.loadDataType?!1===e.leaf||e.children&&0<e.children.length:!1===e.leaf},L.prototype.reSetLines=function(){if(this.togglerEl){var e=this.togglerEl.nativeElement.closest(".treetable-cell-content");if(e)for(var t=e.querySelectorAll(".treetable-lines"),n=0;n<t.length;n++)t[n].remove()}this._renderLines()},L.prototype._renderLines=function(){this.tt.bodyTemplate||this.showLines&&this.renderLines()},L.prototype.noLineStyle=function(){this.togglerEl&&(this.render.setStyle(this.togglerEl.nativeElement,"visibility",this.isShowTriangle?"visible":"hidden"),this.render.removeStyle(this.togglerEl.nativeElement,"display"))},L.prototype.renderLines=function(){var e=this.rowNode.level;if(this.togglerEl){var t=this.togglerEl.nativeElement.closest(".treetable-cell-content");if(t){var n=this.togglerEl.nativeElement.parentElement;0!==e||this.showTriangle()||this.createLeafNodeLines(n,t,!0);for(var i=0;i<e;i++){t.insertBefore(this.newLineElement(),n);var s=this.newLineElement(!1);t.insertBefore(s,n),this.showTriangle()||i!==e-1||this.createLeafNodeLines(n,t)}}}},L.prototype.newLineElement=function(e){void 0===e&&(e=!0);var t=this.render.createElement("div");return this.render.addClass(t,"treetable-lines"),this.showLines&&e&&this.render.addClass(t,"treetable-lines-border-color"),t},L.prototype.createLeafNodeLines=function(e,t,n){void 0===n&&(n=!1);var i=this.newLineElement(),s=this.newLineElement(!1);this.render.addClass(s,"treetable-lines-leaf");var o=this.render.createElement("div");if(this.showLines){var r="normal";this.rowNode.last&&(r="corner",this.render.removeClass(i,"treetable-lines-border-color")),s.appendChild(o),this.render.addClass(o,r),this.render.addClass(o,"treetable-lines-border-color")}t.insertBefore(i,e),t.insertBefore(s,e),n&&this.render.setStyle(s,"marginRight","3px")},L.prototype.registerClickEvent=function(){this.togglerEl&&this.render.listen(this.togglerEl.nativeElement,"click",this.onClick.bind(this))},L.prototype.onClick=function(e){return e.stopPropagation(),e.preventDefault(),this.rowNode.node.showLoading||this.tt.disabled||this.tt.toggleExpand(this.rowNode.node),!1},L.prototype.updateIcon=function(e){this.isShowTriangle=this.showTriangle(),this.noChilds=this.hasChildren(),this.treeNodeIcon=this.tt.getTreeIcon(e)},L.decorators=[{type:m.Component,args:[{selector:"farris-treeTableToggler",template:'\n    <a href="javascript:void(0)" #toggler\n            class="treenode-fold" *ngIf="showLines"\n            [ngClass]="rowNode.node.expanded ? tt.unfoldIcon : tt.foldIcon"\n            [style.display]="isShowTriangle ? \'\' : \'none\'"\n            (click)="onClick($event)"></a>\n\n    <a href="javascript:void(0)" #toggler\n            class="treenode-fold"  *ngIf="!showLines"\n            [ngClass]="rowNode.node.expanded ? tt.unfoldIcon : tt.foldIcon"\n            [style.marginLeft.px]="rowNode.level * indentSpacing"\n            [style.visibility]="isShowTriangle ? \'visible\' : \'hidden\'"\n            (click)="onClick($event)"></a>\n    <span class="tree-icon-line" [style.display]="isShowTriangle && showLines? \'\' : \'none\'"></span>\n    <span [style.display]="(tt.showIcon && rowNode.node.showIcon) ? \'inline-block\': \'none\'" class="treenode-icon" [ngClass]="treeNodeIcon"></span>\n\n    <tt-checkbox  [rowNode]="rowNode" *ngIf="tt.showCheckbox" [disabled]="disabled" [checked]="rowNode.isChecked" ></tt-checkbox>\n    ',encapsulation:m.ViewEncapsulation.None,exportAs:"ttToggler"}]}],L.ctorParameters=function(){return[{type:z},{type:m.NgZone},{type:m.Renderer2}]},L.propDecorators={cls:[{type:m.HostBinding,args:["class.f-cmp-treetable-toggler"]}],rowNode:[{type:m.Input}],disabled:[{type:m.Input}],showLines:[{type:m.Input}],indentSpacing:[{type:m.Input}],togglerEl:[{type:m.ViewChild,args:["toggler"]}]},L);function L(e,t,n){this.tt=e,this.ngzone=t,this.render=n,this.cls=!0,this.showLines=!1,this.indentSpacing=16,this.treeNodeIcon={},this.isShowTriangle=!1,this.noChilds=!1,this.subscriptions=[]}var P=(A.prototype.ngOnInit=function(){},A.prototype.ngOnChanges=function(e){},A.prototype.ngOnDestroy=function(){this.subscription&&(this.subscription.unsubscribe(),this.subscription=null)},A.prototype.ngDoCheck=function(){this.tt.bodyTemplate&&(this.tt.isSelected(this.rowNode.node)||this.render.removeClass(this.el.nativeElement,"farris-table-selectedrow"))},A.prototype.onclick=function(e){var t=this;this.isEnabled()&&(0!==this.delay?this.prevent||(this.prevent=!0,this.timer=setTimeout(function(){t.rowClick(e),t.prevent=!1},this.delay)):this.rowClick(e))},A.prototype.isEnabled=function(){return!this.tt.disabled&&!0!==this.selectRowDisabled},A.prototype.rowClick=function(t){var n=this;t.stopPropagation(),this.tt.beforeClickNode({instance:this.tt,rowNode:this.rowNode,event:t,type:"row"}).subscribe(function(e){e&&(n.tt.handleRowClick({originalEvent:t,rowNode:n.rowNode,rowIndex:n.rowIndex}),n.ngZone.runOutsideAngular(function(){n.toggleClass()}))})},A.prototype.toggleClass=function(){var t=this;this.tt.bodyTemplate||(this.tt.isSelected(this.rowNode.node)?(this.tt.singleSelect&&this.tt.el.nativeElement.querySelectorAll(".farris-treetable-tbody>tr.farris-table-selectedrow").forEach(function(e){t.render.removeClass(e,"farris-table-selectedrow")}),this.render.addClass(this.el.nativeElement,"farris-table-selectedrow")):this.tt.keepSelect||this.render.removeClass(this.el.nativeElement,"farris-table-selectedrow"))},A.decorators=[{type:m.Directive,args:[{selector:"[selectRow]",exportAs:"row"}]}],A.ctorParameters=function(){return[{type:z},{type:m.ElementRef},{type:m.Renderer2},{type:m.NgZone}]},A.propDecorators={rowNode:[{type:m.Input,args:["selectRow"]}],rowIndex:[{type:m.Input}],selectRowDisabled:[{type:m.Input}],delay:[{type:m.Input}],onclick:[{type:m.HostListener,args:["click",["$event"]]}]},A);function A(e,t,n,i){var s=this;this.tt=e,this.el=t,this.render=n,this.ngZone=i,this.prevent=!1,this.delay=0,this.subscription=this.tt.selectNodeChangedSubject.subscribe(function(e){e&&s.rowNode&&-1<e.split(",").indexOf(s.rowNode.id)&&(s.toggleClass(),s.rowNode.node.elementRef=s.el)})}var M=(_.prototype.ngOnInit=function(){},_.prototype.handleClick=function(t){var n=this;return this.disabled||this.tt.disabled||(this.checked?this.tt.beforeUnCheckAll:this.tt.beforeCheckAll)({instance:this.tt,checked:!this.checked}).subscribe(function(e){n.chkAll.nativeElement.indeterminate=!1,n.checked=!n.checked,n.tt.toggleNodesWithCheckbox(t,n.checked)}),t.stopPropagation(),!1},_.decorators=[{type:m.Component,args:[{selector:"tt-header-checkbox",template:'\n    <div class="custom-control custom-checkbox  custom-control-inline tt-checkbox">\n        <input type="checkbox" #chkAll class="custom-control-input"  [checked]="checked">\n        <label class="custom-control-label" (click)="handleClick($event)"></label>\n    </div>\n    ',styles:["\n        :host {\n            vertical-align: middle;\n        }\n        "]}]}],_.ctorParameters=function(){return[{type:z},{type:x}]},_.propDecorators={checked:[{type:m.Input}],disabled:[{type:m.Input}],checkedChange:[{type:m.Output}],chkAll:[{type:m.ViewChild,args:["chkAll"]}]},_);function _(e,t){this.tt=e,this.ttService=t,this.checkedChange=new m.EventEmitter}var j=(B.prototype.ngOnDestroy=function(){this.destroy$.next(),this.destroy$.complete()},B.prototype.ngOnInit=function(){var t=this;this.chk.nativeElement.indeterminate=this.rowNode.indeterminate||!1,this.ttService.changeCheckboxStatus$.pipe(u.takeUntil(this.destroy$)).pipe(u.map(function(e){return e.id===t.rowNode.id?e:null})).subscribe(function(e){e&&(t.chk.nativeElement.indeterminate=e.indeterminate,t.checked=e.isChecked,t.chk.nativeElement.checked=t.checked)})},B.prototype.handleClick=function(t){var n=this;return t.stopPropagation(),this.disabled||this.tt.beforeClickNode({instance:this.tt,rowNode:this.rowNode,event:t,type:"checkbox"}).subscribe(function(e){e&&(n.checked=!n.checked,n.tt.singleSelect?(n.tt.clearAll(),n.checked?n.tt.selectNode(n.rowNode.id,!0):n.tt.unSelectNode(n.rowNode.id,!0)):n.tt.toggleNodeWithCheckbox(t,n.rowNode,n.checked))}),!1},B.decorators=[{type:m.Component,args:[{selector:"tt-checkbox",template:'\n    <div class="custom-control custom-checkbox  custom-control-inline tt-checkbox">\n        <input type="checkbox" #chk class="custom-control-input" [disabled]="disabled" [checked]="checked">\n        <label class="custom-control-label" (click)="handleClick($event)"></label>\n    </div>\n    ',styles:["\n        :host {\n            vertical-align: middle;\n        }\n        :host .custom-checkbox {\n            opacity: 1;\n            float: none;\n        }\n        "]}]}],B.ctorParameters=function(){return[{type:z},{type:x}]},B.propDecorators={cls1:[{type:m.HostBinding,args:["class.tree-toggler-checkbox"]}],checked:[{type:m.Input}],disabled:[{type:m.Input}],rowNode:[{type:m.Input}],checkedChange:[{type:m.Output}],chk:[{type:m.ViewChild,args:["chk"]}]},B);function B(e,t){this.tt=e,this.ttService=t,this.cls1=!0,this.checkedChange=new m.EventEmitter,this.destroy$=new p.Subject,this.ttService=this.tt.ttService}var U=(W.prototype.ngOnInit=function(){this.enableDblClick||(this.selectRowDir.delay=0)},W.prototype.ondblclick=function(e){var t=e.target.previousSibling;if(!t||"checkbox"!==t.type){if(this.tt.disabled)return!1;if(this.tt.multiSelect&&this.dblclickNode&&this.dblclickNode.node.leaf)return!1;var n=null;if(-1<e.target.className.indexOf("f-cmp-treetable-toggler")?n=e.target.querySelector(".treenode-fold"):-1<e.target.className.indexOf("treenode-fold")&&(n=e.target),n&&"visible"===n.style.visibility)return!1;if(this.selectRowDir&&(this.selectRowDir.prevent=!1,clearTimeout(this.selectRowDir.timer),this.selectRowDir.rowNode&&this.enableDblClick)){var i=this.selectRowDir.rowNode;"all"===this.tt.loadDataType&&!i.node.leaf&&this.tt.dblClickExpand&&this.tt.toggleExpand(i.node),this.tt.dblClick.emit(i.node)}}},W.decorators=[{type:m.Directive,args:[{selector:"[dblclick]"}]}],W.ctorParameters=function(){return[{type:z},{type:m.ElementRef},{type:x},{type:P,decorators:[{type:m.Optional},{type:m.Self}]}]},W.propDecorators={enableDblClick:[{type:m.Input,args:["dblclick"]}],dblclickNode:[{type:m.Input}],ondblclick:[{type:m.HostListener,args:["dblclick",["$event"]]}]},W);function W(e,t,n,i){this.tt=e,this.el=t,this.ttService=n,this.selectRowDir=i,this.enableDblClick=!1,this.ttService=this.tt.ttService}var $=(q.prototype.ngOnInit=function(){this.setRowStyle()},q.prototype.setRowStyle=function(){var t=this,e=this.tt.rowStyler;if(e){var n=e(this.rowNode.node);if(n)if("object"==typeof n&&(n.style||n.cls))n.style&&Object.keys(n.style).forEach(function(e){t.render.setStyle(t.el.nativeElement,e,n.style[e])}),n.cls&&n.cls.split(",").forEach(function(e){t.render.addClass(t.el.nativeElement,e)});else if(Array.isArray(n)||"string"==typeof n){var i=this.tt.getRowCls(this.rowNode);i&&Object.keys(i).length&&Object.keys(i).forEach(function(e){i[e]&&t.render.addClass(t.el.nativeElement,e)})}else Object.keys(n).forEach(function(e){t.render.setStyle(t.el.nativeElement,e,n[e])})}},q.prototype.ngOnChanges=function(e){e.rowNode&&!e.rowNode.isFirstChange()&&this.setRowStyle()},q.decorators=[{type:m.Directive,args:[{selector:"[customRowStyle]"}]}],q.ctorParameters=function(){return[{type:m.Injector},{type:m.NgZone},{type:m.ElementRef},{type:z},{type:f.CommonUtils},{type:m.Renderer2}]},q.propDecorators={rowNode:[{type:m.Input,args:["customRowStyle"]}]},q);function q(e,t,n,i,s,o){this.injector=e,this.ngZone=t,this.el=n,this.tt=i,this.utils=s,this.render=o}var G=(K.prototype.ngOnInit=function(){this.tt&&this.tt.getCellCls&&this.setCellStyle(),this.tt.showBorder||1!==this.tt.columns.length||this.render.setStyle(this.el.nativeElement,"border-width","0px")},K.prototype.setCellStyle=function(){var t=this,n=this.tt.getCellCls(this.rowNode,this.column.field);if(this.column&&this.column.styler){n&&Object.keys(n).length&&Object.keys(n).forEach(function(e){n[e]&&t.render.addClass(t.el.nativeElement,e)});var e=this.rowNode.node.data,i=this.column.styler(this.utils.getValue(this.column.field,e),e,this.rowIndex,this.rowNode);i&&(i.style||i.cls)&&(i.style&&Object.keys(i.style).forEach(function(e){t.render.setStyle(t.el.nativeElement,e,i.style[e])}),i.cls&&i.cls.split(",").forEach(function(e){t.render.addClass(t.el.nativeElement,e)}))}else Object.keys(n).forEach(function(e){t.render.setStyle(t.el.nativeElement,e,n[e])})},K.prototype.ngOnChanges=function(e){e.rowNode&&!e.rowNode.isFirstChange()&&this.setCellStyle()},K.decorators=[{type:m.Directive,args:[{selector:"[customCellStyle]"}]}],K.ctorParameters=function(){return[{type:m.Injector},{type:m.NgZone},{type:m.ElementRef},{type:z},{type:f.CommonUtils},{type:m.Renderer2}]},K.propDecorators={column:[{type:m.Input,args:["customCellStyle"]}],rowNode:[{type:m.Input}],rowIndex:[{type:m.Input}]},K);function K(e,t,n,i,s,o){this.injector=e,this.ngZone=t,this.el=n,this.tt=i,this.utils=s,this.render=o}var Z=(Y.prototype.ngAfterViewInit=function(){var e=this;this.isEnable()&&(this.render.addClass(this.el.nativeElement,"resizable-column"),this.resizer=document.createElement("span"),this.resizer.className="column-resizer",this.el.nativeElement.appendChild(this.resizer),this.ngzone.runOutsideAngular(function(){e.resizerMouseDownListener=e.onMouseDown.bind(e),e.resizer.addEventListener("mousedown",e.resizerMouseDownListener),e.el.nativeElement.addEventListener("mouseenter",e.onMouseEnter.bind(e))}))},Y.prototype.ngOnChanges=function(e){e.enableResize&&!e.enableResize.isFirstChange()&&!this.isEnable()&&this.resizer&&this.resizer.remove()},Y.prototype.isEnable=function(){return this.tt.resizableColumns&&!this.tt.autoWidth&&this.enableResize},Y.prototype.bindDocumentEvents=function(){var e=this;this.ngzone.runOutsideAngular(function(){e.documentMouseMoveListener=e.onMouseMove.bind(e),document.addEventListener("mousemove",e.documentMouseMoveListener),e.documentMouseUpListener=e.onMouseUp.bind(e),document.addEventListener("mouseup",e.documentMouseUpListener)})},Y.prototype.unbindDocumentEvents=function(){this.documentMouseMoveListener&&(document.removeEventListener("mousemove",this.documentMouseMoveListener),this.documentMouseMoveListener=null),this.documentMouseUpListener&&(document.removeEventListener("mouseup",this.documentMouseUpListener),this.documentMouseUpListener=null)},Y.prototype.onMouseDown=function(e){this.isEnable()&&(this.tt.onColumnResizeBegin(e),this.bindDocumentEvents())},Y.prototype.onMouseEnter=function(){},Y.prototype.onMouseMove=function(e){this.tt.onColumnResize(e)},Y.prototype.onMouseUp=function(e){this.tt.onColumnResizeEnd(e,this.el.nativeElement),this.unbindDocumentEvents()},Y.prototype.ngOnDestroy=function(){this.resizerMouseDownListener&&this.resizer.removeEventListener("mousedown",this.resizerMouseDownListener),this.unbindDocumentEvents()},Y.decorators=[{type:m.Directive,args:[{selector:"[resizable-column]"}]}],Y.ctorParameters=function(){return[{type:z},{type:m.NgZone},{type:m.ElementRef},{type:m.Renderer2}]},Y.propDecorators={enableResize:[{type:m.Input,args:["resizable-column"]}]},Y);function Y(e,t,n,i){this.tt=e,this.ngzone=t,this.el=n,this.render=i,this.enableResize=!0}var X=(Q.prototype.ngOnInit=function(){var t=this;this.columns.length&&(this.columns=this.columns.filter(function(e){return!e.formatter&&e.field}),this.findField=this.columns[0].field),this.ngZone.runOutsideAngular(function(){t.keyupEventSub=p.fromEvent(t.input.nativeElement,"keyup").pipe(u.filter(function(e){return 13!==(e["switch"]||e.keyCode)}),u.debounceTime(200),u.map(function(e){return e.target.value})).subscribe(function(e){t.valueChanged.emit({value:e,field:t.findField})})})},Q.prototype.ngAfterViewInit=function(){this.input.nativeElement.focus()},Q.prototype.ngOnDestroy=function(){this.keyupEventSub&&this.keyupEventSub.unsubscribe(),this.keyupEventSub=null},Q.prototype.onClose=function(e){return this.close.emit(),!1},Q.prototype.onEnter=function(e,t){return this.enterHandler.emit(t),!1},Q.decorators=[{type:m.Component,args:[{selector:"find-input",template:'\n        <div class="f-find-input" style="">\n            <div class="input-group">\n                <div class="input-group-prepend">\n                    <select class="form-control" [(ngModel)]="findField">\n                        <option *ngFor="let col of columns" value="{{col.field}}">{{ col.title }}</option>\n                    </select>\n                </div>\n                <input #input type="text" placeholder="至少2个字符" class="form-control"\n                    (keydown.esc)="onClose($event)" (keydown.enter)="onEnter($event, 0)">\n                <div class="input-group-append">\n                    <span class="input-group-text">{{current}}/{{count}}</span>\n                    <button class="btn btn-outline-secondary" type="button" title="上一个"\n                        [disabled]="current === 0" (click)="onEnter($event, -1)">\n                        <span class="f-icon f-icon-arrow-chevron-up"></span>\n                    </button>\n                    <button class="btn btn-outline-secondary" type="button" title="下一个"\n                    [disabled]="current === count" (click)="onEnter($event, 1)">\n                        <span class="f-icon f-icon-arrow-chevron-down"></span>\n                    </button>\n                    <button class="btn btn-outline-secondary" type="button" title="关闭" (click)="onClose($event)">\n                        <span class="f-icon f-icon-close"></span>\n                    </button>\n                </div>\n            </div>\n        </div>\n    ',styles:["\n        .f-find-input {\n            width: 300px; height: 40px; background: #fefefe; position: absolute; right: 0; z-index: 10; padding: 5px;\n            border: 1px solid #d5d5d5;\n            box-shadow: 0px 1px 2px 0px #989898;\n        }\n        .f-find-input .input-group-text { border-right: 1px solid #ccc; font-size: 10px }\n        .f-find-input .input-group-append { background: #fff; }\n        .f-find-input .input-group-append button { padding:1px 6px;}\n        "]}]}],Q.ctorParameters=function(){return[{type:m.ElementRef},{type:m.NgZone},{type:m.Injector}]},Q.propDecorators={current:[{type:m.Input}],count:[{type:m.Input}],columns:[{type:m.Input}],close:[{type:m.Output}],valueChanged:[{type:m.Output}],enterHandler:[{type:m.Output}],input:[{type:m.ViewChild,args:["input"]}]},Q);function Q(e,t,n){this.el=e,this.ngZone=t,this.injector=n,this.current=0,this.count=0,this.columns=[],this.close=new m.EventEmitter,this.valueChanged=new m.EventEmitter,this.enterHandler=new m.EventEmitter,this.findField="",this.keyupEventSub=null}var J=(ee.prototype.transform=function(e,t,n,i){void 0===n&&(n=""),void 0===i&&(i="");var s=!0;if(n&&i&&(s=-1===i.indexOf(",")?n===i:i.split(",").some(function(e){return e===n})),!s)return e;if(t&&e){var o=t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");o=o.split(" ").filter(function(e){return 0<e.length}).join("|");var r=new RegExp(o,"gi");return this.sanitizer.bypassSecurityTrustHtml(this.replaceContent(e,r,function(e){return'<span class="search-highlight">'+e+"</span>"}))}return e},ee.prototype.parseHTML=function(e,t){var n=(t||document).createElement("template");return n.innerHTML=e,n.content.cloneNode(!0)},ee.prototype.replaceContent=function(e,t,n){var i,s,o=e.match(/>.*?\</gi);if(o&&o.length){try{for(var r=function u(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}(o),l=r.next();!l.done;l=r.next()){var a=l.value,d=o[a],c=o[a].replace(t,n),h=new RegExp(d,"g");e=e.replace(h,c)}}catch(p){i={error:p}}finally{try{l&&!l.done&&(s=r["return"])&&s.call(r)}finally{if(i)throw i.error}}return e}return e.replace(t,n)},ee.decorators=[{type:m.Pipe,args:[{name:"highlight"}]}],ee.ctorParameters=function(){return[{type:d.DomSanitizer},{type:m.ElementRef}]},ee);function ee(e,t){this.sanitizer=e,this.el=t}var te=(Object.defineProperty(ne.prototype,"pagers",{get:function(){var e=this.getPagerCount();return e?new Array(e):[]},enumerable:!0,configurable:!0}),ne.prototype.ngOnInit=function(){this.setPagerInfo()},ne.prototype.ngOnChanges=function(e){e.context&&!e.context.isFirstChange()&&this.setPagerInfo()},ne.prototype.setPagerInfo=function(){if(this.context){var e=this.context.node;e&&e.pagination&&(this.pagerInfo=y({},e.pagination),this.showPager.next(e.expanded&&e.pagination))}},ne.prototype.getPagerCount=function(){var e=this.pagerInfo,t=e.pageSize,n=e.total;return n?Math.ceil(n/t):0},ne.prototype.isFirstPager=function(){return 1===this.pagerInfo.pageIndex},ne.prototype.isLastPager=function(){return this.pagerInfo.pageIndex===this.getPagerCount()},ne.prototype.previous=function(e){e.stopPropagation(),this.setCurrent(this.pagerInfo.pageIndex-1,this.pagerInfo.pageSize)},ne.prototype.next=function(e){e.stopPropagation(),this.setCurrent(this.pagerInfo.pageIndex+1,this.pagerInfo.pageSize)},ne.prototype.setCurrent=function(e,t,n){n&&n.stopPropagation(),this.pageChange.emit({pageIndex:e,pageSize:t,node:this.context.node,context:this.context})},ne.prototype.pagerChanged=function(e){this.setCurrent(e,this.pagerInfo.pageSize)},ne.decorators=[{type:m.Component,args:[{selector:"nodes-pager",template:'\r\n<div style="justify-content: center;align-items: center;height: 100%;left: -6px;position: relative;" class="d-flex f-utils-fill" *ngIf="showPager | async"  [ngStyle]=" { \'opacity\': (disabled ? 0.6 : 1), \'pointer-events\': (disabled? \'none\': \'\')  }">\r\n    <ul class="treetable-nodes-pagerbar d-flex"  (click)="$event.stopPropagation()" >\r\n        <li class="pageinfo d-flex flex-row" >\r\n            <div class="page-number-list">\r\n                <div style="display: inline-block;">\r\n                    {{pagerInfo.pageIndex}}\r\n                </div>\r\n                <select #pagerList class="page-index" hidefocus="true" [ngModel]="pagerInfo.pageIndex" (ngModelChange)="pagerChanged($event)">\r\n                    <option *ngFor="let t of pagers;let i=index" [ngValue]="i + 1">{{i + 1}}</option>\r\n                </select>\r\n            </div>\r\n           / {{ getPagerCount() }}</li>\r\n        <li class="pager-btn prev" [class.disabled]="isFirstPager()" (click)="previous($event)" title="{{ \'pagination.previous\'|locale: \'上一页\' }}">\r\n            <span class="f-icon f-icon-arrow-chevron-left"></span>\r\n        </li>\r\n        <li class="pager-btn next"  [class.disabled]="isLastPager()" (click)="next($event)" title="{{ \'pagination.next\'|locale: \'下一页\' }}">\r\n            <span class="f-icon f-icon-arrow-chevron-right"></span>\r\n        </li>\r\n        <li class="ml-2" *ngIf="showTotal">\r\n            {{pagerInfo?.totalCount}}\r\n        </li>\r\n    </ul>\r\n\r\n</div>',styles:["\n        .treetable-nodes-pagerbar { height: 22px; line-height: 22px; list-style: none}\n        .treetable-nodes-pagerbar li { float: left; box-sizing: border-box; }\n        .treetable-nodes-pagerbar .pager-btn {\n            width: 22px;\n            height: 22px;\n            text-align: center;\n            border: 1px solid #ccc;\n            background: rgb(248 249 250);\n            cursor: pointer;\n        }\n        .treetable-nodes-pagerbar .pager-btn:hover {\n            background: white;\n        }\n        .treetable-nodes-pagerbar .prev {}\n        .treetable-nodes-pagerbar .next {\n            border-left: 0;\n        }\n\n        .pager-btn.disabled{\n            color: rgb(204 204 204);\n            pointer-events: none;\n        }\n        .treetable-nodes-pagerbar .pageinfo {\n            margin-right: 5px;\n            padding-left: 0;\n            font-weight: 400;\n            padding-right: 5px;\n        }\n\n        .treetable-nodes-pagerbar .page-index {\n            border: 0;\n            background: transparent;\n            outline: none;\n            appearance: none;\n            padding-left: 5px;\n            min-width: 50px;\n            position: absolute;\n            height: 20px;\n            text-align: left;\n            opacity: 0;\n            left: 0;\n        }\n\n        .treetable-nodes-pagerbar .page-number-list {\n            height: 20px;\n            min-width: 30px;\n            max-width: 50px;\n            overflow: hidden;\n            text-align: center;\n            position: relative;\n            border-bottom: 1px solid #ced4da;\n        }\n        "]}]}],ne.ctorParameters=function(){return[{type:z},{type:m.ChangeDetectorRef},{type:m.Injector}]},ne.propDecorators={disabled:[{type:m.Input}],context:[{type:m.Input}],pagerListEl:[{type:m.ViewChild,args:["pagerList"]}],pageChange:[{type:m.Output}],showTotal:[{type:m.Input}]},ne);function ne(e,t,n){var i=this;this.tt=e,this.cd=t,this.injector=n,this.disabled=!1,this.pageChange=new m.EventEmitter,this.showTotal=!1,this.showPager=new p.BehaviorSubject(!1),this.pagerInfo=null,this.tt&&(this.tt.expand.pipe(u.filter(function(e){return e.id===i.context.node.id&&e.pagination&&e.children.filter(function(e){return!e.__childs_loading__}).length})).subscribe(function(e){i.pagerInfo=y({},e.pagination),i.showPager.next(!0)}),this.tt.appendNew.subscribe(function(e){var t=e.parent;t.id===i.context.node.id&&t.pagination&&(i.pagerInfo=y({},t.pagination),i.showPager.next(!0))}),this.tt.collapse.subscribe(function(e){e.id===i.context.node.id&&i.showPager.next(!1)}))}var ie=(se.prototype.ngOnInit=function(){},se.decorators=[{type:m.Component,args:[{selector:"childs-loading",template:'\n    <div class="loading">\n        <span></span>\n        <span></span>\n        <span></span>\n        <span></span>\n        <span></span>\n    </div>\n    ',styles:["\n        .loading{\n            width: 150px;\n            height: 10px;\n            margin: 0 auto;\n            margin-top:10px;\n            margin-bottom: 20px;\n        }\n        .loading span{\n            display: inline-block;\n            width: 10px;\n            height: 100%;\n            margin-right: 5px;\n            border-radius: 50%;\n            background: #59a1ff;\n            -webkit-animation: load 1.04s ease infinite;\n        }\n        .loading span:last-child{\n            margin-right: 0px;\n        }\n        @-webkit-keyframes load{\n            0%{\n                opacity: 1;\n                -webkit-transform: scale(1.3);\n            }\n            100%{\n                opacity: 0.2;\n                -webkit-transform: scale(.3);\n            }\n        }\n        .loading span:nth-child(1){\n            -webkit-animation-delay:0.13s;\n        }\n        .loading span:nth-child(2){\n            -webkit-animation-delay:0.26s;\n        }\n        .loading span:nth-child(3){\n            -webkit-animation-delay:0.39s;\n        }\n        .loading span:nth-child(4){\n            -webkit-animation-delay:0.52s;\n        }\n        .loading span:nth-child(5){\n            -webkit-animation-delay:0.65s;\n        }\n        "]}]}],se.ctorParameters=function(){return[]},se);function se(){}var oe=(re.prototype.transform=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return e.showTips?this.getCellTooltipContent(e,t[0]):""},re.prototype.getCellTooltipContent=function(e,t){var n=this.commonUtils.getValue(e.field,t.data);return e.tipContent?"string"==typeof e.tipContent?n=e.tipContent:"function"==typeof e.tipContent&&(n=e.tipContent(n,t.data,e)):e.formatter&&"object"==typeof e.formatter&&"enum"===e.formatter.type&&(n=this.commonUtils.getEnumTitleFromColumnOptions(n,e.formatter.options)),n},re.decorators=[{type:m.Pipe,args:[{name:"tipmsg"}]}],re.ctorParameters=function(){return[{type:f.CommonUtils}]},re);function re(e){this.commonUtils=e}var le=(ae.prototype.transform=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var i=!e.selectable,s=!1;return!!(t&&t.length&&(t[0]&&(s=t[0]({node:e})),t[1]))||i||s},ae.decorators=[{type:m.Pipe,args:[{name:"disablenode"}]}],ae);function ae(){}var de=(ce.decorators=[{type:m.NgModule,args:[{imports:[n.CommonModule,r.FormsModule,f.FarrisCommonModule.forRoot(),s.PerfectScrollbarModule,t.InputGroupModule,h.LocaleModule.forRoot(),l.DataColumnModule.forRoot(),c.PaginationModule,g.FarrisContextMenuModule],declarations:[z,F,H,P,j,M,U,Z,T,G,X,J,$,te,ie,oe,le],exports:[z,F,H,P,j,M,U,Z,f.FarrisCommonModule,G,T,J,$,te,ie,oe,le,g.FarrisContextMenuModule],providers:[x,a.ResizeService,w]}]}],ce);function ce(){}e.TreetableService=x,e.FindInputComponent=X,e.HighlightPipe=J,e.TTHotkeys=w,e.TreetableNodesPagerComponent=te,e.ChildsLoadingComponent=ie,e.CellTipsPipe=oe,e.DisableNodePipe=le,e.TreeTableModule=de,e.TreeTableColumnDirective=T,e.TreeTableComponent=z,e.TTBodyComponent=F,e.TreeTableTogglerComponent=H,e.TreeTableSelectRowDirective=P,e.TreeTableHeaderCheckboxComponent=M,e.TreeTableCheckboxComponent=j,e.DblClickRowDirective=U,e.CustomRowStyleDirective=$,e.TTCustomCellStyleDirective=G,e.TTResizableColumnDirective=Z,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=farris-ui-treetable.umd.min.js.map