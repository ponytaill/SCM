import { Subject } from 'rxjs';
import { ChangeSet } from '../changeset';
import { SchemaEntityField$Type } from '../schema/schema';
import { EntityList } from './entity_list';
import { entityPrototype } from './entity_prototype';
import { NG_FIELD, NG_LIST, NG_OBJECT } from './metadata';
import { PARENT_CLASS, PARENT_PATH } from './types';
import { Validator } from './validator';
import { ValidationUtils } from './validator/validation_utils';
/**
 * 实体类型工厂
 * 用来根据实体Schema描述信息创建实体类型
 */
export class EntityTypeFactory {
    constructor() { }
    /**
     * 由实体Schema结构创建实体类型
     * @param schema 实体Schema结构
     * @returns 实体类型
     */
    create(schema) {
        // 提取Schema定义中的第一个是实体描述
        const schemaType = schema.entities[0].type;
        // 创建实体类型
        const entityType = this.createClass(schemaType, schema.entities[0]);
        return entityType;
    }
    /**
     * 由实体Schema类型描述创建实体类
     * @param schemaType Schema实体类型描述
     * @returns 实体类型
     */
    createClass(schemaType, relateSchema) {
        const attachEntityInstanceData = this.createEntityInstanceDataInitializer(schemaType);
        // 创建指定实体类型的初始化函数，用来在实体类型构造函数中为实体实例赋值
        const initialize = (entityInstance, entityData, entityTypeConstructor) => {
            entityInstance.isInitializing = true;
            attachEntityInstanceData(entityInstance, entityData, entityTypeConstructor);
            entityInstance.isInitializing = false;
        };
        // 声明实体类构造函数
        const ConcreteEntity = function (data) {
            // 创建实体变更集
            this.changeSet = new ChangeSet();
            // 初始化实体验证状态
            this.isValidating = false;
            // 设置unsubscribe 取消订阅事件
            this.unsubscribe = new Subject();
            // 初始化实体验证信息
            this.validErrors = {};
            // 初始化验证器
            this.validator = new Validator();
            // 初始化实体数据副本
            this.innerData = Object.assign({}, data);
            // 初始化子实体对象集合
            this.innerEntities = {};
            // 初始化实体值变化事件
            this.valueChanged = new Subject();
            this.onValueChanged = this.valueChanged;
            this.validateFromUtilSync = function (propertyName, value, cb, context) {
                this.validErrors = {};
                const result = this.validator.verify(this, propertyName, value, null, undefined, context && context.frameContext || null, true);
                if (result && !result.isValid) {
                    this.validErrors = ValidationUtils.convertErrorsToNormalObject(result.errors, {});
                }
                cb(result);
            };
            // 调用初始化方法，初始化实体数据
            initialize(this, data, ConcreteEntity);
            this.load = (newData) => {
                attachEntityInstanceData(this, newData, ConcreteEntity);
            };
        };
        // 在实体类构造函数中记录视图类型名称
        ConcreteEntity.typeName = `${schemaType.name}Entity`;
        ConcreteEntity.code = relateSchema.code;
        ConcreteEntity.label = relateSchema.label;
        // 在实体类构造函数中记录其下直接引用的子类型
        ConcreteEntity.types = {};
        ConcreteEntity.__prop__metadata__ = {};
        // 构造实体类的原型对象
        const entityTypePrototype = Object.assign({ typeName: 'ConcreteEntityPrototype' }, entityPrototype);
        // 向实体类原型对象中定义预制属性
        this.definePresetProperty(entityTypePrototype, schemaType);
        // 向实体类原型对象中定义字段属性get/set方法
        this.defineFieldsToPrototype(entityTypePrototype, schemaType.fields, schemaType.primary, ConcreteEntity);
        // 向实体类原型对象中定义访问子实体的get/set方法
        this.defineEntitiesToPrototype(entityTypePrototype, schemaType.entities, ConcreteEntity);
        // 将实体类的原型对象指向新构造的原型对象。
        ConcreteEntity.prototype = entityTypePrototype;
        return ConcreteEntity;
    }
    /**
     * 向实体类原型对象中定义预制属性
     * @param prototypeObject 实体类原型对象
     * @param schemaType Schema类型描述
     */
    definePresetProperty(prototypeObject, schemaType) {
        /**
         * 实体数据
         */
        Object.defineProperty(prototypeObject, 'data', {
            get: function () {
                if (!this.innerData) {
                    this.innerData = {};
                }
                return this.innerData;
            },
            set: function (value) {
                this.innerData = value;
            }
        });
        /**
         * 实体验证信息
         */
        Object.defineProperty(prototypeObject, 'errors', {
            get: function () {
                return this.validErrors;
            },
            set: function (errors) {
                this.validErrors = errors;
            }
        });
        /**
         * 实体变更集
         */
        Object.defineProperty(prototypeObject, 'changes', {
            get: function () {
                return this.changeSet.changes;
            }
        });
        /**
         * 实体主键
         */
        Object.defineProperty(prototypeObject, 'primaryProperty', {
            // tslint:disable-next-line: only-arrow-functions
            get: function () {
                // return schemaType.primary;
                return prototypeObject.innerPrimaryProperty || { dataField: schemaType.primary };
            }
        });
        /**
         * 实体主键
         */
        Object.defineProperty(prototypeObject, 'primaryKey', {
            // tslint:disable-next-line: only-arrow-functions
            get: function () {
                return schemaType.primary || '';
            }
        });
        /**
         * 实体主键的值
         */
        Object.defineProperty(prototypeObject, 'primaryValue', {
            get: function () {
                if (this.primaryKey) {
                    // return this[this.primaryProperty.property].toString();
                    const primaryValue = this[this.primaryKey];
                    return primaryValue ? primaryValue : '';
                }
                else {
                    return '';
                }
            }
        });
    }
    /**
     * 向实体类定义字段属性
     * @param prototypeObject 实体类原型对象
     * @param fields 字段描述集合
     * @param parentEntityType 父类型
     */
    defineFieldsToPrototype(prototypeObject, fields, primary, parentEntityType) {
        if (fields && fields.length) {
            // 遍历Schema中描述的字段，在实体原型对象上定义字段访问函数
            fields.forEach(schemaEntityField => {
                switch (schemaEntityField.$type) {
                    // 定义简单类型字段
                    case SchemaEntityField$Type.SimpleField:
                        this.defineSimpleFieldToPrototype(prototypeObject, schemaEntityField, primary, parentEntityType);
                        break;
                    // 定义复杂类型字段
                    case SchemaEntityField$Type.ComplexField:
                        this.defineComplexFieldToPrototype(prototypeObject, schemaEntityField, parentEntityType);
                        break;
                }
            });
        }
    }
    /**
     * 向实体类定义简单类型字段
     * @param prototypeObject 实体类原型对象
     * @param schemaField 字段描述
     */
    defineSimpleFieldToPrototype(prototypeObject, schemaField, primary, parentEntityType) {
        const propertyName = schemaField.label;
        Object.defineProperty(prototypeObject, propertyName, {
            get: function () {
                return this.getFieldValue(schemaField);
            },
            set: function (newPropValue) {
                // 值相同时不触发变更。
                const oldPropValue = this.getFieldValue(schemaField);
                if (this.isFieldValueChanged(schemaField, newPropValue, oldPropValue) === false) {
                    return;
                }
                this.setFieldValue(schemaField, newPropValue);
                this.emitFieldValueChange(schemaField, newPropValue, oldPropValue);
            }
        });
        const fieldMetadata = {
            /** 字段名称 */
            dataField: this.getDataField(schemaField),
            /** 原始字段名称 */
            originalDataField: schemaField.code,
            /** 原始字段类型 */
            originalDataFieldType: schemaField.type.name,
            /**
             * 原始字段
             * @description 对应到scheme的path属性
             */
            path: schemaField.path,
            primary: schemaField.label === primary,
            enableMultiLangInput: this.getEnableMultiLangInput(schemaField),
            defaultValue: schemaField.defaultValue,
            ngMetadataName: NG_FIELD
        };
        if (schemaField['enableStdTimeFormat'] && fieldMetadata.originalDataFieldType == "DateTime") {
            fieldMetadata["enableTimeZone"] = true;
        }
        if (fieldMetadata.primary) {
            prototypeObject.innerPrimaryProperty = fieldMetadata;
        }
        if (!parentEntityType.__prop__metadata__[propertyName]) {
            parentEntityType.__prop__metadata__[propertyName] = [];
        }
        parentEntityType.__prop__metadata__[propertyName].push(fieldMetadata);
    }
    getDataField(schemaField) {
        if (schemaField.multiLanguage) {
            return schemaField.label + "_" + "MULTILANGUAGE";
        }
        return schemaField.label;
    }
    getEnableMultiLangInput(schemaField) {
        if (schemaField.multiLanguage) {
            return true;
        }
    }
    /**
     * 向实体类定义复杂类型字段
     * @param prototypeObject 实体类原型对象
     * @param schemaField 字段描述
     * @param parentEntityType 父类型
     */
    defineComplexFieldToPrototype(prototypeObject, schemaField, parentEntityType) {
        const complexFieldType = this.createClass(schemaField.type, schemaField);
        parentEntityType.types[schemaField.type.name] = complexFieldType;
        const propertyName = schemaField.label;
        Object.defineProperty(prototypeObject, propertyName, {
            get: function () {
                const fieldValue = this.getComplexFieldValue(schemaField);
                return fieldValue;
            },
            set: function (value) {
                this.setComplexFieldValue(schemaField, complexFieldType, value);
            }
        });
        const fieldMetadata = {
            /** 映射字段 */
            dataField: schemaField.label,
            /** 原始字段名称 */
            originalDataField: schemaField.code,
            /** 引用实体类型 */
            type: complexFieldType,
            /**
             * 原始字段
             * @description 对应到scheme的path属性
             */
            path: schemaField.path,
            ngMetadataName: NG_OBJECT
        };
        if (!parentEntityType.__prop__metadata__[propertyName]) {
            parentEntityType.__prop__metadata__[propertyName] = [];
        }
        parentEntityType.__prop__metadata__[propertyName].push(fieldMetadata);
    }
    /**
     * 向实体类定义子实体
     * @param prototypeObject 实体类原型对象
     * @param entities 实体描述集合
     * @param parentEntityType 父类型
     */
    defineEntitiesToPrototype(prototypeObject, entities, parentEntityType) {
        if (entities && entities.length) {
            // 遍历Schema中描述的子实体，在实体对象上定义子实体列表
            entities.forEach(schemaEntity => {
                const complexFieldType = this.createClass(schemaEntity.type, schemaEntity);
                parentEntityType.types[schemaEntity.type.name] = complexFieldType;
                // 提取子实体在实体对象上的属性名
                const propertyName = schemaEntity.label;
                Object.defineProperty(prototypeObject, propertyName, {
                    get: function () {
                        const fieldValue = this.getEntities(schemaEntity);
                        return fieldValue;
                    },
                    set: function (value) {
                        this.setEntities(schemaEntity, value);
                    }
                });
                const entitMetadata = {
                    /** 字段名称 */
                    dataField: schemaEntity.label,
                    /** 原始字段名称 */
                    originalDataField: '',
                    /** 实体类型 */
                    type: complexFieldType,
                    ngMetadataName: NG_LIST
                };
                if (!parentEntityType.__prop__metadata__[propertyName]) {
                    parentEntityType.__prop__metadata__[propertyName] = [];
                }
                parentEntityType.__prop__metadata__[propertyName].push(entitMetadata);
            });
        }
    }
    /**
     * 创建初始化实体对象方法
     * @param schemaType 实体类型描述
     * @returns 初始化实体对象方法
     */
    createEntityInstanceDataInitializer(schemaType) {
        /**
         * 实体初始化函数，用来初始化实体的复杂类型数据和子实体数据
         * @param entityInstance 实体类型实例
         * @param data 实体原始数据
         * @param entityTypeConstructor 实体类型构造函数
         */
        const initializer = (entityInstance, entityData, entityTypeConstructor) => {
            // 初始化复杂类型字段
            schemaType.fields
                // 过滤复杂类型字段
                .filter(field => field.$type === SchemaEntityField$Type.ComplexField)
                // 遍历复杂类型字段创建对应实体类型数据
                .forEach(field => {
                // 提取字段名
                const fieldName = field.label;
                // 提取实体类型下的所有子实体类型
                const includedEntityTypes = entityTypeConstructor.types;
                // 获取复杂类型字段对应的实体类型
                const ComplexField = includedEntityTypes[field.type.name];
                // 提取复杂类型字段原始数据
                const fieldData = entityData ? entityData[fieldName] : null;
                // 创建复杂类型字段对象路径
                const path = entityInstance.createPath(fieldName);
                let complexFieldValue = entityInstance[fieldName];
                if (complexFieldValue instanceof ComplexField) {
                    complexFieldValue.load(fieldData);
                }
                else {
                    // 创建复杂类型字段实体实例
                    complexFieldValue = new ComplexField(fieldData);
                    complexFieldValue.constructor = ComplexField;
                    complexFieldValue[PARENT_CLASS] = entityTypeConstructor;
                    complexFieldValue[PARENT_PATH] = path;
                    complexFieldValue.onValueChanged.subscribe(changes => {
                        if (changes) {
                            changes.path = (entityInstance[PARENT_PATH] || []).concat(changes.path);
                            entityInstance.setChanges(changes);
                        }
                    });
                    entityInstance[fieldName] = complexFieldValue;
                }
            });
            // 初始化子实体
            if (schemaType.entities) {
                // 遍历子实体创建对应实体类型的数据
                schemaType.entities.forEach(schemaEntity => {
                    // 提取子实体名
                    const subEntityName = schemaEntity.label;
                    // 提取实体类型下的所有子实体类型
                    const includedEntityTypes = entityTypeConstructor.types;
                    // 创建子实体对象路径
                    const path = entityInstance.createPath(subEntityName);
                    // 创建子实体对象集合
                    let entityList = entityInstance[subEntityName];
                    if (!(entityList instanceof EntityList)) {
                        entityList = new EntityList();
                        // 向子实体列表注册子实体变化事件
                        entityList.onListChanged.subscribe(value => {
                            if (value) {
                                if (entityList[PARENT_PATH][0] !== value.path[0]) {
                                    value.path = entityList[PARENT_PATH].concat(value.path);
                                }
                                entityInstance.setChanges(value);
                            }
                        });
                        // 向实体类型实例上直接存储子实体对象列表
                        entityInstance[subEntityName] = entityList;
                    }
                    entityList[PARENT_CLASS] = entityTypeConstructor;
                    entityList[PARENT_PATH] = path;
                    // 提取子实体类型名称
                    const schemaEntityTypeName = schemaEntity.type.name;
                    // 获取子实体类型
                    const ConcreteEntity = includedEntityTypes[schemaEntityTypeName];
                    const originalEntityDataArray = entityData ? entityData[subEntityName] : null;
                    // 构造子实体集合
                    if (originalEntityDataArray) {
                        // 遍历子实体原始数据，构造实体对象集合
                        const entities = originalEntityDataArray.map((originalEntityData) => {
                            const concreteEntityInstance = new ConcreteEntity(originalEntityData);
                            concreteEntityInstance.constructor = ConcreteEntity;
                            return concreteEntityInstance;
                        });
                        // 向子实体列表中添加子实体对象
                        entityList.loadEntities(entities);
                    }
                });
            }
        };
        return initializer;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW50aXR5X3R5cGVfZmFjdG9yeS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvZGV2a2l0LyIsInNvdXJjZXMiOlsibGliL2VudGl0eS9lbnRpdHlfdHlwZV9mYWN0b3J5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDL0IsT0FBTyxFQUFFLFNBQVMsRUFBZ0IsTUFBTSxjQUFjLENBQUM7QUFDdkQsT0FBTyxFQUEyQyxzQkFBc0IsRUFBYyxNQUFNLGtCQUFrQixDQUFDO0FBRS9HLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQ3JELE9BQU8sRUFBYSxRQUFRLEVBQUUsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLFlBQVksQ0FBQztBQUNyRSxPQUFPLEVBQUUsWUFBWSxFQUFFLFdBQVcsRUFBRSxNQUFNLFNBQVMsQ0FBQztBQUNwRCxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBQ3hDLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQVEvRDs7O0dBR0c7QUFDSCxNQUFNLE9BQU8saUJBQWlCO0lBRTVCLGdCQUFnQixDQUFDO0lBQ2pCOzs7O09BSUc7SUFDSSxNQUFNLENBQUMsTUFBYztRQUMxQix1QkFBdUI7UUFDdkIsTUFBTSxVQUFVLEdBQUcsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7UUFDM0MsU0FBUztRQUNULE1BQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsVUFBVSxFQUFFLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNwRSxPQUFPLFVBQVUsQ0FBQztJQUNwQixDQUFDO0lBQ0Q7Ozs7T0FJRztJQUNLLFdBQVcsQ0FBQyxVQUFzQixFQUFFLFlB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SSxDQUFDO29CQUM5RSxVQUFVO29CQUNWLElBQUksdUJBQXVCLEVBQUU7d0JBQzNCLHFCQUFxQjt3QkFDckIsTUFBTSxRQUFRLEdBQUcsdUJBQXVCLENBQUMsR0FBRyxDQUFDLENBQUMsa0JBQXVCLEVBQUUsRUFBRTs0QkFDdkUsTUFBTSxzQkFBc0IsR0FBRyxJQUFJLGNBQWMsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDOzRCQUN0RSxzQkFBc0IsQ0FBQyxXQUFXLEdBQUcsY0FBYyxDQUFDOzRCQUNwRCxPQUFPLHNCQUFzQixDQUFDO3dCQUNoQyxDQUFDLENBQUMsQ0FBQzt3QkFDSCxpQkFBaUI7d0JBQ2pCLFVBQVUsQ0FBQyxZQUFZLENBQUMsUUFBUSxDQUFDLENBQUM7cUJBQ25DO2dCQUNILENBQUMsQ0FBQyxDQUFDO2FBQ0o7UUFDSCxDQUFDLENBQUM7UUFDRixPQUFPLFdBQVcsQ0FBQztJQUNyQixDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IENoYW5nZVNldCwgTW9kaWZpY2F0aW9uIH0gZnJvbSAnLi4vY2hhbmdlc2V0JztcclxuaW1wb3J0IHsgU2NoZW1hLCBTY2hlbWFFbnRpdHksIFNjaGVtYUVudGl0eUZpZWxkLCBTY2hlbWFFbnRpdHlGaWVsZCRUeXBlLCBTY2hlbWFUeXBlIH0gZnJvbSAnLi4vc2NoZW1hL3NjaGVtYSc7XHJcbmltcG9ydCB7IEVudGl0eSB9IGZyb20gJy4vZW50aXR5JztcclxuaW1wb3J0IHsgRW50aXR5TGlzdCB9IGZyb20gJy4vZW50aXR5X2xpc3QnO1xyXG5pbXBvcnQgeyBlbnRpdHlQcm90b3R5cGUgfSBmcm9tICcuL2VudGl0eV9wcm90b3R5cGUnO1xyXG5pbXBvcnQgeyBOR19FTlRJVFksIE5HX0ZJRUxELCBOR19MSVNULCBOR19PQkpFQ1QgfSBmcm9tICcuL21ldGFkYXRhJztcclxuaW1wb3J0IHsgUEFSRU5UX0NMQVNTLCBQQVJFTlRfUEFUSCB9IGZyb20gJy4vdHlwZXMnO1xyXG5pbXBvcnQgeyBWYWxpZGF0b3IgfSBmcm9tICcuL3ZhbGlkYXRvcic7XHJcbmltcG9ydCB7IFZhbGlkYXRpb25VdGlscyB9IGZyb20gJy4vdmFsaWRhdG9yL3ZhbGlkYXRpb25fdXRpbHMnO1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBBYnN0cmFjdEVudGl0eVR5cGUge1xyXG4gIHR5cGVOYW1lOiBzdHJpbmc7XHJcbiAgdHlwZXM6IGFueTtcclxuICBfX3Byb3BfX21ldGFkYXRhX186IGFueTtcclxufVxyXG5cclxuLyoqXHJcbiAqIOWunuS9k+exu+Wei+W3peWOglxyXG4gKiDnlKjmnaXmoLnmja7lrp7kvZNTY2hlbWHmj4/ov7Dkv6Hmga/liJvlu7rlrp7kvZPnsbvlnotcclxuICovXHJcbmV4cG9ydCBjbGFzcyBFbnRpdHlUeXBlRmFjdG9yeSB7XHJcblxyXG4gIGNvbnN0cnVjdG9yKCkgeyB9XHJcbiAgLyoqXHJcbiAgICog55Sx5a6e5L2TU2NoZW1h57uT5p6E5Yib5bu65a6e5L2T57G75Z6LXHJcbiAgICogQHBhcmFtIHNjaGVtYSDlrp7kvZNTY2hlbWHnu5PmnoRcclxuICAgKiBAcmV0dXJucyDlrp7kvZPnsbvlnotcclxuICAgKi9cclxuICBwdWJsaWMgY3JlYXRlKHNjaGVtYTogU2NoZW1hKSB7XHJcbiAgICAvLyDmj5Dlj5ZTY2hlbWHlrprkuYnkuK3nmoTnrKzkuIDkuKrmmK/lrp7kvZPmj4/ov7BcclxuICAgIGNvbnN0IHNjaGVtYVR5cGUgPSBzY2hlbWEuZW50aXRpZXNbMF0udHlwZTtcclxuICAgIC8vIOWIm+W7uuWunuS9k+exu+Wei1xyXG4gICAgY29uc3QgZW50aXR5VHlwZSA9IHRoaXMuY3JlYXRlQ2xhc3Moc2NoZW1hVHlwZSwgc2NoZW1hLmVudGl0aWVzWzBdKTtcclxuICAgIHJldHVybiBlbnRpdHlUeXBlO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDnlLHlrp7kvZNTY2hlbWHnsbvlnovmj4/ov7DliJvlu7rlrp7kvZPnsbtcclxuICAgKiBAcGFyYW0gc2NoZW1hVHlwZSBTY2hlbWHlrp7kvZPnsbvlnovmj4/ov7BcclxuICAgKiBAcmV0dXJucyDlrp7kvZPnsbvlnotcclxuICAgKi9cclxuICBwcml2YXRlIGNyZWF0ZUNsYXNzKHNjaGVtYVR5cGU6IFNjaGVtYVR5cGUsIHJlbGF0ZVNjaGVtYTogYW55KSB7XHJcbiAgICBjb25zdCBhdHRhY2hFbnRpdHlJbnN0YW5jZURhdGEgPSB0aGlzLmNyZWF0ZUVudGl0eUluc3RhbmNlRGF0YUluaXRpYWxpemVyKHNjaGVtYVR5cGUpO1xyXG4gICAgLy8g5Yib5bu65oyH5a6a5a6e5L2T57G75Z6L55qE5Yid5aeL5YyW5Ye95pWw77yM55So5p2l5Zyo5a6e5L2T57G75Z6L5p6E6YCg5Ye95pWw5Lit5Li65a6e5L2T5a6e5L6L6LWL5YC8XHJcbiAgICBjb25zdCBpbml0aWFsaXplID0gKGVudGl0eUluc3RhbmNlOiBhbnksIGVudGl0eURhdGE6IGFueSwgZW50aXR5VHlwZUNvbnN0cnVjdG9yOiBhbnkpID0+IHtcclxuICAgICAgZW50aXR5SW5zdGFuY2UuaXNJbml0aWFsaXppbmcgPSB0cnVlO1xyXG4gICAgICBhdHRhY2hFbnRpdHlJbnN0YW5jZURhdGEoZW50aXR5SW5zdGFuY2UsIGVudGl0eURhdGEsIGVudGl0eVR5cGVDb25zdHJ1Y3Rvcik7XHJcbiAgICAgIGVudGl0eUluc3RhbmNlLmlzSW5pdGlhbGl6aW5nID0gZmFsc2U7XHJcbiAgICB9O1xyXG4gICAgLy8g5aOw5piO5a6e5L2T57G75p6E6YCg5Ye95pWwXHJcbiAgICBjb25zdCBDb25jcmV0ZUVudGl0eSA9IGZ1bmN0aW9uIChkYXRhOiBhbnkpIHtcclxuICAgICAgLy8g5Yib5bu65a6e5L2T5Y+Y5pu06ZuGXHJcbiAgICAgIHRoaXMuY2hhbmdlU2V0ID0gbmV3IENoYW5nZVNldCgpO1xyXG4gICAgICAvLyDliJ3lp4vljJblrp7kvZPpqozor4HnirbmgIFcclxuICAgICAgdGhpcy5pc1ZhbGlkYXRpbmcgPSBmYWxzZTtcclxuICAgICAgLy8g6K6+572udW5zdWJzY3JpYmUg5Y+W5raI6K6i6ZiF5LqL5Lu2XHJcbiAgICAgIHRoaXMudW5zdWJzY3JpYmUgPSBuZXcgU3ViamVjdCgpO1xyXG4gICAgICAvLyDliJ3lp4vljJblrp7kvZPpqozor4Hkv6Hmga9cclxuICAgICAgdGhpcy52YWxpZEVycm9ycyA9IHt9O1xyXG4gICAgICAvLyDliJ3lp4vljJbpqozor4HlmahcclxuICAgICAgdGhpcy52YWxpZGF0b3IgPSBuZXcgVmFsaWRhdG9yKCk7XHJcbiAgICAgIC8vIOWIneWni+WMluWunuS9k+aVsOaNruWJr+acrFxyXG4gICAgICB0aGlzLmlubmVyRGF0YSA9IE9iamVjdC5hc3NpZ24oe30sIGRhdGEpO1xyXG4gICAgICAvLyDliJ3lp4vljJblrZDlrp7kvZPlr7nosaHpm4blkIhcclxuICAgICAgdGhpcy5pbm5lckVudGl0aWVzID0ge307XHJcbiAgICAgIC8vIOWIneWni+WMluWunuS9k+WAvOWPmOWMluS6i+S7tlxyXG4gICAgICB0aGlzLnZhbHVlQ2hhbmdlZCA9IG5ldyBTdWJqZWN0PE1vZGlmaWNhdGlvbj4oKTtcclxuICAgICAgdGhpcy5vblZhbHVlQ2hhbmdlZCA9IHRoaXMudmFsdWVDaGFuZ2VkO1xyXG4gICAgICB0aGlzLnZhbGlkYXRlRnJvbVV0aWxTeW5jID0gZnVuY3Rpb24gKHByb3BlcnR5TmFtZSwgdmFsdWUsIGNiLCBjb250ZXh0KSB7XHJcbiAgICAgICAgdGhpcy52YWxpZEVycm9ycyA9IHt9O1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMudmFsaWRhdG9yLnZlcmlmeSh0aGlzLCBwcm9wZXJ0eU5hbWUsIHZhbHVlLCBudWxsLCB1bmRlZmluZWQsIGNvbnRleHQgJiYgY29udGV4dC5mcmFtZUNvbnRleHQgfHwgbnVsbCwgdHJ1ZSk7XHJcbiAgICAgICAgaWYgKHJlc3VsdCAmJiAhcmVzdWx0LmlzVmFsaWQpIHtcclxuICAgICAgICAgIHRoaXMudmFsaWRFcnJvcnMgPSBWYWxpZGF0aW9uVXRpbHMuY29udmVydEVycm9yc1RvTm9ybWFsT2JqZWN0KHJlc3VsdC5lcnJvcnMsIHt9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2IocmVzdWx0KTtcclxuICAgICAgfTtcclxuICAgICAgLy8g6LCD55So5Yid5aeL5YyW5pa55rOV77yM5Yid5aeL5YyW5a6e5L2T5pWw5o2uXHJcbiAgICAgIGluaXRpYWxpemUodGhpcywgZGF0YSwgQ29uY3JldGVFbnRpdHkpO1xyXG4gICAgICB0aGlzLmxvYWQgPSAobmV3RGF0YTogYW55KSA9PiB7XHJcbiAgICAgICAgYXR0YWNoRW50aXR5SW5zdGFuY2VEYXRhKHRoaXMsIG5ld0RhdGEsIENvbmNyZXRlRW50aXR5KTtcclxuICAgICAgfTtcclxuICAgIH07XHJcblxyXG5cclxuICAgIC8vIOWcqOWunuS9k+exu+aehOmAoOWHveaVsOS4reiusOW9leinhuWbvuexu+Wei+WQjeensFxyXG4gICAgQ29uY3JldGVFbnRpdHkudHlwZU5hbWUgPSBgJHtzY2hlbWFUeXBlLm5hbWV9RW50aXR5YDtcclxuICAgIENvbmNyZXRlRW50aXR5LmNvZGUgPSByZWxhdGVTY2hlbWEuY29kZTtcclxuICAgIENvbmNyZXRlRW50aXR5LmxhYmVsID0gcmVsYXRlU2NoZW1hLmxhYmVsO1xyXG4gICAgLy8g5Zyo5a6e5L2T57G75p6E6YCg5Ye95pWw5Lit6K6w5b2V5YW25LiL55u05o6l5byV55So55qE5a2Q57G75Z6LXHJcbiAgICBDb25jcmV0ZUVudGl0eS50eXBlcyA9IHt9O1xyXG4gICAgQ29uY3JldGVFbnRpdHkuX19wcm9wX19tZXRhZGF0YV9fID0ge1xyXG5cclxuICAgIH07XHJcblxyXG4gICAgLy8g5p6E6YCg5a6e5L2T57G755qE5Y6f5Z6L5a+56LGhXHJcbiAgICBjb25zdCBlbnRpdHlUeXBlUHJvdG90eXBlID0gT2JqZWN0LmFzc2lnbih7IHR5cGVOYW1lOiAnQ29uY3JldGVFbnRpdHlQcm90b3R5cGUnIH0sIGVudGl0eVByb3RvdHlwZSk7XHJcbiAgICAvLyDlkJHlrp7kvZPnsbvljp/lnovlr7nosaHkuK3lrprkuYnpooTliLblsZ7mgKdcclxuICAgIHRoaXMuZGVmaW5lUHJlc2V0UHJvcGVydHkoZW50aXR5VHlwZVByb3RvdHlwZSwgc2NoZW1hVHlwZSk7XHJcbiAgICAvLyDlkJHlrp7kvZPnsbvljp/lnovlr7nosaHkuK3lrprkuYnlrZfmrrXlsZ7mgKdnZXQvc2V05pa55rOVXHJcbiAgICB0aGlzLmRlZmluZUZpZWxkc1RvUHJvdG90eXBlKGVudGl0eVR5cGVQcm90b3R5cGUsIHNjaGVtYVR5cGUuZmllbGRzLCBzY2hlbWFUeXBlLnByaW1hcnksIENvbmNyZXRlRW50aXR5KTtcclxuICAgIC8vIOWQkeWunuS9k+exu+WOn+Wei+WvueixoeS4reWumuS5ieiuv+mXruWtkOWunuS9k+eahGdldC9zZXTmlrnms5VcclxuICAgIHRoaXMuZGVmaW5lRW50aXRpZXNUb1Byb3RvdHlwZShlbnRpdHlUeXBlUHJvdG90eXBlLCBzY2hlbWFUeXBlLmVudGl0aWVzLCBDb25jcmV0ZUVudGl0eSk7XHJcbiAgICAvLyDlsIblrp7kvZPnsbvnmoTljp/lnovlr7nosaHmjIflkJHmlrDmnoTpgKDnmoTljp/lnovlr7nosaHjgIJcclxuICAgIENvbmNyZXRlRW50aXR5LnByb3RvdHlwZSA9IGVudGl0eVR5cGVQcm90b3R5cGU7XHJcblxyXG5cclxuICAgIHJldHVybiBDb25jcmV0ZUVudGl0eTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5ZCR5a6e5L2T57G75Y6f5Z6L5a+56LGh5Lit5a6a5LmJ6aKE5Yi25bGe5oCnXHJcbiAgICogQHBhcmFtIHByb3RvdHlwZU9iamVjdCDlrp7kvZPnsbvljp/lnovlr7nosaFcclxuICAgKiBAcGFyYW0gc2NoZW1hVHlwZSBTY2hlbWHnsbvlnovmj4/ov7BcclxuICAgKi9cclxuICBwcml2YXRlIGRlZmluZVByZXNldFByb3BlcnR5KHByb3RvdHlwZU9iamVjdDogYW55LCBzY2hlbWFUeXBlOiBTY2hlbWFUeXBlKSB7XHJcbiAgICAvKipcclxuICAgICAqIOWunuS9k+aVsOaNrlxyXG4gICAgICovXHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocHJvdG90eXBlT2JqZWN0LCAnZGF0YScsIHtcclxuICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmlubmVyRGF0YSkge1xyXG4gICAgICAgICAgdGhpcy5pbm5lckRhdGEgPSB7fTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5uZXJEYXRhO1xyXG4gICAgICB9LFxyXG4gICAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xyXG4gICAgICAgIHRoaXMuaW5uZXJEYXRhID0gdmFsdWU7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgLyoqXHJcbiAgICAgKiDlrp7kvZPpqozor4Hkv6Hmga9cclxuICAgICAqL1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHByb3RvdHlwZU9iamVjdCwgJ2Vycm9ycycsIHtcclxuICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudmFsaWRFcnJvcnM7XHJcbiAgICAgIH0sXHJcbiAgICAgIHNldDogZnVuY3Rpb24gKGVycm9yczogYW55KSB7XHJcbiAgICAgICAgdGhpcy52YWxpZEVycm9ycyA9IGVycm9ycztcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICAvKipcclxuICAgICAqIOWunuS9k+WPmOabtOmbhlxyXG4gICAgICovXHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocHJvdG90eXBlT2JqZWN0LCAnY2hhbmdlcycsIHtcclxuICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2hhbmdlU2V0LmNoYW5nZXM7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgLyoqXHJcbiAgICAgKiDlrp7kvZPkuLvplK5cclxuICAgICAqL1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHByb3RvdHlwZU9iamVjdCwgJ3ByaW1hcnlQcm9wZXJ0eScsIHtcclxuICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBvbmx5LWFycm93LWZ1bmN0aW9uc1xyXG4gICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAvLyByZXR1cm4gc2NoZW1hVHlwZS5wcmltYXJ5O1xyXG4gICAgICAgIHJldHVybiBwcm90b3R5cGVPYmplY3QuaW5uZXJQcmltYXJ5UHJvcGVydHkgfHwgeyBkYXRhRmllbGQ6IHNjaGVtYVR5cGUucHJpbWFyeSB9O1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIC8qKlxyXG4gICAgICog5a6e5L2T5Li76ZSuXHJcbiAgICAgKi9cclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm90b3R5cGVPYmplY3QsICdwcmltYXJ5S2V5Jywge1xyXG4gICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IG9ubHktYXJyb3ctZnVuY3Rpb25zXHJcbiAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBzY2hlbWFUeXBlLnByaW1hcnkgfHwgJyc7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgLyoqXHJcbiAgICAgKiDlrp7kvZPkuLvplK7nmoTlgLxcclxuICAgICAqL1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHByb3RvdHlwZU9iamVjdCwgJ3ByaW1hcnlWYWx1ZScsIHtcclxuICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMucHJpbWFyeUtleSkge1xyXG4gICAgICAgICAgLy8gcmV0dXJuIHRoaXNbdGhpcy5wcmltYXJ5UHJvcGVydHkucHJvcGVydHldLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgICBjb25zdCBwcmltYXJ5VmFsdWUgPSB0aGlzW3RoaXMucHJpbWFyeUtleV07XHJcbiAgICAgICAgICByZXR1cm4gcHJpbWFyeVZhbHVlID8gcHJpbWFyeVZhbHVlIDogJyc7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHJldHVybiAnJztcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDlkJHlrp7kvZPnsbvlrprkuYnlrZfmrrXlsZ7mgKdcclxuICAgKiBAcGFyYW0gcHJvdG90eXBlT2JqZWN0IOWunuS9k+exu+WOn+Wei+WvueixoVxyXG4gICAqIEBwYXJhbSBmaWVsZHMg5a2X5q615o+P6L+w6ZuG5ZCIXHJcbiAgICogQHBhcmFtIHBhcmVudEVudGl0eVR5cGUg54i257G75Z6LXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBkZWZpbmVGaWVsZHNUb1Byb3RvdHlwZShcclxuICAgIHByb3RvdHlwZU9iamVjdDogYW55LFxyXG4gICAgZmllbGRzOiBTY2hlbWFFbnRpdHlGaWVsZFtdLFxyXG4gICAgcHJpbWFyeTogc3RyaW5nLFxyXG4gICAgcGFyZW50RW50aXR5VHlwZTogQWJzdHJhY3RFbnRpdHlUeXBlXHJcbiAgKTogdm9pZCB7XHJcbiAgICBpZiAoZmllbGRzICYmIGZpZWxkcy5sZW5ndGgpIHtcclxuICAgICAgLy8g6YGN5Y6GU2NoZW1h5Lit5o+P6L+w55qE5a2X5q6177yM5Zyo5a6e5L2T5Y6f5Z6L5a+56LGh5LiK5a6a5LmJ5a2X5q616K6/6Zeu5Ye95pWwXHJcbiAgICAgIGZpZWxkcy5mb3JFYWNoKHNjaGVtYUVudGl0eUZpZWxkID0+IHtcclxuICAgICAgICBzd2l0Y2ggKHNjaGVtYUVudGl0eUZpZWxkLiR0eXBlKSB7XHJcbiAgICAgICAgICAvLyDlrprkuYnnroDljZXnsbvlnovlrZfmrrVcclxuICAgICAgICAgIGNhc2UgU2NoZW1hRW50aXR5RmllbGQkVHlwZS5TaW1wbGVGaWVsZDpcclxuICAgICAgICAgICAgdGhpcy5kZWZpbmVTaW1wbGVGaWVsZFRvUHJvdG90eXBlKHByb3RvdHlwZU9iamVjdCwgc2NoZW1hRW50aXR5RmllbGQsIHByaW1hcnksIHBhcmVudEVudGl0eVR5cGUpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgIC8vIOWumuS5ieWkjeadguexu+Wei+Wtl+autVxyXG4gICAgICAgICAgY2FzZSBTY2hlbWFFbnRpdHlGaWVsZCRUeXBlLkNvbXBsZXhGaWVsZDpcclxuICAgICAgICAgICAgdGhpcy5kZWZpbmVDb21wbGV4RmllbGRUb1Byb3RvdHlwZShwcm90b3R5cGVPYmplY3QsIHNjaGVtYUVudGl0eUZpZWxkLCBwYXJlbnRFbnRpdHlUeXBlKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcbiAgLyoqXHJcbiAgICog5ZCR5a6e5L2T57G75a6a5LmJ566A5Y2V57G75Z6L5a2X5q61XHJcbiAgICogQHBhcmFtIHByb3RvdHlwZU9iamVjdCDlrp7kvZPnsbvljp/lnovlr7nosaFcclxuICAgKiBAcGFyYW0gc2NoZW1hRmllbGQg5a2X5q615o+P6L+wXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBkZWZpbmVTaW1wbGVGaWVsZFRvUHJvdG90eXBlKFxyXG4gICAgcHJvdG90eXBlT2JqZWN0OiBhbnksXHJcbiAgICBzY2hlbWFGaWVsZDogU2NoZW1hRW50aXR5RmllbGQsXHJcbiAgICBwcmltYXJ5OiBzdHJpbmcsXHJcbiAgICBwYXJlbnRFbnRpdHlUeXBlOiBBYnN0cmFjdEVudGl0eVR5cGVcclxuICApIHtcclxuICAgIGNvbnN0IHByb3BlcnR5TmFtZSA9IHNjaGVtYUZpZWxkLmxhYmVsO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHByb3RvdHlwZU9iamVjdCwgcHJvcGVydHlOYW1lLCB7XHJcbiAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldEZpZWxkVmFsdWUoc2NoZW1hRmllbGQpO1xyXG4gICAgICB9LFxyXG4gICAgICBzZXQ6IGZ1bmN0aW9uIChuZXdQcm9wVmFsdWUpIHtcclxuICAgICAgICAvLyDlgLznm7jlkIzml7bkuI3op6blj5Hlj5jmm7TjgIJcclxuICAgICAgICBjb25zdCBvbGRQcm9wVmFsdWUgPSB0aGlzLmdldEZpZWxkVmFsdWUoc2NoZW1hRmllbGQpO1xyXG4gICAgICAgIGlmICh0aGlzLmlzRmllbGRWYWx1ZUNoYW5nZWQoc2NoZW1hRmllbGQsIG5ld1Byb3BWYWx1ZSwgb2xkUHJvcFZhbHVlKSA9PT0gZmFsc2UpIHtcclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zZXRGaWVsZFZhbHVlKHNjaGVtYUZpZWxkLCBuZXdQcm9wVmFsdWUpO1xyXG4gICAgICAgIHRoaXMuZW1pdEZpZWxkVmFsdWVDaGFuZ2Uoc2NoZW1hRmllbGQsIG5ld1Byb3BWYWx1ZSwgb2xkUHJvcFZhbHVlKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICBjb25zdCBmaWVsZE1ldGFkYXRhID0ge1xyXG4gICAgICAvKiog5a2X5q615ZCN56ewICovXHJcbiAgICAgIGRhdGFGaWVsZDogdGhpcy5nZXREYXRhRmllbGQoc2NoZW1hRmllbGQpLFxyXG4gICAgICAvKiog5Y6f5aeL5a2X5q615ZCN56ewICovXHJcbiAgICAgIG9yaWdpbmFsRGF0YUZpZWxkOiBzY2hlbWFGaWVsZC5jb2RlLFxyXG4gICAgICAvKiog5Y6f5aeL5a2X5q6157G75Z6LICovXHJcbiAgICAgIG9yaWdpbmFsRGF0YUZpZWxkVHlwZTogc2NoZW1hRmllbGQudHlwZS5uYW1lLFxyXG4gICAgICAvKipcclxuICAgICAgICog5Y6f5aeL5a2X5q61XHJcbiAgICAgICAqIEBkZXNjcmlwdGlvbiDlr7nlupTliLBzY2hlbWXnmoRwYXRo5bGe5oCnXHJcbiAgICAgICAqL1xyXG4gICAgICBwYXRoOiBzY2hlbWFGaWVsZC5wYXRoLFxyXG4gICAgICBwcmltYXJ5OiBzY2hlbWFGaWVsZC5sYWJlbCA9PT0gcHJpbWFyeSxcclxuICAgICAgZW5hYmxlTXVsdGlMYW5nSW5wdXQ6IHRoaXMuZ2V0RW5hYmxlTXVsdGlMYW5nSW5wdXQoc2NoZW1hRmllbGQpLFxyXG4gICAgICBkZWZhdWx0VmFsdWU6IHNjaGVtYUZpZWxkLmRlZmF1bHRWYWx1ZSxcclxuICAgICAgbmdNZXRhZGF0YU5hbWU6IE5HX0ZJRUxEXHJcbiAgICB9O1xyXG4gICAgaWYgKHNjaGVtYUZpZWxkWydlbmFibGVTdGRUaW1lRm9ybWF0J10gJiYgZmllbGRNZXRhZGF0YS5vcmlnaW5hbERhdGFGaWVsZFR5cGUgPT0gXCJEYXRlVGltZVwiKSB7XHJcbiAgICAgIGZpZWxkTWV0YWRhdGFbXCJlbmFibGVUaW1lWm9uZVwiXSA9IHRydWU7XHJcbiAgICB9XHJcbiAgICBpZiAoZmllbGRNZXRhZGF0YS5wcmltYXJ5KSB7XHJcbiAgICAgIHByb3RvdHlwZU9iamVjdC5pbm5lclByaW1hcnlQcm9wZXJ0eSA9IGZpZWxkTWV0YWRhdGE7XHJcbiAgICB9XHJcbiAgICBpZiAoIXBhcmVudEVudGl0eVR5cGUuX19wcm9wX19tZXRhZGF0YV9fW3Byb3BlcnR5TmFtZV0pIHtcclxuICAgICAgcGFyZW50RW50aXR5VHlwZS5fX3Byb3BfX21ldGFkYXRhX19bcHJvcGVydHlOYW1lXSA9IFtdO1xyXG4gICAgfVxyXG4gICAgcGFyZW50RW50aXR5VHlwZS5fX3Byb3BfX21ldGFkYXRhX19bcHJvcGVydHlOYW1lXS5wdXNoKGZpZWxkTWV0YWRhdGEpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXREYXRhRmllbGQoc2NoZW1hRmllbGQ6IFNjaGVtYUVudGl0eUZpZWxkKSB7XHJcbiAgICBpZiAoc2NoZW1hRmllbGQubXVsdGlMYW5ndWFnZSkge1xyXG4gICAgICByZXR1cm4gc2NoZW1hRmllbGQubGFiZWwgKyBcIl9cIiArIFwiTVVMVElMQU5HVUFHRVwiO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHNjaGVtYUZpZWxkLmxhYmVsO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXRFbmFibGVNdWx0aUxhbmdJbnB1dChzY2hlbWFGaWVsZDogU2NoZW1hRW50aXR5RmllbGQpIHtcclxuICAgIGlmIChzY2hlbWFGaWVsZC5tdWx0aUxhbmd1YWdlKSB7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5ZCR5a6e5L2T57G75a6a5LmJ5aSN5p2C57G75Z6L5a2X5q61XHJcbiAgICogQHBhcmFtIHByb3RvdHlwZU9iamVjdCDlrp7kvZPnsbvljp/lnovlr7nosaFcclxuICAgKiBAcGFyYW0gc2NoZW1hRmllbGQg5a2X5q615o+P6L+wXHJcbiAgICogQHBhcmFtIHBhcmVudEVudGl0eVR5cGUg54i257G75Z6LXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBkZWZpbmVDb21wbGV4RmllbGRUb1Byb3RvdHlwZShwcm90b3R5cGVPYmplY3Q6IGFueSwgc2NoZW1hRmllbGQ6IFNjaGVtYUVudGl0eUZpZWxkLCBwYXJlbnRFbnRpdHlUeXBlOiBBYnN0cmFjdEVudGl0eVR5cGUpIHtcclxuICAgIGNvbnN0IGNvbXBsZXhGaWVsZFR5cGUgPSB0aGlzLmNyZWF0ZUNsYXNzKHNjaGVtYUZpZWxkLnR5cGUsIHNjaGVtYUZpZWxkKTtcclxuICAgIHBhcmVudEVudGl0eVR5cGUudHlwZXNbc2NoZW1hRmllbGQudHlwZS5uYW1lXSA9IGNvbXBsZXhGaWVsZFR5cGU7XHJcbiAgICBjb25zdCBwcm9wZXJ0eU5hbWUgPSBzY2hlbWFGaWVsZC5sYWJlbDtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm90b3R5cGVPYmplY3QsIHByb3BlcnR5TmFtZSwge1xyXG4gICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBjb25zdCBmaWVsZFZhbHVlID0gdGhpcy5nZXRDb21wbGV4RmllbGRWYWx1ZShzY2hlbWFGaWVsZCk7XHJcbiAgICAgICAgcmV0dXJuIGZpZWxkVmFsdWU7XHJcbiAgICAgIH0sXHJcbiAgICAgIHNldDogZnVuY3Rpb24gKHZhbHVlOiBhbnkpIHtcclxuICAgICAgICB0aGlzLnNldENvbXBsZXhGaWVsZFZhbHVlKHNjaGVtYUZpZWxkLCBjb21wbGV4RmllbGRUeXBlLCB2YWx1ZSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgY29uc3QgZmllbGRNZXRhZGF0YSA9IHtcclxuICAgICAgLyoqIOaYoOWwhOWtl+autSAqL1xyXG4gICAgICBkYXRhRmllbGQ6IHNjaGVtYUZpZWxkLmxhYmVsLFxyXG4gICAgICAvKiog5Y6f5aeL5a2X5q615ZCN56ewICovXHJcbiAgICAgIG9yaWdpbmFsRGF0YUZpZWxkOiBzY2hlbWFGaWVsZC5jb2RlLFxyXG4gICAgICAvKiog5byV55So5a6e5L2T57G75Z6LICovXHJcbiAgICAgIHR5cGU6IGNvbXBsZXhGaWVsZFR5cGUsXHJcbiAgICAgIC8qKlxyXG4gICAgICAgKiDljp/lp4vlrZfmrrVcclxuICAgICAgICogQGRlc2NyaXB0aW9uIOWvueW6lOWIsHNjaGVtZeeahHBhdGjlsZ7mgKdcclxuICAgICAgICovXHJcbiAgICAgIHBhdGg6IHNjaGVtYUZpZWxkLnBhdGgsXHJcbiAgICAgIG5nTWV0YWRhdGFOYW1lOiBOR19PQkpFQ1RcclxuICAgIH07XHJcbiAgICBpZiAoIXBhcmVudEVudGl0eVR5cGUuX19wcm9wX19tZXRhZGF0YV9fW3Byb3BlcnR5TmFtZV0pIHtcclxuICAgICAgcGFyZW50RW50aXR5VHlwZS5fX3Byb3BfX21ldGFkYXRhX19bcHJvcGVydHlOYW1lXSA9IFtdO1xyXG4gICAgfVxyXG4gICAgcGFyZW50RW50aXR5VHlwZS5fX3Byb3BfX21ldGFkYXRhX19bcHJvcGVydHlOYW1lXS5wdXNoKGZpZWxkTWV0YWRhdGEpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDlkJHlrp7kvZPnsbvlrprkuYnlrZDlrp7kvZNcclxuICAgKiBAcGFyYW0gcHJvdG90eXBlT2JqZWN0IOWunuS9k+exu+WOn+Wei+WvueixoVxyXG4gICAqIEBwYXJhbSBlbnRpdGllcyDlrp7kvZPmj4/ov7Dpm4blkIhcclxuICAgKiBAcGFyYW0gcGFyZW50RW50aXR5VHlwZSDniLbnsbvlnotcclxuICAgKi9cclxuICBwcml2YXRlIGRlZmluZUVudGl0aWVzVG9Qcm90b3R5cGUocHJvdG90eXBlT2JqZWN0OiBhbnksIGVudGl0aWVzOiBTY2hlbWFFbnRpdHlbXSwgcGFyZW50RW50aXR5VHlwZTogQWJzdHJhY3RFbnRpdHlUeXBlKSB7XHJcbiAgICBpZiAoZW50aXRpZXMgJiYgZW50aXRpZXMubGVuZ3RoKSB7XHJcbiAgICAgIC8vIOmBjeWOhlNjaGVtYeS4reaPj+i/sOeahOWtkOWunuS9k++8jOWcqOWunuS9k+WvueixoeS4iuWumuS5ieWtkOWunuS9k+WIl+ihqFxyXG4gICAgICBlbnRpdGllcy5mb3JFYWNoKHNjaGVtYUVudGl0eSA9PiB7XHJcbiAgICAgICAgY29uc3QgY29tcGxleEZpZWxkVHlwZSA9IHRoaXMuY3JlYXRlQ2xhc3Moc2NoZW1hRW50aXR5LnR5cGUsIHNjaGVtYUVudGl0eSk7XHJcbiAgICAgICAgcGFyZW50RW50aXR5VHlwZS50eXBlc1tzY2hlbWFFbnRpdHkudHlwZS5uYW1lXSA9IGNvbXBsZXhGaWVsZFR5cGU7XHJcbiAgICAgICAgLy8g5o+Q5Y+W5a2Q5a6e5L2T5Zyo5a6e5L2T5a+56LGh5LiK55qE5bGe5oCn5ZCNXHJcbiAgICAgICAgY29uc3QgcHJvcGVydHlOYW1lID0gc2NoZW1hRW50aXR5LmxhYmVsO1xyXG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm90b3R5cGVPYmplY3QsIHByb3BlcnR5TmFtZSwge1xyXG4gICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGZpZWxkVmFsdWUgPSB0aGlzLmdldEVudGl0aWVzKHNjaGVtYUVudGl0eSk7XHJcbiAgICAgICAgICAgIHJldHVybiBmaWVsZFZhbHVlO1xyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIHNldDogZnVuY3Rpb24gKHZhbHVlOiBhbnkpIHtcclxuICAgICAgICAgICAgdGhpcy5zZXRFbnRpdGllcyhzY2hlbWFFbnRpdHksIHZhbHVlKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICBjb25zdCBlbnRpdE1ldGFkYXRhID0ge1xyXG4gICAgICAgICAgLyoqIOWtl+auteWQjeensCAqL1xyXG4gICAgICAgICAgZGF0YUZpZWxkOiBzY2hlbWFFbnRpdHkubGFiZWwsXHJcbiAgICAgICAgICAvKiog5Y6f5aeL5a2X5q615ZCN56ewICovXHJcbiAgICAgICAgICBvcmlnaW5hbERhdGFGaWVsZDogJycsXHJcbiAgICAgICAgICAvKiog5a6e5L2T57G75Z6LICovXHJcbiAgICAgICAgICB0eXBlOiBjb21wbGV4RmllbGRUeXBlLFxyXG4gICAgICAgICAgbmdNZXRhZGF0YU5hbWU6IE5HX0xJU1RcclxuICAgICAgICB9O1xyXG4gICAgICAgIGlmICghcGFyZW50RW50aXR5VHlwZS5fX3Byb3BfX21ldGFkYXRhX19bcHJvcGVydHlOYW1lXSkge1xyXG4gICAgICAgICAgcGFyZW50RW50aXR5VHlwZS5fX3Byb3BfX21ldGFkYXRhX19bcHJvcGVydHlOYW1lXSA9IFtdO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwYXJlbnRFbnRpdHlUeXBlLl9fcHJvcF9fbWV0YWRhdGFfX1twcm9wZXJ0eU5hbWVdLnB1c2goZW50aXRNZXRhZGF0YSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuICAvKipcclxuICAgKiDliJvlu7rliJ3lp4vljJblrp7kvZPlr7nosaHmlrnms5VcclxuICAgKiBAcGFyYW0gc2NoZW1hVHlwZSDlrp7kvZPnsbvlnovmj4/ov7BcclxuICAgKiBAcmV0dXJucyDliJ3lp4vljJblrp7kvZPlr7nosaHmlrnms5VcclxuICAgKi9cclxuICBwcml2YXRlIGNyZWF0ZUVudGl0eUluc3RhbmNlRGF0YUluaXRpYWxpemVyKHNjaGVtYVR5cGU6IFNjaGVtYVR5cGUpIHtcclxuICAgIC8qKlxyXG4gICAgICog5a6e5L2T5Yid5aeL5YyW5Ye95pWw77yM55So5p2l5Yid5aeL5YyW5a6e5L2T55qE5aSN5p2C57G75Z6L5pWw5o2u5ZKM5a2Q5a6e5L2T5pWw5o2uXHJcbiAgICAgKiBAcGFyYW0gZW50aXR5SW5zdGFuY2Ug5a6e5L2T57G75Z6L5a6e5L6LXHJcbiAgICAgKiBAcGFyYW0gZGF0YSDlrp7kvZPljp/lp4vmlbDmja5cclxuICAgICAqIEBwYXJhbSBlbnRpdHlUeXBlQ29uc3RydWN0b3Ig5a6e5L2T57G75Z6L5p6E6YCg5Ye95pWwXHJcbiAgICAgKi9cclxuICAgIGNvbnN0IGluaXRpYWxpemVyID0gKGVudGl0eUluc3RhbmNlOiBhbnksIGVudGl0eURhdGE6IGFueSwgZW50aXR5VHlwZUNvbnN0cnVjdG9yOiBhbnkpID0+IHtcclxuICAgICAgLy8g5Yid5aeL5YyW5aSN5p2C57G75Z6L5a2X5q61XHJcbiAgICAgIHNjaGVtYVR5cGUuZmllbGRzXHJcbiAgICAgICAgLy8g6L+H5ruk5aSN5p2C57G75Z6L5a2X5q61XHJcbiAgICAgICAgLmZpbHRlcihmaWVsZCA9PiBmaWVsZC4kdHlwZSA9PT0gU2NoZW1hRW50aXR5RmllbGQkVHlwZS5Db21wbGV4RmllbGQpXHJcbiAgICAgICAgLy8g6YGN5Y6G5aSN5p2C57G75Z6L5a2X5q615Yib5bu65a+55bqU5a6e5L2T57G75Z6L5pWw5o2uXHJcbiAgICAgICAgLmZvckVhY2goZmllbGQgPT4ge1xyXG4gICAgICAgICAgLy8g5o+Q5Y+W5a2X5q615ZCNXHJcbiAgICAgICAgICBjb25zdCBmaWVsZE5hbWUgPSBmaWVsZC5sYWJlbDtcclxuICAgICAgICAgIC8vIOaPkOWPluWunuS9k+exu+Wei+S4i+eahOaJgOacieWtkOWunuS9k+exu+Wei1xyXG4gICAgICAgICAgY29uc3QgaW5jbHVkZWRFbnRpdHlUeXBlcyA9IGVudGl0eVR5cGVDb25zdHJ1Y3Rvci50eXBlcztcclxuICAgICAgICAgIC8vIOiOt+WPluWkjeadguexu+Wei+Wtl+auteWvueW6lOeahOWunuS9k+exu+Wei1xyXG4gICAgICAgICAgY29uc3QgQ29tcGxleEZpZWxkID0gaW5jbHVkZWRFbnRpdHlUeXBlc1tmaWVsZC50eXBlLm5hbWVdO1xyXG4gICAgICAgICAgLy8g5o+Q5Y+W5aSN5p2C57G75Z6L5a2X5q615Y6f5aeL5pWw5o2uXHJcbiAgICAgICAgICBjb25zdCBmaWVsZERhdGEgPSBlbnRpdHlEYXRhID8gZW50aXR5RGF0YVtmaWVsZE5hbWVdIDogbnVsbDtcclxuICAgICAgICAgIC8vIOWIm+W7uuWkjeadguexu+Wei+Wtl+auteWvueixoei3r+W+hFxyXG4gICAgICAgICAgY29uc3QgcGF0aCA9IGVudGl0eUluc3RhbmNlLmNyZWF0ZVBhdGgoZmllbGROYW1lKTtcclxuICAgICAgICAgIGxldCBjb21wbGV4RmllbGRWYWx1ZSA9IGVudGl0eUluc3RhbmNlW2ZpZWxkTmFtZV07XHJcbiAgICAgICAgICBpZiAoY29tcGxleEZpZWxkVmFsdWUgaW5zdGFuY2VvZiBDb21wbGV4RmllbGQpIHtcclxuICAgICAgICAgICAgY29tcGxleEZpZWxkVmFsdWUubG9hZChmaWVsZERhdGEpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8g5Yib5bu65aSN5p2C57G75Z6L5a2X5q615a6e5L2T5a6e5L6LXHJcbiAgICAgICAgICAgIGNvbXBsZXhGaWVsZFZhbHVlID0gbmV3IENvbXBsZXhGaWVsZChmaWVsZERhdGEpO1xyXG4gICAgICAgICAgICBjb21wbGV4RmllbGRWYWx1ZS5jb25zdHJ1Y3RvciA9IENvbXBsZXhGaWVsZDtcclxuICAgICAgICAgICAgY29tcGxleEZpZWxkVmFsdWVbUEFSRU5UX0NMQVNTXSA9IGVudGl0eVR5cGVDb25zdHJ1Y3RvcjtcclxuICAgICAgICAgICAgY29tcGxleEZpZWxkVmFsdWVbUEFSRU5UX1BBVEhdID0gcGF0aDtcclxuICAgICAgICAgICAgY29tcGxleEZpZWxkVmFsdWUub25WYWx1ZUNoYW5nZWQuc3Vic2NyaWJlKGNoYW5nZXMgPT4ge1xyXG4gICAgICAgICAgICAgIGlmIChjaGFuZ2VzKSB7XHJcbiAgICAgICAgICAgICAgICBjaGFuZ2VzLnBhdGggPSAoZW50aXR5SW5zdGFuY2VbUEFSRU5UX1BBVEhdIHx8IFtdKS5jb25jYXQoY2hhbmdlcy5wYXRoKTtcclxuICAgICAgICAgICAgICAgIGVudGl0eUluc3RhbmNlLnNldENoYW5nZXMoY2hhbmdlcyk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgZW50aXR5SW5zdGFuY2VbZmllbGROYW1lXSA9IGNvbXBsZXhGaWVsZFZhbHVlO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAvLyDliJ3lp4vljJblrZDlrp7kvZNcclxuICAgICAgaWYgKHNjaGVtYVR5cGUuZW50aXRpZXMpIHtcclxuICAgICAgICAvLyDpgY3ljoblrZDlrp7kvZPliJvlu7rlr7nlupTlrp7kvZPnsbvlnovnmoTmlbDmja5cclxuICAgICAgICBzY2hlbWFUeXBlLmVudGl0aWVzLmZvckVhY2goc2NoZW1hRW50aXR5ID0+IHtcclxuICAgICAgICAgIC8vIOaPkOWPluWtkOWunuS9k+WQjVxyXG4gICAgICAgICAgY29uc3Qgc3ViRW50aXR5TmFtZSA9IHNjaGVtYUVudGl0eS5sYWJlbDtcclxuICAgICAgICAgIC8vIOaPkOWPluWunuS9k+exu+Wei+S4i+eahOaJgOacieWtkOWunuS9k+exu+Wei1xyXG4gICAgICAgICAgY29uc3QgaW5jbHVkZWRFbnRpdHlUeXBlcyA9IGVudGl0eVR5cGVDb25zdHJ1Y3Rvci50eXBlcztcclxuICAgICAgICAgIC8vIOWIm+W7uuWtkOWunuS9k+Wvueixoei3r+W+hFxyXG4gICAgICAgICAgY29uc3QgcGF0aCA9IGVudGl0eUluc3RhbmNlLmNyZWF0ZVBhdGgoc3ViRW50aXR5TmFtZSk7XHJcbiAgICAgICAgICAvLyDliJvlu7rlrZDlrp7kvZPlr7nosaHpm4blkIhcclxuICAgICAgICAgIGxldCBlbnRpdHlMaXN0ID0gZW50aXR5SW5zdGFuY2Vbc3ViRW50aXR5TmFtZV07XHJcbiAgICAgICAgICBpZiAoIShlbnRpdHlMaXN0IGluc3RhbmNlb2YgRW50aXR5TGlzdCkpIHtcclxuICAgICAgICAgICAgZW50aXR5TGlzdCA9IG5ldyBFbnRpdHlMaXN0PEVudGl0eT4oKTtcclxuICAgICAgICAgICAgLy8g5ZCR5a2Q5a6e5L2T5YiX6KGo5rOo5YaM5a2Q5a6e5L2T5Y+Y5YyW5LqL5Lu2XHJcbiAgICAgICAgICAgIGVudGl0eUxpc3Qub25MaXN0Q2hhbmdlZC5zdWJzY3JpYmUodmFsdWUgPT4ge1xyXG4gICAgICAgICAgICAgIGlmICh2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGVudGl0eUxpc3RbUEFSRU5UX1BBVEhdWzBdICE9PSB2YWx1ZS5wYXRoWzBdKSB7XHJcbiAgICAgICAgICAgICAgICAgIHZhbHVlLnBhdGggPSBlbnRpdHlMaXN0W1BBUkVOVF9QQVRIXS5jb25jYXQodmFsdWUucGF0aCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbnRpdHlJbnN0YW5jZS5zZXRDaGFuZ2VzKHZhbHVlKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAvLyDlkJHlrp7kvZPnsbvlnovlrp7kvovkuIrnm7TmjqXlrZjlgqjlrZDlrp7kvZPlr7nosaHliJfooahcclxuICAgICAgICAgICAgZW50aXR5SW5zdGFuY2Vbc3ViRW50aXR5TmFtZV0gPSBlbnRpdHlMaXN0O1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgZW50aXR5TGlzdFtQQVJFTlRfQ0xBU1NdID0gZW50aXR5VHlwZUNvbnN0cnVjdG9yO1xyXG4gICAgICAgICAgZW50aXR5TGlzdFtQQVJFTlRfUEFUSF0gPSBwYXRoO1xyXG4gICAgICAgICAgLy8g5o+Q5Y+W5a2Q5a6e5L2T57G75Z6L5ZCN56ewXHJcbiAgICAgICAgICBjb25zdCBzY2hlbWFFbnRpdHlUeXBlTmFtZSA9IHNjaGVtYUVudGl0eS50eXBlLm5hbWU7XHJcbiAgICAgICAgICAvLyDojrflj5blrZDlrp7kvZPnsbvlnotcclxuICAgICAgICAgIGNvbnN0IENvbmNyZXRlRW50aXR5ID0gaW5jbHVkZWRFbnRpdHlUeXBlc1tzY2hlbWFFbnRpdHlUeXBlTmFtZV07XHJcbiAgICAgICAgICBjb25zdCBvcmlnaW5hbEVudGl0eURhdGFBcnJheSA9IGVudGl0eURhdGEgPyBlbnRpdHlEYXRhW3N1YkVudGl0eU5hbWVdIDogbnVsbDtcclxuICAgICAgICAgIC8vIOaehOmAoOWtkOWunuS9k+mbhuWQiFxyXG4gICAgICAgICAgaWYgKG9yaWdpbmFsRW50aXR5RGF0YUFycmF5KSB7XHJcbiAgICAgICAgICAgIC8vIOmBjeWOhuWtkOWunuS9k+WOn+Wni+aVsOaNru+8jOaehOmAoOWunuS9k+WvueixoembhuWQiFxyXG4gICAgICAgICAgICBjb25zdCBlbnRpdGllcyA9IG9yaWdpbmFsRW50aXR5RGF0YUFycmF5Lm1hcCgob3JpZ2luYWxFbnRpdHlEYXRhOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICBjb25zdCBjb25jcmV0ZUVudGl0eUluc3RhbmNlID0gbmV3IENvbmNyZXRlRW50aXR5KG9yaWdpbmFsRW50aXR5RGF0YSk7XHJcbiAgICAgICAgICAgICAgY29uY3JldGVFbnRpdHlJbnN0YW5jZS5jb25zdHJ1Y3RvciA9IENvbmNyZXRlRW50aXR5O1xyXG4gICAgICAgICAgICAgIHJldHVybiBjb25jcmV0ZUVudGl0eUluc3RhbmNlO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgLy8g5ZCR5a2Q5a6e5L2T5YiX6KGo5Lit5re75Yqg5a2Q5a6e5L2T5a+56LGhXHJcbiAgICAgICAgICAgIGVudGl0eUxpc3QubG9hZEVudGl0aWVzKGVudGl0aWVzKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgIHJldHVybiBpbml0aWFsaXplcjtcclxuICB9XHJcbn1cclxuIl19