import { Subject } from 'rxjs';
import { ChangeSet } from '../changeset';
import { SchemaEntityField$Type } from '../schema/schema';
import { EntityList } from './entity_list';
import { entityPrototype } from './entity_prototype';
import { NG_FIELD, NG_LIST, NG_OBJECT } from './metadata';
import { PARENT_CLASS, PARENT_PATH } from './types';
import { Validator } from './validator';
import { ValidationUtils } from './validator/validation_utils';
/**
 * 实体类型工厂
 * 用来根据实体Schema描述信息创建实体类型
 */
export class EntityTypeFactory {
    constructor() { }
    /**
     * 由实体Schema结构创建实体类型
     * @param schema 实体Schema结构
     * @returns 实体类型
     */
    create(schema) {
        // 提取Schema定义中的第一个是实体描述
        const schemaType = schema.entities[0].type;
        // 创建实体类型
        const entityType = this.createClass(schemaType);
        return entityType;
    }
    /**
     * 由实体Schema类型描述创建实体类
     * @param schemaType Schema实体类型描述
     * @returns 实体类型
     */
    createClass(schemaType) {
        const attachEntityInstanceData = this.createEntityInstanceDataInitializer(schemaType);
        // 创建指定实体类型的初始化函数，用来在实体类型构造函数中为实体实例赋值
        const initialize = (entityInstance, entityData, entityTypeConstructor) => {
            entityInstance.isInitializing = true;
            attachEntityInstanceData(entityInstance, entityData, entityTypeConstructor);
            entityInstance.isInitializing = false;
        };
        // 声明实体类构造函数
        const ConcreteEntity = function (data) {
            // 创建实体变更集
            this.changeSet = new ChangeSet();
            // 初始化实体验证状态
            this.isValidating = false;
            // 设置unsubscribe 取消订阅事件
            this.unsubscribe = new Subject();
            // 初始化实体验证信息
            this.validErrors = {};
            // 初始化验证器
            this.validator = new Validator();
            // 初始化实体数据副本
            this.innerData = Object.assign({}, data);
            // 初始化子实体对象集合
            this.innerEntities = {};
            // 初始化实体值变化事件
            this.valueChanged = new Subject();
            this.onValueChanged = this.valueChanged;
            this.validateFromUtilSync = function (propertyName, value, cb, context) {
                this.validErrors = {};
                const result = this.validator.verify(this, propertyName, value, null, undefined, context && context.frameContext || null, true);
                if (result && !result.isValid) {
                    this.validErrors = ValidationUtils.convertErrorsToNormalObject(result.errors, {});
                }
                cb(result);
            };
            // 调用初始化方法，初始化实体数据
            initialize(this, data, ConcreteEntity);
            this.load = (newData) => {
                attachEntityInstanceData(this, newData, ConcreteEntity);
            };
        };
        // 在实体类构造函数中记录视图类型名称
        ConcreteEntity.typeName = `${schemaType.name}Entity`;
        // 在实体类构造函数中记录其下直接引用的子类型
        ConcreteEntity.types = {};
        ConcreteEntity.__prop__metadata__ = {};
        // 构造实体类的原型对象
        const entityTypePrototype = Object.assign({ typeName: 'ConcreteEntityPrototype' }, entityPrototype);
        // 向实体类原型对象中定义预制属性
        this.definePresetProperty(entityTypePrototype, schemaType);
        // 向实体类原型对象中定义字段属性get/set方法
        this.defineFieldsToPrototype(entityTypePrototype, schemaType.fields, schemaType.primary, ConcreteEntity);
        // 向实体类原型对象中定义访问子实体的get/set方法
        this.defineEntitiesToPrototype(entityTypePrototype, schemaType.entities, ConcreteEntity);
        // 将实体类的原型对象指向新构造的原型对象。
        ConcreteEntity.prototype = entityTypePrototype;
        return ConcreteEntity;
    }
    /**
     * 向实体类原型对象中定义预制属性
     * @param prototypeObject 实体类原型对象
     * @param schemaType Schema类型描述
     */
    definePresetProperty(prototypeObject, schemaType) {
        /**
         * 实体数据
         */
        Object.defineProperty(prototypeObject, 'data', {
            get: function () {
                if (!this.innerData) {
                    this.innerData = {};
                }
                return this.innerData;
            },
            set: function (value) {
                this.innerData = value;
            }
        });
        /**
         * 实体验证信息
         */
        Object.defineProperty(prototypeObject, 'errors', {
            get: function () {
                return this.validErrors;
            },
            set: function (errors) {
                this.validErrors = errors;
            }
        });
        /**
         * 实体变更集
         */
        Object.defineProperty(prototypeObject, 'changes', {
            get: function () {
                return this.changeSet.changes;
            }
        });
        /**
         * 实体主键
         */
        Object.defineProperty(prototypeObject, 'primaryProperty', {
            // tslint:disable-next-line: only-arrow-functions
            get: function () {
                // return schemaType.primary;
                return prototypeObject.innerPrimaryProperty || { dataField: schemaType.primary };
            }
        });
        /**
         * 实体主键
         */
        Object.defineProperty(prototypeObject, 'primaryKey', {
            // tslint:disable-next-line: only-arrow-functions
            get: function () {
                return schemaType.primary || '';
            }
        });
        /**
         * 实体主键的值
         */
        Object.defineProperty(prototypeObject, 'primaryValue', {
            get: function () {
                if (this.primaryKey) {
                    // return this[this.primaryProperty.property].toString();
                    const primaryValue = this[this.primaryKey];
                    return primaryValue ? primaryValue : '';
                }
                else {
                    return '';
                }
            }
        });
    }
    /**
     * 向实体类定义字段属性
     * @param prototypeObject 实体类原型对象
     * @param fields 字段描述集合
     * @param parentEntityType 父类型
     */
    defineFieldsToPrototype(prototypeObject, fields, primary, parentEntityType) {
        if (fields && fields.length) {
            // 遍历Schema中描述的字段，在实体原型对象上定义字段访问函数
            fields.forEach(schemaEntityField => {
                switch (schemaEntityField.$type) {
                    // 定义简单类型字段
                    case SchemaEntityField$Type.SimpleField:
                        this.defineSimpleFieldToPrototype(prototypeObject, schemaEntityField, primary, parentEntityType);
                        break;
                    // 定义复杂类型字段
                    case SchemaEntityField$Type.ComplexField:
                        this.defineComplexFieldToPrototype(prototypeObject, schemaEntityField, parentEntityType);
                        break;
                }
            });
        }
    }
    /**
     * 向实体类定义简单类型字段
     * @param prototypeObject 实体类原型对象
     * @param schemaField 字段描述
     */
    defineSimpleFieldToPrototype(prototypeObject, schemaField, primary, parentEntityType) {
        const propertyName = schemaField.label;
        Object.defineProperty(prototypeObject, propertyName, {
            get: function () {
                return this.getFieldValue(schemaField);
            },
            set: function (newPropValue) {
                // 值相同时不触发变更。
                const oldPropValue = this.getFieldValue(schemaField);
                if (this.isFieldValueChanged(schemaField, newPropValue, oldPropValue) === false) {
                    return;
                }
                this.setFieldValue(schemaField, newPropValue);
                this.emitFieldValueChange(schemaField, newPropValue, oldPropValue);
            }
        });
        const fieldMetadata = {
            /** 字段名称 */
            dataField: schemaField.label,
            /** 原始字段名称 */
            originalDataField: schemaField.code,
            /** 原始字段类型 */
            originalDataFieldType: schemaField.type.name,
            /**
             * 原始字段
             * @description 对应到scheme的path属性
             */
            path: schemaField.path,
            primary: schemaField.label === primary,
            ngMetadataName: NG_FIELD
        };
        if (fieldMetadata.primary) {
            prototypeObject.innerPrimaryProperty = fieldMetadata;
        }
        if (!parentEntityType.__prop__metadata__[propertyName]) {
            parentEntityType.__prop__metadata__[propertyName] = [];
        }
        parentEntityType.__prop__metadata__[propertyName].push(fieldMetadata);
    }
    /**
     * 向实体类定义复杂类型字段
     * @param prototypeObject 实体类原型对象
     * @param schemaField 字段描述
     * @param parentEntityType 父类型
     */
    defineComplexFieldToPrototype(prototypeObject, schemaField, parentEntityType) {
        const complexFieldType = this.createClass(schemaField.type);
        parentEntityType.types[schemaField.type.name] = complexFieldType;
        const propertyName = schemaField.label;
        Object.defineProperty(prototypeObject, propertyName, {
            get: function () {
                const fieldValue = this.getComplexFieldValue(schemaField);
                return fieldValue;
            },
            set: function (value) {
                this.setComplexFieldValue(schemaField, complexFieldType, value);
            }
        });
        const fieldMetadata = {
            /** 映射字段 */
            dataField: schemaField.label,
            /** 原始字段名称 */
            originalDataField: schemaField.code,
            /** 引用实体类型 */
            type: complexFieldType,
            /**
             * 原始字段
             * @description 对应到scheme的path属性
             */
            path: schemaField.path,
            ngMetadataName: NG_OBJECT
        };
        if (!parentEntityType.__prop__metadata__[propertyName]) {
            parentEntityType.__prop__metadata__[propertyName] = [];
        }
        parentEntityType.__prop__metadata__[propertyName].push(fieldMetadata);
    }
    /**
     * 向实体类定义子实体
     * @param prototypeObject 实体类原型对象
     * @param entities 实体描述集合
     * @param parentEntityType 父类型
     */
    defineEntitiesToPrototype(prototypeObject, entities, parentEntityType) {
        if (entities && entities.length) {
            // 遍历Schema中描述的子实体，在实体对象上定义子实体列表
            entities.forEach(schemaEntity => {
                const complexFieldType = this.createClass(schemaEntity.type);
                parentEntityType.types[schemaEntity.type.name] = complexFieldType;
                // 提取子实体在实体对象上的属性名
                const propertyName = schemaEntity.label;
                Object.defineProperty(prototypeObject, propertyName, {
                    get: function () {
                        const fieldValue = this.getEntities(schemaEntity);
                        return fieldValue;
                    },
                    set: function (value) {
                        this.setEntities(schemaEntity, value);
                    }
                });
                const entitMetadata = {
                    /** 字段名称 */
                    dataField: schemaEntity.label,
                    /** 原始字段名称 */
                    originalDataField: '',
                    /** 实体类型 */
                    type: complexFieldType,
                    ngMetadataName: NG_LIST
                };
                if (!parentEntityType.__prop__metadata__[propertyName]) {
                    parentEntityType.__prop__metadata__[propertyName] = [];
                }
                parentEntityType.__prop__metadata__[propertyName].push(entitMetadata);
            });
        }
    }
    /**
     * 创建初始化实体对象方法
     * @param schemaType 实体类型描述
     * @returns 初始化实体对象方法
     */
    createEntityInstanceDataInitializer(schemaType) {
        /**
         * 实体初始化函数，用来初始化实体的复杂类型数据和子实体数据
         * @param entityInstance 实体类型实例
         * @param data 实体原始数据
         * @param entityTypeConstructor 实体类型构造函数
         */
        const initializer = (entityInstance, entityData, entityTypeConstructor) => {
            // 初始化复杂类型字段
            schemaType.fields
                // 过滤复杂类型字段
                .filter(field => field.$type === SchemaEntityField$Type.ComplexField)
                // 遍历复杂类型字段创建对应实体类型数据
                .forEach(field => {
                // 提取字段名
                const fieldName = field.label;
                // 提取实体类型下的所有子实体类型
                const includedEntityTypes = entityTypeConstructor.types;
                // 获取复杂类型字段对应的实体类型
                const ComplexField = includedEntityTypes[field.type.name];
                // 提取复杂类型字段原始数据
                const fieldData = entityData ? entityData[fieldName] : null;
                // 创建复杂类型字段对象路径
                const path = entityInstance.createPath(fieldName);
                let complexFieldValue = entityInstance[fieldName];
                if (complexFieldValue instanceof ComplexField) {
                    complexFieldValue.load(fieldData);
                }
                else {
                    // 创建复杂类型字段实体实例
                    complexFieldValue = new ComplexField(fieldData);
                    complexFieldValue.constructor = ComplexField;
                    complexFieldValue[PARENT_CLASS] = entityTypeConstructor;
                    complexFieldValue[PARENT_PATH] = path;
                    complexFieldValue.onValueChanged.subscribe(changes => {
                        if (changes) {
                            changes.path = (entityInstance[PARENT_PATH] || []).concat(changes.path);
                            entityInstance.setChanges(changes);
                        }
                    });
                    entityInstance[fieldName] = complexFieldValue;
                }
            });
            // 初始化子实体
            if (schemaType.entities) {
                // 遍历子实体创建对应实体类型的数据
                schemaType.entities.forEach(schemaEntity => {
                    // 提取子实体名
                    const subEntityName = schemaEntity.label;
                    // 提取实体类型下的所有子实体类型
                    const includedEntityTypes = entityTypeConstructor.types;
                    // 创建子实体对象路径
                    const path = entityInstance.createPath(subEntityName);
                    // 创建子实体对象集合
                    let entityList = entityInstance[subEntityName];
                    if (!(entityList instanceof EntityList)) {
                        entityList = new EntityList();
                        // 向子实体列表注册子实体变化事件
                        entityList.onListChanged.subscribe(value => {
                            if (value) {
                                if (entityList[PARENT_PATH][0] !== value.path[0]) {
                                    value.path = entityList[PARENT_PATH].concat(value.path);
                                }
                                entityInstance.setChanges(value);
                            }
                        });
                        // 向实体类型实例上直接存储子实体对象列表
                        entityInstance[subEntityName] = entityList;
                    }
                    entityList[PARENT_CLASS] = entityTypeConstructor;
                    entityList[PARENT_PATH] = path;
                    // 提取子实体类型名称
                    const schemaEntityTypeName = schemaEntity.type.name;
                    // 获取子实体类型
                    const ConcreteEntity = includedEntityTypes[schemaEntityTypeName];
                    const originalEntityDataArray = entityData ? entityData[subEntityName] : null;
                    // 构造子实体集合
                    if (originalEntityDataArray) {
                        // 遍历子实体原始数据，构造实体对象集合
                        const entities = originalEntityDataArray.map((originalEntityData) => {
                            const concreteEntityInstance = new ConcreteEntity(originalEntityData);
                            concreteEntityInstance.constructor = ConcreteEntity;
                            return concreteEntityInstance;
                        });
                        // 向子实体列表中添加子实体对象
                        entityList.loadEntities(entities);
                    }
                });
            }
        };
        return initializer;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW50aXR5X3R5cGVfZmFjdG9yeS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvZGV2a2l0LyIsInNvdXJjZXMiOlsibGliL2VudGl0eS9lbnRpdHlfdHlwZV9mYWN0b3J5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDL0IsT0FBTyxFQUFFLFNBQVMsRUFBZ0IsTUFBTSxjQUFjLENBQUM7QUFDdkQsT0FBTyxFQUEyQyxzQkFBc0IsRUFBYyxNQUFNLGtCQUFrQixDQUFDO0FBRS9HLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQ3JELE9BQU8sRUFBRSxRQUFRLEVBQUUsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLFlBQVksQ0FBQztBQUMxRCxPQUFPLEVBQUUsWUFBWSxFQUFFLFdBQVcsRUFBRSxNQUFNLFNBQVMsQ0FBQztBQUNwRCxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBQ3hDLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQVEvRDs7O0dBR0c7QUFDSCxNQUFNLE9BQU8saUJBQWlCO0lBRTVCLGdCQUFnQixDQUFDO0lBQ2pCOzs7O09BSUc7SUFDSSxNQUFNLENBQUMsTUFBYztRQUMxQix1QkFBdUI7UUFDdkIsTUFBTSxVQUFVLEdBQUcsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7UUFDM0MsU0FBUztRQUNULE1BQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDaEQsT0FBTyxVQUFVLENBQUM7SUFDcEIsQ0FBQztJQUNEOzs7O09BSUc7SUFDSyxXQUFXLENBQUMsVUFBc0I7UUFDeEMsTUFBTSx3QkFBd0IsR0FBRyxJQUFJLENBQUMsbUNBQW1DLENB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VUFBVSxDQUFDLFlBQVksQ0FBQyxHQUFHLHFCQUFxQixDQUFDO29CQUNqRCxVQUFVLENBQUMsV0FBVyxDQUFDLEdBQUcsSUFBSSxDQUFDO29CQUMvQixZQUFZO29CQUNaLE1BQU0sb0JBQW9CLEdBQUcsWUFBWSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUM7b0JBQ3BELFVBQVU7b0JBQ1YsTUFBTSxjQUFjLEdBQUcsbUJBQW1CLENBQUMsb0JBQW9CLENBQUMsQ0FBQztvQkFDakUsTUFBTSx1QkFBdUIsR0FBRyxVQUFVLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO29CQUM5RSxVQUFVO29CQUNWLElBQUksdUJBQXVCLEVBQUU7d0JBQzNCLHFCQUFxQjt3QkFDckIsTUFBTSxRQUFRLEdBQUcsdUJBQXVCLENBQUMsR0FBRyxDQUFDLENBQUMsa0JBQXVCLEVBQUUsRUFBRTs0QkFDdkUsTUFBTSxzQkFBc0IsR0FBRyxJQUFJLGNBQWMsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDOzRCQUN0RSxzQkFBc0IsQ0FBQyxXQUFXLEdBQUcsY0FBYyxDQUFDOzRCQUNwRCxPQUFPLHNCQUFzQixDQUFDO3dCQUNoQyxDQUFDLENBQUMsQ0FBQzt3QkFDSCxpQkFBaUI7d0JBQ2pCLFVBQVUsQ0FBQyxZQUFZLENBQUMsUUFBUSxDQUFDLENBQUM7cUJBQ25DO2dCQUNILENBQUMsQ0FBQyxDQUFDO2FBQ0o7UUFDSCxDQUFDLENBQUM7UUFDRixPQUFPLFdBQVcsQ0FBQztJQUNyQixDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IENoYW5nZVNldCwgTW9kaWZpY2F0aW9uIH0gZnJvbSAnLi4vY2hhbmdlc2V0JztcclxuaW1wb3J0IHsgU2NoZW1hLCBTY2hlbWFFbnRpdHksIFNjaGVtYUVudGl0eUZpZWxkLCBTY2hlbWFFbnRpdHlGaWVsZCRUeXBlLCBTY2hlbWFUeXBlIH0gZnJvbSAnLi4vc2NoZW1hL3NjaGVtYSc7XHJcbmltcG9ydCB7IEVudGl0eSB9IGZyb20gJy4vZW50aXR5JztcclxuaW1wb3J0IHsgRW50aXR5TGlzdCB9IGZyb20gJy4vZW50aXR5X2xpc3QnO1xyXG5pbXBvcnQgeyBlbnRpdHlQcm90b3R5cGUgfSBmcm9tICcuL2VudGl0eV9wcm90b3R5cGUnO1xyXG5pbXBvcnQgeyBOR19GSUVMRCwgTkdfTElTVCwgTkdfT0JKRUNUIH0gZnJvbSAnLi9tZXRhZGF0YSc7XHJcbmltcG9ydCB7IFBBUkVOVF9DTEFTUywgUEFSRU5UX1BBVEggfSBmcm9tICcuL3R5cGVzJztcclxuaW1wb3J0IHsgVmFsaWRhdG9yIH0gZnJvbSAnLi92YWxpZGF0b3InO1xyXG5pbXBvcnQgeyBWYWxpZGF0aW9uVXRpbHMgfSBmcm9tICcuL3ZhbGlkYXRvci92YWxpZGF0aW9uX3V0aWxzJztcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgQWJzdHJhY3RFbnRpdHlUeXBlIHtcclxuICB0eXBlTmFtZTogc3RyaW5nO1xyXG4gIHR5cGVzOiBhbnk7XHJcbiAgX19wcm9wX19tZXRhZGF0YV9fOiBhbnk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiDlrp7kvZPnsbvlnovlt6XljoJcclxuICog55So5p2l5qC55o2u5a6e5L2TU2NoZW1h5o+P6L+w5L+h5oGv5Yib5bu65a6e5L2T57G75Z6LXHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgRW50aXR5VHlwZUZhY3Rvcnkge1xyXG5cclxuICBjb25zdHJ1Y3RvcigpIHsgfVxyXG4gIC8qKlxyXG4gICAqIOeUseWunuS9k1NjaGVtYee7k+aehOWIm+W7uuWunuS9k+exu+Wei1xyXG4gICAqIEBwYXJhbSBzY2hlbWEg5a6e5L2TU2NoZW1h57uT5p6EXHJcbiAgICogQHJldHVybnMg5a6e5L2T57G75Z6LXHJcbiAgICovXHJcbiAgcHVibGljIGNyZWF0ZShzY2hlbWE6IFNjaGVtYSkge1xyXG4gICAgLy8g5o+Q5Y+WU2NoZW1h5a6a5LmJ5Lit55qE56ys5LiA5Liq5piv5a6e5L2T5o+P6L+wXHJcbiAgICBjb25zdCBzY2hlbWFUeXBlID0gc2NoZW1hLmVudGl0aWVzWzBdLnR5cGU7XHJcbiAgICAvLyDliJvlu7rlrp7kvZPnsbvlnotcclxuICAgIGNvbnN0IGVudGl0eVR5cGUgPSB0aGlzLmNyZWF0ZUNsYXNzKHNjaGVtYVR5cGUpO1xyXG4gICAgcmV0dXJuIGVudGl0eVR5cGU7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOeUseWunuS9k1NjaGVtYeexu+Wei+aPj+i/sOWIm+W7uuWunuS9k+exu1xyXG4gICAqIEBwYXJhbSBzY2hlbWFUeXBlIFNjaGVtYeWunuS9k+exu+Wei+aPj+i/sFxyXG4gICAqIEByZXR1cm5zIOWunuS9k+exu+Wei1xyXG4gICAqL1xyXG4gIHByaXZhdGUgY3JlYXRlQ2xhc3Moc2NoZW1hVHlwZTogU2NoZW1hVHlwZSkge1xyXG4gICAgY29uc3QgYXR0YWNoRW50aXR5SW5zdGFuY2VEYXRhID0gdGhpcy5jcmVhdGVFbnRpdHlJbnN0YW5jZURhdGFJbml0aWFsaXplcihzY2hlbWFUeXBlKTtcclxuICAgIC8vIOWIm+W7uuaMh+WumuWunuS9k+exu+Wei+eahOWIneWni+WMluWHveaVsO+8jOeUqOadpeWcqOWunuS9k+exu+Wei+aehOmAoOWHveaVsOS4reS4uuWunuS9k+WunuS+i+i1i+WAvFxyXG4gICAgY29uc3QgaW5pdGlhbGl6ZSA9IChlbnRpdHlJbnN0YW5jZTogYW55LCBlbnRpdHlEYXRhOiBhbnksIGVudGl0eVR5cGVDb25zdHJ1Y3RvcjogYW55KSA9PiB7XHJcbiAgICAgIGVudGl0eUluc3RhbmNlLmlzSW5pdGlhbGl6aW5nID0gdHJ1ZTtcclxuICAgICAgYXR0YWNoRW50aXR5SW5zdGFuY2VEYXRhKGVudGl0eUluc3RhbmNlLCBlbnRpdHlEYXRhLCBlbnRpdHlUeXBlQ29uc3RydWN0b3IpO1xyXG4gICAgICBlbnRpdHlJbnN0YW5jZS5pc0luaXRpYWxpemluZyA9IGZhbHNlO1xyXG4gICAgfTtcclxuICAgIC8vIOWjsOaYjuWunuS9k+exu+aehOmAoOWHveaVsFxyXG4gICAgY29uc3QgQ29uY3JldGVFbnRpdHkgPSBmdW5jdGlvbiAoZGF0YTogYW55KSB7XHJcbiAgICAgIC8vIOWIm+W7uuWunuS9k+WPmOabtOmbhlxyXG4gICAgICB0aGlzLmNoYW5nZVNldCA9IG5ldyBDaGFuZ2VTZXQoKTtcclxuICAgICAgLy8g5Yid5aeL5YyW5a6e5L2T6aqM6K+B54q25oCBXHJcbiAgICAgIHRoaXMuaXNWYWxpZGF0aW5nID0gZmFsc2U7XHJcbiAgICAgIC8vIOiuvue9rnVuc3Vic2NyaWJlIOWPlua2iOiuoumYheS6i+S7tlxyXG4gICAgICB0aGlzLnVuc3Vic2NyaWJlID0gbmV3IFN1YmplY3QoKTtcclxuICAgICAgLy8g5Yid5aeL5YyW5a6e5L2T6aqM6K+B5L+h5oGvXHJcbiAgICAgIHRoaXMudmFsaWRFcnJvcnMgPSB7fTtcclxuICAgICAgLy8g5Yid5aeL5YyW6aqM6K+B5ZmoXHJcbiAgICAgIHRoaXMudmFsaWRhdG9yID0gbmV3IFZhbGlkYXRvcigpO1xyXG4gICAgICAvLyDliJ3lp4vljJblrp7kvZPmlbDmja7lia/mnKxcclxuICAgICAgdGhpcy5pbm5lckRhdGEgPSBPYmplY3QuYXNzaWduKHt9LCBkYXRhKTtcclxuICAgICAgLy8g5Yid5aeL5YyW5a2Q5a6e5L2T5a+56LGh6ZuG5ZCIXHJcbiAgICAgIHRoaXMuaW5uZXJFbnRpdGllcyA9IHt9O1xyXG4gICAgICAvLyDliJ3lp4vljJblrp7kvZPlgLzlj5jljJbkuovku7ZcclxuICAgICAgdGhpcy52YWx1ZUNoYW5nZWQgPSBuZXcgU3ViamVjdDxNb2RpZmljYXRpb24+KCk7XHJcbiAgICAgIHRoaXMub25WYWx1ZUNoYW5nZWQgPSB0aGlzLnZhbHVlQ2hhbmdlZDtcclxuICAgICAgdGhpcy52YWxpZGF0ZUZyb21VdGlsU3luYyA9IGZ1bmN0aW9uIChwcm9wZXJ0eU5hbWUsIHZhbHVlLCBjYiwgY29udGV4dCkge1xyXG4gICAgICAgIHRoaXMudmFsaWRFcnJvcnMgPSB7fTtcclxuICAgICAgICBjb25zdCByZXN1bHQgPSB0aGlzLnZhbGlkYXRvci52ZXJpZnkodGhpcywgcHJvcGVydHlOYW1lLCB2YWx1ZSwgbnVsbCwgdW5kZWZpbmVkLCBjb250ZXh0ICYmIGNvbnRleHQuZnJhbWVDb250ZXh0IHx8IG51bGwsIHRydWUpO1xyXG4gICAgICAgIGlmIChyZXN1bHQgJiYgIXJlc3VsdC5pc1ZhbGlkKSB7XHJcbiAgICAgICAgICB0aGlzLnZhbGlkRXJyb3JzID0gVmFsaWRhdGlvblV0aWxzLmNvbnZlcnRFcnJvcnNUb05vcm1hbE9iamVjdChyZXN1bHQuZXJyb3JzLCB7fSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNiKHJlc3VsdCk7XHJcbiAgICAgIH07XHJcbiAgICAgIC8vIOiwg+eUqOWIneWni+WMluaWueazle+8jOWIneWni+WMluWunuS9k+aVsOaNrlxyXG4gICAgICBpbml0aWFsaXplKHRoaXMsIGRhdGEsIENvbmNyZXRlRW50aXR5KTtcclxuICAgICAgdGhpcy5sb2FkID0gKG5ld0RhdGE6IGFueSkgPT4ge1xyXG4gICAgICAgIGF0dGFjaEVudGl0eUluc3RhbmNlRGF0YSh0aGlzLCBuZXdEYXRhLCBDb25jcmV0ZUVudGl0eSk7XHJcbiAgICAgIH07XHJcbiAgICB9O1xyXG4gICAgLy8g5Zyo5a6e5L2T57G75p6E6YCg5Ye95pWw5Lit6K6w5b2V6KeG5Zu+57G75Z6L5ZCN56ewXHJcbiAgICBDb25jcmV0ZUVudGl0eS50eXBlTmFtZSA9IGAke3NjaGVtYVR5cGUubmFtZX1FbnRpdHlgO1xyXG4gICAgLy8g5Zyo5a6e5L2T57G75p6E6YCg5Ye95pWw5Lit6K6w5b2V5YW25LiL55u05o6l5byV55So55qE5a2Q57G75Z6LXHJcbiAgICBDb25jcmV0ZUVudGl0eS50eXBlcyA9IHt9O1xyXG4gICAgQ29uY3JldGVFbnRpdHkuX19wcm9wX19tZXRhZGF0YV9fID0ge307XHJcblxyXG4gICAgLy8g5p6E6YCg5a6e5L2T57G755qE5Y6f5Z6L5a+56LGhXHJcbiAgICBjb25zdCBlbnRpdHlUeXBlUHJvdG90eXBlID0gT2JqZWN0LmFzc2lnbih7IHR5cGVOYW1lOiAnQ29uY3JldGVFbnRpdHlQcm90b3R5cGUnIH0sIGVudGl0eVByb3RvdHlwZSk7XHJcbiAgICAvLyDlkJHlrp7kvZPnsbvljp/lnovlr7nosaHkuK3lrprkuYnpooTliLblsZ7mgKdcclxuICAgIHRoaXMuZGVmaW5lUHJlc2V0UHJvcGVydHkoZW50aXR5VHlwZVByb3RvdHlwZSwgc2NoZW1hVHlwZSk7XHJcbiAgICAvLyDlkJHlrp7kvZPnsbvljp/lnovlr7nosaHkuK3lrprkuYnlrZfmrrXlsZ7mgKdnZXQvc2V05pa55rOVXHJcbiAgICB0aGlzLmRlZmluZUZpZWxkc1RvUHJvdG90eXBlKGVudGl0eVR5cGVQcm90b3R5cGUsIHNjaGVtYVR5cGUuZmllbGRzLCBzY2hlbWFUeXBlLnByaW1hcnksIENvbmNyZXRlRW50aXR5KTtcclxuICAgIC8vIOWQkeWunuS9k+exu+WOn+Wei+WvueixoeS4reWumuS5ieiuv+mXruWtkOWunuS9k+eahGdldC9zZXTmlrnms5VcclxuICAgIHRoaXMuZGVmaW5lRW50aXRpZXNUb1Byb3RvdHlwZShlbnRpdHlUeXBlUHJvdG90eXBlLCBzY2hlbWFUeXBlLmVudGl0aWVzLCBDb25jcmV0ZUVudGl0eSk7XHJcbiAgICAvLyDlsIblrp7kvZPnsbvnmoTljp/lnovlr7nosaHmjIflkJHmlrDmnoTpgKDnmoTljp/lnovlr7nosaHjgIJcclxuICAgIENvbmNyZXRlRW50aXR5LnByb3RvdHlwZSA9IGVudGl0eVR5cGVQcm90b3R5cGU7XHJcblxyXG5cclxuXHJcbiAgICByZXR1cm4gQ29uY3JldGVFbnRpdHk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWQkeWunuS9k+exu+WOn+Wei+WvueixoeS4reWumuS5iemihOWItuWxnuaAp1xyXG4gICAqIEBwYXJhbSBwcm90b3R5cGVPYmplY3Qg5a6e5L2T57G75Y6f5Z6L5a+56LGhXHJcbiAgICogQHBhcmFtIHNjaGVtYVR5cGUgU2NoZW1h57G75Z6L5o+P6L+wXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBkZWZpbmVQcmVzZXRQcm9wZXJ0eShwcm90b3R5cGVPYmplY3Q6IGFueSwgc2NoZW1hVHlwZTogU2NoZW1hVHlwZSkge1xyXG4gICAgLyoqXHJcbiAgICAgKiDlrp7kvZPmlbDmja5cclxuICAgICAqL1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHByb3RvdHlwZU9iamVjdCwgJ2RhdGEnLCB7XHJcbiAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICghdGhpcy5pbm5lckRhdGEpIHtcclxuICAgICAgICAgIHRoaXMuaW5uZXJEYXRhID0ge307XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLmlubmVyRGF0YTtcclxuICAgICAgfSxcclxuICAgICAgc2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcclxuICAgICAgICB0aGlzLmlubmVyRGF0YSA9IHZhbHVlO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIC8qKlxyXG4gICAgICog5a6e5L2T6aqM6K+B5L+h5oGvXHJcbiAgICAgKi9cclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm90b3R5cGVPYmplY3QsICdlcnJvcnMnLCB7XHJcbiAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnZhbGlkRXJyb3JzO1xyXG4gICAgICB9LFxyXG4gICAgICBzZXQ6IGZ1bmN0aW9uIChlcnJvcnM6IGFueSkge1xyXG4gICAgICAgIHRoaXMudmFsaWRFcnJvcnMgPSBlcnJvcnM7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgLyoqXHJcbiAgICAgKiDlrp7kvZPlj5jmm7Tpm4ZcclxuICAgICAqL1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHByb3RvdHlwZU9iamVjdCwgJ2NoYW5nZXMnLCB7XHJcbiAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNoYW5nZVNldC5jaGFuZ2VzO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIC8qKlxyXG4gICAgICog5a6e5L2T5Li76ZSuXHJcbiAgICAgKi9cclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm90b3R5cGVPYmplY3QsICdwcmltYXJ5UHJvcGVydHknLCB7XHJcbiAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogb25seS1hcnJvdy1mdW5jdGlvbnNcclxuICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgLy8gcmV0dXJuIHNjaGVtYVR5cGUucHJpbWFyeTtcclxuICAgICAgICByZXR1cm4gcHJvdG90eXBlT2JqZWN0LmlubmVyUHJpbWFyeVByb3BlcnR5IHx8IHsgZGF0YUZpZWxkOiBzY2hlbWFUeXBlLnByaW1hcnkgfTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICAvKipcclxuICAgICAqIOWunuS9k+S4u+mUrlxyXG4gICAgICovXHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocHJvdG90eXBlT2JqZWN0LCAncHJpbWFyeUtleScsIHtcclxuICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBvbmx5LWFycm93LWZ1bmN0aW9uc1xyXG4gICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gc2NoZW1hVHlwZS5wcmltYXJ5IHx8ICcnO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIC8qKlxyXG4gICAgICog5a6e5L2T5Li76ZSu55qE5YC8XHJcbiAgICAgKi9cclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm90b3R5cGVPYmplY3QsICdwcmltYXJ5VmFsdWUnLCB7XHJcbiAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICh0aGlzLnByaW1hcnlLZXkpIHtcclxuICAgICAgICAgIC8vIHJldHVybiB0aGlzW3RoaXMucHJpbWFyeVByb3BlcnR5LnByb3BlcnR5XS50b1N0cmluZygpO1xyXG4gICAgICAgICAgY29uc3QgcHJpbWFyeVZhbHVlID0gdGhpc1t0aGlzLnByaW1hcnlLZXldO1xyXG4gICAgICAgICAgcmV0dXJuIHByaW1hcnlWYWx1ZSA/IHByaW1hcnlWYWx1ZSA6ICcnO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByZXR1cm4gJyc7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5ZCR5a6e5L2T57G75a6a5LmJ5a2X5q615bGe5oCnXHJcbiAgICogQHBhcmFtIHByb3RvdHlwZU9iamVjdCDlrp7kvZPnsbvljp/lnovlr7nosaFcclxuICAgKiBAcGFyYW0gZmllbGRzIOWtl+auteaPj+i/sOmbhuWQiFxyXG4gICAqIEBwYXJhbSBwYXJlbnRFbnRpdHlUeXBlIOeItuexu+Wei1xyXG4gICAqL1xyXG4gIHByaXZhdGUgZGVmaW5lRmllbGRzVG9Qcm90b3R5cGUoXHJcbiAgICBwcm90b3R5cGVPYmplY3Q6IGFueSxcclxuICAgIGZpZWxkczogU2NoZW1hRW50aXR5RmllbGRbXSxcclxuICAgIHByaW1hcnk6IHN0cmluZyxcclxuICAgIHBhcmVudEVudGl0eVR5cGU6IEFic3RyYWN0RW50aXR5VHlwZVxyXG4gICk6IHZvaWQge1xyXG4gICAgaWYgKGZpZWxkcyAmJiBmaWVsZHMubGVuZ3RoKSB7XHJcbiAgICAgIC8vIOmBjeWOhlNjaGVtYeS4reaPj+i/sOeahOWtl+aute+8jOWcqOWunuS9k+WOn+Wei+WvueixoeS4iuWumuS5ieWtl+auteiuv+mXruWHveaVsFxyXG4gICAgICBmaWVsZHMuZm9yRWFjaChzY2hlbWFFbnRpdHlGaWVsZCA9PiB7XHJcbiAgICAgICAgc3dpdGNoIChzY2hlbWFFbnRpdHlGaWVsZC4kdHlwZSkge1xyXG4gICAgICAgICAgLy8g5a6a5LmJ566A5Y2V57G75Z6L5a2X5q61XHJcbiAgICAgICAgICBjYXNlIFNjaGVtYUVudGl0eUZpZWxkJFR5cGUuU2ltcGxlRmllbGQ6XHJcbiAgICAgICAgICAgIHRoaXMuZGVmaW5lU2ltcGxlRmllbGRUb1Byb3RvdHlwZShwcm90b3R5cGVPYmplY3QsIHNjaGVtYUVudGl0eUZpZWxkLCBwcmltYXJ5LCBwYXJlbnRFbnRpdHlUeXBlKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAvLyDlrprkuYnlpI3mnYLnsbvlnovlrZfmrrVcclxuICAgICAgICAgIGNhc2UgU2NoZW1hRW50aXR5RmllbGQkVHlwZS5Db21wbGV4RmllbGQ6XHJcbiAgICAgICAgICAgIHRoaXMuZGVmaW5lQ29tcGxleEZpZWxkVG9Qcm90b3R5cGUocHJvdG90eXBlT2JqZWN0LCBzY2hlbWFFbnRpdHlGaWVsZCwgcGFyZW50RW50aXR5VHlwZSk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWQkeWunuS9k+exu+WumuS5ieeugOWNleexu+Wei+Wtl+autVxyXG4gICAqIEBwYXJhbSBwcm90b3R5cGVPYmplY3Qg5a6e5L2T57G75Y6f5Z6L5a+56LGhXHJcbiAgICogQHBhcmFtIHNjaGVtYUZpZWxkIOWtl+auteaPj+i/sFxyXG4gICAqL1xyXG4gIHByaXZhdGUgZGVmaW5lU2ltcGxlRmllbGRUb1Byb3RvdHlwZShcclxuICAgIHByb3RvdHlwZU9iamVjdDogYW55LFxyXG4gICAgc2NoZW1hRmllbGQ6IFNjaGVtYUVudGl0eUZpZWxkLFxyXG4gICAgcHJpbWFyeTogc3RyaW5nLFxyXG4gICAgcGFyZW50RW50aXR5VHlwZTogQWJzdHJhY3RFbnRpdHlUeXBlXHJcbiAgKSB7XHJcbiAgICBjb25zdCBwcm9wZXJ0eU5hbWUgPSBzY2hlbWFGaWVsZC5sYWJlbDtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm90b3R5cGVPYmplY3QsIHByb3BlcnR5TmFtZSwge1xyXG4gICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXRGaWVsZFZhbHVlKHNjaGVtYUZpZWxkKTtcclxuICAgICAgfSxcclxuICAgICAgc2V0OiBmdW5jdGlvbiAobmV3UHJvcFZhbHVlKSB7XHJcbiAgICAgICAgLy8g5YC855u45ZCM5pe25LiN6Kem5Y+R5Y+Y5pu044CCXHJcbiAgICAgICAgY29uc3Qgb2xkUHJvcFZhbHVlID0gdGhpcy5nZXRGaWVsZFZhbHVlKHNjaGVtYUZpZWxkKTtcclxuICAgICAgICBpZiAodGhpcy5pc0ZpZWxkVmFsdWVDaGFuZ2VkKHNjaGVtYUZpZWxkLCBuZXdQcm9wVmFsdWUsIG9sZFByb3BWYWx1ZSkgPT09IGZhbHNlKSB7XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuc2V0RmllbGRWYWx1ZShzY2hlbWFGaWVsZCwgbmV3UHJvcFZhbHVlKTtcclxuICAgICAgICB0aGlzLmVtaXRGaWVsZFZhbHVlQ2hhbmdlKHNjaGVtYUZpZWxkLCBuZXdQcm9wVmFsdWUsIG9sZFByb3BWYWx1ZSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgY29uc3QgZmllbGRNZXRhZGF0YSA9IHtcclxuICAgICAgLyoqIOWtl+auteWQjeensCAqL1xyXG4gICAgICBkYXRhRmllbGQ6IHNjaGVtYUZpZWxkLmxhYmVsLFxyXG4gICAgICAvKiog5Y6f5aeL5a2X5q615ZCN56ewICovXHJcbiAgICAgIG9yaWdpbmFsRGF0YUZpZWxkOiBzY2hlbWFGaWVsZC5jb2RlLFxyXG4gICAgICAvKiog5Y6f5aeL5a2X5q6157G75Z6LICovXHJcbiAgICAgIG9yaWdpbmFsRGF0YUZpZWxkVHlwZTogc2NoZW1hRmllbGQudHlwZS5uYW1lLFxyXG4gICAgICAvKipcclxuICAgICAgICog5Y6f5aeL5a2X5q61XHJcbiAgICAgICAqIEBkZXNjcmlwdGlvbiDlr7nlupTliLBzY2hlbWXnmoRwYXRo5bGe5oCnXHJcbiAgICAgICAqL1xyXG4gICAgICBwYXRoOiBzY2hlbWFGaWVsZC5wYXRoLFxyXG4gICAgICBwcmltYXJ5OiBzY2hlbWFGaWVsZC5sYWJlbCA9PT0gcHJpbWFyeSxcclxuICAgICAgbmdNZXRhZGF0YU5hbWU6IE5HX0ZJRUxEXHJcbiAgICB9O1xyXG4gICAgaWYgKGZpZWxkTWV0YWRhdGEucHJpbWFyeSkge1xyXG4gICAgICBwcm90b3R5cGVPYmplY3QuaW5uZXJQcmltYXJ5UHJvcGVydHkgPSBmaWVsZE1ldGFkYXRhO1xyXG4gICAgfVxyXG4gICAgaWYgKCFwYXJlbnRFbnRpdHlUeXBlLl9fcHJvcF9fbWV0YWRhdGFfX1twcm9wZXJ0eU5hbWVdKSB7XHJcbiAgICAgIHBhcmVudEVudGl0eVR5cGUuX19wcm9wX19tZXRhZGF0YV9fW3Byb3BlcnR5TmFtZV0gPSBbXTtcclxuICAgIH1cclxuICAgIHBhcmVudEVudGl0eVR5cGUuX19wcm9wX19tZXRhZGF0YV9fW3Byb3BlcnR5TmFtZV0ucHVzaChmaWVsZE1ldGFkYXRhKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5ZCR5a6e5L2T57G75a6a5LmJ5aSN5p2C57G75Z6L5a2X5q61XHJcbiAgICogQHBhcmFtIHByb3RvdHlwZU9iamVjdCDlrp7kvZPnsbvljp/lnovlr7nosaFcclxuICAgKiBAcGFyYW0gc2NoZW1hRmllbGQg5a2X5q615o+P6L+wXHJcbiAgICogQHBhcmFtIHBhcmVudEVudGl0eVR5cGUg54i257G75Z6LXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBkZWZpbmVDb21wbGV4RmllbGRUb1Byb3RvdHlwZShwcm90b3R5cGVPYmplY3Q6IGFueSwgc2NoZW1hRmllbGQ6IFNjaGVtYUVudGl0eUZpZWxkLCBwYXJlbnRFbnRpdHlUeXBlOiBBYnN0cmFjdEVudGl0eVR5cGUpIHtcclxuICAgIGNvbnN0IGNvbXBsZXhGaWVsZFR5cGUgPSB0aGlzLmNyZWF0ZUNsYXNzKHNjaGVtYUZpZWxkLnR5cGUpO1xyXG4gICAgcGFyZW50RW50aXR5VHlwZS50eXBlc1tzY2hlbWFGaWVsZC50eXBlLm5hbWVdID0gY29tcGxleEZpZWxkVHlwZTtcclxuICAgIGNvbnN0IHByb3BlcnR5TmFtZSA9IHNjaGVtYUZpZWxkLmxhYmVsO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHByb3RvdHlwZU9iamVjdCwgcHJvcGVydHlOYW1lLCB7XHJcbiAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGNvbnN0IGZpZWxkVmFsdWUgPSB0aGlzLmdldENvbXBsZXhGaWVsZFZhbHVlKHNjaGVtYUZpZWxkKTtcclxuICAgICAgICByZXR1cm4gZmllbGRWYWx1ZTtcclxuICAgICAgfSxcclxuICAgICAgc2V0OiBmdW5jdGlvbiAodmFsdWU6IGFueSkge1xyXG4gICAgICAgIHRoaXMuc2V0Q29tcGxleEZpZWxkVmFsdWUoc2NoZW1hRmllbGQsIGNvbXBsZXhGaWVsZFR5cGUsIHZhbHVlKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICBjb25zdCBmaWVsZE1ldGFkYXRhID0ge1xyXG4gICAgICAvKiog5pig5bCE5a2X5q61ICovXHJcbiAgICAgIGRhdGFGaWVsZDogc2NoZW1hRmllbGQubGFiZWwsXHJcbiAgICAgIC8qKiDljp/lp4vlrZfmrrXlkI3np7AgKi9cclxuICAgICAgb3JpZ2luYWxEYXRhRmllbGQ6IHNjaGVtYUZpZWxkLmNvZGUsXHJcbiAgICAgIC8qKiDlvJXnlKjlrp7kvZPnsbvlnosgKi9cclxuICAgICAgdHlwZTogY29tcGxleEZpZWxkVHlwZSxcclxuICAgICAgLyoqXHJcbiAgICAgICAqIOWOn+Wni+Wtl+autVxyXG4gICAgICAgKiBAZGVzY3JpcHRpb24g5a+55bqU5Yiwc2NoZW1l55qEcGF0aOWxnuaAp1xyXG4gICAgICAgKi9cclxuICAgICAgcGF0aDogc2NoZW1hRmllbGQucGF0aCxcclxuICAgICAgbmdNZXRhZGF0YU5hbWU6IE5HX09CSkVDVFxyXG4gICAgfTtcclxuICAgIGlmICghcGFyZW50RW50aXR5VHlwZS5fX3Byb3BfX21ldGFkYXRhX19bcHJvcGVydHlOYW1lXSkge1xyXG4gICAgICBwYXJlbnRFbnRpdHlUeXBlLl9fcHJvcF9fbWV0YWRhdGFfX1twcm9wZXJ0eU5hbWVdID0gW107XHJcbiAgICB9XHJcbiAgICBwYXJlbnRFbnRpdHlUeXBlLl9fcHJvcF9fbWV0YWRhdGFfX1twcm9wZXJ0eU5hbWVdLnB1c2goZmllbGRNZXRhZGF0YSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWQkeWunuS9k+exu+WumuS5ieWtkOWunuS9k1xyXG4gICAqIEBwYXJhbSBwcm90b3R5cGVPYmplY3Qg5a6e5L2T57G75Y6f5Z6L5a+56LGhXHJcbiAgICogQHBhcmFtIGVudGl0aWVzIOWunuS9k+aPj+i/sOmbhuWQiFxyXG4gICAqIEBwYXJhbSBwYXJlbnRFbnRpdHlUeXBlIOeItuexu+Wei1xyXG4gICAqL1xyXG4gIHByaXZhdGUgZGVmaW5lRW50aXRpZXNUb1Byb3RvdHlwZShwcm90b3R5cGVPYmplY3Q6IGFueSwgZW50aXRpZXM6IFNjaGVtYUVudGl0eVtdLCBwYXJlbnRFbnRpdHlUeXBlOiBBYnN0cmFjdEVudGl0eVR5cGUpIHtcclxuICAgIGlmIChlbnRpdGllcyAmJiBlbnRpdGllcy5sZW5ndGgpIHtcclxuICAgICAgLy8g6YGN5Y6GU2NoZW1h5Lit5o+P6L+w55qE5a2Q5a6e5L2T77yM5Zyo5a6e5L2T5a+56LGh5LiK5a6a5LmJ5a2Q5a6e5L2T5YiX6KGoXHJcbiAgICAgIGVudGl0aWVzLmZvckVhY2goc2NoZW1hRW50aXR5ID0+IHtcclxuICAgICAgICBjb25zdCBjb21wbGV4RmllbGRUeXBlID0gdGhpcy5jcmVhdGVDbGFzcyhzY2hlbWFFbnRpdHkudHlwZSk7XHJcbiAgICAgICAgcGFyZW50RW50aXR5VHlwZS50eXBlc1tzY2hlbWFFbnRpdHkudHlwZS5uYW1lXSA9IGNvbXBsZXhGaWVsZFR5cGU7XHJcbiAgICAgICAgLy8g5o+Q5Y+W5a2Q5a6e5L2T5Zyo5a6e5L2T5a+56LGh5LiK55qE5bGe5oCn5ZCNXHJcbiAgICAgICAgY29uc3QgcHJvcGVydHlOYW1lID0gc2NoZW1hRW50aXR5LmxhYmVsO1xyXG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm90b3R5cGVPYmplY3QsIHByb3BlcnR5TmFtZSwge1xyXG4gICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGZpZWxkVmFsdWUgPSB0aGlzLmdldEVudGl0aWVzKHNjaGVtYUVudGl0eSk7XHJcbiAgICAgICAgICAgIHJldHVybiBmaWVsZFZhbHVlO1xyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIHNldDogZnVuY3Rpb24gKHZhbHVlOiBhbnkpIHtcclxuICAgICAgICAgICAgdGhpcy5zZXRFbnRpdGllcyhzY2hlbWFFbnRpdHksIHZhbHVlKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICBjb25zdCBlbnRpdE1ldGFkYXRhID0ge1xyXG4gICAgICAgICAgLyoqIOWtl+auteWQjeensCAqL1xyXG4gICAgICAgICAgZGF0YUZpZWxkOiBzY2hlbWFFbnRpdHkubGFiZWwsXHJcbiAgICAgICAgICAvKiog5Y6f5aeL5a2X5q615ZCN56ewICovXHJcbiAgICAgICAgICBvcmlnaW5hbERhdGFGaWVsZDogJycsXHJcbiAgICAgICAgICAvKiog5a6e5L2T57G75Z6LICovXHJcbiAgICAgICAgICB0eXBlOiBjb21wbGV4RmllbGRUeXBlLFxyXG4gICAgICAgICAgbmdNZXRhZGF0YU5hbWU6IE5HX0xJU1RcclxuICAgICAgICB9O1xyXG4gICAgICAgIGlmICghcGFyZW50RW50aXR5VHlwZS5fX3Byb3BfX21ldGFkYXRhX19bcHJvcGVydHlOYW1lXSkge1xyXG4gICAgICAgICAgcGFyZW50RW50aXR5VHlwZS5fX3Byb3BfX21ldGFkYXRhX19bcHJvcGVydHlOYW1lXSA9IFtdO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwYXJlbnRFbnRpdHlUeXBlLl9fcHJvcF9fbWV0YWRhdGFfX1twcm9wZXJ0eU5hbWVdLnB1c2goZW50aXRNZXRhZGF0YSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuICAvKipcclxuICAgKiDliJvlu7rliJ3lp4vljJblrp7kvZPlr7nosaHmlrnms5VcclxuICAgKiBAcGFyYW0gc2NoZW1hVHlwZSDlrp7kvZPnsbvlnovmj4/ov7BcclxuICAgKiBAcmV0dXJucyDliJ3lp4vljJblrp7kvZPlr7nosaHmlrnms5VcclxuICAgKi9cclxuICBwcml2YXRlIGNyZWF0ZUVudGl0eUluc3RhbmNlRGF0YUluaXRpYWxpemVyKHNjaGVtYVR5cGU6IFNjaGVtYVR5cGUpIHtcclxuICAgIC8qKlxyXG4gICAgICog5a6e5L2T5Yid5aeL5YyW5Ye95pWw77yM55So5p2l5Yid5aeL5YyW5a6e5L2T55qE5aSN5p2C57G75Z6L5pWw5o2u5ZKM5a2Q5a6e5L2T5pWw5o2uXHJcbiAgICAgKiBAcGFyYW0gZW50aXR5SW5zdGFuY2Ug5a6e5L2T57G75Z6L5a6e5L6LXHJcbiAgICAgKiBAcGFyYW0gZGF0YSDlrp7kvZPljp/lp4vmlbDmja5cclxuICAgICAqIEBwYXJhbSBlbnRpdHlUeXBlQ29uc3RydWN0b3Ig5a6e5L2T57G75Z6L5p6E6YCg5Ye95pWwXHJcbiAgICAgKi9cclxuICAgIGNvbnN0IGluaXRpYWxpemVyID0gKGVudGl0eUluc3RhbmNlOiBhbnksIGVudGl0eURhdGE6IGFueSwgZW50aXR5VHlwZUNvbnN0cnVjdG9yOiBhbnkpID0+IHtcclxuICAgICAgLy8g5Yid5aeL5YyW5aSN5p2C57G75Z6L5a2X5q61XHJcbiAgICAgIHNjaGVtYVR5cGUuZmllbGRzXHJcbiAgICAgICAgLy8g6L+H5ruk5aSN5p2C57G75Z6L5a2X5q61XHJcbiAgICAgICAgLmZpbHRlcihmaWVsZCA9PiBmaWVsZC4kdHlwZSA9PT0gU2NoZW1hRW50aXR5RmllbGQkVHlwZS5Db21wbGV4RmllbGQpXHJcbiAgICAgICAgLy8g6YGN5Y6G5aSN5p2C57G75Z6L5a2X5q615Yib5bu65a+55bqU5a6e5L2T57G75Z6L5pWw5o2uXHJcbiAgICAgICAgLmZvckVhY2goZmllbGQgPT4ge1xyXG4gICAgICAgICAgLy8g5o+Q5Y+W5a2X5q615ZCNXHJcbiAgICAgICAgICBjb25zdCBmaWVsZE5hbWUgPSBmaWVsZC5sYWJlbDtcclxuICAgICAgICAgIC8vIOaPkOWPluWunuS9k+exu+Wei+S4i+eahOaJgOacieWtkOWunuS9k+exu+Wei1xyXG4gICAgICAgICAgY29uc3QgaW5jbHVkZWRFbnRpdHlUeXBlcyA9IGVudGl0eVR5cGVDb25zdHJ1Y3Rvci50eXBlcztcclxuICAgICAgICAgIC8vIOiOt+WPluWkjeadguexu+Wei+Wtl+auteWvueW6lOeahOWunuS9k+exu+Wei1xyXG4gICAgICAgICAgY29uc3QgQ29tcGxleEZpZWxkID0gaW5jbHVkZWRFbnRpdHlUeXBlc1tmaWVsZC50eXBlLm5hbWVdO1xyXG4gICAgICAgICAgLy8g5o+Q5Y+W5aSN5p2C57G75Z6L5a2X5q615Y6f5aeL5pWw5o2uXHJcbiAgICAgICAgICBjb25zdCBmaWVsZERhdGEgPSBlbnRpdHlEYXRhID8gZW50aXR5RGF0YVtmaWVsZE5hbWVdIDogbnVsbDtcclxuICAgICAgICAgIC8vIOWIm+W7uuWkjeadguexu+Wei+Wtl+auteWvueixoei3r+W+hFxyXG4gICAgICAgICAgY29uc3QgcGF0aCA9IGVudGl0eUluc3RhbmNlLmNyZWF0ZVBhdGgoZmllbGROYW1lKTtcclxuICAgICAgICAgIGxldCBjb21wbGV4RmllbGRWYWx1ZSA9IGVudGl0eUluc3RhbmNlW2ZpZWxkTmFtZV07XHJcbiAgICAgICAgICBpZiAoY29tcGxleEZpZWxkVmFsdWUgaW5zdGFuY2VvZiBDb21wbGV4RmllbGQpIHtcclxuICAgICAgICAgICAgY29tcGxleEZpZWxkVmFsdWUubG9hZChmaWVsZERhdGEpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8g5Yib5bu65aSN5p2C57G75Z6L5a2X5q615a6e5L2T5a6e5L6LXHJcbiAgICAgICAgICAgIGNvbXBsZXhGaWVsZFZhbHVlID0gbmV3IENvbXBsZXhGaWVsZChmaWVsZERhdGEpO1xyXG4gICAgICAgICAgICBjb21wbGV4RmllbGRWYWx1ZS5jb25zdHJ1Y3RvciA9IENvbXBsZXhGaWVsZDtcclxuICAgICAgICAgICAgY29tcGxleEZpZWxkVmFsdWVbUEFSRU5UX0NMQVNTXSA9IGVudGl0eVR5cGVDb25zdHJ1Y3RvcjtcclxuICAgICAgICAgICAgY29tcGxleEZpZWxkVmFsdWVbUEFSRU5UX1BBVEhdID0gcGF0aDtcclxuICAgICAgICAgICAgY29tcGxleEZpZWxkVmFsdWUub25WYWx1ZUNoYW5nZWQuc3Vic2NyaWJlKGNoYW5nZXMgPT4ge1xyXG4gICAgICAgICAgICAgIGlmIChjaGFuZ2VzKSB7XHJcbiAgICAgICAgICAgICAgICBjaGFuZ2VzLnBhdGggPSAoZW50aXR5SW5zdGFuY2VbUEFSRU5UX1BBVEhdIHx8IFtdKS5jb25jYXQoY2hhbmdlcy5wYXRoKTtcclxuICAgICAgICAgICAgICAgIGVudGl0eUluc3RhbmNlLnNldENoYW5nZXMoY2hhbmdlcyk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgZW50aXR5SW5zdGFuY2VbZmllbGROYW1lXSA9IGNvbXBsZXhGaWVsZFZhbHVlO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAvLyDliJ3lp4vljJblrZDlrp7kvZNcclxuICAgICAgaWYgKHNjaGVtYVR5cGUuZW50aXRpZXMpIHtcclxuICAgICAgICAvLyDpgY3ljoblrZDlrp7kvZPliJvlu7rlr7nlupTlrp7kvZPnsbvlnovnmoTmlbDmja5cclxuICAgICAgICBzY2hlbWFUeXBlLmVudGl0aWVzLmZvckVhY2goc2NoZW1hRW50aXR5ID0+IHtcclxuICAgICAgICAgIC8vIOaPkOWPluWtkOWunuS9k+WQjVxyXG4gICAgICAgICAgY29uc3Qgc3ViRW50aXR5TmFtZSA9IHNjaGVtYUVudGl0eS5sYWJlbDtcclxuICAgICAgICAgIC8vIOaPkOWPluWunuS9k+exu+Wei+S4i+eahOaJgOacieWtkOWunuS9k+exu+Wei1xyXG4gICAgICAgICAgY29uc3QgaW5jbHVkZWRFbnRpdHlUeXBlcyA9IGVudGl0eVR5cGVDb25zdHJ1Y3Rvci50eXBlcztcclxuICAgICAgICAgIC8vIOWIm+W7uuWtkOWunuS9k+Wvueixoei3r+W+hFxyXG4gICAgICAgICAgY29uc3QgcGF0aCA9IGVudGl0eUluc3RhbmNlLmNyZWF0ZVBhdGgoc3ViRW50aXR5TmFtZSk7XHJcbiAgICAgICAgICAvLyDliJvlu7rlrZDlrp7kvZPlr7nosaHpm4blkIhcclxuICAgICAgICAgIGxldCBlbnRpdHlMaXN0ID0gZW50aXR5SW5zdGFuY2Vbc3ViRW50aXR5TmFtZV07XHJcbiAgICAgICAgICBpZiAoIShlbnRpdHlMaXN0IGluc3RhbmNlb2YgRW50aXR5TGlzdCkpIHtcclxuICAgICAgICAgICAgZW50aXR5TGlzdCA9IG5ldyBFbnRpdHlMaXN0PEVudGl0eT4oKTtcclxuICAgICAgICAgICAgLy8g5ZCR5a2Q5a6e5L2T5YiX6KGo5rOo5YaM5a2Q5a6e5L2T5Y+Y5YyW5LqL5Lu2XHJcbiAgICAgICAgICAgIGVudGl0eUxpc3Qub25MaXN0Q2hhbmdlZC5zdWJzY3JpYmUodmFsdWUgPT4ge1xyXG4gICAgICAgICAgICAgIGlmICh2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGVudGl0eUxpc3RbUEFSRU5UX1BBVEhdWzBdICE9PSB2YWx1ZS5wYXRoWzBdKSB7XHJcbiAgICAgICAgICAgICAgICAgIHZhbHVlLnBhdGggPSBlbnRpdHlMaXN0W1BBUkVOVF9QQVRIXS5jb25jYXQodmFsdWUucGF0aCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbnRpdHlJbnN0YW5jZS5zZXRDaGFuZ2VzKHZhbHVlKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAvLyDlkJHlrp7kvZPnsbvlnovlrp7kvovkuIrnm7TmjqXlrZjlgqjlrZDlrp7kvZPlr7nosaHliJfooahcclxuICAgICAgICAgICAgZW50aXR5SW5zdGFuY2Vbc3ViRW50aXR5TmFtZV0gPSBlbnRpdHlMaXN0O1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgZW50aXR5TGlzdFtQQVJFTlRfQ0xBU1NdID0gZW50aXR5VHlwZUNvbnN0cnVjdG9yO1xyXG4gICAgICAgICAgZW50aXR5TGlzdFtQQVJFTlRfUEFUSF0gPSBwYXRoO1xyXG4gICAgICAgICAgLy8g5o+Q5Y+W5a2Q5a6e5L2T57G75Z6L5ZCN56ewXHJcbiAgICAgICAgICBjb25zdCBzY2hlbWFFbnRpdHlUeXBlTmFtZSA9IHNjaGVtYUVudGl0eS50eXBlLm5hbWU7XHJcbiAgICAgICAgICAvLyDojrflj5blrZDlrp7kvZPnsbvlnotcclxuICAgICAgICAgIGNvbnN0IENvbmNyZXRlRW50aXR5ID0gaW5jbHVkZWRFbnRpdHlUeXBlc1tzY2hlbWFFbnRpdHlUeXBlTmFtZV07XHJcbiAgICAgICAgICBjb25zdCBvcmlnaW5hbEVudGl0eURhdGFBcnJheSA9IGVudGl0eURhdGEgPyBlbnRpdHlEYXRhW3N1YkVudGl0eU5hbWVdIDogbnVsbDtcclxuICAgICAgICAgIC8vIOaehOmAoOWtkOWunuS9k+mbhuWQiFxyXG4gICAgICAgICAgaWYgKG9yaWdpbmFsRW50aXR5RGF0YUFycmF5KSB7XHJcbiAgICAgICAgICAgIC8vIOmBjeWOhuWtkOWunuS9k+WOn+Wni+aVsOaNru+8jOaehOmAoOWunuS9k+WvueixoembhuWQiFxyXG4gICAgICAgICAgICBjb25zdCBlbnRpdGllcyA9IG9yaWdpbmFsRW50aXR5RGF0YUFycmF5Lm1hcCgob3JpZ2luYWxFbnRpdHlEYXRhOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICBjb25zdCBjb25jcmV0ZUVudGl0eUluc3RhbmNlID0gbmV3IENvbmNyZXRlRW50aXR5KG9yaWdpbmFsRW50aXR5RGF0YSk7XHJcbiAgICAgICAgICAgICAgY29uY3JldGVFbnRpdHlJbnN0YW5jZS5jb25zdHJ1Y3RvciA9IENvbmNyZXRlRW50aXR5O1xyXG4gICAgICAgICAgICAgIHJldHVybiBjb25jcmV0ZUVudGl0eUluc3RhbmNlO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgLy8g5ZCR5a2Q5a6e5L2T5YiX6KGo5Lit5re75Yqg5a2Q5a6e5L2T5a+56LGhXHJcbiAgICAgICAgICAgIGVudGl0eUxpc3QubG9hZEVudGl0aWVzKGVudGl0aWVzKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgIHJldHVybiBpbml0aWFsaXplcjtcclxuICB9XHJcbn1cclxuIl19