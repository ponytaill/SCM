/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*
 * @Author: 疯狂秀才(Lucas Huang)
 * @Date: 2019-08-06 07:43:07
 * @LastEditors: 疯狂秀才(Lucas Huang)
 * @LastEditTime: 2019-11-19 15:48:27
 * @QQ: 1055818239
 * @Version: v0.0.1
 */
import { Directive, Input, ElementRef, Renderer2, ContentChild, Injector, forwardRef, Inject, NgZone } from '@angular/core';
import { filter, debounceTime, takeUntil } from 'rxjs/operators';
import { DatagridService } from './../../services/datagrid.service';
import { DatagridCellComponent } from './datagrid-cell.component';
import { DatagridBodyComponent } from './datagrid-body.component';
import { DatagridRowDirective } from './datagrid-row.directive';
import { DatagridFacadeService } from '../../services/datagrid-facade.service';
import { DatagridComponent } from '../../datagrid.component';
import { CELL_SELECTED_CLS, CELL_EDITING_CLS, ALLOW_EDIT_CELL_HIGHLIGHT_CLS } from '../../types/constant';
import { of, noop, Subject } from 'rxjs';
import { Utils } from '../../utils/utils';
var DatagridCellEditableDirective = /** @class */ (function () {
    function DatagridCellEditableDirective(injector, el, render, dg, ngZone) {
        var _this = this;
        this.injector = injector;
        this.el = el;
        this.render = render;
        this.dg = dg;
        this.ngZone = ngZone;
        // private _readonly$ = null;
        this.cellEditorCreatedSubscription = null;
        this.cellEditorDestorySubscription = null;
        this.destroy$ = new Subject();
        this.validMessageEle = null;
        this.dgb = this.injector.get(DatagridBodyComponent);
        this.dr = this.injector.get(DatagridRowDirective);
        this.dfs = this.injector.get(DatagridFacadeService);
        this.dgs = this.injector.get(DatagridService);
        if (!this.cellEditorCreatedSubscription) {
            this.cellEditorCreatedSubscription = this.dgs.cellEditorCreated.pipe(takeUntil(this.destroy$)).pipe(filter((/**
             * @param {?} __0
             * @return {?}
             */
            function (_a) {
                var column = _a.column, editorRef = _a.editorRef, cellEditorRef = _a.cellEditorRef, templateRef = _a.templateRef;
                return column.field === _this.column.field && _this.dg.selectedRow.id === _this.dr.rowId;
            }))).subscribe((/**
             * @param {?} __0
             * @return {?}
             */
            function (_a) {
                var editorRef = _a.editorRef, cellEditorRef = _a.cellEditorRef, templateRef = _a.templateRef;
                if (editorRef) {
                    _this['editor'] = editorRef.instance;
                    _this['formControl'] = (/** @type {?} */ (_this.editor.formControl));
                    _this.cellEditorRef = cellEditorRef;
                    _this.emitBeginEdit();
                }
                else {
                    _this['formControl'] = (/** @type {?} */ (_this.dr.form.get(_this.column.field)));
                    _this.bindEditorInputEvent();
                    _this.dg.beginEdit.emit({ editor: null, column: _this.column, rowData: _this.rowData, gridInstance: _this.dg, template: templateRef });
                }
            }));
        }
        this.dg.dgs.cellEditorDestory.pipe(takeUntil(this.destroy$)).pipe(filter((/**
         * @param {?} __0
         * @return {?}
         */
        function (_a) {
            var column = _a.column;
            return _this.dg.selectedRow && column.field === _this.column.field && _this.dg.selectedRow.id === _this.dr.rowId;
        }))).subscribe((/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            if (_this.dg.editMode === 'cell') {
                _this.dg.selectedRow.editors = [];
                if (_this.dg.currentCell) {
                    _this.dg.currentCell.editor = null;
                    _this.dg.currentCell.cellEditorRef = null;
                }
            }
            _this.unBindEditorInputEvent();
            _this.cellEditorRef = null;
            _this.formControl = null;
            _this.editor = null;
            _this.removeValidMessage();
        }));
    }
    /**
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        if (changes.rowData && !changes.rowData.isFirstChange()) {
            this.setCellClsWithEditorType();
        }
    };
    /**
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        this.initCellEvent();
        this.setCellClsWithEditorType();
    };
    /**
     * @private
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.initCellEvent = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        // this.cellclick = this.render.listen(this.el.nativeElement, 'click', (e) => this.onClickCell(e));
        if (this.column && (this.column.editor || this.column.editorTemplate)) {
            if (!this.dg.clickToEdit) {
                this.celldblclick = this.render.listen(this.el.nativeElement, 'dblclick', (/**
                 * @param {?} e
                 * @return {?}
                 */
                function (e) {
                    _this.onDblClickCell(e);
                }));
            }
            this.el.nativeElement.edit = (/**
             * @param {?} e
             * @return {?}
             */
            function (e) { return _this.onClickCell(e); });
            this.el.nativeElement.editCell = (/**
             * @param {?} e
             * @return {?}
             */
            function (e) {
                _this.openCellEditor();
            });
        }
        else {
            this.clickTimer = 0;
        }
        this.el.nativeElement.gridCellData = { rowData: this.rowData, rowIndex: this.dr.rowIndex };
        this.el.nativeElement.closeEdit = (/**
         * @return {?}
         */
        function () { return _this.closeEditingCell(); });
        this.el.nativeElement.selectCell = (/**
         * @param {?} e
         * @param {?} el
         * @return {?}
         */
        function (e, el) {
            if (_this.dg.disableRow && _this.dg.disableRow(_this.rowData, _this.dr.rowIndex)) {
                return;
            }
            if (_this.dg.currentCell && _this.dg.currentCell.cellElement.id === el.id && !_this.dg.keepSelect) {
                _this.dg.cancelSelectCell();
            }
            else {
                _this.selectCell(_this.column.field, el);
                _this.dg.cellClick.emit({ column: _this.column, rowData: _this.rowData, gridInstance: _this.dg, event: e });
            }
        });
        this.el.nativeElement.cancelSelected = (/**
         * @return {?}
         */
        function () {
            // DomHandler.removeClass(this.el.nativeElement, CELL_SELECTED_CLS);
            // DomHandler.removeClass(this.el.nativeElement, CELL_EDITING_CLS);
            _this.render.removeClass(_this.el.nativeElement, CELL_SELECTED_CLS);
            _this.render.removeClass(_this.el.nativeElement, CELL_EDITING_CLS);
        });
    };
    /**
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.destroy$.next();
        this.destroy$.complete();
        if (this.cellclick) {
            this.cellclick();
        }
        if (this.celldblclick) {
            this.celldblclick();
        }
        this.unBindEditorInputEvent();
        if (this.bindCellEventSubscription) {
            this.bindCellEventSubscription.unsubscribe();
            this.bindCellEventSubscription = null;
        }
        if (this.cellEditorCreatedSubscription) {
            this.cellEditorCreatedSubscription.unsubscribe();
            this.cellEditorCreatedSubscription = null;
        }
        if (this.cellEditorDestorySubscription) {
            this.cellEditorDestorySubscription.unsubscribe();
            this.cellEditorDestorySubscription = null;
        }
        this.editor = null;
        this.cellEditorRef = null;
        this.formControl = null;
        if (this.el) {
            this.el.nativeElement.cancelSelected = noop;
            this.el.nativeElement.selectCell = noop;
            this.el.nativeElement.closeEdit = noop;
            this.el.nativeElement.gridCellData = noop;
            this.el.nativeElement.edit = noop;
            this.el.nativeElement.selectCell = noop;
            this.el = null;
        }
    };
    /**
     * @private
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.isDifferentCell = /**
     * @private
     * @return {?}
     */
    function () {
        if (!this.dg.currentCell) {
            return true;
        }
        else {
            if (!this.dg.selectedRow || this.dg.selectedRow.index !== this.dr.rowIndex) {
                return true;
            }
            else {
                if (this.dr.rowIndex !== this.dg.currentCell.rowIndex) {
                    return true;
                }
                else {
                    return this.dg.currentCell.field !== this.column.field;
                }
            }
        }
    };
    /**
     * @private
     * @param {?} event
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.onClickCell = /**
     * @private
     * @param {?} event
     * @return {?}
     */
    function (event) {
        var _this = this;
        // 关闭其他Grid 的编辑器
        document.body.click();
        this.dg.beforeClickCell.emit({ rowIndex: this.dr.rowIndex, rowData: this.rowData, column: this.column, gridInstance: this.dg });
        if (this.dr.disabled) {
            return;
        }
        // 20210422
        // if (this.dg.closeOtherGridEditor) {
        //     document.body.click();
        // }
        if (this.dg.disabled) {
            return;
        }
        else {
            if (!this.dg.editable || this.isReadonly()) {
                if (this.dg.enableHighlightCell) {
                    event.stopPropagation();
                    this.dg.endEditing();
                    this.selectCell(this.column.field);
                }
                return;
            }
            else {
                if (this.dg.editMode === 'row') {
                    return;
                }
            }
        }
        if (this.dg.selectionMode === 'default' && event) {
            if (event.ctrlKey || event.shiftKey) {
                return;
            }
        }
        event.stopPropagation();
        if (event.target['nodeName'] === 'INPUT') {
            return;
        }
        // if (this.dg.clickToEdit && !this.dg.dblclickRow.observers.length) {
        //     this.dg.clickDelay = 0;
        // }
        this.render.addClass(this.dg.el.nativeElement, 'f-datagrid-unselect');
        if (!this.dg.isSingleClick && this.dg.editMode) {
            this.dg.isSingleClick = true;
            if (this.clickTimer) {
                clearTimeout(this.clickTimer);
            }
            this.clickTimer = setTimeout((/**
             * @return {?}
             */
            function () {
                if (_this.dg.isSingleClick && _this.dg.editable && _this.dg.editMode === 'cell') {
                    _this.dg.isSingleClick = false;
                    clearTimeout(_this.clickTimer);
                    // if (!this.closeEditingCell()) {
                    //     return;
                    // }
                    _this.closeEditingCell().pipe(takeUntil(_this.destroy$)).subscribe((/**
                     * @param {?} f
                     * @return {?}
                     */
                    function (f) {
                        if (f) {
                            if (_this.dg.clickToEdit) {
                                _this.openCellEditor();
                            }
                            else {
                                _this.selectCell(_this.column.field);
                            }
                            _this.render.removeClass(_this.dg.el.nativeElement, 'f-datagrid-unselect');
                            event.preventDefault();
                        }
                    }));
                }
            }), this.dg.clickDelay);
        }
    };
    /**
     * @private
     * @param {?} event
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.onDblClickCell = /**
     * @private
     * @param {?} event
     * @return {?}
     */
    function (event) {
        var _this = this;
        if (this.dg.disabled || this.isReadonly()) {
            return;
        }
        if (event.target['nodeName'] === 'INPUT' || event.target['nodeName'] === 'TEXTAREA') {
            return;
        }
        if (this.dg.editable && this.dg.editMode === 'cell') {
            if (this.clickTimer) {
                this.dg.isSingleClick = false;
                clearTimeout(this.clickTimer);
                this.clickTimer = null;
            }
            this.closeEditingCell().pipe(takeUntil(this.destroy$)).subscribe((/**
             * @param {?} f
             * @return {?}
             */
            function (f) {
                if (f) {
                    setTimeout((/**
                     * @return {?}
                     */
                    function () {
                        _this.openCellEditor();
                    }));
                }
            }));
        }
    };
    /**
     * @param {?=} col
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.isReadonly = /**
     * @param {?=} col
     * @return {?}
     */
    function (col) {
        if (col === void 0) { col = this.column; }
        if (this.dg.editable) {
            // 参与合并的单元格不允许编辑
            if (this.dg.mergeCell && this.dg.mergeFields.indexOf(col.field) > -1) {
                return true;
            }
            return this.getReadonlyValue(col);
        }
        else {
            return true;
        }
    };
    /**
     * @private
     * @param {?=} col
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.getReadonlyValue = /**
     * @private
     * @param {?=} col
     * @return {?}
     */
    function (col) {
        if (col === void 0) { col = this.column; }
        if (col.readonly !== undefined) {
            if (typeof col.readonly === 'boolean') {
                return col.readonly;
            }
            else if (typeof col.readonly === 'function') {
                return col.readonly(this.rowData);
            }
        }
        return false;
    };
    /**
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.openCellEditor = /**
     * @return {?}
     */
    function () {
        var _this = this;
        // 当前行禁用，不允许编辑。
        if (this.dr.disabled) {
            return;
        }
        if ((!this.column.editor && !this.column.editorTemplate) || !this.dg.editable || this.isReadonly()) {
            if (this.dg.selectionMode === 'default' && this.dg.multiSelect) {
                this.dg.clearCheckeds();
            }
            this.selectCell(this.column.field);
            return;
        }
        /** @type {?} */
        var beforeEditEvent = this.dg.beforeEdit({ rowIndex: this.dr.rowIndex, rowData: this.rowData, column: this.column, gridInstance: this.dg });
        if (!beforeEditEvent || !beforeEditEvent.subscribe) {
            this.dg.writeConsole('please return an Observable Type.');
            return;
        }
        if (this.dg.currentCell) {
            if (!this.dg.currentCell.cellRef || this.dg.currentCell.cellRef.column.field !== this.column.field) {
                this.dg.currentCell.cellRef = this.dc;
            }
        }
        beforeEditEvent.pipe(takeUntil(this.destroy$)).subscribe((/**
         * @param {?} flag
         * @return {?}
         */
        function (flag) {
            if (flag) {
                if (_this.isDifferentCell()) {
                    if (_this.dg.selectionMode === 'default' && _this.dg.multiSelect) {
                        _this.dg.clearCheckeds();
                    }
                    _this.selectCell(_this.column.field);
                }
                _this.dfs.editCell();
            }
            else {
                _this.selectCell(_this.column.field);
            }
        }));
    };
    /**
     * @private
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.emitBeginEdit = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var _cellEditorRef = this.cellEditorRef || this.dc.cellEditor;
        this.render.removeClass(this.dg.el.nativeElement, 'f-datagrid-unselect');
        if (this.dg.editMode === 'cell') {
            this.dg.selectedRow.editors = [this.editor];
            this.dg.currentCell.editor = this.editor;
            this.dg.currentCell.cellEditorRef = _cellEditorRef;
            this.bindEditorInputEvent();
            this.render.addClass(this.el.nativeElement, CELL_EDITING_CLS);
            // this.formControl.setValue(this.dc.value);
            this.dg.beginEdit.emit({ editor: _cellEditorRef, column: this.column, rowData: this.rowData, gridInstance: this.dg });
            if (this.column.editor.type === 'textarea' && this.column.editor.options && this.column.editor.options.editType === 'dialog') {
                this.editor.showDialog();
            }
        }
        if (this.dr && !this.dg.nowrap) {
            setTimeout((/**
             * @return {?}
             */
            function () {
                _this.dr.updateRowHeight();
            }));
        }
        if (this.editor) {
            this.validMessageEle = this.showValidMessage();
        }
    };
    /**
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.removeValidMessage = /**
     * @return {?}
     */
    function () {
        // 移除验证信息
        if (this.validMessageEle) {
            this.validMessageEle.remove();
            this.validMessageEle = null;
            if (this.dg.formValidations) {
                delete this.dg.formValidations[this.column.field];
            }
        }
    };
    /**
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.showValidMessage = /**
     * @return {?}
     */
    function () {
        if (this.dg.formValidations && this.dg.formValidations[this.column.field]) {
            var _a = this.dg.formValidations[this.column.field], isValid = _a.isValid, message = _a.message;
            if (!isValid && message) {
                /** @type {?} */
                var tr = this.editor.el.nativeElement.closest('tr');
                /** @type {?} */
                var td = this.editor.el.nativeElement.closest('td');
                /** @type {?} */
                var parentContainver = this.editor.el.nativeElement.closest('.f-datagrid-table');
                /** @type {?} */
                var box = document.createElement('div');
                /** @type {?} */
                var msgWrap = document.createElement('span');
                box.appendChild(msgWrap);
                msgWrap.innerText = message;
                box.style.position = 'absolute';
                box.style.background = '#FDEFEF';
                box.style.color = '#F46160';
                /** @type {?} */
                var top_1 = tr.offsetTop - 21;
                if (tr.getAttribute('index') == '0') {
                    top_1 = tr.offsetHeight;
                }
                box.style.top = top_1 + "px";
                box.style.left = td.offsetLeft + 5 + "px";
                box.style.zIndex = '996';
                box.style.padding = '0.1875rem 0.5rem';
                box.style.fontSize = '.8125rem';
                box.style.lineHeight = '14px';
                // document.body.append(box);
                parentContainver.append(box);
                return box;
            }
            return null;
        }
    };
    /**
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.closeEditingCell = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (!this.dg.isCellEditing()) {
            return of(true);
        }
        /** @type {?} */
        var currentCell = null;
        /** @type {?} */
        var editor = null;
        if (this.dg.currentCell) {
            // this.dg.currentCell.isEditing = false;
            // this.dfs.getCurrentCell().isEditing = false;
            currentCell = (/** @type {?} */ (this.dg.currentCell.cellRef));
            if (currentCell) {
                if (!currentCell.isEditing) {
                    return of(true);
                }
                if (currentCell.cellEditor && currentCell.cellEditor.componentRef && !currentCell.column.editorTemplate) {
                    editor = currentCell.cellEditor.componentRef.instance;
                    if (editor) {
                        // 执行blur 事件
                        if (editor.inputElement) {
                            /** @type {?} */
                            var domName = editor.inputElement.nodeName;
                            /** @type {?} */
                            var blurFn = editor.options && editor.options.onBlur;
                            if (blurFn) {
                                if ((domName === 'INPUT' || domName === 'TEXTAREA') && this.dg['focusElement'] === editor.inputElement) {
                                    blurFn({ editorRef: editor, rowData: currentCell.rowData });
                                }
                            }
                            if (editor.inputElement.blur) {
                                editor.inputElement.blur();
                            }
                            this.dg['focusElement'] = null;
                        }
                        if (editor.blur) {
                            editor.blur();
                        }
                        if (editor.pending) {
                            return of(false);
                        }
                        if (editor.formControl) {
                            if (editor.formControl.pending) {
                                return of(false);
                            }
                            if (editor.formControl && editor.formControl.invalid && !this.dg.endEditByInvalid) {
                                return of(false);
                            }
                        }
                        else {
                            return of(true);
                        }
                    }
                    else {
                        return of(true);
                    }
                }
            }
        }
        else {
            return of(true);
        }
        this.dg.isSingleClick = false;
        /** @type {?} */
        var _col_ = (editor || currentCell).column;
        /** @type {?} */
        var afterEditEvent = this.dg.afterEdit(currentCell.rowIndex, currentCell.rowData, _col_, editor);
        if (!afterEditEvent || !afterEditEvent.subscribe) {
            this.dg.writeConsole('please return an Observable Type.');
            return of(undefined);
        }
        // let cellEndEdit = of(undefined);
        /** @type {?} */
        var cellEndEdit = new Subject();
        afterEditEvent.pipe(takeUntil(this.destroy$)).subscribe((/**
         * @param {?} flag
         * @return {?}
         */
        function (flag) {
            if (flag) {
                /** @type {?} */
                var val_1 = currentCell.value === undefined ? '' : currentCell.value;
                if (currentCell && currentCell.formControl && currentCell.formControl.value !== undefined && val_1 !== currentCell.formControl.value) {
                    val_1 = currentCell.formControl.value;
                    currentCell.isEditing = false;
                    currentCell.updateValue(val_1);
                }
                _this.dfs.endEditCell();
                _this.dgs.onEndCellEdit(_this.dfs.getCurrentCell());
                _this.unBindEditorInputEvent();
                // 移除编辑样式
                _this.render.removeClass(_this.el.nativeElement, CELL_EDITING_CLS);
                if (_this.dg.selectedRow) {
                    _this.dg.selectedRow.editors = [];
                }
                // this.dg.selectedRow.data = this.rowData;
                // 更新行样式或者单元格样式
                _this.dfs.rowUpdate$.next({ index: currentCell.rowIndex, data: currentCell.rowData, cellRef: currentCell });
                // 更新footerData
                _this.dgs.refreshFooterData.emit();
                // 刷新行数据
                // this.dr.refresh();
                if (_this.dg.selectedRow && _this.dg.selectedRow.dr) {
                    _this.dg.selectedRow.dr.refresh();
                }
                if (_this['ENDEDIT_TIMER']) {
                    clearTimeout(_this['ENDEDIT_TIMER']);
                }
                var rowIndex_1 = currentCell.rowIndex, rowData_1 = currentCell.rowData;
                _this['ENDEDIT_TIMER'] = setTimeout((/**
                 * @return {?}
                 */
                function () {
                    _this.dg.endEdit.emit({ rowIndex: rowIndex_1, rowData: rowData_1, column: _col_, value: val_1 });
                    // cellEndEdit = of(true);
                    cellEndEdit.next(true);
                }), 100);
            }
            else {
                if (currentCell && currentCell.cellEditor && currentCell.cellEditor.componentRef && currentCell.cellEditor.componentRef.instance) {
                    editor = currentCell.cellEditor.componentRef.instance;
                    editor.inputElement.focus();
                    // cellEndEdit = of(false);
                    cellEndEdit.next(false);
                }
                else {
                    // cellEndEdit = of(true);
                    cellEndEdit.next(true);
                }
            }
        }));
        return cellEndEdit.asObservable();
    };
    /**
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.cancelCellEditing = /**
     * @return {?}
     */
    function () {
        if (this.dg.currentCell && this.dg.currentCell.isEditing && this.dg.selectedRow.index > -1) {
            // this.dfs.resetRow(this.dg.selectedRow.id);
            this.dc.rowData = this.dg.selectedRow.data;
            this.formControl.reset(Utils.getValue(this.column.field, this.dc.rowData));
            this.closeEditingCell();
        }
    };
    /**
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.bindEditorInputEvent = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var ceRef = this.cellEditorRef || this.dc.cellEditor;
        /** @type {?} */
        var input = null;
        if (ceRef) {
            input = ceRef.componentRef.instance.inputElement;
        }
        else {
            if (this.column.editorTemplate) {
                input = this.dc.el.nativeElement.querySelector('input,textarea');
            }
        }
        if (input) {
            input.focus();
            if (this.dg.selectOnEditing && this.column.editorTemplate) {
                setTimeout((/**
                 * @return {?}
                 */
                function () {
                    if (input.select) {
                        input.select();
                    }
                }));
            }
            this.editorInputKeydownEvent = this.render.listen(input, 'keydown', (/**
             * @param {?} e
             * @return {?}
             */
            function (e) {
                _this.onKeyDownForInput(e);
            }));
        }
    };
    /**
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.unBindEditorInputEvent = /**
     * @return {?}
     */
    function () {
        if (this.editorInputKeydownEvent) {
            this.editorInputKeydownEvent();
            this.editorInputKeydownEvent = null;
        }
    };
    // private isLastCell() {
    //     let i = this.dg.flatColumns.length;
    //     while(i <= ) {
    //         if (this.dg.flatColumns[i])
    //     }
    // }
    // private isLastCell() {
    //     let i = this.dg.flatColumns.length;
    //     while(i <= ) {
    //         if (this.dg.flatColumns[i])
    //     }
    // }
    /**
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.findLastEditCell = 
    // private isLastCell() {
    //     let i = this.dg.flatColumns.length;
    //     while(i <= ) {
    //         if (this.dg.flatColumns[i])
    //     }
    // }
    /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var i = this.dg.colGroup.columns.length - 1;
        /** @type {?} */
        var _col = null;
        while (i >= 0) {
            /** @type {?} */
            var col = this.dg.colGroup.columns[i];
            if (col.editor || col.editorTemplate) {
                _col = col;
                break;
            }
            else {
                i--;
            }
        }
        return _col;
    };
    /**
     * @param {?} e
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.onKeyDownForInput = /**
     * @param {?} e
     * @return {?}
     */
    function (e) {
        var _this = this;
        /** @type {?} */
        var keyCode = e.keyCode;
        if (e.altKey || e.ctrlKey) {
            return;
        }
        if ((this.editor && this.editor.stopPropagation) || keyCode === 13 || this.column.editorTemplate) {
            e.stopPropagation();
        }
        switch (keyCode) {
            case 32: // SPACE
                if (this.column.editor.type === 'switch') {
                    e.preventDefault();
                    this.editor.instance.updateChecked(e, false);
                }
                break;
            case 13: // Enter
                this.closeEditingCell().pipe(takeUntil(this.destroy$)).pipe(debounceTime(100)).subscribe((/**
                 * @param {?} f
                 * @return {?}
                 */
                function (f) {
                    if (f) {
                        _this.dg.dgContainer.nativeElement.focus();
                        /** @type {?} */
                        var lastEditCell = _this.findLastEditCell();
                        /** @type {?} */
                        var enterParam = { gird: _this.dg, cell: _this.dg.currentCell, event: e, lastCell: lastEditCell.field === _this.column.field };
                        if (_this.column.onEnterHandler) {
                            _this.column.onEnterHandler(enterParam);
                        }
                        else {
                            /** @type {?} */
                            var nextTd = _this.dg.findNextCell(_this.column.field, 'right');
                            if (_this.dg.currentCell.lastRow && (!nextTd || lastEditCell.field === _this.column.field)) {
                                _this.dg.lastCellEnterHandler.emit(enterParam);
                            }
                        }
                    }
                }));
                break;
            case 27: // ESC
                this.cancelCellEditing();
                break;
            case 9: // Tab
                e.stopPropagation();
                this.dg.clickDelay = 0;
                if (e.shiftKey) {
                    this.closeEditingCell().pipe(takeUntil(this.destroy$)).subscribe((/**
                     * @param {?} f
                     * @return {?}
                     */
                    function (f) {
                        if (f) {
                            _this.movePrevCellAndEdit();
                        }
                    }));
                }
                else {
                    this.closeEditingCell().pipe(takeUntil(this.destroy$)).subscribe((/**
                     * @param {?} f
                     * @return {?}
                     */
                    function (f) {
                        if (f) {
                            _this.moveNextCellAndEdit(e);
                        }
                    }));
                    e.preventDefault();
                }
                break;
            case 40: // ↓
                /** 选中下一行，且当前列进入编辑态; 仅普通文本输入框支持 */
                if (this.column.editor.type === 'textbox') {
                    this.closeEditingCell().pipe(takeUntil(this.destroy$)).subscribe((/**
                     * @param {?} f
                     * @return {?}
                     */
                    function (f) {
                        if (f) {
                            _this.selectNextRowAndEditCell(_this.column.field, 'down');
                        }
                    }));
                    e.preventDefault();
                }
                break;
            case 38: // ↑
                /** 选中上一行，且当前列进入编辑态; 仅普通文本输入框支持 */
                if (this.column.editor.type === 'textbox') {
                    this.closeEditingCell().pipe(takeUntil(this.destroy$)).subscribe((/**
                     * @param {?} f
                     * @return {?}
                     */
                    function (f) {
                        if (f) {
                            _this.selectNextRowAndEditCell(_this.column.field, 'up');
                        }
                    }));
                    e.preventDefault();
                }
                break;
        }
    };
    /**
     * @private
     * @param {?} field
     * @param {?=} tdElement
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.selectCell = /**
     * @private
     * @param {?} field
     * @param {?=} tdElement
     * @return {?}
     */
    function (field, tdElement) {
        var _this = this;
        this.closeEditingCell().subscribe((/**
         * @param {?} t
         * @return {?}
         */
        function (t) {
            if (!t) {
                return;
            }
            tdElement = tdElement || _this.el.nativeElement;
            _this.clearCellSelectedClass();
            if (field !== _this.dg.ControlPanelFeild) {
                _this.render.addClass(tdElement, CELL_SELECTED_CLS);
            }
            // this.dr.drHover.setRowHoverCls(false);
            _this.dfs.setCurrentCell(_this.dr, field, tdElement, _this.dc);
            if (!_this.dg.fast && _this.column.fixed !== 'left' && _this.column.fixed !== 'right') {
                _this.moveScrollbar(tdElement);
            }
        }));
    };
    /**
     * @private
     * @param {?} td
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.moveScrollbar = /**
     * @private
     * @param {?} td
     * @return {?}
     */
    function (td) {
        /** @type {?} */
        var tdPosLeft = td.offsetLeft + td.offsetWidth;
        /** @type {?} */
        var containerWidth = this.dg.width - this.dgb.columnsGroup.leftFixedWidth - this.dgb.columnsGroup.rightFixedWidth;
        /** @type {?} */
        var tdRect = td.getBoundingClientRect();
        /** @type {?} */
        var scrollContainer = this.dgb.ps.elementRef.nativeElement;
        /** @type {?} */
        var psContainer = scrollContainer.getBoundingClientRect();
        /** @type {?} */
        var scrollTop = scrollContainer.scrollTop;
        /** @type {?} */
        var scrollLeft = scrollContainer.scrollLeft;
        /** @type {?} */
        var scrollbarXLeft = this.dgb.ps.elementRef.nativeElement.scrollLeft;
        if (tdPosLeft > containerWidth) {
            /** @type {?} */
            var x = tdPosLeft - containerWidth + 2;
            // const x = tdPosLeft - this.dgb.ps.instance.scrollbarXWidth + 2;
            if (x > scrollbarXLeft) {
                this.dgb.ps.scrollToX(x);
            }
        }
        else {
            // if (tdRect.x < psContainer.x) {
            //     const x = scrollLeft - tdRect.x;
            //     this.dgb.ps.scrollToX(x);
            // }
            if (td.offsetLeft < scrollLeft) {
                this.dgb.ps.scrollToX(td.offsetLeft);
            }
        }
        /** @type {?} */
        var tdPosTop = tdRect.top - psContainer.top + tdRect.height;
        if (tdPosTop > psContainer.height) {
            /** @type {?} */
            var y = tdPosTop - psContainer.height;
            this.dgb.ps.scrollToY(scrollTop + y);
        }
        else {
            if (tdRect.y < psContainer.y) {
                this.dgb.ps.scrollToY(scrollTop - (psContainer.y - tdRect.y));
            }
        }
    };
    /**
     * @private
     * @param {?=} event
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.moveNextCellAndEdit = /**
     * @private
     * @param {?=} event
     * @return {?}
     */
    function (event) {
        var _this = this;
        // if (!this.closeEditingCell()) {
        //     return;
        // }
        // const fieldIndex = this.dfs.getColumnIndex(this.column.field);
        /** @type {?} */
        var fieldIndex = this.dg.colGroup.columns.findIndex((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return (n.id && n.id === _this.column.id) || n.field === _this.column.field; }));
        if (fieldIndex + 1 < this.dgb.columnsGroup.columns.length) {
            /** @type {?} */
            var nextColumn = this.dgb.columnsGroup.columns[fieldIndex + 1];
            /** @type {?} */
            var nextTd = this.dg.findNextTd(nextColumn);
            if (nextTd && (!nextColumn.fixed || nextColumn.fixed === 'center')) {
                this.moveScrollbar(nextTd);
            }
            // const nextTd = this.dg.currentCell.cellElement.nextElementSibling;
            if (nextColumn && ((!nextColumn.editor && !nextColumn.editorTemplate) || this.isReadonly(nextColumn))) {
                if (nextTd) {
                    nextTd.selectCell(event, nextTd);
                }
                return;
            }
            if (nextTd) {
                nextTd.focus();
                if (nextColumn.editor || nextColumn.editorTemplate) {
                    nextTd.editCell();
                    this.dgs.onCellEdit(nextTd);
                }
            }
        }
        else {
            // next row's first cell to editing
            /** @type {?} */
            var nextTr = this.dg.currentCell.cellElement.parentElement.nextElementSibling;
            if (nextTr && nextTr.tagName === 'TR') {
                // nextTr.children.find(td => td.editCell).editCell();
                /** @type {?} */
                var firstEditor = false;
                /** @type {?} */
                var i = 0;
                while (!firstEditor) {
                    firstEditor = !!nextTr.children[i].editCell;
                    if (!firstEditor) {
                        i++;
                    }
                }
                if (this.dg.selectionMode === 'default') {
                    this.dg.clearCheckeds();
                }
                nextTr.children[i].editCell();
            }
        }
    };
    /**
     * @private
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.movePrevCellAndEdit = /**
     * @private
     * @return {?}
     */
    function () {
        // if (!this.closeEditingCell()) {
        //     return;
        // }
        /** @type {?} */
        var fieldIndex = this.dfs.getColumnIndex(this.column.field);
        if (fieldIndex - 1 >= 0) {
            /** @type {?} */
            var nextColumn = this.dgb.columnsGroup.normalColumns[fieldIndex - 1];
            if (nextColumn && this.isReadonly(nextColumn)) {
                return;
            }
            /** @type {?} */
            var nextTd = this.dg.currentCell.cellElement.previousElementSibling;
            if (nextTd) {
                // this.selectCell(nextColumn.field, nextTd);
                nextTd.focus();
                if (nextColumn.editor) {
                    // this.dfs.editCell();
                    nextTd.click();
                    this.dgs.onCellEdit(nextTd);
                }
            }
        }
    };
    /**
     * @private
     * @param {?} cellFieldName
     * @param {?} dir
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.selectNextRowAndEditCell = /**
     * @private
     * @param {?} cellFieldName
     * @param {?} dir
     * @return {?}
     */
    function (cellFieldName, dir) {
        /** @type {?} */
        var p = dir === 'down' ? 'nextElementSibling' : 'previousElementSibling';
        /** @type {?} */
        var nextTr = this.dg.currentCell.cellElement.parentElement[p];
        if (nextTr && nextTr.tagName === 'TR') {
            /** @type {?} */
            var td = Array.from(nextTr.children).find((/**
             * @param {?} td
             * @return {?}
             */
            function (td) { return td.getAttribute('field') == cellFieldName; }));
            if (td && td.editCell) {
                if (this.dg.selectionMode === 'default') {
                    this.dg.clearCheckeds();
                }
                td.editCell();
            }
        }
    };
    /**
     * @private
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.clearCellSelectedClass = /**
     * @private
     * @return {?}
     */
    function () {
        // if (this.dg.currentCell) {
        //     DomHandler.removeClass(this.dg.currentCell.cellElement, CELL_SELECTED_CLS);
        //     this.render.removeClass(this.dg.currentCell.cellElement, CELL_EDITING_CLS);
        //     const selectedCell = this.dg.el.nativeElement.querySelectorAll('.' + CELL_SELECTED_CLS);
        //     if (selectedCell.length) {
        //         selectedCell.forEach(n => {
        //             this.render.removeClass(n, CELL_SELECTED_CLS);
        //         });
        //     }
        // }
        this.dg.removeCellSelectedCls();
    };
    /**
     * @private
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.setCellClsWithEditorType = /**
     * @private
     * @return {?}
     */
    function () {
        // 设置当前选中单元格样式
        if (this.dg.currentCell && this.dg.enableHighlightCell) {
            if (this.dg.currentCell.field === this.column.field && this.dg.currentCell.rowId === this.rowData[this.dg.idField] && !this.dc.isEditing) {
                this.clearCellSelectedClass();
                this.render.addClass(this.el.nativeElement, CELL_SELECTED_CLS);
            }
        }
        if (!this.dg.enableEditCellStyle) {
            return;
        }
        /** @type {?} */
        var td = this.el.nativeElement;
        this.cleanOtherEditorIcon(td);
        // 当前行禁用，不允许编辑。
        if (this.dr.disabled) {
            return;
        }
        if (!this.column.editor) {
            return;
        }
        if (this.isReadonly()) {
            return;
        }
        /** @type {?} */
        var editorType = this.column.editor.type;
        /** @type {?} */
        var cls = this.column.align === 'right' ? 'allow-edit-cell-left' : 'allow-edit-cell';
        this.render.addClass(td, cls);
        this.render.addClass(td, ALLOW_EDIT_CELL_HIGHLIGHT_CLS[editorType]);
    };
    /**
     * @private
     * @param {?} td
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.cleanOtherEditorIcon = /**
     * @private
     * @param {?} td
     * @return {?}
     */
    function (td) {
        /** @type {?} */
        var values = Object.values(ALLOW_EDIT_CELL_HIGHLIGHT_CLS);
        values.forEach((/**
         * @param {?} v
         * @return {?}
         */
        function (v) {
            if (td.className.indexOf(v) > -1) {
                td.className = td.className.replace('allow-edit-cell-left', '').replace('allow-edit-cell', '');
                td.className = td.className.replace(v, '');
            }
        }));
    };
    DatagridCellEditableDirective.decorators = [
        { type: Directive, args: [{
                    selector: '[cell-editable]',
                    exportAs: 'cellEditable'
                },] }
    ];
    /** @nocollapse */
    DatagridCellEditableDirective.ctorParameters = function () { return [
        { type: Injector },
        { type: ElementRef },
        { type: Renderer2 },
        { type: DatagridComponent, decorators: [{ type: Inject, args: [forwardRef((/**
                         * @return {?}
                         */
                        function () { return DatagridComponent; })),] }] },
        { type: NgZone }
    ]; };
    DatagridCellEditableDirective.propDecorators = {
        rowData: [{ type: Input, args: ['cell-editable',] }],
        column: [{ type: Input }],
        dc: [{ type: ContentChild, args: [DatagridCellComponent,] }]
    };
    return DatagridCellEditableDirective;
}());
export { DatagridCellEditableDirective };
if (false) {
    /** @type {?} */
    DatagridCellEditableDirective.prototype.rowData;
    /** @type {?} */
    DatagridCellEditableDirective.prototype.column;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.clickTimer;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.cellclick;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.celldblclick;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.bindCellEventSubscription;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.editorInputKeydownEvent;
    /** @type {?} */
    DatagridCellEditableDirective.prototype.editor;
    /** @type {?} */
    DatagridCellEditableDirective.prototype.formControl;
    /** @type {?} */
    DatagridCellEditableDirective.prototype.cellEditorRef;
    /** @type {?} */
    DatagridCellEditableDirective.prototype.dc;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.dgb;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.dr;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.dfs;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.dgs;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.cellEditorCreatedSubscription;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.cellEditorDestorySubscription;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.destroy$;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.validMessageEle;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.injector;
    /** @type {?} */
    DatagridCellEditableDirective.prototype.el;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.render;
    /** @type {?} */
    DatagridCellEditableDirective.prototype.dg;
    /** @type {?} */
    DatagridCellEditableDirective.prototype.ngZone;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YWdyaWQtY2VsbC1lZGl0YWJsZS5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWRhdGFncmlkLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvYm9keS9kYXRhZ3JpZC1jZWxsLWVkaXRhYmxlLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFRQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFVLFlBQVksRUFBYSxRQUFRLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBaUIsTUFBTSxFQUE0QixNQUFNLGVBQWUsQ0FBQztBQUV4TCxPQUFPLEVBQUUsTUFBTSxFQUE0QixZQUFZLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDM0YsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG1DQUFtQyxDQUFDO0FBQ3BFLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ2xFLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ2xFLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBRWhFLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLHdDQUF3QyxDQUFDO0FBQy9FLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQzdELE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxnQkFBZ0IsRUFBRSw2QkFBNkIsRUFBMkIsTUFBTSxzQkFBc0IsQ0FBQztBQUVuSSxPQUFPLEVBQUUsRUFBRSxFQUFpQixJQUFJLEVBQUUsT0FBTyxFQUFHLE1BQU0sTUFBTSxDQUFDO0FBQ3pELE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUUxQztJQThDSSx1Q0FDWSxRQUFrQixFQUFTLEVBQWMsRUFBVSxNQUFpQixFQUN4QixFQUFxQixFQUFTLE1BQWM7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SUFFaEQsZ0VBQXFDOztJQUNyQywrQ0FBWTs7SUFDWixvREFBeUI7O0lBQ3pCLHNEQUFtQjs7SUFpQm5CLDJDQUErRDs7Ozs7SUFDL0QsNENBQW1DOzs7OztJQUNuQywyQ0FBaUM7Ozs7O0lBQ2pDLDRDQUFtQzs7Ozs7SUFDbkMsNENBQTZCOzs7OztJQUc3QixzRUFBNkM7Ozs7O0lBQzdDLHNFQUE2Qzs7Ozs7SUFDN0MsaURBQWlDOzs7OztJQUVqQyx3REFBK0I7Ozs7O0lBRTNCLGlEQUEwQjs7SUFBRSwyQ0FBcUI7Ozs7O0lBQUUsK0NBQXlCOztJQUM1RSwyQ0FBeUU7O0lBQUUsK0NBQXFCIiwic291cmNlc0NvbnRlbnQiOlsiLypcclxuICogQEF1dGhvcjog55av54uC56eA5omNKEx1Y2FzIEh1YW5nKVxyXG4gKiBARGF0ZTogMjAxOS0wOC0wNiAwNzo0MzowN1xyXG4gKiBATGFzdEVkaXRvcnM6IOeWr+eLguengOaJjShMdWNhcyBIdWFuZylcclxuICogQExhc3RFZGl0VGltZTogMjAxOS0xMS0xOSAxNTo0ODoyN1xyXG4gKiBAUVE6IDEwNTU4MTgyMzlcclxuICogQFZlcnNpb246IHYwLjAuMVxyXG4gKi9cclxuaW1wb3J0IHsgRGlyZWN0aXZlLCBJbnB1dCwgRWxlbWVudFJlZiwgUmVuZGVyZXIyLCBPbkluaXQsIENvbnRlbnRDaGlsZCwgT25EZXN0cm95LCBJbmplY3RvciwgZm9yd2FyZFJlZiwgSW5qZWN0LCBBZnRlclZpZXdJbml0LCBOZ1pvbmUsIE9uQ2hhbmdlcywgU2ltcGxlQ2hhbmdlcyB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBGb3JtQ29udHJvbCB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcclxuaW1wb3J0IHsgZmlsdGVyLCBtYXAsIHN3aXRjaE1hcCwgdGFrZUxhc3QsIGRlYm91bmNlVGltZSwgdGFrZVVudGlsIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZFNlcnZpY2UgfSBmcm9tICcuLy4uLy4uL3NlcnZpY2VzL2RhdGFncmlkLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZENlbGxDb21wb25lbnQgfSBmcm9tICcuL2RhdGFncmlkLWNlbGwuY29tcG9uZW50JztcclxuaW1wb3J0IHsgRGF0YWdyaWRCb2R5Q29tcG9uZW50IH0gZnJvbSAnLi9kYXRhZ3JpZC1ib2R5LmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IERhdGFncmlkUm93RGlyZWN0aXZlIH0gZnJvbSAnLi9kYXRhZ3JpZC1yb3cuZGlyZWN0aXZlJztcclxuaW1wb3J0IHsgRGF0YUNvbHVtbiB9IGZyb20gJy4vLi4vLi4vdHlwZXMvZGF0YS1jb2x1bW4nO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZEZhY2FkZVNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9kYXRhZ3JpZC1mYWNhZGUuc2VydmljZSc7XHJcbmltcG9ydCB7IERhdGFncmlkQ29tcG9uZW50IH0gZnJvbSAnLi4vLi4vZGF0YWdyaWQuY29tcG9uZW50JztcclxuaW1wb3J0IHsgQ0VMTF9TRUxFQ1RFRF9DTFMsIENFTExfRURJVElOR19DTFMsIEFMTE9XX0VESVRfQ0VMTF9ISUdITElHSFRfQ0xTLCBUUl9QUkVGSVgsIFRSX0lEX1BSRUZJWCB9IGZyb20gJy4uLy4uL3R5cGVzL2NvbnN0YW50JztcclxuaW1wb3J0IHsgRG9tSGFuZGxlciB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL2RvbWhhbmRsZXInO1xyXG5pbXBvcnQgeyBvZiwgU3Vic2NyaXB0aW9uLCAgbm9vcCwgU3ViamVjdCAgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgVXRpbHMgfSBmcm9tICcuLi8uLi91dGlscy91dGlscyc7XHJcblxyXG5ARGlyZWN0aXZlKHtcclxuICAgIHNlbGVjdG9yOiAnW2NlbGwtZWRpdGFibGVdJyxcclxuICAgIGV4cG9ydEFzOiAnY2VsbEVkaXRhYmxlJ1xyXG59KVxyXG5leHBvcnQgY2xhc3MgRGF0YWdyaWRDZWxsRWRpdGFibGVEaXJlY3RpdmUgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSwgT25DaGFuZ2VzLCBBZnRlclZpZXdJbml0IHtcclxuICAgIEBJbnB1dCgnY2VsbC1lZGl0YWJsZScpIHJvd0RhdGE6IGFueTtcclxuICAgIEBJbnB1dCgpIGNvbHVtbjogRGF0YUNvbHVtbjtcclxuXHJcbiAgICBwcml2YXRlIGNsaWNrVGltZXI6IGFueTtcclxuXHJcbiAgICBwcml2YXRlIGNlbGxjbGljazogYW55O1xyXG4gICAgcHJpdmF0ZSBjZWxsZGJsY2xpY2s6IGFueTtcclxuICAgIHByaXZhdGUgYmluZENlbGxFdmVudFN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xyXG5cclxuICAgIHByaXZhdGUgZWRpdG9ySW5wdXRLZXlkb3duRXZlbnQ6IGFueTtcclxuICAgIGVkaXRvcjogYW55O1xyXG4gICAgZm9ybUNvbnRyb2w6IEZvcm1Db250cm9sO1xyXG4gICAgY2VsbEVkaXRvclJlZjogYW55O1xyXG4gICAgLy8gZ2V0IGVkaXRvcigpIHtcclxuICAgIC8vICAgICBpZiAodGhpcy5kYy5jZWxsRWRpdG9yKSB7XHJcbiAgICAvLyAgICAgICAgIGNvbnN0IF9lZGl0b3IgPSB0aGlzLmRjLmNlbGxFZGl0b3IuY29tcG9uZW50UmVmLmluc3RhbmNlO1xyXG4gICAgLy8gICAgICAgICB0aGlzLmRnLnBlbmRpbmcgPSBfZWRpdG9yLnBlbmRpbmc7XHJcbiAgICAvLyAgICAgICAgIHJldHVybiBfZWRpdG9yO1xyXG4gICAgLy8gICAgIH1cclxuICAgIC8vICAgICByZXR1cm4gbnVsbDtcclxuICAgIC8vIH1cclxuXHJcbiAgICAvLyBnZXQgZm9ybUNvbnRyb2woKSB7XHJcbiAgICAvLyAgICAgaWYgKHRoaXMuZWRpdG9yKSB7XHJcbiAgICAvLyAgICAgICAgIHJldHVybiB0aGlzLmVkaXRvci5mb3JtQ29udHJvbCBhcyBGb3JtQ29udHJvbDtcclxuICAgIC8vICAgICB9XHJcbiAgICAvLyAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAvLyB9XHJcblxyXG4gICAgQENvbnRlbnRDaGlsZChEYXRhZ3JpZENlbGxDb21wb25lbnQpIGRjOiBEYXRhZ3JpZENlbGxDb21wb25lbnQ7XHJcbiAgICBwcml2YXRlIGRnYjogRGF0YWdyaWRCb2R5Q29tcG9uZW50O1xyXG4gICAgcHJpdmF0ZSBkcjogRGF0YWdyaWRSb3dEaXJlY3RpdmU7XHJcbiAgICBwcml2YXRlIGRmczogRGF0YWdyaWRGYWNhZGVTZXJ2aWNlO1xyXG4gICAgcHJpdmF0ZSBkZ3M6IERhdGFncmlkU2VydmljZTtcclxuXHJcbiAgICAvLyBwcml2YXRlIF9yZWFkb25seSQgPSBudWxsO1xyXG4gICAgcHJpdmF0ZSBjZWxsRWRpdG9yQ3JlYXRlZFN1YnNjcmlwdGlvbiA9IG51bGw7XHJcbiAgICBwcml2YXRlIGNlbGxFZGl0b3JEZXN0b3J5U3Vic2NyaXB0aW9uID0gbnVsbDtcclxuICAgIHByaXZhdGUgZGVzdHJveSQgPSBuZXcgU3ViamVjdCgpO1xyXG5cclxuICAgIHByaXZhdGUgdmFsaWRNZXNzYWdlRWxlID0gbnVsbDtcclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yLCBwdWJsaWMgZWw6IEVsZW1lbnRSZWYsIHByaXZhdGUgcmVuZGVyOiBSZW5kZXJlcjIsXHJcbiAgICAgICAgQEluamVjdChmb3J3YXJkUmVmKCgpID0+IERhdGFncmlkQ29tcG9uZW50KSkgcHVibGljIGRnOiBEYXRhZ3JpZENvbXBvbmVudCwgcHVibGljIG5nWm9uZTogTmdab25lKSB7XHJcbiAgICAgICAgdGhpcy5kZ2IgPSB0aGlzLmluamVjdG9yLmdldChEYXRhZ3JpZEJvZHlDb21wb25lbnQpO1xyXG4gICAgICAgIHRoaXMuZHIgPSB0aGlzLmluamVjdG9yLmdldChEYXRhZ3JpZFJvd0RpcmVjdGl2ZSk7XHJcbiAgICAgICAgdGhpcy5kZnMgPSB0aGlzLmluamVjdG9yLmdldChEYXRhZ3JpZEZhY2FkZVNlcnZpY2UpO1xyXG4gICAgICAgIHRoaXMuZGdzID0gdGhpcy5pbmplY3Rvci5nZXQoRGF0YWdyaWRTZXJ2aWNlKTtcclxuXHJcblxyXG4gICAgICAgIGlmICghdGhpcy5jZWxsRWRpdG9yQ3JlYXRlZFN1YnNjcmlwdGlvbikge1xyXG4gICAgICAgICAgICB0aGlzLmNlbGxFZGl0b3JDcmVhdGVkU3Vic2NyaXB0aW9uID0gdGhpcy5kZ3MuY2VsbEVkaXRvckNyZWF0ZWQucGlwZShcclxuICAgICAgICAgICAgICAgIHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKVxyXG4gICAgICAgICAgICApLnBpcGUoXHJcbiAgICAgICAgICAgICAgICBmaWx0ZXIoKHsgY29sdW1uLCBlZGl0b3JSZWYsIGNlbGxFZGl0b3JSZWYsIHRlbXBsYXRlUmVmIH0pID0+IHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29sdW1uLmZpZWxkID09PSB0aGlzLmNvbHVtbi5maWVsZCAmJiB0aGlzLmRnLnNlbGVjdGVkUm93LmlkID09PSB0aGlzLmRyLnJvd0lkO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgKS5zdWJzY3JpYmUoKHsgZWRpdG9yUmVmLCBjZWxsRWRpdG9yUmVmLCB0ZW1wbGF0ZVJlZiB9KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZWRpdG9yUmVmKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpc1snZWRpdG9yJ10gPSBlZGl0b3JSZWYuaW5zdGFuY2U7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpc1snZm9ybUNvbnRyb2wnXSA9IHRoaXMuZWRpdG9yLmZvcm1Db250cm9sIGFzIEZvcm1Db250cm9sO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2VsbEVkaXRvclJlZiA9IGNlbGxFZGl0b3JSZWY7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0QmVnaW5FZGl0KCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXNbJ2Zvcm1Db250cm9sJ10gPSB0aGlzLmRyLmZvcm0uZ2V0KHRoaXMuY29sdW1uLmZpZWxkKSBhcyBGb3JtQ29udHJvbDtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmJpbmRFZGl0b3JJbnB1dEV2ZW50KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZy5iZWdpbkVkaXQuZW1pdCh7IGVkaXRvcjogbnVsbCwgY29sdW1uOiB0aGlzLmNvbHVtbiwgcm93RGF0YTogdGhpcy5yb3dEYXRhLCBncmlkSW5zdGFuY2U6IHRoaXMuZGcsIHRlbXBsYXRlOiB0ZW1wbGF0ZVJlZiB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmRnLmRncy5jZWxsRWRpdG9yRGVzdG9yeS5waXBlKFxyXG4gICAgICAgICAgICB0YWtlVW50aWwodGhpcy5kZXN0cm95JClcclxuICAgICAgICApLnBpcGUoXHJcbiAgICAgICAgICAgIGZpbHRlcigoeyBjb2x1bW4gfSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGcuc2VsZWN0ZWRSb3cgJiYgY29sdW1uLmZpZWxkID09PSB0aGlzLmNvbHVtbi5maWVsZCAmJiB0aGlzLmRnLnNlbGVjdGVkUm93LmlkID09PSB0aGlzLmRyLnJvd0lkO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICkuc3Vic2NyaWJlKChlOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZGcuZWRpdE1vZGUgPT09ICdjZWxsJykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kZy5zZWxlY3RlZFJvdy5lZGl0b3JzID0gW107XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kZy5jdXJyZW50Q2VsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGcuY3VycmVudENlbGwuZWRpdG9yID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRnLmN1cnJlbnRDZWxsLmNlbGxFZGl0b3JSZWYgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMudW5CaW5kRWRpdG9ySW5wdXRFdmVudCgpO1xyXG4gICAgICAgICAgICB0aGlzLmNlbGxFZGl0b3JSZWYgPSBudWxsO1xyXG4gICAgICAgICAgICB0aGlzLmZvcm1Db250cm9sID0gbnVsbDtcclxuICAgICAgICAgICAgdGhpcy5lZGl0b3IgPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5yZW1vdmVWYWxpZE1lc3NhZ2UoKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKSB7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xyXG4gICAgICAgIGlmIChjaGFuZ2VzLnJvd0RhdGEgJiYgIWNoYW5nZXMucm93RGF0YS5pc0ZpcnN0Q2hhbmdlKCkpIHtcclxuICAgICAgICAgICAgdGhpcy5zZXRDZWxsQ2xzV2l0aEVkaXRvclR5cGUoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbmdBZnRlclZpZXdJbml0KCkge1xyXG4gICAgICAgIHRoaXMuaW5pdENlbGxFdmVudCgpO1xyXG4gICAgICAgIHRoaXMuc2V0Q2VsbENsc1dpdGhFZGl0b3JUeXBlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBpbml0Q2VsbEV2ZW50KCkge1xyXG4gICAgICAgIC8vIHRoaXMuY2VsbGNsaWNrID0gdGhpcy5yZW5kZXIubGlzdGVuKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgJ2NsaWNrJywgKGUpID0+IHRoaXMub25DbGlja0NlbGwoZSkpO1xyXG4gICAgICAgIGlmICh0aGlzLmNvbHVtbiAmJiAodGhpcy5jb2x1bW4uZWRpdG9yIHx8IHRoaXMuY29sdW1uLmVkaXRvclRlbXBsYXRlKSkge1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuZGcuY2xpY2tUb0VkaXQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2VsbGRibGNsaWNrID0gdGhpcy5yZW5kZXIubGlzdGVuKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgJ2RibGNsaWNrJywgKGUpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm9uRGJsQ2xpY2tDZWxsKGUpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5lbC5uYXRpdmVFbGVtZW50LmVkaXQgPSAoZSkgPT4gdGhpcy5vbkNsaWNrQ2VsbChlKTtcclxuICAgICAgICAgICAgdGhpcy5lbC5uYXRpdmVFbGVtZW50LmVkaXRDZWxsID0gKGUpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMub3BlbkNlbGxFZGl0b3IoKTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmNsaWNrVGltZXIgPSAwO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuZ3JpZENlbGxEYXRhID0geyByb3dEYXRhOiB0aGlzLnJvd0RhdGEsIHJvd0luZGV4OiB0aGlzLmRyLnJvd0luZGV4IH07XHJcbiAgICAgICAgdGhpcy5lbC5uYXRpdmVFbGVtZW50LmNsb3NlRWRpdCA9ICgpID0+IHRoaXMuY2xvc2VFZGl0aW5nQ2VsbCgpO1xyXG4gICAgICAgIHRoaXMuZWwubmF0aXZlRWxlbWVudC5zZWxlY3RDZWxsID0gKGUsIGVsKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmRnLmRpc2FibGVSb3cgJiYgdGhpcy5kZy5kaXNhYmxlUm93KHRoaXMucm93RGF0YSwgdGhpcy5kci5yb3dJbmRleCkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuZGcuY3VycmVudENlbGwgJiYgdGhpcy5kZy5jdXJyZW50Q2VsbC5jZWxsRWxlbWVudC5pZCA9PT0gZWwuaWQgJiYgIXRoaXMuZGcua2VlcFNlbGVjdCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kZy5jYW5jZWxTZWxlY3RDZWxsKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdENlbGwodGhpcy5jb2x1bW4uZmllbGQsIGVsKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGcuY2VsbENsaWNrLmVtaXQoeyBjb2x1bW46IHRoaXMuY29sdW1uLCByb3dEYXRhOiB0aGlzLnJvd0RhdGEsIGdyaWRJbnN0YW5jZTogdGhpcy5kZywgZXZlbnQ6IGUgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIHRoaXMuZWwubmF0aXZlRWxlbWVudC5jYW5jZWxTZWxlY3RlZCA9ICgpID0+IHtcclxuICAgICAgICAgICAgLy8gRG9tSGFuZGxlci5yZW1vdmVDbGFzcyh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsIENFTExfU0VMRUNURURfQ0xTKTtcclxuICAgICAgICAgICAgLy8gRG9tSGFuZGxlci5yZW1vdmVDbGFzcyh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsIENFTExfRURJVElOR19DTFMpO1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlci5yZW1vdmVDbGFzcyh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsIENFTExfU0VMRUNURURfQ0xTKTtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXIucmVtb3ZlQ2xhc3ModGhpcy5lbC5uYXRpdmVFbGVtZW50LCBDRUxMX0VESVRJTkdfQ0xTKTtcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25EZXN0cm95KCkge1xyXG4gICAgICAgIHRoaXMuZGVzdHJveSQubmV4dCgpO1xyXG4gICAgICAgIHRoaXMuZGVzdHJveSQuY29tcGxldGUoKTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuY2VsbGNsaWNrKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2VsbGNsaWNrKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5jZWxsZGJsY2xpY2spIHtcclxuICAgICAgICAgICAgdGhpcy5jZWxsZGJsY2xpY2soKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMudW5CaW5kRWRpdG9ySW5wdXRFdmVudCgpO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5iaW5kQ2VsbEV2ZW50U3Vic2NyaXB0aW9uKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYmluZENlbGxFdmVudFN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICB0aGlzLmJpbmRDZWxsRXZlbnRTdWJzY3JpcHRpb24gPSBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuY2VsbEVkaXRvckNyZWF0ZWRTdWJzY3JpcHRpb24pIHtcclxuICAgICAgICAgICAgdGhpcy5jZWxsRWRpdG9yQ3JlYXRlZFN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICB0aGlzLmNlbGxFZGl0b3JDcmVhdGVkU3Vic2NyaXB0aW9uID0gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmNlbGxFZGl0b3JEZXN0b3J5U3Vic2NyaXB0aW9uKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2VsbEVkaXRvckRlc3RvcnlTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgdGhpcy5jZWxsRWRpdG9yRGVzdG9yeVN1YnNjcmlwdGlvbiA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmVkaXRvciA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5jZWxsRWRpdG9yUmVmID0gbnVsbDtcclxuICAgICAgICB0aGlzLmZvcm1Db250cm9sID0gbnVsbDtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZWwpIHtcclxuICAgICAgICAgICAgdGhpcy5lbC5uYXRpdmVFbGVtZW50LmNhbmNlbFNlbGVjdGVkID0gbm9vcDtcclxuICAgICAgICAgICAgdGhpcy5lbC5uYXRpdmVFbGVtZW50LnNlbGVjdENlbGwgPSBub29wO1xyXG4gICAgICAgICAgICB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuY2xvc2VFZGl0ID0gbm9vcDtcclxuICAgICAgICAgICAgdGhpcy5lbC5uYXRpdmVFbGVtZW50LmdyaWRDZWxsRGF0YSA9IG5vb3A7XHJcbiAgICAgICAgICAgIHRoaXMuZWwubmF0aXZlRWxlbWVudC5lZGl0ID0gbm9vcDtcclxuICAgICAgICAgICAgdGhpcy5lbC5uYXRpdmVFbGVtZW50LnNlbGVjdENlbGwgPSBub29wO1xyXG4gICAgICAgICAgICB0aGlzLmVsID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBpc0RpZmZlcmVudENlbGwoKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmRnLmN1cnJlbnRDZWxsKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5kZy5zZWxlY3RlZFJvdyB8fCB0aGlzLmRnLnNlbGVjdGVkUm93LmluZGV4ICE9PSB0aGlzLmRyLnJvd0luZGV4KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRyLnJvd0luZGV4ICE9PSB0aGlzLmRnLmN1cnJlbnRDZWxsLnJvd0luZGV4KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmRnLmN1cnJlbnRDZWxsLmZpZWxkICE9PSB0aGlzLmNvbHVtbi5maWVsZDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIG9uQ2xpY2tDZWxsKGV2ZW50OiBhbnkpIHtcclxuICAgICAgICAvLyDlhbPpl63lhbbku5ZHcmlkIOeahOe8lui+keWZqFxyXG4gICAgICAgIGRvY3VtZW50LmJvZHkuY2xpY2soKTtcclxuXHJcbiAgICAgICAgdGhpcy5kZy5iZWZvcmVDbGlja0NlbGwuZW1pdCh7IHJvd0luZGV4OiB0aGlzLmRyLnJvd0luZGV4LCByb3dEYXRhOiB0aGlzLnJvd0RhdGEsIGNvbHVtbjogdGhpcy5jb2x1bW4sIGdyaWRJbnN0YW5jZTogdGhpcy5kZyB9KTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZHIuZGlzYWJsZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gMjAyMTA0MjJcclxuICAgICAgICAvLyBpZiAodGhpcy5kZy5jbG9zZU90aGVyR3JpZEVkaXRvcikge1xyXG4gICAgICAgIC8vICAgICBkb2N1bWVudC5ib2R5LmNsaWNrKCk7XHJcbiAgICAgICAgLy8gfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5kZy5kaXNhYmxlZCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLmRnLmVkaXRhYmxlIHx8IHRoaXMuaXNSZWFkb25seSgpKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kZy5lbmFibGVIaWdobGlnaHRDZWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZy5lbmRFZGl0aW5nKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RDZWxsKHRoaXMuY29sdW1uLmZpZWxkKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRnLmVkaXRNb2RlID09PSAncm93Jykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZGcuc2VsZWN0aW9uTW9kZSA9PT0gJ2RlZmF1bHQnICYmIGV2ZW50KSB7XHJcbiAgICAgICAgICAgIGlmIChldmVudC5jdHJsS2V5IHx8IGV2ZW50LnNoaWZ0S2V5KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICBpZiAoZXZlbnQudGFyZ2V0Wydub2RlTmFtZSddID09PSAnSU5QVVQnKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAvLyBpZiAodGhpcy5kZy5jbGlja1RvRWRpdCAmJiAhdGhpcy5kZy5kYmxjbGlja1Jvdy5vYnNlcnZlcnMubGVuZ3RoKSB7XHJcbiAgICAgICAgLy8gICAgIHRoaXMuZGcuY2xpY2tEZWxheSA9IDA7XHJcbiAgICAgICAgLy8gfVxyXG5cclxuXHJcbiAgICAgICAgdGhpcy5yZW5kZXIuYWRkQ2xhc3ModGhpcy5kZy5lbC5uYXRpdmVFbGVtZW50LCAnZi1kYXRhZ3JpZC11bnNlbGVjdCcpO1xyXG5cclxuICAgICAgICBpZiAoIXRoaXMuZGcuaXNTaW5nbGVDbGljayAmJiB0aGlzLmRnLmVkaXRNb2RlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGcuaXNTaW5nbGVDbGljayA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5jbGlja1RpbWVyKSB7XHJcbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5jbGlja1RpbWVyKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5jbGlja1RpbWVyID0gc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kZy5pc1NpbmdsZUNsaWNrICYmIHRoaXMuZGcuZWRpdGFibGUgJiYgdGhpcy5kZy5lZGl0TW9kZSA9PT0gJ2NlbGwnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZy5pc1NpbmdsZUNsaWNrID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuY2xpY2tUaW1lcik7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgKCF0aGlzLmNsb3NlRWRpdGluZ0NlbGwoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gfVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VFZGl0aW5nQ2VsbCgpLnBpcGUoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKVxyXG4gICAgICAgICAgICAgICAgICAgICkuc3Vic2NyaWJlKChmOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGYpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmRnLmNsaWNrVG9FZGl0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vcGVuQ2VsbEVkaXRvcigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdENlbGwodGhpcy5jb2x1bW4uZmllbGQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIucmVtb3ZlQ2xhc3ModGhpcy5kZy5lbC5uYXRpdmVFbGVtZW50LCAnZi1kYXRhZ3JpZC11bnNlbGVjdCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCB0aGlzLmRnLmNsaWNrRGVsYXkpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIG9uRGJsQ2xpY2tDZWxsKGV2ZW50OiBNb3VzZUV2ZW50KSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZGcuZGlzYWJsZWQgfHwgdGhpcy5pc1JlYWRvbmx5KCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGV2ZW50LnRhcmdldFsnbm9kZU5hbWUnXSA9PT0gJ0lOUFVUJyB8fCBldmVudC50YXJnZXRbJ25vZGVOYW1lJ10gPT09ICdURVhUQVJFQScpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5kZy5lZGl0YWJsZSAmJiB0aGlzLmRnLmVkaXRNb2RlID09PSAnY2VsbCcpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuY2xpY2tUaW1lcikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kZy5pc1NpbmdsZUNsaWNrID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5jbGlja1RpbWVyKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2xpY2tUaW1lciA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHRoaXMuY2xvc2VFZGl0aW5nQ2VsbCgpLnBpcGUodGFrZVVudGlsKHRoaXMuZGVzdHJveSQpKS5zdWJzY3JpYmUoZiA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZikge1xyXG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9wZW5DZWxsRWRpdG9yKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICBcclxuICAgIH1cclxuXHJcbiAgICBpc1JlYWRvbmx5KGNvbCA9IHRoaXMuY29sdW1uKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZGcuZWRpdGFibGUpIHtcclxuICAgICAgICAgICAgLy8g5Y+C5LiO5ZCI5bm255qE5Y2V5YWD5qC85LiN5YWB6K6457yW6L6RXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmRnLm1lcmdlQ2VsbCAmJiB0aGlzLmRnLm1lcmdlRmllbGRzLmluZGV4T2YoY29sLmZpZWxkKSA+IC0xKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRSZWFkb25seVZhbHVlKGNvbCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0UmVhZG9ubHlWYWx1ZShjb2wgPSB0aGlzLmNvbHVtbikge1xyXG4gICAgICAgIGlmIChjb2wucmVhZG9ubHkgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIGNvbC5yZWFkb25seSA9PT0gJ2Jvb2xlYW4nKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY29sLnJlYWRvbmx5O1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBjb2wucmVhZG9ubHkgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBjb2wucmVhZG9ubHkodGhpcy5yb3dEYXRhKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgb3BlbkNlbGxFZGl0b3IoKSB7XHJcbiAgICAgICAgLy8g5b2T5YmN6KGM56aB55So77yM5LiN5YWB6K6457yW6L6R44CCXHJcbiAgICAgICAgaWYgKHRoaXMuZHIuZGlzYWJsZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCghdGhpcy5jb2x1bW4uZWRpdG9yICYmICF0aGlzLmNvbHVtbi5lZGl0b3JUZW1wbGF0ZSkgfHwgIXRoaXMuZGcuZWRpdGFibGUgfHwgdGhpcy5pc1JlYWRvbmx5KCkpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZGcuc2VsZWN0aW9uTW9kZSA9PT0gJ2RlZmF1bHQnICYmIHRoaXMuZGcubXVsdGlTZWxlY3QpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGcuY2xlYXJDaGVja2VkcygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0Q2VsbCh0aGlzLmNvbHVtbi5maWVsZCk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGJlZm9yZUVkaXRFdmVudCA9IHRoaXMuZGcuYmVmb3JlRWRpdCh7IHJvd0luZGV4OiB0aGlzLmRyLnJvd0luZGV4LCByb3dEYXRhOiB0aGlzLnJvd0RhdGEsIGNvbHVtbjogdGhpcy5jb2x1bW4sIGdyaWRJbnN0YW5jZTogdGhpcy5kZyB9KTtcclxuICAgICAgICBpZiAoIWJlZm9yZUVkaXRFdmVudCB8fCAhYmVmb3JlRWRpdEV2ZW50LnN1YnNjcmliZSkge1xyXG4gICAgICAgICAgICB0aGlzLmRnLndyaXRlQ29uc29sZSgncGxlYXNlIHJldHVybiBhbiBPYnNlcnZhYmxlIFR5cGUuJyk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmRnLmN1cnJlbnRDZWxsKSB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5kZy5jdXJyZW50Q2VsbC5jZWxsUmVmIHx8IHRoaXMuZGcuY3VycmVudENlbGwuY2VsbFJlZi5jb2x1bW4uZmllbGQgIT09IHRoaXMuY29sdW1uLmZpZWxkKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRnLmN1cnJlbnRDZWxsLmNlbGxSZWYgPSB0aGlzLmRjO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgYmVmb3JlRWRpdEV2ZW50LnBpcGUodGFrZVVudGlsKHRoaXMuZGVzdHJveSQpKS5zdWJzY3JpYmUoKGZsYWcpID0+IHtcclxuICAgICAgICAgICAgaWYgKGZsYWcpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzRGlmZmVyZW50Q2VsbCgpKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmRnLnNlbGVjdGlvbk1vZGUgPT09ICdkZWZhdWx0JyAmJiB0aGlzLmRnLm11bHRpU2VsZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGcuY2xlYXJDaGVja2VkcygpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RDZWxsKHRoaXMuY29sdW1uLmZpZWxkKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRoaXMuZGZzLmVkaXRDZWxsKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdENlbGwodGhpcy5jb2x1bW4uZmllbGQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBlbWl0QmVnaW5FZGl0KCkge1xyXG5cclxuICAgICAgICBjb25zdCBfY2VsbEVkaXRvclJlZiA9IHRoaXMuY2VsbEVkaXRvclJlZiB8fCB0aGlzLmRjLmNlbGxFZGl0b3I7XHJcblxyXG4gICAgICAgIHRoaXMucmVuZGVyLnJlbW92ZUNsYXNzKHRoaXMuZGcuZWwubmF0aXZlRWxlbWVudCwgJ2YtZGF0YWdyaWQtdW5zZWxlY3QnKTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZGcuZWRpdE1vZGUgPT09ICdjZWxsJykge1xyXG4gICAgICAgICAgICB0aGlzLmRnLnNlbGVjdGVkUm93LmVkaXRvcnMgPSBbdGhpcy5lZGl0b3JdO1xyXG4gICAgICAgICAgICB0aGlzLmRnLmN1cnJlbnRDZWxsLmVkaXRvciA9IHRoaXMuZWRpdG9yO1xyXG4gICAgICAgICAgICB0aGlzLmRnLmN1cnJlbnRDZWxsLmNlbGxFZGl0b3JSZWYgPSBfY2VsbEVkaXRvclJlZjtcclxuICAgICAgICAgICAgdGhpcy5iaW5kRWRpdG9ySW5wdXRFdmVudCgpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5yZW5kZXIuYWRkQ2xhc3ModGhpcy5lbC5uYXRpdmVFbGVtZW50LCBDRUxMX0VESVRJTkdfQ0xTKTtcclxuXHJcbiAgICAgICAgICAgIC8vIHRoaXMuZm9ybUNvbnRyb2wuc2V0VmFsdWUodGhpcy5kYy52YWx1ZSk7XHJcbiAgICAgICAgICAgIHRoaXMuZGcuYmVnaW5FZGl0LmVtaXQoeyBlZGl0b3I6IF9jZWxsRWRpdG9yUmVmLCBjb2x1bW46IHRoaXMuY29sdW1uLCByb3dEYXRhOiB0aGlzLnJvd0RhdGEsIGdyaWRJbnN0YW5jZTogdGhpcy5kZyB9KTtcclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbHVtbi5lZGl0b3IudHlwZSA9PT0gJ3RleHRhcmVhJyAmJiB0aGlzLmNvbHVtbi5lZGl0b3Iub3B0aW9ucyAmJiB0aGlzLmNvbHVtbi5lZGl0b3Iub3B0aW9ucy5lZGl0VHlwZSA9PT0gJ2RpYWxvZycpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZWRpdG9yLnNob3dEaWFsb2coKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZHIgJiYgIXRoaXMuZGcubm93cmFwKSB7XHJcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kci51cGRhdGVSb3dIZWlnaHQoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5lZGl0b3IpIHtcclxuICAgICAgICAgICAgdGhpcy52YWxpZE1lc3NhZ2VFbGUgPSB0aGlzLnNob3dWYWxpZE1lc3NhZ2UoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmVtb3ZlVmFsaWRNZXNzYWdlKCkge1xyXG4gICAgICAgIC8vIOenu+mZpOmqjOivgeS/oeaBr1xyXG4gICAgICAgIGlmICh0aGlzLnZhbGlkTWVzc2FnZUVsZSkge1xyXG4gICAgICAgICAgICB0aGlzLnZhbGlkTWVzc2FnZUVsZS5yZW1vdmUoKTtcclxuICAgICAgICAgICAgdGhpcy52YWxpZE1lc3NhZ2VFbGUgPSBudWxsO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5kZy5mb3JtVmFsaWRhdGlvbnMpIHtcclxuICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmRnLmZvcm1WYWxpZGF0aW9uc1t0aGlzLmNvbHVtbi5maWVsZF07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc2hvd1ZhbGlkTWVzc2FnZSgpIHtcclxuICAgICAgICBpZiAodGhpcy5kZy5mb3JtVmFsaWRhdGlvbnMgJiYgdGhpcy5kZy5mb3JtVmFsaWRhdGlvbnNbdGhpcy5jb2x1bW4uZmllbGRdKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHtpc1ZhbGlkLCBtZXNzYWdlfSA9IHRoaXMuZGcuZm9ybVZhbGlkYXRpb25zW3RoaXMuY29sdW1uLmZpZWxkXTtcclxuICAgICAgICAgICAgaWYgKCFpc1ZhbGlkICYmIG1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHRyID0gdGhpcy5lZGl0b3IuZWwubmF0aXZlRWxlbWVudC5jbG9zZXN0KCd0cicpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdGQgPSB0aGlzLmVkaXRvci5lbC5uYXRpdmVFbGVtZW50LmNsb3Nlc3QoJ3RkJyk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBwYXJlbnRDb250YWludmVyID0gdGhpcy5lZGl0b3IuZWwubmF0aXZlRWxlbWVudC5jbG9zZXN0KCcuZi1kYXRhZ3JpZC10YWJsZScpO1xyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IGJveCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbXNnV3JhcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcclxuICAgICAgICAgICAgICAgIGJveC5hcHBlbmRDaGlsZChtc2dXcmFwKTtcclxuICAgICAgICAgICAgICAgIG1zZ1dyYXAuaW5uZXJUZXh0ID0gbWVzc2FnZTtcclxuXHJcbiAgICAgICAgICAgICAgICBib3guc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnO1xyXG4gICAgICAgICAgICAgICAgYm94LnN0eWxlLmJhY2tncm91bmQgPSAnI0ZERUZFRic7XHJcbiAgICAgICAgICAgICAgICBib3guc3R5bGUuY29sb3IgPSAnI0Y0NjE2MCc7XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IHRvcCA9IHRyLm9mZnNldFRvcCAtIDIxO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRyLmdldEF0dHJpYnV0ZSgnaW5kZXgnKSA9PSAnMCcpIHtcclxuICAgICAgICAgICAgICAgICAgICB0b3AgPSB0ci5vZmZzZXRIZWlnaHQ7IFxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGJveC5zdHlsZS50b3AgPSBgJHt0b3B9cHhgO1xyXG4gICAgICAgICAgICAgICAgYm94LnN0eWxlLmxlZnQgPSBgJHt0ZC5vZmZzZXRMZWZ0ICsgNX1weGA7XHJcbiAgICAgICAgICAgICAgICBib3guc3R5bGUuekluZGV4ID0gJzk5Nic7XHJcbiAgICAgICAgICAgICAgICBib3guc3R5bGUucGFkZGluZyA9ICcwLjE4NzVyZW0gMC41cmVtJztcclxuICAgICAgICAgICAgICAgIGJveC5zdHlsZS5mb250U2l6ZSA9ICcuODEyNXJlbSc7XHJcbiAgICAgICAgICAgICAgICBib3guc3R5bGUubGluZUhlaWdodCA9ICcxNHB4JztcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBkb2N1bWVudC5ib2R5LmFwcGVuZChib3gpO1xyXG4gICAgICAgICAgICAgICAgcGFyZW50Q29udGFpbnZlci5hcHBlbmQoYm94KTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYm94O1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY2xvc2VFZGl0aW5nQ2VsbCgpIHtcclxuICAgICAgICBpZiAoIXRoaXMuZGcuaXNDZWxsRWRpdGluZygpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBvZih0cnVlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBjdXJyZW50Q2VsbCA9IG51bGw7XHJcbiAgICAgICAgbGV0IGVkaXRvcjogYW55ID0gbnVsbDtcclxuICAgICAgICBpZiAodGhpcy5kZy5jdXJyZW50Q2VsbCkge1xyXG4gICAgICAgICAgICAvLyB0aGlzLmRnLmN1cnJlbnRDZWxsLmlzRWRpdGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAvLyB0aGlzLmRmcy5nZXRDdXJyZW50Q2VsbCgpLmlzRWRpdGluZyA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgY3VycmVudENlbGwgPSB0aGlzLmRnLmN1cnJlbnRDZWxsLmNlbGxSZWYgYXMgRGF0YWdyaWRDZWxsQ29tcG9uZW50O1xyXG4gICAgICAgICAgICBpZiAoY3VycmVudENlbGwpIHtcclxuICAgICAgICAgICAgICAgIGlmICghY3VycmVudENlbGwuaXNFZGl0aW5nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50Q2VsbC5jZWxsRWRpdG9yICYmIGN1cnJlbnRDZWxsLmNlbGxFZGl0b3IuY29tcG9uZW50UmVmICYmICFjdXJyZW50Q2VsbC5jb2x1bW4uZWRpdG9yVGVtcGxhdGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBlZGl0b3IgPSBjdXJyZW50Q2VsbC5jZWxsRWRpdG9yLmNvbXBvbmVudFJlZi5pbnN0YW5jZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVkaXRvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyDmiafooYxibHVyIOS6i+S7tlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWRpdG9yLmlucHV0RWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZG9tTmFtZSA9IGVkaXRvci5pbnB1dEVsZW1lbnQubm9kZU5hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBibHVyRm4gPSAgZWRpdG9yLm9wdGlvbnMgJiYgZWRpdG9yLm9wdGlvbnMub25CbHVyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJsdXJGbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoZG9tTmFtZSA9PT0gJ0lOUFVUJyB8fCBkb21OYW1lID09PSAnVEVYVEFSRUEnKSAmJiAgdGhpcy5kZ1snZm9jdXNFbGVtZW50J10gPT09IGVkaXRvci5pbnB1dEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmx1ckZuKHsgZWRpdG9yUmVmOiBlZGl0b3IsIHJvd0RhdGE6IGN1cnJlbnRDZWxsLnJvd0RhdGF9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWRpdG9yLmlucHV0RWxlbWVudC5ibHVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWRpdG9yLmlucHV0RWxlbWVudC5ibHVyKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kZ1snZm9jdXNFbGVtZW50J10gPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWRpdG9yLmJsdXIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRvci5ibHVyKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlZGl0b3IucGVuZGluZykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9mKGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVkaXRvci5mb3JtQ29udHJvbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVkaXRvci5mb3JtQ29udHJvbC5wZW5kaW5nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9mKGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWRpdG9yLmZvcm1Db250cm9sICYmIGVkaXRvci5mb3JtQ29udHJvbC5pbnZhbGlkICYmICF0aGlzLmRnLmVuZEVkaXRCeUludmFsaWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2YoZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBvZih0cnVlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuZGcuaXNTaW5nbGVDbGljayA9IGZhbHNlO1xyXG4gICAgICAgIGNvbnN0IF9jb2xfID0gKGVkaXRvciB8fCBjdXJyZW50Q2VsbCkuY29sdW1uO1xyXG4gICAgICAgIGNvbnN0IGFmdGVyRWRpdEV2ZW50ID0gdGhpcy5kZy5hZnRlckVkaXQoY3VycmVudENlbGwucm93SW5kZXgsIGN1cnJlbnRDZWxsLnJvd0RhdGEsIF9jb2xfLCBlZGl0b3IpO1xyXG4gICAgICAgIGlmICghYWZ0ZXJFZGl0RXZlbnQgfHwgIWFmdGVyRWRpdEV2ZW50LnN1YnNjcmliZSkge1xyXG4gICAgICAgICAgICB0aGlzLmRnLndyaXRlQ29uc29sZSgncGxlYXNlIHJldHVybiBhbiBPYnNlcnZhYmxlIFR5cGUuJyk7XHJcbiAgICAgICAgICAgIHJldHVybiBvZih1bmRlZmluZWQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gbGV0IGNlbGxFbmRFZGl0ID0gb2YodW5kZWZpbmVkKTtcclxuICAgICAgICBsZXQgY2VsbEVuZEVkaXQgPSBuZXcgU3ViamVjdCgpO1xyXG5cclxuICAgICAgICBhZnRlckVkaXRFdmVudC5waXBlKHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKSkuc3Vic2NyaWJlKChmbGFnOiBib29sZWFuKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChmbGFnKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IHZhbCA9IGN1cnJlbnRDZWxsLnZhbHVlID09PSB1bmRlZmluZWQgPyAnJyA6IGN1cnJlbnRDZWxsLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRDZWxsICYmIGN1cnJlbnRDZWxsLmZvcm1Db250cm9sICYmIGN1cnJlbnRDZWxsLmZvcm1Db250cm9sLnZhbHVlICE9PSB1bmRlZmluZWQgJiYgdmFsICE9PSBjdXJyZW50Q2VsbC5mb3JtQ29udHJvbC52YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhbCA9IGN1cnJlbnRDZWxsLmZvcm1Db250cm9sLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRDZWxsLmlzRWRpdGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRDZWxsLnVwZGF0ZVZhbHVlKHZhbCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5kZnMuZW5kRWRpdENlbGwoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGdzLm9uRW5kQ2VsbEVkaXQodGhpcy5kZnMuZ2V0Q3VycmVudENlbGwoKSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnVuQmluZEVkaXRvcklucHV0RXZlbnQoKTtcclxuICAgICAgICAgICAgICAgIC8vIOenu+mZpOe8lui+keagt+W8j1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIucmVtb3ZlQ2xhc3ModGhpcy5lbC5uYXRpdmVFbGVtZW50LCBDRUxMX0VESVRJTkdfQ0xTKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kZy5zZWxlY3RlZFJvdykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGcuc2VsZWN0ZWRSb3cuZWRpdG9ycyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy8gdGhpcy5kZy5zZWxlY3RlZFJvdy5kYXRhID0gdGhpcy5yb3dEYXRhO1xyXG4gICAgICAgICAgICAgICAgLy8g5pu05paw6KGM5qC35byP5oiW6ICF5Y2V5YWD5qC85qC35byPXHJcbiAgICAgICAgICAgICAgICB0aGlzLmRmcy5yb3dVcGRhdGUkLm5leHQoeyBpbmRleDogY3VycmVudENlbGwucm93SW5kZXgsIGRhdGE6IGN1cnJlbnRDZWxsLnJvd0RhdGEsIGNlbGxSZWY6IGN1cnJlbnRDZWxsIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIOabtOaWsGZvb3RlckRhdGFcclxuICAgICAgICAgICAgICAgIHRoaXMuZGdzLnJlZnJlc2hGb290ZXJEYXRhLmVtaXQoKTtcclxuICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAvLyDliLfmlrDooYzmlbDmja5cclxuICAgICAgICAgICAgICAgIC8vIHRoaXMuZHIucmVmcmVzaCgpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZGcuc2VsZWN0ZWRSb3cgJiYgdGhpcy5kZy5zZWxlY3RlZFJvdy5kcikge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGcuc2VsZWN0ZWRSb3cuZHIucmVmcmVzaCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0aGlzWydFTkRFRElUX1RJTUVSJ10pIHtcclxuICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpc1snRU5ERURJVF9USU1FUiddKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCB7IHJvd0luZGV4LCByb3dEYXRhIH0gPSBjdXJyZW50Q2VsbDtcclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzWydFTkRFRElUX1RJTUVSJ10gPSBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRnLmVuZEVkaXQuZW1pdCh7IHJvd0luZGV4LCByb3dEYXRhLCBjb2x1bW46IF9jb2xfLCB2YWx1ZTogdmFsfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gY2VsbEVuZEVkaXQgPSBvZih0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICBjZWxsRW5kRWRpdC5uZXh0KHRydWUpO1xyXG4gICAgICAgICAgICAgICAgfSwgMTAwKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50Q2VsbCAmJiBjdXJyZW50Q2VsbC5jZWxsRWRpdG9yICYmIGN1cnJlbnRDZWxsLmNlbGxFZGl0b3IuY29tcG9uZW50UmVmICYmIGN1cnJlbnRDZWxsLmNlbGxFZGl0b3IuY29tcG9uZW50UmVmLmluc3RhbmNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZWRpdG9yID0gY3VycmVudENlbGwuY2VsbEVkaXRvci5jb21wb25lbnRSZWYuaW5zdGFuY2U7XHJcbiAgICAgICAgICAgICAgICAgICAgZWRpdG9yLmlucHV0RWxlbWVudC5mb2N1cygpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGNlbGxFbmRFZGl0ID0gb2YoZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNlbGxFbmRFZGl0Lm5leHQoZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBjZWxsRW5kRWRpdCA9IG9mKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNlbGxFbmRFZGl0Lm5leHQodHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gY2VsbEVuZEVkaXQuYXNPYnNlcnZhYmxlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgY2FuY2VsQ2VsbEVkaXRpbmcoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZGcuY3VycmVudENlbGwgJiYgdGhpcy5kZy5jdXJyZW50Q2VsbC5pc0VkaXRpbmcgJiYgdGhpcy5kZy5zZWxlY3RlZFJvdy5pbmRleCA+IC0xKSB7XHJcbiAgICAgICAgICAgIC8vIHRoaXMuZGZzLnJlc2V0Um93KHRoaXMuZGcuc2VsZWN0ZWRSb3cuaWQpO1xyXG4gICAgICAgICAgICB0aGlzLmRjLnJvd0RhdGEgPSB0aGlzLmRnLnNlbGVjdGVkUm93LmRhdGE7XHJcbiAgICAgICAgICAgIHRoaXMuZm9ybUNvbnRyb2wucmVzZXQoVXRpbHMuZ2V0VmFsdWUodGhpcy5jb2x1bW4uZmllbGQsIHRoaXMuZGMucm93RGF0YSkpO1xyXG4gICAgICAgICAgICB0aGlzLmNsb3NlRWRpdGluZ0NlbGwoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGJpbmRFZGl0b3JJbnB1dEV2ZW50KCkge1xyXG4gICAgICAgIGNvbnN0IGNlUmVmID0gdGhpcy5jZWxsRWRpdG9yUmVmIHx8IHRoaXMuZGMuY2VsbEVkaXRvcjtcclxuICAgICAgICBsZXQgaW5wdXQgPSBudWxsO1xyXG4gICAgICAgIGlmIChjZVJlZikge1xyXG4gICAgICAgICAgICBpbnB1dCA9IGNlUmVmLmNvbXBvbmVudFJlZi5pbnN0YW5jZS5pbnB1dEVsZW1lbnQ7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuY29sdW1uLmVkaXRvclRlbXBsYXRlKSB7XHJcbiAgICAgICAgICAgICAgICBpbnB1dCA9IHRoaXMuZGMuZWwubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCdpbnB1dCx0ZXh0YXJlYScpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChpbnB1dCkge1xyXG4gICAgICAgICAgICBpbnB1dC5mb2N1cygpO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5kZy5zZWxlY3RPbkVkaXRpbmcgJiYgdGhpcy5jb2x1bW4uZWRpdG9yVGVtcGxhdGUpIHtcclxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpbnB1dC5zZWxlY3QpIHsgaW5wdXQuc2VsZWN0KCk7IH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLmVkaXRvcklucHV0S2V5ZG93bkV2ZW50ID0gdGhpcy5yZW5kZXIubGlzdGVuKGlucHV0LCAna2V5ZG93bicsIChlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm9uS2V5RG93bkZvcklucHV0KGUpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdW5CaW5kRWRpdG9ySW5wdXRFdmVudCgpIHtcclxuICAgICAgICBpZiAodGhpcy5lZGl0b3JJbnB1dEtleWRvd25FdmVudCkge1xyXG4gICAgICAgICAgICB0aGlzLmVkaXRvcklucHV0S2V5ZG93bkV2ZW50KCk7XHJcbiAgICAgICAgICAgIHRoaXMuZWRpdG9ySW5wdXRLZXlkb3duRXZlbnQgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBwcml2YXRlIGlzTGFzdENlbGwoKSB7XHJcbiAgICAvLyAgICAgbGV0IGkgPSB0aGlzLmRnLmZsYXRDb2x1bW5zLmxlbmd0aDtcclxuICAgIC8vICAgICB3aGlsZShpIDw9ICkge1xyXG4gICAgLy8gICAgICAgICBpZiAodGhpcy5kZy5mbGF0Q29sdW1uc1tpXSlcclxuICAgIC8vICAgICB9XHJcbiAgICAvLyB9XHJcblxyXG4gICAgZmluZExhc3RFZGl0Q2VsbCgpIHtcclxuICAgICAgICBsZXQgaSA9IHRoaXMuZGcuY29sR3JvdXAuY29sdW1ucy5sZW5ndGggLSAxO1xyXG4gICAgICAgIGxldCBfY29sID0gbnVsbDtcclxuICAgICAgICB3aGlsZShpID49IDApIHtcclxuICAgICAgICAgICAgY29uc3QgY29sID0gdGhpcy5kZy5jb2xHcm91cC5jb2x1bW5zW2ldO1xyXG4gICAgICAgICAgICBpZiAoY29sLmVkaXRvciB8fCBjb2wuZWRpdG9yVGVtcGxhdGUpIHtcclxuICAgICAgICAgICAgICAgIF9jb2wgPSBjb2w7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGktLTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIF9jb2w7XHJcbiAgICB9XHJcblxyXG4gICAgb25LZXlEb3duRm9ySW5wdXQoZTogS2V5Ym9hcmRFdmVudCkge1xyXG4gICAgICAgIGNvbnN0IGtleUNvZGUgPSBlLmtleUNvZGU7XHJcbiAgICAgICAgaWYgKGUuYWx0S2V5IHx8IGUuY3RybEtleSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICgodGhpcy5lZGl0b3IgJiYgdGhpcy5lZGl0b3Iuc3RvcFByb3BhZ2F0aW9uKSB8fCBrZXlDb2RlID09PSAxMyB8fCB0aGlzLmNvbHVtbi5lZGl0b3JUZW1wbGF0ZSkge1xyXG4gICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc3dpdGNoIChrZXlDb2RlKSB7XHJcbiAgICAgICAgICAgIGNhc2UgMzI6ICAvLyBTUEFDRVxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY29sdW1uLmVkaXRvci50eXBlID09PSAnc3dpdGNoJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmVkaXRvci5pbnN0YW5jZS51cGRhdGVDaGVja2VkKGUsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIDEzOiAgLy8gRW50ZXJcclxuICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VFZGl0aW5nQ2VsbCgpLnBpcGUodGFrZVVudGlsKHRoaXMuZGVzdHJveSQpKS5waXBlKFxyXG4gICAgICAgICAgICAgICAgICAgIGRlYm91bmNlVGltZSgxMDApXHJcbiAgICAgICAgICAgICAgICApLnN1YnNjcmliZShmID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRnLmRnQ29udGFpbmVyLm5hdGl2ZUVsZW1lbnQuZm9jdXMoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGFzdEVkaXRDZWxsID0gdGhpcy5maW5kTGFzdEVkaXRDZWxsKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBlbnRlclBhcmFtID0geyBnaXJkOiB0aGlzLmRnLCBjZWxsOiB0aGlzLmRnLmN1cnJlbnRDZWxsLCBldmVudDogZSwgbGFzdENlbGw6IGxhc3RFZGl0Q2VsbC5maWVsZCA9PT0gdGhpcy5jb2x1bW4uZmllbGQgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuY29sdW1uLm9uRW50ZXJIYW5kbGVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbHVtbi5vbkVudGVySGFuZGxlcihlbnRlclBhcmFtKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG5leHRUZCA9IHRoaXMuZGcuZmluZE5leHRDZWxsKHRoaXMuY29sdW1uLmZpZWxkLCAncmlnaHQnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmRnLmN1cnJlbnRDZWxsLmxhc3RSb3cgJiYgKCFuZXh0VGQgfHwgbGFzdEVkaXRDZWxsLmZpZWxkID09PSB0aGlzLmNvbHVtbi5maWVsZCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRnLmxhc3RDZWxsRW50ZXJIYW5kbGVyLmVtaXQoZW50ZXJQYXJhbSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIDI3OiAvLyBFU0NcclxuICAgICAgICAgICAgICAgIHRoaXMuY2FuY2VsQ2VsbEVkaXRpbmcoKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIDk6IC8vIFRhYlxyXG4gICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGcuY2xpY2tEZWxheSA9IDA7XHJcbiAgICAgICAgICAgICAgICBpZiAoZS5zaGlmdEtleSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VFZGl0aW5nQ2VsbCgpLnBpcGUodGFrZVVudGlsKHRoaXMuZGVzdHJveSQpKS5zdWJzY3JpYmUoZiA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vdmVQcmV2Q2VsbEFuZEVkaXQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlRWRpdGluZ0NlbGwoKS5waXBlKHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKSkuc3Vic2NyaWJlKGYgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3ZlTmV4dENlbGxBbmRFZGl0KGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgNDA6IC8vIOKGk1xyXG4gICAgICAgICAgICAgICAgLyoqIOmAieS4reS4i+S4gOihjO+8jOS4lOW9k+WJjeWIl+i/m+WFpee8lui+keaAgTsg5LuF5pmu6YCa5paH5pys6L6T5YWl5qGG5pSv5oyBICovXHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jb2x1bW4uZWRpdG9yLnR5cGUgPT09ICd0ZXh0Ym94Jykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VFZGl0aW5nQ2VsbCgpLnBpcGUodGFrZVVudGlsKHRoaXMuZGVzdHJveSQpKS5zdWJzY3JpYmUoZiA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdE5leHRSb3dBbmRFZGl0Q2VsbCh0aGlzLmNvbHVtbi5maWVsZCwgJ2Rvd24nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIDM4OiAvLyDihpFcclxuICAgICAgICAgICAgICAgIC8qKiDpgInkuK3kuIrkuIDooYzvvIzkuJTlvZPliY3liJfov5vlhaXnvJbovpHmgIE7IOS7heaZrumAmuaWh+acrOi+k+WFpeahhuaUr+aMgSAqL1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY29sdW1uLmVkaXRvci50eXBlID09PSAndGV4dGJveCcpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlRWRpdGluZ0NlbGwoKS5waXBlKHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKSkuc3Vic2NyaWJlKGYgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3ROZXh0Um93QW5kRWRpdENlbGwodGhpcy5jb2x1bW4uZmllbGQsICd1cCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2VsZWN0Q2VsbChmaWVsZDogc3RyaW5nLCB0ZEVsZW1lbnQ/OiBhbnkpIHtcclxuICAgICAgICB0aGlzLmNsb3NlRWRpdGluZ0NlbGwoKS5zdWJzY3JpYmUodCA9PiB7XHJcbiAgICAgICAgICAgIGlmICghdCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRkRWxlbWVudCA9IHRkRWxlbWVudCB8fCB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQ7XHJcbiAgICAgICAgICAgIHRoaXMuY2xlYXJDZWxsU2VsZWN0ZWRDbGFzcygpO1xyXG5cclxuICAgICAgICAgICAgaWYgKGZpZWxkICE9PSB0aGlzLmRnLkNvbnRyb2xQYW5lbEZlaWxkKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5hZGRDbGFzcyh0ZEVsZW1lbnQsIENFTExfU0VMRUNURURfQ0xTKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gdGhpcy5kci5kckhvdmVyLnNldFJvd0hvdmVyQ2xzKGZhbHNlKTtcclxuICAgICAgICAgICAgdGhpcy5kZnMuc2V0Q3VycmVudENlbGwodGhpcy5kciwgZmllbGQsIHRkRWxlbWVudCwgdGhpcy5kYyk7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5kZy5mYXN0ICYmIHRoaXMuY29sdW1uLmZpeGVkICE9PSAnbGVmdCcgJiYgdGhpcy5jb2x1bW4uZml4ZWQgIT09ICdyaWdodCcpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubW92ZVNjcm9sbGJhcih0ZEVsZW1lbnQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBtb3ZlU2Nyb2xsYmFyKHRkOiBhbnkpIHtcclxuICAgICAgICBjb25zdCB0ZFBvc0xlZnQgPSB0ZC5vZmZzZXRMZWZ0ICsgdGQub2Zmc2V0V2lkdGg7XHJcbiAgICAgICAgY29uc3QgY29udGFpbmVyV2lkdGggPSB0aGlzLmRnLndpZHRoIC0gdGhpcy5kZ2IuY29sdW1uc0dyb3VwLmxlZnRGaXhlZFdpZHRoIC0gdGhpcy5kZ2IuY29sdW1uc0dyb3VwLnJpZ2h0Rml4ZWRXaWR0aDtcclxuICAgICAgICBjb25zdCB0ZFJlY3QgPSB0ZC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgICAgICBjb25zdCBzY3JvbGxDb250YWluZXIgPSB0aGlzLmRnYi5wcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQ7XHJcbiAgICAgICAgY29uc3QgcHNDb250YWluZXIgPSBzY3JvbGxDb250YWluZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcbiAgICAgICAgY29uc3Qgc2Nyb2xsVG9wID0gc2Nyb2xsQ29udGFpbmVyLnNjcm9sbFRvcDtcclxuICAgICAgICBjb25zdCBzY3JvbGxMZWZ0ID0gc2Nyb2xsQ29udGFpbmVyLnNjcm9sbExlZnQ7XHJcbiAgICAgICAgY29uc3Qgc2Nyb2xsYmFyWExlZnQgPSB0aGlzLmRnYi5wcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuc2Nyb2xsTGVmdDtcclxuICAgICAgICBpZiAodGRQb3NMZWZ0ID4gY29udGFpbmVyV2lkdGgpIHtcclxuICAgICAgICAgICAgY29uc3QgeCA9IHRkUG9zTGVmdCAtIGNvbnRhaW5lcldpZHRoICsgMjtcclxuICAgICAgICAgICAgLy8gY29uc3QgeCA9IHRkUG9zTGVmdCAtIHRoaXMuZGdiLnBzLmluc3RhbmNlLnNjcm9sbGJhclhXaWR0aCArIDI7XHJcbiAgICAgICAgICAgIGlmICh4ID4gc2Nyb2xsYmFyWExlZnQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGdiLnBzLnNjcm9sbFRvWCh4KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIGlmICh0ZFJlY3QueCA8IHBzQ29udGFpbmVyLngpIHtcclxuICAgICAgICAgICAgLy8gICAgIGNvbnN0IHggPSBzY3JvbGxMZWZ0IC0gdGRSZWN0Lng7XHJcbiAgICAgICAgICAgIC8vICAgICB0aGlzLmRnYi5wcy5zY3JvbGxUb1goeCk7XHJcbiAgICAgICAgICAgIC8vIH1cclxuICAgICAgICAgICAgaWYgKHRkLm9mZnNldExlZnQgPCBzY3JvbGxMZWZ0KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRnYi5wcy5zY3JvbGxUb1godGQub2Zmc2V0TGVmdCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHRkUG9zVG9wID0gdGRSZWN0LnRvcCAtIHBzQ29udGFpbmVyLnRvcCArIHRkUmVjdC5oZWlnaHQ7XHJcbiAgICAgICAgaWYgKHRkUG9zVG9wID4gcHNDb250YWluZXIuaGVpZ2h0KSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHkgPSB0ZFBvc1RvcCAtIHBzQ29udGFpbmVyLmhlaWdodDtcclxuICAgICAgICAgICAgdGhpcy5kZ2IucHMuc2Nyb2xsVG9ZKHNjcm9sbFRvcCArIHkpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlmICh0ZFJlY3QueSA8IHBzQ29udGFpbmVyLnkpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGdiLnBzLnNjcm9sbFRvWShzY3JvbGxUb3AgLSAocHNDb250YWluZXIueSAtIHRkUmVjdC55KSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBtb3ZlTmV4dENlbGxBbmRFZGl0KGV2ZW50PzogYW55KSB7XHJcbiAgICAgICAgLy8gaWYgKCF0aGlzLmNsb3NlRWRpdGluZ0NlbGwoKSkge1xyXG4gICAgICAgIC8vICAgICByZXR1cm47XHJcbiAgICAgICAgLy8gfVxyXG4gICAgICAgIC8vIGNvbnN0IGZpZWxkSW5kZXggPSB0aGlzLmRmcy5nZXRDb2x1bW5JbmRleCh0aGlzLmNvbHVtbi5maWVsZCk7XHJcbiAgICAgICAgY29uc3QgZmllbGRJbmRleCA9IHRoaXMuZGcuY29sR3JvdXAuY29sdW1ucy5maW5kSW5kZXgobiA9PiAobi5pZCAmJiBuLmlkID09PSB0aGlzLmNvbHVtbi5pZCkgfHwgbi5maWVsZCA9PT0gdGhpcy5jb2x1bW4uZmllbGQpO1xyXG4gICAgICAgIGlmIChmaWVsZEluZGV4ICsgMSA8IHRoaXMuZGdiLmNvbHVtbnNHcm91cC5jb2x1bW5zLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBjb25zdCBuZXh0Q29sdW1uID0gdGhpcy5kZ2IuY29sdW1uc0dyb3VwLmNvbHVtbnNbZmllbGRJbmRleCArIDFdO1xyXG4gICAgICAgICAgICBjb25zdCBuZXh0VGQ6IGFueSA9IHRoaXMuZGcuZmluZE5leHRUZChuZXh0Q29sdW1uKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChuZXh0VGQgJiYgKCFuZXh0Q29sdW1uLmZpeGVkIHx8IG5leHRDb2x1bW4uZml4ZWQgPT09ICdjZW50ZXInKSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5tb3ZlU2Nyb2xsYmFyKG5leHRUZCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIGNvbnN0IG5leHRUZCA9IHRoaXMuZGcuY3VycmVudENlbGwuY2VsbEVsZW1lbnQubmV4dEVsZW1lbnRTaWJsaW5nO1xyXG4gICAgICAgICAgICBpZiAobmV4dENvbHVtbiAmJiAoKCFuZXh0Q29sdW1uLmVkaXRvciAmJiAhbmV4dENvbHVtbi5lZGl0b3JUZW1wbGF0ZSkgfHwgdGhpcy5pc1JlYWRvbmx5KG5leHRDb2x1bW4pKSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKG5leHRUZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5leHRUZC5zZWxlY3RDZWxsKGV2ZW50LCBuZXh0VGQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAobmV4dFRkKSB7XHJcbiAgICAgICAgICAgICAgICBuZXh0VGQuZm9jdXMoKTtcclxuICAgICAgICAgICAgICAgIGlmIChuZXh0Q29sdW1uLmVkaXRvciB8fCBuZXh0Q29sdW1uLmVkaXRvclRlbXBsYXRlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV4dFRkLmVkaXRDZWxsKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZ3Mub25DZWxsRWRpdChuZXh0VGQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8gbmV4dCByb3cncyBmaXJzdCBjZWxsIHRvIGVkaXRpbmdcclxuICAgICAgICAgICAgY29uc3QgbmV4dFRyID0gdGhpcy5kZy5jdXJyZW50Q2VsbC5jZWxsRWxlbWVudC5wYXJlbnRFbGVtZW50Lm5leHRFbGVtZW50U2libGluZztcclxuICAgICAgICAgICAgaWYgKG5leHRUciAmJiBuZXh0VHIudGFnTmFtZSA9PT0gJ1RSJykge1xyXG4gICAgICAgICAgICAgICAgLy8gbmV4dFRyLmNoaWxkcmVuLmZpbmQodGQgPT4gdGQuZWRpdENlbGwpLmVkaXRDZWxsKCk7XHJcbiAgICAgICAgICAgICAgICBsZXQgZmlyc3RFZGl0b3IgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGxldCBpID0gMDtcclxuICAgICAgICAgICAgICAgIHdoaWxlICghZmlyc3RFZGl0b3IpIHtcclxuICAgICAgICAgICAgICAgICAgICBmaXJzdEVkaXRvciA9ICEhbmV4dFRyLmNoaWxkcmVuW2ldLmVkaXRDZWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghZmlyc3RFZGl0b3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRnLnNlbGVjdGlvbk1vZGUgPT09ICdkZWZhdWx0Jykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGcuY2xlYXJDaGVja2VkcygpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgbmV4dFRyLmNoaWxkcmVuW2ldLmVkaXRDZWxsKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBtb3ZlUHJldkNlbGxBbmRFZGl0KCkge1xyXG4gICAgICAgIC8vIGlmICghdGhpcy5jbG9zZUVkaXRpbmdDZWxsKCkpIHtcclxuICAgICAgICAvLyAgICAgcmV0dXJuO1xyXG4gICAgICAgIC8vIH1cclxuICAgICAgICBjb25zdCBmaWVsZEluZGV4ID0gdGhpcy5kZnMuZ2V0Q29sdW1uSW5kZXgodGhpcy5jb2x1bW4uZmllbGQpO1xyXG4gICAgICAgIGlmIChmaWVsZEluZGV4IC0gMSA+PSAwKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG5leHRDb2x1bW4gPSB0aGlzLmRnYi5jb2x1bW5zR3JvdXAubm9ybWFsQ29sdW1uc1tmaWVsZEluZGV4IC0gMV07XHJcbiAgICAgICAgICAgIGlmIChuZXh0Q29sdW1uICYmIHRoaXMuaXNSZWFkb25seShuZXh0Q29sdW1uKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IG5leHRUZCA9IHRoaXMuZGcuY3VycmVudENlbGwuY2VsbEVsZW1lbnQucHJldmlvdXNFbGVtZW50U2libGluZztcclxuICAgICAgICAgICAgaWYgKG5leHRUZCkge1xyXG4gICAgICAgICAgICAgICAgLy8gdGhpcy5zZWxlY3RDZWxsKG5leHRDb2x1bW4uZmllbGQsIG5leHRUZCk7XHJcbiAgICAgICAgICAgICAgICBuZXh0VGQuZm9jdXMoKTtcclxuICAgICAgICAgICAgICAgIGlmIChuZXh0Q29sdW1uLmVkaXRvcikge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuZGZzLmVkaXRDZWxsKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV4dFRkLmNsaWNrKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZ3Mub25DZWxsRWRpdChuZXh0VGQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2VsZWN0TmV4dFJvd0FuZEVkaXRDZWxsKGNlbGxGaWVsZE5hbWU6IHN0cmluZywgZGlyOiAnZG93bicgfCAndXAnKSB7XHJcbiAgICAgICAgY29uc3QgcCA9IGRpciA9PT0gJ2Rvd24nID8gJ25leHRFbGVtZW50U2libGluZyc6ICdwcmV2aW91c0VsZW1lbnRTaWJsaW5nJztcclxuICAgICAgICBjb25zdCBuZXh0VHIgPSB0aGlzLmRnLmN1cnJlbnRDZWxsLmNlbGxFbGVtZW50LnBhcmVudEVsZW1lbnRbcF07XHJcbiAgICAgICAgaWYgKG5leHRUciAmJiBuZXh0VHIudGFnTmFtZSA9PT0gJ1RSJykge1xyXG4gICAgICAgICAgICBjb25zdCB0ZDogYW55ID0gQXJyYXkuZnJvbShuZXh0VHIuY2hpbGRyZW4pLmZpbmQoKHRkOiBhbnkpID0+IHRkLmdldEF0dHJpYnV0ZSgnZmllbGQnKSA9PSBjZWxsRmllbGROYW1lKTtcclxuICAgICAgICAgICAgaWYgKHRkICYmIHRkLmVkaXRDZWxsKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kZy5zZWxlY3Rpb25Nb2RlID09PSAnZGVmYXVsdCcgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZy5jbGVhckNoZWNrZWRzKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0ZC5lZGl0Q2VsbCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY2xlYXJDZWxsU2VsZWN0ZWRDbGFzcygpIHtcclxuICAgICAgICAvLyBpZiAodGhpcy5kZy5jdXJyZW50Q2VsbCkge1xyXG4gICAgICAgIC8vICAgICBEb21IYW5kbGVyLnJlbW92ZUNsYXNzKHRoaXMuZGcuY3VycmVudENlbGwuY2VsbEVsZW1lbnQsIENFTExfU0VMRUNURURfQ0xTKTtcclxuICAgICAgICAvLyAgICAgdGhpcy5yZW5kZXIucmVtb3ZlQ2xhc3ModGhpcy5kZy5jdXJyZW50Q2VsbC5jZWxsRWxlbWVudCwgQ0VMTF9FRElUSU5HX0NMUyk7XHJcblxyXG4gICAgICAgIC8vICAgICBjb25zdCBzZWxlY3RlZENlbGwgPSB0aGlzLmRnLmVsLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLicgKyBDRUxMX1NFTEVDVEVEX0NMUyk7XHJcbiAgICAgICAgLy8gICAgIGlmIChzZWxlY3RlZENlbGwubGVuZ3RoKSB7XHJcbiAgICAgICAgLy8gICAgICAgICBzZWxlY3RlZENlbGwuZm9yRWFjaChuID0+IHtcclxuICAgICAgICAvLyAgICAgICAgICAgICB0aGlzLnJlbmRlci5yZW1vdmVDbGFzcyhuLCBDRUxMX1NFTEVDVEVEX0NMUyk7XHJcbiAgICAgICAgLy8gICAgICAgICB9KTtcclxuICAgICAgICAvLyAgICAgfVxyXG4gICAgICAgIC8vIH1cclxuXHJcbiAgICAgICAgdGhpcy5kZy5yZW1vdmVDZWxsU2VsZWN0ZWRDbHMoKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNldENlbGxDbHNXaXRoRWRpdG9yVHlwZSgpIHtcclxuXHJcbiAgICAgICAgLy8g6K6+572u5b2T5YmN6YCJ5Lit5Y2V5YWD5qC85qC35byPXHJcbiAgICAgICAgaWYgKHRoaXMuZGcuY3VycmVudENlbGwgJiYgdGhpcy5kZy5lbmFibGVIaWdobGlnaHRDZWxsKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmRnLmN1cnJlbnRDZWxsLmZpZWxkID09PSB0aGlzLmNvbHVtbi5maWVsZCAmJiB0aGlzLmRnLmN1cnJlbnRDZWxsLnJvd0lkID09PSB0aGlzLnJvd0RhdGFbdGhpcy5kZy5pZEZpZWxkXSAmJiAhdGhpcy5kYy5pc0VkaXRpbmcpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2xlYXJDZWxsU2VsZWN0ZWRDbGFzcygpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIuYWRkQ2xhc3ModGhpcy5lbC5uYXRpdmVFbGVtZW50LCBDRUxMX1NFTEVDVEVEX0NMUyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBpZiAoIXRoaXMuZGcuZW5hYmxlRWRpdENlbGxTdHlsZSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCB0ZCA9IHRoaXMuZWwubmF0aXZlRWxlbWVudDtcclxuICAgICAgICB0aGlzLmNsZWFuT3RoZXJFZGl0b3JJY29uKHRkKTtcclxuICAgICAgICAvLyDlvZPliY3ooYznpoHnlKjvvIzkuI3lhYHorrjnvJbovpHjgIJcclxuICAgICAgICBpZiAodGhpcy5kci5kaXNhYmxlZCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoIXRoaXMuY29sdW1uLmVkaXRvcikge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5pc1JlYWRvbmx5KCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgZWRpdG9yVHlwZSA9IHRoaXMuY29sdW1uLmVkaXRvci50eXBlO1xyXG4gICAgICAgIGNvbnN0IGNscyA9IHRoaXMuY29sdW1uLmFsaWduID09PSAncmlnaHQnID8gJ2FsbG93LWVkaXQtY2VsbC1sZWZ0JyA6ICdhbGxvdy1lZGl0LWNlbGwnO1xyXG4gICAgICAgIHRoaXMucmVuZGVyLmFkZENsYXNzKHRkLCBjbHMpO1xyXG4gICAgICAgIHRoaXMucmVuZGVyLmFkZENsYXNzKHRkLCBBTExPV19FRElUX0NFTExfSElHSExJR0hUX0NMU1tlZGl0b3JUeXBlXSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjbGVhbk90aGVyRWRpdG9ySWNvbih0ZCkge1xyXG4gICAgICAgIGNvbnN0IHZhbHVlcyA9IE9iamVjdC52YWx1ZXMoQUxMT1dfRURJVF9DRUxMX0hJR0hMSUdIVF9DTFMpO1xyXG4gICAgICAgIHZhbHVlcy5mb3JFYWNoKHYgPT4ge1xyXG4gICAgICAgICAgICBpZiAodGQuY2xhc3NOYW1lLmluZGV4T2YodikgPiAtMSkge1xyXG4gICAgICAgICAgICAgICAgdGQuY2xhc3NOYW1lID0gdGQuY2xhc3NOYW1lLnJlcGxhY2UoJ2FsbG93LWVkaXQtY2VsbC1sZWZ0JywgJycpLnJlcGxhY2UoJ2FsbG93LWVkaXQtY2VsbCcsICcnKTtcclxuICAgICAgICAgICAgICAgIHRkLmNsYXNzTmFtZSA9IHRkLmNsYXNzTmFtZS5yZXBsYWNlKHYsICcnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==