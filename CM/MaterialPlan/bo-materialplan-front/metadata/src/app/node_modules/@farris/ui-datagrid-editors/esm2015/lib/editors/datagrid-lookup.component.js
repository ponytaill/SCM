/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { debounceTime } from 'rxjs/operators';
import { Injector } from '@angular/core';
/*
 * @Author: 疯狂秀才(Lucas Huang)
 * @Date: 2019-08-14 11:41:00
 * @LastEditors: 疯狂秀才(Lucas Huang)
 * @LastEditTime: 2019-10-14 13:00:48
 * @QQ: 1055818239
 * @Version: v0.0.1
 */
import { Component, Renderer2, ElementRef, ViewChild } from '@angular/core';
import { DatagridBaseEditorDirective } from '../datagrid-base-editor.directive';
import { LookupDefaultOptions } from '../editor-default-options';
import { LookupGridComponent } from '@farris/ui-lookup';
import { RuntimeStateService } from '@farris/ui-common';
// 
export class DatagridLookupComponent extends DatagridBaseEditorDirective {
    /**
     * @param {?} render
     * @param {?} el
     * @param {?} rts
     * @param {?} injector
     */
    constructor(render, el, rts, injector) {
        super(render, el, injector);
        this.rts = rts;
        this.stopPropagation = false;
        this.extInfoFormatter = (/**
         * @param {?} e
         * @return {?}
         */
        (e) => {
            if (this.options.extInfoFormatter) {
                return this.options.extInfoFormatter({ bindingData: this.dr.rowData, instance: e.instance });
            }
            return '';
        });
    }
    /**
     * @param {?} id
     * @return {?}
     */
    set controlId(id) {
        this.instance.controlId = id;
        if (this.instance.uri) {
            this.instance.controlId += '_' + this.instance.uri;
        }
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        super.ngOnInit();
        if (!this.options.valueField) {
            this.options.valueField = this.options.idField;
        }
        this.options = Object.assign({}, LookupDefaultOptions, this.options);
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        this.instance.changeDetector.detectChanges();
        if (this.options.viewType === 'tag') {
            this.inputElement = this.instance.tagbox.nativeElement;
        }
        else {
            this.inputElement = this.instance.inputGroup.textbox.nativeElement;
        }
        super.ngAfterViewInit();
        if (this.options.loader) {
            if (this.instance['http']) {
                /** @type {?} */
                const getDataFn = this.instance['http'];
                this.instance['http'] = Object.assign({}, getDataFn, { getData: this.options.loader });
            }
            else {
                this.instance['http'] = { getData: this.options.loader };
            }
        }
        this.instance['host'] = this.dg;
        this.rts.state$.pipe(debounceTime(10)).subscribe((/**
         * @param {?} state
         * @return {?}
         */
        state => {
            if (state && state.form && state.form.lookup && this.dg) {
                this.pending = state.form.lookup.pending;
                this.dg.pending = this.pending;
            }
        }));
    }
    /**
     * @return {?}
     */
    onDialogClosed() {
        // this.lookup.changeDetector.detectChanges();
    }
    /**
     * @return {?}
     */
    onDialogOpen() {
        this.instance.changeDetector.detectChanges();
    }
    /**
     * @return {?}
     */
    onLoadSuccess() {
        this.instance.changeDetector.detectChanges();
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onClear(event) {
        // const rowData = this.instance.selectionMgr.getBindingData();
        // this.instance['defaultMapping'].lookupFieldMap(null, this.instance.mapFields, rowData);
        this.instance.changeDetector.detectChanges();
        if (this.options.clear) {
            this.options.clear();
        }
    }
    /**
     * @param {?} $evnet
     * @return {?}
     */
    onTagRemoved($evnet) {
        if (this.options.tagRemoved) {
            this.options.tagRemoved($evnet);
        }
    }
}
DatagridLookupComponent.decorators = [
    { type: Component, args: [{
                selector: 'grid-editor-lookup',
                template: `
    <div [formGroup]="group" class="f-datagrid-cell-formgroup farris-group-auto">
        <datagrid-tooltip [control]="formControl" [tooltipPosition]="'top-left'" [message]="errorMessage">
            <farris-lookup-grid #lookup style="width: 100%"
                id="{{ controlId }}"
                [formControlName]="column.field"
                [uri]="options.uri"
                [helpId]="options.helpId"
                [displayType]="options.displayType"
                [singleSelect]="options.singleSelect"
                [idField]="options.idField"
                [pageSize]="options.pageSize || 20"
                [pageIndex]="options.pageSize || 1"
                [pagination]="options.pageination"
                [textField]="options.textField"
                [valueField]="options.valueField"
                [title]="options.title"
                [useFavorite]="options.useFavorite"
                [isRecordSize]="options.isRecordSize"
                [useTip]="options.useTip"
                [editable]="options.editable"
                [readonly]="options.readonly"
                [dialogWidth]="options.dialogWidth"
                [dialogHeight]="options.dialogHeight"
                [showMaxButton]="options.showMaxButton"
                [showCloseButton]="options.showCloseButton"
                [resizable]="options.resizable"
                [buttonAlign]="options.buttonAlign"
                [enableClear]="options.enableClear"
                [searchOnServer]="options.searchOnServer"
                [nosearch]="options.nosearch"
                [maxLength]="options.maxLength"
                [mappingFn]="options.mappingFn"
                [mapFields]="options.mapFields"
                [context]="options.context"
                [expandLevel]="options.expandLevel"
                [dictPicking]="options.dictPicking"
                [dictPicked]="options.dictPicked"
                [enableFullTree]="options.enableFullTree"
                [loadTreeDataType]="options.loadTreeDataType"
                [enableCascade]="options.enableCascade"
                [cascadeStatus]="options.cascadeStatus"
                [useExtendInfo]="options.useExtendInfo"
                [extInfoFields]="options.extInfoFields"
                [extInfoFormatter]="options.extInfoFormatter"
                [textAlign]="options.textAlign"
                [loadDataWhenOpen]="options.loadDataWhenOpen"
                [selectFirstInNav]="options.selectFirstInNav"
                [customNavFormatter]="options.customNavFormatter"
                [customFormatter]="options.customFormatter"
                [treeInfo]="options?.treeInfo"
                (dialogClosed)="onDialogClosed()"
                (dialogOpened)="onDialogOpen()"
                (clear)="onClear($event)"
                (loadSuccess)="onLoadSuccess()"
                [treeTableOptions]="options?.treeTableOptions"
                [showCheckAll]="options?.showCheckAll"
                [viewType]="options?.viewType"
                (tagRemoved)="onTagRemoved($event)"
                [quickSelect]="options?.quickSelect"
                [treeToList]="options?.treeToList"
                [navTreeToList]="options?.navTreeToList"
                [showCascadeControl]="options.showCascadeControl"
                [showNavigation]="options.showNavigation"
            ></farris-lookup-grid>
        </datagrid-tooltip>
    </div>
    `
            }] }
];
/** @nocollapse */
DatagridLookupComponent.ctorParameters = () => [
    { type: Renderer2 },
    { type: ElementRef },
    { type: RuntimeStateService },
    { type: Injector }
];
DatagridLookupComponent.propDecorators = {
    instance: [{ type: ViewChild, args: ['lookup',] }]
};
if (false) {
    /** @type {?} */
    DatagridLookupComponent.prototype.instance;
    /** @type {?} */
    DatagridLookupComponent.prototype.stopPropagation;
    /** @type {?} */
    DatagridLookupComponent.prototype.extInfoFormatter;
    /**
     * @type {?}
     * @private
     */
    DatagridLookupComponent.prototype.rts;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YWdyaWQtbG9va3VwLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktZGF0YWdyaWQtZWRpdG9ycy8iLCJzb3VyY2VzIjpbImxpYi9lZGl0b3JzL2RhdGFncmlkLWxvb2t1cC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUM5QyxPQUFPLEVBQXFELFFBQVEsRUFBRSxNQUFNLGVBQWUsQ0FBQzs7Ozs7Ozs7O0FBUzVGLE9BQU8sRUFBRSxTQUFTLEVBQVUsU0FBUyxFQUFFLFVBQVUsRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDcEYsT0FBTyxFQUFFLDJCQUEyQixFQUFFLE1BQU0sbUNBQW1DLENBQUM7QUFDaEYsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDakUsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDeEQsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sbUJBQW1CLENBQUM7O0FBMkV4RCxNQUFNLE9BQU8sdUJBQXdCLFNBQVEsMkJBQTJCOzs7Ozs7O0lBWXBFLFlBQVksTUFBaUIsRUFBRSxFQUFjLEVBQVUsR0FBd0IsRUFDbkUsUUFBa0I7UUFDMUIsS0FBSyxDQUFDLE1BQU0sRUFBRSxFQUFFLEVBQUUsUUFBUSxDQUFDLENBQUM7UUFGdUIsUUFBRyxHQUFILEdBQUcsQ0FBcUI7UUFEL0Usb0JBQWUsR0FBRyxLQUFLLENBQUM7UUF5RXhCLHFCQUFnQjs7OztRQUFHLENBQUMsQ0FBQyxFQUFFLEVBQUU7WUFDckIsSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLGdCQUFnQixFQUFFO2dCQUMvQixPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsZ0JBQWdCLENBQUMsRUFBRSxXQUFXLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxPQUFPLEVBQUUsUUFB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QUNqRCxDQUFDOzs7OztJQUVELE9BQU8sQ0FBQyxLQUFpQjtRQUNyQiwrREFBK0Q7UUFDL0QsMEZBQTBGO1FBRTFGLElBQUksQ0FBQyxRQUFRLENBQUMsY0FBYyxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQzdDLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUU7WUFDcEIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsQ0FBQztTQUN4QjtJQUNMLENBQUM7Ozs7O0lBRUQsWUFBWSxDQUFDLE1BQU07UUFDZixJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsVUFBVSxFQUFFO1lBQ3pCLElBQUksQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1NBQ25DO0lBQ0wsQ0FBQzs7O1lBekpKLFNBQVMsU0FBQztnQkFDUCxRQUFRLEVBQUUsb0JBQW9CO2dCQUM5QixRQUFRLEVBQUU7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7S0FtRVQ7YUFDSjs7OztZQTlFMkIsU0FBUztZQUFFLFVBQVU7WUFJeEMsbUJBQW1CO1lBYmdDLFFBQVE7Ozt1QkF5Ri9ELFNBQVMsU0FBQyxRQUFROzs7O0lBQW5CLDJDQUFtRDs7SUFVbkQsa0RBQXdCOztJQXlFeEIsbURBTUM7Ozs7O0lBOUU4QyxzQ0FBZ0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBkZWJvdW5jZVRpbWUgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7IEFmdGVyVmlld0luaXQsIEFwcGxpY2F0aW9uUmVmLCBJbmplY3QsIGZvcndhcmRSZWYsIEluamVjdG9yIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbi8qXHJcbiAqIEBBdXRob3I6IOeWr+eLguengOaJjShMdWNhcyBIdWFuZylcclxuICogQERhdGU6IDIwMTktMDgtMTQgMTE6NDE6MDBcclxuICogQExhc3RFZGl0b3JzOiDnlq/ni4Lnp4DmiY0oTHVjYXMgSHVhbmcpXHJcbiAqIEBMYXN0RWRpdFRpbWU6IDIwMTktMTAtMTQgMTM6MDA6NDhcclxuICogQFFROiAxMDU1ODE4MjM5XHJcbiAqIEBWZXJzaW9uOiB2MC4wLjFcclxuICovXHJcbmltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBSZW5kZXJlcjIsIEVsZW1lbnRSZWYsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZEJhc2VFZGl0b3JEaXJlY3RpdmUgfSBmcm9tICcuLi9kYXRhZ3JpZC1iYXNlLWVkaXRvci5kaXJlY3RpdmUnO1xyXG5pbXBvcnQgeyBMb29rdXBEZWZhdWx0T3B0aW9ucyB9IGZyb20gJy4uL2VkaXRvci1kZWZhdWx0LW9wdGlvbnMnO1xyXG5pbXBvcnQgeyBMb29rdXBHcmlkQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1sb29rdXAnO1xyXG5pbXBvcnQgeyBSdW50aW1lU3RhdGVTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1jb21tb24nO1xyXG5cclxuXHJcbi8vIFxyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAnZ3JpZC1lZGl0b3ItbG9va3VwJyxcclxuICAgIHRlbXBsYXRlOiBgXHJcbiAgICA8ZGl2IFtmb3JtR3JvdXBdPVwiZ3JvdXBcIiBjbGFzcz1cImYtZGF0YWdyaWQtY2VsbC1mb3JtZ3JvdXAgZmFycmlzLWdyb3VwLWF1dG9cIj5cclxuICAgICAgICA8ZGF0YWdyaWQtdG9vbHRpcCBbY29udHJvbF09XCJmb3JtQ29udHJvbFwiIFt0b29sdGlwUG9zaXRpb25dPVwiJ3RvcC1sZWZ0J1wiIFttZXNzYWdlXT1cImVycm9yTWVzc2FnZVwiPlxyXG4gICAgICAgICAgICA8ZmFycmlzLWxvb2t1cC1ncmlkICNsb29rdXAgc3R5bGU9XCJ3aWR0aDogMTAwJVwiXHJcbiAgICAgICAgICAgICAgICBpZD1cInt7IGNvbnRyb2xJZCB9fVwiXHJcbiAgICAgICAgICAgICAgICBbZm9ybUNvbnRyb2xOYW1lXT1cImNvbHVtbi5maWVsZFwiXHJcbiAgICAgICAgICAgICAgICBbdXJpXT1cIm9wdGlvbnMudXJpXCJcclxuICAgICAgICAgICAgICAgIFtoZWxwSWRdPVwib3B0aW9ucy5oZWxwSWRcIlxyXG4gICAgICAgICAgICAgICAgW2Rpc3BsYXlUeXBlXT1cIm9wdGlvbnMuZGlzcGxheVR5cGVcIlxyXG4gICAgICAgICAgICAgICAgW3NpbmdsZVNlbGVjdF09XCJvcHRpb25zLnNpbmdsZVNlbGVjdFwiXHJcbiAgICAgICAgICAgICAgICBbaWRGaWVsZF09XCJvcHRpb25zLmlkRmllbGRcIlxyXG4gICAgICAgICAgICAgICAgW3BhZ2VTaXplXT1cIm9wdGlvbnMucGFnZVNpemUgfHwgMjBcIlxyXG4gICAgICAgICAgICAgICAgW3BhZ2VJbmRleF09XCJvcHRpb25zLnBhZ2VTaXplIHx8IDFcIlxyXG4gICAgICAgICAgICAgICAgW3BhZ2luYXRpb25dPVwib3B0aW9ucy5wYWdlaW5hdGlvblwiXHJcbiAgICAgICAgICAgICAgICBbdGV4dEZpZWxkXT1cIm9wdGlvbnMudGV4dEZpZWxkXCJcclxuICAgICAgICAgICAgICAgIFt2YWx1ZUZpZWxkXT1cIm9wdGlvbnMudmFsdWVGaWVsZFwiXHJcbiAgICAgICAgICAgICAgICBbdGl0bGVdPVwib3B0aW9ucy50aXRsZVwiXHJcbiAgICAgICAgICAgICAgICBbdXNlRmF2b3JpdGVdPVwib3B0aW9ucy51c2VGYXZvcml0ZVwiXHJcbiAgICAgICAgICAgICAgICBbaXNSZWNvcmRTaXplXT1cIm9wdGlvbnMuaXNSZWNvcmRTaXplXCJcclxuICAgICAgICAgICAgICAgIFt1c2VUaXBdPVwib3B0aW9ucy51c2VUaXBcIlxyXG4gICAgICAgICAgICAgICAgW2VkaXRhYmxlXT1cIm9wdGlvbnMuZWRpdGFibGVcIlxyXG4gICAgICAgICAgICAgICAgW3JlYWRvbmx5XT1cIm9wdGlvbnMucmVhZG9ubHlcIlxyXG4gICAgICAgICAgICAgICAgW2RpYWxvZ1dpZHRoXT1cIm9wdGlvbnMuZGlhbG9nV2lkdGhcIlxyXG4gICAgICAgICAgICAgICAgW2RpYWxvZ0hlaWdodF09XCJvcHRpb25zLmRpYWxvZ0hlaWdodFwiXHJcbiAgICAgICAgICAgICAgICBbc2hvd01heEJ1dHRvbl09XCJvcHRpb25zLnNob3dNYXhCdXR0b25cIlxyXG4gICAgICAgICAgICAgICAgW3Nob3dDbG9zZUJ1dHRvbl09XCJvcHRpb25zLnNob3dDbG9zZUJ1dHRvblwiXHJcbiAgICAgICAgICAgICAgICBbcmVzaXphYmxlXT1cIm9wdGlvbnMucmVzaXphYmxlXCJcclxuICAgICAgICAgICAgICAgIFtidXR0b25BbGlnbl09XCJvcHRpb25zLmJ1dHRvbkFsaWduXCJcclxuICAgICAgICAgICAgICAgIFtlbmFibGVDbGVhcl09XCJvcHRpb25zLmVuYWJsZUNsZWFyXCJcclxuICAgICAgICAgICAgICAgIFtzZWFyY2hPblNlcnZlcl09XCJvcHRpb25zLnNlYXJjaE9uU2VydmVyXCJcclxuICAgICAgICAgICAgICAgIFtub3NlYXJjaF09XCJvcHRpb25zLm5vc2VhcmNoXCJcclxuICAgICAgICAgICAgICAgIFttYXhMZW5ndGhdPVwib3B0aW9ucy5tYXhMZW5ndGhcIlxyXG4gICAgICAgICAgICAgICAgW21hcHBpbmdGbl09XCJvcHRpb25zLm1hcHBpbmdGblwiXHJcbiAgICAgICAgICAgICAgICBbbWFwRmllbGRzXT1cIm9wdGlvbnMubWFwRmllbGRzXCJcclxuICAgICAgICAgICAgICAgIFtjb250ZXh0XT1cIm9wdGlvbnMuY29udGV4dFwiXHJcbiAgICAgICAgICAgICAgICBbZXhwYW5kTGV2ZWxdPVwib3B0aW9ucy5leHBhbmRMZXZlbFwiXHJcbiAgICAgICAgICAgICAgICBbZGljdFBpY2tpbmddPVwib3B0aW9ucy5kaWN0UGlja2luZ1wiXHJcbiAgICAgICAgICAgICAgICBbZGljdFBpY2tlZF09XCJvcHRpb25zLmRpY3RQaWNrZWRcIlxyXG4gICAgICAgICAgICAgICAgW2VuYWJsZUZ1bGxUcmVlXT1cIm9wdGlvbnMuZW5hYmxlRnVsbFRyZWVcIlxyXG4gICAgICAgICAgICAgICAgW2xvYWRUcmVlRGF0YVR5cGVdPVwib3B0aW9ucy5sb2FkVHJlZURhdGFUeXBlXCJcclxuICAgICAgICAgICAgICAgIFtlbmFibGVDYXNjYWRlXT1cIm9wdGlvbnMuZW5hYmxlQ2FzY2FkZVwiXHJcbiAgICAgICAgICAgICAgICBbY2FzY2FkZVN0YXR1c109XCJvcHRpb25zLmNhc2NhZGVTdGF0dXNcIlxyXG4gICAgICAgICAgICAgICAgW3VzZUV4dGVuZEluZm9dPVwib3B0aW9ucy51c2VFeHRlbmRJbmZvXCJcclxuICAgICAgICAgICAgICAgIFtleHRJbmZvRmllbGRzXT1cIm9wdGlvbnMuZXh0SW5mb0ZpZWxkc1wiXHJcbiAgICAgICAgICAgICAgICBbZXh0SW5mb0Zvcm1hdHRlcl09XCJvcHRpb25zLmV4dEluZm9Gb3JtYXR0ZXJcIlxyXG4gICAgICAgICAgICAgICAgW3RleHRBbGlnbl09XCJvcHRpb25zLnRleHRBbGlnblwiXHJcbiAgICAgICAgICAgICAgICBbbG9hZERhdGFXaGVuT3Blbl09XCJvcHRpb25zLmxvYWREYXRhV2hlbk9wZW5cIlxyXG4gICAgICAgICAgICAgICAgW3NlbGVjdEZpcnN0SW5OYXZdPVwib3B0aW9ucy5zZWxlY3RGaXJzdEluTmF2XCJcclxuICAgICAgICAgICAgICAgIFtjdXN0b21OYXZGb3JtYXR0ZXJdPVwib3B0aW9ucy5jdXN0b21OYXZGb3JtYXR0ZXJcIlxyXG4gICAgICAgICAgICAgICAgW2N1c3RvbUZvcm1hdHRlcl09XCJvcHRpb25zLmN1c3RvbUZvcm1hdHRlclwiXHJcbiAgICAgICAgICAgICAgICBbdHJlZUluZm9dPVwib3B0aW9ucz8udHJlZUluZm9cIlxyXG4gICAgICAgICAgICAgICAgKGRpYWxvZ0Nsb3NlZCk9XCJvbkRpYWxvZ0Nsb3NlZCgpXCJcclxuICAgICAgICAgICAgICAgIChkaWFsb2dPcGVuZWQpPVwib25EaWFsb2dPcGVuKClcIlxyXG4gICAgICAgICAgICAgICAgKGNsZWFyKT1cIm9uQ2xlYXIoJGV2ZW50KVwiXHJcbiAgICAgICAgICAgICAgICAobG9hZFN1Y2Nlc3MpPVwib25Mb2FkU3VjY2VzcygpXCJcclxuICAgICAgICAgICAgICAgIFt0cmVlVGFibGVPcHRpb25zXT1cIm9wdGlvbnM/LnRyZWVUYWJsZU9wdGlvbnNcIlxyXG4gICAgICAgICAgICAgICAgW3Nob3dDaGVja0FsbF09XCJvcHRpb25zPy5zaG93Q2hlY2tBbGxcIlxyXG4gICAgICAgICAgICAgICAgW3ZpZXdUeXBlXT1cIm9wdGlvbnM/LnZpZXdUeXBlXCJcclxuICAgICAgICAgICAgICAgICh0YWdSZW1vdmVkKT1cIm9uVGFnUmVtb3ZlZCgkZXZlbnQpXCJcclxuICAgICAgICAgICAgICAgIFtxdWlja1NlbGVjdF09XCJvcHRpb25zPy5xdWlja1NlbGVjdFwiXHJcbiAgICAgICAgICAgICAgICBbdHJlZVRvTGlzdF09XCJvcHRpb25zPy50cmVlVG9MaXN0XCJcclxuICAgICAgICAgICAgICAgIFtuYXZUcmVlVG9MaXN0XT1cIm9wdGlvbnM/Lm5hdlRyZWVUb0xpc3RcIlxyXG4gICAgICAgICAgICAgICAgW3Nob3dDYXNjYWRlQ29udHJvbF09XCJvcHRpb25zLnNob3dDYXNjYWRlQ29udHJvbFwiXHJcbiAgICAgICAgICAgICAgICBbc2hvd05hdmlnYXRpb25dPVwib3B0aW9ucy5zaG93TmF2aWdhdGlvblwiXHJcbiAgICAgICAgICAgID48L2ZhcnJpcy1sb29rdXAtZ3JpZD5cclxuICAgICAgICA8L2RhdGFncmlkLXRvb2x0aXA+XHJcbiAgICA8L2Rpdj5cclxuICAgIGAsXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBEYXRhZ3JpZExvb2t1cENvbXBvbmVudCBleHRlbmRzIERhdGFncmlkQmFzZUVkaXRvckRpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCB7XHJcbiAgICBAVmlld0NoaWxkKCdsb29rdXAnKSBpbnN0YW5jZTogTG9va3VwR3JpZENvbXBvbmVudDtcclxuXHJcblxyXG4gICAgc2V0IGNvbnRyb2xJZChpZCkge1xyXG4gICAgICAgIHRoaXMuaW5zdGFuY2UuY29udHJvbElkID0gaWQ7XHJcbiAgICAgICAgaWYgKHRoaXMuaW5zdGFuY2UudXJpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zdGFuY2UuY29udHJvbElkICs9ICdfJyArIHRoaXMuaW5zdGFuY2UudXJpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzdG9wUHJvcGFnYXRpb24gPSBmYWxzZTtcclxuICAgIGNvbnN0cnVjdG9yKHJlbmRlcjogUmVuZGVyZXIyLCBlbDogRWxlbWVudFJlZiwgcHJpdmF0ZSBydHM6IFJ1bnRpbWVTdGF0ZVNlcnZpY2UsXHJcbiAgICAgICAgICAgICAgICBpbmplY3RvcjogSW5qZWN0b3IpIHtcclxuICAgICAgICBzdXBlcihyZW5kZXIsIGVsLCBpbmplY3Rvcik7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKTogdm9pZCB7XHJcbiAgICAgICAgc3VwZXIubmdPbkluaXQoKTtcclxuXHJcbiAgICAgICAgaWYgKCF0aGlzLm9wdGlvbnMudmFsdWVGaWVsZCkge1xyXG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMudmFsdWVGaWVsZCA9IHRoaXMub3B0aW9ucy5pZEZpZWxkXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLm9wdGlvbnMgPSBPYmplY3QuYXNzaWduKCB7fSAsIExvb2t1cERlZmF1bHRPcHRpb25zLCB0aGlzLm9wdGlvbnMpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcclxuICAgICAgICB0aGlzLmluc3RhbmNlLmNoYW5nZURldGVjdG9yLmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLnZpZXdUeXBlID09PSAndGFnJykge1xyXG4gICAgICAgICAgICB0aGlzLmlucHV0RWxlbWVudCA9IHRoaXMuaW5zdGFuY2UudGFnYm94Lm5hdGl2ZUVsZW1lbnQ7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5pbnB1dEVsZW1lbnQgPSB0aGlzLmluc3RhbmNlLmlucHV0R3JvdXAudGV4dGJveC5uYXRpdmVFbGVtZW50O1xyXG4gICAgICAgIH1cclxuICAgICAgICBzdXBlci5uZ0FmdGVyVmlld0luaXQoKTtcclxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmxvYWRlcikge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5pbnN0YW5jZVsnaHR0cCddKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBnZXREYXRhRm4gPSB0aGlzLmluc3RhbmNlWydodHRwJ107XHJcbiAgICAgICAgICAgICAgICB0aGlzLmluc3RhbmNlWydodHRwJ10gPSB7Li4uZ2V0RGF0YUZuLCBnZXREYXRhOiB0aGlzLm9wdGlvbnMubG9hZGVyfTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5zdGFuY2VbJ2h0dHAnXSA9IHtnZXREYXRhOiB0aGlzLm9wdGlvbnMubG9hZGVyfTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5pbnN0YW5jZVsnaG9zdCddID0gdGhpcy5kZztcclxuXHJcbiAgICAgICAgdGhpcy5ydHMuc3RhdGUkLnBpcGUoXHJcbiAgICAgICAgICAgIGRlYm91bmNlVGltZSgxMClcclxuICAgICAgICApLnN1YnNjcmliZShzdGF0ZSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChzdGF0ZSAmJiBzdGF0ZS5mb3JtICYmIHN0YXRlLmZvcm0ubG9va3VwICYmIHRoaXMuZGcpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucGVuZGluZyA9IHN0YXRlLmZvcm0ubG9va3VwLnBlbmRpbmc7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRnLnBlbmRpbmcgPSB0aGlzLnBlbmRpbmc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBvbkRpYWxvZ0Nsb3NlZCgpIHtcclxuICAgICAgICAvLyB0aGlzLmxvb2t1cC5jaGFuZ2VEZXRlY3Rvci5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgb25EaWFsb2dPcGVuKCkge1xyXG4gICAgICAgIHRoaXMuaW5zdGFuY2UuY2hhbmdlRGV0ZWN0b3IuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uTG9hZFN1Y2Nlc3MoKSB7XHJcbiAgICAgICAgdGhpcy5pbnN0YW5jZS5jaGFuZ2VEZXRlY3Rvci5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgb25DbGVhcihldmVudDogTW91c2VFdmVudCkge1xyXG4gICAgICAgIC8vIGNvbnN0IHJvd0RhdGEgPSB0aGlzLmluc3RhbmNlLnNlbGVjdGlvbk1nci5nZXRCaW5kaW5nRGF0YSgpO1xyXG4gICAgICAgIC8vIHRoaXMuaW5zdGFuY2VbJ2RlZmF1bHRNYXBwaW5nJ10ubG9va3VwRmllbGRNYXAobnVsbCwgdGhpcy5pbnN0YW5jZS5tYXBGaWVsZHMsIHJvd0RhdGEpO1xyXG5cclxuICAgICAgICB0aGlzLmluc3RhbmNlLmNoYW5nZURldGVjdG9yLmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmNsZWFyKSB7XHJcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5jbGVhcigpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBvblRhZ1JlbW92ZWQoJGV2bmV0KSB7XHJcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy50YWdSZW1vdmVkKSB7XHJcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy50YWdSZW1vdmVkKCRldm5ldCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGV4dEluZm9Gb3JtYXR0ZXIgPSAoZSkgPT4ge1xyXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuZXh0SW5mb0Zvcm1hdHRlcikge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLmV4dEluZm9Gb3JtYXR0ZXIoeyBiaW5kaW5nRGF0YTogdGhpcy5kci5yb3dEYXRhLCBpbnN0YW5jZTogZS5pbnN0YW5jZSB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiAnJztcclxuICAgIH1cclxufVxyXG4iXX0=