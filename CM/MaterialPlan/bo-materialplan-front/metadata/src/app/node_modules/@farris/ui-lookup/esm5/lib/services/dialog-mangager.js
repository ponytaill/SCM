/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
var LookupDialogManager = /** @class */ (function () {
    function LookupDialogManager(ins) {
        this.ins = ins;
        this.lookupInit = null;
        this._loadDataWhenOpen = true;
        this._navSelectedId = '';
        this._selectFirstInNav = false;
        this.dialogClosedSubscription = null;
        this.dialogOpenedSubscription = null;
        this.keyDownHandler = null;
    }
    /**
     * @private
     * @return {?}
     */
    LookupDialogManager.prototype.unsubscribes = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.lookupInit) {
            this.lookupInit.unsubscribe();
            this.lookupInit = null;
        }
        if (this.dialogClosedSubscription) {
            this.dialogClosedSubscription.unsubscribe();
            this.dialogClosedSubscription = null;
        }
        if (this.dialogOpenedSubscription) {
            this.dialogOpenedSubscription.unsubscribe();
            this.dialogOpenedSubscription = null;
        }
    };
    // 帮助窗口关闭后做一些清理工作
    // 帮助窗口关闭后做一些清理工作
    /**
     * @return {?}
     */
    LookupDialogManager.prototype.dialogClosed = 
    // 帮助窗口关闭后做一些清理工作
    /**
     * @return {?}
     */
    function () {
        if (this.ins.displayText !== this.ins.originalText && !this.ins.nosearch) {
            this.ins.displayText = this.ins.originalText;
            this.ins.setModelValue(this.ins.displayText);
        }
        if (this.ins.componentRef) {
            this.ins.componentRef.destroy();
            this.ins.componentRef = null;
        }
        if (this.ins.favoritesComponentRef) {
            this.ins.favoritesComponentRef.destroy();
            this.ins.favoritesComponentRef = null;
        }
        if (this.ins.contentContainer) {
            this.ins.contentContainer.clear();
        }
        if (this.ins.centerContainer) {
            this.ins.centerContainer.clear();
        }
        if (this.ins.leftComponentRef) {
            this.ins.leftComponentRef.destroy();
            this.ins.leftComponentRef = null;
        }
        if (this.ins.leftContainer) {
            this.ins.leftContainer.clear();
        }
        this.ins.isShow = false;
        this.ins.isTextChange = false;
        if (this.ins.dialog) {
            this.ins.content = null;
        }
        this.ins.navigationFilter = null;
        this.ins.lookupUtils.pendingEnd();
        if (this.ins.helpId) {
            this.ins.displayType = '';
        }
        this.unsubscribes();
        // this.ins.items = [];
        this.ins.favoriteItems = [];
        this.ins.lookupSelectionSer.initFavoriteItems([]);
        this.ins.isTabChanged = false;
        if (this.ins.uri) {
            this.ins.items = [];
        }
        this.ins._searchState = null;
        this.ins.pageIndex = 1;
        this.ins.loadDataWhenOpen = this._loadDataWhenOpen;
        this.ins.navSelectedIds = this._navSelectedId;
        this.ins.selectFirstInNav = this._selectFirstInNav;
        this.ins.isGetAllChidlNodes = false;
        this.ins.enableGetAllChildNodes = true;
        // 保存个性化数据
        if (this.ins.usePersionalConf && this.ins.favoriteDataFrom !== 'locale') {
            this.ins.httpMgr.submitFavoriteData('dialog closed event.');
        }
        if (this.keyDownHandler) {
            this.keyDownHandler();
            this.keyDownHandler = null;
        }
        if (this.ins.inputGroup) {
            this.ins.inputGroup.focus();
        }
        this.ins.userInitialConfig.reset();
        this.ins.treeInfo = this.ins._treeInfo_;
        this.ins.lookupUtils.destroy();
        this.ins.dialogClosed.emit();
        if (this.ins.includeSubordinates$$) {
            this.ins.includeSubordinates$$.unsubscribe();
            this.ins.includeSubordinates$$ = null;
        }
        this.ins.searching = false;
        if (this.ins.dtEventMgr) {
            this.ins.dtEventMgr['_sortState'] = null;
        }
        if (this.ins.ttEventMgr) {
            this.ins.ttEventMgr['_sortState'] = null;
        }
    };
    /**
     * @return {?}
     */
    LookupDialogManager.prototype.onDialogCreated = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this._loadDataWhenOpen = this.ins.loadDataWhenOpen;
        this._navSelectedId = this.ins.navSelectedIds;
        this._selectFirstInNav = this.ins.selectFirstInNav;
        this.ins.dialogCreatedSubscription = this.ins.dialogCreated.subscribe((/**
         * @param {?} dlg
         * @return {?}
         */
        function (dlg) {
            if (dlg) {
                if (_this.ins.dialogOpenedSubscription) {
                    _this.ins.dialogOpenedSubscription.unsubscribe();
                }
                if (_this.ins.dialogClosedSubscription) {
                    _this.ins.dialogClosedSubscription.unsubscribe();
                }
                _this.registerDialogEvent();
                if (_this.ins.isRecordSize) {
                    /** @type {?} */
                    var dlgSize = _this.ins.personalConfigService.getDialogSize();
                    if (dlgSize) {
                        var width = dlgSize.width, height = dlgSize.height;
                        _this.ins.dialogWidth = width ? width : _this.ins.dialogWidth;
                        _this.ins.dialogHeight = height ? height : _this.ins.dialogHeight;
                        // 20200908 更新现窗口的尺寸 by Lucas
                        dlg.width = _this.ins.dialogWidth;
                        dlg.height = _this.ins.dialogHeight;
                    }
                }
                dlg.show();
            }
        }));
        this.ins.subscriptions.push(this.ins.dialogCreatedSubscription);
    };
    /**
     * @param {?} pr
     * @return {?}
     */
    LookupDialogManager.prototype.checkDictPickingResult = /**
     * @param {?} pr
     * @return {?}
     */
    function (pr) {
        /** @type {?} */
        var o = true;
        if (pr === undefined || pr === null || pr === '') {
            o = true;
        }
        if (typeof pr === 'boolean') {
            o = pr;
        }
        /** @type {?} */
        var customData;
        /** @type {?} */
        var selectedIds;
        /** @type {?} */
        var message;
        customData = this.ins.customData;
        selectedIds = this.ins.selectedIds;
        if (typeof pr === 'object') {
            if (pr.showDialog === undefined) {
                o = true;
            }
            else {
                o = pr.showDialog;
            }
            if (pr.hasOwnProperty('data')) {
                /** 保存帮助前传递的数据 */
                customData = pr.data;
            }
            selectedIds = pr.selectedIds || null;
            if (pr.message) {
                message = pr.message;
            }
        }
        return { show: o, customData: customData, selectedIds: selectedIds, message: message };
    };
    /**
     * @param {?} pr
     * @return {?}
     */
    LookupDialogManager.prototype.canOpenDialog = /**
     * @param {?} pr
     * @return {?}
     */
    function (pr) {
        var _a = this.checkDictPickingResult(pr), show = _a.show, customData = _a.customData, selectedIds = _a.selectedIds, message = _a.message;
        this.ins.customData = customData;
        this.ins.selectedIds = selectedIds || null;
        if (message) {
            this.ins.notifyService.warning(message);
        }
        this.ins.isReady = false;
        this.ins.isShow = show;
    };
    /**
     * @return {?}
     */
    LookupDialogManager.prototype.getHeight = /**
     * @return {?}
     */
    function () {
        return this.ins.dialog.size.contentHeight -
            this.ins.containerMargin.bottom -
            this.ins.containerMargin.top -
            (this.ins.layoutFormat === 'default' ? this.ins.useFavorite ? 40 : 0 : 56);
    };
    /**
     * @private
     * @return {?}
     */
    LookupDialogManager.prototype.getMainGridSize = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.ins.isDoublleList()) {
            return {
                width: this.ins.dialog.size.width - this.ins.leftPanel.width - 27,
                height: this.getHeight()
            };
        }
        return {
            width: this.ins.dialog.size.width - this.ins.containerMargin.left - this.ins.containerMargin.right,
            height: this.getHeight()
        };
    };
    /**
     * @return {?}
     */
    LookupDialogManager.prototype.resetDialogContentHeight = /**
     * @return {?}
     */
    function () {
        var _a = this.ins.dialog.size, hHeight = _a.header, fHeight = _a.footer;
        return this.ins.dialogHeight - hHeight - fHeight - this.ins.containerMargin.bottom - this.ins.containerMargin.top;
    };
    /** 注册弹出窗口的事件 */
    /**
     * 注册弹出窗口的事件
     * @private
     * @return {?}
     */
    LookupDialogManager.prototype.registerDialogEvent = /**
     * 注册弹出窗口的事件
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        this.dialogOpenedSubscription = this.ins.dialog.opened.subscribe((/**
         * @return {?}
         */
        function () {
            // const dialogEl = this.ins.dialog.dialogEl.nativeElement;
            // this.ins.render2.removeStyle(dialogEl, 'margin-left', RendererStyleFlags2.DashCase);
            // this.ins.render2.removeStyle(dialogEl, 'margin-top', RendererStyleFlags2.DashCase);
            // this.ins.render2.setStyle(dialogEl, 'top' , this.ins.dialog.postitionStyles.top);
            // this.ins.render2.setStyle(dialogEl, 'left' , this.ins.dialog.postitionStyles.left);
            // this.ins.render2.addClass(dialogEl, 'm-0');
            _this.ins.dialogContentHeight = _this.resetDialogContentHeight();
            _this.ins.gridOptions = Object.assign(_this.ins.gridOptions, _this.getMainGridSize());
            _this.ins.dialog.el.nativeElement.querySelector('.ps-content').style.height = '100%';
            if (_this.ins.displayType && _this.ins.customDisplayType) {
                _this.ins.componentRef = _this.ins.lookupCmpMgr.createContent(_this.ins.gridOptions);
                _this.ins.lookupCmpMgr.createFavoriteComponent();
            }
            _this.ins.initData();
            // 修改帮助窗口的状态
            _this.ins.lookupUtils.pendingEnd();
            _this.ins.dialogOpened.emit();
        }));
        this.lookupInit = this.ins.lookupinitializationSubject.subscribe((/**
         * @return {?}
         */
        function () {
            _this.ins.loadDataWhenOpen = true;
            // 注册快捷键
            _this.registerShortcutKey();
            // 监听左侧尺寸变化事件
            if (_this.ins.leftPanel) {
                /** @type {?} */
                var leftPanelResize$ = _this.ins.leftPanel.resizing.subscribe((/**
                 * @param {?} s
                 * @return {?}
                 */
                function (s) {
                    _this.ins.componentRef.instance.resize({
                        width: _this.ins.dialog.size.width - s.size.width - 27,
                        height: _this.getHeight()
                    });
                    _this.ins.leftComponentRef.instance.resize(s.size);
                }));
                _this.ins.subscriptions.push(leftPanelResize$);
            }
        }));
        this.dialogClosedSubscription = this.ins.dialog.closed.subscribe((/**
         * @return {?}
         */
        function () {
            // 输入框变化后，弹出窗口未选择数据关闭窗口时，还原原始值
            _this.ins.dialogMgr.dialogClosed();
        }));
        // this.ins.subscriptions.push(this.ins.dialogClosedSubscription);
    };
    /**
     * @private
     * @return {?}
     */
    LookupDialogManager.prototype.registerShortcutKey = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        // 回车，与确定按钮处理逻辑一至。
        /** @type {?} */
        var dlgContainerDom = this.ins.dialog.el.nativeElement.querySelector('.farris-modal');
        if (dlgContainerDom && this.ins.shortcutKey && !this.keyDownHandler) {
            this.keyDownHandler = this.ins.eventManager.addEventListener(dlgContainerDom, 'keydown', (/**
             * @param {?} e
             * @return {?}
             */
            function (e) {
                e.stopPropagation();
                var _a = _this.ins.shortcutKey, moveUp = _a.moveUp, moveDown = _a.moveDown, searchFocus = _a.searchFocus, confirm = _a.confirm, nextPager = _a.nextPager, prevPager = _a.prevPager, expand = _a.expand, collapse = _a.collapse;
                /** @type {?} */
                var arrowKey = [moveUp, moveDown, expand, collapse];
                if (arrowKey.includes(e.code)) {
                    _this.ins.componentRef.instance.onKeydownEvent(e);
                }
                else if (e.key === confirm) {
                    if (e.target['nodeName'] === 'INPUT' && !e.ctrlKey) {
                        return;
                    }
                    _this.ins.okButton.nativeElement.click();
                }
                else if (e.code === searchFocus) { // 帮助窗口查询输入框焦点
                    e.preventDefault();
                    _this.ins.componentRef.instance.inputGroup.focus();
                }
                else if (!_this.ins.isTree() && (e.code === nextPager || e.code === prevPager)) { // 分页
                    // 分页
                    /** @type {?} */
                    var isNextPager = e.code === nextPager;
                    _this.paginationKeyDownHandler(isNextPager);
                }
            }));
        }
    };
    /**
     * @private
     * @param {?=} next
     * @return {?}
     */
    LookupDialogManager.prototype.paginationKeyDownHandler = /**
     * @private
     * @param {?=} next
     * @return {?}
     */
    function (next) {
        if (next === void 0) { next = true; }
        /** @type {?} */
        var datatableRef = this.ins.componentRef.instance;
        var pageIndex = datatableRef.pageIndex, pageSize = datatableRef.pageSize, total = datatableRef.total;
        /** @type {?} */
        var pagerCount = Math.ceil(total / pageSize);
        /** @type {?} */
        var newPageNum = pageIndex;
        if (next) {
            newPageNum = newPageNum + 1;
        }
        else {
            newPageNum = newPageNum - 1;
        }
        if (newPageNum > pagerCount || newPageNum < 1) {
            newPageNum = pageIndex;
        }
        this.ins.componentRef.instance.onPageChange({ pageSize: pageSize, pageIndex: newPageNum });
    };
    return LookupDialogManager;
}());
export { LookupDialogManager };
if (false) {
    /**
     * @type {?}
     * @private
     */
    LookupDialogManager.prototype.lookupInit;
    /**
     * @type {?}
     * @private
     */
    LookupDialogManager.prototype._loadDataWhenOpen;
    /**
     * @type {?}
     * @private
     */
    LookupDialogManager.prototype._navSelectedId;
    /**
     * @type {?}
     * @private
     */
    LookupDialogManager.prototype._selectFirstInNav;
    /**
     * @type {?}
     * @private
     */
    LookupDialogManager.prototype.dialogClosedSubscription;
    /**
     * @type {?}
     * @private
     */
    LookupDialogManager.prototype.dialogOpenedSubscription;
    /**
     * @type {?}
     * @private
     */
    LookupDialogManager.prototype.keyDownHandler;
    /**
     * @type {?}
     * @private
     */
    LookupDialogManager.prototype.ins;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGlhbG9nLW1hbmdhZ2VyLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1sb29rdXAvIiwic291cmNlcyI6WyJsaWIvc2VydmljZXMvZGlhbG9nLW1hbmdhZ2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFLQTtJQVdJLDZCQUFvQixHQUF3QjtRQUF4QixRQUFHLEdBQUgsR0FBRyxDQUFxQjtRQVRwQyxlQUFVLEdBQWlCLElBQUksQ0FBQztRQUNoQyxzQkFBaUIsR0FBRyxJQUFJLENBQUM7UUFDekIsbUJBQWMsR0FBRyxFQUFFLENBQUM7UUFDcEIsc0JBQWlCLEdBQUcsS0FBSyxDQUFDO1FBQzFCLDZCQUF3QixHQUFpQixJQUFJLENBQUM7UUFDOUMsNkJBQXdCLEdBQWlCLElBQUksQ0FBQztRQUU5QyxtQkFBYyxHQUFHLElBQUksQ0FBQztJQUVrQixDQUFDOzs7OztJQUV6QywwQ0FBWTs7OztJQUFwQjtRQUNJLElBQUksSUFBSSxDQUFDLFVBQVUsRUFBRTtZQUNqQixJQUFJLENBQUMsVUFBVSxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQzlCLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDO1NBQzFCO1FBRUQsSUFBSSxJQUFJLENBQUMsd0JBQXdCLEVBQUU7WUFDL0IsSUFBSSxDQUFDLHdCQUF3QixDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQzVDLElBQUksQ0FBQyx3QkFBd0IsR0FBRyxJQUFJLENBQUM7U0FDeEM7UUFFRCxJQUFJLElBQUksQ0FBQyx3QkFBd0IsRUFBRTtZQUMvQixJQUFJLENBQUMsd0JBQXdCLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDNUMsSUFBSSxDQUFDLHdCQUF3QixHQUFHLElBQUksQ0FBQztTQUN4QztJQUVMLENBQUM7SUFDRCxpQkFBaUI7Ozs7O0lBQ2pCLDBDQUFZOzs7OztJQUFaO1FBQ0ksSUFBSSxJQUFJLENBQUMsR0FBRyxDQUFDLFdBQVcsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLFlBQVksSUFB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QUFZLENBQUMsUUFBUSxDQUFDLFlBQVksQ0FBQyxFQUFFLFFBQVEsVUFBQSxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsQ0FBQyxDQUFDO0lBQ3JGLENBQUM7SUFFTCwwQkFBQztBQUFELENBQUMsQUE1VkQsSUE0VkM7Ozs7Ozs7SUExVkcseUNBQXdDOzs7OztJQUN4QyxnREFBaUM7Ozs7O0lBQ2pDLDZDQUE0Qjs7Ozs7SUFDNUIsZ0RBQWtDOzs7OztJQUNsQyx1REFBc0Q7Ozs7O0lBQ3RELHVEQUFzRDs7Ozs7SUFFdEQsNkNBQThCOzs7OztJQUVsQixrQ0FBZ0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBSZW5kZXJlclN0eWxlRmxhZ3MyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBQaWNraW5nUmVzdWx0IH0gZnJvbSAnLi4vbG9va3VwLWdyaWQtb3B0aW9ucyc7XHJcbmltcG9ydCB7IExvb2t1cEdyaWRDb21wb25lbnQgfSBmcm9tICcuLi9sb29rdXAtZ3JpZC5jb21wb25lbnQnO1xyXG5cclxuZXhwb3J0IGNsYXNzIExvb2t1cERpYWxvZ01hbmFnZXIge1xyXG5cclxuICAgIHByaXZhdGUgbG9va3VwSW5pdDogU3Vic2NyaXB0aW9uID0gbnVsbDtcclxuICAgIHByaXZhdGUgX2xvYWREYXRhV2hlbk9wZW4gPSB0cnVlO1xyXG4gICAgcHJpdmF0ZSBfbmF2U2VsZWN0ZWRJZCA9ICcnO1xyXG4gICAgcHJpdmF0ZSBfc2VsZWN0Rmlyc3RJbk5hdiA9IGZhbHNlO1xyXG4gICAgcHJpdmF0ZSBkaWFsb2dDbG9zZWRTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbiA9IG51bGw7XHJcbiAgICBwcml2YXRlIGRpYWxvZ09wZW5lZFN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uID0gbnVsbDtcclxuICAgIFxyXG4gICAgcHJpdmF0ZSBrZXlEb3duSGFuZGxlciA9IG51bGw7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBpbnM6IExvb2t1cEdyaWRDb21wb25lbnQpIHsgfVxyXG5cclxuICAgIHByaXZhdGUgdW5zdWJzY3JpYmVzKCl7XHJcbiAgICAgICAgaWYgKHRoaXMubG9va3VwSW5pdCkge1xyXG4gICAgICAgICAgICB0aGlzLmxvb2t1cEluaXQudW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgdGhpcy5sb29rdXBJbml0ID0gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmRpYWxvZ0Nsb3NlZFN1YnNjcmlwdGlvbikge1xyXG4gICAgICAgICAgICB0aGlzLmRpYWxvZ0Nsb3NlZFN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICB0aGlzLmRpYWxvZ0Nsb3NlZFN1YnNjcmlwdGlvbiA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5kaWFsb2dPcGVuZWRTdWJzY3JpcHRpb24pIHtcclxuICAgICAgICAgICAgdGhpcy5kaWFsb2dPcGVuZWRTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgdGhpcy5kaWFsb2dPcGVuZWRTdWJzY3JpcHRpb24gPSBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcbiAgICAvLyDluK7liqnnqpflj6PlhbPpl63lkI7lgZrkuIDkupvmuIXnkIblt6XkvZxcclxuICAgIGRpYWxvZ0Nsb3NlZCgpIHtcclxuICAgICAgICBpZiAodGhpcy5pbnMuZGlzcGxheVRleHQgIT09IHRoaXMuaW5zLm9yaWdpbmFsVGV4dCAmJiAhdGhpcy5pbnMubm9zZWFyY2gpIHtcclxuICAgICAgICAgICAgdGhpcy5pbnMuZGlzcGxheVRleHQgPSB0aGlzLmlucy5vcmlnaW5hbFRleHQ7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zLnNldE1vZGVsVmFsdWUodGhpcy5pbnMuZGlzcGxheVRleHQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuaW5zLmNvbXBvbmVudFJlZikge1xyXG4gICAgICAgICAgICB0aGlzLmlucy5jb21wb25lbnRSZWYuZGVzdHJveSgpO1xyXG4gICAgICAgICAgICB0aGlzLmlucy5jb21wb25lbnRSZWYgPSBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuaW5zLmZhdm9yaXRlc0NvbXBvbmVudFJlZikge1xyXG4gICAgICAgICAgICB0aGlzLmlucy5mYXZvcml0ZXNDb21wb25lbnRSZWYuZGVzdHJveSgpO1xyXG4gICAgICAgICAgICB0aGlzLmlucy5mYXZvcml0ZXNDb21wb25lbnRSZWYgPSBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuaW5zLmNvbnRlbnRDb250YWluZXIpIHtcclxuICAgICAgICAgICAgdGhpcy5pbnMuY29udGVudENvbnRhaW5lci5jbGVhcigpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuaW5zLmNlbnRlckNvbnRhaW5lcikge1xyXG4gICAgICAgICAgICB0aGlzLmlucy5jZW50ZXJDb250YWluZXIuY2xlYXIoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmlucy5sZWZ0Q29tcG9uZW50UmVmKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zLmxlZnRDb21wb25lbnRSZWYuZGVzdHJveSgpO1xyXG4gICAgICAgICAgICB0aGlzLmlucy5sZWZ0Q29tcG9uZW50UmVmID0gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmlucy5sZWZ0Q29udGFpbmVyKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zLmxlZnRDb250YWluZXIuY2xlYXIoKTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICB0aGlzLmlucy5pc1Nob3cgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmlucy5pc1RleHRDaGFuZ2UgPSBmYWxzZTtcclxuICAgICAgICBpZiAodGhpcy5pbnMuZGlhbG9nKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zLmNvbnRlbnQgPSBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5pbnMubmF2aWdhdGlvbkZpbHRlciA9IG51bGw7XHJcblxyXG4gICAgICAgIHRoaXMuaW5zLmxvb2t1cFV0aWxzLnBlbmRpbmdFbmQoKTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuaW5zLmhlbHBJZCkge1xyXG4gICAgICAgICAgICB0aGlzLmlucy5kaXNwbGF5VHlwZSA9ICcnO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIHRoaXMudW5zdWJzY3JpYmVzKCk7XHJcblxyXG4gICAgICAgIC8vIHRoaXMuaW5zLml0ZW1zID0gW107XHJcbiAgICAgICAgdGhpcy5pbnMuZmF2b3JpdGVJdGVtcyA9IFtdO1xyXG4gICAgICAgIHRoaXMuaW5zLmxvb2t1cFNlbGVjdGlvblNlci5pbml0RmF2b3JpdGVJdGVtcyhbXSk7XHJcblxyXG4gICAgICAgIHRoaXMuaW5zLmlzVGFiQ2hhbmdlZCA9IGZhbHNlO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5pbnMudXJpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zLml0ZW1zID0gW107XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaW5zLl9zZWFyY2hTdGF0ZSA9IG51bGw7XHJcblxyXG5cclxuICAgICAgICB0aGlzLmlucy5wYWdlSW5kZXggPSAxO1xyXG5cclxuICAgICAgICB0aGlzLmlucy5sb2FkRGF0YVdoZW5PcGVuID0gdGhpcy5fbG9hZERhdGFXaGVuT3BlbjtcclxuICAgICAgICB0aGlzLmlucy5uYXZTZWxlY3RlZElkcyA9IHRoaXMuX25hdlNlbGVjdGVkSWQ7XHJcbiAgICAgICAgdGhpcy5pbnMuc2VsZWN0Rmlyc3RJbk5hdiA9IHRoaXMuX3NlbGVjdEZpcnN0SW5OYXY7XHJcblxyXG4gICAgICAgIHRoaXMuaW5zLmlzR2V0QWxsQ2hpZGxOb2RlcyA9IGZhbHNlO1xyXG5cclxuICAgICAgICB0aGlzLmlucy5lbmFibGVHZXRBbGxDaGlsZE5vZGVzID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgLy8g5L+d5a2Y5Liq5oCn5YyW5pWw5o2uXHJcbiAgICAgICAgaWYgKHRoaXMuaW5zLnVzZVBlcnNpb25hbENvbmYgJiYgdGhpcy5pbnMuZmF2b3JpdGVEYXRhRnJvbSAhPT0gJ2xvY2FsZScpIHtcclxuICAgICAgICAgICAgdGhpcy5pbnMuaHR0cE1nci5zdWJtaXRGYXZvcml0ZURhdGEoJ2RpYWxvZyBjbG9zZWQgZXZlbnQuJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5rZXlEb3duSGFuZGxlcikge1xyXG4gICAgICAgICAgICB0aGlzLmtleURvd25IYW5kbGVyKCk7XHJcbiAgICAgICAgICAgIHRoaXMua2V5RG93bkhhbmRsZXIgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5pbnMuaW5wdXRHcm91cCkge1xyXG4gICAgICAgICAgICB0aGlzLmlucy5pbnB1dEdyb3VwLmZvY3VzKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmlucy51c2VySW5pdGlhbENvbmZpZy5yZXNldCgpO1xyXG5cclxuICAgICAgICB0aGlzLmlucy50cmVlSW5mbyA9IHRoaXMuaW5zLl90cmVlSW5mb187XHJcblxyXG4gICAgICAgIHRoaXMuaW5zLmxvb2t1cFV0aWxzLmRlc3Ryb3koKTtcclxuICAgICAgICB0aGlzLmlucy5kaWFsb2dDbG9zZWQuZW1pdCgpO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5pbnMuaW5jbHVkZVN1Ym9yZGluYXRlcyQkKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zLmluY2x1ZGVTdWJvcmRpbmF0ZXMkJC51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICB0aGlzLmlucy5pbmNsdWRlU3Vib3JkaW5hdGVzJCQgPSBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5pbnMuc2VhcmNoaW5nID0gZmFsc2U7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmlucy5kdEV2ZW50TWdyKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zLmR0RXZlbnRNZ3JbJ19zb3J0U3RhdGUnXSA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5pbnMudHRFdmVudE1ncikge1xyXG4gICAgICAgICAgICB0aGlzLmlucy50dEV2ZW50TWdyWydfc29ydFN0YXRlJ10gPSBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcblxyXG4gICAgb25EaWFsb2dDcmVhdGVkKCkge1xyXG4gICAgICAgIHRoaXMuX2xvYWREYXRhV2hlbk9wZW4gPSB0aGlzLmlucy5sb2FkRGF0YVdoZW5PcGVuO1xyXG4gICAgICAgIHRoaXMuX25hdlNlbGVjdGVkSWQgPSB0aGlzLmlucy5uYXZTZWxlY3RlZElkcztcclxuICAgICAgICB0aGlzLl9zZWxlY3RGaXJzdEluTmF2ID0gdGhpcy5pbnMuc2VsZWN0Rmlyc3RJbk5hdjtcclxuXHJcbiAgICAgICAgdGhpcy5pbnMuZGlhbG9nQ3JlYXRlZFN1YnNjcmlwdGlvbiA9IHRoaXMuaW5zLmRpYWxvZ0NyZWF0ZWQuc3Vic2NyaWJlKGRsZyA9PiB7XHJcbiAgICAgICAgICAgIGlmIChkbGcpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlucy5kaWFsb2dPcGVuZWRTdWJzY3JpcHRpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5kaWFsb2dPcGVuZWRTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlucy5kaWFsb2dDbG9zZWRTdWJzY3JpcHRpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5kaWFsb2dDbG9zZWRTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRoaXMucmVnaXN0ZXJEaWFsb2dFdmVudCgpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaW5zLmlzUmVjb3JkU2l6ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGRsZ1NpemUgPSB0aGlzLmlucy5wZXJzb25hbENvbmZpZ1NlcnZpY2UuZ2V0RGlhbG9nU2l6ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChkbGdTaXplKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgd2lkdGgsIGhlaWdodCB9ID0gZGxnU2l6ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMuZGlhbG9nV2lkdGggPSB3aWR0aCA/IHdpZHRoIDogdGhpcy5pbnMuZGlhbG9nV2lkdGg7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zLmRpYWxvZ0hlaWdodCA9IGhlaWdodCA/IGhlaWdodCA6IHRoaXMuaW5zLmRpYWxvZ0hlaWdodDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIDIwMjAwOTA4IOabtOaWsOeOsOeql+WPo+eahOWwuuWvuCBieSBMdWNhc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkbGcud2lkdGggPSB0aGlzLmlucy5kaWFsb2dXaWR0aDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGxnLmhlaWdodCA9IHRoaXMuaW5zLmRpYWxvZ0hlaWdodDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBkbGcuc2hvdygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMuaW5zLnN1YnNjcmlwdGlvbnMucHVzaCh0aGlzLmlucy5kaWFsb2dDcmVhdGVkU3Vic2NyaXB0aW9uKTtcclxuICAgIH1cclxuXHJcbiAgICBjaGVja0RpY3RQaWNraW5nUmVzdWx0KHByOiBQaWNraW5nUmVzdWx0IHwgYW55KSB7XHJcbiAgICAgICAgbGV0IG8gPSB0cnVlO1xyXG4gICAgICAgIGlmIChwciA9PT0gdW5kZWZpbmVkIHx8IHByID09PSBudWxsIHx8IHByID09PSAnJykge1xyXG4gICAgICAgICAgICBvID0gdHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0eXBlb2YgcHIgPT09ICdib29sZWFuJykge1xyXG4gICAgICAgICAgICBvID0gcHI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgY3VzdG9tRGF0YSwgc2VsZWN0ZWRJZHMsIG1lc3NhZ2U7XHJcbiAgICAgICAgY3VzdG9tRGF0YSA9IHRoaXMuaW5zLmN1c3RvbURhdGE7XHJcbiAgICAgICAgc2VsZWN0ZWRJZHMgPSB0aGlzLmlucy5zZWxlY3RlZElkcztcclxuXHJcbiAgICAgICAgaWYgKHR5cGVvZiBwciA9PT0gJ29iamVjdCcpIHtcclxuICAgICAgICAgICAgaWYgKHByLnNob3dEaWFsb2cgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgbyA9IHRydWU7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBvID0gcHIuc2hvd0RpYWxvZztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHByLmhhc093blByb3BlcnR5KCdkYXRhJykpIHtcclxuICAgICAgICAgICAgICAgIC8qKiDkv53lrZjluK7liqnliY3kvKDpgJLnmoTmlbDmja4gKi9cclxuICAgICAgICAgICAgICAgIGN1c3RvbURhdGEgPSBwci5kYXRhO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNlbGVjdGVkSWRzID0gcHIuc2VsZWN0ZWRJZHMgfHwgbnVsbDtcclxuXHJcbiAgICAgICAgICAgIGlmIChwci5tZXNzYWdlKSB7XHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlID0gcHIubWVzc2FnZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHsgc2hvdzogbywgY3VzdG9tRGF0YSwgc2VsZWN0ZWRJZHMsIG1lc3NhZ2UgfTtcclxuICAgIH1cclxuXHJcbiAgICBjYW5PcGVuRGlhbG9nKHByOiBQaWNraW5nUmVzdWx0IHwgYW55KSB7XHJcbiAgICAgICAgY29uc3Qge3Nob3csIGN1c3RvbURhdGEsIHNlbGVjdGVkSWRzLCBtZXNzYWdlfSA9IHRoaXMuY2hlY2tEaWN0UGlja2luZ1Jlc3VsdChwcik7XHJcbiAgICAgICAgdGhpcy5pbnMuY3VzdG9tRGF0YSA9IGN1c3RvbURhdGE7XHJcbiAgICAgICAgdGhpcy5pbnMuc2VsZWN0ZWRJZHMgPSBzZWxlY3RlZElkcyB8fCBudWxsO1xyXG4gICAgICAgIGlmIChtZXNzYWdlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zLm5vdGlmeVNlcnZpY2Uud2FybmluZyhtZXNzYWdlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuaW5zLmlzUmVhZHkgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmlucy5pc1Nob3cgPSBzaG93O1xyXG4gICAgfVxyXG5cclxuICAgIGdldEhlaWdodCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5pbnMuZGlhbG9nLnNpemUuY29udGVudEhlaWdodCAtXHJcbiAgICAgICAgICAgICAgICB0aGlzLmlucy5jb250YWluZXJNYXJnaW4uYm90dG9tIC1cclxuICAgICAgICAgICAgICAgIHRoaXMuaW5zLmNvbnRhaW5lck1hcmdpbi50b3AgLVxyXG4gICAgICAgICAgICAgICAgKCB0aGlzLmlucy5sYXlvdXRGb3JtYXQgPT09ICdkZWZhdWx0JyA/IHRoaXMuaW5zLnVzZUZhdm9yaXRlID8gNDAgOiAwIDogNTYpO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwcml2YXRlIGdldE1haW5HcmlkU2l6ZSgpIHtcclxuICAgICAgICBpZiAodGhpcy5pbnMuaXNEb3VibGxlTGlzdCgpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICB3aWR0aDogdGhpcy5pbnMuZGlhbG9nLnNpemUud2lkdGggLSB0aGlzLmlucy5sZWZ0UGFuZWwud2lkdGggLSAyNyxcclxuICAgICAgICAgICAgICAgIGhlaWdodDogdGhpcy5nZXRIZWlnaHQoKVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgd2lkdGg6IHRoaXMuaW5zLmRpYWxvZy5zaXplLndpZHRoIC0gdGhpcy5pbnMuY29udGFpbmVyTWFyZ2luLmxlZnQgLSB0aGlzLmlucy5jb250YWluZXJNYXJnaW4ucmlnaHQsXHJcbiAgICAgICAgICAgIGhlaWdodDogdGhpcy5nZXRIZWlnaHQoKVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgcmVzZXREaWFsb2dDb250ZW50SGVpZ2h0KCkge1xyXG4gICAgICAgIGNvbnN0IHsgaGVhZGVyOiBoSGVpZ2h0LCBmb290ZXI6IGZIZWlnaHQgfSA9IHRoaXMuaW5zLmRpYWxvZy5zaXplO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmlucy5kaWFsb2dIZWlnaHQgLSBoSGVpZ2h0IC0gZkhlaWdodCAtICB0aGlzLmlucy5jb250YWluZXJNYXJnaW4uYm90dG9tIC0gdGhpcy5pbnMuY29udGFpbmVyTWFyZ2luLnRvcDtcclxuICAgIH1cclxuXHJcbiAgICAvKiog5rOo5YaM5by55Ye656qX5Y+j55qE5LqL5Lu2ICovXHJcbiAgICBwcml2YXRlIHJlZ2lzdGVyRGlhbG9nRXZlbnQoKSB7XHJcbiAgICAgICAgdGhpcy5kaWFsb2dPcGVuZWRTdWJzY3JpcHRpb24gPSB0aGlzLmlucy5kaWFsb2cub3BlbmVkLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBjb25zdCBkaWFsb2dFbCA9IHRoaXMuaW5zLmRpYWxvZy5kaWFsb2dFbC5uYXRpdmVFbGVtZW50O1xyXG4gICAgICAgICAgICAvLyB0aGlzLmlucy5yZW5kZXIyLnJlbW92ZVN0eWxlKGRpYWxvZ0VsLCAnbWFyZ2luLWxlZnQnLCBSZW5kZXJlclN0eWxlRmxhZ3MyLkRhc2hDYXNlKTtcclxuICAgICAgICAgICAgLy8gdGhpcy5pbnMucmVuZGVyMi5yZW1vdmVTdHlsZShkaWFsb2dFbCwgJ21hcmdpbi10b3AnLCBSZW5kZXJlclN0eWxlRmxhZ3MyLkRhc2hDYXNlKTtcclxuICAgICAgICAgICAgLy8gdGhpcy5pbnMucmVuZGVyMi5zZXRTdHlsZShkaWFsb2dFbCwgJ3RvcCcgLCB0aGlzLmlucy5kaWFsb2cucG9zdGl0aW9uU3R5bGVzLnRvcCk7XHJcbiAgICAgICAgICAgIC8vIHRoaXMuaW5zLnJlbmRlcjIuc2V0U3R5bGUoZGlhbG9nRWwsICdsZWZ0JyAsIHRoaXMuaW5zLmRpYWxvZy5wb3N0aXRpb25TdHlsZXMubGVmdCk7XHJcbiAgICAgICAgICAgIC8vIHRoaXMuaW5zLnJlbmRlcjIuYWRkQ2xhc3MoZGlhbG9nRWwsICdtLTAnKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuaW5zLmRpYWxvZ0NvbnRlbnRIZWlnaHQgPSB0aGlzLnJlc2V0RGlhbG9nQ29udGVudEhlaWdodCgpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5pbnMuZ3JpZE9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHRoaXMuaW5zLmdyaWRPcHRpb25zLCB0aGlzLmdldE1haW5HcmlkU2l6ZSgpKTtcclxuICAgICAgICAgICAgdGhpcy5pbnMuZGlhbG9nLmVsLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcignLnBzLWNvbnRlbnQnKS5zdHlsZS5oZWlnaHQgPSAnMTAwJSc7XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5pbnMuZGlzcGxheVR5cGUgJiYgdGhpcy5pbnMuY3VzdG9tRGlzcGxheVR5cGUpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5zLmNvbXBvbmVudFJlZiA9IHRoaXMuaW5zLmxvb2t1cENtcE1nci5jcmVhdGVDb250ZW50KHRoaXMuaW5zLmdyaWRPcHRpb25zKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5zLmxvb2t1cENtcE1nci5jcmVhdGVGYXZvcml0ZUNvbXBvbmVudCgpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLmlucy5pbml0RGF0YSgpO1xyXG5cclxuICAgICAgICAgICAgLy8g5L+u5pS55biu5Yqp56qX5Y+j55qE54q25oCBXHJcbiAgICAgICAgICAgIHRoaXMuaW5zLmxvb2t1cFV0aWxzLnBlbmRpbmdFbmQoKTtcclxuICAgICAgICAgICAgdGhpcy5pbnMuZGlhbG9nT3BlbmVkLmVtaXQoKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGhpcy5sb29rdXBJbml0ID0gdGhpcy5pbnMubG9va3VwaW5pdGlhbGl6YXRpb25TdWJqZWN0LnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zLmxvYWREYXRhV2hlbk9wZW4gPSB0cnVlO1xyXG4gICAgICAgICAgICAvLyDms6jlhozlv6vmjbfplK5cclxuICAgICAgICAgICAgdGhpcy5yZWdpc3RlclNob3J0Y3V0S2V5KCk7XHJcbiAgICAgICAgICAgIC8vIOebkeWQrOW3puS+p+WwuuWvuOWPmOWMluS6i+S7tlxyXG4gICAgICAgICAgICBpZiAodGhpcy5pbnMubGVmdFBhbmVsKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBsZWZ0UGFuZWxSZXNpemUkID0gdGhpcy5pbnMubGVmdFBhbmVsLnJlc2l6aW5nLnN1YnNjcmliZSgoczogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMuY29tcG9uZW50UmVmLmluc3RhbmNlLnJlc2l6ZSh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiB0aGlzLmlucy5kaWFsb2cuc2l6ZS53aWR0aCAtIHMuc2l6ZS53aWR0aCAtIDI3LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IHRoaXMuZ2V0SGVpZ2h0KClcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5sZWZ0Q29tcG9uZW50UmVmLmluc3RhbmNlLnJlc2l6ZShzLnNpemUpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnMuc3Vic2NyaXB0aW9ucy5wdXNoKGxlZnRQYW5lbFJlc2l6ZSQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMuZGlhbG9nQ2xvc2VkU3Vic2NyaXB0aW9uID0gdGhpcy5pbnMuZGlhbG9nLmNsb3NlZC5zdWJzY3JpYmUoKCkgPT4ge1xyXG4gICAgICAgICAgICAvLyDovpPlhaXmoYblj5jljJblkI7vvIzlvLnlh7rnqpflj6PmnKrpgInmi6nmlbDmja7lhbPpl63nqpflj6Pml7bvvIzov5jljp/ljp/lp4vlgLxcclxuICAgICAgICAgICAgdGhpcy5pbnMuZGlhbG9nTWdyLmRpYWxvZ0Nsb3NlZCgpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyB0aGlzLmlucy5zdWJzY3JpcHRpb25zLnB1c2godGhpcy5pbnMuZGlhbG9nQ2xvc2VkU3Vic2NyaXB0aW9uKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHJlZ2lzdGVyU2hvcnRjdXRLZXkoKSB7XHJcbiAgICAgICAgLy8g5Zue6L2m77yM5LiO56Gu5a6a5oyJ6ZKu5aSE55CG6YC76L6R5LiA6Iez44CCXHJcbiAgICAgICAgY29uc3QgZGxnQ29udGFpbmVyRG9tID0gdGhpcy5pbnMuZGlhbG9nLmVsLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcignLmZhcnJpcy1tb2RhbCcpO1xyXG5cclxuICAgICAgICBpZiAoZGxnQ29udGFpbmVyRG9tICYmIHRoaXMuaW5zLnNob3J0Y3V0S2V5ICYmICF0aGlzLmtleURvd25IYW5kbGVyKSB7XHJcbiAgICAgICAgICAgIHRoaXMua2V5RG93bkhhbmRsZXIgPSB0aGlzLmlucy5ldmVudE1hbmFnZXIuYWRkRXZlbnRMaXN0ZW5lcihkbGdDb250YWluZXJEb20sICdrZXlkb3duJywgKGU6IEtleWJvYXJkRXZlbnQpID0+IHtcclxuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB7IG1vdmVVcCwgbW92ZURvd24sIHNlYXJjaEZvY3VzLCBjb25maXJtLCBuZXh0UGFnZXIsIHByZXZQYWdlciwgZXhwYW5kLCBjb2xsYXBzZSB9ID0gdGhpcy5pbnMuc2hvcnRjdXRLZXk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBhcnJvd0tleSA9IFttb3ZlVXAsIG1vdmVEb3duLCBleHBhbmQsIGNvbGxhcHNlXTtcclxuICAgICAgICAgICAgICAgIGlmIChhcnJvd0tleS5pbmNsdWRlcyhlLmNvZGUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMuY29tcG9uZW50UmVmLmluc3RhbmNlLm9uS2V5ZG93bkV2ZW50KGUpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlLmtleSA9PT0gY29uZmlybSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChlLnRhcmdldFsnbm9kZU5hbWUnXSA9PT0gJ0lOUFVUJyAmJiAhZS5jdHJsS2V5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMub2tCdXR0b24ubmF0aXZlRWxlbWVudC5jbGljaygpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlLmNvZGUgPT09IHNlYXJjaEZvY3VzKSB7IC8vIOW4ruWKqeeql+WPo+afpeivoui+k+WFpeahhueEpueCuVxyXG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5jb21wb25lbnRSZWYuaW5zdGFuY2UuaW5wdXRHcm91cC5mb2N1cygpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICghdGhpcy5pbnMuaXNUcmVlKCkgJiYgKGUuY29kZSA9PT0gbmV4dFBhZ2VyIHx8IGUuY29kZSA9PT0gcHJldlBhZ2VyICkpIHsgIC8vIOWIhumhtVxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzTmV4dFBhZ2VyID0gZS5jb2RlID09PSBuZXh0UGFnZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYWdpbmF0aW9uS2V5RG93bkhhbmRsZXIoaXNOZXh0UGFnZXIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBwYWdpbmF0aW9uS2V5RG93bkhhbmRsZXIobmV4dCA9IHRydWUpIHtcclxuICAgICAgICBjb25zdCBkYXRhdGFibGVSZWYgPSB0aGlzLmlucy5jb21wb25lbnRSZWYuaW5zdGFuY2U7XHJcbiAgICAgICAgY29uc3Qge3BhZ2VJbmRleCwgcGFnZVNpemUsIHRvdGFsfSA9IGRhdGF0YWJsZVJlZjtcclxuICAgICAgICBjb25zdCBwYWdlckNvdW50ID0gTWF0aC5jZWlsKHRvdGFsIC8gcGFnZVNpemUpO1xyXG5cclxuICAgICAgICBsZXQgbmV3UGFnZU51bSA9IHBhZ2VJbmRleDtcclxuICAgICAgICBpZiAobmV4dCkge1xyXG4gICAgICAgICAgICBuZXdQYWdlTnVtID0gbmV3UGFnZU51bSArIDE7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgbmV3UGFnZU51bSA9IG5ld1BhZ2VOdW0gLSAxO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKG5ld1BhZ2VOdW0gPiBwYWdlckNvdW50IHx8IG5ld1BhZ2VOdW0gPCAxKSB7XHJcbiAgICAgICAgICAgIG5ld1BhZ2VOdW0gPSBwYWdlSW5kZXg7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmlucy5jb21wb25lbnRSZWYuaW5zdGFuY2Uub25QYWdlQ2hhbmdlKHsgcGFnZVNpemUsIHBhZ2VJbmRleDogbmV3UGFnZU51bSB9KTtcclxuICAgIH1cclxuXHJcbn1cclxuXHJcbiJdfQ==