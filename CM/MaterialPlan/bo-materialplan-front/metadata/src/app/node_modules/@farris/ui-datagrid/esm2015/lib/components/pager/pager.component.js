/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { DatagridComponent } from './../../datagrid.component';
import { NotifyService } from '@farris/ui-notify';
import { ChangeDetectorRef, Injector, Optional, TemplateRef } from '@angular/core';
/*
 * @Author: 疯狂秀才(Lucas Huang)
 * @Date: 2019-08-06 07:43:07
 * @LastEditors: 疯狂秀才(Lucas Huang)
 * @LastEditTime: 2019-10-17 20:20:21
 * @QQ: 1055818239
 * @Version: v0.0.1
 */
import { Component, Input, Output, EventEmitter, ElementRef, ViewChild } from '@angular/core';
import { PaginationControlsComponent } from '@farris/ui-pagination';
import { OverLayHiddenService } from '@farris/ui-common';
export class DatagridPagerComponent {
    /**
     * @param {?} el
     * @param {?} cd
     * @param {?} inject
     */
    constructor(el, cd, inject) {
        this.el = el;
        this.cd = cd;
        this.inject = inject;
        this.pagerPos = 'right';
        this.id = 'farris-datagrid-pager';
        /**
         * 显示页码的数量
         */
        this.maxSize = 7;
        /**
         * 是否显示页码
         */
        this.directionLinks = true;
        this.autoHide = false;
        this.responsive = false;
        /**
         * 上页标签
         */
        this.previousLabel = '上页';
        /**
         * 下页标签
         */
        this.nextLabel = '下页';
        this.showPageList = false;
        this.showPageInfo = true;
        this.showPageNumber = true;
        this.locked = false;
        this.selectedData = [];
        this.viewMode = 'default';
        this.showSelectedList = false;
        this.showGotoInput = false;
        /**
         * 分页条自定义内容区模板
         */
        this.contentTemplate = null;
        this.data = null;
        this.pageChange = new EventEmitter();
        this.pageSizeChange = new EventEmitter();
        this.removeSelectedItem = new EventEmitter();
        this.clearSelectedItem = new EventEmitter();
        this.styles = { opacity: 1 };
        this.mouseInSelectedList = false;
        this.openSelectedList = false;
        this.selectionDataChange$ = null;
        this.overLayService = null;
        if (this.inject) {
            this.notifySer = this.inject.get(NotifyService, null);
        }
        this.overLayService = new OverLayHiddenService();
    }
    /**
     * @return {?}
     */
    get pagination() {
        return this.pager.paginationDirective;
    }
    /**
     * @return {?}
     */
    get pageSize() {
        return this.pagination.getPageSize();
    }
    /**
     * @return {?}
     */
    get total() {
        return this.pagination.getTotalItems();
    }
    /**
     * @return {?}
     */
    get outerHeight() {
        if (this.pc) {
            return this.pc.nativeElement.offsetHeight;
        }
        return 40;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.listenCheckDataChanged();
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        this.lockedStyles();
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (changes.selectedData && !changes.selectedData.isFirstChange()) {
            if (!this.selectedData || !this.selectedData.length) {
                this.closeSelectedList();
            }
        }
        if (changes.showSelectedList && !changes.showSelectedList.isFirstChange()) {
            this.listenCheckDataChanged();
        }
        if (changes.locked && !changes.locked.isFirstChange()) {
            this.lockedStyles();
        }
    }
    /**
     * @private
     * @return {?}
     */
    listenCheckDataChanged() {
        if (this.showSelectedList) {
            /** @type {?} */
            const dg = this.inject.get(DatagridComponent, null);
            if (dg) {
                this.selectionDataChange$ = dg.checkedChange.subscribe((/**
                 * @param {?} data
                 * @return {?}
                 */
                (data) => {
                    this.selectedData = data;
                    if (!this.cd['destroyed']) {
                        this.cd.detectChanges();
                    }
                }));
            }
        }
        else {
            if (this.selectionDataChange$) {
                this.selectionDataChange$.unsubscribe();
                this.selectionDataChange$ = null;
            }
        }
    }
    /**
     * @param {?} pageIndex
     * @return {?}
     */
    onPageChange(pageIndex) {
        if (typeof pageIndex === 'object') {
            pageIndex = pageIndex.pageIndex || 1;
        }
        this.pageChange.emit(Number.parseInt(pageIndex, 10));
    }
    /**
     * @param {?} pageSize
     * @return {?}
     */
    onPageSizeChange(pageSize) {
        this.pageSizeChange.emit(Number.parseInt(pageSize, 10));
    }
    /**
     * @return {?}
     */
    lock() {
        this.locked = true;
        this.lockedStyles();
    }
    /**
     * @return {?}
     */
    unlock() {
        this.locked = false;
        this.lockedStyles();
    }
    /**
     * @private
     * @return {?}
     */
    lockedStyles() {
        this.styles = { opacity: this.locked ? 0.5 : 1 };
        this.cd.detectChanges();
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onMouseEnter($event) {
        $event.stopPropagation();
        if (this.locked) {
            return;
        }
        this.mouseInSelectedList = true;
        if (this.selectedData && this.selectedData.length) {
            this.openSelectedList = !this.openSelectedList;
        }
        else {
            this.openSelectedList = false;
        }
        /** @type {?} */
        let target = $event.target;
        if (!target.classList.contains('selected-list-badge')) {
            target = $event.target.closest('.selected-list-badge');
        }
        if (this.openSelectedList) {
            /** @type {?} */
            const selectedListContainer = this.el.nativeElement.querySelector('.pager-overlay-container');
            /** @type {?} */
            const isInModal = target.closest('.modal-dialog');
            let { top, left } = target.getBoundingClientRect();
            if (selectedListContainer) {
                if (isInModal) {
                    const { top: mtop, left: mleft } = isInModal.getBoundingClientRect();
                    top = top - mtop;
                    left = left - mleft;
                }
                selectedListContainer.style.top = `${top}px`;
                selectedListContainer.style.left = `${left - 10}px`;
            }
            this.overLayService.registerMouseEvent(this.selectItemPanel.nativeElement, (/**
             * @param {?} e
             * @return {?}
             */
            (e) => {
                if (this.selectItemPanel.nativeElement.contains(e.target) || e.target.classList.contains('selected-list-badge') || e.target.closest('.selected-list-badge')) {
                    return;
                }
                this.closeSelectedList();
                this.overLayService.destory(this.selectItemPanel.nativeElement);
            }));
        }
    }
    /**
     * @return {?}
     */
    closeSelectedList() {
        this.openSelectedList = false;
        this.mouseInSelectedList = false;
        if (!this.cd['destroyed']) {
            this.cd.detectChanges();
        }
    }
    /**
     * @param {?} id
     * @return {?}
     */
    onDelSelectedItem(id) {
        this.removeSelectedItem.emit(id);
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onClearSelected($event) {
        this.clearSelectedItem.emit();
        this.closeSelectedList();
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onSelectListPanelClose($event) {
        this.closeSelectedList();
    }
}
DatagridPagerComponent.decorators = [
    { type: Component, args: [{
                selector: 'datagrid-pager',
                template: "<div class=\"f-datagrid-pager\" #pagerContainer [ngStyle]=\"styles\">\r\n    <pagination-controls #pager [id]=\"id\" [maxSize]=\"maxSize\"\r\n        [directionLinks]=\"directionLinks\"\r\n        [showPageList]=\"showPageList\"\r\n        [showPageInfo]=\"showPageInfo\"\r\n        [showPageNumber]=\"showPageNumber\"\r\n        [autoHide]=\"autoHide\" [responsive]=\"responsive\"\r\n        [previousLabel]=\"previousLabel\" [nextLabel]=\"nextLabel\"\r\n        [showGotoInput]=\"showGotoInput\"\r\n        (pageChange)=\"onPageChange($event)\"\r\n        (pageSizeChange)=\"onPageSizeChange($event)\"\r\n        [position]=\"pagerPos\"\r\n        [viewMode]=\"viewMode\" [showSelectedList]=\"showSelectedList\">\r\n\r\n        <div class=\"pager-overlay-container\" style=\"position:fixed;z-index: 999999;\" #selectItemPanel>\r\n            <pager-selected-list *ngIf=\"openSelectedList\"\r\n                [data]=\"selectedData | selectedItem: listItemFormatter\"\r\n                (close)=\"onSelectListPanelClose($event)\"\r\n                (remove)=\"onDelSelectedItem($event)\"\r\n                (clear)=\"onClearSelected($event)\"\r\n            ></pager-selected-list>\r\n        </div>\r\n\r\n        <div class=\"flex-fill pager-pos-right\" style=\"left: 0\" [style.position]=\"pagerPos==='center'? 'absolute':'relative'\">\r\n            <div class=\"d-flex flex-row\" style=\"align-items: center;\">\r\n                <span class=\"badge badge-pill badge-light mr-2 selected-list-badge\" *ngIf=\"showSelectedList\"\r\n                    style=\"cursor:pointer\" [attr.title]=\"'datagrid.selectionData.tooltip' | locale\"\r\n                    [class.badge-primary]=\"mouseInSelectedList\"\r\n                    [innerHTML]=\"'datagrid.selectionData.currentLenth' | locale | replaceX: selectedData.length\"\r\n                    (click)=\"onMouseEnter($event)\">\r\n                </span>\r\n\r\n                <div class=\"f-utils-fill mr-2 content-template\" *ngIf=\"contentTemplate && pagerPos === 'right'\">\r\n                    <ng-container [ngTemplateOutlet]=\"contentTemplate\" [ngTemplateOutletContext]=\"{ footerData: data }\"></ng-container>\r\n                </div>\r\n\r\n            </div>\r\n        </div>\r\n\r\n        <div class=\"flex-fill pager-pos-left\" *ngIf=\"pagerPos === 'left'\">\r\n            <div class=\"d-flex flex-row\" style=\"align-items: center;\">\r\n                \r\n                <div class=\"f-utils-fill mr-2 content-template\" *ngIf=\"contentTemplate\">\r\n                    <ng-container [ngTemplateOutlet]=\"contentTemplate\" [ngTemplateOutletContext]=\"{ footerData: data }\"></ng-container>\r\n                </div>\r\n\r\n            </div>\r\n        </div>\r\n\r\n    </pagination-controls>\r\n</div>"
            }] }
];
/** @nocollapse */
DatagridPagerComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: ChangeDetectorRef },
    { type: Injector, decorators: [{ type: Optional }] }
];
DatagridPagerComponent.propDecorators = {
    pagerPos: [{ type: Input }],
    id: [{ type: Input }],
    maxSize: [{ type: Input }],
    directionLinks: [{ type: Input }],
    autoHide: [{ type: Input }],
    responsive: [{ type: Input }],
    previousLabel: [{ type: Input }],
    nextLabel: [{ type: Input }],
    showPageList: [{ type: Input }],
    showPageInfo: [{ type: Input }],
    showPageNumber: [{ type: Input }],
    locked: [{ type: Input }],
    selectedData: [{ type: Input }],
    viewMode: [{ type: Input }],
    listItemFormatter: [{ type: Input }],
    showSelectedList: [{ type: Input }],
    showGotoInput: [{ type: Input }],
    contentTemplate: [{ type: Input }],
    data: [{ type: Input }],
    pageChange: [{ type: Output }],
    pageSizeChange: [{ type: Output }],
    removeSelectedItem: [{ type: Output }],
    clearSelectedItem: [{ type: Output }],
    pc: [{ type: ViewChild, args: ['pagerContainer',] }],
    pager: [{ type: ViewChild, args: ['pager',] }],
    selectItemPanel: [{ type: ViewChild, args: ['selectItemPanel',] }]
};
if (false) {
    /** @type {?} */
    DatagridPagerComponent.prototype.pagerPos;
    /** @type {?} */
    DatagridPagerComponent.prototype.id;
    /**
     * 显示页码的数量
     * @type {?}
     */
    DatagridPagerComponent.prototype.maxSize;
    /**
     * 是否显示页码
     * @type {?}
     */
    DatagridPagerComponent.prototype.directionLinks;
    /** @type {?} */
    DatagridPagerComponent.prototype.autoHide;
    /** @type {?} */
    DatagridPagerComponent.prototype.responsive;
    /**
     * 上页标签
     * @type {?}
     */
    DatagridPagerComponent.prototype.previousLabel;
    /**
     * 下页标签
     * @type {?}
     */
    DatagridPagerComponent.prototype.nextLabel;
    /** @type {?} */
    DatagridPagerComponent.prototype.showPageList;
    /** @type {?} */
    DatagridPagerComponent.prototype.showPageInfo;
    /** @type {?} */
    DatagridPagerComponent.prototype.showPageNumber;
    /** @type {?} */
    DatagridPagerComponent.prototype.locked;
    /** @type {?} */
    DatagridPagerComponent.prototype.selectedData;
    /** @type {?} */
    DatagridPagerComponent.prototype.viewMode;
    /** @type {?} */
    DatagridPagerComponent.prototype.listItemFormatter;
    /** @type {?} */
    DatagridPagerComponent.prototype.showSelectedList;
    /** @type {?} */
    DatagridPagerComponent.prototype.showGotoInput;
    /**
     * 分页条自定义内容区模板
     * @type {?}
     */
    DatagridPagerComponent.prototype.contentTemplate;
    /** @type {?} */
    DatagridPagerComponent.prototype.data;
    /** @type {?} */
    DatagridPagerComponent.prototype.pageChange;
    /** @type {?} */
    DatagridPagerComponent.prototype.pageSizeChange;
    /** @type {?} */
    DatagridPagerComponent.prototype.removeSelectedItem;
    /** @type {?} */
    DatagridPagerComponent.prototype.clearSelectedItem;
    /** @type {?} */
    DatagridPagerComponent.prototype.pc;
    /** @type {?} */
    DatagridPagerComponent.prototype.pager;
    /** @type {?} */
    DatagridPagerComponent.prototype.selectItemPanel;
    /** @type {?} */
    DatagridPagerComponent.prototype.styles;
    /** @type {?} */
    DatagridPagerComponent.prototype.mouseInSelectedList;
    /** @type {?} */
    DatagridPagerComponent.prototype.openSelectedList;
    /**
     * @type {?}
     * @private
     */
    DatagridPagerComponent.prototype.selectionDataChange$;
    /**
     * @type {?}
     * @private
     */
    DatagridPagerComponent.prototype.notifySer;
    /**
     * @type {?}
     * @private
     */
    DatagridPagerComponent.prototype.overLayService;
    /** @type {?} */
    DatagridPagerComponent.prototype.el;
    /**
     * @type {?}
     * @private
     */
    DatagridPagerComponent.prototype.cd;
    /**
     * @type {?}
     * @private
     */
    DatagridPagerComponent.prototype.inject;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFnZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1kYXRhZ3JpZC8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL3BhZ2VyL3BhZ2VyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQ0EsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDL0QsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUE0QixXQUFXLEVBQUUsTUFBTSxlQUFlLENBQUM7Ozs7Ozs7OztBQVM3RyxPQUFPLEVBQUUsU0FBUyxFQUFVLEtBQUssRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUFFLFVBQVUsRUFBaUIsU0FBUyxFQUFlLE1BQU0sZUFBZSxDQUFDO0FBQ2xJLE9BQU8sRUFBRSwyQkFBMkIsRUFBK0IsTUFBTSx1QkFBdUIsQ0FBQztBQUNqRyxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQU16RCxNQUFNLE9BQU8sc0JBQXNCOzs7Ozs7SUFzRS9CLFlBQW1CLEVBQWMsRUFBVSxFQUFxQixFQUFzQixNQUFnQjtRQUFuRixPQUFFLEdBQUYsRUFBRSxDQUFZO1FBQVUsT0FBRSxHQUFGLEVBQUUsQ0FBbUI7UUFBc0IsV0FBTSxHQUFOLE1BQU0sQ0FBVTtRQXJFN0YsYUFBUSxHQUFHLE9BQU8sQ0FBQztRQUNuQixPQUFFLEdBQUcsdUJBQXVCLENBQUM7Ozs7UUFFN0IsWUFBTyxHQUFHLENBQUMsQ0FBQzs7OztRQUVaLG1CQUFjLEdBQUcsSUFBSSxDQUFDO1FBRXRCLGFBQVEsR0FBRyxLQUFLLENBQUM7UUFFakIsZUFBVSxHQUFHLEtBQUssQ0FBQzs7OztRQUVuQixrQkFBYSxHQUFHLElBQUksQ0FBQzs7OztRQUVyQixjQUFTLEdBQUcsSUFBSSxDQUFDO1FBQ2pCLGlCQUFZLEdBQUcsS0FBSyxDQUFDO1FBQ3JCLGlCQUFZLEdBQUcsSUFBSSxDQUFDO1FBQ3BCLG1CQUFjLEdBQUcsSUFBSSxDQUFDO1FBQ3RCLFdBQU0sR0FBRyxLQUFLLENBQUM7UUFFZixpQkFBWSxHQUFHLEVBQUUsQ0FBQztRQUNsQixhQUFRLEdBQXlCLFNBQVMsQ0FBQztRQUczQyxxQkFBZ0IsR0FBRyxLQUFLLENBQUM7UUFFekIsa0JBQWEsR0FBRyxLQUFLLENBQUM7Ozs7UUFHdEIsb0JBQWUsR0FBcUIsSUFBSSxDQUFDO1FBQ3pDLFNBQUksR0FBRyxJQUFJLENBQUM7UUFFWCxlQUFVLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUNoQyxtQkFBYyxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFFcEMsdUJBQWtCLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUN4QyxzQkFBaUIsR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBeUJqRCxXQUFNLEdBQUcsRUFBRSxPQUFPLEVBQUUsQ0FBQyxFQUFFLENBQUM7UUFFeEIsd0JBQW1CLEdBQUcsS0FBSyxDQUFDO1FBQzVCLHFCQUFnQixHQUFHLEtBQUssQ0FBQztRQUVqQix5QkFBb0IsR0FBaUIsSUFBSSxDQUFDO1FBRzFDLG1CQUFjLEdBQXlCLElBQUksQ0FBQztRQUVoRCxJQUFJLElBQUksQ0FBQyxNQUFNLEVBQUU7WUFDYixJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFnQixhQUFhLEVBQUUsSUFBSSxDQUFDLENBQUM7U0FDeEU7UUFFRCxJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksb0JBQW9CLEVBQUUsQ0FBQztJQUNyRCxDQUFDOzs7O0lBbENELElBQUksVUFBVTtRQUNWLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxtQkFBbUIsQ0FBQztJQUMxQyxDQUFDOzs7O0lBR0QsSUFBSSxRQUFRO1FBQ1IsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLFdBQVcsRUFBRSxDQUFDO0lBQ3pDLENBQUM7Ozs7SUFFRCxJQUFJLEtBQUs7UUFDTCxPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxFQUFFLENBQUM7SUFDM0MsQ0FBQzs7OztJQUVELElBQUksV0FBVztRQUNYLElBQUksSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNULE9BQU8sSUFBSSxDQUFDLEVBQUUsQ0FBQyxhQUFhLENBQUMsWUFBWSxDQUFDO1NBQzdDO1FBQ0QsT0FBTyxFQUFFLENBQUM7SUFDZCxDQUFDOzs7O0lBa0JELFFBQVE7UUFDSixJQUFJLENBQUMsc0JBQXNCLEVBQUUsQ0FBQztJQUNsQyxDQUFDOzs7O0lBRUQsZUFBZTtRQUNYLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztJQUN4QixDQUFDOzs7OztJQUVELFdBQVcsQ0FBQyxPQUFzQjtRQUM5QixJQUFJLE9BQU8sQ0FBQyxZQUFZLElBQUksQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLGFBQWEsRUFBRSxFQUFFO1lBQy9ELElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxJQUFJLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxNQUFNLEVBQUU7Z0JBQ2pELElBQUksQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO2FBQzVCO1NBQ0o7UUFFRCxJQUFJLE9BQU8sQ0FBQyxnQkFBZ0IsSUFBSSxDQUFDLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxhQUFhLEVBQUUsRUFBRTtZQUN2RSxJQUFJLENBQUMsc0JBQXNCLEVBQUUsQ0FBQztTQUNqQztRQUVELElBQUksT0FBTyxDQUFDLE1BQU0sSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsYUFBYSxFQUFFLEVBQUU7WUFDbkQsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO1NBQ3ZCO0lBQ0wsQ0FBQzs7Ozs7SUFFTyxzQkFBc0I7UUFDMUIsSUFBSSxJQUFJLENBQUMsZ0JBQWdCLEVBQUU7O2tCQUNqQixFQUFFLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsaUJBQWlCLEVBQUUsSUFBSSxDQUFDO1lBQ25ELElBQUksRUFBRSxFQUFFO2dCQUNKLElBQUksQ0FBQyxvQkFBb0IsR0FBRyxFQUFFLENBQUMsYUFBYSxDQUFDLFNBQVM7Ozs7Z0JBQUMsQ0FBQyxJQUFTLEVBQUUsRUFBRTtvQkFDakUsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUM7b0JBQ3pCLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLFdBQVcsQ0FBQyxFQUFFO3dCQUN2QixJQUFJLENBQUMsRUFBRSxDQUFDLGFBQWEsRUFBRSxDQUFDO3FCQUMzQjtnQkFDTCxDQUFDLEVBQUMsQ0FBQzthQUNOO1NBQ0o7YUFBTTtZQUNILElBQUksSUFBSSxDQUFDLG9CQUFvQixFQUFFO2dCQUMzQixJQUFJLENBQUMsb0JBQW9CLENBQUMsV0FBVyxFQUFFLENBQUM7Z0JBQ3hDLElBQUksQ0FBQyxvQkFBb0IsR0FBRyxJQUFJLENBQUM7YUFDcEM7U0FDSjtJQUNMLENBQUM7Ozs7O0lBRUQsWUFBWSxDQUFDLFNBQWM7UUFDdkIsSUFBSSxPQUFPLFNBQVMsS0FBSyxRQUFRLEVBQUU7WUFDL0IsU0FBUyxHQUFHLFNBQVMsQ0FBQyxTQUFTLElBQUksQ0FBQyxDQUFDO1NBQ3hDO1FBQ0QsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxTQUFTLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQztJQUN6RCxDQUFDOzs7OztJQUVELGdCQUFnQixDQUFDLFFBQWE7UUFDMUIsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxRQUFRLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQztJQUM1RCxDQUFDOzs7O0lBRUQsSUFBSTtRQUNBLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDO1FBQ25CLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztJQUN4QixDQUFDOzs7O0lBQ0QsTUFBTTtRQUNGLElBQUksQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFDO1FBQ3BCLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztJQUN4QixDQUFDOzs7OztJQUVPLFlBQVk7UUFDaEIsSUFBSSxDQUFDLE1BQU0sR0FBRyxFQUFFLE9BQU8sRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFBLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO1FBQ2hELElBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxFQUFFLENBQUM7SUFDNUIsQ0FBQzs7Ozs7SUFFRCxZQUFZLENBQUMsTUFBTTtRQUNmLE1BQU0sQ0FBQyxlQUFlLEVBQUUsQ0FBQztRQUV6QixJQUFJLElBQUksQ0FBQyxNQUFNLEVBQUU7WUFDYixPQUFPO1NBQ1Y7UUFDRCxJQUFJLENBQUMsbUJBQW1CLEdBQUcsSUFBSSxDQUFDO1FBQ2hDLElBQUksSUFBSSxDQUFDLFlBQVksSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDLE1BQU0sRUFBRTtZQUMvQyxJQUFJLENBQUMsZ0JBQWdCLEdBQUcsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUM7U0FDbEQ7YUFBTTtZQUNILElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxLQUFLLENBQUM7U0FDakM7O1lBRUcsTUFBTSxHQUFHLE1BQU0sQ0FBQyxNQUFNO1FBQzFCLElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxxQkFBcUIsQ0FBQyxFQUFFO1lBQ25ELE1BQU0sR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO1NBQzFEO1FBR0QsSUFBSSxJQUFJLENBQUMsZ0JBQWdCLEVBQUU7O2tCQUVqQixxQkFBcUIsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLGFBQWEsQ0FBQyxhQUFhLENBQUMsMEJBQTBCLENBQUM7O2tCQUN2RixTQUFTLEdBQUcsTUFBTSxDQUFDLE9BQU8sQ0FBQyxlQUFlLENBQUM7Z0JBRTdDLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxHQUFHLE1BQU0sQ0FBQyxxQkFBcUIsRUFBRTtZQUNsRCxJQUFJLHFCQUFxQixFQUFFO2dCQUN2QixJQUFJLFNBQVMsRUFBRTswQkFDTCxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxHQUFHLFNBQVMsQ0FBQyxxQkFBcUIsRUFBRTtvQkFDcEUsR0FBRyxHQUFHLEdBQUcsR0FBRyxJQUFJLENBQUM7b0JBQ2pCLElBQUksR0FBRyxJQUFJLEdBQUcsS0FBSyxDQUFDO2lCQUN2QjtnQkFFRCxxQkFBcUIsQ0FBQyxLQUFLLENBQUMsR0FBRyxHQUFHLEdBQUcsR0FBRyxJQUFJLENBQUM7Z0JBQzdDLHFCQUFxQixDQUFDLEtBQUssQ0FBQyxJQUFJLEdBQUcsR0FBRyxJQUFJLEdBQUcsRUFBRSxJQUFJLENBQUM7YUFDdkQ7WUFFRCxJQUFJLENBQUMsY0FBYyxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsYUFBYTs7OztZQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUU7Z0JBQzdFLElBQUksSUFBSSxDQUFDLGVBQWUsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMscUJBQXFCLENBQUMsSUFBSSxDQUFDLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxzQkFBc0IsQ0FBQyxFQUFFO29CQUN6SixPQUFPO2lCQUNWO2dCQUVELElBQUksQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO2dCQUN6QixJQUFJLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1lBQ3BFLENBQUMsRUFBQyxDQUFDO1NBQ047SUFDTCxDQUFDOzs7O0lBR0QsaUJBQWlCO1FBQ2IsSUFBSSxDQUFDLGdCQUFnQixHQUFHLEtBQUssQ0FBQztRQUM5QixJQUFJLENBQUMsbUJBQW1CLEdBQUcsS0FBSyxDQUFDO1FBQ2pDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLFdBQVcsQ0FBQyxFQUFFO1lBQ3ZCLElBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxFQUFFLENBQUM7U0FDM0I7SUFDTCxDQUFDOzs7OztJQUVELGlCQUFpQixDQUFDLEVBQU87UUFDckIsSUFBSSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUNyQyxDQUFDOzs7OztJQUVELGVBQWUsQ0FBQyxNQUFNO1FBQ2xCLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUM5QixJQUFJLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztJQUM3QixDQUFDOzs7OztJQUVELHNCQUFzQixDQUFDLE1BQU07UUFDekIsSUFBSSxDQUFDLGlCQUFpQixFQUFFLENBQUM7SUFDN0IsQ0FBQzs7O1lBek5KLFNBQVMsU0FBQztnQkFDUCxRQUFRLEVBQUUsZ0JBQWdCO2dCQUMxQiw2dUZBQW9DO2FBQ3ZDOzs7O1lBUHdELFVBQVU7WUFUMUQsaUJBQWlCO1lBQUUsUUFBUSx1QkF1Rm1DLFFBQVE7Ozt1QkFyRTFFLEtBQUs7aUJBQ0wsS0FBSztzQkFFTCxLQUFLOzZCQUVMLEtBQUs7dUJBRUwsS0FBSzt5QkFFTCxLQUFLOzRCQUVMLEtBQUs7d0JBRUwsS0FBSzsyQkFDTCxLQUFLOzJCQUNMLEtBQUs7NkJBQ0wsS0FBSztxQkFDTCxLQUFLOzJCQUVMLEtBQUs7dUJBQ0wsS0FBSztnQ0FDTCxLQUFLOytCQUVMLEtBQUs7NEJBRUwsS0FBSzs4QkFHTCxLQUFLO21CQUNMLEtBQUs7eUJBRUwsTUFBTTs2QkFDTixNQUFNO2lDQUVOLE1BQU07Z0NBQ04sTUFBTTtpQkFFTixTQUFTLFNBQUMsZ0JBQWdCO29CQUMxQixTQUFTLFNBQUMsT0FBTzs4QkFDakIsU0FBUyxTQUFDLGlCQUFpQjs7OztJQXZDNUIsMENBQTRCOztJQUM1QixvQ0FBc0M7Ozs7O0lBRXRDLHlDQUFxQjs7Ozs7SUFFckIsZ0RBQStCOztJQUUvQiwwQ0FBMEI7O0lBRTFCLDRDQUE0Qjs7Ozs7SUFFNUIsK0NBQThCOzs7OztJQUU5QiwyQ0FBMEI7O0lBQzFCLDhDQUE4Qjs7SUFDOUIsOENBQTZCOztJQUM3QixnREFBK0I7O0lBQy9CLHdDQUF3Qjs7SUFFeEIsOENBQTJCOztJQUMzQiwwQ0FBb0Q7O0lBQ3BELG1EQUE2Qzs7SUFFN0Msa0RBQWtDOztJQUVsQywrQ0FBK0I7Ozs7O0lBRy9CLGlEQUFrRDs7SUFDbEQsc0NBQXFCOztJQUVyQiw0Q0FBMEM7O0lBQzFDLGdEQUE4Qzs7SUFFOUMsb0RBQWtEOztJQUNsRCxtREFBaUQ7O0lBRWpELG9DQUE0Qzs7SUFDNUMsdUNBQXVEOztJQUN2RCxpREFBMEQ7O0lBcUIxRCx3Q0FBd0I7O0lBRXhCLHFEQUE0Qjs7SUFDNUIsa0RBQXlCOzs7OztJQUV6QixzREFBa0Q7Ozs7O0lBRWxELDJDQUFpQzs7Ozs7SUFDakMsZ0RBQW9EOztJQUN4QyxvQ0FBcUI7Ozs7O0lBQUUsb0NBQTZCOzs7OztJQUFFLHdDQUFvQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZENvbXBvbmVudCB9IGZyb20gJy4vLi4vLi4vZGF0YWdyaWQuY29tcG9uZW50JztcclxuaW1wb3J0IHsgTm90aWZ5U2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbm90aWZ5JztcclxuaW1wb3J0IHsgQ2hhbmdlRGV0ZWN0b3JSZWYsIEluamVjdG9yLCBPcHRpb25hbCwgT25DaGFuZ2VzLCBTaW1wbGVDaGFuZ2VzLCBUZW1wbGF0ZVJlZiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG4vKlxyXG4gKiBAQXV0aG9yOiDnlq/ni4Lnp4DmiY0oTHVjYXMgSHVhbmcpXHJcbiAqIEBEYXRlOiAyMDE5LTA4LTA2IDA3OjQzOjA3XHJcbiAqIEBMYXN0RWRpdG9yczog55av54uC56eA5omNKEx1Y2FzIEh1YW5nKVxyXG4gKiBATGFzdEVkaXRUaW1lOiAyMDE5LTEwLTE3IDIwOjIwOjIxXHJcbiAqIEBRUTogMTA1NTgxODIzOVxyXG4gKiBAVmVyc2lvbjogdjAuMC4xXHJcbiAqL1xyXG5pbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgSW5wdXQsIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBFbGVtZW50UmVmLCBBZnRlclZpZXdJbml0LCBWaWV3Q2hpbGQsIEhvc3RCaW5kaW5nIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFBhZ2luYXRpb25Db250cm9sc0NvbXBvbmVudCwgUGFnaW5hdGlvbkNvbnRyb2xzRGlyZWN0aXZlIH0gZnJvbSAnQGZhcnJpcy91aS1wYWdpbmF0aW9uJztcclxuaW1wb3J0IHsgT3ZlckxheUhpZGRlblNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWNvbW1vbic7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAnZGF0YWdyaWQtcGFnZXInLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcuL3BhZ2UuY29tcG9uZW50Lmh0bWwnXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBEYXRhZ3JpZFBhZ2VyQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0LCBPbkNoYW5nZXMge1xyXG4gICAgQElucHV0KCkgcGFnZXJQb3MgPSAncmlnaHQnO1xyXG4gICAgQElucHV0KCkgaWQgPSAnZmFycmlzLWRhdGFncmlkLXBhZ2VyJztcclxuICAgIC8qKiDmmL7npLrpobXnoIHnmoTmlbDph48gKi9cclxuICAgIEBJbnB1dCgpIG1heFNpemUgPSA3O1xyXG4gICAgLyoqIOaYr+WQpuaYvuekuumhteeggSAqL1xyXG4gICAgQElucHV0KCkgZGlyZWN0aW9uTGlua3MgPSB0cnVlO1xyXG5cclxuICAgIEBJbnB1dCgpIGF1dG9IaWRlID0gZmFsc2U7XHJcblxyXG4gICAgQElucHV0KCkgcmVzcG9uc2l2ZSA9IGZhbHNlO1xyXG4gICAgLyoqIOS4iumhteagh+etviAqL1xyXG4gICAgQElucHV0KCkgcHJldmlvdXNMYWJlbCA9ICfkuIrpobUnO1xyXG4gICAgLyoqIOS4i+mhteagh+etviAqL1xyXG4gICAgQElucHV0KCkgbmV4dExhYmVsID0gJ+S4i+mhtSc7XHJcbiAgICBASW5wdXQoKSBzaG93UGFnZUxpc3QgPSBmYWxzZTtcclxuICAgIEBJbnB1dCgpIHNob3dQYWdlSW5mbyA9IHRydWU7XHJcbiAgICBASW5wdXQoKSBzaG93UGFnZU51bWJlciA9IHRydWU7XHJcbiAgICBASW5wdXQoKSBsb2NrZWQgPSBmYWxzZTtcclxuXHJcbiAgICBASW5wdXQoKSBzZWxlY3RlZERhdGEgPSBbXTtcclxuICAgIEBJbnB1dCgpIHZpZXdNb2RlOiAnZGVmYXVsdCcgfCAnc2ltcGxlJyA9ICdkZWZhdWx0JztcclxuICAgIEBJbnB1dCgpIGxpc3RJdGVtRm9ybWF0dGVyOiAoZGF0YSkgPT4gc3RyaW5nO1xyXG5cclxuICAgIEBJbnB1dCgpIHNob3dTZWxlY3RlZExpc3QgPSBmYWxzZTtcclxuXHJcbiAgICBASW5wdXQoKSBzaG93R290b0lucHV0ID0gZmFsc2U7XHJcblxyXG4gICAgLyoqIOWIhumhteadoeiHquWumuS5ieWGheWuueWMuuaooeadvyAqL1xyXG4gICAgQElucHV0KCkgY29udGVudFRlbXBsYXRlOiBUZW1wbGF0ZVJlZjxhbnk+ID0gbnVsbDtcclxuICAgIEBJbnB1dCgpIGRhdGEgPSBudWxsO1xyXG5cclxuICAgIEBPdXRwdXQoKSBwYWdlQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gICAgQE91dHB1dCgpIHBhZ2VTaXplQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG5cclxuICAgIEBPdXRwdXQoKSByZW1vdmVTZWxlY3RlZEl0ZW0gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgICBAT3V0cHV0KCkgY2xlYXJTZWxlY3RlZEl0ZW0gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcblxyXG4gICAgQFZpZXdDaGlsZCgncGFnZXJDb250YWluZXInKSBwYzogRWxlbWVudFJlZjtcclxuICAgIEBWaWV3Q2hpbGQoJ3BhZ2VyJykgcGFnZXI6IFBhZ2luYXRpb25Db250cm9sc0NvbXBvbmVudDtcclxuICAgIEBWaWV3Q2hpbGQoJ3NlbGVjdEl0ZW1QYW5lbCcpIHNlbGVjdEl0ZW1QYW5lbDogRWxlbWVudFJlZjtcclxuXHJcbiAgICBnZXQgcGFnaW5hdGlvbigpOiBQYWdpbmF0aW9uQ29udHJvbHNEaXJlY3RpdmUge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnBhZ2VyLnBhZ2luYXRpb25EaXJlY3RpdmU7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGdldCBwYWdlU2l6ZSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5wYWdpbmF0aW9uLmdldFBhZ2VTaXplKCk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHRvdGFsKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnBhZ2luYXRpb24uZ2V0VG90YWxJdGVtcygpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBvdXRlckhlaWdodCgpIHtcclxuICAgICAgICBpZiAodGhpcy5wYykge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5wYy5uYXRpdmVFbGVtZW50Lm9mZnNldEhlaWdodDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIDQwO1xyXG4gICAgfVxyXG4gICAgc3R5bGVzID0geyBvcGFjaXR5OiAxIH07XHJcblxyXG4gICAgbW91c2VJblNlbGVjdGVkTGlzdCA9IGZhbHNlO1xyXG4gICAgb3BlblNlbGVjdGVkTGlzdCA9IGZhbHNlO1xyXG5cclxuICAgIHByaXZhdGUgc2VsZWN0aW9uRGF0YUNoYW5nZSQ6IFN1YnNjcmlwdGlvbiA9IG51bGw7XHJcblxyXG4gICAgcHJpdmF0ZSBub3RpZnlTZXI6IE5vdGlmeVNlcnZpY2U7XHJcbiAgICBwcml2YXRlIG92ZXJMYXlTZXJ2aWNlOiBPdmVyTGF5SGlkZGVuU2VydmljZSA9IG51bGw7XHJcbiAgICBjb25zdHJ1Y3RvcihwdWJsaWMgZWw6IEVsZW1lbnRSZWYsIHByaXZhdGUgY2Q6IENoYW5nZURldGVjdG9yUmVmLCBAT3B0aW9uYWwoKSBwcml2YXRlIGluamVjdDogSW5qZWN0b3IpIHtcclxuICAgICAgICBpZiAodGhpcy5pbmplY3QpIHtcclxuICAgICAgICAgICAgdGhpcy5ub3RpZnlTZXIgPSB0aGlzLmluamVjdC5nZXQ8Tm90aWZ5U2VydmljZT4oTm90aWZ5U2VydmljZSwgbnVsbCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLm92ZXJMYXlTZXJ2aWNlID0gbmV3IE92ZXJMYXlIaWRkZW5TZXJ2aWNlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5saXN0ZW5DaGVja0RhdGFDaGFuZ2VkKCk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdBZnRlclZpZXdJbml0KCkge1xyXG4gICAgICAgIHRoaXMubG9ja2VkU3R5bGVzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xyXG4gICAgICAgIGlmIChjaGFuZ2VzLnNlbGVjdGVkRGF0YSAmJiAhY2hhbmdlcy5zZWxlY3RlZERhdGEuaXNGaXJzdENoYW5nZSgpKSB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5zZWxlY3RlZERhdGEgfHwgIXRoaXMuc2VsZWN0ZWREYXRhLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZVNlbGVjdGVkTGlzdCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoY2hhbmdlcy5zaG93U2VsZWN0ZWRMaXN0ICYmICFjaGFuZ2VzLnNob3dTZWxlY3RlZExpc3QuaXNGaXJzdENoYW5nZSgpKSB7XHJcbiAgICAgICAgICAgIHRoaXMubGlzdGVuQ2hlY2tEYXRhQ2hhbmdlZCgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGNoYW5nZXMubG9ja2VkICYmICFjaGFuZ2VzLmxvY2tlZC5pc0ZpcnN0Q2hhbmdlKCkpIHtcclxuICAgICAgICAgICAgdGhpcy5sb2NrZWRTdHlsZXMoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBsaXN0ZW5DaGVja0RhdGFDaGFuZ2VkKCkge1xyXG4gICAgICAgIGlmICh0aGlzLnNob3dTZWxlY3RlZExpc3QpIHtcclxuICAgICAgICAgICAgY29uc3QgZGcgPSB0aGlzLmluamVjdC5nZXQoRGF0YWdyaWRDb21wb25lbnQsIG51bGwpO1xyXG4gICAgICAgICAgICBpZiAoZGcpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0aW9uRGF0YUNoYW5nZSQgPSBkZy5jaGVja2VkQ2hhbmdlLnN1YnNjcmliZSgoZGF0YTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZERhdGEgPSBkYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5jZFsnZGVzdHJveWVkJ10pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5zZWxlY3Rpb25EYXRhQ2hhbmdlJCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb25EYXRhQ2hhbmdlJC51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb25EYXRhQ2hhbmdlJCA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgb25QYWdlQ2hhbmdlKHBhZ2VJbmRleDogYW55KSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBwYWdlSW5kZXggPT09ICdvYmplY3QnKSB7XHJcbiAgICAgICAgICAgIHBhZ2VJbmRleCA9IHBhZ2VJbmRleC5wYWdlSW5kZXggfHwgMTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5wYWdlQ2hhbmdlLmVtaXQoTnVtYmVyLnBhcnNlSW50KHBhZ2VJbmRleCwgMTApKTtcclxuICAgIH1cclxuXHJcbiAgICBvblBhZ2VTaXplQ2hhbmdlKHBhZ2VTaXplOiBhbnkpIHtcclxuICAgICAgICB0aGlzLnBhZ2VTaXplQ2hhbmdlLmVtaXQoTnVtYmVyLnBhcnNlSW50KHBhZ2VTaXplLCAxMCkpO1xyXG4gICAgfVxyXG5cclxuICAgIGxvY2soKSB7XHJcbiAgICAgICAgdGhpcy5sb2NrZWQgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMubG9ja2VkU3R5bGVzKCk7XHJcbiAgICB9XHJcbiAgICB1bmxvY2soKSB7XHJcbiAgICAgICAgdGhpcy5sb2NrZWQgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmxvY2tlZFN0eWxlcygpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgbG9ja2VkU3R5bGVzKCkge1xyXG4gICAgICAgIHRoaXMuc3R5bGVzID0geyBvcGFjaXR5OiB0aGlzLmxvY2tlZD8gMC41IDogMSB9O1xyXG4gICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uTW91c2VFbnRlcigkZXZlbnQpIHtcclxuICAgICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmxvY2tlZCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMubW91c2VJblNlbGVjdGVkTGlzdCA9IHRydWU7XHJcbiAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWREYXRhICYmIHRoaXMuc2VsZWN0ZWREYXRhLmxlbmd0aCkge1xyXG4gICAgICAgICAgICB0aGlzLm9wZW5TZWxlY3RlZExpc3QgPSAhdGhpcy5vcGVuU2VsZWN0ZWRMaXN0O1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMub3BlblNlbGVjdGVkTGlzdCA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IHRhcmdldCA9ICRldmVudC50YXJnZXQ7XHJcbiAgICAgICAgaWYgKCF0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdzZWxlY3RlZC1saXN0LWJhZGdlJykpIHtcclxuICAgICAgICAgICAgdGFyZ2V0ID0gJGV2ZW50LnRhcmdldC5jbG9zZXN0KCcuc2VsZWN0ZWQtbGlzdC1iYWRnZScpO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGlmICh0aGlzLm9wZW5TZWxlY3RlZExpc3QpIHtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkTGlzdENvbnRhaW5lciA9IHRoaXMuZWwubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcucGFnZXItb3ZlcmxheS1jb250YWluZXInKTtcclxuICAgICAgICAgICAgY29uc3QgaXNJbk1vZGFsID0gdGFyZ2V0LmNsb3Nlc3QoJy5tb2RhbC1kaWFsb2cnKTtcclxuXHJcbiAgICAgICAgICAgIGxldCB7IHRvcCwgbGVmdCB9ID0gdGFyZ2V0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gICAgICAgICAgICBpZiAoc2VsZWN0ZWRMaXN0Q29udGFpbmVyKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXNJbk1vZGFsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgeyB0b3A6IG10b3AsIGxlZnQ6IG1sZWZ0IH0gPSBpc0luTW9kYWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdG9wID0gdG9wIC0gbXRvcDtcclxuICAgICAgICAgICAgICAgICAgICBsZWZ0ID0gbGVmdCAtIG1sZWZ0O1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHNlbGVjdGVkTGlzdENvbnRhaW5lci5zdHlsZS50b3AgPSBgJHt0b3B9cHhgO1xyXG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRMaXN0Q29udGFpbmVyLnN0eWxlLmxlZnQgPSBgJHtsZWZ0IC0gMTB9cHhgO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLm92ZXJMYXlTZXJ2aWNlLnJlZ2lzdGVyTW91c2VFdmVudCh0aGlzLnNlbGVjdEl0ZW1QYW5lbC5uYXRpdmVFbGVtZW50LCAoZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2VsZWN0SXRlbVBhbmVsLm5hdGl2ZUVsZW1lbnQuY29udGFpbnMoZS50YXJnZXQpIHx8IGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnc2VsZWN0ZWQtbGlzdC1iYWRnZScpIHx8IGUudGFyZ2V0LmNsb3Nlc3QoJy5zZWxlY3RlZC1saXN0LWJhZGdlJykpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZVNlbGVjdGVkTGlzdCgpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5vdmVyTGF5U2VydmljZS5kZXN0b3J5KHRoaXMuc2VsZWN0SXRlbVBhbmVsLm5hdGl2ZUVsZW1lbnQpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGNsb3NlU2VsZWN0ZWRMaXN0KCkge1xyXG4gICAgICAgIHRoaXMub3BlblNlbGVjdGVkTGlzdCA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMubW91c2VJblNlbGVjdGVkTGlzdCA9IGZhbHNlO1xyXG4gICAgICAgIGlmICghdGhpcy5jZFsnZGVzdHJveWVkJ10pIHtcclxuICAgICAgICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9uRGVsU2VsZWN0ZWRJdGVtKGlkOiBhbnkpIHtcclxuICAgICAgICB0aGlzLnJlbW92ZVNlbGVjdGVkSXRlbS5lbWl0KGlkKTtcclxuICAgIH1cclxuXHJcbiAgICBvbkNsZWFyU2VsZWN0ZWQoJGV2ZW50KSB7XHJcbiAgICAgICAgdGhpcy5jbGVhclNlbGVjdGVkSXRlbS5lbWl0KCk7XHJcbiAgICAgICAgdGhpcy5jbG9zZVNlbGVjdGVkTGlzdCgpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uU2VsZWN0TGlzdFBhbmVsQ2xvc2UoJGV2ZW50KSB7XHJcbiAgICAgICAgdGhpcy5jbG9zZVNlbGVjdGVkTGlzdCgpO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==