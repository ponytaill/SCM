import { Injectable } from '@angular/core';
import { MetadataUtil } from '../../metadata/index';
import { NG_DECLARATION } from './declaration_decorator';
import { VariableParseService } from '../../variable/index';
import { EventTypeEnum } from './event-type';
var Declaration = /** @class */ (function () {
    function Declaration() {
    }
    /**
     * 初始化
     */
    Declaration.prototype.init = function (frameComponent) {
        if (!frameComponent) {
            return;
        }
        this.bindDeclaration(frameComponent, null);
    };
    /**
     *  依据定义列表进行初始化
     * @param frameComponent 表单component实例
     * @param ngDeclarations 事件定义列表信息
     */
    Declaration.prototype.initWithDeclarations = function (frameComponent, ngDeclarations) {
        if (!frameComponent) {
            return;
        }
        this.bindDeclaration(frameComponent, null);
    };
    /**
     * 基于事件元数据构建事件
     * 调整访问级别 便于解析表单进行初始化动作
     * @param context 框架上下文
     */
    Declaration.prototype.bindDeclaration = function (frameComponent, ngDeclarations) {
        var _this = this;
        var context = frameComponent.context;
        if (!context) {
            return;
        }
        var ngPublicEventProps = ngDeclarations ? ngDeclarations : this.getNgPublicEvent();
        if (!ngPublicEventProps) {
            return;
        }
        Object.keys(ngPublicEventProps).forEach(function (propertyName) {
            var ngExportEvent = ngPublicEventProps[propertyName];
            Object.defineProperty(_this, propertyName, {
                value: function () {
                    // 获取命令处理上下文
                    var targetContext = context;
                    // todo: 给ngExportEvent添加frameId（保证框架之间的事件隔离）
                    // if (ngExportEvent.frameId) {
                    //   targetContext = context.appContext.getFrameContext(ngExportEvent.frameId);
                    // }
                    var root = targetContext.root;
                    var emitter = ngExportEvent.token;
                    var tokenValue = ngExportEvent.token;
                    var eventName = ngExportEvent.name;
                    var eventArgs = JSON.parse(JSON.stringify(ngExportEvent.params));
                    var eventType = ngExportEvent.type;
                    var eventBus = targetContext.eventBus || root.eventBus;
                    if (!eventBus) {
                        return;
                    }
                    var injector = targetContext.injector || root.injector;
                    var variableParseService = injector.get(VariableParseService);
                    // 执行参数解析
                    setTimeout(function () {
                        eventArgs = variableParseService.parse(eventArgs, targetContext);
                        var eventSender = targetContext.frameComponent;
                        var currentContext = targetContext;
                        var eventId = new Date().valueOf();
                        if (eventType && eventType === EventTypeEnum.ROUTE) {
                            // 事件依次向上冒泡
                            while (currentContext) {
                                currentContext.eventBus.post(emitter, tokenValue, eventName, eventArgs, eventSender, eventType, eventId);
                                // currentContext = currentContext.parent;
                                currentContext = _this.getParentContext(currentContext);
                            }
                        }
                        else {
                            eventBus.post(emitter, tokenValue, eventName, eventArgs, eventSender);
                        }
                    }, 0);
                }
            });
        });
    };
    /**
     * 获取事件定义列表
     * @returns  事件定义
     */
    Declaration.prototype.getNgPublicEvent = function () {
        return MetadataUtil.getPropsMetadatasByName(this.constructor, NG_DECLARATION);
    };
    /**
     * 获取父Context
     * @param context 当前上下文
     */
    Declaration.prototype.getParentContext = function (context) {
        // 首先查找直接上级FrameContext
        if (context.parent) {
            return context.parent;
        }
        // 到了AppContext边界，返回上级AppContext的根FrameContext
        var parentAppContext = context.appContext.parent;
        if (parentAppContext) {
            return parentAppContext.frameContextManager.getRootFrameContext();
        }
        return null;
    };
    Declaration.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    Declaration.ctorParameters = function () { return []; };
    return Declaration;
}());
export { Declaration };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVjbGFyYXRpb24uanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2RldmtpdC8iLCJzb3VyY2VzIjpbImxpYi9ldmVudC1tZWNoYW5pc20vZGVjbGFyYXRpb24vZGVjbGFyYXRpb24udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFVBQVUsRUFBWSxNQUFNLGVBQWUsQ0FBQztBQUNyRCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFFcEQsT0FBTyxFQUFFLGNBQWMsRUFBaUIsTUFBTSx5QkFBeUIsQ0FBQztBQUN4RSxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUM1RCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sY0FBYyxDQUFDO0FBRTdDO0lBR0U7SUFFQSxDQUFDO0lBRUQ7O09BRUc7SUFDSSwwQkFBSSxHQUFYLFVBQVksY0FBOEI7UUFDeEMsSUFBSSxDQUFDLGNBQWMsRUFBRTtZQUNuQixPQUFPO1NBQ1I7UUFFRCxJQUFJLENBQUMsZUFBZSxDQUFDLGNBQWMsRUFBRSxJQUFJLENBQUMsQ0FBQztJQUM3QyxDQUFDO0lBRUQ7Ozs7T0FJRztJQUNJLDBDQUFvQixHQUEzQixVQUE0QixjQUE4QixFQUFFLGNBRTNEO1FBQ0MsSUFBSSxDQUFDLGNBQWMsRUFBRTtZQUNuQixPQUFPO1NBQ1I7UUFFRCxJQUFJLENBQUMsZUFBZSxDQUFDLGNBQWMsRUFBRSxJQUFJLENBQUMsQ0FBQztJQUM3QyxDQUFDO0lBRUQ7Ozs7T0FJRztJQUNJLHFDQUFlLEdBQXRCLFVBQXVCLGNBQThCLEVBQUUsY0FFdEQ7UUFGRCxpQkF5REM7UUF0REMsSUFBTSxPQUFPLEdBQUcsY0FBYyxDQUFDLE9BQU8sQ0FBQztRQUN2QyxJQUFJLENBQUMsT0FBTyxFQUFFO1lBQ1osT0FBTztTQUNSO1FBRUQsSUFBTSxrQkFBa0IsR0FBRyxjQUFjLENBQUMsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsSUFB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SUFBTSxnQkFBZ0IsR0FBRyxPQUFPLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQztRQUNuRCxJQUFJLGdCQUFnQixFQUFFO1lBQ3BCLE9BQU8sZ0JBQWdCLENBQUMsbUJBQW1CLENBQUMsbUJBQW1CLEVBQUUsQ0FBQztTQUNuRTtRQUVELE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQzs7Z0JBM0hGLFVBQVU7Ozs7SUE0SFgsa0JBQUM7Q0FBQSxBQTVIRCxJQTRIQztBQUVELE9BQU8sRUFBRSxXQUFXLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIEluamVjdG9yIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IE1ldGFkYXRhVXRpbCB9IGZyb20gJy4uLy4uL21ldGFkYXRhL2luZGV4JztcclxuaW1wb3J0IHsgRnJhbWVDb250ZXh0LCBGcmFtZUNvbXBvbmVudCB9IGZyb20gJy4uLy4uL2ZyYW1lJztcclxuaW1wb3J0IHsgTkdfREVDTEFSQVRJT04sIE5nRGVjbGFyYXRpb24gfSBmcm9tICcuL2RlY2xhcmF0aW9uX2RlY29yYXRvcic7XHJcbmltcG9ydCB7IFZhcmlhYmxlUGFyc2VTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vdmFyaWFibGUvaW5kZXgnO1xyXG5pbXBvcnQgeyBFdmVudFR5cGVFbnVtIH0gZnJvbSAnLi9ldmVudC10eXBlJztcclxuXHJcbkBJbmplY3RhYmxlKClcclxuY2xhc3MgRGVjbGFyYXRpb24ge1xyXG5cclxuICBjb25zdHJ1Y3RvcigpIHtcclxuXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDliJ3lp4vljJZcclxuICAgKi9cclxuICBwdWJsaWMgaW5pdChmcmFtZUNvbXBvbmVudDogRnJhbWVDb21wb25lbnQpIHtcclxuICAgIGlmICghZnJhbWVDb21wb25lbnQpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuYmluZERlY2xhcmF0aW9uKGZyYW1lQ29tcG9uZW50LCBudWxsKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqICDkvp3mja7lrprkuYnliJfooajov5vooYzliJ3lp4vljJZcclxuICAgKiBAcGFyYW0gZnJhbWVDb21wb25lbnQg6KGo5Y2VY29tcG9uZW505a6e5L6LXHJcbiAgICogQHBhcmFtIG5nRGVjbGFyYXRpb25zIOS6i+S7tuWumuS5ieWIl+ihqOS/oeaBr1xyXG4gICAqL1xyXG4gIHB1YmxpYyBpbml0V2l0aERlY2xhcmF0aW9ucyhmcmFtZUNvbXBvbmVudDogRnJhbWVDb21wb25lbnQsIG5nRGVjbGFyYXRpb25zOiB7XHJcbiAgICBbcHJvcE5hbWU6IHN0cmluZ106IGFueTtcclxuICB9KTogdm9pZCB7XHJcbiAgICBpZiAoIWZyYW1lQ29tcG9uZW50KSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmJpbmREZWNsYXJhdGlvbihmcmFtZUNvbXBvbmVudCwgbnVsbCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDln7rkuo7kuovku7blhYPmlbDmja7mnoTlu7rkuovku7ZcclxuICAgKiDosIPmlbTorr/pl67nuqfliKsg5L6/5LqO6Kej5p6Q6KGo5Y2V6L+b6KGM5Yid5aeL5YyW5Yqo5L2cXHJcbiAgICogQHBhcmFtIGNvbnRleHQg5qGG5p625LiK5LiL5paHXHJcbiAgICovXHJcbiAgcHVibGljIGJpbmREZWNsYXJhdGlvbihmcmFtZUNvbXBvbmVudDogRnJhbWVDb21wb25lbnQsIG5nRGVjbGFyYXRpb25zOiB7XHJcbiAgICBbcHJvcE5hbWU6IHN0cmluZ106IGFueTtcclxuICB9KSB7XHJcbiAgICBjb25zdCBjb250ZXh0ID0gZnJhbWVDb21wb25lbnQuY29udGV4dDtcclxuICAgIGlmICghY29udGV4dCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgbmdQdWJsaWNFdmVudFByb3BzID0gbmdEZWNsYXJhdGlvbnMgPyBuZ0RlY2xhcmF0aW9ucyA6IHRoaXMuZ2V0TmdQdWJsaWNFdmVudCgpO1xyXG4gICAgaWYgKCFuZ1B1YmxpY0V2ZW50UHJvcHMpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIE9iamVjdC5rZXlzKG5nUHVibGljRXZlbnRQcm9wcykuZm9yRWFjaCgocHJvcGVydHlOYW1lOiBzdHJpbmcpID0+IHtcclxuICAgICAgY29uc3QgbmdFeHBvcnRFdmVudDogTmdEZWNsYXJhdGlvbiA9IG5nUHVibGljRXZlbnRQcm9wc1twcm9wZXJ0eU5hbWVdO1xyXG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgcHJvcGVydHlOYW1lLCB7XHJcbiAgICAgICAgdmFsdWU6ICgpID0+IHtcclxuICAgICAgICAgIC8vIOiOt+WPluWRveS7pOWkhOeQhuS4iuS4i+aWh1xyXG4gICAgICAgICAgY29uc3QgdGFyZ2V0Q29udGV4dDogRnJhbWVDb250ZXh0ID0gY29udGV4dDtcclxuICAgICAgICAgIC8vIHRvZG86IOe7mW5nRXhwb3J0RXZlbnTmt7vliqBmcmFtZUlk77yI5L+d6K+B5qGG5p625LmL6Ze055qE5LqL5Lu26ZqU56a777yJXHJcbiAgICAgICAgICAvLyBpZiAobmdFeHBvcnRFdmVudC5mcmFtZUlkKSB7XHJcbiAgICAgICAgICAvLyAgIHRhcmdldENvbnRleHQgPSBjb250ZXh0LmFwcENvbnRleHQuZ2V0RnJhbWVDb250ZXh0KG5nRXhwb3J0RXZlbnQuZnJhbWVJZCk7XHJcbiAgICAgICAgICAvLyB9XHJcbiAgICAgICAgICBjb25zdCByb290ID0gdGFyZ2V0Q29udGV4dC5yb290O1xyXG4gICAgICAgICAgY29uc3QgZW1pdHRlciA9IG5nRXhwb3J0RXZlbnQudG9rZW47XHJcbiAgICAgICAgICBjb25zdCB0b2tlblZhbHVlID0gbmdFeHBvcnRFdmVudC50b2tlbjtcclxuICAgICAgICAgIGNvbnN0IGV2ZW50TmFtZSA9IG5nRXhwb3J0RXZlbnQubmFtZTtcclxuICAgICAgICAgIGxldCBldmVudEFyZ3MgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KG5nRXhwb3J0RXZlbnQucGFyYW1zKSk7XHJcbiAgICAgICAgICBjb25zdCBldmVudFR5cGUgPSBuZ0V4cG9ydEV2ZW50LnR5cGU7XHJcbiAgICAgICAgICBjb25zdCBldmVudEJ1cyA9IHRhcmdldENvbnRleHQuZXZlbnRCdXMgfHwgcm9vdC5ldmVudEJ1cztcclxuICAgICAgICAgIGlmICghZXZlbnRCdXMpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgY29uc3QgaW5qZWN0b3IgPSB0YXJnZXRDb250ZXh0LmluamVjdG9yIHx8IHJvb3QuaW5qZWN0b3I7XHJcbiAgICAgICAgICBjb25zdCB2YXJpYWJsZVBhcnNlU2VydmljZSA9IGluamVjdG9yLmdldDxWYXJpYWJsZVBhcnNlU2VydmljZT4oVmFyaWFibGVQYXJzZVNlcnZpY2UpO1xyXG5cclxuICAgICAgICAgIC8vIOaJp+ihjOWPguaVsOino+aekFxyXG4gICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgIGV2ZW50QXJncyA9IHZhcmlhYmxlUGFyc2VTZXJ2aWNlLnBhcnNlKGV2ZW50QXJncywgdGFyZ2V0Q29udGV4dCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGV2ZW50U2VuZGVyID0gdGFyZ2V0Q29udGV4dC5mcmFtZUNvbXBvbmVudDtcclxuICAgICAgICAgICAgbGV0IGN1cnJlbnRDb250ZXh0ID0gdGFyZ2V0Q29udGV4dDtcclxuICAgICAgICAgICAgY29uc3QgZXZlbnRJZCA9IG5ldyBEYXRlKCkudmFsdWVPZigpO1xyXG4gICAgICAgICAgICBpZiAoZXZlbnRUeXBlICYmIGV2ZW50VHlwZSA9PT0gRXZlbnRUeXBlRW51bS5ST1VURSkge1xyXG4gICAgICAgICAgICAgIC8vIOS6i+S7tuS+neasoeWQkeS4iuWGkuazoVxyXG4gICAgICAgICAgICAgIHdoaWxlIChjdXJyZW50Q29udGV4dCkge1xyXG4gICAgICAgICAgICAgICAgY3VycmVudENvbnRleHQuZXZlbnRCdXMucG9zdChlbWl0dGVyLCB0b2tlblZhbHVlLCBldmVudE5hbWUsIGV2ZW50QXJncywgZXZlbnRTZW5kZXIsIGV2ZW50VHlwZSwgZXZlbnRJZCk7XHJcbiAgICAgICAgICAgICAgICAvLyBjdXJyZW50Q29udGV4dCA9IGN1cnJlbnRDb250ZXh0LnBhcmVudDtcclxuICAgICAgICAgICAgICAgIGN1cnJlbnRDb250ZXh0ID0gdGhpcy5nZXRQYXJlbnRDb250ZXh0KGN1cnJlbnRDb250ZXh0KTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgZXZlbnRCdXMucG9zdChlbWl0dGVyLCB0b2tlblZhbHVlLCBldmVudE5hbWUsIGV2ZW50QXJncywgZXZlbnRTZW5kZXIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9LCAwKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+W5LqL5Lu25a6a5LmJ5YiX6KGoXHJcbiAgICogQHJldHVybnMgIOS6i+S7tuWumuS5iVxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXROZ1B1YmxpY0V2ZW50KCkge1xyXG4gICAgcmV0dXJuIE1ldGFkYXRhVXRpbC5nZXRQcm9wc01ldGFkYXRhc0J5TmFtZSh0aGlzLmNvbnN0cnVjdG9yLCBOR19ERUNMQVJBVElPTik7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDojrflj5bniLZDb250ZXh0XHJcbiAgICogQHBhcmFtIGNvbnRleHQg5b2T5YmN5LiK5LiL5paHXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXRQYXJlbnRDb250ZXh0KGNvbnRleHQ6IEZyYW1lQ29udGV4dCk6IEZyYW1lQ29udGV4dCB7XHJcblxyXG4gICAgLy8g6aaW5YWI5p+l5om+55u05o6l5LiK57qnRnJhbWVDb250ZXh0XHJcbiAgICBpZiAoY29udGV4dC5wYXJlbnQpIHtcclxuICAgICAgcmV0dXJuIGNvbnRleHQucGFyZW50O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOWIsOS6hkFwcENvbnRleHTovrnnlYzvvIzov5Tlm57kuIrnuqdBcHBDb250ZXh055qE5qC5RnJhbWVDb250ZXh0XHJcbiAgICBjb25zdCBwYXJlbnRBcHBDb250ZXh0ID0gY29udGV4dC5hcHBDb250ZXh0LnBhcmVudDtcclxuICAgIGlmIChwYXJlbnRBcHBDb250ZXh0KSB7XHJcbiAgICAgIHJldHVybiBwYXJlbnRBcHBDb250ZXh0LmZyYW1lQ29udGV4dE1hbmFnZXIuZ2V0Um9vdEZyYW1lQ29udGV4dCgpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IHsgRGVjbGFyYXRpb24gfTtcclxuIl19