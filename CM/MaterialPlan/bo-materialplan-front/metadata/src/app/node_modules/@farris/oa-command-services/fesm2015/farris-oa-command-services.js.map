{"version":3,"file":"farris-oa-command-services.js.map","sources":["ng://@farris/oa-command-services/lib/print-web-page/entity.ts","ng://@farris/oa-command-services/lib/print-web-page/print-web-page.service.ts","ng://@farris/oa-command-services/lib/task-center-bridge/entity.ts","ng://@farris/oa-command-services/lib/task-center-bridge/task-center-bridge.service.ts","ng://@farris/oa-command-services/lib/transit-approval/transit-approval.service.ts","ng://@farris/oa-command-services/lib/oa-command-services-module.ts"],"sourcesContent":["\r\nexport enum templateType {\r\n  card = \"card\"\r\n}","import { Injectable } from \"@angular/core\";\r\nimport { MessagerService } from '@farris/ui-messager';\r\nimport { templateType } from \"./entity\";\r\n@Injectable()\r\nexport class PrintWebPageService {\r\n\r\n  private currentTemplate: templateType;\r\n\r\n  constructor(\r\n\r\n    private msgSer: MessagerService\r\n  ) {\r\n    window.onbeforeprint = () => {\r\n      if (this.currentTemplate == templateType.card) {\r\n        const rootLayout = document.getElementById('root-layout');\r\n        const mainContainer = document.getElementById('main-container');\r\n        if (rootLayout && mainContainer) {\r\n          rootLayout.style.display = 'block';\r\n          rootLayout.style.position = 'relative';\r\n          mainContainer.style.display = 'block';\r\n          rootLayout.parentElement.style.position = 'relative';\r\n          document.title = '';\r\n        } else {\r\n          this.msgSer.error('æªæ¾å°æ¨¡æ¿ä¸­å³é®èç¹ï¼è¯·æ£æ¥å½ä»¤ä¼ åä¸­æ¨¡æ¿ç±»åæ¯å¦æ­£ç¡®ã');\r\n        }\r\n      }\r\n    }\r\n    window.onafterprint = () => {\r\n      if (this.currentTemplate == templateType.card) {\r\n        const rootLayout = document.getElementById('root-layout');\r\n        const mainContainer = document.getElementById('main-container');\r\n        if (rootLayout && mainContainer) {\r\n          mainContainer.setAttribute('style', '');\r\n          rootLayout.setAttribute('style', '');\r\n          rootLayout.parentElement.setAttribute('style', '');\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  public printWebPage(tempType: templateType = templateType.card) {\r\n    this.currentTemplate = tempType;\r\n    if (!window.navigator.userAgent.includes('AppleWebKit/')) {\r\n      this.msgSer.prompt('æç¤º', 'ä¸ºä¿è¯æå°ææï¼æ¨èä½¿ç¨è°·æ­æµè§å¨è¿è¡æå°ãæ¯å¦ç»§ç»­æå°ï¼').subscribe((confirmed) => {\r\n        if (confirmed) {\r\n          window.print()\r\n        }\r\n      });\r\n    } else {\r\n      window.print()\r\n    }\r\n  }\r\n\r\n}","\r\nexport enum WFActionType {\r\n  Resubmit = 'Resubmit'\r\n}\r\n\r\n\r\nexport interface Parameter {\r\n  code: string;\r\n  value: string;\r\n}\r\n\r\nexport interface Action {\r\n  code: string;\r\n  parameters: Parameter[];\r\n}\r\n\r\nexport interface WFTask {\r\n  id: string;\r\n  sourceId: string;\r\n  name: string;\r\n  state: string;\r\n  owner: string;\r\n  priority: number;\r\n  categoryId: string;\r\n  submitter: string;\r\n  startTime: string;\r\n  endTime: string;\r\n  processInstanceId: string;\r\n  refBizId: string;\r\n  submitterName: string;\r\n  bizCategory: string;\r\n  activityType: string;\r\n  activityDefinitionId: string;\r\n  activityInstanceId: string;\r\n  fromType: number;\r\n  tenantId: number;\r\n  readTime: string;\r\n  createdTime: string;\r\n  creator: string;\r\n  lastModifiedTime: string;\r\n  lastModifier: string;\r\n  actions: Action[];\r\n}\r\n\r\n\r\n\r\nexport type WFAction = {\r\n  \"code\": WFActionType,\r\n  \"parameters\": [],\r\n  \"id\": \"\",\r\n  \"name\": \"\",\r\n  \"sortOrder\": 13,\r\n  \"typeId\": \"wf\",\r\n  \"isBatchAction\": false,\r\n  \"isPrimaryAction\": false,\r\n  \"isHyperlinkAction\": false,\r\n  \"isCustomizeAction\": false,\r\n  \"terminal\": \"web,app\",\r\n  \"scope\": \"running\",\r\n  \"groupId\": \"complete\",\r\n  \"nameLanguage\": null,\r\n  \"preEvents\": [],\r\n  \"postEvents\": []\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { FrameContext } from '@farris/devkit';\r\nimport { WFAction, WFActionType, WFTask } from './entity';\r\n\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class TaskCenterBridgeService {\r\n\r\n  constructor() { }\r\n\r\n  public initTaskCenterBridge(customerCmds: {}) {\r\n    const bridgeWin = window.parent;\r\n    let frameContext: FrameContext;\r\n    try {\r\n      frameContext = this['context'].frameContext\r\n    } catch (error) {\r\n      throw new Error('can not find frameContex');\r\n    }\r\n\r\n    let slienceSaveTask;\r\n\r\n    try {\r\n      slienceSaveTask = this['context'].frameContext.viewModel.slienceSave1;\r\n    } catch (error) {\r\n      // ä¸å­å¨éé³ä¿å­å½ä»¤\r\n    }\r\n    if (bridgeWin) {\r\n      bridgeWin['taskCenterBeforeLoad'] = (\r\n        actionObj: {\r\n          \"task\": WFTask,\r\n          \"action\": WFAction\r\n        }\r\n      ) => {\r\n        return new Promise((resolve, reject) => {\r\n          const { action } = actionObj;\r\n          if (frameContext.uiState['UIStateInProcess'] == 'Approving' && frameContext.uiState['formConfigId']) {\r\n            slienceSaveTask.call(this).subscribe(() => {\r\n              resolve({\r\n                result: true\r\n              });\r\n            }, () => {\r\n              window.document.body.click()\r\n              resolve({\r\n                result: false\r\n              });\r\n            })\r\n          } else if (action.code == WFActionType.Resubmit && slienceSaveTask) {\r\n            slienceSaveTask.call(this).subscribe(() => {\r\n              resolve({\r\n                result: true\r\n              });\r\n            })\r\n          } else {\r\n            resolve({\r\n              result: true\r\n            });\r\n          }\r\n        })\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Injectable, Injector } from '@angular/core';\r\n// import { StateMachineService } from '@farris/command-services';\r\nimport { FrameContext } from '@farris/devkit';\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\n@Injectable()\r\nexport class TransitApprovalStatus {\r\n    constructor(\r\n        private injetor: Injector\r\n    ) {\r\n        // å ä¸ºæ³¨ä½ç½®çé®é¢ï¼è¿æ ·å­æ¿ä¸å°\r\n        // this.stateMachineSer = this.injetor.get(StateMachineService);\r\n    }\r\n    public switchStatus() {\r\n        const result: BehaviorSubject<string> = new BehaviorSubject('Cancel');\r\n        //  å¤æ­æµç¨ä¼ å  formConfigId\r\n        let frameContext: FrameContext;\r\n        try {\r\n            frameContext = this['context'].frameContext\r\n        } catch (error) {\r\n            throw new Error('can not find frameContex');\r\n        }\r\n        if (frameContext.uiState['UIStateInProcess'] == 'Approving' && frameContext.uiState['formConfigId']) {\r\n            result.next('Edit');\r\n        }\r\n        return result;\r\n    }\r\n}","import { NgModule } from '@angular/core';\r\nimport { PrintWebPageService } from './print-web-page/print-web-page.service';\r\nimport { TaskCenterBridgeService } from './task-center-bridge/task-center-bridge.service';\r\nimport { TransitApprovalStatus } from './transit-approval/transit-approval.service';\r\n\r\n\r\n\r\n@NgModule({\r\n    providers: [\r\n        TaskCenterBridgeService,\r\n        PrintWebPageService,\r\n        TransitApprovalStatus,\r\n    ],\r\n    imports: [\r\n\r\n    ],\r\n    exports: [\r\n\r\n    ],\r\n    entryComponents: [\r\n    ]\r\n})\r\nclass OACommandServicesModule {\r\n    constructor() { }\r\n}\r\n\r\nexport { OACommandServicesModule };\r\n\r\n"],"names":[],"mappings":"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"}
