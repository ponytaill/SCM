import { DataPropGroup } from "../core/index";
import { ENTITY_TEMPLATE, GROUP_FUNCTIONS } from "../resolver/index";
export class ExpressionUtil {
    static getGroupFunctionDependency(expr, entityTypeInfo) {
        const deps = [];
        // 获取聚合函数依赖项
        const groupFunctionRegex = new RegExp(`DefaultFunction\\.(${GROUP_FUNCTIONS.join('|')})\\s*\\([^\\r\\n\\)]*\\)`, "g");
        const groupFunctions = expr.match(groupFunctionRegex);
        if (groupFunctions && groupFunctions.length > 0) {
            // todo: 使用正则匹配时可能会因为参数中有逗号导致问题，后续使用ast解析
            const argumentsRegex = /\(([^\r\n\)]*)\)/;
            const methodNameRegex = /DefaultFunction\.(\S*)\(/;
            groupFunctions.forEach((groupFunction) => {
                const argumentMatchResult = groupFunction.match(argumentsRegex);
                const methodNameMatchResult = groupFunction.match(methodNameRegex);
                let methodName = null;
                if (methodNameMatchResult && methodNameMatchResult.length == 2) {
                    methodName = methodNameMatchResult[1];
                }
                if (argumentMatchResult.length === 2) {
                    const argument = argumentMatchResult[1];
                    const args = argument.split(',').map(p => p.replace(/\"/g, ''));
                    if (args && args.length === 2) {
                        let item = args.join('.');
                        item = this.convertToNodeCode(item, entityTypeInfo).join('.');
                        // 移除主表code
                        item = item.substr(item.indexOf('.') + 1);
                        const dep = item.split('.');
                        dep.splice(0, 0, ENTITY_TEMPLATE);
                        deps.push(dep.join('/'));
                    }
                    else if (args && args.length === 3 && methodName === 'MultiplyChildNumber') {
                        // support MultiplyChildNumber
                        // [Entity.childrens,prop1,prop2]
                        const prefix = args[0]; // like Entity.childrens
                        //const tableName = args[0];// prefix.substring(prefix.indexOf('.')+1);
                        const prop1FullPath = `${prefix}.${args[1]}`;
                        const prop2FullPath = `${prefix}.${args[2]}`;
                        [prop1FullPath, prop2FullPath].forEach(item => {
                            item = this.convertToNodeCode(item, entityTypeInfo).join('.');
                            item = item.substr(item.indexOf('.') + 1);
                            const dep = item.split('.');
                            dep.splice(0, 0, ENTITY_TEMPLATE);
                            deps.push(dep.join('/'));
                        });
                    }
                    else {
                        throw new Error(`无法解析参数： ${JSON.stringify(argument)}`);
                    }
                }
            });
        }
        return deps;
    }
    /**
     * 将voCode转换为前端nodeCode
     * @param entityExpression like Entity.Child.p1
     * @returns
     */
    static convertToNodeCode(entityExpression, entityTypeInfo) {
        // UserEntity.storys.p1
        const nodeCodes = [];
        if (entityTypeInfo && entityExpression.includes('.')) {
            const entityExpressions = entityExpression.split('.') || [];
            let dataTypeInfo = entityTypeInfo;
            for (let index = 0; index < entityExpressions.length; index++) {
                const prop = entityExpressions[index];
                if (dataTypeInfo && dataTypeInfo.entityInfo && dataTypeInfo.entityInfo.nodeCode === prop || dataTypeInfo.entityInfo.originalCode === prop) {
                    // 第一个是主表code，不能转nodeCode
                    if (index === 0) {
                        nodeCodes.push(dataTypeInfo.entityInfo.originalCode);
                    }
                    else {
                        nodeCodes.push(dataTypeInfo.entityInfo.nodeCode);
                    }
                    // 下一级可能为子表、对象或属性
                    const nextNodeCode = entityExpressions[index + 1];
                    if (!nextNodeCode) {
                        break;
                    }
                    const nextNodeCodePropInfo = dataTypeInfo.getPropInfoByName(nextNodeCode);
                    if (!nextNodeCodePropInfo) {
                        break;
                    }
                    // 下一级为子表或对象
                    if (nextNodeCodePropInfo.typeInfo) {
                        dataTypeInfo = nextNodeCodePropInfo.typeInfo;
                    }
                }
                else if (dataTypeInfo && dataTypeInfo.getPropInfoByName(prop)) {
                    const dataPropInfo = dataTypeInfo.getPropInfoByName(prop);
                    nodeCodes.push(dataPropInfo.name);
                }
                else {
                    //throw new Error(`错误的属性参数 ${entityExpression}`);
                    break;
                }
            }
        }
        return nodeCodes;
    }
    /**
     * 找到元数据中所有实体路径
     * @param dataTypeInfo
     * @param results
     * @param paths
     */
    static getChildrenEntityPaths(dataTypeInfo, results, paths = []) {
        const list = dataTypeInfo.getPropInfosByGroup(DataPropGroup.List);
        if (list && list.length > 0) {
            list.forEach((dataPropInfo) => {
                if (paths.length === 0) {
                    results.push([dataPropInfo.name]);
                }
                const childrens = dataPropInfo.typeInfo.getPropInfosByGroup(DataPropGroup.List);
                if (childrens && childrens.length > 0) {
                    paths.push(dataPropInfo.name);
                    childrens.forEach((dataPropInfo) => {
                        this.getChildrenEntityPaths(dataPropInfo.typeInfo, results, paths);
                    });
                }
                else {
                    if (paths.length !== 0) {
                        paths.push(dataPropInfo.name);
                        results.push([...paths]);
                    }
                    paths.length = 0;
                }
            });
        }
        else {
            if (paths.length > 0) {
                paths.push(dataTypeInfo.entityInfo.nodeCode);
                results.push([...paths]);
            }
            paths.length = 0;
        }
    }
    /**
     * 获取指定绑定路径的当前行数据
     * @param paths 绑定路径
     * @param bindingData
     * @returns
     */
    static getCurrentRowByPaths(paths, bindingData) {
        let result = null;
        const bindingList = bindingData.getValue(paths);
        if (bindingList && bindingList.length > 0) {
            let primaryValue = bindingList.currentItem.primaryKeyValue || null;
            // 使用事件中的主键
            // 主表或下级表新增，此时事件行就是当前行，无需处理
            if (primaryValue) {
                const bindingObject = bindingList.findById(primaryValue);
                if (bindingObject) {
                    result = bindingObject.toJSON();
                }
            }
        }
        return result;
    }
    /**
     * 从实体路径中获取级数最大的从表或从从表
     * @param paths
     * @returns
     */
    static getAvailableChildrenPathsFromEntityPaths(paths, entityTypeInfo) {
        let nodeCodes = [];
        paths = [...paths];
        while (paths.length > 0) {
            const dataPropInfo = entityTypeInfo.getPropInfoByPath(paths);
            if (dataPropInfo && dataPropInfo.group === 'List') {
                nodeCodes = paths;
                break;
            }
            paths.pop();
        }
        return nodeCodes;
    }
    /**
     * 从路径中获取绑定路径
     * @param paths 路径
     * @param entityTypeInfo entityTypeInfo
     * @returns
     */
    static getBindingPath(paths, entityTypeInfo) {
        paths = this.getEntityPath(paths);
        const entityPaths = this.getAvailableChildrenPathsFromEntityPaths(paths, entityTypeInfo);
        return entityPaths;
    }
    static getEntityPath(path) {
        const paths = path.filter((value, index) => {
            if (index % 2 === 0 && value.includes(':')) {
                return false;
            }
            else {
                return true;
            }
        });
        return paths;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXhwcmVzc2lvbl91dGlsLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9kZXZraXQvIiwic291cmNlcyI6WyJsaWIvdXRpbHMvZXhwcmVzc2lvbl91dGlsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxhQUFhLEVBQThCLE1BQU0sZUFBZSxDQUFDO0FBQzFFLE9BQU8sRUFBRSxlQUFlLEVBQUUsZUFBZSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFFckUsTUFBTSxPQUFPLGNBQWM7SUFDbEIsTUFBTSxDQUFDLDBCQUEwQixDQUFDLElBQVksRUFBRSxjQUE0QjtRQUNqRixNQUFNLElBQUksR0FBRyxFQUFFLENBQUM7UUFDaEIsWUFBWTtRQUNaLE1BQU0sa0JBQWtCLEdBQUcsSUFBSSxNQUFNLENBQUMsc0JBQXNCLGVBQWUsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLDBCQUEwQixFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBQ3RILE1BQU0sY0FBYyxHQUFxQixJQUFJLENBQUMsS0FBSyxDQUFDLGtCQUFrQixDQUFDLENBQUM7UUFDeEUsSUFBSSxjQUFjLElBQUksY0FBYyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDL0MseUNBQXlDO1lBQ3pDLE1BQU0sY0FBYyxHQUFHLGtCQUFrQixDQUFDO1lBQzFDLE1BQU0sZUFBZSxHQUFHLDBCQUEwQixDQUFDO1lBQ25ELGNBQWMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxhQUFxQixFQUFFLEVBQUU7Z0JBQy9DLE1BQU0sbUJBQW1CLEdBQUcsYUFBYSxDQUFDLEtBQUssQ0FBQyxjQUFjLENBQUMsQ0FBQztnQkFDaEUsTUFBTSxxQkFBcUIsR0FBRyxhQUFhLENBQUMsS0FBSyxDQUFDLGVBQWUsQ0FBQyxDQUFDO2dCQUNuRSxJQUFJLFVBQVUsR0FBRyxJQUFJLENBQUM7Z0JBQ3RCLElBQUkscUJBQXFCLElBQUkscUJBQXFCLENBQUMsTUFBTSxJQUFJLENBQUMsRUFBRTtvQkFDOUQsVUFBVSxH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UUFDSCxPQUFPLEtBQUssQ0FBQztJQUNmLENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEJpbmRpbmdEYXRhLCBCaW5kaW5nTGlzdCB9IGZyb20gXCIuLi9iaW5kaW5nLWRhdGEvaW5kZXhcIjtcclxuaW1wb3J0IHsgRGF0YVByb3BHcm91cCwgRGF0YVByb3BJbmZvLCBEYXRhVHlwZUluZm8gfSBmcm9tIFwiLi4vY29yZS9pbmRleFwiO1xyXG5pbXBvcnQgeyBFTlRJVFlfVEVNUExBVEUsIEdST1VQX0ZVTkNUSU9OUyB9IGZyb20gXCIuLi9yZXNvbHZlci9pbmRleFwiO1xyXG5cclxuZXhwb3J0IGNsYXNzIEV4cHJlc3Npb25VdGlsIHtcclxuICBwdWJsaWMgc3RhdGljIGdldEdyb3VwRnVuY3Rpb25EZXBlbmRlbmN5KGV4cHI6IHN0cmluZywgZW50aXR5VHlwZUluZm86IERhdGFUeXBlSW5mbyk6IHN0cmluZ1tdIHtcclxuICAgIGNvbnN0IGRlcHMgPSBbXTtcclxuICAgIC8vIOiOt+WPluiBmuWQiOWHveaVsOS+nei1lumhuVxyXG4gICAgY29uc3QgZ3JvdXBGdW5jdGlvblJlZ2V4ID0gbmV3IFJlZ0V4cChgRGVmYXVsdEZ1bmN0aW9uXFxcXC4oJHtHUk9VUF9GVU5DVElPTlMuam9pbignfCcpfSlcXFxccypcXFxcKFteXFxcXHJcXFxcblxcXFwpXSpcXFxcKWAsIFwiZ1wiKTtcclxuICAgIGNvbnN0IGdyb3VwRnVuY3Rpb25zOiBSZWdFeHBNYXRjaEFycmF5ID0gZXhwci5tYXRjaChncm91cEZ1bmN0aW9uUmVnZXgpO1xyXG4gICAgaWYgKGdyb3VwRnVuY3Rpb25zICYmIGdyb3VwRnVuY3Rpb25zLmxlbmd0aCA+IDApIHtcclxuICAgICAgLy8gdG9kbzog5L2/55So5q2j5YiZ5Yy56YWN5pe25Y+v6IO95Lya5Zug5Li65Y+C5pWw5Lit5pyJ6YCX5Y+35a+86Ie06Zeu6aKY77yM5ZCO57ut5L2/55SoYXN06Kej5p6QXHJcbiAgICAgIGNvbnN0IGFyZ3VtZW50c1JlZ2V4ID0gL1xcKChbXlxcclxcblxcKV0qKVxcKS87XHJcbiAgICAgIGNvbnN0IG1ldGhvZE5hbWVSZWdleCA9IC9EZWZhdWx0RnVuY3Rpb25cXC4oXFxTKilcXCgvO1xyXG4gICAgICBncm91cEZ1bmN0aW9ucy5mb3JFYWNoKChncm91cEZ1bmN0aW9uOiBzdHJpbmcpID0+IHtcclxuICAgICAgICBjb25zdCBhcmd1bWVudE1hdGNoUmVzdWx0ID0gZ3JvdXBGdW5jdGlvbi5tYXRjaChhcmd1bWVudHNSZWdleCk7XHJcbiAgICAgICAgY29uc3QgbWV0aG9kTmFtZU1hdGNoUmVzdWx0ID0gZ3JvdXBGdW5jdGlvbi5tYXRjaChtZXRob2ROYW1lUmVnZXgpO1xyXG4gICAgICAgIGxldCBtZXRob2ROYW1lID0gbnVsbDtcclxuICAgICAgICBpZiAobWV0aG9kTmFtZU1hdGNoUmVzdWx0ICYmIG1ldGhvZE5hbWVNYXRjaFJlc3VsdC5sZW5ndGggPT0gMikge1xyXG4gICAgICAgICAgbWV0aG9kTmFtZSA9IG1ldGhvZE5hbWVNYXRjaFJlc3VsdFsxXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGFyZ3VtZW50TWF0Y2hSZXN1bHQubGVuZ3RoID09PSAyKSB7XHJcbiAgICAgICAgICBjb25zdCBhcmd1bWVudCA9IGFyZ3VtZW50TWF0Y2hSZXN1bHRbMV07XHJcbiAgICAgICAgICBjb25zdCBhcmdzID0gYXJndW1lbnQuc3BsaXQoJywnKS5tYXAocCA9PiBwLnJlcGxhY2UoL1xcXCIvZywgJycpKTtcclxuICAgICAgICAgIGlmIChhcmdzICYmIGFyZ3MubGVuZ3RoID09PSAyKSB7XHJcbiAgICAgICAgICAgIGxldCBpdGVtOiBhbnkgPSBhcmdzLmpvaW4oJy4nKTtcclxuICAgICAgICAgICAgaXRlbSA9IHRoaXMuY29udmVydFRvTm9kZUNvZGUoaXRlbSwgZW50aXR5VHlwZUluZm8pLmpvaW4oJy4nKTtcclxuICAgICAgICAgICAgLy8g56e76Zmk5Li76KGoY29kZVxyXG4gICAgICAgICAgICBpdGVtID0gaXRlbS5zdWJzdHIoaXRlbS5pbmRleE9mKCcuJykgKyAxKTtcclxuICAgICAgICAgICAgY29uc3QgZGVwID0gaXRlbS5zcGxpdCgnLicpO1xyXG4gICAgICAgICAgICBkZXAuc3BsaWNlKDAsIDAsIEVOVElUWV9URU1QTEFURSk7XHJcbiAgICAgICAgICAgIGRlcHMucHVzaChkZXAuam9pbignLycpKTtcclxuICAgICAgICAgIH0gZWxzZSBpZiAoYXJncyAmJiBhcmdzLmxlbmd0aCA9PT0gMyAmJiBtZXRob2ROYW1lID09PSAnTXVsdGlwbHlDaGlsZE51bWJlcicpIHtcclxuICAgICAgICAgICAgLy8gc3VwcG9ydCBNdWx0aXBseUNoaWxkTnVtYmVyXHJcbiAgICAgICAgICAgIC8vIFtFbnRpdHkuY2hpbGRyZW5zLHByb3AxLHByb3AyXVxyXG4gICAgICAgICAgICBjb25zdCBwcmVmaXggPSBhcmdzWzBdOyAvLyBsaWtlIEVudGl0eS5jaGlsZHJlbnNcclxuICAgICAgICAgICAgLy9jb25zdCB0YWJsZU5hbWUgPSBhcmdzWzBdOy8vIHByZWZpeC5zdWJzdHJpbmcocHJlZml4LmluZGV4T2YoJy4nKSsxKTtcclxuICAgICAgICAgICAgY29uc3QgcHJvcDFGdWxsUGF0aCA9IGAke3ByZWZpeH0uJHthcmdzWzFdfWA7XHJcbiAgICAgICAgICAgIGNvbnN0IHByb3AyRnVsbFBhdGggPSBgJHtwcmVmaXh9LiR7YXJnc1syXX1gO1xyXG4gICAgICAgICAgICBbcHJvcDFGdWxsUGF0aCwgcHJvcDJGdWxsUGF0aF0uZm9yRWFjaChpdGVtID0+IHtcclxuICAgICAgICAgICAgICBpdGVtID0gdGhpcy5jb252ZXJ0VG9Ob2RlQ29kZShpdGVtLCBlbnRpdHlUeXBlSW5mbykuam9pbignLicpO1xyXG4gICAgICAgICAgICAgIGl0ZW0gPSBpdGVtLnN1YnN0cihpdGVtLmluZGV4T2YoJy4nKSArIDEpO1xyXG4gICAgICAgICAgICAgIGNvbnN0IGRlcCA9IGl0ZW0uc3BsaXQoJy4nKTtcclxuICAgICAgICAgICAgICBkZXAuc3BsaWNlKDAsIDAsIEVOVElUWV9URU1QTEFURSk7XHJcbiAgICAgICAgICAgICAgZGVwcy5wdXNoKGRlcC5qb2luKCcvJykpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihg5peg5rOV6Kej5p6Q5Y+C5pWw77yaICR7SlNPTi5zdHJpbmdpZnkoYXJndW1lbnQpfWApO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZGVwcztcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5bCGdm9Db2Rl6L2s5o2i5Li65YmN56uvbm9kZUNvZGVcclxuICAgKiBAcGFyYW0gZW50aXR5RXhwcmVzc2lvbiBsaWtlIEVudGl0eS5DaGlsZC5wMVxyXG4gICAqIEByZXR1cm5zIFxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGF0aWMgY29udmVydFRvTm9kZUNvZGUoZW50aXR5RXhwcmVzc2lvbjogc3RyaW5nLCBlbnRpdHlUeXBlSW5mbzogRGF0YVR5cGVJbmZvKTogc3RyaW5nW10ge1xyXG4gICAgLy8gVXNlckVudGl0eS5zdG9yeXMucDFcclxuICAgIGNvbnN0IG5vZGVDb2RlcyA9IFtdO1xyXG4gICAgaWYgKGVudGl0eVR5cGVJbmZvICYmIGVudGl0eUV4cHJlc3Npb24uaW5jbHVkZXMoJy4nKSkge1xyXG4gICAgICBjb25zdCBlbnRpdHlFeHByZXNzaW9ucyA9IGVudGl0eUV4cHJlc3Npb24uc3BsaXQoJy4nKSB8fCBbXTtcclxuICAgICAgbGV0IGRhdGFUeXBlSW5mbyA9IGVudGl0eVR5cGVJbmZvO1xyXG4gICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgZW50aXR5RXhwcmVzc2lvbnMubGVuZ3RoOyBpbmRleCsrKSB7XHJcbiAgICAgICAgY29uc3QgcHJvcCA9IGVudGl0eUV4cHJlc3Npb25zW2luZGV4XTtcclxuICAgICAgICBpZiAoZGF0YVR5cGVJbmZvICYmIGRhdGFUeXBlSW5mby5lbnRpdHlJbmZvICYmIGRhdGFUeXBlSW5mby5lbnRpdHlJbmZvLm5vZGVDb2RlID09PSBwcm9wIHx8IGRhdGFUeXBlSW5mby5lbnRpdHlJbmZvLm9yaWdpbmFsQ29kZSA9PT0gcHJvcCkge1xyXG4gICAgICAgICAgLy8g56ys5LiA5Liq5piv5Li76KGoY29kZe+8jOS4jeiDvei9rG5vZGVDb2RlXHJcbiAgICAgICAgICBpZiAoaW5kZXggPT09IDApIHtcclxuICAgICAgICAgICAgbm9kZUNvZGVzLnB1c2goZGF0YVR5cGVJbmZvLmVudGl0eUluZm8ub3JpZ2luYWxDb2RlKTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIG5vZGVDb2Rlcy5wdXNoKGRhdGFUeXBlSW5mby5lbnRpdHlJbmZvLm5vZGVDb2RlKTtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAvLyDkuIvkuIDnuqflj6/og73kuLrlrZDooajjgIHlr7nosaHmiJblsZ7mgKdcclxuICAgICAgICAgIGNvbnN0IG5leHROb2RlQ29kZSA9IGVudGl0eUV4cHJlc3Npb25zW2luZGV4ICsgMV07XHJcbiAgICAgICAgICBpZiAoIW5leHROb2RlQ29kZSkge1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGNvbnN0IG5leHROb2RlQ29kZVByb3BJbmZvID0gZGF0YVR5cGVJbmZvLmdldFByb3BJbmZvQnlOYW1lKG5leHROb2RlQ29kZSk7XHJcbiAgICAgICAgICBpZiAoIW5leHROb2RlQ29kZVByb3BJbmZvKSB7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgLy8g5LiL5LiA57qn5Li65a2Q6KGo5oiW5a+56LGhXHJcbiAgICAgICAgICBpZiAobmV4dE5vZGVDb2RlUHJvcEluZm8udHlwZUluZm8pIHtcclxuICAgICAgICAgICAgZGF0YVR5cGVJbmZvID0gbmV4dE5vZGVDb2RlUHJvcEluZm8udHlwZUluZm87XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIGlmIChkYXRhVHlwZUluZm8gJiYgZGF0YVR5cGVJbmZvLmdldFByb3BJbmZvQnlOYW1lKHByb3ApKSB7XHJcbiAgICAgICAgICBjb25zdCBkYXRhUHJvcEluZm8gPSBkYXRhVHlwZUluZm8uZ2V0UHJvcEluZm9CeU5hbWUocHJvcCk7XHJcbiAgICAgICAgICBub2RlQ29kZXMucHVzaChkYXRhUHJvcEluZm8ubmFtZSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIC8vdGhyb3cgbmV3IEVycm9yKGDplJnor6/nmoTlsZ7mgKflj4LmlbAgJHtlbnRpdHlFeHByZXNzaW9ufWApO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbm9kZUNvZGVzO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmib7liLDlhYPmlbDmja7kuK3miYDmnInlrp7kvZPot6/lvoRcclxuICAgKiBAcGFyYW0gZGF0YVR5cGVJbmZvIFxyXG4gICAqIEBwYXJhbSByZXN1bHRzIFxyXG4gICAqIEBwYXJhbSBwYXRocyBcclxuICAgKi9cclxuICBwdWJsaWMgc3RhdGljIGdldENoaWxkcmVuRW50aXR5UGF0aHMoZGF0YVR5cGVJbmZvOiBEYXRhVHlwZUluZm8sIHJlc3VsdHM6IGFueVtdLCBwYXRoczogc3RyaW5nW10gPSBbXSkge1xyXG4gICAgY29uc3QgbGlzdDogRGF0YVByb3BJbmZvW10gPSBkYXRhVHlwZUluZm8uZ2V0UHJvcEluZm9zQnlHcm91cChEYXRhUHJvcEdyb3VwLkxpc3QpO1xyXG4gICAgaWYgKGxpc3QgJiYgbGlzdC5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGxpc3QuZm9yRWFjaCgoZGF0YVByb3BJbmZvOiBEYXRhUHJvcEluZm8pID0+IHtcclxuICAgICAgICBpZiAocGF0aHMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICByZXN1bHRzLnB1c2goW2RhdGFQcm9wSW5mby5uYW1lXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGNoaWxkcmVuczogRGF0YVByb3BJbmZvW10gPSBkYXRhUHJvcEluZm8udHlwZUluZm8uZ2V0UHJvcEluZm9zQnlHcm91cChEYXRhUHJvcEdyb3VwLkxpc3QpO1xyXG4gICAgICAgIGlmIChjaGlsZHJlbnMgJiYgY2hpbGRyZW5zLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgIHBhdGhzLnB1c2goZGF0YVByb3BJbmZvLm5hbWUpO1xyXG4gICAgICAgICAgY2hpbGRyZW5zLmZvckVhY2goKGRhdGFQcm9wSW5mbzogRGF0YVByb3BJbmZvKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuZ2V0Q2hpbGRyZW5FbnRpdHlQYXRocyhkYXRhUHJvcEluZm8udHlwZUluZm8sIHJlc3VsdHMsIHBhdGhzKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBpZiAocGF0aHMubGVuZ3RoICE9PSAwKSB7XHJcbiAgICAgICAgICAgIHBhdGhzLnB1c2goZGF0YVByb3BJbmZvLm5hbWUpO1xyXG4gICAgICAgICAgICByZXN1bHRzLnB1c2goWy4uLnBhdGhzXSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBwYXRocy5sZW5ndGggPSAwO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBpZiAocGF0aHMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIHBhdGhzLnB1c2goZGF0YVR5cGVJbmZvLmVudGl0eUluZm8ubm9kZUNvZGUpO1xyXG4gICAgICAgIHJlc3VsdHMucHVzaChbLi4ucGF0aHNdKTtcclxuICAgICAgfVxyXG4gICAgICBwYXRocy5sZW5ndGggPSAwO1xyXG4gICAgfVxyXG4gIH1cclxuICAvKipcclxuICAgKiDojrflj5bmjIflrprnu5Hlrprot6/lvoTnmoTlvZPliY3ooYzmlbDmja5cclxuICAgKiBAcGFyYW0gcGF0aHMg57uR5a6a6Lev5b6EXHJcbiAgICogQHBhcmFtIGJpbmRpbmdEYXRhIFxyXG4gICAqIEByZXR1cm5zIFxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGF0aWMgZ2V0Q3VycmVudFJvd0J5UGF0aHMocGF0aHM6IHN0cmluZ1tdLCBiaW5kaW5nRGF0YTogQmluZGluZ0RhdGEpOiBudWxsIHwgeyBbcHJvcDogc3RyaW5nXTogYW55IH0ge1xyXG4gICAgbGV0IHJlc3VsdCA9IG51bGw7XHJcbiAgICBjb25zdCBiaW5kaW5nTGlzdDogQmluZGluZ0xpc3QgPSBiaW5kaW5nRGF0YS5nZXRWYWx1ZShwYXRocykgYXMgQmluZGluZ0xpc3Q7XHJcbiAgICBpZiAoYmluZGluZ0xpc3QgJiYgYmluZGluZ0xpc3QubGVuZ3RoID4gMCkge1xyXG4gICAgICBsZXQgcHJpbWFyeVZhbHVlID0gYmluZGluZ0xpc3QuY3VycmVudEl0ZW0ucHJpbWFyeUtleVZhbHVlIHx8IG51bGw7XHJcbiAgICAgIC8vIOS9v+eUqOS6i+S7tuS4reeahOS4u+mUrlxyXG4gICAgICAvLyDkuLvooajmiJbkuIvnuqfooajmlrDlop7vvIzmraTml7bkuovku7booYzlsLHmmK/lvZPliY3ooYzvvIzml6DpnIDlpITnkIZcclxuICAgICAgaWYgKHByaW1hcnlWYWx1ZSkge1xyXG4gICAgICAgIGNvbnN0IGJpbmRpbmdPYmplY3QgPSBiaW5kaW5nTGlzdC5maW5kQnlJZChwcmltYXJ5VmFsdWUpO1xyXG4gICAgICAgIGlmIChiaW5kaW5nT2JqZWN0KSB7XHJcbiAgICAgICAgICByZXN1bHQgPSBiaW5kaW5nT2JqZWN0LnRvSlNPTigpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5LuO5a6e5L2T6Lev5b6E5Lit6I635Y+W57qn5pWw5pyA5aSn55qE5LuO6KGo5oiW5LuO5LuO6KGoXHJcbiAgICogQHBhcmFtIHBhdGhzIFxyXG4gICAqIEByZXR1cm5zIFxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGF0aWMgZ2V0QXZhaWxhYmxlQ2hpbGRyZW5QYXRoc0Zyb21FbnRpdHlQYXRocyhwYXRoczogc3RyaW5nW10sIGVudGl0eVR5cGVJbmZvOiBEYXRhVHlwZUluZm8pOiBzdHJpbmdbXSB7XHJcbiAgICBsZXQgbm9kZUNvZGVzID0gW107XHJcbiAgICBwYXRocyA9IFsuLi5wYXRoc107XHJcbiAgICB3aGlsZSAocGF0aHMubGVuZ3RoID4gMCkge1xyXG4gICAgICBjb25zdCBkYXRhUHJvcEluZm8gPSBlbnRpdHlUeXBlSW5mby5nZXRQcm9wSW5mb0J5UGF0aChwYXRocyk7XHJcbiAgICAgIGlmIChkYXRhUHJvcEluZm8gJiYgZGF0YVByb3BJbmZvLmdyb3VwID09PSAnTGlzdCcpIHtcclxuICAgICAgICBub2RlQ29kZXMgPSBwYXRocztcclxuICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgICBwYXRocy5wb3AoKTtcclxuICAgIH1cclxuICAgIHJldHVybiBub2RlQ29kZXM7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOS7jui3r+W+hOS4reiOt+WPlue7keWumui3r+W+hFxyXG4gICAqIEBwYXJhbSBwYXRocyDot6/lvoRcclxuICAgKiBAcGFyYW0gZW50aXR5VHlwZUluZm8gZW50aXR5VHlwZUluZm9cclxuICAgKiBAcmV0dXJucyBcclxuICAgKi9cclxuICBwdWJsaWMgc3RhdGljIGdldEJpbmRpbmdQYXRoKHBhdGhzOiBzdHJpbmdbXSwgZW50aXR5VHlwZUluZm86IERhdGFUeXBlSW5mbykge1xyXG4gICAgcGF0aHMgPSB0aGlzLmdldEVudGl0eVBhdGgocGF0aHMpO1xyXG4gICAgY29uc3QgZW50aXR5UGF0aHMgPSB0aGlzLmdldEF2YWlsYWJsZUNoaWxkcmVuUGF0aHNGcm9tRW50aXR5UGF0aHMocGF0aHMsIGVudGl0eVR5cGVJbmZvKTtcclxuICAgIHJldHVybiBlbnRpdHlQYXRocztcclxuICB9XHJcbiAgcHVibGljIHN0YXRpYyBnZXRFbnRpdHlQYXRoKHBhdGg6IHN0cmluZ1tdKTogc3RyaW5nW10ge1xyXG4gICAgY29uc3QgcGF0aHMgPSBwYXRoLmZpbHRlcigodmFsdWU6IHN0cmluZywgaW5kZXg6IG51bWJlcikgPT4ge1xyXG4gICAgICBpZiAoaW5kZXggJSAyID09PSAwICYmIHZhbHVlLmluY2x1ZGVzKCc6JykpIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIHBhdGhzO1xyXG4gIH1cclxufSJdfQ==