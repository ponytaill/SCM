/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, EventEmitter, Output, Renderer2, Injector, ViewChild, ElementRef } from '@angular/core';
import { LocaleService } from '@farris/ui-locale';
var PanelInputComponent = /** @class */ (function () {
    function PanelInputComponent(renderer, injector) {
        this.renderer = renderer;
        this.injector = injector;
        this.localStorageKey = 'farrisSearchRecord';
        this.searchHandle = new EventEmitter();
        this.submitChange = new EventEmitter();
        this.placeholder = '';
        this.searchTags = [];
        this.searchItems = [];
        this.searchFocus = false;
        this.historyText = '历史搜索';
        this.resultText = '查询结果';
        this.resultTitle = '历史搜索';
        this.localeService = this.injector.get(LocaleService);
    }
    Object.defineProperty(PanelInputComponent.prototype, "item", {
        get: /**
         * @return {?}
         */
        function () {
            return this._item;
        },
        set: /**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            var _this = this;
            this._item = data;
            if (this._item) {
                if (!this._item.hasOwnProperty('value')) {
                    //this._item.value.value = undefined;
                    this._item.value = { value: '' };
                }
                if (this._item.placeHolder) {
                    this.placeholder = this._item.placeHolder || '';
                }
                this.inputValue = this._item.value.value;
                setTimeout((/**
                 * @return {?}
                 */
                function () {
                    /** @type {?} */
                    var filterPanelArray = JSON.parse(localStorage.getItem(_this.localStorageKey));
                    if (Array.isArray(filterPanelArray)) {
                        filterPanelArray = null;
                    }
                    if (filterPanelArray && filterPanelArray[_this._item.labelCode]) {
                        _this.searchTags = filterPanelArray[_this._item.labelCode];
                        _this.searchItems = filterPanelArray[_this._item.labelCode];
                    }
                }), 0);
            }
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    PanelInputComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var self = this;
        this.renderer.listen(document, 'click', (/**
         * @param {?} event
         * @return {?}
         */
        function (event) {
            if (!event.target.closest('.f-filter-search-result-panel') && !event.target.closest('.filter-type-input .form-control')) {
                self.searchFocus = false;
            }
        }));
        this.historyText = this.localeService.getValue('filterPanel.searchHistory');
        this.resultText = this.localeService.getValue('filterPanel.searchResult');
        this.resultTitle = this.historyText;
        this.setSubmitChange();
        this.inputText.nativeElement.focus();
    };
    /**
     * 绑定点击回车触发查询
     * @param e
     */
    /**
     * 绑定点击回车触发查询
     * @param {?} e
     * @return {?}
     */
    PanelInputComponent.prototype.inputKeyEnter = /**
     * 绑定点击回车触发查询
     * @param {?} e
     * @return {?}
     */
    function (e) {
        this._item.value.value = this.inputValue;
        this._item.valueText = this._item.value.value;
        this.setSubmitChange();
        this.searchHandle.emit({ value: this._item.value.value, type: 'enter' });
    };
    /**
     * @param {?} e
     * @return {?}
     */
    PanelInputComponent.prototype.inputChanged = /**
     * @param {?} e
     * @return {?}
     */
    function (e) {
        this._item.value.value = this.inputValue;
        this._item.valueText = this._item.value.value;
        this.setSubmitChange();
        this.searchHandle.emit(this._item.value.value);
    };
    /**
     * @param {?} e
     * @return {?}
     */
    PanelInputComponent.prototype.inputValueChange = /**
     * @param {?} e
     * @return {?}
     */
    function (e) {
        this.searchItems = this.searchTags;
        this.resultTitle = this.historyText;
        this._item.value.value = this.inputValue;
        this._item.valueText = this._item.value.value;
        this.setSubmitChange();
        if (this.inputValue && this.searchItems.length) {
            /** @type {?} */
            var arr = this.fuzzyQuery(this.searchItems, this.inputValue);
            if (arr.length) {
                this.searchItems = arr;
                this.resultTitle = this.resultText;
            }
            else {
                this.searchItems = this.searchTags;
                this.resultTitle = this.historyText;
            }
        }
    };
    /**
     * @private
     * @param {?} list
     * @param {?} keyWord
     * @return {?}
     */
    PanelInputComponent.prototype.fuzzyQuery = /**
     * @private
     * @param {?} list
     * @param {?} keyWord
     * @return {?}
     */
    function (list, keyWord) {
        // if (keyWord) {
        //     keyWord = keyWord.replace(/\\/g, '\\');
        // }
        // if (keyWord) {
        //     keyWord = keyWord.replace(/\\/g, '\\');
        // }
        // var reg = new RegExp(keyWord + '/');
        /** @type {?} */
        var arr = [];
        for (var i = 0; i < list.length; i++) {
            if (!arr.find((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n === keyWord; }))) {
                arr.push(list[i]);
            }
        }
        return arr;
    };
    /**
     * @param {?} e
     * @return {?}
     */
    PanelInputComponent.prototype.inputFocus = /**
     * @param {?} e
     * @return {?}
     */
    function (e) {
        this.searchFocus = true;
        this.inputValueChange(e);
    };
    /**
     * @param {?} tag
     * @param {?} event
     * @return {?}
     */
    PanelInputComponent.prototype.clickTag = /**
     * @param {?} tag
     * @param {?} event
     * @return {?}
     */
    function (tag, event) {
        event.stopPropagation();
        if (this.inputValue !== tag) {
            this.inputValue = tag;
            this._item.value.value = this.inputValue;
            this._item.valueText = this._item.value.value;
            this.setSubmitChange();
            this.searchHandle.emit({ value: this._item.value.value, type: 'enter' });
        }
    };
    /**
     * @param {?} tag
     * @param {?} index
     * @param {?} event
     * @return {?}
     */
    PanelInputComponent.prototype.removeTag = /**
     * @param {?} tag
     * @param {?} index
     * @param {?} event
     * @return {?}
     */
    function (tag, index, event) {
        event.stopPropagation();
        if (this.searchTags && this.searchTags.length) {
            this.searchTags.splice(index, 1);
        }
        this.searchItems = this.searchTags;
        /** @type {?} */
        var filterPanelArray = JSON.parse(localStorage.getItem(this.localStorageKey));
        if (Array.isArray(filterPanelArray)) {
            filterPanelArray = null;
        }
        if (filterPanelArray && filterPanelArray[this._item.labelCode]) {
            if (this.searchTags.length) {
                filterPanelArray[this._item.labelCode] = this.searchTags;
            }
            else {
                delete filterPanelArray[this._item.labelCode];
            }
        }
        localStorage.setItem(this.localStorageKey, JSON.stringify(filterPanelArray));
    };
    /**
     * @param {?} item
     * @param {?} event
     * @return {?}
     */
    PanelInputComponent.prototype.clickSearchItem = /**
     * @param {?} item
     * @param {?} event
     * @return {?}
     */
    function (item, event) {
        this.clickTag(item, event);
        this.searchFocus = false;
    };
    /**
     * @return {?}
     */
    PanelInputComponent.prototype.setSubmitChange = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var val = this._item.value;
        if (Object.keys(val).length < 0 || !val.value) {
            this.submitChange.emit(false);
        }
        else {
            this.submitChange.emit(true);
        }
    };
    /**
     * @return {?}
     */
    PanelInputComponent.prototype.showSearchTags = /**
     * @return {?}
     */
    function () {
        if (this.searchTags && this.searchTags.length > 0) {
            if (this.searchTags.length == 1 && this.searchTags[0].length == 0) {
                return false;
            }
            return true;
        }
        return false;
    };
    PanelInputComponent.decorators = [
        { type: Component, args: [{
                    selector: 'panel-filter-input',
                    template: "<input class=\"form-control\" type=\"text\" [(ngModel)]=\"inputValue\" [placeholder]=\"placeholder\"\r\n    (keyup.enter)=\"inputKeyEnter($event)\" (keyup)=\"inputValueChange($event)\" (blur)=\"inputChanged($event)\"\r\n    (focus)=\"inputFocus($event)\" #inputText>\r\n\r\n<!-- <div class=\"f-filter-search-result-panel\" [hidden]=\"!(searchItems && searchItems.length && searchFocus)\">\r\n    <div class=\"search-result-title\">{{ resultTitle }}</div>\r\n    <div class=\"search-result-list\">\r\n        <div class=\"search-result-item\" \r\n        *ngFor=\"let item of searchItems;\" \r\n        (click)=\"clickSearchItem(item,$event)\"\r\n        [innerHTML]=\"item | filterHighlightSearchResult:inputValue | filterSafe: 'html'\"\r\n        [title]=\"item\"\r\n        ></div>\r\n    </div>\r\n</div> -->\r\n\r\n<div class=\"f-filter-panel-search-tags\" *ngIf=\"showSearchTags()\">\r\n    <ng-container *ngFor=\"let tag of searchTags;let i = index;\">\r\n        <div class=\"panel-search-tag\" *ngIf=\"tag.length>0\">\r\n            <span class=\"panel-search-tag-text\" (click)=\"clickTag(tag,$event)\" [title]=\"tag\">{{tag}}</span>\r\n            <span class=\"panel-search-tag-remove f-icon modal_close\" (click)=\"removeTag(tag,i,$event)\"></span>\r\n        </div>\r\n    </ng-container>\r\n</div>"
                }] }
    ];
    /** @nocollapse */
    PanelInputComponent.ctorParameters = function () { return [
        { type: Renderer2 },
        { type: Injector }
    ]; };
    PanelInputComponent.propDecorators = {
        item: [{ type: Input }],
        localStorageKey: [{ type: Input }],
        searchHandle: [{ type: Output }],
        submitChange: [{ type: Output }],
        inputText: [{ type: ViewChild, args: ['inputText',] }]
    };
    return PanelInputComponent;
}());
export { PanelInputComponent };
if (false) {
    /** @type {?} */
    PanelInputComponent.prototype._item;
    /** @type {?} */
    PanelInputComponent.prototype.localStorageKey;
    /** @type {?} */
    PanelInputComponent.prototype.searchHandle;
    /** @type {?} */
    PanelInputComponent.prototype.submitChange;
    /** @type {?} */
    PanelInputComponent.prototype.inputText;
    /** @type {?} */
    PanelInputComponent.prototype.placeholder;
    /** @type {?} */
    PanelInputComponent.prototype.inputValue;
    /** @type {?} */
    PanelInputComponent.prototype.searchTags;
    /** @type {?} */
    PanelInputComponent.prototype.searchItems;
    /** @type {?} */
    PanelInputComponent.prototype.searchFocus;
    /** @type {?} */
    PanelInputComponent.prototype.localeService;
    /** @type {?} */
    PanelInputComponent.prototype.historyText;
    /** @type {?} */
    PanelInputComponent.prototype.resultText;
    /** @type {?} */
    PanelInputComponent.prototype.resultTitle;
    /**
     * @type {?}
     * @private
     */
    PanelInputComponent.prototype.renderer;
    /**
     * @type {?}
     * @private
     */
    PanelInputComponent.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5wdXQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1maWx0ZXItcGFuZWwvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9pbnB1dGNvbXBvbmVudC9pbnB1dC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFVLFlBQVksRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLFFBQVEsRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNILE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUVsRDtJQWdESSw2QkFDWSxRQUFtQixFQUNuQixRQUFrQjtRQURsQixhQUFRLEdBQVIsUUFBUSxDQUFXO1FBQ25CLGFBQVEsR0FBUixRQUFRLENBQVU7UUFmckIsb0JBQWUsR0FBRyxvQkFBb0IsQ0FBQztRQUN0QyxpQkFBWSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFDbEMsaUJBQVksR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBRTVDLGdCQUFXLEdBQUcsRUFBRSxDQUFDO1FBRWpCLGVBQVUsR0FBRyxFQUFFLENBQUM7UUFDaEIsZ0JBQVcsR0FBRyxFQUFFLENBQUM7UUFDakIsZ0JBQVcsR0FBRyxLQUFLLENBQUM7UUFFcEIsZ0JBQVcsR0FBRyxNQUFNLENBQUM7UUFDckIsZUFBVSxHQUFHLE1BQU0sQ0FBQztRQUNwQixnQkFBVyxHQUFHLE1BQU0sQ0FBQztRQUlqQixJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQyxDQUFDO0lBQzFELENBQUM7SUE3Q0Qsc0JBQ0kscUNBQUk7Ozs7UUFEUjtZQUVBLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQztRQUNsQixDQUFDOzs7OztRQUNELFVBQVMsSUFBSTtZQUFiLGlCQXNCQztZQXJCRyxJQUFJLENB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QWlMQztTQTVLWSxtQkFBbUI7OztJQUM1QixvQ0FBVzs7SUE2QlgsOENBQWdEOztJQUNoRCwyQ0FBNEM7O0lBQzVDLDJDQUE0Qzs7SUFDNUMsd0NBQThDOztJQUM5QywwQ0FBaUI7O0lBQ2pCLHlDQUFtQjs7SUFDbkIseUNBQWdCOztJQUNoQiwwQ0FBaUI7O0lBQ2pCLDBDQUFvQjs7SUFDcEIsNENBQTZCOztJQUM3QiwwQ0FBcUI7O0lBQ3JCLHlDQUFvQjs7SUFDcEIsMENBQXFCOzs7OztJQUVqQix1Q0FBMkI7Ozs7O0lBQzNCLHVDQUEwQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQsIE9uSW5pdCwgRXZlbnRFbWl0dGVyLCBPdXRwdXQsIFJlbmRlcmVyMiwgSW5qZWN0b3IsIFZpZXdDaGlsZCwgRWxlbWVudFJlZiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBMb2NhbGVTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1sb2NhbGUnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ3BhbmVsLWZpbHRlci1pbnB1dCcsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vaW5wdXQuY29tcG9uZW50Lmh0bWwnXHJcbn0pXHJcblxyXG5leHBvcnQgY2xhc3MgUGFuZWxJbnB1dENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XHJcbiAgICBfaXRlbTogYW55O1xyXG4gICAgQElucHV0KClcclxuICAgIGdldCBpdGVtKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX2l0ZW07XHJcbiAgICB9XHJcbiAgICBzZXQgaXRlbShkYXRhKSB7XHJcbiAgICAgICAgdGhpcy5faXRlbSA9IGRhdGE7XHJcbiAgICAgICAgaWYgKHRoaXMuX2l0ZW0pIHtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLl9pdGVtLmhhc093blByb3BlcnR5KCd2YWx1ZScpKSB7XHJcbiAgICAgICAgICAgICAgICAvL3RoaXMuX2l0ZW0udmFsdWUudmFsdWUgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9pdGVtLnZhbHVlID0geyB2YWx1ZTogJycgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLl9pdGVtLnBsYWNlSG9sZGVyKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnBsYWNlaG9sZGVyID0gdGhpcy5faXRlbS5wbGFjZUhvbGRlciB8fCAnJztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmlucHV0VmFsdWUgPSB0aGlzLl9pdGVtLnZhbHVlLnZhbHVlO1xyXG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgIGxldCBmaWx0ZXJQYW5lbEFycmF5ID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSh0aGlzLmxvY2FsU3RvcmFnZUtleSkpO1xyXG4gICAgICAgICAgICAgICAgaWYoQXJyYXkuaXNBcnJheShmaWx0ZXJQYW5lbEFycmF5KSl7XHJcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyUGFuZWxBcnJheSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoZmlsdGVyUGFuZWxBcnJheSAmJiBmaWx0ZXJQYW5lbEFycmF5W3RoaXMuX2l0ZW0ubGFiZWxDb2RlXSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VhcmNoVGFncyA9IGZpbHRlclBhbmVsQXJyYXlbdGhpcy5faXRlbS5sYWJlbENvZGVdO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VhcmNoSXRlbXMgPSBmaWx0ZXJQYW5lbEFycmF5W3RoaXMuX2l0ZW0ubGFiZWxDb2RlXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgMCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIEBJbnB1dCgpIGxvY2FsU3RvcmFnZUtleSA9ICdmYXJyaXNTZWFyY2hSZWNvcmQnO1xyXG4gICAgQE91dHB1dCgpIHNlYXJjaEhhbmRsZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIEBPdXRwdXQoKSBzdWJtaXRDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgICBAVmlld0NoaWxkKCdpbnB1dFRleHQnKSBpbnB1dFRleHQ6IEVsZW1lbnRSZWY7XHJcbiAgICBwbGFjZWhvbGRlciA9ICcnO1xyXG4gICAgaW5wdXRWYWx1ZTogc3RyaW5nO1xyXG4gICAgc2VhcmNoVGFncyA9IFtdO1xyXG4gICAgc2VhcmNoSXRlbXMgPSBbXTtcclxuICAgIHNlYXJjaEZvY3VzID0gZmFsc2U7XHJcbiAgICBsb2NhbGVTZXJ2aWNlOiBMb2NhbGVTZXJ2aWNlO1xyXG4gICAgaGlzdG9yeVRleHQgPSAn5Y6G5Y+y5pCc57SiJztcclxuICAgIHJlc3VsdFRleHQgPSAn5p+l6K+i57uT5p6cJztcclxuICAgIHJlc3VsdFRpdGxlID0gJ+WOhuWPsuaQnOe0oic7XHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwcml2YXRlIHJlbmRlcmVyOiBSZW5kZXJlcjIsXHJcbiAgICAgICAgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IpIHtcclxuICAgICAgICB0aGlzLmxvY2FsZVNlcnZpY2UgPSB0aGlzLmluamVjdG9yLmdldChMb2NhbGVTZXJ2aWNlKTtcclxuICAgIH1cclxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIHRoaXMucmVuZGVyZXIubGlzdGVuKGRvY3VtZW50LCAnY2xpY2snLCAoZXZlbnQpID0+IHtcclxuICAgICAgICAgICAgaWYgKCFldmVudC50YXJnZXQuY2xvc2VzdCgnLmYtZmlsdGVyLXNlYXJjaC1yZXN1bHQtcGFuZWwnKSAmJiAhZXZlbnQudGFyZ2V0LmNsb3Nlc3QoJy5maWx0ZXItdHlwZS1pbnB1dCAuZm9ybS1jb250cm9sJykpIHtcclxuICAgICAgICAgICAgICAgIHNlbGYuc2VhcmNoRm9jdXMgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLmhpc3RvcnlUZXh0ID0gdGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKCdmaWx0ZXJQYW5lbC5zZWFyY2hIaXN0b3J5Jyk7XHJcbiAgICAgICAgdGhpcy5yZXN1bHRUZXh0ID0gdGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKCdmaWx0ZXJQYW5lbC5zZWFyY2hSZXN1bHQnKTtcclxuICAgICAgICB0aGlzLnJlc3VsdFRpdGxlID0gdGhpcy5oaXN0b3J5VGV4dDtcclxuICAgICAgICB0aGlzLnNldFN1Ym1pdENoYW5nZSgpO1xyXG4gICAgICAgIHRoaXMuaW5wdXRUZXh0Lm5hdGl2ZUVsZW1lbnQuZm9jdXMoKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog57uR5a6a54K55Ye75Zue6L2m6Kem5Y+R5p+l6K+iXHJcbiAgICAgKiBAcGFyYW0gZSBcclxuICAgICAqL1xyXG4gICAgaW5wdXRLZXlFbnRlcihlKXtcclxuICAgICAgICB0aGlzLl9pdGVtLnZhbHVlLnZhbHVlID0gdGhpcy5pbnB1dFZhbHVlO1xyXG4gICAgICAgIHRoaXMuX2l0ZW0udmFsdWVUZXh0ID0gdGhpcy5faXRlbS52YWx1ZS52YWx1ZTtcclxuICAgICAgICB0aGlzLnNldFN1Ym1pdENoYW5nZSgpO1xyXG4gICAgICAgIHRoaXMuc2VhcmNoSGFuZGxlLmVtaXQoe3ZhbHVlOnRoaXMuX2l0ZW0udmFsdWUudmFsdWUsdHlwZTonZW50ZXInfSk7XHJcbiAgICB9XHJcbiAgICBpbnB1dENoYW5nZWQoZSkge1xyXG4gICAgICAgIHRoaXMuX2l0ZW0udmFsdWUudmFsdWUgPSB0aGlzLmlucHV0VmFsdWU7XHJcbiAgICAgICAgdGhpcy5faXRlbS52YWx1ZVRleHQgPSB0aGlzLl9pdGVtLnZhbHVlLnZhbHVlO1xyXG4gICAgICAgIHRoaXMuc2V0U3VibWl0Q2hhbmdlKCk7XHJcbiAgICAgICAgdGhpcy5zZWFyY2hIYW5kbGUuZW1pdCh0aGlzLl9pdGVtLnZhbHVlLnZhbHVlKTtcclxuICAgIH1cclxuXHJcbiAgICBpbnB1dFZhbHVlQ2hhbmdlKGUpIHtcclxuICAgICAgICB0aGlzLnNlYXJjaEl0ZW1zID0gdGhpcy5zZWFyY2hUYWdzO1xyXG4gICAgICAgIHRoaXMucmVzdWx0VGl0bGUgPSB0aGlzLmhpc3RvcnlUZXh0O1xyXG4gICAgICAgIHRoaXMuX2l0ZW0udmFsdWUudmFsdWUgPSB0aGlzLmlucHV0VmFsdWU7XHJcbiAgICAgICAgdGhpcy5faXRlbS52YWx1ZVRleHQgPSB0aGlzLl9pdGVtLnZhbHVlLnZhbHVlO1xyXG4gICAgICAgIHRoaXMuc2V0U3VibWl0Q2hhbmdlKCk7XHJcbiAgICAgICAgaWYodGhpcy5pbnB1dFZhbHVlICYmIHRoaXMuc2VhcmNoSXRlbXMubGVuZ3RoKXtcclxuICAgICAgICAgICAgbGV0IGFyciA9IHRoaXMuZnV6enlRdWVyeSh0aGlzLnNlYXJjaEl0ZW1zLCB0aGlzLmlucHV0VmFsdWUpO1xyXG4gICAgICAgICAgICBpZiAoYXJyLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWFyY2hJdGVtcyA9IGFycjtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVzdWx0VGl0bGUgPSB0aGlzLnJlc3VsdFRleHQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlYXJjaEl0ZW1zID0gdGhpcy5zZWFyY2hUYWdzO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZXN1bHRUaXRsZSA9IHRoaXMuaGlzdG9yeVRleHQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBmdXp6eVF1ZXJ5KGxpc3QsIGtleVdvcmQpIHtcclxuICAgICAgICAvLyBpZiAoa2V5V29yZCkge1xyXG4gICAgICAgIC8vICAgICBrZXlXb3JkID0ga2V5V29yZC5yZXBsYWNlKC9cXFxcL2csICdcXFxcJyk7XHJcbiAgICAgICAgLy8gfVxyXG5cclxuICAgICAgICAvLyB2YXIgcmVnID0gbmV3IFJlZ0V4cChrZXlXb3JkICsgJy8nKTtcclxuICAgICAgICB2YXIgYXJyID0gW107XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGlmICghYXJyLmZpbmQobiA9PiBuID09PSBrZXlXb3JkKSkge1xyXG4gICAgICAgICAgICAgICAgYXJyLnB1c2gobGlzdFtpXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGFycjtcclxuICAgIH1cclxuXHJcbiAgICBpbnB1dEZvY3VzKGUpIHtcclxuICAgICAgICB0aGlzLnNlYXJjaEZvY3VzID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLmlucHV0VmFsdWVDaGFuZ2UoZSk7XHJcbiAgICB9XHJcblxyXG4gICAgY2xpY2tUYWcodGFnLCBldmVudCkge1xyXG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgIGlmICh0aGlzLmlucHV0VmFsdWUgIT09IHRhZykge1xyXG4gICAgICAgICAgICB0aGlzLmlucHV0VmFsdWUgPSB0YWc7XHJcbiAgICAgICAgICAgIHRoaXMuX2l0ZW0udmFsdWUudmFsdWUgPSB0aGlzLmlucHV0VmFsdWU7XHJcbiAgICAgICAgICAgIHRoaXMuX2l0ZW0udmFsdWVUZXh0ID0gdGhpcy5faXRlbS52YWx1ZS52YWx1ZTtcclxuICAgICAgICAgICAgdGhpcy5zZXRTdWJtaXRDaGFuZ2UoKTtcclxuICAgICAgICAgICAgdGhpcy5zZWFyY2hIYW5kbGUuZW1pdCh7dmFsdWU6dGhpcy5faXRlbS52YWx1ZS52YWx1ZSx0eXBlOidlbnRlcid9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZW1vdmVUYWcodGFnLCBpbmRleCwgZXZlbnQpIHtcclxuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICBpZiAodGhpcy5zZWFyY2hUYWdzICYmIHRoaXMuc2VhcmNoVGFncy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgdGhpcy5zZWFyY2hUYWdzLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuc2VhcmNoSXRlbXMgPSB0aGlzLnNlYXJjaFRhZ3M7XHJcbiAgICAgICAgbGV0IGZpbHRlclBhbmVsQXJyYXkgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKHRoaXMubG9jYWxTdG9yYWdlS2V5KSk7XHJcbiAgICAgICAgaWYoQXJyYXkuaXNBcnJheShmaWx0ZXJQYW5lbEFycmF5KSl7XHJcbiAgICAgICAgICAgIGZpbHRlclBhbmVsQXJyYXkgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZihmaWx0ZXJQYW5lbEFycmF5ICYmIGZpbHRlclBhbmVsQXJyYXlbdGhpcy5faXRlbS5sYWJlbENvZGVdKXtcclxuICAgICAgICAgICAgaWYodGhpcy5zZWFyY2hUYWdzLmxlbmd0aCl7XHJcbiAgICAgICAgICAgICAgICBmaWx0ZXJQYW5lbEFycmF5W3RoaXMuX2l0ZW0ubGFiZWxDb2RlXSA9IHRoaXMuc2VhcmNoVGFncztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNle1xyXG4gICAgICAgICAgICAgICAgZGVsZXRlIGZpbHRlclBhbmVsQXJyYXlbdGhpcy5faXRlbS5sYWJlbENvZGVdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKHRoaXMubG9jYWxTdG9yYWdlS2V5LCBKU09OLnN0cmluZ2lmeShmaWx0ZXJQYW5lbEFycmF5KSk7XHJcbiAgICB9XHJcblxyXG4gICAgY2xpY2tTZWFyY2hJdGVtKGl0ZW0sIGV2ZW50KSB7XHJcbiAgICAgICAgdGhpcy5jbGlja1RhZyhpdGVtLCBldmVudCk7XHJcbiAgICAgICAgdGhpcy5zZWFyY2hGb2N1cyA9IGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIHNldFN1Ym1pdENoYW5nZSgpe1xyXG4gICAgICAgIGNvbnN0IHZhbCA9IHRoaXMuX2l0ZW0udmFsdWU7XHJcbiAgICAgICAgaWYoT2JqZWN0LmtleXModmFsKS5sZW5ndGggPCAwIHx8ICF2YWwudmFsdWUpe1xyXG4gICAgICAgICAgICB0aGlzLnN1Ym1pdENoYW5nZS5lbWl0KGZhbHNlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZXtcclxuICAgICAgICAgICAgdGhpcy5zdWJtaXRDaGFuZ2UuZW1pdCh0cnVlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBzaG93U2VhcmNoVGFncygpe1xyXG4gICAgICAgIGlmKHRoaXMuc2VhcmNoVGFncyYmdGhpcy5zZWFyY2hUYWdzLmxlbmd0aD4wKXtcclxuICAgICAgICAgICAgaWYodGhpcy5zZWFyY2hUYWdzLmxlbmd0aD09MSYmdGhpcy5zZWFyY2hUYWdzWzBdLmxlbmd0aD09MCl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxufVxyXG4iXX0=