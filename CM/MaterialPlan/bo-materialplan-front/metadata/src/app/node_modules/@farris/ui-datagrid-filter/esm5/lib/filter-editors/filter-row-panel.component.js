/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, NgZone, ElementRef, Renderer2, Output, EventEmitter, Injector } from '@angular/core';
import { ColumnFilterType } from '@farris/ui-datagrid';
import { DatagridFilterRowService } from '../datagrid-filter-row.service';
var FilterRowPanelComponent = /** @class */ (function () {
    function FilterRowPanelComponent(ngzone, el, render, dfrs, inject) {
        this.ngzone = ngzone;
        this.el = el;
        this.render = render;
        this.dfrs = dfrs;
        this.inject = inject;
        this.width = 240;
        this.height = 250;
        this.datatype = ColumnFilterType.string;
        this.conditionChange = new EventEmitter();
        this.gridInstance = null;
        this.enumSetting = {};
        this.condition = {
            operator1: 1,
            value1: '',
            relation: '',
            operator2: 1,
            value2: ''
        };
        this.documentClickHandle = null;
        this.ro = null;
        this.zone = null;
        this.zone = this.inject.get(NgZone);
    }
    /**
     * @return {?}
     */
    FilterRowPanelComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.ngzone.runOutsideAngular((/**
         * @return {?}
         */
        function () {
            _this.render.listen(_this.el.nativeElement, 'click', (/**
             * @param {?} e
             * @return {?}
             */
            function (e) {
                e.stopPropagation();
                return false;
            }));
        }));
        this.initEnumSetting();
        this.documentClickHandle = this.render.listen(document, 'click', (/**
         * @param {?} event
         * @return {?}
         */
        function (event) {
            _this.close(event);
        }));
    };
    /**
     * @return {?}
     */
    FilterRowPanelComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        if (this.target) {
            // const panelDiv = this.el.nativeElement.querySelector('div');
            // const panelRect = panelDiv.getBoundingClientRect();
            // const h = panelRect.height;
            // const rect = this.target.target.getBoundingClientRect();
            // if (window['innerHeight'] - panelRect.top < h) {
            //     let top = 0;
            //     if (rect.top > h) {
            //         top = rect.top - h - 14;
            //     } else {
            //         top = 32;
            //     }
            //     panelDiv.style.top = top + 'px';
            // }
            this.resetPanelPosition();
            /** @type {?} */
            var panelDiv = this.el.nativeElement.querySelector('div');
            panelDiv.style.transition = 'top 0.2s ease 0.05s';
        }
    };
    /**
     * @return {?}
     */
    FilterRowPanelComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        if (this.documentClickHandle) {
            this.documentClickHandle();
            this.documentClickHandle = null;
        }
    };
    /**
     * @private
     * @return {?}
     */
    FilterRowPanelComponent.prototype.resetPanelPosition = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var panelDiv = this.el.nativeElement.querySelector('div');
        /** @type {?} */
        var h = panelDiv.querySelector('.panel-content').clientHeight + 36;
        /** @type {?} */
        var rect = this.target.target.parentElement.getBoundingClientRect();
        /** @type {?} */
        var downAreaHeight = window['innerHeight'] - rect.top;
        if (downAreaHeight < h) {
            /** @type {?} */
            var top_1 = window['innerHeight'] - h - 10;
            panelDiv.style.top = top_1 + 'px';
        }
        else {
            panelDiv.style.top = rect.top + 'px';
        }
    };
    /**
     * @return {?}
     */
    FilterRowPanelComponent.prototype.onPanelHeightChanged = /**
     * @return {?}
     */
    function () {
        this.resetPanelPosition();
    };
    /**
     * @param {?} event
     * @return {?}
     */
    FilterRowPanelComponent.prototype.close = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        event.stopPropagation();
        this.dfrs.closeFilterPanel();
    };
    /**
     * @param {?} condition
     * @return {?}
     */
    FilterRowPanelComponent.prototype.onValueChange = /**
     * @param {?} condition
     * @return {?}
     */
    function (condition) {
        this.conditionChange.emit(condition);
    };
    /**
     * @private
     * @return {?}
     */
    FilterRowPanelComponent.prototype.initEnumSetting = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.datatype > 5) {
            this.enumSetting = this.dfrs.getEnumOptions(this.column);
            /** @type {?} */
            var currentColumnCondition = (/** @type {?} */ (this.dfrs.columnConditions[this.column.field]));
            if (currentColumnCondition && currentColumnCondition.value1) {
                this.selectedValues = currentColumnCondition.value1.join(',');
            }
        }
    };
    FilterRowPanelComponent.decorators = [
        { type: Component, args: [{
                    selector: 'filter-row-panel',
                    template: "<div class=\"f-datagrid-filter-panel d-flex flex-column\" [style.width.px]=\"width\" style=\"z-index: 6666;\">\r\n    <div class=\"panel-header\">\r\n        <div (click)=\"close($event)\" class=\"panel-icon\" style=\"text-align: center; cursor: pointer;\">\r\n            <span class=\"f-icon f-icon-filter-sm\"></span>\r\n        </div> \r\n    </div>\r\n    <div class=\"panel-content flex-fill\">\r\n        <condition-editor *ngIf=\"datatype < 6\"\r\n            [datatype]=\"datatype\"\r\n            [condition]=\"condition\"\r\n            [operators]=\"operators\"\r\n            [filterOptions]=\"column.filter.options\"\r\n            (conditionChange)=\"onValueChange($event)\"\r\n            (panelHeightChange)=\"onPanelHeightChanged()\"></condition-editor>\r\n            \r\n\r\n        <filter-datalist *ngIf=\"datatype === 6 || datatype === 7\" \r\n            [data]=\"enumSetting?.data\" [valueField]=\"enumSetting?.valueField\"\r\n            [textField]=\"enumSetting?.textField\" [idField]=\"enumSetting?.valueField\"\r\n            [selectedValues]=\"selectedValues\"\r\n            (valueChange)=\"onValueChange($event)\"></filter-datalist>\r\n    </div>\r\n</div>\r\n\r\n<div class=\"filter-panel-overlay\" style=\"position: absolute;\r\nposition: absolute;\r\nz-index: 4444;\r\nwidth: 100%;\r\ntop: 0;\r\nheight: 100%;\r\nbackground: rgb(255, 255, 255);\r\nopacity: 0;\" (click)=\"close($event)\"></div>\r\n"
                }] }
    ];
    /** @nocollapse */
    FilterRowPanelComponent.ctorParameters = function () { return [
        { type: NgZone },
        { type: ElementRef },
        { type: Renderer2 },
        { type: DatagridFilterRowService },
        { type: Injector }
    ]; };
    FilterRowPanelComponent.propDecorators = {
        width: [{ type: Input }],
        height: [{ type: Input }],
        column: [{ type: Input }],
        operators: [{ type: Input }],
        datatype: [{ type: Input }],
        conditionChange: [{ type: Output }]
    };
    return FilterRowPanelComponent;
}());
export { FilterRowPanelComponent };
if (false) {
    /** @type {?} */
    FilterRowPanelComponent.prototype.width;
    /** @type {?} */
    FilterRowPanelComponent.prototype.height;
    /** @type {?} */
    FilterRowPanelComponent.prototype.column;
    /** @type {?} */
    FilterRowPanelComponent.prototype.operators;
    /** @type {?} */
    FilterRowPanelComponent.prototype.datatype;
    /** @type {?} */
    FilterRowPanelComponent.prototype.conditionChange;
    /** @type {?} */
    FilterRowPanelComponent.prototype.gridInstance;
    /** @type {?} */
    FilterRowPanelComponent.prototype.enumSetting;
    /** @type {?} */
    FilterRowPanelComponent.prototype.selectedValues;
    /** @type {?} */
    FilterRowPanelComponent.prototype.condition;
    /** @type {?} */
    FilterRowPanelComponent.prototype.documentClickHandle;
    /** @type {?} */
    FilterRowPanelComponent.prototype.target;
    /**
     * @type {?}
     * @private
     */
    FilterRowPanelComponent.prototype.ro;
    /**
     * @type {?}
     * @private
     */
    FilterRowPanelComponent.prototype.zone;
    /**
     * @type {?}
     * @private
     */
    FilterRowPanelComponent.prototype.ngzone;
    /**
     * @type {?}
     * @private
     */
    FilterRowPanelComponent.prototype.el;
    /**
     * @type {?}
     * @private
     */
    FilterRowPanelComponent.prototype.render;
    /** @type {?} */
    FilterRowPanelComponent.prototype.dfrs;
    /**
     * @type {?}
     * @private
     */
    FilterRowPanelComponent.prototype.inject;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsdGVyLXJvdy1wYW5lbC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWRhdGFncmlkLWZpbHRlci8iLCJzb3VyY2VzIjpbImxpYi9maWx0ZXItZWRpdG9ycy9maWx0ZXItcm93LXBhbmVsLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFVLFVBQVUsRUFDekMsU0FBUyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsUUFBUSxFQUE0QixNQUFNLGVBQWUsQ0FBQztBQUV2RyxPQUFPLEVBQWMsZ0JBQWdCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUVuRSxPQUFPLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUcxRTtJQWtDSSxpQ0FDWSxNQUFjLEVBQVUsRUFBYyxFQUN0QyxNQUFpQixFQUFTLElBQThCLEVBQ3hELE1BQWdCO1FBRmhCLFdBQU0sR0FBTixNQUFNLENBQVE7UUFBVSxPQUFFLEdBQUYsRUFBRSxDQUFZO1FBQ3RDLFdBQU0sR0FBTixNQUFNLENBQVc7UUFBUyxTQUFJLEdBQUosSUFBSSxDQUEwQjtRQUN4RCxXQUFNLEdBQU4sTUFBTSxDQUFVO1FBaENuQixVQUFLLEdBQUcsR0FBRyxDQUFDO1FBQ1osV0FBTSxHQUFHLEdBQUcsQ0FBQztRQUtiLGFBQVEsR0FBRyxnQkFBZ0IsQ0FBQyxNQUFNLENBQUM7UUFFbEMsb0JBQWUsR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBRS9DLGlCQUFZLEdBQUcsSUFBSSxDQUFDO1FBQ3BCLGdCQUFXLEdBQXNCLEVBQUUsQ0FBQztRQUdwQyxjQUFTLEdBQW9CO1lBQ3pCLFNBQVMsRUFBRSxDQUFDO1lBQ1osTUFBTSxFQUFFLEVBQUU7WUFDVixRQUFRLEVBQUUsRUFBRTtZQUNaLFNBQVMsRUFBRSxDQUFDO1lBQ1osTUFBTSxFQUFFLEVBQUU7U0FDYixDQUFDO1FB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LHlDQUFZOzs7OztJQUVaLHFDQUF5Qzs7Ozs7SUFDekMsdUNBQTRCOzs7OztJQUd4Qix5Q0FBc0I7Ozs7O0lBQUUscUNBQXNCOzs7OztJQUM5Qyx5Q0FBeUI7O0lBQUUsdUNBQXFDOzs7OztJQUNoRSx5Q0FBd0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBOZ1pvbmUsIE9uSW5pdCwgRWxlbWVudFJlZixcclxuICAgICAgICAgICAgUmVuZGVyZXIyLCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgSW5qZWN0b3IsIEFmdGVyVmlld0luaXQsIE9uRGVzdHJveSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgUmVzaXplT2JzZXJ2ZXIgZnJvbSAncmVzaXplLW9ic2VydmVyLXBvbHlmaWxsJztcclxuaW1wb3J0IHsgRGF0YUNvbHVtbiwgQ29sdW1uRmlsdGVyVHlwZSB9IGZyb20gJ0BmYXJyaXMvdWktZGF0YWdyaWQnO1xyXG5cclxuaW1wb3J0IHsgRGF0YWdyaWRGaWx0ZXJSb3dTZXJ2aWNlIH0gZnJvbSAnLi4vZGF0YWdyaWQtZmlsdGVyLXJvdy5zZXJ2aWNlJztcclxuaW1wb3J0IHsgRmlsdGVyRW51bVNldHRpbmcsIEZpbHRlckNvbmRpdGlvbiwgRmlsdGVyUm93T3BlcmF0b3IgfSBmcm9tICcuLi9vcGVyYXRpb25zL29wZXJhdG9ycyc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAnZmlsdGVyLXJvdy1wYW5lbCcsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vZmlsdGVyLXJvdy1wYW5lbC5jb21wb2VudC5odG1sJ1xyXG59KVxyXG5leHBvcnQgY2xhc3MgRmlsdGVyUm93UGFuZWxDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIEFmdGVyVmlld0luaXQsIE9uRGVzdHJveSB7XHJcbiAgICBASW5wdXQoKSB3aWR0aCA9IDI0MDtcclxuICAgIEBJbnB1dCgpIGhlaWdodCA9IDI1MDtcclxuXHJcbiAgICBASW5wdXQoKSBjb2x1bW46IERhdGFDb2x1bW47XHJcbiAgICBASW5wdXQoKSBvcGVyYXRvcnM6IEZpbHRlclJvd09wZXJhdG9yW107XHJcblxyXG4gICAgQElucHV0KCkgZGF0YXR5cGUgPSBDb2x1bW5GaWx0ZXJUeXBlLnN0cmluZztcclxuXHJcbiAgICBAT3V0cHV0KCkgY29uZGl0aW9uQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG5cclxuICAgIGdyaWRJbnN0YW5jZSA9IG51bGw7XHJcbiAgICBlbnVtU2V0dGluZzogRmlsdGVyRW51bVNldHRpbmcgPSB7fTtcclxuICAgIHNlbGVjdGVkVmFsdWVzOiBzdHJpbmc7XHJcblxyXG4gICAgY29uZGl0aW9uOiBGaWx0ZXJDb25kaXRpb24gPSB7XHJcbiAgICAgICAgb3BlcmF0b3IxOiAxLFxyXG4gICAgICAgIHZhbHVlMTogJycsXHJcbiAgICAgICAgcmVsYXRpb246ICcnLFxyXG4gICAgICAgIG9wZXJhdG9yMjogMSxcclxuICAgICAgICB2YWx1ZTI6ICcnXHJcbiAgICB9O1xyXG5cclxuICAgIGRvY3VtZW50Q2xpY2tIYW5kbGUgPSBudWxsO1xyXG5cclxuICAgIHRhcmdldDogYW55O1xyXG5cclxuICAgIHByaXZhdGUgcm86IFJlc2l6ZU9ic2VydmVyIHwgbnVsbCA9IG51bGw7XHJcbiAgICBwcml2YXRlIHpvbmU6IE5nWm9uZSA9IG51bGw7XHJcblxyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgcHJpdmF0ZSBuZ3pvbmU6IE5nWm9uZSwgcHJpdmF0ZSBlbDogRWxlbWVudFJlZixcclxuICAgICAgICBwcml2YXRlIHJlbmRlcjogUmVuZGVyZXIyLCBwdWJsaWMgZGZyczogRGF0YWdyaWRGaWx0ZXJSb3dTZXJ2aWNlLFxyXG4gICAgICAgIHByaXZhdGUgaW5qZWN0OiBJbmplY3Rvcikge1xyXG4gICAgICAgIHRoaXMuem9uZSA9IHRoaXMuaW5qZWN0LmdldChOZ1pvbmUpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCkge1xyXG4gICAgICAgIHRoaXMubmd6b25lLnJ1bk91dHNpZGVBbmd1bGFyKCAoKSA9PiAge1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlci5saXN0ZW4odGhpcy5lbC5uYXRpdmVFbGVtZW50LCAnY2xpY2snLCAgKGU6IE1vdXNlRXZlbnQpID0+IHtcclxuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLmluaXRFbnVtU2V0dGluZygpO1xyXG5cclxuICAgICAgICB0aGlzLmRvY3VtZW50Q2xpY2tIYW5kbGUgPSB0aGlzLnJlbmRlci5saXN0ZW4oZG9jdW1lbnQsICdjbGljaycsIChldmVudCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmNsb3NlKGV2ZW50KTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgbmdBZnRlclZpZXdJbml0KCkge1xyXG4gICAgICAgIGlmICh0aGlzLnRhcmdldCkge1xyXG4gICAgICAgICAgICAvLyBjb25zdCBwYW5lbERpdiA9IHRoaXMuZWwubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCdkaXYnKTtcclxuICAgICAgICAgICAgLy8gY29uc3QgcGFuZWxSZWN0ID0gcGFuZWxEaXYuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcbiAgICAgICAgICAgIC8vIGNvbnN0IGggPSBwYW5lbFJlY3QuaGVpZ2h0O1xyXG4gICAgICAgICAgICAvLyBjb25zdCByZWN0ID0gdGhpcy50YXJnZXQudGFyZ2V0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gICAgICAgICAgICAvLyBpZiAod2luZG93Wydpbm5lckhlaWdodCddIC0gcGFuZWxSZWN0LnRvcCA8IGgpIHtcclxuICAgICAgICAgICAgLy8gICAgIGxldCB0b3AgPSAwO1xyXG4gICAgICAgICAgICAvLyAgICAgaWYgKHJlY3QudG9wID4gaCkge1xyXG4gICAgICAgICAgICAvLyAgICAgICAgIHRvcCA9IHJlY3QudG9wIC0gaCAtIDE0O1xyXG4gICAgICAgICAgICAvLyAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8gICAgICAgICB0b3AgPSAzMjtcclxuICAgICAgICAgICAgLy8gICAgIH1cclxuICAgICAgICAgICAgLy8gICAgIHBhbmVsRGl2LnN0eWxlLnRvcCA9IHRvcCArICdweCc7XHJcbiAgICAgICAgICAgIC8vIH1cclxuICAgICAgICAgICAgdGhpcy5yZXNldFBhbmVsUG9zaXRpb24oKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHBhbmVsRGl2ID0gdGhpcy5lbC5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ2RpdicpO1xyXG4gICAgICAgICAgICBwYW5lbERpdi5zdHlsZS50cmFuc2l0aW9uID0gICd0b3AgMC4ycyBlYXNlIDAuMDVzJztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkRlc3Ryb3koKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZG9jdW1lbnRDbGlja0hhbmRsZSkge1xyXG4gICAgICAgICAgICB0aGlzLmRvY3VtZW50Q2xpY2tIYW5kbGUoKTtcclxuICAgICAgICAgICAgdGhpcy5kb2N1bWVudENsaWNrSGFuZGxlID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSByZXNldFBhbmVsUG9zaXRpb24oKSB7XHJcbiAgICAgICAgY29uc3QgcGFuZWxEaXYgPSB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcignZGl2Jyk7XHJcbiAgICAgICAgY29uc3QgaCA9IHBhbmVsRGl2LnF1ZXJ5U2VsZWN0b3IoJy5wYW5lbC1jb250ZW50JykuY2xpZW50SGVpZ2h0ICsgMzY7XHJcbiAgICAgICAgY29uc3QgcmVjdCA9IHRoaXMudGFyZ2V0LnRhcmdldC5wYXJlbnRFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG5cclxuICAgICAgICBjb25zdCBkb3duQXJlYUhlaWdodCA9IHdpbmRvd1snaW5uZXJIZWlnaHQnXSAtIHJlY3QudG9wO1xyXG5cclxuICAgICAgICBpZiAoZG93bkFyZWFIZWlnaHQgPCBoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRvcCA9IHdpbmRvd1snaW5uZXJIZWlnaHQnXSAtIGggLSAxMDtcclxuICAgICAgICAgICAgcGFuZWxEaXYuc3R5bGUudG9wID0gdG9wICsgJ3B4JztcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBwYW5lbERpdi5zdHlsZS50b3AgPSByZWN0LnRvcCArICdweCc7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9uUGFuZWxIZWlnaHRDaGFuZ2VkKCkge1xyXG4gICAgICAgIHRoaXMucmVzZXRQYW5lbFBvc2l0aW9uKCk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGNsb3NlKGV2ZW50OiBNb3VzZUV2ZW50KSB7XHJcbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgdGhpcy5kZnJzLmNsb3NlRmlsdGVyUGFuZWwoKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgb25WYWx1ZUNoYW5nZShjb25kaXRpb24pIHtcclxuICAgICAgICB0aGlzLmNvbmRpdGlvbkNoYW5nZS5lbWl0KGNvbmRpdGlvbik7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBpbml0RW51bVNldHRpbmcoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZGF0YXR5cGUgPiA1KSB7XHJcbiAgICAgICAgICAgIHRoaXMuZW51bVNldHRpbmcgPSB0aGlzLmRmcnMuZ2V0RW51bU9wdGlvbnModGhpcy5jb2x1bW4pO1xyXG4gICAgICAgICAgICBjb25zdCBjdXJyZW50Q29sdW1uQ29uZGl0aW9uID0gdGhpcy5kZnJzLmNvbHVtbkNvbmRpdGlvbnNbdGhpcy5jb2x1bW4uZmllbGRdIGFzIEZpbHRlckNvbmRpdGlvbjtcclxuICAgICAgICAgICAgaWYgKGN1cnJlbnRDb2x1bW5Db25kaXRpb24gJiYgY3VycmVudENvbHVtbkNvbmRpdGlvbi52YWx1ZTEpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRWYWx1ZXMgPSBjdXJyZW50Q29sdW1uQ29uZGl0aW9uLnZhbHVlMS5qb2luKCcsJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIl19