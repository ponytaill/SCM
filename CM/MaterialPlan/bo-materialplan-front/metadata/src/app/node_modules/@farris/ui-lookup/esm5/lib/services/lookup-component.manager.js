/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { of } from 'rxjs';
import { debounceTime, switchMap } from 'rxjs/operators';
import { LookupGridDisplayType } from '../lookup-displaytype';
import { LookupLeftComponent } from '../lookup-left.component';
var LookupComponentManager = /** @class */ (function () {
    function LookupComponentManager(ins) {
        this.ins = ins;
    }
    /**
     * @param {?=} type
     * @return {?}
     */
    LookupComponentManager.prototype.getComponentInstance = /**
     * @param {?=} type
     * @return {?}
     */
    function (type) {
        if (type === void 0) { type = 'datatable'; }
        if (!this.ins.componentRef || !this.ins.componentRef.instance) {
            return null;
        }
        if (type === 'selected') {
            return this.ins.multiSelectDT;
        }
        /** @type {?} */
        var ins = this.ins.componentRef.instance;
        if (type === 'leftDataTable' || type === 'leftTree') {
            /** @type {?} */
            var leftRef = this.ins.leftComponentRef;
            if (!leftRef || !leftRef.instance || !leftRef.instance.cmpRef || !leftRef.instance.cmpRef.instance) {
                return null;
            }
            ins = this.ins.leftComponentRef.instance.cmpRef.instance;
        }
        if (type === 'fav') {
            ins = this.ins.favoritesComponentRef.instance;
        }
        switch (type) {
            case 'leftDataTable':
            case 'fav':
            case 'datatable':
                return (/** @type {?} */ (ins));
            case 'leftTree':
            case 'treetable':
                return (/** @type {?} */ (ins));
            default:
                if (this.ins.isTree()) {
                    return (/** @type {?} */ (ins));
                }
                return (/** @type {?} */ (ins));
        }
    };
    /**
     * @param {?} data
     * @return {?}
     */
    LookupComponentManager.prototype.createComponentWithServerData = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        if (this.ins.componentRef) {
            return;
        }
        this.ins.idField = data.idField || this.ins.idField;
        this.ins.textField = data.textField || this.ins.textField;
        this.ins.valueField = data.valueField || this.ins.valueField;
        this.ins.displayType = (data && data.displayType) || this.ins.displayType || 'LIST';
        /** @type {?} */
        var dtyp = this.ins.displayType.toUpperCase();
        if (this.ins.isDoublleList()) {
            if (this.ins.navTreeToList && dtyp === LookupGridDisplayType.NavTreeList) {
                this.ins.displayType = LookupGridDisplayType.NavList;
            }
            if (this.ins.treeToList) {
                if (dtyp === LookupGridDisplayType.NavListTree) {
                    this.ins.displayType = LookupGridDisplayType.NavList;
                }
            }
        }
        else {
            if (this.ins.treeToList) {
                if (dtyp === LookupGridDisplayType.TreeList) {
                    this.ins.displayType = 'LIST';
                }
                else {
                    if (dtyp === LookupGridDisplayType.NavListTree) {
                        this.ins.displayType = LookupGridDisplayType.NavList;
                    }
                }
            }
        }
        if (this.ins.isDoublleList() && this.ins.navTreeToList) {
            if (dtyp === LookupGridDisplayType.NavTreeList) {
                this.ins.displayType = LookupGridDisplayType.NavList;
            }
        }
        this.ins.changeDetector.detectChanges();
        this.ins.componentRef = this.createContent(this.ins.gridOptions);
        this.createFavoriteComponent();
        this.resizeComponent();
    };
    /**
     * @return {?}
     */
    LookupComponentManager.prototype.createFavoriteComponent = /**
     * @return {?}
     */
    function () {
        if (this.ins.useFavorite && !this.ins.favoritesComponentRef) {
            this.ins.favoriteColumns = this.ins.favHelper.getFavoriteColumns();
            /** @type {?} */
            var favoritesOptions = Object.assign({}, this.ins.gridOptions, {
                showFilterBar: false,
                pagination: false,
                columns: this.ins.favoriteColumns || []
            });
            this.ins.favoritesComponentRef = this.createFavoritesContent(favoritesOptions);
            this.resizeComponent('fav');
        }
    };
    /**
     * @private
     * @param {?} expandLevel
     * @return {?}
     */
    LookupComponentManager.prototype.reloadTreeDataForExpand = /**
     * @private
     * @param {?} expandLevel
     * @return {?}
     */
    function (expandLevel) {
        var _this = this;
        /** @type {?} */
        var uri = this.ins.gridOptions.uri;
        /** @type {?} */
        var tt = (/** @type {?} */ (this.ins.componentRef.instance));
        var _a = tslib_1.__assign({}, tt.searchData), _b = _a.field, field = _b === void 0 ? '*' : _b, _c = _a.value, value = _c === void 0 ? '' : _c;
        /** @type {?} */
        var search = { category: 'all', searchValue: value, searchField: field, layerNum: expandLevel };
        /** @type {?} */
        var param = {
            searchValue: JSON.stringify(search),
            customData: this.ins.customData,
            enableFullTree: this.ins.enableFullTree,
            loadTreeDataType: this.ins.loadTreeDataType
        };
        if (this.ins.helpId) {
            param['helpId'] = this.ins.helpId;
        }
        if (tt && tt.sortName) {
            Object.assign(param, {
                sortName: tt.sortName,
                sortOrder: tt.sortOrder
            });
        }
        this.ins.showLoading();
        return this.ins.http.getData(uri, param).subscribe((/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            _this.ins.closeLoading();
            /** @type {?} */
            var nodes = _this.ins.checkNodeCanBeSelect(data.items, expandLevel === -1);
            _this.ins.items = nodes;
            tt.loadData(nodes);
        }));
    };
    /**
     * @private
     * @param {?} nodes
     * @param {?} level
     * @return {?}
     */
    LookupComponentManager.prototype.setTreeNodeExpandBy = /**
     * @private
     * @param {?} nodes
     * @param {?} level
     * @return {?}
     */
    function (nodes, level) {
        var _this = this;
        if (!nodes || !nodes.length) {
            return;
        }
        nodes.forEach((/**
         * @param {?} n
         * @return {?}
         */
        function (n) {
            /** @type {?} */
            var layer = n.data[_this.ins.treeInfo.dataField].layer;
            /** @type {?} */
            var expandLayer = layer + level - 1;
            n.expanded = layer <= expandLayer ? true : n.expanded;
            if (n.children && n.children.length && layer + 1 <= expandLayer) {
                _this.setTreeNodeExpandBy(n.children, level);
            }
        }));
    };
    // 启用树帮助右键菜单功能
    // 启用树帮助右键菜单功能
    /**
     * @private
     * @param {?} cmpRef
     * @return {?}
     */
    LookupComponentManager.prototype.useContextMenuForTree = 
    // 启用树帮助右键菜单功能
    /**
     * @private
     * @param {?} cmpRef
     * @return {?}
     */
    function (cmpRef) {
        var _this = this;
        var _a = this.ins.treeTableOptions, maxLevel = _a.maxLevel, enableContextMenu = _a.enableContextMenu, language = _a.language;
        if (enableContextMenu && maxLevel) {
            /** @type {?} */
            var levelMenus = [];
            for (var i = 1; i <= maxLevel; i++) {
                /** @type {?} */
                var title = language['expand' + i];
                levelMenus.push({ id: 30 + 1, code: i, title: title, handle: (/**
                     * @param {?} t
                     * @return {?}
                     */
                    function (t) {
                        // 发送请求获取数据
                        /** @type {?} */
                        var level = t.menu.code;
                        if (isLoadAllTreeData_1()) {
                            _this.setTreeNodeExpandBy(_this.ins.items, level);
                            cmpRef.instance.updateSerializedValue();
                        }
                        else {
                            var _a = _this.ins.treeInfo, dataField = _a.dataField, layerField = _a.layerField;
                            /** @type {?} */
                            var firstNodeData = (_this.ins.items || [])[0];
                            if (firstNodeData && firstNodeData.data) {
                                /** @type {?} */
                                var minLayer = _this.ins.utils.getValue(dataField + "." + layerField, firstNodeData.data);
                                /** @type {?} */
                                var _level = minLayer + level - 1;
                                _this.reloadTreeDataForExpand(_level);
                            }
                        }
                    }) });
            }
            /** @type {?} */
            var isLoadAllTreeData_1 = (/**
             * @return {?}
             */
            function () {
                if (_this.ins.loadTreeDataType === 'default') {
                    return cmpRef.instance.loadDataType === 'all';
                }
                else {
                    return _this.ins.loadTreeDataType === 'loadall';
                }
            });
            /** @type {?} */
            var contextMenus = [
                {
                    id: 6, code: 'checkchildnodes', title: '勾选下级数据',
                    visible: (/**
                     * @param {?} e
                     * @return {?}
                     */
                    function (e) {
                        // console.log(e);
                        return !e.data.node.selectable && !_this.ins.singleSelect && e.data.node.children && e.data.node.children.length;
                    }),
                    handle: (/**
                     * @param {?} t
                     * @return {?}
                     */
                    function (t) {
                        if (cmpRef) {
                            /** @type {?} */
                            var nodeIds = cmpRef.instance.getChildNodes(t.data.id).filter((/**
                             * @param {?} n
                             * @return {?}
                             */
                            function (n) { return n.selectable; })).map((/**
                             * @param {?} n
                             * @return {?}
                             */
                            function (n) { return n[_this.ins.idField]; }));
                            // const nodeIds = t.data.node.children.map(n => n[this.ins.idField]);
                            cmpRef.instance.checkedNodes(nodeIds);
                            cmpRef.instance.selectNodes(nodeIds);
                        }
                    })
                },
                {
                    id: 5, code: 'uncheckchildnodes', title: '取消勾选下级数据',
                    visible: (/**
                     * @param {?} e
                     * @return {?}
                     */
                    function (e) {
                        // console.log(e);
                        return !e.data.node.selectable && !_this.ins.singleSelect && e.data.node.children && e.data.node.children.length;
                    }),
                    handle: (/**
                     * @param {?} t
                     * @return {?}
                     */
                    function (t) {
                        if (cmpRef) {
                            // const nodeIds = t.data.node.children.map(n => n[this.ins.idField]);
                            /** @type {?} */
                            var nodeIds = cmpRef.instance.getChildNodes(t.data.id).filter((/**
                             * @param {?} n
                             * @return {?}
                             */
                            function (n) { return n.selectable; })).map((/**
                             * @param {?} n
                             * @return {?}
                             */
                            function (n) { return n[_this.ins.idField]; }));
                            cmpRef.instance.unCheckedNodes(nodeIds);
                            cmpRef.instance.unSelectNodes(nodeIds);
                        }
                    })
                },
                '-',
                {
                    id: 1, code: 'expandall', title: language.expandall, handle: (/**
                     * @param {?} t
                     * @return {?}
                     */
                    function (t) {
                        if (cmpRef && isLoadAllTreeData_1()) {
                            cmpRef.instance.expandAll();
                        }
                        else {
                            // 发送请求获取数据
                            _this.reloadTreeDataForExpand(-1);
                        }
                    })
                },
                { id: 2, code: 'collapseall', title: language.collapseall, handle: (/**
                     * @param {?} t
                     * @return {?}
                     */
                    function (t) {
                        if (cmpRef) {
                            cmpRef.instance.collapseAll();
                        }
                    }) },
                '-',
                {
                    id: 3, title: language.expandByLayer,
                    children: levelMenus
                }
            ];
            this.ins.treeTableOptions.contextMenuItems = contextMenus;
            cmpRef.instance.beforeShowContextMenu = (/**
             * @return {?}
             */
            function () {
                return of({ show: !cmpRef.instance.state.searched });
            });
        }
    };
    /**
     * @private
     * @return {?}
     */
    LookupComponentManager.prototype.getSpaceWidth = /**
     * @private
     * @return {?}
     */
    function () {
        return this.ins.layoutFormat === 'default' ? 20 : 48;
    };
    /**
     * @param {?} opts
     * @return {?}
     */
    LookupComponentManager.prototype.createContent = /**
     * @param {?} opts
     * @return {?}
     */
    function (opts) {
        if (this.ins.componentRef) {
            return;
        }
        /** @type {?} */
        var type = this.ins.getComponentType();
        /** @type {?} */
        var cmpFac = this.ins.cfr.resolveComponentFactory(type);
        /** @type {?} */
        var cmpRef = null;
        if (this.ins.isDoublleList()) {
            cmpRef = this.ins.centerContainer.createComponent(cmpFac);
        }
        else {
            cmpRef = this.ins.contentContainer.createComponent(cmpFac);
        }
        if (this.ins.isTree()) {
            opts.fit = true;
            opts.pagination = false;
            opts.fast = true;
            if (this.ins.useFavorite) {
                opts.fitColumns = false;
                opts.autoFitColumns = true;
            }
            this.useContextMenuForTree(cmpRef);
        }
        else {
            opts.fill = true;
        }
        /** @type {?} */
        var ttOpts = this.ins.treeTableOptions || {};
        Object.assign(cmpRef.instance, opts, tslib_1.__assign({ allColumnsTitle: this.ins.allColumnsTitle }, ttOpts));
        this.ins.componentRef = cmpRef;
        this.resizeComponent();
        return cmpRef;
    };
    // 创建收藏CMP
    // 创建收藏CMP
    /**
     * @param {?} opts
     * @return {?}
     */
    LookupComponentManager.prototype.createFavoritesContent = 
    // 创建收藏CMP
    /**
     * @param {?} opts
     * @return {?}
     */
    function (opts) {
        /** @type {?} */
        var type = this.ins.getComponentType();
        /** @type {?} */
        var cmpFac = this.ins.cfr.resolveComponentFactory(type);
        /** @type {?} */
        var cmpRef = null;
        cmpRef = this.ins.favoritesContainer.createComponent(cmpFac);
        if (this.ins.isTree()) {
            opts.fit = true;
            opts.pagination = false;
        }
        else {
            opts.fill = true;
        }
        Object.assign(cmpRef.instance, opts, {
            width: this.ins.dialog.size.width - this.getSpaceWidth(),
            height: this.ins.dialogMgr.getHeight()
        });
        // 订阅收藏夹列表中组件的相关事件
        this.ins.favHelper.initFavoriteComponentEvent(cmpRef);
        return cmpRef;
    };
    /**
     * @param {?=} type
     * @return {?}
     */
    LookupComponentManager.prototype.resizeComponent = /**
     * @param {?=} type
     * @return {?}
     */
    function (type) {
        if (type === void 0) { type = 'datatable'; }
        /** @type {?} */
        var size = {
            width: this.ins.dialog.size.width - this.getSpaceWidth(),
            height: this.ins.dialogMgr.getHeight()
        };
        if (this.ins.isDoublleList() && (type === 'datatable' || type === 'treetable')) {
            size.width = this.ins.dialog.size.width - this.ins.leftPanelWidth - (this.ins.layoutFormat === 'default' ? 20 : 48) - 7;
        }
        this.getComponentInstance(type).resize(size);
    };
    /**
     * @private
     * @param {?} node
     * @return {?}
     */
    LookupComponentManager.prototype.getChildNodes = /**
     * @private
     * @param {?} node
     * @return {?}
     */
    function (node) {
        var _this = this;
        /** @type {?} */
        var nodes = [];
        if (node.selectable || node.selectable === undefined) {
            nodes.push(node);
        }
        if (node.children && node.children.length) {
            node.children.forEach((/**
             * @param {?} n
             * @return {?}
             */
            function (n) {
                nodes.push.apply(nodes, tslib_1.__spread(_this.getChildNodes(n)));
            }));
        }
        return nodes;
    };
    /** 创建左侧组件 */
    /**
     * 创建左侧组件
     * @param {?} ops
     * @return {?}
     */
    LookupComponentManager.prototype.createLeftComponent = /**
     * 创建左侧组件
     * @param {?} ops
     * @return {?}
     */
    function (ops) {
        var _this = this;
        /** @type {?} */
        var dtFac = null;
        if (this.ins.isDoublleList()) {
            dtFac = this.ins.cfr.resolveComponentFactory(LookupLeftComponent);
        }
        this.ins.leftComponentRef = this.ins.leftContainer.createComponent(dtFac);
        ops.height = this.ins.dialogMgr.getHeight();
        if (this.ins.dialogWidth < this.ins.navLookupDialogMinWidth) {
            this.ins.dialogWidth = this.ins.navLookupDialogMinWidth;
            this.ins.dialog.reSize({ width: this.ins.dialogWidth });
            this.ins.resizeCmp({ width: this.ins.dialog.size.width });
        }
        if (ops.width !== this.ins.leftPanel.width) {
            // 默认 1 : 2
            this.ins.leftPanel.resize({
                width: this.ins.leftPanel.width,
                height: ops.height
            });
            this.ins.resizeCmp({ width: this.ins.dialog.size.width });
        }
        // this.resizeComponent();
        this.ins.leftComponentRef.instance.lookupCmp = this.ins;
        this.ins.leftComponentRef.instance.navOptions = ops;
        this.ins.leftComponentRef.instance.selected
            .pipe(debounceTime(100), switchMap((/**
         * @param {?} d
         * @return {?}
         */
        function (d) {
            if (d && d.data) {
                _this.ins.navigationFilter = {
                    selected: d.data,
                    idValue: _this.getNavigationFilter(d.data),
                    searchField: '',
                    searchValue: ''
                };
            }
            else {
                _this.ins.navigationFilter = undefined;
            }
            // 加载右侧数据
            /** @type {?} */
            var p = {
                pageInfo: {
                    pageIndex: _this.ins.gridOptions.pageIndex,
                    pageSize: _this.ins.gridOptions.pageSize
                }
            };
            if (_this.ins.includeSubordinates && d && d.node && ops.treeInfo) {
                var _a = ops.treeInfo, layerType = _a.layerType, pathField = _a.pathField, loadDataType = _a.loadDataType, dataField = _a.dataField;
                if (loadDataType === 'all') {
                    /** @type {?} */
                    var rowDatas = _this.getChildNodes(d.node).map((/**
                     * @param {?} n
                     * @return {?}
                     */
                    function (n) { return n.data; }));
                    _this.ins.navigationFilter.idValue = _this.getNavigationFilter(rowDatas);
                }
                else {
                    if (layerType == 'pathcode') {
                        // p['navNodePathCode'] = d.data[dataField][pathField];
                        p['navNodePathCode'] = _this.ins.getPathCode(d.data, ops.treeInfo);
                        _this.ins['navNodePathCode'] = p['navNodePathCode'];
                    }
                }
            }
            else {
                _this.ins['navNodePathCode'] = '';
            }
            /** @type {?} */
            var dataCmpRef = _this.getComponentInstance();
            var sortName = dataCmpRef.sortName, sortOrder = dataCmpRef.sortOrder;
            Object.assign(p, { search: _this.ins._searchState, sortName: sortName, sortOrder: sortOrder });
            return _this.ins.httpMgr.getData(p, 'list');
        })))
            .subscribe((/**
         * @param {?} res
         * @return {?}
         */
        function (res) {
            _this.ins.closeLoading();
            _this.ins.loadDataWhenOpen = true;
            // if (this.ins.useFavorite && !this.ins.isTree()) {
            //     this.ins.favHelper.updateFavoritesStatus(res.items);
            // }
            // this.ins.loadDataTableData(res);
            _this.ins.loadData(res, false);
            setTimeout((/**
             * @return {?}
             */
            function () {
                // 选中数据
                _this.ins.selectionMgr.selectCurrentValue();
                _this.ins.changeDetector.detectChanges();
            }));
        }));
        return this.ins.leftComponentRef.instance.createComponent();
    };
    // 获取关联数据, 右侧数据中 关联各字段的值
    // 获取关联数据, 右侧数据中 关联各字段的值
    /**
     * @private
     * @param {?} navRow
     * @return {?}
     */
    LookupComponentManager.prototype.getNavigationFilter = 
    // 获取关联数据, 右侧数据中 关联各字段的值
    /**
     * @private
     * @param {?} navRow
     * @return {?}
     */
    function (navRow) {
        if (this.ins.navigationOptions.relations && this.ins.navigationOptions.relations.length) {
            /** @type {?} */
            var result_1 = [];
            this.ins.navigationOptions.relations.forEach((/**
             * @param {?} r
             * @return {?}
             */
            function (r) {
                /** @type {?} */
                var k = r.groupField;
                /** @type {?} */
                var dField = r.helpField;
                /** @type {?} */
                var rf = { fieldName: dField, fieldValue: '' };
                if (Array.isArray(navRow)) {
                    /** @type {?} */
                    var vals = navRow.map((/**
                     * @param {?} n
                     * @return {?}
                     */
                    function (n) {
                        return k.split('.').reduce((/**
                         * @param {?} o
                         * @param {?} c
                         * @return {?}
                         */
                        function (o, c) {
                            return o[c];
                        }), n);
                    }));
                    rf.fieldValue = vals.join(',');
                }
                else {
                    rf.fieldValue = k.split('.').reduce((/**
                     * @param {?} o
                     * @param {?} c
                     * @return {?}
                     */
                    function (o, c) {
                        return o[c];
                    }), navRow);
                }
                result_1.push(rf);
            }));
            return result_1;
        }
        return '';
    };
    return LookupComponentManager;
}());
export { LookupComponentManager };
if (false) {
    /**
     * @type {?}
     * @private
     */
    LookupComponentManager.prototype.ins;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9va3VwLWNvbXBvbmVudC5tYW5hZ2VyLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1sb29rdXAvIiwic291cmNlcyI6WyJsaWIvc2VydmljZXMvbG9va3VwLWNvbXBvbmVudC5tYW5hZ2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBSUEsT0FBTyxFQUFFLEVBQUUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMxQixPQUFPLEVBQUUsWUFBWSxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3pELE9BQU8sRUFBeUIscUJBQXFCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUVyRixPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUcvRDtJQUNJLGdDQUFvQixHQUF3QjtRQUF4QixRQUFHLEdBQUgsR0FBRyxDQUFxQjtJQUFHLENBQUM7Ozs7O0lBRWhELHFEQUFvQjs7OztJQUFwQixVQUFxQixJQUF5QztRQUF6QyxxQkFBQSxFQUFBLGtCQUF5QztRQUMxRCxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxZQUFZLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxRQUFRLEVBQUU7WUFDM0QsT0FBTyxJQUFJLENBQUM7U0FDZjtRQUVELElBQUksSUFBSSxLQUFLLFVBQVUsRUFBRTtZQUNyQixPQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsYUFBYSxDQUFDO1NBQ2pDOztZQUVHLEdBQUcsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxRQUFRO1FBRXhDLElBQUksSUFBSSxLQUFLLGVBQWUsSUFBSSxJQUFJLEtBQUssVUFBVSxFQUFFOztnQkFDM0MsT0FBTyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsZ0JBQWdCO1lBQ3pDLElBQUksQ0FBQyxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsUUFBUSxJQUFJLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxNQUFN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IHsgQ29tcG9uZW50UmVmIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IERhdGFUYWJsZUNvbXBvbmVudCB9IGZyb20gJ0BmYXJyaXMvdWktZGF0YXRhYmxlJztcclxuaW1wb3J0IHsgT1BUUyB9IGZyb20gJ0BmYXJyaXMvdWktZGF0ZXBpY2tlci9wdWJsaWMtYXBpJztcclxuaW1wb3J0IHsgVHJlZU5vZGUsIFRyZWVUYWJsZUNvbXBvbmVudCB9IGZyb20gJ0BmYXJyaXMvdWktdHJlZXRhYmxlJztcclxuaW1wb3J0IHsgb2YgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgZGVib3VuY2VUaW1lLCBzd2l0Y2hNYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7IENvbXBvbmVudEluc3RhbmNlVHlwZSwgTG9va3VwR3JpZERpc3BsYXlUeXBlIH0gZnJvbSAnLi4vbG9va3VwLWRpc3BsYXl0eXBlJztcclxuaW1wb3J0IHsgTG9va3VwR3JpZENvbXBvbmVudCB9IGZyb20gJy4uL2xvb2t1cC1ncmlkLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IExvb2t1cExlZnRDb21wb25lbnQgfSBmcm9tICcuLi9sb29rdXAtbGVmdC5jb21wb25lbnQnO1xyXG5cclxuXHJcbmV4cG9ydCBjbGFzcyBMb29rdXBDb21wb25lbnRNYW5hZ2VyIHtcclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgaW5zOiBMb29rdXBHcmlkQ29tcG9uZW50KSB7fVxyXG5cclxuICAgIGdldENvbXBvbmVudEluc3RhbmNlKHR5cGU6IENvbXBvbmVudEluc3RhbmNlVHlwZSA9ICdkYXRhdGFibGUnKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmlucy5jb21wb25lbnRSZWYgfHwgIXRoaXMuaW5zLmNvbXBvbmVudFJlZi5pbnN0YW5jZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0eXBlID09PSAnc2VsZWN0ZWQnKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmlucy5tdWx0aVNlbGVjdERUO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IGlucyA9IHRoaXMuaW5zLmNvbXBvbmVudFJlZi5pbnN0YW5jZTtcclxuXHJcbiAgICAgICAgaWYgKHR5cGUgPT09ICdsZWZ0RGF0YVRhYmxlJyB8fCB0eXBlID09PSAnbGVmdFRyZWUnKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGxlZnRSZWYgPSB0aGlzLmlucy5sZWZ0Q29tcG9uZW50UmVmO1xyXG4gICAgICAgICAgICBpZiAoIWxlZnRSZWYgfHwgIWxlZnRSZWYuaW5zdGFuY2UgfHwgIWxlZnRSZWYuaW5zdGFuY2UuY21wUmVmIHx8ICFsZWZ0UmVmLmluc3RhbmNlLmNtcFJlZi5pbnN0YW5jZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaW5zID0gdGhpcy5pbnMubGVmdENvbXBvbmVudFJlZi5pbnN0YW5jZS5jbXBSZWYuaW5zdGFuY2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodHlwZSA9PT0gJ2ZhdicpIHtcclxuICAgICAgICAgICAgaW5zID0gdGhpcy5pbnMuZmF2b3JpdGVzQ29tcG9uZW50UmVmLmluc3RhbmNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc3dpdGNoICh0eXBlKSB7XHJcbiAgICAgICAgICAgIGNhc2UgJ2xlZnREYXRhVGFibGUnOlxyXG4gICAgICAgICAgICBjYXNlICdmYXYnOlxyXG4gICAgICAgICAgICBjYXNlICdkYXRhdGFibGUnOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGlucyBhcyBEYXRhVGFibGVDb21wb25lbnQ7XHJcbiAgICAgICAgICAgIGNhc2UgJ2xlZnRUcmVlJzpcclxuICAgICAgICAgICAgY2FzZSAndHJlZXRhYmxlJzpcclxuICAgICAgICAgICAgICAgIHJldHVybiBpbnMgYXMgVHJlZVRhYmxlQ29tcG9uZW50O1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaW5zLmlzVHJlZSgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlucyBhcyBUcmVlVGFibGVDb21wb25lbnQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaW5zIGFzIERhdGFUYWJsZUNvbXBvbmVudDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY3JlYXRlQ29tcG9uZW50V2l0aFNlcnZlckRhdGEoZGF0YTogYW55KSB7XHJcbiAgICAgICAgaWYgKHRoaXMuaW5zLmNvbXBvbmVudFJlZikge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaW5zLmlkRmllbGQgPSBkYXRhLmlkRmllbGQgfHwgdGhpcy5pbnMuaWRGaWVsZDtcclxuICAgICAgICB0aGlzLmlucy50ZXh0RmllbGQgPSBkYXRhLnRleHRGaWVsZCB8fCB0aGlzLmlucy50ZXh0RmllbGQ7XHJcbiAgICAgICAgdGhpcy5pbnMudmFsdWVGaWVsZCA9IGRhdGEudmFsdWVGaWVsZCB8fCB0aGlzLmlucy52YWx1ZUZpZWxkO1xyXG5cclxuICAgICAgICB0aGlzLmlucy5kaXNwbGF5VHlwZSA9IChkYXRhICYmIGRhdGEuZGlzcGxheVR5cGUpIHx8IHRoaXMuaW5zLmRpc3BsYXlUeXBlIHx8ICdMSVNUJztcclxuXHJcbiAgICAgICAgY29uc3QgZHR5cCA9IHRoaXMuaW5zLmRpc3BsYXlUeXBlLnRvVXBwZXJDYXNlKCk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmlucy5pc0RvdWJsbGVMaXN0KCkpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuaW5zLm5hdlRyZWVUb0xpc3QgJiYgZHR5cCA9PT0gTG9va3VwR3JpZERpc3BsYXlUeXBlLk5hdlRyZWVMaXN0KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlucy5kaXNwbGF5VHlwZSA9IExvb2t1cEdyaWREaXNwbGF5VHlwZS5OYXZMaXN0O1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5pbnMudHJlZVRvTGlzdCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGR0eXAgPT09ICBMb29rdXBHcmlkRGlzcGxheVR5cGUuTmF2TGlzdFRyZWUpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5kaXNwbGF5VHlwZSA9IExvb2t1cEdyaWREaXNwbGF5VHlwZS5OYXZMaXN0O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmlucy50cmVlVG9MaXN0KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZHR5cCA9PT0gTG9va3VwR3JpZERpc3BsYXlUeXBlLlRyZWVMaXN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMuZGlzcGxheVR5cGUgPSAnTElTVCc7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChkdHlwID09PSAgTG9va3VwR3JpZERpc3BsYXlUeXBlLk5hdkxpc3RUcmVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zLmRpc3BsYXlUeXBlID0gTG9va3VwR3JpZERpc3BsYXlUeXBlLk5hdkxpc3Q7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gXHJcblxyXG4gICAgICAgIFxyXG5cclxuICAgICAgICBpZiAodGhpcy5pbnMuaXNEb3VibGxlTGlzdCgpICYmIHRoaXMuaW5zLm5hdlRyZWVUb0xpc3QpIHtcclxuICAgICAgICAgICAgaWYgKGR0eXAgPT09IExvb2t1cEdyaWREaXNwbGF5VHlwZS5OYXZUcmVlTGlzdCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnMuZGlzcGxheVR5cGUgPSBMb29rdXBHcmlkRGlzcGxheVR5cGUuTmF2TGlzdDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5pbnMuY2hhbmdlRGV0ZWN0b3IuZGV0ZWN0Q2hhbmdlcygpO1xyXG5cclxuICAgICAgICB0aGlzLmlucy5jb21wb25lbnRSZWYgPSB0aGlzLmNyZWF0ZUNvbnRlbnQodGhpcy5pbnMuZ3JpZE9wdGlvbnMpO1xyXG4gICAgICAgIHRoaXMuY3JlYXRlRmF2b3JpdGVDb21wb25lbnQoKTtcclxuXHJcbiAgICAgICAgdGhpcy5yZXNpemVDb21wb25lbnQoKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgY3JlYXRlRmF2b3JpdGVDb21wb25lbnQoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuaW5zLnVzZUZhdm9yaXRlICYmICF0aGlzLmlucy5mYXZvcml0ZXNDb21wb25lbnRSZWYpIHtcclxuICAgICAgICAgICAgdGhpcy5pbnMuZmF2b3JpdGVDb2x1bW5zID0gdGhpcy5pbnMuZmF2SGVscGVyLmdldEZhdm9yaXRlQ29sdW1ucygpO1xyXG4gICAgICAgICAgICBjb25zdCBmYXZvcml0ZXNPcHRpb25zID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5pbnMuZ3JpZE9wdGlvbnMsIHtcclxuICAgICAgICAgICAgICAgIHNob3dGaWx0ZXJCYXI6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgcGFnaW5hdGlvbjogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBjb2x1bW5zOiB0aGlzLmlucy5mYXZvcml0ZUNvbHVtbnMgfHwgW11cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zLmZhdm9yaXRlc0NvbXBvbmVudFJlZiA9IHRoaXMuY3JlYXRlRmF2b3JpdGVzQ29udGVudChmYXZvcml0ZXNPcHRpb25zKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMucmVzaXplQ29tcG9uZW50KCdmYXYnKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHByaXZhdGUgcmVsb2FkVHJlZURhdGFGb3JFeHBhbmQoZXhwYW5kTGV2ZWwpIHtcclxuICAgICAgICBjb25zdCB1cmkgPSB0aGlzLmlucy5ncmlkT3B0aW9ucy51cmk7XHJcbiAgICAgICAgY29uc3QgdHQgPSB0aGlzLmlucy5jb21wb25lbnRSZWYuaW5zdGFuY2UgYXMgVHJlZVRhYmxlQ29tcG9uZW50O1xyXG4gICAgICAgIGNvbnN0IHsgZmllbGQgPSAnKicsIHZhbHVlID0gJycgfSA9IHtcclxuICAgICAgICAgICAgLi4udHQuc2VhcmNoRGF0YVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgY29uc3Qgc2VhcmNoID0geyBjYXRlZ29yeTogJ2FsbCcsIHNlYXJjaFZhbHVlOiB2YWx1ZSwgc2VhcmNoRmllbGQ6IGZpZWxkLCBsYXllck51bTogZXhwYW5kTGV2ZWwgfTtcclxuXHJcblxyXG4gICAgICAgIGNvbnN0IHBhcmFtID0ge1xyXG4gICAgICAgICAgICBzZWFyY2hWYWx1ZTogSlNPTi5zdHJpbmdpZnkoc2VhcmNoKSxcclxuICAgICAgICAgICAgY3VzdG9tRGF0YTogdGhpcy5pbnMuY3VzdG9tRGF0YSxcclxuICAgICAgICAgICAgZW5hYmxlRnVsbFRyZWU6IHRoaXMuaW5zLmVuYWJsZUZ1bGxUcmVlLFxyXG4gICAgICAgICAgICBsb2FkVHJlZURhdGFUeXBlOiB0aGlzLmlucy5sb2FkVHJlZURhdGFUeXBlXHJcbiAgICAgICAgfTtcclxuXHJcblxyXG4gICAgICAgIGlmICh0aGlzLmlucy5oZWxwSWQpIHtcclxuICAgICAgICAgICAgcGFyYW1bJ2hlbHBJZCddID0gdGhpcy5pbnMuaGVscElkO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHR0ICYmIHR0LnNvcnROYW1lKSB7XHJcbiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24ocGFyYW0sIHtcclxuICAgICAgICAgICAgICAgIHNvcnROYW1lOiB0dC5zb3J0TmFtZSxcclxuICAgICAgICAgICAgICAgIHNvcnRPcmRlcjogdHQuc29ydE9yZGVyXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmlucy5zaG93TG9hZGluZygpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmlucy5odHRwLmdldERhdGEodXJpLCBwYXJhbSkuc3Vic2NyaWJlKChkYXRhOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5pbnMuY2xvc2VMb2FkaW5nKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IG5vZGVzID0gdGhpcy5pbnMuY2hlY2tOb2RlQ2FuQmVTZWxlY3QoZGF0YS5pdGVtcywgZXhwYW5kTGV2ZWwgPT09IC0xKTtcclxuICAgICAgICAgICAgdGhpcy5pbnMuaXRlbXMgPSBub2RlcztcclxuICAgICAgICAgICAgdHQubG9hZERhdGEobm9kZXMpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2V0VHJlZU5vZGVFeHBhbmRCeShub2RlczogVHJlZU5vZGVbXSwgbGV2ZWwpIHtcclxuICAgICAgICBpZiAoIW5vZGVzIHx8ICFub2Rlcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBub2Rlcy5mb3JFYWNoKChuOiBUcmVlTm9kZSkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBsYXllciA9IG4uZGF0YVt0aGlzLmlucy50cmVlSW5mby5kYXRhRmllbGRdLmxheWVyO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgZXhwYW5kTGF5ZXIgPSBsYXllciArIGxldmVsIC0gMTtcclxuXHJcbiAgICAgICAgICAgIG4uZXhwYW5kZWQgPSBsYXllciA8PSBleHBhbmRMYXllciA/IHRydWUgOiBuLmV4cGFuZGVkO1xyXG4gICAgICAgICAgICBpZiAobi5jaGlsZHJlbiAmJiBuLmNoaWxkcmVuLmxlbmd0aCAmJiBsYXllciArIDEgPD0gZXhwYW5kTGF5ZXIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2V0VHJlZU5vZGVFeHBhbmRCeShuLmNoaWxkcmVuLCBsZXZlbCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyDlkK/nlKjmoJHluK7liqnlj7PplK7oj5zljZXlip/og71cclxuICAgIHByaXZhdGUgdXNlQ29udGV4dE1lbnVGb3JUcmVlKGNtcFJlZjogQ29tcG9uZW50UmVmPGFueT4pIHtcclxuICAgICAgICBjb25zdCB7IG1heExldmVsLCBlbmFibGVDb250ZXh0TWVudSwgbGFuZ3VhZ2UgfSA9IHRoaXMuaW5zLnRyZWVUYWJsZU9wdGlvbnM7XHJcbiAgICAgICAgaWYgKGVuYWJsZUNvbnRleHRNZW51ICYmIG1heExldmVsKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGxldmVsTWVudXMgPSBbXTtcclxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gbWF4TGV2ZWw7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdGl0bGUgPSBsYW5ndWFnZVsnZXhwYW5kJyArIGldO1xyXG4gICAgICAgICAgICAgICAgbGV2ZWxNZW51cy5wdXNoKHsgaWQ6IDMwICsgMSwgY29kZTogaSwgdGl0bGUsIGhhbmRsZTogKHQpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAvLyDlj5HpgIHor7fmsYLojrflj5bmlbDmja5cclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBsZXZlbCA9IHQubWVudS5jb2RlO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpc0xvYWRBbGxUcmVlRGF0YSgpICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFRyZWVOb2RlRXhwYW5kQnkodGhpcy5pbnMuaXRlbXMsIGxldmVsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY21wUmVmLmluc3RhbmNlLnVwZGF0ZVNlcmlhbGl6ZWRWYWx1ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgZGF0YUZpZWxkLCBsYXllckZpZWxkIH0gPSB0aGlzLmlucy50cmVlSW5mbztcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZmlyc3ROb2RlRGF0YSA9ICh0aGlzLmlucy5pdGVtcyB8fCBbXSlbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmaXJzdE5vZGVEYXRhICYmIGZpcnN0Tm9kZURhdGEuZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbWluTGF5ZXIgPSB0aGlzLmlucy51dGlscy5nZXRWYWx1ZShgJHtkYXRhRmllbGR9LiR7bGF5ZXJGaWVsZH1gLCBmaXJzdE5vZGVEYXRhLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IF9sZXZlbCA9IG1pbkxheWVyICsgbGV2ZWwgLSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWxvYWRUcmVlRGF0YUZvckV4cGFuZChfbGV2ZWwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY29uc3QgaXNMb2FkQWxsVHJlZURhdGEgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pbnMubG9hZFRyZWVEYXRhVHlwZSA9PT0gJ2RlZmF1bHQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNtcFJlZi5pbnN0YW5jZS5sb2FkRGF0YVR5cGUgPT09ICdhbGwnO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pbnMubG9hZFRyZWVEYXRhVHlwZSA9PT0gJ2xvYWRhbGwnO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgY29uc3QgY29udGV4dE1lbnVzID0gW1xyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGlkOjYsIGNvZGU6ICdjaGVja2NoaWxkbm9kZXMnLCB0aXRsZTogJ+WLvumAieS4i+e6p+aVsOaNricsXHJcbiAgICAgICAgICAgICAgICAgICAgdmlzaWJsZTogKGUpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAhZS5kYXRhLm5vZGUuc2VsZWN0YWJsZSAmJiAhdGhpcy5pbnMuc2luZ2xlU2VsZWN0ICYmIGUuZGF0YS5ub2RlLmNoaWxkcmVuICYmIGUuZGF0YS5ub2RlLmNoaWxkcmVuLmxlbmd0aFxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlOiAodCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY21wUmVmKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBub2RlSWRzID0gY21wUmVmLmluc3RhbmNlLmdldENoaWxkTm9kZXModC5kYXRhLmlkKS5maWx0ZXIobiA9PiBuLnNlbGVjdGFibGUpLm1hcChuID0+IG5bdGhpcy5pbnMuaWRGaWVsZF0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29uc3Qgbm9kZUlkcyA9IHQuZGF0YS5ub2RlLmNoaWxkcmVuLm1hcChuID0+IG5bdGhpcy5pbnMuaWRGaWVsZF0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY21wUmVmLmluc3RhbmNlLmNoZWNrZWROb2Rlcyhub2RlSWRzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNtcFJlZi5pbnN0YW5jZS5zZWxlY3ROb2Rlcyhub2RlSWRzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWQ6NSwgY29kZTogJ3VuY2hlY2tjaGlsZG5vZGVzJywgdGl0bGU6ICflj5bmtojli77pgInkuIvnuqfmlbDmja4nLFxyXG4gICAgICAgICAgICAgICAgICAgIHZpc2libGU6IChlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIWUuZGF0YS5ub2RlLnNlbGVjdGFibGUgJiYgIXRoaXMuaW5zLnNpbmdsZVNlbGVjdCAmJiBlLmRhdGEubm9kZS5jaGlsZHJlbiAmJiBlLmRhdGEubm9kZS5jaGlsZHJlbi5sZW5ndGhcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZTogKHQpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNtcFJlZikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29uc3Qgbm9kZUlkcyA9IHQuZGF0YS5ub2RlLmNoaWxkcmVuLm1hcChuID0+IG5bdGhpcy5pbnMuaWRGaWVsZF0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgbm9kZUlkcyA9IGNtcFJlZi5pbnN0YW5jZS5nZXRDaGlsZE5vZGVzKHQuZGF0YS5pZCkuZmlsdGVyKG4gPT4gbi5zZWxlY3RhYmxlKS5tYXAobiA9PiBuW3RoaXMuaW5zLmlkRmllbGRdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNtcFJlZi5pbnN0YW5jZS51bkNoZWNrZWROb2Rlcyhub2RlSWRzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNtcFJlZi5pbnN0YW5jZS51blNlbGVjdE5vZGVzKG5vZGVJZHMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICctJyxcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBpZDogMSwgY29kZTogJ2V4cGFuZGFsbCcsIHRpdGxlOiBsYW5ndWFnZS5leHBhbmRhbGwsIGhhbmRsZTogKHQpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNtcFJlZiAmJiBpc0xvYWRBbGxUcmVlRGF0YSgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbXBSZWYuaW5zdGFuY2UuZXhwYW5kQWxsKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDlj5HpgIHor7fmsYLojrflj5bmlbDmja5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVsb2FkVHJlZURhdGFGb3JFeHBhbmQoLTEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHsgaWQ6IDIsIGNvZGU6ICdjb2xsYXBzZWFsbCcsIHRpdGxlOiBsYW5ndWFnZS5jb2xsYXBzZWFsbCwgaGFuZGxlOiAodCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjbXBSZWYpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY21wUmVmLmluc3RhbmNlLmNvbGxhcHNlQWxsKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSB9LFxyXG4gICAgICAgICAgICAgICAgJy0nLFxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGlkOiAzLCB0aXRsZTogbGFuZ3VhZ2UuZXhwYW5kQnlMYXllcixcclxuICAgICAgICAgICAgICAgICAgICBjaGlsZHJlbjogbGV2ZWxNZW51c1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBdO1xyXG4gICAgICAgICAgICB0aGlzLmlucy50cmVlVGFibGVPcHRpb25zLmNvbnRleHRNZW51SXRlbXMgPSBjb250ZXh0TWVudXM7XHJcblxyXG4gICAgICAgICAgICBjbXBSZWYuaW5zdGFuY2UuYmVmb3JlU2hvd0NvbnRleHRNZW51ID0gKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG9mKHtzaG93OiAhY21wUmVmLmluc3RhbmNlLnN0YXRlLnNlYXJjaGVkfSk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0U3BhY2VXaWR0aCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5pbnMubGF5b3V0Rm9ybWF0ID09PSAnZGVmYXVsdCcgPyAyMCA6IDQ4O1xyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZUNvbnRlbnQob3B0czogYW55KTogQ29tcG9uZW50UmVmPGFueT4ge1xyXG5cclxuICAgICAgICBpZiAodGhpcy5pbnMuY29tcG9uZW50UmVmKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHR5cGUgPSB0aGlzLmlucy5nZXRDb21wb25lbnRUeXBlKCk7XHJcblxyXG4gICAgICAgIGNvbnN0IGNtcEZhYyA9IHRoaXMuaW5zLmNmci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeSh0eXBlKTtcclxuICAgICAgICBsZXQgY21wUmVmOiBDb21wb25lbnRSZWY8YW55PiA9IG51bGw7XHJcbiAgICAgICAgaWYgKHRoaXMuaW5zLmlzRG91YmxsZUxpc3QoKSkge1xyXG4gICAgICAgICAgICBjbXBSZWYgPSB0aGlzLmlucy5jZW50ZXJDb250YWluZXIuY3JlYXRlQ29tcG9uZW50KGNtcEZhYyk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY21wUmVmID0gdGhpcy5pbnMuY29udGVudENvbnRhaW5lci5jcmVhdGVDb21wb25lbnQoY21wRmFjKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmlucy5pc1RyZWUoKSkge1xyXG4gICAgICAgICAgICBvcHRzLmZpdCA9IHRydWU7XHJcbiAgICAgICAgICAgIG9wdHMucGFnaW5hdGlvbiA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgb3B0cy5mYXN0ID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmlucy51c2VGYXZvcml0ZSkge1xyXG4gICAgICAgICAgICAgICAgb3B0cy5maXRDb2x1bW5zID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBvcHRzLmF1dG9GaXRDb2x1bW5zID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy51c2VDb250ZXh0TWVudUZvclRyZWUoY21wUmVmKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBvcHRzLmZpbGwgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgdHRPcHRzID0gdGhpcy5pbnMudHJlZVRhYmxlT3B0aW9ucyB8fCB7fTtcclxuICAgICAgICBPYmplY3QuYXNzaWduKGNtcFJlZi5pbnN0YW5jZSwgb3B0cywgeyBhbGxDb2x1bW5zVGl0bGU6IHRoaXMuaW5zLmFsbENvbHVtbnNUaXRsZSwgLi4udHRPcHRzIH0pO1xyXG5cclxuICAgICAgICB0aGlzLmlucy5jb21wb25lbnRSZWYgPSBjbXBSZWY7XHJcbiAgICAgICAgdGhpcy5yZXNpemVDb21wb25lbnQoKTtcclxuICAgICAgICByZXR1cm4gY21wUmVmO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOWIm+W7uuaUtuiXj0NNUFxyXG4gICAgY3JlYXRlRmF2b3JpdGVzQ29udGVudChvcHRzOiBhbnkpOiBDb21wb25lbnRSZWY8YW55PiB7XHJcblxyXG4gICAgICAgIGNvbnN0IHR5cGUgPSB0aGlzLmlucy5nZXRDb21wb25lbnRUeXBlKCk7XHJcblxyXG4gICAgICAgIGNvbnN0IGNtcEZhYyA9IHRoaXMuaW5zLmNmci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeSh0eXBlKTtcclxuICAgICAgICBsZXQgY21wUmVmID0gbnVsbDtcclxuICAgICAgICBjbXBSZWYgPSB0aGlzLmlucy5mYXZvcml0ZXNDb250YWluZXIuY3JlYXRlQ29tcG9uZW50KGNtcEZhYyk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmlucy5pc1RyZWUoKSkge1xyXG4gICAgICAgICAgICBvcHRzLmZpdCA9IHRydWU7XHJcbiAgICAgICAgICAgIG9wdHMucGFnaW5hdGlvbiA9IGZhbHNlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIG9wdHMuZmlsbCA9IHRydWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBPYmplY3QuYXNzaWduKGNtcFJlZi5pbnN0YW5jZSwgb3B0cywge1xyXG4gICAgICAgICAgICB3aWR0aDogdGhpcy5pbnMuZGlhbG9nLnNpemUud2lkdGggLSB0aGlzLmdldFNwYWNlV2lkdGgoKSxcclxuICAgICAgICAgICAgaGVpZ2h0OiB0aGlzLmlucy5kaWFsb2dNZ3IuZ2V0SGVpZ2h0KClcclxuICAgICAgICB9KTtcclxuXHJcblxyXG4gICAgICAgIC8vIOiuoumYheaUtuiXj+WkueWIl+ihqOS4ree7hOS7tueahOebuOWFs+S6i+S7tlxyXG4gICAgICAgIHRoaXMuaW5zLmZhdkhlbHBlci5pbml0RmF2b3JpdGVDb21wb25lbnRFdmVudChjbXBSZWYpO1xyXG5cclxuICAgICAgICByZXR1cm4gY21wUmVmO1xyXG4gICAgfVxyXG5cclxuICAgIHJlc2l6ZUNvbXBvbmVudCh0eXBlOiBDb21wb25lbnRJbnN0YW5jZVR5cGUgPSAnZGF0YXRhYmxlJykge1xyXG4gICAgICAgIGNvbnN0IHNpemUgPSB7XHJcbiAgICAgICAgICAgIHdpZHRoOiB0aGlzLmlucy5kaWFsb2cuc2l6ZS53aWR0aCAtIHRoaXMuZ2V0U3BhY2VXaWR0aCgpLFxyXG4gICAgICAgICAgICBoZWlnaHQ6IHRoaXMuaW5zLmRpYWxvZ01nci5nZXRIZWlnaHQoKVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmlucy5pc0RvdWJsbGVMaXN0KCkgJiYgKHR5cGUgPT09ICdkYXRhdGFibGUnIHx8IHR5cGUgPT09ICd0cmVldGFibGUnKSkge1xyXG4gICAgICAgICAgICBzaXplLndpZHRoID0gdGhpcy5pbnMuZGlhbG9nLnNpemUud2lkdGggLSB0aGlzLmlucy5sZWZ0UGFuZWxXaWR0aCAtICh0aGlzLmlucy5sYXlvdXRGb3JtYXQgPT09ICdkZWZhdWx0JyA/IDIwIDogNDgpIC0gNztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuZ2V0Q29tcG9uZW50SW5zdGFuY2UodHlwZSkucmVzaXplKHNpemUpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0Q2hpbGROb2Rlcyhub2RlOiBUcmVlTm9kZSkge1xyXG4gICAgICAgIGNvbnN0IG5vZGVzOiBhbnkgPSBbXTtcclxuICAgICAgICBpZiAobm9kZS5zZWxlY3RhYmxlIHx8IG5vZGUuc2VsZWN0YWJsZSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIG5vZGVzLnB1c2gobm9kZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChub2RlLmNoaWxkcmVuICYmIG5vZGUuY2hpbGRyZW4ubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIG5vZGUuY2hpbGRyZW4uZm9yRWFjaChuID0+IHtcclxuICAgICAgICAgICAgICAgIG5vZGVzLnB1c2goLi4udGhpcy5nZXRDaGlsZE5vZGVzKG4pKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBub2RlcztcclxuICAgIH1cclxuXHJcbiAgICAvKiog5Yib5bu65bem5L6n57uE5Lu2ICovXHJcbiAgICBjcmVhdGVMZWZ0Q29tcG9uZW50KG9wczogYW55KSB7XHJcbiAgICAgICAgbGV0IGR0RmFjID0gbnVsbDtcclxuICAgICAgICBpZiAodGhpcy5pbnMuaXNEb3VibGxlTGlzdCgpKSB7XHJcbiAgICAgICAgICAgIGR0RmFjID0gdGhpcy5pbnMuY2ZyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KExvb2t1cExlZnRDb21wb25lbnQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmlucy5sZWZ0Q29tcG9uZW50UmVmID0gdGhpcy5pbnMubGVmdENvbnRhaW5lci5jcmVhdGVDb21wb25lbnQoZHRGYWMpO1xyXG4gICAgICAgIG9wcy5oZWlnaHQgPSB0aGlzLmlucy5kaWFsb2dNZ3IuZ2V0SGVpZ2h0KCk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmlucy5kaWFsb2dXaWR0aCA8IHRoaXMuaW5zLm5hdkxvb2t1cERpYWxvZ01pbldpZHRoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zLmRpYWxvZ1dpZHRoID0gdGhpcy5pbnMubmF2TG9va3VwRGlhbG9nTWluV2lkdGg7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zLmRpYWxvZy5yZVNpemUoeyB3aWR0aDogdGhpcy5pbnMuZGlhbG9nV2lkdGggfSk7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zLnJlc2l6ZUNtcCh7IHdpZHRoOiB0aGlzLmlucy5kaWFsb2cuc2l6ZS53aWR0aCB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChvcHMud2lkdGggIT09IHRoaXMuaW5zLmxlZnRQYW5lbC53aWR0aCkge1xyXG4gICAgICAgICAgICAvLyDpu5jorqQgMSA6IDJcclxuICAgICAgICAgICAgdGhpcy5pbnMubGVmdFBhbmVsLnJlc2l6ZSh7XHJcbiAgICAgICAgICAgICAgICB3aWR0aDogdGhpcy5pbnMubGVmdFBhbmVsLndpZHRoLFxyXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiBvcHMuaGVpZ2h0XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB0aGlzLmlucy5yZXNpemVDbXAoeyB3aWR0aDogdGhpcy5pbnMuZGlhbG9nLnNpemUud2lkdGggfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyB0aGlzLnJlc2l6ZUNvbXBvbmVudCgpO1xyXG5cclxuICAgICAgICB0aGlzLmlucy5sZWZ0Q29tcG9uZW50UmVmLmluc3RhbmNlLmxvb2t1cENtcCA9IHRoaXMuaW5zO1xyXG4gICAgICAgIHRoaXMuaW5zLmxlZnRDb21wb25lbnRSZWYuaW5zdGFuY2UubmF2T3B0aW9ucyA9IG9wcztcclxuXHJcblxyXG4gICAgICAgIHRoaXMuaW5zLmxlZnRDb21wb25lbnRSZWYuaW5zdGFuY2Uuc2VsZWN0ZWRcclxuICAgICAgICAgICAgLnBpcGUoXHJcbiAgICAgICAgICAgICAgICBkZWJvdW5jZVRpbWUoMTAwKSxcclxuICAgICAgICAgICAgICAgIHN3aXRjaE1hcCgoZDogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGQgJiYgZC5kYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zLm5hdmlnYXRpb25GaWx0ZXIgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZDogZC5kYXRhLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWRWYWx1ZTogdGhpcy5nZXROYXZpZ2F0aW9uRmlsdGVyKGQuZGF0YSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWFyY2hGaWVsZDogJycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWFyY2hWYWx1ZTogJydcclxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5uYXZpZ2F0aW9uRmlsdGVyID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAvLyDliqDovb3lj7PkvqfmlbDmja5cclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBwID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYWdlSW5mbzoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFnZUluZGV4OiB0aGlzLmlucy5ncmlkT3B0aW9ucy5wYWdlSW5kZXgsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWdlU2l6ZTogdGhpcy5pbnMuZ3JpZE9wdGlvbnMucGFnZVNpemVcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmlucy5pbmNsdWRlU3Vib3JkaW5hdGVzICYmIGQgJiYgZC5ub2RlICYmIG9wcy50cmVlSW5mbykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB7bGF5ZXJUeXBlLCBwYXRoRmllbGQsIGxvYWREYXRhVHlwZSwgZGF0YUZpZWxkfSA9IG9wcy50cmVlSW5mb1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobG9hZERhdGFUeXBlID09PSAnYWxsJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgcm93RGF0YXMgPSB0aGlzLmdldENoaWxkTm9kZXMoZC5ub2RlKS5tYXAobiA9PiBuLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMubmF2aWdhdGlvbkZpbHRlci5pZFZhbHVlID0gdGhpcy5nZXROYXZpZ2F0aW9uRmlsdGVyKHJvd0RhdGFzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsYXllclR5cGUgPT0gJ3BhdGhjb2RlJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHBbJ25hdk5vZGVQYXRoQ29kZSddID0gZC5kYXRhW2RhdGFGaWVsZF1bcGF0aEZpZWxkXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwWyduYXZOb2RlUGF0aENvZGUnXSA9IHRoaXMuaW5zLmdldFBhdGhDb2RlKGQuZGF0YSwgb3BzLnRyZWVJbmZvKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmluc1snbmF2Tm9kZVBhdGhDb2RlJ10gPSBwWyduYXZOb2RlUGF0aENvZGUnXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmluc1snbmF2Tm9kZVBhdGhDb2RlJ10gPSAnJztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGFDbXBSZWYgPSB0aGlzLmdldENvbXBvbmVudEluc3RhbmNlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgeyBzb3J0TmFtZSwgc29ydE9yZGVyIH0gPSBkYXRhQ21wUmVmO1xyXG4gICAgICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24ocCwgeyBzZWFyY2g6IHRoaXMuaW5zLl9zZWFyY2hTdGF0ZSwgc29ydE5hbWUsIHNvcnRPcmRlciB9KTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pbnMuaHR0cE1nci5nZXREYXRhKHAsICdsaXN0Jyk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICApXHJcbiAgICAgICAgICAgIC5zdWJzY3JpYmUocmVzID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5zLmNsb3NlTG9hZGluZygpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnMubG9hZERhdGFXaGVuT3BlbiA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gaWYgKHRoaXMuaW5zLnVzZUZhdm9yaXRlICYmICF0aGlzLmlucy5pc1RyZWUoKSkge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgIHRoaXMuaW5zLmZhdkhlbHBlci51cGRhdGVGYXZvcml0ZXNTdGF0dXMocmVzLml0ZW1zKTtcclxuICAgICAgICAgICAgICAgIC8vIH1cclxuICAgICAgICAgICAgICAgIC8vIHRoaXMuaW5zLmxvYWREYXRhVGFibGVEYXRhKHJlcyk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5zLmxvYWREYXRhKHJlcywgZmFsc2UpO1xyXG5cclxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIOmAieS4reaVsOaNrlxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zLnNlbGVjdGlvbk1nci5zZWxlY3RDdXJyZW50VmFsdWUoKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5jaGFuZ2VEZXRlY3Rvci5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLmlucy5sZWZ0Q29tcG9uZW50UmVmLmluc3RhbmNlLmNyZWF0ZUNvbXBvbmVudCgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOiOt+WPluWFs+iBlOaVsOaNriwg5Y+z5L6n5pWw5o2u5LitIOWFs+iBlOWQhOWtl+auteeahOWAvFxyXG4gICAgcHJpdmF0ZSBnZXROYXZpZ2F0aW9uRmlsdGVyKG5hdlJvdzogYW55KSB7XHJcbiAgICAgICAgaWYgKHRoaXMuaW5zLm5hdmlnYXRpb25PcHRpb25zLnJlbGF0aW9ucyAmJiB0aGlzLmlucy5uYXZpZ2F0aW9uT3B0aW9ucy5yZWxhdGlvbnMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IFtdO1xyXG4gICAgICAgICAgICB0aGlzLmlucy5uYXZpZ2F0aW9uT3B0aW9ucy5yZWxhdGlvbnMuZm9yRWFjaChyID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGsgPSByLmdyb3VwRmllbGQ7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBkRmllbGQgPSByLmhlbHBGaWVsZDtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHJmOiBhbnkgPSB7IGZpZWxkTmFtZTogZEZpZWxkLCBmaWVsZFZhbHVlOiAnJyB9O1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KG5hdlJvdykpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWxzID0gbmF2Um93Lm1hcChuID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGsuc3BsaXQoJy4nKS5yZWR1Y2UoKG8sIGMpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvW2NdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBuKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICByZi5maWVsZFZhbHVlID0gdmFscy5qb2luKCcsJyk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJmLmZpZWxkVmFsdWUgPSBrLnNwbGl0KCcuJykucmVkdWNlKChvLCBjKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvW2NdO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sIG5hdlJvdyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gocmYpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiAnJztcclxuICAgIH1cclxufVxyXG4iXX0=