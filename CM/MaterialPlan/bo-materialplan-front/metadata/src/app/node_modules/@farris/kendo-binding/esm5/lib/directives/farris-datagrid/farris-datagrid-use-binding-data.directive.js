import { Directive, HostListener, EventEmitter, Output } from '@angular/core';
import { Subject } from 'rxjs';
import { BindingData, ChangeType, ViewModel, DataTypeInfo, EntityPathConverter, RunMode, ComponentType } from '@farris/devkit';
import { DatagridComponent } from '@farris/ui-datagrid';
import { debounceTime, finalize } from 'rxjs/operators';
// tslint:disable: max-line-length
/*
 * 使用绑定数据指令
 */
var FarrisDatagridUseBindingDataDirective = /** @class */ (function () {
    function FarrisDatagridUseBindingDataDirective(bindingData, viewModel, grid) {
        this.bindingData = bindingData;
        this.viewModel = viewModel;
        this.grid = grid;
        // 排序字段
        this.sortFields = null;
        // 排序方向
        this.sortDirections = null;
        this.parentId = null;
        /**
         * 过滤条件
         */
        this.filters = null;
        /**
         * 渲染grid
         */
        this.renderGridSubject = new Subject();
        /**
         * 选中行切换事件
         */
        this.selectedRowChange = new EventEmitter();
        this.setChecks([]);
        this.registerEvent();
    }
    Object.defineProperty(FarrisDatagridUseBindingDataDirective.prototype, "props", {
        get: function () {
            return this._PROPS;
        },
        set: function (value) {
            this._PROPS = value;
        },
        enumerable: true,
        configurable: true
    });
    // #region Ng Event
    FarrisDatagridUseBindingDataDirective.prototype.ngOnInit = function () {
        var _this = this;
        var _a = (this.getPagingInfo() || {}).pageSize, pageSize = _a === void 0 ? 0 : _a;
        if (pageSize !== 0) {
            // 启用分页
            if ((!this.grid.pageList || this.grid.pageList.length < 1) && typeof this.grid['setPageList'] === 'function') {
                this.grid['setPageList']([pageSize, pageSize * 2, pageSize * 3, pageSize * 4]);
            }
        }
        this.setComponentRef();
        this.bindData();
        window.setTimeout(function () {
            _this.updateSelectedRow();
        }, 0);
        this.registerBindingDataChangeEvent();
        this.renderGridSubject.pipe(debounceTime(500)).subscribe(function (change) {
            if (!_this.viewModel || !_this.viewModel.frameContext || _this.viewModel.frameContext.isDisposed) {
                return;
            }
            _this.bindData(change);
        });
        if (this.viewModel && this.viewModel.frameContext && this.viewModel.frameContext.frameComponent) {
            this.viewModel.frameContext.frameComponent.componentType = ComponentType.farrisDataGridComponent;
        }
    };
    FarrisDatagridUseBindingDataDirective.prototype.ngOnChanges = function (changes) {
        this.bindData();
    };
    Object.defineProperty(FarrisDatagridUseBindingDataDirective.prototype, "primaryKey", {
        // #endregion
        /**
         * 主键
         */
        get: function () {
            return this.bindingList.primaryKey;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FarrisDatagridUseBindingDataDirective.prototype, "bindingList", {
        /**
         * 获取绑定数据
         */
        get: function () {
            // 根实体
            if (this.viewModel.bindingPath === '/' || !this.viewModel.bindingPath) {
                return this.bindingData.list;
            }
            // 子实体
            var bindingPath = this.viewModel.bindingPath.substr(1);
            bindingPath = bindingPath[0].toLowerCase() + bindingPath.substring(1, bindingPath.length);
            var paths = bindingPath.split('/');
            var filteredPaths = paths.filter(function (part) {
                return part !== '';
            });
            return this.bindingData.getValue(filteredPaths);
        },
        enumerable: true,
        configurable: true
    });
    /**
     * 设置组件引用
     */
    FarrisDatagridUseBindingDataDirective.prototype.setComponentRef = function () {
        var appContext = this.viewModel && this.viewModel.frameContext && this.viewModel.frameContext.getFormAppContext();
        var frameId = this.viewModel && this.viewModel.frameContext && this.viewModel.frameContext.frameId;
        var id = this.grid && this.grid.id;
        // 如果frameId不存在或farris grid没有id属性，说明不符合使用场景
        if (!frameId || !id) {
            return;
        }
        var map = appContext && appContext.componentRefs && appContext.componentRefs.get(frameId) || new Map();
        appContext && appContext.componentRefs && appContext.componentRefs.set(frameId, map.set(id, this.grid));
    };
    /**
     * 获取分页信息
     */
    FarrisDatagridUseBindingDataDirective.prototype.getPagingInfo = function () {
        var bindingPath = this.viewModel.bindingPath;
        var bindingData = this.viewModel.bindingData;
        var pagingInfo = bindingData && bindingData.pagingInfo || {};
        if (bindingPath === '/') {
            return pagingInfo;
        }
        else {
            var bindingPaths = bindingPath.substr(1).split('/').filter(function (item) { return !!item && item.length > 0; });
            // 从表及从从表分页和数据是关联的，因为不同的从表行有不同的从从表数据，分页信息的结构为nodeCode_parentId:{分页信息}且分页信息是平级的
            // {pagination:{a_pid:{pageSize:2,pageIndex:1},b_pid:{pageSize:2,pageIndex:1}}}
            // 取出当前路径下实体的nodeCode
            var nodeCode = bindingPaths[bindingPaths.length - 1];
            nodeCode = nodeCode.substr(0, nodeCode.length - 1);
            // 获取当前实体上级的主键
            // const result = pagingInfo[nodeCode] || {};
            // if (result.hasOwnProperty('totalCount')) {
            //   result.total = result.totalCount;
            // }
            // return result;
            var paths = bindingPaths.slice(0, bindingPaths.length - 1);
            var bindingList = bindingData.getValue(paths);
            var _a = (pagingInfo["" + nodeCode] || {}).pageSize, pageSize = _a === void 0 ? 0 : _a;
            // 上级表有数据
            if (bindingList && bindingList.currentId) {
                var key = nodeCode + "_" + bindingList.currentId;
                // const key = nodeCode;
                var result = pagingInfo[key] || {};
                if (result.hasOwnProperty('totalCount')) {
                    result.total = result.totalCount;
                }
                // 上级表虽然有数据，但上级表当前行的下级表可能没有数据，这就导致获取不到分页信息，所以需要在返回前对结果进行处理，如果没有分页信息的话起码应该返回分页大小及当前页码
                if (Object.keys(result).length < 1) {
                    result.pageIndex = 1;
                    result.pageSize = pageSize;
                }
                return result;
            }
            else {
                // 上级表没有数据，此时需要获取当前表的分页信息，如分页大小。当前页默认为1即可。
                return { pageIndex: 1, pageSize: pageSize };
            }
        }
    };
    // #region Input
    /**
     * 组件是否需要更新
     * @param props 当前属性
     * @param nextProps 新属性
     * @param change 变更
     */
    FarrisDatagridUseBindingDataDirective.prototype.shouldComponentUpdate = function (change, data) {
        var props = this.buildProps(data);
        if (this.viewModel && this.viewModel.frameContext && this.viewModel.frameContext.appContext && this.viewModel.frameContext.appContext.runMode === RunMode.highSpeed && change) {
            if (change.type === ChangeType.Load || change.type === ChangeType.Remove || change.type === ChangeType.PaginationInfoChange) {
                return { result: true, props: props };
            }
        }
        var gridProps = this.buildGridProps();
        if (JSON.stringify(props) === JSON.stringify(gridProps)) {
            return { result: false };
        }
        return { result: true, props: props };
    };
    FarrisDatagridUseBindingDataDirective.prototype.registerEvent = function () {
        var _this = this;
        // 排序事件
        this.grid && this.grid.columnSorted && this.grid.columnSorted.subscribe(function (event) {
            var isRemoteSort = _this.grid.remoteSort;
            // 本地排序
            if (!isRemoteSort) {
                _this.sortFields = _this.grid.sortName;
                _this.sortDirections = _this.grid.sortOrder;
                _this.sortBindingList();
                // this.props = this.buildProps();
            }
            else {
                // 服务器端排序
                var groupField = _this.grid && _this.grid.groupField || null;
                var sortFields = _this.grid.sortName && _this.grid.sortName.split(',') || [];
                var sortDirection = _this.grid.sortOrder && _this.grid.sortOrder.split(',') || [];
                if (groupField) {
                    if (!sortFields.includes(groupField)) {
                        sortFields.splice(0, 0, groupField);
                        sortDirection.splice(0, 0, 'asc');
                    }
                }
                // 获取当前entity上所有object属性
                var entityType = _this.viewModel && _this.viewModel.frameContext.repository.entityType || null;
                if (sortFields.length > 0) {
                    if (entityType) {
                        var dataTypeInfo_1 = new DataTypeInfo(entityType);
                        sortFields = sortFields.map(function (field) {
                            //if (field && field.indexOf('.') !== -1) {
                            var paths = field.split('.');
                            var propInfo = dataTypeInfo_1.getPropInfoByPath(paths);
                            var originalField = propInfo && propInfo.metadataInfo['path'] || null;
                            return originalField;
                            //}
                            //return field;
                        });
                    }
                }
                // 遍历属性，根据datafield转换为originalDataField
                var fields = sortFields.join(',');
                var directions = sortDirection.join(',') || 'asc';
                var frameContext = _this.viewModel && _this.viewModel.frameContext || null;
                if (frameContext) {
                    frameContext.repository.sortConditionManager.setConditions(_this.viewModel.bindingPath, fields, directions);
                }
            }
        });
        // 过滤事件
        this.grid && this.grid.filterChanged && this.grid.filterChanged.subscribe(function (event) {
            _this.filters = event;
            if (!_this.grid.remoteFilter) {
                if (_this.bindingList.length > 0 && !_this.bindingList.currentId) {
                    var id = _this.bindingList.getIdByIndex(0);
                    _this.bindingList.setCurrentId(id);
                }
                _this.bindData();
            }
        });
    };
    /**
     * 对bindingList排序
     */
    FarrisDatagridUseBindingDataDirective.prototype.sortBindingList = function () {
        var groupField = this.grid && this.grid.groupField || null;
        if (groupField) {
            var arrSortFields = this.sortFields && this.sortFields.split(',') || [];
            if (!arrSortFields.includes(groupField)) {
                arrSortFields.splice(0, 0, groupField);
                var arrSortDirection = this.sortDirections && this.sortDirections.split(',') || [];
                arrSortDirection.splice(0, 0, 'asc');
                this.sortFields = arrSortFields.join(',');
                this.sortDirections = arrSortDirection.join(',') || 'asc';
            }
        }
        if (this.sortFields && this.sortDirections) {
            this.bindingList.sortBy(this.sortFields, this.sortDirections);
            // this.props = this.buildProps();
        }
        this.bindData();
    };
    // #endregion
    // #region 数据绑定部分
    /**
     * 更新数据
     * @param change? 变更
     */
    FarrisDatagridUseBindingDataDirective.prototype.bindData = function (change) {
        var _this = this;
        var isRemoteFilter = this.grid && this.grid.remoteFilter || false;
        // 先执行排序
        if (this.sortFields && !this.grid.editable && change && (change.type === 'Load' || change.type === 'SelectionChanged')) {
            this.sortBindingList();
            return;
        }
        // 新增数据时清空表格筛选条件
        if ((this.grid.editable === true || change && change.type === ChangeType.Append) && this.filters && Object.keys(this.filters).length > 0 && !isRemoteFilter) {
            this.filters = {};
            this.grid.clearCondition();
        }
        // 再toJSON
        var data = this.bindingList.toJSON();
        if (this.filters && Object.keys(this.filters).length > 0 && !isRemoteFilter) {
            data = this.grid.clientFilterService.executeFilter(data, this.filters);
        }
        if (this.filters && Object.keys(this.filters).length > 0 && !isRemoteFilter && (!change || change && change.type !== ChangeType.SelectionChanged && change.type !== ChangeType.GlobalSelectionChanged)) {
            if (data && data.length > 0) {
                // 判断当前行是否在过滤后的数据中
                var row = data.find(function (item) { return item[_this.bindingList.primaryKey] === _this.bindingList.currentId; });
                if (!row) {
                    var firstRowId = data[0][this.bindingList.primaryKey];
                    this.bindingList.setCurrentId(firstRowId, true, true);
                }
            }
            else {
                // 本地过滤完之后没有数据了
                // this.bindingList.currentId = null;
                this.bindingList.setCurrentId(null, true, true, true);
                // 单选时清空ids
                if (!this.grid.multiSelect) {
                    this.setChecks([]);
                }
            }
        }
        var result = this.shouldComponentUpdate(change, data);
        if (!result.result) {
            return;
        }
        // const nextProps = this.buildProps(result);
        this.renderGrid(result.props);
        this.props = JSON.parse(JSON.stringify(result.props));
    };
    /**
     * 渲染grid
     * @param props 属性
     */
    FarrisDatagridUseBindingDataDirective.prototype.renderGrid = function (props) {
        var pageIndex = props.pageIndex, pageSize = props.pageSize, total = props.total, pagination = props.pagination, data = props.data;
        var virtualizedLoad = this.grid.virtualizedAsyncLoad || false;
        this.grid.total = total;
        this.grid.pageSize = pageSize;
        this.grid.pageIndex = pageIndex;
        this.grid.pagination = pagination;
        this.grid.controlPaginationState = false;
        // this.endCellEdit();
        if (pageSize === 0) {
            this.grid.pagination = false;
            this.grid.pageIndex = 1;
            // 修复不分页时grid启用分组仍会重新邦数的问题
            // this.grid.pageSize = total;
        }
        if (virtualizedLoad) {
            this.grid.loadVirtualData({
                items: data,
                pageIndex: pageIndex,
                pageSize: pageSize,
                total: total
            });
        }
        else {
            this.grid.loadData(data);
        }
    };
    /**
     * 构造表格数据属性
     */
    FarrisDatagridUseBindingDataDirective.prototype.buildProps = function (datas) {
        var data;
        if (typeof (datas) !== 'undefined') {
            data = datas;
        }
        else {
            data = this.bindingList.toJSON();
        }
        // let skip = 0;
        var _a = this.getPagingInfo() || {}, _b = _a.pageIndex, pageIndex = _b === void 0 ? 1 : _b, _c = _a.pageSize, pageSize = _c === void 0 ? 0 : _c;
        var _d = (this.getPagingInfo() || {}).total, total = _d === void 0 ? 0 : _d;
        // if (pageIndex > 0) {
        //   skip = (pageIndex - 1) * pageSize;
        // }
        if (pageSize === 0 && total === 0) {
            total = data.length;
        }
        return { data: data, pageIndex: pageIndex, pageSize: pageSize, total: total, pagination: pageSize !== 0 };
    };
    /**
     * 计算grid状态
     */
    FarrisDatagridUseBindingDataDirective.prototype.buildGridProps = function () {
        var data = this.grid.data || [];
        var skip = 0;
        var _a = { pageIndex: this.grid.pageIndex, pageSize: this.grid.pageSize }, _b = _a.pageIndex, pageIndex = _b === void 0 ? 1 : _b, _c = _a.pageSize, pageSize = _c === void 0 ? 0 : _c;
        var total = this.grid.total || 0;
        if (pageIndex > 0) {
            skip = (pageIndex - 1) * pageSize;
        }
        if (pageSize === 0 && total === 0) {
            total = data.length;
        }
        return { data: data, pageIndex: pageIndex, pageSize: pageSize, total: total, pagination: this.grid.pagination };
    };
    /**
     * 数据源发生变更
     * @param change 变更
     */
    FarrisDatagridUseBindingDataDirective.prototype.onBindingDataChange = function (change) {
        this.updateDataSource(change);
        this.updateSelectedRow(change);
        // this.updateGrid(change);
        // 不清除勾选行，需要保留勾选状态
        // this.clearCheckedRows(change);
        this.endCellEdit(change);
        // 更新勾选行数据
        this.updateCheckedRows(change);
        this.updateData(change);
    };
    /**
     * 更新数据
     */
    FarrisDatagridUseBindingDataDirective.prototype.updateDataSource = function (change) {
        /*if (change) {
          const isMatch = this.checkIfChangeMatchBindingPath(change);
          if (!isMatch) {
            return;
          }
        }*/
        if (change && change.type === ChangeType.ValueChanged) {
            this.renderGridSubject.next(change);
        }
        else if (change && (change.type === ChangeType.SelectionChanged || change.type === ChangeType.GlobalSelectionChanged)) {
            if (this.bindingList.currentId === (this.grid.selectedRow && this.grid.selectedRow.id) && this.grid.total > 0) {
            }
            else {
                this.bindData(change);
            }
        }
        else {
            this.bindData(change);
        }
    };
    // private endCellEdit() {
    //   const isEditing = this.grid.isEditing();
    //   if (isEditing) {
    //     this.grid.endCellEdit();
    //   }
    // }
    FarrisDatagridUseBindingDataDirective.prototype.endCellEdit = function (change) {
        var isEditing = this.grid.isEditing();
        if (change.type === ChangeType.Load && isEditing) {
            this.grid.endCellEdit();
        }
    };
    /**
     * 设置grid当前选择行
     * @param change 变更
     */
    FarrisDatagridUseBindingDataDirective.prototype.updateSelectedRow = function (change) {
        if (!this.bindingList || !this.bindingList.currentId) {
            return;
        }
        // 页码切换时不执行当前行切换
        if (change && change.type === ChangeType.PaginationInfoChange) {
            return;
        }
        if (this.viewModel && this.viewModel.frameContext.bindingData.rowSelectedEventSuspend === true) {
            return;
        }
        var _a = (this.grid.selectedRow || {}).id, gridSelectedRowId = _a === void 0 ? null : _a;
        var currentId = this.bindingList.currentId;
        // grid当前行与bingingList当前行一致，无须切换
        if (gridSelectedRowId === currentId) {
            var isMatch = change && (change.path.toString() === this.viewModel.bindingPath.split('/').filter(function (p) { return p; }).toString());
            if (change && change.type === ChangeType.Load && isMatch) {
                this.grid.clearSelections();
                this.grid.selectRow(currentId, true, true);
            }
            return;
        }
        this.selectGridRow(this.bindingList.currentId);
    };
    /**
     * 注册bindingdata变化事件
     */
    FarrisDatagridUseBindingDataDirective.prototype.registerBindingDataChangeEvent = function () {
        var _this = this;
        this.bindingDataChangeEvent = this.bindingData.changes.subscribe(function (change) {
            _this.onBindingDataChange(change);
        });
        this.viewModel.frameContext.appContext.messagePipe.subscribe(function (message) {
            if (message === 'bindData') {
                _this.bindData();
            }
        });
    };
    /**
     * 取消bindingdata变化订阅
     */
    FarrisDatagridUseBindingDataDirective.prototype.unRegisterBindingDataChangeEvent = function () {
        if (this.bindingDataChangeEvent && typeof (this.bindingDataChangeEvent.unsubscribe) === 'function') {
            this.bindingDataChangeEvent.unsubscribe();
        }
    };
    /**
     * 触发页码切换事件
     * @description 本方法适用场景仅为父级grid数据重新load，需要触发该grid重新取数使用。其他场景请勿使用
     * @TODO: 待重构，控制下级数据加载应该依赖表格的行切换事件，临时这样处理，后续提供LoadChildren事件
     */
    FarrisDatagridUseBindingDataDirective.prototype.updateData = function (change) {
        var _this = this;
        if (!(change && (change.type === ChangeType.SelectionChanged || change.type === ChangeType.Load))) {
            return;
        }
        var bindingPath = this.viewModel.bindingPath;
        var eventBindingPath = '/' + change.path.join('/');
        var isRetrieve = this.viewModel.frameContext.appContext.params.get('retrieveing') || false;
        if (change.path.length < 1 || bindingPath === '/' || bindingPath === eventBindingPath || !bindingPath.startsWith(eventBindingPath)) {
            return;
        }
        // retrieve时会自动带回从表第一页及从表第一行的从从表数据，所以不需要再去单独请求
        if (isRetrieve) {
            return;
        }
        var fullPaths = EntityPathConverter.toEntityPathArray(this.viewModel.bindingPath, this.bindingData);
        var paths = fullPaths.slice(0, fullPaths.length - 1);
        var parent = this.bindingList.parent;
        var parentId = parent && parent[parent.primaryKey];
        // 上级表没有数据
        if (!parentId) {
            return;
        }
        // 获取nodecode
        var bindingPaths = this.viewModel.bindingPath.split('/').filter(function (item) { return item; });
        var nodeCode = bindingPaths[bindingPaths.length - 1];
        nodeCode = nodeCode.substr(0, nodeCode.length - 1);
        // const configPath = `/${nodeCode}_${parentId}`;
        var configPath = "/" + nodeCode;
        var _a = (this.viewModel.frameContext.repository.entityCollection.getPaginationConfigByPath(configPath) || {}).pageIndex, pageIndex = _a === void 0 ? 1 : _a;
        var _b = (this.viewModel.frameContext.repository.entityCollection.getPaginationConfigByPath(configPath) || {}).pageSize, pageSize = _b === void 0 ? 0 : _b;
        var parentNodeCode = change.path[change.path.length - 1];
        var parentConfigPath = '/' + parentNodeCode.substring(0, parentNodeCode.length - 1);
        var _c = (this.viewModel.frameContext.repository.entityCollection.getPaginationConfigByPath(parentConfigPath) || {}).pageSize, parentPageSize = _c === void 0 ? 0 : _c;
        var isQueryChild = this.viewModel.frameContext.appContext.params.get('queryChild') || false;
        if (isQueryChild) {
            // this.viewModel.frameContext.appContext.params.delete('queryChild');
            pageIndex = 1;
        }
        // 当上级表切换行时
        if (parentPageSize + pageSize !== 0) {
            this.viewModel.frameContext.appContext.params.set('forceQueryChild', true);
            this.viewModel.frameContext.repository.queryChild(paths, pageIndex, pageSize).pipe(finalize(function () { return _this.viewModel.frameContext.appContext.params.delete('forceQueryChild'); })).subscribe();
        }
    };
    FarrisDatagridUseBindingDataDirective.prototype.ngOnDestroy = function () {
        this.unRegisterBindingDataChangeEvent();
    };
    // #endregion
    // #region 事件发射器
    /**
     * 发射选中行切换事件
     * @description 统一单选模式和多选模式下的行切换事件
     */
    FarrisDatagridUseBindingDataDirective.prototype.fireSelectedRowChange = function (selectedRowContext) {
        this.selectedRowChange.emit(selectedRowContext);
    };
    /**
     * 清空选定行
     * @param change 变更
     */
    FarrisDatagridUseBindingDataDirective.prototype.clearCheckedRows = function (change) {
        if (change.type === ChangeType.Load && this.grid.multiSelect) {
            var isMatch = this.checkIfChangeMatchBindingPath(change);
            if (isMatch) {
                this.setChecks([]);
                if (typeof (this.grid.clearCheckeds) === 'function') {
                    this.grid.clearCheckeds();
                }
            }
        }
    };
    // #endregion
    // #region 通信
    /**
     * 设置BindingList的当前行
     * @param id 当前行内码
     */
    FarrisDatagridUseBindingDataDirective.prototype.setSelectionIdToBindingData = function (id) {
        // 如果当前行不存在，则强制设置
        if (!id) {
            this.bindingList.currentId = id;
            if (!this.grid.multiSelect) {
                this.setChecks([]);
            }
            return;
        }
        if (this.bindingList.currentId !== id) {
            this.bindingList.setCurrentId(id, true);
        }
        // 单选模式下将当前行设置到ids
        if (!this.grid.multiSelect) {
            this.setChecks([id]);
        }
    };
    FarrisDatagridUseBindingDataDirective.prototype.updateCheckedRows = function (changes) {
        if (changes.type === ChangeType.Load) {
            this.setCheckedRows();
        }
        else if (changes.type === ChangeType.ValueChanged) {
            var ids = this.getChecks();
            if (changes.id && ids.includes(changes.id)) {
                this.setCheckedRows();
            }
        }
    };
    /**
     * 设置选择行
     */
    FarrisDatagridUseBindingDataDirective.prototype.setChecks = function (ids) {
        this.viewModel.uiState.setPropertyValue('ids', ids);
        this.setCheckedRows(ids);
    };
    /**
     * 获取勾选行id数组
     * @returns
     */
    FarrisDatagridUseBindingDataDirective.prototype.getChecks = function () {
        return this.viewModel.uiState['ids'] || [];
    };
    /**
     * 更新勾选行数据
     */
    FarrisDatagridUseBindingDataDirective.prototype.setCheckedRows = function (ids) {
        var _this = this;
        // 高速模式时不再设置rows
        // if (this.viewModel.frameContext.appContext.runMode === RunMode.highSpeed) {
        //   return;
        // }
        if (typeof ids === 'undefined') {
            ids = this.viewModel.uiState['ids'] || [];
        }
        if (!Array.isArray(ids) || ids.length < 1) {
            // 此时ids没有值，rows中也不应该有
            this.viewModel.uiState.setPropertyValue('rows', null);
            return;
        }
        var list = [];
        // TODO：rows中数据在高速模式和普通模式下多语字段的值表现不一致，高速模式下多语字段值为对象，普通模式为当前语言。暂不处理高速模式场景
        if (this.viewModel.frameContext.appContext.runMode === RunMode.highSpeed) {
            list = this.grid.data || [];
        }
        else {
            list = this.bindingList.toJSON({ ignoreMultiLangInput: true });
        }
        var rows = this.viewModel.uiState['rows'] || new Map();
        var result = new Map();
        ids.forEach(function (id) {
            var item = list.find(function (item) { return item[_this.primaryKey] === id; });
            var otherPageItem = rows.get(id);
            if (item) {
                result.set(id, item);
            }
            else if (otherPageItem) {
                result.set(id, otherPageItem);
            }
        });
        this.viewModel.uiState.setPropertyValue('rows', result);
    };
    /**
     * 选中grid行
     * @param id id
     */
    FarrisDatagridUseBindingDataDirective.prototype.selectGridRow = function (id) {
        this.grid.selectRow(id);
        this.grid.scrollToCurrentRow();
    };
    // #endregion
    // #region 事件处理器
    /**
     * 页码切换事件
     * @param event event
     */
    FarrisDatagridUseBindingDataDirective.prototype.pageChangedHandler = function (event) {
        var pageIndex = event.pageIndex, pageSize = event.pageSize;
        if (pageIndex < 1) {
            pageIndex = 1;
        }
        var skip = (pageIndex - 1) * pageSize;
        this.bindingData.setPagingInfo(skip, pageSize, this.bindingData.bindingPath);
    };
    /**
     * 行切换事件
     * @param event event
     */
    FarrisDatagridUseBindingDataDirective.prototype.selectedRowChanged = function (event) {
        var index = event.index, data = event.data;
        var id = data[this.primaryKey];
        this.setSelectionIdToBindingData(id);
        this.fireSelectedRowChange(event);
    };
    /**
     * 取消行选择事件
     * @param event event
     */
    FarrisDatagridUseBindingDataDirective.prototype.unSelected = function (event) {
        if (!event) {
            return;
        }
        var _a = event.data, data = _a === void 0 ? {} : _a;
        var id = data[this.primaryKey];
        var currentId = this.bindingList.currentId;
        if (id === currentId) {
            this.setSelectionIdToBindingData(null);
        }
        // this.fireSelectedRowChange(event);
    };
    /**
     * 勾选行发生变化
     * @param event event
     */
    FarrisDatagridUseBindingDataDirective.prototype.checkedChanged = function (event) {
        event = event || [];
        var ids = event.map(function (item) { return item.id; });
        this.setChecks(ids);
    };
    /**
     * 分页大小变更事件
     * @param event event
     */
    FarrisDatagridUseBindingDataDirective.prototype.pageSizeChanged = function (event) {
        var pageIndex = event.pageIndex, pageSize = event.pageSize;
        var skip = 0; //(pageIndex - 1) * pageSize;
        // this.bindingList.setPaginationInfo(skip, pageSize);
        this.bindingData.setPagingInfo(skip, pageSize, this.bindingData.bindingPath);
    };
    /**
     * grid滚动加载数据
     * @param event event
     */
    FarrisDatagridUseBindingDataDirective.prototype.scrollY = function (event) {
        var pageIndex = event.pager, pageSize = event.pageSize;
        var skip = (pageIndex - 1) * pageSize;
        this.bindingData.setPagingInfo(skip, pageSize, this.bindingData.bindingPath);
    };
    FarrisDatagridUseBindingDataDirective.prototype.filterChanged = function (event) {
        this.filters = event;
    };
    // #endregion
    FarrisDatagridUseBindingDataDirective.prototype.checkIfChangeMatchBindingPath = function (change) {
        var isMatch = false;
        if (!change || !change.path) {
            return isMatch;
        }
        var changePathArray = change.path;
        if (!changePathArray) {
            return isMatch;
        }
        if (!(this.bindingData) && !(this.bindingData.bindingPath)) {
            return isMatch;
        }
        var bingdingPathArray = this.bindingData.bindingPath.split('/');
        if (bingdingPathArray.length <= 0) {
            return isMatch;
        }
        if (changePathArray.length === 0) { // 主表
            if (this.bindingData.bindingPath === '/') {
                isMatch = true;
            }
        }
        else if (change.path.length === 1) { // 主从表
            if (bingdingPathArray.length === 2 && bingdingPathArray[1] === change.path[0]) {
                isMatch = true;
            }
        }
        else if (change.path.length === 2) { // 主从从表
            if (bingdingPathArray.length === 3 && bingdingPathArray[1] === change.path[0] && bingdingPathArray[2] === change.path[1]) {
                isMatch = true;
            }
        }
        return isMatch;
    };
    FarrisDatagridUseBindingDataDirective.decorators = [
        { type: Directive, args: [{
                    selector: '[farris-use-binding-data]'
                },] }
    ];
    /** @nocollapse */
    FarrisDatagridUseBindingDataDirective.ctorParameters = function () { return [
        { type: BindingData },
        { type: ViewModel },
        { type: DatagridComponent }
    ]; };
    FarrisDatagridUseBindingDataDirective.propDecorators = {
        selectedRowChange: [{ type: Output }],
        pageChangedHandler: [{ type: HostListener, args: ['pageChanged', ['$event'],] }],
        selectedRowChanged: [{ type: HostListener, args: ['selectChanged', ['$event'],] }],
        unSelected: [{ type: HostListener, args: ['unSelect', ['$event'],] }],
        checkedChanged: [{ type: HostListener, args: ['checkedChange', ['$event'],] }],
        pageSizeChanged: [{ type: HostListener, args: ['pageSizeChanged', ['$event'],] }],
        scrollY: [{ type: HostListener, args: ['scrollYLoad', ['$event'],] }],
        filterChanged: [{ type: HostListener, args: ['filterChanged', ['$event'],] }]
    };
    return FarrisDatagridUseBindingDataDirective;
}());
export { FarrisDatagridUseBindingDataDirective };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmFycmlzLWRhdGFncmlkLXVzZS1iaW5kaW5nLWRhdGEuZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9rZW5kby1iaW5kaW5nLyIsInNvdXJjZXMiOlsibGliL2RpcmVjdGl2ZXMvZmFycmlzLWRhdGFncmlkL2ZhcnJpcy1kYXRhZ3JpZC11c2UtYmluZGluZy1kYXRhLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUErQyxZQUFZLEVBQ3BFLFlBQVksRUFBRSxNQUFNLEVBQ3JCLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxPQUFPLEVBQWdCLE1BQU0sTUFBTSxDQUFDO0FBQzdDLE9BQU8sRUFBRSxXQUFXLEVBQXVCLFVBQVUsRUFBRSxTQUFTLEVBQStDLFlBQVksRUFBaUIsbUJBQW1CLEVBQUUsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ2hOLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3hELE9BQU8sRUFBRSxZQUFZLEVBQUUsUUFBUSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDeEQsa0NBQWtDO0FBRWxDOztHQUVHO0FBQ0g7SUE4QkUsK0NBQW1CLFdBQXdCLEVBQVMsU0FBb0IsRUFBUyxJQUF1QjtRQUFyRixnQkFBVyxHQUFYLFdBQVcsQ0FBYTtRQUFTLGNBQVMsR0FBVCxTQUFTLENBQVc7UUFBUyxTQUFJLEdBQUosSUFBSSxDQUFtQjtRQXpCeEcsT0FBTztRQUNDLGVBQVUsR0FBVyxJQUFJLENBQUM7UUFDbEMsT0FBTztRQUNDLG1CQUFjLEdBQVcsSUFBSSxDQUFDO1FBQzlCLGFBQVEsR0FBVyxJQUFJLENBQUM7UUFDaEM7O1dBRUc7UUFDSyxZQUFPLEdBQVEsSUFBSSxDQUFDO1FBUTVCOztXQUVHO1FBQ0ssc0JBQWlCLEdBQWlCLElBQUksT0FBTyxFQUFPLENBQUM7UUFDN0Q7O1dBRUc7UUFDTyxz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QjtTQUNGO2FBQU0sSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUUsRUFBRSxPQUFPO1lBQzVDLElBQUksaUJBQWlCLENBQUMsTUFBTSxLQUFLLENBQUMsSUFBSSxpQkFBaUIsQ0FBQyxDQUFDLENBQUMsS0FBSyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLGlCQUFpQixDQUFDLENBQUMsQ0FBQyxLQUFLLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUU7Z0JBQ3hILE9BQU8sR0FBRyxJQUFJLENBQUM7YUFDaEI7U0FDRjtRQUVELE9BQU8sT0FBTyxDQUFDO0lBQ2pCLENBQUM7O2dCQS92QkYsU0FBUyxTQUFDO29CQUNULFFBQVEsRUFBRSwyQkFBMkI7aUJBQ3RDOzs7O2dCQVZRLFdBQVc7Z0JBQW1DLFNBQVM7Z0JBQ3ZELGlCQUFpQjs7O29DQW1DdkIsTUFBTTtxQ0FxbkJOLFlBQVksU0FBQyxhQUFhLEVBQUUsQ0FBQyxRQUFRLENBQUM7cUNBY3RDLFlBQVksU0FBQyxlQUFlLEVBQUUsQ0FBQyxRQUFRLENBQUM7NkJBWXhDLFlBQVksU0FBQyxVQUFVLEVBQUUsQ0FBQyxRQUFRLENBQUM7aUNBaUJuQyxZQUFZLFNBQUMsZUFBZSxFQUFFLENBQUMsUUFBUSxDQUFDO2tDQVV4QyxZQUFZLFNBQUMsaUJBQWlCLEVBQUUsQ0FBQyxRQUFRLENBQUM7MEJBWTFDLFlBQVksU0FBQyxhQUFhLEVBQUUsQ0FBQyxRQUFRLENBQUM7Z0NBTXRDLFlBQVksU0FBQyxlQUFlLEVBQUUsQ0FBQyxRQUFRLENBQUM7O0lBeUMzQyw0Q0FBQztDQUFBLEFBandCRCxJQWl3QkM7U0E5dkJZLHFDQUFxQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgRGlyZWN0aXZlLCBPbkluaXQsIE9uQ2hhbmdlcywgT25EZXN0cm95LCBTaW1wbGVDaGFuZ2VzLCBIb3N0TGlzdGVuZXIsXHJcbiAgRXZlbnRFbWl0dGVyLCBPdXRwdXRcclxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgU3ViamVjdCwgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IEJpbmRpbmdEYXRhLCBCaW5kaW5nTGlzdCwgQ2hhbmdlLCBDaGFuZ2VUeXBlLCBWaWV3TW9kZWwsIEFwcENvbnRleHQsIEZyYW1lQ29udGV4dCwgRmllbGRNZXRhZGF0YVV0aWwsIERhdGFUeXBlSW5mbywgQmluZGluZ09iamVjdCwgRW50aXR5UGF0aENvbnZlcnRlciwgUnVuTW9kZSwgQ29tcG9uZW50VHlwZSB9IGZyb20gJ0BmYXJyaXMvZGV2a2l0JztcclxuaW1wb3J0IHsgRGF0YWdyaWRDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLWRhdGFncmlkJztcclxuaW1wb3J0IHsgZGVib3VuY2VUaW1lLCBmaW5hbGl6ZSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuLy8gdHNsaW50OmRpc2FibGU6IG1heC1saW5lLWxlbmd0aFxyXG5cclxuLypcclxuICog5L2/55So57uR5a6a5pWw5o2u5oyH5LukXHJcbiAqL1xyXG5ARGlyZWN0aXZlKHtcclxuICBzZWxlY3RvcjogJ1tmYXJyaXMtdXNlLWJpbmRpbmctZGF0YV0nXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBGYXJyaXNEYXRhZ3JpZFVzZUJpbmRpbmdEYXRhRGlyZWN0aXZlIGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMsIE9uRGVzdHJveSB7XHJcbiAgcHJpdmF0ZSBfUFJPUFM6IHsgW3Byb3BOYW1lOiBzdHJpbmddOiBhbnkgfTtcclxuICAvLyDmjpLluo/lrZfmrrVcclxuICBwcml2YXRlIHNvcnRGaWVsZHM6IHN0cmluZyA9IG51bGw7XHJcbiAgLy8g5o6S5bqP5pa55ZCRXHJcbiAgcHJpdmF0ZSBzb3J0RGlyZWN0aW9uczogc3RyaW5nID0gbnVsbDtcclxuICBwcml2YXRlIHBhcmVudElkOiBzdHJpbmcgPSBudWxsO1xyXG4gIC8qKlxyXG4gICAqIOi/h+a7pOadoeS7tlxyXG4gICAqL1xyXG4gIHByaXZhdGUgZmlsdGVyczogYW55ID0gbnVsbDtcclxuICBwcm90ZWN0ZWQgZ2V0IHByb3BzKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX1BST1BTO1xyXG4gIH1cclxuICBwcm90ZWN0ZWQgc2V0IHByb3BzKHZhbHVlKSB7XHJcbiAgICB0aGlzLl9QUk9QUyA9IHZhbHVlO1xyXG4gIH1cclxuICBwcm90ZWN0ZWQgYmluZGluZ0RhdGFDaGFuZ2VFdmVudDogU3Vic2NyaXB0aW9uO1xyXG4gIC8qKlxyXG4gICAqIOa4suafk2dyaWRcclxuICAgKi9cclxuICBwcml2YXRlIHJlbmRlckdyaWRTdWJqZWN0OiBTdWJqZWN0PGFueT4gPSBuZXcgU3ViamVjdDxhbnk+KCk7XHJcbiAgLyoqXHJcbiAgICog6YCJ5Lit6KGM5YiH5o2i5LqL5Lu2XHJcbiAgICovXHJcbiAgQE91dHB1dCgpIHNlbGVjdGVkUm93Q2hhbmdlOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG5cclxuICBjb25zdHJ1Y3RvcihwdWJsaWMgYmluZGluZ0RhdGE6IEJpbmRpbmdEYXRhLCBwdWJsaWMgdmlld01vZGVsOiBWaWV3TW9kZWwsIHB1YmxpYyBncmlkOiBEYXRhZ3JpZENvbXBvbmVudCkge1xyXG4gICAgdGhpcy5zZXRDaGVja3MoW10pO1xyXG4gICAgdGhpcy5yZWdpc3RlckV2ZW50KCk7XHJcbiAgfVxyXG5cclxuICAvLyAjcmVnaW9uIE5nIEV2ZW50XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gICAgY29uc3QgeyBwYWdlU2l6ZSA9IDAgfSA9IHRoaXMuZ2V0UGFnaW5nSW5mbygpIHx8IHt9O1xyXG4gICAgaWYgKHBhZ2VTaXplICE9PSAwKSB7XHJcbiAgICAgIC8vIOWQr+eUqOWIhumhtVxyXG4gICAgICBpZiAoKCF0aGlzLmdyaWQucGFnZUxpc3QgfHwgdGhpcy5ncmlkLnBhZ2VMaXN0Lmxlbmd0aCA8IDEpICYmIHR5cGVvZiB0aGlzLmdyaWRbJ3NldFBhZ2VMaXN0J10gPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICB0aGlzLmdyaWRbJ3NldFBhZ2VMaXN0J10oW3BhZ2VTaXplLCBwYWdlU2l6ZSAqIDIsIHBhZ2VTaXplICogMywgcGFnZVNpemUgKiA0XSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHRoaXMuc2V0Q29tcG9uZW50UmVmKCk7XHJcbiAgICB0aGlzLmJpbmREYXRhKCk7XHJcbiAgICB3aW5kb3cuc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgIHRoaXMudXBkYXRlU2VsZWN0ZWRSb3coKTtcclxuICAgIH0sIDApO1xyXG4gICAgdGhpcy5yZWdpc3RlckJpbmRpbmdEYXRhQ2hhbmdlRXZlbnQoKTtcclxuICAgIHRoaXMucmVuZGVyR3JpZFN1YmplY3QucGlwZShcclxuICAgICAgZGVib3VuY2VUaW1lKDUwMClcclxuICAgICkuc3Vic2NyaWJlKChjaGFuZ2U6IENoYW5nZSkgPT4ge1xyXG4gICAgICBpZiAoIXRoaXMudmlld01vZGVsIHx8ICF0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQgfHwgdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LmlzRGlzcG9zZWQpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5iaW5kRGF0YShjaGFuZ2UpO1xyXG4gICAgfSk7XHJcbiAgICBpZiAodGhpcy52aWV3TW9kZWwgJiYgdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0ICYmIHRoaXMudmlld01vZGVsLmZyYW1lQ29udGV4dC5mcmFtZUNvbXBvbmVudCkge1xyXG4gICAgICB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQuZnJhbWVDb21wb25lbnQuY29tcG9uZW50VHlwZSA9IENvbXBvbmVudFR5cGUuZmFycmlzRGF0YUdyaWRDb21wb25lbnQ7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XHJcbiAgICB0aGlzLmJpbmREYXRhKCk7XHJcbiAgfVxyXG5cclxuICAvLyAjZW5kcmVnaW9uXHJcblxyXG5cclxuICAvKipcclxuICAgKiDkuLvplK5cclxuICAgKi9cclxuICBwcm90ZWN0ZWQgZ2V0IHByaW1hcnlLZXkoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5iaW5kaW5nTGlzdC5wcmltYXJ5S2V5O1xyXG4gIH1cclxuICAvKipcclxuICAgKiDojrflj5bnu5HlrprmlbDmja5cclxuICAgKi9cclxuICBwcm90ZWN0ZWQgZ2V0IGJpbmRpbmdMaXN0KCk6IEJpbmRpbmdMaXN0IHtcclxuICAgIC8vIOagueWunuS9k1xyXG4gICAgaWYgKHRoaXMudmlld01vZGVsLmJpbmRpbmdQYXRoID09PSAnLycgfHwgIXRoaXMudmlld01vZGVsLmJpbmRpbmdQYXRoKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLmJpbmRpbmdEYXRhLmxpc3Q7XHJcbiAgICB9XHJcbiAgICAvLyDlrZDlrp7kvZNcclxuICAgIGxldCBiaW5kaW5nUGF0aCA9IHRoaXMudmlld01vZGVsLmJpbmRpbmdQYXRoLnN1YnN0cigxKTtcclxuICAgIGJpbmRpbmdQYXRoID0gYmluZGluZ1BhdGhbMF0udG9Mb3dlckNhc2UoKSArIGJpbmRpbmdQYXRoLnN1YnN0cmluZygxLCBiaW5kaW5nUGF0aC5sZW5ndGgpO1xyXG4gICAgY29uc3QgcGF0aHMgPSBiaW5kaW5nUGF0aC5zcGxpdCgnLycpO1xyXG5cclxuICAgIGNvbnN0IGZpbHRlcmVkUGF0aHMgPSBwYXRocy5maWx0ZXIoKHBhcnQ6IHN0cmluZykgPT4ge1xyXG4gICAgICByZXR1cm4gcGFydCAhPT0gJyc7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiB0aGlzLmJpbmRpbmdEYXRhLmdldFZhbHVlKGZpbHRlcmVkUGF0aHMpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDorr7nva7nu4Tku7blvJXnlKhcclxuICAgKi9cclxuICBwcml2YXRlIHNldENvbXBvbmVudFJlZigpIHtcclxuICAgIGNvbnN0IGFwcENvbnRleHQgPSB0aGlzLnZpZXdNb2RlbCAmJiB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQgJiYgdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LmdldEZvcm1BcHBDb250ZXh0KCk7XHJcbiAgICBjb25zdCBmcmFtZUlkID0gdGhpcy52aWV3TW9kZWwgJiYgdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0ICYmIHRoaXMudmlld01vZGVsLmZyYW1lQ29udGV4dC5mcmFtZUlkO1xyXG4gICAgY29uc3QgaWQgPSB0aGlzLmdyaWQgJiYgdGhpcy5ncmlkLmlkO1xyXG4gICAgLy8g5aaC5p6cZnJhbWVJZOS4jeWtmOWcqOaIlmZhcnJpcyBncmlk5rKh5pyJaWTlsZ7mgKfvvIzor7TmmI7kuI3nrKblkIjkvb/nlKjlnLrmma9cclxuICAgIGlmICghZnJhbWVJZCB8fCAhaWQpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgY29uc3QgbWFwID0gYXBwQ29udGV4dCAmJiBhcHBDb250ZXh0LmNvbXBvbmVudFJlZnMgJiYgYXBwQ29udGV4dC5jb21wb25lbnRSZWZzLmdldChmcmFtZUlkKSB8fCBuZXcgTWFwPHN0cmluZywgYW55PigpO1xyXG4gICAgYXBwQ29udGV4dCAmJiBhcHBDb250ZXh0LmNvbXBvbmVudFJlZnMgJiYgYXBwQ29udGV4dC5jb21wb25lbnRSZWZzLnNldChmcmFtZUlkLCBtYXAuc2V0KGlkLCB0aGlzLmdyaWQpKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6I635Y+W5YiG6aG15L+h5oGvXHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIGdldFBhZ2luZ0luZm8oKSB7XHJcbiAgICBjb25zdCBiaW5kaW5nUGF0aCA9IHRoaXMudmlld01vZGVsLmJpbmRpbmdQYXRoO1xyXG4gICAgY29uc3QgYmluZGluZ0RhdGEgPSB0aGlzLnZpZXdNb2RlbC5iaW5kaW5nRGF0YTtcclxuICAgIGxldCBwYWdpbmdJbmZvID0gYmluZGluZ0RhdGEgJiYgYmluZGluZ0RhdGEucGFnaW5nSW5mbyB8fCB7fTtcclxuICAgIGlmIChiaW5kaW5nUGF0aCA9PT0gJy8nKSB7XHJcbiAgICAgIHJldHVybiBwYWdpbmdJbmZvO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY29uc3QgYmluZGluZ1BhdGhzID0gYmluZGluZ1BhdGguc3Vic3RyKDEpLnNwbGl0KCcvJykuZmlsdGVyKGl0ZW0gPT4gISFpdGVtICYmIGl0ZW0ubGVuZ3RoID4gMCk7XHJcbiAgICAgIC8vIOS7juihqOWPiuS7juS7juihqOWIhumhteWSjOaVsOaNruaYr+WFs+iBlOeahO+8jOWboOS4uuS4jeWQjOeahOS7juihqOihjOacieS4jeWQjOeahOS7juS7juihqOaVsOaNru+8jOWIhumhteS/oeaBr+eahOe7k+aehOS4um5vZGVDb2RlX3BhcmVudElkOnvliIbpobXkv6Hmga995LiU5YiG6aG15L+h5oGv5piv5bmz57qn55qEXHJcbiAgICAgIC8vIHtwYWdpbmF0aW9uOnthX3BpZDp7cGFnZVNpemU6MixwYWdlSW5kZXg6MX0sYl9waWQ6e3BhZ2VTaXplOjIscGFnZUluZGV4OjF9fX1cclxuICAgICAgLy8g5Y+W5Ye65b2T5YmN6Lev5b6E5LiL5a6e5L2T55qEbm9kZUNvZGVcclxuICAgICAgbGV0IG5vZGVDb2RlID0gYmluZGluZ1BhdGhzW2JpbmRpbmdQYXRocy5sZW5ndGggLSAxXTtcclxuICAgICAgbm9kZUNvZGUgPSBub2RlQ29kZS5zdWJzdHIoMCwgbm9kZUNvZGUubGVuZ3RoIC0gMSk7XHJcbiAgICAgIC8vIOiOt+WPluW9k+WJjeWunuS9k+S4iue6p+eahOS4u+mUrlxyXG4gICAgICAvLyBjb25zdCByZXN1bHQgPSBwYWdpbmdJbmZvW25vZGVDb2RlXSB8fCB7fTtcclxuICAgICAgLy8gaWYgKHJlc3VsdC5oYXNPd25Qcm9wZXJ0eSgndG90YWxDb3VudCcpKSB7XHJcbiAgICAgIC8vICAgcmVzdWx0LnRvdGFsID0gcmVzdWx0LnRvdGFsQ291bnQ7XHJcbiAgICAgIC8vIH1cclxuICAgICAgLy8gcmV0dXJuIHJlc3VsdDtcclxuXHJcbiAgICAgIGNvbnN0IHBhdGhzID0gYmluZGluZ1BhdGhzLnNsaWNlKDAsIGJpbmRpbmdQYXRocy5sZW5ndGggLSAxKTtcclxuICAgICAgY29uc3QgYmluZGluZ0xpc3QgPSBiaW5kaW5nRGF0YS5nZXRWYWx1ZShwYXRocykgYXMgQmluZGluZ0xpc3Q7XHJcbiAgICAgIGNvbnN0IHsgcGFnZVNpemUgPSAwIH0gPSBwYWdpbmdJbmZvW2Ake25vZGVDb2RlfWBdIHx8IHt9O1xyXG4gICAgICAvLyDkuIrnuqfooajmnInmlbDmja5cclxuICAgICAgaWYgKGJpbmRpbmdMaXN0ICYmIGJpbmRpbmdMaXN0LmN1cnJlbnRJZCkge1xyXG4gICAgICAgIGNvbnN0IGtleSA9IGAke25vZGVDb2RlfV8ke2JpbmRpbmdMaXN0LmN1cnJlbnRJZH1gO1xyXG4gICAgICAgIC8vIGNvbnN0IGtleSA9IG5vZGVDb2RlO1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IHBhZ2luZ0luZm9ba2V5XSB8fCB7fTtcclxuICAgICAgICBpZiAocmVzdWx0Lmhhc093blByb3BlcnR5KCd0b3RhbENvdW50JykpIHtcclxuICAgICAgICAgIHJlc3VsdC50b3RhbCA9IHJlc3VsdC50b3RhbENvdW50O1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyDkuIrnuqfooajomb3nhLbmnInmlbDmja7vvIzkvYbkuIrnuqfooajlvZPliY3ooYznmoTkuIvnuqfooajlj6/og73msqHmnInmlbDmja7vvIzov5nlsLHlr7zoh7Tojrflj5bkuI3liLDliIbpobXkv6Hmga/vvIzmiYDku6XpnIDopoHlnKjov5Tlm57liY3lr7nnu5Pmnpzov5vooYzlpITnkIbvvIzlpoLmnpzmsqHmnInliIbpobXkv6Hmga/nmoTor53otbfnoIHlupTor6Xov5Tlm57liIbpobXlpKflsI/lj4rlvZPliY3pobXnoIFcclxuICAgICAgICBpZiAoT2JqZWN0LmtleXMocmVzdWx0KS5sZW5ndGggPCAxKSB7XHJcbiAgICAgICAgICByZXN1bHQucGFnZUluZGV4ID0gMTtcclxuICAgICAgICAgIHJlc3VsdC5wYWdlU2l6ZSA9IHBhZ2VTaXplO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIOS4iue6p+ihqOayoeacieaVsOaNru+8jOatpOaXtumcgOimgeiOt+WPluW9k+WJjeihqOeahOWIhumhteS/oeaBr++8jOWmguWIhumhteWkp+Wwj+OAguW9k+WJjemhtem7mOiupOS4ujHljbPlj6/jgIJcclxuICAgICAgICByZXR1cm4geyBwYWdlSW5kZXg6IDEsIHBhZ2VTaXplIH07XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vICNyZWdpb24gSW5wdXRcclxuICAvKipcclxuICAgKiDnu4Tku7bmmK/lkKbpnIDopoHmm7TmlrBcclxuICAgKiBAcGFyYW0gcHJvcHMg5b2T5YmN5bGe5oCnXHJcbiAgICogQHBhcmFtIG5leHRQcm9wcyDmlrDlsZ7mgKdcclxuICAgKiBAcGFyYW0gY2hhbmdlIOWPmOabtFxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBzaG91bGRDb21wb25lbnRVcGRhdGUoY2hhbmdlOiBDaGFuZ2UsIGRhdGE6IGFueSwpOiB7IHJlc3VsdDogYm9vbGVhbiwgcHJvcHM/OiBhbnkgfSB7XHJcbiAgICBjb25zdCBwcm9wcyA9IHRoaXMuYnVpbGRQcm9wcyhkYXRhKTtcclxuICAgIGlmICh0aGlzLnZpZXdNb2RlbCAmJiB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQgJiYgdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LmFwcENvbnRleHQgJiYgdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LmFwcENvbnRleHQucnVuTW9kZSA9PT0gUnVuTW9kZS5oaWdoU3BlZWQgJiYgY2hhbmdlKSB7XHJcbiAgICAgIGlmIChjaGFuZ2UudHlwZSA9PT0gQ2hhbmdlVHlwZS5Mb2FkIHx8IGNoYW5nZS50eXBlID09PSBDaGFuZ2VUeXBlLlJlbW92ZSB8fCBjaGFuZ2UudHlwZSA9PT0gQ2hhbmdlVHlwZS5QYWdpbmF0aW9uSW5mb0NoYW5nZSkge1xyXG4gICAgICAgIHJldHVybiB7IHJlc3VsdDogdHJ1ZSwgcHJvcHMgfTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgY29uc3QgZ3JpZFByb3BzID0gdGhpcy5idWlsZEdyaWRQcm9wcygpO1xyXG4gICAgaWYgKEpTT04uc3RyaW5naWZ5KHByb3BzKSA9PT0gSlNPTi5zdHJpbmdpZnkoZ3JpZFByb3BzKSkge1xyXG4gICAgICByZXR1cm4geyByZXN1bHQ6IGZhbHNlIH07XHJcbiAgICB9XHJcbiAgICByZXR1cm4geyByZXN1bHQ6IHRydWUsIHByb3BzIH07XHJcbiAgfVxyXG4gIHByb3RlY3RlZCByZWdpc3RlckV2ZW50KCkge1xyXG4gICAgLy8g5o6S5bqP5LqL5Lu2XHJcbiAgICB0aGlzLmdyaWQgJiYgdGhpcy5ncmlkLmNvbHVtblNvcnRlZCAmJiB0aGlzLmdyaWQuY29sdW1uU29ydGVkLnN1YnNjcmliZSgoZXZlbnQ6IGFueSkgPT4ge1xyXG4gICAgICBjb25zdCBpc1JlbW90ZVNvcnQgPSB0aGlzLmdyaWQucmVtb3RlU29ydDtcclxuICAgICAgLy8g5pys5Zyw5o6S5bqPXHJcbiAgICAgIGlmICghaXNSZW1vdGVTb3J0KSB7XHJcbiAgICAgICAgdGhpcy5zb3J0RmllbGRzID0gdGhpcy5ncmlkLnNvcnROYW1lO1xyXG4gICAgICAgIHRoaXMuc29ydERpcmVjdGlvbnMgPSB0aGlzLmdyaWQuc29ydE9yZGVyO1xyXG4gICAgICAgIHRoaXMuc29ydEJpbmRpbmdMaXN0KCk7XHJcbiAgICAgICAgLy8gdGhpcy5wcm9wcyA9IHRoaXMuYnVpbGRQcm9wcygpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIOacjeWKoeWZqOerr+aOkuW6j1xyXG4gICAgICAgIGNvbnN0IGdyb3VwRmllbGQgPSB0aGlzLmdyaWQgJiYgdGhpcy5ncmlkLmdyb3VwRmllbGQgfHwgbnVsbDtcclxuICAgICAgICBsZXQgc29ydEZpZWxkcyA9IHRoaXMuZ3JpZC5zb3J0TmFtZSAmJiB0aGlzLmdyaWQuc29ydE5hbWUuc3BsaXQoJywnKSB8fCBbXTtcclxuICAgICAgICBjb25zdCBzb3J0RGlyZWN0aW9uID0gdGhpcy5ncmlkLnNvcnRPcmRlciAmJiB0aGlzLmdyaWQuc29ydE9yZGVyLnNwbGl0KCcsJykgfHwgW107XHJcbiAgICAgICAgaWYgKGdyb3VwRmllbGQpIHtcclxuICAgICAgICAgIGlmICghc29ydEZpZWxkcy5pbmNsdWRlcyhncm91cEZpZWxkKSkge1xyXG4gICAgICAgICAgICBzb3J0RmllbGRzLnNwbGljZSgwLCAwLCBncm91cEZpZWxkKTtcclxuICAgICAgICAgICAgc29ydERpcmVjdGlvbi5zcGxpY2UoMCwgMCwgJ2FzYycpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICAvLyDojrflj5blvZPliY1lbnRpdHnkuIrmiYDmnIlvYmplY3TlsZ7mgKdcclxuICAgICAgICBjb25zdCBlbnRpdHlUeXBlID0gdGhpcy52aWV3TW9kZWwgJiYgdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LnJlcG9zaXRvcnkuZW50aXR5VHlwZSB8fCBudWxsO1xyXG5cclxuICAgICAgICBpZiAoc29ydEZpZWxkcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICBpZiAoZW50aXR5VHlwZSkge1xyXG4gICAgICAgICAgICBjb25zdCBkYXRhVHlwZUluZm8gPSBuZXcgRGF0YVR5cGVJbmZvKGVudGl0eVR5cGUpO1xyXG4gICAgICAgICAgICBzb3J0RmllbGRzID0gc29ydEZpZWxkcy5tYXAoZmllbGQgPT4ge1xyXG4gICAgICAgICAgICAgIC8vaWYgKGZpZWxkICYmIGZpZWxkLmluZGV4T2YoJy4nKSAhPT0gLTEpIHtcclxuICAgICAgICAgICAgICBjb25zdCBwYXRocyA9IGZpZWxkLnNwbGl0KCcuJyk7XHJcbiAgICAgICAgICAgICAgY29uc3QgcHJvcEluZm8gPSBkYXRhVHlwZUluZm8uZ2V0UHJvcEluZm9CeVBhdGgocGF0aHMpO1xyXG4gICAgICAgICAgICAgIGNvbnN0IG9yaWdpbmFsRmllbGQgPSBwcm9wSW5mbyAmJiBwcm9wSW5mby5tZXRhZGF0YUluZm9bJ3BhdGgnXSB8fCBudWxsO1xyXG4gICAgICAgICAgICAgIHJldHVybiBvcmlnaW5hbEZpZWxkO1xyXG4gICAgICAgICAgICAgIC8vfVxyXG4gICAgICAgICAgICAgIC8vcmV0dXJuIGZpZWxkO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgLy8g6YGN5Y6G5bGe5oCn77yM5qC55o2uZGF0YWZpZWxk6L2s5o2i5Li6b3JpZ2luYWxEYXRhRmllbGRcclxuICAgICAgICBjb25zdCBmaWVsZHMgPSBzb3J0RmllbGRzLmpvaW4oJywnKTtcclxuICAgICAgICBjb25zdCBkaXJlY3Rpb25zID0gc29ydERpcmVjdGlvbi5qb2luKCcsJykgfHwgJ2FzYyc7XHJcbiAgICAgICAgY29uc3QgZnJhbWVDb250ZXh0OiBGcmFtZUNvbnRleHQgPSB0aGlzLnZpZXdNb2RlbCAmJiB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQgfHwgbnVsbDtcclxuICAgICAgICBpZiAoZnJhbWVDb250ZXh0KSB7XHJcbiAgICAgICAgICBmcmFtZUNvbnRleHQucmVwb3NpdG9yeS5zb3J0Q29uZGl0aW9uTWFuYWdlci5zZXRDb25kaXRpb25zKHRoaXMudmlld01vZGVsLmJpbmRpbmdQYXRoLCBmaWVsZHMsIGRpcmVjdGlvbnMpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICAvLyDov4fmu6Tkuovku7ZcclxuICAgIHRoaXMuZ3JpZCAmJiB0aGlzLmdyaWQuZmlsdGVyQ2hhbmdlZCAmJiB0aGlzLmdyaWQuZmlsdGVyQ2hhbmdlZC5zdWJzY3JpYmUoKGV2ZW50OiBhbnkpID0+IHtcclxuICAgICAgdGhpcy5maWx0ZXJzID0gZXZlbnQ7XHJcbiAgICAgIGlmICghdGhpcy5ncmlkLnJlbW90ZUZpbHRlcikge1xyXG4gICAgICAgIGlmICh0aGlzLmJpbmRpbmdMaXN0Lmxlbmd0aCA+IDAgJiYgIXRoaXMuYmluZGluZ0xpc3QuY3VycmVudElkKSB7XHJcbiAgICAgICAgICBjb25zdCBpZCA9IHRoaXMuYmluZGluZ0xpc3QuZ2V0SWRCeUluZGV4KDApO1xyXG4gICAgICAgICAgdGhpcy5iaW5kaW5nTGlzdC5zZXRDdXJyZW50SWQoaWQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmJpbmREYXRhKCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5a+5YmluZGluZ0xpc3TmjpLluo9cclxuICAgKi9cclxuICBwcml2YXRlIHNvcnRCaW5kaW5nTGlzdCgpIHtcclxuICAgIGNvbnN0IGdyb3VwRmllbGQgPSB0aGlzLmdyaWQgJiYgdGhpcy5ncmlkLmdyb3VwRmllbGQgfHwgbnVsbDtcclxuICAgIGlmIChncm91cEZpZWxkKSB7XHJcbiAgICAgIGNvbnN0IGFyclNvcnRGaWVsZHMgPSB0aGlzLnNvcnRGaWVsZHMgJiYgdGhpcy5zb3J0RmllbGRzLnNwbGl0KCcsJykgfHwgW107XHJcbiAgICAgIGlmICghYXJyU29ydEZpZWxkcy5pbmNsdWRlcyhncm91cEZpZWxkKSkge1xyXG4gICAgICAgIGFyclNvcnRGaWVsZHMuc3BsaWNlKDAsIDAsIGdyb3VwRmllbGQpO1xyXG4gICAgICAgIGNvbnN0IGFyclNvcnREaXJlY3Rpb24gPSB0aGlzLnNvcnREaXJlY3Rpb25zICYmIHRoaXMuc29ydERpcmVjdGlvbnMuc3BsaXQoJywnKSB8fCBbXTtcclxuICAgICAgICBhcnJTb3J0RGlyZWN0aW9uLnNwbGljZSgwLCAwLCAnYXNjJyk7XHJcbiAgICAgICAgdGhpcy5zb3J0RmllbGRzID0gYXJyU29ydEZpZWxkcy5qb2luKCcsJyk7XHJcbiAgICAgICAgdGhpcy5zb3J0RGlyZWN0aW9ucyA9IGFyclNvcnREaXJlY3Rpb24uam9pbignLCcpIHx8ICdhc2MnO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5zb3J0RmllbGRzICYmIHRoaXMuc29ydERpcmVjdGlvbnMpIHtcclxuICAgICAgdGhpcy5iaW5kaW5nTGlzdC5zb3J0QnkodGhpcy5zb3J0RmllbGRzLCB0aGlzLnNvcnREaXJlY3Rpb25zKTtcclxuICAgICAgLy8gdGhpcy5wcm9wcyA9IHRoaXMuYnVpbGRQcm9wcygpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5iaW5kRGF0YSgpO1xyXG4gIH1cclxuICAvLyAjZW5kcmVnaW9uXHJcblxyXG4gIC8vICNyZWdpb24g5pWw5o2u57uR5a6a6YOo5YiGXHJcbiAgLyoqXHJcbiAgICog5pu05paw5pWw5o2uXHJcbiAgICogQHBhcmFtIGNoYW5nZT8g5Y+Y5pu0XHJcbiAgICovXHJcbiAgYmluZERhdGEoY2hhbmdlPzogQ2hhbmdlKSB7XHJcbiAgICBjb25zdCBpc1JlbW90ZUZpbHRlciA9IHRoaXMuZ3JpZCAmJiB0aGlzLmdyaWQucmVtb3RlRmlsdGVyIHx8IGZhbHNlO1xyXG4gICAgLy8g5YWI5omn6KGM5o6S5bqPXHJcbiAgICBpZiAodGhpcy5zb3J0RmllbGRzICYmICF0aGlzLmdyaWQuZWRpdGFibGUgJiYgY2hhbmdlICYmIChjaGFuZ2UudHlwZSA9PT0gJ0xvYWQnIHx8IGNoYW5nZS50eXBlID09PSAnU2VsZWN0aW9uQ2hhbmdlZCcpKSB7XHJcbiAgICAgIHRoaXMuc29ydEJpbmRpbmdMaXN0KCk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIC8vIOaWsOWinuaVsOaNruaXtua4heepuuihqOagvOetm+mAieadoeS7tlxyXG4gICAgaWYgKCh0aGlzLmdyaWQuZWRpdGFibGUgPT09IHRydWUgfHwgY2hhbmdlICYmIGNoYW5nZS50eXBlID09PSBDaGFuZ2VUeXBlLkFwcGVuZCkgJiYgdGhpcy5maWx0ZXJzICYmIE9iamVjdC5rZXlzKHRoaXMuZmlsdGVycykubGVuZ3RoID4gMCAmJiAhaXNSZW1vdGVGaWx0ZXIpIHtcclxuICAgICAgdGhpcy5maWx0ZXJzID0ge307XHJcbiAgICAgIHRoaXMuZ3JpZC5jbGVhckNvbmRpdGlvbigpO1xyXG4gICAgfVxyXG4gICAgLy8g5YaNdG9KU09OXHJcbiAgICBsZXQgZGF0YTogYW55ID0gdGhpcy5iaW5kaW5nTGlzdC50b0pTT04oKTtcclxuICAgIGlmICh0aGlzLmZpbHRlcnMgJiYgT2JqZWN0LmtleXModGhpcy5maWx0ZXJzKS5sZW5ndGggPiAwICYmICFpc1JlbW90ZUZpbHRlcikge1xyXG4gICAgICBkYXRhID0gdGhpcy5ncmlkLmNsaWVudEZpbHRlclNlcnZpY2UuZXhlY3V0ZUZpbHRlcihkYXRhLCB0aGlzLmZpbHRlcnMpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0aGlzLmZpbHRlcnMgJiYgT2JqZWN0LmtleXModGhpcy5maWx0ZXJzKS5sZW5ndGggPiAwICYmICFpc1JlbW90ZUZpbHRlciAmJiAoIWNoYW5nZSB8fCBjaGFuZ2UgJiYgY2hhbmdlLnR5cGUgIT09IENoYW5nZVR5cGUuU2VsZWN0aW9uQ2hhbmdlZCAmJiBjaGFuZ2UudHlwZSAhPT0gQ2hhbmdlVHlwZS5HbG9iYWxTZWxlY3Rpb25DaGFuZ2VkKSkge1xyXG4gICAgICBpZiAoZGF0YSAmJiBkYXRhLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAvLyDliKTmlq3lvZPliY3ooYzmmK/lkKblnKjov4fmu6TlkI7nmoTmlbDmja7kuK1cclxuICAgICAgICBjb25zdCByb3cgPSAoZGF0YSBhcyBbXSkuZmluZChpdGVtID0+IGl0ZW1bdGhpcy5iaW5kaW5nTGlzdC5wcmltYXJ5S2V5XSA9PT0gdGhpcy5iaW5kaW5nTGlzdC5jdXJyZW50SWQpO1xyXG4gICAgICAgIGlmICghcm93KSB7XHJcbiAgICAgICAgICBjb25zdCBmaXJzdFJvd0lkID0gZGF0YVswXVt0aGlzLmJpbmRpbmdMaXN0LnByaW1hcnlLZXldO1xyXG4gICAgICAgICAgdGhpcy5iaW5kaW5nTGlzdC5zZXRDdXJyZW50SWQoZmlyc3RSb3dJZCwgdHJ1ZSwgdHJ1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIOacrOWcsOi/h+a7pOWujOS5i+WQjuayoeacieaVsOaNruS6hlxyXG4gICAgICAgIC8vIHRoaXMuYmluZGluZ0xpc3QuY3VycmVudElkID0gbnVsbDtcclxuICAgICAgICB0aGlzLmJpbmRpbmdMaXN0LnNldEN1cnJlbnRJZChudWxsLCB0cnVlLCB0cnVlLCB0cnVlKTtcclxuICAgICAgICAvLyDljZXpgInml7bmuIXnqbppZHNcclxuICAgICAgICBpZiAoIXRoaXMuZ3JpZC5tdWx0aVNlbGVjdCkge1xyXG4gICAgICAgICAgdGhpcy5zZXRDaGVja3MoW10pO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgY29uc3QgcmVzdWx0ID0gdGhpcy5zaG91bGRDb21wb25lbnRVcGRhdGUoY2hhbmdlLCBkYXRhKTtcclxuICAgIGlmICghcmVzdWx0LnJlc3VsdCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICAvLyBjb25zdCBuZXh0UHJvcHMgPSB0aGlzLmJ1aWxkUHJvcHMocmVzdWx0KTtcclxuICAgIHRoaXMucmVuZGVyR3JpZChyZXN1bHQucHJvcHMpO1xyXG4gICAgdGhpcy5wcm9wcyA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkocmVzdWx0LnByb3BzKSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOa4suafk2dyaWRcclxuICAgKiBAcGFyYW0gcHJvcHMg5bGe5oCnXHJcbiAgICovXHJcbiAgcHJpdmF0ZSByZW5kZXJHcmlkKHByb3BzOiBhbnkpIHtcclxuICAgIGNvbnN0IHsgcGFnZUluZGV4LCBwYWdlU2l6ZSwgdG90YWwsIHBhZ2luYXRpb24sIGRhdGEgfSA9IHByb3BzO1xyXG4gICAgY29uc3QgdmlydHVhbGl6ZWRMb2FkID0gdGhpcy5ncmlkLnZpcnR1YWxpemVkQXN5bmNMb2FkIHx8IGZhbHNlO1xyXG4gICAgdGhpcy5ncmlkLnRvdGFsID0gdG90YWw7XHJcbiAgICB0aGlzLmdyaWQucGFnZVNpemUgPSBwYWdlU2l6ZTtcclxuICAgIHRoaXMuZ3JpZC5wYWdlSW5kZXggPSBwYWdlSW5kZXg7XHJcbiAgICB0aGlzLmdyaWQucGFnaW5hdGlvbiA9IHBhZ2luYXRpb247XHJcbiAgICB0aGlzLmdyaWQuY29udHJvbFBhZ2luYXRpb25TdGF0ZSA9IGZhbHNlO1xyXG4gICAgLy8gdGhpcy5lbmRDZWxsRWRpdCgpO1xyXG4gICAgaWYgKHBhZ2VTaXplID09PSAwKSB7XHJcbiAgICAgIHRoaXMuZ3JpZC5wYWdpbmF0aW9uID0gZmFsc2U7XHJcbiAgICAgIHRoaXMuZ3JpZC5wYWdlSW5kZXggPSAxO1xyXG4gICAgICAvLyDkv67lpI3kuI3liIbpobXml7Zncmlk5ZCv55So5YiG57uE5LuN5Lya6YeN5paw6YKm5pWw55qE6Zeu6aKYXHJcbiAgICAgIC8vIHRoaXMuZ3JpZC5wYWdlU2l6ZSA9IHRvdGFsO1xyXG4gICAgfVxyXG4gICAgaWYgKHZpcnR1YWxpemVkTG9hZCkge1xyXG4gICAgICB0aGlzLmdyaWQubG9hZFZpcnR1YWxEYXRhKHtcclxuICAgICAgICBpdGVtczogZGF0YSxcclxuICAgICAgICBwYWdlSW5kZXgsXHJcbiAgICAgICAgcGFnZVNpemUsXHJcbiAgICAgICAgdG90YWxcclxuICAgICAgfSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLmdyaWQubG9hZERhdGEoZGF0YSk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOaehOmAoOihqOagvOaVsOaNruWxnuaAp1xyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBidWlsZFByb3BzKGRhdGFzPzogQXJyYXk8YW55Pikge1xyXG4gICAgbGV0IGRhdGE7XHJcbiAgICBpZiAodHlwZW9mIChkYXRhcykgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgIGRhdGEgPSBkYXRhcztcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGRhdGEgPSB0aGlzLmJpbmRpbmdMaXN0LnRvSlNPTigpO1xyXG4gICAgfVxyXG4gICAgLy8gbGV0IHNraXAgPSAwO1xyXG4gICAgbGV0IHsgcGFnZUluZGV4ID0gMSwgcGFnZVNpemUgPSAwIH0gPSB0aGlzLmdldFBhZ2luZ0luZm8oKSB8fCB7fTtcclxuICAgIGxldCB7IHRvdGFsID0gMCB9ID0gdGhpcy5nZXRQYWdpbmdJbmZvKCkgfHwge307XHJcbiAgICAvLyBpZiAocGFnZUluZGV4ID4gMCkge1xyXG4gICAgLy8gICBza2lwID0gKHBhZ2VJbmRleCAtIDEpICogcGFnZVNpemU7XHJcbiAgICAvLyB9XHJcbiAgICBpZiAocGFnZVNpemUgPT09IDAgJiYgdG90YWwgPT09IDApIHtcclxuICAgICAgdG90YWwgPSBkYXRhLmxlbmd0aDtcclxuICAgIH1cclxuICAgIHJldHVybiB7IGRhdGEsIHBhZ2VJbmRleCwgcGFnZVNpemUsIHRvdGFsLCBwYWdpbmF0aW9uOiBwYWdlU2l6ZSAhPT0gMCB9O1xyXG4gIH1cclxuICAvKipcclxuICAgKiDorqHnrpdncmlk54q25oCBXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBidWlsZEdyaWRQcm9wcygpIHtcclxuICAgIGNvbnN0IGRhdGEgPSB0aGlzLmdyaWQuZGF0YSB8fCBbXTtcclxuICAgIGxldCBza2lwID0gMDtcclxuICAgIGNvbnN0IHsgcGFnZUluZGV4ID0gMSwgcGFnZVNpemUgPSAwIH0gPSB7IHBhZ2VJbmRleDogdGhpcy5ncmlkLnBhZ2VJbmRleCwgcGFnZVNpemU6IHRoaXMuZ3JpZC5wYWdlU2l6ZSB9O1xyXG4gICAgbGV0IHRvdGFsID0gdGhpcy5ncmlkLnRvdGFsIHx8IDA7XHJcbiAgICBpZiAocGFnZUluZGV4ID4gMCkge1xyXG4gICAgICBza2lwID0gKHBhZ2VJbmRleCAtIDEpICogcGFnZVNpemU7XHJcbiAgICB9XHJcbiAgICBpZiAocGFnZVNpemUgPT09IDAgJiYgdG90YWwgPT09IDApIHtcclxuICAgICAgdG90YWwgPSBkYXRhLmxlbmd0aDtcclxuICAgIH1cclxuICAgIHJldHVybiB7IGRhdGEsIHBhZ2VJbmRleCwgcGFnZVNpemUsIHRvdGFsLCBwYWdpbmF0aW9uOiB0aGlzLmdyaWQucGFnaW5hdGlvbiB9O1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmlbDmja7mupDlj5HnlJ/lj5jmm7RcclxuICAgKiBAcGFyYW0gY2hhbmdlIOWPmOabtFxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBvbkJpbmRpbmdEYXRhQ2hhbmdlKGNoYW5nZTogQ2hhbmdlKSB7XHJcbiAgICB0aGlzLnVwZGF0ZURhdGFTb3VyY2UoY2hhbmdlKTtcclxuICAgIHRoaXMudXBkYXRlU2VsZWN0ZWRSb3coY2hhbmdlKTtcclxuICAgIC8vIHRoaXMudXBkYXRlR3JpZChjaGFuZ2UpO1xyXG4gICAgLy8g5LiN5riF6Zmk5Yu+6YCJ6KGM77yM6ZyA6KaB5L+d55WZ5Yu+6YCJ54q25oCBXHJcbiAgICAvLyB0aGlzLmNsZWFyQ2hlY2tlZFJvd3MoY2hhbmdlKTtcclxuICAgIHRoaXMuZW5kQ2VsbEVkaXQoY2hhbmdlKTtcclxuICAgIC8vIOabtOaWsOWLvumAieihjOaVsOaNrlxyXG4gICAgdGhpcy51cGRhdGVDaGVja2VkUm93cyhjaGFuZ2UpO1xyXG4gICAgdGhpcy51cGRhdGVEYXRhKGNoYW5nZSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOabtOaWsOaVsOaNrlxyXG4gICAqL1xyXG4gIHByaXZhdGUgdXBkYXRlRGF0YVNvdXJjZShjaGFuZ2U6IENoYW5nZSkge1xyXG4gICAgLyppZiAoY2hhbmdlKSB7XHJcbiAgICAgIGNvbnN0IGlzTWF0Y2ggPSB0aGlzLmNoZWNrSWZDaGFuZ2VNYXRjaEJpbmRpbmdQYXRoKGNoYW5nZSk7XHJcbiAgICAgIGlmICghaXNNYXRjaCkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgfSovXHJcbiAgICBpZiAoY2hhbmdlICYmIGNoYW5nZS50eXBlID09PSBDaGFuZ2VUeXBlLlZhbHVlQ2hhbmdlZCkge1xyXG4gICAgICB0aGlzLnJlbmRlckdyaWRTdWJqZWN0Lm5leHQoY2hhbmdlKTtcclxuICAgIH0gZWxzZSBpZiAoY2hhbmdlICYmIChjaGFuZ2UudHlwZSA9PT0gQ2hhbmdlVHlwZS5TZWxlY3Rpb25DaGFuZ2VkIHx8IGNoYW5nZS50eXBlID09PSBDaGFuZ2VUeXBlLkdsb2JhbFNlbGVjdGlvbkNoYW5nZWQpKSB7XHJcbiAgICAgIGlmICh0aGlzLmJpbmRpbmdMaXN0LmN1cnJlbnRJZCA9PT0gKHRoaXMuZ3JpZC5zZWxlY3RlZFJvdyAmJiB0aGlzLmdyaWQuc2VsZWN0ZWRSb3cuaWQpICYmIHRoaXMuZ3JpZC50b3RhbCA+IDApIHtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLmJpbmREYXRhKGNoYW5nZSk7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuYmluZERhdGEoY2hhbmdlKTtcclxuICAgIH1cclxuICB9XHJcbiAgLy8gcHJpdmF0ZSBlbmRDZWxsRWRpdCgpIHtcclxuICAvLyAgIGNvbnN0IGlzRWRpdGluZyA9IHRoaXMuZ3JpZC5pc0VkaXRpbmcoKTtcclxuICAvLyAgIGlmIChpc0VkaXRpbmcpIHtcclxuICAvLyAgICAgdGhpcy5ncmlkLmVuZENlbGxFZGl0KCk7XHJcbiAgLy8gICB9XHJcbiAgLy8gfVxyXG4gIHByaXZhdGUgZW5kQ2VsbEVkaXQoY2hhbmdlOiBDaGFuZ2UpIHtcclxuICAgIGNvbnN0IGlzRWRpdGluZyA9IHRoaXMuZ3JpZC5pc0VkaXRpbmcoKTtcclxuICAgIGlmIChjaGFuZ2UudHlwZSA9PT0gQ2hhbmdlVHlwZS5Mb2FkICYmIGlzRWRpdGluZykge1xyXG4gICAgICB0aGlzLmdyaWQuZW5kQ2VsbEVkaXQoKTtcclxuICAgIH1cclxuICB9XHJcbiAgLyoqXHJcbiAgICog6K6+572uZ3JpZOW9k+WJjemAieaLqeihjFxyXG4gICAqIEBwYXJhbSBjaGFuZ2Ug5Y+Y5pu0XHJcbiAgICovXHJcbiAgcHJpdmF0ZSB1cGRhdGVTZWxlY3RlZFJvdyhjaGFuZ2U/OiBDaGFuZ2UpIHtcclxuICAgIGlmICghdGhpcy5iaW5kaW5nTGlzdCB8fCAhdGhpcy5iaW5kaW5nTGlzdC5jdXJyZW50SWQpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgLy8g6aG156CB5YiH5o2i5pe25LiN5omn6KGM5b2T5YmN6KGM5YiH5o2iXHJcbiAgICBpZiAoY2hhbmdlICYmIGNoYW5nZS50eXBlID09PSBDaGFuZ2VUeXBlLlBhZ2luYXRpb25JbmZvQ2hhbmdlKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLnZpZXdNb2RlbCAmJiB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQuYmluZGluZ0RhdGEucm93U2VsZWN0ZWRFdmVudFN1c3BlbmQgPT09IHRydWUpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgY29uc3QgeyBpZDogZ3JpZFNlbGVjdGVkUm93SWQgPSBudWxsIH0gPSB0aGlzLmdyaWQuc2VsZWN0ZWRSb3cgfHwge307XHJcbiAgICBjb25zdCBjdXJyZW50SWQgPSB0aGlzLmJpbmRpbmdMaXN0LmN1cnJlbnRJZDtcclxuICAgIC8vIGdyaWTlvZPliY3ooYzkuI5iaW5naW5nTGlzdOW9k+WJjeihjOS4gOiHtO+8jOaXoOmhu+WIh+aNolxyXG4gICAgaWYgKGdyaWRTZWxlY3RlZFJvd0lkID09PSBjdXJyZW50SWQpIHtcclxuICAgICAgY29uc3QgaXNNYXRjaCA9IGNoYW5nZSAmJiAoY2hhbmdlLnBhdGgudG9TdHJpbmcoKSA9PT0gdGhpcy52aWV3TW9kZWwuYmluZGluZ1BhdGguc3BsaXQoJy8nKS5maWx0ZXIocCA9PiBwKS50b1N0cmluZygpKTtcclxuICAgICAgaWYgKGNoYW5nZSAmJiBjaGFuZ2UudHlwZSA9PT0gQ2hhbmdlVHlwZS5Mb2FkICYmIGlzTWF0Y2gpIHtcclxuICAgICAgICB0aGlzLmdyaWQuY2xlYXJTZWxlY3Rpb25zKCk7XHJcbiAgICAgICAgdGhpcy5ncmlkLnNlbGVjdFJvdyhjdXJyZW50SWQsIHRydWUsIHRydWUpO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHRoaXMuc2VsZWN0R3JpZFJvdyh0aGlzLmJpbmRpbmdMaXN0LmN1cnJlbnRJZCk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOazqOWGjGJpbmRpbmdkYXRh5Y+Y5YyW5LqL5Lu2XHJcbiAgICovXHJcbiAgcHJpdmF0ZSByZWdpc3RlckJpbmRpbmdEYXRhQ2hhbmdlRXZlbnQoKSB7XHJcbiAgICB0aGlzLmJpbmRpbmdEYXRhQ2hhbmdlRXZlbnQgPSB0aGlzLmJpbmRpbmdEYXRhLmNoYW5nZXMuc3Vic2NyaWJlKChjaGFuZ2U6IENoYW5nZSkgPT4ge1xyXG4gICAgICB0aGlzLm9uQmluZGluZ0RhdGFDaGFuZ2UoY2hhbmdlKTtcclxuICAgIH0pO1xyXG4gICAgdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LmFwcENvbnRleHQubWVzc2FnZVBpcGUuc3Vic2NyaWJlKG1lc3NhZ2UgPT4ge1xyXG4gICAgICBpZiAobWVzc2FnZSA9PT0gJ2JpbmREYXRhJykge1xyXG4gICAgICAgIHRoaXMuYmluZERhdGEoKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWPlua2iGJpbmRpbmdkYXRh5Y+Y5YyW6K6i6ZiFXHJcbiAgICovXHJcbiAgcHJpdmF0ZSB1blJlZ2lzdGVyQmluZGluZ0RhdGFDaGFuZ2VFdmVudCgpIHtcclxuICAgIGlmICh0aGlzLmJpbmRpbmdEYXRhQ2hhbmdlRXZlbnQgJiYgdHlwZW9mICh0aGlzLmJpbmRpbmdEYXRhQ2hhbmdlRXZlbnQudW5zdWJzY3JpYmUpID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgIHRoaXMuYmluZGluZ0RhdGFDaGFuZ2VFdmVudC51bnN1YnNjcmliZSgpO1xyXG4gICAgfVxyXG4gIH1cclxuICAvKipcclxuICAgKiDop6blj5HpobXnoIHliIfmjaLkuovku7ZcclxuICAgKiBAZGVzY3JpcHRpb24g5pys5pa55rOV6YCC55So5Zy65pmv5LuF5Li654i257qnZ3JpZOaVsOaNrumHjeaWsGxvYWTvvIzpnIDopoHop6blj5Hor6Vncmlk6YeN5paw5Y+W5pWw5L2/55So44CC5YW25LuW5Zy65pmv6K+35Yu/5L2/55SoXHJcbiAgICogQFRPRE86IOW+hemHjeaehO+8jOaOp+WItuS4i+e6p+aVsOaNruWKoOi9veW6lOivpeS+nei1luihqOagvOeahOihjOWIh+aNouS6i+S7tu+8jOS4tOaXtui/meagt+WkhOeQhu+8jOWQjue7reaPkOS+m0xvYWRDaGlsZHJlbuS6i+S7tlxyXG4gICAqL1xyXG4gIHByaXZhdGUgdXBkYXRlRGF0YShjaGFuZ2U/OiBDaGFuZ2UpIHtcclxuICAgIGlmICghKGNoYW5nZSAmJiAoY2hhbmdlLnR5cGUgPT09IENoYW5nZVR5cGUuU2VsZWN0aW9uQ2hhbmdlZCB8fCBjaGFuZ2UudHlwZSA9PT0gQ2hhbmdlVHlwZS5Mb2FkKSkpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgY29uc3QgYmluZGluZ1BhdGggPSB0aGlzLnZpZXdNb2RlbC5iaW5kaW5nUGF0aDtcclxuICAgIGNvbnN0IGV2ZW50QmluZGluZ1BhdGggPSAnLycgKyBjaGFuZ2UucGF0aC5qb2luKCcvJyk7XHJcbiAgICBjb25zdCBpc1JldHJpZXZlID0gdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LmFwcENvbnRleHQucGFyYW1zLmdldCgncmV0cmlldmVpbmcnKSB8fCBmYWxzZTtcclxuICAgIGlmIChjaGFuZ2UucGF0aC5sZW5ndGggPCAxIHx8IGJpbmRpbmdQYXRoID09PSAnLycgfHwgYmluZGluZ1BhdGggPT09IGV2ZW50QmluZGluZ1BhdGggfHwgIWJpbmRpbmdQYXRoLnN0YXJ0c1dpdGgoZXZlbnRCaW5kaW5nUGF0aCkpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgLy8gcmV0cmlldmXml7bkvJroh6rliqjluKblm57ku47ooajnrKzkuIDpobXlj4rku47ooajnrKzkuIDooYznmoTku47ku47ooajmlbDmja7vvIzmiYDku6XkuI3pnIDopoHlho3ljrvljZXni6zor7fmsYJcclxuICAgIGlmIChpc1JldHJpZXZlKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGNvbnN0IGZ1bGxQYXRocyA9IEVudGl0eVBhdGhDb252ZXJ0ZXIudG9FbnRpdHlQYXRoQXJyYXkodGhpcy52aWV3TW9kZWwuYmluZGluZ1BhdGgsIHRoaXMuYmluZGluZ0RhdGEpO1xyXG4gICAgY29uc3QgcGF0aHMgPSBmdWxsUGF0aHMuc2xpY2UoMCwgZnVsbFBhdGhzLmxlbmd0aCAtIDEpO1xyXG4gICAgY29uc3QgcGFyZW50ID0gdGhpcy5iaW5kaW5nTGlzdC5wYXJlbnQ7XHJcbiAgICBjb25zdCBwYXJlbnRJZCA9IHBhcmVudCAmJiBwYXJlbnRbcGFyZW50LnByaW1hcnlLZXldO1xyXG4gICAgLy8g5LiK57qn6KGo5rKh5pyJ5pWw5o2uXHJcbiAgICBpZiAoIXBhcmVudElkKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIC8vIOiOt+WPlm5vZGVjb2RlXHJcbiAgICBjb25zdCBiaW5kaW5nUGF0aHMgPSB0aGlzLnZpZXdNb2RlbC5iaW5kaW5nUGF0aC5zcGxpdCgnLycpLmZpbHRlcihpdGVtID0+IGl0ZW0pO1xyXG4gICAgbGV0IG5vZGVDb2RlID0gYmluZGluZ1BhdGhzW2JpbmRpbmdQYXRocy5sZW5ndGggLSAxXTtcclxuICAgIG5vZGVDb2RlID0gbm9kZUNvZGUuc3Vic3RyKDAsIG5vZGVDb2RlLmxlbmd0aCAtIDEpO1xyXG4gICAgLy8gY29uc3QgY29uZmlnUGF0aCA9IGAvJHtub2RlQ29kZX1fJHtwYXJlbnRJZH1gO1xyXG4gICAgY29uc3QgY29uZmlnUGF0aCA9IGAvJHtub2RlQ29kZX1gO1xyXG4gICAgbGV0IHsgcGFnZUluZGV4ID0gMSB9ID0gdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5nZXRQYWdpbmF0aW9uQ29uZmlnQnlQYXRoKGNvbmZpZ1BhdGgpIHx8IHt9O1xyXG4gICAgY29uc3QgeyBwYWdlU2l6ZSA9IDAgfSA9IHRoaXMudmlld01vZGVsLmZyYW1lQ29udGV4dC5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24uZ2V0UGFnaW5hdGlvbkNvbmZpZ0J5UGF0aChjb25maWdQYXRoKSB8fCB7fTtcclxuXHJcbiAgICBjb25zdCBwYXJlbnROb2RlQ29kZSA9IGNoYW5nZS5wYXRoW2NoYW5nZS5wYXRoLmxlbmd0aCAtIDFdO1xyXG4gICAgY29uc3QgcGFyZW50Q29uZmlnUGF0aCA9ICcvJyArIHBhcmVudE5vZGVDb2RlLnN1YnN0cmluZygwLCBwYXJlbnROb2RlQ29kZS5sZW5ndGggLSAxKTtcclxuICAgIGNvbnN0IHsgcGFnZVNpemU6IHBhcmVudFBhZ2VTaXplID0gMCB9ID0gdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5nZXRQYWdpbmF0aW9uQ29uZmlnQnlQYXRoKHBhcmVudENvbmZpZ1BhdGgpIHx8IHt9O1xyXG4gICAgY29uc3QgaXNRdWVyeUNoaWxkID0gdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LmFwcENvbnRleHQucGFyYW1zLmdldCgncXVlcnlDaGlsZCcpIHx8IGZhbHNlO1xyXG4gICAgaWYgKGlzUXVlcnlDaGlsZCkge1xyXG4gICAgICAvLyB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQuYXBwQ29udGV4dC5wYXJhbXMuZGVsZXRlKCdxdWVyeUNoaWxkJyk7XHJcbiAgICAgIHBhZ2VJbmRleCA9IDE7XHJcbiAgICB9XHJcbiAgICAvLyDlvZPkuIrnuqfooajliIfmjaLooYzml7ZcclxuICAgIGlmIChwYXJlbnRQYWdlU2l6ZSArIHBhZ2VTaXplICE9PSAwKSB7XHJcbiAgICAgIHRoaXMudmlld01vZGVsLmZyYW1lQ29udGV4dC5hcHBDb250ZXh0LnBhcmFtcy5zZXQoJ2ZvcmNlUXVlcnlDaGlsZCcsIHRydWUpO1xyXG4gICAgICB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQucmVwb3NpdG9yeS5xdWVyeUNoaWxkKHBhdGhzLCBwYWdlSW5kZXgsIHBhZ2VTaXplKS5waXBlKFxyXG4gICAgICAgIGZpbmFsaXplKCgpID0+IHRoaXMudmlld01vZGVsLmZyYW1lQ29udGV4dC5hcHBDb250ZXh0LnBhcmFtcy5kZWxldGUoJ2ZvcmNlUXVlcnlDaGlsZCcpKVxyXG4gICAgICApLnN1YnNjcmliZSgpO1xyXG4gICAgfVxyXG4gIH1cclxuICBuZ09uRGVzdHJveSgpIHtcclxuICAgIHRoaXMudW5SZWdpc3RlckJpbmRpbmdEYXRhQ2hhbmdlRXZlbnQoKTtcclxuICB9XHJcbiAgLy8gI2VuZHJlZ2lvblxyXG5cclxuICAvLyAjcmVnaW9uIOS6i+S7tuWPkeWwhOWZqFxyXG5cclxuICAvKipcclxuICAgKiDlj5HlsITpgInkuK3ooYzliIfmjaLkuovku7ZcclxuICAgKiBAZGVzY3JpcHRpb24g57uf5LiA5Y2V6YCJ5qih5byP5ZKM5aSa6YCJ5qih5byP5LiL55qE6KGM5YiH5o2i5LqL5Lu2XHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIGZpcmVTZWxlY3RlZFJvd0NoYW5nZShzZWxlY3RlZFJvd0NvbnRleHQ6IGFueSkge1xyXG4gICAgdGhpcy5zZWxlY3RlZFJvd0NoYW5nZS5lbWl0KHNlbGVjdGVkUm93Q29udGV4dCk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOa4heepuumAieWumuihjFxyXG4gICAqIEBwYXJhbSBjaGFuZ2Ug5Y+Y5pu0XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBjbGVhckNoZWNrZWRSb3dzKGNoYW5nZTogQ2hhbmdlKSB7XHJcbiAgICBpZiAoY2hhbmdlLnR5cGUgPT09IENoYW5nZVR5cGUuTG9hZCAmJiB0aGlzLmdyaWQubXVsdGlTZWxlY3QpIHtcclxuICAgICAgY29uc3QgaXNNYXRjaCA9IHRoaXMuY2hlY2tJZkNoYW5nZU1hdGNoQmluZGluZ1BhdGgoY2hhbmdlKTtcclxuICAgICAgaWYgKGlzTWF0Y2gpIHtcclxuICAgICAgICB0aGlzLnNldENoZWNrcyhbXSk7XHJcbiAgICAgICAgaWYgKHR5cGVvZiAodGhpcy5ncmlkLmNsZWFyQ2hlY2tlZHMpID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICB0aGlzLmdyaWQuY2xlYXJDaGVja2VkcygpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gI2VuZHJlZ2lvblxyXG5cclxuXHJcblxyXG4gIC8vICNyZWdpb24g6YCa5L+hXHJcblxyXG4gIC8qKlxyXG4gICAqIOiuvue9rkJpbmRpbmdMaXN055qE5b2T5YmN6KGMXHJcbiAgICogQHBhcmFtIGlkIOW9k+WJjeihjOWGheeggVxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBzZXRTZWxlY3Rpb25JZFRvQmluZGluZ0RhdGEoaWQ6IHN0cmluZyk6IHZvaWQge1xyXG4gICAgLy8g5aaC5p6c5b2T5YmN6KGM5LiN5a2Y5Zyo77yM5YiZ5by65Yi26K6+572uXHJcbiAgICBpZiAoIWlkKSB7XHJcbiAgICAgIHRoaXMuYmluZGluZ0xpc3QuY3VycmVudElkID0gaWQ7XHJcbiAgICAgIGlmICghdGhpcy5ncmlkLm11bHRpU2VsZWN0KSB7XHJcbiAgICAgICAgdGhpcy5zZXRDaGVja3MoW10pO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLmJpbmRpbmdMaXN0LmN1cnJlbnRJZCAhPT0gaWQpIHtcclxuICAgICAgdGhpcy5iaW5kaW5nTGlzdC5zZXRDdXJyZW50SWQoaWQsIHRydWUpO1xyXG4gICAgfVxyXG4gICAgLy8g5Y2V6YCJ5qih5byP5LiL5bCG5b2T5YmN6KGM6K6+572u5YiwaWRzXHJcbiAgICBpZiAoIXRoaXMuZ3JpZC5tdWx0aVNlbGVjdCkge1xyXG4gICAgICB0aGlzLnNldENoZWNrcyhbaWRdKTtcclxuICAgIH1cclxuICB9XHJcbiAgcHJpdmF0ZSB1cGRhdGVDaGVja2VkUm93cyhjaGFuZ2VzOiBDaGFuZ2UpIHtcclxuICAgIGlmIChjaGFuZ2VzLnR5cGUgPT09IENoYW5nZVR5cGUuTG9hZCkge1xyXG4gICAgICB0aGlzLnNldENoZWNrZWRSb3dzKCk7XHJcbiAgICB9IGVsc2UgaWYgKGNoYW5nZXMudHlwZSA9PT0gQ2hhbmdlVHlwZS5WYWx1ZUNoYW5nZWQpIHtcclxuICAgICAgY29uc3QgaWRzID0gdGhpcy5nZXRDaGVja3MoKTtcclxuICAgICAgaWYgKGNoYW5nZXMuaWQgJiYgaWRzLmluY2x1ZGVzKGNoYW5nZXMuaWQpKSB7XHJcbiAgICAgICAgdGhpcy5zZXRDaGVja2VkUm93cygpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiuvue9rumAieaLqeihjFxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBzZXRDaGVja3MoaWRzOiBzdHJpbmdbXSkge1xyXG4gICAgdGhpcy52aWV3TW9kZWwudWlTdGF0ZS5zZXRQcm9wZXJ0eVZhbHVlKCdpZHMnLCBpZHMpO1xyXG4gICAgdGhpcy5zZXRDaGVja2VkUm93cyhpZHMpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDojrflj5bli77pgInooYxpZOaVsOe7hFxyXG4gICAqIEByZXR1cm5zIFxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBnZXRDaGVja3MoKTogc3RyaW5nW10ge1xyXG4gICAgcmV0dXJuIHRoaXMudmlld01vZGVsLnVpU3RhdGVbJ2lkcyddIHx8IFtdO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmm7TmlrDli77pgInooYzmlbDmja5cclxuICAgKi9cclxuICBwcm90ZWN0ZWQgc2V0Q2hlY2tlZFJvd3MoaWRzPzogc3RyaW5nW10pIHtcclxuICAgIC8vIOmrmOmAn+aooeW8j+aXtuS4jeWGjeiuvue9rnJvd3NcclxuICAgIC8vIGlmICh0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQuYXBwQ29udGV4dC5ydW5Nb2RlID09PSBSdW5Nb2RlLmhpZ2hTcGVlZCkge1xyXG4gICAgLy8gICByZXR1cm47XHJcbiAgICAvLyB9XHJcbiAgICBpZiAodHlwZW9mIGlkcyA9PT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgaWRzID0gdGhpcy52aWV3TW9kZWwudWlTdGF0ZVsnaWRzJ10gfHwgW107XHJcbiAgICB9XHJcbiAgICBpZiAoIUFycmF5LmlzQXJyYXkoaWRzKSB8fCBpZHMubGVuZ3RoIDwgMSkge1xyXG4gICAgICAvLyDmraTml7ZpZHPmsqHmnInlgLzvvIxyb3dz5Lit5Lmf5LiN5bqU6K+l5pyJXHJcbiAgICAgIHRoaXMudmlld01vZGVsLnVpU3RhdGUuc2V0UHJvcGVydHlWYWx1ZSgncm93cycsIG51bGwpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBsZXQgbGlzdCA9IFtdO1xyXG4gICAgLy8gVE9ET++8mnJvd3PkuK3mlbDmja7lnKjpq5jpgJ/mqKHlvI/lkozmma7pgJrmqKHlvI/kuIvlpJror63lrZfmrrXnmoTlgLzooajnjrDkuI3kuIDoh7TvvIzpq5jpgJ/mqKHlvI/kuIvlpJror63lrZfmrrXlgLzkuLrlr7nosaHvvIzmma7pgJrmqKHlvI/kuLrlvZPliY3or63oqIDjgILmmoLkuI3lpITnkIbpq5jpgJ/mqKHlvI/lnLrmma9cclxuICAgIGlmICh0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQuYXBwQ29udGV4dC5ydW5Nb2RlID09PSBSdW5Nb2RlLmhpZ2hTcGVlZCkge1xyXG4gICAgICBsaXN0ID0gdGhpcy5ncmlkLmRhdGEgfHwgW107XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBsaXN0ID0gdGhpcy5iaW5kaW5nTGlzdC50b0pTT04oeyBpZ25vcmVNdWx0aUxhbmdJbnB1dDogdHJ1ZSB9KTtcclxuICAgIH1cclxuICAgIGNvbnN0IHJvd3M6IE1hcDxzdHJpbmcsIGFueT4gPSB0aGlzLnZpZXdNb2RlbC51aVN0YXRlWydyb3dzJ10gfHwgbmV3IE1hcDxzdHJpbmcsIGFueT4oKTtcclxuXHJcbiAgICBjb25zdCByZXN1bHQgPSBuZXcgTWFwPHN0cmluZywgYW55PigpO1xyXG4gICAgaWRzLmZvckVhY2goKGlkOiBhbnkpID0+IHtcclxuICAgICAgY29uc3QgaXRlbSA9IGxpc3QuZmluZChpdGVtID0+IGl0ZW1bdGhpcy5wcmltYXJ5S2V5XSA9PT0gaWQpO1xyXG4gICAgICBjb25zdCBvdGhlclBhZ2VJdGVtID0gcm93cy5nZXQoaWQpO1xyXG4gICAgICBpZiAoaXRlbSkge1xyXG4gICAgICAgIHJlc3VsdC5zZXQoaWQsIGl0ZW0pO1xyXG4gICAgICB9IGVsc2UgaWYgKG90aGVyUGFnZUl0ZW0pIHtcclxuICAgICAgICByZXN1bHQuc2V0KGlkLCBvdGhlclBhZ2VJdGVtKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICB0aGlzLnZpZXdNb2RlbC51aVN0YXRlLnNldFByb3BlcnR5VmFsdWUoJ3Jvd3MnLCByZXN1bHQpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDpgInkuK1ncmlk6KGMXHJcbiAgICogQHBhcmFtIGlkIGlkXHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIHNlbGVjdEdyaWRSb3coaWQ6IGFueSkge1xyXG4gICAgdGhpcy5ncmlkLnNlbGVjdFJvdyhpZCk7XHJcbiAgICB0aGlzLmdyaWQuc2Nyb2xsVG9DdXJyZW50Um93KCk7XHJcbiAgfVxyXG4gIC8vICNlbmRyZWdpb25cclxuICAvLyAjcmVnaW9uIOS6i+S7tuWkhOeQhuWZqFxyXG5cclxuICAvKipcclxuICAgKiDpobXnoIHliIfmjaLkuovku7ZcclxuICAgKiBAcGFyYW0gZXZlbnQgZXZlbnRcclxuICAgKi9cclxuICBASG9zdExpc3RlbmVyKCdwYWdlQ2hhbmdlZCcsIFsnJGV2ZW50J10pXHJcbiAgcHVibGljIHBhZ2VDaGFuZ2VkSGFuZGxlcihldmVudDogYW55KSB7XHJcbiAgICBsZXQgeyBwYWdlSW5kZXgsIHBhZ2VTaXplIH0gPSBldmVudDtcclxuICAgIGlmIChwYWdlSW5kZXggPCAxKSB7XHJcbiAgICAgIHBhZ2VJbmRleCA9IDE7XHJcbiAgICB9XHJcbiAgICBjb25zdCBza2lwID0gKHBhZ2VJbmRleCAtIDEpICogcGFnZVNpemU7XHJcbiAgICB0aGlzLmJpbmRpbmdEYXRhLnNldFBhZ2luZ0luZm8oc2tpcCwgcGFnZVNpemUsIHRoaXMuYmluZGluZ0RhdGEuYmluZGluZ1BhdGgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6KGM5YiH5o2i5LqL5Lu2XHJcbiAgICogQHBhcmFtIGV2ZW50IGV2ZW50XHJcbiAgICovXHJcbiAgQEhvc3RMaXN0ZW5lcignc2VsZWN0Q2hhbmdlZCcsIFsnJGV2ZW50J10pXHJcbiAgcHVibGljIHNlbGVjdGVkUm93Q2hhbmdlZChldmVudDogYW55KSB7XHJcbiAgICBjb25zdCB7IGluZGV4LCBkYXRhIH0gPSBldmVudDtcclxuICAgIGNvbnN0IGlkID0gZGF0YVt0aGlzLnByaW1hcnlLZXldO1xyXG4gICAgdGhpcy5zZXRTZWxlY3Rpb25JZFRvQmluZGluZ0RhdGEoaWQpO1xyXG4gICAgdGhpcy5maXJlU2VsZWN0ZWRSb3dDaGFuZ2UoZXZlbnQpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Y+W5raI6KGM6YCJ5oup5LqL5Lu2XHJcbiAgICogQHBhcmFtIGV2ZW50IGV2ZW50XHJcbiAgICovXHJcbiAgQEhvc3RMaXN0ZW5lcigndW5TZWxlY3QnLCBbJyRldmVudCddKVxyXG4gIHB1YmxpYyB1blNlbGVjdGVkKGV2ZW50OiBhbnkpIHtcclxuICAgIGlmICghZXZlbnQpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgY29uc3QgeyBkYXRhID0ge30gfSA9IGV2ZW50O1xyXG4gICAgY29uc3QgaWQgPSBkYXRhW3RoaXMucHJpbWFyeUtleV07XHJcbiAgICBjb25zdCBjdXJyZW50SWQgPSB0aGlzLmJpbmRpbmdMaXN0LmN1cnJlbnRJZDtcclxuICAgIGlmIChpZCA9PT0gY3VycmVudElkKSB7XHJcbiAgICAgIHRoaXMuc2V0U2VsZWN0aW9uSWRUb0JpbmRpbmdEYXRhKG51bGwpO1xyXG4gICAgfVxyXG4gICAgLy8gdGhpcy5maXJlU2VsZWN0ZWRSb3dDaGFuZ2UoZXZlbnQpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDli77pgInooYzlj5HnlJ/lj5jljJZcclxuICAgKiBAcGFyYW0gZXZlbnQgZXZlbnRcclxuICAgKi9cclxuICBASG9zdExpc3RlbmVyKCdjaGVja2VkQ2hhbmdlJywgWyckZXZlbnQnXSlcclxuICBwdWJsaWMgY2hlY2tlZENoYW5nZWQoZXZlbnQ6IGFueSkge1xyXG4gICAgZXZlbnQgPSBldmVudCB8fCBbXTtcclxuICAgIGNvbnN0IGlkcyA9IGV2ZW50Lm1hcChpdGVtID0+IGl0ZW0uaWQpO1xyXG4gICAgdGhpcy5zZXRDaGVja3MoaWRzKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5YiG6aG15aSn5bCP5Y+Y5pu05LqL5Lu2XHJcbiAgICogQHBhcmFtIGV2ZW50IGV2ZW50XHJcbiAgICovXHJcbiAgQEhvc3RMaXN0ZW5lcigncGFnZVNpemVDaGFuZ2VkJywgWyckZXZlbnQnXSlcclxuICBwdWJsaWMgcGFnZVNpemVDaGFuZ2VkKGV2ZW50OiBhbnkpIHtcclxuICAgIGNvbnN0IHsgcGFnZUluZGV4LCBwYWdlU2l6ZSB9ID0gZXZlbnQ7XHJcbiAgICBjb25zdCBza2lwID0gMDsvLyhwYWdlSW5kZXggLSAxKSAqIHBhZ2VTaXplO1xyXG4gICAgLy8gdGhpcy5iaW5kaW5nTGlzdC5zZXRQYWdpbmF0aW9uSW5mbyhza2lwLCBwYWdlU2l6ZSk7XHJcbiAgICB0aGlzLmJpbmRpbmdEYXRhLnNldFBhZ2luZ0luZm8oc2tpcCwgcGFnZVNpemUsIHRoaXMuYmluZGluZ0RhdGEuYmluZGluZ1BhdGgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogZ3JpZOa7muWKqOWKoOi9veaVsOaNrlxyXG4gICAqIEBwYXJhbSBldmVudCBldmVudFxyXG4gICAqL1xyXG4gIEBIb3N0TGlzdGVuZXIoJ3Njcm9sbFlMb2FkJywgWyckZXZlbnQnXSlcclxuICBwdWJsaWMgc2Nyb2xsWShldmVudDogYW55KSB7XHJcbiAgICBjb25zdCB7IHBhZ2VyOiBwYWdlSW5kZXgsIHBhZ2VTaXplIH0gPSBldmVudDtcclxuICAgIGNvbnN0IHNraXAgPSAocGFnZUluZGV4IC0gMSkgKiBwYWdlU2l6ZTtcclxuICAgIHRoaXMuYmluZGluZ0RhdGEuc2V0UGFnaW5nSW5mbyhza2lwLCBwYWdlU2l6ZSwgdGhpcy5iaW5kaW5nRGF0YS5iaW5kaW5nUGF0aCk7XHJcbiAgfVxyXG4gIEBIb3N0TGlzdGVuZXIoJ2ZpbHRlckNoYW5nZWQnLCBbJyRldmVudCddKVxyXG4gIHB1YmxpYyBmaWx0ZXJDaGFuZ2VkKGV2ZW50OiBhbnkpIHtcclxuICAgIHRoaXMuZmlsdGVycyA9IGV2ZW50O1xyXG4gIH1cclxuICAvLyAjZW5kcmVnaW9uXHJcbiAgcHJpdmF0ZSBjaGVja0lmQ2hhbmdlTWF0Y2hCaW5kaW5nUGF0aChjaGFuZ2U6IENoYW5nZSk6IGJvb2xlYW4ge1xyXG4gICAgbGV0IGlzTWF0Y2ggPSBmYWxzZTtcclxuICAgIGlmICghY2hhbmdlIHx8ICFjaGFuZ2UucGF0aCkge1xyXG4gICAgICByZXR1cm4gaXNNYXRjaDtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBjaGFuZ2VQYXRoQXJyYXkgPSBjaGFuZ2UucGF0aDtcclxuICAgIGlmICghY2hhbmdlUGF0aEFycmF5KSB7XHJcbiAgICAgIHJldHVybiBpc01hdGNoO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICghKHRoaXMuYmluZGluZ0RhdGEpICYmICEodGhpcy5iaW5kaW5nRGF0YS5iaW5kaW5nUGF0aCkpIHtcclxuICAgICAgcmV0dXJuIGlzTWF0Y2g7XHJcbiAgICB9XHJcbiAgICBjb25zdCBiaW5nZGluZ1BhdGhBcnJheSA9IHRoaXMuYmluZGluZ0RhdGEuYmluZGluZ1BhdGguc3BsaXQoJy8nKTtcclxuICAgIGlmIChiaW5nZGluZ1BhdGhBcnJheS5sZW5ndGggPD0gMCkge1xyXG4gICAgICByZXR1cm4gaXNNYXRjaDtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoY2hhbmdlUGF0aEFycmF5Lmxlbmd0aCA9PT0gMCkgeyAvLyDkuLvooahcclxuICAgICAgaWYgKHRoaXMuYmluZGluZ0RhdGEuYmluZGluZ1BhdGggPT09ICcvJykge1xyXG4gICAgICAgIGlzTWF0Y2ggPSB0cnVlO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2UgaWYgKGNoYW5nZS5wYXRoLmxlbmd0aCA9PT0gMSkgey8vIOS4u+S7juihqFxyXG4gICAgICBpZiAoYmluZ2RpbmdQYXRoQXJyYXkubGVuZ3RoID09PSAyICYmIGJpbmdkaW5nUGF0aEFycmF5WzFdID09PSBjaGFuZ2UucGF0aFswXSkge1xyXG4gICAgICAgIGlzTWF0Y2ggPSB0cnVlO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2UgaWYgKGNoYW5nZS5wYXRoLmxlbmd0aCA9PT0gMikgeyAvLyDkuLvku47ku47ooahcclxuICAgICAgaWYgKGJpbmdkaW5nUGF0aEFycmF5Lmxlbmd0aCA9PT0gMyAmJiBiaW5nZGluZ1BhdGhBcnJheVsxXSA9PT0gY2hhbmdlLnBhdGhbMF0gJiYgYmluZ2RpbmdQYXRoQXJyYXlbMl0gPT09IGNoYW5nZS5wYXRoWzFdKSB7XHJcbiAgICAgICAgaXNNYXRjaCA9IHRydWU7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gaXNNYXRjaDtcclxuICB9XHJcblxyXG59XHJcbiJdfQ==