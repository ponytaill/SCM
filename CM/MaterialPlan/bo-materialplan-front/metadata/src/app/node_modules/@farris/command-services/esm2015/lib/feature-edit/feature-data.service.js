import { Inject, Injectable, Injector, LOCALE_ID, Optional } from "@angular/core";
import { map } from "rxjs/operators";
import { FeatureRepository } from "./feature-repository";
import { Prop } from "./types";
export class FeatureDataService {
    constructor(injector, repository, localeId) {
        this.injector = injector;
        this.repository = repository;
        this.localeId = localeId;
        this.localeId = this.localeId || 'zh-CHS';
    }
    /**
     * 根据物料id获取物料特征项及特征值（公共默认值）
     * @param materialId 物料id
     */
    getFeaturesByMaterialId(materialId) {
        return this.repository.getFeaturesByMaterialId(materialId).pipe(map((response) => {
            if (!response || !response.returnValue) {
                return null;
            }
            const returnValue = JSON.parse(response.returnValue);
            const result = { propset: [], props: [] };
            const propsets = returnValue.propset || null;
            const props = returnValue.props || null;
            if (propsets && Array.isArray(propsets)) {
                propsets.map((propset) => {
                    propset.name = this.translateName(propset);
                    return propset;
                });
                result.propset = propsets;
            }
            if (props && Array.isArray(props) && props.length > 0) {
                props.map((prop) => {
                    // 处理多语
                    prop.name = this.translateName(prop);
                    // 处理枚举
                    if (prop.inputtype === Prop.InputType.enum && prop.enuminfo) {
                        prop.data = JSON.parse(prop.enuminfo);
                    }
                    // 处理必填和只读
                    prop.isreadonly = prop.isreadonly === '1' ? true : false;
                    prop.isrequired = prop.isrequired === '1' ? true : false;
                    return prop;
                });
                result.props = props;
            }
            return result;
        }));
    }
    /**
     * 根据物料id及物料特征保存后的hash获取该物料已经存储的特征项值
     * @param materialId 物料Id
     * @param configID 对应该物料的特征项hash
     * @returns
     */
    getConfigedValueByFeatureId(materialId, configID, configType = 'Materials') {
        return this.repository.getConfigedValueByFeatureId(materialId, configID, configType).pipe(map((result) => {
            return JSON.parse(result);
        }));
    }
    /**
     * 保存物料特征项
     * @param materialId 物料id
     * @param charactValue 特征值
     * @param configType 配置类型
     * @returns
     */
    applyFeatures(materialId, charactValue, configType = 'Materials') {
        return this.repository.applyFeatures(materialId, charactValue, configType).pipe(map((config) => {
            return JSON.parse(config);
        }));
    }
    /**
     * 获取帮助信息
     * @param helpid 帮助id
     * @param filter 过滤条件
     * @param params 参数
     * @returns
     */
    getHelpInfo(helpid, filter, params) {
        const url = '/api/scm/scmfnd/v1.0/scmcommoncmpservice/service/gethelpdata';
        const httpParams = {};
        if (params) {
            if (params.pageIndex) {
                httpParams['pageIndex'] = JSON.stringify(params.pageIndex - 0);
            }
            if (params.pageSize) {
                httpParams['pageSize'] = JSON.stringify(params.pageSize - 0);
            }
            if (params.condition) {
                httpParams['condition'] = JSON.stringify(params.condition);
            }
            if (params.searchValue) {
                httpParams['search'] = params.searchValue;
            }
        }
        const body = {
            helpID: helpid,
            queryParam: JSON.stringify(httpParams),
            filterStr: filter
        };
        const befRepository = null; //this.repository as BefRepository<any>;
        const options = {
            body
        };
        return befRepository.proxy.request(url, 'put', null, options).pipe(map((result) => JSON.parse(result)));
    }
    /**
     * 国际化特征项或特征集名称
     * @param object 特征集或特征项对象
     * @returns
     */
    translateName(object) {
        if (!object) {
            return null;
        }
        let name = null;
        switch (this.localeId) {
            case 'en':
                {
                    name = object['name_en'];
                }
                break;
            case 'zh-CHS':
                {
                    name = object['name_chs'];
                }
                break;
            case 'zh-CHT':
                {
                    name = object['name_cht'];
                }
                break;
            default: name = object['name_chs'];
        }
        return name;
    }
}
FeatureDataService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
FeatureDataService.ctorParameters = () => [
    { type: Injector },
    { type: FeatureRepository },
    { type: String, decorators: [{ type: Optional }, { type: Inject, args: [LOCALE_ID,] }] }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmVhdHVyZS1kYXRhLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2NvbW1hbmQtc2VydmljZXMvIiwic291cmNlcyI6WyJsaWIvZmVhdHVyZS1lZGl0L2ZlYXR1cmUtZGF0YS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxTQUFTLEVBQUUsUUFBUSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBSWxGLE9BQU8sRUFBRSxHQUFHLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNyQyxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUN6RCxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sU0FBUyxDQUFDO0FBRy9CLE1BQU0sT0FBTyxrQkFBa0I7SUFDN0IsWUFDVSxRQUFrQixFQUNsQixVQUE2QixFQUNFLFFBQWlCO1FBRmhELGFBQVEsR0FBUixRQUFRLENBQVU7UUFDbEIsZUFBVSxHQUFWLFVBQVUsQ0FBbUI7UUFDRSxhQUFRLEdBQVIsUUFBUSxDQUFTO1FBRXhELElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLFFBQVEsSUFBSSxRQUFRLENBQUM7SUFDNUMsQ0FBQztJQUNEOzs7T0FHRztJQUNJLHVCQUF1QixDQUFDLFVBQWtCO1FBQy9DLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyx1QkFBdUIsQ0FBQyxVQUFVLENBQUMsQ0FBQyxJQUFJLENBQzdELEdBQUcsQ0FBQyxDQUFDLFFBQXNCLEVBQUUsRUFBRTtZQUM3QixJQUFJLENBQUMsUUFBUSxJQUFJLENBQUMsUUFBUSxDQUFDLFdBQVcsRUFBRTtnQkFDdEMsT0FBTyxJQUFJLENBQUM7YUFDYjtZQUNELE1BQU0sV0FBVyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQ3JELE1BQU0sTUFBTSxHQUFzQixFQUFFLE9BQU8sRUFB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QUNiO1FBQ0QsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBQ2hCLFFBQVEsSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNyQixLQUFLLElBQUk7Z0JBQUU7b0JBQ1QsSUFBSSxHQUFHLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQztpQkFDMUI7Z0JBQUMsTUFBTTtZQUNSLEtBQUssUUFBUTtnQkFBRTtvQkFDYixJQUFJLEdBQUcsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDO2lCQUMzQjtnQkFBQyxNQUFNO1lBQ1IsS0FBSyxRQUFRO2dCQUFFO29CQUNiLElBQUksR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUM7aUJBQzNCO2dCQUFDLE1BQU07WUFDUixPQUFPLENBQUMsQ0FBQyxJQUFJLEdBQUcsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1NBQ3BDO1FBQ0QsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDOzs7WUFwSUYsVUFBVTs7OztZQVJrQixRQUFRO1lBSzVCLGlCQUFpQjt5Q0FRckIsUUFBUSxZQUFJLE1BQU0sU0FBQyxTQUFTIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0LCBJbmplY3RhYmxlLCBJbmplY3RvciwgTE9DQUxFX0lELCBPcHRpb25hbCB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XHJcbmltcG9ydCB7IEJlZlJlcG9zaXRvcnksIFJlc3BvbnNlSW5mbyB9IGZyb20gXCJAZmFycmlzL2JlZlwiO1xyXG5pbXBvcnQgeyBGcmFtZUNvbnRleHQsIFJlc3RmdWxTZXJ2aWNlLCBSZXBvc2l0b3J5IH0gZnJvbSAnQGZhcnJpcy9kZXZraXQnO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSBcInJ4anNcIjtcclxuaW1wb3J0IHsgbWFwIH0gZnJvbSBcInJ4anMvb3BlcmF0b3JzXCI7XHJcbmltcG9ydCB7IEZlYXR1cmVSZXBvc2l0b3J5IH0gZnJvbSBcIi4vZmVhdHVyZS1yZXBvc2l0b3J5XCI7XHJcbmltcG9ydCB7IFByb3AgfSBmcm9tIFwiLi90eXBlc1wiO1xyXG5cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgRmVhdHVyZURhdGFTZXJ2aWNlIHtcclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yLFxyXG4gICAgcHJpdmF0ZSByZXBvc2l0b3J5OiBGZWF0dXJlUmVwb3NpdG9yeSxcclxuICAgIEBPcHRpb25hbCgpIEBJbmplY3QoTE9DQUxFX0lEKSBwcml2YXRlIGxvY2FsZUlkPzogc3RyaW5nXHJcbiAgKSB7XHJcbiAgICB0aGlzLmxvY2FsZUlkID0gdGhpcy5sb2NhbGVJZCB8fCAnemgtQ0hTJztcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5qC55o2u54mp5paZaWTojrflj5bnianmlpnnibnlvoHpobnlj4rnibnlvoHlgLzvvIjlhazlhbHpu5jorqTlgLzvvIlcclxuICAgKiBAcGFyYW0gbWF0ZXJpYWxJZCDnianmlplpZFxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRGZWF0dXJlc0J5TWF0ZXJpYWxJZChtYXRlcmlhbElkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPFByb3AuSVJldHVyblZhbHVlPiB7XHJcbiAgICByZXR1cm4gdGhpcy5yZXBvc2l0b3J5LmdldEZlYXR1cmVzQnlNYXRlcmlhbElkKG1hdGVyaWFsSWQpLnBpcGUoXHJcbiAgICAgIG1hcCgocmVzcG9uc2U6IFJlc3BvbnNlSW5mbykgPT4ge1xyXG4gICAgICAgIGlmICghcmVzcG9uc2UgfHwgIXJlc3BvbnNlLnJldHVyblZhbHVlKSB7XHJcbiAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgcmV0dXJuVmFsdWUgPSBKU09OLnBhcnNlKHJlc3BvbnNlLnJldHVyblZhbHVlKTtcclxuICAgICAgICBjb25zdCByZXN1bHQ6IFByb3AuSVJldHVyblZhbHVlID0geyBwcm9wc2V0OiBbXSwgcHJvcHM6IFtdIH07XHJcbiAgICAgICAgY29uc3QgcHJvcHNldHMgPSByZXR1cm5WYWx1ZS5wcm9wc2V0IHx8IG51bGw7XHJcbiAgICAgICAgY29uc3QgcHJvcHMgPSByZXR1cm5WYWx1ZS5wcm9wcyB8fCBudWxsO1xyXG4gICAgICAgIGlmIChwcm9wc2V0cyAmJiBBcnJheS5pc0FycmF5KHByb3BzZXRzKSkge1xyXG4gICAgICAgICAgcHJvcHNldHMubWFwKChwcm9wc2V0OiBQcm9wLklQcm9wU2V0KSA9PiB7XHJcbiAgICAgICAgICAgIHByb3BzZXQubmFtZSA9IHRoaXMudHJhbnNsYXRlTmFtZShwcm9wc2V0KTtcclxuICAgICAgICAgICAgcmV0dXJuIHByb3BzZXQ7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICAgIHJlc3VsdC5wcm9wc2V0ID0gcHJvcHNldHM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChwcm9wcyAmJiBBcnJheS5pc0FycmF5KHByb3BzKSAmJiBwcm9wcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICBwcm9wcy5tYXAoKHByb3A6IFByb3AuSVByb3ApID0+IHtcclxuICAgICAgICAgICAgLy8g5aSE55CG5aSa6K+tXHJcbiAgICAgICAgICAgIHByb3AubmFtZSA9IHRoaXMudHJhbnNsYXRlTmFtZShwcm9wKTtcclxuICAgICAgICAgICAgLy8g5aSE55CG5p6a5Li+XHJcbiAgICAgICAgICAgIGlmIChwcm9wLmlucHV0dHlwZSA9PT0gUHJvcC5JbnB1dFR5cGUuZW51bSAmJiBwcm9wLmVudW1pbmZvKSB7XHJcbiAgICAgICAgICAgICAgcHJvcC5kYXRhID0gSlNPTi5wYXJzZShwcm9wLmVudW1pbmZvKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyDlpITnkIblv4Xloavlkozlj6ror7tcclxuICAgICAgICAgICAgcHJvcC5pc3JlYWRvbmx5ID0gcHJvcC5pc3JlYWRvbmx5ID09PSAnMScgPyB0cnVlIDogZmFsc2U7XHJcbiAgICAgICAgICAgIHByb3AuaXNyZXF1aXJlZCA9IHByb3AuaXNyZXF1aXJlZCA9PT0gJzEnID8gdHJ1ZSA6IGZhbHNlO1xyXG4gICAgICAgICAgICByZXR1cm4gcHJvcDtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgcmVzdWx0LnByb3BzID0gcHJvcHM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmoLnmja7nianmlplpZOWPiueJqeaWmeeJueW+geS/neWtmOWQjueahGhhc2jojrflj5bor6Xnianmlpnlt7Lnu4/lrZjlgqjnmoTnibnlvoHpobnlgLxcclxuICAgKiBAcGFyYW0gbWF0ZXJpYWxJZCDnianmlplJZFxyXG4gICAqIEBwYXJhbSBjb25maWdJRCDlr7nlupTor6XnianmlpnnmoTnibnlvoHpobloYXNoXHJcbiAgICogQHJldHVybnMgXHJcbiAgICovXHJcbiAgcHVibGljIGdldENvbmZpZ2VkVmFsdWVCeUZlYXR1cmVJZChtYXRlcmlhbElkOiBzdHJpbmcsIGNvbmZpZ0lEOiBzdHJpbmcsIGNvbmZpZ1R5cGU6IHN0cmluZyA9ICdNYXRlcmlhbHMnKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIHJldHVybiB0aGlzLnJlcG9zaXRvcnkuZ2V0Q29uZmlnZWRWYWx1ZUJ5RmVhdHVyZUlkKG1hdGVyaWFsSWQsIGNvbmZpZ0lELCBjb25maWdUeXBlKS5waXBlKG1hcCgocmVzdWx0OiBhbnkpID0+IHtcclxuICAgICAgcmV0dXJuIEpTT04ucGFyc2UocmVzdWx0KTtcclxuICAgIH0pKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5L+d5a2Y54mp5paZ54m55b6B6aG5XHJcbiAgICogQHBhcmFtIG1hdGVyaWFsSWQg54mp5paZaWRcclxuICAgKiBAcGFyYW0gY2hhcmFjdFZhbHVlIOeJueW+geWAvFxyXG4gICAqIEBwYXJhbSBjb25maWdUeXBlIOmFjee9ruexu+Wei1xyXG4gICAqIEByZXR1cm5zIFxyXG4gICAqL1xyXG4gIHB1YmxpYyBhcHBseUZlYXR1cmVzKG1hdGVyaWFsSWQ6IHN0cmluZywgY2hhcmFjdFZhbHVlOiBhbnksIGNvbmZpZ1R5cGU6IHN0cmluZyA9ICdNYXRlcmlhbHMnKSB7XHJcbiAgICByZXR1cm4gdGhpcy5yZXBvc2l0b3J5LmFwcGx5RmVhdHVyZXMobWF0ZXJpYWxJZCwgY2hhcmFjdFZhbHVlLCBjb25maWdUeXBlKS5waXBlKG1hcCgoY29uZmlnOiBhbnkpID0+IHtcclxuICAgICAgcmV0dXJuIEpTT04ucGFyc2UoY29uZmlnKTtcclxuICAgIH0pKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6I635Y+W5biu5Yqp5L+h5oGvXHJcbiAgICogQHBhcmFtIGhlbHBpZCDluK7liqlpZFxyXG4gICAqIEBwYXJhbSBmaWx0ZXIg6L+H5ruk5p2h5Lu2XHJcbiAgICogQHBhcmFtIHBhcmFtcyDlj4LmlbBcclxuICAgKiBAcmV0dXJucyBcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0SGVscEluZm8oaGVscGlkOiBzdHJpbmcsIGZpbHRlcjogc3RyaW5nLCBwYXJhbXM6IGFueSk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBjb25zdCB1cmwgPSAnL2FwaS9zY20vc2NtZm5kL3YxLjAvc2NtY29tbW9uY21wc2VydmljZS9zZXJ2aWNlL2dldGhlbHBkYXRhJztcclxuICAgIGNvbnN0IGh0dHBQYXJhbXM6IGFueSA9IHt9O1xyXG4gICAgaWYgKHBhcmFtcykge1xyXG4gICAgICBpZiAocGFyYW1zLnBhZ2VJbmRleCkge1xyXG4gICAgICAgIGh0dHBQYXJhbXNbJ3BhZ2VJbmRleCddID0gSlNPTi5zdHJpbmdpZnkocGFyYW1zLnBhZ2VJbmRleCAtIDApO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChwYXJhbXMucGFnZVNpemUpIHtcclxuICAgICAgICBodHRwUGFyYW1zWydwYWdlU2l6ZSddID0gSlNPTi5zdHJpbmdpZnkocGFyYW1zLnBhZ2VTaXplIC0gMCk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKHBhcmFtcy5jb25kaXRpb24pIHtcclxuICAgICAgICBodHRwUGFyYW1zWydjb25kaXRpb24nXSA9IEpTT04uc3RyaW5naWZ5KHBhcmFtcy5jb25kaXRpb24pO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChwYXJhbXMuc2VhcmNoVmFsdWUpIHtcclxuICAgICAgICBodHRwUGFyYW1zWydzZWFyY2gnXSA9IHBhcmFtcy5zZWFyY2hWYWx1ZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgY29uc3QgYm9keSA9IHtcclxuICAgICAgaGVscElEOiBoZWxwaWQsXHJcbiAgICAgIHF1ZXJ5UGFyYW06IEpTT04uc3RyaW5naWZ5KGh0dHBQYXJhbXMpLFxyXG4gICAgICBmaWx0ZXJTdHI6IGZpbHRlclxyXG4gICAgfTtcclxuICAgIGNvbnN0IGJlZlJlcG9zaXRvcnk6IEJlZlJlcG9zaXRvcnk8YW55PiA9IG51bGw7Ly90aGlzLnJlcG9zaXRvcnkgYXMgQmVmUmVwb3NpdG9yeTxhbnk+O1xyXG4gICAgY29uc3Qgb3B0aW9ucyA9IHtcclxuICAgICAgYm9keVxyXG4gICAgfTtcclxuICAgIHJldHVybiBiZWZSZXBvc2l0b3J5LnByb3h5LnJlcXVlc3QodXJsLCAncHV0JywgbnVsbCwgb3B0aW9ucykucGlwZShcclxuICAgICAgbWFwKChyZXN1bHQ6IGFueSkgPT4gSlNPTi5wYXJzZShyZXN1bHQpKVxyXG4gICAgKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5Zu96ZmF5YyW54m55b6B6aG55oiW54m55b6B6ZuG5ZCN56ewXHJcbiAgICogQHBhcmFtIG9iamVjdCDnibnlvoHpm4bmiJbnibnlvoHpobnlr7nosaFcclxuICAgKiBAcmV0dXJucyBcclxuICAgKi9cclxuICBwcml2YXRlIHRyYW5zbGF0ZU5hbWUob2JqZWN0OiBQcm9wLklQcm9wU2V0IHwgUHJvcC5JUHJvcCk6IHN0cmluZyB7XHJcbiAgICBpZiAoIW9iamVjdCkge1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICAgIGxldCBuYW1lID0gbnVsbDtcclxuICAgIHN3aXRjaCAodGhpcy5sb2NhbGVJZCkge1xyXG4gICAgICBjYXNlICdlbic6IHtcclxuICAgICAgICBuYW1lID0gb2JqZWN0WyduYW1lX2VuJ107XHJcbiAgICAgIH0gYnJlYWs7XHJcbiAgICAgIGNhc2UgJ3poLUNIUyc6IHtcclxuICAgICAgICBuYW1lID0gb2JqZWN0WyduYW1lX2NocyddO1xyXG4gICAgICB9IGJyZWFrO1xyXG4gICAgICBjYXNlICd6aC1DSFQnOiB7XHJcbiAgICAgICAgbmFtZSA9IG9iamVjdFsnbmFtZV9jaHQnXTtcclxuICAgICAgfSBicmVhaztcclxuICAgICAgZGVmYXVsdDogbmFtZSA9IG9iamVjdFsnbmFtZV9jaHMnXTtcclxuICAgIH1cclxuICAgIHJldHVybiBuYW1lO1xyXG4gIH1cclxufSJdfQ==