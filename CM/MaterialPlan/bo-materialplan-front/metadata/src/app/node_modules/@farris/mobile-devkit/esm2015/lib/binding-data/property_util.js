import { FieldMetadataUtil } from '../entity/index';
import { BindingPropertyType } from './binding_property';
/**
 * 属性工具类
 */
class PropertyUtil {
    /**
     * 获取实体上的属性集合，并将他们转换成BindingProperty集合
     * @param  entityType 实体类型
     * @returns 绑定属性集合
     */
    static getProperties(entityType) {
        const properties = [];
        // Plain
        const ngFieldProperties = FieldMetadataUtil.getNgFields(entityType);
        Object.keys(ngFieldProperties).forEach((propertyName) => {
            const ngFieldProperty = ngFieldProperties[propertyName];
            properties.push({
                name: propertyName,
                type: BindingPropertyType.Plain,
                isPrimaryKey: ngFieldProperty.primary,
                isForeignKey: ngFieldProperty.foreign,
                enableMultiLangInput: ngFieldProperty.enableMultiLangInput
            });
        });
        // Object
        const ngObjectProperties = FieldMetadataUtil.getNgObjects(entityType);
        Object.keys(ngObjectProperties).forEach((propertyName) => {
            const ngObjectProperty = ngObjectProperties[propertyName];
            properties.push({
                name: propertyName,
                type: BindingPropertyType.Object,
                entityType: ngObjectProperty.type
            });
        });
        // List
        const ngListProperties = FieldMetadataUtil.getNgList(entityType);
        Object.keys(ngListProperties).forEach((propertyName) => {
            const ngListProperty = ngListProperties[propertyName];
            properties.push({
                name: propertyName,
                type: BindingPropertyType.List,
                entityType: ngListProperty.type
            });
        });
        // Dynamics
        const ngDynamicProperties = FieldMetadataUtil.getNgDynamic(entityType);
        Object.keys(ngDynamicProperties).forEach((propertyName) => {
            const ngDynamicProperty = ngDynamicProperties[propertyName];
            properties.push({
                name: propertyName,
                type: BindingPropertyType.Dynamic,
                entityType: ngDynamicProperty.type
            });
        });
        return properties;
    }
    static getDynamicProperties(dynamicData) {
        const properties = [];
        Object.keys(dynamicData).forEach((propertyName) => {
            if (dynamicData.hasOwnProperty(propertyName)) {
                if (dynamicData[propertyName] instanceof Object) {
                    properties.push({
                        name: propertyName,
                        type: BindingPropertyType.Dynamic,
                        entityType: null
                    });
                }
                else {
                    properties.push({
                        name: propertyName,
                        type: BindingPropertyType.Plain,
                        isPrimaryKey: false,
                        isForeignKey: false
                    });
                }
            }
        });
        return properties;
    }
    /**
     * 根据属性名获取属性
     */
    static getPropertyByName(properties, propertyName) {
        const targetProperty = properties.find((property) => {
            return property.name === propertyName;
        });
        return targetProperty;
    }
    /**
     * 获取实体主键名
     * @param properties 属性集合
     * @returns 主键名
     */
    static getPrimaryKey(properties) {
        // 实体必须有主键，如果没有主键在构造实体的时候就已经报错，这里不需要再进行检查
        const primaryProperty = properties.find((property) => {
            return property.isPrimaryKey === true;
        });
        return primaryProperty ? primaryProperty.name : '';
    }
}
export { PropertyUtil };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvcGVydHlfdXRpbC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvbW9iaWxlLWRldmtpdC8iLCJzb3VyY2VzIjpbImxpYi9iaW5kaW5nLWRhdGEvcHJvcGVydHlfdXRpbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQVUsaUJBQWlCLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUM1RCxPQUFPLEVBQW1CLG1CQUFtQixFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFFMUU7O0dBRUc7QUFDSCxNQUFNLFlBQVk7SUFFaEI7Ozs7T0FJRztJQUNILE1BQU0sQ0FBQyxhQUFhLENBQUMsVUFBd0I7UUFDM0MsTUFBTSxVQUFVLEdBQUcsRUFBRSxDQUFDO1FBRXRCLFFBQVE7UUFDUixNQUFNLGlCQUFpQixHQUFHLGlCQUFpQixDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUNwRSxNQUFNLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsWUFBb0IsRUFBRSxFQUFFO1lBQzlELE1BQU0sZUFBZSxHQUFHLGlCQUFpQixDQUFDLFlBQVksQ0FBQyxDQUFDO1lBQ3hELFVBQVUsQ0FBQyxJQUFJLENBQUM7Z0JBQ2QsSUFBSSxFQUFFLFlBQVk7Z0JBQ2xCLElBQUksRUFBRSxtQkFBbUIsQ0FBQyxLQUFLO2dCQUMvQixZQUFZLEVBQUUsZUFBZSxDQUFDLE9BQU87Z0JBQ3JDLFlBQVksRUFBRSxlQUFlLENBQUMsT0FBTztnQkFDckMsb0JBQW9CLEVBQUUsZUFBZSxDQUFDLG9CQUFvQjthQUMzRCxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUVILFNBQVM7UUFDVCxNQUFNLGtCQUFrQixHQUFHLGlCQUFpQixDQUFDLFlBQVksQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUN0RSxNQUFNLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsWUFBb0IsRUFBRSxFQUFFO1lB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QUFFLEVBQUU7WUFDcEUsT0FBTyxRQUFRLENBQUMsWUFBWSxLQUFLLElBQUksQ0FBQztRQUN4QyxDQUFDLENBQUMsQ0FBQztRQUNILE9BQU8sZUFBZSxDQUFDLENBQUMsQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7SUFDckQsQ0FBQztDQUVGO0FBRUQsT0FBTyxFQUFFLFlBQVksRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtUeXBlfSBmcm9tICcuLi9jb3JlL2luZGV4JztcclxuaW1wb3J0IHsgRW50aXR5LCBGaWVsZE1ldGFkYXRhVXRpbCB9IGZyb20gJy4uL2VudGl0eS9pbmRleCc7XHJcbmltcG9ydCB7IEJpbmRpbmdQcm9wZXJ0eSwgQmluZGluZ1Byb3BlcnR5VHlwZSB9IGZyb20gJy4vYmluZGluZ19wcm9wZXJ0eSc7XHJcblxyXG4vKipcclxuICog5bGe5oCn5bel5YW357G7XHJcbiAqL1xyXG5jbGFzcyBQcm9wZXJ0eVV0aWwge1xyXG5cclxuICAvKipcclxuICAgKiDojrflj5blrp7kvZPkuIrnmoTlsZ7mgKfpm4blkIjvvIzlubblsIbku5bku6zovazmjaLmiJBCaW5kaW5nUHJvcGVydHnpm4blkIhcclxuICAgKiBAcGFyYW0gIGVudGl0eVR5cGUg5a6e5L2T57G75Z6LXHJcbiAgICogQHJldHVybnMg57uR5a6a5bGe5oCn6ZuG5ZCIXHJcbiAgICovXHJcbiAgc3RhdGljIGdldFByb3BlcnRpZXMoZW50aXR5VHlwZTogVHlwZTxFbnRpdHk+KTogQmluZGluZ1Byb3BlcnR5W10ge1xyXG4gICAgY29uc3QgcHJvcGVydGllcyA9IFtdO1xyXG5cclxuICAgIC8vIFBsYWluXHJcbiAgICBjb25zdCBuZ0ZpZWxkUHJvcGVydGllcyA9IEZpZWxkTWV0YWRhdGFVdGlsLmdldE5nRmllbGRzKGVudGl0eVR5cGUpO1xyXG4gICAgT2JqZWN0LmtleXMobmdGaWVsZFByb3BlcnRpZXMpLmZvckVhY2goKHByb3BlcnR5TmFtZTogc3RyaW5nKSA9PiB7XHJcbiAgICAgIGNvbnN0IG5nRmllbGRQcm9wZXJ0eSA9IG5nRmllbGRQcm9wZXJ0aWVzW3Byb3BlcnR5TmFtZV07XHJcbiAgICAgIHByb3BlcnRpZXMucHVzaCh7XHJcbiAgICAgICAgbmFtZTogcHJvcGVydHlOYW1lLFxyXG4gICAgICAgIHR5cGU6IEJpbmRpbmdQcm9wZXJ0eVR5cGUuUGxhaW4sXHJcbiAgICAgICAgaXNQcmltYXJ5S2V5OiBuZ0ZpZWxkUHJvcGVydHkucHJpbWFyeSxcclxuICAgICAgICBpc0ZvcmVpZ25LZXk6IG5nRmllbGRQcm9wZXJ0eS5mb3JlaWduLFxyXG4gICAgICAgIGVuYWJsZU11bHRpTGFuZ0lucHV0OiBuZ0ZpZWxkUHJvcGVydHkuZW5hYmxlTXVsdGlMYW5nSW5wdXRcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBPYmplY3RcclxuICAgIGNvbnN0IG5nT2JqZWN0UHJvcGVydGllcyA9IEZpZWxkTWV0YWRhdGFVdGlsLmdldE5nT2JqZWN0cyhlbnRpdHlUeXBlKTtcclxuICAgIE9iamVjdC5rZXlzKG5nT2JqZWN0UHJvcGVydGllcykuZm9yRWFjaCgocHJvcGVydHlOYW1lOiBzdHJpbmcpID0+IHtcclxuICAgICAgY29uc3QgbmdPYmplY3RQcm9wZXJ0eSA9IG5nT2JqZWN0UHJvcGVydGllc1twcm9wZXJ0eU5hbWVdO1xyXG4gICAgICBwcm9wZXJ0aWVzLnB1c2goe1xyXG4gICAgICAgIG5hbWU6IHByb3BlcnR5TmFtZSxcclxuICAgICAgICB0eXBlOiBCaW5kaW5nUHJvcGVydHlUeXBlLk9iamVjdCxcclxuICAgICAgICBlbnRpdHlUeXBlOiBuZ09iamVjdFByb3BlcnR5LnR5cGVcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBMaXN0XHJcbiAgICBjb25zdCBuZ0xpc3RQcm9wZXJ0aWVzID0gRmllbGRNZXRhZGF0YVV0aWwuZ2V0TmdMaXN0KGVudGl0eVR5cGUpO1xyXG4gICAgT2JqZWN0LmtleXMobmdMaXN0UHJvcGVydGllcykuZm9yRWFjaCgocHJvcGVydHlOYW1lOiBzdHJpbmcpID0+IHtcclxuICAgICAgY29uc3QgbmdMaXN0UHJvcGVydHkgPSBuZ0xpc3RQcm9wZXJ0aWVzW3Byb3BlcnR5TmFtZV07XHJcbiAgICAgIHByb3BlcnRpZXMucHVzaCh7XHJcbiAgICAgICAgbmFtZTogcHJvcGVydHlOYW1lLFxyXG4gICAgICAgIHR5cGU6IEJpbmRpbmdQcm9wZXJ0eVR5cGUuTGlzdCxcclxuICAgICAgICBlbnRpdHlUeXBlOiBuZ0xpc3RQcm9wZXJ0eS50eXBlXHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gRHluYW1pY3NcclxuICAgIGNvbnN0IG5nRHluYW1pY1Byb3BlcnRpZXMgPSBGaWVsZE1ldGFkYXRhVXRpbC5nZXROZ0R5bmFtaWMoZW50aXR5VHlwZSk7XHJcbiAgICBPYmplY3Qua2V5cyhuZ0R5bmFtaWNQcm9wZXJ0aWVzKS5mb3JFYWNoKChwcm9wZXJ0eU5hbWU6IHN0cmluZykgPT4ge1xyXG4gICAgICBjb25zdCBuZ0R5bmFtaWNQcm9wZXJ0eSA9IG5nRHluYW1pY1Byb3BlcnRpZXNbcHJvcGVydHlOYW1lXTtcclxuICAgICAgcHJvcGVydGllcy5wdXNoKHtcclxuICAgICAgICBuYW1lOiBwcm9wZXJ0eU5hbWUsXHJcbiAgICAgICAgdHlwZTogQmluZGluZ1Byb3BlcnR5VHlwZS5EeW5hbWljLFxyXG4gICAgICAgIGVudGl0eVR5cGU6IG5nRHluYW1pY1Byb3BlcnR5LnR5cGVcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gcHJvcGVydGllcztcclxuICB9XHJcblxyXG4gIHN0YXRpYyBnZXREeW5hbWljUHJvcGVydGllcyhkeW5hbWljRGF0YTogYW55KTogQmluZGluZ1Byb3BlcnR5W10ge1xyXG4gICAgY29uc3QgcHJvcGVydGllcyA9IFtdO1xyXG4gICAgT2JqZWN0LmtleXMoZHluYW1pY0RhdGEpLmZvckVhY2goKHByb3BlcnR5TmFtZTogc3RyaW5nKSA9PiB7XHJcbiAgICAgIGlmIChkeW5hbWljRGF0YS5oYXNPd25Qcm9wZXJ0eShwcm9wZXJ0eU5hbWUpKSB7XHJcbiAgICAgICAgaWYgKGR5bmFtaWNEYXRhW3Byb3BlcnR5TmFtZV0gaW5zdGFuY2VvZiBPYmplY3QpIHtcclxuICAgICAgICAgIHByb3BlcnRpZXMucHVzaCh7XHJcbiAgICAgICAgICAgIG5hbWU6IHByb3BlcnR5TmFtZSxcclxuICAgICAgICAgICAgdHlwZTogQmluZGluZ1Byb3BlcnR5VHlwZS5EeW5hbWljLFxyXG4gICAgICAgICAgICBlbnRpdHlUeXBlOiBudWxsXHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgcHJvcGVydGllcy5wdXNoKHtcclxuICAgICAgICAgICAgbmFtZTogcHJvcGVydHlOYW1lLFxyXG4gICAgICAgICAgICB0eXBlOiBCaW5kaW5nUHJvcGVydHlUeXBlLlBsYWluLFxyXG4gICAgICAgICAgICBpc1ByaW1hcnlLZXk6IGZhbHNlLFxyXG4gICAgICAgICAgICBpc0ZvcmVpZ25LZXk6IGZhbHNlXHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIHByb3BlcnRpZXM7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOagueaNruWxnuaAp+WQjeiOt+WPluWxnuaAp1xyXG4gICAqL1xyXG4gIHN0YXRpYyBnZXRQcm9wZXJ0eUJ5TmFtZShwcm9wZXJ0aWVzOiBCaW5kaW5nUHJvcGVydHlbXSwgcHJvcGVydHlOYW1lOiBzdHJpbmcpOiBCaW5kaW5nUHJvcGVydHkge1xyXG4gICAgY29uc3QgdGFyZ2V0UHJvcGVydHkgPSAgcHJvcGVydGllcy5maW5kKChwcm9wZXJ0eTogQmluZGluZ1Byb3BlcnR5KSA9PiB7XHJcbiAgICAgIHJldHVybiBwcm9wZXJ0eS5uYW1lID09PSBwcm9wZXJ0eU5hbWU7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiB0YXJnZXRQcm9wZXJ0eTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluWunuS9k+S4u+mUruWQjVxyXG4gICAqIEBwYXJhbSBwcm9wZXJ0aWVzIOWxnuaAp+mbhuWQiFxyXG4gICAqIEByZXR1cm5zIOS4u+mUruWQjVxyXG4gICAqL1xyXG4gIHN0YXRpYyBnZXRQcmltYXJ5S2V5KHByb3BlcnRpZXM6IEJpbmRpbmdQcm9wZXJ0eVtdKTogc3RyaW5nIHtcclxuXHJcbiAgICAvLyDlrp7kvZPlv4XpobvmnInkuLvplK7vvIzlpoLmnpzmsqHmnInkuLvplK7lnKjmnoTpgKDlrp7kvZPnmoTml7blgJnlsLHlt7Lnu4/miqXplJnvvIzov5nph4zkuI3pnIDopoHlho3ov5vooYzmo4Dmn6VcclxuICAgIGNvbnN0IHByaW1hcnlQcm9wZXJ0eSA9IHByb3BlcnRpZXMuZmluZCgocHJvcGVydHk6IEJpbmRpbmdQcm9wZXJ0eSkgPT4ge1xyXG4gICAgICByZXR1cm4gcHJvcGVydHkuaXNQcmltYXJ5S2V5ID09PSB0cnVlO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gcHJpbWFyeVByb3BlcnR5ID8gcHJpbWFyeVByb3BlcnR5Lm5hbWUgOiAnJztcclxuICB9XHJcblxyXG59XHJcblxyXG5leHBvcnQgeyBQcm9wZXJ0eVV0aWwgfTtcclxuIl19