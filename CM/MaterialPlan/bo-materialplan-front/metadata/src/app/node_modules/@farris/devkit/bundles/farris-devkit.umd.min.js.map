{"version":3,"sources":["node_modules/tslib/tslib.es6.js","ng://@farris/devkit/lib/metadata/decorator/decorator.ts","ng://@farris/devkit/lib/metadata/decorator/metadata_util.ts","ng://@farris/devkit/lib/changeset/types.ts","ng://@farris/devkit/lib/changeset/change_set.ts","ng://@farris/devkit/lib/entity/metadata/field_decorator.ts","ng://@farris/devkit/lib/entity/metadata/entity_decorator.ts","ng://@farris/devkit/lib/entity/metadata/field_metadata_util.ts","ng://@farris/devkit/lib/entity/metadata/entity_metadata_util.ts","ng://@farris/devkit/lib/entity/types.ts","ng://@farris/devkit/lib/entity/entity_factory.ts","ng://@farris/devkit/lib/entity/entity_type_creator.ts","ng://@farris/devkit/lib/entity/entity_creator.ts","ng://@farris/devkit/lib/entity/validator/validation_types.ts","ng://@farris/devkit/lib/entity/validator/validation_error.ts","ng://@farris/devkit/lib/entity/validator/validation_executor.ts","ng://@farris/devkit/lib/entity/validator/validation_utils.ts","ng://@farris/devkit/lib/utils/date_util.ts","ng://@farris/devkit/lib/i18n/translate_service.ts","ng://@farris/devkit/lib/entity/validator/validator.ts","ng://@farris/devkit/lib/entity/entity_list.ts","ng://@farris/devkit/lib/core/types.ts","ng://@farris/devkit/lib/i18n/user_settings_service.ts","ng://@farris/devkit/lib/i18n/zoned_time.ts","ng://@farris/devkit/lib/misc/router-param.service.ts","ng://@farris/devkit/lib/binding-data/changes.ts","ng://@farris/devkit/lib/binding-data/binding_property.ts","ng://@farris/devkit/lib/binding-data/base_binding_object.ts","ng://@farris/devkit/lib/binding-data/property_util.ts","ng://@farris/devkit/lib/binding-data/binding_object.ts","ng://@farris/devkit/lib/binding-data/binding_list_type_factory.ts","ng://@farris/devkit/lib/binding-data/binding_list_factory.ts","ng://@farris/devkit/lib/binding-data/binding_object_type_factory.ts","ng://@farris/devkit/lib/binding-data/binding_object_factory.ts","ng://@farris/devkit/lib/form/decorators.ts","ng://@farris/devkit/lib/utils/data-path/binding_path_converter.ts","ng://@farris/devkit/lib/utils/data-path/binding_path_comparer.ts","ng://@farris/devkit/lib/utils/data-path/binding_path_traverser.ts","ng://@farris/devkit/lib/utils/data-path/entity_path_converter.ts","ng://@farris/devkit/lib/utils/data-path/entity_path_comparer.ts","ng://@farris/devkit/lib/core/data-path/data_path_node.ts","ng://@farris/devkit/lib/utils/data-path/form_path_converter.ts","ng://@farris/devkit/lib/core/data-path/data_path.ts","ng://@farris/devkit/lib/core/data-path/data_path_creator.ts","ng://@farris/devkit/lib/core/data-type-info/data_prop_info.ts","ng://@farris/devkit/lib/core/data-type-info/data_type_info.ts","ng://@farris/devkit/lib/core/tokens.ts","ng://@farris/devkit/lib/core/core.ts","ng://@farris/devkit/lib/core/escape.ts","ng://@farris/devkit/lib/resolver/types.ts","ng://@farris/devkit/lib/resolver/resolver_registry.ts","ng://@farris/devkit/lib/repository/decorators.ts","ng://@farris/devkit/lib/repository/entity_collection.ts","ng://@farris/devkit/lib/repository/entity_manager.ts","ng://@farris/devkit/lib/repository/pagination_manager.ts","ng://@farris/devkit/lib/repository/data_change_history.ts","ng://@farris/devkit/lib/repository/sort_condition_manager.ts","ng://@farris/devkit/lib/repository/filter_condition_manager.ts","ng://@farris/devkit/lib/misc/uid.ts","ng://@farris/devkit/lib/repository/repository.ts","ng://@farris/devkit/lib/repository/default_repository.ts","ng://@farris/devkit/lib/resolver/entity_dependency_resolver.ts","ng://@farris/devkit/lib/resolver/state_dependency_resolver.ts","ng://@farris/devkit/lib/resolver/comment_dependency_resolver.ts","ng://@farris/devkit/lib/resolver/resolve_service.ts","ng://@farris/devkit/lib/utils/expression_util.ts","ng://@farris/devkit/lib/utils/data_type_info_util.ts","ng://@farris/devkit/lib/form/form.ts","ng://@farris/devkit/lib/binding-data/entity_util.ts","ng://@farris/devkit/lib/binding-data/binding_data.ts","ng://@farris/devkit/lib/binding-data/binding_list.ts","ng://@farris/devkit/lib/binding-data/binding_data_factory.ts","ng://@farris/devkit/lib/binding-data/decorators.ts","ng://@farris/devkit/lib/misc/data-path-util.ts","ng://@farris/devkit/lib/misc/guid.ts","ng://@farris/devkit/lib/misc/run_mode_service.ts","ng://@farris/devkit/lib/entity/entity.ts","ng://@farris/devkit/lib/entity/dynamic_entity.ts","ng://@farris/devkit/lib/schema/schema.ts","ng://@farris/devkit/lib/entity/entity_data_service.ts","ng://@farris/devkit/lib/entity/entity_prototype.ts","ng://@farris/devkit/lib/entity/entity_type_factory.ts","ng://@farris/devkit/lib/rest/rest_service.ts","ng://@farris/devkit/lib/command/decorators.ts","ng://@farris/devkit/lib/misc/is-observable.ts","ng://@farris/devkit/lib/command/flow/task_node.ts","ng://@farris/devkit/lib/variable/variable_parser.ts","ng://@farris/devkit/lib/variable/parse_util.ts","ng://@farris/devkit/lib/variable/data_variable_parser.ts","ng://@farris/devkit/lib/variable/ui_state_variable_parser.ts","ng://@farris/devkit/lib/variable/state_machine_variable_parser.ts","ng://@farris/devkit/lib/variable/command_variable_parser.ts","ng://@farris/devkit/lib/variable/variable_parse_service.ts","ng://@farris/devkit/lib/variable/frame_id_variable_parser.ts","ng://@farris/devkit/lib/variable/form_state_variable_parser.ts","ng://@farris/devkit/lib/variable/event_param_variable_parser.ts","ng://@farris/devkit/lib/variable/index.ts","ng://@farris/devkit/lib/command/flow/task_link.ts","ng://@farris/devkit/lib/command/flow/task_flow.ts","ng://@farris/devkit/lib/command/command_context.ts","ng://@farris/devkit/lib/i18n/translate_token.ts","ng://@farris/devkit/lib/command/command_handler.ts","ng://@farris/devkit/lib/command/command_handler_registry.ts","ng://@farris/devkit/lib/command/command_handler_extender.ts","ng://@farris/devkit/lib/command/command_handler_extender_registry.ts","ng://@farris/devkit/lib/ui-state/decorators.ts","ng://@farris/devkit/lib/ui-state/uistate_metadata_util.ts","ng://@farris/devkit/lib/ui-state/ui_state.ts","ng://@farris/devkit/lib/ui-state/tokens.ts","ng://@farris/devkit/lib/state-machine/types.ts","ng://@farris/devkit/lib/state-machine/context.ts","ng://@farris/devkit/lib/state-machine/state_machine_event.ts","ng://@farris/devkit/lib/state-machine/state_machine.ts","ng://@farris/devkit/lib/state-machine/decorators.ts","ng://@farris/devkit/lib/view-model/decorators.ts","ng://@farris/devkit/lib/view-model/view_model.ts","ng://@farris/devkit/lib/context/context.ts","ng://@farris/devkit/lib/app/binding_data_manager.ts","ng://@farris/devkit/lib/app/repository_mananger.ts","ng://@farris/devkit/lib/app/frame_component_refresher.ts","ng://@farris/devkit/lib/app/change_detection_controller.ts","ng://@farris/devkit/lib/app/app_context_manager.ts","ng://@farris/devkit/lib/app/component_manager.ts","ng://@farris/devkit/lib/app/tokens.ts","ng://@farris/devkit/lib/schema/dom.service.ts","ng://@farris/devkit/lib/schema/form-metadata.ts","ng://@farris/devkit/lib/schema/schema.service.ts","ng://@farris/devkit/lib/app/app_metadata_collector.ts","ng://@farris/devkit/lib/app/view_model_manager.ts","ng://@farris/devkit/lib/app/render_context_metadata_manager.ts","ng://@farris/devkit/lib/frame/tokens.ts","ng://@farris/devkit/lib/app/app_context.ts","ng://@farris/devkit/lib/app/frame_contex_manager.ts","ng://@farris/devkit/lib/event-bus-new/event-bus-proxy.ts","ng://@farris/devkit/lib/event-mechanism/declaration/event-type.ts","ng://@farris/devkit/lib/event-mechanism/declaration/declaration_decorator.ts","ng://@farris/devkit/lib/event-mechanism/declaration/declaration.ts","ng://@farris/devkit/lib/event-mechanism/subscription/subscription_decorator.ts","ng://@farris/devkit/lib/event-bus-new/event-pipe-type.ts","ng://@farris/devkit/lib/event-mechanism/subscription/subscription.ts","ng://@farris/devkit/lib/event-bus-new/event-pipe.ts","ng://@farris/devkit/lib/event-bus-new/event-bus.ts","ng://@farris/devkit/lib/exception/tokens.ts","ng://@farris/devkit/lib/expression/types.ts","ng://@farris/devkit/lib/i18n/tokens.ts","ng://@farris/devkit/lib/manifest/tokens.ts","ng://@farris/devkit/lib/expression/expression_registry.ts","ng://@farris/devkit/lib/listener/tokens.ts","ng://@farris/devkit/lib/listener/change_listener.ts","ng://@farris/devkit/lib/expression/expression_executor.ts","ng://@farris/devkit/lib/expression/expression_result.ts","ng://@farris/devkit/lib/expression/expression_manager.ts","ng://@farris/devkit/lib/expression/expression_result_factory.ts","ng://@farris/devkit/lib/listener/ui_state_change_listener.ts","ng://@farris/devkit/lib/expression/tokens.ts","ng://@farris/devkit/lib/listener/repository_change_listener.ts","ng://@farris/devkit/lib/listener/listener_registry.ts","ng://@farris/devkit/lib/listener/binding_data_change_listener.ts","ng://@farris/devkit/lib/listener/listeners.ts","ng://@farris/devkit/lib/expression/expression_event_emitter.ts","ng://@farris/devkit/lib/effector/tokens.ts","ng://@farris/devkit/lib/effector/repository_effector.ts","ng://@farris/devkit/lib/effector/uistate_effector.ts","ng://@farris/devkit/lib/effector/readonly_effector.ts","ng://@farris/devkit/lib/effector/dependency_effector.ts","ng://@farris/devkit/lib/effector/effector_registry.ts","ng://@farris/devkit/lib/effector/relative_effector.ts","ng://@farris/devkit/lib/effector/validate_effector.ts","ng://@farris/devkit/lib/effector/required_effector.ts","ng://@farris/devkit/lib/effector/visible_effector.ts","ng://@farris/devkit/lib/effector/effector_factory.ts","ng://@farris/devkit/lib/event-handler/event_handler.ts","ng://@farris/devkit/lib/event-handler/entity_value_changed_event_handler.ts","ng://@farris/devkit/lib/effector/effector_manager.ts","ng://@farris/devkit/lib/event-handler/state_value_changed_event_handler.ts","ng://@farris/devkit/lib/event-handler/repository_add_entity_event_handler.ts","ng://@farris/devkit/lib/event-handler/repository_remove_entity_event_handler.ts","ng://@farris/devkit/lib/event-handler/repository_load_event_handler.ts","ng://@farris/devkit/lib/event-handler/entity_update_event_handler.ts","ng://@farris/devkit/lib/event-handler/binding_data_append_object_event_handler.ts","ng://@farris/devkit/lib/event-handler/binding_data_value_change_event_handler.ts","ng://@farris/devkit/lib/event-handler/binding_data_remove_object_event_handler.ts","ng://@farris/devkit/lib/event-handler/binding_data_load_event_handler.ts","ng://@farris/devkit/lib/event-handler/binding_data_selection_changed_event_handler.ts","ng://@farris/devkit/lib/event-handler/event_handler_registry.ts","ng://@farris/devkit/lib/expression/expression_engine_impl.ts","ng://@farris/devkit/lib/frame/component_ref_manager.ts","ng://@farris/devkit/lib/frame/frame_context.ts","ng://@farris/devkit/lib/frame/frame_component.ts","ng://@farris/devkit/lib/frame/frame_event.ts","ng://@farris/devkit/lib/frame/frame_event_bus.ts","ng://@farris/devkit/lib/command/command_handler_factory.ts","ng://@farris/devkit/lib/command/command_bus.ts","ng://@farris/devkit/lib/command/dynamic_command_handler.ts","ng://@farris/devkit/lib/command/providers.ts","ng://@farris/devkit/lib/validation/tokens.ts","ng://@farris/devkit/lib/providers.ts","ng://@farris/devkit/lib/devkit_module.ts","ng://@farris/devkit/lib/listener/deprecated_binding_data_change_listener.ts","ng://@farris/devkit/lib/cache/types.ts","ng://@farris/devkit/lib/cache/core/cache_object.ts","ng://@farris/devkit/lib/cache/core/cache_container.ts","ng://@farris/devkit/lib/cache/provider/memory_cache_provider.ts","ng://@farris/devkit/lib/cache/provider/default_cache_provider.ts","ng://@farris/devkit/lib/core/encode_url.ts","ng://@farris/devkit/lib/cache/core/decorator.ts"],"names":["extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__extends","__","this","constructor","prototype","create","__assign","assign","t","s","i","n","arguments","length","call","apply","__generator","thisArg","body","f","y","g","_","label","sent","trys","ops","next","verb","throw","return","Symbol","iterator","v","step","op","TypeError","done","value","pop","push","e","__values","o","m","__read","r","ar","error","__spread","concat","ANNOTATIONS","PARAMETERS","PROP_METADATA","makeDecorator","name","props","parentClass","chainFn","typeFn","metaCtor","makeMetadataCtor","DecoratorFactory","args","_i","annotationInstance","bind","typeDecorator","cls","defineProperty","ngMetadataName","annotationCls","values","propName","makePropDecorator","PropDecoratorFactory","decoratorInstance","target","meta","unshift","MetadataUtil","getClassMetadatas","getClassMetadataByName","metadataName","getClassMetadataByNameWithTranslate","translateService","keysToTranslate","allClassMetadatas","metadata","find","classMetadata","translateMetadataByName","getPropsMetadatas","getPropsMetadatasByName","getPropsMetadatasByNameWithTranslate","metadatas","allPropMetadatas","keys","forEach","propMetadata","translateMetadatasByName","_this","metadataPropKey","propertyVariable","startsWith","endsWith","translateKey","replace","trim","transform","console","info","getPropMetadatasByName","getPropMetadataByName","ModifyType","Modification","modifyType","path","preValue","position","type","isEqual","other","JSON","stringify","ChangeSet","modifications","append","modification","ValueChange","appendValueChangeModification","Add","Insert","Clone","appendAddModification","Remove","appendRemoveModification","Load","existedModification","findModifyItemsPath","existedAddModification","findNewAddItemsPath","primaryKey","primaryKeyValue","addModification","filter","addDataItem","fullRemovePath","valueModification","valueChangePath","from","removeDescendantRemoveModifications","clear","index","parentRemoveModification","parentPathWithId","createRemovePathWithId","descendantPathWithId","isDescendantPath","parentPath","descendantPath","parentPathItem","parentPathItemIndex","isPlainObject","toString","getPrototypeOf","proto","NG_FIELD","NgField","makeNgFieldDecorator","options","primary","foreign","Boolean","dataField","String","NG_LIST","NgList","makeNgListDecorator","NG_OBJECT","NgObject","makeNgObjectDecorator","NG_Dynamic","NgDynamic","makeNgDynamicDecorator","NG_ENTITY","FieldMetadataUtil","getNgFields","getNgField","getDataField","getNgObjects","getNgDynamic","getNgList","getPrimaryFieldMetadata","ngFieldObj","prop","propMeta","property","undefined","getPrimaryKey","entityType","primaryNgField","getValidationMetadata","fieldMetadatas","key","validRules","map","rule","getValidationMetadataWithPath","object","parentPaths","getPaths","propertyPath","property_1","join","EntityMetadataUtil","getAllNgProperties","ngPlainProperties","getNgFieldProperties","ngEntityProperties","getNgObjectProperties","ngDynamicProperties","getNgDynamicProperties","ngEntityListProperties","getNgEntityMatadata","getNgListProperties","getPrimaryKeyProperty","primaryKeyProperty","ngProperty","PARENT_PATH","PARENT_CLASS","EntityFactory","T","data","EntityTypeCreator","entity","getType","createType","_super","tslib_1.__extends","Entity","EntityType","entityPrototype","extendProperties","ngFields","ngObjects","ngLists","ngDynamic","extendPlainProperty","extendListProperty","extendObjectProperty","extendDynamicProperty","ngField","get","getPropValue","set","newPropValue","oldPropValue","isPropValueChanged","setPropValue","changeSetValue","preparePropValue","emitValueChange","ngListMetadata","propertyName","entityList","fieldMetadata_1","createPath","val","EntityList","entities","loadEntities","onListChanged","subscribe","setChanges","ngObjectMetadata","fieldMetadata","childEntity","buildEntity","modifyInfo","ngDynamicMetadata","dynamicEntity","originalData","buildDynamic","buffer","has","parent","instance","onValueChanged","changes","DynamicFactory","Map","createEntity","entityData","typeName","createEntities","entityListData","validationMessage","ValidationTypes","isValidType","indexOf","getMessage","CURRENT_LANGUAGE","setCurrentLanguage","language","CUSTOM_VALIDATION","REQUIRED","EQUALS","NOT_EQUALS","IS_NUMBER","IS_INT","IS_FLOAT","IS_STRING","IS_BOOLEAN","IS_DATE","IS_DATE_STRING","IS_BOOLEAN_STRING","IS_NUMBER_STRING","IS_EMAIL","IS_JSON","IS_LOWERCASE","IS_UPPERCASE","RANGE","MIN","MINVALUE","MAX","MAXVALUE","LENGTH","MAX_LENGTH","MIN_LENGTH","MIN_DATE","MAX_DATE","EXCLUDE","MATCHES","FIELD_CONTAINER","fieldContainer","required","equals","notEquals","isNumber","isInt","isFloat","isBoolean","isDate","isEmail","min","minValue","minDate","max","maxValue","maxDate","isBooleanString","isDateString","isLowercase","isUppercase","range","maxLength","minLength","isNumberString","exclude","matches","ValidationError","isArray","ValidationExecutor","replaceMessageSpecialTokens","message","messageString","Function","constraints","constraint","RegExp","targetName","execute","newValue","validationErrors","externalRules","currentRowId","frameContext","form","getValidationRules","validateMetadatas","remainedExternalRules","parentPathArray","objectCursor","cursorParentPath","parentPath_1","reverse","rules","pathArray","split","fieldName_1","fieldParentPath","targetId_1","targetId","validateRule","fullPath","fieldName","validateRules","path_1","bindingPaths","getForm","formControl","getFormControl","id","formGroupName","defaultI18nValue","reduce","curr","_a","isMultLanguageField","multiLangFields","getMultiLanguageFields","includes","field","frameContext_1","fieldContainerName","Number","isInteger","validationDisplayName","validationError","generateValidationError","defaultValidations","objectValidations","listValidations","ngFields_1","enableMultiLangInput","stripEmptyErrors","errors","children","errorMap","validValue","validator","validateValueByMetadata","Promise","promise","then","isValid","createValidationError","awaitingPromises","parentIndex","INDEX_LABEL","listFields","validationError_1","items","actualIndex","primaryValue","objectFields","extType","getFrameContext","eventFrameContext","paths","bindingPath","appContext","frameContextManager","getFrameContexts","context","viewModel","ngFormControls","test","ValidationUtils","createDetailedErrorMessage","messages","propConstraintFailed","ruleName","formattedProperty","convertErrorsToNormalObject","errObj","err","childErrors","itemErr","childErr","_b","DateUtil","formatISO","dateOrDateString","isEmptyDateOrDateString","emptyISODateTimeString","dateObj","parse","format","defaultISOFormat","dateFormat","defaultDisplayFormat","parseISO","date","isEmptyDate","isEmptyDateString","dateString","dateOrDateString1","dateOrDateString2","dateObj1","dateObj2","compare","compareAsc","emptyDateTimeString","defaultDateFormat","defaultTimeFormat","TranslateService","setTranslate","translate","getCurrentLanguage","defaultLanguage","dispose","Validator","validate","executor","all","sortValidationErrors","buildErrors","sortable","sort","a","verify","ignoreAsyncValidateRules","validType","constraintsToValidate","param","Date","eval","patch","currentRows","parentEntityListPaths","getEntityListPath","childrenList","slice","getMainEntityPrimaryValue","currentRow","result","msg","Set","newMsg","customValidation","comparison","isEmptyValue","currentLanguage","Infinity","allowInfinity","isNaN","allowNaN","isFinite","validatorJs","isString","getTime","toDate","isLength","hasInvalidLangs","dateRange","isYearRange","isMonthOrDayRange","parseInt","getRangeValue","isDayTimeRange","splitor","isDateRange","isYearMonthRange","num","match","BigNumber","isGreaterThanOrEqualTo","isLessThanOrEqualTo","isNumeric","contains","seed","notContains","isJSON","someChars","arrChar","counter","pattern","ValidatorJS.default","rawData","changeSet","tslib_1.__values","initEntity","changeItem","appendNew","isCloned","newEntity","insert","appendEntity","appendEntities","remove","primaryId","total","count","indexToRemove","findIndex","entityToRemove","splice","primaryProperty","updateIndex","item","modinfo","listChanged","change","sum","getPropertyName","toJson","toJSON","toArray","isNewEntity","subChanges","newLength","__type__","Subject","asObservable","DataChangeType","HttpMethod","RunMode","BigNumberType","BackEndMessage","Level","Message","bizMessages","ComponentType","DEVKIT_RUN_MODE","InjectionToken","UserSettingsService","setUserSettings","userSettings","timeZone","timeZoneOffset","getTimeZone","getTimeZoneOffset","ZonedTime","zonedTimeToSpecialTimeZoneOffsetTimeString","offset","offsetMinutes","moment","utc","add","timeZoneOffsetTimeToUtcTimeString","utcOffset","toISOString","ChangeType","ViewChangeType","BindingPropertyType","RouterParamService","getParams","url","getAllParams","setParams","params","allParams","setAllParams","clearParams","Error","allParamsJson","window","sessionStorage","getItem","setItem","clearAllParams","Injectable","BaseBindingObject","getValue","setShowValidationMsg","flag","isShowValidationMsg","innerValues","setValue","propertyValue","emitEventToView","emitEventToEntity","invokeOnValueChange","oldPropertyValue","entityChanged","of","viewChange","buildViewChangesContext","viewChanges","buildChangesContext","langCode","properties","List","list","Dynamic","ignoreMultiLangInput","multiLangValueObj","useFullMultiLangProperty","localStorage","ValueChanged","unsubscribe","controlMap","PropertyUtil","getProperties","ngFieldProperties","ngFieldProperty","Plain","isPrimaryKey","isForeignKey","ngObjectProperties","ngObjectProperty","ngListProperties","ngListProperty","ngDynamicProperty","getDynamicProperties","dynamicData","getPropertyByName","BindingObject","BindingListTypeFactory","bindingProperties","bindingListType","BindingList","BindingListType","bindingListTypePrototype","bindingListPrototype","bindingProperty","currentItem","provider","BindingListFactory","bindingList","BindingObjectTypeFactory","bindingObjectType","BindingObjectType","typePrototype","extendDynamicObjectProperty","childListProperties","bindingObjects","load","childObjectProperties","bindingObject","BindingObjectFactory","createDynamicBindingObject","childList","childObject","attachDynamicObjectProperty","dynamicObject","NG_VALIDATE_FORM","NG_CHILD_FORM","NgChildForm","obj","NG_CHILD_FORM_ARRAY","NgChildFormArray","NG_FORM_CONTROL","NgFormControl","BindingPathConverter","toBindingPathArray","part","toBindingPathString","bindingPathArray","BindingPathComparer","srcPath","dstPath","srcPathArray","dstPathArray","every","srcPathItem","srcPathIndex","isParent","childPath","childPathArray","isAncestor","ancestorPath","descendantPathArray","ancestorPathArray","ancestorPathItem","ancestorPathIndex","BindingPathTraverser","getLeafPathString","getParentPathString","EntityPathConverter","toEntityPathArray","bindingPathString","bindingData","entityPathArray","currentBindingObject","createPrimaryKeyPath","currentBindingList","DataPathNodeType","EntityPathComparer","FormPathConverter","formPahtString","DataPathNode","prev","DataPath","newNode","head","tailNode","getTail","lastNode","currentNode","clone","newDataPath","curDataNode","DataPropGroup","DataPathCreator$$1","DataPathCreator","fullPathArrayOrString","entityManager","dataPath","fullPathArray","currentNodeInfo","nodeValue","shift","nodeType","DataId","entityTypeInfo","DataTypeInfo","nextNodeValue","getNextPathNodeInfo","parentNodeInfo","parentNodeValue","parentNodeType","parentEntityTypeInfo","nextPathNodeInfo","PropName","nextPropInfo","getPropInfoByName","group","typeInfo","shortPathArrayOrString","shortPathArray","currentEntityTypeInfo","propInfo","DataPropInfo","getBindingPathByTableName","tableName","fullEntityPath","getFullEntityPath","dataTypeInfo","entityInfo","nodeCode","originalCode","propInfoMap","idx","dataTypeInfo_1","getPropInfos","isVOField","getPropNames","propNames","getPropInfosByGroup","getPropNamesByGroup","getPropInfoByPath","arrPath","getTypeInfoByPath","getPrimaryKeyPropInfo","getPropMappingByName","mapping","getPropMappingByPath","checkPropGroup","propGroup","collectPropInfos","foreignKey","addPropInfo","collectEntityInfos","metadataInfo","originalDataField","FORM_PATH_TOKEN","BACK_END_MESSAGE_HANDLER_TOKEN","MESSAGE_SERVICE_TOKEN","NOTIFY_SERVICE_TOKEN","CHANGE_SET_POLICY_TOKEN","Core","warn","optionalParams","logable","log","escape","RESOLVER_TOKEN","ENTITY_TEMPLATE","STATE_TEMPLATE","GROUP_FUNCTIONS","Injector","decorators","Optional","Inject","ResolverRegistry","injector","resolvers","NG_REPOSITORY","EntityCollection","_changeSetPolicy","policy","innerEntitySet","size","innerEntityMap","notifyCollectionChanged","reset","notify","complete","isReset","entityCreate","extendChangeSetPolicyProperty","listenEntityChangeEvent","addEntity","verifyEntityToAdd","insertEntity","updateEntity","Update","addEntities","entitiesToAdd","isTreeNodeLoadScene","addData","AddData","changeSetPolicy","getEntityById","identity","getEntityByPath","rootEntityId","parentNode","currentPath","getEntitiesByPath","getEntities","predicate","getAllEntities","removeEntityById","verifyEntityToRemove","delete","removeEntitiesByIds","removeEntities","entitiesToRemove","removeData","RemoveData","resetEntities","entityId","collectionChanged","paginationInfo","pageSize","original","PaginationInfoChange","pageIndex","updatePaginationInfoByPath","pageInfo","totalCount","setPaginationConfigByPath","getPaginationConfigByPath","defaultValue","config","current","Math","abs","EntityManager","createEntitiesByPath","fPath","childEntityList","subPaths","fid","entityCollection","propEntityType","EntityUtil","getPropInfo","getEntityNodeByPath","entityCollectionOrList","createByLongPathFromRoot","entityNode","pathNode","getPropValueByPath","setPropValueByPath","propValue","insertEntityBeforeByPath","fpath","insertEntitiesBeforeByPath","insertEntityAfterByPath","insertEntitiesAfterByPath","appendEntityByPath","initialData","insertEntityByPath","appendEntitiesByPath","removeEntityByPath","removeEntitiesByPath","ids","clearAllEntityChanges","clearEntityChangesById","clearEntityChangesByIds","checkAllEntityChanges","some","checkEntityChangesById","clearEntityChangesByArray","idArray","PaginationManager","expandMainEntityConfig","entityName","paginationConfig","entityConfig","removeLasts","newKey","substring","deleteMainEntityConfig","defaultPageSize","getChilds","objectType","listProperties","itemTypeName","child","childs","DataChangeHistory","addChange","dataChange","changeType","addChanges","history","clearByIds","dataId","ids_1","ids_1_1","isChanged","onAddData","onDeleteData","SortConditionManager","getConditionsByBindingPath","directionConverter","conditions","sorts","condition","sortType","SortType","SortField","addCondition","direction","isBindingPathExist","bindingPathSortConditions","conditionIndex","removeCondition","setConditions","fields","directions","filedsArray","directionsArray","FilterConditionManager","getFilters","filters","mergeCondition","merge","findConditionIndex","addConditions","removes","props_1","props_1_1","UID","redix","timestamp","now","valueOf","previous","Repository","innerName","guid","paginationManager","destroy$","ngOnDestroy","updateEntityType","readMetadata","repositoryMetadata","apiUri","apiUrl","setPaginationConfig","pagination","buildEntities","listData","dataChangeHistory","sortConditionManager","filterConditionManager","DefaultRepository","getList","getById","queryChild","updateById","updateEntityById","appendByPath","insertByPath","removeById","ifSave","batchRemove","removeByIds","removeByPath","updateChangesById","updateChangesByPath","updateAllChanges","applyChanges","applyChangesById","cancelChanges","batchRemoveByPath","batchAppendByPath","defaultValues","batchAppend","EntityDependencyResolver","resolve","expr","groupFunctionDependencies","ExpressionUtil","getGroupFunctionDependency","repository","entityDependencies","getEntityDependency","dep","merged","getValidEntityPropertyExpression","entityPropertyExpression","propPaths","deps","regex","entityPropertyExpressions","convertToNodeCode","substr","CONTEXT_FUNCTIONS","StateDependencyResolver","contextFunctions","argumentsRegex_1","groupFunction","argumentMatchResult","argument","CommentDependencyResolver","dependencies","defineMatchArray","defineString","defineObject","ResolveService","expression","resolverRegistry","commentDependencyResolver","resolver","commentDependencies","dependency","groupFunctionRegex","groupFunctions","methodNameRegex_1","methodNameMatchResult","methodName","prefix","entityExpression","nodeCodes","entityExpressions","nextNodeCode","nextNodeCodePropInfo","dataPropInfo","getChildrenEntityPaths","results","childrens","getCurrentRowByPaths","findById","getAvailableChildrenPathsFromEntityPaths","getBindingPath","getEntityPath","DataTypeInfoUtil","getChildrenNodeCodes","Form","FormGroup","ngValidateForm","enableValidate","insMap","ngChildForms","metaDatas","controls","disposeValidation","updateErrors","errorObj","isGrid","setControlValue","isFormValid","setIsShowmap","domPropertyName","isShowPropMap","raisedByValidateEffector","getObject","getGridItemControl","getCardControlErrors","cardControls","getFormControlErrors","getGridControlErrors","controlIdMap","isGridComponent","frameComponent","getDomPropertyNameByEntityProp","currentId","isSubForm","innerList","ngFormControl","getngFormControlByBinding","fixedValidType","messageTemplate","invalidMessage","updateFormErrors","forceShow","clearBackendError","setErrors","markAsTouched","errorType","binding","getErrorMessage","domProperty","validateRuleType","controlName","init","verifycationChanged","verifycations","resetCardValidMsg","buildForm","collectMetadatas","createChildForms","createControls","x","resetFormControls","updateFieldValidateRule","isRequired","clearValidators","markAsUntouched","markAsPristine","requiredRuleIndex","displayFieldName","validators","ruleObj","validateFn","getValidatorByRuleObj","setValidators","addFieldValidateRule","expressionId","ruleType","control","controlPaths","currentLangValue","isInValid","bigNumber","isGreaterThan","isLessThan","collectionFormControlMetadats","formControls","subForms","preloadMetadata","formControlId","validationRule","FormControl","updateOn","setUpBindingDataPipeline","valueConverter","formGroup","formType","addControls","column","converter","editor","fieldPath","bindingFieldPath","initValue","getValueFromBindingData","pipe","takeUntil","changePath","isUdt","SelectionChanged","UpdateErrors","changePathWithDot","fullEntityProp","pathPrefix","newControlValue","convertFrom","domPropName","valueChanges","oldBindingValue","oldValue","compareDate","newBindingValue","convertTo","clearBackEndMessages","runMode","highSpeed","isDateConverter","srcDate","dstDate","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","getEntityValueChangingListeners","listeners","valueChanging","getEntityValueChangedListeners","valueChanged","validatoinRules","ngFormControl_1","displayFieldName_1","validationrulesToAdd","setTranslateService","messageKeys","errors_1","errors_2","loadEntity","loadEntityList","isEffectiveField","setUpEntityPipeline","primaryKeyPath","dynamic","value_1","target_1","parentId","findId","pathData","controlProp","entityValidate","callback","validateFromUtilSync","formErrors","mergedErrors","validateError","setUpEntityListPipeline","paths_1","parentId_1","paths_2","parentPath_2","parentId_2","paths_3","parentPath_3","parentId_3","loadRepository","entityCollectionChange","createBindingObjects","toLowerCase","effectiveFields","createBindingObject","removeDataByIds","watchReposiroty","pagingInfo","targetPropName","propType","primaryNgFiledProp","isObjectProp","isDynamicProp","appendInitialData","parentID","BindingData","firePagingChangeEvent","setPagingInfo","skip","take","parentObject","updatePagingInfo","setValueChangeInvokerFactory","valueChangeInvokerFactory","getValudChangeInvokerFactory","initByRepository","initByBindingList","setDataTypeInfo","useInitValue","getInitValueByPaths","clearValue","getPath","_paginationInfo","sPaginationInfo","setPaginationInfo","emptyCurrentItem","self","objects","firstId","setCurrentId","lastId","Append","currentIndex","nextCurrentId","getCurrentIdBeforeDeleting","getIndexById","clearOnly","nextIndex","getIdByIndex","emitEvent","emitGlobalEvent","force","GlobalSelectionChanged","swapById","id1","id2","item1","element","item2","toList","Swap","sortBy","orders","arrFields","arrDirections","isMultiLangProp","order","item1Value","item2Value","localeCompare","BindingDataFactory","createFromRepository","BindingPropertyUtil","EntityLoadUtil","createFromEntityManager","createFromExistingBindingData","existingBindingData","NG_BINDING_DATA","DataPathUtil","convertToBindingPathArray","convertToEntityPathArray","convertToRestUrl","restPathArray","getLeafPath","getParentPath","Guid","isGuid","createEmpty","raw","isEmpty","EMPTY","RunModeService","setRunMode","mode","getRunMode","newData","validErrors","primaryFieldMetadata","tap","validateAll","validateContext","validateFromUtil","cb","pathObj","handleParent","loadFields","loadChild","loadLists","loadObjects","loadDynamicObjects","buildChanges","enableTimeZone","ngDynamics","initialize","initializeNormalField","initializeList","initializeObject","initializeDynamic","createEntityFromJsonData","ngList","objectData","ngDynamicObjects","loadDynamicData","originDataField","originalDataFieldType","isEmptyMultiLangPropValue","isValidating","onUpdate","compatible","DynamicEntity","initializeDynamicField","dynamicEntity_1","createDynamicEntityFromJsonData","parentModification","SchemaEntityField$Type","SchemaEntityFieldType$Type","SchemaEntityFieldTypeName","ENTITY_DATA_SERVICE_TOKEN","getFieldValue","schemaField","multiLanguage","setFieldValue","getComplexFieldValue","innerEntities","setComplexFieldValue","ComplexField","complexFieldInstance","objectPropertyValue","changeInfo","isInitializing","schemaEntity","setEntities","isFieldValueChanged","emitFieldValueChange","Schema","SchemaEntity","SchemaEntityType","SchemaEntityField","SchemaEntityFieldType","SchemaEntityFieldEditor","EntityTypeFactory","schema","schemaType","createClass","relateSchema","attachEntityInstanceData","createEntityInstanceDataInitializer","ConcreteEntity","entityInstance","entityTypeConstructor","innerData","code","types","__prop__metadata__","entityTypePrototype","definePresetProperty","defineFieldsToPrototype","defineEntitiesToPrototype","prototypeObject","innerPrimaryProperty","parentEntityType","schemaEntityField","$type","SimpleField","defineSimpleFieldToPrototype","defineComplexFieldToPrototype","getEnableMultiLangInput","complexFieldType","entitMetadata","fieldData","complexFieldValue","subEntityName","includedEntityTypes","originalEntityDataArray","originalEntityData","concreteEntityInstance","RestfulService","uri","request","put","optionsWithBody","addBody","post","method","httpParams","buildParams","httpClient","HttpParams","HttpClient","NG_COMMAND_HANDLER","NG_COMMAND_HANDLER_EXTENDER","TaskNode","func","observable","Observable","VARIABLE_PARSERS","ParseUtil","getAppContext","getRootFrameContext","root","getFrameContextById","frameId","DataVariableParser","extractPaths","replaceValue","searchValue","dataVariables","DATA_PATTERN","dataVariable","pathMatches","parts","UIStateVariableParser","getUIState","uiStateVariables","UI_STATE_PATTERN","uiStateVariable","stateName","state","uiState","formatDate","year","month","day","StateMachineVariableParser","stateMachineVariables","STATE_MACHINE_PATTERN","sessionVariable","getPathObj","stateMachine","getTargetStateMachine","targetFrameContext","splitPath","CommandVariableParser","CommandContext","paramKey","command","VariableParseService","eventParam","parseExpression","itemIndex","evaluate","parsedExpression","parsers","parser","VARIABLE_MATCHER","FrameIdVariableParser","variables","extractVariables","exp","getVariableValue","relativeFrameId","getFullFrameId","namespace","FORM_STATES_EXP","FORM_STATE_EXP","FormStateVariableParser","variableExpression","exprs","variable","formStates","EVENT_PARAMS_EXP","EVENT_PARAM_EXP","EventParamVariableParser","VARIABLE_PROVIDERS","provide","multi","useClass","TaskLink","canLink","parseService","to","TaskFlow","addNode","node","nodes","addNodes","insertNode","findNodeIndex","createNode","appendNode","addLink","link","createLink","links","addLinks","getNext","nextLink","taskFlow","latestResult","clearResults","TranslateToken","CommandHandler","variableParseService","schedule","lastTaskResult$","setTimeout","isDisposed","commandToExecute","paramsTransform","transParamTypes","paramDescriptions","initContext","context$","BehaviorSubject","currentTask","concatMap","throwIfEmpty","takeLast","waitForDestroy","displayError","commandContext","destorySignal","pArray","ele","$1","$2","addTask","insertTask","afterTask","replaceTask","invoke","serviceInstance","setContextToServiceInstance","parsedArgs","serviceContext","parType","numResult","boolResult","strValue","COMMAND_HANDLERS_TOKEN","CommandHandlerRegistry","commandName","commandHandler","handlerMap","regist","handlerMetadata","handler","handlers","CommandHandlerExtender","COMMAND_HANDLER_EXTENDERS_TOKEN","CommandHandlerExtenderRegistry","extendersMap","extender","extenderMetadata","extenders","NG_COMPONENT_STATE","NgParam","UIStateMetadataUtil","getUIFields","UIState","_init","uiFields","initializeUIField","uiStates","uiFieldMetadata","uiField","isExistProperty","paramTypeTransform","ngParams","ngParam","dataType","originalDataType","setPropertyValue","PARAM_TYPE_TRANSFORM_TOKEN","State","StateMachineContext","initialState","stateMachineEvent","transitTo","nextState","states","render","targetType","parseSourceValue","ListenUIStateChange","getData","ListenEntityChange","StateMachineEvent","UI_STATE_PATTERN_1","DATA_PATTERN_1","getFrameField","frameField","frameContextMap","uiFieldList","dataFrameContextMap","dataFieldList","isAccordingValue","arr","StateMachine","effectHandlers","transit","perform","statemachine","preconditons","stateMachineMetadata","collectionMetadata","buildStateMachine","renderStates","actions","propsMetadatas","buildNgState","renderStateName","buildNgRenderState","actionName","buildNgAction","ngState","ngRenderState","renders","ngAction","precondition","stateRender","stateChange","isStateInited","NgState","NgRenderState","NgAction","action","NG_COMMAND","NgCommand","ViewModel","expressionManager","expressionResult","entityValueChangingListeners","entityValueChangedListeners","setMetadata","bindingTo","viewModelCode","buildCommands","plainPath","change_1","changed","commands","valueChangeSuccess_1","initListeners","ngCommands","keybindingMap","ngCommand","keyBinding","targetContext","commandBus","dispatch","extractPath","bindingBasePath","valueChangingListeners_1","valueChangedListeners_1","bindToParent","verifyInformations","wfConf","source","Context","getParam","setParam","BindingDataManager","getBindingDataMap","bindingDataMap","getBindingDataByName","regBindingData","unRegisteBindingData","ifBindingDataExits","RepositoryManager","regRepository","repositoryMap","unRegisteRepository","getRepositoryMap","getRepositories","getRepositoryByName","ifRepositoryExits","FrameComponentRefresher","refreshComponents","frameComponentMap","component","onFormLoad","regFrameComponent","unregFrameContext","ChangeDetectionController","reattach","frameContexts","detectChanges","detach","AppContextManager","registerAppContext","appContextSet","unregisterAppContext","getAppContexts","ComponentManager","componentRefs","getComponentsByFrameId","FORM_ID","DomService","getElementByBinding","contents","bindingFieldId","parentElement","contents_1","contents_1_1","childControls","FormContent","FormContentForDB","content","Id","Code","Name","Contents","FormMetadaDataDom","FormModule","FormOptions","SchemaService","getFieldsByIds","fieldIds","specifiedFieldsMap","entityPath","bindTo","getEntityFields","fieldsMap_1","flattenFields","fieldId","fieldsMap","fields_1","fields_1_1","splitIndex","entities_1","entities_1_1","ContextMetadataBuilder","buildAppContextMetadata","formMetadataContent","module","identify","buildStataMachineMetadata","buildUiStateMetadata","buildViewContextMetadata","controllers","dynamicOptions","buildCommand","commandHandlers","buildCommandHandlers","commandHandlerExtends","buildFormMetadata","buildFormControlMetadata","commandMetadataArray","previousValue","commandMetadata","previousCommand","enableValidation","formFields","formFieldIds","formField","formFieldsMap","domService","matchedElement","parentMatchedElement","domElements","getTitle","generateConverter","caption","title","valueConverterMap","renderState","renderStateMetadata","renderFunction","buildRenderFunction","actionMetadata","renderFunctionString","previousFunctionString","conditionTarget","conditionSource","functionString","lBracket","rBracket","relation","toLocaleLowerCase","commandReference","controllerId","cmpId","controller","methods","handlerName","previousMethodValue","methodParam","DynamicCommandHandler","ViewModelManager","getViewModelMap","viewModelMap","getViewModelByName","register","exsit","ContextMetadataManager","getContextMetadataMap","contextMetadataMap","getContextMetadataByName","contextMetadata","FRAME_ID","NAMESPACE","FRAME_COMPONENT_INIT_HANDLER_TOKEN","AppContext","getFrameContextMap","disposed","isFormDestoryed","router","unregisterFromManager","frameComponentRefresher","repositoryManager","viewModelManager","bindingDataManager","messagePipe","initializeByMetadata","contextMetadataBuilder","registerToManager","appContextManager","regFrameContext","repositoryName","regContextMetadata","componentId","contextMetadataManager","getFormAppContext","destory","applicationId","appId","token","registerCommandHandler","refresh","getContextById","getAllFrameContexts","handleSelectChange","srcFrameContext","buildRenderViewContext","viewModels","formModule","viewmodels","viewComponents","components","schemas","matchedComponent","matchedViewModel","parentViewModel","parentComponent","buildRenderViewContextRecursively","contextMetadataId","subViewModels","subViewModel","getComponentProviders","useValue","FrameContext","SkipSelf","useIsoluteEventBus","formId","ApplicationId","Token","FrameContextManager","changeDetectionController","componentManager","opened","Router","existedFrameContext","frameContextSet","getFrameContextsByNamespace","getFrameContextFromAllAppContexts","EventBusProxy","eventName","eventBus","hostType","eventTokenValueProvider","EventTypeEnum","NG_DECLARATION","Declaration","bindDeclaration","initWithDeclarations","ngDeclarations","ngPublicEventProps","getNgPublicEvent","ngExportEvent","emitter","tokenValue","eventArgs","eventType","eventSender","currentContext","eventId","ROUTE","getParentContext","parentAppContext","NG_SUBSCRIPTION","ParamMap","EventPipeType","Subscription","bindSubscription","initWithSubscriptions","ngEvents","ngEventHandlerProps","getNgEvents","eventPipes","ngImportEvent","receiver","paramMapCollection","eventPipe","on","subscriptionHandler","eventHandler","currentFrameContext","paramMap2UiState","destContext","setUiStateProperty","targetFrameContextId","EventPipe","subscriptionMap","sender","eventData","eventSubject","subscriptionInMap","subscription","lastEventId","isInSampeScope","subscribeOnce","caller","onceSubscriptionMap","unSubscribe","subscriber","unSubscribeForOnce","_c","matchEmitterToken","examByTargetToken","parentEventPipeList","location_1","disposeByCaller","eventPipeType","Parsing","senderAppContext","receiverAppContext","isoluteEventBus","Compile","EventBus","getProxy","ownerType","ownerName","proxyMap","emitterType","eventPipeList","eventMap","Type","eventPipeList_1","eventPipeList_1_1","getEventPipe","off","subscriptions","once","requestFor","requestName","requestValue","success","fail","findExistEventPipe","response","status","responseOn","responseSubject","requestObj","eventPipeList_2","eventPipeList_2_1","EventCache","setToken","tokens","getToken","Expression","ExpressionBindingType","ExpressionType","EventType","EventSource","MessageType","EffectPath","EXCEPTION_HANDLER","UserSettingsToken","MESSAGE","zh-CHS","require","dataPicking","en","zh-CHT","DEPENDENCY_SPLITER","FORM_MANIFEST_SERVICE_TOKEN","FORM_EXPRESSION_MANIFEST_SERVICE_TOKEN","ExpressionRegistry","formExpressionManifestService","switchMap","describe","expressions","expressionObject","ns","bindingType","messageType","Required","Validate","DataPicking","getExpressionMessage","_expressions","cleanSpecialCharacters","catchError","getExpressionById","expressionType","replacer","replaceAll","originalValue","search","LISTENER_TOKEN","ChangeListener","subject","findEntityPaths","ExpressionExecutor","compile","expressionContext","buildContext","factory","expression_1","ExpressionEngineExpression","ExpressionEngine","ExpressionContext","ExpressionResult","ExpressionManager","rowData","expressionRegistry","customContext","Readonly","Visible","onDataPicking","configs","warning","notifyService","hideTitle","resolveService","groupDependencies","entityContext","buildEntityContext","stateContext","buildStateContext","contexts","entityOriginalNodeCode","bignumber_js","CurrentLanguage","expressionExecutor","executeAsync","isGroupdMainEntity","isEntityDependency","getEntity","collection","childrenEntityPaths","row","parentRow","getPropertyValue","entity_1","fullPaths_1","__items__","rootFrameContext","getVirtualRootFrameContext","uiState_1","getOwnPropertyNames","messageService","ExpressionResultFactory","registeEvent","expressionObjects","ASSIGNER_TOKEN","EVENT_HANDLER_TOKEN","UIStateChangeListener","buildEventPath","registerEvent","RepositoryChangeListener","convertEventType","Field","event","ListenerRegistry","BindingDataChangeListener","Listeners","registry","listener","onEvent","ExpressionEventEmitter","attach","events","observers","EFFECTOR_TOKEN","RepositoryEffector","effect","rowId","UIStateEffector","ReadonlyEffector","DependencyEffector","EffectorRegistry","effectors","RelativeEffector","ValidateEffector","domInfo","getDomInfoByEntityPath","buildFormErrors","currentErrors","frameContexts_1","frameContexts_1_1","keys_1","keys_1_1","bindings","dgColumnNames","dgColumnInfo","array","componentType","farrisTreeTalbeComponent","getVerifyInformations","buildVerifyInformations","targetField","removeValidateVerifyInformations","RequiredEffector","pathValue","updateColumnValidators","datagridColumns","isValidValue","datagrid","updateColumn","columns","columnsChanged","getDataPropInfo","VisibleEffector","datagridComponent","getTablePaths","getDatagridComponent","fieldPaths","getPropertyPaths","showColumn","hideColumn","matchedFrameContexts","componentsMap","tablePaths","EffectorFactory","getEffector","nsEffectors","effectorRegistry","effector","Compute","Dependency","Relative","EventHandler","handleEvent","effectTo","effectorFactory","effectPaths","effectOptions","isValidateOrRequiredExpression","getEntityPathFromEvent","buildEntityPath","cleanEventPath","getEventId","tableCode","propertyIndex","idIndex","expressionBindingType","object_1","v1","v2","userAssignCurrentRow","row_1","entityCode","buildEffectPath","expressionPaths","currentPaths","propertyInfo","getPathInfo","propertyNames","getTablePathsFromEventPaths","getPropertyPathsFromEventPaths","analysis","expressionPathInfo","eventPaths","eventPathInfo","expressionTablePaths","expressionPropertyNames","eventTablePaths","eventPropertyNames","distance","eventFromChildren","eventFromParent","isSameTable","buildCurrentRows","fullPaths","convertBooleanTypeExpressionResult","isBooleanTypeExpression","isReadonlyExpression","isVisibleExpression","isValidateExpression","isRequiredExpression","isDependencyExpression","EntityValueChangedEventHandler","getCurrentRowByEvent","EffectorManager","StateValueChangedEventHandler","changePaths","eventPath","effectRows","output","prevPaths","currentCurrentRows","flag_1","nextPrevPaths_1","nextBindingPaths","RepositoryAddEntityEventHandler","RepositoryRemoveEntityEventHandler","RepositoryLoadEventHandler","EntityUpdateEventHandler","depPathInfo","eventEntityPath","childrenPaths","BindingDataAppendObjectEventHandler","groupExpressions","dependPathInfo","eventTablePaths_1","relativeExpressions","depExpressions","depPath","propertyPaths_1","prevPaths_1","BindingDataValueChangeEventHandler","eventEntityPaths","list_1","list_1_1","BindingDataRemoveObjectEventHandler","propertyPaths","BindingDataLoadEventHandler","BindingDataSelectionChangedEventHandler","EventHandlerRegistry","ExpressionEngineImpl","attachEvent","expressionEventEmitter","getEventHandler","resolveDependency","eventHandlerRegistry","bindingDataValueChangeEventHandler","entityValueChangedEventHandler","stateValueChangedEventHandler","repositoryAddEntityEventHandler","bindingDataAppendEntityEventHandler","repositoryRemoveEntityEventHandler","bindingDataRemoveObjectEventHandler","entityUpdateEventHandler","repositoryLoadEventHandler","bindingDataLoadEventHandler","bindingDataSelectionChangedHandler","ComponentRefManager","isDestoried","isRootFrameContext","viewModelNames","exceptionHandler","expressionEngineImpl","getComponentById","componentRefManager","getComponentsById","bindInjector","componentInjector","initializeBindingData","initializeStateMachine","initializeUiState","initializeForm","initializeCommandBus","initializeViewModel","registerExceptionHandler","initExpression","formAppContext","location","href","applicationContext","isExceptionHandlerExist","setContext","__frame_context__","handle","registerAppContextDestroyEvent","getFrameId","initializeRepository","handlerRegistry","extendsRegistry","commandHandlerFactory","CommandHandlerFactory","CommandBus","regViewModel","isRunAtHighSpeedMode","repositoryBindingData","routerParams","className","parentContext","childViewModels","viewModelName","name_1","nameToken","charAt","toLocaleUpperCase","formFrameContext","getViewModel","renderAppContext","attachViewComponent","viewComponent","actionPath","$event","actionBindingPath","bindingViewModel","alert","InjectFlags","defaultViewModel","FrameComponent","cd","ngOnInit","initialized","getChangeDetectorRef","initPublicEvent","initSubscription","restComponent","onFrameComponentInit","frameComponentInitHandlers","onComponentInit","ChangeDetectorRef","isCdValid","getSubscription","declaration","getDeclaration","trigger","executingCommandCount$","executingCommandCount","innerTrigger","FrameEvent","FrameEventBus","frameIds","rawHandler","extenderRegistry","extend","commandResult$","executeCommand","lastTaskResult","removeCommandFromExecutingQueue","is401Error","handlerFactory","addCommandToExecutingQueue","executingCommands","postOrNot","executingCommand","COMMAND_PROVIDERS","controllerMap","imports","dynamicInvoke","serviceTocken","dynamicInvoke2","methodObject","serviceUri","serviceName","service","stageParam","result$","serviceSpecifer","serviceModule_1","executeWithServiceModule","System","import","serviceModule","originalContextInjector_1","resolvedReflectiveProviders","loadProvidersFromModule","reflectiveInjector","ReflectiveInjector","fromResolvedProviders","serviceMethod","serviceMethodResult","isObservable","scheduleStages","stages","initialStage","preStage","currentStage","forkStage","providerArray","isInjectableService","providerName","hasInjectableDecorator","isFunction","injectableDecorators","decorator","__annotations__","decoratorFactory","VALIDATION_HANDLER","FARRIS_DEVKIT_APP_PROVIDERS","FARRIS_DEVKIT_MODULE_PROVIDERS","FARRIS_DEVKIT_ROOT_FRAME_PROVIDERS","FARRIS_DEVKIT_EXPRESSION_ROOT_FRAME_PROVIDERS","FARRIS_DEVKIT_EXPRESSION_LISTENER_PROVIDERS","FARRIS_DEVKIT_EXPRESSION_EFFECTOR_PROVIDERS","FARRIS_DEVKIT_FRAME_PROVIDERS","DevkitModule","NgModule","providers","CacheReturnType","DeprecatedBindingDataChangeListener","CacheKeyCompare","key1","key2","CacheObject","isExpired","ttl","createAt","CacheContainer","cacheObject","isCacheObjectExpired","MemoryCacheProvider","store","cacheKeyCompare","DefaultCacheProvider","makeParamDecorator","ParamDecoratorFactory","ParamDecorator","annotation","unusedKey","parameters","NgEntity","NgRepository","encodeUrl","encodeURI","NgCommandHandler","NgCommandHandlerExtender","NgBindingData","NgValidateForm","NgDeclaration","NgSubscription","getNgSubscriptionDecoratorFactory","Cacheable","propertyKey","descriptor","getOwnPropertyDescriptor","cacheKey","argsString"],"mappings":"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","sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","/**\r\n * @license\r\n * Copyright Google Inc. All Rights Reserved.\r\n *\r\n * Use of this source code is governed by an MIT-style license that can be\r\n * found in the LICENSE file at https://angular.io/license\r\n */\r\nimport { Type } from '@angular/core';\r\n\r\n/**\r\n * An interface implemented by all Angular formType decorators, which allows them to be used as ES7\r\n * decorators as well as\r\n * Angular DSL syntax.\r\n *\r\n * ES7 syntax:\r\n *\r\n * ```\r\n * @ng.Component({...})\r\n * class MyClass {...}\r\n * ```\r\n *\r\n */\r\nexport interface TypeDecorator {\r\n    /**\r\n     * Invoke as ES7 decorator.\r\n     */\r\n    <T extends Type<any>>(type: T): T;\r\n\r\n    // Make TypeDecorator assignable to built-in ParameterDecorator formType.\r\n    // ParameterDecorator is declared in lib.d.ts as a `declare formType`\r\n    // so we cannot declare this interface as a subtype.\r\n    // see https://github.com/angular/angular/issues/3379#issuecomment-126169417\r\n    (target: Object, propertyKey?: string | symbol, parameterIndex?: number): void;\r\n}\r\n\r\nexport const ANNOTATIONS = '__annotations__';\r\nexport const PARAMETERS = '__parameters__';\r\nexport const PROP_METADATA = '__prop__metadata__';\r\n\r\n/**\r\n * @suppress {globalThis}\r\n */\r\nexport function makeDecorator(\r\n    name: string, props?: (...args: any[]) => any, parentClass?: any,\r\n    chainFn?: (fn: Function) => void,\r\n    typeFn?: (type: Type<any>, ...args: any[]) => void): {\r\n        new(...args: any[]): any;\r\n        (...args: any[]): any;\r\n        (...args: any[]): (cls: any) => any;\r\n    } {\r\n    const metaCtor = makeMetadataCtor(props);\r\n\r\n    function DecoratorFactory(...args: any[]): (cls: any) => any {\r\n        if (this instanceof DecoratorFactory) {\r\n            metaCtor.call(this, ...args);\r\n            return this;\r\n        }\r\n\r\n        const annotationInstance = new (<any>DecoratorFactory)(...args);\r\n        const typeDecorator: TypeDecorator = <TypeDecorator>function createTypeDecorator(cls: Type<any>) {\r\n            typeFn && typeFn(cls, ...args);\r\n            // Use of Object.defineProperty is important since it creates non-enumerable property which\r\n            // prevents the property is copied during subclassing.\r\n            const annotations = cls.hasOwnProperty(ANNOTATIONS) ?\r\n                (cls as any)[ANNOTATIONS] :\r\n                Object.defineProperty(cls, ANNOTATIONS, { value: [] })[ANNOTATIONS];\r\n            annotations.push(annotationInstance);\r\n            return cls;\r\n        };\r\n        if (chainFn) { chainFn(typeDecorator); }\r\n        return typeDecorator;\r\n    }\r\n\r\n    if (parentClass) {\r\n        DecoratorFactory.prototype = Object.create(parentClass.prototype);\r\n    }\r\n\r\n    DecoratorFactory.prototype.ngMetadataName = name;\r\n    (<any>DecoratorFactory).annotationCls = DecoratorFactory;\r\n    return DecoratorFactory as any;\r\n}\r\n\r\nfunction makeMetadataCtor(props?: (...args: any[]) => any): any {\r\n    return function ctor(...args: any[]) {\r\n        if (props) {\r\n            const values = props(...args);\r\n            // tslint:disable-next-line:forin\r\n            for (const propName in values) {\r\n                this[propName] = values[propName];\r\n            }\r\n        }\r\n    };\r\n}\r\n\r\nexport function makeParamDecorator(\r\n    name: string, props?: (...args: any[]) => any, parentClass?: any): any {\r\n    const metaCtor = makeMetadataCtor(props);\r\n    function ParamDecoratorFactory(...args: any[]): any {\r\n        if (this instanceof ParamDecoratorFactory) {\r\n            metaCtor.apply(this, args);\r\n            return this;\r\n        }\r\n        const annotationInstance = new (<any>ParamDecoratorFactory)(...args);\r\n\r\n        (<any>ParamDecorator).annotation = annotationInstance;\r\n        return ParamDecorator;\r\n\r\n        function ParamDecorator(cls: any, unusedKey: any, index: number): any {\r\n            // Use of Object.defineProperty is important since it creates non-enumerable property which\r\n            // prevents the property is copied during subclassing.\r\n            const parameters = cls.hasOwnProperty(PARAMETERS) ?\r\n                (cls as any)[PARAMETERS] :\r\n                Object.defineProperty(cls, PARAMETERS, { value: [] })[PARAMETERS];\r\n\r\n            // there might be gaps if some in between parameters do not have annotations.\r\n            // we pad with nulls.\r\n            while (parameters.length <= index) {\r\n                parameters.push(null);\r\n            }\r\n\r\n            (parameters[index] = parameters[index] || []).push(annotationInstance);\r\n            return cls;\r\n        }\r\n    }\r\n    if (parentClass) {\r\n        ParamDecoratorFactory.prototype = Object.create(parentClass.prototype);\r\n    }\r\n    ParamDecoratorFactory.prototype.ngMetadataName = name;\r\n    (<any>ParamDecoratorFactory).annotationCls = ParamDecoratorFactory;\r\n    return ParamDecoratorFactory;\r\n}\r\n\r\nexport function makePropDecorator(\r\n    name: string, props?: (...args: any[]) => any, parentClass?: any): any {\r\n    const metaCtor = makeMetadataCtor(props);\r\n\r\n    function PropDecoratorFactory(...args: any[]): any {\r\n        if (this instanceof PropDecoratorFactory) {\r\n            metaCtor.apply(this, args);\r\n            return this;\r\n        }\r\n\r\n        const decoratorInstance = new (<any>PropDecoratorFactory)(...args);\r\n\r\n        // tslint:disable-next-line:no-shadowed-variable\r\n        return function PropDecorator(target: any, name: string) {\r\n            const constructor = target.constructor;\r\n            // Use of Object.defineProperty is important since it creates non-enumerable property which\r\n            // prevents the property is copied during subclassing.\r\n            const meta = constructor.hasOwnProperty(PROP_METADATA) ?\r\n                (constructor as any)[PROP_METADATA] :\r\n                Object.defineProperty(constructor, PROP_METADATA, { value: {} })[PROP_METADATA];\r\n            meta[name] = meta.hasOwnProperty(name) && meta[name] || [];\r\n            meta[name].unshift(decoratorInstance);\r\n        };\r\n    }\r\n\r\n    if (parentClass) {\r\n        PropDecoratorFactory.prototype = Object.create(parentClass.prototype);\r\n    }\r\n\r\n    PropDecoratorFactory.prototype.ngMetadataName = name;\r\n    (<any>PropDecoratorFactory).annotationCls = PropDecoratorFactory;\r\n    return PropDecoratorFactory;\r\n}\r\n","import { ANNOTATIONS, PROP_METADATA } from './decorator';\r\nimport { Translate } from '../../i18n';\r\n//import { Cacheable, DefaultCacheProvider } from '../../cache';\r\n\r\n/**\r\n * \r\n * \r\n * 1\r\n * 2\r\n */\r\nclass MetadataUtil {\r\n\r\n  // ----------------------------------------\r\n  // \r\n  // ----------------------------------------\r\n\r\n  /**\r\n   * \r\n   * \r\n   * [\r\n   *   Injectable\r\n   *   NgViewModel\r\n   *   NgViewModel\r\n   * ]\r\n   */\r\n  static getClassMetadatas(constructor: any): any[] {\r\n    const metadatas = constructor[ANNOTATIONS];\r\n    return metadatas;\r\n  }\r\n\r\n  /**\r\n   * class\r\n   * NgViewModel\r\n   */\r\n  static getClassMetadataByName(constructor: any, metadataName: string): any {\r\n    const metadata = this.getClassMetadataByNameWithTranslate(constructor, metadataName, null, null);\r\n    return metadata;\r\n  }\r\n\r\n  static getClassMetadataByNameWithTranslate(\r\n    constructor: any, metadataName: string,\r\n    translateService?: Translate, keysToTranslate?: string[]): any {\r\n    const allClassMetadatas = this.getClassMetadatas(constructor);\r\n    if (!allClassMetadatas) {\r\n      return null;\r\n    }\r\n    const metadata = allClassMetadatas.find((classMetadata: any) => {\r\n      return classMetadata.ngMetadataName === metadataName;\r\n    });\r\n    this.translateMetadataByName(metadata, translateService, keysToTranslate);\r\n    return metadata;\r\n  }\r\n\r\n  // ----------------------------------------\r\n  // \r\n  // ----------------------------------------\r\n\r\n  /**\r\n   * \r\n   * \r\n   * {\r\n   *   propName1: [ NgDefaultValue, NgMaxLength, NgMinLength],\r\n   *   propName2: [ NgDefaultValue, NgMaxLength, NgMinLength]\r\n   * }\r\n   */\r\n   // @Cacheable({ key: ((context: any, args: any[]) => args[0]), provider: new DefaultCacheProvider() })\r\n  static getPropsMetadatas(constructor: any): any {\r\n    const allPropMetadatas = constructor[PROP_METADATA];\r\n    return allPropMetadatas;\r\n  }\r\n\r\n  /**\r\n   * \r\n   * \r\n   * \r\n   * {\r\n   *    propName1: NgDefaultValue,\r\n   *    propName2: NgDefaultValue\r\n   * }\r\n   */\r\n  // @Cache({ provider: new MemoryCacheProvider(new MetadataKeyCompare()), key: ((context: any, args: any[]) => { return { constructor: args[0], metadataName: args[1] } }) })\r\n  static getPropsMetadatasByName(constructor: any, metadataName: string): { [propName: string]: any } {\r\n    const metadatas = this.getPropsMetadatasByNameWithTranslate(constructor, metadataName);\r\n    return metadatas;\r\n  }\r\n  static getPropsMetadatasByNameWithTranslate(\r\n    constructor: any, metadataName: string,\r\n    translateService?: Translate, keysToTranslate?: string[]): { [propName: string]: any } {\r\n    const metadatas = {};\r\n    // \r\n    const allPropMetadatas = this.getPropsMetadatas(constructor);\r\n    if (!allPropMetadatas) {\r\n      return metadatas;\r\n    }\r\n    // \r\n    Object.keys(allPropMetadatas).forEach((propName: string) => {\r\n      // \r\n      const propMetadatas: any[] = allPropMetadatas[propName];\r\n      // \r\n      const metadata = propMetadatas.find((propMetadata: any) => {\r\n        return propMetadata.ngMetadataName === metadataName;\r\n      });\r\n      if (metadata) {\r\n        metadatas[propName] = metadata;\r\n      }\r\n    });\r\n    // \r\n    this.translateMetadatasByName(metadatas, translateService, keysToTranslate);\r\n    return metadatas;\r\n  }\r\n\r\n  static translateMetadatasByName(metadatas: any, translateService?: Translate, keysToTranslate?: string[])\r\n    : { [propName: string]: any } {\r\n    Object.keys(metadatas).forEach((propName: string) => {\r\n      // \r\n      this.translateMetadataByName(metadatas[propName], translateService, keysToTranslate);\r\n    });\r\n    return metadatas;\r\n  }\r\n\r\n  static translateMetadataByName(metadata: any, translateService?: Translate, keysToTranslate?: string[]): any {\r\n    if (metadata && translateService && keysToTranslate) {\r\n      keysToTranslate.forEach((metadataPropKey) => {\r\n        const propertyVariable: string = metadata[metadataPropKey];\r\n        try {\r\n        if (propertyVariable && propertyVariable.startsWith('{{') && propertyVariable.endsWith('}}')) {\r\n          const translateKey = propertyVariable.replace('{{', '').replace('}}', '').trim();\r\n          metadata[metadataPropKey] = translateService.transform(translateKey, null);\r\n        }\r\n        } catch (e) {\r\n          console.info(e);\r\n        }\r\n      });\r\n    }\r\n    return metadata;\r\n  }\r\n\r\n  /**\r\n   * \r\n   * [ NgDefaultValue, NgMaxLength, NgMinLength]\r\n   */\r\n  static getPropMetadatasByName(constructor: any, propName: string): any[] {\r\n    // \r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * \r\n   * NgDefaultValue\r\n   */\r\n  static getPropMetadataByName(constructor: any, propName: string, metadataName: string): any {\r\n    // \r\n    return null;\r\n  }\r\n\r\n\r\n  // ----------------------------------------\r\n  // \r\n  // ----------------------------------------\r\n\r\n}\r\n\r\nexport { MetadataUtil };\r\n","/**\r\n * \r\n */\r\nexport class Modification {\r\n\r\n  /**\r\n   * [1, 'name']\r\n   *  1 ID name \r\n   */\r\n  path?: string[];\r\n\r\n  /**\r\n   * \r\n   */\r\n  preValue?: any;\r\n\r\n  /**\r\n   * \r\n   *\r\n   * value  type()type \r\n   * - Add: valuejson \r\n   * - ValueChange: valuestring\\number\\boolean\r\n   * - Remove: value{[key:string]: value} key\r\n   *\r\n   */\r\n  value: any;\r\n\r\n  /**\r\n   * \r\n   */\r\n  type: ModifyType;\r\n\r\n  /**\r\n   * \r\n   */\r\n  isValid?: boolean;\r\n\r\n  /**\r\n   * \r\n   */\r\n  errors?: { [type: string]: string };\r\n\r\n  /**\r\n   * \r\n   */\r\n  position?: 1 | -1;\r\n\r\n  /**\r\n   * \r\n   */\r\n  changeSetValue?: any;\r\n  /**\r\n   * \r\n   */\r\n  isReset?: boolean;\r\n  entityCreate?: boolean;\r\n  dynamic?: boolean;\r\n  /**\r\n   * \r\n   * @description \r\n   */\r\n  isTreeNodeLoadScene?: boolean;\r\n  /**\r\n   * \r\n   * @param value \r\n   * @param modifyType \r\n   * @param path \r\n   * @param preValue \r\n   */\r\n  constructor(value: any, modifyType: ModifyType, path?: string[], preValue?: any, position?: 1 | -1) {\r\n    this.type = modifyType;\r\n    this.value = value;\r\n    this.preValue = preValue;\r\n    this.path = path;\r\n    this.position = position;\r\n  }\r\n}\r\n\r\n/**\r\n * \r\n */\r\nexport enum ModifyType {\r\n\r\n  /**\r\n   * \r\n   */\r\n  Add = 'ADD',\r\n  /**\r\n   * \r\n   */\r\n  AddData = 'AddData',\r\n  /**\r\n   * \r\n   */\r\n  Clone = 'CLONE',\r\n  /**\r\n   * \r\n   */\r\n  Remove = 'REMOVE',\r\n  RemoveData = 'RemoveData',\r\n\r\n  /**\r\n   * \r\n   */\r\n  ValueChange = 'VALUE_CHANGE',\r\n\r\n  /**\r\n   * \r\n   */\r\n  Load = 'LOAD',\r\n\r\n  /**\r\n   * \r\n   */\r\n  UnChanged = 'UNCHANGED',\r\n\r\n  /**\r\n   * \r\n   */\r\n  PaginationInfoChange = 'PAGINATION_INFO_CHANGE',\r\n\r\n  /**\r\n   * \r\n   */\r\n  Insert = 'Insert',\r\n  /**\r\n   * \r\n   */\r\n  Update = 'UPDATE'\r\n}\r\n","/*\r\n * @Author: Lucus, Witt\r\n * @Date: 2018-10-30 15:53:59\r\n * @Last Modified by: Witt\r\n * @Last Modified time: 2018-11-08 17:25:08\r\n */\r\n\r\nimport { Modification, ModifyType } from './types';\r\n\r\nfunction isEqual(value: any, other: any) {\r\n  return JSON.stringify(value) === JSON.stringify(other);\r\n}\r\n\r\n/**\r\n * \r\n */\r\nclass ChangeSet {\r\n\r\n  /**\r\n   * \r\n   */\r\n  protected modifications: Modification[] = [];\r\n\r\n  /**\r\n   *  \r\n   */\r\n  public get changes(): Modification[] {\r\n    return this.modifications;\r\n  }\r\n\r\n  /**\r\n   * \r\n   * ### \r\n   * ```\r\n   * const changeSet = new ChangeSet();\r\n   * const modify = new Modification('newValue', ModifyType.ValueChange, [1, 'title'], 'oldValue');\r\n   * changeSet.append(modify)\r\n   * ```\r\n   * @param changeItem \r\n   */\r\n  public append(modification: Modification) {\r\n    switch (modification.type) {\r\n      case ModifyType.ValueChange:\r\n        this.appendValueChangeModification(modification);\r\n        break;\r\n      case ModifyType.Add:\r\n      case ModifyType.Insert:\r\n      case ModifyType.Clone:\r\n        this.appendAddModification(modification);\r\n        break;\r\n      case ModifyType.Remove:\r\n        this.appendRemoveModification(modification);\r\n        break;\r\n      case ModifyType.Load:\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private appendValueChangeModification(modification: Modification) {\r\n    const value = modification.value;\r\n\r\n    const existedModification = this.findModifyItemsPath(modification.path);\r\n    if (existedModification) {\r\n\r\n      // ValueChange\r\n      existedModification.value = value;\r\n    } else {\r\n      const existedAddModification = this.findNewAddItemsPath(modification.path);\r\n      if (existedAddModification) {\r\n\r\n        // @todo\r\n        // 1valueassign\r\n        // 2\r\n        // ValueChangeAddAdd\r\n        existedAddModification.value = Object.assign({}, existedAddModification.value, value);\r\n      } else {\r\n\r\n        // ValueChange\r\n        this.modifications.push(modification);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private appendAddModification(modification: Modification) {\r\n    const value = modification.value;\r\n\r\n    const existedModification = this.findNewAddItemsPath(modification.path);\r\n    if (existedModification) {\r\n\r\n      // 1AddValue\r\n      existedModification.value = existedModification.value.concat(value);\r\n    } else {\r\n\r\n      // 2Add\r\n      this.modifications.push(modification);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private appendRemoveModification(modification: Modification) {\r\n\r\n    const path = modification.path;\r\n    const primaryKey = Object.keys(modification.value)[0];\r\n    const primaryKeyValue = modification.value[primaryKey];\r\n\r\n    // 1path\r\n    // @todo12\r\n    this.modifications.forEach((addModification: Modification) => {\r\n\r\n      // \r\n      if (addModification.type !== ModifyType.Add && addModification.type !== ModifyType.Insert && addModification.type !== ModifyType.Clone) {\r\n        return;\r\n      }\r\n\r\n      // @todo \r\n      if (isEqual(addModification.path, path) === false) {\r\n        return;\r\n      }\r\n\r\n      // valuevalue\r\n      addModification.value = addModification.value.filter((addDataItem: any) => {\r\n        return addDataItem[primaryKey] !== primaryKeyValue;\r\n      });\r\n    });\r\n\r\n    // 2\r\n    const fullRemovePath = path.concat(`${primaryKey}:${primaryKeyValue}`);\r\n    this.modifications = this.modifications.filter((valueModification: Modification) => {\r\n      if (valueModification.type !== ModifyType.ValueChange) {\r\n        return true;\r\n      }\r\n      const valueChangePath = Array.from(valueModification.path);\r\n      valueChangePath.pop();\r\n\r\n      // \r\n      const isToRemove = isEqual(valueChangePath, fullRemovePath);\r\n      return !isToRemove;\r\n    });\r\n\r\n    // \r\n    // \r\n    this.removeDescendantRemoveModifications(modification);\r\n    this.modifications.push(modification);\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public clear() {\r\n    this.modifications = [];\r\n  }\r\n\r\n\r\n  /**\r\n   * pathAdd\r\n   * @param path \r\n   */\r\n  private findNewAddItemsPath(path: any[]) {\r\n    return this.modifications.find((value, index) => {\r\n      return isEqual(path, value.path) && (value.type === ModifyType.Add || value.type === ModifyType.Insert || value.type === ModifyType.Clone);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * pathValueChange\r\n   * @param path \r\n   */\r\n  private findModifyItemsPath(path: any[]) {\r\n    return this.modifications.find((value, index) => {\r\n      return isEqual(path, value.path) && value.type === ModifyType.ValueChange;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @todo\r\n   */\r\n  private removeDescendantRemoveModifications(parentRemoveModification: Modification): void {\r\n\r\n    const parentPathWithId = this.createRemovePathWithId(parentRemoveModification);\r\n\r\n    // \r\n    this.modifications = this.modifications.filter((modification: Modification) => {\r\n      if (modification.type !== ModifyType.Remove) {\r\n        return true;\r\n      }\r\n      const descendantPathWithId = this.createRemovePathWithId(modification);\r\n      const isDescendant = this.isDescendantPath(parentPathWithId, descendantPathWithId);\r\n      return !isDescendant;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @summary\r\n   * 1\r\n   * 2id\r\n   */\r\n  private createRemovePathWithId(modification: Modification) {\r\n    const path = modification.path;\r\n    const primaryKey = Object.keys(modification.value)[0];\r\n    const primaryKeyValue = modification.value[primaryKey];\r\n    const pathWithId = path.concat([`${primaryKey}:${primaryKeyValue}`]);\r\n    return pathWithId;\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param parentPath \r\n   * @param descendantPath \r\n   */\r\n  private isDescendantPath(parentPath: string[], descendantPath: string[]) {\r\n    if (parentPath.length > descendantPath.length) {\r\n      return false;\r\n    }\r\n\r\n    let isDescendantPath = true;\r\n    parentPath.forEach((parentPathItem: string, parentPathItemIndex: number) => {\r\n      if (parentPathItem !== descendantPath[parentPathItemIndex]) {\r\n        isDescendantPath = false;\r\n        return;\r\n      }\r\n    });\r\n\r\n    return isDescendantPath;\r\n  }\r\n\r\n}\r\n\r\nexport { ChangeSet };\r\n\r\n","import { makePropDecorator } from '../../metadata/index';\r\nimport { ClassType } from '../types';\r\nimport { ValidateRule } from '../validator/index';\r\n\r\nfunction isPlainObject(value): boolean {\r\n  if (!(typeof value === 'object' && value !== null) || Object.prototype.toString.call({}) !== '[object Object]') {\r\n    return false;\r\n  }\r\n  if (Object.getPrototypeOf(value) === null) {\r\n    return true;\r\n  }\r\n  let proto = value;\r\n  while (Object.getPrototypeOf(proto) !== null) {\r\n    proto = Object.getPrototypeOf(proto);\r\n  }\r\n  return Object.getPrototypeOf(value) === proto;\r\n}\r\n\r\nexport interface NgProperty {\r\n\r\n  /**\r\n   * \r\n   * @summary\r\n   * key\r\n   */\r\n  dataField?: string;\r\n\r\n  /**\r\n   * \r\n   */\r\n  originalDataField?: string;\r\n\r\n  /**\r\n   * \r\n   */\r\n  originalDataFieldType?: string;\r\n\r\n  /**\r\n   * \r\n   */\r\n  type?: any;\r\n\r\n  /**\r\n   * \r\n   * @description schemepath\r\n   */\r\n  path?: string;\r\n\r\n}\r\n\r\n\r\n/**\r\n * --------------------------------------------------------------------------------\r\n * NgField\r\n * --------------------------------------------------------------------------------\r\n */\r\n\r\n/**  */\r\nexport const NG_FIELD = 'NgField';\r\n\r\n/**  */\r\nexport interface NgFieldProperty extends NgProperty {\r\n\r\n  /**  */\r\n  property?: string;\r\n\r\n  /**  */\r\n  dataField?: string;\r\n\r\n  /**  */\r\n  originalDataField?: string;\r\n\r\n  /**  */\r\n  originalDataFieldType?: string;\r\n\r\n  /**  */\r\n  primary?: boolean;\r\n\r\n  /**  */\r\n  foreign?: boolean;\r\n\r\n  /**  */\r\n  defaultValue?: any;\r\n\r\n  /**  */\r\n  validRules?: ValidateRule[];\r\n\r\n  /**  */\r\n  initValue?: any;\r\n\r\n  /**  */\r\n  enableMultiLangInput?: boolean;\r\n  /**\r\n   * \r\n   */\r\n  enableTimeZone?: boolean;\r\n  /**\r\n   * \r\n   * @description schemepath\r\n   */\r\n  path?: string;\r\n}\r\n\r\n/**  */\r\nexport interface NgFieldPropertyDecorator {\r\n  /**\r\n   * @constructor\r\n   * @param obj obj NgFieldPropertystringClassType\r\n   *\r\n   * string \r\n   *\r\n   * ClassType\r\n   */\r\n  (obj: NgFieldProperty | string | ClassType): any;\r\n  (obj?: NgFieldProperty | string | boolean): any;\r\n  new(obj?: NgFieldProperty | string | boolean): any;\r\n}\r\n\r\nfunction makeNgFieldDecorator(options?: NgFieldProperty | string | boolean): any {\r\n  let metadata: NgFieldProperty = {\r\n    primary: false,\r\n    foreign: false\r\n  };\r\n\r\n  if (options) {\r\n    const paramType = typeof options;\r\n    switch (paramType) {\r\n      case 'boolean':\r\n        metadata.primary = Boolean(options);\r\n        break;\r\n      case 'string':\r\n        metadata.dataField = String(options);\r\n        break;\r\n      case 'object':\r\n        metadata = Object.assign(metadata, options);\r\n        break;\r\n    }\r\n  }\r\n  return metadata;\r\n}\r\n\r\n/**\r\n * \r\n *\r\n * ### \r\n * ```\r\n * export class UserEntity extends Entity {\r\n *      @NgField({\r\n *          primary: true,\r\n *          dataField: 'id',\r\n *          ...\r\n *      })\r\n *      userid: string;\r\n *      userName: string;\r\n * }\r\n * ```\r\n */\r\nexport const NgField: NgFieldPropertyDecorator = makePropDecorator(NG_FIELD, makeNgFieldDecorator);\r\n\r\n\r\n/**\r\n * --------------------------------------------------------------------------------\r\n * NgField\r\n * --------------------------------------------------------------------------------\r\n */\r\n\r\n/** NgList  */\r\nexport const NG_LIST = 'NgList';\r\n\r\n/**\r\n * \r\n */\r\nexport interface NgListProperty extends NgProperty {\r\n  /**  */\r\n  tableName?: string;\r\n  /**  */\r\n  dataField?: string;\r\n  /**  */\r\n  originalDataField?: string;\r\n  /**  */\r\n  type?: any;\r\n  /**\r\n   * \r\n   * @description schemepath\r\n   */\r\n  path?: string;\r\n}\r\n\r\n/**  */\r\nexport interface NgListPropertyDecorator {\r\n  /**\r\n   * @constructor\r\n   * @param obj obj NgListPropertystringClassType\r\n   *\r\n   * string \r\n   *\r\n   * ClassType\r\n   */\r\n  (obj: NgListProperty | string | ClassType): any;\r\n  new(obj: NgListProperty | string | ClassType): any;\r\n}\r\n\r\nfunction makeNgListDecorator(options: NgListProperty | string | ClassType): any {\r\n  if (isPlainObject(options)) {\r\n    return options;\r\n  }\r\n\r\n  const type = typeof options;\r\n  if (type === 'string') {\r\n    return {\r\n      dataField: options\r\n    };\r\n  }\r\n\r\n  if (type === 'function') {\r\n    return {\r\n      type: options\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * \r\n * ### \r\n * ```\r\n * export class UserEntity extends Entity {\r\n *      @NgField({\r\n *          primary: true,\r\n *          dataField: 'id',\r\n *          ...\r\n *      })\r\n *      userid: string;\r\n *      userName: string;\r\n *      @NgList({\r\n *          dataField: 'roles',\r\n *          formType: Role\r\n *      })\r\n *      Roles: EntityList<Role>\r\n * }\r\n * ```\r\n */\r\nexport const NgList: NgListPropertyDecorator = makePropDecorator(NG_LIST, makeNgListDecorator);\r\n\r\n\r\n/**\r\n * --------------------------------------------------------------------------------\r\n * NgObject\r\n * --------------------------------------------------------------------------------\r\n */\r\n\r\n/** NgObject  */\r\nexport const NG_OBJECT = 'NgObject';\r\n\r\n/**\r\n * \r\n */\r\nexport interface NgObjectProperty extends NgProperty {\r\n  /**  */\r\n  dataField?: string;\r\n  /**  */\r\n  originalDataField?: string;\r\n  /**  */\r\n  tableName?: string;\r\n  /**  */\r\n  type?: ClassType;\r\n  /**  path|parent */\r\n  hierarchyType?: string;\r\n  /**\r\n   * \r\n   * @description schemepath\r\n   */\r\n  path?: string;\r\n}\r\n\r\n/**  */\r\nexport interface NgObjectPropertyDecorator {\r\n  /**\r\n   * @constructor\r\n   * @param obj obj NgObjectPropertystringClassType\r\n   *\r\n   * string \r\n   *\r\n   * ClassType\r\n   */\r\n  (obj: NgObjectProperty | string | ClassType): any;\r\n  new(obj: NgObjectProperty | string | ClassType): any;\r\n}\r\n\r\nfunction makeNgObjectDecorator(options: NgObjectProperty | string | ClassType): any {\r\n  if (isPlainObject(options)) {\r\n    return options;\r\n  }\r\n\r\n  const type = typeof options;\r\n  if (type === 'string') {\r\n    return {\r\n      dataField: options\r\n    };\r\n  }\r\n\r\n  if (type === 'function') {\r\n    return {\r\n      type: options\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * \r\n * ### \r\n *\r\n * ```\r\n *  export class UserEntity entends Entity {\r\n *      @NgField(true)  // \r\n *      id: string;\r\n *      @NgField('name')  //  name\r\n *      userName: string;\r\n *\r\n *      depid: string;\r\n *\r\n *      @NgObject(Department)  //  Department \r\n *      epartment: Department;\r\n *  }\r\n * ```\r\n */\r\nexport const NgObject: NgObjectPropertyDecorator = makePropDecorator(NG_OBJECT, makeNgObjectDecorator);\r\n\r\n\r\n/**\r\n * --------------------------------------------------------------------------------\r\n * NgDynamicProperty\r\n * --------------------------------------------------------------------------------\r\n */\r\n\r\n/** NgObject  */\r\nexport const NG_Dynamic = 'NgDynamic';\r\n\r\n/**\r\n * \r\n */\r\nexport interface NgDynamicProperty extends NgProperty {\r\n  /**  */\r\n  dataField?: string;\r\n  /**  */\r\n  originalDataField?: string;\r\n  /**  */\r\n  tableName?: string;\r\n  /**  */\r\n  type?: ClassType;\r\n  /**\r\n   * \r\n   * @description schemepath\r\n   */\r\n  path?: string;\r\n}\r\n\r\n/**  */\r\nexport interface NgDynamicPropertyDecorator {\r\n  /**\r\n   * @constructor\r\n   * @param obj obj NgDynamicPropertystringClassType\r\n   *\r\n   * string \r\n   *\r\n   * ClassType\r\n   */\r\n  (obj: NgDynamicProperty | string | ClassType): any;\r\n  new(obj: NgDynamicProperty | string | ClassType): any;\r\n}\r\n\r\nfunction makeNgDynamicDecorator(options: NgDynamicProperty | string | ClassType): any {\r\n  if (isPlainObject(options)) {\r\n    return options;\r\n  }\r\n\r\n  const type = typeof options;\r\n  if (type === 'string') {\r\n    return {\r\n      dataField: options\r\n    };\r\n  }\r\n\r\n  if (type === 'function') {\r\n    return {\r\n      type: options\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * \r\n * ### \r\n *\r\n * ```\r\n *  export class UserEntity entends Entity {\r\n *      @NgField(true)  // \r\n *      id: string;\r\n *      @NgField('name')  //  name\r\n *      userName: string;\r\n *\r\n *      depid: string;\r\n *\r\n *      @NgDynamic(Department)  //  Department \r\n *      epartment: Department;\r\n *  }\r\n * ```\r\n */\r\nexport const NgDynamic: NgDynamicPropertyDecorator = makePropDecorator(NG_Dynamic, makeNgDynamicDecorator);\r\n","import { makeDecorator } from \"../../metadata/index\";\r\n\r\nexport const NG_ENTITY = 'NgEntity';\r\n\r\n/**\r\n * \r\n */\r\nexport interface NgEntity {\r\n  /**\r\n   * ,schemacode\r\n   */\r\n  originalCode: string;\r\n  /**\r\n   * ,schemalabel\r\n   */\r\n  nodeCode: string;\r\n  /**\r\n   * \r\n   */\r\n  allowEmpty?: boolean | string;\r\n}\r\n/**\r\n * \r\n */\r\nexport interface NgEntityDecorator {\r\n  (obj?: NgEntity): any;\r\n  new(obj?: NgEntity): any;\r\n}\r\n/**\r\n * \r\n * @param options options\r\n */\r\nexport function NgEntity(options: NgEntity) {\r\n  const decoratorFactory = makeDecorator(NG_ENTITY, (obj: NgEntity) => obj);\r\n  return decoratorFactory(options);\r\n}","import { MetadataUtil } from '../../metadata/index';\r\nimport {\r\n  NG_FIELD, NG_OBJECT, NG_Dynamic, NG_LIST, NgFieldProperty, NgObjectProperty, NgListProperty\r\n} from './field_decorator';\r\nimport { ValidateRule } from '../validator/types';\r\n// import { Cacheable, DefaultCacheProvider } from '../../cache';\r\n\r\n/**\r\n * \r\n */\r\nexport class FieldMetadataUtil {\r\n  /**\r\n   * \r\n   * @param target \r\n   * @returns {[propName: string]: NgObjectProperty}\r\n   */\r\n  //@Cacheable({ key: ((context: any, args: any[]) => args[0]), provider: new DefaultCacheProvider() })\r\n  static getNgFields(target: any): { [propName: string]: NgFieldProperty } {\r\n    return MetadataUtil.getPropsMetadatasByName(target, NG_FIELD);\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  static getNgField(target: any, propName: string): NgFieldProperty {\r\n    const ngFields = this.getNgFields(target);\r\n    const ngField = ngFields[propName] as NgFieldProperty;\r\n    return ngField;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  static getDataField(target: any, propName: string) {\r\n    const ngField = this.getNgField(target, propName);\r\n    return ngField.dataField || propName;\r\n  }\r\n\r\n  /**\r\n   * NgObject\r\n   * @param target \r\n   * @returns {[propName: string]: NgObjectProperty}\r\n   */\r\n  //@Cacheable({ key: ((context: any, args: any[]) => args[0]), provider: new DefaultCacheProvider() })\r\n  static getNgObjects(target: any): { [propName: string]: NgObjectProperty } {\r\n    return MetadataUtil.getPropsMetadatasByName(target, NG_OBJECT);\r\n  }\r\n\r\n  static getNgDynamic(target: any): { [propName: string]: NgObjectProperty } {\r\n    return MetadataUtil.getPropsMetadatasByName(target, NG_Dynamic);\r\n  }\r\n\r\n  /**\r\n   * NgList\r\n   * @param target \r\n   * @returns {[propName: string]: NgListProperty}\r\n   */\r\n  //@Cacheable({ key: ((context: any, args: any[]) => args[0]), provider: new DefaultCacheProvider() })\r\n  static getNgList(target: any): { [propName: string]: NgListProperty } {\r\n    return MetadataUtil.getPropsMetadatasByName(target, NG_LIST);\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param target \r\n   */\r\n  //@Cacheable({ key: ((context: any, args: any[]) => args[0]), provider: new DefaultCacheProvider() })\r\n  static getPrimaryFieldMetadata(target: any): NgFieldProperty | undefined {\r\n    const ngFieldObj = FieldMetadataUtil.getNgFields(target);\r\n    const primaryKey = Object.keys(ngFieldObj).find((prop: string) => {\r\n      return ngFieldObj[prop].primary;\r\n    });\r\n\r\n    if (primaryKey) {\r\n      const propMeta = ngFieldObj[primaryKey];\r\n      propMeta.property = primaryKey;\r\n      if (!propMeta.dataField) {\r\n        propMeta.dataField = primaryKey;\r\n      }\r\n\r\n      return propMeta;\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  //@Cacheable({ key: ((context: any, args: any[]) => args[0]), provider: new DefaultCacheProvider() })\r\n  static getPrimaryKey(entityType: any) {\r\n    const primaryNgField = this.getPrimaryFieldMetadata(entityType);\r\n    if (!primaryNgField) {\r\n      return '';\r\n    }\r\n    return primaryNgField.property;\r\n  }\r\n\r\n  // static udtMap = {};\r\n\r\n  /**\r\n   * NgField \r\n   * @param target Type\r\n   */\r\n  //@Cacheable({ key: ((context: any, args: any[]) => args[0]), provider: new DefaultCacheProvider() })\r\n  static getValidationMetadata(target: any): { [key: string]: ValidateRule[] } {\r\n    const fieldMetadatas = FieldMetadataUtil.getNgFields(target);\r\n    // this.udtMap = Object.assign(this.udtMap || {}, FieldMetadataUtil.getNgObjects(target) || {});\r\n    // let udtParentName = '';\r\n    // Object.keys(this.udtMap).forEach(key => {\r\n    //   // udt\r\n    //   if (this.udtMap[key].type.name === target.name) {\r\n    //     // udt\r\n    //     udtParentName = key;\r\n    //   }\r\n    // });\r\n    const metadatas: { [key: string]: ValidateRule[] } = {};\r\n    // let primaryId = '';\r\n    // let udtPrimaryId = '';\r\n    // \r\n    // const excludeIDs = [];\r\n    // udt\r\n    // Object.keys(fieldMetadatas).forEach(key => {\r\n    //   if (fieldMetadatas[key].primary || fieldMetadatas[key].foreign) {\r\n    //     primaryId = fieldMetadatas[key].dataField;\r\n    //     udtPrimaryId = fieldMetadatas[key].dataField + '_ID';\r\n    //     excludeIDs.push(fieldMetadatas[key].dataField);\r\n    //   }\r\n    // });\r\n    Object.keys(fieldMetadatas).forEach(key => {\r\n      if (fieldMetadatas[key].primary || fieldMetadatas[key].foreign) {\r\n        return;\r\n      }\r\n      const validRules = fieldMetadatas[key].validRules;\r\n      // if (excludeIDs.indexOf(key) > -1) {\r\n      //   return;\r\n      // }\r\n      if (validRules && validRules.length) {\r\n        validRules.map(rule => {\r\n          rule.property = key;\r\n          rule['targetName'] = target.name;\r\n        });\r\n        metadatas[key] = validRules;\r\n      }\r\n    });\r\n    return metadatas;\r\n  }\r\n  //@Cacheable({ key: ((context: any, args: any[]) => args[0]), provider: new DefaultCacheProvider() })\r\n  static getValidationMetadataWithPath(object: any): { [key: string]: ValidateRule[] } {\r\n    const target = object.constructor;\r\n    const fieldMetadatas = FieldMetadataUtil.getNgFields(target);\r\n    const parentPaths = object.getPaths().path || [];\r\n    const metadatas: { [key: string]: ValidateRule[] } = {};\r\n\r\n    Object.keys(fieldMetadatas).forEach(key => {\r\n      if (fieldMetadatas[key].primary || fieldMetadatas[key].foreign) {\r\n        return;\r\n      }\r\n      const validRules = fieldMetadatas[key].validRules;\r\n\r\n      if (validRules && validRules.length) {\r\n        const propertyPath = parentPaths.concat([]);\r\n        propertyPath.push(key);\r\n        const property = propertyPath.join('.');\r\n        validRules.map(rule => {\r\n          rule.property = key;\r\n          rule['targetName'] = target.name;\r\n          rule['path'] = property;\r\n        });\r\n        metadatas[key] = validRules;\r\n      }\r\n    });\r\n    return metadatas;\r\n  }\r\n}\r\n","import { Type } from '@angular/core';\r\nimport { MetadataUtil } from '../../metadata/index';\r\nimport { Entity } from '../entity';\r\nimport { NgEntity, NG_ENTITY } from './entity_decorator';\r\n// import { NgProperty } from './ng_property';\r\n// import { NG_FIELD,   NgFieldProperty   } from './ng_field';\r\n// import { NG_OBJECT,  NgObjectProperty  } from './ng_object';\r\n// import { NG_Dynamic, NgDynamicProperty } from './ng_dynamic';\r\n// import { NG_LIST,    NgListProperty    } from './ng_list';\r\nimport {\r\n  NgProperty, NG_FIELD, NgFieldProperty, NG_OBJECT, NgObjectProperty,\r\n  NG_Dynamic, NgDynamicProperty, NG_LIST,    NgListProperty\r\n} from './field_decorator';\r\n\r\n/**\r\n * \r\n */\r\nexport class EntityMetadataUtil {\r\n\r\n  /**\r\n   * \r\n   * @todo\r\n   */\r\n  static getAllNgProperties(entityType: Type<Entity>): { [propName: string]: NgProperty } {\r\n    const ngPlainProperties = this.getNgFieldProperties(entityType);\r\n    const ngEntityProperties = this.getNgObjectProperties(entityType);\r\n    const ngDynamicProperties = this.getNgDynamicProperties(entityType);\r\n    const ngEntityListProperties = this.getNgObjectProperties(entityType);\r\n\r\n    return Object.assign({},\r\n      ngPlainProperties,   ngEntityProperties,\r\n      ngDynamicProperties, ngEntityListProperties\r\n    );\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  static getNgEntityMatadata(entityType: any): NgEntity{\r\n    return MetadataUtil.getClassMetadataByNameWithTranslate(entityType,NG_ENTITY);\r\n  }\r\n  /**\r\n   * NgField\r\n   */\r\n  static getNgFieldProperties(entityType: any): { [propName: string]: NgFieldProperty } {\r\n    return MetadataUtil.getPropsMetadatasByName(entityType, NG_FIELD);\r\n  }\r\n\r\n  /**\r\n   * NgObject\r\n   */\r\n  static getNgObjectProperties(entityType: any): { [propName: string]: NgObjectProperty } {\r\n    return MetadataUtil.getPropsMetadatasByName(entityType, NG_OBJECT);\r\n  }\r\n\r\n  /**\r\n   * NgDynamic\r\n   */\r\n  static getNgDynamicProperties(entityType: any): { [propName: string]: NgDynamicProperty } {\r\n    return MetadataUtil.getPropsMetadatasByName(entityType, NG_Dynamic);\r\n  }\r\n\r\n  /**\r\n   * NgList\r\n   */\r\n  static getNgListProperties(entityType: any): { [propName: string]: NgListProperty } {\r\n    return MetadataUtil.getPropsMetadatasByName(entityType, NG_LIST);\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  static getPrimaryKeyProperty(entityType: Type<Entity>): NgFieldProperty {\r\n    let primaryKeyProperty;\r\n    const ngPlainProperties = EntityMetadataUtil.getNgFieldProperties(entityType);\r\n    Object.keys(ngPlainProperties).forEach((propName: string) => {\r\n      const ngProperty = ngPlainProperties[propName] as NgFieldProperty;\r\n      if (ngProperty.primary === true) {\r\n        primaryKeyProperty = ngProperty;\r\n      }\r\n    });\r\n\r\n    return primaryKeyProperty;\r\n  }\r\n}\r\n","export const PARENT_PATH = '__PARENT_PATH__';\r\nexport const PARENT_CLASS = '__PARENT__';\r\n\r\nexport type ClassType<T = any> = new (...args: any[]) => T;\r\n\r\nexport interface Dynamic {\r\n  loadDynamicData(dynamicData: any): void;\r\n}\r\n","import { Entity } from './entity';\r\nimport { EntityTypeCreator } from './entity_type_creator';\r\n\r\nexport function EntityFactory<T extends Entity>(T: new (...args: any[]) => any, data: any): T {\r\n  // const entity = new T(data);\r\n  const entity: any = EntityTypeCreator.create(T, data);\r\n  return entity;\r\n}\r\nexport function DynamicFactory<T extends Entity>(T: new (...args: any[]) => any, data: any): T {\r\n  const entity = new T(data);\r\n  return entity;\r\n}\r\n","import { ModifyType } from \"../changeset\";\r\nimport { Entity } from \"./entity\";\r\nimport { DynamicFactory, EntityFactory } from \"./entity_factory\";\r\nimport { EntityList } from \"./entity_list\";\r\nimport { FieldMetadataUtil, NgDynamicProperty, NgFieldProperty, NgListProperty, NgObjectProperty } from \"./metadata\";\r\nimport { ClassType, PARENT_CLASS, PARENT_PATH } from \"./types\";\r\n\r\nexport class EntityTypeCreator {\r\n  private static buffer = new Map<any, any>();\r\n  public static create(constructor: Function, data: any): Entity {\r\n    const entityType = this.getType(constructor);\r\n    const entity = new entityType(data);\r\n    entity.constructor = constructor;\r\n    return entity;\r\n  }\r\n  // @Cache({ key: ((context: any, args: any[]) => { return args[0] }), provider: new MemoryCacheProvider() })\r\n  public static createType(constructor: Function): ClassType<Entity> {\r\n    const entityType = class EntityType extends Entity {\r\n      constructor(data: any) {\r\n        super(data);\r\n      }\r\n    };\r\n    const entityPrototype = entityType.prototype;\r\n    this.extendProperties(constructor, entityPrototype);\r\n    return entityType;\r\n  }\r\n  private static extendProperties(constructor: Function, entityPrototype: Entity) {\r\n    const ngFields = FieldMetadataUtil.getNgFields(constructor);\r\n    const ngObjects = FieldMetadataUtil.getNgObjects(constructor);\r\n    const ngLists = FieldMetadataUtil.getNgList(constructor);\r\n    const ngDynamic = FieldMetadataUtil.getNgDynamic(constructor);\r\n    this.extendPlainProperty(entityPrototype, ngFields);\r\n    this.extendListProperty(entityPrototype, ngLists);\r\n    this.extendObjectProperty(entityPrototype, ngObjects);\r\n    this.extendDynamicProperty(entityPrototype, ngDynamic);\r\n  }\r\n\r\n  private static extendPlainProperty(entityPrototype: Entity, ngFields: { [key: string]: NgFieldProperty }): void {\r\n    Object.keys(ngFields).forEach(function (propName) {\r\n      const ngField = ngFields[propName] as NgFieldProperty;\r\n      // const dataField = ngField.dataField || propName;\r\n      Object.defineProperty(entityPrototype, propName, {\r\n        get: function () {\r\n          const value = this.getPropValue(propName, ngField);\r\n          return value;\r\n        },\r\n        set: function (newPropValue) {\r\n          // \r\n          const oldPropValue = this.getPropValue(propName, ngField);\r\n          if (this.isPropValueChanged(propName, ngField, newPropValue, oldPropValue) === false) {\r\n            return;\r\n          }\r\n          this.setPropValue(propName, ngField, newPropValue);\r\n          const changeSetValue = this.preparePropValue(propName, ngField, newPropValue);\r\n          this.emitValueChange(propName, ngField, newPropValue, oldPropValue, changeSetValue);\r\n        }\r\n      });\r\n    });\r\n  }\r\n  private static extendListProperty(entityPrototype: Entity, ngListMetadata: { [key: string]: NgListProperty }): void {\r\n    Object.keys(ngListMetadata).forEach(function (propertyName) {\r\n      const key = `__${propertyName}__`;\r\n      Object.defineProperty(entityPrototype, propertyName, {\r\n        get: function () {\r\n          let entityList = this[key];\r\n          if (!entityList) {\r\n            const fieldMetadata = ngListMetadata[propertyName] as NgListProperty;\r\n            const path = this.createPath(propertyName);\r\n            const dataField = fieldMetadata.dataField || propertyName;\r\n            const val = this.data[dataField];\r\n            entityList = new EntityList<typeof fieldMetadata.type>();\r\n            entityList[PARENT_CLASS] = this;\r\n            entityList[PARENT_PATH] = path;\r\n            if (val) {\r\n              const entities = val.map(v => EntityFactory<typeof fieldMetadata.type>(fieldMetadata.type, v));\r\n              entityList.loadEntities(entities);\r\n            }\r\n            entityList.onListChanged.subscribe(value => {\r\n              if (value) {\r\n                if (entityList[PARENT_PATH][0] !== value.path[0]) {\r\n                  value.path = entityList[PARENT_PATH].concat(value.path);\r\n                }\r\n                this.setChanges(value);\r\n              }\r\n            });\r\n            this[key] = entityList;\r\n          }\r\n          return entityList;\r\n        },\r\n        set: function (value) {\r\n          this[key] = value;\r\n        }\r\n      });\r\n    });\r\n  }\r\n  private static extendObjectProperty(entityPrototype: Entity, ngObjectMetadata: { [key: string]: NgObjectProperty }) {\r\n    Object.keys(ngObjectMetadata).forEach(function (propertyName) {\r\n      const fieldMetadata = ngObjectMetadata[propertyName] as NgObjectProperty;\r\n      const key = `__${propertyName}__`;\r\n      // \r\n      Object.defineProperty(entityPrototype, propertyName, {\r\n        get: function () {\r\n          let childEntity = this[key];\r\n          const path = this.createPath(propertyName);\r\n          if (!childEntity) {\r\n            const dataField = fieldMetadata.dataField || propertyName;\r\n            // val\r\n            const val = this.data[dataField] || {};\r\n            childEntity = EntityTypeCreator.buildEntity(path, val, this, fieldMetadata);\r\n            this[key] = childEntity;\r\n          }\r\n          return childEntity;\r\n        },\r\n        set: function (value: any) {\r\n          const path = this.createPath(propertyName);\r\n          const modifyInfo = {\r\n            path: path,\r\n            value: value.data,\r\n            preValue: this[propertyName].data,\r\n            type: ModifyType.ValueChange\r\n          };\r\n          const childEntity = EntityTypeCreator.buildEntity(path, value, this, fieldMetadata);\r\n          this[key] = childEntity;\r\n          this.setChanges(modifyInfo);\r\n        }\r\n      });\r\n    });\r\n  }\r\n  private static extendDynamicProperty(entityPrototype: Entity, ngDynamicMetadata: { [key: string]: NgDynamicProperty }) {\r\n    Object.keys(ngDynamicMetadata).forEach(function (propertyName) {\r\n      const fieldMetadata = ngDynamicMetadata[propertyName] as NgDynamicProperty;\r\n      const key = `__${propertyName}__`;\r\n      \r\n      Object.defineProperty(entityPrototype, propertyName, {\r\n        get: function () {\r\n          let dynamicEntity = this[key];\r\n          const path = this.createPath(propertyName);\r\n          if (!dynamicEntity) {\r\n            const dataField = fieldMetadata.dataField || propertyName;\r\n            const originalData = this.data[dataField] || {};\r\n            dynamicEntity = EntityTypeCreator.buildDynamic(path, originalData, this, fieldMetadata);\r\n            this[key] = dynamicEntity;\r\n          }\r\n          return dynamicEntity;\r\n        },\r\n        set: function (value) {\r\n          const path = this.createPath(propertyName);\r\n          const modifyInfo = {\r\n            path: path,\r\n            value: value.data,\r\n            preValue: this[propertyName].data,\r\n            type: ModifyType.ValueChange\r\n          };\r\n          let dynamicEntity = EntityTypeCreator.buildDynamic(path, value, this, fieldMetadata);\r\n          this[key] = dynamicEntity;\r\n          this.setChanges(modifyInfo);\r\n        }\r\n      });\r\n    });\r\n  }\r\n  private static getType(constructor: Function) {\r\n    if (this.buffer.has(constructor)) {\r\n      return this.buffer.get(constructor);\r\n    }\r\n    const entityType = this.createType(constructor);\r\n    this.buffer.set(constructor, entityType);\r\n    return entityType;\r\n  }\r\n  private static buildEntity(parentPath: string[], value: any, parent: any, fieldMetadata: NgObjectProperty | NgDynamicProperty) {\r\n    let instance;\r\n    if (value instanceof fieldMetadata.type) {\r\n      instance = value;\r\n    } else {\r\n      instance = EntityFactory(fieldMetadata.type, value);\r\n    }\r\n    instance[PARENT_CLASS] = parent;\r\n    instance[PARENT_PATH] = parentPath;\r\n    instance.onValueChanged.subscribe(changes => {\r\n      if (changes) {\r\n        changes.path = (parent[PARENT_PATH] || []).concat(changes.path);\r\n        parent.setChanges(changes);\r\n      }\r\n    });\r\n    return instance;\r\n  }\r\n  private static buildDynamic(parentPath: string[], value: any, parent: any, fieldMetadata: NgObjectProperty | NgDynamicProperty) {\r\n    let instance;\r\n    if (value instanceof fieldMetadata.type) {\r\n      instance = value;\r\n    } else {\r\n      instance = DynamicFactory(fieldMetadata.type, value);\r\n    }\r\n    instance[PARENT_CLASS] = parent;\r\n    instance[PARENT_PATH] = parentPath;\r\n    instance.onValueChanged.subscribe(changes => {\r\n      if (changes) {\r\n        changes.path = (parent[PARENT_PATH] || []).concat(changes.path);\r\n        parent.setChanges(changes);\r\n      }\r\n    });\r\n    return instance;\r\n  }\r\n}","import { Type } from '@angular/core';\r\nimport { Entity } from './entity';\r\nimport { EntityTypeCreator } from './entity_type_creator';\r\n\r\n/**\r\n * \r\n * @param entityType \r\n * @param entityData \r\n */\r\nexport function createEntity<T extends Entity>(entityType: Type<any>, entityData: any): T {\r\n  let entity: any;\r\n  if (entityType && entityType.prototype && entityType.prototype.typeName === 'ConcreteEntityPrototype') {\r\n    entity = new entityType(entityData);\r\n  } else {\r\n    entity = EntityTypeCreator.create(entityType, entityData);//new entityType(entityData); \r\n  }\r\n  entity.constructor = entityType;\r\n  return entity;\r\n}\r\n\r\n/**\r\n * \r\n * @param entityType     \r\n * @param entityListData \r\n */\r\nexport function createEntities<T extends Entity>(entityType: Type<any>, entityListData: any): T[] {\r\n  const entities: T[] = [];\r\n  entityListData.forEach((entityData: any) => {\r\n    const entity = createEntity<T>(entityType, entityData);\r\n    entities.push(entity);\r\n  });\r\n  return entities;\r\n}\r\n\r\n/**\r\n * createEntity\r\n */\r\nexport function EntityFactory<T extends Entity>(T: new (...args: any[]) => any, data: any): T {\r\n  const entity = new T(data);\r\n  return entity;\r\n}\r\n\r\n\r\n\r\n","const validationMessage = {};\r\n\r\n/**\r\n * \r\n */\r\nexport class ValidationTypes {\r\n  static CURRENT_LANGUAGE = 'zh-CNS';\r\n\r\n  /**\r\n   * \r\n   */\r\n  static CUSTOM_VALIDATION = `customValidation`;\r\n\r\n  /**\r\n   * \r\n   */\r\n  static REQUIRED = 'required';\r\n\r\n  /**\r\n   * \r\n   */\r\n  static EQUALS = 'equals';\r\n\r\n  /**\r\n   * \r\n   */\r\n  static NOT_EQUALS = 'notEquals';\r\n\r\n  /**\r\n   * \r\n   */\r\n  static IS_NUMBER = 'isNumber';\r\n\r\n  /**\r\n   * \r\n   */\r\n  static IS_INT = 'isInt';\r\n\r\n  /**\r\n   * \r\n   */\r\n  static IS_FLOAT = 'isFloat';\r\n\r\n  /**\r\n   * \r\n   */\r\n  static IS_STRING = 'isString';\r\n\r\n  /**\r\n   * \r\n   */\r\n  static IS_BOOLEAN = 'isBoolean';\r\n\r\n  /**\r\n   * \r\n   */\r\n  static IS_DATE = 'isDate';\r\n\r\n  /**\r\n   * \r\n   */\r\n  static IS_DATE_STRING = 'isDateString';\r\n\r\n  /**\r\n   * \r\n   */\r\n  static IS_BOOLEAN_STRING = 'isBooleanString';\r\n\r\n  /**\r\n   * \r\n   */\r\n  static IS_NUMBER_STRING = 'isNumberString';\r\n\r\n  /**\r\n   * \r\n   */\r\n  static IS_EMAIL = 'isEmail';\r\n\r\n  /**\r\n   * JSON\r\n   */\r\n  static IS_JSON = 'isJSON';\r\n\r\n  /**\r\n   * \r\n   */\r\n  static IS_LOWERCASE = 'isLowercase';\r\n\r\n  /**\r\n   * \r\n   */\r\n  static IS_UPPERCASE = 'isUppercase';\r\n\r\n  /**\r\n   * \r\n   */\r\n  static RANGE = 'range';\r\n\r\n  /**\r\n   * \r\n   */\r\n  static MIN = 'min';\r\n\r\n  /**\r\n   * \r\n   */\r\n  static MINVALUE = 'minValue';\r\n\r\n  /**\r\n   * \r\n   */\r\n  static MAX = 'max';\r\n\r\n  /**\r\n   * \r\n   */\r\n  static MAXVALUE = 'maxValue';\r\n\r\n  /**\r\n   * \r\n   */\r\n  static LENGTH = 'length';\r\n\r\n  /**\r\n   * \r\n   */\r\n  static MAX_LENGTH = 'maxLength';\r\n\r\n  /**\r\n   * \r\n   */\r\n  static MIN_LENGTH = 'minLength';\r\n\r\n  /**\r\n   * \r\n   */\r\n  static MIN_DATE = 'minDate';\r\n\r\n  /**\r\n   * \r\n   */\r\n  static MAX_DATE = 'maxDate';\r\n\r\n  /**\r\n   * \r\n   */\r\n  static EXCLUDE = 'exclude';\r\n\r\n  /**\r\n   * \r\n   */\r\n  static MATCHES = 'matches';\r\n\r\n  static FIELD_CONTAINER = 'fieldContainer';\r\n  /**\r\n   * \r\n   * @param type \r\n   */\r\n  static isValidType(type: string): boolean {\r\n    return (\r\n      type !== `isValidType` &&\r\n      type !== 'getMessage' &&\r\n      Object.keys(this)\r\n        .map(key => (this as any)[key])\r\n        .indexOf(type) !== -1\r\n    );\r\n  }\r\n  /**\r\n   * \r\n   * @param type \r\n   * @returns \r\n   */\r\n  static getMessage(type: string): string {\r\n    const messages = validationMessage[this.CURRENT_LANGUAGE] || validationMessage['zh-CHS'];\r\n    return messages[type] || '';\r\n  }\r\n\r\n  static setCurrentLanguage(language: string) {\r\n    this.CURRENT_LANGUAGE = language;\r\n  }\r\n}\r\n\r\nvalidationMessage['zh-CHS'] = {\r\n  fieldContainer: `$target  $value `,\r\n  required: `'$property'`,\r\n  equals: `'$property'$constraint1`,\r\n  notEquals: `'$property''$constraint1'`,\r\n  isNumber: `'$property'`,\r\n  isInt: `'$property'`,\r\n  isFloat: `'$property'`,\r\n  isBoolean: `'$property'`,\r\n  isDate: `'$property'`,\r\n  isEmail: ``,\r\n  min: `'$property'$constraint1`,\r\n  minValue: `'$property'$constraint1`,\r\n  minDate: `'$property'$constraint1`,\r\n  max: `'$property'$constraint1`,\r\n  maxValue: `'$property'$constraint1`,\r\n  maxDate: `'$property'$constraint1`,\r\n  isBooleanString: `'$property'`,\r\n  isDateString: `'$property'`,\r\n  isLowercase: `'$property'`,\r\n  isUppercase: `'$property'`,\r\n  length: `'$property'$constraint1~$constraint2`,\r\n  range: `'$property'$constraint1~$constraint2`,\r\n  maxLength: `'$property'$constraint1`,\r\n  minLength: `'$property'$constraint1`,\r\n  isNumberString: `'$property'`,\r\n  exclude: `'$property'$constraint1`,\r\n  matches: `'$property'`\r\n};\r\nvalidationMessage['en'] = {\r\n  fieldContainer: `$target row $value`,\r\n  required: `Please input '$property'`,\r\n  equals: `'$property' should equals '$constraint1'`,\r\n  notEquals: `'$property' should not equals '$constraint1'`,\r\n  isNumber: `'$property' should be number`,\r\n  isInt: `'$property' should be integer`,\r\n  isFloat: `'$property' should be float`,\r\n  isBoolean: `'$property' should be boolean`,\r\n  isDate: `'$property' should be date`,\r\n  isEmail: `'$property' should be e-mail address`,\r\n  min: `'$property' should not less than $constraint1`,\r\n  minValue: `'$property' should not less than $constraint1`,\r\n  minDate: `'$property' should not early than $constraint1`,\r\n  max: `'$property' should not bigger than $constraint1`,\r\n  maxValue: `'$property' should not bigger than $constraint1`,\r\n  maxDate: `'$property' should not late than $constraint1`,\r\n  isBooleanString: `'$property' should be boolean string`,\r\n  isDateString: `'$property' should be date string`,\r\n  isLowercase: `'$property' should be lowercase charactor`,\r\n  isUppercase: `'$property' should be uppercase charactor`,\r\n  length: `'$property' length should between $constraint1~$constraint2`,\r\n  range: `'$property' value should between $constraint1~$constraint2`,\r\n  maxLength: `'$property' should not longer than $constraint1`,\r\n  minLength: `'$property' should not shorter than $constraint1`,\r\n  isNumberString: `'$property' should be number string`,\r\n  exclude: `'$property' should not include $constraint1`,\r\n  matches: `'$property' calibration failed`\r\n};\r\nvalidationMessage['zh-CHT'] = {\r\n  fieldContainer: `$target  $value `,\r\n  required: `'$property'`,\r\n  equals: `'$property'$constraint1`,\r\n  notEquals: `'$property''$constraint1'`,\r\n  isNumber: `'$property'`,\r\n  isInt: `'$property'`,\r\n  isFloat: `'$property'`,\r\n  isBoolean: `'$property'`,\r\n  isDate: `'$property'`,\r\n  isEmail: ``,\r\n  min: `'$property'$constraint1`,\r\n  minValue: `'$property'$constraint1`,\r\n  minDate: `'$property'$constraint1`,\r\n  max: `'$property'$constraint1`,\r\n  maxValue: `'$property'$constraint1`,\r\n  maxDate: `'$property'$constraint1`,\r\n  isBooleanString: `'$property'`,\r\n  isDateString: `'$property'`,\r\n  isLowercase: `'$property'`,\r\n  isUppercase: `'$property'`,\r\n  length: `'$property'$constraint1~$constraint2`,\r\n  range: `'$property'$constraint1~$constraint2`,\r\n  maxLength: `'$property'$constraint1`,\r\n  minLength: `'$property'$constraint1`,\r\n  isNumberString: `'$property'`,\r\n  exclude: `'$property'$constraint1`,\r\n  matches: `'$property'`\r\n};\r\n","import { FrameContext } from \"../../frame/index\";\r\n\r\n/**\r\n * \r\n */\r\nexport class ValidationError {\r\n  /**\r\n   * \r\n   */\r\n  target?: any;\r\n\r\n  /**\r\n   * \r\n   */\r\n  property: string;\r\n\r\n  /**\r\n   * \r\n   */\r\n  propertyName?: string;\r\n  /**\r\n   * \r\n   */\r\n  value?: any;\r\n\r\n  /**\r\n   * \r\n   * @summary {[formType-]: string -  }\r\n   */\r\n  constraints: { [type: string]: string; };\r\n\r\n  /**\r\n   * \r\n   */\r\n  children: ValidationError[];\r\n\r\n  /**\r\n   * \r\n   */\r\n  isArray = false;\r\n\r\n  /**\r\n   * \r\n   */\r\n  index = undefined;\r\n\r\n  /**\r\n   * \r\n   */\r\n  field: string;\r\n  /**\r\n   * \r\n   */\r\n  rule: any;\r\n  /**\r\n   * \r\n   */\r\n  binding?: string;\r\n  frameContext?: FrameContext;\r\n  /**\r\n   * \r\n   */\r\n  fullPath?: string;\r\n}\r\n","// tslint:disable: max-line-length\r\nimport { Validator } from './validator';\r\nimport { ValidateRule } from './types';\r\nimport { ValidationError } from './validation_error';\r\nimport { Entity } from '../entity';\r\nimport { ValidationTypes } from './validation_types';\r\nimport { EntityList } from '../entity_list';\r\nimport { FieldMetadataUtil, NgFieldProperty } from '../metadata/index';\r\nimport { DateUtil } from '../../utils/date_util';\r\nimport { FrameContext } from '../../frame/index';\r\n\r\n/**\r\n * \r\n */\r\nexport class ValidationExecutor<T extends Entity> {\r\n\r\n  constructor(private validator: Validator<T>) { }\r\n\r\n  /**  */\r\n  awaitingPromises: Promise<any>[] = [];\r\n  /**\r\n   * \r\n   * @param message \r\n   * @param metadata \r\n   * @param value \r\n   */\r\n  public static replaceMessageSpecialTokens(message: any, metadata: ValidateRule, value: any) {\r\n    let messageString: string;\r\n    if (message instanceof Function) {\r\n      messageString = (message as (args: ValidateRule) => string)(metadata);\r\n    } else if (typeof message === 'string') {\r\n      messageString = message as string;\r\n    }\r\n\r\n    if (messageString && metadata.constraints instanceof Array) {\r\n      metadata.constraints.forEach((constraint, index) => {\r\n        messageString = messageString.replace(new RegExp(`\\\\$constraint${index + 1}`, 'g'), constraint);\r\n      });\r\n    }\r\n\r\n    if (messageString && value !== undefined && value !== null) {\r\n      messageString = messageString.replace(/\\$value/g, value);\r\n    }\r\n\r\n    if (messageString) {\r\n      messageString = messageString.replace(/\\$property/g, metadata.property);\r\n    }\r\n\r\n    if (messageString) {\r\n      messageString = messageString.replace(/\\$target/g, metadata.targetName);\r\n    }\r\n\r\n    return messageString;\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param object \r\n   * @param newValue \r\n   * @param validationErrors \r\n   * @param propertyName \r\n   * @param index \r\n   */\r\n  execute(object: T, newValue, validationErrors: ValidationError[], propertyName?: string, index?: any, externalRules?: Map<string, ValidateRule[]>, currentRowId?: string, frameContext?: FrameContext) {\r\n    // if (!currentRowId) {\r\n    //   currentRowId = object.primaryValue;\r\n    // }\r\n    if (!externalRules && frameContext) {\r\n      externalRules = frameContext.form.getValidationRules();\r\n    }\r\n    // \r\n    // {key:[rule1,rule2]}\r\n    let validateMetadatas = FieldMetadataUtil.getValidationMetadataWithPath(object);\r\n    const remainedExternalRules = new Map<string, ValidateRule[]>();\r\n\r\n    // \r\n    if (externalRules) {\r\n      // const parentPathArray: string[] = object['__PARENT_PATH__'] ? [...object['__PARENT_PATH__']] : [''];\r\n      // if (parentPathArray.length > 1) {\r\n      //   parentPathArray[0] = '';\r\n      // }\r\n      const parentPathArray = [];\r\n      let objectCursor = object;\r\n      while (objectCursor && objectCursor !== objectCursor['__PARENT__']) {\r\n        const cursorParentPath = objectCursor['__PARENT_PATH__'] ? objectCursor['__PARENT_PATH__'][1] : '';\r\n        // if (parentPathArray[parentPathArray.length - 1] !== cursorParentPath) {\r\n        parentPathArray.push(cursorParentPath);\r\n        // }\r\n        objectCursor = objectCursor['__PARENT__'];\r\n        if (objectCursor instanceof EntityList) {\r\n          objectCursor = objectCursor['__PARENT__'];\r\n        }\r\n      }\r\n      const parentPath = parentPathArray.reverse().join('/');\r\n\r\n      externalRules.forEach((rules, path) => {\r\n        if (path) {\r\n          // \r\n          const pathArray = path.split('/');\r\n          // \r\n          const fieldName = pathArray.pop();\r\n          // \r\n          const fieldParentPath = pathArray.join('/');\r\n          // \r\n          if (parentPath === fieldParentPath) {\r\n            validateMetadatas[fieldName] = [...(validateMetadatas[fieldName] || [])];\r\n            // \r\n            if (rules.length) {\r\n              let targetId = '';\r\n              rules.forEach(rule => {\r\n                if (rule.targetId && rule.targetId.length > targetId.length) {\r\n                  targetId = rule.targetId;\r\n                }\r\n                validateMetadatas[fieldName].push(rule);\r\n              });\r\n              validateMetadatas[fieldName].forEach((validateRule: ValidateRule) => {\r\n                validateRule.targetId = targetId;\r\n                validateRule.targetName = rules[0].targetName;\r\n                validateRule.property = rules[0].property;\r\n                if (rules[0].frameContext) {\r\n                  validateRule.frameContext = rules[0].frameContext;\r\n                }\r\n                validateRule.fullPath = rules[0].fullPath;\r\n                validateRule['initialized'] = true;\r\n              });\r\n            }\r\n          } else {\r\n            remainedExternalRules.set(path, rules);\r\n          }\r\n        }\r\n      });\r\n    }\r\n    // \r\n    // form\r\n    if (validateMetadatas && Object.keys(validateMetadatas).length > 0) {\r\n      Object.keys(validateMetadatas).forEach((fieldName: string) => {\r\n        const validateRules = validateMetadatas[fieldName];\r\n        if (validateRules && validateRules.length > 0) {\r\n          const firstValidateRule = validateRules[0];\r\n          const path = firstValidateRule['path'];\r\n          if (path) {\r\n            validateRules.forEach((validateRule: ValidateRule) => {\r\n              // initialized\r\n              if (validateRule['initialized'] !== true) {\r\n                const bindingPaths = path.split('.');\r\n                const form = this.getForm(bindingPaths, frameContext);\r\n                const formControl = this.getFormControl(bindingPaths, frameContext);\r\n                if (formControl) {\r\n                  validateRule.targetId = formControl.id;\r\n                  validateRule.targetName = form && form.formGroupName;\r\n                  validateRule.property = formControl.name || formControl.defaultI18nValue || '';\r\n                }\r\n              }\r\n            });\r\n          }\r\n        }\r\n      });\r\n    }\r\n    // \r\n    if (propertyName) {\r\n      validateMetadatas = Object.keys(validateMetadatas)\r\n        .filter(key => key === propertyName)\r\n        .reduce((val, curr) => Object.assign({}, val, { [curr]: validateMetadatas[curr] }), {});\r\n    }\r\n    // validateMetadatas = {rule:}\r\n    Object.keys(validateMetadatas).filter((key: string) =>\r\n      object && (\r\n        object.hasOwnProperty(key) ||\r\n        (\r\n          object.constructor.prototype &&\r\n          object.constructor.prototype.typeName &&\r\n          object.constructor.prototype.hasOwnProperty(key)\r\n        ) ||\r\n        object['__proto__'].hasOwnProperty(key)\r\n      )\r\n    ).forEach(key => {\r\n      // todo: valueundefined\r\n      let value = newValue;\r\n      if (newValue === undefined) {\r\n        value = (object as any)[key];\r\n      }\r\n      let isMultLanguageField = false;\r\n      const multiLangFields = this.getMultiLanguageFields(object);\r\n      if (multiLangFields && multiLangFields.length > 0) {\r\n        if (multiLangFields.includes(key)) {\r\n          isMultLanguageField = true;\r\n        }\r\n      }\r\n      // const value = newValue || \r\n      const validateRules: ValidateRule[] = validateMetadatas[key];\r\n      if (validateRules.length) {\r\n        const { property: fieldName, targetId: field, frameContext, fullPath } = validateRules[0];\r\n        // const fieldContainerName = Number.isInteger(index) ?\r\n        // `${validateRules[0].targetName} ${index + 1}` : validateRules[0].targetName;\r\n        const fieldContainerName = Number.isInteger(index) ?\r\n          ValidationExecutor.replaceMessageSpecialTokens(\r\n            ValidationTypes.getMessage(ValidationTypes.FIELD_CONTAINER),\r\n            validateRules[0], index + 1\r\n          ) : validateRules[0].targetName;\r\n        const validationDisplayName = fieldContainerName ? `${fieldContainerName} - ${fieldName}` : `${fieldName}`;\r\n        // const property = validateRules['path'] || key;\r\n        const validationError = this.generateValidationError(object, value, key, validationDisplayName, index, field, frameContext, fullPath);\r\n        if (index !== undefined) {\r\n          validationError['index'] = index;\r\n        }\r\n        validationErrors.push(validationError);\r\n        this.defaultValidations(object, value, validateRules, validationError, isMultLanguageField, currentRowId);\r\n      }\r\n    });\r\n\r\n    this.objectValidations(object, validationErrors, propertyName, index, remainedExternalRules, currentRowId, frameContext);\r\n\r\n    this.listValidations(object, validationErrors, propertyName, index, remainedExternalRules, frameContext);\r\n    // this.sortValidationErrors(validationErrors);\r\n\r\n    // todo ngObject\r\n    // if (!propertyName) {\r\n    //     this.objectValidations(object, validationErrors);\r\n    // }\r\n  }\r\n\r\n\r\n\r\n  private getMultiLanguageFields(entity: any) {\r\n    if (entity && entity.constructor) {\r\n      const ngFields = FieldMetadataUtil.getNgFields(entity.constructor);\r\n      return Object.keys(ngFields).filter((fieldName: string) => ngFields[fieldName].enableMultiLangInput);\r\n    }\r\n    return null;\r\n  }\r\n  /**\r\n   * \r\n   * @param errors \r\n   */\r\n  stripEmptyErrors(errors: ValidationError[]) {\r\n    return errors.filter(error => {\r\n      if (error.children) {\r\n        error.children = this.stripEmptyErrors(error.children);\r\n      }\r\n\r\n      if (Object.keys(error.constraints).length === 0) {\r\n        if (error.children.length === 0) {\r\n          return false;\r\n        } else {\r\n          delete error.constraints;\r\n        }\r\n      }\r\n\r\n      return true;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param object \r\n   * @param value \r\n   * @param propertyName \r\n   * @param index \r\n   * @param field \r\n   */\r\n  private generateValidationError(object: any, value: any, property: string, propertyName?: string, index?: number, field?: string, frameContext?: FrameContext, fullPath?: string) {\r\n    const validationError = new ValidationError();\r\n\r\n    validationError.target = object;\r\n    validationError.value = value;\r\n\r\n    validationError.property = property;\r\n    validationError.propertyName = propertyName;\r\n    validationError.field = field;\r\n    validationError.index = index;\r\n    validationError.children = [];\r\n    validationError.constraints = {};\r\n    if (frameContext) {\r\n      validationError.frameContext = frameContext;\r\n    }\r\n    validationError.fullPath = fullPath;\r\n    return validationError;\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param object \r\n   * @param value \r\n   * @param validateRules \r\n   * @param errorMap {[key]: message}\r\n   *\r\n   * key: \r\n   * message: \r\n   */\r\n  private defaultValidations(object: T, value: any, validateRules: ValidateRule[], validationError: ValidationError, isMultLanguageField?: boolean, currentRowId?: string) {\r\n    const errorMap = validationError.constraints;\r\n    return validateRules\r\n      .filter(validateRule => {\r\n        // \r\n        const validValue = this.validator.validateValueByMetadata(object, value, validateRule, isMultLanguageField, currentRowId);\r\n        if (validValue instanceof Promise) {\r\n          const promise = validValue.then(isValid => {\r\n            if (!isValid) {\r\n              const { type, messageString: message } = this.createValidationError(object, value, validateRule);\r\n              errorMap[type] = message;\r\n              validationError.rule = validateRule;\r\n            }\r\n          });\r\n          this.awaitingPromises.push(promise);\r\n        }\r\n        return !validValue;\r\n      })\r\n      .forEach(validateRule => {\r\n        // \r\n        const { type: key, messageString: message } = this.createValidationError(object, value, validateRule);\r\n        errorMap[key] = message;\r\n        validationError.rule = validateRule;\r\n      });\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param object \r\n   * @param errors \r\n   * @param property \r\n   * @param parentIndex \r\n   */\r\n  private listValidations(\r\n    object: any,\r\n    errors: ValidationError[],\r\n    property?: string,\r\n    parentIndex?: any,\r\n    externalRules?: Map<string, ValidateRule[]>,\r\n    frameContext?: FrameContext\r\n  ) {\r\n    const INDEX_LABEL = \"__ACTUAL_INDEX__\";\r\n    const listFields = FieldMetadataUtil.getNgList(object.constructor);\r\n    if (!listFields) {\r\n      return;\r\n    }\r\n    let keys = Object.keys(listFields);\r\n    if (property) {\r\n      keys = keys.filter(key => key === property);\r\n    }\r\n    keys.forEach(propertyName => {\r\n      const metadata = listFields[propertyName];\r\n      const clzType = metadata.type;\r\n      const value = object[propertyName] as EntityList<T>;\r\n      if (value) {\r\n        const parentPaths = object.getPaths().path || [];\r\n        parentPaths.push(propertyName);\r\n        const validationError = this.generateValidationError(object, value.items, parentPaths.join('.'), propertyName, parentIndex);\r\n        validationError.isArray = true;\r\n        errors.push(validationError);\r\n        value.items.forEach((entity, index) => {\r\n          let actualIndex = entity[INDEX_LABEL] ? entity[INDEX_LABEL] : index;\r\n          this.execute(entity, undefined, validationError.children, undefined, actualIndex, externalRules, entity.primaryValue, frameContext);\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param object \r\n   * @param errors \r\n   */\r\n  private objectValidations(object: T, errors: ValidationError[], property?: string, parentIndex?: any, externalRules?: Map<string, ValidateRule[]>, currentRowId?: string, frameContext?: FrameContext) {\r\n    const objectFields = FieldMetadataUtil.getNgObjects(object.constructor);\r\n    if (!objectFields || Object.keys(objectFields).length < 1) {\r\n      return;\r\n    }\r\n\r\n    let keys = Object.keys(objectFields);\r\n    if (property) {\r\n      keys = keys.filter(key => key === property);\r\n    }\r\n    keys.forEach(propertyName => {\r\n      const metadata = objectFields[propertyName];\r\n      const objectType = metadata.type;\r\n      const value = object[propertyName];\r\n      if (value) {\r\n        this.execute(value, undefined, errors, undefined, parentIndex, externalRules, currentRowId, frameContext);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param object \r\n   * @param value \r\n   * @param metadata \r\n   */\r\n  private createValidationError(object: T, value: any, metadata: ValidateRule) {\r\n    const targetName = object.constructor ? (object.constructor as any).name : undefined;\r\n    const type = metadata.type;\r\n    let message = metadata.message;\r\n\r\n    if (!message) {\r\n      message = ValidationTypes.getMessage(type);\r\n    }\r\n\r\n    if (ValidationTypes.isValidType(type) && (type === ValidationTypes.MAXVALUE || type === ValidationTypes.MINVALUE)) {\r\n      if (this.isDateString(value) && metadata.constraints && metadata.constraints.length) {\r\n        // \r\n        const extType = type === ValidationTypes.MINVALUE ? ValidationTypes.MIN_DATE : ValidationTypes.MAX_DATE;\r\n        message = ValidationTypes.getMessage(extType);\r\n        /*if (metadata.constraints[0]) {\r\n          metadata.constraints[0] = DateUtil.format(metadata.constraints[0], 'yyyy-MM-dd HH:mm:ss');\r\n        }*/\r\n      }\r\n    }\r\n\r\n    const messageString = ValidationExecutor.replaceMessageSpecialTokens(message, metadata, value);\r\n    return { type, messageString, metadata };\r\n  }\r\n  private getFrameContext(bindingPaths: string[], eventFrameContext?: FrameContext) {\r\n    if (!bindingPaths || bindingPaths.length < 1 || !eventFrameContext) {\r\n      return null;\r\n    }\r\n    const paths = bindingPaths.concat([]);\r\n    paths.pop();\r\n    const bindingPath = paths.join('/');\r\n    const frameContext = eventFrameContext.appContext.frameContextManager.getFrameContexts().find((context: FrameContext) => context && context.viewModel && context.viewModel.bindingPath && context.viewModel.bindingPath.split('/').filter(p => p).join('/') === bindingPath);\r\n    return frameContext || null;\r\n  }\r\n  private getForm(bindingPaths: string[], eventFrameContext?: FrameContext) {\r\n    if (!bindingPaths || bindingPaths.length < 1 || !eventFrameContext) {\r\n      return null;\r\n    }\r\n    const frameContext = this.getFrameContext(bindingPaths, eventFrameContext);\r\n    return frameContext && frameContext.form || null;\r\n  }\r\n  private getFormControl(bindingPaths: string[], eventFrameContext?: FrameContext) {\r\n    if (!bindingPaths || bindingPaths.length < 1 || !eventFrameContext) {\r\n      return null;\r\n    }\r\n    const paths = bindingPaths.concat([]);\r\n    const propertyName = paths.pop();\r\n    const frameContext = this.getFrameContext(bindingPaths, eventFrameContext);\r\n    const formControl = frameContext && frameContext.form && frameContext.form.ngFormControls && frameContext.form.ngFormControls[propertyName] || null;\r\n    return formControl;\r\n  }\r\n  isDateString(value: any): boolean {\r\n    const regex = /\\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])(T|\\s?)?(([0-2]\\d:[0-5]\\d)?(:[0-5]\\d(?:\\.\\d+)))?(?:Z|\\+[0-2]\\d(?:\\:[0-5]\\d)?)?/g;\r\n    return regex.test(value);\r\n  }\r\n}\r\n","import { ValidationError } from './validation_error';\r\nimport { ValidationResult } from './types';\r\n/**\r\n * \r\n */\r\nexport class ValidationUtils {\r\n\r\n  /**\r\n   * \r\n   * @param errors \r\n   * @param messages \r\n   * @param parentPath \r\n   */\r\n  static createDetailedErrorMessage(\r\n    errors: ValidationError[],\r\n    messages: string[] = [],\r\n    parentPath: string = ''\r\n  ): string[] {\r\n    errors.forEach(error => {\r\n      const targetName = error.target ? error.target.constructor.name : '';\r\n      const property = error.propertyName;\r\n\r\n      const propConstraintFailed = (propertyName: string): string =>\r\n        `   -  ${parentPath}${propertyName} :  \\n` +\r\n        `${Object.keys(error.constraints)\r\n          .map(ruleName => {\r\n            return `        #${ruleName}: ${error.constraints[ruleName]}\\n`;\r\n          })\r\n          .join('')}`;\r\n\r\n      if (!parentPath) {\r\n        messages.push(` ${targetName} \\n`);\r\n\r\n        if (error.constraints) {\r\n          messages.push(propConstraintFailed(property));\r\n        }\r\n\r\n        if (error.children.length) {\r\n          ValidationUtils.createDetailedErrorMessage(error.children, messages, property);\r\n        }\r\n      } else {\r\n        const formattedProperty = Number.isInteger(+error.index)\r\n          ? `[${error.index}].${property}`\r\n          : `${parentPath ? `.` : ``}${property}`;\r\n        if (error.constraints) {\r\n          messages.push(propConstraintFailed(formattedProperty));\r\n        }\r\n        if (error.children.length) {\r\n          ValidationUtils.createDetailedErrorMessage(error.children, messages, `${parentPath}${formattedProperty}`);\r\n        }\r\n      }\r\n    });\r\n\r\n    return messages;\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param errors \r\n   * @param errObj :\r\n   * ```\r\n   * { name: { required: '', max: '99' },\r\n   *   list: {\r\n   *      0: { name:{required: ''},\r\n   *           age: { min: ' 20' }\r\n   *         },\r\n   *      2: { ... }\r\n   *   }\r\n   * }\r\n   *\r\n   * ```\r\n   */\r\n  static convertErrorsToNormalObject(errors: ValidationError[], errObj: {}): {} {\r\n    errors.forEach(err => {\r\n      const property = err.propertyName;\r\n\r\n      const buildArray = (childErrors: ValidationError[]) => {\r\n        const itemErr = {};\r\n        childErrors.forEach((childErr: ValidationError) => {\r\n          if (childErr.children.length) {\r\n            itemErr[childErr.index] = ValidationUtils.convertErrorsToNormalObject(childErr.children, childErr);\r\n          } else {\r\n            if (itemErr[childErr.index]) {\r\n              itemErr[childErr.index] = Object.assign({}, itemErr[childErr.index], {\r\n                [childErr.propertyName]: childErr.constraints\r\n              });\r\n            } else {\r\n              itemErr[childErr.index] = { [childErr.propertyName]: childErr.constraints };\r\n            }\r\n          }\r\n        });\r\n\r\n        return itemErr;\r\n      };\r\n\r\n      if (!err.isArray) {\r\n        if (!err.children.length) {\r\n          errObj[property] = err.constraints;\r\n        } else {\r\n          errObj[property] = ValidationUtils.convertErrorsToNormalObject(err.children, errObj);\r\n        }\r\n      } else {\r\n        errObj[property] = buildArray(err.children);\r\n      }\r\n    });\r\n\r\n    return errObj;\r\n  }\r\n}\r\n","import { format, isDate, parseISO, isEqual, compareAsc } from 'date-fns';\r\n\r\n/**\r\n * \r\n */\r\nclass DateUtil {\r\n\r\n  /**\r\n   * N\r\n   * @tododevkit\r\n   */\r\n  // static emptyDateTimeString = '0001-01-01T00:00:00';\r\n  static emptyDateTimeString = null;\r\n\r\n  /**\r\n   * ISO\r\n   */\r\n  // static emptyISODateTimeString = '0001-01-01T00:00:00+00:00';\r\n  static emptyISODateTimeString = null;\r\n\r\n  /**\r\n   * \r\n   */\r\n  static defaultISOFormat = `yyyy-MM-dd'T'HH:mm:ssxxx`;\r\n\r\n  static defaultDisplayFormat = 'yyyy-MM-dd HH:mm:ss';\r\n\r\n  static defaultDateFormat = 'yyyy-MM-dd';\r\n\r\n  static defaultTimeFormat = 'HH:mm:ss';\r\n\r\n  /**\r\n   * ISO\r\n   */\r\n  static formatISO(dateOrDateString: string|Date): string {\r\n    if (this.isEmptyDateOrDateString(dateOrDateString) === true) {\r\n      return this.emptyISODateTimeString;\r\n    }\r\n    const dateObj = this.parse(dateOrDateString);\r\n    return format(dateObj, this.defaultISOFormat);\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param dateOrDateString ISO8601\r\n   * @param dateFormat \r\n   */\r\n  static format(dateOrDateString: string|Date, dateFormat?: string): string {\r\n    if (this.isEmptyDateOrDateString(dateOrDateString) === true) {\r\n      return this.emptyISODateTimeString;\r\n    }\r\n    const dateObj = this.parse(dateOrDateString);\r\n    dateFormat = dateFormat ? dateFormat : this.defaultDisplayFormat;\r\n    return format(dateObj, dateFormat);\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param dateOrDateString ISO8601\r\n   */\r\n  static parse(dateOrDateString: string | Date): Date {\r\n    if (this.isEmptyDateOrDateString(dateOrDateString) === true) {\r\n      return null;\r\n    }\r\n\r\n    if (this.isDate(dateOrDateString) === true) {\r\n      return dateOrDateString as Date;\r\n    }\r\n\r\n    return parseISO(dateOrDateString as string);\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  static isDate(date: any): boolean {\r\n    return isDate(date);\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param dateOrDateString \r\n   */\r\n  static isEmptyDateOrDateString(dateOrDateString: string | Date) {\r\n    if (this.isDate(dateOrDateString) === true) {\r\n      return this.isEmptyDate(dateOrDateString as Date);\r\n    }\r\n    return this.isEmptyDateString(dateOrDateString as string);\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param date \r\n   */\r\n  static isEmptyDate(date: Date) {\r\n    if (!date) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param dateString \r\n   */\r\n  static isEmptyDateString(dateString: string) {\r\n    if (!dateString || dateString.startsWith('0001-01-01') === true) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param dateOrDateString1 \r\n   * @param dateOrDateString1 \r\n   * @return truefalse\r\n   */\r\n  static isEqual(dateOrDateString1: string|Date, dateOrDateString2: string|Date): boolean {\r\n    const dateObj1 = this.parse(dateOrDateString1);\r\n    const dateObj2 = this.parse(dateOrDateString2);\r\n    if (dateObj1 === dateObj2) {\r\n      return true;\r\n    }\r\n    return isEqual(dateObj1, dateObj2);\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param dateOrDateString1 \r\n   * @param dateOrDateString1 \r\n   * @return -101\r\n   */\r\n  static compare(dateOrDateString1: string|Date, dateOrDateString2: string|Date) {\r\n    const dateObj1 = this.parse(dateOrDateString1);\r\n    const dateObj2 = this.parse(dateOrDateString2);\r\n    if (this.isEqual(dateObj1, dateObj2) === true) {\r\n      return 0;\r\n    }\r\n\r\n    // nullnull\r\n    if (!dateObj1 && this.isDate(dateObj2) === true) {\r\n      return -1;\r\n    }\r\n    if (!dateObj2 && this.isDate(dateObj1) === true) {\r\n      return 1;\r\n    }\r\n\r\n    return compareAsc(dateObj1, dateObj2);\r\n  }\r\n}\r\n\r\nexport { DateUtil };\r\n\r\n","import { Translate } from './translate';\r\n\r\nexport class TranslateService {\r\n  private static defaultLanguage = 'zh-CHS';\r\n  public static translate: Translate = null;\r\n  /**\r\n   * \r\n   * @param translate translate\r\n   */\r\n  public static setTranslate(translate: Translate) {\r\n    if (translate) {\r\n      this.translate = translate;\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  public static getCurrentLanguage() {\r\n    return this.translate && this.translate.getCurrentLanguage() || this.defaultLanguage;\r\n  }\r\n  public static dispose() {\r\n    this.translate = null;\r\n  }\r\n}\r\n","import * as ValidatorJS from 'validator';\r\nimport { ValidateRule, IsNumberOptions, ValidationResult } from './types';\r\nimport { ValidationTypes } from './validation_types';\r\nimport { ValidationError } from './validation_error';\r\nimport { Entity } from '../entity';\r\nimport { ValidationExecutor } from './validation_executor';\r\nimport { ValidationUtils } from './validation_utils';\r\nimport { DateUtil } from '../../utils/date_util';\r\nimport { TranslateService } from '../../i18n/translate_service';\r\nimport { BigNumber } from 'bignumber.js';\r\nimport { RuleType } from '../../form/index';\r\nimport { FrameContext } from '../../frame/index';\r\n\r\n/**\r\n * \r\n */\r\nexport class Validator<T extends Entity> {\r\n  constructor() { }\r\n\r\n  private validatorJs = ValidatorJS.default;\r\n  /**\r\n   * \r\n   * @param object \r\n   * @param propertyName \r\n   */\r\n  // tslint:disable-next-line: max-line-length\r\n  validate(object: T, propertyName?: string, value?, externalRules?: Map<string, ValidateRule[]>, index?: number, frameContext?: FrameContext): Promise<ValidationResult> {\r\n    const validationErrors: ValidationError[] = [];\r\n    const executor = new ValidationExecutor(this);\r\n    executor.execute(object, value, validationErrors, propertyName, index, externalRules, null, frameContext);\r\n    return Promise.all(executor.awaitingPromises).then(() => {\r\n      const errors = executor.stripEmptyErrors(validationErrors);\r\n      this.sortValidationErrors(errors);\r\n      return this.buildErrors(errors);\r\n    });\r\n  }\r\n  /**\r\n   * \r\n   * @param validationErrors \r\n   */\r\n  private sortValidationErrors(validationErrors: ValidationError[]) {\r\n    // \r\n    let sortable: boolean = true;\r\n    validationErrors.forEach(info => {\r\n      if (info.children && info.children.length > 1) {\r\n        this.sortValidationErrors(info.children);\r\n      }\r\n      if (typeof info.index !== \"number\") {\r\n        sortable = false;\r\n      }\r\n    });\r\n    if (sortable) {\r\n      validationErrors.sort((a, b) => a.index - b.index);\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   * @param object \r\n   * @param propertyName \r\n   * @param value \r\n   * @param externalRules \r\n   * @param index \r\n   * @param frameContext \r\n   * @param ignoreAsyncValidateRules\r\n   * @returns \r\n   */\r\n  public verify(object: T, propertyName?: string, value?, externalRules?: Map<string, ValidateRule[]>, index?: number, frameContext?: FrameContext, ignoreAsyncValidateRules: boolean = false): Promise<ValidationResult> | { isValid: boolean, errors: any, message: string } {\r\n    const validationErrors: ValidationError[] = [];\r\n    const executor = new ValidationExecutor(this);\r\n    executor.execute(object, value, validationErrors, propertyName, index, externalRules, null, frameContext);\r\n    if (executor.awaitingPromises && executor.awaitingPromises.length > 0 && ignoreAsyncValidateRules === false) {\r\n      return Promise.all(executor.awaitingPromises).then(() => {\r\n        const errors = executor.stripEmptyErrors(validationErrors);\r\n        const result = this.buildErrors(errors);\r\n        return result;\r\n      });\r\n    } else {\r\n      const errors = executor.stripEmptyErrors(validationErrors);\r\n      return this.buildErrors(errors);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param object \r\n   * @param value \r\n   * @param validateRule \r\n   */\r\n  validateValueByMetadata(object: any, value: any, validateRule: ValidateRule, isMultLanguageField?: boolean, currentRowId?: string): boolean | any {\r\n    const validType = validateRule.type;\r\n    let constraintsToValidate = [];\r\n    if (validateRule.constraints) {\r\n      constraintsToValidate = validateRule.constraints.map(param => {\r\n        if (typeof param === 'function') {\r\n          return param(object, value);\r\n        }\r\n        return param;\r\n      });\r\n    } else {\r\n      validateRule.constraints = [];\r\n    }\r\n\r\n    if (ValidationTypes.isValidType(validType)) {\r\n      if (validType === ValidationTypes.MAXVALUE) {\r\n        const rule = constraintsToValidate[0];\r\n        if (this.isDateString(value) || this.isDate(value) || this.isDateString(rule) || this.isDate(rule)) {\r\n          // \r\n          if (!value) {\r\n            return true;\r\n          }\r\n          if (value.indexOf('~') !== -1) {\r\n            // \r\n            return true;\r\n          }\r\n          return this[ValidationTypes.MAX_DATE](DateUtil.parse(value), isMultLanguageField, new Date(constraintsToValidate[0]));\r\n        } else {\r\n          return this[ValidationTypes.MAXVALUE](value, isMultLanguageField, constraintsToValidate[0]);\r\n        }\r\n      } else if (validType === ValidationTypes.MINVALUE) {\r\n        // nullundefinedtrue\r\n        if (constraintsToValidate[0] === null || constraintsToValidate[0] === undefined) {\r\n          return true;\r\n        }\r\n        if (this.isDateString(value) || this.isDate(value)) {\r\n          if (constraintsToValidate[0] === 0) {\r\n            return true;\r\n          }\r\n          return this[ValidationTypes.MIN_DATE](DateUtil.parse(value), isMultLanguageField, DateUtil.parse(constraintsToValidate[0]));\r\n        } else if (this.isNumber(value)) {\r\n          return this[ValidationTypes.MIN](value, isMultLanguageField, constraintsToValidate[0]);\r\n        }\r\n      } else {\r\n        return this[validType](value, isMultLanguageField, ...constraintsToValidate);\r\n      }\r\n    } else {\r\n      if (typeof validateRule.eval === 'function') {\r\n        const bindingPath = validateRule.bindingPath;\r\n        const bindingPaths = bindingPath.split('/').filter(p => p);\r\n        let fieldName = validateRule.field;\r\n        if (bindingPaths.length !== 0) {\r\n          const prefix = bindingPaths.join('/');\r\n          fieldName = `${prefix}/${fieldName.split('.').filter(p => p).join('/')}`;\r\n        }\r\n        const options: any = { patch: { [fieldName]: value } };\r\n        options.currentRows = [];\r\n        const parentEntityListPaths: string[] = object && typeof object['getEntityListPath'] === 'function' && object.getEntityListPath();\r\n        if (parentEntityListPaths.length === 4) {\r\n          const childrenList = parentEntityListPaths.slice(1, 3).reverse();\r\n          options.currentRows.push({ bindingPath: childrenList[1], primaryValue: childrenList[0].split(':')[1] });\r\n        }\r\n        if (currentRowId) {\r\n          if (validateRule.bindingPath.split('/').filter(p => p).length !== 0) {\r\n            const primaryValue = object && typeof object['getMainEntityPrimaryValue'] === 'function' && object.getMainEntityPrimaryValue();\r\n            options.currentRows.push({ bindingPath: '/', primaryValue: primaryValue });\r\n          }\r\n          options.currentRow = { bindingPath: validateRule.bindingPath, primaryValue: currentRowId };\r\n        } else {\r\n          const primaryValue = object && typeof object['getMainEntityPrimaryValue'] === 'function' && object.getMainEntityPrimaryValue();\r\n          options.currentRows.push({ bindingPath: '/', primaryValue: primaryValue });\r\n        }\r\n\r\n        const result = validateRule.eval(options);\r\n        if (validateRule.type === RuleType.Require) {\r\n          const isValid = this.required(value, isMultLanguageField);\r\n          if (result) {\r\n            return isValid;\r\n          } else {\r\n            return true;\r\n          }\r\n        } else {\r\n          return result;\r\n        }\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n  private buildErrors(errors: ValidationError[]) {\r\n    const msg = new Set(ValidationUtils.createDetailedErrorMessage(errors));\r\n    const newMsg = [];\r\n    msg.forEach(v => {\r\n      newMsg.push(v);\r\n    });\r\n    return {\r\n      isValid: errors.length === 0,\r\n      errors,\r\n      message: newMsg.join('')\r\n    };\r\n  }\r\n  /**  */\r\n  customValidation(value, comparison: boolean): boolean {\r\n    return comparison;\r\n  }\r\n  private isEmptyValue(value: any) {\r\n    const result = value === '' || value === null || value === undefined\r\n      || value === '0001-01-01' || value === '0001-01-01 00:00:00' || value === '0001-01-01T00:00:00';\r\n    return result;\r\n  }\r\n  /**  */\r\n  required(value: any, isMultLanguageField?: boolean): boolean {\r\n    if (isMultLanguageField) {\r\n      const currentLanguage = TranslateService.getCurrentLanguage();\r\n      if (Object.keys(value).length < 1) {\r\n        return false;\r\n      }\r\n      // \r\n      if (currentLanguage) {\r\n        return !!value[currentLanguage];\r\n      }\r\n      // \r\n      // const allEmpty = Object.values(value).every((v: any) => !v || v.length < 1); // .filter((v: any) => !v || v.length < 1);\r\n      // if (allEmpty) {\r\n      //   return false;\r\n      // }\r\n      return true;\r\n    }\r\n    if (typeof value === 'object' && value !== null) {\r\n      if (!Object.keys(value).length) {\r\n        return false;\r\n      }\r\n      value = Object.values(value)[0];\r\n    }\r\n    // tslint:disable: max-line-length\r\n    return value !== '' && value !== null && value !== undefined\r\n      && value !== '0001-01-01' && value !== '0001-01-01 00:00:00' && value !== '0001-01-01T00:00:00';\r\n  }\r\n\r\n  /**  */\r\n  equals(value: any, comparison: any): boolean {\r\n    return value === comparison;\r\n  }\r\n\r\n  /**\r\n   *  value \r\n   * @param value \r\n   * @param comparison \r\n   */\r\n  notEquals(value: any, comparison: any): boolean {\r\n    return value !== comparison;\r\n  }\r\n\r\n  /**\r\n   * value \r\n   * @param value \r\n   * @param options \r\n   */\r\n  isNumber(value: any, options: IsNumberOptions = {}): boolean {\r\n    if (value === Infinity || value === -Infinity) {\r\n      return options.allowInfinity;\r\n    }\r\n\r\n    if (Number.isNaN(value)) {\r\n      return options.allowNaN;\r\n    }\r\n\r\n    return Number.isFinite(value);\r\n  }\r\n\r\n  /** value */\r\n  isInt(value: number) {\r\n    return Number.isInteger(value);\r\n  }\r\n\r\n  /**  */\r\n  isFloat(value: any): boolean {\r\n    if (this.isNumber(value) || this.isNumberString(value)) {\r\n      return this.validatorJs.isFloat(value);\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * value \r\n   */\r\n  isBoolean(value: any): boolean {\r\n    return value instanceof Boolean || typeof value === 'boolean';\r\n  }\r\n\r\n  /**\r\n   * value \r\n   */\r\n  isString(value: any): boolean {\r\n    return value instanceof String || typeof value === 'string';\r\n  }\r\n\r\n  /**\r\n   * value \r\n   */\r\n  isDate(value: any): boolean {\r\n    return value instanceof Date && !isNaN(value.getTime());\r\n  }\r\n\r\n  /**\r\n   * value \r\n   */\r\n  isDateString(value: any): boolean {\r\n    const regex = /\\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])(T|\\s?)?(([0-2]\\d:[0-5]\\d)?(:[0-5]\\d(?:\\.\\d+)))?(?:Z|\\+[0-2]\\d(?:\\:[0-5]\\d)?)?/g;\r\n    return this.isString(value) && regex.test(value) && this.validatorJs.toDate(value);\r\n  }\r\n\r\n  /** value   */\r\n  length(value: any, min: number, max?: number, isMultLanguageField?: boolean): boolean {\r\n    return typeof value === 'string' && this.validatorJs.isLength(value, min, max);\r\n  }\r\n\r\n  /**\r\n   * value\r\n   * @param value \r\n   * @param min \r\n   */\r\n  minLength(value: any, isMultLanguageField: boolean, min: number): boolean {\r\n    if (isMultLanguageField) {\r\n      // const currentLanguage = TranslateService.getCurrentLanguage();\r\n      if (typeof value === 'object') {\r\n        const hasInvalidLangs = Object.values(value).filter((v: any) => v && v.length < min);\r\n        if (hasInvalidLangs && hasInvalidLangs.length > 0) {\r\n          return false;\r\n        }\r\n      }\r\n      // if (currentLanguage) {\r\n      //   return value[currentLanguage] ? value[currentLanguage].length > min : true;\r\n      // }\r\n      // \r\n      // const hasValidLangs = Object.values(value).filter((v: any) => v && v.length > min);\r\n      // if (hasValidLangs.length > 0) {\r\n      //   return true;\r\n      // }\r\n      // return false;\r\n      return true;\r\n    }\r\n    if (value && typeof value !== 'string') {\r\n      value = value.toString();\r\n    }\r\n    return !value || (typeof value === 'string' && this.length(value, min));\r\n  }\r\n\r\n  /**\r\n   * value\r\n   * @param value \r\n   * @param max \r\n   */\r\n  maxLength(value: any, isMultLanguageField: boolean, max: number): boolean {\r\n    if (isMultLanguageField) {\r\n      // const currentLanguage = TranslateService.getCurrentLanguage();\r\n      // if (currentLanguage) {\r\n      //   return value[currentLanguage] ? value[currentLanguage].length < max : true;\r\n      // }\r\n      if (typeof value === 'object') {\r\n        const hasInvalidLangs = Object.values(value).filter((v: any) => v && v.length > max);\r\n        if (hasInvalidLangs.length > 0) {\r\n          return false;\r\n        }\r\n      }\r\n      return true;\r\n    }\r\n    if (typeof value === 'object') {\r\n      for (const key in value) {\r\n        if (value.hasOwnProperty(key)) {\r\n          const element = value[key];\r\n          if (typeof element === 'string' && !this.length(value[key], 0, max)) {\r\n            return false;\r\n          }\r\n        }\r\n      }\r\n      return true;\r\n    }\r\n    if (value && typeof value !== 'string') {\r\n      value = value.toString();\r\n    }\r\n    return !value || (typeof value === 'string' && this.length(value, 0, max));\r\n  }\r\n\r\n  /** value  */\r\n  range(value: number, isMultLanguageField: boolean, min: number, max: number): boolean {\r\n    return typeof value === 'number' && this.isNumber(min) && this.isNumber(max) && value >= min && value <= max;\r\n  }\r\n  /**\r\n   * \r\n   * @param value value\r\n   * @param min \r\n   * @param max \r\n   */\r\n  dateRange(value: any, isMultLanguageField: boolean, rule: string, type: string) {\r\n    // 2010~2020|04~05|03 11:00:00~05 12:00:00\r\n    if (!value) {\r\n      return true;\r\n    }\r\n    if (type === 'maxValue' || type === 'maxDate') {\r\n      if (this.isYearRange(value) || this.isMonthOrDayRange(value)) {\r\n        return this.maxValue(parseInt(this.getRangeValue(value, 1)), isMultLanguageField, parseInt(rule.split(' ')[0]));\r\n      } else if (this.isDayTimeRange(value)) {\r\n        return true;\r\n      }\r\n    } else if (type === 'minValue' || type === 'minDate') {\r\n      if (this.isYearRange(value) || this.isMonthOrDayRange(value)) {\r\n        return this.maxValue(parseInt(this.getRangeValue(value, 0)), isMultLanguageField, parseInt(rule.split(' ')[0]));\r\n      } else if (this.isDayTimeRange(value)) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n  private getRangeValue(value: string, position: 0 | 1, splitor = '~') {\r\n    return value.split(splitor)[position];\r\n  }\r\n  private isDateRange(value: any) {\r\n    if (typeof value !== 'string') {\r\n      value = value.toString();\r\n    }\r\n    return /(\\d{4}|\\d{2})/.test(value);\r\n  }\r\n  /**\r\n   * \r\n   * @param value value\r\n   */\r\n  private isYearRange(value: any) {\r\n    if (typeof value !== 'string') {\r\n      value = value.toString();\r\n    }\r\n    return /^\\d{4}~\\d{4}$/.test(value);\r\n  }\r\n  /**\r\n   * \r\n   * @param value value\r\n   */\r\n  private isYearMonthRange(value: any) {\r\n    if (typeof value !== 'string') {\r\n      value = value.toString();\r\n    }\r\n    return /^\\d{4}-\\d{2}~\\d{4}-\\d{2}$/.test(value);\r\n  }\r\n  /**\r\n   * \r\n   * @param value value\r\n   */\r\n  private isMonthOrDayRange(value: any) {\r\n    if (typeof value !== 'string') {\r\n      value = value.toString();\r\n    }\r\n    return /^[0|1|2|3]\\d{1}~[0|1|2|3]\\d{1}$/.test(value);\r\n  }\r\n  /**\r\n   * +\r\n   * @param value value\r\n   */\r\n  private isDayTimeRange(value: any) {\r\n    if (typeof value !== 'string') {\r\n      value = value.toString();\r\n    }\r\n    return /^[0|1|2|3]\\d{1} \\d{2}:\\d{2}:\\d{2}~[0|1|2|3]\\d{1} \\d{2}:\\d{2}:\\d{2}$/.test(value);\r\n  }\r\n\r\n  /**\r\n   * Checks if the first number is greater than second.\r\n   */\r\n  min(num: number, isMultLanguageField: boolean, min: number): boolean {\r\n    return typeof num === 'number' && typeof min === 'number' && num >= min;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  minValue(num: number | string, isMultLanguageField: boolean, min: number): boolean {\r\n    // \r\n    if (num === null || num === undefined) {\r\n      return true;\r\n    }\r\n    // \r\n    if (typeof num === 'string' && num.match(/^(-?\\d+)(\\.\\d+)?$/g)) {\r\n      const value = new BigNumber(num);\r\n      const maxValue = new BigNumber(min);\r\n      return value.isGreaterThanOrEqualTo(maxValue);\r\n    }\r\n    return typeof num === 'number' && typeof min === 'number' && num >= min;\r\n  }\r\n\r\n  /**\r\n   * Checks if the first number is less than second.\r\n   */\r\n  max(num: number, isMultLanguageField: boolean, max: number): boolean {\r\n    // \r\n    if (num === null || num === undefined) {\r\n      return true;\r\n    }\r\n    return typeof num === 'number' && typeof max === 'number' && num <= max;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  maxValue(num: number | string, isMultLanguageField: boolean, max: number): boolean {\r\n    // \r\n    if (num === null || num === undefined) {\r\n      return true;\r\n    }\r\n    // \r\n    if (typeof num === 'string' && num.match(/^(-?\\d+)(\\.\\d+)?$/g)) {\r\n      const value = new BigNumber(num);\r\n      const maxValue = new BigNumber(max);\r\n      return value.isLessThanOrEqualTo(maxValue);\r\n    }\r\n    return typeof num === 'number' && typeof max === 'number' && num <= max;\r\n  }\r\n\r\n  /**\r\n   * Checks if the value is a date that's after the specified date.\r\n   */\r\n  minDate(date: Date, isMultLanguageField: boolean, minDate: Date): boolean {\r\n    if (!date) {\r\n      return true;\r\n    }\r\n    return date && date.getTime() >= minDate.getTime();\r\n  }\r\n\r\n  /**\r\n   * Checks if the value is a date that's before the specified date.\r\n   */\r\n  maxDate(date: Date, isMultLanguageField: boolean, maxDate: Date): boolean {\r\n    // \r\n    if (date === null || date === undefined) {\r\n      return true;\r\n    }\r\n    return date && date.getTime() <= maxDate.getTime();\r\n  }\r\n\r\n  /**\r\n   * Checks if a string is a boolean.\r\n   * If given value is not a string, then it returns false.\r\n   */\r\n  isBooleanString(value: string): boolean {\r\n    return typeof value === 'string' && this.validatorJs.isBoolean(value);\r\n  }\r\n\r\n  /**\r\n   * Checks if the string is numeric.\r\n   * If given value is not a string, then it returns false.\r\n   */\r\n  isNumberString(value: string): boolean {\r\n    return typeof value === 'string' && this.validatorJs.isNumeric(value);\r\n  }\r\n\r\n  /**\r\n   * Checks if the string contains the seed.\r\n   * If given value is not a string, then it returns false.\r\n   */\r\n  contains(value: string, isMultLanguageField: boolean, seed: string): boolean {\r\n    return typeof value === 'string' && this.validatorJs.contains(value, seed);\r\n  }\r\n\r\n  /**\r\n   * Checks if the string does not contain the seed.\r\n   * If given value is not a string, then it returns false.\r\n   */\r\n  notContains(value: string, isMultLanguageField: boolean, seed: string): boolean {\r\n    return typeof value === 'string' && !this.validatorJs.contains(value, seed);\r\n  }\r\n\r\n  /**\r\n   * Checks if the string is an email.\r\n   * If given value is not a string, then it returns false.\r\n   */\r\n  isEmail(value: string): boolean {\r\n    return typeof value === 'string' && this.validatorJs.isEmail(value);\r\n  }\r\n\r\n  /**\r\n   * Checks if the string is valid JSON (note: uses JSON.parse).\r\n   * If given value is not a string, then it returns false.\r\n   */\r\n  isJSON(value: string): boolean {\r\n    return typeof value === 'string' && this.validatorJs.isJSON(value);\r\n  }\r\n\r\n  /**\r\n   * Checks if the string is lowercase.\r\n   * If given value is not a string, then it returns false.\r\n   */\r\n  isLowercase(value: string): boolean {\r\n    return typeof value === 'string' && this.validatorJs.isLowercase(value);\r\n  }\r\n\r\n  /**\r\n   * Checks if the string is uppercase.\r\n   * If given value is not a string, then it returns false.\r\n   */\r\n  isUppercase(value: string): boolean {\r\n    return typeof value === 'string' && this.validatorJs.isUppercase(value);\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param value \r\n   * @param someChars #%@$\r\n   */\r\n  exclude(value: string, isMultLanguageField: boolean, someChars: string): boolean {\r\n    const arrChar = someChars.split('');\r\n    let counter = 0;\r\n    arrChar.forEach(val => {\r\n      if (this.contains(value, isMultLanguageField, val)) {\r\n        counter++;\r\n      }\r\n    });\r\n\r\n    return counter === 0;\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param value \r\n   * @param pattern \r\n   */\r\n  matches(value: string, isMultLanguageField: boolean, pattern: any): boolean {\r\n    value = (value === null || value === undefined) ? '' : value.toString();\r\n    if (value === '') {\r\n      return true;\r\n    }\r\n    return this.validatorJs.matches(value, pattern);\r\n  }\r\n}\r\n","import { Subject, Observable, from } from 'rxjs';\r\nimport { ChangeSet } from '../changeset/change_set';\r\nimport { Modification, ModifyType } from '../changeset/types';\r\nimport { Entity } from './entity';\r\nimport { EntityFactory } from './entity_creator';\r\nimport { PARENT_CLASS, PARENT_PATH, ClassType } from './types';\r\nimport { Validator } from './validator/validator';\r\nimport { ValidationResult } from './validator/types';\r\n\r\nexport interface IList<T> {\r\n  [index: number]: T;\r\n}\r\n/**\r\n * \r\n */\r\nexport class EntityList<T extends Entity> implements IList<T>, Iterable<T> {\r\n  public __type__ = 'EntityList';\r\n\r\n  // #region \r\n  private originalData: any[] = [];\r\n  /**\r\n   * \r\n   */\r\n  private rawData: T[];\r\n\r\n  /**\r\n   * \r\n   */\r\n  private listChanged = new Subject<Modification>();\r\n\r\n  /**\r\n   * \r\n   */\r\n  private changeSet = new ChangeSet();\r\n\r\n  /**\r\n   * \r\n   */\r\n  private validator = new Validator<T>();\r\n\r\n  // #endregion\r\n\r\n\r\n  // #region \r\n\r\n  /**\r\n   * ()\r\n   * @event\r\n   */\r\n  public onListChanged = this.listChanged.asObservable();\r\n\r\n  /**\r\n   * \r\n   */\r\n  public get items(): T[] {\r\n    return this.rawData;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public get changes() {\r\n    return this.changeSet.changes;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  [index: number]: T;\r\n\r\n  /**\r\n   * \r\n   */\r\n  *[Symbol.iterator](): Iterator<T> {\r\n    yield* this.items;\r\n  }\r\n\r\n  // #endregion\r\n\r\n\r\n  /**\r\n   * @param data JSON\r\n   * @param type \r\n   */\r\n  constructor(data?: any[], type?: ClassType) {\r\n    this.clear();\r\n    if (data) {\r\n      // this.loadEntities(data);\r\n      data.forEach(item => {\r\n        this.initEntity(EntityFactory(type, item));\r\n      });\r\n    }\r\n  }\r\n\r\n\r\n  // #region \r\n\r\n  /**  */\r\n  public loadEntities(entities: T[]) {\r\n    this.clear();\r\n\r\n    entities.forEach(entity => {\r\n      this.initEntity(entity);\r\n    });\r\n\r\n    // Load\r\n    const changeItem = {\r\n      path: [],\r\n      value: entities,\r\n      preValue: undefined,\r\n      type: ModifyType.Load,\r\n      target: this\r\n    };\r\n    this.setChanges(changeItem);\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  public clear() {\r\n    this.rawData = [];\r\n    this.originalData = [];\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param entity \r\n   * @param isCloned \r\n   */\r\n  public appendNew(entity: T, isCloned: boolean = false): T {\r\n    const newEntity = this.initEntity(entity, true);\r\n    // \r\n    const changeItem = {\r\n      path: [],\r\n      value: [newEntity],\r\n      preValue: undefined,\r\n      type: ModifyType.Add\r\n    };\r\n    if (isCloned === true) {\r\n      changeItem.type = ModifyType.Clone;\r\n    }\r\n    this.setChanges(changeItem);\r\n    return newEntity;\r\n  }\r\n  /**\r\n   * \r\n   * @param entity \r\n   * @param position \r\n   */\r\n  public insert(entity: T, position?: 1 | -1): T {\r\n    const newEntity = this.initEntity(entity, true);\r\n\r\n    // \r\n    const changeItem = {\r\n      path: [],\r\n      value: [newEntity],\r\n      preValue: undefined,\r\n      type: ModifyType.Insert,\r\n      position: position,\r\n    };\r\n\r\n    this.setChanges(changeItem);\r\n    return newEntity;\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  public appendEntity(entity: T): void {\r\n    const newEntity = this.initEntity(entity, true);\r\n    // \r\n    const changeItem = {\r\n      path: [],\r\n      value: [newEntity],\r\n      preValue: undefined,\r\n      type: ModifyType.Add\r\n    };\r\n\r\n    this.setChanges(changeItem);\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public appendEntities(entities: T[]): void {\r\n    const newEntites = entities.map((entity: T) => {\r\n      return this.initEntity(entity, true);\r\n    });\r\n    const changeItem = {\r\n      path: [],\r\n      value: newEntites,\r\n      preValue: undefined,\r\n      type: ModifyType.Add\r\n    };\r\n    this.setChanges(changeItem);\r\n  }\r\n\r\n  /**\r\n   * ID true false \r\n   * @param primaryId ID\r\n   */\r\n  public remove(primaryId: string): boolean {\r\n    const total = this.count();\r\n    const indexToRemove = this.rawData.findIndex((entity: Entity) => {\r\n      return entity.primaryValue === primaryId;\r\n    });\r\n    if (indexToRemove === -1) {\r\n      return false;\r\n    }\r\n    const entityToRemove = this.rawData[indexToRemove];\r\n    this.rawData.splice(indexToRemove, 1);\r\n\r\n    // \r\n    const changeItem = {\r\n      path: [],\r\n      value: { [entityToRemove.primaryProperty.dataField]: primaryId },\r\n      preValue: undefined,\r\n      type: ModifyType.Remove\r\n    };\r\n\r\n    this.updateIndex(total);\r\n    this.setChanges(changeItem);\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * ID\r\n   * @param id \r\n   */\r\n  public get(id: string) {\r\n    return this.items.find(item => {\r\n      return item.primaryValue === id;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param value \r\n   */\r\n  public setChanges(modinfo: Modification) {\r\n\r\n    // app\r\n    this.listChanged.next(modinfo);\r\n\r\n    // changeSetchagne\r\n    const change = Object.assign({}, modinfo);\r\n    if ((modinfo.type === ModifyType.Add || modinfo.type === ModifyType.Insert || modinfo.type === ModifyType.Clone) && modinfo.value[0] instanceof Entity) {\r\n      change.value = [modinfo.value[0].data];\r\n    }\r\n    this.changeSet.append(change);\r\n  }\r\n\r\n  /**  */\r\n  public count() {\r\n    return this.items.length;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public indexOf(entity: T): number {\r\n    return this.items.indexOf(entity);\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param propertyName \r\n   */\r\n  public sum(propertyName: string): number {\r\n    if (this.count() === 0) {\r\n      return 0;\r\n    }\r\n    return this.items.reduce((val, curr: T) => {\r\n      return val + curr[propertyName];\r\n    }, 0);\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public validate(): Observable<ValidationResult> {\r\n    const propertyName = this.getPropertyName();\r\n    return from(this.validator.validate(this[PARENT_CLASS], propertyName));\r\n  }\r\n\r\n  /**\r\n   * toJSON\r\n   * @deprecated\r\n   */\r\n  public toJson() {\r\n    return this.rawData;\r\n  }\r\n\r\n  /**\r\n   * JSON\r\n   */\r\n  public toJSON(): any[] {\r\n    const result = [];\r\n    this.items.forEach((entity: Entity) => {\r\n      result.push(entity.toJSON());\r\n    });\r\n    return result;\r\n  }\r\n\r\n  public toArray(): T[] {\r\n    return this.items;\r\n  }\r\n\r\n  // #endregion\r\n\r\n\r\n  // #region \r\n\r\n  /**\r\n   * \r\n   * @param entity \r\n   */\r\n  private initEntity(entity: T, isNewEntity: boolean = false): T {\r\n    entity[PARENT_CLASS] = this;\r\n    entity[PARENT_PATH] = this[PARENT_PATH];\r\n    entity.onValueChanged.subscribe((v: Modification) => {\r\n      const path = v.path;\r\n      const value = v.value;\r\n      const preValue = v.preValue;\r\n      const operator = v.type;\r\n      const subChanges = { path, value, preValue, type: operator };\r\n      if (v.changeSetValue !== undefined) {\r\n        subChanges['changeSetValue'] = v.changeSetValue;\r\n      }\r\n      this.setChanges(subChanges);\r\n    });\r\n    // TODO: \r\n    const newLength = this.rawData.push(entity);\r\n    this[newLength - 1] = entity;\r\n    if (!isNewEntity) {\r\n      this.originalData.push(entity.toJSON());\r\n    }\r\n    return entity;\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param total \r\n   */\r\n  private updateIndex(total: number) {\r\n    for (let i = 0; i < total; i++) {\r\n      delete this[i];\r\n    }\r\n    this.rawData.forEach((entity, index) => {\r\n      this[index] = entity;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private getPropertyName() {\r\n    const path = this[PARENT_PATH];\r\n    if (path && path.length) {\r\n      const name = path[path.length - 1];\r\n      return name;\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  // #endregion\r\n\r\n}\r\n","import { InjectionToken } from '@angular/core';\r\nimport { AppContext } from '../app/index';\r\n\r\n// export type ClassType = new (...args: any[]) => any;\r\nexport const BigNumberType = 'BigNumber';\r\nexport interface Pagination {\r\n  pageSize: number;\r\n  pageIndex: number;\r\n  total: number;\r\n}\r\nexport interface ResultData {\r\n  data?: any[];\r\n  pagination?: Pagination;\r\n}\r\n\r\nexport enum DataChangeType { Add, Delete }\r\n\r\nexport interface DataChange {\r\n  /**\r\n   * \r\n   */\r\n  fpath?: string;\r\n  dataId: string;\r\n  changeType: DataChangeType;\r\n  [prop: string]: any;\r\n}\r\nexport enum HttpMethod {\r\n  GET = 'GET',\r\n  POST = 'POST',\r\n  PUT = 'PUT',\r\n  DELETE = 'DELETE'\r\n}\r\n\r\n/**\r\n * \r\n */\r\n// tslint:disable-next-line: no-namespace\r\nexport namespace BackEndMessage {\r\n  /**\r\n   * \r\n   */\r\n  export enum Level {\r\n    Error = 'Error',\r\n    Info = 'Info',\r\n    Warning = 'Warning'\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  export interface IMessage {\r\n    context: IMessageContext;\r\n    bizMessages: IBizMessage[];\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  export interface ILocation {\r\n    /**\r\n     * \r\n     */\r\n    nodeCode: string;\r\n    /**\r\n     * \r\n     */\r\n    rows?: string[];\r\n    /**\r\n     * \r\n     */\r\n    columns?: string[];\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  export interface IBizMessage {\r\n    /**\r\n     * \r\n     */\r\n    location?: ILocation;\r\n    /**\r\n     * \r\n     */\r\n    message: string;\r\n    /**\r\n     * \r\n     */\r\n    level: Level;\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  export interface IMessageContext {\r\n    ns: string;\r\n    appContext: AppContext;\r\n  }\r\n  /**\r\n   * \r\n   * @description info/warning\r\n   */\r\n  export class Message implements IMessage {\r\n    public context: IMessageContext;\r\n    public bizMessages: IBizMessage[];\r\n    constructor(bizMessages: IBizMessage[], context: IMessageContext) {\r\n      this.bizMessages = bizMessages;\r\n      this.context = context;\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  export interface IBackEndMessageHandler {\r\n    handle(message: IMessage, context?: any);\r\n  }\r\n}\r\n\r\nexport interface IMessageService {\r\n  /**\r\n   * \r\n   * @param message \r\n   */\r\n  info(message: string);\r\n  /**\r\n   * \r\n   * @param message \r\n   */\r\n  error(message: string);\r\n  /**\r\n   * \r\n   * @param message \r\n   */\r\n  warning(message: string);\r\n}\r\n\r\nexport interface INotifyService {\r\n  /**\r\n   * \r\n   * @param message \r\n   * @param options \r\n   */\r\n  info(message: string, options?: { [prop: string]: any });\r\n  /**\r\n   * \r\n   * @param content \r\n   * @param options \r\n   */\r\n  success(content: string, options?: { [prop: string]: any });\r\n  /**\r\n   * \r\n   * @param content \r\n   */\r\n  warning(content: string);\r\n  /**\r\n   * \r\n   * @param content \r\n   * @param options \r\n   */\r\n  error(content: string, options?: { [prop: string]: any });\r\n}\r\n\r\nexport enum RunMode {\r\n  compatible = 'compatible',\r\n  highSpeed = 'highSpeed'\r\n}\r\n/**\r\n * compatible | highSpeed\r\n */\r\nexport const DEVKIT_RUN_MODE = new InjectionToken<RunMode>('@farris/devkit_run_mode');\r\nexport interface IDisposable {\r\n  dispose(options?: any);\r\n}\r\n/**\r\n * \r\n */\r\nexport enum ComponentType {\r\n  farrisDataGridComponent = 'farrisDatagridComponent',\r\n  farrisTreeTalbeComponent = 'farrisTreeTalbeComponent',\r\n  primengTreeComponent = 'primengTreeComponent',\r\n  kendoGridComponent = 'kendoGridComponent'\r\n}\r\n\r\nexport type ChangeSetPolicy = 'entire' | 'valid';","import { UserSettings } from \"./types\";\r\nexport class UserSettingsService {\r\n  private static userSettings: UserSettings = null;\r\n  private static timeZone: string = undefined;\r\n  private static timeZoneOffset: number = undefined;\r\n  public static setUserSettings(userSettings: UserSettings) {\r\n    this.userSettings = userSettings;\r\n    this.timeZone = undefined;\r\n    this.timeZoneOffset = undefined;\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  public static getTimeZone() {\r\n    if (this.timeZone !== undefined) {\r\n      return this.timeZone;\r\n    }\r\n    const timeZone = this.userSettings && this.userSettings.timeZone || null;\r\n    this.timeZone = timeZone;\r\n    return timeZone;\r\n  }\r\n  public static getTimeZoneOffset() {\r\n    if (this.timeZoneOffset !== undefined) {\r\n      return this.timeZoneOffset;\r\n    }\r\n    const timeZoneOffset = this.userSettings && this.userSettings.timeZoneOffset || null;\r\n    this.timeZoneOffset = timeZoneOffset;\r\n    return timeZoneOffset;\r\n  }\r\n}","import moment from 'moment';\r\n//import { timezones } from './time_zones';\r\n//import { Timezone } from './types';\r\nexport class ZonedTime {\r\n  /**\r\n   * UTC\r\n   * @param date \r\n   * @param timeZone \r\n   */\r\n  // public static zonedTimeToUtc(date: Date | string | number, timeZone: string): string {\r\n  //   timeZone = this.getStandardTimezoneName(timeZone);\r\n  //   return moment.tz(date, timeZone).utc().format();\r\n  // }\r\n  /**\r\n   * \r\n   * @param date \r\n   * @param timeZone \r\n   * @param format \r\n   */\r\n  // public static zonedTimeToSpecialZoneTimeString(date: Date | string | number, timeZone: string, format: string = 'YYYY-MM-DD HH:mm:ss.SSS'): string {\r\n  //   timeZone = this.getStandardTimezoneName(timeZone);\r\n  //   return moment(date).tz(timeZone).format(format);\r\n  // }\r\n  /**\r\n   * \r\n   * @param tz \r\n   */\r\n  // public static getStandardTimezoneName(tz: string) {\r\n  //   let momentZone = moment.tz.zone(tz);\r\n  //   let standardTimezone = tz;\r\n  //   if (!momentZone) {\r\n  //     const timezone = timezones.find((item: Timezone) => item.value === tz || item.utc.includes(tz));\r\n  //     standardTimezone = timezone && timezone.utc[0] || null;\r\n  //   }\r\n  //   return standardTimezone;\r\n  // }\r\n\r\n  public static zonedTimeToSpecialTimeZoneOffsetTimeString(date: Date | string | number, offset: number = 0, format: string = 'YYYY-MM-DD HH:mm:ss.SSS') {\r\n    const utcTime = moment(date).utc();\r\n    const offsetMinutes = offset * 60;\r\n    const result = utcTime.add(offsetMinutes, 'm');\r\n    return result.format(format);\r\n  }\r\n  public static timeZoneOffsetTimeToUtcTimeString(date: Date | string | number, offset: number, format: string = 'YYYY-MM-DD HH:mm:ss.SSS') {\r\n    return moment(date).utcOffset(offset, true).toISOString();\r\n  }\r\n}","import { Injectable } from '@angular/core';\r\n\r\n/**\r\n * \r\n */\r\n@Injectable()\r\nclass RouterParamService {\r\n\r\n  /**\r\n   * \r\n   */\r\n  public getParams(url: string): any {\r\n    const allParams = this.getAllParams();\r\n    return allParams[url] || {};\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public setParams(url: string, params: any) {\r\n    const allParams = this.getAllParams();\r\n    allParams[url] = params;\r\n    this.setAllParams(allParams);\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public clearParams() {\r\n    throw new Error('Not Implemented');\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public getAllParams(): any {\r\n    const allParamsJson = window.sessionStorage.getItem('ROUTER_PARAMS') || '{}';\r\n    const allParams = JSON.parse(allParamsJson);\r\n    return allParams;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public setAllParams(allParams: any): void {\r\n    allParams = allParams || {};\r\n    const allParamsJson = JSON.stringify(allParams);\r\n    window.sessionStorage.setItem('ROUTER_PARAMS', allParamsJson);\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public clearAllParams() {\r\n    window.sessionStorage.setItem('ROUTER_PARAMS', '{}');\r\n  }\r\n}\r\n\r\nexport { RouterParamService };\r\n","/**\r\n * \r\n * @author Witt<jiwt@inspur.com>\r\n */\r\n\r\n/**\r\n * \r\n */\r\nexport interface Change {\r\n\r\n  /**\r\n   * \r\n   */\r\n  type: ChangeType;\r\n\r\n  /**\r\n   * \r\n   */\r\n  path: string[];\r\n\r\n  /**\r\n   * \r\n   */\r\n  value?: any;\r\n\r\n  /**\r\n   * \r\n   */\r\n  preValue?: any;\r\n\r\n  /**\r\n   * \r\n   */\r\n  errors?: any;\r\n\r\n  /**\r\n   * \r\n   */\r\n  cb?: Function;\r\n\r\n  /**\r\n   * true\r\n   */\r\n  isSubmitted?: boolean;\r\n\r\n  /**\r\n   * grididerrorsform\r\n   * {\r\n   *  [id]: errors\r\n   * }\r\n   * \r\n   */\r\n  id?: string;\r\n\r\n  isUdt?: boolean;\r\n\r\n  isGrid?: boolean;\r\n  /**\r\n   * \r\n   */\r\n  create?: boolean;\r\n  /**\r\n   * \r\n   */\r\n  isCloned?: boolean;\r\n  /**\r\n   * \r\n   */\r\n  isTreeNodeLoadScene?: boolean;\r\n  [prop: string]: any;\r\n}\r\n\r\n/**\r\n * \r\n */\r\nexport enum ChangeType {\r\n  Update = 'Update',\r\n  Load = 'Load',\r\n  Append = 'Append',\r\n  Remove = 'Remove',\r\n  Swap = 'Swap',\r\n  SelectionChanged = 'SelectionChanged',\r\n  ValueChanged = 'ValueChanged',\r\n  UpdateErrors = 'UpdateErrors',\r\n  GlobalSelectionChanged = 'GlobalSelectionChanged',\r\n  /**\r\n   * \r\n   */\r\n  PaginationInfoChange = 'PaginationInfoChange',\r\n}\r\n\r\n/**\r\n * \r\n */\r\nexport interface ViewChange {\r\n  type: ViewChangeType;\r\n  path: string[];\r\n  value: any;\r\n  preValue?: any;\r\n  context?: any;\r\n  [prop: string]: any;\r\n}\r\n\r\n/**\r\n * \r\n */\r\nexport enum ViewChangeType {\r\n  ValueChanged\r\n}\r\n\r\n/**\r\n * Form\r\n */\r\nexport interface FormValueChange {\r\n  path: string[]; // \r\n  value: any; // \r\n  preValue?: any; // \r\n  command: string; // \r\n  entityChanged: boolean; // \r\n}\r\n\r\n/**\r\n * \r\n */\r\nexport interface EntityValueChange {\r\n  paths: string[]; // \r\n  value: any; // \r\n  preValue?: any; // \r\n  changed: boolean; // \r\n  [prop: string]: any;\r\n}","/**\r\n * \r\n * @author Witt<jiwt@inspur.com>\r\n */\r\n\r\n/**\r\n * \r\n */\r\nexport enum BindingPropertyType {\r\n\r\n  /**\r\n   * \r\n   */\r\n  Plain = 'Plain',\r\n\r\n  /**\r\n   * \r\n   */\r\n  Object = 'Object',\r\n\r\n  /**\r\n   * \r\n   */\r\n  List = 'List',\r\n\r\n  /**\r\n   * \r\n   */\r\n  Dynamic = 'Dynamic'\r\n}\r\n\r\n\r\n/**\r\n * \r\n */\r\nexport interface BindingProperty {\r\n\r\n  /**\r\n   * \r\n   */\r\n  name: string;\r\n\r\n  /**\r\n   * \r\n   */\r\n  type: BindingPropertyType;\r\n\r\n  /**\r\n   * ObjectList\r\n   */\r\n  entityType?: any;\r\n\r\n  /**\r\n   * \r\n   */\r\n  isPrimaryKey?: boolean;\r\n\r\n  /**\r\n   * \r\n   */\r\n  enableMultiLangInput?: boolean;\r\n}\r\n","import { Subject, of } from 'rxjs';\r\nimport { Map } from 'immutable';\r\nimport { Change, ChangeType, ViewChange, ViewChangeType } from './changes';\r\nimport { BindingProperty, BindingPropertyType } from './binding_property';\r\nimport { BindingList } from './binding_list';\r\nimport { InvokeOnValueChange } from './types';\r\n\r\n/**\r\n * \r\n */\r\nabstract class BaseBindingObject {\r\n  public __type__ = 'BindingObject';\r\n  // protected data: any = undefined;\r\n  /**\r\n   * immutable\r\n   */\r\n  protected innerValues: Map<string, any>;\r\n  /**\r\n   * \r\n   */\r\n  protected currentLanguage: string;\r\n  /**\r\n   * \r\n   */\r\n  public parent: BindingList | BaseBindingObject;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public changes: Subject<Change>;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public viewChanges: Subject<ViewChange>;\r\n\r\n  /**\r\n   *  \r\n   */\r\n  public properties: BindingProperty[];\r\n\r\n  /**\r\n   * \r\n   */\r\n  public primaryKey: string;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public get primaryKeyValue() {\r\n    return this.primaryKey ? this.getValue(this.primaryKey) : '';\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public isShowValidationMsg = false;\r\n  /**\r\n   * \r\n   */\r\n  public unsubscribe: Subject<any> = new Subject();\r\n  /**\r\n   * { [propertyName]: FormControl }control\r\n   */\r\n  public controlMap: any = {};\r\n  constructor() {\r\n    this.innerValues = Map<string, any>();\r\n    this.changes = new Subject<Change>();\r\n    this.viewChanges = new Subject<ViewChange>();\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  public setShowValidationMsg(flag: boolean) {\r\n    this.isShowValidationMsg = flag;\r\n  }\r\n  // public abstract load(data: any);\r\n  /**\r\n   * \r\n   * @param   propertyName \r\n   * @returns \r\n   */\r\n  public getValue(propertyName: string): any {\r\n    return this.innerValues.get(propertyName);\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param propertyName        \r\n   * @param propertyValue       \r\n   * @param emitEventToView     Viewfalse\r\n   * @param emitEventToEntity   Entityfalse\r\n   * @param errors              \r\n   * @param invokeOnValueChange \r\n   */\r\n  public setValue(propertyName: string, propertyValue: any, emitEventToView: boolean = false, emitEventToEntity: boolean = false, errors?: any, invokeOnValueChange?: InvokeOnValueChange, context?: any): void {\r\n    // \r\n    // if (this.primaryKey && !this.primaryKeyValue && this.primaryKey !== propertyName) {\r\n    //   return;\r\n    // }\r\n    const oldPropertyValue = this.getValue(propertyName);\r\n    // @oldPropertyValue === propertyValue\r\n    // if (oldPropertyValue === propertyValue) {\r\n    //   return;\r\n    // }\r\n    if (!invokeOnValueChange || oldPropertyValue === propertyValue) {\r\n      // \r\n      invokeOnValueChange = function (preValue, value, entityChanged: boolean, primaryValue?: any) {\r\n        return of(true);\r\n      };\r\n    }\r\n\r\n    if (emitEventToEntity === true) {\r\n      // BUG 322301@2019.08.10; ; Load\r\n      // if(!this.innerValues.has(propertyName)) {\r\n      //   return;\r\n      // }\r\n      // \r\n      invokeOnValueChange(oldPropertyValue, propertyValue, false, this.primaryKeyValue).subscribe((result) => {\r\n        if (result) {\r\n          // \r\n          this.innerValues = this.innerValues.set(propertyName, propertyValue);\r\n          // this.data[propertyName] = propertyValue;\r\n          const viewChange = this.buildViewChangesContext(propertyName, propertyValue, oldPropertyValue, errors, context);\r\n          this.viewChanges.next(viewChange);\r\n          // \r\n          if (emitEventToView === true) {\r\n            const change = this.buildChangesContext(propertyName, propertyValue, context, errors);\r\n            this.changes.next(change);\r\n          }\r\n          // \r\n          invokeOnValueChange(oldPropertyValue, propertyValue, true, this.primaryKeyValue).subscribe();\r\n        } else {\r\n          // \r\n          // \r\n          const change = this.buildChangesContext(propertyName, oldPropertyValue, context, errors);\r\n          this.changes.next(change);\r\n        }\r\n      });\r\n    } else {\r\n      // `emitEventToEntity === false`, \r\n      this.innerValues = this.innerValues.set(propertyName, propertyValue);\r\n      // this.data[propertyName] = propertyValue;\r\n      if (emitEventToView === true) {\r\n        const change = this.buildChangesContext(propertyName, propertyValue, context, errors);\r\n        this.changes.next(change);\r\n      }\r\n      // \r\n      invokeOnValueChange(oldPropertyValue, propertyValue, true, this.primaryKeyValue).subscribe();\r\n    }\r\n  }\r\n  /**\r\n   * BindingObjectJSON\r\n   */\r\n  public toJSON(options?: any): any {\r\n    const langCode = this.getCurrentLanguage();//window.localStorage.getItem('languageCode') || 'zh-CHS';\r\n    const result = {};\r\n    this.properties.forEach((property: BindingProperty) => {\r\n      const propName = property.name;\r\n      if (property.type === BindingPropertyType.List) {\r\n        const list: BindingList = this[propName];\r\n        result[propName] = list.toJSON(options);\r\n      } else if (property.type === BindingPropertyType.Object) {\r\n        const object: BaseBindingObject = this[propName];\r\n        result[propName] = object.toJSON(options);\r\n      } else if (property.type === BindingPropertyType.Dynamic) {\r\n        const object: BaseBindingObject = this[propName];\r\n        result[propName] = object.toJSON(options);\r\n      } else {\r\n        // 1\r\n        // 2ignoreMultiLangInput\r\n        if (property.enableMultiLangInput === true) {\r\n          // \r\n          if (options && options.ignoreMultiLangInput === true) {\r\n            const multiLangValueObj = this.getValue(propName);\r\n            if (multiLangValueObj) {\r\n              result[propName] = multiLangValueObj[langCode];\r\n            } else {\r\n              result[propName] = multiLangValueObj;\r\n            }\r\n          } else if (options && options.useFullMultiLangProperty) {\r\n            //  @2021-10-13\r\n            const multiLangValueObj = this.getValue(propName);\r\n            if (multiLangValueObj) {\r\n              result[`${propName}_MULTILANGUAGE`] = multiLangValueObj;\r\n              // \r\n              result[propName] = multiLangValueObj[langCode];\r\n            }\r\n          } else {\r\n            const multiLangValueObj = this.getValue(propName);\r\n            if (!multiLangValueObj) {\r\n              result[propName] = { [langCode]: multiLangValueObj };\r\n            } else {\r\n              result[propName] = multiLangValueObj;\r\n            }\r\n          }\r\n        } else {\r\n          result[propName] = this.getValue(propName);\r\n        }\r\n      }\r\n    });\r\n\r\n    return result;\r\n  }\r\n  /**\r\n   * \r\n   * @returns \r\n   */\r\n  protected getCurrentLanguage() {\r\n    this.currentLanguage = this.currentLanguage || window.localStorage.getItem('languageCode') || 'zh-CHS';\r\n    return this.currentLanguage;\r\n  }\r\n  /**\r\n   * bindignData\r\n   * @param propertyName \r\n   * @param propertyValue \r\n   * @param context \r\n   * @param errors \r\n   * @param type \r\n   * @returns \r\n   */\r\n  private buildChangesContext(propertyName: string, propertyValue: any, context?: any, errors?: any, type: ChangeType = ChangeType.ValueChanged): Change {\r\n    return {\r\n      type: type,\r\n      path: [propertyName],\r\n      value: propertyValue,\r\n      id: this.primaryKeyValue,\r\n      errors: errors,\r\n      context\r\n    };\r\n  }\r\n  /**\r\n   * viewChanges\r\n   * @param propertyName \r\n   * @param value \r\n   * @param preValue \r\n   * @param errors \r\n   * @param context \r\n   * @param type \r\n   * @returns \r\n   */\r\n  private buildViewChangesContext(propertyName: string, value: any, preValue: any, errors?: any, context?: any, type: ViewChangeType = ViewChangeType.ValueChanged): ViewChange {\r\n    return {\r\n      type: type,\r\n      path: [propertyName],\r\n      value: value,\r\n      preValue: preValue,\r\n      errors: errors,\r\n      context\r\n    };\r\n  }\r\n}\r\nexport { BaseBindingObject }","import { Type } from '@angular/core';\r\nimport { Entity, FieldMetadataUtil } from '../entity/index';\r\nimport { BindingProperty, BindingPropertyType } from './binding_property';\r\n\r\n/**\r\n * \r\n */\r\nclass PropertyUtil {\r\n\r\n  /**\r\n   * BindingProperty\r\n   * @param  entityType \r\n   * @returns \r\n   */\r\n  static getProperties(entityType: Type<Entity>): BindingProperty[] {\r\n    const properties = [];\r\n\r\n    // Plain\r\n    const ngFieldProperties = FieldMetadataUtil.getNgFields(entityType);\r\n    Object.keys(ngFieldProperties).forEach((propertyName: string) => {\r\n      const ngFieldProperty = ngFieldProperties[propertyName];\r\n      properties.push({\r\n        name: propertyName,\r\n        type: BindingPropertyType.Plain,\r\n        isPrimaryKey: ngFieldProperty.primary,\r\n        isForeignKey: ngFieldProperty.foreign,\r\n        enableMultiLangInput: ngFieldProperty.enableMultiLangInput\r\n      });\r\n    });\r\n\r\n    // Object\r\n    const ngObjectProperties = FieldMetadataUtil.getNgObjects(entityType);\r\n    Object.keys(ngObjectProperties).forEach((propertyName: string) => {\r\n      const ngObjectProperty = ngObjectProperties[propertyName];\r\n      properties.push({\r\n        name: propertyName,\r\n        type: BindingPropertyType.Object,\r\n        entityType: ngObjectProperty.type\r\n      });\r\n    });\r\n\r\n    // List\r\n    const ngListProperties = FieldMetadataUtil.getNgList(entityType);\r\n    Object.keys(ngListProperties).forEach((propertyName: string) => {\r\n      const ngListProperty = ngListProperties[propertyName];\r\n      properties.push({\r\n        name: propertyName,\r\n        type: BindingPropertyType.List,\r\n        entityType: ngListProperty.type\r\n      });\r\n    });\r\n\r\n    // Dynamics\r\n    const ngDynamicProperties = FieldMetadataUtil.getNgDynamic(entityType);\r\n    Object.keys(ngDynamicProperties).forEach((propertyName: string) => {\r\n      const ngDynamicProperty = ngDynamicProperties[propertyName];\r\n      properties.push({\r\n        name: propertyName,\r\n        type: BindingPropertyType.Dynamic,\r\n        entityType: ngDynamicProperty.type\r\n      });\r\n    });\r\n\r\n    return properties;\r\n  }\r\n\r\n  static getDynamicProperties(dynamicData: any): BindingProperty[] {\r\n    const properties = [];\r\n    Object.keys(dynamicData).forEach((propertyName: string) => {\r\n      if (dynamicData.hasOwnProperty(propertyName)) {\r\n        if (dynamicData[propertyName] instanceof Object) {\r\n          properties.push({\r\n            name: propertyName,\r\n            type: BindingPropertyType.Dynamic,\r\n            entityType: null\r\n          });\r\n        } else {\r\n          properties.push({\r\n            name: propertyName,\r\n            type: BindingPropertyType.Plain,\r\n            isPrimaryKey: false,\r\n            isForeignKey: false\r\n          });\r\n        }\r\n      }\r\n    });\r\n    return properties;\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  static getPropertyByName(properties: BindingProperty[], propertyName: string): BindingProperty {\r\n    const targetProperty = properties.find((property: BindingProperty) => {\r\n      return property.name === propertyName;\r\n    });\r\n    return targetProperty;\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param properties \r\n   * @returns \r\n   */\r\n  static getPrimaryKey(properties: BindingProperty[]): string {\r\n\r\n    // \r\n    const primaryProperty = properties.find((property: BindingProperty) => {\r\n      return property.isPrimaryKey === true;\r\n    });\r\n    return primaryProperty ? primaryProperty.name : '';\r\n  }\r\n\r\n}\r\n\r\nexport { PropertyUtil };\r\n","/**\r\n * BindingObject\r\n * @author Witt<jiwt@inspur.com>\r\n */\r\nimport { BindingProperty } from './binding_property';\r\nimport { PropertyUtil } from './property_util';\r\nimport { BaseBindingObject } from './base_binding_object';\r\n/**\r\n * BindingObjectEntityEntity\r\n */\r\nclass BindingObject extends BaseBindingObject {\r\n\r\n  /**\r\n   * \r\n   * @param properties \r\n   */\r\n  constructor(properties: BindingProperty[]) {\r\n    super();\r\n    this.properties = properties;\r\n    this.primaryKey = PropertyUtil.getPrimaryKey(properties);\r\n  }\r\n  /**\r\n   * \r\n   * @param data \r\n   */\r\n  /*public load(data: any) {\r\n    throw new Error('Method not implemented.');\r\n  }*/\r\n}\r\n\r\nexport { BindingObject };\r\n","import { Type } from \"@angular/core\";\r\nimport { ClassType } from \"../entity\";\r\nimport { BindingList } from \"./binding_list\";\r\nimport { BindingProperty } from \"./binding_property\";\r\n/**\r\n * BindingListTypeFactory\r\n */\r\nexport class BindingListTypeFactory {\r\n  private static provider: Map<BindingProperty[], Type<BindingList>> = new Map<BindingProperty[], Type<BindingList>>();\r\n  public static create(bindingProperties: BindingProperty[]) {\r\n    const bindingListType = this.getType(bindingProperties);\r\n    const bindingList = new bindingListType(bindingProperties);\r\n    return bindingList;\r\n  }\r\n  /**\r\n   * BindingList\r\n   * @param bindingProperties \r\n   * @returns \r\n   */\r\n  private static createType(bindingProperties: BindingProperty[]): ClassType<BindingList> {\r\n    const bindingListType = class BindingListType extends BindingList {\r\n      constructor(properties: BindingProperty[]) {\r\n        super(properties);\r\n      }\r\n    }\r\n    const bindingListTypePrototype = bindingListType.prototype;\r\n    this.extendProperties(bindingListTypePrototype, bindingProperties);\r\n    return bindingListType;\r\n  }\r\n  /**\r\n   * BindingList\r\n   * @param bindingListPrototype bindingList\r\n   * @param bindingProperties \r\n   */\r\n  private static extendProperties(bindingListPrototype: BindingList, bindingProperties: BindingProperty[]) {\r\n    bindingProperties.forEach((bindingProperty: BindingProperty) => {\r\n      const propertyName = bindingProperty.name;\r\n      Object.defineProperty(bindingListPrototype, propertyName, {\r\n        get: function () {\r\n          return this.currentItem[propertyName];\r\n        }\r\n      });\r\n    });\r\n  }\r\n  /**\r\n   * bindingList\r\n   * @param bindingProperties bindingList\r\n   * @returns \r\n   */\r\n  private static getType(bindingProperties: BindingProperty[]): Type<BindingList> {\r\n    if (this.provider.has(bindingProperties)) {\r\n      return this.provider.get(bindingProperties);\r\n    }\r\n    const bindingListType = this.createType(bindingProperties);\r\n    this.provider.set(bindingProperties, bindingListType);\r\n    return bindingListType;\r\n  }\r\n}","/**\r\n * \r\n * @author Witt<jiwt@inspur.com>\r\n */\r\n\r\nimport { BindingList } from './binding_list';\r\nimport { BindingListTypeFactory } from './binding_list_type_factory';\r\nimport { BindingProperty } from './binding_property';\r\n\r\n/**\r\n * BindingListBindingListBindingList\r\n *\r\n * ****\r\n * ```ts\r\n * const deptProperties: BindingProperty[] = PropertyUtil.getProperties(DeptEntity);\r\n * const deptList = BindingListFactory.create(deptProperties);\r\n * ```\r\n */\r\nclass BindingListFactory {\r\n\r\n  /**\r\n   * BindingList\r\n   * @param bindingProperties \r\n   */\r\n  static create(bindingProperties: BindingProperty[]): BindingList {\r\n    // const bindingList = new BindingList(bindingProperties);\r\n    // this.extendProperties(bindingList, bindingProperties);\r\n    const bindingList = BindingListTypeFactory.create(bindingProperties);\r\n    return bindingList;\r\n  }\r\n\r\n  /**\r\n   * BindingList\r\n   * @param bindingList       \r\n   * @param bindingProperties \r\n   */\r\n  static extendProperties(bindingList: BindingList, bindingProperties: BindingProperty[]) {\r\n    bindingProperties.forEach((bindingProperty: BindingProperty) => {\r\n      const propertyName = bindingProperty.name;\r\n      Object.defineProperty(bindingList, propertyName, {\r\n        get: () => {\r\n          return bindingList.currentItem[propertyName];\r\n        }\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\nexport { BindingListFactory };\r\n\r\n","import { Type } from '@angular/core';\r\n//import { Map as ImmutableMap } from 'immutable';\r\nimport { Change } from './changes';\r\nimport { BindingProperty, BindingPropertyType } from './binding_property';\r\nimport { BindingList } from './binding_list';\r\nimport { PropertyUtil } from './property_util';\r\nimport { BaseBindingObject } from './base_binding_object';\r\nimport { BindingListFactory } from './binding_list_factory';\r\nimport { ClassType } from '../entity';\r\nimport { BindingObject } from './binding_object';\r\nimport { TranslateService } from '../i18n/translate_service';\r\n// import { BindingObjectFactory } from './binding_object_factory';\r\n\r\n/**\r\n * BindingObjectTypeFactory\r\n */\r\nexport class BindingObjectTypeFactory {\r\n  private static provider: Map<BindingProperty[], Type<BindingObject>> = new Map<BindingProperty[], Type<BindingObject>>();\r\n  /**\r\n   * BindingObject\r\n   * @param properties \r\n   * @param data \r\n   * @returns \r\n   */\r\n  public static create(properties: BindingProperty[]/*, data?: any*/) {\r\n    const bindingObjectType = this.getType(properties);\r\n    return new bindingObjectType();\r\n  }\r\n  /**\r\n   * \r\n   * @param properties \r\n   * @returns \r\n   */\r\n  private static createType(properties: BindingProperty[]): ClassType<BindingObject> {\r\n    // \r\n    const bindingObjectType = class BindingObjectType extends BaseBindingObject {\r\n      constructor() {\r\n        super();\r\n        // this.innerValues = ImmutableMap(Object.assign({}, data));\r\n\r\n      }\r\n      //#endregion load\r\n\r\n      /*\r\n      public load(data: any) {\r\n        // data\r\n        this.innerValues = ImmutableMap(Object.assign({}, data));\r\n        this.properties.forEach((property: BindingProperty) => {\r\n          if (property.type === BindingPropertyType.List) {\r\n            this.loadLists(property);\r\n          } else if (property.type === BindingPropertyType.Object) {\r\n            this.loadObjects(property);\r\n          } else if (property.type === BindingPropertyType.Dynamic) {\r\n            this.loadDynamicObjects(property);\r\n          } else {\r\n            this.loadFields(property);\r\n          }\r\n        });\r\n      }\r\n      private loadFields(property: BindingProperty) {\r\n        const propertyName = property.name;\r\n        const dataField = property.dataField || propertyName;\r\n        let value;\r\n        if (property.enableMultiLangInput) {\r\n          value = this.getValue(dataField, false);\r\n        } else {\r\n          value = this.getValue(propertyName);\r\n        }\r\n        this[propertyName] = value;\r\n      }\r\n      private loadLists(property: BindingProperty) {\r\n        const propertyName = property.name;\r\n        const key = `_${propertyName}_`;\r\n        const bindingList: BindingList = this[key];\r\n        if (bindingList) {\r\n          const childListProperties = PropertyUtil.getProperties(property.entityType);\r\n          const data: any[] = this.getValue(propertyName);\r\n          if (data) {\r\n            const bindingObjects = data.map(item => {\r\n              const bindingObject = BindingObjectTypeFactory.create(childListProperties);\r\n              return bindingObject;\r\n            });\r\n            bindingList.load(bindingObjects);\r\n          }\r\n        }\r\n      }\r\n      private loadObjects(property: BindingProperty) {\r\n        const propertyName = property.name;\r\n        const key = `_${propertyName}_`;\r\n        const value = this.getValue(propertyName) || {};\r\n        const childObjectProperties = PropertyUtil.getProperties(property.entityType);\r\n        const bindingObject = BindingObjectTypeFactory.create(childObjectProperties);\r\n        this[key] = bindingObject;\r\n\r\n      }\r\n      private loadDynamicObjects(property: BindingProperty) {\r\n        const propertyName = property.name;\r\n        const value = this.getValue(propertyName) || {};\r\n        const dynamicObject = BindingObjectFactory.createDynamicBindingObject(value);\r\n        Object.defineProperty(this, propertyName, {\r\n          value: dynamicObject\r\n        });\r\n      }*/\r\n      //#endregion\r\n    };\r\n    // \r\n    const primaryKey = PropertyUtil.getPrimaryKey(properties);\r\n    // \r\n    bindingObjectType.prototype.primaryKey = primaryKey;\r\n    bindingObjectType.prototype.properties = properties;\r\n    // \r\n    this.extendProperties(bindingObjectType.prototype, properties);\r\n    return bindingObjectType;\r\n  }\r\n  /**\r\n   * \r\n   * @param typePrototype \r\n   * @param properties \r\n   */\r\n  private static extendProperties(typePrototype: BaseBindingObject, properties: BindingProperty[]) {\r\n    // BindingObject\r\n    properties.forEach((property: BindingProperty) => {\r\n      if (property.type === BindingPropertyType.List) {\r\n        this.extendListProperty(typePrototype, property);\r\n      } else if (property.type === BindingPropertyType.Object) {\r\n        this.extendObjectProperty(typePrototype, property);\r\n      } else if (property.type === BindingPropertyType.Dynamic) {\r\n        this.extendDynamicObjectProperty(typePrototype, property);\r\n      } else {\r\n        this.extendPlainProperty(typePrototype, property);\r\n      }\r\n    });\r\n  }\r\n  /**\r\n   * \r\n   * @param typePrototype \r\n   * @param property \r\n   */\r\n  private static extendListProperty(typePrototype: BaseBindingObject, property: BindingProperty) {\r\n    const propertyName = property.name;\r\n    const childListProperties = PropertyUtil.getProperties(property.entityType);\r\n    const key = `_${propertyName}_`;\r\n    // BindingList\r\n    Object.defineProperty(typePrototype, propertyName, {\r\n      get: function () {\r\n        let bindingList = this[key];\r\n        if (!bindingList) {\r\n          bindingList = BindingListFactory.create(childListProperties);\r\n          this[key] = bindingList;\r\n          // \r\n          const data: any[] = this.getValue(propertyName);\r\n          if (data) {\r\n            const bindingObjects = data.map(item => {\r\n              const bindingObject = BindingObjectTypeFactory.create(childListProperties);\r\n              return bindingObject;\r\n            });\r\n            bindingList.load(bindingObjects);\r\n          }\r\n          // ListparentListchanges\r\n          bindingList.parent = this;\r\n          bindingList.changes.subscribe((change: Change) => {\r\n            change.path.unshift(propertyName);\r\n            this.changes.next(change);\r\n          });\r\n        }\r\n        return bindingList;\r\n      },\r\n      set: function (bindingList: BindingList) {\r\n        this[key] = bindingList;\r\n      }\r\n    });\r\n  }\r\n  /**\r\n   * \r\n   * @param typePrototype \r\n   * @param property \r\n   */\r\n  private static extendObjectProperty(typePrototype: BaseBindingObject, property: BindingProperty): void {\r\n    const propertyName = property.name;\r\n    const childObjectProperties = PropertyUtil.getProperties(property.entityType);\r\n    const key = `_${propertyName}_`;\r\n    Object.defineProperty(typePrototype, propertyName, {\r\n      get: function () {\r\n        let bindingObject = this[key];\r\n        if (!bindingObject) {\r\n          const value = this.getValue(propertyName) || {};\r\n          bindingObject = BindingObjectTypeFactory.create(childObjectProperties);\r\n          this[key] = bindingObject;\r\n          // ObjectparentObjectchanges\r\n          bindingObject.parent = this;\r\n          bindingObject.changes.subscribe((change: Change) => {\r\n            change.path.unshift(propertyName);\r\n            this.changes.next(change);\r\n          });\r\n        }\r\n        return bindingObject;\r\n      },\r\n      set: function (value: BaseBindingObject) {\r\n        this[key] = value;\r\n      }\r\n    });\r\n  }\r\n  /**\r\n   * \r\n   * @param typePrototype \r\n   * @param property \r\n   */\r\n  private static extendDynamicObjectProperty(typePrototype: BaseBindingObject, property: BindingProperty): void {\r\n    const propertyName = property.name;\r\n    // Object.defineProperty(typePrototype, propertyName, {\r\n    //   value: null\r\n    // });\r\n    typePrototype[propertyName] = null;\r\n  }\r\n  /**\r\n   * \r\n   * @param typePrototype \r\n   * @param property \r\n   */\r\n  private static extendPlainProperty(typePrototype: BaseBindingObject, property: BindingProperty): void {\r\n    const propertyName = property.name;\r\n    Object.defineProperty(typePrototype, propertyName, {\r\n      get: function () {\r\n        if (property.enableMultiLangInput === true) {\r\n          let value = this.getValue(propertyName, false);\r\n          if (!value) {\r\n            value = this.getValue(propertyName, false);\r\n            const langCode = TranslateService.getCurrentLanguage();\r\n            return { [langCode]: value };\r\n          }\r\n          return value;\r\n        } else {\r\n          const value = this.getValue(propertyName);\r\n          return value;\r\n        }\r\n      },\r\n      set: function (value: any) {\r\n        const oldValue = this.getValue(propertyName);\r\n        if (value === oldValue) {\r\n          return;\r\n        }\r\n        this.setValue(propertyName, value, true, true);\r\n      }\r\n    });\r\n  }\r\n  /**\r\n   * bindingList\r\n   * @param properties bindingList\r\n   * @returns \r\n   */\r\n  private static getType(properties: BindingProperty[]): Type<BindingObject> {\r\n    if (this.provider.has(properties)) {\r\n      return this.provider.get(properties);\r\n    }\r\n    const bindingObjectType = this.createType(properties);\r\n    this.provider.set(properties, bindingObjectType);\r\n    return bindingObjectType;\r\n  }\r\n}","/**\r\n * \r\n * @author Witt<jiwt@inspur.com>\r\n */\r\n\r\nimport { Change } from './changes';\r\nimport { PropertyUtil } from './property_util';\r\nimport { BindingProperty, BindingPropertyType } from './binding_property';\r\nimport { BindingObject } from './binding_object';\r\nimport { BindingListFactory } from './binding_list_factory';\r\nimport { BindingObjectTypeFactory } from './binding_object_type_factory';\r\n\r\n/**\r\n * BindingObjectBindingObject\r\n *\r\n * ****\r\n *\r\n * BindingProperty\r\n * - undefinedgetsetset\r\n * - BindingObject\r\n * - BindingList\r\n *\r\n * ****\r\n *\r\n * ```ts\r\n *  const empProperties = PropertyUtil.getProperties(EmpEntity);\r\n * const empBindingObject = BindingObjectFactory.create(properties);\r\n * ```\r\n */\r\nclass BindingObjectFactory {\r\n\r\n  /**\r\n   * BindingObject\r\n   * @param properties \r\n   * @returns BindingObject\r\n   */\r\n  static create(properties: BindingProperty[]/*, data?: any*/): BindingObject {\r\n    const bindingObjectType = BindingObjectTypeFactory.create(properties/*, data*/);\r\n    return bindingObjectType;\r\n    // const object = new BindingObject(properties);\r\n    // this.extendProperties(object, properties);\r\n    // return object;\r\n  }\r\n\r\n  static createDynamicBindingObject(data: any): BindingObject {\r\n    const properties = PropertyUtil.getDynamicProperties(data);\r\n    const object = BindingObjectTypeFactory.create(properties/*, data*/);//new BindingObject(properties);\r\n    this.extendProperties(object, properties);\r\n    return object;\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param object     \r\n   * @param properties \r\n   */\r\n  static extendProperties(object: BindingObject, properties: BindingProperty[]): void {\r\n    // BindingObject\r\n    properties.forEach((property: BindingProperty) => {\r\n      if (property.type === BindingPropertyType.List) {\r\n        this.extendListProperty(object, property);\r\n      } else if (property.type === BindingPropertyType.Object) {\r\n        this.extendObjectProperty(object, property);\r\n      } else if (property.type === BindingPropertyType.Dynamic) {\r\n        this.extendDynamicObjectProperty(object, property);\r\n      } else {\r\n        this.extendPlainProperty(object, property);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param object     \r\n   * @param properties \r\n   */\r\n  static extendListProperty(object: BindingObject, property: BindingProperty): void {\r\n    const propertyName = property.name;\r\n    const childListProperties = PropertyUtil.getProperties(property.entityType);\r\n    const childList = BindingListFactory.create(childListProperties);\r\n\r\n    // ListparentListchanges\r\n    childList.parent = object;\r\n    childList.changes.subscribe((change: Change) => {\r\n      change.path.unshift(propertyName);\r\n      object.changes.next(change);\r\n    });\r\n\r\n    // BindingList\r\n    Object.defineProperty(object, propertyName, {\r\n      value: childList\r\n    });\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param object     \r\n   * @param properties \r\n   */\r\n  static extendObjectProperty(object: BindingObject, property: BindingProperty): void {\r\n    const propertyName = property.name;\r\n    const childObjectProperties = PropertyUtil.getProperties(property.entityType);\r\n    const childObject = this.create(childObjectProperties);\r\n\r\n    // ObjectparentObjectchanges\r\n    childObject.parent = object;\r\n    childObject.changes.subscribe((change: Change) => {\r\n      change.path.unshift(propertyName);\r\n      object.changes.next(change);\r\n    });\r\n\r\n    Object.defineProperty(object, propertyName, {\r\n      value: childObject\r\n    });\r\n  }\r\n\r\n  static extendDynamicObjectProperty(object: BindingObject, property: BindingProperty): void {\r\n    const propertyName = property.name;\r\n    object[propertyName] = null;\r\n  }\r\n\r\n  static attachDynamicObjectProperty(object: BindingObject, propertyName: string, dynamicObject: BindingObject) {\r\n    dynamicObject.parent = object;\r\n    dynamicObject.changes.subscribe((change: Change) => {\r\n      change.path.unshift(propertyName);\r\n      object.changes.next(change);\r\n    });\r\n    Object.defineProperty(object, propertyName, {\r\n      value: dynamicObject\r\n    });\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param object     \r\n   * @param properties \r\n   */\r\n  static extendPlainProperty(object: BindingObject, property: BindingProperty): void {\r\n    const propertyName = property.name;\r\n    Object.defineProperty(object, propertyName, {\r\n      get: () => {\r\n        return object.getValue(propertyName);\r\n      },\r\n      set: (value: any) => {\r\n        const oldValue = object.getValue(propertyName);\r\n        if (value === oldValue) {\r\n          return;\r\n        }\r\n        object.setValue(propertyName, value, true, true);\r\n      }\r\n    });\r\n  }\r\n\r\n}\r\n\r\nexport { BindingObjectFactory };\r\n","import { Type } from '@angular/core';\r\nimport { makePropDecorator, makeDecorator } from '../metadata/index';\r\nimport { ValidatorFn, AsyncValidatorFn } from '@angular/forms';\r\nimport { Form } from './form';\r\nimport { ControlValueConverter } from './control_value_converter';\r\nimport { ValidateRule } from '../entity';\r\n\r\n/**\r\n * ----------------------------------------\r\n * NgValidateForm\r\n * ----------------------------------------\r\n */\r\n\r\n/**\r\n * \r\n */\r\nexport const NG_VALIDATE_FORM = 'NgValidateForm';\r\n\r\n/**\r\n * \r\n */\r\nexport interface NgValidateForm {\r\n\r\n  /**\r\n   * Form\r\n   */\r\n  formGroupName: string;\r\n  /**\r\n   * \r\n   */\r\n  enableValidate: boolean;\r\n}\r\n\r\n/**\r\n * \r\n */\r\nexport interface NgValidateFormDecorator {\r\n  (obj?: NgValidateForm): any;\r\n  new(obj?: NgValidateForm): any;\r\n}\r\n\r\n/**\r\n * \r\n */\r\nexport function NgValidateForm(options: NgValidateForm) {\r\n  const decoratorFactory = makeDecorator(NG_VALIDATE_FORM, (obj: NgValidateForm) => obj);\r\n  return decoratorFactory(options);\r\n}\r\n\r\n/**\r\n * ----------------------------------------\r\n * NgChildForm\r\n * ----------------------------------------\r\n */\r\n\r\n/**\r\n * \r\n */\r\nexport const NG_CHILD_FORM = 'NgChildForm';\r\n\r\n/**\r\n * \r\n */\r\nexport interface NgChildForm {\r\n\r\n  /**\r\n   * \r\n   */\r\n  formType: Type<Form>;\r\n}\r\n\r\n/**\r\n * \r\n */\r\nexport interface NgChildFormDecorator {\r\n  (obj?: NgChildForm): any;\r\n  new(obj?: NgChildForm): any;\r\n}\r\n\r\n/**\r\n * \r\n */\r\nexport const NgChildForm: NgChildFormDecorator =\r\n  makePropDecorator(NG_CHILD_FORM, (obj: NgChildForm) => obj);\r\n\r\n\r\n/**\r\n * ----------------------------------------\r\n * NgChildFormArray\r\n * ----------------------------------------\r\n */\r\n\r\n/**\r\n * \r\n * @type {string}\r\n */\r\nexport const NG_CHILD_FORM_ARRAY = 'NgChildFormArray';\r\n\r\n/**\r\n * \r\n */\r\nexport interface NgChildFormArray {\r\n\r\n  /**\r\n   * \r\n   */\r\n  formType: Type<Form>;\r\n\r\n  /**\r\n   * \r\n   */\r\n  multi?: boolean;\r\n}\r\n\r\n/**\r\n * \r\n */\r\nexport interface NgFormArrayDecorator {\r\n  (obj?: NgChildFormArray): any;\r\n  new(obj?: NgChildFormArray): any;\r\n}\r\n\r\n/**\r\n * \r\n */\r\nexport const NgChildFormArray: NgFormArrayDecorator =\r\n  makePropDecorator(NG_CHILD_FORM_ARRAY, (obj: NgChildFormArray) => obj);\r\n\r\n\r\n/**\r\n * ----------------------------------------\r\n * NgFormControl\r\n * ----------------------------------------\r\n */\r\n\r\n/**\r\n * \r\n * @type {string}\r\n */\r\nexport const NG_FORM_CONTROL = 'NgFormControl';\r\n\r\n/**\r\n * \r\n */\r\nexport interface NgFormControl {\r\n  /**\r\n   * \r\n   */\r\n  id?: string;\r\n  /**\r\n   * \r\n   */\r\n  name?: string;\r\n\r\n  /**\r\n   * ()\r\n   */\r\n  defaultI18nValue?: string;\r\n\r\n  /**\r\n   * \r\n   */\r\n  binding?: string;\r\n\r\n  /**\r\n   * \r\n   */\r\n  valueConverter?: ControlValueConverter;\r\n\r\n  /**\r\n   * \r\n   */\r\n  disabled?: boolean;\r\n\r\n  /**\r\n   * \r\n   */\r\n  updateOn?: 'change' | 'blur' | 'submit';\r\n\r\n  /**\r\n   * \r\n   */\r\n  validators?: ValidatorFn | ValidatorFn[] | null;\r\n\r\n  /**\r\n   * \r\n   */\r\n  asyncValidatorFn?: AsyncValidatorFn | AsyncValidatorFn | null;\r\n\r\n  /**\r\n   * \r\n   */\r\n  validRules?: ValidateRule | ValidateRule[] | null;\r\n\r\n  /**\r\n   * \r\n   */\r\n  valueChanging?: string;\r\n  /**\r\n   * \r\n   */\r\n  valueChanged?: string;\r\n  /**\r\n   * \r\n   */\r\n  bigNumber?: boolean;\r\n  [prop: string]: any;\r\n}\r\n\r\n/**\r\n * \r\n */\r\nexport interface NgFormControlDecorator {\r\n  (obj?: NgFormControl): any;\r\n  new(obj?: NgFormControl): any;\r\n}\r\n\r\n/**\r\n * \r\n */\r\nexport const NgFormControl: NgFormControlDecorator =\r\n  makePropDecorator(NG_FORM_CONTROL, (obj: NgFormControl) => obj);\r\n","/**\r\n * \r\n */\r\nclass BindingPathConverter {\r\n\r\n  /**\r\n   * (BindingPathString | BindingPathArray) => BindingPathArray\r\n   * @param bindingPath BindingPath\r\n   * @return BindingPath\r\n   */\r\n  public static toBindingPathArray(bindingPath: string | string[]): string[] {\r\n    let bindingPathArray: string[];\r\n    if (typeof bindingPath === 'string') {\r\n      bindingPathArray = bindingPath.split('/').filter((part: string) => {\r\n        return part !== '';\r\n      });\r\n      return bindingPathArray;\r\n    } else {\r\n      bindingPathArray = bindingPath.concat([]);\r\n    }\r\n\r\n    return bindingPathArray;\r\n  }\r\n\r\n  /**\r\n   * BindingPathArray => BindingPathString\r\n   */\r\n  public static toBindingPathString(bindingPathArray: string[]): string {\r\n    return '/' + bindingPathArray.join('/');\r\n  }\r\n}\r\n\r\nexport { BindingPathConverter };\r\n","import { BindingPathConverter } from './binding_path_converter';\r\n\r\n/**\r\n * BindingPath\r\n */\r\nclass BindingPathComparer {\r\n\r\n  /**\r\n   * \r\n   */\r\n  public static isEqual(srcPath: string | string[], dstPath: string | string[]) {\r\n    const srcPathArray = BindingPathConverter.toBindingPathArray(srcPath);\r\n    const dstPathArray = BindingPathConverter.toBindingPathArray(dstPath);\r\n\r\n    const isEqual = srcPathArray.every((srcPathItem: string, srcPathIndex: number) => {\r\n      return srcPathItem === dstPathArray[srcPathIndex];\r\n    });\r\n\r\n    return isEqual;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public static isParent(childPath: string | string[], parentPath: string | string[]): boolean {\r\n\r\n    const childPathArray  = BindingPathConverter.toBindingPathArray(childPath);\r\n    const parentPathArray = BindingPathConverter.toBindingPathArray(parentPath);\r\n\r\n    // 1\r\n    if (childPathArray.length !== parentPathArray.length + 1) {\r\n      return;\r\n    }\r\n\r\n    return this.isAncestor(childPath, parentPath);\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public static isAncestor(descendantPath: string | string[], ancestorPath: string | string[]): boolean {\r\n    const descendantPathArray = BindingPathConverter.toBindingPathArray(descendantPath);\r\n    const ancestorPathArray   = BindingPathConverter.toBindingPathArray(ancestorPath);\r\n\r\n    if (descendantPath.length <= ancestorPathArray.length) {\r\n      return false;\r\n    }\r\n\r\n    const isAncestor = ancestorPathArray.every((ancestorPathItem: string, ancestorPathIndex: number) => {\r\n      return ancestorPathItem === descendantPathArray[ancestorPathIndex];\r\n    });\r\n\r\n    return isAncestor;\r\n  }\r\n\r\n}\r\n\r\nexport { BindingPathComparer };\r\n","import { BindingPathConverter } from './binding_path_converter';\r\n\r\n/**\r\n * BindingPath\r\n */\r\nclass BindingPathTraverser {\r\n\r\n  /**\r\n   * Path\r\n   */\r\n  public static getLeafPathString(bindingPath: string | string[]): string {\r\n    const bindingPathArray = BindingPathConverter.toBindingPathArray(bindingPath);\r\n    return bindingPathArray.pop();\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public static getParentPathString(bindingPath: string | string[]): string {\r\n    const bindingPathArray = BindingPathConverter.toBindingPathArray(bindingPath);\r\n    bindingPathArray.pop();\r\n    return '/' + bindingPathArray.join('/');\r\n  }\r\n}\r\n\r\nexport { BindingPathTraverser };\r\n","import {\r\n  BindingData, BindingPropertyType, PropertyUtil\r\n} from '../../binding-data/index';\r\nimport { BindingPathConverter } from './binding_path_converter';\r\n\r\n/**\r\n * EntityPath\r\n */\r\nclass EntityPathConverter {\r\n\r\n  /**\r\n   * Entity\r\n   * []\r\n   * ['id:xxx', 'name'],\r\n   * ['id:xxx', 'deptInfo', 'id:xxx', 'name']\r\n   * UDT: ['id:xxx', 'updateInfo', ':', 'createdOn']\r\n   * ['id:xxx', 'edus', 'id:xxx', 'name'],\r\n   * ['id:xxx', 'edus', 'id:xxx', 'grades', 'id:xxx', 'name']\r\n   */\r\n  public static toEntityPathArray(bindingPathString: string, bindingData: BindingData): string[] {\r\n    const bindingPathArray: string[] = BindingPathConverter.toBindingPathArray(bindingPathString);\r\n    const entityPathArray: string[] = [];\r\n\r\n    if (bindingPathArray.length === 0) {\r\n      return entityPathArray;\r\n    }\r\n\r\n    // \r\n    let currentBindingObject = bindingData.list.currentItem;\r\n    entityPathArray.push(\r\n      this.createPrimaryKeyPath(currentBindingObject.primaryKey, currentBindingObject.primaryKeyValue)\r\n    );\r\n\r\n    bindingPathArray.forEach((propName: string) => {\r\n      const propInfo = PropertyUtil.getPropertyByName(currentBindingObject.properties, propName);\r\n      switch (propInfo.type) {\r\n        case BindingPropertyType.Plain:\r\n          entityPathArray.push(propName);\r\n          break;\r\n        case BindingPropertyType.Object:\r\n          currentBindingObject = currentBindingObject[propName];\r\n          entityPathArray.push(propName);\r\n          entityPathArray.push(\r\n            this.createPrimaryKeyPath(currentBindingObject.primaryKey, currentBindingObject.primaryKeyValue)\r\n          );\r\n          break;\r\n        case BindingPropertyType.List:\r\n          const currentBindingList = currentBindingObject[propName];\r\n          currentBindingObject = currentBindingList.currentItem;\r\n          entityPathArray.push(propName);\r\n          entityPathArray.push(\r\n            this.createPrimaryKeyPath(currentBindingObject.primaryKey, currentBindingObject.primaryKeyValue)\r\n          );\r\n          break;\r\n        default:\r\n            break;\r\n      }\r\n    });\r\n\r\n    return entityPathArray;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public static createPrimaryKeyPath(primaryKey: string, primaryKeyValue: string) {\r\n    return `${primaryKey}:${primaryKeyValue}`;\r\n  }\r\n\r\n}\r\n\r\nexport { EntityPathConverter };\r\n","\r\n/**\r\n * \r\n */\r\nclass EntityPathComparer {\r\n}\r\n\r\nexport { EntityPathComparer };\r\n","/*\r\n * @Author: Witt\r\n * @Date: 2018-12-27 09:25:38\r\n * @Last Modified by: Witt\r\n * @Last Modified time: 2018-12-27 09:39:10\r\n */\r\n\r\n\r\n/**\r\n * \r\n */\r\nenum DataPathNodeType {\r\n\r\n  /**\r\n   * \r\n   */\r\n  DataId   = 'DataId',\r\n\r\n  /**\r\n   * \r\n   */\r\n  PropName = 'PropName',\r\n}\r\n\r\n\r\n/**\r\n * \r\n */\r\nclass DataPathNode {\r\n\r\n  /**\r\n   * \r\n   */\r\n  prev: DataPathNode;\r\n\r\n  /**\r\n   * \r\n   */\r\n  next: DataPathNode;\r\n\r\n  /**\r\n   * \r\n   */\r\n  type: DataPathNodeType;\r\n\r\n  /**\r\n   * \r\n   * List  value\r\n   * Objectvalue\r\n   */\r\n  value: any;\r\n\r\n  /**\r\n   * \r\n   */\r\n  constructor(type: DataPathNodeType, data: any) {\r\n    this.type = type;\r\n    this.value = data;\r\n\r\n    this.prev = null;\r\n    this.next = null;\r\n  }\r\n}\r\n\r\n\r\nexport { DataPathNodeType, DataPathNode };\r\n","\r\n/**\r\n * \r\n */\r\nclass FormPathConverter {\r\n\r\n  /**\r\n   * ControlPathString => BingingPathArray\r\n   * @params controlPath FormControlBindingDatabindingPaht + FormControlbinding\r\n   * @return BindingPath\r\n   */\r\n  public static toBindingPathArray(formPahtString: string): string[] {\r\n    const bindingPathArray = formPahtString.split('.').filter((part: string) => {\r\n      return part !== '';\r\n    });\r\n    return bindingPathArray;\r\n  }\r\n}\r\n\r\nexport { FormPathConverter };\r\n","/*\r\n * @Author: Witt\r\n * @Date: 2018-12-27 09:26:41\r\n * @Last Modified by: Witt\r\n * @Last Modified time: 2019-01-15 22:00:45\r\n */\r\n\r\nimport { DataPathNode, DataPathNodeType } from './data_path_node';\r\n/**\r\n * \r\n */\r\nclass DataPath {\r\n\r\n  /**\r\n   * \r\n   */\r\n  public head: DataPathNode;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public length: number;\r\n\r\n  /**\r\n   * \r\n   */\r\n  constructor() {\r\n    this.head = new DataPathNode(null, null);\r\n    this.length = 0;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public unshift(type: DataPathNodeType, data: any) {\r\n    const newNode = new DataPathNode(type, data);\r\n    newNode.next = this.head.next;\r\n    newNode.prev = this.head;\r\n\r\n    this.head.next = newNode;\r\n    if (newNode.next) {\r\n      newNode.next.prev = newNode;\r\n    }\r\n\r\n    this.length++;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public push(type: DataPathNodeType, data: any) {\r\n    const tailNode = this.getTail();\r\n    const newNode = new DataPathNode(type, data);\r\n    tailNode.next = newNode;\r\n    this.length++;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public getTail(): DataPathNode {\r\n    let lastNode = this.head;\r\n    while (lastNode.next) {\r\n      lastNode = lastNode.next;\r\n    }\r\n    return lastNode;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public toArray() {\r\n    const pathArray = [];\r\n    let currentNode = this.head.next;\r\n    while (currentNode) {\r\n      pathArray.push(`${currentNode.type}:${currentNode.value}`) ;\r\n      currentNode = currentNode.next;\r\n    }\r\n    return pathArray;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public toString() {\r\n    const pathArray = this.toArray();\r\n    const pathString = pathArray.join(', ');\r\n    return `[${pathString}]`;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public clone(): DataPath {\r\n    const newDataPath = new DataPath();\r\n    let curDataNode = this.head.next;\r\n    while (curDataNode) {\r\n      newDataPath.push(curDataNode.type, curDataNode.value);\r\n      curDataNode = curDataNode.next;\r\n    }\r\n    return newDataPath;\r\n  }\r\n}\r\n\r\nexport { DataPath };\r\n","\r\nimport { DataTypeInfo, DataPropGroup  } from '../../core/index';\r\nimport { Entity  } from '../../entity/index';\r\nimport { Repository, EntityManager } from '../../repository/index';\r\nimport { BindingData } from '../../binding-data/index';\r\nimport { DataPathNode, DataPathNodeType } from './data_path_node';\r\nimport { DataPath } from './data_path';\r\n\r\n/**\r\n * Path\r\n */\r\nclass DataPathCreator {\r\n\r\n  /**\r\n   * \r\n   * @param fullPathArrayOrString \r\n   * @param repository \r\n   * @summary\r\n   * 1data-path.md\r\n   */\r\n  public static createByLongPathFromRoot(fullPathArrayOrString: string[] | string, entityManager: EntityManager<Entity>): DataPath {\r\n    const dataPath = new DataPath();\r\n    const fullPathArray = fullPathArrayOrString as string[];\r\n    if (!fullPathArray || fullPathArray.length === 0) {\r\n      return dataPath;\r\n    }\r\n\r\n    let currentNodeInfo = {\r\n      nodeValue: fullPathArray.shift(),\r\n      nodeType: DataPathNodeType.DataId,\r\n      entityTypeInfo: new DataTypeInfo(entityManager.entityType)\r\n    };\r\n    while (currentNodeInfo) {\r\n      dataPath.push(currentNodeInfo.nodeType, currentNodeInfo.nodeValue);\r\n\r\n      // \r\n      const nextNodeValue = fullPathArray.shift();\r\n      if (!nextNodeValue || !currentNodeInfo.entityTypeInfo) {\r\n        break;\r\n      }\r\n      currentNodeInfo = this.getNextPathNodeInfo(currentNodeInfo, nextNodeValue);\r\n    }\r\n\r\n    return dataPath;\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param parentNodeInfo \r\n   * @param nextNodeValue \r\n   * @summary\r\n   * 1\r\n   * 2\r\n   */\r\n  private static getNextPathNodeInfo(parentNodeInfo: any, nextNodeValue: string): any {\r\n\r\n    const parentNodeValue = parentNodeInfo.nodeValue;\r\n    const parentNodeType = parentNodeInfo.nodeType;\r\n    const parentEntityTypeInfo = parentNodeInfo.entityTypeInfo;\r\n\r\n    if (!nextNodeValue || !parentEntityTypeInfo) {\r\n      return null;\r\n    }\r\n\r\n    const nextPathNodeInfo = {\r\n      nodeValue: nextNodeValue,\r\n      nodeType: null,\r\n      entityTypeInfo: null\r\n    };\r\n\r\n\r\n    // DataNodeType=ListObjectEntityTypeInfo\r\n    if (parentNodeType === DataPathNodeType.DataId) {\r\n      nextPathNodeInfo.nodeType = DataPathNodeType.PropName;\r\n      nextPathNodeInfo.entityTypeInfo = parentEntityTypeInfo;\r\n    } else {\r\n\r\n      // DataNodeType=Object\r\n      const nextPropInfo = parentEntityTypeInfo.getPropInfoByName(parentNodeValue);\r\n      if (nextPropInfo.group === DataPropGroup.List) {\r\n\r\n        // EntityPropGroup=EntityListList\r\n        nextPathNodeInfo.nodeType = DataPathNodeType.DataId;\r\n        nextPathNodeInfo.entityTypeInfo = nextPropInfo.typeInfo;\r\n      } else {\r\n\r\n        // EntityPropGroup=Entity       entityTypeInfo\r\n        // EntityPropGroup=Dynamic|Plainnull\r\n        nextPathNodeInfo.nodeType = DataPathNodeType.PropName;\r\n        nextPathNodeInfo.entityTypeInfo = nextPropInfo.group === DataPropGroup.Object ? nextPropInfo.typeInfo : null;\r\n      }\r\n    }\r\n\r\n    return nextPathNodeInfo;\r\n  }\r\n\r\n  /**\r\n   * @param fullPathArrayOrString \r\n   * @param repository \r\n   * @summary\r\n   * 1data-path.md\r\n   * 2shortPathArrayOrString\r\n   */\r\n  public static createByShortPathFromRoot(\r\n    shortPathArrayOrString: string[] | string, entityManager: EntityManager<Entity>, bindingData: BindingData\r\n  ): DataPath {\r\n\r\n    const dataPath = new DataPath();\r\n    const shortPathArray: string[] = shortPathArrayOrString as string[];\r\n\r\n    // \r\n    let currentBindingObject = bindingData.list.currentItem;\r\n    let currentEntityTypeInfo = new DataTypeInfo(entityManager.entityType);\r\n    dataPath.push(DataPathNodeType.DataId, currentBindingObject.primaryKeyValue);\r\n\r\n    // \r\n    shortPathArray.forEach((propName: string) => {\r\n      const propInfo = currentEntityTypeInfo.getPropInfoByName(propName);\r\n      switch (propInfo.group) {\r\n        case DataPropGroup.Plain:\r\n          dataPath.push(DataPathNodeType.PropName, propName);\r\n          break;\r\n        case DataPropGroup.Object:\r\n          currentBindingObject = currentBindingObject[propName];\r\n          currentEntityTypeInfo = propInfo.typeInfo;\r\n          dataPath.push(DataPathNodeType.PropName, propName);\r\n\r\n          break;\r\n        case DataPropGroup.List:\r\n          const currentBindingList = currentBindingObject[propName];\r\n          currentBindingObject = currentBindingList.currentItem;\r\n          currentEntityTypeInfo = propInfo.typeInfo;\r\n\r\n          dataPath.push(DataPathNodeType.PropName, propName);\r\n          dataPath.push(DataPathNodeType.DataId, currentBindingObject.primaryKeyValue);\r\n          break;\r\n        default:\r\n            break;\r\n      }\r\n    });\r\n\r\n    return dataPath;\r\n  }\r\n\r\n}\r\n\r\nexport { DataPathCreator };\r\n","/*\r\n * @Author: Witt\r\n * @Date: 2019-08-14 14:11:51\r\n * @Last Modified by: Witt\r\n * @Last Modified time: 2019-08-14 16:11:51\r\n */\r\n\r\nimport { DataTypeInfo } from './data_type_info';\r\n\r\n\r\n/**\r\n * \r\n */\r\nenum DataPropGroup {\r\n\r\n  /**\r\n   * \r\n   */\r\n  Plain = 'Plain',\r\n\r\n  /**\r\n   * \r\n   */\r\n  Object = 'Object',\r\n\r\n  /**\r\n   * \r\n   */\r\n  Dynamic = 'Dynamic',\r\n\r\n  /**\r\n   * \r\n   */\r\n  List = 'List'\r\n\r\n}\r\n\r\n\r\n/**\r\n * \r\n */\r\nclass DataPropInfo {\r\n\r\n  /**\r\n   * \r\n   */\r\n  public group: DataPropGroup;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public name: string;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public mapping: string;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public typeInfo: DataTypeInfo;\r\n\r\n  /**\r\n   * \r\n   * @todo\r\n   * 1EntityPropInfo\r\n   * 2 \r\n   */\r\n  public metadataInfo?: any;\r\n  /**\r\n   * vo\r\n   */\r\n  public isVOField?: boolean;\r\n}\r\n\r\nexport { DataPropGroup, DataPropInfo };\r\n","/*\r\n * @Author: Witt\r\n * @Date: 2018-12-07 09:05:09\r\n * @Last Modified by: Witt\r\n * @Last Modified time: 2018-12-27 20:35:02\r\n */\r\n\r\nimport { Type } from '@angular/core';\r\nimport {\r\n  NgProperty, NgFieldProperty, NgObjectProperty, NgDynamicProperty, NgListProperty,\r\n  EntityMetadataUtil,\r\n  NgEntity\r\n} from '../../entity/metadata/index';\r\nimport { DataPropGroup, DataPropInfo } from './data_prop_info';\r\n\r\n/**\r\n * \r\n * @todo\r\n * 1Entity\r\n * 2BuilderEntity\r\n */\r\nclass DataTypeInfo {\r\n  public entityInfo: NgEntity;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public type: Type<any>;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public propInfoMap: Map<string, DataPropInfo>;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public primaryKey: string;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public foreignKey: string;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public get isValueObject() {\r\n    return !this.primaryKey;\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @todo\r\n   */\r\n  constructor(type: any) {\r\n    this.type = type;\r\n    this.primaryKey = '';\r\n    this.foreignKey = '';\r\n    this.propInfoMap = new Map<string, DataPropInfo>();\r\n    this.collectEntityInfos();\r\n    this.collectPropInfos();\r\n  }\r\n  public getBindingPathByTableName(tableName: string): string {\r\n    const fullEntityPath = this.getFullEntityPath(this, tableName);\r\n    if (!fullEntityPath) {\r\n      return null;\r\n    }\r\n    fullEntityPath.splice(0, 1);\r\n    return '/' + fullEntityPath.join('/');\r\n  }\r\n  private getFullEntityPath(dataTypeInfo: DataTypeInfo, tableName: string, paths: string[] = []) {\r\n    if (dataTypeInfo.entityInfo && (dataTypeInfo.entityInfo.nodeCode === tableName || dataTypeInfo.entityInfo.originalCode === tableName)) {\r\n      paths.push(dataTypeInfo.entityInfo.nodeCode);\r\n      return paths;\r\n    }\r\n    const props = Array.from(dataTypeInfo.propInfoMap.values()).filter(p => p.typeInfo);\r\n    if (props.length < 1) {\r\n      paths = [];\r\n      return paths;\r\n    }\r\n    if (dataTypeInfo.entityInfo) {\r\n      paths.push(dataTypeInfo.entityInfo.nodeCode);\r\n    }\r\n\r\n    for (let idx = 0; idx < props.length; idx++) {\r\n      const dataTypeInfo = props[idx].typeInfo;\r\n      const path = this.getFullEntityPath(dataTypeInfo, tableName);\r\n      if (!path || path.length < 1) {\r\n        continue;\r\n      } else {\r\n        paths = paths.concat(path);\r\n        return paths;\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  public getPropInfos(): DataPropInfo[] {\r\n    return Array.from(this.propInfoMap.values()).filter((propInfo) => !propInfo.isVOField);\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public getPropNames(): string[] {\r\n    const propNames = [];\r\n    const propInfos = this.getPropInfos();\r\n    propInfos.forEach((propInfo) => {\r\n      propNames.push(propInfo.name);\r\n    });\r\n    return propNames;\r\n  }\r\n\r\n  /**\r\n   * group\r\n   */\r\n  public getPropInfosByGroup(group: DataPropGroup): DataPropInfo[] {\r\n    const allPropInfos = Array.from(this.propInfoMap.values());\r\n    const propInfos = allPropInfos.filter((propInfo: DataPropInfo) => {\r\n      return propInfo.group === group && !propInfo.isVOField;\r\n    });\r\n    return propInfos;\r\n  }\r\n\r\n  /**\r\n   * group\r\n   * @param group \r\n   */\r\n  public getPropNamesByGroup(group: DataPropGroup): string[] {\r\n    const propNames = [];\r\n    const propInfos = this.getPropInfosByGroup(group);\r\n    propInfos.forEach((propInfo) => {\r\n      propNames.push(propInfo.name);\r\n    });\r\n    return propNames;\r\n  }\r\n\r\n  /**\r\n   * propName\r\n   */\r\n  public getPropInfoByName(propName: string): DataPropInfo {\r\n    if (this.propInfoMap.has(propName)) {\r\n      return this.propInfoMap.get(propName);\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * path\r\n   */\r\n  public getPropInfoByPath(path: string[]): DataPropInfo {\r\n\r\n    // shift\r\n    const arrPath = path.concat([]);\r\n    if (arrPath.length === 0) {\r\n      throw Error(``);\r\n    }\r\n\r\n    // \r\n    let typeInfo = this;\r\n    let propInfo = null;\r\n    while (typeInfo && arrPath.length > 0) {\r\n\r\n      const propName = arrPath.shift();\r\n      propInfo = typeInfo.getPropInfoByName(propName);\r\n      if (!propInfo) {\r\n        throw Error(`${path}${propName}`);\r\n      }\r\n      typeInfo = propInfo.typeInfo;\r\n\r\n      // null()\r\n      if (propInfo.group === DataPropGroup.Dynamic && arrPath.length > 0) {\r\n        propInfo = null;\r\n        typeInfo = null;\r\n      }\r\n    }\r\n\r\n    return propInfo;\r\n  }\r\n\r\n  /**\r\n   * pathTypeInfo\r\n   */\r\n  public getTypeInfoByPath(path: string[]): DataTypeInfo {\r\n\r\n    // \r\n    if (path.length === 0) {\r\n      return this;\r\n    }\r\n\r\n    // \r\n    const propInfo = this.getPropInfoByPath(path);\r\n    if (!propInfo.typeInfo) {\r\n      throw Error(`${path}EntityTypeInfo`);\r\n    }\r\n\r\n    return propInfo.typeInfo;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public getPrimaryKeyPropInfo(): DataPropInfo {\r\n    return this.getPropInfoByName(this.primaryKey);\r\n  }\r\n\r\n  /**\r\n   * name\r\n   */\r\n  public getPropMappingByName(name: string): string {\r\n    const propInfo = this.getPropInfoByName(name);\r\n    if (!propInfo) {\r\n      return '';\r\n    }\r\n    return propInfo.mapping;\r\n  }\r\n\r\n  /**\r\n   * path\r\n   */\r\n  public getPropMappingByPath(path: string[]): string {\r\n    const propInfo = this.getPropInfoByPath(path);\r\n    if (!propInfo) {\r\n      return '';\r\n    }\r\n    return propInfo.mapping;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public checkPropGroup(propName: string, propGroup: DataPropGroup): boolean {\r\n    const propInfo = this.getPropInfoByName(propName);\r\n    if (propInfo && propInfo.group === propGroup) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n\r\n  /**\r\n   * --------------------------------------------------------------------------------\r\n   *  => \r\n   * --------------------------------------------------------------------------------\r\n   */\r\n\r\n  /**\r\n   * \r\n   * @todotsinterface\r\n   */\r\n  private collectPropInfos() {\r\n\r\n    // \r\n    const ngPlainProperties = EntityMetadataUtil.getNgFieldProperties(this.type);\r\n    Object.keys(ngPlainProperties).forEach((propName: string) => {\r\n      const ngProperty = ngPlainProperties[propName] as NgFieldProperty;\r\n      if (ngProperty.primary === true) {\r\n        this.primaryKey = propName;\r\n      }\r\n      if (ngProperty.foreign === true) {\r\n        this.foreignKey = propName;\r\n      }\r\n      this.addPropInfo(DataPropGroup.Plain, propName, ngProperty.dataField, null, ngProperty);\r\n    });\r\n\r\n    // \r\n    const ngEntityProperties = EntityMetadataUtil.getNgObjectProperties(this.type);\r\n    Object.keys(ngEntityProperties).forEach((propName: string) => {\r\n      const ngProperty = ngEntityProperties[propName] as NgObjectProperty;\r\n      this.addPropInfo(DataPropGroup.Object, propName, ngProperty.dataField, ngProperty.type, ngProperty);\r\n    });\r\n\r\n    // \r\n    const ngDynamicProperties = EntityMetadataUtil.getNgDynamicProperties(this.type);\r\n    Object.keys(ngDynamicProperties).forEach((propName: string) => {\r\n      const ngProperty = ngDynamicProperties[propName] as NgDynamicProperty;\r\n      this.addPropInfo(DataPropGroup.Dynamic, propName, ngProperty.dataField, null, ngProperty);\r\n    });\r\n\r\n    // \r\n    const ngEntityListProperties = EntityMetadataUtil.getNgListProperties(this.type);\r\n    Object.keys(ngEntityListProperties).forEach((propName: string) => {\r\n      const ngProperty = ngEntityListProperties[propName] as NgListProperty;\r\n      this.addPropInfo(DataPropGroup.List, propName, ngProperty.dataField, ngProperty.type, ngProperty);\r\n    });\r\n  }\r\n  private collectEntityInfos() {\r\n    let entityInfo = EntityMetadataUtil.getNgEntityMatadata(this.type);\r\n    if (!entityInfo) {\r\n      // \r\n      entityInfo = {\r\n        originalCode: this.type[\"code\"],\r\n        nodeCode: this.type[\"label\"]\r\n      };\r\n    }\r\n    this.entityInfo = entityInfo;\r\n\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  private addPropInfo(group: DataPropGroup, name: string, mapping: string, type: Type<any>, metadataInfo: NgProperty) {\r\n\r\n    // \r\n    mapping = mapping ? mapping : name;\r\n    let typeInfo = null;\r\n    if (type) {\r\n      typeInfo = new DataTypeInfo(type);\r\n    }\r\n    const propInfo = { group, name, mapping, typeInfo, metadataInfo };\r\n    this.propInfoMap.set(name, propInfo);\r\n    // vo\r\n    const originalDataField = metadataInfo && metadataInfo.originalDataField;\r\n    if (originalDataField && !this.propInfoMap.has(originalDataField)) {\r\n      this.propInfoMap.set(originalDataField, { ...propInfo, isVOField: true });\r\n    } else if (metadataInfo && metadataInfo.type) {\r\n      const entityInfo = EntityMetadataUtil.getNgEntityMatadata(metadataInfo.type);\r\n      if (entityInfo && entityInfo.originalCode) {\r\n        this.propInfoMap.set(entityInfo.originalCode, { ...propInfo, isVOField: true });\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport { DataTypeInfo };\r\n","import { InjectionToken } from '@angular/core';\r\nimport { ChangeSetPolicy, IMessageService, INotifyService } from './types';\r\n/**\r\n * \r\n */\r\nexport const FORM_PATH_TOKEN = new InjectionToken<string>('@farris/devkit form path token');\r\n/**\r\n * \r\n */\r\nexport const BACK_END_MESSAGE_HANDLER_TOKEN = new InjectionToken<string>('@farris/devkit_back_end_message_handler');\r\nexport const MESSAGE_SERVICE_TOKEN = new InjectionToken<IMessageService>('@farris/message_service_token');\r\nexport const NOTIFY_SERVICE_TOKEN = new InjectionToken<INotifyService>('@farris/notify_service_token');\r\n/**\r\n * ,entire | valid\r\n * @description entirevalid\r\n */\r\nexport const CHANGE_SET_POLICY_TOKEN = new InjectionToken<ChangeSetPolicy>('@farris/changeset_policy_token');","export class Core {\r\n  public static warn(message?: any, ...optionalParams: any[]) {\r\n    this.logable() && console && console.warn(message, ...optionalParams);\r\n  }\r\n  public static error(message?: any, ...optionalParams: any[]) {\r\n    this.logable() && console && console.error(message, ...optionalParams);\r\n  }\r\n  public static log(message?: any, ...optionalParams: any[]) {\r\n    this.logable() && console && console.log(message, ...optionalParams);\r\n  }\r\n  private static logable(): boolean {\r\n    return window && window.localStorage && window.localStorage.getItem('__DEVKIT_LOGABLE__') === 'true' || false;\r\n  }\r\n}","export function escape(value: string) {\r\n  if (!value || typeof value !== 'string') {\r\n    return value;\r\n  }\r\n  return value\r\n    .replace(/[\\\\]/g, '\\\\\\\\')\r\n    .replace(/[\\\"]/g, '\\\\\\\"')\r\n    .replace(/[\\/]/g, '\\\\/')\r\n    .replace(/[\\b]/g, '\\\\b')\r\n    .replace(/[\\f]/g, '\\\\f')\r\n    .replace(/[\\n]/g, '\\\\n')\r\n    .replace(/[\\r]/g, '\\\\r')\r\n    .replace(/[\\t]/g, '\\\\t');\r\n}","import { InjectionToken } from \"@angular/core\";\r\n\r\nexport interface IResolver {\r\n  resolve(expr: string): string[];\r\n}\r\nexport const RESOLVER_TOKEN = new InjectionToken('@farris_resolver_token');\r\nexport const ENTITY_TEMPLATE = 'ENTITY~';\r\nexport const STATE_TEMPLATE = 'STATE~';\r\nexport const GROUP_FUNCTIONS = ['SumByProp', 'CountByProp', 'AvgByProp', 'MaxByProp', 'MinByProp', 'IsExistRecord', 'ListContains', 'ListGreaterThan', 'ListLessThan', 'ListStartWith', 'ListEndWith', 'MultiplyChildNumber'];","import { Inject, Injectable, Injector, Optional } from '@angular/core';\r\nimport { IResolver, RESOLVER_TOKEN } from './types';\r\n\r\n@Injectable()\r\nexport class ResolverRegistry{\r\n  constructor(private injector: Injector, @Optional() @Inject(RESOLVER_TOKEN) public resolvers: Array<IResolver>){}\r\n}","import { Type } from '@angular/core';\r\nimport { makeDecorator } from '../metadata/index';\r\n\r\nexport const NG_REPOSITORY = 'NgRepository';\r\n\r\n/**\r\n * NgRepository\r\n */\r\nexport interface NgRepository {\r\n\r\n  /**\r\n     * API\r\n     */\r\n    apiUrl: string;\r\n\r\n    /**\r\n     * \r\n     */\r\n    entityType: Type<any>;\r\n}\r\n\r\n/**\r\n * NgRepositoryDecorator\r\n */\r\nexport interface NgRepositoryDecorator {\r\n    (obj?: NgRepository): any;\r\n    new(obj?: NgRepository): any;\r\n}\r\n\r\n/**\r\n * NgRepository\r\n */\r\nexport function NgRepository(options: NgRepository) {\r\n  const decoratorFactory = makeDecorator(NG_REPOSITORY, (obj: NgRepository) => obj);\r\n  return decoratorFactory(options);\r\n}\r\n","/*\r\n * @Author: Witt\r\n * @Date: 2018-10-01 19:36:51\r\n * @Last Modified by: aalizzwell\r\n * @Last Modified time: 2019-09-03 19:46:42\r\n */\r\nimport { Type } from '@angular/core';\r\nimport { Modification, ModifyType } from '../changeset/index';\r\nimport { Subject } from 'rxjs';\r\nimport { Entity, FieldMetadataUtil, EntityList } from '../entity/index';\r\nimport { ChangeSetPolicy } from '../core';\r\n// tslint:disable: no-bitwise\r\n/**\r\n * \r\n * @todoEntityList\r\n */\r\nclass EntityCollection<T extends Entity> {\r\n\r\n  /**\r\n   * Set\r\n   */\r\n  private innerEntitySet: Set<T>;\r\n  /**\r\n   * \r\n   */\r\n  private _changeSetPolicy: ChangeSetPolicy;\r\n  /**\r\n   * \r\n   */\r\n  public set changeSetPolicy(policy: ChangeSetPolicy) {\r\n    this._changeSetPolicy = policy;\r\n  }\r\n  public get changeSetPolicy(): ChangeSetPolicy {\r\n    return this._changeSetPolicy;\r\n  }\r\n  /**\r\n   * Map\r\n   */\r\n  private innerEntityMap: Map<string, T>;\r\n  public changes: Subject<Modification>;\r\n\r\n  /**\r\n   * Entity\r\n   */\r\n  public collectionChanged: Subject<Modification>;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public readonly entityType: Type<T>;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public readonly primaryKey: string;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public paginationInfo: any;\r\n\r\n\r\n  /**\r\n   * \r\n   */\r\n  constructor(entityType: any) {\r\n    this.innerEntitySet = new Set<T>();\r\n    this.innerEntityMap = new Map<string, T>();\r\n    this.collectionChanged = new Subject<Modification>();\r\n    this.changes = new Subject<Modification>();\r\n    this.entityType = entityType;\r\n    this.primaryKey = FieldMetadataUtil.getPrimaryKey(this.entityType) || entityType.prototype.primaryKey;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public count(): number {\r\n    return this.innerEntitySet.size;\r\n  }\r\n\r\n  public get entityTypeName() {\r\n    return this.entityType.name;\r\n  }\r\n  /**\r\n   * \r\n   * @param id \r\n   */\r\n  public has(id: string): boolean {\r\n    return this.innerEntityMap.has(id);\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public clear() {\r\n    this.innerEntityMap.clear();\r\n    this.innerEntitySet.clear();\r\n    this.notifyCollectionChanged(new Modification([], ModifyType.Load));\r\n  }\r\n  /**\r\n   * \r\n   * @param isReset \r\n   */\r\n  public reset(notify: boolean = true) {\r\n    this.innerEntityMap.forEach(entity => {\r\n      entity.unsubscribe.next();\r\n      entity.unsubscribe.complete();\r\n    });\r\n    this.innerEntitySet.forEach(entity => {\r\n      entity.unsubscribe.next();\r\n      entity.unsubscribe.complete();\r\n    });\r\n    this.innerEntityMap.clear();\r\n    this.innerEntitySet.clear();\r\n    if (notify === true) {\r\n      const modification = new Modification([], ModifyType.Load);\r\n      modification.isReset = true;\r\n      this.notifyCollectionChanged(modification);\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  public toArray(): Entity[] {\r\n    return Array.from(this.innerEntitySet);\r\n  }\r\n\r\n  /**\r\n   * JSON\r\n   */\r\n  public toJSON(): any[] {\r\n    const result = [];\r\n    const entities = this.toArray();\r\n    entities.forEach((entity: Entity) => {\r\n      result.push(entity.toJSON());\r\n    });\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public loadEntities(entities: any[], entityCreate: boolean = false) {\r\n    this.innerEntityMap.clear();\r\n    this.innerEntitySet.clear();\r\n\r\n    entities.forEach(entity => {\r\n      this.extendChangeSetPolicyProperty(entity);\r\n      this.innerEntitySet.add(entity);\r\n      this.innerEntityMap.set(entity[this.primaryKey], entity);\r\n      this.listenEntityChangeEvent(entity);\r\n    });\r\n    const modification = new Modification(entities, ModifyType.Load);\r\n    modification.entityCreate = entityCreate;\r\n    this.notifyCollectionChanged(modification);\r\n\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param entity \r\n   * @param isCloned \r\n   */\r\n  public addEntity(entity: any, isCloned: boolean = false) {\r\n    this.verifyEntityToAdd(entity);\r\n    this.extendChangeSetPolicyProperty(entity);\r\n    this.innerEntitySet.add(entity);\r\n    this.innerEntityMap.set(entity[this.primaryKey], entity);\r\n    this.listenEntityChangeEvent(entity);\r\n    const modifyType = isCloned ? ModifyType.Clone : ModifyType.Add;\r\n    this.notifyCollectionChanged(new Modification([entity], modifyType));\r\n  }\r\n  /**\r\n   * \r\n   * @param entity \r\n   * @param position \r\n   */\r\n  public insertEntity(entity: any, position: 1 | -1) {\r\n    this.verifyEntityToAdd(entity);\r\n    this.extendChangeSetPolicyProperty(entity);\r\n    this.innerEntitySet.add(entity);\r\n    this.innerEntityMap.set(entity[this.primaryKey], entity);\r\n    this.listenEntityChangeEvent(entity);\r\n    this.notifyCollectionChanged(new Modification(entity, ModifyType.Insert, null, null, position));\r\n  }\r\n  /**\r\n   * \r\n   * @param entity entity\r\n   * @param data \r\n   */\r\n  public updateEntity(entity: any, data: any) {\r\n    entity.load(data);\r\n    this.notifyCollectionChanged(new Modification(data, ModifyType.Update, null, null));\r\n  }\r\n  /**\r\n   * \r\n   * @param entities \r\n   */\r\n  public addEntities(entities: any[], options: any = null) {\r\n    if (!entities) {\r\n      return;\r\n    }\r\n    const entitiesToAdd: any[] = [];\r\n    entities.forEach(entity => {\r\n      this.verifyEntityToAdd(entity);\r\n      entitiesToAdd.push(entity);\r\n    });\r\n    entitiesToAdd.forEach(entity => {\r\n      this.extendChangeSetPolicyProperty(entity);\r\n      this.innerEntitySet.add(entity);\r\n      this.innerEntityMap.set(entity[this.primaryKey], entity);\r\n      this.listenEntityChangeEvent(entity);\r\n    });\r\n    const isTreeNodeLoadScene = options && options.isTreeNodeLoadScene || false;\r\n    const modification = new Modification(entitiesToAdd, ModifyType.Add);\r\n    modification.isTreeNodeLoadScene = isTreeNodeLoadScene;\r\n    this.notifyCollectionChanged(modification);\r\n  }\r\n  /**\r\n   * \r\n   * @param entities \r\n   */\r\n  public addData(entities: any[], options: any = null) {\r\n    if (!entities) {\r\n      return;\r\n    }\r\n    const entitiesToAdd: any[] = [];\r\n    entities.forEach(entity => {\r\n      this.verifyEntityToAdd(entity);\r\n      entitiesToAdd.push(entity);\r\n    });\r\n    entitiesToAdd.forEach(entity => {\r\n      this.extendChangeSetPolicyProperty(entity);\r\n      this.innerEntitySet.add(entity);\r\n      this.innerEntityMap.set(entity[this.primaryKey], entity);\r\n      this.listenEntityChangeEvent(entity);\r\n    });\r\n    // \r\n    const isTreeNodeLoadScene = options && options.isTreeNodeLoadScene || false;\r\n    const modification = new Modification(entitiesToAdd, ModifyType.AddData);\r\n    modification.isTreeNodeLoadScene = isTreeNodeLoadScene;\r\n    this.notifyCollectionChanged(modification);\r\n  }\r\n  /**\r\n   * \r\n   * @param entity \r\n   */\r\n  private extendChangeSetPolicyProperty(entity: any){\r\n    if (entity) {\r\n      entity.changeSetPolicy = this.changeSetPolicy;\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  getEntityById(identity: string): any {\r\n    if (this.innerEntityMap.has(identity) === false) {\r\n      return null;\r\n    }\r\n    const entity = this.innerEntityMap.get(identity);\r\n    return entity;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  getEntityByPath(pathArray: string[]): any {\r\n    const rootEntityId = pathArray[0].split(':')[1];\r\n    let parentNode: any = this.getEntityById(rootEntityId);\r\n    for (let i = 1; i < pathArray.length && parentNode; i = i + 1) {\r\n      const currentPath = pathArray[i];\r\n      if ((parentNode instanceof Entity) || (\r\n        parentNode.typeName === 'ConcreteEntityPrototype')\r\n      ) {\r\n        // @todo\r\n        if (currentPath.indexOf(':') === -1) {\r\n          parentNode = parentNode[pathArray[i]];\r\n        }\r\n      } else {\r\n        parentNode = parentNode.get(pathArray[i].split(':')[1]);\r\n      }\r\n    }\r\n    return parentNode;\r\n  }\r\n  /**\r\n   * id:1/a/id:2/c\r\n   * @param pathArray \r\n   */\r\n  public getEntitiesByPath(pathArray: string[]) {\r\n    const rootEntityId = pathArray[0].split(':')[1];\r\n    let entity: any = this.getEntityById(rootEntityId);\r\n    for (let i = 1; i < pathArray.length && entity; i += 2) {\r\n      const path = pathArray[i];\r\n      entity = entity[path];\r\n      if (!(entity instanceof EntityList)) {\r\n        throw new Error('');\r\n      }\r\n      if ((i + 1) < pathArray.length) {\r\n        const id = pathArray[i + 1].split(':')[1];\r\n        entity = entity.get(id);\r\n      }\r\n    }\r\n    return entity;\r\n  }\r\n  /**\r\n   * \r\n   * @param predicate \r\n   */\r\n  getEntities(predicate: (value: any, index: number, array: any[]) => any): any[] {\r\n    const entities: any[] = Array.from(this.innerEntitySet);\r\n    const matchedEntities = entities.filter(predicate);\r\n    return matchedEntities;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  getAllEntities(): any[] {\r\n    return Array.from(this.innerEntitySet);\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param identity \r\n   */\r\n  removeEntityById(identity: string): any {\r\n    this.verifyEntityToRemove(identity);\r\n    const entityToRemove = this.innerEntityMap.get(identity);\r\n    this.innerEntityMap.delete(identity);\r\n    this.innerEntitySet.delete(entityToRemove);\r\n    this.notifyCollectionChanged(new Modification([entityToRemove], ModifyType.Remove));\r\n    return entityToRemove;\r\n  }\r\n\r\n  removeEntitiesByIds(id: string) {\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public removeEntities(predicate: (value: any, index: number, array: any[]) => any): any[] {\r\n    const entitiesToRemove = Array.from(this.innerEntitySet).filter(predicate);\r\n    entitiesToRemove.forEach(entityToRemove => {\r\n      this.innerEntityMap.delete(entityToRemove[this.primaryKey]);\r\n      this.innerEntitySet.delete(entityToRemove);\r\n    });\r\n    this.notifyCollectionChanged(new Modification(entitiesToRemove, ModifyType.Remove));\r\n    return entitiesToRemove;\r\n  }\r\n  /**\r\n   * \r\n   * @param predicate \r\n   */\r\n  public removeData(predicate: (value: any, index: number, array: any[]) => any): any[] {\r\n    const entitiesToRemove = Array.from(this.innerEntitySet).filter(predicate);\r\n    entitiesToRemove.forEach(entityToRemove => {\r\n      this.innerEntityMap.delete(entityToRemove[this.primaryKey]);\r\n      this.innerEntitySet.delete(entityToRemove);\r\n    });\r\n    this.notifyCollectionChanged(new Modification(entitiesToRemove, ModifyType.RemoveData));\r\n    return entitiesToRemove;\r\n  }\r\n  /**\r\n   * \r\n   * @param paths \r\n   *  ['id:provinceId','id:cityMDMs','zoneMDMs']\r\n   * @description path\r\n   * ```json\r\n   * [\r\n   * \"id:b5ed23ca-88d9-4377-98ec-92f35c1325f1\",\r\n   * \"cityMDMs\",\r\n   * \"id:373706af-622f-4aea-a006-dddbffd7bda3\",\r\n   * \"zoneMDMs\"\r\n   * ]\r\n   * ```\r\n   * @param entities \r\n   */\r\n  public resetEntities(paths: string[], entities: any[]) {\r\n    if (paths[0].indexOf(':') === -1) {\r\n      throw new Error('');\r\n    }\r\n    // \r\n    const id = paths[0].split(':')[1];\r\n    let entity: any = this.innerEntityMap.get(id);\r\n    let entityList = entity[paths[1]] as EntityList<any>;\r\n    if (!entity) {\r\n      throw new Error(`${id}`);\r\n    }\r\n    for (let index = 2; index < paths.length; index += 2) {\r\n      const pathInfo = paths[index].split(':');\r\n      const entityId = pathInfo[1];\r\n      // \r\n      entity = entityList.get(entityId);\r\n      if (!entity) {\r\n        throw new Error(`${id}`);\r\n      }\r\n      // \r\n      entityList = entity[paths[index + 1]];\r\n    }\r\n    entityList.clear();\r\n    entityList.loadEntities(entities);\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private verifyEntityToAdd(entity: any): boolean {\r\n    if (this.has(entity[this.primaryKey])) {\r\n      throw new Error(`The repository already had an item with the save identity of '${entity[this.primaryKey]}'`);\r\n    }\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private verifyEntityToRemove(identity: string): boolean {\r\n    if (!this.has(identity)) {\r\n      throw new Error(`The entity with identity of '${identity} dose not exsit.'`);\r\n    }\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private notifyCollectionChanged(modification: Modification) {\r\n    this.collectionChanged.next(modification);\r\n  }\r\n  private listenEntityChangeEvent(entity: Entity) {\r\n    if (entity) {\r\n      entity.onValueChanged.subscribe((change: Modification) => this.changes.next(change));\r\n    }\r\n  }\r\n\r\n  //#region \r\n\r\n  /**\r\n   * \r\n   */\r\n  set pageSize(pageSize: number) {\r\n    if (typeof (pageSize) !== 'number' || pageSize < 0) {\r\n      throw new Error('Invalid parameter:pageSize');\r\n    }\r\n\r\n    const original = this.paginationInfo;\r\n    // const entityPaginationInfo = Object.assign({}, original[this.entityTypeName], { pageSize });\r\n    // this.paginationInfo = Object.assign({}, original, { [this.entityTypeName]: entityPaginationInfo });\r\n    // this.notifyCollectionChanged(new Modification(this.paginationInfo[this.entityTypeName], ModifyType.PaginationInfoChange));\r\n    this.paginationInfo = Object.assign({}, original, { pageSize });\r\n    this.notifyCollectionChanged(new Modification(this.paginationInfo, ModifyType.PaginationInfoChange));\r\n  }\r\n  /**\r\n   * \r\n   * @description 0\r\n   */\r\n  get pageSize(): number {\r\n    if (!!this.paginationInfo) {\r\n      return this.paginationInfo.pageSize || 0;\r\n    }\r\n    return 0;\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  set totalCount(total: number) {\r\n    if (typeof (total) !== 'number' || total < 0) {\r\n      throw new Error('Invalid parameter:total');\r\n    }\r\n\r\n    const original = this.paginationInfo;\r\n    // const entityPaginationInfo = Object.assign({}, original[this.entityTypeName], { total });\r\n    // this.paginationInfo = Object.assign({}, original, { [this.entityTypeName]: entityPaginationInfo });\r\n    this.paginationInfo = Object.assign({}, original, { total });\r\n    this.notifyCollectionChanged(new Modification(this.paginationInfo, ModifyType.PaginationInfoChange));\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  get totalCount(): number {\r\n    if (!!this.paginationInfo) {\r\n      return this.paginationInfo.total || 0;\r\n    }\r\n    return 0;\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  set pageIndex(pageIndex: number) {\r\n    if (typeof (pageIndex) !== 'number' || pageIndex < 0) {\r\n      throw new Error('Invalid parameter:pageIndex');\r\n    }\r\n\r\n    const original = this.paginationInfo;\r\n    // const entityPaginationInfo = Object.assign({}, original[this.entityTypeName], { pageIndex });\r\n    // this.paginationInfo = Object.assign({}, original, { [this.entityTypeName]: entityPaginationInfo });\r\n    this.paginationInfo = Object.assign({}, original, { pageIndex });\r\n    this.notifyCollectionChanged(new Modification(this.paginationInfo, ModifyType.PaginationInfoChange));\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  get pageIndex(): number {\r\n    if (!!this.paginationInfo) {\r\n      return this.paginationInfo.pageIndex || 1;\r\n    }\r\n    return 1;\r\n  }\r\n  /**\r\n   * \r\n   * @param path \r\n   * @param pageInfo \r\n   */\r\n  public updatePaginationInfoByPath(path: string, pageInfo: { pageIndex: any, pageSize: any, totalCount: any, [prop: string]: any }) {\r\n    const original = this.paginationInfo;\r\n    const { pageIndex, pageSize } = pageInfo;\r\n    const total = pageInfo && (pageInfo.totalCount || pageInfo.total) || 0;\r\n    const paginationInfo = Object.assign({}, original, { pageIndex, pageSize, total });\r\n    this.setPaginationConfigByPath(path, paginationInfo);\r\n  }\r\n  /**\r\n   * \r\n   * @param path \r\n   */\r\n  public getPaginationConfigByPath(path: string, defaultValue?: any) {\r\n    if (!path || path === '/') {\r\n      return this.paginationInfo;\r\n    }\r\n    if (typeof path !== 'string') {\r\n      throw new Error('');\r\n    }\r\n    const paths = path.split('/').filter(item => !!item && item.trim().length > 0).map(item => item.trim());\r\n    let config = this.paginationInfo;\r\n    paths.forEach(item => {\r\n      if (config && config.hasOwnProperty(item)) {\r\n        config = config[item];\r\n      } else {\r\n        config = null;\r\n      }\r\n    });\r\n    return !!config ? config : typeof defaultValue !== 'undefined' ? defaultValue : undefined;\r\n  }\r\n  /**\r\n   * \r\n   * @param path \r\n   * @param value keytotal\r\n   */\r\n  public setPaginationConfigByPath(path: string | Array<any>, value: any) {\r\n    const original = JSON.stringify(this.paginationInfo);\r\n    if (!path || path === '/') {\r\n      this.paginationInfo = value;\r\n    } else {\r\n      if (!Array.isArray(path)) {\r\n        path = path.toString().match(/[^/[\\]]+/g) || [];\r\n      }\r\n      path.slice(0, -1).reduce((prev, current, index) =>\r\n        Object(prev[current]) === prev[current]\r\n          ? prev[current]\r\n          : prev[current] = Math.abs(path[index + 1]) >> 0 === +path[index + 1]\r\n            ? []\r\n            : {},\r\n        this.paginationInfo)[path[path.length - 1]] = value;\r\n    }\r\n\r\n    if (JSON.stringify(this.paginationInfo) !== original) {\r\n      this.notifyCollectionChanged(new Modification(this.paginationInfo, ModifyType.PaginationInfoChange));\r\n    }\r\n    return this.paginationInfo;\r\n  }\r\n  //#endregion\r\n}\r\n\r\nexport { EntityCollection };\r\n","/*\r\n * @Author: Witt\r\n * @Date: 2019-03-07 17:24:38\r\n * @Last Modified by:   Witt\r\n * @Last Modified time: 2019-03-11 19:50:38\r\n */\r\n\r\nimport { Type } from '@angular/core';\r\nimport { Entity, EntityList, createEntity, createEntities } from '../entity/index';\r\nimport { EntityCollection } from './entity_collection';\r\nimport { DataPath, DataPathCreator, DataPathNodeType, DataTypeInfo } from '../core/index';\r\nimport { EntityUtil } from '../binding-data/entity_util';\r\n\r\n\r\n/**\r\n * \r\n */\r\nclass EntityManager<T extends Entity> {\r\n\r\n  /**\r\n   * \r\n   */\r\n  public entityType: Type<Entity>;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public entityCollection: EntityCollection<Entity>;\r\n\r\n  /**\r\n   * \r\n   */\r\n  constructor(entityCollection: EntityCollection<T>) {\r\n    this.entityCollection = entityCollection;\r\n    this.entityType = entityCollection.entityType;\r\n  }\r\n\r\n\r\n  // #region \r\n\r\n  /**\r\n   * \r\n   */\r\n  public createEntity(entityData: any): T {\r\n    const entity = createEntity<T>(this.entityType, entityData);\r\n    return entity;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public createEntities(entityListData: any[], entityType: any): T[] {\r\n    const entities: T[] = createEntities<T>(this.entityType, entityListData);\r\n    return entities;\r\n  }\r\n  /**\r\n   * \r\n   * @param fPath fpath\r\n   * @param entityListData \r\n   */\r\n  public createEntitiesByPath(fPath: string, entityListData: any[]) {\r\n    const subPaths = fPath.split('/');\r\n    if (subPaths.length < 3) {\r\n      throw Error(`pathpath[${fPath}]`);\r\n    }\r\n    if (entityListData.length < 1) {\r\n      return [];\r\n    }\r\n    let childEntityList: EntityList<any>;\r\n    let propInfo: { propType: string, propEntityType: any };\r\n    let propName: string;\r\n    for (let i = 2; i < subPaths.length; i = i + 2) {\r\n      const fid = subPaths[i - 1];\r\n      propName = subPaths[i];\r\n      const parentEntity = childEntityList ? childEntityList.get(fid) : this.entityCollection.getEntityById(fid);\r\n      childEntityList = parentEntity[propName];\r\n      const entityType = propInfo ? propInfo.propEntityType : this.entityType;\r\n      propInfo = EntityUtil.getPropInfo(entityType, propName);\r\n      if (!childEntityList) {\r\n        throw Error(`fpath${propName}fpath${fPath}`);\r\n      }\r\n    }\r\n    const entities = entityListData.map(entityData => {\r\n      return createEntity<Entity>(propInfo.propEntityType, entityData);\r\n    });\r\n    return entities;\r\n  }\r\n  // #endregion\r\n\r\n\r\n  // #region \r\n\r\n  /**\r\n   * path\r\n   */\r\n  public getEntityByPath(path: string[]): Entity {\r\n    const entity = this.getEntityNodeByPath(path) as Entity;\r\n    return entity;\r\n  }\r\n\r\n  /**\r\n   * path\r\n   */\r\n  public getEntitiesByPath(path: string[]): Entity[] {\r\n    const entityCollectionOrList = this.getEntityNodeByPath(path) as EntityCollection<Entity> | EntityList<Entity>;\r\n    let entities: Entity[];\r\n    if (entityCollectionOrList instanceof EntityCollection === true) {\r\n      entities = (entityCollectionOrList as EntityCollection<Entity>).toArray();\r\n    } else {\r\n      entities = (entityCollectionOrList as EntityList<Entity>).toArray();\r\n    }\r\n    return entities;\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param path \r\n   */\r\n  public getEntityNodeByPath(path: string[]): EntityCollection<Entity> | EntityList<Entity> | Entity {\r\n    const dataPath = DataPathCreator.createByLongPathFromRoot(path, this);\r\n    let entityNode: any = this.entityCollection;\r\n    let pathNode = dataPath.head.next;\r\n    while (pathNode) {\r\n      if (pathNode.type === DataPathNodeType.DataId) {\r\n        if (entityNode instanceof EntityCollection === true) {\r\n          entityNode = (entityNode as EntityCollection<Entity>).getEntityById(pathNode.value);\r\n        } else {\r\n          entityNode = (entityNode as EntityList<Entity>).get(pathNode.value);\r\n        }\r\n      } else {\r\n        entityNode = entityNode[pathNode.value];\r\n      }\r\n      if (!entityNode) {\r\n        throw new Error(`${pathNode.value}`);\r\n      }\r\n      pathNode = pathNode.next;\r\n    }\r\n    return entityNode;\r\n  }\r\n  // #endregion\r\n\r\n\r\n  // #region \r\n\r\n  /**\r\n   * path\r\n   */\r\n  public getPropValueByPath(path: string[]): any {\r\n    const propName = path.pop();\r\n    const entity = this.getEntityByPath(path);\r\n    return entity[propName];\r\n  }\r\n\r\n  /**\r\n   * path\r\n   */\r\n  public setPropValueByPath(path: string[], propValue: any): void {\r\n    const propName = path.pop();\r\n    const entity = this.getEntityByPath(path);\r\n    entity[propName] = propValue;\r\n  }\r\n\r\n  // #endregion\r\n\r\n\r\n  // #region \r\n\r\n  /**\r\n   * path\r\n   */\r\n  public insertEntityBeforeByPath(fpath: string[]) {\r\n    throw new Error('Not Implemented');\r\n  }\r\n\r\n  /**\r\n   * path\r\n   */\r\n  public insertEntitiesBeforeByPath() {\r\n    throw new Error('Not Implemented');\r\n  }\r\n\r\n  /**\r\n   * path\r\n   */\r\n  public insertEntityAfterByPath() {\r\n    throw new Error('Not Implemented');\r\n  }\r\n\r\n  /**\r\n   * path\r\n   */\r\n  public insertEntitiesAfterByPath() {\r\n    throw new Error('Not Implemented');\r\n  }\r\n\r\n  // #endregion\r\n\r\n\r\n  // #region \r\n\r\n  /**\r\n   * path1\r\n   */\r\n  // public appendEntityByPath(fpath: string[], entity: Entity): void {\r\n  //   const entityCollectionOrList = this.getEntityNodeByPath(fpath);\r\n  //   if (entityCollectionOrList instanceof EntityCollection === true) {\r\n  //     const entityCollection = entityCollectionOrList as EntityCollection<Entity>;\r\n  //     entityCollection.addEntity(entity);\r\n  //   } else {\r\n  //     const entityList = (entityCollectionOrList as EntityList<Entity>);\r\n  //     entityList.appendEntity(entity);\r\n  //   }\r\n  // }\r\n\r\n  /**\r\n   * path\r\n   * @param fpath  /id/childsNode/id/xxx\r\n   * @param entityData \r\n   * @param initialData[] \r\n   */\r\n  public appendEntityByPath(fpath: string, entityData: any, initialData?: any, isCloned: boolean = false): Entity {\r\n    const subPaths = fpath.split('/');\r\n    if (subPaths.length < 3) {\r\n      throw Error(`pathpath[${fpath}]`);\r\n    }\r\n\r\n    let childEntityList: EntityList<any>;\r\n    let propInfo: { propType: string, propEntityType: any };\r\n    let propName: string;\r\n    for (let i = 2; i < subPaths.length; i = i + 2) {\r\n      const fid = subPaths[i - 1];\r\n      propName = subPaths[i];\r\n\r\n      // todo: EntityCollection\r\n      const parentEntity = childEntityList ? childEntityList.get(fid) : this.entityCollection.getEntityById(fid);\r\n      childEntityList = parentEntity[propName];\r\n      const entityType = propInfo ? propInfo.propEntityType : this.entityType;\r\n      propInfo = EntityUtil.getPropInfo(entityType, propName);\r\n      if (!childEntityList) {\r\n        throw Error(`fpath${propName}fpath${fpath}`);\r\n      }\r\n    }\r\n\r\n    // const propInfo = EntityUtil.getPropInfo(this.entityType, propName);\r\n    const childEntity = createEntity<Entity>(propInfo.propEntityType, entityData);\r\n    // createBindingObject\r\n    // if (initialData) {\r\n    //   EntityUtil.appendInitialData(childEntity, initialData);\r\n    // }\r\n    childEntityList.appendNew(childEntity, isCloned);\r\n\r\n    return childEntity;\r\n  }\r\n  /**\r\n   * \r\n   * @param fpath \r\n   * @param entityData \r\n   * @param initialData \r\n   * @param position \r\n   */\r\n  public insertEntityByPath(fpath: string, entityData: any, initialData?: any, position?: 1 | -1) {\r\n    const subPaths = fpath.split('/');\r\n    if (subPaths.length < 3) {\r\n      throw Error(`pathpath[${fpath}]`);\r\n    }\r\n\r\n    let childEntityList: EntityList<any>;\r\n    let propInfo: { propType: string, propEntityType: any };\r\n    let propName: string;\r\n    for (let i = 2; i < subPaths.length; i = i + 2) {\r\n      const fid = subPaths[i - 1];\r\n      propName = subPaths[i];\r\n\r\n      // todo: EntityCollection\r\n      const parentEntity = childEntityList ? childEntityList.get(fid) : this.entityCollection.getEntityById(fid);\r\n      childEntityList = parentEntity[propName];\r\n      const entityType = propInfo ? propInfo.propEntityType : this.entityType;\r\n      propInfo = EntityUtil.getPropInfo(entityType, propName);\r\n      if (!childEntityList) {\r\n        throw Error(`fpath${propName}fpath${fpath}`);\r\n      }\r\n    }\r\n\r\n    // const propInfo = EntityUtil.getPropInfo(this.entityType, propName);\r\n    const childEntity = createEntity<Entity>(propInfo.propEntityType, entityData);\r\n    // createBindingObject\r\n    // if (initialData) {\r\n    //   EntityUtil.appendInitialData(childEntity, initialData);\r\n    // }\r\n    childEntityList.insert(childEntity, position);\r\n    return childEntity;\r\n  }\r\n  /**\r\n   * path\r\n   */\r\n  public appendEntitiesByPath(fpath: string[], entities: Entity[]) {\r\n    const entityCollectionOrList = this.getEntityNodeByPath(fpath);\r\n    if (entityCollectionOrList instanceof EntityCollection === true) {\r\n      const entityCollection = entityCollectionOrList as EntityCollection<Entity>;\r\n      entityCollection.addEntities(entities);\r\n    } else {\r\n      const entityList = (entityCollectionOrList as EntityList<Entity>);\r\n      entityList.appendEntities(entities);\r\n    }\r\n  }\r\n\r\n  // #endregion\r\n\r\n\r\n  // #region \r\n\r\n  /**\r\n   * fapthid\r\n   */\r\n  // public removeEntityByPath(fpath: string[], id: string): void {\r\n  //   const entityCollectionOrList = this.getEntityNodeByPath(fpath);\r\n  //   if (entityCollectionOrList instanceof EntityCollection === true) {\r\n  //     const entityCollection = entityCollectionOrList as EntityCollection<Entity>;\r\n  //     entityCollection.removeEntityById(id);\r\n  //   } else {\r\n  //     const entityList = (entityCollectionOrList as EntityList<Entity>);\r\n  //     entityList.remove(id);\r\n  //   }\r\n  // }\r\n\r\n  /**\r\n   * path\r\n   * @param fpath path\r\n   */\r\n  public removeEntityByPath(fpath: string, id: string) {\r\n    const subPaths = fpath.split('/');\r\n    if (subPaths.length < 3) {\r\n      throw Error(`pathpath[${fpath}]`);\r\n    }\r\n    let childEntityList: EntityList<any>;\r\n    for (let i = 2; i < subPaths.length; i = i + 2) {\r\n      const fid = subPaths[i - 1];\r\n      const propName = subPaths[i];\r\n      const parentEntity = childEntityList ? childEntityList.get(fid) : this.entityCollection.getEntityById(fid);\r\n      childEntityList = parentEntity[propName];\r\n      if (!childEntityList) {\r\n        throw Error(`fpath${propName}fpath${fpath}`);\r\n      }\r\n    }\r\n\r\n    childEntityList.remove(id);\r\n  }\r\n\r\n  /**\r\n   * fapthids\r\n   */\r\n  public removeEntitiesByPath(fpath: string[], ids: string[]): void {\r\n    // const entityCollectionOrList = this.getEntityNodeByPath(fpath);\r\n    // if (entityCollectionOrList instanceof EntityCollection === true) {\r\n    //   const entityCollection = entityCollectionOrList as EntityCollection<Entity>;\r\n    //   entityCollection.removeEntitiesByIds(ids);\r\n    // } else {\r\n    //   const entityList = (entityCollectionOrList as EntityList<Entity>);\r\n    //   entityList.remove(ids);\r\n    // }\r\n    throw new Error('Not Implemented');\r\n  }\r\n  // #endregion\r\n\r\n\r\n  // #region \r\n\r\n  /**\r\n   * \r\n   */\r\n  public clearAllEntityChanges() {\r\n    const entities = this.entityCollection.toArray();\r\n    entities.forEach((entity: Entity) => {\r\n      entity.changes.splice(0, entity.changes.length);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * id\r\n   */\r\n  public clearEntityChangesById(id: string): void {\r\n    const entity = this.entityCollection.getEntityById(id);\r\n    if (!entity) {\r\n      return;\r\n    }\r\n    entity.changes.splice(0, entity.changes.length);\r\n  }\r\n\r\n  /**\r\n   * ids\r\n   */\r\n  public clearEntityChangesByIds(ids: string[]): void {\r\n    if (!ids || ids.length < 0) {\r\n      return;\r\n    }\r\n\r\n    ids.forEach((id: string) => {\r\n      this.clearEntityChangesById(id);\r\n    });\r\n  }\r\n\r\n  // #endregion\r\n\r\n\r\n  // #region \r\n\r\n  /**\r\n   * \r\n   */\r\n  public checkAllEntityChanges(): boolean {\r\n\r\n    const entities = this.entityCollection.toArray();\r\n    const hasChanges = entities.some((entity: Entity) => {\r\n      if (entity.changes.length > 0) {\r\n        return true;\r\n      } else {\r\n        return false;\r\n      }\r\n    });\r\n    return hasChanges;\r\n  }\r\n\r\n  /**\r\n   * id\r\n   */\r\n  public checkEntityChangesById(id: string): boolean {\r\n    const entity = this.entityCollection.getEntityById(id);\r\n    if (!entity) {\r\n      return false;\r\n    }\r\n    return entity.changes.length > 0;\r\n  }\r\n\r\n  // #endregion\r\n\r\n\r\n  // #region \r\n\r\n  /**\r\n   * \r\n   * @deprecated\r\n   */\r\n  public clearEntityChangesByArray(idArray: string[]): void {\r\n    this.clearEntityChangesByIds(idArray);\r\n  }\r\n\r\n  // #endregion\r\n\r\n}\r\n\r\nexport { EntityManager };\r\n","import { Type, Injectable } from '@angular/core';\r\nimport { Entity, FieldMetadataUtil } from '../entity/index';\r\n// tslint:disable: no-bitwise\r\n@Injectable()\r\nexport class PaginationManager<T extends Entity> {\r\n\r\n  constructor(private entityType: any, private paginationConfig: any) {\r\n    if (this.paginationConfig === null || this.paginationConfig === undefined) {\r\n      this.paginationConfig = this.getNgListProperties();\r\n    }\r\n    // \r\n    this.expandMainEntityConfig();\r\n    this.deleteMainEntityConfig();\r\n    this.removeLasts();\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  private expandMainEntityConfig() {\r\n    const entityName = this.entityType.typeName || this.entityType.name;\r\n    if (this.paginationConfig.hasOwnProperty(entityName)) {\r\n      const entityConfig = this.paginationConfig[entityName];\r\n      this.paginationConfig = Object.assign(this.paginationConfig, entityConfig);\r\n    } else {\r\n      this.paginationConfig = Object.assign(this.paginationConfig, { pageSize: this.paginationConfig['pageSize'] || 0 });\r\n    }\r\n  }\r\n  /**\r\n   * keys\r\n   */\r\n  private removeLasts() {\r\n    const entityName = this.entityType.typeName || this.entityType.name;\r\n    Object.keys(this.paginationConfig).forEach(key => {\r\n      if (key !== entityName && key.endsWith('s')) {\r\n        const newKey = key.substring(0, key.length - 1);\r\n        this.paginationConfig[newKey] = this.paginationConfig[key];\r\n        delete this.paginationConfig[key];\r\n      }\r\n    });\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  private deleteMainEntityConfig() {\r\n    const entityName = this.entityType.typeName || this.entityType.name;\r\n    delete this.paginationConfig[entityName];\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  public get pagination() {\r\n    return this.paginationConfig;\r\n  }\r\n  /**\r\n   * \r\n   * @param path \r\n   * @param defaultValue \r\n   */\r\n  public getPaginationConfigByPath(path: string, defaultValue?: any) {\r\n    if (!path || path === '/') {\r\n      return this.paginationConfig;\r\n    }\r\n    if (typeof path !== 'string') {\r\n      throw new Error('');\r\n    }\r\n    path = path.substring(1);\r\n    const paths = path.split('/').filter(item => !!item && item.trim().length > 0);\r\n    let config = this.paginationConfig;\r\n    paths.forEach(item => {\r\n      if (config && config.hasOwnProperty(item)) {\r\n        config = config[item];\r\n      } else {\r\n        config = null;\r\n      }\r\n    });\r\n    return !!config ? config : typeof defaultValue !== 'undefined' ? defaultValue : undefined;\r\n  }\r\n  /**\r\n   * \r\n   * @param path \r\n   * @param value \r\n   */\r\n  public setPaginationConfigByPath(path: string | Array<any>, value: any) {\r\n    if (!Array.isArray(path)) {\r\n      path = path.toString().match(/[^/[\\]]+/g) || [];\r\n    }\r\n    path.slice(0, -1).reduce((prev, current, index) =>\r\n      Object(prev[current]) === prev[current]\r\n        ? prev[current]\r\n        : prev[current] = Math.abs(path[index + 1]) >> 0 === +path[index + 1]\r\n          ? []\r\n          : {},\r\n      this.paginationConfig)[path[path.length - 1]] = value;\r\n    return this.paginationConfig;\r\n  }\r\n\r\n  /**\r\n   * NgList\r\n   * @param defaultPageSize defaultPageSize\r\n   */\r\n  private getNgListProperties(defaultPageSize: number = 0) {\r\n\r\n    const getChilds = (objectType: Type<Entity>) => {\r\n      const listProperties = FieldMetadataUtil.getNgList(objectType);\r\n      let result = {};\r\n      if (Object.keys(listProperties).length < 1) {\r\n        return result;\r\n      }\r\n\r\n      Object.keys(listProperties).forEach(prop => {\r\n        let itemTypeName = listProperties[prop].dataField;\r\n        // s\r\n        if (itemTypeName.endsWith('s')) {\r\n          itemTypeName = itemTypeName.substring(0, itemTypeName.length - 1);\r\n        }\r\n        result[itemTypeName] = {\r\n          pageSize: defaultPageSize\r\n        };\r\n        const child = getChilds(listProperties[prop].type);\r\n        if (child !== null && Object.keys(child).length > 0) {\r\n          result = Object.assign({}, result, child);\r\n        }\r\n      });\r\n      return result;\r\n    };\r\n    const childs = getChilds(this.entityType);\r\n    const root = Object.assign({}, { pageSize: defaultPageSize }, childs);\r\n    return root;\r\n  }\r\n\r\n}\r\n","import { DataChange, DataChangeType } from '../core';\r\n\r\nclass DataChangeHistory {\r\n    private history: Array<DataChange>;\r\n    constructor() {\r\n        this.history = [];\r\n    }\r\n    public addChange(dataChange: DataChange) {\r\n        const changeType = DataChangeType[dataChange.changeType];\r\n        this[`on${changeType}Data`](dataChange);\r\n    }\r\n    public addChanges(dataChange: DataChange[]) {\r\n        dataChange.forEach(change => this.addChange(change));\r\n    }\r\n    public clear() {\r\n        this.history.splice(0, this.history.length);\r\n    }\r\n    public clearByIds(ids: string[]) {\r\n        this.history = this.history.filter(item => {\r\n            if (item.fpath && item.fpath !== '/' && item.fpath.includes('/')) {\r\n                for (const id of ids) {\r\n                    const include = item.fpath.split('/').includes(id);\r\n                    return !include;\r\n                }\r\n            } else {\r\n                return !ids.includes(item.dataId);\r\n            }\r\n        });\r\n    }\r\n    public isChanged() {\r\n        return this.history.length > 0;\r\n    }\r\n    private onAddData(dataChange: DataChange) {\r\n        this.history.push(dataChange);\r\n    }\r\n    private onDeleteData(dataChange: DataChange) {\r\n        const index = this.history.findIndex(item => item.dataId === dataChange.dataId && item.changeType === DataChangeType.Add);\r\n        if (index >= 0) {\r\n            this.history.splice(index, 1);\r\n        } else {\r\n            this.history.push(dataChange);\r\n        }\r\n    }\r\n}\r\nexport { DataChangeHistory };\r\n","/**\r\n * \r\n */\r\nexport class SortConditionManager {\r\n  /**\r\n   * \r\n   * @description\r\n   * \r\n   * ```typescript\r\n   * key: bindingPath\r\n   * value: Array<{field:\"name|etc\",direction:\"asc|desc\"}>\r\n   * ```\r\n   */\r\n  private sorts: Map<string, Array<any>>;\r\n  constructor() {\r\n    this.sorts = new Map<string, Array<any>>();\r\n  }\r\n  /**\r\n   * bingdingPath\r\n   * @param bindingPath bindingPath\r\n   * @param directionConverter converter\r\n   */\r\n  public getConditionsByBindingPath(bindingPath: string, directionConverter?: (direction: 'asc' | 'desc') => any) {\r\n    let conditions = this.sorts.get(bindingPath) || [];\r\n    if (conditions.length < 1) {\r\n      return conditions;\r\n    }\r\n    if (typeof directionConverter === 'function') {\r\n      conditions = conditions.map(condition => {\r\n        const sortType = directionConverter(condition.SortType);\r\n        return { SortField: condition.SortField, SortType: sortType };\r\n      });\r\n    }\r\n    return conditions;\r\n  }\r\n  /**\r\n   * \r\n   * @param bindingPath \r\n   * @param field \r\n   * @param direction  asc|desc\r\n   */\r\n  public addCondition(bindingPath: string, field: string, direction: string) {\r\n    // \r\n    if (!field || !direction) {\r\n      this.sorts.delete(bindingPath);\r\n      return;\r\n    }\r\n    const isBindingPathExist = this.sorts.has(bindingPath);\r\n    const condition = { SortField: field, SortType: direction };\r\n    if (!isBindingPathExist) {\r\n      this.sorts.set(bindingPath, [condition]);\r\n    } else {\r\n      const bindingPathSortConditions = this.sorts.get(bindingPath) || [];\r\n      // new condition will override the previous condition\r\n      const conditionIndex = bindingPathSortConditions.findIndex(item => item.SortField === field);\r\n      if (conditionIndex !== -1) {\r\n        bindingPathSortConditions[conditionIndex] = condition;\r\n      } else {\r\n        bindingPathSortConditions.push(condition);\r\n      }\r\n    }\r\n  }\r\n  public removeCondition(bindingPath: string, field: string) {\r\n    throw new Error('not implement!');\r\n  }\r\n  /**\r\n   * \r\n   * @param bindingPath bindingPath\r\n   * @param fields fields , seprated by comma\r\n   * @param directions directions , seprated by comma\r\n   * @description set conditions and overwrite all conditions which has the same bindingPath\r\n   */\r\n  public setConditions(bindingPath: string, fields: string, directions: string) {\r\n    // \r\n    if (!fields || !directions) {\r\n      this.sorts.delete(bindingPath);\r\n      return;\r\n    }\r\n    const filedsArray = fields.split(',').filter(item => item);\r\n    const directionsArray = directions.split(',').filter(item => item);\r\n    if (filedsArray.length !== directionsArray.length) {\r\n      throw new Error('arguments error,fields and direction are not match.');\r\n    }\r\n    const conditions = [];\r\n    filedsArray.forEach((field: string, index: number) => {\r\n      const condition = { SortField: field, SortType: directionsArray[index] };\r\n      conditions.push(condition);\r\n    });\r\n    this.sorts.set(bindingPath, conditions);\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  public clear() {\r\n    this.sorts.clear();\r\n  }\r\n\r\n}\r\n","/**\r\n * \r\n */\r\nexport class FilterConditionManager {\r\n    private filters: Map<string, Array<any>> = new Map<string, Array<any>>();\r\n    /**\r\n     * \r\n     * @param bindingPath \r\n     */\r\n    public getFilters(bindingPath: string) {\r\n        return this.filters.get(bindingPath) || [];\r\n    }\r\n    /**\r\n     * \r\n     * @param bindingPath \r\n     * @param merge \r\n     */\r\n    public mergeCondition(bindingPath: string, merge: (conditions: any) => any) {\r\n        const conditions = this.filters.get(bindingPath) || [];\r\n        const result = merge(conditions);\r\n        this.filters.set(bindingPath, result);\r\n    }\r\n    /**\r\n     * \r\n     * @param bindingPath \r\n     * @param condition \r\n     */\r\n    public addCondition(bindingPath: string, condition: any) {\r\n        // bindingPath\r\n        const conditions = this.filters.get(bindingPath);\r\n        const index = this.findConditionIndex(bindingPath, condition);\r\n        if (index !== -1) {\r\n            conditions[index] = condition;\r\n        } else {\r\n            conditions.push(condition);\r\n        }\r\n    }\r\n    /**\r\n     * \r\n     * @param bindingPath \r\n     * @param conditions \r\n     */\r\n    public addConditions(bindingPath: string, conditions: Array<any>) {\r\n        if (!conditions || !Array.isArray(conditions) || conditions.length < 1) {\r\n            return;\r\n        }\r\n        conditions.forEach(condition => {\r\n            this.addCondition(bindingPath, condition);\r\n        });\r\n    }\r\n    /**\r\n     * \r\n     * @param bindingPath \r\n     * @param predicate \r\n     */\r\n    public removeCondition(bindingPath: string, predicate: (value: any, index: number, array: any[]) => boolean) {\r\n        const conditions: Array<{ [propName: string]: any }> = this.filters.get(bindingPath);\r\n        if (!conditions || conditions.length < 1) {\r\n            return;\r\n        }\r\n        const removes = conditions.filter(predicate);\r\n        if (removes) {\r\n            removes.forEach(condition => {\r\n                const index = this.findConditionIndex(bindingPath, condition);\r\n                if (index >= 0) {\r\n                    conditions.splice(index, 1);\r\n                }\r\n            });\r\n        }\r\n    }\r\n    /**\r\n     * \r\n     */\r\n    public clear() {\r\n        this.filters.clear();\r\n    }\r\n    /**\r\n     * \r\n     * @param bindingPath \r\n     * @param conditions \r\n     */\r\n    public setConditions(bindingPath: string, conditions: Array<any>) {\r\n        this.filters.set(bindingPath, conditions);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param bindingPath \r\n     * @param condition \r\n     */\r\n    private findConditionIndex(bindingPath: string, condition: any) {\r\n        if (!condition || typeof (condition) !== 'object' || Object.keys(condition).length < 1) {\r\n            return -1;\r\n        }\r\n        const conditions: Array<any> = this.filters.get(bindingPath);\r\n        if (!conditions || conditions.length < 1) {\r\n            return -1;\r\n        }\r\n        return conditions.findIndex((value, index) => {\r\n            let isEqual = true;\r\n            const props = Object.keys(condition);\r\n            for (const prop of props) {\r\n                if (!(value && value.hasOwnProperty(prop) && value[prop] === condition[prop])) {\r\n                    isEqual = false;\r\n                    break;\r\n                }\r\n            }\r\n            return isEqual;\r\n        });\r\n    }\r\n}\r\n","// tslint:disable: no-bitwise\r\n// get uniqueId\r\nexport class UID {\r\n    private static previous = 0;\r\n    public static create(redix?: number) {\r\n        const timestamp = Date.now().valueOf();\r\n        let uuid = 0;\r\n        if (timestamp > UID.previous) {\r\n            UID.previous = timestamp;\r\n            uuid = timestamp;\r\n        } else {\r\n            UID.previous = UID.previous + 100;\r\n            uuid = UID.previous;\r\n        }\r\n        return uuid.toString(redix);\r\n    }\r\n}\r\n","/*\r\n * @Author: Witt\r\n * @Date: 2018-10-12 15:37:11\r\n * @Last Modified by: aalizzwell\r\n * @Last Modified time: 2019-09-03 19:10:44\r\n * @todo \r\n * 1apiUrlapi\r\n */\r\n\r\nimport { Type, Injectable, OnDestroy } from '@angular/core';\r\nimport { Observable, Subject } from 'rxjs';\r\n\r\nimport { DataTypeInfo, IDisposable } from '../core/index';\r\nimport { Modification } from '../changeset/index';\r\nimport { MetadataUtil } from '../metadata/index';\r\nimport { Entity, createEntity, createEntities, FieldMetadataUtil } from '../entity/index';\r\nimport { NgRepository } from './decorators';\r\nimport { EntityCollection } from './entity_collection';\r\nimport { PaginationManager } from './pagination_manager';\r\nimport { DataChangeHistory } from './data_change_history';\r\nimport { SortConditionManager } from './sort_condition_manager';\r\nimport { FilterConditionManager } from './filter_condition_manager';\r\nimport { UID } from '../misc/uid';\r\n\r\n/**\r\n * \r\n * @description\r\n * # Repository\r\n * \r\n * RepositoryEntityRepository\r\n * RepositoryEntityAPIRepositoryBindingDataBindingData\r\n * \r\n * ## \r\n * Repository\r\n * \r\n * - \r\n * \r\n *   ```javascript\r\n *    this.repository.entityCollection.getEntityById(\"id\");\r\n *   ```\r\n * \r\n * - \r\n * \r\n *   ```javascript\r\n *   this.repository.entityCollection.removeEntityById(\"id\")\r\n *   ```\r\n * \r\n * - \r\n * \r\n *   ```javascript\r\n *   this.repository.entityCollection.clear();\r\n *   ```\r\n * \r\n * - json\r\n * \r\n *   ```javascript\r\n *   this.repository.entityCollection.toJSON();\r\n *   ```\r\n * \r\n * - \r\n * \r\n *   ```javascript\r\n *   this.repository.entityCollection.addEntity(entity:T);\r\n *   ```\r\n * - \r\n * \r\n *   ```javascript\r\n *   const befRepository = this.repository as BefRepository<any>;\r\n *   const entityManager = befRepository.entityManager;\r\n *   entityManager.appendEntityByPath(\"/Id/s\",{JSON});\r\n *   ```\r\n * - \r\n * \r\n *   ```javascript\r\n *   this.repository.entityCollection.addEntities(entities:T[])\r\n *   ```\r\n *   \r\n * - \r\n * \r\n *   ```javascript\r\n *   const befRepository = this.repository as BefRepository<any>;\r\n *   const entityManager = befRepository.entityManager;\r\n *   const childrenEntities = entityManager.createEntitiesByPath([\"Id\",\"s\"], entityListData: any[])\r\n *   entityManager.appendEntitiesByPath([\"Id\",\"s\"],childrenEntities);\r\n *   ```\r\n * \r\n * - \r\n * \r\n *   ```javascript\r\n *   this.repository.entityCollection.loadEntities(entities:T[]);\r\n *   ```\r\n * \r\n *   > \r\n * \r\n * - \r\n * \r\n *   ```javascript\r\n *   this.repository.buildEntity(JSON);\r\n *   ```\r\n * \r\n * - \r\n * \r\n *   ```javascript\r\n *   this.repository.buildEntities(JSON);\r\n *   ```\r\n * \r\n * - \r\n * \r\n *   ```javascript\r\n *   const befRepository = this.repository as BefRepository<any>;\r\n *   const entityManager = befRepository.entityManager;\r\n *   entityManager.getEntityByPath([\"Id\",\"\",\"id\"]);\r\n *   ```\r\n * \r\n *   !> **** entityManagerBefRepositoryEntityManagerRepositoryBefRepository\r\n * \r\n * - \r\n * \r\n *   ```javascript\r\n *   const befRepository = this.repository as BefRepository<any>;\r\n *   const entityManager = befRepository.entityManager;\r\n *   entityManager.getEntitiesByPath([\"Id\",\"\"]);\r\n *   ```\r\n * \r\n *   > EntityManager\r\n *   >\r\n *   > ```javascript\r\n *   > entityManager.getEntitiesByPath([\"Id\"]);\r\n *   > ```\r\n *   \r\n * - \r\n * \r\n *   ```javascript\r\n *   const entity = this.repository.entityCollection.getEntityById(\"id\");\r\n *   cosnt name = entity['name'];\r\n *   // \r\n *   const entity: any = this.repository.entityCollection.getEntityById(\"id\");\r\n *   cosnt name = entity.name;\r\n *   ```\r\n * \r\n * ## \r\n * \r\n * \t\r\n * \r\n * - \r\n * \r\n *   ```javascript\r\n *   this.repository.updateById('id');\r\n *   ```\r\n * \r\n * - \r\n * \r\n *   ```javascript\r\n *   this.repository.removeById(\"id\");\r\n *   ```\r\n * \r\n * - \r\n * \r\n *   ```javascript\r\n *   this.repository.removeByIds(ids:string[])\r\n *   ```\r\n * \r\n * - \r\n * \r\n *   ```javascript\r\n *   this.repository.removeByPath(['Id','','Id'])\r\n *   ```\r\n * \r\n * - \r\n * \r\n *   ```javascript\r\n *   this.repository.append();\r\n *   ```\r\n * \r\n * - \r\n * \r\n *   ```javascript\r\n *   this.repository.appendByPath(['id','']);\r\n *   ```\r\n * \r\n * - \r\n * \r\n *   ```javascript\r\n *   this.repository.getById('id');\r\n *   ```\r\n * \r\n * - \r\n * \r\n *   ```javascript\r\n *   this.repository.getEntities(filter: any[], sorts: any[], pageSize: number | null, pageIndex: number | null)\r\n *   \r\n *   ```\r\n * \r\n *   > pageSizepageIndex\r\n * \r\n * - POST\r\n * \r\n *   ```javascript\r\n *   this.repository.filter(filter: any[], sorts: any[], pageSize: number | null, pageIndex: number | null)\r\n *   ```\r\n * \r\n * - \r\n * \r\n *   ```javascript\r\n *   this.repository.updateChangesById(\"id\");\r\n *   ```\r\n * \r\n * - \r\n * \r\n *   ```javascript\r\n *   this.repository.updateAllChanges();\r\n *   ```\r\n * \r\n * - \r\n * \r\n *   ```javascript\r\n *   this.repository.applyChanges();\r\n *   ```\r\n * \r\n * - \r\n * \r\n *   ```javascript\r\n *   this.repository.cancelChanges();\r\n *   ```\r\n * \r\n * - Repository\r\n * \r\n *   ```javascript\r\n *   const befRepository = this.repository as BefRepository<any>;\r\n *   befRepository.entityManager.clearAllEntityChanges();\r\n *   ```\r\n *   \r\n * - \r\n *   ```javascript\r\n *   this.repository.batchAppendByPath(path: string, defaultValues: Array<any>);\r\n *   ```\r\n *   \r\n *   > path `string`/id/nodeCode/1/orders\r\n *   >\r\n *   > defaultValues `Array<any>`keyvalue\r\n *   \r\n * - \r\n *   \r\n *   ```javascript\r\n *   this.repository.batchRemoveByPath(path: string, ids: string);\r\n *   ```\r\n *   \r\n *   > path `string` /id/nodeCode/1/orders\r\n *   >\r\n *   > ids `string` id`id1,id2,id3`\r\n */\r\n@Injectable()\r\nexport abstract class Repository<T extends Entity> implements IDisposable, OnDestroy {\r\n\r\n  // #region \r\n\r\n  /**\r\n   * \r\n   */\r\n  private innerName: string;\r\n\r\n  // #endregion\r\n\r\n  // #region \r\n\r\n  /**\r\n   * API\r\n   */\r\n  public apiUri: string;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public entityType: any;\r\n\r\n  /**\r\n   * \r\n   * @todoEntityTypeInfoDataTypeInfo\r\n   */\r\n  public entityTypeInfo: DataTypeInfo;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public entityCollection: EntityCollection<T>;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public paginationInfo: any = null;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public dataChangeHistory: DataChangeHistory;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public sortConditionManager: SortConditionManager;\r\n  /**\r\n   * \r\n   */\r\n  public filterConditionManager: FilterConditionManager;\r\n\r\n  // #endregion\r\n\r\n  // #region get/set\r\n\r\n  /**\r\n   * \r\n   */\r\n  public get primaryKey(): string {\r\n    return this.entityCollection.primaryKey;\r\n  }\r\n  public get changes(): Subject<Modification> {\r\n    return this.entityCollection.changes;\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  public get entityCollectionChange(): Subject<Modification> {\r\n    return this.entityCollection.collectionChanged;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public get name(): string {\r\n\r\n    // 1name\r\n    // 2construcotr.namename\r\n    if (!this.innerName) {\r\n      const guid = UID.create();\r\n      this.innerName = `Repository_${guid}`;\r\n    }\r\n\r\n    return this.innerName;\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  public set name(value: string) {\r\n    this.innerName = value;\r\n  }\r\n\r\n  public paginationManager: PaginationManager<T>;\r\n  public destroy$: Subject<any>;\r\n  // #endregion\r\n\r\n  /**\r\n   * \r\n   */\r\n  constructor() {\r\n    this.readMetadata();\r\n    if (this.entityType) {\r\n      this.entityTypeInfo = new DataTypeInfo(this.entityType);\r\n      this.entityCollection = new EntityCollection<T>(this.entityType);\r\n    }\r\n    this.dataChangeHistory = new DataChangeHistory();\r\n    this.sortConditionManager = new SortConditionManager();\r\n    this.filterConditionManager = new FilterConditionManager();\r\n    this.destroy$ = new Subject<any>();\r\n  }\r\n  dispose(options?: any) {\r\n\r\n    this.paginationManager = null;\r\n    if (this.destroy$) {\r\n      this.destroy$.next();\r\n      this.destroy$.complete();\r\n      this.destroy$ = null;\r\n    }\r\n    if (this.entityCollection) {\r\n      this.entityCollection.reset(false);\r\n      // this.entityCollection = null;\r\n    }\r\n\r\n  }\r\n  ngOnDestroy(): void {\r\n    this.dispose();\r\n  }\r\n\r\n  public updateEntityType(entityType: any) {\r\n    this.entityType = entityType;\r\n    this.entityTypeInfo = new DataTypeInfo(this.entityType);\r\n    this.entityCollection = new EntityCollection<T>(this.entityType);\r\n  }\r\n\r\n\r\n  /**\r\n   * \r\n   */\r\n  private readMetadata() {\r\n    const repositoryMetadata: NgRepository = MetadataUtil.getClassMetadataByName(this.constructor, 'NgRepository');\r\n    if (repositoryMetadata) {\r\n      // API\r\n      this.apiUri = repositoryMetadata.apiUrl;\r\n\r\n      // \r\n      this.entityType = repositoryMetadata.entityType;\r\n    }\r\n\r\n    // // API\r\n    // this.apiUri = repositoryMetadata.apiUrl;\r\n\r\n    // // \r\n    // this.entityType = repositoryMetadata.entityType;\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param config \r\n   */\r\n  setPaginationConfig(config: any) {\r\n    this.paginationManager = new PaginationManager(this.entityType, config);\r\n    const { pageSize = 0 } = this.paginationManager.getPaginationConfigByPath('/') || {};\r\n    // tslint:disable-next-line: max-line-length\r\n    this.entityCollection.paginationInfo = Object.assign({ pageSize }, this.paginationManager.pagination, this.entityCollection.paginationInfo);\r\n    // pageSize\r\n    // this.entityCollection.pageSize = pageSize;\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  public reset(): void {\r\n    this.entityCollection.reset();\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public buildEntity(data: any): T {\r\n    const entity = createEntity<T>(this.entityType, data);\r\n    return entity;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public buildEntities(listData: any[]): T[] {\r\n    const entities: T[] = createEntities<T>(this.entityType, listData);\r\n    return entities;\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param filters    \r\n   * @param sorts      \r\n   * @param pagination \r\n   */\r\n  abstract getEntities(filter: any[], sorts: any[], pageSize: number | null, pageIndex: number | null): Observable<T[]>;\r\n  /**\r\n   * \r\n   * @param filter \r\n   * @param sorts \r\n   * @param pageSize \r\n   * @param pageIndex \r\n   */\r\n  abstract filter(filter?: any[], sorts?: any[], pageSize?: number | null, pageIndex?: number | null): Observable<T[]>;\r\n  /**\r\n   * \r\n   */\r\n  abstract getList(): Observable<T[]>;\r\n  /**\r\n   * id\r\n   * @param id \r\n   */\r\n  abstract getById(id: string): Observable<T>;\r\n  /**\r\n   * id\r\n   * @param id id\r\n   */\r\n  abstract getEntityById(id: string): Observable<T>;\r\n  /**\r\n   * /\r\n   * @param path \r\n   * @param ids \r\n   * @param filter \r\n   * @param sort \r\n   */\r\n  abstract queryChild(paths: string[], pageIndex: number, pageSize: number, filter?: string, sort?: string): Observable<T[]>;\r\n  /**\r\n   * id\r\n   * @param id id\r\n   */\r\n  abstract updateById(id: string): Observable<T>;\r\n  /**\r\n   * ()\r\n   * @param id \r\n   */\r\n  abstract updateEntityById(id: string): Observable<T>;\r\n  /**\r\n   * \r\n   */\r\n  abstract create(): Observable<any>;\r\n\r\n  // /**\r\n  //  * \r\n  //  * @param path \r\n  //  */\r\n  // abstract createByPath(path: string);\r\n\r\n  /**\r\n   * \r\n   */\r\n  abstract append(): Observable<any>;\r\n\r\n  /**\r\n   * \r\n   * @param path \r\n   */\r\n  abstract appendByPath(path: string): Observable<any>;\r\n  /**\r\n   * \r\n   */\r\n  abstract insert(position: 1 | -1, defaultValue?: any): Observable<any>;\r\n  /**\r\n   * \r\n   * @param path \r\n   */\r\n  abstract insertByPath(path: string, position: 1 | -1): Observable<any>;\r\n  /**\r\n   * id\r\n   * @param id \r\n   */\r\n  abstract removeById(id: string, ifSave?: boolean): Observable<any>;\r\n\r\n  /**\r\n   * ids\r\n   * @param id ids\r\n   * @param ifSave \r\n   * @deprecated querystringbatchRemove\r\n   */\r\n  abstract removeByIds(ids: string[], ifSave?: boolean): Observable<any>;\r\n  /**\r\n   * ids\r\n   * @param ids ids\r\n   * @param ifSave \r\n   */\r\n  abstract batchRemove(ids: string[], ifSave?: boolean): Observable<any>;\r\n  /**\r\n   * idpath\r\n   */\r\n  abstract removeByPath(path: string, id: string);\r\n\r\n  /**\r\n   * id\r\n   */\r\n  abstract updateChangesById(id: string): Observable<boolean>;\r\n\r\n  /**\r\n   * path\r\n   */\r\n  abstract updateChangesByPath(path: string, id: string): Observable<boolean>;\r\n\r\n  /**\r\n   * \r\n   */\r\n  abstract updateAllChanges(): Observable<boolean>;\r\n\r\n  /**\r\n   * \r\n   */\r\n  abstract applyChanges(): Observable<boolean>;\r\n\r\n  /**\r\n   * id\r\n   */\r\n  abstract applyChangesById(id: string): Observable<boolean>;\r\n\r\n  /**\r\n   * \r\n   */\r\n  abstract cancelChanges(options?: any): Observable<boolean>;\r\n  /**\r\n   * \r\n   */\r\n  abstract batchRemoveByPath(path: string, ids: string): Observable<boolean>;\r\n  /**\r\n   * /\r\n   * @param path like 1/childs or 1/childs/11/childchilds\r\n   * @param defaultValues \r\n   * @description \r\n   */\r\n  abstract batchAppendByPath(path: string, defaultValues: Array<any>): Observable<any>;\r\n  /**\r\n   * \r\n   * @param defaultValues \r\n   */\r\n  abstract batchAppend(defaultValues: Array<any>): Observable<any>;\r\n\r\n}\r\n","/*\r\n * @Author: Witt\r\n * @Date: 2019-02-28 15:46:07\r\n * @Last Modified by: aalizzwell\r\n * @Last Modified time: 2019-09-03 19:10:53\r\n */\r\n\r\n\r\nimport { Injectable, Injector } from '@angular/core';\r\nimport { Observable } from 'rxjs';\r\nimport { Entity } from '../entity/index';\r\nimport { Repository } from './repository';\r\nimport { EntityManager } from './entity_manager';\r\n\r\n/**\r\n * Repository\r\n */\r\n@Injectable()\r\nclass DefaultRepository<T extends Entity> extends Repository<T> {\r\n  /**\r\n   * \r\n   * @internal\r\n   */\r\n  public entityManager: EntityManager<T>;\r\n\r\n  constructor(private injector: Injector) {\r\n    super();\r\n\r\n    // \r\n    this.entityManager = new EntityManager(this.entityCollection);\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public getEntities(filter: any[], sorts: any[], pageSize: number, pageIndex: number): Observable<T[]> {\r\n    throw new Error('Not Implemented');\r\n  }\r\n  public filter(filter: any[], sorts: any[], pageSize: number, pageIndex: number): Observable<T[]> {\r\n    throw new Error('Not Implemented');\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public getList(): Observable<T[]> {\r\n    throw new Error('Not Implemented');\r\n  }\r\n  /**\r\n   * id\r\n   * @param id id\r\n   */\r\n  public getById(id: string): Observable<T> {\r\n    throw new Error('Not Implemented');\r\n  }\r\n  /**\r\n   * id\r\n   * @param id id\r\n   */\r\n  public getEntityById(id: string): Observable<T> {\r\n    throw new Error('Not Implemented');\r\n  }\r\n  /**\r\n   * /\r\n   * @param path \r\n   * @param ids \r\n   * @param filter \r\n   * @param sort \r\n   */\r\n  public queryChild(paths: string[], pageIndex: number, pageSize: number, filter?: string, sort?: string): Observable<T[]> {\r\n    throw new Error('Not Implemented');\r\n  }\r\n  /**\r\n   * id\r\n   */\r\n  public updateById(id: string): Observable<T> {\r\n    throw new Error('Not Implemented');\r\n  }\r\n  /**\r\n   * ()\r\n   * @param id \r\n   */\r\n  public updateEntityById(id: string): Observable<T> {\r\n    throw new Error('Not Implemented');\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  public create(): Observable<any> {\r\n    throw new Error('Not Implemented');\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public append(): Observable<any> {\r\n    throw new Error('Not Implemented');\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public appendByPath(path: string): Observable<any> {\r\n    throw new Error('Not Implemented');\r\n  }\r\n  /**\r\n   * \r\n   * @param position \r\n   * @param defaultValue \r\n   */\r\n  public insert(position: 1 | -1, defaultValue?: any): Observable<any> {\r\n    throw new Error('Not Implemented');\r\n  }\r\n  /**\r\n   * \r\n   * @param path \r\n   * @param position \r\n   */\r\n  public insertByPath(path: string, position: 1 | -1): Observable<any> {\r\n    throw new Error('Not Implemented');\r\n  }\r\n  /**\r\n   * id\r\n   */\r\n  public removeById(id: string, ifSave?: boolean): Observable<any> {\r\n    throw new Error('Not Implemented');\r\n  }\r\n  /**\r\n   * ids\r\n   * @param ids ids\r\n   * @param ifSave \r\n   */\r\n  public batchRemove(ids: string[], ifSave?: boolean): Observable<any> {\r\n    throw new Error('Not Implemented');\r\n  }\r\n  /**\r\n   * ids\r\n   */\r\n  public removeByIds(id: string[], ifSave?: boolean): Observable<any> {\r\n    throw new Error('Not Implemented');\r\n  }\r\n\r\n  /**\r\n   * idpath\r\n   */\r\n  public removeByPath(path: string, id: string) {\r\n    throw new Error('Not Implemented');\r\n  }\r\n\r\n  /**\r\n   * id\r\n   */\r\n  public updateChangesById(id: string): Observable<boolean> {\r\n    throw new Error('Not Implemented');\r\n  }\r\n\r\n  /**\r\n   * path\r\n   */\r\n  public updateChangesByPath(path: string, id: string): Observable<boolean> {\r\n    throw new Error('Not Implemented');\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public updateAllChanges(): Observable<boolean> {\r\n    throw new Error('Not Implemented');\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public applyChanges(): Observable<boolean> {\r\n    throw new Error('Not Implemented');\r\n  }\r\n\r\n  /**\r\n   * id\r\n   */\r\n  public applyChangesById(id: string): Observable<boolean> {\r\n    throw new Error('Not Implemented');\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public cancelChanges(options?: any): Observable<boolean> {\r\n    throw new Error('Not Implemented');\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  public batchRemoveByPath(path: string, ids: string): Observable<boolean> {\r\n    throw new Error('Not Implemented');\r\n  }\r\n  /**\r\n   * /\r\n   * @param path like 1/childs or 1/childs/11/childchilds\r\n   * @param defaultValues \r\n   */\r\n  public batchAppendByPath(path: string, defaultValues: Array<any>): Observable<any> {\r\n    throw new Error('Not Implemented');\r\n  }\r\n  /**\r\n   * \r\n   * @param path like 1/childs or 1/childs/11/childchilds\r\n   * @param defaultValues \r\n   */\r\n  public batchAppend(defaultValues: Array<any>): Observable<any> {\r\n    throw new Error('Not Implemented');\r\n  }\r\n}\r\n\r\nexport { DefaultRepository };\r\n","import { Injectable } from '@angular/core';\r\nimport { DataTypeInfo } from '../core/index';\r\nimport { Repository } from '../repository/index';\r\nimport { ExpressionUtil } from '../utils/expression_util';\r\nimport { ENTITY_TEMPLATE, GROUP_FUNCTIONS, IResolver } from './types';\r\n\r\n@Injectable()\r\nexport class EntityDependencyResolver implements IResolver {\r\n  private entityTypeInfo: DataTypeInfo;\r\n  constructor(private repository: Repository<any>) {\r\n    this.entityTypeInfo = this.repository && this.repository.entityTypeInfo || null;\r\n  }\r\n  /**\r\n   * \r\n   * @param expr \r\n   * @returns \r\n   */\r\n  public resolve(expr: string): string[] {\r\n    const groupFunctionDependencies = ExpressionUtil.getGroupFunctionDependency(expr, this.repository.entityTypeInfo);\r\n    const entityDependencies = this.getEntityDependency(expr);\r\n    // \r\n    if (groupFunctionDependencies && groupFunctionDependencies.length > 0 && entityDependencies && entityDependencies.length > 0) {\r\n      groupFunctionDependencies.forEach((dep: string) => {\r\n        const index = entityDependencies.findIndex(item => dep.startsWith(item));\r\n        if (index !== -1) {\r\n          entityDependencies.splice(index, 1);\r\n        }\r\n      });\r\n    }\r\n    // \r\n    const merged = [...groupFunctionDependencies, ...entityDependencies];\r\n    const deps = [...new Set(merged)];\r\n    return deps;\r\n  }\r\n  /**\r\n   * \r\n   * @param entityPropertyExpression \r\n   * @returns \r\n   */\r\n  private getValidEntityPropertyExpression(entityPropertyExpression: string): string[] {\r\n    const propPaths = entityPropertyExpression.split('.');\r\n    let propInfo = null;\r\n    try {\r\n      propInfo = this.entityTypeInfo.getPropInfoByPath(propPaths);\r\n    } catch (e) { }\r\n    if (!propInfo) {\r\n      if (propPaths.length > 1) {\r\n        propPaths.pop();\r\n        return this.getValidEntityPropertyExpression(propPaths.join('.'));\r\n      } else {\r\n        return null;\r\n      }\r\n    } else {\r\n      return entityPropertyExpression.split('.');\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   * @param expr \r\n   * @returns \r\n   */\r\n  private getEntityDependency(expr: string): string[] {\r\n    const deps = [];\r\n    if (this.entityTypeInfo) {\r\n      // \r\n      const regex = new RegExp(`[\\\\'\\\\\"]?\\\\s*(${this.entityTypeInfo.entityInfo.nodeCode}|${this.entityTypeInfo.entityInfo.originalCode})[\\\\.\\\\[\\\\]a-zA-Z0-9_]+\\\\s*[\\\\'\\\\\"]?`, 'g');\r\n      const entityPropertyExpressions: RegExpMatchArray = expr.match(regex);\r\n      if (Array.isArray(entityPropertyExpressions) && entityPropertyExpressions.length > 0) {\r\n        // \r\n        entityPropertyExpressions.forEach((item: string) => {\r\n          if (item.indexOf('.') === -1) {\r\n            return;\r\n          }\r\n          // \r\n          item = item.trim().replace(/\\\"/g, '');\r\n          const paths = ExpressionUtil.convertToNodeCode(item, this.repository.entityTypeInfo);\r\n          item = paths.join('.');\r\n          // \r\n          item = item.substr(item.indexOf('.') + 1);\r\n          const dep = this.getValidEntityPropertyExpression(item);\r\n          if (dep && Array.isArray(dep) && dep.length > 0) {\r\n            // \r\n            dep.splice(0, 0, ENTITY_TEMPLATE);\r\n            deps.push(dep.join('/'));\r\n          }\r\n        });\r\n      }\r\n    } else {\r\n    }\r\n    return deps;\r\n  }\r\n\r\n}","import { IResolver } from \"./types\";\r\nconst CONTEXT_FUNCTIONS = ['GetContextParameter', 'GetSessionValue'];\r\nexport class StateDependencyResolver implements IResolver {\r\n  public resolve(expr: string): string[] {\r\n    const deps = [];\r\n    const regex = new RegExp(`DefaultFunction\\\\.(${CONTEXT_FUNCTIONS.join('|')})\\\\s*\\\\([^\\\\r\\\\n\\\\)]*\\\\)`, 'g');\r\n    const contextFunctions: RegExpMatchArray = expr.match(regex);\r\n    if (contextFunctions && contextFunctions.length > 0) {\r\n      // todo: ast\r\n      const argumentsRegex = /\\(([^\\r\\n\\)]*)\\)/;\r\n      contextFunctions.forEach((groupFunction: string) => {\r\n        const argumentMatchResult = groupFunction.match(argumentsRegex);\r\n        if (argumentMatchResult.length === 2) {\r\n          const argument = argumentMatchResult[1].trim().replace(/\\\"/g,'');\r\n          const dep = ['STATE~'];\r\n          dep.push(argument);\r\n          deps.push(dep.join('/'));\r\n        }\r\n      });\r\n    }\r\n    return deps;\r\n  }\r\n}","import { Injectable } from \"@angular/core\";\r\nimport { IResolver } from \"./types\";\r\n/**\r\n * \r\n */\r\n@Injectable()\r\nexport class CommentDependencyResolver implements IResolver {\r\n  public resolve(expr: string): string[] {\r\n    const dependencies = [];\r\n    if (!expr || expr.length < 1) {\r\n      return dependencies;\r\n    }\r\n    const defineRegex = /\\/\\*\\*\\s*__define__\\((.*)\\)\\s*\\*\\//;\r\n    const defineMatchArray: RegExpMatchArray = expr.match(defineRegex);\r\n    if (defineMatchArray && defineMatchArray.length === 2) {\r\n      const defineString: string = defineMatchArray[1].trim();\r\n      let defineObject = null;\r\n      try {\r\n        defineObject = JSON.parse(defineString);\r\n      } catch (e) { console.warn(`${defineString}`); }\r\n      if (defineObject && defineObject.hasOwnProperty('deps') && Array.isArray(defineObject['deps'])) {\r\n        dependencies.push(...defineObject['deps']);\r\n      }\r\n    }\r\n    return dependencies;\r\n  }\r\n}","import { Injectable, Injector } from \"@angular/core\";\r\nimport { CommentDependencyResolver } from \"./comment_dependency_resolver\";\r\nimport { ResolverRegistry } from \"./resolver_registry\";\r\nimport { IResolver } from \"./types\";\r\n\r\n@Injectable()\r\nexport class ResolveService {\r\n  constructor(private injector: Injector, private resolverRegistry: ResolverRegistry) { }\r\n  public resolve(expression: string) {\r\n    const deps: string[] = [];\r\n    if (!this.resolverRegistry || !this.resolverRegistry.resolvers || this.resolverRegistry.resolvers.length < 1) {\r\n      return;\r\n    }\r\n    // \r\n    const commentDependencyResolver = this.resolverRegistry.resolvers.find((resolver: IResolver) => resolver instanceof CommentDependencyResolver);\r\n    if (commentDependencyResolver) {\r\n      const commentDependencies = commentDependencyResolver.resolve(expression);\r\n      if (commentDependencies && Array.isArray(commentDependencies) && commentDependencies.length > 0) {\r\n        deps.push(...commentDependencies);\r\n      }\r\n    }\r\n    // \r\n    if (deps && deps.length > 0) {\r\n      return deps;\r\n    }\r\n    this.resolverRegistry.resolvers.forEach((resolver: IResolver) => {\r\n      // \r\n      if (resolver instanceof CommentDependencyResolver) {\r\n        return;\r\n      }\r\n      const dependency = resolver.resolve(expression);\r\n      if (dependency && dependency.length > 0) {\r\n        deps.push(...dependency);\r\n      }\r\n    });\r\n    // \r\n    return [...new Set(deps)];\r\n  }\r\n}","import { BindingData, BindingList } from \"../binding-data/index\";\r\nimport { DataPropGroup, DataPropInfo, DataTypeInfo } from \"../core/index\";\r\nimport { ENTITY_TEMPLATE, GROUP_FUNCTIONS } from \"../resolver/index\";\r\n\r\nexport class ExpressionUtil {\r\n  public static getGroupFunctionDependency(expr: string, entityTypeInfo: DataTypeInfo): string[] {\r\n    const deps = [];\r\n    // \r\n    const groupFunctionRegex = new RegExp(`DefaultFunction\\\\.(${GROUP_FUNCTIONS.join('|')})\\\\s*\\\\([^\\\\r\\\\n\\\\)]*\\\\)`, \"g\");\r\n    const groupFunctions: RegExpMatchArray = expr.match(groupFunctionRegex);\r\n    if (groupFunctions && groupFunctions.length > 0) {\r\n      // todo: ast\r\n      const argumentsRegex = /\\(([^\\r\\n\\)]*)\\)/;\r\n      const methodNameRegex = /DefaultFunction\\.(\\S*)\\(/;\r\n      groupFunctions.forEach((groupFunction: string) => {\r\n        const argumentMatchResult = groupFunction.match(argumentsRegex);\r\n        const methodNameMatchResult = groupFunction.match(methodNameRegex);\r\n        let methodName = null;\r\n        if (methodNameMatchResult && methodNameMatchResult.length == 2) {\r\n          methodName = methodNameMatchResult[1];\r\n        }\r\n        if (argumentMatchResult.length === 2) {\r\n          const argument = argumentMatchResult[1];\r\n          const args = argument.split(',').map(p => p.replace(/\\\"/g, ''));\r\n          if (args && args.length === 2) {\r\n            let item: any = args.join('.');\r\n            item = this.convertToNodeCode(item, entityTypeInfo).join('.');\r\n            // code\r\n            item = item.substr(item.indexOf('.') + 1);\r\n            const dep = item.split('.');\r\n            dep.splice(0, 0, ENTITY_TEMPLATE);\r\n            deps.push(dep.join('/'));\r\n          } else if (args && args.length === 3 && methodName === 'MultiplyChildNumber') {\r\n            // support MultiplyChildNumber\r\n            // [Entity.childrens,prop1,prop2]\r\n            const prefix = args[0]; // like Entity.childrens\r\n            //const tableName = args[0];// prefix.substring(prefix.indexOf('.')+1);\r\n            const prop1FullPath = `${prefix}.${args[1]}`;\r\n            const prop2FullPath = `${prefix}.${args[2]}`;\r\n            [prop1FullPath, prop2FullPath].forEach(item => {\r\n              item = this.convertToNodeCode(item, entityTypeInfo).join('.');\r\n              item = item.substr(item.indexOf('.') + 1);\r\n              const dep = item.split('.');\r\n              dep.splice(0, 0, ENTITY_TEMPLATE);\r\n              deps.push(dep.join('/'));\r\n            });\r\n          } else {\r\n            throw new Error(` ${JSON.stringify(argument)}`);\r\n          }\r\n        }\r\n      });\r\n    }\r\n    return deps;\r\n  }\r\n  /**\r\n   * voCodenodeCode\r\n   * @param entityExpression like Entity.Child.p1\r\n   * @returns \r\n   */\r\n  public static convertToNodeCode(entityExpression: string, entityTypeInfo: DataTypeInfo): string[] {\r\n    // UserEntity.storys.p1\r\n    const nodeCodes = [];\r\n    if (entityTypeInfo && entityExpression.includes('.')) {\r\n      const entityExpressions = entityExpression.split('.') || [];\r\n      let dataTypeInfo = entityTypeInfo;\r\n      for (let index = 0; index < entityExpressions.length; index++) {\r\n        const prop = entityExpressions[index];\r\n        if (dataTypeInfo && dataTypeInfo.entityInfo && dataTypeInfo.entityInfo.nodeCode === prop || dataTypeInfo.entityInfo.originalCode === prop) {\r\n          // codenodeCode\r\n          if (index === 0) {\r\n            nodeCodes.push(dataTypeInfo.entityInfo.originalCode);\r\n          } else {\r\n            nodeCodes.push(dataTypeInfo.entityInfo.nodeCode);\r\n          }\r\n\r\n          // \r\n          const nextNodeCode = entityExpressions[index + 1];\r\n          if (!nextNodeCode) {\r\n            break;\r\n          }\r\n          const nextNodeCodePropInfo = dataTypeInfo.getPropInfoByName(nextNodeCode);\r\n          if (!nextNodeCodePropInfo) {\r\n            break;\r\n          }\r\n          // \r\n          if (nextNodeCodePropInfo.typeInfo) {\r\n            dataTypeInfo = nextNodeCodePropInfo.typeInfo;\r\n          }\r\n        } else if (dataTypeInfo && dataTypeInfo.getPropInfoByName(prop)) {\r\n          const dataPropInfo = dataTypeInfo.getPropInfoByName(prop);\r\n          nodeCodes.push(dataPropInfo.name);\r\n        } else {\r\n          //throw new Error(` ${entityExpression}`);\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    return nodeCodes;\r\n  }\r\n  /**\r\n   * \r\n   * @param dataTypeInfo \r\n   * @param results \r\n   * @param paths \r\n   */\r\n  public static getChildrenEntityPaths(dataTypeInfo: DataTypeInfo, results: any[], paths: string[] = []) {\r\n    const list: DataPropInfo[] = dataTypeInfo.getPropInfosByGroup(DataPropGroup.List);\r\n    if (list && list.length > 0) {\r\n      list.forEach((dataPropInfo: DataPropInfo) => {\r\n        if (paths.length === 0) {\r\n          results.push([dataPropInfo.name]);\r\n        }\r\n        const childrens: DataPropInfo[] = dataPropInfo.typeInfo.getPropInfosByGroup(DataPropGroup.List);\r\n        if (childrens && childrens.length > 0) {\r\n          paths.push(dataPropInfo.name);\r\n          childrens.forEach((dataPropInfo: DataPropInfo) => {\r\n            this.getChildrenEntityPaths(dataPropInfo.typeInfo, results, paths);\r\n          });\r\n        } else {\r\n          if (paths.length !== 0) {\r\n            paths.push(dataPropInfo.name);\r\n            results.push([...paths]);\r\n          }\r\n          paths.length = 0;\r\n        }\r\n      });\r\n    } else {\r\n      if (paths.length > 0) {\r\n        paths.push(dataTypeInfo.entityInfo.nodeCode);\r\n        results.push([...paths]);\r\n      }\r\n      paths.length = 0;\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   * @param paths \r\n   * @param bindingData \r\n   * @returns \r\n   */\r\n  public static getCurrentRowByPaths(paths: string[], bindingData: BindingData): null | { [prop: string]: any } {\r\n    let result = null;\r\n    const bindingList: BindingList = bindingData.getValue(paths) as BindingList;\r\n    if (bindingList && bindingList.length > 0) {\r\n      let primaryValue = bindingList.currentItem.primaryKeyValue || null;\r\n      // \r\n      // \r\n      if (primaryValue) {\r\n        const bindingObject = bindingList.findById(primaryValue);\r\n        if (bindingObject) {\r\n          result = bindingObject.toJSON();\r\n        }\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n  /**\r\n   * \r\n   * @param paths \r\n   * @returns \r\n   */\r\n  public static getAvailableChildrenPathsFromEntityPaths(paths: string[], entityTypeInfo: DataTypeInfo): string[] {\r\n    let nodeCodes = [];\r\n    paths = [...paths];\r\n    while (paths.length > 0) {\r\n      const dataPropInfo = entityTypeInfo.getPropInfoByPath(paths);\r\n      if (dataPropInfo && dataPropInfo.group === 'List') {\r\n        nodeCodes = paths;\r\n        break;\r\n      }\r\n      paths.pop();\r\n    }\r\n    return nodeCodes;\r\n  }\r\n  /**\r\n   * \r\n   * @param paths \r\n   * @param entityTypeInfo entityTypeInfo\r\n   * @returns \r\n   */\r\n  public static getBindingPath(paths: string[], entityTypeInfo: DataTypeInfo) {\r\n    paths = this.getEntityPath(paths);\r\n    const entityPaths = this.getAvailableChildrenPathsFromEntityPaths(paths, entityTypeInfo);\r\n    return entityPaths;\r\n  }\r\n  public static getEntityPath(path: string[]): string[] {\r\n    const paths = path.filter((value: string, index: number) => {\r\n      if (index % 2 === 0 && value.includes(':')) {\r\n        return false;\r\n      } else {\r\n        return true;\r\n      }\r\n    });\r\n    return paths;\r\n  }\r\n}","import { DataPropGroup, DataPropInfo, DataTypeInfo } from \"../core\";\r\n\r\nexport class DataTypeInfoUtil {\r\n  /**\r\n   * \r\n   * @param dataTypeInfo \r\n   * @param results \r\n  */\r\n  public static getChildrenNodeCodes(dataTypeInfo: DataTypeInfo, results: any[] = []) {\r\n    const list: DataPropInfo[] = dataTypeInfo.getPropInfosByGroup(DataPropGroup.List);\r\n    if (list && list.length > 0) {\r\n      list.forEach((dataPropInfo: DataPropInfo) => {\r\n        results.push(dataPropInfo.name);\r\n        const childrens: DataPropInfo[] = dataPropInfo.typeInfo.getPropInfosByGroup(DataPropGroup.List);\r\n        if (childrens && childrens.length > 0) {\r\n          childrens.forEach((dataPropInfo: DataPropInfo) => {\r\n            results.push(dataPropInfo.name);\r\n            this.getChildrenNodeCodes(dataPropInfo.typeInfo, results);\r\n          });\r\n        }\r\n      });\r\n    }\r\n  }\r\n}\r\n","// tslint:disable: max-line-length\r\nimport { ElementRef, Injectable, Injector, OnDestroy } from '@angular/core';\r\nimport { AbstractControl } from '@angular/forms';\r\nimport { filter, takeUntil } from 'rxjs/operators';\r\nimport { FormControl, FormGroup, ValidatorFn } from '@angular/forms';\r\nimport { BigNumber } from 'bignumber.js';\r\nimport { MetadataUtil, PROP_METADATA } from '../metadata/index';\r\nimport { FrameContext } from '../frame/index';\r\nimport { BindingData, Change, ChangeType, BindingObject } from '../binding-data/index';\r\nimport { ValidateRule, Validation } from '../entity/validator/types';\r\nimport {\r\n  NG_FORM_CONTROL, NgFormControl,\r\n  NG_CHILD_FORM, NgChildForm,\r\n  NgValidateForm, NG_VALIDATE_FORM\r\n} from './decorators';\r\nimport { ControlValueConverter } from './control_value_converter';\r\nimport { DateUtil } from '../utils/index';\r\nimport { Translate } from '../i18n/translate';\r\nimport { ValidationTypes } from '../entity/validator/validation_types';\r\nimport { ValidationExecutor } from '../entity/validator/validation_executor';\r\nimport * as ValidatorJS from 'validator';\r\nimport { ValidationError } from '../entity';\r\nimport { DataPropInfo, DataTypeInfo, RunMode } from '../core';\r\nimport { TranslateService } from '../i18n/translate_service';\r\nimport { RuleType } from './types';\r\nimport { IDisposable } from '../core';\r\nimport { Subject } from 'rxjs';\r\nimport { parseISO } from 'date-fns';\r\n/**\r\n * \r\n */\r\n@Injectable()\r\nclass Form extends FormGroup implements IDisposable, OnDestroy {\r\n\r\n  /**\r\n   * \r\n   */\r\n  static insMap: {\r\n    [formName: string]: Form\r\n  } = {};\r\n\r\n  /**\r\n   * \r\n   */\r\n  public get formGroupName() {\r\n    return this.ngValidateForm ? this.ngValidateForm.formGroupName : '';\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public get enableValidate() {\r\n    return this.ngValidateForm ? this.ngValidateForm.enableValidate : false;\r\n  }\r\n\r\n  public get translateService(): Translate {\r\n    return this.translate;\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  // private excludeRuleTypes: { [propertyName: string]: string[] };\r\n\r\n  /**\r\n   * \r\n   */\r\n  protected frameContext: FrameContext;\r\n\r\n  /**\r\n   * \r\n   */\r\n  constructor() {\r\n    super({}, null, null);\r\n    this.controlIdMap = {};\r\n    this.cardControls = {};\r\n    this.isShowPropMap = {};\r\n    this.destroy$ = new Subject<any>();\r\n    // this.excludeRuleTypes = {};\r\n  }\r\n  ngOnDestroy(): void {\r\n    this.dispose();\r\n  }\r\n  dispose(options?: any) {\r\n    if (this.destroy$) {\r\n      this.destroy$.next();\r\n      this.destroy$.complete();\r\n      this.destroy$ = null;\r\n    }\r\n    Form.insMap[this.constructor.name] = null;\r\n    this.frameContext = null;\r\n    this.bindingData = null;\r\n    this.ngChildForms = null;\r\n    this.metaDatas = null;\r\n    this.ngFormControls = {};\r\n    this.controls = {};\r\n    this.disposeValidation();\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  protected bindingData: BindingData;\r\n  /**\r\n   * \r\n   */\r\n  protected bindingPath: string;\r\n  /**\r\n   * Form\r\n   */\r\n  private ngValidateForm: NgValidateForm;\r\n  /**\r\n   * FormControl\r\n   */\r\n  public ngFormControls: { [propName: string]: NgFormControl };\r\n  /**\r\n   * \r\n   */\r\n  public metaDatas: { [propName: string]: any };\r\n  /**\r\n   * FormGroup\r\n   */\r\n  private ngChildForms: { [propName: string]: NgChildForm };\r\n  /**\r\n   * \r\n   */\r\n  private controlIdMap: {\r\n    [id: string]: {\r\n      [propName: string]: object\r\n    }\r\n  };\r\n  /**\r\n   * \r\n   */\r\n  private cardControls: object;\r\n  private raisedByValidateEffector = false;\r\n  public isShowValidationMsg = false;\r\n\r\n  // map,keyhtml\r\n  public isShowPropMap: {\r\n    [domPropertyName: string]: boolean\r\n  };\r\n\r\n  private translate: Translate;\r\n\r\n  private validatorJs = ValidatorJS.default;\r\n  private destroy$: Subject<any>;\r\n  /**\r\n   * formControlcardControl\r\n   */\r\n  static updateErrors(propertyName, errorObj, id, value?, isGrid?) {\r\n    Object.keys(Form.insMap).forEach(key => {\r\n      const form = Form.insMap[key];\r\n      if (!form) {\r\n        return;\r\n      }\r\n      if (id) {\r\n        form.setControlValue(propertyName, value);\r\n      }\r\n      if (form.enableValidate) {\r\n        form.isFormValid(propertyName, errorObj, id, isGrid);\r\n      }\r\n    });\r\n  }\r\n  /**\r\n   * dom\r\n   * @param domPropertyName dom\r\n   */\r\n  public setIsShowmap(domPropertyName: string) {\r\n    this.isShowPropMap[domPropertyName] = true;\r\n  }\r\n\r\n  public setShowValidationMsg(flag: boolean) {\r\n    this.raisedByValidateEffector = false;\r\n    this.isShowValidationMsg = flag;\r\n  }\r\n\r\n  public setControlValue(key: string, value: any) {\r\n    const bindingObject: BindingObject = this.bindingData && this.bindingData.getObject() || null;\r\n    if (bindingObject && bindingObject.controlMap) {\r\n      bindingObject.controlMap[key] = this.getGridItemControl(key, value);\r\n    }\r\n  }\r\n  /**\r\n   * dom\r\n   * @param domPropertyName dom\r\n   */\r\n  public getCardControlErrors(domPropertyName?: string): object {\r\n    this.setIsShowmap(domPropertyName);\r\n    return this.cardControls[domPropertyName] && this.cardControls[domPropertyName].errors;\r\n  }\r\n  /**\r\n   * \r\n   * @param domPropertyName \r\n   * @returns \r\n   */\r\n  public getFormControlErrors(domPropertyName?: string) {\r\n    return this.cardControls[domPropertyName] && this.cardControls[domPropertyName].errors;\r\n  }\r\n  public getGridControlErrors(domPropertyName: string, id: string): object {\r\n    this.setIsShowmap(domPropertyName);\r\n    return this.controlIdMap[id] && this.controlIdMap[id][domPropertyName] && this.controlIdMap[id][domPropertyName]['errors'];\r\n  }\r\n\r\n  public isFormValid(propertyName?: string, errorObj?: object, id?: string, isGrid?: boolean): boolean {\r\n    let prefix = '';\r\n    // \r\n    if (this.raisedByValidateEffector) {\r\n      return;\r\n    }\r\n    const isGridComponent = this.frameContext.frameComponent.isGridComponent;\r\n    if (isGridComponent !== undefined) {\r\n      isGrid = isGridComponent;\r\n    }\r\n    //frontNodeCode\r\n    const bindingPaths = this.bindingPath.split('/').filter(p => p);\r\n    if (bindingPaths.length > 0) {\r\n      prefix = bindingPaths.join('.').concat('.');\r\n    }\r\n    // \r\n    const domPropertyName = this.getDomPropertyNameByEntityProp(propertyName, prefix);\r\n    // dom\r\n    if (propertyName && !domPropertyName) {\r\n      return true;\r\n    }\r\n    // \r\n    if (domPropertyName && !this.isShowPropMap[domPropertyName]) {\r\n      return true;\r\n    }\r\n    let isValid = true;\r\n    const bindingObject = this.bindingData.getObject();\r\n    const currentId = bindingObject.primaryKeyValue;\r\n    const isSubForm = this.bindingPath !== '/';\r\n    const bindingList = this.bindingData.getList();\r\n\r\n    // \r\n    if (isSubForm && bindingList.innerList.size === 0) {\r\n      return true;\r\n    }\r\n    // \r\n    if (!currentId) {\r\n      return true;\r\n    }\r\n    // dataGrididformControl\r\n    if (id && domPropertyName) {\r\n      // if (this.controlIdMap[id] && Object.keys(this.controlIdMap[id]).length === 0) {\r\n      //   this.controlIdMap[id] = {};\r\n      // }\r\n      this.controlIdMap[id] = this.controlIdMap[id] || {};\r\n      this.controlIdMap[id][domPropertyName] = {\r\n        errors: errorObj\r\n      };\r\n    }\r\n\r\n    // gridFormControlcontrolIDMap\r\n    // const currentBindingObject = bindingList.currentItem as BindingObject;\r\n    const currentBindingObject: BindingObject = bindingObject;\r\n\r\n    if (id && id !== currentId) {\r\n      return;\r\n    }\r\n\r\n    // \r\n    if (!propertyName && !id) {\r\n      currentBindingObject.controlMap = {};\r\n      this.controlIdMap = {};\r\n      this.cardControls = {};\r\n    }\r\n    Object.keys(this.controls).forEach((key) => {\r\n      if (this.isShowPropMap[key] !== true) {\r\n        return;\r\n      }\r\n      // \r\n      if (key === domPropertyName) {\r\n        // \r\n        if (errorObj && Object.keys(errorObj).length > 0) {\r\n          // \r\n          if (!isGrid) {\r\n            // {ruleType:{name:'',value:'',originalErrors:[ValidationError]}}name\r\n            // validator\r\n            Object.keys(errorObj).map((validType: any) => {\r\n              const validationError: ValidationError = errorObj[validType] && errorObj[validType]['error'] || null;\r\n              if (validationError) {\r\n                const validateRule: ValidateRule = validationError.rule;\r\n                const ngFormControl = this.getngFormControlByBinding(validateRule.field);\r\n                if (ngFormControl) {\r\n                  validateRule.property = ngFormControl.name || ngFormControl.defaultI18nValue;\r\n                  validateRule.targetId = ngFormControl.id;\r\n                  validateRule.targetName = this.formGroupName;\r\n                  // key\r\n                  const fixedValidType = validType === 'require' ? 'required' : validType;\r\n                  const messageTemplate = ValidationTypes.getMessage(fixedValidType);\r\n                  if (messageTemplate) {\r\n                    const invalidMessage = ValidationExecutor.replaceMessageSpecialTokens(messageTemplate, validateRule, ngFormControl.name);\r\n                    errorObj[validType]['name'] = invalidMessage;\r\n                  }\r\n                }\r\n                // todo: ngFormControl\r\n                // errorObj['name'] = this.getErrorByRuleType(validType, validateRule, null);\r\n              }\r\n            });\r\n            this.cardControls[key] = {\r\n              errors: errorObj\r\n            };\r\n          }\r\n        } else {\r\n          this.cardControls[key] = {};\r\n        }\r\n      }\r\n      if (this.controls[key] && this.controls[key].errors && Object.keys(this.controls[key].errors).length > 0) {\r\n        // \r\n        // \r\n        this.cardControls[key] = {\r\n          errors: {\r\n            ...this.cardControls[key] && this.cardControls[key].errors,\r\n            ...this.controls[key].errors\r\n          }\r\n        };\r\n        isValid = false;\r\n      }\r\n    });\r\n    // BE\r\n    if (this.cardControls) {\r\n      Object.keys(this.cardControls).forEach(key => {\r\n        if (this.cardControls[key] && this.cardControls[key].errors) {\r\n          Object.keys(this.cardControls[key].errors).forEach(validType => {\r\n            if (typeof this.cardControls[key].errors[validType] !== 'object') {\r\n              // \r\n              const validateRules: ValidateRule | ValidateRule[] = this.ngFormControls[key].validRules || [];\r\n              const rules: ValidateRule[] = [].concat(validateRules);\r\n              const validateRule: ValidateRule = rules.find(item => item.type === validType);\r\n              if (validateRule) {\r\n                validateRule.targetName = this.formGroupName;\r\n                const messageTemplate = ValidationTypes.getMessage(validType);\r\n                const invalidMessage = ValidationExecutor.replaceMessageSpecialTokens(messageTemplate, validateRule, '');\r\n                this.cardControls[key].errors[key] = { value: this.controls[key] && this.controls[key].value || '', name: invalidMessage };\r\n              }\r\n            }\r\n          })\r\n        }\r\n      });\r\n    }\r\n    Object.keys(this.cardControls).forEach((key) => {\r\n      if (this.cardControls[key] && this.cardControls[key].errors && Object.keys(this.cardControls[key].errors).length > 0) {\r\n        isValid = false;\r\n      }\r\n    });\r\n    return isValid;\r\n  }\r\n  /**\r\n   * \r\n   * @param errors \r\n   */\r\n  public updateFormErrors(errors: { [domPropertyName: string]: { errors: { [ruleType: string]: { name: string, [prop: string]: any } } } }, forceShow: boolean = false, from: string = '') {\r\n    if (from && from === 'backend') {\r\n      this.clearBackendError();\r\n    }\r\n    // \r\n    if (this.isShowValidationMsg === true || forceShow === true) {\r\n      this.isShowValidationMsg = true;\r\n      Object.keys(errors).forEach((key: string) => {\r\n        if (errors[key].errors && Object.keys(errors[key].errors).length > 0) {\r\n          // \r\n          this.cardControls[key] = {\r\n            errors: {\r\n              ...this.cardControls[key] && this.cardControls[key].errors,\r\n              ...errors[key].errors\r\n            }\r\n          };\r\n        } else {\r\n          // \r\n          this.cardControls[key] = {\r\n            errors: {}\r\n          };\r\n          // \r\n          this.controls[key].setErrors(null);\r\n          this.controls[key].markAsTouched();\r\n        }\r\n      });\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  public clearBackendError() {\r\n    Object.keys(this.cardControls).forEach(key => {\r\n      const errors = this.cardControls[key] && this.cardControls[key].errors || null;\r\n      if (errors) {\r\n        Object.keys(errors).forEach(errorType => {\r\n          if (errorType && errorType.startsWith('backend-message-')) {\r\n            delete errors[errorType];\r\n          }\r\n        });\r\n        if (errors && Object.keys(errors).length === 0) {\r\n          delete this.cardControls[key].errors;\r\n        }\r\n      } else {\r\n        this.cardControls[key] = {};\r\n      }\r\n    });\r\n  }\r\n  /**\r\n   * ngFormControl\r\n   * @param binding \r\n   */\r\n  private getngFormControlByBinding(binding: string) {\r\n    return Object.values(this.ngFormControls).find((ngFormControl: NgFormControl) => ngFormControl.binding && ngFormControl.binding === binding);\r\n  }\r\n  private disposeValidation() {\r\n    const properties = this.constructor[PROP_METADATA];\r\n    if (properties && Object.keys(properties).length > 0) {\r\n      Object.keys(properties).forEach((key: string) => {\r\n        const props = this.constructor[PROP_METADATA][key] as any[];\r\n        if (props && props.length > 0) {\r\n          props.forEach((item) => {\r\n            if (item.validRules && Array.isArray(item.validRules) && item.validRules.length > 0) {\r\n              item.validRules = item.validRules.filter(item => !(item.eval && typeof (item.eval) === 'function'));\r\n            }\r\n          });\r\n        }\r\n      });\r\n    }\r\n  }\r\n  /**\r\n   * dom\r\n   * @param domProperty dom\r\n   * @param validateRuleType \r\n   */\r\n  private getErrorMessage(domProperty: string, validateRuleType: string) {\r\n    const formControl = this.ngFormControls[domProperty];\r\n    if (formControl) {\r\n      const validRules = formControl.validRules;\r\n      const rules = [];\r\n      if (!Array.isArray(validRules)) {\r\n        rules.push(validRules);\r\n      } else {\r\n        rules.push(...validRules);\r\n      }\r\n      const rule = rules.find(item => item.type === validateRuleType);\r\n      if (rule) {\r\n        const controlName = formControl.name;\r\n        const messageTemplate = ValidationTypes.getMessage(validateRuleType);\r\n        const message = ValidationExecutor.replaceMessageSpecialTokens(messageTemplate, rule, controlName);\r\n        return message;\r\n      }\r\n      return null;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Form\r\n   * @param context \r\n   */\r\n  public init(bindingData: BindingData, bindingPath: string, frameContext?: FrameContext) {\r\n    this.frameContext = frameContext;\r\n    this.bindingData = bindingData;\r\n    this.bindingPath = bindingPath;\r\n    // \r\n    if (this.frameContext && this.frameContext.viewModel && this.frameContext.viewModel.verifycationChanged) {\r\n      this.frameContext.viewModel.verifycationChanged.subscribe((verifycations: any[]) => {\r\n        if (!verifycations || verifycations.length < 1) {\r\n          this.resetCardValidMsg();\r\n        }\r\n      });\r\n    }\r\n    this.buildForm();\r\n    // @todo: key\r\n    Form.insMap[this.constructor.name] = this;\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  public buildForm() {\r\n    this.collectMetadatas();\r\n    // this.createChildFormArrays();\r\n    this.createChildForms();\r\n    this.createControls();\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public resetCardValidMsg(): void {\r\n    this.cardControls = {};\r\n    //  ,control\r\n    Object.keys(this.controlIdMap).forEach(id => {\r\n      if (!this.bindingData.getList().innerList.map(x => x.id).includes(id)) {\r\n        delete this.controlIdMap[id];\r\n      }\r\n    });\r\n    this.resetFormControls();\r\n    this.setShowValidationMsg(false);\r\n  }\r\n  /**\r\n   * \r\n   * @param propertyName \r\n   * @param isRequired \r\n   */\r\n  public updateFieldValidateRule(propertyName: string, isRequired: boolean) {\r\n    if (!propertyName) {\r\n      return;\r\n    }\r\n    const formControl: AbstractControl = this.controls[propertyName];\r\n\r\n    // \r\n    if (formControl) {\r\n      formControl.clearValidators();\r\n      formControl.markAsUntouched();\r\n      formControl.markAsPristine();\r\n      formControl.setErrors([]);\r\n    }\r\n    // formControl\r\n    // validRules\r\n    const ngFormControl = this.ngFormControls[propertyName];\r\n    let validateRules: ValidateRule | ValidateRule[] = ngFormControl && ngFormControl.validRules || [];\r\n    if (!Array.isArray(validateRules)) {\r\n      validateRules = [validateRules];\r\n    }\r\n    const requiredRuleIndex = validateRules.findIndex((validateRule: ValidateRule) => validateRule.type === ValidationTypes.REQUIRED);\r\n    if (isRequired) {\r\n      // \r\n      if (requiredRuleIndex == -1) {\r\n\r\n        const validateRule: ValidateRule = { type: ValidationTypes.REQUIRED, constraints: [true] };\r\n        // \r\n        const displayFieldName = ngFormControl && (ngFormControl.name || ngFormControl.defaultI18nValue) || '';\r\n        validateRule.targetId = ngFormControl && ngFormControl.id || null;\r\n        validateRule.targetName = this.formGroupName;\r\n        validateRule.property = displayFieldName;\r\n        validateRule.field = ngFormControl && ngFormControl.binding;\r\n        validateRules.push(validateRule);\r\n      }\r\n    } else {\r\n      // \r\n      if (requiredRuleIndex !== -1) {\r\n        validateRules.splice(requiredRuleIndex, 1);\r\n      }\r\n    }\r\n    // \r\n    const validators: ValidatorFn[] = [];\r\n    Array.prototype.forEach.call(validateRules, ((ruleObj: ValidateRule) => {\r\n      const validateFn = this.getValidatorByRuleObj(ruleObj, this.ngFormControls[propertyName]);\r\n      if (validateFn) {\r\n        validators.push(validateFn);\r\n      }\r\n    }));\r\n    this.ngFormControls[propertyName].validRules = validateRules;\r\n    this.controls[propertyName].setValidators(validators);\r\n  }\r\n  public addFieldValidateRule(propertyName: string, message: string, expressionId: string, ruleType: RuleType) {\r\n    const formControl: AbstractControl = this.controls[propertyName];\r\n    if (formControl) {\r\n      // \r\n      formControl.setErrors(null);\r\n    }\r\n    const ngFormControl = this.ngFormControls[propertyName];\r\n    let validateRules = this.ngFormControls[propertyName].validRules;\r\n    if (!validateRules) {\r\n      validateRules = [];\r\n    }\r\n    if (!Array.isArray(validateRules)) {\r\n      validateRules = [validateRules];\r\n    }\r\n    const index = validateRules.findIndex((rule: ValidateRule) => rule && rule.expressionId === expressionId);\r\n    if (index !== -1) {\r\n      validateRules.splice(index, 1);\r\n    }\r\n    const bindingPath = this.frameContext.viewModel.bindingPath;\r\n    const bindingPaths = bindingPath.split('/').filter(p => p);\r\n    let fieldName = propertyName;\r\n    if (bindingPaths.length !== 0) {\r\n      const prefix = bindingPaths.join('/');\r\n      const binding = ngFormControl.binding || '';\r\n      const property = binding.split('.').join('/');\r\n      fieldName = `${prefix}/${property}`;\r\n    }\r\n    const context = this.frameContext;\r\n    const validateRule: ValidateRule = {\r\n      type: ruleType,\r\n      message: message,\r\n      expressionId: expressionId,\r\n      constraints: [],\r\n      bindingPath: bindingPaths.join('/'),\r\n      eval: function (options?: any) {\r\n        return context.viewModel.expression.validate(expressionId, options);\r\n      }\r\n    };\r\n    validateRules.push(validateRule);\r\n    this.ngFormControls[propertyName].validRules = validateRules;\r\n    // if (this.ngFormControls[propertyName] && validateRules.length > 0) {\r\n    //   const validators: ValidatorFn[] = [];\r\n    //   Array.prototype.forEach.call(validateRules, ((ruleObj: ValidateRule) => {\r\n    //     const validateFn = this.getValidatorByRuleObj(ruleObj, this.ngFormControls[propertyName]);\r\n    //     if (validateFn) {\r\n    //       validators.push(validateFn);\r\n    //     }\r\n    //   }));\r\n    //   this.controls[propertyName].setValidators(validators);\r\n    // }\r\n  }\r\n  /**\r\n   * validator\r\n   * @param ruleObj: ValidateRule\r\n   */\r\n  private getValidatorByRuleObj(ruleObj: ValidateRule, ngFormControl: NgFormControl): ValidatorFn {\r\n    const { type, constraints = [], message = null } = ruleObj;\r\n    const displayText = ngFormControl.name || ngFormControl.defaultI18nValue || '';\r\n    const ruleHandlerObj = {\r\n      required: (control: AbstractControl): { [key: string]: any } | null => {\r\n        const value = control.value;\r\n        let isValid = value !== '' && value !== null && value !== undefined && value !== '0001-01-01' && value !== '0001-01-01 00:00:00' && value !== '0001-01-01T00:00:00';\r\n        const parentPaths = this.bindingPath.split('/').filter(p => p);\r\n        const controlPaths = ngFormControl.binding.split('.');\r\n        const paths = parentPaths.concat(controlPaths);\r\n        const propInfo = this.getPropInfoByPath(paths);\r\n        const isMultiLangInput = propInfo && propInfo.metadataInfo.enableMultiLangInput;\r\n        if (isMultiLangInput) {\r\n          const currentLanguage = TranslateService.getCurrentLanguage();\r\n          const currentLangValue = value && value[currentLanguage];\r\n          isValid = currentLangValue !== '' && currentLangValue !== null && currentLangValue !== undefined && currentLangValue !== '0001-01-01' && currentLangValue !== '0001-01-01 00:00:00' && currentLangValue !== '0001-01-01T00:00:00';\r\n        }\r\n        const messageTemplate = ValidationTypes.getMessage(ValidationTypes.REQUIRED);\r\n        const invalidMessage = ValidationExecutor.replaceMessageSpecialTokens(messageTemplate, ruleObj, control.value);\r\n        if (isValid && control.errors && control.errors.required) {\r\n          // \r\n          delete control.errors.required;\r\n          this.isFormValid(paths.join('.'));\r\n        }\r\n        return isValid ? null : { required: { value: control.value, name: invalidMessage } };\r\n      },\r\n      maxLength: (control: AbstractControl): { [key: string]: any } | null => {\r\n        const isInValid = control.value && control.value.toString().length > constraints[0];\r\n        const messageTemplate = ValidationTypes.getMessage(ValidationTypes.MAX_LENGTH);\r\n        const invalidMessage = ValidationExecutor.replaceMessageSpecialTokens(messageTemplate, ruleObj, control.value);\r\n        return isInValid ? { maxLength: { value: control.value, name: invalidMessage } } : null;\r\n      },\r\n      minLength: (control: AbstractControl): { [key: string]: any } | null => {\r\n        const isInValid = control.value && control.value.toString().length < constraints[0];\r\n        const messageTemplate = ValidationTypes.getMessage(ValidationTypes.MAX_LENGTH);\r\n        const invalidMessage = ValidationExecutor.replaceMessageSpecialTokens(messageTemplate, ruleObj, control.value);\r\n        return isInValid ? { minLength: { value: control.value, name: invalidMessage } } : null;\r\n      },\r\n      minValue: (control: AbstractControl): { [key: string]: any } | null => {\r\n        let isInValid = false;\r\n        let invalidMessage = '';\r\n        // \r\n        if (control.value === null || control.value === undefined) {\r\n          return null;\r\n        }\r\n        if (typeof control.value === 'number' && typeof constraints[0] === 'number') {\r\n          isInValid = control.value < constraints[0];\r\n          const messageTemplate = ValidationTypes.getMessage(ValidationTypes.MINVALUE);\r\n          invalidMessage = ValidationExecutor.replaceMessageSpecialTokens(messageTemplate, ruleObj, control.value);\r\n          // invalidMessage = `${ngFormControl.name}${constraints[0]}`;\r\n        } else if (ngFormControl && ngFormControl.bigNumber === true) {\r\n          // \r\n          const minValue = new BigNumber(constraints[0]);\r\n          const value = new BigNumber(control.value);\r\n          isInValid = minValue.isGreaterThan(value);\r\n          const messageTemplate = ValidationTypes.getMessage(ValidationTypes.MINVALUE);\r\n          invalidMessage = ValidationExecutor.replaceMessageSpecialTokens(messageTemplate, ruleObj, control.value);\r\n        } else {\r\n          const messageTemplate = ValidationTypes.getMessage(ValidationTypes.MIN_DATE);\r\n          // \r\n          // null0undefined\"\"\r\n          if (!constraints || constraints.length < 1 || !constraints[0]) {\r\n            return null;\r\n          }\r\n          if (control.value instanceof Date) {\r\n            isInValid = control.value < parseISO(constraints[0]);\r\n          } else {\r\n            isInValid = parseISO(control.value) < parseISO(constraints[0]);\r\n          }\r\n          invalidMessage = ValidationExecutor.replaceMessageSpecialTokens(messageTemplate, ruleObj, control.value);\r\n        }\r\n        return isInValid ? { minValue: { value: control.value, name: invalidMessage } } : null;\r\n      },\r\n      maxValue: (control: AbstractControl): { [key: string]: any } | null => {\r\n        let isInValid = false;\r\n        let invalidMessage = '';\r\n        if (control.value === null || control.value === undefined) {\r\n          return null;\r\n        }\r\n        if (typeof control.value === 'number' && typeof constraints[0] === 'number') {\r\n          isInValid = control.value > constraints[0];\r\n          const messageTemplate = ValidationTypes.getMessage(ValidationTypes.MAXVALUE);\r\n          invalidMessage = ValidationExecutor.replaceMessageSpecialTokens(messageTemplate, ruleObj, control.value);\r\n          // invalidMessage = `${ngFormControl.name}${constraints[0]}`;\r\n        } else if (ngFormControl && ngFormControl.bigNumber === true) {\r\n          // \r\n          const maxValue = new BigNumber(constraints[0]);\r\n          const value = new BigNumber(control.value);\r\n          isInValid = maxValue.isLessThan(value);\r\n          const messageTemplate = ValidationTypes.getMessage(ValidationTypes.MAXVALUE);\r\n          invalidMessage = ValidationExecutor.replaceMessageSpecialTokens(messageTemplate, ruleObj, control.value);\r\n        } else {\r\n          // \r\n          const messageTemplate = ValidationTypes.getMessage(ValidationTypes.MAX_DATE);\r\n          if (control.value instanceof Date) {\r\n            isInValid = control.value > new Date(constraints[0]);\r\n            // invalidMessage = `${ngFormControl.name}${constraints[0]}`;\r\n          } else {\r\n            isInValid = new Date(control.value) > new Date(constraints[0]);\r\n            // invalidMessage = `${ngFormControl.name}${constraints[0]}`;\r\n          }\r\n          invalidMessage = ValidationExecutor.replaceMessageSpecialTokens(messageTemplate, ruleObj, control.value);\r\n        }\r\n        return isInValid ? { maxValue: { value: control.value, name: invalidMessage } } : null;\r\n      },\r\n      exclude: (control: AbstractControl): { [key: string]: any } | null => {\r\n        const isValid = typeof control.value === 'string' && !this.validatorJs.contains(control.value, constraints[0]);\r\n        const messageTemplate = ValidationTypes.getMessage(ValidationTypes.EXCLUDE);\r\n        const invalidMessage = ValidationExecutor.replaceMessageSpecialTokens(messageTemplate, ruleObj, control.value);\r\n        return isValid ? null : { exclude: { value: control.value, name: invalidMessage } };\r\n      },\r\n      matches: (control: AbstractControl): { [key: string]: any } | null => {\r\n        const value = (control.value === null || control.value === undefined) ? '' : control.value.toString();\r\n        const isValid = value === '' ? true : this.validatorJs.matches(value, constraints[0]);\r\n        let invalidMessage = message;\r\n        if (!invalidMessage) {\r\n          const messageTemplate = ValidationTypes.getMessage(ValidationTypes.MATCHES);\r\n          invalidMessage = ValidationExecutor.replaceMessageSpecialTokens(messageTemplate, ruleObj, control.value);\r\n        }\r\n\r\n        return isValid ? null : { matches: { value: control.value, name: invalidMessage } }\r\n      }\r\n    };\r\n    return ruleHandlerObj[type];\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private collectMetadatas() {\r\n    this.ngValidateForm = this.frameContext.metadata.form ? MetadataUtil.translateMetadataByName(this.frameContext.metadata.form, this.translateService, ['formGroupName']) :\r\n      MetadataUtil.getClassMetadataByNameWithTranslate(this.constructor, NG_VALIDATE_FORM,\r\n        this.translateService, ['formGroupName']);\r\n    this.ngFormControls = this.collectionFormControlMetadats(this.frameContext.metadata.formControls);\r\n    this.ngChildForms = this.frameContext.metadata.subForms || MetadataUtil.getPropsMetadatasByName(this.constructor, NG_CHILD_FORM);\r\n  }\r\n\r\n  private collectionFormControlMetadats(preloadMetadata: { [propName: string]: NgFormControl } = null): { [propName: string]: NgFormControl } {\r\n    const metadatas = preloadMetadata ? MetadataUtil.translateMetadatasByName(preloadMetadata, this.translateService, ['name']) :\r\n      MetadataUtil.getPropsMetadatasByNameWithTranslate(this.constructor, NG_FORM_CONTROL, this.translateService, ['name']);\r\n    // \r\n    if (metadatas) {\r\n      Object.keys(metadatas).forEach((propName: string) => {\r\n        const ngFormControl = metadatas[propName];\r\n        const displayFieldName = ngFormControl.name || ngFormControl.defaultI18nValue || '';\r\n        const formControlId = ngFormControl.id;\r\n        if (Array.isArray(ngFormControl.validRules)) {\r\n          ngFormControl.validRules.forEach((validationRule: ValidateRule) => {\r\n            validationRule.targetId = formControlId;\r\n            validationRule.targetName = this.formGroupName;\r\n            validationRule.property = displayFieldName;\r\n            validationRule.field = ngFormControl.binding;\r\n\r\n          });\r\n        }\r\n      });\r\n    }\r\n    return metadatas;\r\n  }\r\n\r\n  // gridformControl\r\n  getGridItemControl(propName: string, value: any) {\r\n    const createControlFromRules = propertyName => {\r\n      const validators = [];\r\n      // form\r\n      if (this.ngFormControls[propertyName] && Array.isArray(this.ngFormControls[propertyName].validRules)) {\r\n        Array.prototype.forEach.call(this.ngFormControls[propertyName].validRules, ((ruleObj) => {\r\n          const validateFn = this.getValidatorByRuleObj(ruleObj, this.ngFormControls[propertyName]);\r\n          if (validateFn) {\r\n            validators.push(validateFn);\r\n          }\r\n        }));\r\n      }\r\n      return new FormControl(value, { validators: validators, updateOn: 'blur' });\r\n    };\r\n    return createControlFromRules(propName);\r\n  }\r\n\r\n  // \r\n  getDomPropertyNameByEntityProp(propertyName: string, prefix: string = ''): string {\r\n    let domPropertyName = '';\r\n    Object.keys(this.ngFormControls).forEach(key => {\r\n      const binding = `${prefix}${this.ngFormControls[key].binding}`;\r\n      if (binding === propertyName) {\r\n        domPropertyName = key;\r\n      }\r\n    });\r\n    return domPropertyName;\r\n  }\r\n\r\n  /**\r\n   * FormControl\r\n   */\r\n  createControls() {\r\n    Object.keys(this.ngFormControls).forEach((propName: string) => {\r\n      const ngFormControl = this.ngFormControls[propName];\r\n      const validators: ValidatorFn[] = [];\r\n\r\n      // form\r\n      if (Array.isArray(this.ngFormControls[propName].validRules)) {\r\n        Array.prototype.forEach.call(this.ngFormControls[propName].validRules, (ruleObj => {\r\n          const validateFn = this.getValidatorByRuleObj(ruleObj, this.ngFormControls[propName]);\r\n          if (validateFn) {\r\n            validators.push(validateFn);\r\n          }\r\n        }));\r\n      }\r\n\r\n      const updateOn = ngFormControl.updateOn ? ngFormControl.updateOn : 'blur';\r\n      const control = new FormControl(null, { validators: validators, updateOn: updateOn });\r\n      if (ngFormControl.binding) {\r\n        this.setUpBindingDataPipeline(control, ngFormControl.binding, ngFormControl.valueConverter);\r\n      }\r\n      this.controls[propName] = control;\r\n      this[propName] = control;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * FormGroup\r\n   */\r\n  createChildForms() {\r\n    Object.keys(this.ngChildForms).forEach((propName: string) => {\r\n      const ngFormGroup = this.ngChildForms[propName];\r\n\r\n      // Form\r\n      const formGroup = new ngFormGroup.formType();\r\n      formGroup.init(this.bindingData, this.bindingPath, this.frameContext);\r\n\r\n      this.controls[propName] = formGroup;\r\n      this[propName] = formGroup;\r\n    });\r\n  }\r\n  /*\r\n  * FormControls\r\n   */\r\n  addControls(column: any, converter?: ControlValueConverter) {\r\n\r\n    const updateOn = column && column.editor && column.editor.updateOn ? column.editor.updateOn : 'blur';\r\n    const formControl = new FormControl('', { updateOn: updateOn });\r\n    const fieldPath = column.dataField;\r\n\r\n    //   \r\n    // this.setUpBindingDataPipeline(formControl, fieldPath, converter);\r\n    if (column.editor && column.editor.binding) {\r\n      this.setUpBindingDataPipeline(formControl, fieldPath, converter);\r\n      this.controls[column.editor.binding.path] = formControl;\r\n      this[column.editor.binding.path] = formControl;\r\n    }\r\n  }\r\n\r\n\r\n  /**\r\n   * controltable\r\n   * @param control \r\n   * @param bindingFieldPath \r\n   */\r\n  private setUpBindingDataPipeline(control: FormControl, bindingFieldPath, converter?: ControlValueConverter) {\r\n\r\n    if (!this.bindingData) {\r\n      throw Error('BindingData');\r\n    }\r\n\r\n    // converterConverterinjector\r\n    // __FRAME_CONTEXT__ \r\n    /*if (converter) {\r\n      converter['__FRAME_CONTEXT__'] = this.frameContext;\r\n    }*/\r\n\r\n    // bindignPathbindingFieldPath\r\n    if (this.bindingPath.length > 1) {\r\n      bindingFieldPath = this.bindingPath.substr(1).replace(/\\//g, '.') + '.' + bindingFieldPath;\r\n    }\r\n    const bindingPaths: string[] = bindingFieldPath.split('.');\r\n    const propertyName = bindingPaths[bindingPaths.length - 1];\r\n    // \r\n    const initValue = this.getValueFromBindingData(bindingPaths, converter);\r\n    control.setValue(initValue);\r\n\r\n    // \r\n\r\n    // BindingData => control\r\n    this.bindingData.changes.pipe(takeUntil(this.destroy$)).pipe(filter((change: Change) => {\r\n      const bindingObject = this.bindingData.getObject();\r\n      const changePath = change.path.join('.');\r\n      if (change.isUdt) {\r\n        return changePath === bindingFieldPath;\r\n      }\r\n      if (change.type === ChangeType.ValueChanged) {\r\n        // path\r\n        return changePath === bindingFieldPath;\r\n      } else if (change.type === ChangeType.Load || change.type === ChangeType.SelectionChanged || change.type === ChangeType.Remove || change.type === ChangeType.Update) {\r\n        // ObjectChangedSelectionChanged\r\n        const changePathWithDot = changePath === '' ? changePath : changePath + '.';\r\n        // \r\n        if (change && change.type === ChangeType.Load) {\r\n          this.resetCardValidMsg();\r\n        }\r\n        return bindingFieldPath.indexOf(changePathWithDot) === 0;\r\n      } else if (change.type === ChangeType.UpdateErrors) {\r\n        if (changePath === bindingFieldPath) {\r\n          this.cardControls[propertyName] = this.cardControls[propertyName] || {};\r\n          if (bindingFieldPath && this.controls[propertyName]) {\r\n            if (bindingObject.primaryKeyValue === change.id) {\r\n              this.cardControls[propertyName].errors = change.errors;\r\n            } else {\r\n              // \r\n              // this.cardControls[propertyName].errors = null;\r\n              // this.isFormValid(bindingFieldPath);\r\n            }\r\n          }\r\n          // \r\n          if (!change.path || !bindingFieldPath || !change.errors) {\r\n            this.cardControls[propertyName].errors = null;\r\n            this.isFormValid(bindingFieldPath);\r\n          }\r\n          return false;\r\n        }\r\n      } else {\r\n        return false;\r\n      }\r\n    })).subscribe((change: Change) => {\r\n      let fullEntityProp = propertyName;\r\n      // udt'_'\r\n      let pathPrefix = '';\r\n      if (change.isUdt) {\r\n        if (change.isGrid) {\r\n          // grid \r\n          change.path.shift();\r\n        }\r\n        if (change.path.length) {\r\n          pathPrefix = change.path.join('.');\r\n        }\r\n        fullEntityProp = pathPrefix;\r\n      }\r\n\r\n      const value = this.bindingData.getValue(bindingPaths, false);\r\n      const newControlValue = converter ? converter.convertFrom(value) : value;\r\n      // FormControl\r\n      const domPropName = this.getDomPropertyNameByEntityProp(fullEntityProp);\r\n      this.cardControls[domPropName] = this.cardControls[domPropName] || {};\r\n      if (change.errors) {\r\n        this.cardControls[domPropName].errors = change.errors;\r\n      }\r\n      // dataGrididformControl\r\n      if (change.id) {\r\n        if (this.controlIdMap[change.id] && Object.keys(this.controlIdMap[change.id]).length === 0) {\r\n          this.controlIdMap[change.id] = {};\r\n        }\r\n        this.controlIdMap[change.id] = this.controlIdMap[change.id] || {};\r\n        if (change.errors) {\r\n          this.controlIdMap[change.id][domPropName] = {\r\n            errors: change.errors\r\n          };\r\n        }\r\n      }\r\n      // \r\n      if (JSON.stringify(control.value) === JSON.stringify(newControlValue)) {\r\n        return;\r\n      }\r\n\r\n      // \r\n      control.setValue(newControlValue);\r\n\r\n    });\r\n\r\n    // control => BindingData\r\n    control.valueChanges.pipe(takeUntil(this.destroy$)).subscribe((value: any) => {\r\n      const oldBindingValue = this.bindingData.getValue(bindingPaths);\r\n      // \r\n      if (value && value.constructor && value.constructor.name === 'Date') {\r\n        const isValidDate = !isNaN(value);\r\n        if (!isValidDate) {\r\n          return;\r\n        }\r\n        if (oldBindingValue && converter) {\r\n          const oldValue = converter.convertFrom(oldBindingValue);\r\n\r\n          if (this.compareDate(value, oldValue) === true) {\r\n            return;\r\n          }\r\n        }\r\n      }\r\n\r\n      // \r\n      if (this.isDate(converter) === true) {\r\n        if (DateUtil.isEqual(value, oldBindingValue) === true) {\r\n          return;\r\n        }\r\n      }\r\n\r\n      // BindingDataBindingData\r\n      const newBindingValue = converter ? converter.convertTo(value) : value;\r\n      if (JSON.stringify(oldBindingValue) === JSON.stringify(newBindingValue)) {\r\n        return;\r\n      }\r\n      // if (!this.isFormValid(propertyName, null, null, false)) {\r\n      //   const errors = this.cardControls[propertyName] && this.cardControls[propertyName].errors || {};\r\n      //   this.bindingData.setValue(bindingPaths, newBindingValue, false, true, errors);\r\n      // } else {\r\n      this.clearBackEndMessages(propertyName);\r\n      const emitEventToView = this.frameContext.appContext.runMode === RunMode.highSpeed;\r\n      this.bindingData.setValue(bindingPaths, newBindingValue, emitEventToView, true, null, { frameContext: this.frameContext });\r\n      //}\r\n    });\r\n  }\r\n\r\n  /**\r\n   * \r\n   * 1Converter\r\n   * 2DevkitKendoBindingDateConverter\r\n   * 3constructor.name,name\r\n   * 4formatConverterformat\r\n   * @todo\r\n   * \r\n   */\r\n  private isDate(converter: ControlValueConverter): boolean {\r\n    let isDateConverter = false;\r\n\r\n    // if (converter && converter.constructor && converter.constructor.name === 'DateConverter') {\r\n    //   isDateConverter = true;\r\n    // }\r\n    if (converter && converter.hasOwnProperty('format') === true) {\r\n      isDateConverter = true;\r\n    }\r\n    return isDateConverter;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  compareDate(srcDate: Date, dstDate: Date) {\r\n    if (!srcDate || !dstDate) {\r\n      return srcDate === dstDate;\r\n    }\r\n    const isEqual =\r\n      srcDate.getFullYear() === dstDate.getFullYear()\r\n      && srcDate.getMonth() === dstDate.getMonth()\r\n      && srcDate.getDate() === dstDate.getDate()\r\n      && srcDate.getHours() === dstDate.getHours()\r\n      && srcDate.getMinutes() === dstDate.getMinutes()\r\n      && srcDate.getSeconds() === dstDate.getSeconds();\r\n    return isEqual;\r\n  }\r\n\r\n  private getPropInfoByPath(path: Array<string>): DataPropInfo {\r\n    const entityType = this.frameContext && this.frameContext.repository.entityType || null;\r\n    if (entityType) {\r\n      const dataTypeInfo = new DataTypeInfo(entityType);\r\n      const propInfo: DataPropInfo = dataTypeInfo.getPropInfoByPath(path);\r\n      return propInfo;\r\n      // const isMultiLangInput = propInfo.metadataInfo.enableMultiLangInput;\r\n    }\r\n    return null;\r\n  }\r\n  /**\r\n   * BindingData\r\n   */\r\n  private getValueFromBindingData(bindingPaths: string[], converter?: ControlValueConverter) {\r\n    const value = this.bindingData.getValue(bindingPaths);\r\n    const converteredValue = converter ? converter.convertFrom(value) : value;\r\n    return converteredValue;\r\n  }\r\n\r\n  public getEntityValueChangingListeners(): { [property: string]: string } {\r\n    const listeners = {};\r\n    Object.keys(this.ngFormControls).forEach((propName) => {\r\n      const ngFormControl = this.ngFormControls[propName];\r\n      if (ngFormControl.valueChanging) {\r\n        listeners[ngFormControl.binding] = ngFormControl.valueChanging;\r\n      }\r\n    });\r\n    return listeners;\r\n  }\r\n\r\n  public getEntityValueChangedListeners(): { [property: string]: string } {\r\n    const listeners = {};\r\n    Object.keys(this.ngFormControls).forEach((propName) => {\r\n      const ngFormControl = this.ngFormControls[propName];\r\n      if (ngFormControl.valueChanged) {\r\n        listeners[ngFormControl.binding] = ngFormControl.valueChanged;\r\n      }\r\n    });\r\n    return listeners;\r\n  }\r\n  /**\r\n   * \r\n   * @description\r\n   * Map<string,ValidateRule>,keybindingPath/\r\n   */\r\n  public getValidationRules(): Map<string, ValidateRule[]> {\r\n    const validatoinRules = new Map<string, ValidateRule[]>();\r\n    let parentPath = this.bindingPath;\r\n    if (parentPath.length && parentPath === '/') {\r\n      parentPath = '';\r\n    }\r\n    Object.keys(this.ngFormControls).forEach((propName: string) => {\r\n      // const fieldName = `${parentPath}/${propName}`;\r\n\r\n      if (this.isShowPropMap[propName] === true || Object.keys(this.isShowPropMap).length === 0) {\r\n        const ngFormControl = this.ngFormControls[propName];\r\n        const displayFieldName = ngFormControl.name || ngFormControl.defaultI18nValue || '';\r\n        const bindingPathArray = ngFormControl.binding ? ngFormControl.binding.split('.') : [propName];\r\n        const fieldNameArray = [parentPath, ...bindingPathArray];\r\n        const fieldName = fieldNameArray.join('/');\r\n        if (Array.isArray(ngFormControl.validRules) && ngFormControl.validRules.length > 0) {\r\n          let validationrulesToAdd = [...ngFormControl.validRules];\r\n          // if (this.excludeRuleTypes && this.excludeRuleTypes[propName] && this.excludeRuleTypes[propName].length > 0) {\r\n          //   validationrulesToAdd = ngFormControl.validRules.filter((item) => !this.excludeRuleTypes[propName].includes(item.type));\r\n          // }\r\n          validationrulesToAdd.forEach((validationRule: ValidateRule) => {\r\n            validationRule.targetId = ngFormControl.id;\r\n            validationRule.targetName = this.formGroupName;\r\n            validationRule.property = displayFieldName;\r\n            validationRule.field = ngFormControl.binding;\r\n            validationRule.fullPath = fieldName;\r\n            if (this.frameContext) {\r\n              validationRule.frameContext = this.frameContext;\r\n            }\r\n          });\r\n          validatoinRules.set(fieldName, validationrulesToAdd);\r\n        } else {\r\n          validatoinRules.set(fieldName, [{\r\n            type: 'setDisplayInfo',\r\n            targetId: ngFormControl.id,\r\n            targetName: this.formGroupName,\r\n            property: displayFieldName,\r\n            fullPath: fieldName,\r\n            frameContext: this.frameContext\r\n          }]);\r\n        }\r\n      }\r\n    });\r\n    return validatoinRules;\r\n  }\r\n\r\n  public setTranslateService(translateService: Translate) {\r\n    if (!translateService) {\r\n      return;\r\n    }\r\n    this.translate = translateService;\r\n    ValidationTypes.setCurrentLanguage(translateService.getCurrentLanguage());\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  private resetFormControls() {\r\n    if (Object.keys(this.controls).length > 0) {\r\n      Object.keys(this.controls).forEach((prop) => {\r\n        const formControl: AbstractControl = this.controls[prop];\r\n        formControl.markAsUntouched();\r\n        formControl.markAsPristine();\r\n      });\r\n    }\r\n\r\n  }\r\n  private clearBackEndMessages(domPropertyName: string) {\r\n    if (domPropertyName) {\r\n      if (this.cardControls[domPropertyName] && this.cardControls[domPropertyName]['errors'] && !!Object.keys(this.cardControls[domPropertyName]['errors']).find(item => item.startsWith('message-'))) {\r\n        const messageKeys = Object.keys(this.cardControls[domPropertyName]['errors']).filter(item => item.startsWith('message-'));\r\n        const errors = { ...this.cardControls[domPropertyName]['errors'] };\r\n        messageKeys.forEach(key => delete errors[key]);\r\n        this.cardControls[domPropertyName] = { errors: errors };\r\n      }\r\n    } else {\r\n      Object.keys(this.cardControls).forEach(propertyName => {\r\n        if (this.cardControls[propertyName] && this.cardControls[propertyName]['errors'] && !!Object.keys(this.cardControls[propertyName]['errors']).find(item => item.startsWith('message-'))) {\r\n          const messageKeys = Object.keys(this.cardControls[propertyName]['errors']).filter(item => item.startsWith('message-'));\r\n          const errors = { ...this.cardControls[propertyName]['errors'] };\r\n          messageKeys.forEach(key => delete errors[key]);\r\n          this.cardControls[propertyName] = { errors: errors };\r\n        }\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nexport { Form };\r\n","import { Repository } from '../repository/index';\r\nimport { Entity, EntityList, PARENT_CLASS, FieldMetadataUtil } from '../entity/index';\r\nimport { Modification, ModifyType } from '../changeset/index';\r\nimport { ViewChange, Change, ChangeType } from './changes';\r\nimport { BindingList } from './binding_list';\r\nimport { BindingObject } from './binding_object';\r\nimport { BindingProperty, BindingPropertyType } from './binding_property';\r\nimport { BindingObjectFactory } from './binding_object_factory';\r\nimport { Form } from '../form/index';\r\nimport { Pagination } from '../core';\r\nimport { BindingData } from './binding_data';\r\nimport { takeUntil } from 'rxjs/operators';\r\n\r\n/**\r\n * \r\n */\r\nclass EntityUtil {\r\n\r\n  /**\r\n   * entitybindingObject\r\n   * @param entity        \r\n   * @param bindingObject \r\n   */\r\n  static loadEntity(entity: Entity, bindingObject: BindingObject) {\r\n    // bindingObjectproperties\r\n    bindingObject.properties.forEach((property: BindingProperty) => {\r\n      const propertyName = property.name;\r\n      if (property.type === BindingPropertyType.List) {\r\n        this.loadEntityList(entity[propertyName] || entity[PARENT_CLASS], bindingObject[propertyName]);\r\n      } else if (property.type === BindingPropertyType.Object) {\r\n        if (entity && entity[propertyName] && this.isEffectiveField(entity, propertyName)) {\r\n          this.loadEntity(entity[propertyName], bindingObject[propertyName]);\r\n        }\r\n      } else if (property.type === BindingPropertyType.Dynamic) {\r\n        if (entity && entity[propertyName]) {\r\n          const dynamicObject = BindingObjectFactory.createDynamicBindingObject(entity[propertyName].data);\r\n          BindingObjectFactory.attachDynamicObjectProperty(bindingObject, propertyName, dynamicObject);\r\n          this.loadEntity(entity[propertyName], bindingObject[propertyName]);\r\n        }\r\n      } else {\r\n        if (this.isEffectiveField(entity, propertyName)) {\r\n          const value = entity[propertyName];\r\n          bindingObject.setValue(propertyName, value, false, false);\r\n        }\r\n      }\r\n    });\r\n\r\n    this.setUpEntityPipeline(entity, bindingObject);\r\n  }\r\n\r\n  /**\r\n   * entitybindingObject\r\n   * @param entity        \r\n   * @param bindingObject \r\n   */\r\n  static setUpEntityPipeline(entity: Entity, bindingObject: BindingObject) {\r\n    if (!entity || !bindingObject) {\r\n      return;\r\n    }\r\n    // entity\r\n    entity.onValueChanged.pipe(takeUntil(entity.unsubscribe)).subscribe((modification: Modification) => {\r\n      if (modification.type !== ModifyType.ValueChange || modification.path.length === 0) {\r\n        return;\r\n      }\r\n      const propertyName = modification.path[modification.path.length - 1];\r\n      const primaryKeyPath = modification.path[modification.path.length - 2];\r\n\r\n      // \r\n      // id\r\n      if (bindingObject.primaryKey && bindingObject.primaryKey === 'id') {\r\n        const primaryKey = bindingObject.primaryKey;\r\n        const primaryKeyValue = bindingObject.getValue(primaryKey);\r\n        if (primaryKeyPath !== `${primaryKey}:${primaryKeyValue}`) {\r\n          return;\r\n        }\r\n      }\r\n      // TODO:dynamicBindingObject\r\n      if (modification.dynamic) {\r\n        if (bindingObject['__original__']) {\r\n          return;\r\n        }\r\n        const value = modification.value;\r\n        const target = bindingObject[propertyName];\r\n        if (!target) {\r\n          return;\r\n        }\r\n        Object.keys(value).forEach((key: string) => {\r\n          if (target.getValue(key) === value[key]) {\r\n            return;\r\n          }\r\n          target.setValue(key, value[key], true, false);\r\n        });\r\n      } else {\r\n        // \r\n        // TODO: bindingObjectentityentity\r\n        if (bindingObject.getValue(propertyName) === modification.value) {\r\n          return;\r\n        }\r\n        bindingObject.setValue(propertyName, modification.value, true, false, modification.errors);\r\n      }\r\n\r\n    });\r\n    // bindingObject\r\n    bindingObject.viewChanges.pipe(takeUntil(bindingObject.unsubscribe)).subscribe((viewChange: ViewChange) => {\r\n      const value = viewChange.value;\r\n      const propertyName = viewChange.path[0];\r\n\r\n      let pathPrefix = '';\r\n      const pathData = entity.getPaths();\r\n      const paths = pathData.path;\r\n      let id = bindingObject['id'];\r\n      bindingObject['__original__'] = true;\r\n      // if (pathData.isUdt) {\r\n      // gridudtidid\r\n      const getParentId = (target: any) => {\r\n        let parentId = '';\r\n        const findId = (item: any) => {\r\n          if (item && item && item['id']) {\r\n            parentId = item['id'];\r\n            return;\r\n          } else if (item['parent']) {\r\n            findId(item['parent']);\r\n          }\r\n        };\r\n        findId(target);\r\n        return parentId;\r\n      };\r\n      id = getParentId(bindingObject);\r\n      // if (pathData.isGrid) {\r\n      //   // grid \r\n      //   paths.pop();\r\n      // }\r\n      if (paths.length) {\r\n        pathPrefix = paths.join('.') + '.';\r\n      }\r\n      // }\r\n      const controlProp = pathPrefix + propertyName;\r\n      // formControl\r\n      const entityValidate = (callback?: (error: any) => void) => {\r\n        const enableValidate = Object.values(Form.insMap).find(item => item && item.enableValidate);\r\n        if (!enableValidate) {\r\n          if (typeof callback === 'function') {\r\n            callback(null);\r\n          }\r\n          return;\r\n        }\r\n        entity.validateFromUtilSync(propertyName, value, result => {\r\n          const errorObj = {};\r\n          if (result.errors && result.errors.length > 0) {\r\n            result.errors.forEach((error: any) => {\r\n              if (error.constraints) {\r\n                Object.keys(error.constraints).forEach(key => {\r\n                  errorObj[key] = {\r\n                    value: value,\r\n                    name: error.constraints[key],\r\n                    error: error\r\n                  };\r\n                });\r\n              }\r\n            });\r\n          }\r\n          // formform.isFormValidform\r\n          Form.updateErrors(controlProp, errorObj, id, value, pathData.isGrid);\r\n          const formErrors = viewChange['errors'] || {};\r\n          const mergedErrors = Object.assign({}, formErrors, errorObj);\r\n          let validateError = null;\r\n          if (Object.keys(mergedErrors).length > 0) {\r\n            validateError = { [propertyName]: mergedErrors };\r\n          }\r\n          if (typeof (callback) === 'function') {\r\n            callback(validateError);\r\n          }\r\n        }, viewChange.context);\r\n      };\r\n\r\n      // \r\n      // \r\n      if (bindingObject.primaryKey) {\r\n        const primaryKey = bindingObject.primaryKey;\r\n        if (propertyName !== primaryKey) {\r\n          if (!entity[primaryKey] || entity[primaryKey] !== bindingObject[primaryKey]) {\r\n            entityValidate();\r\n            return;\r\n          }\r\n        } else if (entity[propertyName] !== value) {\r\n          // todo: \r\n          entity[propertyName] = value;\r\n          entityValidate();\r\n          return;\r\n        }\r\n      }\r\n\r\n      // BindingObjectEntity\r\n      if (entity[propertyName] === value) {\r\n        entityValidate();\r\n        return;\r\n      }\r\n\r\n      // ,\r\n      // bingdingObject\r\n      entityValidate((errors: any) => {\r\n        entity.errors = errors;\r\n        entity[propertyName] = value;\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * entityListEntityBindingObjectbindingListentityListbindingList\r\n   * @param entityList  \r\n   * @param bindingList \r\n   */\r\n  static loadEntityList(entityList: EntityList<any>, bindingList: BindingList) {\r\n    this.loadEntities(entityList.items, bindingList);\r\n    this.setUpEntityListPipeline(entityList, bindingList);\r\n  }\r\n\r\n  /**\r\n   * entityListbindingList\r\n   * @param entityList  \r\n   * @param bindingList \r\n   */\r\n  static setUpEntityListPipeline(entityList: EntityList<any>, bindingList: BindingList) {\r\n    entityList.onListChanged.subscribe((modification: Modification) => {\r\n      const target = modification['target'];\r\n      if (target && target !== entityList) {\r\n        return;\r\n      }\r\n      switch (modification.type) {\r\n        // \r\n        case ModifyType.Add:\r\n        case ModifyType.Clone:\r\n          {\r\n            const entitiesToAdd = <Entity[]>modification.value;\r\n            if (entitiesToAdd.length === 0) {\r\n              return;\r\n            }\r\n            // id\r\n            const paths = modification.path;\r\n            const parentPath = paths[paths.length - 2];\r\n            const parentId = bindingList.parent.primaryKeyValue;\r\n            if (parentPath.indexOf(parentId) === -1) {\r\n              return;\r\n            }\r\n\r\n            this.appendEntities(<Entity[]>modification.value, bindingList, modification.type === ModifyType.Clone);\r\n          }\r\n          break;\r\n        case ModifyType.Insert:\r\n          {\r\n            // id\r\n            const paths = modification.path;\r\n            const parentPath = paths[paths.length - 2];\r\n            const parentId = bindingList.parent.primaryKeyValue;\r\n            const position = modification.position;\r\n            if (parentPath.indexOf(parentId) === -1) {\r\n              return;\r\n            }\r\n            this.insertEntity(modification.value[0], bindingList, position);\r\n          }\r\n          break;\r\n        // \r\n        case ModifyType.Remove:\r\n          {\r\n            // id\r\n            const paths = modification.path;\r\n            const parentPath = paths[paths.length - 2];\r\n            const parentId = bindingList.parent.primaryKeyValue;\r\n            if (parentPath.indexOf(parentId) === -1) {\r\n              return;\r\n            }\r\n            // valuevalue { primaryKey: primaryValue}\r\n            const id = modification.value[bindingList.primaryKey];\r\n            bindingList.removeByIds([id]);\r\n            // this.removeEntities(<Entity[]>modification.value, bindingList);\r\n          }\r\n          break;\r\n\r\n        // \r\n        case ModifyType.Load:\r\n          // id\r\n          const paths = modification.path;\r\n          const parentPath = paths[paths.length - 2];\r\n          const parentId = bindingList.parent.primaryKeyValue;\r\n          if (parentPath.indexOf(parentId) === -1) {\r\n            return;\r\n          }\r\n          const entities = modification.value;\r\n          this.loadEntities(entities, bindingList);\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * repositoryrepositorybindingList\r\n   * @param repository  \r\n   * @param bindingList \r\n   */\r\n  static loadRepository(repository: Repository<any>, bindingList: BindingList) {\r\n    // \r\n    const entities = Array.from(repository.entityCollection.toArray());\r\n    this.loadEntities(entities, bindingList);\r\n\r\n    // \r\n    repository.entityCollectionChange.pipe(takeUntil(repository.destroy$)).subscribe((modification: Modification) => {\r\n      switch (modification.type) {\r\n        case ModifyType.Load:\r\n          bindingList.clear(true);\r\n          this.loadEntities(<Entity[]>modification.value, bindingList, modification.entityCreate);\r\n          break;\r\n        case ModifyType.Add:\r\n        case ModifyType.Clone:\r\n          this.appendEntities(<Entity[]>modification.value, bindingList, modification.type === ModifyType.Clone, { isTreeNodeLoadScene: modification.isTreeNodeLoadScene });\r\n          break;\r\n        case ModifyType.AddData:\r\n          this.addData(<Entity[]>modification.value, bindingList, { isTreeNodeLoadScene: modification.isTreeNodeLoadScene });\r\n          break;\r\n        case ModifyType.Insert:\r\n          this.insertEntity(modification.value, bindingList, modification.position);\r\n          break;\r\n        case ModifyType.Remove:\r\n          this.removeEntities(<Entity[]>modification.value, bindingList);\r\n          break;\r\n        case ModifyType.RemoveData:\r\n          this.removeData(<Entity[]>modification.value, bindingList);\r\n          break;\r\n        case ModifyType.PaginationInfoChange:\r\n          // bindingListbindingDatabindingList\r\n          bindingList.paginationInfo = <Pagination>modification.value;\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n    });\r\n\r\n    // BindingList\r\n    bindingList.changes.pipe(takeUntil(bindingList.destroy$)).subscribe((change: Change) => {\r\n      if (change.type === ChangeType.PaginationInfoChange) {\r\n        const entityCollection = repository.entityCollection;\r\n        // const entityTypeName = entityCollection.entityTypeName;\r\n        // const original = entityCollection.paginationInfo[entityTypeName];\r\n        // const entityPaginationInfo = Object.assign({}, original, change.value);\r\n        entityCollection.paginationInfo = Object.assign({}, entityCollection.paginationInfo, change.value);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * entitiesEntityBindingObjectbindingList\r\n   * @param entities    \r\n   * @param bindingList \r\n   */\r\n  static loadEntities(entities: Entity[], bindingList: BindingList, entityCreate: boolean = false) {\r\n    const bindingObjects = this.createBindingObjects(entities, bindingList);\r\n    bindingList.load(bindingObjects, entityCreate);\r\n  }\r\n\r\n  /**\r\n   * entitiesEntityBIndingObjectbindingList\r\n   * @param entities    \r\n   * @param bindingList \r\n   * @param isCloned \r\n   * @param options \r\n   */\r\n  static appendEntities(entities: Entity[], bindingList: BindingList, isCloned: boolean = false, options: any = null) {\r\n    const bindingObjects = this.createBindingObjects(entities, bindingList);\r\n    bindingList.append(bindingObjects, isCloned, options);\r\n  }\r\n  /**\r\n   * \r\n   * @param entity \r\n   * @param propertyName \r\n   * @returns \r\n   */\r\n  static isEffectiveField(entity: Entity, propertyName: string) {\r\n    if (!entity || !propertyName) {\r\n      return false;\r\n    }\r\n    propertyName = propertyName.toLowerCase();\r\n    if (entity['__farris_effective_fields__']) {\r\n      return entity['__farris_effective_fields__'].includes(propertyName);\r\n    }\r\n    if (entity['farris_effective_fields'] && typeof entity['farris_effective_fields'] === 'string') {\r\n      const effectiveFields = entity['farris_effective_fields'].split(',').filter(p => p).map(item => item.toLowerCase());\r\n      entity['__farris_effective_fields__'] = effectiveFields;\r\n      return effectiveFields.includes(propertyName);\r\n    }\r\n    return true;\r\n  }\r\n  /**\r\n   * \r\n   * @param entities \r\n   * @param bindingList \r\n   */\r\n  static addData(entities: Entity[], bindingList: BindingList, options: any = null) {\r\n    const bindingObjects = this.createBindingObjects(entities, bindingList);\r\n    bindingList.addData(bindingObjects, options);\r\n  }\r\n  static insertEntity(entity: Entity, bindingList: BindingList, position: -1 | 1) {\r\n    const bindingObject = this.createBindingObject(entity, bindingList);\r\n    bindingList.insert(bindingObject, position);\r\n  }\r\n  /**\r\n   * bindingListentitiesBindingObject\r\n   * @param entities    \r\n   * @param bindingList \r\n   */\r\n  static removeEntities(entities: Entity[], bindingList: BindingList) {\r\n    if (entities === null || entities.length === 0) {\r\n      return;\r\n    }\r\n\r\n    // id\r\n    const primaryKey = bindingList.primaryKey;\r\n    const ids = [];\r\n    entities.forEach((entity: Entity) => {\r\n      ids.push(entity[primaryKey]);\r\n    });\r\n    bindingList.removeByIds(ids);\r\n  }\r\n  static removeData(entities: Entity[], bindingList: BindingList) {\r\n    if (entities === null || entities.length === 0) {\r\n      return;\r\n    }\r\n    // id\r\n    const primaryKey = bindingList.primaryKey;\r\n    const ids = [];\r\n    entities.forEach((entity: Entity) => {\r\n      ids.push(entity[primaryKey]);\r\n    });\r\n    bindingList.removeDataByIds(ids);\r\n  }\r\n  /**\r\n   * entitiesEntityBindingObject\r\n   * @param entities    \r\n   * @param bindingList \r\n   */\r\n  static createBindingObjects(entities: Entity[], bindingList: BindingList) {\r\n    if (entities === null || entities.length === 0) {\r\n      return [];\r\n    }\r\n    const bindingObjects = [];\r\n    entities.forEach((entity: Entity) => {\r\n      const bindingObject = BindingObjectFactory.create(bindingList.properties);\r\n      bindingObject['_ENTITY_'] = entity;\r\n      this.loadEntity(entity, bindingObject);\r\n\r\n      // // bindingObjectinitialData\r\n      // if (entity['initialData']) {\r\n      //   bindingObject['initialData'] = entity['initialData'];\r\n      // }\r\n      bindingObjects.push(bindingObject);\r\n    });\r\n    return bindingObjects;\r\n  }\r\n  static createBindingObject(entity: Entity, bindingList: BindingList) {\r\n    const bindingObject = BindingObjectFactory.create(bindingList.properties);\r\n    this.loadEntity(entity, bindingObject);\r\n    return bindingObject;\r\n  }\r\n  public static watchReposiroty(repository: Repository<any>, bindingData: BindingData) {\r\n    // reposiroty => bindingData\r\n    repository.entityCollectionChange.subscribe((modification: Modification) => {\r\n      switch (modification.type) {\r\n        case ModifyType.PaginationInfoChange:\r\n          bindingData.pagingInfo = modification.value;\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n    });\r\n  }\r\n  /**\r\n   * \r\n   * @param entityType \r\n   * @param targetPropName \r\n   * @return NgFieldNgObjectNgListNgFieldnull\r\n   */\r\n  static getPropInfo(entityType: any, targetPropName: string): { propType: string, propEntityType: any } {\r\n\r\n    let propType: string;\r\n    let propEntityType: any;\r\n\r\n    // NgField\r\n    const ngFieldProperties = FieldMetadataUtil.getNgFields(entityType);\r\n    Object.keys(ngFieldProperties).forEach((propName: string) => {\r\n      if (propName === targetPropName) {\r\n        propType = 'NgField';\r\n        propEntityType = null;\r\n      }\r\n    });\r\n\r\n    // NgObject\r\n    const ngObjectProperties = FieldMetadataUtil.getNgObjects(entityType);\r\n    Object.keys(ngObjectProperties).forEach((propName: string) => {\r\n      if (propName === targetPropName) {\r\n        propType = 'NgObject';\r\n        propEntityType = ngObjectProperties[propName].type;\r\n      }\r\n    });\r\n\r\n    // NgList\r\n    const ngListProperties = FieldMetadataUtil.getNgList(entityType);\r\n    Object.keys(ngListProperties).forEach((propName: string) => {\r\n      if (propName === targetPropName) {\r\n        propType = 'NgList';\r\n        propEntityType = ngListProperties[propName].type;\r\n      }\r\n    });\r\n\r\n    const ngDynamicProperties = FieldMetadataUtil.getNgDynamic(entityType);\r\n    Object.keys(ngDynamicProperties).forEach((propName: string) => {\r\n      if (propName === targetPropName) {\r\n        propType = 'NgDynamic';\r\n        propEntityType = ngDynamicProperties[propName].type;\r\n      }\r\n    });\r\n\r\n    return { propType, propEntityType };\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param entityType \r\n   */\r\n  static getPrimaryKey(entityType: any) {\r\n    const primaryNgFiledProp = FieldMetadataUtil.getPrimaryFieldMetadata(entityType);\r\n    if (primaryNgFiledProp) {\r\n      return primaryNgFiledProp.dataField;\r\n    } else {\r\n      return '';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  static isObjectProp(entityType: any, targetPropName: string,) {\r\n    let isObjectProp = false;\r\n    const ngObjectProperties = FieldMetadataUtil.getNgObjects(entityType);\r\n    Object.keys(ngObjectProperties).forEach((propName: string) => {\r\n      if (propName === targetPropName) {\r\n        isObjectProp = true;\r\n      }\r\n    });\r\n    return isObjectProp;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  static isDynamicProp(entityType: any, targetPropName: string) {\r\n    let isDynamicProp = false;\r\n    const ngDynamicProperties = FieldMetadataUtil.getNgDynamic(entityType);\r\n    Object.keys(ngDynamicProperties).forEach((propName: string) => {\r\n      if (propName === targetPropName) {\r\n        isDynamicProp = true;\r\n      }\r\n    });\r\n    return isDynamicProp;\r\n  }\r\n\r\n  /**\r\n   * initialData\r\n   * @param entity \r\n   * @param initialData \r\n   */\r\n  static appendInitialData(entity, initialData) {\r\n    const data = Object.assign({}, initialData);\r\n    delete data.id;\r\n    delete data.parentID;\r\n    entity['initialData'] = data;\r\n  }\r\n}\r\n\r\nexport { EntityUtil };\r\n","// tslint:disable: max-line-length member-ordering\r\n/**\r\n * \r\n * @author Witt<jiwt@inspur.com>\r\n * @todo\r\n * 1BindingDataBindingData\r\n * 2\r\n */\r\n\r\nimport { Injectable, OnDestroy } from '@angular/core';\r\nimport { Subject } from 'rxjs';\r\nimport { DataTypeInfo } from '../core/data-type-info';\r\nimport { Repository } from '../repository/index';\r\nimport { Change, ChangeType } from './changes';\r\nimport { BindingProperty } from './binding_property';\r\nimport { BindingList } from './binding_list';\r\nimport { BindingListFactory } from './binding_list_factory';\r\nimport { PropertyUtil } from './property_util';\r\nimport { EntityUtil } from './entity_util';\r\nimport { BindingObject } from './binding_object';\r\nimport { InvokeOnValueChange } from './types';\r\nimport { IDisposable } from '../core';\r\n\r\n/**\r\n * \r\n * @description\r\n * # BindingData\r\n * \r\n * BindingDataBindingListBindingObject\r\n * \r\n * ## \r\n * \r\n * ### \r\n * \r\n * ```javascript\r\n * //paths\r\n * //@param paths \r\n * //@param value \r\n * //@param emitEventToView truefalse\r\n * //@param emitEventToEntity trueEntitytrue\r\n * public setValue(paths: string[], value: any, emitEventToView: boolean = false, emitEventToEntity: boolean = true)\r\n * ```\r\n * \r\n * ### \r\n * \r\n * - \r\n * \r\n *   ```javascript\r\n *   bindingData.setValue(['name'],'ESG');\r\n *   ```\r\n * \r\n * - \r\n * \r\n *   ```javascript\r\n *   bindingData.setValue(['soItems','price'],20);\r\n *   ```\r\n * \r\n * - \r\n * \r\n *   ```javascript\r\n *   bindingData.setValue(['udt','udt_field'],'value');\r\n *   ```\r\n * \r\n * - \r\n * \r\n *   ```javascript\r\n *   bindingData.setValue(['name'],'ESG',true,false);\r\n *   ```\r\n * \r\n *   > \r\n *   >\r\n *   > bindingDatabindingData\r\n *   >\r\n *   > `FrameContext``BindingData` * bindingData\r\n *   >\r\n *   > - :\r\n *   >\r\n *   >   ```javascript\r\n *   >   const frameContext = this.frameContext.bindingData;\r\n *   >   frameContext.bindingData.setValue(['name'],'ESG');\r\n *   >   ```\r\n *   >\r\n *   > - \r\n *   >\r\n *   >   ```javascript\r\n *   >   const cardFrameContext = this.frameContext.appContext.frameContextManager.getFrameContextById('card-frameId');\r\n *   >   cardFrameContext.bindingData.setValue(['name'],'ESG');\r\n *   >   ```\r\n * \r\n * ## \r\n * \r\n * ### \r\n * \r\n *   ```javascript\r\n *   //paths\r\n *   //@param  paths \r\n *   //@returns \r\n *   public getValue(paths: string[], useInitValue = false)\r\n *   ```\r\n * \r\n * ### \r\n * \r\n * - \r\n * \r\n *   ```javascript\r\n *   bindingData.getValue(['name']) //'ESG'\r\n *   ```\r\n * \r\n * - \r\n * \r\n *   ```javascript\r\n *   bindingData.getValue(['soItems','price']); // 20\r\n *   ```\r\n * \r\n * - \r\n * \r\n *   ```javascript\r\n *   bindingData.getValue(['udt','udt_field']); // 'value'\r\n *   ```\r\n * \r\n * ## BindingObject\r\n * \r\n * ### \r\n * \r\n * ```javascript\r\n * //bindingObject\r\n * bindingData.list.findById(id: string): BindingObject;\r\n * ```\r\n * \r\n * ### \r\n * - \r\n *   ```javascript\r\n *   bindingData.list.findById(\"id\");\r\n *   ```\r\n * - \r\n *   ```javascript\r\n *   // \r\n *   const bindingObject = bindingData.list.findById(\"id\") as BindingObject;\r\n *   // \r\n *   const bindingList = bindingObject.getValue(\"soItems\") as BindingList;\r\n *   ```\r\n * \r\n * - \r\n * \r\n *   ```javascript\r\n *   //\r\n *   const bindingObject = bindingData.list.findById(\"id\") as BindingObject;\r\n *   //\r\n *   const bindingList = bindingObject.getValue(\"soItems\") as BindingList;\r\n *   //\r\n *   const childrenBindingObject = bindingList.findById('id');\r\n *   const name = childrenBindingObject.getValue(\"name\"); // childrenBindingObject['name']\r\n *   ```\r\n * \r\n * ## \r\n * \r\n * ### \r\n * \r\n *    BindingData& * \r\n * \r\n *    BindingObject\r\n * \r\n * ### bindingData\r\n * \r\n *    bindingDatabindingData * \r\n * \r\n *    \r\n */\r\n@Injectable()\r\nclass BindingData implements IDisposable, OnDestroy{\r\n  /**\r\n   * \r\n   */\r\n  private dataTypeInfo: DataTypeInfo;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public bindingPath: string;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public properties: BindingProperty[];\r\n\r\n  /**\r\n   * \r\n   */\r\n  public rowSelectedEventSuspend: boolean;\r\n  /**\r\n   * \r\n   */\r\n  public list: BindingList;\r\n  private paginationInfo = null;\r\n\r\n  public set pagingInfo(pagingInfo: any) {\r\n    this.paginationInfo = pagingInfo;\r\n    this.firePagingChangeEvent();\r\n  }\r\n\r\n  public get pagingInfo() {\r\n    return this.paginationInfo;\r\n  }\r\n  dispose(options?: any) {\r\n    this.list.dispose();\r\n  }\r\n  ngOnDestroy(): void {\r\n    this.dispose();\r\n  }\r\n  /**\r\n   * \r\n   * @param skip \r\n   * @param take \r\n   * @param bindingPath \r\n   */\r\n  public setPagingInfo(skip: number, take: number, bindingPath: string) {\r\n    if (bindingPath.length < 1 || bindingPath === '/') {\r\n      this.paginationInfo = Object.assign(this.paginationInfo, { pageSize: take, pageIndex: skip / take + 1 });\r\n    } else {\r\n      let pagingInfo = this.paginationInfo || {};\r\n      const bindingPaths = bindingPath.substr(1).split('/').filter(item => !!item && item.length > 0); // .map(item => item.substring(0, item.length - 1));\r\n      let nodeCode = bindingPaths[bindingPaths.length - 1];\r\n      // s\r\n      nodeCode = nodeCode.substr(0, nodeCode.length - 1);\r\n      // \r\n      // \r\n      const paths = bindingPaths.slice(0, bindingPaths.length - 1);\r\n      const parentObject = this.getValue(paths) as BindingObject;\r\n      if (parentObject && parentObject[parentObject.primaryKey]) {\r\n        // const key = `${nodeCode}_${parentObject[parentObject.primaryKey]}`;\r\n        const key = `${nodeCode}`;\r\n        pagingInfo = pagingInfo[key] || {};\r\n        pagingInfo.pageIndex = ((skip / take) || 0) + 1;\r\n        pagingInfo.pageSize = take || 0;\r\n      }\r\n    }\r\n    this.firePagingChangeEvent();\r\n  }\r\n  public updatePagingInfo(pageInfo: { pageIndex?: number, pageSize?: number, total?: number }, bindingPath: string) {\r\n    if (bindingPath.length < 1 || bindingPath === '/') {\r\n      this.paginationInfo = Object.assign(this.paginationInfo, pageInfo);\r\n    } else {\r\n      let pagingInfo = this.paginationInfo || {};\r\n      const bindingPaths = bindingPath.substr(1).split('/').filter(item => !!item && item.length > 0); // .map(item => item.substring(0, item.length - 1));\r\n      let nodeCode = bindingPaths[bindingPaths.length - 1];\r\n      // s\r\n      nodeCode = nodeCode.substr(0, nodeCode.length - 1);\r\n      pagingInfo[nodeCode] = Object.assign(pagingInfo[nodeCode], pageInfo);\r\n    }\r\n    this.firePagingChangeEvent();\r\n  }\r\n  private firePagingChangeEvent() {\r\n    this.list.changes.next({\r\n      type: ChangeType.PaginationInfoChange,\r\n      path: this.bindingPath && this.bindingPath.split('/').filter(p => p) || [],\r\n      value: this.paginationInfo\r\n    });\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  public get changes(): Subject<Change> {\r\n    return this.list.changes;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private valueChangeInvokerFactory: (paths: string[]) => InvokeOnValueChange;\r\n\r\n  /**\r\n   * \r\n   * @param value \r\n   */\r\n  public setValueChangeInvokerFactory(value: (paths: string[]) => InvokeOnValueChange) {\r\n    this.valueChangeInvokerFactory = value;\r\n  }\r\n  public getValudChangeInvokerFactory() {\r\n    return this.valueChangeInvokerFactory;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public init(repository: Repository<any>, bindingPath: string) {\r\n    this.initByRepository(repository, bindingPath);\r\n  }\r\n\r\n  /**\r\n   * RepositoryBindingData\r\n   */\r\n  public initByRepository(repository: Repository<any>, bindingPath: string) {\r\n    this.bindingPath = bindingPath;\r\n\r\n    this.properties = PropertyUtil.getProperties(repository.entityType);\r\n    this.list = BindingListFactory.create(this.properties);\r\n    // repositorybindingData\r\n    this.pagingInfo = repository.entityCollection.paginationInfo;\r\n    // @todo\r\n    // BindingDataRepository\r\n    EntityUtil.loadRepository(repository, this.list);\r\n    this.dataTypeInfo = repository.entityTypeInfo;\r\n\r\n    this.extendProperties(this.properties);\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public initByBindingList(bindingList: BindingList, bindingPath: string) {\r\n    this.list = bindingList;\r\n    this.bindingPath = bindingPath;\r\n    this.extendProperties(this.list.properties);\r\n  }\r\n  public setDataTypeInfo(dataTypeInfo: DataTypeInfo) {\r\n    this.dataTypeInfo = dataTypeInfo;\r\n  }\r\n  /**\r\n   * \r\n   * @param paths \r\n   * @param useInitValue `false`\r\n   * @returns \r\n   */\r\n  public getValue(paths: string[], useInitValue = false) {\r\n    let target: any = this.list;\r\n    paths.forEach((path: string) => {\r\n      if (target) {\r\n        target = target[path];\r\n      }\r\n    });\r\n    if (useInitValue === true && paths && paths.length > 0) {\r\n      const initValue = this.getInitValueByPaths(paths);\r\n      if (target === undefined && target !== initValue) {\r\n        target = initValue;\r\n      }\r\n    }\r\n    return target;\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param paths \r\n   * @param value \r\n   * @param emitEventToView truefalse\r\n   * @param emitEventToEntity trueEntitytrue\r\n   * @description\r\n   * ## \r\n   * \r\n   * ### \r\n   * pathvalue\r\n   * \r\n   * ```typescript\r\n   * this.frameContext.bindingData.setValue(paths,value);\r\n   * ```\r\n   * \r\n   * ### \r\n   * pathsvalueemitEventToViewtrueemitEventToEntityfalse\r\n   * BindingDatasetValue\r\n   * ```typescript\r\n   * const tableFrameContext = this.frameContext.appContext.frameContextManager.getFrameContextById('data-grid-component');\r\n   * tableFrameContext.bindingData.setValue(paths,value,true,false);\r\n   * ```\r\n   * ## \r\n   * setValue\r\n   * \r\n   * \r\n   */\r\n  public setValue(paths: string[], value: any, emitEventToView: boolean = false, emitEventToEntity: boolean = true, errors: any = {}, context?: any) {\r\n\r\n    if (!paths || paths.length === 0) {\r\n      throw Error('');\r\n    }\r\n    const parentPaths = paths.slice(0, paths.length - 1);\r\n    const propName = paths[paths.length - 1];\r\n\r\n    let parent = this.getValue(parentPaths);\r\n    if (!parent) {\r\n      throw Error('');\r\n    }\r\n    if (parent instanceof BindingData) {\r\n      parent = parent.list.currentItem;\r\n    } else if (parent instanceof BindingList) {\r\n      parent = parent.currentItem;\r\n    }\r\n    if (!!this.valueChangeInvokerFactory) {\r\n      parent.setValue(propName, value, emitEventToView, emitEventToEntity, errors, this.valueChangeInvokerFactory(paths), context);\r\n    } else {\r\n      parent.setValue(propName, value, emitEventToView, emitEventToEntity, errors, null, context);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * paths\r\n   */\r\n  public clearValue(paths: string[], emitEventToView: boolean = false, emitEventToEntity: boolean = true, context?: any) {\r\n    let initValue: any;\r\n    const propInfo = this.dataTypeInfo.getPropInfoByPath(paths);\r\n    if (propInfo && propInfo.metadataInfo && propInfo.metadataInfo.initValue !== undefined) {\r\n      initValue = propInfo.metadataInfo.initValue;\r\n    } else {\r\n\r\n      // \r\n      const oldValue = this.getValue(paths);\r\n      if (typeof oldValue === 'number') {\r\n        initValue = 0;\r\n      } else {\r\n        initValue = '';\r\n      }\r\n    }\r\n    this.setValue(paths, initValue, emitEventToView, emitEventToEntity, null, context);\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public getList() {\r\n    if (!this.bindingPath || this.bindingPath === '/') {\r\n      return this.list;\r\n    }\r\n\r\n    const bindingPath = this.bindingPath.substr(1);\r\n    const bindingPathArray = bindingPath.split('/').filter((part: string) => {\r\n      return part !== '';\r\n    });\r\n    return this.getValue(bindingPathArray);\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public getObject() {\r\n    const bindingList = this.getList();\r\n    return bindingList.currentItem;\r\n  }\r\n  /**\r\n   * \r\n   * @param bindingPath \r\n   */\r\n  public getPath(bindingPath?: string[]) {\r\n    const bindingPaths = bindingPath.filter(p => p);\r\n    const path = [`${this.list.primaryKey}:${this.list.currentId}`];\r\n\r\n    bindingPaths.forEach((item: string) => {\r\n      path.push(item);\r\n      const list = this[item] as BindingList;\r\n      if (list) {\r\n        path.push(`${list.primaryKey}:${list.currentId}`);\r\n      }\r\n    });\r\n    return path;\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  public reset() {\r\n    this.list.clear(true);\r\n  }\r\n  /**\r\n   * \r\n   * @param paths \r\n   */\r\n  private getInitValueByPaths(paths: Array<string>) {\r\n    let initValue: any;\r\n    const propInfo = this.dataTypeInfo && this.dataTypeInfo.getPropInfoByPath(paths) || null;\r\n    if (propInfo && propInfo.metadataInfo && propInfo.metadataInfo.initValue !== undefined) {\r\n      initValue = propInfo.metadataInfo.initValue;\r\n    }\r\n    return initValue;\r\n  }\r\n  /**\r\n   * BindingDataBindingData\r\n   * @param properties \r\n   */\r\n  private extendProperties(properties: BindingProperty[]) {\r\n    properties.forEach((property: BindingProperty) => {\r\n      const propName = property.name;\r\n      Object.defineProperty(this, propName, {\r\n        get: () => {\r\n          return this.list.currentItem[propName];\r\n        },\r\n        set: (value: any) => {\r\n          this.list.currentItem[propName] = value;\r\n        }\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\nexport { BindingData };\r\n","/**\r\n * \r\n * @author Witt<jiwt@inspur.com>\r\n */\r\n\r\n// tslint:disable: max-line-length\r\n\r\nimport { List } from 'immutable';\r\nimport { Subject } from 'rxjs';\r\n\r\nimport { Change, ChangeType } from './changes';\r\nimport { BindingObject } from './binding_object';\r\nimport { BindingProperty } from './binding_property';\r\nimport { BindingObjectFactory } from './binding_object_factory';\r\nimport { PropertyUtil } from './property_util';\r\nimport { BindingData } from './binding_data';\r\nimport { TranslateService } from '../i18n/translate_service';\r\nimport { IDisposable } from '../core';\r\n\r\n/**\r\n * BindingListBindingObject\r\n */\r\nclass BindingList implements IDisposable {\r\n  public __type__ = 'BindingList';\r\n  /**\r\n   * immutableBindingObject\r\n   */\r\n  private innerList: List<BindingObject>;\r\n\r\n  private emptyCurrentItem: BindingObject;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public properties: BindingProperty[];\r\n\r\n  /**\r\n   * \r\n   */\r\n  public primaryKey: string;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public parent: BindingObject;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public changes: Subject<Change>;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public currentId: string;\r\n  /**\r\n   * destory signal\r\n   */\r\n  public destroy$: Subject<any>;\r\n\r\n  //#region \r\n\r\n  /**\r\n   * \r\n   */\r\n  public _paginationInfo: any = null;\r\n\r\n  set paginationInfo(sPaginationInfo: any) {\r\n    this._paginationInfo = sPaginationInfo;\r\n    if (this._paginationInfo === sPaginationInfo) {\r\n      return;\r\n    }\r\n    this.changes.next({\r\n      type: ChangeType.PaginationInfoChange,\r\n      path: [],\r\n      value: this._paginationInfo\r\n    });\r\n  }\r\n\r\n  get paginationInfo(): any {\r\n    return this._paginationInfo;\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  get pageIndex() {\r\n    if (!!this.paginationInfo && this.paginationInfo.hasOwnProperty(\"pageIndex\")) {\r\n      return this.paginationInfo.pageIndex;\r\n    }\r\n    return 1;\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  get pageSize() {\r\n    if (!!this.paginationInfo && this.paginationInfo.hasOwnProperty(\"pageSize\")) {\r\n      return this.paginationInfo.pageSize;\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  get total() {\r\n    if (!!this.paginationInfo) {\r\n      return this.paginationInfo.total || this.paginationInfo.totalCount;\r\n    }\r\n    return 0;\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  get skip() {\r\n    const pageIndex = this.pageIndex;\r\n    const pageSize = this.pageSize;\r\n    return (pageIndex - 1) * pageSize;\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param skip skip\r\n   * @param take take\r\n   */\r\n  public setPaginationInfo(skip: number, take: number) {\r\n    this.paginationInfo = Object.assign({}, this.paginationInfo, {\r\n      pageSize: take,\r\n      pageIndex: skip / take + 1\r\n    });\r\n    /*this.changes.next({\r\n      type: ChangeType.PaginationInfoChange,\r\n      path: [],\r\n      value: this.paginationInfo\r\n    });*/\r\n  }\r\n  //#endregion\r\n\r\n\r\n\r\n  /**\r\n   * \r\n   * currentIdnull\r\n   */\r\n  public get currentItem(): BindingObject {\r\n    const currentItem = this.findById(this.currentId);\r\n    if (!currentItem) {\r\n      if (!this.emptyCurrentItem) {\r\n        this.emptyCurrentItem = BindingObjectFactory.create(this.properties);\r\n      }\r\n      return this.emptyCurrentItem;\r\n    }\r\n    return currentItem;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public get length(): number {\r\n    return this.innerList.count();\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  constructor(properties: BindingProperty[]) {\r\n    this.properties = properties;\r\n    this.primaryKey = PropertyUtil.getPrimaryKey(properties);\r\n\r\n    this.changes = new Subject<Change>();\r\n    this.innerList = List<BindingObject>();\r\n    this.currentId = null;\r\n    this.destroy$ = new Subject();\r\n  }\r\n  /**\r\n   * \r\n   * @param options \r\n   */\r\n  dispose(options?: any) {\r\n    this.clear(true);\r\n    if (this.destroy$) {\r\n      this.destroy$.next();\r\n      this.destroy$.complete();\r\n      this.destroy$ = null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * [Symbol.iterator]for of\r\n   */\r\n  [Symbol.iterator]() {\r\n    const self = this;\r\n    let index = -1;\r\n    const size = this.innerList.size;\r\n\r\n    return {\r\n      next: function () {\r\n        index++;\r\n        if (index < size) {\r\n          return { done: false, value: self.innerList.get(index) };\r\n        }\r\n        return { done: true, value: undefined };\r\n      }\r\n    };\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param objects \r\n   */\r\n  public load(objects: BindingObject[], entityCreate: boolean = false): void {\r\n    // \r\n    this.innerList = this.innerList.clear();\r\n    if (objects.length !== 0) {\r\n      // \r\n      objects.forEach((object: BindingObject) => {\r\n        this.add(object);\r\n      });\r\n\r\n      // \r\n      const currentItem = this.findById(this.currentId);\r\n      if (!currentItem) {\r\n        const firstId = objects[0][this.primaryKey];\r\n        this.setCurrentId(firstId, false, false);\r\n      }\r\n    } else {\r\n      this.currentId = null;\r\n    }\r\n    const change: Change = {\r\n      type: ChangeType.Load,\r\n      path: [],\r\n      value: objects\r\n    };\r\n    change.create = entityCreate;\r\n    // \r\n    this.changes.next(change);\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param objects \r\n   */\r\n  public append(objects: BindingObject[], isCloned: boolean = false, options: any = null): void {\r\n    if (objects.length === 0) {\r\n      return;\r\n    }\r\n    // BindingObject\r\n    objects.forEach((object: BindingObject) => {\r\n      this.add(object);\r\n    });\r\n    // 1\r\n    const lastId = objects[objects.length - 1][this.primaryKey];\r\n    this.setCurrentId(lastId, true, true);\r\n    // \r\n    const change: Change = {\r\n      type: ChangeType.Append,\r\n      path: [],\r\n      value: objects,\r\n      isTreeNodeLoadScene: options && options.isTreeNodeLoadScene\r\n    };\r\n    if (isCloned) {\r\n      change.isCloned = true;\r\n    }\r\n    this.changes.next(change);\r\n  }\r\n  /**\r\n   * \r\n   * @param objects \r\n   * @param options \r\n   * @description \r\n   */\r\n  public addData(objects: BindingObject[], options: any = null): void {\r\n    if (objects.length === 0) {\r\n      return;\r\n    }\r\n    // BindingObject\r\n    objects.forEach((object: BindingObject) => {\r\n      this.add(object);\r\n    });\r\n    // \r\n    this.changes.next({\r\n      type: ChangeType.Append,\r\n      path: [],\r\n      value: objects,\r\n      isTreeNodeLoadScene: options && options.isTreeNodeLoadScene\r\n    });\r\n  }\r\n  public insert(object: BindingObject, position?: 1 | -1) {\r\n    const currentIndex = this.innerList.findIndex((obj: BindingObject) => obj.primaryKeyValue === this.currentId);\r\n    // BindingObject\r\n    if (position === 1) {\r\n      this.innerList = this.innerList.insert(currentIndex + 1, object);\r\n    } else if (position === -1) {\r\n      this.innerList = this.innerList.insert(currentIndex, object);\r\n    } else {\r\n      this.innerList = this.innerList.push(object);\r\n    }\r\n    object.parent = this;\r\n    // objectlistpath\r\n    object.changes.subscribe((change: Change) => {\r\n      this.changes.next(change);\r\n    });\r\n\r\n    this.setCurrentId(object.primaryKeyValue, true, true);\r\n\r\n    // \r\n    this.changes.next({\r\n      type: ChangeType.Append,\r\n      path: [],\r\n      value: object\r\n    });\r\n  }\r\n  /**\r\n   * \r\n   * @param object \r\n   */\r\n  public add(object: BindingObject) {\r\n    this.innerList = this.innerList.push(object);\r\n    object.parent = this;\r\n\r\n    // objectlistpath\r\n    object.changes.subscribe((change: Change) => {\r\n      this.changes.next(change);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param ids \r\n   */\r\n  public removeByIds(ids: Array<string>): void {\r\n    if (!ids || ids.length === 0) {\r\n      return;\r\n    }\r\n\r\n    let nextCurrentId = this.currentId;\r\n    ids.forEach((id: string) => {\r\n\r\n      // \r\n      if (id === nextCurrentId) {\r\n        nextCurrentId = this.getCurrentIdBeforeDeleting();\r\n      }\r\n\r\n      // \r\n      const index = this.getIndexById(id);\r\n      if (index === -1) {\r\n        return;\r\n      }\r\n      this.innerList = this.innerList.delete(index);\r\n    });\r\n\r\n    // \r\n    if (this.innerList.count() === 0) {\r\n      this.currentId = null;\r\n    } else {\r\n      this.setCurrentId(nextCurrentId, false, false);\r\n    }\r\n\r\n    // \r\n    this.changes.next({\r\n      type: ChangeType.Remove,\r\n      path: [],\r\n      value: ids\r\n    });\r\n  }\r\n  /**\r\n   * \r\n   * @param ids ids\r\n   */\r\n  public removeDataByIds(ids: Array<string>): void {\r\n    if (!ids || ids.length === 0) {\r\n      return;\r\n    }\r\n\r\n    ids.forEach((id: string) => {\r\n      // \r\n      const index = this.getIndexById(id);\r\n      if (index === -1) {\r\n        return;\r\n      }\r\n      this.innerList = this.innerList.delete(index);\r\n    });\r\n\r\n    // \r\n    this.changes.next({\r\n      type: ChangeType.Remove,\r\n      path: [],\r\n      value: ids\r\n    });\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  public clear(clearOnly: boolean = false) {\r\n    this.innerList.forEach((item: BindingObject) => {\r\n      item['_ENTITY_'] = null;\r\n      item.unsubscribe.next();\r\n      item.unsubscribe.complete();\r\n      item.changes.complete();\r\n      item.viewChanges.complete();\r\n    });\r\n    this.innerList = this.innerList.clear();\r\n    if (!clearOnly) {\r\n      this.currentId = null;\r\n      this.changes.next({\r\n        type: ChangeType.Remove,\r\n        path: [],\r\n        value: []\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * \r\n   * - 11\r\n   * - 1\r\n   */\r\n  public getCurrentIdBeforeDeleting(): string {\r\n    let nextIndex = -1;\r\n    const currentIndex = this.getIndexById(this.currentId);\r\n    if (currentIndex === this.length - 1) {\r\n      nextIndex = currentIndex - 1;\r\n    } else {\r\n      nextIndex = currentIndex + 1;\r\n    }\r\n    return this.getIdByIndex(nextIndex);\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param   id \r\n   * @returns BindingObject null\r\n   */\r\n  public findById(id: string): BindingObject | null {\r\n    let target: BindingObject;\r\n    target = this.innerList.find((item) => {\r\n      return item.getValue(this.primaryKey) === id;\r\n    });\r\n    return target === undefined ? null : target;\r\n  }\r\n\r\n  /**\r\n   * id\r\n   * @param  id        \r\n   * @param  emitEvent \r\n   * @param  force \r\n   */\r\n  public setCurrentId(id: string, emitEvent: boolean = true, emitGlobalEvent: boolean = true, force: boolean = false): void {\r\n    if (this.currentId === id && !force) {\r\n      return;\r\n    }\r\n\r\n    // null\r\n    // const currentObj = this.findById(id);\r\n    // if (!currentObj) {\r\n    //   this.currentId = null;\r\n    // } else {\r\n    //   this.currentId = id;\r\n    // }\r\n\r\n    // @todonull\r\n    const currentObj = this.findById(id);\r\n    if (!currentObj && !force) {\r\n      return;\r\n    }\r\n    this.currentId = id;\r\n\r\n    // \r\n    if (emitEvent === true) {\r\n      this.changes.next({\r\n        type: ChangeType.SelectionChanged,\r\n        path: [],\r\n        value: this.currentItem,\r\n        force\r\n      });\r\n    }\r\n\r\n    // \r\n    if (emitGlobalEvent === true) {\r\n      this.changes.next({\r\n        type: ChangeType.GlobalSelectionChanged,\r\n        path: [],\r\n        value: this.currentItem,\r\n        force\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * id\r\n   * @param id \r\n   * @returns index-1\r\n   */\r\n  public getIndexById(id: string): number {\r\n    return this.innerList.findIndex((obj: BindingObject) => {\r\n      return obj[this.primaryKey] === id;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @reutrn null\r\n   */\r\n  public getIdByIndex(index: number): string {\r\n\r\n    if (index < 0 || index > this.length) {\r\n      return null;\r\n    }\r\n\r\n    if (this.innerList.has(index) === false) {\r\n      return null;\r\n    }\r\n    const obj = this.innerList.get(index);\r\n    return obj[this.primaryKey];\r\n  }\r\n\r\n  /**\r\n   * BindingObject\r\n   */\r\n  public toArray(): BindingObject[] {\r\n    return this.innerList.toArray();\r\n  }\r\n  /**\r\n   * \r\n   * @param id1 id1\r\n   * @param id2 id2\r\n   */\r\n  public swapById(id1: any, id2: any) {\r\n    const item1 = this.innerList.find(element => element.primaryKeyValue === id1);\r\n    const item2 = this.innerList.find(element => element.primaryKeyValue === id2);\r\n    this.innerList = this.innerList.map((bindingObject: BindingObject, index: number) => {\r\n      if (bindingObject.primaryKeyValue === id1) {\r\n        return item2;\r\n      } else if (bindingObject.primaryKeyValue === id2) {\r\n        return item1;\r\n      } else return bindingObject;\r\n    }).toList();\r\n    this.changes.next({\r\n      type: ChangeType.Swap,\r\n      path: []\r\n    });\r\n  }\r\n  /**\r\n   * JSON\r\n   * @returns \r\n   */\r\n  public toJSON(options?: any): any[] {\r\n    const result = [];\r\n    this.innerList.forEach((obj: BindingObject) => {\r\n      result.push(obj.toJSON(options));\r\n    });\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param path \r\n   * @param defaultValue \r\n   */\r\n  public getPaginationConfigByPath(path: string, defaultValue?: any) {\r\n    if (!path || path === '/') {\r\n      return this.paginationInfo;\r\n    }\r\n    if (typeof path !== 'string') {\r\n      throw new Error('');\r\n    }\r\n    path = path.substring(1);\r\n    const paths = path.split('/').filter(item => !!item && item.trim().length > 0).map(item => item.trim());\r\n    let config = this.paginationInfo;\r\n    paths.forEach(item => {\r\n      if (config && config.hasOwnProperty(item)) {\r\n        config = config[item];\r\n      } else {\r\n        config = null;\r\n      }\r\n    });\r\n    return !!config ? config : typeof defaultValue !== 'undefined' ? defaultValue : undefined;\r\n  }\r\n  /**\r\n   * bindingList\r\n   * @param string \r\n   * @param directions \r\n   * @param options \r\n   */\r\n  public sortBy(fields: string | Array<string>, directions: string | Array<string>, options?: { [prop: string]: any }) {\r\n    if (!fields || fields.length < 1 || !directions || directions.length < 1) {\r\n      throw new Error('sortBy:argument error');\r\n    }\r\n    // \r\n    const arrFields: Array<string> = typeof fields === 'string' ? fields.split(',') : fields || [];\r\n    const arrDirections: Array<string> = typeof directions === 'string' ? directions.split(',') : directions || [];\r\n    // \r\n    if (arrFields.length !== arrDirections.length || arrFields.length < 1) {\r\n      throw new Error('sortBy:fields and directions not match');\r\n    }\r\n    // nage,age,total\r\n    const comparator = (props: Array<string>, orders: Array<string>) => (item1: BindingObject, item2: BindingObject) => {\r\n      return props.reduce((result, prop) => {\r\n        if (result === 0) {\r\n          const bindingProperty = this.properties.find(item => item.name === prop);\r\n          let isMultiLangProp = false;\r\n          if (bindingProperty) {\r\n            isMultiLangProp = bindingProperty.enableMultiLangInput;\r\n          }\r\n          const currentLanguage = TranslateService.getCurrentLanguage();\r\n          const order = ['asc'].includes(orders[props.indexOf(prop)]) ? 1 : -1;\r\n          let item1Value = this.getValue(item1, prop, isMultiLangProp, currentLanguage);\r\n          let item2Value = this.getValue(item2, prop, isMultiLangProp, currentLanguage);\r\n\r\n          if (item1Value === null || item1Value === undefined) { item1Value = ''; }\r\n          if (item2Value === null || item2Value === undefined) { item2Value = ''; }\r\n\r\n          if (typeof item1Value === 'string' && typeof item2Value === 'string') {\r\n            const localeCompareResult = item1Value.localeCompare(item2Value);\r\n            result = localeCompareResult * order;\r\n          } else {\r\n            if (item1Value > item2Value) { result = order * 1; }\r\n            if (item1Value < item2Value) { result = order * -1; }\r\n          }\r\n        }\r\n        return result;\r\n      }, 0);\r\n    };\r\n    this.innerList = this.innerList.sort(comparator(arrFields, arrDirections)).toList();\r\n  }\r\n  private getValue(target: any, propName: string, isMultiLangProp: boolean = false, currentLanguage: string = 'zh-CHS') {\r\n    if (target instanceof BindingList) {\r\n      target = target.currentItem;\r\n    } else if (target instanceof BindingData) {\r\n      target = target.list.currentItem;\r\n    }\r\n    let result = null;\r\n    if (propName.indexOf('.') === -1) {\r\n      result = target[propName];\r\n    } else {\r\n      const props = propName.split('.');\r\n      for (const prop of props) {\r\n        target = result = this.getValue(target, prop, isMultiLangProp, currentLanguage);\r\n      }\r\n    }\r\n    if (isMultiLangProp && result && result.hasOwnProperty(currentLanguage)) {\r\n      return result[currentLanguage];\r\n    } else {\r\n      return result;\r\n    }\r\n  }\r\n}\r\n\r\nexport { BindingList };\r\n","import { Entity } from '../entity/index';\r\nimport { Repository, EntityManager } from '../repository/index';\r\nimport { PropertyUtil as BindingPropertyUtil } from './property_util';\r\nimport { EntityUtil as EntityLoadUtil } from './entity_util';\r\nimport { BindingListFactory } from './binding_list_factory';\r\nimport { BindingData } from './binding_data';\r\n\r\n\r\nclass BindingDataFactory {\r\n\r\n  /**\r\n   * RepositoryBindingData\r\n   */\r\n  public static createFromRepository(repository: Repository<Entity>, bindingPath: string): BindingData {\r\n    const bindingData = new BindingData();\r\n    const bindingProperties = BindingPropertyUtil.getProperties(repository.entityType);\r\n    const bindingList = BindingListFactory.create(bindingProperties);\r\n    bindingData.initByBindingList(bindingList, bindingPath);\r\n    bindingData.setDataTypeInfo(repository.entityTypeInfo);\r\n    EntityLoadUtil.loadRepository(repository, bindingList);\r\n\r\n    // repositorybindingData\r\n    bindingData.pagingInfo = repository.entityCollection.paginationInfo;\r\n    return bindingData;\r\n  }\r\n\r\n  /**\r\n   * EntityManagerBindingData\r\n   * @internal\r\n   * @summary\r\n   * 1\r\n   * 2BindingData\r\n   */\r\n  public static createFromEntityManager(entityManager: EntityManager<Entity>, bindingPath: string): BindingData {\r\n    const bindingData = new BindingData();\r\n    const bindingProperties = BindingPropertyUtil.getProperties(entityManager.entityType);\r\n    const bindingList = BindingListFactory.create(bindingProperties);\r\n    bindingData.initByBindingList(bindingList, bindingPath);\r\n\r\n    // \r\n    const entities: Entity[] = entityManager.getEntitiesByPath([]);\r\n    EntityLoadUtil.loadEntities(entities, bindingList);\r\n\r\n    return bindingData;\r\n  }\r\n\r\n  /**\r\n   * BindingDataBindingData\r\n   */\r\n  public static createFromExistingBindingData(existingBindingData: BindingData, bindingPath: string) {\r\n    const bindingData = new BindingData();\r\n    bindingData.initByBindingList(existingBindingData.list, bindingPath);\r\n    return bindingData;\r\n  }\r\n}\r\n\r\nexport { BindingDataFactory };\r\n","/**\r\n * \r\n * @author Witt<jiwt@inspur.com>\r\n */\r\n\r\nimport { Type } from '@angular/core';\r\nimport { TypeDecorator, makeDecorator } from '../metadata/index';\r\nimport { Repository } from '../repository/index';\r\nimport { Entity } from '../entity/index';\r\n\r\n/**\r\n * NgBindingData\r\n * @formType {string}\r\n */\r\nexport const NG_BINDING_DATA = 'NgBindingData';\r\n\r\n/**\r\n * NgBindingData\r\n */\r\nexport interface NgBindingData {\r\n\r\n  // /**\r\n  //  * entity\r\n  //  */\r\n  // entity: Type<Entity>;\r\n\r\n  /**\r\n   * repository\r\n   */\r\n  repository: Type<Repository<any>>;\r\n}\r\n\r\n/**\r\n * NgBindingContextDecorator\r\n */\r\nexport interface NgBindingDataDecorator {\r\n\r\n  (obj?: NgBindingData): TypeDecorator;\r\n\r\n  new(obj?: NgBindingData): NgBindingData;\r\n\r\n}\r\n\r\n/**\r\n * NgBindingContext\r\n */\r\n\r\n// export const NgBindingData: NgBindingDataDecorator =\r\n//   makeDecorator(NG_BINDING_DATA, (obj: NgBindingData) => obj);\r\nexport function NgBindingData(options: NgBindingData) {\r\n  const decoratorFactory = makeDecorator(NG_BINDING_DATA, (obj: NgBindingData) => obj);\r\n  return decoratorFactory(options);\r\n}\r\n","import { BindingData, BindingPropertyType, PropertyUtil } from '../binding-data/index';\r\n/**\r\n * /PathNode1/PathNode2/...\r\n */\r\nclass DataPathUtil {\r\n\r\n  /**\r\n   * BindingData\r\n   */\r\n  public static convertToBindingPathArray(path: string): string[] {\r\n    const bindingPathArray = path.split('/').filter((part: string) => {\r\n      return part !== '';\r\n    });\r\n    return bindingPathArray;\r\n  }\r\n\r\n  /**\r\n   * Entity\r\n   * []\r\n   * ['id:xxx', 'name'],\r\n   * ['id:xxx', 'deptInfo', 'id:xxx', 'name']\r\n   * UDT: ['id:xxx', 'updateInfo', ':', 'createdOn']\r\n   * ['id:xxx', 'edus', 'id:xxx', 'name'],\r\n   * ['id:xxx', 'edus', 'id:xxx', 'grades', 'id:xxx', 'name']\r\n   */\r\n  public static convertToEntityPathArray(path: string, bindingData: BindingData): string[] {\r\n    const bindingPathArray: string[] = this.convertToBindingPathArray(path);\r\n    const entityPathArray: string[] = [];\r\n\r\n    if (bindingPathArray.length === 0) {\r\n      return entityPathArray;\r\n    }\r\n\r\n    // \r\n    let currentBindingObject = bindingData.list.currentItem;\r\n    entityPathArray.push(\r\n      this.createPrimaryKeyPath(currentBindingObject.primaryKey, currentBindingObject.primaryKeyValue)\r\n    );\r\n\r\n    bindingPathArray.forEach((propName: string) => {\r\n      const propInfo = PropertyUtil.getPropertyByName(currentBindingObject.properties, propName);\r\n      switch (propInfo.type) {\r\n        case BindingPropertyType.Plain:\r\n          entityPathArray.push(propName);\r\n          break;\r\n        case BindingPropertyType.Object:\r\n          currentBindingObject = currentBindingObject[propName];\r\n          entityPathArray.push(propName);\r\n          entityPathArray.push(\r\n            this.createPrimaryKeyPath(currentBindingObject.primaryKey, currentBindingObject.primaryKeyValue)\r\n          );\r\n          break;\r\n        case BindingPropertyType.List:\r\n          const currentBindingList = currentBindingObject[propName];\r\n          currentBindingObject = currentBindingList.currentItem;\r\n          entityPathArray.push(propName);\r\n          entityPathArray.push(\r\n            this.createPrimaryKeyPath(currentBindingObject.primaryKey, currentBindingObject.primaryKeyValue)\r\n          );\r\n          break;\r\n        default:\r\n            break;\r\n      }\r\n    });\r\n\r\n    return entityPathArray;\r\n  }\r\n\r\n  /**\r\n   * RestUrl\r\n   *\r\n   * \r\n   * //\r\n   * /jiwtEdus/xxx/jiwtEdus\r\n   * /jiwtEdus/jiwtGrades /xxx/jiwtEdus/xxx/jiwtGrades\r\n   */\r\n  public static convertToRestUrl(path: string, bindingData: BindingData): string {\r\n    const bindingPathArray: string[] = this.convertToBindingPathArray(path);\r\n    const restPathArray: string[] = [];\r\n\r\n    let currentBindingObject = bindingData.list.currentItem;\r\n    restPathArray.push(currentBindingObject.primaryKeyValue);\r\n\r\n    bindingPathArray.forEach((propName: string) => {\r\n      const propInfo = PropertyUtil.getPropertyByName(currentBindingObject.properties, propName);\r\n      if (propInfo.type !== BindingPropertyType.List) {\r\n        throw new Error(`${propInfo.name}`);\r\n      }\r\n      const currentBindingList = currentBindingObject[propName];\r\n      currentBindingObject = currentBindingList.currentItem;\r\n      restPathArray.push(propName);\r\n      restPathArray.push(currentBindingObject.primaryKeyValue);\r\n    });\r\n\r\n    // \r\n    restPathArray.pop();\r\n    return '/' + restPathArray.join('/');\r\n  }\r\n\r\n  /**\r\n   * Path\r\n   */\r\n  public static getLeafPath(path: string): string {\r\n    const pathArray = DataPathUtil.convertToBindingPathArray(path);\r\n    return pathArray.pop();\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public static getParentPath(path: string): string {\r\n    const pathArray = DataPathUtil.convertToBindingPathArray(path);\r\n    pathArray.pop();\r\n    return '/' + pathArray.join('/');\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private static createPrimaryKeyPath(primaryKey: string, primaryKeyValue: string) {\r\n    return `${primaryKey}:${primaryKeyValue}`;\r\n  }\r\n}\r\n\r\nexport { DataPathUtil };\r\n","// tslint:disable: max-line-length\r\nimport { UID } from './uid';\r\n\r\n/**\r\n * GUID\r\n * @scope Provider\r\n */\r\nexport class Guid {\r\n\r\n    private constructor(guid: string) {\r\n        if (!guid) { throw new TypeError('Invalid argument; `value` has no value.'); }\r\n\r\n        this.value = Guid.EMPTY;\r\n\r\n        if (guid) {\r\n            this.value = guid;\r\n        }\r\n    }\r\n\r\n    public static validator = new RegExp('^[a-z0-9]+$', 'i');\r\n\r\n    public static EMPTY = '';\r\n\r\n    private value: string;\r\n\r\n    public static isGuid(guid: any) {\r\n        const value: string = guid.toString();\r\n        return guid && (guid instanceof Guid || Guid.validator.test(value));\r\n    }\r\n\r\n    public static create(): Guid {\r\n        return new Guid(UID.create());\r\n    }\r\n\r\n    public static createEmpty(): Guid {\r\n        return new Guid('');\r\n    }\r\n\r\n    public static parse(guid: string): Guid {\r\n        return new Guid(guid);\r\n    }\r\n\r\n    public static raw(): string {\r\n        return UID.create();\r\n    }\r\n\r\n    public equals(other: Guid): boolean {\r\n        // Comparing string `value` against provided `guid` will auto-call\r\n        // toString on `guid` for comparison\r\n        return Guid.isGuid(other) && this.value === other.toString();\r\n    }\r\n\r\n    public isEmpty(): boolean {\r\n        return this.value === Guid.EMPTY;\r\n    }\r\n\r\n    public toString(): string {\r\n        return this.value;\r\n    }\r\n\r\n    public toJSON(): any {\r\n        return {\r\n            value: this.value,\r\n        };\r\n    }\r\n}\r\n","import { RunMode } from \"../core\";\r\n\r\nexport class RunModeService {\r\n  private static mode: RunMode = null;\r\n  public static setRunMode(mode: RunMode) {\r\n    RunModeService.mode = mode;\r\n  }\r\n  public static getRunMode() {\r\n    return RunModeService.mode;\r\n  }\r\n}","import { Observable, Subject, from } from 'rxjs';\r\nimport { tap } from 'rxjs/operators';\r\nimport { NgFieldProperty, NgListProperty, NgObjectProperty, NgDynamicProperty, FieldMetadataUtil } from './metadata/index';\r\nimport { Modification, ModifyType, ChangeSet } from '../changeset/index';\r\nimport { PARENT_PATH, PARENT_CLASS, Dynamic } from './types';\r\nimport { EntityList } from './entity_list';\r\nimport { EntityFactory } from './entity_factory';\r\nimport { Validator, ValidationResult, ValidateRule } from './validator/index';\r\nimport { ValidationUtils } from './validator/validation_utils';\r\nimport { BigNumberType, ChangeSetPolicy, RunMode } from '../core/types';\r\nimport { UserSettingsService } from '../i18n/user_settings_service';\r\nimport { ZonedTime } from '../i18n/zoned_time';\r\nimport { FrameContext } from '../frame/index';\r\nimport { RunModeService } from '../misc';\r\n/**\r\n * @author Lucas Huang\r\n * Entity\r\n *\r\n * ### \r\n * ```\r\n * export class UserEntity extends Entity {\r\n *    userId: string;\r\n *    userName: string;\r\n *\r\n *    constructor(data: any){\r\n *        super(data);\r\n *    }\r\n * }\r\n * ```\r\n */\r\nexport abstract class Entity {\r\n  // #region \r\n\r\n  /**\r\n   * \r\n   */\r\n  private validErrors = {};\r\n  private primaryFieldMetadata: NgFieldProperty = null;\r\n  private originalData = undefined;\r\n  /**\r\n   * \r\n   */\r\n  private validator: Validator<any>;\r\n\r\n  /**\r\n   * \r\n   */\r\n  protected changeSet = new ChangeSet();\r\n\r\n  /**\r\n   * \r\n   */\r\n  protected isValidating = false;\r\n\r\n  /**\r\n   * \r\n   */\r\n  protected newData = undefined;\r\n  /**\r\n   * \r\n   */\r\n  public unsubscribe: Subject<any> = new Subject();\r\n  /**\r\n   * \r\n   */\r\n  private _changeSetPolicy: ChangeSetPolicy;\r\n  // #endregion\r\n\r\n\r\n  // #region \r\n\r\n  /**\r\n   * \r\n   */\r\n  public valueChanged = new Subject<Modification>();\r\n\r\n  /**\r\n   * \r\n   *\r\n   * ### \r\n   * ```\r\n   *  const entity = new UserEntity(data);\r\n   *  entity.onValueChanged.subscribe((data: Modification) => {\r\n   *      console.log(data);\r\n   *  })\r\n   *\r\n   * ```\r\n   *\r\n   * @event\r\n   */\r\n  public onValueChanged = this.valueChanged.asObservable();\r\n  public onUpdate = new Subject<Modification>();\r\n  /**\r\n   * JSON\r\n   */\r\n  public get data(): any {\r\n    return this.newData;\r\n  }\r\n  public set data(value: any) {\r\n    this.newData = value;\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  public get errors() {\r\n    return this.validErrors;\r\n  }\r\n\r\n  public set errors(errors: any) {\r\n    this.validErrors = errors;\r\n  }\r\n  public set changeSetPolicy(policy: ChangeSetPolicy) {\r\n    this._changeSetPolicy = policy;\r\n  }\r\n  public get changeSetPolicy(): ChangeSetPolicy {\r\n    return this._changeSetPolicy;\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  public get changes(): Modification[] {\r\n    return this.changeSet.changes;\r\n  }\r\n  /**\r\n   * \r\n   */\r\n\r\n  public get primaryProperty(): NgFieldProperty {\r\n    if (!this.primaryFieldMetadata) {\r\n      this.primaryFieldMetadata = FieldMetadataUtil.getPrimaryFieldMetadata(this.constructor);\r\n    }\r\n    return this.primaryFieldMetadata;\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @todo\r\n   * 1''undefined\r\n   */\r\n  public get primaryKey(): string {\r\n    if (this.primaryProperty) {\r\n      return this.primaryProperty.property;\r\n    } else {\r\n      return '';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * \r\n   * 1''undefined\r\n   */\r\n  public get primaryValue(): string {\r\n    if (this.primaryKey) {\r\n      // return this[this.primaryProperty.property].toString();\r\n      const primaryValue = this[this.primaryProperty.property];\r\n      return primaryValue ? primaryValue : '';\r\n    } else {\r\n      return '';\r\n    }\r\n  }\r\n\r\n  // #endregion\r\n\r\n\r\n  /**\r\n   * @param data JSON\r\n   */\r\n  constructor(data: any) {\r\n    this.validator = new Validator();\r\n    this.newData = Object.assign({}, data);\r\n    this.originalData = Object.assign({}, data);\r\n    this.onValueChanged = this.valueChanged;\r\n    // this.onValueChanged = this.valueChanged.pipe(\r\n    //     scan((x: Modification, curr: Modification) => {\r\n    //         if (x) {\r\n    //             if (isEqual(x.path, curr.path) && x.type === curr.type) {\r\n    //                 return Object.assign(x, curr);\r\n    //             }\r\n    //             return curr;\r\n    //         }\r\n    //         return curr;\r\n    //     })\r\n    // );\r\n    if (RunModeService.getRunMode() === RunMode.compatible) {\r\n      this.initialize();\r\n    }\r\n    // this.validate();\r\n  }\r\n\r\n\r\n  // #region \r\n\r\n  /**\r\n   * \r\n   * @param value \r\n   */\r\n  public setChanges(value: Modification): void {\r\n    const propertyName = value.path[value.path.length - 1];\r\n\r\n    // @todochangeEntitynewData\r\n    // this.newData = Object.assign(this.newData, { [propertyName]: value.value });\r\n\r\n    this.valueChanged.next(value);\r\n    if (!(this.validErrors && Object.keys(this.validErrors).includes(propertyName) && this.changeSetPolicy === 'valid')) {\r\n      if (value && value.changeSetValue !== undefined) {\r\n        value = JSON.parse(JSON.stringify(value));\r\n        value.value = value.changeSetValue;\r\n      }\r\n      this.changeSet.append(value);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param propertyName \r\n   * @returns Observable<ValidationResult>\r\n   * ### \r\n   * ```\r\n   *  const entity = new UserEntity(data);\r\n   *  entity.validate().subscribe(result =>{\r\n   *      if(result.isValid){\r\n   *          ...\r\n   *      } else {\r\n   *          console.log(result.message);\r\n   *      }\r\n   *  })\r\n   *\r\n   * ```\r\n   */\r\n\r\n  // tslint:disable-next-line: max-line-length\r\n  public validate(propertyName?: string, value?, externalRules?: Map<string, ValidateRule[]>, index?: number, frameContext?: FrameContext): Observable<ValidationResult> {\r\n    return from(this.validator.validate(this, propertyName, value, externalRules, index, frameContext)).pipe(\r\n      tap(result => {\r\n        if (!result.isValid) {\r\n          this.validErrors = ValidationUtils.convertErrorsToNormalObject(result.errors, {});\r\n        } else {\r\n          this.validErrors = {};\r\n        }\r\n      })\r\n    );\r\n  }\r\n\r\n  public validateAll(validateContext?: Map<string, ValidateRule[]>) {\r\n\r\n  }\r\n\r\n  // entity_utilcb\r\n  public validateFromUtil(propertyName: string, value, cb, context?: any) {\r\n    this.validErrors = {};\r\n    from(this.validator.validate(this, propertyName, value, null, undefined, context && context.frameContext || null)).subscribe(result => {\r\n      if (!result.isValid) {\r\n        this.validErrors = ValidationUtils.convertErrorsToNormalObject(result.errors, {});\r\n      }\r\n      // \r\n      /*else {\r\n        // BindingObjectEntity\r\n        if (this[propertyName] === value) {\r\n          return;\r\n        }\r\n        this[propertyName] = value;\r\n      }*/\r\n      cb(result);\r\n    });\r\n  }\r\n  /**\r\n   * \r\n   * @param propertyName \r\n   * @param value \r\n   * @param cb \r\n   */\r\n  public validateFromUtilSync(propertyName: string, value: any, cb: any, context?: any) {\r\n    this.validErrors = {};\r\n    const result: any = this.validator.verify(this, propertyName, value, null, undefined, context && context.frameContext || null, true);\r\n    if (result && !result.isValid) {\r\n      this.validErrors = ValidationUtils.convertErrorsToNormalObject(result.errors, {});\r\n    }\r\n    cb(result);\r\n  }\r\n  public getPaths() {\r\n    const pathObj = {\r\n      path: [],\r\n      isUdt: false,\r\n      isGrid: false\r\n    };\r\n    const handleParent = item => {\r\n      const parentPaths = item[PARENT_PATH];\r\n      if (parentPaths) {\r\n        const prop = parentPaths[parentPaths.length - 1];\r\n        // ngObjectUDt\r\n        if (Object.keys(FieldMetadataUtil.getNgObjects(item[PARENT_CLASS].constructor)).indexOf(prop) > -1) {\r\n          pathObj.isUdt = true;\r\n        }\r\n        // ngListgrid\r\n        if (item instanceof EntityList === true) {\r\n          pathObj.isGrid = true;\r\n        } else {\r\n          pathObj.path.push(prop);\r\n        }\r\n\r\n      }\r\n      if (item[PARENT_CLASS]) {\r\n        handleParent(item[PARENT_CLASS]);\r\n      }\r\n    };\r\n    handleParent(this);\r\n    pathObj.path = pathObj.path.reverse();\r\n    return pathObj;\r\n  }\r\n  public getEntityListPath() {\r\n    let paths = [];\r\n    const handleParent = (item: Entity) => {\r\n      const parentPaths = item[PARENT_PATH];\r\n      if (parentPaths) {\r\n        if (item instanceof EntityList === true) {\r\n          const path = parentPaths.concat([]).reverse();\r\n          Array.prototype.push.apply(paths, path);\r\n        }\r\n      }\r\n      if (item[PARENT_CLASS]) {\r\n        handleParent(item[PARENT_CLASS]);\r\n      }\r\n    };\r\n    handleParent(this);\r\n    return paths.reverse();\r\n  }\r\n  public getMainEntityPrimaryValue() {\r\n    let item = this;\r\n    while (item[PARENT_CLASS]) {\r\n      item = item[PARENT_CLASS];\r\n    }\r\n    return item.primaryValue;\r\n  }\r\n  /**\r\n   * \r\n   * @param data \r\n   */\r\n  public load(data: any, options: any = {}) {\r\n    if (!data) {\r\n      data = {};\r\n    }\r\n    this.loadFields(data);\r\n    if (!options || (options && options.loadChild !== false)) {\r\n      this.loadLists(data);\r\n    }\r\n    this.loadObjects(data);\r\n    this.loadDynamicObjects(data);\r\n    this.newData = Object.assign({}, data);\r\n    this.originalData = Object.assign({}, data);\r\n  }\r\n  /**\r\n   * JSON\r\n   * @param buildChanges \r\n   * @param includeMultiLanguageField \r\n   */\r\n  public toJSON(buildChanges?: boolean) {\r\n    const result = {};\r\n\r\n    // \r\n    const ngFields = FieldMetadataUtil.getNgFields(this.constructor);\r\n    Object.keys(ngFields).forEach((propName: string) => {\r\n      const ngField = ngFields[propName];\r\n      const dataField = ngField.dataField || propName;\r\n      if (buildChanges === true && ngField.enableTimeZone === true) {\r\n        result[dataField] = this.data[propName];\r\n      } else {\r\n        result[dataField] = this[propName];\r\n      }\r\n    });\r\n\r\n    // \r\n    const ngObjects = FieldMetadataUtil.getNgObjects(this.constructor);\r\n    Object.keys(ngObjects).forEach((propName: string) => {\r\n      const ngObject = ngObjects[propName];\r\n      const dataField = ngObject.dataField || propName;\r\n      result[dataField] = this[propName] ? this[propName].toJSON(buildChanges) : {};\r\n    });\r\n\r\n    // \r\n    const ngDynamics = FieldMetadataUtil.getNgDynamic(this.constructor);\r\n    Object.keys(ngDynamics).forEach((propName: string) => {\r\n      const ngDynamic = ngDynamics[propName];\r\n      const dataField = ngDynamic.dataField || propName;\r\n      result[dataField] = this[propName] ? this[propName].toJSON(buildChanges) : {};\r\n    });\r\n\r\n    // \r\n    const ngLists = FieldMetadataUtil.getNgList(this.constructor);\r\n    Object.keys(ngLists).forEach((propName: string) => {\r\n      const ngList = ngLists[propName];\r\n      const dataField = ngList.dataField || propName;\r\n      result[dataField] = this[propName] ? this[propName].toJSON(buildChanges) : {};\r\n    });\r\n\r\n    return result;\r\n  }\r\n\r\n  // #endregion\r\n\r\n\r\n  //#region private\r\n\r\n  /**\r\n   * \r\n   */\r\n  private initialize() {\r\n    const constructor = this.constructor;\r\n\r\n    const ngFields = FieldMetadataUtil.getNgFields(constructor);\r\n    const ngObjects = FieldMetadataUtil.getNgObjects(constructor);\r\n    const ngLists = FieldMetadataUtil.getNgList(constructor);\r\n    const ngDynamic = FieldMetadataUtil.getNgDynamic(constructor);\r\n\r\n    this.initializeNormalField(ngFields);\r\n    this.initializeList(ngLists);\r\n    this.initializeObject(ngObjects);\r\n    this.initializeDynamic(ngDynamic);\r\n  }\r\n\r\n  /**\r\n   * path\r\n   * @param propertyName \r\n   */\r\n  protected createPath(propertyName: string): string[] {\r\n    const primaryFieldMetadata = this.primaryProperty;\r\n    if (primaryFieldMetadata) {\r\n      const primaryDataField = primaryFieldMetadata.dataField;\r\n      return [primaryDataField + ':' + this.primaryValue, propertyName];\r\n    } else {\r\n      return [':', propertyName];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param ngFields \r\n   */\r\n  private initializeNormalField(ngFields: { [key: string]: NgFieldProperty }): void {\r\n    Object.keys(ngFields).forEach(propName => {\r\n      const ngField = ngFields[propName] as NgFieldProperty;\r\n      const dataField = ngField.dataField || propName;\r\n\r\n      if (delete this[propName]) {\r\n        Object.defineProperty(this, propName, {\r\n          get: function () {\r\n            const value = this.getPropValue(propName, ngField);\r\n            return value;\r\n          },\r\n          set: function (newPropValue) {\r\n            // \r\n            const oldPropValue = this.getPropValue(propName, ngField);\r\n            if (this.isPropValueChanged(propName, ngField, newPropValue, oldPropValue) === false) {\r\n              return;\r\n            }\r\n            this.setPropValue(propName, ngField, newPropValue);\r\n            const changeSetValue = this.preparePropValue(propName, ngField, newPropValue);\r\n            this.emitValueChange(propName, ngField, newPropValue, oldPropValue, changeSetValue);\r\n          }\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param ngListMetadata \r\n   */\r\n  private initializeList(ngListMetadata: { [key: string]: NgListProperty }): void {\r\n    Object.keys(ngListMetadata).forEach(propertyName => {\r\n      const fieldMetadata = ngListMetadata[propertyName] as NgListProperty;\r\n      const path = this.createPath(propertyName);\r\n      const dataField = fieldMetadata.dataField || propertyName;\r\n      const val = this.data[dataField];\r\n\r\n      const entityList = new EntityList<typeof fieldMetadata.type>();\r\n      entityList[PARENT_CLASS] = this;\r\n      entityList[PARENT_PATH] = path;\r\n\r\n      if (val) {\r\n        const entities = val.map(v => EntityFactory<typeof fieldMetadata.type>(fieldMetadata.type, v));\r\n        entityList.loadEntities(entities);\r\n      }\r\n\r\n      entityList.onListChanged.subscribe(value => {\r\n        if (value) {\r\n          if (entityList[PARENT_PATH][0] !== value.path[0]) {\r\n            value.path = entityList[PARENT_PATH].concat(value.path);\r\n          }\r\n          this.setChanges(value);\r\n        }\r\n      });\r\n      this[propertyName] = entityList;\r\n    });\r\n  }\r\n  /**\r\n   * \r\n   * @param ngObjectMetadata \r\n   */\r\n  private initializeObject(ngObjectMetadata: { [key: string]: NgObjectProperty }) {\r\n    Object.keys(ngObjectMetadata).forEach(propertyName => {\r\n      const fieldMetadata = ngObjectMetadata[propertyName] as NgObjectProperty;\r\n      const path = this.createPath(propertyName);\r\n      const dataField = fieldMetadata.dataField || propertyName;\r\n\r\n      // val\r\n      const val = this.data[dataField] || {};\r\n\r\n      const createEntityFromJsonData = (value: any) => {\r\n        let instance;\r\n        if (value instanceof fieldMetadata.type) {\r\n          instance = value;\r\n        } else {\r\n          instance = EntityFactory(fieldMetadata.type, value);\r\n        }\r\n        instance[PARENT_CLASS] = this;\r\n        instance[PARENT_PATH] = path;\r\n\r\n        instance.onValueChanged.subscribe(changes => {\r\n          if (changes) {\r\n            changes.path = (this[PARENT_PATH] || []).concat(changes.path);\r\n            this.setChanges(changes);\r\n          }\r\n        });\r\n\r\n        return instance;\r\n      };\r\n\r\n      // \r\n      let childEntity = createEntityFromJsonData(val);\r\n      if (delete this[propertyName]) {\r\n        Object.defineProperty(this, propertyName, {\r\n          get: () => {\r\n            return childEntity;\r\n          },\r\n          set: function (value: any) {\r\n            const modifyInfo = {\r\n              path: childEntity[PARENT_PATH],\r\n              value: value.data,\r\n              preValue: this[propertyName].data,\r\n              type: ModifyType.ValueChange\r\n            };\r\n            childEntity = createEntityFromJsonData(value);\r\n            this.setChanges(modifyInfo);\r\n          }\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  private initializeDynamic(ngDynamicMetadata: { [key: string]: NgDynamicProperty }) {\r\n    Object.keys(ngDynamicMetadata).forEach(propertyName => {\r\n      const fieldMetadata = ngDynamicMetadata[propertyName] as NgDynamicProperty;\r\n      const path = this.createPath(propertyName);\r\n      const dataField = fieldMetadata.dataField || propertyName;\r\n\r\n      const originalData = this.data[dataField] || {};\r\n\r\n      const createEntityFromJsonData = (value: any) => {\r\n        let instance;\r\n        if (value instanceof fieldMetadata.type) {\r\n          instance = value;\r\n        } else {\r\n          instance = EntityFactory(fieldMetadata.type, value);\r\n        }\r\n        instance[PARENT_CLASS] = this;\r\n        instance[PARENT_PATH] = path;\r\n\r\n        instance.onValueChanged.subscribe(changes => {\r\n          if (changes) {\r\n            changes.path = (this[PARENT_PATH] || []).concat(changes.path);\r\n            this.setChanges(changes);\r\n          }\r\n        });\r\n\r\n        return instance;\r\n      };\r\n\r\n      let dynamicEntity = createEntityFromJsonData(originalData);\r\n      if (delete this[propertyName]) {\r\n        Object.defineProperty(this, propertyName, {\r\n          get: function () {\r\n            return dynamicEntity;\r\n          },\r\n          set: function (value) {\r\n            const modifyInfo = {\r\n              path: dynamicEntity[PARENT_PATH],\r\n              value: value.data,\r\n              preValue: this[propertyName].data,\r\n              type: ModifyType.ValueChange\r\n            };\r\n            dynamicEntity = createEntityFromJsonData(value);\r\n            this.setChanges(modifyInfo);\r\n          }\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  //#endregion\r\n\r\n\r\n  // #region privateprojected\r\n\r\n  /**\r\n   * \r\n   * @todo \r\n   */\r\n  protected loadFields(data: any) {\r\n    const ngFields = FieldMetadataUtil.getNgFields(this.constructor);\r\n    Object.keys(ngFields).forEach((propName: string) => {\r\n      const ngField = ngFields[propName];\r\n      const dataField = ngField.dataField || propName;\r\n      // if (ngField.primary === false) {\r\n      //   this[propName] = data[dataField];\r\n      // }\r\n      let propValue = data[dataField];\r\n      if (ngField.enableTimeZone === true) {\r\n        const timeZoneOffset = UserSettingsService.getTimeZoneOffset();\r\n        if (timeZoneOffset !== null && propValue) {\r\n          propValue = ZonedTime.zonedTimeToSpecialTimeZoneOffsetTimeString(propValue, timeZoneOffset);\r\n        }\r\n      }\r\n      this[propName] = propValue;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param data \r\n   */\r\n  protected loadLists(data: any) {\r\n    const ngLists = FieldMetadataUtil.getNgList(this.constructor);\r\n    Object.keys(ngLists).forEach((propName: string) => {\r\n      const ngList = ngLists[propName];\r\n      const dataField = ngList.dataField || propName;\r\n      const entityType = ngList.type;\r\n\r\n      // \r\n      const listData = data[dataField];\r\n      if (listData) {\r\n        const entities = listData.map((entityData: any) => {\r\n          return EntityFactory<typeof entityType>(entityType, entityData);\r\n        });\r\n        this[propName].loadEntities(entities);\r\n      } else {\r\n        this[propName].loadEntities([]);\r\n      }\r\n    });\r\n  }\r\n\r\n  private loadObjects(data: any) {\r\n    const ngObjects = FieldMetadataUtil.getNgObjects(this.constructor);\r\n    Object.keys(ngObjects).forEach((propName: string) => {\r\n      const ngObject = ngObjects[propName];\r\n      const dataField = ngObject.dataField || propName;\r\n      const objectData = data[dataField];\r\n      const entity = this[propName] as Entity;\r\n      if (!entity || !objectData) {\r\n        return;\r\n      }\r\n      entity.load(objectData);\r\n    });\r\n  }\r\n\r\n  protected loadDynamicObjects(data: any) {\r\n    const ngDynamicObjects = FieldMetadataUtil.getNgDynamic(this.constructor);\r\n    Object.keys(ngDynamicObjects).forEach((propName: string) => {\r\n      const ngDynamicObject = ngDynamicObjects[propName];\r\n      const dataField = ngDynamicObject.dataField || propName;\r\n\r\n      const dynamicData = data[dataField] || {};\r\n      const dynamicEntity = this[propName] as Dynamic;\r\n      if (!dynamicEntity) {\r\n        return;\r\n      }\r\n      dynamicEntity.loadDynamicData(dynamicData);\r\n    });\r\n  }\r\n\r\n  // #endregion\r\n\r\n  // #region \r\n\r\n\r\n  /**\r\n   * \r\n   */\r\n  private emitValueChange(propName: string, propMetadata: NgFieldProperty, newPropValue: any, oldPropValue: any, changeSetValue: any = undefined): void {\r\n    const change = {\r\n      path: this.createPath(propName),\r\n      value: newPropValue,\r\n      changeSetValue,\r\n      preValue: oldPropValue,\r\n      type: ModifyType.ValueChange\r\n    };\r\n\r\n    if (this[PARENT_PATH]) {\r\n      change.path = this[PARENT_PATH].concat(change.path);\r\n    }\r\n    this.setChanges(change);\r\n  }\r\n  /**\r\n   * \r\n   * @param propName \r\n   * @param propMetadata \r\n   * @param propValue \r\n   */\r\n  private preparePropValue(propName: string, propMetadata: NgFieldProperty, propValue: any) {\r\n    let value = undefined;\r\n    // \r\n    if (propMetadata.enableTimeZone === true) {\r\n      const timeZoneOffset = UserSettingsService.getTimeZoneOffset();\r\n      if (timeZoneOffset !== null && propValue) {\r\n        value = ZonedTime.timeZoneOffsetTimeToUtcTimeString(propValue, timeZoneOffset);\r\n      }\r\n    }\r\n    return value;\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  private getPropValue(propName: string, propMetadata: NgFieldProperty) {\r\n    const dataField = propMetadata.dataField || propName;\r\n    let value = this.data[dataField];\r\n\r\n    // query\r\n    if (propMetadata.enableMultiLangInput === true && !value) {\r\n      const langCode = window.localStorage.getItem('languageCode') || 'zh-CHS';\r\n      const originDataField = dataField.replace('_MULTILANGUAGE', '');\r\n      return {\r\n        [langCode]: this.data[originDataField]\r\n      };\r\n    }\r\n    // \r\n    if (propMetadata.enableTimeZone === true) {\r\n      const timeZoneOffset = UserSettingsService.getTimeZoneOffset();\r\n      if (timeZoneOffset !== null && value) {\r\n        return ZonedTime.zonedTimeToSpecialTimeZoneOffsetTimeString(value, timeZoneOffset);\r\n      }\r\n    }\r\n    if (propMetadata.originalDataFieldType === BigNumberType) {\r\n      value = value && value.toString() || null;\r\n    }\r\n    return value;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private setPropValue(propName: string, propMetadata: NgFieldProperty, propValue: any) {\r\n    const dataField = propMetadata.dataField || propName;\r\n    if (propMetadata.originalDataFieldType === BigNumberType) {\r\n      this.data[dataField] = propValue === null ? null : propValue && propValue.toString() || '';\r\n    } else {\r\n      if (propMetadata.enableTimeZone === true) {\r\n        const timeZoneOffset = UserSettingsService.getTimeZoneOffset();\r\n        if (timeZoneOffset !== null && propValue) {\r\n          propValue = ZonedTime.timeZoneOffsetTimeToUtcTimeString(propValue, timeZoneOffset);\r\n        }\r\n      }\r\n      this.data[dataField] = propValue;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private isPropValueChanged(propName: string, propMetadata: NgFieldProperty, newPropValue: any, oldPropValue: any) {\r\n    if (propMetadata.enableMultiLangInput === true) {\r\n      if (this.isEmptyMultiLangPropValue(newPropValue) === true && this.isEmptyMultiLangPropValue(oldPropValue) === true) {\r\n        return false;\r\n      }\r\n      return JSON.stringify(newPropValue) !== JSON.stringify(oldPropValue);\r\n    } else if (propMetadata.originalDataFieldType === BigNumberType) {\r\n      if (typeof newPropValue !== 'string' && newPropValue !== null && newPropValue !== undefined) {\r\n        newPropValue = newPropValue.toString();\r\n      }\r\n      return newPropValue !== oldPropValue;\r\n    } else {\r\n      return newPropValue !== oldPropValue;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private isEmptyMultiLangPropValue(value: any) {\r\n    if (!value) {\r\n      return true;\r\n    }\r\n\r\n    const keys = Object.keys(value);\r\n    if (keys.length === 0) {\r\n      return true;\r\n    }\r\n\r\n    // \r\n    const vals = Object.values(value);\r\n    const allEmptyVal = vals.every((val) => {\r\n      return !val;\r\n    });\r\n    if (allEmptyVal === true) {\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n  // #endregion\r\n}\r\n","import { ModifyType, Modification } from '../changeset/types';\r\nimport { PARENT_PATH, Dynamic, PARENT_CLASS } from './types';\r\nimport { Entity } from './entity';\r\nimport { takeUntil } from 'rxjs/operators';\r\n\r\n/**\r\n * \r\n */\r\nexport class DynamicEntity extends Entity implements Dynamic {\r\n\r\n  /**\r\n   * \r\n   */\r\n  public get IsNested(): boolean {\r\n    return this[PARENT_CLASS] instanceof DynamicEntity;\r\n  }\r\n\r\n  /**\r\n   * @param data JSON\r\n   */\r\n  constructor(data: any) {\r\n    super(data);\r\n    this.loadDynamicData(data);\r\n  }\r\n\r\n  public loadDynamicData(dynamicData: any) {\r\n    this.initializeDynamicField(dynamicData);\r\n    // super.loadFields(dynamicData);\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param dynamicData \r\n   */\r\n  private initializeDynamicField(dynamicData: any): void {\r\n    // key\r\n    Object.keys(dynamicData).forEach(propertyName => {\r\n      const dataField = propertyName;\r\n      if (delete this[propertyName]) {\r\n        if (dynamicData[propertyName] instanceof Object) {\r\n          const path = this.createPath(propertyName);\r\n          let dynamicEntity = this.createDynamicEntityFromJsonData(dynamicData[propertyName], path);\r\n          // this.constructor['__prop__metadata__'] = this.constructor['__prop__metadata__'] || {};\r\n          // NgObject({\r\n          //     /**  */\r\n          //     dataField: propertyName,\r\n          //     /**  */\r\n          //     originalDataField: propertyName,\r\n          //     /**  */\r\n          //     type: DynamicEntity\r\n          // })(this, propertyName);\r\n          Object.defineProperty(this, propertyName, {\r\n            get: function () {\r\n              return dynamicEntity;\r\n            },\r\n            set: function (value) {\r\n              const modifyInfo = {\r\n                path: dynamicEntity[PARENT_PATH],\r\n                value: value.data,\r\n                preValue: this[propertyName].data,\r\n                type: ModifyType.ValueChange\r\n              };\r\n              dynamicEntity = this.createDynamicEntityFromJsonData(value, path);\r\n              this.setChanges(modifyInfo);\r\n            }\r\n          });\r\n        } else {\r\n          // this.constructor['__prop__metadata__'] = this.constructor['__prop__metadata__'] || {};\r\n          // NgField({\r\n          //     /**  */\r\n          //     dataField: propertyName,\r\n          //     /**  */\r\n          //     originalDataField: propertyName,\r\n          //     /**  */\r\n          //     primary: false,\r\n          //     /**  */\r\n          //     foreign: false\r\n          // })(this, propertyName);\r\n          Object.defineProperty(this, propertyName, {\r\n            // \r\n            get: function () {\r\n              // \r\n              return this.data[dataField];\r\n            },\r\n            set: function (value) {\r\n              // \r\n              const oldValue = this.data[dataField];\r\n              if (oldValue === value) {\r\n                return;\r\n              }\r\n              // \r\n              this.data[dataField] = value;\r\n              // \r\n              const changes = {\r\n                type: ModifyType.ValueChange,\r\n                path: this.createPath(propertyName),\r\n                value: value,\r\n                preValue: oldValue\r\n              };\r\n\r\n              if (this[PARENT_PATH]) {\r\n                changes.path = this[PARENT_PATH].concat(changes.path);\r\n              }\r\n              this.setChanges(changes);\r\n            }\r\n          });\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  private createDynamicEntityFromJsonData(value: any, parentPath: string[]) {\r\n    let instance: DynamicEntity;\r\n    if (value instanceof DynamicEntity) {\r\n      instance = value;\r\n    } else {\r\n      instance = new DynamicEntity(value);\r\n      instance.constructor = DynamicEntity;\r\n    }\r\n    instance[PARENT_CLASS] = this;\r\n    instance[PARENT_PATH] = parentPath;\r\n    instance.onValueChanged.pipe(takeUntil(this.unsubscribe)).subscribe(changes => {\r\n      if (changes) {\r\n        changes.path = (this[PARENT_PATH] || []).concat(changes.path);\r\n        this.setChanges(changes);\r\n      }\r\n    });\r\n\r\n    return instance;\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param value \r\n   * @todo\r\n   * 1preValueDyanmicaEntitydataprevaluevalue\r\n   * 2valuevaluedatasetChagnes\r\n   */\r\n  setChanges(value: Modification): void {\r\n    const propertyName = value.path[value.path.length - 1];\r\n    const preValue = Object.assign({}, this.data);\r\n    this.newData = Object.assign(this.newData, { [propertyName]: value.value });\r\n    let parentPath = value.path;\r\n    if (value.path.length > 2) {\r\n      parentPath = value.path.slice(0, value.path.length - 2);\r\n    }\r\n\r\n    // Modification\r\n    // const parentModification = new Modification(this.data, value.type, parentPath, preValue);\r\n    const parentModification: Modification = {\r\n      path: parentPath,\r\n      value: this.data,\r\n      preValue: preValue,\r\n      type: value.type,\r\n      dynamic: true\r\n    };\r\n\r\n    this.valueChanged.next(parentModification);\r\n    this.changeSet.append(value);\r\n  }\r\n\r\n  /**\r\n   * toJSON\r\n   */\r\n  public toJSON() {\r\n    return this.data;\r\n  }\r\n}\r\n","import { EnumData, FormVariable } from './dom-entity';\r\n\r\nexport interface SchemaType {\r\n    name: string;\r\n    code: string;\r\n    label: string;\r\n    fields?: SchemaEntityField[];\r\n    entities?: SchemaEntity[];\r\n    primary?: string;\r\n}\r\n\r\n/**\r\n * schema\r\n */\r\nexport class Schema {\r\n    public dataSource?: string;\r\n    public sourceUri: string;\r\n    public id: string;\r\n    public code: string;\r\n    public name: string;\r\n    public entities: SchemaEntity[];\r\n    public variables: SchemaEntityField[];\r\n    public eapiId: string;\r\n    public extendProperties: { enableStdTimeFormat: boolean };\r\n}\r\n\r\n/**\r\n * \r\n */\r\nexport class SchemaEntity {\r\n    public id: string;\r\n    public code: string;\r\n    public name: string;\r\n    public label: string;\r\n    public type: SchemaEntityType;\r\n}\r\n\r\n/**\r\n * \r\n */\r\nexport class SchemaEntityType implements SchemaType {\r\n    public code: string;\r\n    public label: string;\r\n    public name: string;\r\n    public primary: string;\r\n    public fields: SchemaEntityField[];\r\n    public entities?: SchemaEntity[];\r\n    public displayName?: string;\r\n}\r\n\r\n/**\r\n * \r\n */\r\nexport class SchemaEntityField {\r\n    public $type: SchemaEntityField$Type;\r\n    public id: string;\r\n    public originalId: string;\r\n    public code: string;\r\n    public label: string;\r\n    public bindingField: string;\r\n    public name: string;\r\n    public defaultValue: any;\r\n    public require: boolean;\r\n    public readonly: boolean;\r\n    public type: SchemaEntityFieldType;\r\n    public editor?: SchemaEntityFieldEditor;\r\n    public path?: string;\r\n    public bindingPath?: string;\r\n    public multiLanguage?: boolean;\r\n    public converter?: any;\r\n    // \r\n    public expression?: any;\r\n}\r\n\r\n/**\r\n * \r\n */\r\nexport class SchemaEntityFieldType implements SchemaType {\r\n    code: string;\r\n    label: string;\r\n    public $type: SchemaEntityFieldType$Type;\r\n    public name: SchemaEntityFieldTypeName | any;\r\n    public length?: number;\r\n    public precision?: number;\r\n    public valueType?: SchemaEntityFieldType;\r\n    public enumValues?: EnumData[];\r\n    public fields?: SchemaEntityField[];\r\n    public displayName?: string;\r\n    public primary?: string;\r\n    public entities?: SchemaEntity[];\r\n    // //\r\n    public elementType?: any;\r\n\r\n\r\n    // :  \r\n    public extendProperty?: any;\r\n}\r\n\r\n/**\r\n * \r\n */\r\nexport class SchemaEntityFieldEditor {\r\n    public $type: any;\r\n    [propName: string]: any;\r\n}\r\n\r\n\r\n/**\r\n * \r\n */\r\nexport enum SchemaEntityField$Type {\r\n    /**\r\n     * \r\n     */\r\n    SimpleField = 'SimpleField',\r\n    /**\r\n     * /UDT\r\n     */\r\n    ComplexField = 'ComplexField'\r\n}\r\n\r\n/**\r\n * \r\n */\r\nexport enum SchemaEntityFieldType$Type {\r\n\r\n    /**\r\n     * \r\n     */\r\n    StringType = 'StringType',\r\n    /**\r\n     * \r\n     */\r\n    TextType = 'TextType',\r\n    /**\r\n     * \r\n     */\r\n    NumericType = 'NumericType',\r\n    /**\r\n     * \r\n     */\r\n    BooleanType = 'BooleanType',\r\n    /**\r\n     * \r\n     */\r\n    DateType = 'DateType',\r\n\r\n    /**\r\n     * \r\n     */\r\n    DateTimeType = 'DateTimeType',\r\n\r\n    /**\r\n     * \r\n     */\r\n    EnumType = 'EnumType',\r\n    /**\r\n     * \r\n     */\r\n    EntityType = 'EntityType',\r\n\r\n    /**\r\n     * \r\n     */\r\n    HierarchyType = 'HierarchyType',\r\n\r\n    /**\r\n     * \r\n     */\r\n    ObjectType = 'ObjectType',\r\n\r\n    /**\r\n     * \r\n     */\r\n    BigNumericType = 'BigNumericType'\r\n}\r\n\r\n\r\n/**\r\n * \r\n */\r\nexport enum SchemaEntityFieldTypeName {\r\n    /**\r\n     * \r\n     */\r\n    String = 'String',\r\n    /**\r\n     * \r\n     */\r\n    DateTime = 'DateTime',\r\n    /**\r\n     * \r\n     */\r\n    Date = 'Date',\r\n    /**\r\n     * \r\n     */\r\n    Enum = 'Enum',\r\n    /**\r\n     * \r\n     */\r\n    Boolean = 'Boolean',\r\n\r\n    /**\r\n     * \r\n     */\r\n    Number = 'Number',\r\n\r\n    /**\r\n     * \r\n     */\r\n    Text = 'Text',\r\n\r\n    /**\r\n     * \r\n     */\r\n    BigNumber = 'BigNumber'\r\n}\r\n","import { InjectionToken } from '@angular/core';\r\n\r\n/**\r\n * \r\n */\r\ninterface EntityDataService {\r\n\r\n  /**\r\n   * \r\n   * @param path \r\n   */\r\n  addChild(childPath: string);\r\n\r\n  /**\r\n   * \r\n   * @param path \r\n   * @param id id\r\n   */\r\n  removeChild(childPath: string, id: string);\r\n\r\n}\r\n\r\nconst ENTITY_DATA_SERVICE_TOKEN = new InjectionToken<EntityDataService>('@farris/devkit ENTITY_DATA_SERVICE');\r\n\r\nexport { EntityDataService, ENTITY_DATA_SERVICE_TOKEN };\r\n","import { from, Observable } from 'rxjs';\r\nimport { tap } from 'rxjs/operators';\r\nimport { Modification, ModifyType } from '../changeset';\r\nimport { UserSettingsService } from '../i18n/user_settings_service';\r\nimport { ZonedTime } from '../i18n/zoned_time';\r\nimport { SchemaEntity, SchemaEntityField } from '../schema/schema';\r\nimport { Entity } from './entity';\r\nimport { EntityList } from './entity_list';\r\nimport { FieldMetadataUtil } from './metadata/field_metadata_util';\r\nimport { PARENT_CLASS, PARENT_PATH } from './types';\r\nimport { ValidateRule, ValidationResult } from './validator/types';\r\nimport { ValidationUtils } from './validator/validation_utils';\r\n\r\nexport const entityPrototype = {\r\n  /**\r\n   * \r\n   */\r\n  getFieldValue: function(schemaField: SchemaEntityField) {\r\n    const fieldName = schemaField.label;\r\n    const value = this.data[fieldName];\r\n    // query\r\n    if (schemaField.multiLanguage === true && !value) {\r\n      const langCode = window.localStorage.getItem('languageCode') || 'zh-CHS';\r\n      const originDataField = fieldName.replace('_MULTILANGUAGE', '');\r\n      return {\r\n        [langCode]: this.data[originDataField]\r\n      };\r\n    }\r\n    return value;\r\n  },\r\n  /**\r\n   * \r\n   */\r\n  setFieldValue: function(schemaField: SchemaEntityField, propertyValue: any) {\r\n    const fieldName = schemaField.label;\r\n    this.data[fieldName] = propertyValue;\r\n  },\r\n  /**\r\n   * \r\n   * @param schemaField Schema\r\n   * @returns \r\n   */\r\n  getComplexFieldValue: function(schemaField: SchemaEntityField) {\r\n    const fieldName = schemaField.label;\r\n    const objectPropertyValue = this.innerEntities[fieldName];\r\n    return objectPropertyValue;\r\n  },\r\n  /**\r\n   * \r\n   * @param schemaField Schema\r\n   * @param ComplexField \r\n   * @param propertyValue \r\n   */\r\n  setComplexFieldValue: function(schemaField: SchemaEntityField, ComplexField: any, propertyValue: any) {\r\n    // \r\n    const fieldName = schemaField.label;\r\n    let complexFieldInstance = null;\r\n    if (propertyValue instanceof ComplexField) {\r\n      complexFieldInstance = propertyValue;\r\n    } else {\r\n      complexFieldInstance = new ComplexField(propertyValue);\r\n      complexFieldInstance.constructor = ComplexField;\r\n    }\r\n    // \r\n    const objectPropertyValue = this.innerEntities[fieldName];\r\n    const propertyPath = (objectPropertyValue && objectPropertyValue[PARENT_PATH]) || complexFieldInstance[PARENT_PATH];\r\n    // \r\n    const changeInfo = {\r\n      // \r\n      path: propertyPath,\r\n      // \r\n      value: propertyValue,\r\n      // \r\n      preValue: (this[fieldName] && this[fieldName].data) || null,\r\n      // \r\n      type: ModifyType.ValueChange\r\n    };\r\n    // \r\n    this.innerEntities[fieldName] = complexFieldInstance;\r\n    // this.innerEntities[fieldName] = new ComplexField(propertyValue);\r\n    // \r\n    if (!this.isInitializing) {\r\n      this.setChanges(changeInfo);\r\n    }\r\n  },\r\n  /**\r\n   * \r\n   * @param schemaEntity \r\n   * @returns \r\n   */\r\n  getEntities: function(schemaEntity: SchemaEntity) {\r\n    const dataField = schemaEntity.label;\r\n    const listPropertyValue = this.innerEntities[dataField];\r\n    return listPropertyValue;\r\n  },\r\n  /**\r\n   * \r\n   * @param schemaEntity \r\n   * @param propertyValue \r\n   */\r\n  setEntities: function(schemaEntity: SchemaEntity, propertyValue: any) {\r\n    const dataField = schemaEntity.label;\r\n    this.innerEntities[dataField] = propertyValue;\r\n  },\r\n  /**\r\n   * \r\n   */\r\n  isFieldValueChanged: function(schemaField: SchemaEntityField, newPropValue: any, oldPropValue: any) {\r\n    if (schemaField.multiLanguage === true) {\r\n      if (this.isEmptyMultiLangPropValue(newPropValue) === true && this.isEmptyMultiLangPropValue(oldPropValue) === true) {\r\n        return false;\r\n      }\r\n      return JSON.stringify(newPropValue) !== JSON.stringify(oldPropValue);\r\n    } else {\r\n      return newPropValue !== oldPropValue;\r\n    }\r\n  },\r\n  /**\r\n   * \r\n   */\r\n  isEmptyMultiLangPropValue(value: any) {\r\n    if (!value) {\r\n      return true;\r\n    }\r\n\r\n    const keys = Object.keys(value);\r\n    if (keys.length === 0) {\r\n      return true;\r\n    }\r\n\r\n    // \r\n    const vals = Object.values(value);\r\n    const allEmptyVal = vals.every((val) => {\r\n      return !val;\r\n    });\r\n    if (allEmptyVal === true) {\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  },\r\n  /**\r\n   * \r\n   */\r\n  emitFieldValueChange: function(schemaField: SchemaEntityField, newPropValue: any, oldPropValue: any): void {\r\n    if (!this.isInitializing) {\r\n      const fieldName = schemaField.label;\r\n      const changeInfo = {\r\n        path: this.createPath(fieldName),\r\n        value: newPropValue,\r\n        preValue: oldPropValue,\r\n        type: ModifyType.ValueChange\r\n      };\r\n\r\n      if (this[PARENT_PATH]) {\r\n        changeInfo.path = this[PARENT_PATH].concat(changeInfo.path);\r\n      }\r\n      this.setChanges(changeInfo);\r\n    }\r\n  },\r\n  /**\r\n   * \r\n   * @param value \r\n   */\r\n  setChanges: function(value: Modification): void {\r\n    const propertyName = value.path[value.path.length - 1];\r\n\r\n    // @todochangeEntitynewData\r\n    // this.newData = Object.assign(this.newData, { [propertyName]: value.value });\r\n\r\n    this.valueChanged.next(value);\r\n    if (!(this.validErrors && Object.keys(this.validErrors).includes(propertyName))) {\r\n      this.changeSet.append(value);\r\n    }\r\n  },\r\n  /**\r\n   * path\r\n   * @param propertyName \r\n   */\r\n  createPath: function(propertyName: string): string[] {\r\n    if (this.primaryKey) {\r\n      return [this.primaryKey + ':' + this.primaryValue, propertyName];\r\n    } else {\r\n      return [':', propertyName];\r\n    }\r\n  },\r\n  getPaths() {\r\n    const pathObj = {\r\n      path: [],\r\n      isUdt: false,\r\n      isGrid: false\r\n    };\r\n    const handleParent = item => {\r\n      const parentPaths = item[PARENT_PATH];\r\n      if (parentPaths) {\r\n        const prop = parentPaths[parentPaths.length - 1];\r\n        // ngObjectUDt\r\n        if (Object.keys(FieldMetadataUtil.getNgObjects(item[PARENT_CLASS].constructor)).indexOf(prop) > -1) {\r\n          pathObj.isUdt = true;\r\n        }\r\n        // ngListgrid\r\n        if (item instanceof EntityList === true) {\r\n          pathObj.isGrid = true;\r\n        } else {\r\n          pathObj.path.push(prop);\r\n        }\r\n\r\n      }\r\n      if (item[PARENT_CLASS]) {\r\n        handleParent(item[PARENT_CLASS]);\r\n      }\r\n    };\r\n    handleParent(this);\r\n    pathObj.path = pathObj.path.reverse();\r\n    return pathObj;\r\n  },\r\n  validate(propertyName?: string, value?, externalRules?: Map<string, ValidateRule[]>, index?: number): Observable<ValidationResult> {\r\n    return from(this.validator.validate(this, propertyName, value, externalRules, index)).pipe(\r\n      tap((result: any) => {\r\n        if (!result.isValid) {\r\n          this.validErrors = ValidationUtils.convertErrorsToNormalObject(result.errors, {});\r\n        } else {\r\n          this.validErrors = {};\r\n        }\r\n      })\r\n    );\r\n  },\r\n  validateAll(validateContext?: Map<string, ValidateRule[]>) {\r\n\r\n  },\r\n  /**\r\n   * entity_utilcb\r\n   */\r\n  validateFromUtil(propertyName: string, value: any, cb: any) {\r\n    this.validErrors = {};\r\n    from(this.validator.validate(this, propertyName, value)).subscribe((result: any) => {\r\n      if (!result.isValid) {\r\n        this.validErrors = ValidationUtils.convertErrorsToNormalObject(result.errors, {});\r\n      }\r\n      // \r\n      /*else {\r\n        // BindingObjectEntity\r\n        if (this[propertyName] === value) {\r\n          return;\r\n        }\r\n        this[propertyName] = value;\r\n      }*/\r\n      cb(result);\r\n    });\r\n  },\r\n  /**\r\n   * JSON\r\n   */\r\n  toJSON(buildChanges?: boolean) {\r\n    // \r\n    const result = {};\r\n    // \r\n    const ngFields = FieldMetadataUtil.getNgFields(this.constructor);\r\n    Object.keys(ngFields).forEach((propName: string) => {\r\n      const ngField = ngFields[propName];\r\n      const dataField = ngField.dataField || propName;\r\n      if (buildChanges === true && ngField.enableTimeZone === true) {\r\n        result[dataField] = this.data[propName];\r\n      } else {\r\n        result[dataField] = this[propName];\r\n      }\r\n    });\r\n    // \r\n    const ngObjects = FieldMetadataUtil.getNgObjects(this.constructor);\r\n    Object.keys(ngObjects).forEach((propName: string) => {\r\n      const ngObject = ngObjects[propName];\r\n      const dataField = ngObject.dataField || propName;\r\n      result[dataField] = this[propName] ? this[propName].toJSON(buildChanges) : {};\r\n    });\r\n    // \r\n    const ngDynamics = FieldMetadataUtil.getNgDynamic(this.constructor);\r\n    Object.keys(ngDynamics).forEach((propName: string) => {\r\n      const ngDynamic = ngDynamics[propName];\r\n      const dataField = ngDynamic.dataField || propName;\r\n      result[dataField] = this[propName] ? this[propName].toJSON(buildChanges) : {};\r\n    });\r\n    // \r\n    const ngLists = FieldMetadataUtil.getNgList(this.constructor);\r\n    Object.keys(ngLists).forEach((propName: string) => {\r\n      const ngList = ngLists[propName];\r\n      const dataField = ngList.dataField || propName;\r\n      result[dataField] = this[propName] ? this[propName].toJSON(buildChanges) : {};\r\n    });\r\n\r\n    return result;\r\n  }\r\n};\r\n","import { Subject } from 'rxjs';\r\nimport { ChangeSet, Modification } from '../changeset';\r\nimport { Schema, SchemaEntity, SchemaEntityField, SchemaEntityField$Type, SchemaType } from '../schema/schema';\r\nimport { Entity } from './entity';\r\nimport { EntityList } from './entity_list';\r\nimport { entityPrototype } from './entity_prototype';\r\nimport { NG_ENTITY, NG_FIELD, NG_LIST, NG_OBJECT } from './metadata';\r\nimport { PARENT_CLASS, PARENT_PATH } from './types';\r\nimport { Validator } from './validator';\r\nimport { ValidationUtils } from './validator/validation_utils';\r\n\r\nexport interface AbstractEntityType {\r\n  typeName: string;\r\n  types: any;\r\n  __prop__metadata__: any;\r\n}\r\n\r\n/**\r\n * \r\n * Schema\r\n */\r\nexport class EntityTypeFactory {\r\n\r\n  constructor() { }\r\n  /**\r\n   * Schema\r\n   * @param schema Schema\r\n   * @returns \r\n   */\r\n  public create(schema: Schema) {\r\n    // Schema\r\n    const schemaType = schema.entities[0].type;\r\n    // \r\n    const entityType = this.createClass(schemaType, schema.entities[0]);\r\n    return entityType;\r\n  }\r\n  /**\r\n   * Schema\r\n   * @param schemaType Schema\r\n   * @returns \r\n   */\r\n  private createClass(schemaType: SchemaType, relateSchema: any) {\r\n    const attachEntityInstanceData = this.createEntityInstanceDataInitializer(schemaType);\r\n    // \r\n    const initialize = (entityInstance: any, entityData: any, entityTypeConstructor: any) => {\r\n      entityInstance.isInitializing = true;\r\n      attachEntityInstanceData(entityInstance, entityData, entityTypeConstructor);\r\n      entityInstance.isInitializing = false;\r\n    };\r\n    // \r\n    const ConcreteEntity = function (data: any) {\r\n      // \r\n      this.changeSet = new ChangeSet();\r\n      // \r\n      this.isValidating = false;\r\n      // unsubscribe \r\n      this.unsubscribe = new Subject();\r\n      // \r\n      this.validErrors = {};\r\n      // \r\n      this.validator = new Validator();\r\n      // \r\n      this.innerData = Object.assign({}, data);\r\n      // \r\n      this.innerEntities = {};\r\n      // \r\n      this.valueChanged = new Subject<Modification>();\r\n      this.onValueChanged = this.valueChanged;\r\n      this.validateFromUtilSync = function (propertyName, value, cb, context) {\r\n        this.validErrors = {};\r\n        const result = this.validator.verify(this, propertyName, value, null, undefined, context && context.frameContext || null, true);\r\n        if (result && !result.isValid) {\r\n          this.validErrors = ValidationUtils.convertErrorsToNormalObject(result.errors, {});\r\n        }\r\n        cb(result);\r\n      };\r\n      // \r\n      initialize(this, data, ConcreteEntity);\r\n      this.load = (newData: any) => {\r\n        attachEntityInstanceData(this, newData, ConcreteEntity);\r\n      };\r\n    };\r\n\r\n\r\n    // \r\n    ConcreteEntity.typeName = `${schemaType.name}Entity`;\r\n    ConcreteEntity.code = relateSchema.code;\r\n    ConcreteEntity.label = relateSchema.label;\r\n    // \r\n    ConcreteEntity.types = {};\r\n    ConcreteEntity.__prop__metadata__ = {\r\n\r\n    };\r\n\r\n    // \r\n    const entityTypePrototype = Object.assign({ typeName: 'ConcreteEntityPrototype' }, entityPrototype);\r\n    // \r\n    this.definePresetProperty(entityTypePrototype, schemaType);\r\n    // get/set\r\n    this.defineFieldsToPrototype(entityTypePrototype, schemaType.fields, schemaType.primary, ConcreteEntity);\r\n    // get/set\r\n    this.defineEntitiesToPrototype(entityTypePrototype, schemaType.entities, ConcreteEntity);\r\n    // \r\n    ConcreteEntity.prototype = entityTypePrototype;\r\n\r\n\r\n    return ConcreteEntity;\r\n  }\r\n  /**\r\n   * \r\n   * @param prototypeObject \r\n   * @param schemaType Schema\r\n   */\r\n  private definePresetProperty(prototypeObject: any, schemaType: SchemaType) {\r\n    /**\r\n     * \r\n     */\r\n    Object.defineProperty(prototypeObject, 'data', {\r\n      get: function () {\r\n        if (!this.innerData) {\r\n          this.innerData = {};\r\n        }\r\n        return this.innerData;\r\n      },\r\n      set: function (value) {\r\n        this.innerData = value;\r\n      }\r\n    });\r\n    /**\r\n     * \r\n     */\r\n    Object.defineProperty(prototypeObject, 'errors', {\r\n      get: function () {\r\n        return this.validErrors;\r\n      },\r\n      set: function (errors: any) {\r\n        this.validErrors = errors;\r\n      }\r\n    });\r\n    /**\r\n     * \r\n     */\r\n    Object.defineProperty(prototypeObject, 'changes', {\r\n      get: function () {\r\n        return this.changeSet.changes;\r\n      }\r\n    });\r\n    /**\r\n     * \r\n     */\r\n    Object.defineProperty(prototypeObject, 'primaryProperty', {\r\n      // tslint:disable-next-line: only-arrow-functions\r\n      get: function () {\r\n        // return schemaType.primary;\r\n        return prototypeObject.innerPrimaryProperty || { dataField: schemaType.primary };\r\n      }\r\n    });\r\n    /**\r\n     * \r\n     */\r\n    Object.defineProperty(prototypeObject, 'primaryKey', {\r\n      // tslint:disable-next-line: only-arrow-functions\r\n      get: function () {\r\n        return schemaType.primary || '';\r\n      }\r\n    });\r\n    /**\r\n     * \r\n     */\r\n    Object.defineProperty(prototypeObject, 'primaryValue', {\r\n      get: function () {\r\n        if (this.primaryKey) {\r\n          // return this[this.primaryProperty.property].toString();\r\n          const primaryValue = this[this.primaryKey];\r\n          return primaryValue ? primaryValue : '';\r\n        } else {\r\n          return '';\r\n        }\r\n      }\r\n    });\r\n  }\r\n  /**\r\n   * \r\n   * @param prototypeObject \r\n   * @param fields \r\n   * @param parentEntityType \r\n   */\r\n  private defineFieldsToPrototype(\r\n    prototypeObject: any,\r\n    fields: SchemaEntityField[],\r\n    primary: string,\r\n    parentEntityType: AbstractEntityType\r\n  ): void {\r\n    if (fields && fields.length) {\r\n      // Schema\r\n      fields.forEach(schemaEntityField => {\r\n        switch (schemaEntityField.$type) {\r\n          // \r\n          case SchemaEntityField$Type.SimpleField:\r\n            this.defineSimpleFieldToPrototype(prototypeObject, schemaEntityField, primary, parentEntityType);\r\n            break;\r\n          // \r\n          case SchemaEntityField$Type.ComplexField:\r\n            this.defineComplexFieldToPrototype(prototypeObject, schemaEntityField, parentEntityType);\r\n            break;\r\n        }\r\n      });\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   * @param prototypeObject \r\n   * @param schemaField \r\n   */\r\n  private defineSimpleFieldToPrototype(\r\n    prototypeObject: any,\r\n    schemaField: SchemaEntityField,\r\n    primary: string,\r\n    parentEntityType: AbstractEntityType\r\n  ) {\r\n    const propertyName = schemaField.label;\r\n    Object.defineProperty(prototypeObject, propertyName, {\r\n      get: function () {\r\n        return this.getFieldValue(schemaField);\r\n      },\r\n      set: function (newPropValue) {\r\n        // \r\n        const oldPropValue = this.getFieldValue(schemaField);\r\n        if (this.isFieldValueChanged(schemaField, newPropValue, oldPropValue) === false) {\r\n          return;\r\n        }\r\n        this.setFieldValue(schemaField, newPropValue);\r\n        this.emitFieldValueChange(schemaField, newPropValue, oldPropValue);\r\n      }\r\n    });\r\n    const fieldMetadata = {\r\n      /**  */\r\n      dataField: this.getDataField(schemaField),\r\n      /**  */\r\n      originalDataField: schemaField.code,\r\n      /**  */\r\n      originalDataFieldType: schemaField.type.name,\r\n      /**\r\n       * \r\n       * @description schemepath\r\n       */\r\n      path: schemaField.path,\r\n      primary: schemaField.label === primary,\r\n      enableMultiLangInput: this.getEnableMultiLangInput(schemaField),\r\n      defaultValue: schemaField.defaultValue,\r\n      ngMetadataName: NG_FIELD\r\n    };\r\n    if (schemaField['enableStdTimeFormat'] && fieldMetadata.originalDataFieldType == \"DateTime\") {\r\n      fieldMetadata[\"enableTimeZone\"] = true;\r\n    }\r\n    if (fieldMetadata.primary) {\r\n      prototypeObject.innerPrimaryProperty = fieldMetadata;\r\n    }\r\n    if (!parentEntityType.__prop__metadata__[propertyName]) {\r\n      parentEntityType.__prop__metadata__[propertyName] = [];\r\n    }\r\n    parentEntityType.__prop__metadata__[propertyName].push(fieldMetadata);\r\n  }\r\n\r\n  private getDataField(schemaField: SchemaEntityField) {\r\n    if (schemaField.multiLanguage) {\r\n      return schemaField.label + \"_\" + \"MULTILANGUAGE\";\r\n    }\r\n    return schemaField.label;\r\n  }\r\n\r\n  private getEnableMultiLangInput(schemaField: SchemaEntityField) {\r\n    if (schemaField.multiLanguage) {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param prototypeObject \r\n   * @param schemaField \r\n   * @param parentEntityType \r\n   */\r\n  private defineComplexFieldToPrototype(prototypeObject: any, schemaField: SchemaEntityField, parentEntityType: AbstractEntityType) {\r\n    const complexFieldType = this.createClass(schemaField.type, schemaField);\r\n    parentEntityType.types[schemaField.type.name] = complexFieldType;\r\n    const propertyName = schemaField.label;\r\n    Object.defineProperty(prototypeObject, propertyName, {\r\n      get: function () {\r\n        const fieldValue = this.getComplexFieldValue(schemaField);\r\n        return fieldValue;\r\n      },\r\n      set: function (value: any) {\r\n        this.setComplexFieldValue(schemaField, complexFieldType, value);\r\n      }\r\n    });\r\n    const fieldMetadata = {\r\n      /**  */\r\n      dataField: schemaField.label,\r\n      /**  */\r\n      originalDataField: schemaField.code,\r\n      /**  */\r\n      type: complexFieldType,\r\n      /**\r\n       * \r\n       * @description schemepath\r\n       */\r\n      path: schemaField.path,\r\n      ngMetadataName: NG_OBJECT\r\n    };\r\n    if (!parentEntityType.__prop__metadata__[propertyName]) {\r\n      parentEntityType.__prop__metadata__[propertyName] = [];\r\n    }\r\n    parentEntityType.__prop__metadata__[propertyName].push(fieldMetadata);\r\n  }\r\n  /**\r\n   * \r\n   * @param prototypeObject \r\n   * @param entities \r\n   * @param parentEntityType \r\n   */\r\n  private defineEntitiesToPrototype(prototypeObject: any, entities: SchemaEntity[], parentEntityType: AbstractEntityType) {\r\n    if (entities && entities.length) {\r\n      // Schema\r\n      entities.forEach(schemaEntity => {\r\n        const complexFieldType = this.createClass(schemaEntity.type, schemaEntity);\r\n        parentEntityType.types[schemaEntity.type.name] = complexFieldType;\r\n        // \r\n        const propertyName = schemaEntity.label;\r\n        Object.defineProperty(prototypeObject, propertyName, {\r\n          get: function () {\r\n            const fieldValue = this.getEntities(schemaEntity);\r\n            return fieldValue;\r\n          },\r\n          set: function (value: any) {\r\n            this.setEntities(schemaEntity, value);\r\n          }\r\n        });\r\n        const entitMetadata = {\r\n          /**  */\r\n          dataField: schemaEntity.label,\r\n          /**  */\r\n          originalDataField: '',\r\n          /**  */\r\n          type: complexFieldType,\r\n          ngMetadataName: NG_LIST\r\n        };\r\n        if (!parentEntityType.__prop__metadata__[propertyName]) {\r\n          parentEntityType.__prop__metadata__[propertyName] = [];\r\n        }\r\n        parentEntityType.__prop__metadata__[propertyName].push(entitMetadata);\r\n      });\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   * @param schemaType \r\n   * @returns \r\n   */\r\n  private createEntityInstanceDataInitializer(schemaType: SchemaType) {\r\n    /**\r\n     * \r\n     * @param entityInstance \r\n     * @param data \r\n     * @param entityTypeConstructor \r\n     */\r\n    const initializer = (entityInstance: any, entityData: any, entityTypeConstructor: any) => {\r\n      // \r\n      schemaType.fields\r\n        // \r\n        .filter(field => field.$type === SchemaEntityField$Type.ComplexField)\r\n        // \r\n        .forEach(field => {\r\n          // \r\n          const fieldName = field.label;\r\n          // \r\n          const includedEntityTypes = entityTypeConstructor.types;\r\n          // \r\n          const ComplexField = includedEntityTypes[field.type.name];\r\n          // \r\n          const fieldData = entityData ? entityData[fieldName] : null;\r\n          // \r\n          const path = entityInstance.createPath(fieldName);\r\n          let complexFieldValue = entityInstance[fieldName];\r\n          if (complexFieldValue instanceof ComplexField) {\r\n            complexFieldValue.load(fieldData);\r\n          } else {\r\n            // \r\n            complexFieldValue = new ComplexField(fieldData);\r\n            complexFieldValue.constructor = ComplexField;\r\n            complexFieldValue[PARENT_CLASS] = entityTypeConstructor;\r\n            complexFieldValue[PARENT_PATH] = path;\r\n            complexFieldValue.onValueChanged.subscribe(changes => {\r\n              if (changes) {\r\n                changes.path = (entityInstance[PARENT_PATH] || []).concat(changes.path);\r\n                entityInstance.setChanges(changes);\r\n              }\r\n            });\r\n            entityInstance[fieldName] = complexFieldValue;\r\n          }\r\n        });\r\n      // \r\n      if (schemaType.entities) {\r\n        // \r\n        schemaType.entities.forEach(schemaEntity => {\r\n          // \r\n          const subEntityName = schemaEntity.label;\r\n          // \r\n          const includedEntityTypes = entityTypeConstructor.types;\r\n          // \r\n          const path = entityInstance.createPath(subEntityName);\r\n          // \r\n          let entityList = entityInstance[subEntityName];\r\n          if (!(entityList instanceof EntityList)) {\r\n            entityList = new EntityList<Entity>();\r\n            // \r\n            entityList.onListChanged.subscribe(value => {\r\n              if (value) {\r\n                if (entityList[PARENT_PATH][0] !== value.path[0]) {\r\n                  value.path = entityList[PARENT_PATH].concat(value.path);\r\n                }\r\n                entityInstance.setChanges(value);\r\n              }\r\n            });\r\n            // \r\n            entityInstance[subEntityName] = entityList;\r\n          }\r\n          entityList[PARENT_CLASS] = entityTypeConstructor;\r\n          entityList[PARENT_PATH] = path;\r\n          // \r\n          const schemaEntityTypeName = schemaEntity.type.name;\r\n          // \r\n          const ConcreteEntity = includedEntityTypes[schemaEntityTypeName];\r\n          const originalEntityDataArray = entityData ? entityData[subEntityName] : null;\r\n          // \r\n          if (originalEntityDataArray) {\r\n            // \r\n            const entities = originalEntityDataArray.map((originalEntityData: any) => {\r\n              const concreteEntityInstance = new ConcreteEntity(originalEntityData);\r\n              concreteEntityInstance.constructor = ConcreteEntity;\r\n              return concreteEntityInstance;\r\n            });\r\n            // \r\n            entityList.loadEntities(entities);\r\n          }\r\n        });\r\n      }\r\n    };\r\n    return initializer;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { HttpClient, HttpParams } from '@angular/common/http';\r\nimport { Observable } from 'rxjs';\r\n\r\nexport type RestfulMethod = 'GET' | 'PUT' | 'POST' | 'DELETE';\r\n\r\n@Injectable()\r\nexport class RestfulService {\r\n\r\n  /**\r\n   * \r\n   * @param httpClient http\r\n   */\r\n  constructor(private httpClient: HttpClient) { }\r\n\r\n  /**\r\n   * GET\r\n   * @param uri \r\n   * @param params \r\n   */\r\n  get(uri: string, params?: object, options?: any): Observable<any[]> {\r\n    return this.request(uri, 'GET', params, options);\r\n  }\r\n\r\n  /**\r\n   * POST\r\n   * @param uri \r\n   * @param params \r\n   */\r\n  put(uri: string, body: any, params?: object, options?: any): Observable<any> {\r\n    const optionsWithBody = this.addBody(options, body);\r\n    return this.request(uri, 'PUT', params, optionsWithBody);\r\n  }\r\n\r\n  /**\r\n   * PUT\r\n   * @param uri \r\n   * @param params \r\n   */\r\n  post(uri: string, body: any, params?: object, options?: any): Observable<any> {\r\n    const optionsWithBody = this.addBody(options, body);\r\n    return this.request(uri, 'POST', params, optionsWithBody);\r\n  }\r\n\r\n  /**\r\n   * DELETE\r\n   * @param uri \r\n   * @param params \r\n   */\r\n  delete(uri: string, params?: object, options?: any): Observable<any> {\r\n    return this.request(uri, 'DELETE', params, options);\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param uri \r\n   * @param params \r\n   */\r\n  private request(uri: string, method: RestfulMethod, params: object, options: any = {}): Observable<any> {\r\n    options = options || {};\r\n    if (params) {\r\n      const httpParams = this.buildParams(params);\r\n      options.params = httpParams;\r\n    }\r\n    const methodName = method as string;\r\n    const result = this.httpClient.request(methodName, uri, options);\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Http\r\n   * @param params \r\n   */\r\n  private buildParams(params: object): HttpParams {\r\n    let httpParams = new HttpParams();\r\n    for (const key in params) {\r\n      if (params.hasOwnProperty(key)) {\r\n        const value = params[key].toString();\r\n        httpParams = httpParams.append(key, value);\r\n      }\r\n    }\r\n    return httpParams;\r\n  }\r\n\r\n  private addBody(options: any, body: any) {\r\n    options = options || {};\r\n    const mergedOptions = Object.assign(options, { body: body});\r\n    return mergedOptions;\r\n  }\r\n}\r\n","import { TypeDecorator, makeDecorator, makePropDecorator } from '../metadata/index';\r\n\r\n/**\r\n * ----------------------------------------\r\n * NgCommandHandler\r\n * ----------------------------------------\r\n */\r\n\r\n/**\r\n * \r\n */\r\nexport const NG_COMMAND_HANDLER = 'NgCommandHandler';\r\n\r\n/**\r\n * \r\n */\r\nexport interface NgCommandHandler {\r\n\r\n  /**\r\n   * \r\n   */\r\n  commandName: string;\r\n}\r\n\r\n/**\r\n * \r\n */\r\nexport interface NgCommandHandlerDecorator {\r\n  (handler?: NgCommandHandler): TypeDecorator;\r\n  new(handler?: NgCommandHandler): NgCommandHandler;\r\n}\r\n\r\n/**\r\n * \r\n */\r\n\r\n// export const NgCommandHandler: NgCommandHandlerDecorator =\r\n//   makeDecorator(NG_COMMAND_HANDLER, (handler: NgCommandHandler) => handler);\r\nexport function NgCommandHandler(options: NgCommandHandler) {\r\n  const decoratorFactory = makeDecorator(NG_COMMAND_HANDLER, (handler: NgCommandHandler) => handler);\r\n  return decoratorFactory(options);\r\n  }\r\n\r\n/**\r\n * ----------------------------------------\r\n * NgCommandHandlerExtender\r\n * ----------------------------------------\r\n */\r\n\r\n/**\r\n * \r\n */\r\nexport const NG_COMMAND_HANDLER_EXTENDER = 'NgCommandHandlerExtender';\r\n\r\n/**\r\n * \r\n */\r\nexport interface NgCommandExtender {\r\n  commandName: string;\r\n}\r\n\r\n/**\r\n * \r\n */\r\nexport interface NgCommandHandlerExtenderDecorator {\r\n  (extender?: NgCommandExtender): TypeDecorator;\r\n  new(extender?: NgCommandExtender): NgCommandExtender;\r\n}\r\n\r\n/**\r\n * \r\n */\r\nexport function NgCommandHandlerExtender(options: NgCommandExtender) {\r\n  const decoratorFactory = makeDecorator(NG_COMMAND_HANDLER_EXTENDER, (extender: NgCommandExtender) => extender);\r\n  return decoratorFactory(options);\r\n}\r\n","/*\r\n * @Author: aalizzwell \r\n * @Date: 2019-10-25 13:30:52 \r\n * @Last Modified by:   aalizzwell \r\n * @Last Modified time: 2019-10-25 13:30:52 \r\n */\r\nimport { Observable } from 'rxjs';\r\n\r\nconst isObservable = (value) => {\r\n    if (!value) {\r\n        return false;\r\n    }\r\n    if (value[Symbol.observable] && value === value[Symbol.observable]()) {\r\n        return true;\r\n    }\r\n    if (value['@@observable'] && value === value['@@observable']()) {\r\n        return true;\r\n    }\r\n    if (value instanceof Observable) {\r\n        return true;\r\n    }\r\n    return false;\r\n}\r\nexport { isObservable }\r\n","import { Observable, of } from 'rxjs';\r\nimport { CommandContext } from '../command_context';\r\nimport { isObservable } from '../../misc/is-observable';\r\n\r\n/**\r\n * \r\n */\r\ntype TaskFunc = (context: CommandContext) => any;\r\n\r\n\r\n/**\r\n * \r\n */\r\nclass TaskNode {\r\n\r\n  /**\r\n   * \r\n   */\r\n  name: string;\r\n\r\n  /**\r\n   * \r\n   */\r\n  func: TaskFunc;\r\n\r\n  /**\r\n   * \r\n   */\r\n  constructor(name: string, func: TaskFunc) {\r\n    this.name = name;\r\n    this.func = func;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  execute(context: CommandContext): Observable<any> {\r\n    const result = this.func(context);\r\n    const result$ = isObservable(result) ? result : of(result);\r\n    return result$;\r\n  }\r\n}\r\n\r\nexport { TaskFunc, TaskNode };\r\n","/**\r\n * session\r\n * @author Witt <jiwt@inspur.com>\r\n */\r\n\r\nimport { Injectable, InjectionToken } from '@angular/core';\r\n\r\n/**\r\n * \r\n */\r\ninterface VariableParser {\r\n  /**\r\n   * \r\n   * @param expression \r\n   * @param context \r\n   */\r\n  parse(expression: string, context: any, eventParam?: any): any;\r\n}\r\n\r\nconst VARIABLE_PARSERS = new InjectionToken<VariableParser>('variable parsers');\r\n\r\nexport { VariableParser, VARIABLE_PARSERS };\r\n","/*\r\n * StateMachine\r\n * @Author: Witt\r\n * @Date: 2018-12-04 17:09:42\r\n * @Last Modified by: Witt\r\n * @Last Modified time: 2019-10-30 11:07:10\r\n */\r\n\r\n// import { AppContext } from '../app/index';\r\n// import { FrameContext } from '../frame/index';\r\n// import { CommandContext } from '../command/index';\r\n\r\n/**\r\n * \r\n */\r\nclass ParseUtil {\r\n\r\n  /**\r\n   * \r\n   */\r\n  static getAppContext(context: any): any {\r\n    if (context.typeName === 'CommandContext') {\r\n      return context.frameContext.appContext;\r\n    } else if (context.appContext) {\r\n      return context.appContext;\r\n    } else if (context.typeName === 'AppContext') {\r\n      return context;\r\n    } else {\r\n      throw new Error('AppContext');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * FrameContext\r\n   */\r\n  static getFrameContext(context: any) {\r\n    if (context.typeName === 'CommandContext') {\r\n      return context.frameContext;\r\n    } else if (context.typeName === 'FrameContext') {\r\n      return context;\r\n    } else {\r\n      throw new Error('FrameContext');\r\n    }\r\n\r\n  }\r\n\r\n  /**\r\n   * FrameContext\r\n   */\r\n  static getRootFrameContext(context: any): any {\r\n    const frameContext = this.getFrameContext(context);\r\n    return frameContext.root;\r\n  }\r\n\r\n  /**\r\n   * frameIdFrameContext\r\n   */\r\n  static getFrameContextById(context: any, frameId: string): any {\r\n    const appContext = this.getAppContext(context);\r\n    return appContext.frameContextManager.getFrameContextById(frameId);\r\n  }\r\n}\r\n\r\nexport { ParseUtil };\r\n","/**\r\n * \r\n * @author Witt <jiwt@inspur.com>\r\n */\r\nimport { Injectable } from '@angular/core';\r\nimport { AppContext } from '../app/index';\r\nimport { VariableParser } from './variable_parser';\r\nimport { ParseUtil } from './parse_util';\r\nimport { escape } from '../core/escape';\r\n/**\r\n * \r\n */\r\n@Injectable()\r\nclass DataVariableParser implements VariableParser {\r\n\r\n  /**\r\n   * \r\n   * @param expression \r\n   * @param context \r\n   */\r\n  parse(expression: string, context: any): any {\r\n    const appContext = ParseUtil.getAppContext(context);\r\n    const paths: string[] = this.extractPaths(expression);\r\n\r\n    if (paths.length === 1) {\r\n      const value = this.getValue(paths[0], appContext);\r\n      // 1\r\n      if (expression === `{DATA~${paths[0]}}`) {\r\n        return value;\r\n      } else if (expression === `{:DATA~${paths[0]}}`) {\r\n        // JSON\r\n        return escape(value);\r\n      }\r\n    }\r\n\r\n    // 2\r\n    paths.forEach((path: string) => {\r\n      const replaceValue = this.getValue(path, appContext);\r\n      const searchValue = `{DATA~${path}}`;\r\n      expression = expression.replace(searchValue, replaceValue);\r\n\r\n      const target = `{:DATA~${path}}`;\r\n      if (expression.includes(target)) {\r\n        const value = escape(replaceValue);\r\n        expression = expression.replace(target, value);\r\n      }\r\n    });\r\n\r\n    return expression;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private extractPaths(expression: string) {\r\n    const paths: string[] = [];\r\n\r\n    // uiState\r\n    const DATA_PATTERN_G = /\\{:?DATA~(\\S+?)\\}/g;\r\n    const dataVariables = expression.match(DATA_PATTERN_G);\r\n    if (dataVariables === null) {\r\n      return [];\r\n    }\r\n\r\n    // \r\n    const DATA_PATTERN = /\\{:?DATA~(\\S+?)\\}/;\r\n    dataVariables.forEach(dataVariable => {\r\n      const pathMatches = dataVariable.match(DATA_PATTERN);\r\n      if (pathMatches != null && pathMatches.length === 2) {\r\n        paths.push(pathMatches[1]);\r\n      }\r\n    });\r\n    return paths;\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param path /\r\n   */\r\n  private getValue(path: string, appContext: AppContext): any {\r\n    const parts = path.split('/').filter((part: string) => {\r\n      return part !== '';\r\n    });\r\n\r\n    const frameContext = appContext.getFrameContext(parts[0]);\r\n    if (!frameContext) {\r\n      throw new Error(`${path}`);\r\n    }\r\n\r\n    const bindingData = frameContext.bindingData;\r\n    if (!bindingData) {\r\n      throw new Error(`${path}`);\r\n    }\r\n    return bindingData.getValue(parts.slice(1));\r\n  }\r\n\r\n\r\n}\r\n\r\nexport { DataVariableParser };\r\n","/**\r\n * session\r\n * @author Witt <jiwt@inspur.com>\r\n */\r\n\r\nimport { Injectable } from '@angular/core';\r\nimport { VariableParser } from './variable_parser';\r\nimport { AppContext } from '../app/index';\r\nimport { ParseUtil } from './parse_util';\r\nimport { escape } from '../core/escape';\r\n/**\r\n * \r\n */\r\n@Injectable()\r\nclass UIStateVariableParser implements VariableParser {\r\n\r\n  /**\r\n   * \r\n   * @param expression /frameId/stateName\r\n   * @param context \r\n   */\r\n  public parse(expression: string, context: any): any {\r\n\r\n    const appContext = ParseUtil.getAppContext(context);\r\n    const paths = this.extractPaths(expression);\r\n\r\n    if (paths.length === 1) {\r\n      const value = this.getUIState(paths[0], appContext);\r\n      // 1\r\n      if (expression === `{UISTATE~${paths[0]}}`) {\r\n        return value;\r\n      } else if (expression === `{:UISTATE~${paths[0]}}`) {\r\n        return escape(value);\r\n      }\r\n    }\r\n\r\n    // 2\r\n    paths.forEach(path => {\r\n      const searchValue = `{UISTATE~${path}}`;\r\n      const replaceValue = this.getUIState(path, appContext);\r\n      expression = expression.replace(searchValue, replaceValue);\r\n\r\n      const target = `{:UISTATE~${path}}`;\r\n      if (expression.includes(target)) {\r\n        const value = escape(replaceValue);\r\n        expression = expression.replace(target, value);\r\n      }\r\n    });\r\n\r\n    return expression;\r\n  }\r\n\r\n  /**\r\n   * \r\n   * {}\r\n   */\r\n  private extractPaths(expression: string): string[] {\r\n    const paths: string[] = [];\r\n\r\n    // uiState\r\n    const UI_STATE_PATTERN_G = /\\{:?UISTATE~(\\S+?)\\}/g;\r\n    const uiStateVariables = expression.match(UI_STATE_PATTERN_G);\r\n    if (uiStateVariables === null) {\r\n      return [];\r\n    }\r\n\r\n    // \r\n    const UI_STATE_PATTERN = /\\{:?UISTATE~(\\S+?)\\}/;\r\n    uiStateVariables.forEach((uiStateVariable: string) => {\r\n      const pathMatches = uiStateVariable.match(UI_STATE_PATTERN);\r\n      if (pathMatches != null && pathMatches.length === 2) {\r\n        paths.push(pathMatches[1]);\r\n      }\r\n    });\r\n\r\n    return paths;\r\n  }\r\n\r\n  /**\r\n   * UIState\r\n   */\r\n  private getUIState(path: string, appContext: AppContext) {\r\n    const parts = path.split('/').filter((part: string) => {\r\n      return part !== '';\r\n    });\r\n    const [frameId, stateName] = parts;\r\n    const frameContext = appContext.getFrameContext(frameId);\r\n    let state = frameContext && frameContext.uiState[stateName];\r\n    if (state && state.constructor.toString().startsWith('function Date()')) {\r\n      return this.formatDate(state);\r\n    }\r\n    for (let i = 2; i < parts.length; i++) {\r\n      state = state[parts[i]];\r\n      // undefinedundefined\r\n      if (!state) {\r\n        return state;\r\n      }\r\n    }\r\n    return state;\r\n  }\r\n\r\n  /**\r\n   * @todo\r\n   */\r\n  private formatDate(value: Date): string {\r\n    if (!value) {\r\n      return '';\r\n    }\r\n\r\n    // \r\n    const year = value.getFullYear();\r\n\r\n    // \r\n    let month = (value.getMonth() + 1).toString();\r\n    month = month.length === 1 ? ('0' + month) : month;\r\n\r\n    // \r\n    let day = value.getDate().toString();\r\n    day = day.length === 1 ? ('0' + day) : day;\r\n    return `${year}-${month}-${day}`;\r\n  }\r\n}\r\n\r\nexport { UIStateVariableParser };\r\n","/*\r\n * StateMachine\r\n * @Author: Witt\r\n * @Date: 2018-12-04 17:09:42\r\n * @Last Modified by: Witt\r\n * @Last Modified time: 2019-10-30 11:07:10\r\n */\r\nimport { Injectable } from '@angular/core';\r\nimport { FrameContext } from '../frame/index';\r\nimport { StateMachine } from '../state-machine/index';\r\nimport { VariableParser } from './variable_parser';\r\nimport { ParseUtil } from './parse_util';\r\n\r\n/**\r\n * \r\n * @summary\r\n *\r\n * \r\n * 1frameIdStateMachine\r\n * {STATEMACHINE~/states/key}\r\n * {STATEMACHINE~/renderStates/key}\r\n *\r\n * 2frameIdframeIdFrameContextStateMachine\r\n * {STATEMACHINE~/frameId/states/key}\r\n * {STATEMACHINE~/frameId/renderStates/key}\r\n *\r\n * \r\n * 1frameIdStateMachineFrameContextStateMachine\r\n * 2StateMachinerootFrameContextStateMachine\r\n * 3farmeIdstatesrenderStates\r\n */\r\n@Injectable()\r\nclass StateMachineVariableParser implements VariableParser {\r\n\r\n  /**\r\n   * \r\n   */\r\n  public constructor() {\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param expression /frameId/componentId/stateName\r\n   * @param context \r\n   */\r\n  public parse(expression: string, context: any): any {\r\n    const paths = this.extractPaths(expression);\r\n\r\n    // 1\r\n    if (paths.length === 1 && expression === `{STATEMACHINE~${paths[0]}}`) {\r\n      return this.getValue(paths[0], context);\r\n    }\r\n\r\n    // 2\r\n    paths.forEach( path => {\r\n      const searchValue = `{STATEMACHINE~${path}}`;\r\n      const replaceValue = this.getValue(path, context);\r\n      expression = expression.replace(searchValue, replaceValue);\r\n    });\r\n\r\n    return  expression;\r\n  }\r\n\r\n  /**\r\n   * Session\r\n   * {}\r\n   */\r\n  private extractPaths(expression: string): string[] {\r\n    const paths: string[]  = [];\r\n\r\n    // StateMachine\r\n    const STATE_MACHINE_PATTERN_G = /\\{STATEMACHINE~(\\S+?)\\}/g;\r\n    const stateMachineVariables = expression.match(STATE_MACHINE_PATTERN_G);\r\n    if (stateMachineVariables === null) {\r\n      return [];\r\n    }\r\n\r\n    // \r\n    const STATE_MACHINE_PATTERN = /\\{STATEMACHINE~(\\S+?)\\}/;\r\n    stateMachineVariables.forEach( sessionVariable =>  {\r\n      const pathMatches = sessionVariable.match(STATE_MACHINE_PATTERN);\r\n      if (pathMatches != null && pathMatches.length === 2) {\r\n        paths.push(pathMatches[1]);\r\n      }\r\n    });\r\n\r\n    return paths;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private getValue(path: string, context: any): any {\r\n\r\n    const pathObj = this.getPathObj(path);\r\n    const stateMachine = this.getTargetStateMachine(pathObj.frameId, context);\r\n\r\n    if (pathObj.type === 'currentState') {\r\n      return stateMachine.context.state;\r\n    } else if (pathObj.type === 'renderStates') {\r\n      return stateMachine[pathObj.name] as boolean;\r\n    } else {\r\n      throw new Error(`${pathObj.type}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * pathStateMachine\r\n   */\r\n  private getTargetStateMachine(frameId: string, context): StateMachine {\r\n    let targetFrameContext: FrameContext;\r\n    if (frameId) {\r\n      targetFrameContext = ParseUtil.getFrameContextById(context, frameId);\r\n    } else {\r\n      targetFrameContext = ParseUtil.getRootFrameContext(context);\r\n    }\r\n\r\n    if (!targetFrameContext || !targetFrameContext.stateMachine) {\r\n      throw new Error('');\r\n    }\r\n    return targetFrameContext.stateMachine;\r\n  }\r\n\r\n  /**\r\n   * PathPath\r\n   */\r\n  private getPathObj(path: string): any {\r\n    let parsedPathObj: any;\r\n    const parts = this.splitPath(path);\r\n\r\n    if (parts[0] === 'currentState' || parts[0] === 'renderStates') {\r\n      parsedPathObj = {\r\n        frameId: '',\r\n        type: parts[0],\r\n        name: parts[1]\r\n      };\r\n    } else {\r\n      parsedPathObj = {\r\n        frameId: parts[0],\r\n        type: parts[1],\r\n        name: parts[2]\r\n      };\r\n    }\r\n\r\n    return parsedPathObj;\r\n  }\r\n\r\n  /**\r\n   * Path\r\n   */\r\n  private splitPath(path: string): string[] {\r\n    const parts = path.split('/').filter((part: string) => {\r\n      return part !== '';\r\n    });\r\n    return parts;\r\n  }\r\n\r\n}\r\n\r\nexport { StateMachineVariableParser };\r\n","/**\r\n * session\r\n * @author Witt <jiwt@inspur.com>\r\n */\r\n\r\nimport { Injectable } from '@angular/core';\r\nimport { CommandContext } from '../command/index';\r\nimport { VariableParser } from './variable_parser';\r\n\r\n/**\r\n * \r\n * {COMMAND~/params/key}\r\n * {COMMAND~/results/taskName}\r\n */\r\n@Injectable()\r\nclass CommandVariableParser implements VariableParser {\r\n\r\n  /**\r\n   * \r\n   */\r\n  public constructor() {\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param expression /frameId/componentId/stateName\r\n   * @param context \r\n   */\r\n  public parse(expression: string, context: any): any {\r\n    const paths = this.extractPaths(expression);\r\n\r\n    // 1\r\n    if (paths.length === 1 && expression === `{COMMAND~${paths[0]}}`) {\r\n      return this.getValue(paths[0], context);\r\n    }\r\n\r\n    // 2\r\n    paths.forEach(path => {\r\n      const searchValue = `{COMMAND~${path}}`;\r\n      const replaceValue = this.getValue(path, context);\r\n      expression = expression.replace(searchValue, replaceValue);\r\n    });\r\n\r\n    return expression;\r\n  }\r\n\r\n  /**\r\n   * Session\r\n   * {}\r\n   */\r\n  private extractPaths(expression: string): string[] {\r\n    const paths: string[] = [];\r\n\r\n    // uiState\r\n    const UI_STATE_PATTERN_G = /\\{COMMAND~(\\S+?)\\}/g;\r\n    const uiStateVariables = expression.match(UI_STATE_PATTERN_G);\r\n    if (uiStateVariables === null) {\r\n      return [];\r\n    }\r\n\r\n    // \r\n    const UI_STATE_PATTERN = /\\{COMMAND~(\\S+?)\\}/;\r\n    uiStateVariables.forEach(sessionVariable => {\r\n      const pathMatches = sessionVariable.match(UI_STATE_PATTERN);\r\n      if (pathMatches != null && pathMatches.length === 2) {\r\n        paths.push(pathMatches[1]);\r\n      }\r\n    });\r\n\r\n    return paths;\r\n  }\r\n\r\n  /**\r\n   * UIState\r\n   */\r\n  private getValue(path: string, context: any) {\r\n    if (context instanceof CommandContext === false) {\r\n      throw new Error('COMMAND');\r\n    }\r\n    const parts = path.split('/').filter((part: string) => {\r\n      return part !== '';\r\n    });\r\n    const type = parts.shift();\r\n    if (type === 'params') {\r\n      const paramKey = parts.shift();\r\n      return context.command.params[paramKey];\r\n    } else if (type === 'results') {\r\n      return parts.reduce((results: any, paramKey: string) => {\r\n        return results && results[paramKey];\r\n      }, context.results);\r\n    }\r\n  }\r\n}\r\n\r\nexport { CommandVariableParser };\r\n","/**\r\n * \r\n * @author Witt<jiwt@inspur.com>\r\n */\r\n\r\nimport { Inject, Injectable } from '@angular/core';\r\nimport { VariableParser, VARIABLE_PARSERS } from './variable_parser';\r\n\r\n\r\n/**\r\n * \r\n * \r\n * 1\r\n * 2\r\n *\r\n * @todo \r\n */\r\n@Injectable()\r\nclass VariableParseService {\r\n\r\n  /**\r\n   * \r\n   */\r\n  private parsers: VariableParser[];\r\n\r\n  /**\r\n   * \r\n   * @param parsers \r\n   */\r\n  constructor(@Inject(VARIABLE_PARSERS) parsers: VariableParser[]) {\r\n    this.parsers = parsers;\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param expression \r\n   * @param context \r\n   */\r\n  public parse(target: any, context?: any, eventParam?: any): any {\r\n    if (typeof target === 'string' && target.length > 0) {\r\n\r\n      // \r\n      return this.parseExpression(target, context, eventParam);\r\n\r\n    } else if (Array.isArray(target)) {\r\n\r\n      // \r\n      target.forEach((item, itemIndex) => {\r\n        if (typeof item === 'string') {\r\n          target[itemIndex] = this.parseExpression(item, context, eventParam);\r\n        } else {\r\n          target[itemIndex] = this.parse(item, context, eventParam);\r\n        }\r\n      });\r\n\r\n    } else if (typeof target === 'object' && target !== null) {\r\n\r\n      // \r\n      const keys = Object.keys(target);\r\n      keys.forEach(key => {\r\n        if (typeof target[key] === 'string') {\r\n          target[key] = this.parseExpression(target[key], context, eventParam);\r\n        } else {\r\n          target[key] = this.parse(target[key], context, eventParam);\r\n        }\r\n      });\r\n    }\r\n\r\n    return target;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public evaluate(expression: string, context?: any, eventParam?: any): any {\r\n    const parsedExpression = this.parse(expression, context, eventParam);\r\n    return (new Function('return ' + parsedExpression))();\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param expression \r\n   * @param context \r\n   */\r\n  private parseExpression(expression: string, context: any, eventParam: any): string {\r\n\r\n    // \r\n    if (expression === '') {\r\n      return '';\r\n    }\r\n\r\n    this.parsers.forEach(parser => {\r\n      if (typeof expression === 'string') {\r\n        expression = parser.parse(expression, context, eventParam);\r\n      }\r\n    });\r\n    return expression;\r\n  }\r\n}\r\n\r\nexport { VariableParseService };\r\n","/**\r\n * session\r\n * @author Witt <jiwt@inspur.com>\r\n */\r\n\r\nimport { Injectable } from '@angular/core';\r\nimport { VariableParser } from './variable_parser';\r\nimport { AppContext } from '../app/index';\r\nimport { ParseUtil } from './parse_util';\r\nimport { FrameContext } from '../frame';\r\nconst VARIABLE_MATCHER = /#{\\S+?}/g;\r\n/**\r\n * \r\n */\r\n@Injectable()\r\nclass FrameIdVariableParser implements VariableParser {\r\n  public context: any;\r\n  /**\r\n   * \r\n   * @param expression /#{root-component}/stateName\r\n   * @param context \r\n   */\r\n  public parse(expression: string, context: any): any {\r\n    this.context = context;\r\n    const variables = this.extractVariables(expression);\r\n\r\n    if (!variables || variables.length < 1) {\r\n      return expression;\r\n    }\r\n    variables.forEach((exp: string) => {\r\n      const frameId = this.getVariableValue(exp);\r\n      expression = expression.replace(VARIABLE_MATCHER, frameId);\r\n    });\r\n    return expression;\r\n  }\r\n  /**\r\n   * \r\n   * @param expression like #{root-component}\r\n   */\r\n  private getVariableValue(expression: string) {\r\n    const relativeFrameId = expression.substring(2, expression.length - 1);\r\n    return this.getFullFrameId(relativeFrameId);\r\n  }\r\n  private extractVariables(expression: string) {\r\n    if (!expression) {\r\n      return [];\r\n    }\r\n    return expression.match(VARIABLE_MATCHER);\r\n  }\r\n\r\n  /**\r\n   * frameId\r\n   * @param frameId frameId\r\n   */\r\n  private getFullFrameId(frameId: string) {\r\n    const frameContext: FrameContext = ParseUtil.getFrameContext(this.context);\r\n    const namespace = frameContext.namespace || '';\r\n    const prefix = namespace ? `${namespace}_` : '';\r\n    return `${prefix}${frameId}`;\r\n  }\r\n}\r\n\r\nexport { FrameIdVariableParser };\r\n","import { FrameContext } from '../frame';\r\nimport { ParseUtil } from './parse_util';\r\nimport { VariableParser } from './variable_parser';\r\nconst FORM_STATES_EXP = /\\{FORMSTATE~\\/(\\S+?)\\}/g;\r\nconst FORM_STATE_EXP = /\\{FORMSTATE~\\/(\\S+?)\\}/;\r\n\r\nexport class FormStateVariableParser implements VariableParser {\r\n  public context: any;\r\n  /**\r\n   * \r\n   */\r\n  public parse(expression: string, context: any): any {\r\n    this.context = context;\r\n    const variables = this.extractVariables(expression);\r\n    if (!variables || variables.length < 1) {\r\n      return expression;\r\n    }\r\n    variables.forEach(variableExpression => {\r\n      const exprs = variableExpression.match(FORM_STATE_EXP);\r\n      if (exprs && exprs.length === 2) {\r\n        const variable = exprs[1];\r\n        const value = this.getVariableValue(variable);\r\n        expression = expression.replace(FORM_STATE_EXP, value);\r\n      }\r\n    });\r\n    return expression;\r\n  }\r\n  /**\r\n   * \r\n   * @param variable \r\n   */\r\n  private getVariableValue(variable: string) {\r\n    const frameContext: FrameContext = ParseUtil.getFrameContext(this.context);\r\n    const appContext = frameContext.appContext;\r\n    const formVariable = appContext.params.get(variable);\r\n    return formVariable;\r\n  }\r\n  /**\r\n   * FormState\r\n   * @param expression \r\n   */\r\n  private extractVariables(expression: string): string[] | null {\r\n    if (!expression) {\r\n      return null;\r\n    }\r\n    const formStates = expression.match(FORM_STATES_EXP);\r\n    if (!formStates || formStates.length < 1) {\r\n      return null;\r\n    }\r\n    return formStates;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { VariableParser } from './variable_parser';\r\nconst EVENT_PARAMS_EXP = /\\{EVENTPARAM~\\/(\\S+?)\\}/g;\r\nconst EVENT_PARAM_EXP = /\\{EVENTPARAM~\\/(\\S+?)\\}/;\r\n\r\n/**\r\n * \r\n */\r\n@Injectable()\r\nexport class EventParamVariableParser implements VariableParser {\r\n  public context: any;\r\n\r\n  public parse(expression: string, context: any, eventParam?: any) {\r\n    this.context = context;\r\n    const variables = this.extractVariables(expression);\r\n    if (!variables || variables.length < 1) {\r\n      return expression;\r\n    }\r\n    variables.forEach(variableExpression => {\r\n      const exprs = variableExpression.match(EVENT_PARAM_EXP);\r\n      if (exprs && exprs.length === 2) {\r\n        const variable = exprs[1];\r\n        const value = this.getVariableValue(variable, eventParam);\r\n        expression = expression.replace(EVENT_PARAM_EXP, value);\r\n      }\r\n    });\r\n    return expression;\r\n  }\r\n  /**\r\n   * \r\n   * @param expression \r\n   * @returns \r\n   */\r\n  private extractVariables(expression: string) {\r\n    if (!expression) {\r\n      return null;\r\n    }\r\n    const variables = expression.match(EVENT_PARAMS_EXP);\r\n    if (!variables || variables.length < 1) {\r\n      return null;\r\n    }\r\n    return variables;\r\n  }\r\n  /**\r\n   * \r\n   * @param variable \r\n   */\r\n  private getVariableValue(variable: string, eventParam: any) {\r\n    if (!eventParam || !variable) {\r\n      return null;\r\n    }\r\n    const variables = variable.split('/').filter(p => p);\r\n    const result = variables.reduce((target: any, key: string) => {\r\n      if (target) {\r\n        return target[key];\r\n      } else {\r\n        return null;\r\n      }\r\n    }, eventParam);\r\n    return result;\r\n  }\r\n}","import { Provider } from '@angular/core';\r\n\r\nimport { VariableParser, VARIABLE_PARSERS } from './variable_parser';\r\nimport { DataVariableParser } from './data_variable_parser';\r\nimport { UIStateVariableParser } from './ui_state_variable_parser';\r\nimport { StateMachineVariableParser } from './state_machine_variable_parser';\r\nimport { CommandVariableParser } from './command_variable_parser';\r\nimport { VariableParseService } from './variable_parse_service';\r\nimport { FrameIdVariableParser } from './frame_id_variable_parser';\r\nimport { FormStateVariableParser } from './form_state_variable_parser';\r\nimport { EventParamVariableParser } from './event_param_variable_parser';\r\n\r\n// Providers\r\nconst VARIABLE_PROVIDERS: Provider[] = [\r\n  { provide: VARIABLE_PARSERS, multi: true, useClass: FrameIdVariableParser },\r\n  { provide: VARIABLE_PARSERS, multi: true, useClass: FormStateVariableParser },\r\n  { provide: VARIABLE_PARSERS, multi: true, useClass: EventParamVariableParser },\r\n  { provide: VARIABLE_PARSERS, multi: true, useClass: DataVariableParser },\r\n  { provide: VARIABLE_PARSERS, multi: true, useClass: UIStateVariableParser },\r\n  { provide: VARIABLE_PARSERS, multi: true, useClass: StateMachineVariableParser },\r\n  { provide: VARIABLE_PARSERS, multi: true, useClass: CommandVariableParser },\r\n  VariableParseService\r\n];\r\n\r\nexport {\r\n  VariableParser, VARIABLE_PARSERS,\r\n  FrameIdVariableParser,\r\n  DataVariableParser, UIStateVariableParser,\r\n  CommandVariableParser, StateMachineVariableParser,\r\n  VariableParseService, EventParamVariableParser, VARIABLE_PROVIDERS\r\n};\r\n","import { Injectable } from '@angular/core';\r\nimport { VariableParseService } from '../../variable/index';\r\nimport { CommandContext } from '../command_context';\r\n\r\n/**\r\n * \r\n * @params result \r\n * @params context \r\n */\r\ntype LinkFunc = (context: CommandContext) => boolean;\r\n\r\n/**\r\n * \r\n */\r\nclass TaskLink {\r\n\r\n  /**\r\n   * \r\n   */\r\n  from: string;\r\n\r\n  /**\r\n   * \r\n   */\r\n  to: string;\r\n\r\n  /**\r\n   * \r\n   * 1\r\n   * 2\r\n   * 3\r\n   */\r\n  condition: string | boolean | LinkFunc;\r\n\r\n  /**\r\n   * \r\n   */\r\n  constructor(from: string, to: string, condition: string | boolean | LinkFunc) {\r\n    this.from = from;\r\n    this.to = to;\r\n    this.condition = condition;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public canLink(context: CommandContext): boolean {\r\n    const type = typeof this.condition;\r\n    let canLink;\r\n    switch (type) {\r\n      case 'boolean':\r\n        canLink = this.condition as boolean;\r\n        break;\r\n      case 'function':\r\n        canLink = (<LinkFunc>this.condition)(context);\r\n        break;\r\n      case 'string':\r\n        const parseService = context && context.frameContext && context.frameContext.injector && context.frameContext.injector.get<VariableParseService>(VariableParseService);\r\n        canLink = parseService && parseService.evaluate(this.condition as string, context);\r\n        break;\r\n      default:\r\n        canLink = false;\r\n        break;\r\n    }\r\n    return canLink;\r\n  }\r\n}\r\n\r\nexport { LinkFunc, TaskLink };\r\n","/*\r\n * @Author: Witt\r\n * @Date: 2018-10-17 14:13:40\r\n * @Last Modified by: Witt\r\n * @Last Modified time: 2018-10-17 16:08:34\r\n */\r\n\r\nimport { TaskFunc, TaskNode } from './task_node';\r\nimport { LinkFunc, TaskLink } from './task_link';\r\nimport { CommandContext } from '../command_context';\r\n\r\n/**\r\n * \r\n */\r\nclass TaskFlow {\r\n\r\n  /**\r\n   * \r\n   */\r\n  private nodes: TaskNode[] = [];\r\n\r\n  /**\r\n   * \r\n   */\r\n  private links: TaskLink[] = [];\r\n\r\n\r\n  // #region \r\n\r\n  /**\r\n   * \r\n   */\r\n  public addNode(name: string, func: TaskFunc): void {\r\n    const node = new TaskNode(name, func);\r\n    this.nodes.push(node);\r\n  }\r\n\r\n\r\n  /**\r\n   * \r\n   */\r\n  public addNodes(nodes: TaskNode[]) {\r\n    this.nodes = this.nodes.concat(nodes);\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param target \r\n   * @param name \r\n   * @param func \r\n   */\r\n  public insertNode(target: string, name: string, func: TaskFunc): void {\r\n    const index = this.findNodeIndex(target);\r\n    const node = this.createNode(name, func);\r\n    this.nodes.splice(index, 0, node);\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public appendNode(target: string, name: string, func: TaskFunc) {\r\n    const index = this.findNodeIndex(target) + 1;\r\n    const node = this.createNode(name, func);\r\n    this.nodes.splice(index, 0, node);\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param name \r\n   */\r\n  private findNodeIndex(name: string): number {\r\n    return this.nodes.findIndex((node: TaskNode) => {\r\n      return node.name === name;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param name \r\n   * @param func \r\n   */\r\n  private createNode(name: string, func: TaskFunc): TaskNode {\r\n    const node = new TaskNode(name, func);\r\n    return node;\r\n  }\r\n\r\n  // #endregion\r\n\r\n\r\n  // #region \r\n\r\n  /**\r\n   * \r\n   * @param name \r\n   * @param func \r\n   */\r\n  public addLink(from: string, to: string, condition: string | boolean) {\r\n    const link = this.createLink(from, to, condition);\r\n    this.links.push(link);\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public addLinks(links: TaskLink[]) {\r\n    this.links = this.links.concat(links);\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private createLink(from: string, to: string, condition: string | boolean) {\r\n    const link = new TaskLink(from, to, condition);\r\n    return link;\r\n  }\r\n\r\n  // #endregion\r\n\r\n\r\n  // #region \r\n  /**\r\n   * \r\n   * @param from    \r\n   * @param context \r\n   */\r\n  getNext(from?: string, context?: CommandContext): TaskNode {\r\n    if (!from) {\r\n      return this.nodes.shift();\r\n    }\r\n\r\n    // \r\n    const nextLink = this.links.find((link: TaskLink) => {\r\n      return link.from === from && link.canLink(context);\r\n    });\r\n    if (!nextLink) {\r\n      return;\r\n    }\r\n\r\n    return this.nodes.find((node: TaskNode) => {\r\n      return node.name === nextLink.to;\r\n    });\r\n  }\r\n\r\n  // #endregion\r\n\r\n  // #region \r\n\r\n  /**\r\n   * \r\n   */\r\n  clone() {\r\n    const taskFlow = new TaskFlow();\r\n    taskFlow.addNodes(this.nodes);\r\n    taskFlow.addLinks(this.links);\r\n    return taskFlow;\r\n  }\r\n\r\n  // #endregion\r\n}\r\n\r\nexport { TaskFlow };\r\n","import { IDisposable } from '../core';\r\nimport { FrameContext } from '../frame/index';\r\nimport { Command } from './command';\r\n\r\n/**\r\n * Command\r\n */\r\nclass CommandContext implements IDisposable{\r\n\r\n  public typeName = 'CommandContext';\r\n\r\n  /**\r\n   * \r\n   */\r\n  command: Command;\r\n\r\n  /**\r\n   * \r\n   */\r\n  frameContext: FrameContext;\r\n\r\n  /**\r\n   * \r\n   * task\r\n   */\r\n  results: { [taskName: string]: any } = {};\r\n\r\n  /**\r\n   * \r\n   */\r\n  latestResult: any;\r\n\r\n  /**\r\n   * \r\n   */\r\n  eventParam: any;\r\n\r\n  /**\r\n   * \r\n   * @param command \r\n   * @param frameContext \r\n   */\r\n  constructor(command: Command, frameContext: FrameContext) {\r\n    this.command = command;\r\n    this.frameContext = frameContext;\r\n  }\r\n  public dispose() {\r\n    this.eventParam = null;\r\n    this.command = null;\r\n    this.results = null;\r\n    this.latestResult = null;\r\n    this.frameContext = null;\r\n  }\r\n  public clearResults(){\r\n    this.results = null;\r\n  }\r\n}\r\n\r\nexport { CommandContext };\r\n","import { InjectionToken } from '@angular/core';\r\nimport { Translate } from './translate';\r\n\r\nexport const TranslateToken = new InjectionToken<Translate>('@farris/devkit TranslateToken');\r\n","import { InjectionToken, Optional, Injector, OnDestroy } from '@angular/core';\r\nimport { Observable, Subject, BehaviorSubject, EMPTY } from 'rxjs';\r\nimport { concatMap, map, takeLast, take, takeUntil, throwIfEmpty } from 'rxjs/operators';\r\n\r\nimport { FrameContext } from '../frame/index';\r\nimport { VariableParseService } from '../variable/index';\r\n\r\nimport { Command, CommandParams, ParamDescriptions } from './command';\r\nimport { CommandContext } from './command_context';\r\nimport { TaskFunc, TaskFlow } from './flow/index';\r\nimport { TranslateToken } from '../i18n/translate_token';\r\nimport { Translate } from '../i18n/translate';\r\nimport { IDisposable } from '../core';\r\n\r\n/**\r\n * schedule\r\n */\r\nabstract class CommandHandler implements IDisposable, OnDestroy {\r\n\r\n  /**\r\n   * \r\n   */\r\n  private taskFlow: TaskFlow;\r\n\r\n  /**\r\n   * \r\n   */\r\n  protected frameContext: FrameContext;\r\n\r\n  /**\r\n   * \r\n   */\r\n  protected parseService: VariableParseService;\r\n\r\n  public commandName: string;\r\n  private destroy$: Subject<any> = new Subject<any>();\r\n  /**\r\n   * \r\n   */\r\n  constructor() {\r\n  }\r\n  dispose(options?: any) {\r\n    if (this.destroy$) {\r\n      this.destroy$.next();\r\n      this.destroy$.complete();\r\n    }\r\n    this.frameContext = null;\r\n  }\r\n  ngOnDestroy(): void {\r\n    this.dispose();\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  abstract schedule();\r\n\r\n  /**\r\n   * \r\n   */\r\n  public init(frameContext: FrameContext, variableParseService: VariableParseService) {\r\n    this.frameContext = frameContext;\r\n    this.parseService = variableParseService;\r\n    this.taskFlow = new TaskFlow();\r\n    this.schedule();\r\n\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param command \r\n   * @return \r\n   * @todo\r\n   */\r\n  public execute(command: Command): Observable<any> {\r\n    const lastTaskResult$ = new Subject();\r\n    const taskFlow = this.taskFlow.clone();\r\n\r\n    // setTimeout\r\n    // 1TreeTableBinding\r\n    // 2\r\n    setTimeout(() => {\r\n      if (!this.frameContext || this.frameContext.isDisposed) {\r\n        return EMPTY;\r\n      }\r\n      // 1\r\n      // command\r\n      const { eventParam = null } = {\r\n        ...command\r\n      };\r\n      delete command.eventParam;\r\n      const commandToExecute = JSON.parse(JSON.stringify(command));\r\n      commandToExecute.params = this.paramsTransform(commandToExecute.params);\r\n      commandToExecute.params = this.parseService.parse(commandToExecute.params, this.frameContext, eventParam);\r\n      command.eventParam = eventParam;\r\n      commandToExecute.eventParam = eventParam;\r\n      this.transParamTypes(commandToExecute.params, commandToExecute.paramDescriptions);\r\n\r\n      // 2\r\n      const initContext = new CommandContext(commandToExecute, this.frameContext);\r\n      initContext.eventParam = command.eventParam || null;\r\n      const context$ = new BehaviorSubject<CommandContext>(initContext);\r\n      let currentTask = taskFlow.getNext('', initContext);\r\n      const highOrder$ = context$.pipe(\r\n        concatMap((context: CommandContext) => {\r\n          const result$ = currentTask.execute(context);\r\n          return result$.pipe(\r\n            take(1),\r\n            map((result: any) => {\r\n\r\n              // \r\n              context.results[currentTask.name] = result;\r\n              context.latestResult = result;\r\n              currentTask = taskFlow.getNext(currentTask.name, context);\r\n\r\n              // \r\n              if (currentTask) {\r\n                context$.next(context);\r\n              } else {\r\n                context$.complete();\r\n              }\r\n\r\n              // context\r\n              return context;\r\n            }),\r\n            throwIfEmpty(() => {\r\n              context$.complete();\r\n            })\r\n          );\r\n        })\r\n      );\r\n\r\n      // 3\r\n      highOrder$.pipe(\r\n        takeLast(1)\r\n      ).subscribe({\r\n        next: (context: CommandContext) => {\r\n          this.waitForDestroy(context);\r\n          lastTaskResult$.next(context.latestResult);\r\n        },\r\n        error: (error: any) => {\r\n          this.waitForDestroy(initContext);\r\n            this.displayError(error);\r\n          lastTaskResult$.error(error || '');\r\n        },\r\n        complete: () => {\r\n          this.waitForDestroy(initContext);\r\n          lastTaskResult$.complete();\r\n        },\r\n      });\r\n\r\n    }, 0);\r\n\r\n    return lastTaskResult$;\r\n  }\r\n  /**\r\n   * \r\n   * @param commandContext \r\n   */\r\n  private waitForDestroy(commandContext: CommandContext) {\r\n    if (!commandContext) {\r\n      return;\r\n    }\r\n    commandContext.clearResults();\r\n    if (this.frameContext && this.frameContext.appContext && this.frameContext.appContext.destorySignal) {\r\n      this.frameContext.appContext.destorySignal.pipe(takeUntil(this.destroy$)).subscribe(() => {\r\n        if (commandContext) {\r\n          commandContext.dispose();\r\n          commandContext = null;\r\n        }\r\n      });\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  private displayError(error: any) {\r\n    if (!error) {\r\n      return;\r\n    }\r\n    if (!console || !console.error) {\r\n      return;\r\n    }\r\n    console.error(error);\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  private paramsTransform(params: object) {\r\n    const exp = /\\{\\{(\\w+)\\}\\}/g;\r\n    if (!params) {\r\n      return null;\r\n    }\r\n    const translateService = this.frameContext && this.frameContext.injector && this.frameContext.injector.get<Translate>(TranslateToken, null) || null;\r\n    const pArray = Object.keys(params);\r\n    const result = {};\r\n    if (pArray.length === 0) {\r\n      return params;\r\n    }\r\n    pArray.forEach((p) => {\r\n      let ele = params[p];\r\n      if (ele && exp.test(ele) && translateService) {\r\n        ele = ele.replace(exp, ($1, $2) => {\r\n          return translateService.transform($2, null);\r\n        });\r\n      }\r\n      result[p] = ele;\r\n\r\n    });\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param name  \r\n   * @param func \r\n   */\r\n  protected addTask(name: string, func: TaskFunc) {\r\n    this.taskFlow.addNode(name, func);\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param name  \r\n   * @param func \r\n   */\r\n  protected addLink(from: string, to: string, condition: string | boolean) {\r\n    this.taskFlow.addLink(from, to, condition);\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param  name \r\n   * @param  func \r\n   */\r\n  public insertTask(target: string, name: string, func: TaskFunc) {\r\n    throw new Error('Not Implemented');\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param  name \r\n   * @param  func \r\n   */\r\n  public afterTask(target: string, name: string, func: TaskFunc) {\r\n    throw new Error('Not Implemented');\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param  name \r\n   * @param  func \r\n   */\r\n  public replaceTask(name: string, func: TaskFunc) {\r\n    throw new Error('Not Implement');\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public invoke(serviceInstance: any, method: string, args: any[], context: CommandContext) {\r\n    this.setContextToServiceInstance(serviceInstance, context);\r\n    const parsedArgs = this.parseService.parse(args, context, context.eventParam);\r\n    return serviceInstance[method](...parsedArgs);\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @todo\r\n   * \r\n   * 1context\r\n   * 2\r\n   * \r\n   * 1context\r\n   * 2CommandContextcontext\r\n   *    contextIContext\r\n   */\r\n  protected setContextToServiceInstance(serviceInstance: any, context: CommandContext) {\r\n\r\n    // contextCommandContext\r\n    const serviceContext = serviceInstance.context;\r\n    if (serviceContext && (serviceContext instanceof CommandContext === false)) {\r\n      return;\r\n    }\r\n\r\n    serviceInstance.context = context;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private transParamTypes(params: CommandParams, paramDescriptions: ParamDescriptions) {\r\n    if (!paramDescriptions) {\r\n      return;\r\n    }\r\n    const keys = Object.keys(params);\r\n    keys.forEach(key => {\r\n      if (!paramDescriptions[key] || !paramDescriptions[key].type) {\r\n        return;\r\n      }\r\n\r\n      const parType = paramDescriptions[key].type;\r\n      const value = params[key];\r\n      if (value === undefined || value === null || typeof value === parType) {\r\n        return; // \r\n      }\r\n\r\n      switch (parType) {\r\n        case 'string':\r\n          // string\r\n          params[key] = value + '';\r\n          break;\r\n        case 'int':\r\n        case 'double':\r\n        case 'number':\r\n          // numberintdouble\r\n          const numResult = Number(value);\r\n          if (isNaN(numResult)) {\r\n            throw Error(`${key}${value}${parType}`);\r\n          }\r\n          params[key] = numResult;\r\n          break;\r\n        case 'boolean':\r\n          let boolResult: boolean;\r\n          const strValue = (value + '').toLowerCase();\r\n          if (strValue === 'true') {\r\n            boolResult = true;\r\n          } else if (strValue === 'false') {\r\n            boolResult = false;\r\n          } else {\r\n            throw Error(`${key}${value}${parType}`);\r\n          }\r\n          params[key] = boolResult;\r\n          break;\r\n        case 'datetime':\r\n          // todo\r\n          break;\r\n        case 'object':\r\n          // \r\n          // todo: jsonobject\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n    });\r\n  }\r\n\r\n}\r\n\r\n/**\r\n * Token\r\n */\r\nconst COMMAND_HANDLERS_TOKEN = new InjectionToken<CommandHandler>('@Farris Command Handlers');\r\n\r\nexport { CommandHandler, COMMAND_HANDLERS_TOKEN };\r\n","/**\r\n * \r\n * @author Witt<jiwt@inspur.com>\r\n */\r\n\r\nimport { Injectable, Optional, Inject } from '@angular/core';\r\nimport { MetadataUtil } from '../metadata/index';\r\nimport { NG_COMMAND_HANDLER, NgCommandHandler } from './decorators';\r\nimport { COMMAND_HANDLERS_TOKEN, CommandHandler } from './command_handler';\r\n\r\n\r\n/**\r\n * \r\n */\r\n@Injectable()\r\nclass CommandHandlerRegistry {\r\n\r\n  /**\r\n   * CommandHandler Map\r\n   */\r\n  private handlerMap: Map<string, CommandHandler>;\r\n\r\n  /**\r\n   * \r\n   * @param handlers \r\n   */\r\n  constructor(@Optional() @Inject(COMMAND_HANDLERS_TOKEN)handlers: CommandHandler[]) {\r\n    const self = this;\r\n    this.handlerMap = new Map<string, CommandHandler>();\r\n    if (handlers) {\r\n      handlers.forEach((handler: CommandHandler) => {\r\n        self.regist(handler);\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param  commandName    \r\n   * @param  commandHandler \r\n   */\r\n  public set(commandName: string, commandHandler: CommandHandler) {\r\n    if (this.handlerMap.has(commandName)) {\r\n      throw new Error(commandName + 'CommandHandler');\r\n    }\r\n    this.handlerMap.set(commandName, commandHandler);\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param   commandName \r\n   * @returns \r\n   */\r\n  public get(commandName: string): CommandHandler {\r\n    if (this.handlerMap.has(commandName) === false) {\r\n      throw new Error('' + commandName + 'CommandHandler');\r\n    }\r\n    return this.handlerMap.get(commandName);\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param handlers \r\n   */\r\n  public regist(commandHandler: CommandHandler) {\r\n    let commandName = commandHandler.commandName;\r\n    if (!commandName) {\r\n      // metadataCommand\r\n      const handlerMetadata: NgCommandHandler =\r\n        MetadataUtil.getClassMetadataByName(commandHandler.constructor, NG_COMMAND_HANDLER);\r\n      if (!handlerMetadata) {\r\n        throw new Error('CommandHandler');\r\n      }\r\n      commandName = handlerMetadata.commandName;\r\n    }\r\n    this.set(commandName, commandHandler);\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  public dispose() {\r\n    if (this.handlerMap) {\r\n      this.handlerMap.forEach(handler => {\r\n        handler.dispose();\r\n      });\r\n    }\r\n    this.handlerMap.clear();\r\n  }\r\n\r\n}\r\n\r\nexport { CommandHandlerRegistry };\r\n","/**\r\n * \r\n * @author Witt<jiwt@inspur.com>\r\n */\r\n\r\nimport { Injectable, InjectionToken } from '@angular/core';\r\nimport { CommandHandler } from './command_handler';\r\n\r\n/**\r\n * \r\n *\r\n * CommandHandlerTaskTask\r\n * CommandHandlerExtender\r\n * \r\n *\r\n * ### \r\n *\r\n * ****\r\n *\r\n * \r\n * - CommandHandlerExtender\r\n * - extend\r\n * - NgCommandHandlerExtender\r\n *\r\n * ```ts\r\n * @Injectable()\r\n * @NgCommandHandlerExtender({\r\n *    commandName: 'formLoad'\r\n *  })\r\n * class FormLoadExtender extends CommandHandlerExtender {\r\n *\r\n *   extend(handler: CommandHandler): CommandHandler {\r\n *\r\n *     // \r\n *     handler.extendTask('loadData', (originalResult) => {\r\n *       console.log('do sth. to the original result');\r\n *     });\r\n *\r\n *     // \r\n *     handler.extendTask('transitState', () => {\r\n *       console.log('transit to other state');\r\n *     });\r\n *\r\n *     return handler;\r\n *   }\r\n * }\r\n * ```\r\n * extend\r\n * - extendTask\r\n * - replaceTask\r\n *\r\n * ****\r\n *\r\n * FormLoadHandlerExtenderCommandModule.setup\r\n * \r\n * ```ts\r\n * @NgModule({\r\n *   imports: [\r\n *     CommandModule.setup([FormLoadHandler], [FormLoadHandlerExtender])\r\n *   ]\r\n * })\r\n * class SimpleModule {}\r\n * ```\r\n */\r\n@Injectable()\r\nabstract class CommandHandlerExtender {\r\n\r\n  /**\r\n   * \r\n   * @param handler \r\n   */\r\n  abstract extend(handler: CommandHandler): CommandHandler;\r\n\r\n}\r\n\r\n\r\n/**\r\n * Token\r\n */\r\nconst COMMAND_HANDLER_EXTENDERS_TOKEN = new InjectionToken<CommandHandlerExtender>('@farris/devkit CommandHandler Extenders');\r\n\r\nexport { CommandHandlerExtender, COMMAND_HANDLER_EXTENDERS_TOKEN };\r\n","/**\r\n * \r\n * @author Witt<jiwt@inspur.com>\r\n */\r\n\r\nimport { Injectable, Optional, Inject } from '@angular/core';\r\nimport { MetadataUtil } from '../metadata/index';\r\nimport { NG_COMMAND_HANDLER_EXTENDER, NgCommandExtender } from './decorators';\r\nimport { COMMAND_HANDLER_EXTENDERS_TOKEN, CommandHandlerExtender } from './command_handler_extender';\r\nimport { IDisposable } from '../core';\r\n\r\n/**\r\n * \r\n */\r\n@Injectable()\r\nclass CommandHandlerExtenderRegistry implements IDisposable{\r\n\r\n  /**\r\n   * CommandHandlerExtenderMap\r\n   * - key\r\n   * - value\r\n   */\r\n  private extendersMap: Map<string, CommandHandlerExtender[]>;\r\n\r\n  /**\r\n   * \r\n   * @param extenders \r\n   */\r\n  constructor(@Optional() @Inject(COMMAND_HANDLER_EXTENDERS_TOKEN)extenders: CommandHandlerExtender[]) {\r\n    const self = this;\r\n    this.extendersMap = new Map<string, CommandHandlerExtender[]>();\r\n    if (extenders) {\r\n      extenders.forEach((extender: CommandHandlerExtender) => {\r\n        self.regist(extender);\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param   commandName \r\n   * @returns \r\n   */\r\n  get(commandName: string): CommandHandlerExtender[] {\r\n    if (this.extendersMap.has(commandName) === false) {\r\n      return [];\r\n    }\r\n    return this.extendersMap.get(commandName);\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param commandName Command\r\n   * @param extender    CommandHandlerExtender\r\n   * @return void\r\n   */\r\n  set(commandName: string, extender: CommandHandlerExtender) {\r\n    if (this.extendersMap.has(commandName)) {\r\n\r\n      // commandName\r\n      this.extendersMap.get(commandName).push(extender);\r\n    } else {\r\n\r\n      // \r\n      this.extendersMap.set(commandName, [extender]);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param extender CommandHandlerExtender\r\n   */\r\n  regist(extender: CommandHandlerExtender) {\r\n\r\n    // Comamnd\r\n    const extenderMetadata: NgCommandExtender =\r\n      MetadataUtil.getClassMetadataByName(extender.constructor, NG_COMMAND_HANDLER_EXTENDER);\r\n    if (!extenderMetadata) {\r\n      throw new Error('CommandHandlerExtender');\r\n    }\r\n    const commandName = extenderMetadata.commandName;\r\n\r\n    // Map\r\n    this.set(commandName, extender);\r\n  }\r\n  public dispose(){\r\n    this.extendersMap.clear();\r\n  }\r\n\r\n}\r\n\r\nexport { CommandHandlerExtenderRegistry };\r\n","import { makePropDecorator } from '../metadata/index';\r\n\r\n/**\r\n * NgComponentState\r\n */\r\nexport const NG_COMPONENT_STATE = 'NgParam';\r\n\r\n/**\r\n * NgComponentState\r\n */\r\nexport interface NgParam {\r\n\r\n  /**\r\n   * ID\r\n   */\r\n  componentId?: string;\r\n\r\n  /**\r\n   * \r\n   */\r\n  stateName?: string;\r\n  /**\r\n   * \r\n   */\r\n  originalDataType?: string;\r\n  /**\r\n   * locale|remote\r\n   */\r\n  category?: string;\r\n\r\n}\r\n\r\n/**\r\n * NgUIStateDecorator\r\n */\r\nexport interface NgParamDecorator {\r\n  (obj?: NgParam): any;\r\n  new(obj?: NgParam): any;\r\n}\r\n\r\n/**\r\n * NgUIState\r\n */\r\nexport const NgParam: NgParamDecorator =\r\n  makePropDecorator(NG_COMPONENT_STATE, (obj?: NgParam) => obj);\r\n\r\n\r\n","import { MetadataUtil } from '../metadata/index';\r\nimport { NG_COMPONENT_STATE, NgParam } from './decorators';\r\n\r\nexport class UIStateMetadataUtil {\r\n\r\n  /**\r\n   * NgUIState\r\n   * @param \r\n   * @returns \r\n   * @example\r\n   * \r\n   * {\r\n   *    '': <NgUIStateProperty>{ ...}\r\n   * }\r\n   */\r\n  static getUIFields(target: Function): {[propName: string]: NgParam} {\r\n      return MetadataUtil.getPropsMetadatasByName(target, NG_COMPONENT_STATE);\r\n  }\r\n}","/*\r\n * @Author: Witt\r\n * @Date: 2018-11-17 13:38:23\r\n * @Last Modified by: Witt\r\n * @Last Modified time: 2018-11-17 13:38:50\r\n * @todo\r\n */\r\n\r\nimport { Injectable } from '@angular/core';\r\nimport { Subject } from 'rxjs';\r\nimport { UIStateMetadataUtil } from './uistate_metadata_util';\r\nimport { NgParam } from './decorators';\r\n\r\nexport interface UIStateObservableParam {\r\n  field: string;\r\n  value: any;\r\n}\r\n/**\r\n * UI\r\n */\r\n@Injectable()\r\nexport class UIState {\r\n  /**\r\n   * @deprecated innerData\r\n   */\r\n  innerData: {};\r\n\r\n  // \r\n  public changes: Subject<UIStateObservableParam>;\r\n  public paramTypeTransform = false;\r\n  constructor() {\r\n    this.changes = new Subject<UIStateObservableParam>();\r\n    this.innerData = Object.assign({});\r\n    this._init();\r\n  }\r\n\r\n  _init() {\r\n    const uiFields = UIStateMetadataUtil.getUIFields(this.constructor);\r\n    this.initializeUIField(uiFields);\r\n  }\r\n\r\n  initialize(context: any) {\r\n    const uiFields = context.metadata.uiStates || UIStateMetadataUtil.getUIFields(this.constructor);\r\n    this.initializeUIField(uiFields);\r\n  }\r\n\r\n  private initializeUIField(uiFieldMetadata: { [key: string]: NgParam }): void {\r\n    Object.keys(uiFieldMetadata).forEach(propertyName => {\r\n      const fieldMetadata = uiFieldMetadata[propertyName] as NgParam;\r\n      const uiField = fieldMetadata.stateName || propertyName;\r\n\r\n      if (delete this[propertyName]) {\r\n        this.defineProperty(propertyName, uiField);\r\n      }\r\n    });\r\n  }\r\n\r\n  public isExistProperty(propertyName: any) {\r\n    if (this.innerData.hasOwnProperty(propertyName) || this.hasOwnProperty(propertyName)) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  private defineProperty(propertyName: any, field: any = null) {\r\n    Object.defineProperty(this, propertyName, {\r\n      get: function () {\r\n        return field !== null ? this.innerData[field] : this.innerData[propertyName];\r\n      },\r\n      set: function (value) {\r\n        // \r\n        const oldValue = field !== null ? this.innerData[field] : this.innerData[propertyName];\r\n        if (this.paramTypeTransform === true) {\r\n          const ngParams = UIStateMetadataUtil.getUIFields(this.constructor);\r\n          const ngParam = ngParams && ngParams[propertyName] || null;\r\n          const dataType = ngParam && ngParam.originalDataType || null;\r\n          if (dataType) {\r\n            value = this.transform(value, dataType);\r\n          }\r\n        }\r\n        if (oldValue === value) {\r\n          return;\r\n        }\r\n        if (field !== null) {\r\n          this.innerData[field] = value;\r\n        } else {\r\n          this.innerData[propertyName] = value;\r\n        }\r\n        this.changes.next({\r\n          field: propertyName,\r\n          value: value\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  public setPropertyValue(propertyName: any, value: any) {\r\n    if (propertyName === '' || propertyName === undefined) {\r\n      return;\r\n    }\r\n    if (!this.isExistProperty(propertyName)) {\r\n      this.defineProperty(propertyName);\r\n    }\r\n    this[propertyName] = value;\r\n  }\r\n  private transform(target: any, dataType: string) {\r\n    if (!dataType) {\r\n      return target;\r\n    }\r\n    dataType = dataType.toLowerCase();\r\n    if (dataType === 'string') {\r\n      if (target === null || target === undefined) {\r\n        return target;\r\n      }\r\n      return target.toString();\r\n    } else if (dataType === 'number') {\r\n      if (target === undefined) {\r\n        return undefined;\r\n      }\r\n      const result = Number(target);\r\n      if (isNaN(result)) {\r\n        throw new Error(`${target}`);\r\n      }\r\n      return result;\r\n    } else if (dataType === 'boolean') {\r\n      if (typeof target === 'boolean') {\r\n        return target;\r\n      } else {\r\n        if (target === null || target === undefined) {\r\n          return false;\r\n        }\r\n        target = target.toString().toLowerCase();\r\n        if (target === 'false') {\r\n          return false;\r\n        } else if (target === 'true') {\r\n          return true;\r\n        } else {\r\n          throw new Error(`${target}`);\r\n        }\r\n      }\r\n    } else if (dataType === 'date' || dataType === 'datetime') {\r\n      // \r\n      return target;\r\n    } else if (dataType === 'object') {\r\n      if (typeof target === 'object') {\r\n        return target;\r\n      } else {\r\n        try {\r\n          return JSON.parse(target);\r\n        } catch {\r\n          throw new Error(`${target}`);\r\n        }\r\n      }\r\n    } else {\r\n      return target;\r\n    }\r\n  }\r\n}\r\n","import { InjectionToken } from \"@angular/core\";\r\n/**\r\n * \r\n */\r\nexport const PARAM_TYPE_TRANSFORM_TOKEN = new InjectionToken<boolean>('@farris/devkit_param_type_transform');","import { ViewModel } from '../view-model/index';\r\nimport { StateMachineContext } from './context';\r\n\r\n/**\r\n * --------------------------------------------------------------------------------\r\n * State\r\n * --------------------------------------------------------------------------------\r\n */\r\n\r\n/**\r\n * StateRenderState\r\n */\r\nexport class State {\r\n\r\n  /**\r\n   * \r\n   * @param name \r\n   */\r\n  constructor(public name: string) {\r\n  }\r\n}\r\n\r\n/**\r\n * , \r\n * {\r\n *  stateName1: stateInstance1,\r\n *  stateName2: stateInstance2,\r\n *  ...\r\n * }\r\n */\r\nexport interface StateDictionary {\r\n    [index: string]: State;\r\n}\r\n\r\n\r\n/**\r\n * --------------------------------------------------------------------------------\r\n * RenderState\r\n * --------------------------------------------------------------------------------\r\n */\r\n\r\n/**\r\n * UI\r\n */\r\nexport type RenderState = boolean;\r\n\r\n/**\r\n * \r\n */\r\nexport const initialUIState: RenderState = false;\r\n\r\n/**\r\n * \r\n * {\r\n *  renderStateName1: true,\r\n *  renderStateName1: false,\r\n *  ...\r\n * }\r\n */\r\nexport interface RenderStateDictionary {\r\n  [index: string]: RenderState;\r\n}\r\n\r\n\r\n/**\r\n * \r\n * StateMachineContext\r\n * RenderState\r\n */\r\nexport type Render = (context: StateMachineContext) => RenderState;\r\n\r\n/**\r\n * \r\n * {\r\n *  renderStateName1: render1,\r\n *  renderStateName1: render2,\r\n *  ...\r\n * }\r\n */\r\nexport interface RenderDictionary {\r\n  [index: string]: Render;\r\n}\r\n\r\n\r\n/**\r\n * --------------------------------------------------------------------------------\r\n * Action\r\n * --------------------------------------------------------------------------------\r\n */\r\n\r\n/**\r\n * \r\n */\r\nexport type Action = () => any;\r\n\r\n/**\r\n * \r\n */\r\n// export interface Precondition {\r\n// }\r\n\r\n\r\n/**\r\n * --------------------------------------------------------------------------------\r\n * Effect\r\n * --------------------------------------------------------------------------------\r\n */\r\n\r\n/**\r\n * \r\n */\r\nexport interface EffectHandlerOption {\r\n\r\n  /**\r\n   * \r\n   */\r\n  type: string;\r\n\r\n  /**\r\n   * \r\n   */\r\n  effect: any;\r\n}\r\n\r\n/**\r\n * \r\n */\r\nexport interface Effect {\r\n\r\n  /**\r\n   * \r\n   */\r\n  preconditions?: any[];\r\n\r\n  /**\r\n   * \r\n   */\r\n  handlers?: EffectHandlerOption[];\r\n}\r\n\r\n/**\r\n * \r\n */\r\nexport interface EffectDictianry {\r\n    [index: string]: Effect;\r\n}\r\n\r\n\r\n","import { StateMachine } from './state_machine';\r\nimport { State } from './types';\r\nimport { Context } from '../context/context';\r\nimport { VariableParseService } from '../variable/index';\r\nimport { FrameContext } from '../frame/index';\r\nimport { StateMachineEvent } from './state_machine_event';\r\n\r\n/**\r\n * \r\n */\r\nexport class StateMachineContext {\r\n\r\n  /**\r\n   * \r\n   */\r\n  state: string;\r\n\r\n  parent: Context;\r\n\r\n  parser: VariableParseService;\r\n\r\n  frameContext: FrameContext;\r\n\r\n  stateMachineEvent: StateMachineEvent;\r\n  /**\r\n   * \r\n   * @param stateMachine \r\n   * @param initialState \r\n   */\r\n  constructor(public stateMachine: StateMachine) {\r\n    // this.state = initialState.name;\r\n  }\r\n\r\n  initialize(variableParseService: VariableParseService, initialState: State) {\r\n    this.frameContext = this.stateMachine && this.stateMachine.frameContext || null;\r\n    this.state = this.state || (initialState ? initialState.name : '');\r\n    this.parser = variableParseService;\r\n    this.stateMachineEvent = this.stateMachine.stateMachineEvent;\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param stateName \r\n   */\r\n  transitTo(stateName: string) {\r\n    const nextState = this.stateMachine.states[stateName];\r\n    if (nextState) {\r\n      this.state = nextState.name;\r\n      this.stateMachine.render();\r\n    }\r\n  }\r\n\r\n  parse(expression: string, targetType: 'source' | 'target'): any {\r\n    if (expression === null || expression === undefined) {\r\n      return expression;\r\n    }\r\n    const context = this.stateMachineEvent.getFrameContext(expression) || this.stateMachine.frameContext;\r\n    switch (targetType) {\r\n      case 'source':\r\n        return this.parseSourceValue(expression, context);\r\n      case 'target':\r\n        return this.parser.parse(expression, context);\r\n    }\r\n  }\r\n\r\n  private parseSourceValue(expression: string, context: any): any {\r\n    if (expression === null || expression === undefined) {\r\n      return expression;\r\n    }\r\n    let result = expression.trim();\r\n    result = this.parser.parse(result, context);\r\n    if (result === 'state') {\r\n      result = this.state;\r\n    }\r\n    return result;\r\n  }\r\n\r\n  // \r\n  get(expression: string): any {\r\n    return this.getUIState(expression);\r\n  }\r\n  // uistate\r\n  getUIState(expression: string): any {\r\n    if (!expression) {\r\n      return;\r\n    }\r\n    const frameContext = this.stateMachineEvent.getFrameContext(expression);\r\n    if (!frameContext) {\r\n      return;\r\n    }\r\n    this.stateMachineEvent.ListenUIStateChange(frameContext, expression);\r\n    if (this.parser) {\r\n      const value = this.parser.parse(expression, frameContext);\r\n      if (value === null) {\r\n        return null;\r\n      }\r\n      if (typeof value === 'object' && Object.keys(value).length === 0) {\r\n        return null;\r\n      }\r\n      return value;\r\n    } else {\r\n      throw new Error('');\r\n    }\r\n  }\r\n\r\n  // data\r\n  getData(expression: string): any {\r\n    if (!expression) {\r\n      return;\r\n    }\r\n    const frameContext = this.stateMachineEvent.getFrameContext(expression);\r\n    if (!frameContext) {\r\n      return;\r\n    }\r\n    this.stateMachineEvent.ListenEntityChange(frameContext, expression);\r\n    if (this.parser) {\r\n      const value = this.parser.parse(expression, frameContext);\r\n      if (value === null) {\r\n        return null;\r\n      }\r\n      if (typeof value === 'object' && Object.keys(value).length === 0) {\r\n        return null;\r\n      }\r\n      return value;\r\n    } else {\r\n      throw new Error('');\r\n    }\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { StateMachine } from './state_machine';\r\nimport { FrameContext } from '../frame/index';\r\nimport { Change } from '../binding-data/changes';\r\nimport { AppContext } from '../app';\r\n\r\n/**\r\n * uistateentity\r\n */\r\n@Injectable()\r\nexport class StateMachineEvent {\r\n\r\n  frameContext: FrameContext;\r\n\r\n  get appContext(): AppContext {\r\n    return this.stateMachine.appContext as AppContext;\r\n  }\r\n\r\n  uiFieldList: Array<string> = [];\r\n\r\n  frameContextMap: Map<FrameContext, Array<string>>;\r\n\r\n  dataFieldList: Array<string> = [];\r\n\r\n  dataFrameContextMap: Map<FrameContext, Array<string>>;\r\n\r\n  constructor(public stateMachine: StateMachine) {\r\n    this.frameContextMap = new Map<FrameContext, any>();\r\n    this.dataFrameContextMap = new Map<FrameContext, any>();\r\n  }\r\n\r\n  initialize(frameContext: FrameContext) {\r\n    this.frameContext = frameContext;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private extractPaths(expression: string): string {\r\n    let path = '';\r\n    const UI_STATE_PATTERN_G = /\\{UISTATE~(\\S+?)\\}$/g;\r\n    const DATA_PATTERN_G = /\\{DATA~(\\S+?)\\}$/g;\r\n    if (typeof expression === 'string') {\r\n      const uiStateVariables = expression.match(UI_STATE_PATTERN_G);\r\n      const dataVariables = expression.match(DATA_PATTERN_G);\r\n      if (uiStateVariables !== null) {\r\n        const UI_STATE_PATTERN = /\\{UISTATE~(\\S+?)\\}$/;\r\n        uiStateVariables.forEach((uiStateVariable: string) => {\r\n          const pathMatches = uiStateVariable.match(UI_STATE_PATTERN);\r\n          if (pathMatches != null && pathMatches.length === 2) {\r\n            path = pathMatches[1];\r\n          }\r\n        });\r\n      }\r\n      if (dataVariables !== null) {\r\n        const DATA_PATTERN = /\\{DATA~(\\S+?)\\}$/;\r\n        dataVariables.forEach((dataVariable: string) => {\r\n          const pathMatches = dataVariable.match(DATA_PATTERN);\r\n          if (pathMatches != null && pathMatches.length === 2) {\r\n            path = pathMatches[1];\r\n          }\r\n        });\r\n      }\r\n    }\r\n    return path;\r\n  }\r\n\r\n  // frameContext\r\n  getFrameContext(expression: any): FrameContext {\r\n    let frameId = this.extractPaths(expression).split('/')[1] || '';\r\n    if (frameId.startsWith('#{') && frameId.endsWith('}') && this.frameContext) {\r\n      const relativeFrameId = frameId.substring(2, frameId.length - 1);\r\n      frameId = this.frameContext.namespace ? `${this.frameContext.namespace}_${relativeFrameId}` : relativeFrameId;\r\n    }\r\n    return this.appContext.getFrameContext(frameId);\r\n  }\r\n\r\n  // (uistate)\r\n  getFrameField(expression: any) {\r\n    return this.extractPaths(expression).split('/')[2];\r\n  }\r\n\r\n  // \r\n  ListenUIStateChange(frameContext: FrameContext, expression: any) {\r\n    const frameField = this.getFrameField(expression);\r\n    if (!this.frameContextMap.has(frameContext)) {\r\n      this.frameContextMap.set(frameContext, this.uiFieldList);\r\n      frameContext.uiState.changes.subscribe((data) => {\r\n        if (data.field && this.frameContextMap.get(frameContext).indexOf(data.field) > -1) {\r\n          this.stateMachine.render();\r\n        }\r\n      });\r\n    }\r\n    if (this.frameContextMap.get(frameContext).indexOf(frameField) === -1) {\r\n      this.uiFieldList.push(frameField);\r\n    }\r\n  }\r\n\r\n\r\n  // \r\n  ListenEntityChange(frameContext: FrameContext, expression: any) {\r\n    if (!this.dataFrameContextMap.has(frameContext)) {\r\n      this.dataFrameContextMap.set(frameContext, this.dataFieldList);\r\n      frameContext.bindingData.changes.subscribe((change: Change) => {\r\n        // \r\n        if (change.type === 'Load' || change.type === 'SelectionChanged') {\r\n          this.stateMachine.render();\r\n        }\r\n        if (change.path.join() && this.isAccordingValue(this.dataFrameContextMap.get(frameContext), change.path.join('/'))) {\r\n          this.stateMachine.render();\r\n        }\r\n      });\r\n    }\r\n    if (this.dataFrameContextMap.get(frameContext).indexOf(expression) === -1) {\r\n      this.dataFieldList.push(expression);\r\n    }\r\n  }\r\n  // \r\n  isAccordingValue(arr: any, path: string) {\r\n    return arr.find(item => {\r\n      return item.indexOf(path) > -1;\r\n    }) === undefined ? false : true;\r\n  }\r\n}","import { BehaviorSubject } from 'rxjs';\r\nimport { MetadataUtil } from '../metadata/index';\r\nimport { StateMachineContext } from './context';\r\nimport { NgState, NgAction, NgRenderState } from './decorators';\r\nimport {\r\n  State, initialUIState, Effect, Render,\r\n  StateDictionary, RenderStateDictionary, RenderDictionary\r\n} from './types';\r\nimport { FrameContext } from '../frame/index';\r\nimport { StateMachineEvent } from './state_machine_event';\r\nimport { VariableParseService } from '../variable/variable_parse_service';\r\nimport { OnDestroy } from '@angular/core';\r\nimport { IDisposable } from '../core';\r\n\r\n/**\r\n * \r\n */\r\nexport interface StateMachineOption {\r\n\r\n  /**\r\n   * \r\n   */\r\n  renders?: { [index: string]: Render };\r\n\r\n  /**\r\n   * \r\n   */\r\n  states?: string[];\r\n\r\n  /**\r\n   * \r\n   */\r\n  effects?: { [index: string]: Effect };\r\n}\r\n\r\n/**\r\n * \r\n */\r\nexport const effectHandlers = {\r\n\r\n  /**\r\n   * \r\n   */\r\n  transit: {\r\n\r\n    /**\r\n     * \r\n     * @param stateMachine  \r\n     * @param stateName     \r\n     * @param preconditions \r\n     */\r\n    // tslint:disable-next-line: only-arrow-functions\r\n    perform: function (statemachine: StateMachine, stateName: string, preconditons: any[] = []) {\r\n      const nextState: State = statemachine.states[stateName];\r\n      statemachine.context.transitTo(nextState.name);\r\n      statemachine.render();\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * \r\n *\r\n * ### \r\n * \r\n * - State\r\n * - RenderState\r\n * - Action\r\n *\r\n * ### \r\n *\r\n * ****\r\n *\r\n * - StateMachineNgStatemachine\r\n * - \r\n *\r\n * ****\r\n *\r\n * - NgStatemachine\r\n * - NgStateinitialState\r\n * - NgRenderStaterender\r\n *   \r\n * - NgActiontransitTo\r\n *\r\n * ```ts\r\n * @Injectable()\r\n * @NgStatemachine()\r\n * class SimpleStateMachine extends StateMachine {\r\n *\r\n *   // \r\n *   @NgState({ initialState: true })\r\n *   viewState: State;\r\n *\r\n *   // \r\n *   @NgState()\r\n *   editState: State;\r\n *\r\n *   // \r\n *   @NgRenderState({\r\n *     render: (context) => context.state === 'viewState'\r\n *   })\r\n *   canEdit: RenderState;\r\n *\r\n *   // \r\n *   @NgRenderState({\r\n *     render: (context) => context.state === 'editState'\r\n *   })\r\n *   canSave: RenderState;\r\n *\r\n *   // \r\n *   @NgRenderState({\r\n *     render: (context) => context.state === 'editState'\r\n *   })\r\n *   canInput: RenderState;\r\n *\r\n *   // \r\n *   @NgAction({ transitTo: 'editState' })\r\n *   edit: Action;\r\n *\r\n *   // \r\n *   @NgAction({ transitTo: 'viewState' })\r\n *   view: Action;\r\n * }\r\n * ```\r\n * \r\n * - \r\n * - \r\n * - viewedit\r\n *\r\n *\r\n * ### \r\n *\r\n * \r\n *\r\n * ```html\r\n * <button type=\"button\" [disabled]=\"!viewModel.stateMachine.canEdit\"></button>\r\n * <button type=\"button\" [disabled]=\"!viewModel.stateMachine.canSave\"></button>\r\n * <input id=\"code\" [disabled]=\"!viewModel.stateMachine.canInput\" />\r\n * <input id=\"name\" [disabled]=\"!viewModel.stateMachine.canInput\" />\r\n * ```\r\n *\r\n * ### \r\n * \r\n * \r\n * CommandHandler\r\n * ```ts\r\n * @Injectable()\r\n * @NgCommandHandler({\r\n *   commandName: 'save'\r\n * })\r\n * class SaveHandler extends CommandHandler {\r\n *\r\n *   schedule() {\r\n *     this.addTask('save', () => {\r\n *       // \r\n *     });\r\n *\r\n *     // \r\n *     this.addTask('transitState', ) => {\r\n *       this.stateMachine['view']();\r\n *     });\r\n *   }\r\n * }\r\n * ```\r\n */\r\nexport class StateMachine implements OnDestroy, IDisposable {\r\n  private isStateInited = false;\r\n  /**\r\n   * \r\n   */\r\n  public initialState: State;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public states: StateDictionary;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public renderStates: RenderStateDictionary;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public renders: RenderDictionary;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public context: StateMachineContext;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public stateChange: BehaviorSubject<string>;\r\n\r\n  public appContext: any;\r\n\r\n  public frameContext: FrameContext;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public stateMachineEvent: StateMachineEvent;\r\n  /**\r\n   * \r\n   */\r\n  public metadatas: { states: { [stateName: string]: NgState }, renderStates: { [renderStateName: string]: NgRenderState }, actions: { [actionName: string]: NgAction } };\r\n  private isDisposed = false;\r\n  /**\r\n   * \r\n   */\r\n  constructor() {\r\n    const propsMetadatas = MetadataUtil.getPropsMetadatas(this.constructor);\r\n\r\n    // build\r\n    if (propsMetadatas) {\r\n      Object.keys(propsMetadatas).forEach((propName: string) => {\r\n        const propMetadatas = propsMetadatas[propName];\r\n        propMetadatas.forEach(propMetadata => {\r\n          this['build' + propMetadata.ngMetadataName](propName, propMetadata);\r\n        });\r\n      });\r\n    }\r\n\r\n    // if (!this.initialState) {\r\n    //   throw new Error('NgState');\r\n    // }\r\n\r\n    this.stateChange = new BehaviorSubject<any>(false);\r\n    this.context = new StateMachineContext(this);\r\n    this.stateMachineEvent = new StateMachineEvent(this);\r\n  }\r\n  public dispose(options?: any) {\r\n    this.isDisposed = true;\r\n    this.frameContext = null;\r\n    this.appContext = null;\r\n    this.context = null;\r\n    this.stateMachineEvent = null;\r\n    this.metadatas = null;\r\n  }\r\n  public ngOnDestroy(): void {\r\n    this.dispose();\r\n  }\r\n\r\n  // render\r\n  initialize(frameContext: FrameContext, variableParseService: VariableParseService) {\r\n    this.appContext = frameContext.appContext;\r\n    this.frameContext = frameContext;\r\n    const stateMachineMetadata = this.appContext.metadata.stateMachine || this.collectionMetadata();\r\n    this.metadatas = stateMachineMetadata;\r\n    this.buildStateMachine(stateMachineMetadata);\r\n    // if (!this.initialState) {\r\n    //   throw new Error('NgState');\r\n    // }\r\n    this.context.initialize(variableParseService, this.initialState);\r\n    this.stateMachineEvent.initialize(this.frameContext);\r\n    this.render();\r\n  }\r\n\r\n  private collectionMetadata(): {\r\n    states: { [stateName: string]: NgState },\r\n    renderStates: { [renderStateName: string]: NgRenderState },\r\n    actions: { [actionName: string]: NgAction }\r\n  } {\r\n    const stateMachineMetadata = {\r\n      states: {},\r\n      renderStates: {},\r\n      actions: {}\r\n    };\r\n    const propsMetadatas = MetadataUtil.getPropsMetadatas(this.constructor);\r\n    if (propsMetadatas) {\r\n      Object.keys(propsMetadatas).forEach((propName: string) => {\r\n        const propMetadatas = propsMetadatas[propName];\r\n        propMetadatas.forEach(propMetadata => {\r\n          switch (propMetadata.ngMetadataName) {\r\n            case 'NgState':\r\n              stateMachineMetadata.states[propName] = propMetadata;\r\n              break;\r\n            case 'NgRenderState':\r\n              stateMachineMetadata.renderStates[propName] = propMetadata;\r\n              break;\r\n            case 'NgAction':\r\n              stateMachineMetadata.actions[propName] = propMetadata;\r\n              break;\r\n          }\r\n        });\r\n      });\r\n    }\r\n    return stateMachineMetadata;\r\n  }\r\n\r\n  private buildStateMachine(metadata: {\r\n    states: { [stateName: string]: NgState },\r\n    renderStates: { [renderStateName: string]: NgRenderState },\r\n    actions: { [actionName: string]: NgAction }\r\n  }) {\r\n    Object.keys(metadata.states).forEach((stateName: string) => {\r\n      this.buildNgState(stateName, metadata.states[stateName]);\r\n    });\r\n\r\n    Object.keys(metadata.renderStates).forEach((renderStateName: string) => {\r\n      this.buildNgRenderState(renderStateName, metadata.renderStates[renderStateName]);\r\n    });\r\n\r\n    Object.keys(metadata.actions).forEach((actionName: string) => {\r\n      this.buildNgAction(actionName, metadata.actions[actionName]);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param stateName \r\n   * @param ngState   \r\n   */\r\n  private buildNgState(stateName: string, ngState: NgState) {\r\n    this.states = this.states || {};\r\n    this[stateName] = new State(stateName);\r\n    this.states[stateName] = this[stateName];\r\n    if (ngState.initialState) {\r\n      this.initialState = this[stateName];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param renderStateName \r\n   * @param ngRenderState   \r\n   */\r\n  private buildNgRenderState(renderStateName: string, ngRenderState: NgRenderState) {\r\n    this.renderStates = this.renderStates || {};\r\n    this[renderStateName] = initialUIState;\r\n    this.renderStates[renderStateName] = this[renderStateName];\r\n\r\n    // renderStaterenderrenders\r\n    this.renders = this.renders || {};\r\n    this.renders[renderStateName] = ngRenderState.render;\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param actionName \r\n   * @param ngAction   \r\n   */\r\n  private buildNgAction(actionName: string, ngAction: NgAction) {\r\n    this[actionName] = () => {\r\n      effectHandlers.transit.perform(this, ngAction.transitTo, ngAction.precondition);\r\n    };\r\n  }\r\n\r\n  /**\r\n   * \r\n   *  staterenderrenderState\r\n   */\r\n  render() {\r\n    if (this.isDisposed) {\r\n      return;\r\n    }\r\n    for (const renderStateName in this.renderStates) {\r\n      if (this.renderStates.hasOwnProperty(renderStateName) === false) {\r\n        continue;\r\n      }\r\n      const stateRender = this.renders[renderStateName];\r\n      if (!stateRender) {\r\n        continue;\r\n      }\r\n      // renderrenderState\r\n      this.renderStates[renderStateName] = stateRender(this.context);\r\n      this[renderStateName] = this.renderStates[renderStateName];\r\n    }\r\n    this.stateChange.next(this.context.state);\r\n  }\r\n}\r\n","import { TypeDecorator, makeDecorator, makePropDecorator } from '../metadata/index';\r\nimport { Render } from './types';\r\n\r\n\r\n/**\r\n * --------------------------------------------------------------------------------\r\n * NgStateDecorator\r\n * --------------------------------------------------------------------------------\r\n */\r\n\r\n/**\r\n * NgState\r\n */\r\nexport interface NgState {\r\n\r\n  /**\r\n   * \r\n   */\r\n  initialState?: boolean;\r\n  /**\r\n   * \r\n   */\r\n  name?: string;\r\n}\r\n\r\n/**\r\n * NgStateDecorator\r\n */\r\nexport interface NgStateDecorator {\r\n  (obj?: NgState): any;\r\n  new(obj?: NgState): any;\r\n}\r\n\r\n/**\r\n * NgState\r\n */\r\nexport const NgState: NgStateDecorator =\r\n  makePropDecorator('NgState', (obj?: NgState) => obj);\r\n\r\n\r\n/**\r\n * --------------------------------------------------------------------------------\r\n * NgRenderStateDecorator\r\n * --------------------------------------------------------------------------------\r\n */\r\n\r\n/**\r\n * NgRenderState\r\n */\r\nexport interface NgRenderState {\r\n  render: Render;\r\n}\r\n\r\n/**\r\n * NgRenderStateDecorator\r\n */\r\nexport interface NgRenderStateDecorator {\r\n  (obj?: NgRenderState): any;\r\n  new(obj?: NgRenderState): any;\r\n}\r\n\r\n/**\r\n * NgRenderState\r\n */\r\nexport const NgRenderState: NgRenderStateDecorator =\r\n  makePropDecorator('NgRenderState', (obj: NgRenderState) => obj);\r\n\r\n\r\n/**\r\n * --------------------------------------------------------------------------------\r\n * NgActionDecorator\r\n * --------------------------------------------------------------------------------\r\n */\r\n\r\n/**\r\n * NgAction\r\n */\r\nexport interface NgAction {\r\n  precondition?: any[];\r\n  transitTo: string;\r\n}\r\n\r\n/**\r\n* NgActionDecorator\r\n*/\r\nexport interface NgActionDecorator {\r\n  (obj?: NgAction): any;\r\n  new(obj?: NgAction): any;\r\n}\r\n\r\n/**\r\n * NgRenderStateDecorator\r\n */\r\nexport const NgAction: NgActionDecorator =\r\n  makePropDecorator('NgAction', (action: NgAction) => action);","import { makePropDecorator } from '../metadata/index';\r\nimport { CommandParams, ParamDescriptions,  } from '../command/index';\r\n\r\n/**\r\n * ----------------------------------------\r\n * NgCommand\r\n * ----------------------------------------\r\n */\r\n\r\n/**\r\n * \r\n */\r\nexport interface Keybinding {\r\n\treadonly ctrlKey: boolean;\r\n\treadonly shiftKey: boolean;\r\n\treadonly altKey: boolean;\r\n\treadonly metaKey?: boolean;\r\n\treadonly key: String;\r\n}\r\n\r\n/**\r\n * \r\n * @type {string}\r\n */\r\nexport const NG_COMMAND = 'NgCommand';\r\n\r\n/**\r\n * \r\n */\r\nexport interface NgCommand {\r\n\r\n  /**\r\n   * \r\n   */\r\n  name: string;\r\n\r\n  /**\r\n   * \r\n   */\r\n  params?: CommandParams;\r\n\r\n  /**\r\n   * id\r\n   * frameIdFrame\r\n   */\r\n  frameId?: string;\r\n\r\n  /**\r\n   * \r\n   */\r\n  paramDescriptions?: ParamDescriptions;\r\n\r\n  /**\r\n   * \r\n   */\r\n  keyBinding?: Keybinding\r\n}\r\n\r\n\r\n/**\r\n * \r\n */\r\nexport interface NgCommandDecorator {\r\n  (ngCommand?: NgCommand): any;\r\n  new(ngCommand?: NgCommand): any;\r\n}\r\n\r\n/**\r\n * \r\n * @type {any}\r\n */\r\nexport const NgCommand: NgCommandDecorator =\r\n  makePropDecorator(NG_COMMAND, (obj: NgCommand) => obj);\r\n","import { Injectable, Injector, OnDestroy } from '@angular/core';\r\nimport { MetadataUtil } from '../metadata/index';\r\nimport { Command } from '../command/index';\r\nimport { NG_COMMAND, NgCommand, Keybinding } from './decorators';\r\nimport { BindingData, EntityValueChange } from '../binding-data/index';\r\nimport { UIState } from '../ui-state/index';\r\nimport { Form } from '../form/index';\r\nimport { StateMachine } from '../state-machine/index';\r\nimport { FrameContext } from '../frame/index';\r\nimport { Observable, of, Subject, from, EMPTY } from 'rxjs';\r\nimport { map, concatMap, tap, every, debounceTime, switchMap, takeLast } from 'rxjs/operators';\r\nimport { ExpressionManager, ExpressionResult } from '../expression/index';\r\nimport { IContextMetadata } from '../app/app_metadata';\r\nimport { InvokeOnValueChange } from '../binding-data/types';\r\nimport { IDisposable } from '../core/index';\r\n\r\n/**\r\n * ViewModel\r\n *\r\n * ### ViewModel\r\n *\r\n * ViewModel\r\n *\r\n * 1ViewModelViewModel\r\n * 2NgViewModelSinmpleDemoBindingDataSimpleDemoForm\r\n *    SimpleDemoStateMachine\r\n * 3injectorViewModelinjectorNgViewModel\r\n *\r\n * ViewModel\r\n * ```ts\r\n * import { Injector, Injectable } from '@angular/core';\r\n * import { NgViewModel, ViewModel } from '@farris/devkit';\r\n *\r\n * @Injectable()\r\n * @NgViewModel({\r\n *   children: [],\r\n *   binding: SimpleDemoBindingData,\r\n *   form: SimpleDemoForm,\r\n *   stateMachine: SimpleDemoStateMachine,\r\n * })\r\n * class SimpleDemoViewModel extends ViewModel {\r\n *    constructor(injector: Injector) {\r\n *      super(injector);\r\n *    }\r\n *    @NgCommand({\r\n *      name: 'formLoad',\r\n *      params: {\r\n *        dataId: '1'\r\n *      }\r\n *    })\r\n *    public formLoad() {}\r\n * }\r\n * export { SimpleDemoViewModel };\r\n * ```\r\n *\r\n * ViewModel\r\n * ```ts\r\n * @Component({\r\n *   selector: 'app-simple-demo',\r\n *   templateUrl: './simple-demo.component.html'\r\n * })\r\n * class SimpleDemoComponent implements OnInit {\r\n *\r\n *   public viewModel: SimpleDemoViewModel;\r\n *\r\n *   constructor(viewModel: SimpleDemoViewModel) {\r\n *     this.viewModel = viewModel;\r\n *   }\r\n * }\r\n * ```\r\n *\r\n * ### ViewModel\r\n *\r\n * NgViewModel BindingDataFormStateMachine\r\n * ```html\r\n * * <!---->\r\n * <p>{{viewModel.bindingData.name}}</p>\r\n *\r\n * <!---->\r\n * <form [formGroup]=\"viewModel.form\">\r\n *   <input type=\"text\" formControlName=\"name\">\r\n * </form>\r\n *\r\n * <!---->\r\n * <button type=\"button\" [disabled]=\"!viewModel.stateMachine.canAdd\"> </button>\r\n * * ```\r\n *\r\n * viewModelNgCommand\r\n * ```html\r\n * <button type=\"button\" (click)=\"viewModel.add()\"> </button>\r\n * ```\r\n *\r\n * ### ViewModle\r\n *\r\n * ViewModelViewModel\r\n * ViewModelNgViewModelchildrenViewModel\r\n * ViewModelViewModel\r\n * \r\n * ```ts\r\n * @Injectable()\r\n *  @NgViewModel({\r\n *  children: [LeftListViewModel, RightCardViewModel],\r\n *    binding: NestedDemoBindingData,\r\n * })\r\n * class NestedDemoViewModel extends ViewModel {\r\n *   constructor(injector: Injector) {\r\n *     super(injector);\r\n *   }\r\n * }\r\n * export { NestedDemoViewModel };\r\n * ```\r\n */\r\n@Injectable()\r\nclass ViewModel implements IDisposable, OnDestroy {\r\n\r\n  public name: string;\r\n\r\n  public frameContext: FrameContext;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public bindingData: BindingData;\r\n\r\n  /**\r\n   * \r\n   * /()/edus/edus/grades\r\n   */\r\n  public bindingPath: string;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public uiState: UIState;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public form: Form;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public stateMachine: StateMachine;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public verifyInformations: any[] = [];\r\n\r\n  public verifycationChanged = new Subject<any[]>();\r\n  /**\r\n   * \r\n   */\r\n  public get expression(): ExpressionManager {\r\n    return this.frameContext.expressionManager;\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  public get expressionResult(): ExpressionResult {\r\n    return this.frameContext.expressionResult;\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  public keybindingMap: Map<string, Keybinding>;\r\n\r\n  /**\r\n   * \r\n   */\r\n  private entityValueChangingListeners: Map<string, string>;\r\n\r\n  /**\r\n   * \r\n   */\r\n  private entityValueChangedListeners: Map<string, string>;\r\n  /**\r\n   * \r\n   */\r\n  public metadatas: { [propName: string]: NgCommand };\r\n\r\n  /**\r\n   * kendogrid option\r\n   */\r\n\r\n  // constructor(metadata?: IContextMetadata) {\r\n  //   if (!this.bindingPath && metadata && metadata.bindingTo) {\r\n  //     this.bindingPath = metadata.bindingTo;\r\n  //   }\r\n  // }\r\n  constructor() { }\r\n  ngOnDestroy(): void {\r\n    this.dispose();\r\n  }\r\n\r\n  dispose(options?: any) {\r\n    // this.frameContext = null;\r\n    // this.bindingData = null;\r\n    // this.stateMachine = null;\r\n    this.form = null;\r\n    // this.uiState = null;\r\n\r\n    if (this.entityValueChangingListeners) {\r\n      this.entityValueChangingListeners.clear();\r\n    }\r\n    if (this.entityValueChangedListeners) {\r\n      this.entityValueChangedListeners.clear();\r\n    }\r\n    if (this.verifycationChanged) {\r\n      this.verifycationChanged.complete();\r\n      this.verifycationChanged = null;\r\n    }\r\n    }\r\n\r\n  public setMetadata(metadata: IContextMetadata) {\r\n    if (!this.bindingPath && metadata && metadata.bindingTo) {\r\n      this.bindingPath = metadata.bindingTo;\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  public init(context: FrameContext) {\r\n    if (!this.name) {\r\n      this.name = context.metadata.viewModelCode || this.constructor.name;\r\n    }\r\n    this.frameContext = context;\r\n    this.bindingData = context.bindingData;\r\n    this.uiState = context.uiState;\r\n    this.form = context.form;\r\n    this.stateMachine = context.stateMachine;\r\n    this.buildCommands(context);\r\n    this.entityValueChangingListeners = new Map<string, string>();\r\n    this.entityValueChangedListeners = new Map<string, string>();\r\n    // bindingData\r\n    if (this.bindingData) {\r\n      this.bindingData.setValueChangeInvokerFactory((paths: string[]): InvokeOnValueChange => {\r\n        return (preValue, value, entityChanged: boolean, primaryValue?: any): Observable<boolean> => {\r\n          const plainPath = '/' + paths.join('/');\r\n          let command: string;\r\n          if (entityChanged === false) {\r\n            command = this.entityValueChangingListeners[plainPath];\r\n          } else {\r\n            command = this.entityValueChangedListeners[plainPath];\r\n          }\r\n\r\n          if (!!command) {\r\n            const change: EntityValueChange = {\r\n              paths: paths,\r\n              preValue: preValue,\r\n              value: value,\r\n              id: primaryValue,\r\n              changed: entityChanged\r\n            };\r\n            const commands = command.split(';').filter(p => p);\r\n            let valueChangeSuccess = true;\r\n            return from(commands).pipe(\r\n              concatMap(item => {\r\n                if (!valueChangeSuccess) {\r\n                  return EMPTY;\r\n                }\r\n                return this[item](change).pipe(\r\n                  tap((result: any) => {\r\n                    valueChangeSuccess = result;\r\n                  })\r\n                );\r\n              }),\r\n              every((result: any) => result)\r\n            );\r\n            // return this[command](change).pipe(map(result => {\r\n            //   return result === false ? false : true;\r\n            // }));\r\n          } else {\r\n            return of(true);\r\n          }\r\n        };\r\n\r\n      });\r\n    }\r\n\r\n    this.initListeners();\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public buildCommands(context: FrameContext) {\r\n    const ngCommands: {\r\n      [commandName: string]: NgCommand\r\n    } = context.metadata.commands || MetadataUtil.getPropsMetadatasByName(this.constructor, NG_COMMAND);\r\n    this.metadatas = ngCommands;\r\n    this.keybindingMap = new Map<string, Keybinding>();\r\n    Object.keys(ngCommands).forEach((propertyName: string) => {\r\n      const ngCommand: NgCommand = ngCommands[propertyName];\r\n      // \r\n      if (ngCommand.keyBinding) {\r\n        this.keybindingMap.set(propertyName, ngCommand.keyBinding);\r\n      }\r\n      Object.defineProperty(this, propertyName, {\r\n        value: (data: any) => {\r\n          if (context.isDisposed) {\r\n            return EMPTY;\r\n          }\r\n          // \r\n          let targetContext = context;\r\n          if (ngCommand.frameId) {\r\n            targetContext = context.appContext.getFrameContext(ngCommand.frameId);\r\n          }\r\n          const command: Command = {\r\n            name: ngCommand.name,\r\n            params: ngCommand.params,\r\n            paramDescriptions: ngCommand.paramDescriptions,\r\n            eventParam: data || null\r\n          };\r\n          return targetContext.commandBus.dispatch(command);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Form\r\n   */\r\n  private initListeners() {\r\n    const extractPath = (bindingBasePath: string, bindingPath: string): string => {\r\n      return '/' + bindingBasePath.split('/').concat(bindingPath.split('.')).filter((item) => item.length > 0).join('/');\r\n    };\r\n\r\n    if (this.form) {\r\n      const valueChangingListeners = this.form.getEntityValueChangingListeners();\r\n      Object.keys(valueChangingListeners).forEach((bindingPath) => {\r\n        const plainPath = extractPath(this.bindingPath, bindingPath);\r\n        this.entityValueChangingListeners[plainPath] = valueChangingListeners[bindingPath];\r\n      });\r\n\r\n      const valueChangedListeners = this.form.getEntityValueChangedListeners();\r\n      Object.keys(valueChangedListeners).forEach((bindingPath) => {\r\n        const plainPath = extractPath(this.bindingPath, bindingPath);\r\n        this.entityValueChangedListeners[plainPath] = valueChangedListeners[bindingPath];\r\n      });\r\n    }\r\n  }\r\n\r\n  public bindToParent(parent: ViewModel) {\r\n    if (parent) {\r\n      if (parent.verifycationChanged) {\r\n        parent.verifycationChanged.subscribe(verifyInformations => {\r\n          if (this.verifycationChanged) {\r\n            this.verifycationChanged.next(verifyInformations);\r\n          }\r\n        });\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   * @param expression \r\n   * @returns \r\n   */\r\n  public transform(expression: string | boolean | Array<any>): any {\r\n    if (Array.isArray(expression)) {\r\n      const wfConf = expression.find(item => item && item.source === 'wf');\r\n      if (wfConf && wfConf.value) {\r\n        return this.transform(wfConf.value);\r\n      } else {\r\n        return this.transform(expression[0]);\r\n      }\r\n    } else {\r\n      if (typeof expression === 'boolean') {\r\n        return expression;\r\n      } else if (typeof expression === 'string') {\r\n        return new Function('ctx', `return ${expression}`).apply(this.frameContext, [this]);\r\n      } else {\r\n        // result\r\n        return expression;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport { ViewModel };\r\n","import { Injectable } from '@angular/core';\r\n\r\n@Injectable()\r\nclass Context {\r\n\r\n  /**\r\n   * \r\n   */\r\n  params: Map<string, any> = new Map<string, any>();\r\n\r\n  /**\r\n   * \r\n   */\r\n  getParam(key: string): any {\r\n    return this.params.get(key);\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  setParam(key: string, value: any) {\r\n    this.params.set(key, value);\r\n  }\r\n}\r\n\r\nexport { Context };\r\n","/*\r\n * @Author: Witt\r\n * @Date: 2018-12-29 10:46:01\r\n * @Last Modified by: Witt\r\n * @Last Modified time: 2018-12-30 17:56:02\r\n */\r\n\r\nimport { BindingData } from '../binding-data';\r\nimport { IDisposable } from '../core';\r\n\r\n/**\r\n * BindingData\r\n */\r\nclass BindingDataManager implements IDisposable {\r\n\r\n  /**\r\n   * BindingDataMap\r\n   */\r\n  private bindingDataMap: Map<string, BindingData>;\r\n\r\n  /**\r\n   * \r\n   */\r\n  constructor() {\r\n    this.bindingDataMap = new Map<string, BindingData>();\r\n  }\r\n\r\n  /**\r\n   * BindingDataMap\r\n   */\r\n  public getBindingDataMap(): Map<string, BindingData> {\r\n    return this.bindingDataMap;\r\n  }\r\n\r\n  /**\r\n   * nameBindingData\r\n   * @return undefined\r\n   */\r\n  public getBindingDataByName(name: string): BindingData {\r\n    return this.bindingDataMap.get(name);\r\n  }\r\n\r\n  /**\r\n   * BindingData\r\n   * @description bindingData\r\n   */\r\n  public regBindingData(name: string, bindingData: BindingData): void {\r\n    this.bindingDataMap.set(name, bindingData);\r\n  }\r\n  public unRegisteBindingData(name: string) {\r\n    this.bindingDataMap.delete(name);\r\n  }\r\n  /**\r\n   * Repository\r\n   */\r\n  public ifBindingDataExits(name: string) {\r\n    const bindingData = this.getBindingDataByName(name);\r\n    return bindingData ? true : false;\r\n  }\r\n  public dispose() {\r\n    this.bindingDataMap.clear();\r\n  }\r\n\r\n}\r\n\r\nexport { BindingDataManager };\r\n","/*\r\n * @Author: Witt\r\n * @Date: 2018-12-29 10:46:01\r\n * @Last Modified by: Witt\r\n * @Last Modified time: 2018-12-30 18:06:11\r\n */\r\n\r\nimport { Injectable, Inject, Optional } from '@angular/core';\r\nimport { Repository } from '../repository/index';\r\nimport { Entity } from '../entity/index';\r\nimport { IDisposable } from '../core';\r\n\r\n/**\r\n * Repository\r\n */\r\n@Injectable()\r\nclass RepositoryManager implements IDisposable {\r\n  /**\r\n   * repositoryMap\r\n   */\r\n  private repositoryMap: Map<string, Repository<Entity>>;\r\n\r\n  /**\r\n   * \r\n   */\r\n  constructor() {\r\n    this.repositoryMap = new Map<string, Repository<Entity>>();\r\n  }\r\n\r\n  /**\r\n   * Repository\r\n   */\r\n  public regRepository(name: string, repository: Repository<Entity>): void {\r\n    this.repositoryMap.set(name, repository);\r\n  }\r\n\r\n  public unRegisteRepository(name: string) {\r\n    this.repositoryMap.delete(name);\r\n  }\r\n  /**\r\n   * RepositoryMap\r\n   * @internal\r\n   */\r\n  public getRepositoryMap(): Map<string, Repository<Entity>> {\r\n    return this.repositoryMap;\r\n  }\r\n\r\n  /**\r\n   * Repository\r\n   */\r\n  public getRepositories(): Repository<Entity>[] {\r\n    return Array.from(this.repositoryMap.values());\r\n  }\r\n\r\n  /**\r\n   * nameRepository\r\n   */\r\n  public getRepositoryByName(name: string): Repository<Entity> {\r\n    return this.repositoryMap.get(name);\r\n  }\r\n\r\n  /**\r\n   * Repository\r\n   */\r\n  public ifRepositoryExits(name: string) {\r\n    const repository = this.getRepositoryByName(name);\r\n    return repository ? true : false;\r\n  }\r\n  public dispose() {\r\n    // this.repositoryMap.forEach((repo: Repository<any>) => {\r\n    //   if (repo) {\r\n    //     repo.entityCollection.reset(false);\r\n    //   }\r\n    // });\r\n    this.repositoryMap.clear();\r\n  }\r\n\r\n}\r\n\r\nexport { RepositoryManager };\r\n","import { IDisposable } from '../core';\r\nimport { FrameContext } from '../frame';\r\n\r\n/**\r\n * FrameComponent\r\n */\r\nclass FrameComponentRefresher implements IDisposable {\r\n  private frameComponentMap: Map<string, any>;\r\n\r\n  /**\r\n   * \r\n   */\r\n  constructor() {\r\n    this.frameComponentMap = new Map<string, any>();\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public refreshComponents() {\r\n    this.frameComponentMap.forEach((component: any, frameId: string) => {\r\n      if (typeof component['onFormLoad'] === 'function') {\r\n        component.onFormLoad();\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param frameId   FrameId\r\n   * @param component Frame\r\n   */\r\n  public regFrameComponent(frameId: string, component: any) {\r\n    this.frameComponentMap.set(frameId, component);\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  public unregFrameContext(frameContext: FrameContext): void {\r\n    const frameId = frameContext.frameId;\r\n    this.frameComponentMap.delete(frameId);\r\n  }\r\n  public dispose() {\r\n    this.frameComponentMap.clear();\r\n  }\r\n}\r\n\r\nexport { FrameComponentRefresher };\r\n","import { FrameContext } from '../frame/index';\r\nimport { FrameContextManager } from './frame_contex_manager';\r\n\r\n/**\r\n * \r\n */\r\nclass ChangeDetectionController {\r\n\r\n  /**\r\n   * FrameContext\r\n   */\r\n  private get frameContexts(): FrameContext[] {\r\n    return this.frameContextManager.getFrameContexts();\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  constructor(private frameContextManager: FrameContextManager) {\r\n  }\r\n\r\n  /**\r\n   * FrameComponent\r\n   * @todo\r\n   * 1\r\n   * 2setTimeoutsubscribe\r\n   * 3setTimeout\r\n   */\r\n  public reattach(): void {\r\n    setTimeout(() => {\r\n      this.frameContexts.forEach((frameContext: FrameContext) => {\r\n        frameContext.frameComponent.reattach();\r\n        frameContext.frameComponent.detectChanges();\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * FrameComponent\r\n   */\r\n  public detach(): void {\r\n    this.frameContexts.forEach((frameContext: FrameContext) => {\r\n      frameContext.frameComponent.detach();\r\n    });\r\n  }\r\n}\r\n\r\nexport { ChangeDetectionController };\r\n","import { AppContext } from './app_context';\r\n\r\n/**\r\n * The manager for all appContexts.\r\n * @summary\r\n * 1, The generator create unique frameId dynamically for each frameContext in the combination forms.\r\n * 2, Combined form and Host form visit each other by these unique frameIds.\r\n * 3, Now we make these forms has own appContext, they can't visit each other in old way.\r\n * 4, For compatible purpose, we collect all appContexts together and search frameContext in these appContexts by unque frameId.\r\n */\r\nclass AppContextManager {\r\n\r\n  /**\r\n   * AppContext Set\r\n   */\r\n  private appContextSet: Set<AppContext>;\r\n\r\n  /**\r\n   * constructor\r\n   */\r\n  constructor() {\r\n    this.appContextSet = new Set<AppContext>();\r\n  }\r\n\r\n  /**\r\n   * Register AppContext\r\n   */\r\n  public registerAppContext(appContext: AppContext): void {\r\n    this.appContextSet.add(appContext);\r\n  }\r\n\r\n  /**\r\n   * Unregister AppContext\r\n   */\r\n  public unregisterAppContext(appContext: AppContext): void {\r\n    this.appContextSet.delete(appContext);\r\n  }\r\n\r\n  /**\r\n   * Get an array of all AppContexts.\r\n   */\r\n  public getAppContexts(): AppContext[] {\r\n    return Array.from(this.appContextSet);\r\n  }\r\n\r\n}\r\n\r\nexport { AppContextManager };\r\n","import { AppContext } from './app_context';\r\n\r\nexport class ComponentManager {\r\n  constructor(private appContext: AppContext) { }\r\n  public get(paths: string[]) {\r\n    if (!Array.isArray(paths) || paths.length < 1) {\r\n      throw new Error('Argument error !');\r\n    }\r\n    if (!this.appContext || !this.appContext.componentRefs || this.appContext.componentRefs.size < 1) {\r\n      return null;\r\n    }\r\n    const componentRefs = this.appContext.componentRefs;\r\n    let component: any = componentRefs;\r\n    paths.forEach(path => {\r\n      component = component && component.get(path) || null;\r\n    });\r\n    return component;\r\n  }\r\n  /**\r\n   * frame\r\n   * @param frameId \r\n   * @returns \r\n   */\r\n  public getComponentsByFrameId(frameId: string): Map<string, any> | undefined {\r\n    if (!this.appContext || !this.appContext.componentRefs || this.appContext.componentRefs.size < 1) {\r\n      return null;\r\n    }\r\n    const componentRefs = this.appContext.componentRefs;\r\n    return componentRefs.get(frameId);\r\n  }\r\n}\r\n","import { InjectionToken } from '@angular/core';\r\n/**\r\n * Id\r\n */\r\nexport const FORM_ID = new InjectionToken<string>('@farris/devkit FORM_ID');\r\n\r\n","export class DomService {\r\n\r\n  constructor() { }\r\n\r\n  public getElementByBinding(contents: any[], bindingFieldId: string, parentElement): ElementByBindingResult[] {\r\n    const controls: ElementByBindingResult[] = [];\r\n    for (const element of contents) {\r\n      // \r\n      if (element.fields) { // \r\n        const childControls = this.getElementByBinding(element.fields, bindingFieldId, element);\r\n        controls.push(...childControls);\r\n      }\r\n      // \r\n      else if (element.contents) { // \r\n        const childControls = this.getElementByBinding(element.contents, bindingFieldId, element);\r\n        controls.push(...childControls);\r\n      }\r\n      // \r\n      else if (element.editor) {\r\n        const childControls = this.getElementByBinding([element.editor], bindingFieldId, element);\r\n        controls.push(...childControls);\r\n      }\r\n      // \r\n      else if (element.binding && element.binding.field === bindingFieldId) {\r\n        controls.push({\r\n          element: element,\r\n          parentElement: parentElement\r\n        });\r\n      }\r\n    }\r\n    return controls;\r\n  }\r\n}\r\n\r\ninterface ElementByBindingResult {\r\n  element: any;\r\n  parentElement: any;\r\n}","import { FormDeclaration } from './dom-entity';\r\nimport { Schema } from './schema';\r\n\r\nexport class FormContent {\r\n    Id: string;\r\n    Code: string;\r\n    Name: string;\r\n    Contents: {\r\n        module: FormModule,\r\n        options?: FormOptions\r\n    };\r\n}\r\n\r\nexport class FormContentForDB {\r\n    Id: string;\r\n    Code: string;\r\n    Name: string;\r\n    Contents: string;\r\n\r\n    constructor(content: FormContent) {\r\n        this.Id = content.Id;\r\n        this.Code = content.Code;\r\n        this.Name = content.Name;\r\n        this.Contents = JSON.stringify(content.Contents);\r\n    }\r\n}\r\n\r\nexport class FormMetadaDataDom {\r\n    module: FormModule;\r\n}\r\n\r\nexport class FormModule {\r\n    id: string;\r\n    code: string;\r\n    name: string;\r\n    caption: string;\r\n    type: string;\r\n    creator: string;\r\n    creationDate: Date;\r\n    updateVersion: string;\r\n    showTitle: boolean;\r\n    boostrap: string;\r\n    schemas: Array<Schema>;\r\n    states: Array<any>;\r\n    contents: Array<any>;\r\n    stateMachines: Array<any>;\r\n    viewmodels: Array<IFormViewModel>;\r\n    components: Array<any>;\r\n    webcmds: Array<any>;\r\n    serviceRefs: Array<any>;\r\n    ctrlLangs: any;\r\n\r\n    // \r\n    isMobileApprove: boolean;\r\n\r\n    // \r\n    isComposedFrm: boolean;\r\n\r\n    // \r\n    projectName: string;\r\n\r\n    // \r\n    extraImports: Array<{ name: string, path: string }>;\r\n\r\n    // \r\n    externalComponents: Array<any>;\r\n    // \r\n    declarations: FormDeclaration;\r\n    // \r\n    subscriptions: Array<any>;\r\n}\r\n\r\n// export class FormDeclaration {\r\n//     events: Array<any>;\r\n//     commands: Array<any>;\r\n//     states: Array<any>;\r\n// }\r\n\r\nexport class FormOptions {\r\n    enableTextArea: boolean;\r\n    enableDragAndDropToModifyLayout: boolean;\r\n}\r\n\r\nexport interface IFormViewModel {\r\n    id: string;\r\n    code: string;\r\n    name: string;\r\n    fields: IFormViewModelField[];\r\n    commands: any[];\r\n    serviceRefs: any[];\r\n    states: IFormViewModelUiState[];\r\n    bindTo: string;\r\n    parent: string;\r\n    pagination: any;\r\n    enableValidation: boolean;\r\n}\r\n\r\nexport interface IFormViewModelField {\r\n    type: string;\r\n    id: string;\r\n    fieldName: string;\r\n    bindingPath: string;\r\n    groupId: string;\r\n    groupName: string;\r\n    valueChanging: string;\r\n    valueChanged: string;\r\n    updateOn: 'change' | 'blur' | 'submit';\r\n}\r\n\r\n\r\nexport interface IStateMachine {\r\n    initialState: string;\r\n    renderState: { [renderStateName: string]: IRenderState };\r\n    state: IState[];\r\n    action: { [actionName: string]: IAction };\r\n}\r\n\r\nexport interface IRenderState {\r\n    name: string;\r\n    condition: IRenderStateCondition[];\r\n    description: string;\r\n}\r\n\r\nexport interface IRenderStateCondition {\r\n    compare: string;\r\n    lBracket: string;\r\n    rBracket: string;\r\n    relation: string;\r\n    source: string;\r\n    target: string;\r\n}\r\n\r\nexport interface IState {\r\n    state: string;\r\n    name: string;\r\n    description: string;\r\n}\r\n\r\nexport interface IAction {\r\n    name: string;\r\n    transitTo: string;\r\n    precondition: any[];\r\n    description: string;\r\n}\r\n\r\nexport interface IFormViewModelCommand {\r\n    id: string;\r\n    code: string;\r\n    name: string;\r\n    params: IFormViewModelCommandParam[];\r\n    handlerName: string;\r\n    cmpId: string;\r\n    shortcut: any;\r\n    extensions: any[]\r\n}\r\n\r\nexport interface IFormViewModelCommandParam {\r\n    name: string;\r\n    showName: string;\r\n    value: string;\r\n    description: string;\r\n}\r\n\r\nexport interface IFormViewModelUiState {\r\n    id: string;\r\n    category: string;\r\n    code: string;\r\n    name: string;\r\n    type: string;\r\n}\r\n\r\n","\r\nimport { IFormViewModel } from './form-metadata';\r\nimport { Schema, SchemaEntity, SchemaEntityField } from './schema';\r\n\r\nexport class SchemaService {\r\n\r\n    constructor() { }\r\n\r\n    /**\r\n     * \r\n     * @param fieldIds \r\n     * @param schema \r\n     * @param viewModel \r\n     * @returns Map\r\n     */\r\n    public getFieldsByIds(fieldIds: string[], schema: Schema, viewModel: IFormViewModel)\r\n        : Map<string, SchemaEntityField> {\r\n        const specifiedFieldsMap = new Map<string, SchemaEntityField>();\r\n        const entities = schema.entities;\r\n        if (entities && entities.length && viewModel) {\r\n            const entityPath = viewModel.bindTo;\r\n            const fields = this.getEntityFields(entities, entityPath);\r\n            const fieldsMap = this.flattenFields(fields);\r\n            fieldIds.forEach(fieldId => {\r\n                if (fieldsMap.has(fieldId)) {\r\n                    specifiedFieldsMap.set(fieldId, fieldsMap.get(fieldId));\r\n                }\r\n            });\r\n        }\r\n        return specifiedFieldsMap;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param fields \r\n     * @param fieldsMap Map\r\n     * @returns Map\r\n     */\r\n    private flattenFields(\r\n        fields: SchemaEntityField[],\r\n        fieldsMap: Map<string, SchemaEntityField> = new Map<string, SchemaEntityField>()\r\n    ): Map<string, SchemaEntityField> {\r\n        for (const field of fields) {\r\n            fieldsMap.set(field.id, field);\r\n            if (field.type && field.type.fields && field.type.fields.length > 0) {\r\n                this.flattenFields(field.type.fields, fieldsMap);\r\n            }\r\n        }\r\n        return fieldsMap;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param entities \r\n     * @param entityPath '/'\r\n     */\r\n    private getEntityFields(entities: SchemaEntity[], entityPath: string): SchemaEntityField[] {\r\n        if (entities && entities.length) {\r\n            const splitIndex = entityPath.indexOf('/');\r\n            if (splitIndex > -1) {\r\n                entityPath = entityPath.slice(splitIndex + 1, entityPath.length);\r\n            }\r\n            // \r\n            for (const entity of entities) {\r\n                if (entityPath === '' || entityPath === entity.code || entityPath === entity.label) {\r\n                    return entity.type.fields;\r\n                } else {\r\n                    const fields = this.getEntityFields(entity.type.entities, entityPath);\r\n                    if (fields && fields.length) {\r\n                        return fields;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return [];\r\n    }\r\n}\r\n","\r\nimport { CommandController, CommandHandler, CommandHandlerExtender, ControllerMethod, DynamicCommandHandler } from '../command';\r\nimport { ValidateRule } from '../entity';\r\nimport { NgFormControl, NgValidateForm } from '../form';\r\nimport { DomService, Schema, SchemaEntityField } from '../schema';\r\nimport {\r\n  IFormViewModel, IFormViewModelCommand, IFormViewModelCommandParam, IFormViewModelField,\r\n  IFormViewModelUiState, IRenderState, IStateMachine\r\n} from '../schema/form-metadata';\r\nimport { SchemaService } from '../schema/schema.service';\r\nimport { NgParam } from '../ui-state';\r\nimport { NgCommand } from '../view-model';\r\nimport { IContextMetadata, IContextStateMachineMetadata } from './app_metadata';\r\n\r\nexport class ContextMetadataBuilder {\r\n\r\n  constructor() {\r\n\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param formMetadataContent \r\n   * @param stateMachineMetadata \r\n   * @returns \r\n   */\r\n  public buildAppContextMetadata(formMetadataContent: any, stateMachineMetadata: IStateMachine): IContextMetadata {\r\n    const module = formMetadataContent.module;\r\n    const uiStates = module.states;\r\n    const appContextMetadata = {\r\n      identify: module.code,\r\n      namespace: '',\r\n      stateMachine: this.buildStataMachineMetadata(stateMachineMetadata),\r\n      uiStates: this.buildUiStateMetadata(uiStates)\r\n    };\r\n    return appContextMetadata;\r\n  }\r\n\r\n\r\n  /**\r\n   * \r\n   * @param componentId \r\n   * @param viewModel \r\n   * @param declarations \r\n   * @param subscriptions \r\n   * @returns \r\n   */\r\n  public buildViewContextMetadata(\r\n    component: any,\r\n    viewModel: IFormViewModel,\r\n    schema: Schema,\r\n    controllers: { [id: string]: CommandController },\r\n    dynamicOptions: any\r\n  ): IContextMetadata {\r\n    const contextMetadata = {\r\n      identify: component.id,\r\n      namespace: '',\r\n      commands: this.buildCommand(viewModel.commands),\r\n      commandHandlers: this.buildCommandHandlers(viewModel.commands, controllers),\r\n      commandHandlerExtends: [],\r\n      form: this.buildFormMetadata(viewModel),\r\n      formControls: this.buildFormControlMetadata(viewModel.fields, viewModel, schema, component, dynamicOptions),\r\n      subForms: null,\r\n      uiStates: this.buildUiStateMetadata(viewModel.states),\r\n      bindingTo: viewModel.bindTo,\r\n      viewModelCode: viewModel.code\r\n    };\r\n    return contextMetadata;\r\n  }\r\n\r\n  private buildCommand(commandMetadataArray: IFormViewModelCommand[]): { [commandName: string]: NgCommand } {\r\n    const commands = {};\r\n    commandMetadataArray.reduce<{ [commandName: string]: NgCommand }>((previousValue, commandMetadata: IFormViewModelCommand) => {\r\n      const ngCommand: NgCommand = {\r\n        name: commandMetadata.code,\r\n        params: {},\r\n        paramDescriptions: {}\r\n      };\r\n      commandMetadata.params.reduce<NgCommand>((previousCommand, param) => {\r\n        previousCommand.params[param.name] = param.value;\r\n        previousCommand.paramDescriptions[param.name] = { type: 'string' };\r\n        return previousCommand;\r\n      }, ngCommand);\r\n      previousValue[commandMetadata.code] = ngCommand;\r\n      return previousValue;\r\n    }, commands);\r\n    return commands;\r\n  }\r\n\r\n  private buildFormMetadata(viewModel: IFormViewModel): NgValidateForm {\r\n    return {\r\n      formGroupName: viewModel.name,\r\n      enableValidate: viewModel.enableValidation\r\n    };\r\n  }\r\n\r\n  private buildFormControlMetadata(formFields: IFormViewModelField[], viewModel: IFormViewModel, schema: Schema, component: any, dynamicOptions: any)\r\n    : { [controlName: string]: NgFormControl } {\r\n    const formControls: { [controlName: string]: NgFormControl } = {};\r\n    const formFieldIds = formFields.map(formField => formField.id);\r\n    const schemaService = new SchemaService();\r\n    const formFieldsMap = schemaService.getFieldsByIds(formFieldIds, schema, viewModel);\r\n    const domService = new DomService();\r\n\r\n    formFields.reduce<{ [controlName: string]: NgFormControl }>((previousValue, field) => {\r\n      const schemaEntityField: SchemaEntityField = formFieldsMap.has(field.id) ? formFieldsMap.get(field.id) : null;\r\n      const binding = schemaEntityField ? schemaEntityField.bindingPath : '';\r\n      const parentElement = {};\r\n      // parentElement  \r\n      const domElements = domService.getElementByBinding(component.contents, field.id, parentElement);\r\n      const validRules: ValidateRule[] = [];\r\n      let matchedElement;\r\n      let parentMatchedElement;\r\n      if (domElements && domElements.length >= 1) {\r\n        matchedElement = domElements[0].element;\r\n        parentMatchedElement = domElements[0].parentElement;\r\n        const keys = 'maxValue,minValue,required,require';\r\n        Object.keys(matchedElement).forEach(key => {\r\n          if (keys.includes(key)) {\r\n            if (key === 'maxValue' && (matchedElement[key] !== null && matchedElement[key] !== undefined)) {\r\n              // validRule\r\n              validRules.push({ type: 'maxValue', constraints: [matchedElement[key]] });\r\n            } else if (key === 'minValue' && (matchedElement[key] !== null && matchedElement[key] !== undefined)) {\r\n              // validRule\r\n              validRules.push({ type: 'minValue', constraints: [matchedElement[key]] });\r\n            } else if (key === 'required' || key === 'require') {\r\n              // validRule\r\n              // \r\n              if (matchedElement[key] === 'true' || matchedElement[key] === true) {\r\n                validRules.push({ type: 'required', constraints: [true] });\r\n              }\r\n            }\r\n          }\r\n        });\r\n      }\r\n      previousValue[field.fieldName] = {\r\n        /**  */\r\n        id: field.fieldName, //`${field.fieldName}_${field.id.substr(0, 13).replace('-', '_')}`,\r\n        /**  todo:  */\r\n        name: this.getTitle(matchedElement, parentMatchedElement, field.fieldName),\r\n        /**  */\r\n        binding,\r\n        /**  */\r\n        updateOn: field.updateOn,\r\n        /**  */\r\n        defaultI18nValue: this.getTitle(matchedElement, parentMatchedElement, field.fieldName),\r\n        valueChanging: field.valueChanging,\r\n        valueChanged: field.valueChanged,\r\n        valueConverter: this.generateConverter(schemaEntityField, dynamicOptions),\r\n        /**  */\r\n        validRules\r\n      };\r\n\r\n      return previousValue;\r\n    }, formControls);\r\n\r\n    return formControls;\r\n  }\r\n\r\n  /**\r\n   * title\r\n   * @param matchedElement \r\n   * @param defaultValue \r\n   * @returns \r\n   */\r\n  private getTitle(matchedElement, parentMatchedElement, defaultValue) {\r\n    if (!matchedElement) {\r\n      return defaultValue;\r\n    }\r\n    if (parentMatchedElement.type == 'GridField') {\r\n      return parentMatchedElement.caption || defaultValue;\r\n    }\r\n    return matchedElement.title || defaultValue;\r\n  }\r\n\r\n  /**\r\n   * converter\r\n   * @param field \r\n   * @returns \r\n   */\r\n  private generateConverter(field, dynamicOptions) {\r\n    const valueConverterMap = dynamicOptions[\"valueConverterMap\"];\r\n    if (!valueConverterMap) {\r\n      return;\r\n    }\r\n    if (field.type && (field.type.name == 'Date' || field.type.name == 'DateTime') && !field.converter) {\r\n      field.converter = valueConverterMap[\"Date\"];\r\n    }\r\n    if (field.multiLanguage && !field.converter) {\r\n      field.converter = valueConverterMap[\"MultiLang\"];\r\n    }\r\n\r\n    return field.converter;\r\n  }\r\n  /**\r\n   * \r\n   * @param stateMachineMetadata \r\n   * @returns \r\n   */\r\n  private buildStataMachineMetadata(stateMachineMetadata: IStateMachine): IContextStateMachineMetadata {\r\n    // \r\n    const stateMachine: IContextStateMachineMetadata = {\r\n      states: {},\r\n      renderStates: {},\r\n      actions: {}\r\n    };\r\n\r\n    if (!stateMachineMetadata) {\r\n      return stateMachine;\r\n    }\r\n\r\n    // NgState\r\n    stateMachineMetadata.state.reduce<IContextStateMachineMetadata>((previousValue, state) => {\r\n      previousValue.states[state.state] = {\r\n        initialState: state.state === stateMachineMetadata.initialState\r\n      };\r\n      return previousValue;\r\n    }, stateMachine);\r\n    // NgRenderState\r\n    Object.keys(stateMachineMetadata.renderState)\r\n      .reduce<IContextStateMachineMetadata>((previousValue, renderStateName) => {\r\n        const renderStateMetadata = stateMachineMetadata.renderState[renderStateName];\r\n        const renderFunction = this.buildRenderFunction(renderStateMetadata);\r\n        previousValue.renderStates[renderStateName] = {\r\n          render: renderFunction\r\n        };\r\n        // previousValue.renderStates[renderStateName] = {\r\n        //   render: (context: StateMachineContext) => {\r\n        //     return context.parser.parse(renderStateMetadata.condition, this);\r\n        //   }\r\n        // };\r\n        return previousValue;\r\n      }, stateMachine);\r\n    // NgAction\r\n    Object.keys(stateMachineMetadata.action)\r\n      .reduce<IContextStateMachineMetadata>((previousValue, actionName) => {\r\n        const actionMetadata = stateMachineMetadata.action[actionName];\r\n        previousValue.actions[actionName] = {\r\n          precondition: actionMetadata.precondition,\r\n          transitTo: actionMetadata.transitTo\r\n        };\r\n        return previousValue;\r\n      }, stateMachine);\r\n    // \r\n    return stateMachine;\r\n  }\r\n\r\n  private buildUiStateMetadata(states: IFormViewModelUiState[]): { [stateName: string]: NgParam } {\r\n    const uiStates: { [stateName: string]: NgParam } = {};\r\n    states.reduce<{ [stateName: string]: NgParam }>((previousValue, uiState) => {\r\n      previousValue[uiState.code] = {\r\n        stateName: uiState.code\r\n      };\r\n      return previousValue;\r\n    }, uiStates);\r\n    return uiStates;\r\n  }\r\n\r\n  private buildRenderFunction(renderStateMetadata: IRenderState): any {\r\n    if (renderStateMetadata && renderStateMetadata.condition.length) {\r\n      const renderFunctionString = renderStateMetadata.condition.reduce<string>((previousFunctionString, condition) => {\r\n        let conditionTarget = condition.target;\r\n        if (!conditionTarget.startsWith('\\'')) {\r\n          conditionTarget = `'${conditionTarget}`;\r\n        }\r\n        if (!conditionTarget.endsWith('\\'')) {\r\n          conditionTarget = `${conditionTarget}'`;\r\n        }\r\n        let conditionSource = condition.source;\r\n        if (conditionSource.indexOf('\\'') < 0) {\r\n          conditionSource = `'${conditionSource}'`;\r\n        }\r\n        if (conditionSource.indexOf('getUIState') > -1) {\r\n          conditionSource = conditionSource.replace('getUIState', 'context.getUIState');\r\n        }\r\n        if (conditionSource.indexOf('getData') > -1) {\r\n          conditionSource = conditionSource.replace('getData', 'context.getData');\r\n        }\r\n        // tslint:disable-next-line: max-line-length\r\n        let functionString = `${condition.lBracket || ''}context.parse(${conditionSource},'source')${condition.compare}${condition.target}${condition.rBracket || ''}`;\r\n        if (condition.relation) {\r\n          switch (condition.relation.trim().toLocaleLowerCase()) {\r\n            case 'or':\r\n              functionString += '||';\r\n              break;\r\n            case 'and':\r\n              functionString += '&&';\r\n              break;\r\n          }\r\n        }\r\n        return previousFunctionString + functionString;\r\n      }, '');\r\n      if (renderFunctionString) {\r\n        return new Function('context', `return ${renderFunctionString};`);\r\n      }\r\n    }\r\n    return new Function('context', 'return true;');\r\n  }\r\n\r\n  private buildCommandHandlers(commandMetadataArray: IFormViewModelCommand[], controllers: { [id: string]: CommandController })\r\n    : CommandHandler[] {\r\n    const commandHandlers: CommandHandler[] = [];\r\n    commandMetadataArray.reduce<CommandHandler[]>((previousValue: CommandHandler[], commandReference: IFormViewModelCommand) => {\r\n      const commandName = commandReference.code;\r\n      const controllerId = commandReference.cmpId;\r\n      const controller = controllers[controllerId];\r\n      const method = Object.assign({}, controller.methods[commandReference.handlerName]);\r\n      method.params = method.params && method.params.map(param => Object.assign({}, param));\r\n      if (method.params && method.params.length) {\r\n        commandReference.params.reduce<ControllerMethod>((previousMethodValue: ControllerMethod, param: IFormViewModelCommandParam) => {\r\n          const methodParam = previousMethodValue.params.find(value => value.name === param.name);\r\n          if (methodParam) {\r\n            methodParam.expression = param.value;\r\n          }\r\n          return previousMethodValue;\r\n        }, method);\r\n      }\r\n      const commandHandler = new DynamicCommandHandler(commandName, method);\r\n      previousValue.push(commandHandler);\r\n      return previousValue;\r\n    }, commandHandlers);\r\n    return commandHandlers;\r\n  }\r\n}\r\n","import { IDisposable } from '../core';\r\nimport { ViewModel } from '../view-model';\r\n\r\n/**\r\n * ViewModel\r\n */\r\nclass ViewModelManager implements IDisposable {\r\n  /**\r\n   * ViewModelMap\r\n   */\r\n  private viewModelMap: Map<string, ViewModel>;\r\n\r\n  /**\r\n   * \r\n   */\r\n  constructor() {\r\n    this.viewModelMap = new Map<string, ViewModel>();\r\n  }\r\n\r\n  /**\r\n   * ViewModelMap\r\n   */\r\n  public getViewModelMap(): Map<string, ViewModel> {\r\n    return this.viewModelMap;\r\n  }\r\n\r\n  /**\r\n   * nameViewModel\r\n   * @return undefined\r\n   */\r\n  public getViewModelByName(name: string): ViewModel {\r\n    return this.viewModelMap.get(name);\r\n  }\r\n\r\n  /**\r\n   * viewModel\r\n   */\r\n  public register(name: string, viewModel: ViewModel): void {\r\n    this.viewModelMap.set(name, viewModel);\r\n  }\r\n\r\n  /**\r\n   * Repository\r\n   */\r\n  public exsit(name: string) {\r\n    const viewModel = this.getViewModelByName(name);\r\n    return viewModel ? true : false;\r\n  }\r\n  public dispose() {\r\n    this.viewModelMap.clear();\r\n  }\r\n\r\n}\r\n\r\nexport { ViewModelManager };\r\n","import { IContextMetadata } from './app_metadata';\r\n\r\n/**\r\n * ContextMetadata\r\n */\r\nclass ContextMetadataManager {\r\n\r\n  /**\r\n   * ContextMetadataMap\r\n   */\r\n  private contextMetadataMap: Map<string, IContextMetadata>;\r\n\r\n  /**\r\n   * \r\n   */\r\n  constructor() {\r\n    this.contextMetadataMap = new Map<string, IContextMetadata>();\r\n  }\r\n\r\n  /**\r\n   * ContextMetadataMap\r\n   */\r\n  public getContextMetadataMap(): Map<string, IContextMetadata> {\r\n    return this.contextMetadataMap;\r\n  }\r\n\r\n  /**\r\n   * nameContextMetadata\r\n   * @return undefined\r\n   */\r\n  public getContextMetadataByName(name: string): IContextMetadata {\r\n    return this.contextMetadataMap.get(name);\r\n  }\r\n\r\n  /**\r\n   * ContextMetadata\r\n   */\r\n  public register(name: string, contextMetadata: IContextMetadata): void {\r\n    this.contextMetadataMap.set(name, contextMetadata);\r\n  }\r\n\r\n  /**\r\n   * ContextMetadata\r\n   */\r\n  public exsit(name: string) {\r\n    const contextMetadata = this.getContextMetadataByName(name);\r\n    return contextMetadata ? true : false;\r\n  }\r\n\r\n}\r\n\r\nexport { ContextMetadataManager };\r\n","import { InjectionToken } from '@angular/core';\r\nimport { FrameContext } from './frame_context';\r\nexport const FRAME_ID = new InjectionToken<string>('@farris/devkit FRAME_ID');\r\n/**\r\n * \r\n */\r\nexport const NAMESPACE = new InjectionToken<string>('@farris/devkit NAMESPACE');\r\n\r\n/**\r\n * \r\n */\r\nexport interface onFrameComponentInit {\r\n  onComponentInit(frameContext: FrameContext): void;\r\n}\r\n/**\r\n * \r\n */\r\nexport const FRAME_COMPONENT_INIT_HANDLER_TOKEN = new InjectionToken<onFrameComponentInit[]>('@farris/frame_component_init_handler_token');\r\n","/**\r\n * \r\n * @author Witt<jiwt@inspur.com>\r\n * @todo\r\n * 1parnetAppContextManager\r\n */\r\nimport { Injectable, Injector, Optional, SkipSelf, InjectFlags, OnDestroy } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\nimport { Context } from '../context/index';\r\nimport { BindingData, BindingDataFactory, BindingList, Change } from '../binding-data';\r\nimport { FrameContextManager } from './frame_contex_manager';\r\nimport { FrameComponentRefresher } from './frame_component_refresher';\r\nimport { RepositoryManager } from './repository_mananger';\r\nimport { BindingDataManager } from './binding_data_manager';\r\nimport { ChangeDetectionController } from './change_detection_controller';\r\nimport { AppContextManager } from './app_context_manager';\r\nimport { Subject } from 'rxjs';\r\nimport { ComponentManager } from './component_manager';\r\nimport { UID } from '../misc/uid';\r\nimport { FORM_ID } from './tokens';\r\nimport { ContextMetadataBuilder } from './app_metadata_collector';\r\nimport { FormModule, IFormViewModel, IStateMachine } from '../schema/form-metadata';\r\nimport { CommandController } from '../command';\r\nimport { StateMachine } from '../state-machine';\r\nimport { IContextMetadata } from './app_metadata';\r\nimport {\r\n  CommandVariableParser, DataVariableParser, FrameIdVariableParser,\r\n  StateMachineVariableParser, UIStateVariableParser, VariableParseService\r\n} from '../variable';\r\nimport { ViewModelManager } from './view_model_manager';\r\nimport { Repository } from '../repository';\r\nimport { Entity } from '../entity';\r\nimport { UIState } from '../ui-state';\r\nimport { Schema } from '../schema';\r\nimport { ContextMetadataManager } from './render_context_metadata_manager';\r\nimport { Form } from '../form';\r\nimport { ViewModel } from '../view-model';\r\nimport { FrameContext } from '../frame/frame_context';\r\nimport { NAMESPACE, FRAME_ID } from '../frame/tokens';\r\nimport { EventBus } from '../event-bus-new';\r\nimport { DEVKIT_RUN_MODE, RunMode } from '../core';\r\nimport { RunModeService } from '../misc/run_mode_service';\r\nimport { IDisposable } from '../core';\r\n\r\n@Injectable()\r\nclass AppContext extends Context implements OnDestroy, IDisposable {\r\n  public typeName = 'AppContext';\r\n  /**\r\n   * \r\n   */\r\n  public injector: Injector;\r\n  /**\r\n   * \r\n   */\r\n  public root: AppContext;\r\n  /**\r\n   * \r\n   */\r\n  public parent: AppContext;\r\n  /**\r\n   * \r\n   */\r\n  public appContextManager: AppContextManager;\r\n  /**\r\n   * FrameContext\r\n   */\r\n  public frameContextManager: FrameContextManager;\r\n  /**\r\n   * FrameComponent\r\n   */\r\n  public frameComponentRefresher: FrameComponentRefresher;\r\n  /**\r\n   * Repository\r\n   */\r\n  public repositoryManager: RepositoryManager;\r\n  /**\r\n   * \r\n   */\r\n  public bindingDataManager: BindingDataManager;\r\n  /**\r\n   * \r\n   */\r\n  public viewModelManager: ViewModelManager;\r\n\r\n  public contextMetadataManager: ContextMetadataManager;\r\n  /**\r\n   * \r\n   */\r\n  public changeDetectionController: ChangeDetectionController;\r\n  /**\r\n   * \r\n   */\r\n  public isFormDestoryed = false;\r\n  /**\r\n   * \r\n   */\r\n  public applicationId: string = null;\r\n\r\n  private token: string = null;\r\n  /**\r\n   * eventBus\r\n   * @memberof AppContext\r\n   */\r\n  public useIsoluteEventBus = false;\r\n\r\n  /**\r\n   * eventBus\r\n   *\r\n   * @type {EventBus}\r\n   * @memberof AppContext\r\n   */\r\n  public isoluteEventBus: EventBus;\r\n  /**\r\n   * FrameContextManagergetFrameContextMap\r\n   * @deprecated\r\n   * @summary\r\n   * private\r\n   */\r\n  private get frameContexts(): Map<string, any> {\r\n    return this.frameContextManager.getFrameContextMap();\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  public messagePipe: Subject<any>;\r\n  /**\r\n   * Id\r\n   */\r\n  public formId: string;\r\n  /**\r\n   * \r\n   */\r\n  public componentRefs: Map<string, Map<string, any>>;\r\n  /**\r\n   * \r\n   */\r\n  public componentManager: ComponentManager;\r\n  /**\r\n   * confirm\r\n   */\r\n  public opened: boolean;\r\n  /**\r\n   * \r\n   */\r\n  // public sortConditionManager: SortConditionManager;\r\n  /**\r\n   * \r\n   */\r\n  // public filterConditionManager: FilterConditionManager;\r\n\r\n  protected contextMetadataBuilder: ContextMetadataBuilder;\r\n  /**\r\n   * \r\n   */\r\n  public metadata: IContextMetadata = {};\r\n  /**\r\n   * \r\n   */\r\n  public uiState: UIState;\r\n  /**\r\n   * \r\n   */\r\n  public repository: Repository<Entity>;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public stateMachine: StateMachine;\r\n\r\n  public variableParseService: VariableParseService;\r\n\r\n  public namespace: string;\r\n\r\n  public router: Router;\r\n\r\n  public formMetadataContent: any;\r\n  /**\r\n   * compatible | highSpeed\r\n   */\r\n  public runMode: RunMode;\r\n\r\n  public get formModule(): FormModule {\r\n    return this.formMetadataContent ? this.formMetadataContent.module : null;\r\n  }\r\n\r\n  public controllers: { [id: string]: CommandController };\r\n\r\n  /**\r\n   * \r\n   */\r\n  public destorySignal: Subject<any>;\r\n  public disposed: boolean = false;\r\n\r\n  private dynamicOptions: any;\r\n\r\n  /**\r\n   * \r\n   */\r\n  constructor(\r\n    @Optional() injector: Injector,\r\n    @Optional() appContextManager: AppContextManager,\r\n    @Optional() @SkipSelf() parent: AppContext\r\n  ) {\r\n    super();\r\n    this.destorySignal = new Subject<any>();\r\n    this.injector = injector;\r\n    this.appContextManager = appContextManager;\r\n    this.formId = this.injector && this.injector.get(FORM_ID, null) || null;\r\n    // \r\n    this.runMode = this.injector && this.injector.get<RunMode>(DEVKIT_RUN_MODE, RunMode.compatible) || RunMode.compatible;\r\n    RunModeService.setRunMode(this.runMode);\r\n    this.params.set('formId', this.formId);\r\n    this.params.set('appId', this.ApplicationId);\r\n    this.params.set('token', this.Token);\r\n    // \r\n    if (!parent) {\r\n      this.parent = null;\r\n      this.root = this;\r\n    } else {\r\n      this.parent = parent;\r\n      this.root = parent.root;\r\n    }\r\n\r\n    this.registerToManager();\r\n\r\n    this.frameContextManager = new FrameContextManager(this);\r\n    this.frameComponentRefresher = new FrameComponentRefresher();\r\n    this.repositoryManager = new RepositoryManager();\r\n    this.bindingDataManager = new BindingDataManager();\r\n    this.changeDetectionController = new ChangeDetectionController(this.frameContextManager);\r\n    this.messagePipe = new Subject<any>();\r\n    this.componentRefs = new Map<string, Map<string, any>>();\r\n    this.componentManager = new ComponentManager(this);\r\n    this.contextMetadataManager = new ContextMetadataManager();\r\n\r\n    this.opened = false;\r\n    // this.sortConditionManager = new SortConditionManager();\r\n    // this.filterConditionManager = new FilterConditionManager();\r\n    this.router = this.injector && this.injector.get(Router);\r\n    this.viewModelManager = new ViewModelManager();\r\n    this.contextMetadataBuilder = new ContextMetadataBuilder();\r\n    this.variableParseService = new VariableParseService([\r\n      new FrameIdVariableParser(),\r\n      new DataVariableParser(),\r\n      new UIStateVariableParser(),\r\n      new StateMachineVariableParser(),\r\n      new CommandVariableParser()\r\n    ]);\r\n  }\r\n  dispose(options?: any) {\r\n    if (this.disposed) {\r\n      return;\r\n    }\r\n    this.isFormDestoryed = true;\r\n    this.disposed = true;\r\n    this.router = null;\r\n    this.unregisterFromManager();\r\n    this.componentRefs.clear();\r\n    if (this.stateMachine) {\r\n      this.stateMachine.dispose();\r\n      this.stateMachine = null;\r\n    }\r\n\r\n    this.frameComponentRefresher.dispose();\r\n    this.frameContextManager.dispose();\r\n    this.repositoryManager.dispose();\r\n    this.viewModelManager.dispose();\r\n    this.bindingDataManager.dispose();\r\n    if (this.messagePipe) {\r\n      this.messagePipe.complete();\r\n      this.messagePipe = null;\r\n    }\r\n    this.injector = null;\r\n    if (this.destorySignal) {\r\n      this.destorySignal.next();\r\n      this.destorySignal.complete();\r\n    }\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.dispose();\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param formMetadataContent \r\n   * @param stateMachineMetadata \r\n   * @param controllers \r\n   */\r\n  public initializeByMetadata(\r\n    formMetadataContent: any,\r\n    stateMachineMetadata: IStateMachine,\r\n    controllers: { [id: string]: CommandController },\r\n    options: {\r\n      valueConverterMap?: any\r\n    }\r\n  ) {\r\n    this.metadata = this.contextMetadataBuilder.buildAppContextMetadata(formMetadataContent, stateMachineMetadata);\r\n    if (!this.stateMachine) {\r\n      // \r\n      // this.stateMachine = this.injector.get(StateMachine, new StateMachine());\r\n      this.stateMachine = new StateMachine();\r\n    }\r\n    this.formMetadataContent = formMetadataContent;\r\n    this.controllers = controllers;\r\n    this.dynamicOptions = options;\r\n  }\r\n\r\n  /**\r\n   * Register current AppContext instance to AppContextManager\r\n   */\r\n  public registerToManager() {\r\n    if (!this.appContextManager) {\r\n      return;\r\n    }\r\n    this.appContextManager.registerAppContext(this);\r\n  }\r\n\r\n  /**\r\n   * Unregister current AppContext instance from AppContextManager\r\n   */\r\n  public unregisterFromManager() {\r\n    if (!this.appContextManager) {\r\n      return;\r\n    }\r\n    this.appContextManager.unregisterAppContext(this);\r\n  }\r\n\r\n  /**\r\n   * FrameContext\r\n   */\r\n  public regFrameContext(frameContext: any): void {\r\n    const repository = frameContext.repository;\r\n    const repositoryName = repository.name;\r\n\r\n    // Repository\r\n    if (this.repositoryManager.ifRepositoryExits(repositoryName) === false) {\r\n      this.repositoryManager.regRepository(repositoryName, repository);\r\n    }\r\n\r\n    // BindingData\r\n    if (this.bindingDataManager.ifBindingDataExits(repositoryName) === false) {\r\n      let bindingData = null;\r\n      // bindingDataManager\r\n      if (this.runMode === RunMode.highSpeed) {\r\n        bindingData = BindingDataFactory.createFromRepository(repository, '/');\r\n        this.bindingDataManager.regBindingData(repositoryName, bindingData);\r\n      }\r\n    }\r\n\r\n    // AppContextComponent\r\n    this.frameContextManager.regFrameContext(frameContext);\r\n  }\r\n\r\n  public regContextMetadata(componentId: string, contextMetadata: IContextMetadata) {\r\n    if (!this.contextMetadataManager.exsit(componentId)) {\r\n      this.contextMetadataManager.register(componentId, contextMetadata);\r\n    }\r\n  }\r\n  /**\r\n   * AppContext\r\n   */\r\n  public getFormAppContext() {\r\n    return this;\r\n  }\r\n  /**\r\n   * \r\n   * @todo: ,angular\r\n   */\r\n  public destory() {\r\n    this.dispose();\r\n  }\r\n  public get isDestoryed() {\r\n    return this.isFormDestoryed;\r\n  }\r\n  /**\r\n   * id\r\n   */\r\n  public get ApplicationId() {\r\n    if (!!this.applicationId) {\r\n      return this.applicationId;\r\n    }\r\n    this.applicationId = UID.create();\r\n    return this.applicationId;\r\n  }\r\n  public set ApplicationId(appId: string) {\r\n    this.applicationId = appId;\r\n  }\r\n  public get Token() {\r\n    if (!!this.token) {\r\n      return this.token;\r\n    }\r\n    this.token = UID.create();\r\n    return this.token;\r\n  }\r\n  public set Token(token: string) {\r\n    this.token = token;\r\n  }\r\n  // #region \r\n\r\n  /**\r\n   * FrameComponentRefresherrefreshComponent\r\n   * @deprecated\r\n   */\r\n  public registerCommandHandler(frameId: string, component: any) {\r\n    this.frameComponentRefresher.regFrameComponent(frameId, component);\r\n  }\r\n  /**\r\n   * FrameComponentRefresherrefreshComponent\r\n   * @deprecated\r\n   */\r\n  public refresh() {\r\n    this.frameComponentRefresher.refreshComponents();\r\n  }\r\n\r\n  /**\r\n   * FrameContextManagergetFrameContextById\r\n   * @deprecated\r\n   */\r\n  public getFrameContext(frameId: string): any {\r\n    return this.frameContextManager.getFrameContextById(frameId);\r\n  }\r\n\r\n  public getContextById(identify: string): any {\r\n    const context = this.frameContextManager.getFrameContextById(identify);\r\n    return context;\r\n  }\r\n\r\n  /**\r\n   * FrameContextManagergetFrameContextMap\r\n   * @deprecated\r\n   */\r\n  public getAllFrameContexts() {\r\n    return this.frameContextManager.getFrameContextMap();\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public handleSelectChange(change: Change, srcFrameContext: any) {\r\n    const force = change.force || false;\r\n    this.frameContexts.forEach((targetFrameContext) => {\r\n      // FrameCotnextRepository\r\n      if (targetFrameContext === srcFrameContext\r\n        || targetFrameContext.repository !== srcFrameContext.repository) {\r\n        return;\r\n      }\r\n\r\n      const bindingData = targetFrameContext.bindingData;\r\n      const bindingList: BindingList = bindingData.getValue(change.path);\r\n      const currentId = change.value['id'];\r\n      if (bindingList && bindingList.currentId !== currentId || force) {\r\n\r\n        // \r\n        bindingList.setCurrentId(currentId, true, false, force);\r\n      }\r\n    });\r\n  }\r\n\r\n  // #endregion\r\n\r\n  public buildRenderViewContext(componentId: string) {\r\n\r\n    // \r\n    const viewModels = this.formModule.viewmodels;\r\n    // \r\n    const viewComponents = this.formModule.components;\r\n    // schema\r\n    const schema = this.formModule.schemas[0];\r\n    // \r\n    const matchedComponent = viewComponents.find(component => component.id === componentId);\r\n    // \r\n    const matchedViewModel = viewModels.find(viewModel => matchedComponent.viewModel === viewModel.id);\r\n    // \r\n    const parentViewModel = viewModels.find(viewModel => viewModel.id === matchedViewModel.parent);\r\n    let parentComponentId = '';\r\n    // \r\n    if (parentViewModel) {\r\n      const parentComponent = viewComponents.find(component => component.viewModel === parentViewModel.id);\r\n      if (parentComponent) {\r\n        parentComponentId = parentComponent.id;\r\n      }\r\n    }\r\n    // \r\n    // const parentViewContext = parentComponentId ? this.getContextById(parentComponentId) : null;\r\n    // this.buildRenderViewContextRecursively(matchedViewModel, parentViewContext, schema);\r\n    this.buildRenderViewContextRecursively(matchedViewModel, schema);\r\n  }\r\n\r\n  private buildRenderViewContextRecursively(viewModel: IFormViewModel, schema: Schema) {\r\n    const controllers = this.controllers;\r\n    const viewComponents = this.formModule.components;\r\n    const matchedComponent = viewComponents.find(component => component.viewModel === viewModel.id);\r\n    const contextMetadata = this.contextMetadataBuilder.buildViewContextMetadata(matchedComponent, viewModel, schema, controllers,this.dynamicOptions);\r\n    // const commandHandlers: CommandHandler[] = this.buildCommandHandlers(viewModel.commands, controllers);\r\n    // const commandHandlerExtends: CommandHandlerExtender[] = [];\r\n    // const viewContext = new ViewComponentContext();\r\n    //   contextMetadata,\r\n    //   this,\r\n    //   parent,\r\n    //   this.injector\r\n    // );\r\n    // this.regFrameContext(viewContext);\r\n    // viewContext.init();\r\n\r\n    const contextMetadataId = (this.namespace ? (this.namespace + '_') : '') + matchedComponent.id;\r\n    contextMetadata.namespace = this.namespace || '';\r\n    this.regContextMetadata(contextMetadataId, contextMetadata);\r\n\r\n    const viewModels = this.formModule.viewmodels;\r\n    const subViewModels = viewModels.filter(subViewModel => subViewModel.parent === viewModel.id);\r\n    if (subViewModels && subViewModels.length) {\r\n      subViewModels.forEach(subViewModel => {\r\n        this.buildRenderViewContextRecursively(subViewModel, schema);\r\n      });\r\n    }\r\n  }\r\n\r\n  public getComponentProviders(componentId: string): any[] {\r\n    const contextMetadata = this.contextMetadataManager.getContextMetadataByName(componentId);\r\n    const bindingData = new BindingData();\r\n    const form = new Form();\r\n    const namespace = contextMetadata.namespace;\r\n    const repository = this.repository || this.injector.get(Repository, null);\r\n    const stateMachine = this.stateMachine;\r\n    const uiState = new UIState();\r\n    const viewModel = new ViewModel();\r\n    viewModel.setMetadata(contextMetadata);\r\n    return [\r\n      { provide: FRAME_ID, useValue: componentId },\r\n      { provide: NAMESPACE, useValue: namespace },\r\n      { provide: FrameContext, useClass: FrameContext },\r\n      { provide: AppContext, useValue: this },\r\n      { provide: BindingData, useValue: bindingData },\r\n      { provide: Form, useValue: form },\r\n      { provide: Repository, useValue: repository },\r\n      { provide: StateMachine, useValue: stateMachine },\r\n      { provide: UIState, useValue: uiState },\r\n      { provide: ViewModel, useValue: viewModel },\r\n      {\r\n        provide: VariableParseService, useValue: new VariableParseService([\r\n          new FrameIdVariableParser(),\r\n          new DataVariableParser(),\r\n          new UIStateVariableParser(),\r\n          new StateMachineVariableParser(),\r\n          new CommandVariableParser()\r\n        ])\r\n      }\r\n    ];\r\n  }\r\n}\r\n\r\nexport { AppContext };\r\n","/*\r\n * @Author: Witt\r\n * @Date: 2018-12-30 17:11:37\r\n * @Last Modified by: Witt\r\n * @Last Modified time: 2018-12-30 17:19:01\r\n */\r\n// tslint:disable: max-line-length\r\nimport { Injectable } from '@angular/core';\r\nimport { IDisposable, RunMode } from '../core';\r\nimport { FrameContext } from '../frame/index';\r\nimport { AppContext } from './app_context';\r\n\r\n/**\r\n * FrameContext\r\n */\r\n@Injectable()\r\nclass FrameContextManager implements IDisposable {\r\n\r\n  /**\r\n   * FrameContext()\r\n   */\r\n  private frameContextMap: Map<string, FrameContext>;\r\n\r\n  /**\r\n   * FrameContext\r\n   */\r\n  private frameContextSet: Set<FrameContext>;\r\n\r\n  /**\r\n   * AppContext\r\n   */\r\n  private appContext: AppContext;\r\n\r\n  /**\r\n   * \r\n   */\r\n  constructor(appContext: AppContext) {\r\n    this.frameContextMap = new Map<string, FrameContext>();\r\n    this.frameContextSet = new Set<FrameContext>();\r\n    this.appContext = appContext;\r\n  }\r\n\r\n  /**\r\n   * FrameContext\r\n   */\r\n  public regFrameContext(frameContext: FrameContext): void {\r\n    const frameId = frameContext.frameId;\r\n\r\n    // \r\n    if (this.frameContextMap.has(frameId) === true) {\r\n      const existedFrameContext = this.frameContextMap.get(frameId);\r\n      this.frameContextMap.delete(frameId);\r\n      this.frameContextSet.delete(existedFrameContext);\r\n    }\r\n    frameContext.index = this.frameContextSet.size;\r\n    this.frameContextMap.set(frameId, frameContext);\r\n    this.frameContextSet.add(frameContext);\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public unregFrameContext(frameContext: FrameContext): void {\r\n    const frameId = frameContext.frameId;\r\n    this.frameContextMap.delete(frameId);\r\n    this.frameContextSet.delete(frameContext);\r\n    // bindingDataManager\r\n    if (this.appContext.runMode === RunMode.highSpeed) {\r\n      const namespace = frameContext.namespace;\r\n      const repositoryName = frameContext.repository && frameContext.repository.name;\r\n      // nsframecontextbindingData\r\n      const frameContexts = this.getFrameContextsByNamespace(namespace);\r\n      if (!frameContexts || frameContexts.length < 1) {\r\n        this.appContext.bindingDataManager.unRegisteBindingData(repositoryName);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * FrameContextMap\r\n   */\r\n  public getFrameContextMap() {\r\n    return this.frameContextMap;\r\n  }\r\n\r\n  /**\r\n   * FrameContext\r\n   */\r\n  public getFrameContexts(): FrameContext[] {\r\n    return Array.from(this.frameContextSet);\r\n  }\r\n  /**\r\n   * frameContext\r\n   * @param namespace \r\n   */\r\n  public getFrameContextsByNamespace(namespace: string) {\r\n    return Array.from(this.frameContextSet).filter((frameContext: FrameContext) => frameContext && frameContext.namespace === namespace);\r\n  }\r\n  /**\r\n   * idFrameContext\r\n   */\r\n  public getFrameContextById(frameId: string): FrameContext {\r\n    const targetFrameContext = this.frameContextMap.get(frameId);\r\n    if (targetFrameContext) {\r\n      return targetFrameContext;\r\n    }\r\n    return this.getFrameContextFromAllAppContexts(frameId);\r\n  }\r\n\r\n  /**\r\n   * Get the root FrameContext instance\r\n   * @return Return the FrameContext instance whose parent is null, and undefined otherwise.\r\n   */\r\n  public getRootFrameContext(): FrameContext {\r\n    const frameContexts = this.getFrameContexts();\r\n    const rootFrameContext = frameContexts.find((frameContext: FrameContext) => {\r\n      return frameContext.parent === null;\r\n    });\r\n    return rootFrameContext;\r\n  }\r\n  public dispose() {\r\n    this.frameContextMap.clear();\r\n    this.frameContextSet.clear();\r\n  }\r\n  /**\r\n   * AppContext\r\n   * @summary\r\n   * 1frameId\r\n   * 2AppContxtAppContextAppContext\r\n   * 3\r\n   */\r\n  private getFrameContextFromAllAppContexts(frameId: string): FrameContext {\r\n    if (!this.appContext.appContextManager) {\r\n      return;\r\n    }\r\n    let targetFrameContext: FrameContext;\r\n    const appContexts = this.appContext.appContextManager.getAppContexts();\r\n    appContexts.some((appContext: AppContext) => {\r\n      const frameContextMap = appContext.frameContextManager.getFrameContextMap();\r\n      if (frameContextMap.has(frameId) === true) {\r\n        targetFrameContext = frameContextMap.get(frameId);\r\n        return true;\r\n      } else {\r\n        return false;\r\n      }\r\n    });\r\n    return targetFrameContext;\r\n  }\r\n}\r\n\r\nexport { FrameContextManager };\r\n","import { IEmitable } from './types';\r\nimport { Type } from '@angular/core';\r\n\r\nexport class EventBusProxy {\r\n\r\n  constructor(private eventBus: IEmitable, private hostType: Type<any>, private eventTokenValueProvider: () => any) {\r\n  }\r\n\r\n  post(eventName: string, data: any) {\r\n    this.eventBus.post(this.hostType, this.eventTokenValueProvider(), eventName, data);\r\n  }\r\n\r\n  // on(eventName: string, data: any, handler: Function) {\r\n  //   this.eventBus.on(null, this.eventTokenValueProvider(), eventName, (data) => handler(data), this);\r\n  // }\r\n}\r\n\r\n","export enum EventTypeEnum {\r\n    COMPONENT,\r\n    ROUTE\r\n}\r\n","import { makePropDecorator } from '../../metadata/index';\r\nimport { EventTypeEnum } from './event-type';\r\n\r\nexport const NG_DECLARATION = 'NgDeclaration';\r\n\r\n/**\r\n * NgDeclaration\r\n * \r\n */\r\nexport interface NgDeclaration {\r\n    /**\r\n     * Token, ID\r\n     */\r\n    token: string;\r\n\r\n    /**\r\n     * \r\n     */\r\n    name: string;\r\n\r\n    /**\r\n     * \r\n     */\r\n    params: any;\r\n\r\n    /**\r\n     * \r\n     */\r\n    type ?: EventTypeEnum;\r\n}\r\n\r\n// /**\r\n//  * \r\n//  */\r\n// export interface Params {\r\n//     [key: string]: any;\r\n// }\r\n\r\n/**\r\n * NgDeclarationDecorator\r\n * \r\n */\r\nexport interface NgDeclarationDecorator {\r\n    (obj?: NgDeclaration): any;\r\n    new(obj?: NgDeclaration): any;\r\n}\r\n\r\n/**\r\n * NgDeclaration\r\n * \r\n */\r\nexport function NgDeclaration(options: NgDeclaration) {\r\n    const decoratorFactory = makePropDecorator(NG_DECLARATION, (obj: NgDeclaration) => obj);\r\n    return decoratorFactory(options);\r\n}\r\n","import { Injectable, Injector } from '@angular/core';\r\nimport { MetadataUtil } from '../../metadata/index';\r\nimport { FrameContext, FrameComponent } from '../../frame';\r\nimport { NG_DECLARATION, NgDeclaration } from './declaration_decorator';\r\nimport { VariableParseService } from '../../variable/index';\r\nimport { EventTypeEnum } from './event-type';\r\n\r\n@Injectable()\r\nclass Declaration {\r\n\r\n  constructor() {\r\n\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public init(frameComponent: FrameComponent) {\r\n    if (!frameComponent) {\r\n      return;\r\n    }\r\n\r\n    this.bindDeclaration(frameComponent, null);\r\n  }\r\n\r\n  /**\r\n   *  \r\n   * @param frameComponent component\r\n   * @param ngDeclarations \r\n   */\r\n  public initWithDeclarations(frameComponent: FrameComponent, ngDeclarations: {\r\n    [propName: string]: any;\r\n  }): void {\r\n    if (!frameComponent) {\r\n      return;\r\n    }\r\n\r\n    this.bindDeclaration(frameComponent, null);\r\n  }\r\n\r\n  /**\r\n   * \r\n   *  \r\n   * @param context \r\n   */\r\n  public bindDeclaration(frameComponent: FrameComponent, ngDeclarations: {\r\n    [propName: string]: any;\r\n  }) {\r\n    const context = frameComponent.context;\r\n    if (!context) {\r\n      return;\r\n    }\r\n\r\n    const ngPublicEventProps = ngDeclarations ? ngDeclarations : this.getNgPublicEvent();\r\n    if (!ngPublicEventProps) {\r\n      return;\r\n    }\r\n\r\n    Object.keys(ngPublicEventProps).forEach((propertyName: string) => {\r\n      const ngExportEvent: NgDeclaration = ngPublicEventProps[propertyName];\r\n      Object.defineProperty(this, propertyName, {\r\n        value: () => {\r\n          // \r\n          const targetContext: FrameContext = context;\r\n          // todo: ngExportEventframeId\r\n          // if (ngExportEvent.frameId) {\r\n          //   targetContext = context.appContext.getFrameContext(ngExportEvent.frameId);\r\n          // }\r\n          const root = targetContext.root;\r\n          const emitter = ngExportEvent.token;\r\n          const tokenValue = ngExportEvent.token;\r\n          const eventName = ngExportEvent.name;\r\n          let eventArgs = JSON.parse(JSON.stringify(ngExportEvent.params));\r\n          const eventType = ngExportEvent.type;\r\n          const eventBus = targetContext.eventBus || root.eventBus;\r\n          if (!eventBus) {\r\n            return;\r\n          }\r\n          const injector = targetContext.injector || root.injector;\r\n          const variableParseService = injector.get<VariableParseService>(VariableParseService);\r\n\r\n          // \r\n          setTimeout(() => {\r\n            eventArgs = variableParseService.parse(eventArgs, targetContext);\r\n            const eventSender = targetContext.frameComponent;\r\n            let currentContext = targetContext;\r\n            const eventId = new Date().valueOf();\r\n            if (eventType && eventType === EventTypeEnum.ROUTE) {\r\n              // \r\n              while (currentContext) {\r\n                currentContext.eventBus.post(emitter, tokenValue, eventName, eventArgs, eventSender, eventType, eventId);\r\n                // currentContext = currentContext.parent;\r\n                currentContext = this.getParentContext(currentContext);\r\n              }\r\n            } else {\r\n              eventBus.post(emitter, tokenValue, eventName, eventArgs, eventSender);\r\n            }\r\n          }, 0);\r\n        }\r\n      });\r\n    });\r\n\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @returns  \r\n   */\r\n  public getNgPublicEvent() {\r\n    return MetadataUtil.getPropsMetadatasByName(this.constructor, NG_DECLARATION);\r\n  }\r\n\r\n  /**\r\n   * Context\r\n   * @param context \r\n   */\r\n  private getParentContext(context: FrameContext): FrameContext {\r\n\r\n    // FrameContext\r\n    if (context.parent) {\r\n      return context.parent;\r\n    }\r\n\r\n    // AppContextAppContextFrameContext\r\n    const parentAppContext = context.appContext.parent;\r\n    if (parentAppContext) {\r\n      return parentAppContext.frameContextManager.getRootFrameContext();\r\n    }\r\n\r\n    return null;\r\n  }\r\n}\r\n\r\nexport { Declaration };\r\n","import { makePropDecorator } from '../../metadata/index';\r\n\r\nexport const NG_SUBSCRIPTION = 'NgSubscription';\r\n\r\n/**\r\n * NgSubscription\r\n * \r\n */\r\nexport interface NgSubscription {\r\n    /**\r\n     * Token, ID\r\n     */\r\n    token: string;\r\n\r\n    /**\r\n     * \r\n     */\r\n    name: string;\r\n\r\n    /**\r\n     * \r\n     */\r\n    paramMapCollection?: ParamMap[];\r\n}\r\n\r\nexport class ParamMap {\r\n    from: string;\r\n    frameId: string;\r\n    to: string;\r\n}\r\n\r\n/**\r\n * NgSubscriptionDecorator\r\n * \r\n */\r\nexport interface NgSubscriptionDecorator {\r\n    (obj?: NgSubscription): any;\r\n    new(obj?: NgSubscription): any;\r\n}\r\n\r\n/**\r\n * NgSubscription\r\n * \r\n */\r\nexport function NgSubscription(options: NgSubscription) {\r\n    const decoratorFactory = makePropDecorator(NG_SUBSCRIPTION, (obj: NgSubscription) => obj);\r\n    return decoratorFactory(options);\r\n}\r\n\r\nexport function getNgSubscriptionDecoratorFactory() {\r\n    const decoratorFactory = makePropDecorator(NG_SUBSCRIPTION, (obj: NgSubscription) => obj);\r\n    return decoratorFactory;\r\n}\r\n","export enum EventPipeType {\r\n    Compile,\r\n    Parsing\r\n}","import { Injectable, Injector } from '@angular/core';\r\nimport { MetadataUtil } from '../../metadata/index';\r\nimport { FrameContext, FrameComponent } from '../../frame/index';\r\nimport { UIState } from '../../ui-state/index';\r\nimport { NG_SUBSCRIPTION, NgSubscription, ParamMap } from './subscription_decorator';\r\nimport { IDisposable } from '../../core/index';\r\n\r\n@Injectable()\r\nclass Subscription {\r\n\r\n  /**\r\n   * \r\n   */\r\n  public init(frameComponent: FrameComponent): IDisposable[] {\r\n    if (!frameComponent) {\r\n      return;\r\n    }\r\n\r\n    return this.bindSubscription(frameComponent, null);\r\n  }\r\n\r\n\r\n  /**\r\n   *  \r\n   * @param frameComponent \r\n   * @param ngEvents \r\n   * @returns eventPipes\r\n   */\r\n  public initWithSubscriptions(frameComponent: FrameComponent, ngEvents: {\r\n    [propName: string]: any;\r\n  }): IDisposable[] {\r\n    if (!frameComponent) {\r\n      return;\r\n    }\r\n\r\n    return this.bindSubscription(frameComponent, ngEvents);\r\n  }\r\n\r\n  /**\r\n   * public \r\n   * @param frameComponent \r\n   * @param ngEvents \r\n   * @returns \r\n   */\r\n  public bindSubscription(frameComponent: FrameComponent, ngEvents: {\r\n    [propName: string]: any;\r\n  }) {\r\n    const context = frameComponent.context;\r\n    if (!context) {\r\n      return;\r\n    }\r\n\r\n    const ngEventHandlerProps = ngEvents ? ngEvents : this.getNgEvents(frameComponent);\r\n    if (!ngEventHandlerProps) {\r\n      return;\r\n    }\r\n\r\n    const eventPipes: IDisposable[] = [];\r\n    Object.keys(ngEventHandlerProps).forEach((propertyName: string) => {\r\n      const ngImportEvent: NgSubscription = ngEventHandlerProps[propertyName];\r\n\r\n      // \r\n      const targetContext = context;\r\n\r\n      const receiver = frameComponent;\r\n      const emitter = ngImportEvent.token;\r\n      const tokenValue = ngImportEvent.token;\r\n      const eventName = ngImportEvent.name;\r\n\r\n      const paramMapCollection = ngImportEvent.paramMapCollection;\r\n      const eventPipe = targetContext.eventBus.on(emitter, tokenValue, eventName, receiver,\r\n        (eventArgs) => {\r\n          this.subscriptionHandler(eventArgs, paramMapCollection, targetContext);\r\n\r\n          const eventHandler: Function = frameComponent[eventName];\r\n          if (!eventHandler) {\r\n            return;\r\n          }\r\n\r\n          try {\r\n            eventHandler(receiver, eventArgs);\r\n          } catch {\r\n            throw new Error('Error invoking method ' + eventName);\r\n          }\r\n        }\r\n      );\r\n\r\n      eventPipes.push(eventPipe);\r\n    });\r\n\r\n    return eventPipes;\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param frameComponent component\r\n   * @returns \r\n   */\r\n  public getNgEvents(frameComponent: FrameComponent) {\r\n    return MetadataUtil.getPropsMetadatasByName(frameComponent.constructor, NG_SUBSCRIPTION);\r\n  }\r\n\r\n  private subscriptionHandler(param: any, paramMapCollection: ParamMap[], currentFrameContext: FrameContext) {\r\n\r\n    if (!param || !paramMapCollection || paramMapCollection.length <= 0 || !currentFrameContext) {\r\n      return;\r\n    }\r\n\r\n    this.paramMap2UiState(param, paramMapCollection, currentFrameContext);\r\n  }\r\n\r\n  /**\r\n   * paramMapparamUISTATE\r\n   */\r\n  private paramMap2UiState(param: any, paramMapCollection: ParamMap[], currentFrameContext: FrameContext) {\r\n    for (let i = 0; i < paramMapCollection.length; i++) {\r\n      const from = paramMapCollection[i].from;\r\n      const frameId = paramMapCollection[i].frameId;\r\n      const to = paramMapCollection[i].to;\r\n\r\n      if (!from || !frameId || !to) {\r\n        continue;\r\n      }\r\n      const destContext: FrameContext = this.getFrameContext(frameId, currentFrameContext);\r\n      if (destContext == null) {\r\n        continue;\r\n      }\r\n      this.setUiStateProperty(to, param[from], destContext.uiState);\r\n      // this.setUiStateProperty(to, param[from], currentFrameContext.uiState);\r\n    }\r\n  }\r\n\r\n  private getFrameContext(targetFrameContextId: string, currentContext: FrameContext): FrameContext {\r\n    let destContext: FrameContext = null;\r\n    try {\r\n      destContext = currentContext.appContext.getFrameContext(targetFrameContextId);\r\n    } catch {\r\n      throw new Error('Error in Getting FrameContext');\r\n    }\r\n    return destContext;\r\n  }\r\n\r\n  private setUiStateProperty(propertyName: string, propertyValue: string, uiState: UIState) {\r\n    try {\r\n      uiState.setPropertyValue(propertyName, propertyValue);\r\n    } catch {\r\n      throw new Error(\"Error in Setting Property Value of the current UISTATE\" + uiState);\r\n    }\r\n  }\r\n\r\n}\r\n\r\nexport { Subscription };\r\n","import { Subject, Subscription } from 'rxjs';\r\nimport { IDisposable } from '../core/index';\r\nimport { EventTypeEnum } from '../event-mechanism';\r\nimport { EventPipeType } from './event-pipe-type';\r\n\r\nexport class EventPipe implements IDisposable {\r\n  private lastEventId = -1;\r\n  /**\r\n   * \r\n   */\r\n  private eventSubject: Subject<any>;\r\n\r\n  /**\r\n   * Map\r\n   * key=FrameComponent\r\n   * valueevetnSubjectSubscriptionrxjs\r\n   */\r\n  private subscriptionMap: Map<object, Subscription>;\r\n\r\n  /**\r\n   * \r\n   */\r\n  private onceSubscriptionMap: Map<object, Subscription>;\r\n\r\n  /**\r\n   * EventPipe\r\n   */\r\n  public eventPipeType = EventPipeType.Compile; \r\n  public get subscriptions(): Map<object, Subscription> {\r\n    return this.subscriptionMap;\r\n  }\r\n  constructor(\r\n    public name: string,\r\n    public tokenValue: string,\r\n    public emitter: string,\r\n    private parentEventPipeList: Array<EventPipe>\r\n  ) {\r\n    this.eventSubject = new Subject<any>();\r\n    this.subscriptionMap = new Map<object, Subscription>();\r\n    this.onceSubscriptionMap = new Map<object, Subscription>();\r\n    if (this.parentEventPipeList) {\r\n      this.parentEventPipeList.push(this);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  post(args: any, sender?: any, eventType?: any, eventId?: number) {\r\n    const eventData = {\r\n      args: args,\r\n      sender: sender,\r\n      eventType,\r\n      eventId\r\n    };\r\n    this.eventSubject.next(eventData);\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  subscribe(eventHandler: (value: any) => void, receiver: object): IDisposable {\r\n\r\n    // callercaller\r\n    // \r\n    const subscriptionInMap = this.subscriptionMap.get(receiver);\r\n    if (subscriptionInMap != null) {\r\n      subscriptionInMap.unsubscribe();\r\n      this.subscriptionMap.delete(receiver);\r\n    }\r\n\r\n    const subscription = this.eventSubject.subscribe((eventData: any) => {\r\n      const args = eventData.args;\r\n      const sender = eventData.sender;\r\n      const eventType = eventData.eventType || null;\r\n      const eventId = eventData.eventId || 0;\r\n      if (this.lastEventId >= eventId) {\r\n        return;\r\n      }\r\n      this.lastEventId = eventId;\r\n      // senderreceiverAppContext\r\n      // SPA\r\n      if (!(eventType === EventTypeEnum.ROUTE)) {\r\n        if (this.isInSampeScope(sender, receiver) === false) {\r\n          return;\r\n        }\r\n      }\r\n      eventHandler.call(receiver, args);\r\n    });\r\n\r\n    this.subscriptionMap.set(\r\n      receiver,\r\n      subscription\r\n    );\r\n    return this;\r\n  }\r\n\r\n  subscribeOnce(eventHandler: (value: any) => void, caller: object): IDisposable {\r\n    const subscription = this.eventSubject.subscribe((value) => eventHandler.call(caller, value));\r\n    this.onceSubscriptionMap.set(\r\n      caller,\r\n      subscription\r\n    );\r\n    return this;\r\n  }\r\n\r\n  unSubscribe(subscriber: object) {\r\n    let subscription = this.subscriptionMap.get(subscriber);\r\n    if (subscription) {\r\n      subscription.unsubscribe();\r\n      subscription = null;\r\n      this.subscriptionMap.delete(subscriber);\r\n    } else {\r\n      subscription = this.onceSubscriptionMap.get(subscriber);\r\n      if (subscription) {\r\n        subscription.unsubscribe();\r\n        subscription = null;\r\n        this.onceSubscriptionMap.delete(subscriber);\r\n      }\r\n    }\r\n  }\r\n\r\n  // once\r\n  unSubscribeForOnce() {\r\n    for (const subscriber of Array.from(this.onceSubscriptionMap.keys())) {\r\n      this.unSubscribe(subscriber);\r\n    }\r\n  }\r\n\r\n  matchEmitterToken(emitter: string, tokenValue: string): boolean {\r\n    if (this.emitter && emitter && this.emitter !== emitter) {\r\n      return false;\r\n    }\r\n    if (this.tokenValue && tokenValue && this.tokenValue !== tokenValue) {\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  examByTargetToken(target: string, tokenValue: string): boolean {\r\n    if (this.emitter !== target) {\r\n      return false;\r\n    }\r\n    if (this.tokenValue !== tokenValue) {\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  dispose(subscriber: object): void {\r\n    this.unSubscribe(subscriber);\r\n    if (this.subscriptionMap.size === 0 && this.parentEventPipeList) {\r\n      const location = this.parentEventPipeList.findIndex(item => item === this);\r\n      if (location !== -1) {\r\n        this.parentEventPipeList.splice(location, 1);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * caller\r\n   */\r\n  disposeByCaller(caller: any) {\r\n    const subscriptionInMap = this.subscriptionMap.get(caller);\r\n    if (subscriptionInMap != null) {\r\n      subscriptionInMap.unsubscribe();\r\n      this.subscriptionMap.delete(caller);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @todo\r\n   * 1senderreceiver\r\n   * 2\r\n   */\r\n  private isInSampeScope(sender: any, receiver: any): boolean {\r\n    // \r\n    if (this.eventPipeType === EventPipeType.Parsing) {\r\n      return true;\r\n    }\r\n\r\n    // sender\r\n    if (!sender) {\r\n      return true;\r\n    }\r\n\r\n    // \r\n    if (sender === receiver) {\r\n      return true;\r\n    }\r\n\r\n    // FrameContext\r\n    if (!sender.context || !sender.context.appContext ||\r\n      !receiver.context || !receiver.context.appContext) {\r\n      return false;\r\n    }\r\n\r\n    const senderAppContext = sender.context.appContext;\r\n    const receiverAppContext = receiver.context.appContext;\r\n\r\n    // 1\r\n    // AppContext\r\n    // root-componentroot-componetnAppContext\r\n    // SPARoot AppContext\r\n    // AppContext\r\n    // AppContext\r\n    if (senderAppContext === receiverAppContext) {\r\n      return true;\r\n    }\r\n\r\n    // 2\r\n    // AppContext\r\n    // root-componentAppContext;\r\n    // root-componentAppContextRoot AppContext\r\n    // if (senderAppContext.root === receiverAppContext.root) {\r\n    //   return true;\r\n    // }\r\n\r\n    // 3\r\n    // ;\r\n    // 2AppContext\r\n    // Root Appcontext\r\n    // 1senderinjectorinjectorAppContext\r\n    // 2\r\n\r\n    if ((senderAppContext.useIsoluteEventBus && senderAppContext.isoluteEventBus) ||\r\n      (receiverAppContext.useIsoluteEventBus && receiverAppContext.isoluteEventBus)) {\r\n      // js  \r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n}\r\n","import { Injectable, Type } from '@angular/core';\r\nimport { EventBusProxy } from './event-bus-proxy';\r\nimport { IEmitable } from './types';\r\nimport { EventPipe } from './event-pipe';\r\nimport { IDisposable } from '../core/index';\r\n\r\n@Injectable()\r\nexport class EventBus implements IEmitable {\r\n  private proxyMap: Map<string, EventBusProxy>;\r\n  private eventMap: Map<string, Array<EventPipe>>;\r\n\r\n  constructor() {\r\n    this.proxyMap = new Map<string, EventBusProxy>();\r\n    this.eventMap = new Map<string, Array<EventPipe>>();\r\n  }\r\n\r\n  getProxy(ownerType: any, eventTokenValueProvider: () => any): EventBusProxy {\r\n    const ownerName = ownerType.constructor.typeName || ownerType.constructor.name;\r\n    if (!this.proxyMap.has(ownerName)) {\r\n      this.proxyMap.set(ownerName, new EventBusProxy(this, ownerType, eventTokenValueProvider));\r\n    }\r\n    return this.proxyMap.get(ownerName);\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  // tslint:disable-next-line: max-line-length\r\n  post(emitterType: any | string, tokenValue: string, eventName: string, eventArgs: any, sender?: any, eventType?: any, eventId?: number): void {\r\n    const eventPipeList = this.eventMap.get(eventName);\r\n    if (!eventPipeList) {\r\n      return;\r\n    }\r\n\r\n    if (!emitterType) {\r\n      console.error('postemitterType');\r\n      return;\r\n    }\r\n    let emitter: string;\r\n    if (emitterType instanceof Type) {\r\n      emitter = emitterType.typeName || emitterType.name;\r\n    } else {\r\n      emitter = emitterType;\r\n    }\r\n    if (typeof eventId === 'undefined') {\r\n      eventId = new Date().valueOf();\r\n    }\r\n    for (const eventPipe of eventPipeList) {\r\n      if (eventPipe.matchEmitterToken(emitter, tokenValue)) {\r\n        eventPipe.post(eventArgs, sender, eventType, eventId);\r\n        eventPipe.unSubscribeForOnce();\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  on(target: string, tokenValue: string, eventName: string, caller: Object, handler: (value: any) => void): IDisposable {\r\n    return this.getEventPipe(eventName, target, tokenValue).subscribe(handler, caller);\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param target \r\n   * @param tokenValue \r\n   * @param eventName \r\n   * @param caller \r\n   */\r\n  public off(target: string, tokenValue: string, eventName: string, caller: Object) {\r\n    const eventPipeList = this.eventMap.get(eventName);\r\n    if (eventPipeList) {\r\n      const index = eventPipeList.findIndex((eventPipe: EventPipe) => {\r\n        if (eventPipe.subscriptions.get(caller)) {\r\n          return eventPipe.name === eventName && eventPipe.tokenValue === tokenValue && eventPipe.emitter === target;\r\n        }\r\n        return false;\r\n      });\r\n      if (index !== -1) {\r\n        eventPipeList.splice(index, 1);\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  once(target: string, tokenValue: string, eventName: string, caller: Object, handler: (value: any) => void): IDisposable {\r\n    return this.getEventPipe(eventName, target, tokenValue).subscribeOnce(handler, caller);\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  requestFor(target: string, tokenValue: string, requestName: string, requestValue: any, success: (any) => any, fail?: (string) => any) {\r\n    const eventPipe = this.findExistEventPipe(requestName, 'RequestSubject', tokenValue);\r\n    if (eventPipe) {\r\n      this.once(target, tokenValue, requestName, this, (response) => {\r\n        if (response.status === 'success') {\r\n          success(response.data);\r\n        } else {\r\n          if (fail) {\r\n            fail('No target responser listening');\r\n          }\r\n        }\r\n      });\r\n      eventPipe.post({ target: target, token: tokenValue, data: requestValue });\r\n    } else {\r\n      if (fail) {\r\n        fail('No target responser listening.');\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  responseOn(responseSubject: string, requestName: string, callback: (any) => any) {\r\n    this.on('RequestSubject', null, requestName, this, (requestObj) => {\r\n      const response = { status: 'fail', data: null };\r\n      if (responseSubject === requestObj.target) {\r\n        response.data = callback(requestObj.data);\r\n        response.status = 'success';\r\n      }\r\n      this.post(requestObj.target, requestObj.token, requestName, response);\r\n    });\r\n  }\r\n\r\n  private getEventPipe(eventName: string, target: string, tokenValue: string) {\r\n    let eventPipeList = this.eventMap.get(eventName);\r\n    if (!eventPipeList) {\r\n      eventPipeList = new Array<EventPipe>();\r\n      this.eventMap.set(eventName, eventPipeList);\r\n    }\r\n\r\n    // 1\r\n    // let eventPipe = eventPipeList.find(item => item.examByTargetToken(target, tokenValue));\r\n    // if (!eventPipe) {\r\n    //   eventPipe = new EventPipe(eventName, tokenValue, target, eventPipeList);\r\n    // }\r\n\r\n    // 2\r\n    const eventPipe = new EventPipe(eventName, tokenValue, target, eventPipeList);\r\n\r\n    return eventPipe;\r\n  }\r\n\r\n  private findExistEventPipe(eventName: string, target: string, tokenValue: string): EventPipe {\r\n    const eventPipeList = this.eventMap.get(eventName);\r\n    if (!eventPipeList) {\r\n      return null;\r\n    }\r\n    // return eventPipeList.find(item => item.examByTargetToken(target, tokenValue));\r\n    for (const eventPipe of eventPipeList) {\r\n      if (eventPipe.matchEmitterToken(target, tokenValue)) {\r\n        return eventPipe;\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n}\r\n\r\nexport class EventCache {\r\n  private static tokens = new Map();\r\n\r\n  public static setToken(key: string, value: any) {\r\n    EventCache.tokens.set(key, value);\r\n  }\r\n\r\n  public static getToken(key: string) {\r\n    return EventCache.tokens.get(key);\r\n  }\r\n}\r\n\r\nclass RequestSubject { }\r\nclass DataClass { }\r\n","/*\r\n * @Author: aalizzwell \r\n * @Date: 2019-05-30 11:08:18 \r\n * @Last Modified by: aalizzwell\r\n * @Last Modified time: 2019-06-01 17:10:04\r\n */\r\n\r\nimport { InjectionToken } from '@angular/core';\r\nimport { IExceptionHandler } from './types';\r\nexport const EXCEPTION_HANDLER = new InjectionToken<IExceptionHandler>('@farris/devkit ExceptionHandler');","import { Observable } from 'rxjs';\r\n\r\n// tslint:disable-next-line: no-namespace\r\nexport namespace Expression {\r\n  /**\r\n   * \r\n   */\r\n  export interface ExpressionObject {\r\n    /**\r\n     * \r\n     */\r\n    id?: string;\r\n    /**\r\n     * \r\n     */\r\n    path: string;\r\n    /**\r\n     * State|Entity\r\n     */\r\n    bindingType: ExpressionBindingType;\r\n    /**\r\n     * \r\n     */\r\n    type: ExpressionType;\r\n    /**\r\n     * \r\n     */\r\n    expression: string;\r\n    /**\r\n     * \r\n     */\r\n    deps: Array<string>;\r\n    /**\r\n     * namespace\r\n     */\r\n    ns: string;\r\n    /**\r\n     * \r\n     */\r\n    result?: any;\r\n    /**\r\n     * \r\n     */\r\n    effectPaths?: string[],\r\n    /**\r\n     * \r\n     */\r\n    message?: string;\r\n    /**\r\n     * \r\n     */\r\n    messageType?: 'error' | 'info' | 'warning';\r\n    /**\r\n     * \r\n     */\r\n    factory?: any;\r\n  }\r\n\r\n  /**\r\n   *  \r\n   */\r\n  export interface ICustomContext {\r\n    currentRows?: Array<ICurrentRow>,\r\n    contexts?: { [prop: string]: any },\r\n    patch?: { [prop: string]: any }\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  export interface ICurrentRow {\r\n    bindingPath: string;\r\n    primaryValue: string;\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @deprecated deprecatednever use\r\n   */\r\n  export interface Assigner {\r\n    assign(expressionObject: ExpressionObject);\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  export interface IExecutor {\r\n    compile(expressionObject: Expression.ExpressionObject, context?: { [prop: string]: any }): any;\r\n  }\r\n  /**\r\n   * UIState?\r\n   */\r\n  export enum ExpressionBindingType {\r\n    State = 'State',\r\n    Field = 'Field'\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  export enum ExpressionType {\r\n    /**\r\n     * \r\n     */\r\n    Required = 'require',\r\n    /**\r\n     * \r\n     */\r\n    Readonly = 'readonly',\r\n    /**\r\n     * \r\n     */\r\n    Compute = 'compute',\r\n    /**\r\n     * \r\n     */\r\n    Dependency = 'dependency',\r\n    /**\r\n     * \r\n     */\r\n    Visible = 'visible',\r\n    /**\r\n     * \r\n     */\r\n    Relative = 'relative',\r\n    /**\r\n     * \r\n     */\r\n    Validate = 'validate',\r\n    /**\r\n     * \r\n     */\r\n    DataPicking = 'dataPicking'\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  export enum EventType {\r\n    ValueChanged = 'VALUE_CHANGED',\r\n    SelectionChanged = 'SELECTION_CHANGED',\r\n    Load = 'Load',\r\n    Append = 'Append',\r\n    Remove = 'Remove',\r\n    Update = 'Update',\r\n  }\r\n  export enum EventSource {\r\n    Field = 'Field',\r\n    State = 'State',\r\n    BindingData = 'BindingData',\r\n    Repository = 'Repository'\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  export interface EventArgs {\r\n    /**\r\n     * namespace\r\n     */\r\n    ns: string;\r\n    /**\r\n     * \r\n     */\r\n    path: Array<string>;\r\n    /**\r\n     * \r\n     */\r\n    type?: EventType;\r\n    /**\r\n     * \r\n     */\r\n    source: EventSource;\r\n    /**\r\n     * \r\n     */\r\n    value?: any;\r\n    /**\r\n     * \r\n     */\r\n    context?: any;\r\n    /**\r\n     * frameId\r\n     */\r\n    frameId?: string;\r\n    /**\r\n     * \r\n     */\r\n    entity?: any;\r\n    id?: any;\r\n    /**\r\n     * \r\n     */\r\n    isTreeNodeLoadScene?: boolean;\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  export interface Listener {\r\n    onEvent: Observable<EventArgs>;\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  export interface Effector {\r\n    /**\r\n     * namespace\r\n     */\r\n    ns: string;\r\n    /**\r\n     * \r\n     * @param expressionObject \r\n     */\r\n    effect(path: string, value: any, options: EffectOptions);\r\n  }\r\n  export interface EffectOptions {\r\n    /**\r\n     * \r\n     */\r\n    path?: string[];\r\n    /**\r\n     * frameId\r\n     */\r\n    frameId?: string;\r\n    /**\r\n     * \r\n     */\r\n    message?: string;\r\n    /**\r\n     * \r\n     */\r\n    messageType?: MessageType | 'error' | 'info' | 'warning';\r\n    /**\r\n     * id\r\n     */\r\n    expressionId?: string;\r\n  }\r\n  export enum MessageType {\r\n    error = 'error',\r\n    info = 'info',\r\n    warning = 'warning'\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  export interface IEventHandler {\r\n    handleEvent(event: EventArgs, expressionObjects: Expression.ExpressionObject[]);\r\n    filter(event: Expression.EventArgs);\r\n    perform(expressionObject: Expression.ExpressionObject, context: any);\r\n    effect(event: Expression.EventArgs, expressionObject: Expression.ExpressionObject): void;\r\n  }\r\n  export enum EffectPath {\r\n    currentRow = 0\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  export interface IValidateResult {\r\n    expressionId: string;\r\n    path: string[];\r\n    result: any;\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  export interface IBuilderOptions {\r\n\r\n  }\r\n  export const MESSAGE = {\r\n    'zh-CHS': {\r\n      require: `'$property'`,\r\n      validate: `'$property'`,\r\n      dataPicking: ''\r\n    },\r\n    en: {\r\n      require: `Please input '$property'`,\r\n      validate: `'$property' calibration failed`,\r\n      dataPicking: 'Failed to verify the expression before help'\r\n    },\r\n    'zh-CHT': {\r\n      require: `'$property'`,\r\n      validate: `'$property'`,\r\n      dataPicking: ''\r\n    }\r\n  };\r\n  export const DEPENDENCY_SPLITER = '/';\r\n}","import { InjectionToken } from \"@angular/core\";\r\nimport { UserSettings } from \"./types\";\r\n\r\nexport const UserSettingsToken = new InjectionToken<UserSettings>('@farris/devkit UserSettingsToken');","import { InjectionToken } from \"@angular/core\";\r\nimport { IFormExpressionManifestService, IFormManifestService } from \"./types\";\r\n\r\nexport const FORM_MANIFEST_SERVICE_TOKEN = new InjectionToken<IFormManifestService>('@farris/form_manifest_service');\r\nexport const FORM_EXPRESSION_MANIFEST_SERVICE_TOKEN = new InjectionToken<IFormExpressionManifestService>('@farris/form_expression_manifest_service');\r\n","import { Inject, Injectable, Injector, Optional } from \"@angular/core\";\r\nimport { Observable, of } from \"rxjs\";\r\nimport { catchError, switchMap } from \"rxjs/operators\";\r\nimport { Expression } from './types';\r\nimport { FORM_EXPRESSION_MANIFEST_SERVICE_TOKEN, IFormExpressionManifestService } from \"../manifest/index\";\r\nimport { Translate, TranslateToken } from \"../i18n/index\";\r\nimport { Repository } from \"../repository/index\";\r\n\r\n@Injectable()\r\nexport class ExpressionRegistry {\r\n  private _expressions: Expression.ExpressionObject[] = null;\r\n  constructor(\r\n    private injector: Injector,\r\n    @Inject(FORM_EXPRESSION_MANIFEST_SERVICE_TOKEN) private formExpressionManifestService: IFormExpressionManifestService,\r\n    @Optional() @Inject(TranslateToken) private translate: Translate\r\n  ) {\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  public load(): Observable<Expression.ExpressionObject[]> {\r\n    return this.formExpressionManifestService.load().pipe(\r\n      switchMap((describe: Array<any>) => {\r\n        const expressions: Array<Expression.ExpressionObject> = [];\r\n        const exprs = Array.from(describe);\r\n        exprs.forEach((expr: any) => {\r\n          expr.expressions.forEach((expression: any) => {\r\n            const expressionObject: Expression.ExpressionObject = {\r\n              id: expression.id,\r\n              ns: expr.ns,\r\n              path: expr.path,\r\n              bindingType: expr.type,\r\n              type: expression.type,\r\n              expression: expression.value || expression.expr || '',\r\n              message: expression.message || null,\r\n              messageType: expression.messageType || null,\r\n              deps: []\r\n            };\r\n            if ((expression.type === Expression.ExpressionType.Required || expression.type === Expression.ExpressionType.Validate || expression.type === Expression.ExpressionType.DataPicking)) {\r\n              if (!expression.message) {\r\n                expressionObject.message = this.getExpressionMessage(expression.type);\r\n              }\r\n              if (!expression.messageType) {\r\n                expressionObject.messageType = 'error';\r\n              }\r\n            }\r\n            if (expressionObject.message) {\r\n              this.transform(expressionObject);\r\n            }\r\n            expressions.push(expressionObject);\r\n          });\r\n        });\r\n        this._expressions = expressions;\r\n        this.cleanSpecialCharacters();\r\n        return of(expressions);\r\n      }),\r\n      catchError((e) => {\r\n        return of([]);\r\n      })\r\n    );\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  public get expressions(): Observable<Expression.ExpressionObject[]> {\r\n    if (this._expressions) {\r\n      return of(this._expressions);\r\n    }\r\n    return this.load();\r\n  }\r\n  /**\r\n   * id\r\n   * @param id id\r\n   * @returns \r\n   */\r\n  public getExpressionById(id: string): Expression.ExpressionObject {\r\n    if (!this._expressions || this._expressions.length < 1) {\r\n      return null;\r\n    }\r\n    return this._expressions.find((expressionObject: Expression.ExpressionObject) => expressionObject.id === id);\r\n  }\r\n  private getExpressionMessage(expressionType: Expression.ExpressionType, defaultValue?: string) {\r\n    if (!(expressionType === Expression.ExpressionType.Validate || expressionType === Expression.ExpressionType.Required || expressionType === Expression.ExpressionType.DataPicking)) {\r\n      return null;\r\n    }\r\n    if (!this.translate) {\r\n      return defaultValue;\r\n    }\r\n    const currentLanguage = this.translate.getCurrentLanguage() || 'zh-CHS';\r\n    return Expression.MESSAGE[currentLanguage][expressionType];\r\n  }\r\n  private transform(expressionObject: Expression.ExpressionObject) {\r\n    if (!this.translate) {\r\n      return;\r\n    }\r\n    if (expressionObject.message && expressionObject.message.startsWith('{{') && expressionObject.message.endsWith('}}')) {\r\n      expressionObject.message = this.translate.transform(expressionObject.message.substr(2, expressionObject.message.length - 4), null) || this.getExpressionMessage(expressionObject.type);\r\n    }\r\n  }\r\n  private cleanSpecialCharacters() {\r\n    if (!this._expressions || this._expressions.length < 1 || !Array.isArray(this._expressions)) {\r\n      return;\r\n    }\r\n    const repository: Repository<any> = this.injector.get(Repository, null);\r\n    if (!repository) {\r\n      return;\r\n    }\r\n    const entityTypeInfo = repository.entityTypeInfo;\r\n    const regex = new RegExp(`[\\\\'\\\\\"]?\\\\s*(${entityTypeInfo.entityInfo.nodeCode}|${entityTypeInfo.entityInfo.originalCode})[\\\\.\\\\[\\\\]a-zA-Z0-9_]+\\\\s*[\\\\'\\\\\"]?`, 'g');\r\n    this._expressions.forEach((expressionObject: Expression.ExpressionObject) => {\r\n      const expr = expressionObject.expression;\r\n      const entityPropertyExpressions: RegExpMatchArray = expr.match(regex);\r\n      if (Array.isArray(entityPropertyExpressions) && entityPropertyExpressions.length > 0) {\r\n        // \r\n        entityPropertyExpressions.forEach((item: string) => {\r\n          if (item.indexOf('.') === -1) {\r\n            return;\r\n          }\r\n          // \r\n          if (/\\[\\d\\]/g.test(item)) {\r\n            const replacer = item.replace(/\\[\\d\\]/g, '');\r\n            expressionObject.expression = this.replaceAll(expressionObject.expression, item, replacer);\r\n          }\r\n          // \r\n          if (/\\*/g.test(item)) {\r\n            const replacer = item.replace(/\\*/g, '');\r\n            expressionObject.expression = this.replaceAll(expressionObject.expression, item, replacer);\r\n          }\r\n        });\r\n      }\r\n    });\r\n  }\r\n  private replaceAll(originalValue: string, search: string, replacer: string) {\r\n    return originalValue.split(search).join(replacer);\r\n  }\r\n}","import { InjectionToken } from '@angular/core';\r\nimport { Expression } from '../expression/index';\r\n\r\ntype Listener = Expression.Listener;\r\n\r\nexport const LISTENER_TOKEN = new InjectionToken<Listener>('@Farris listener');","import { Observable, Subject } from \"rxjs\";\r\nimport { Change } from \"../binding-data/index\";\r\nimport { Modification } from \"../changeset/index\";\r\nimport { DataPropGroup, DataPropInfo, DataTypeInfo } from \"../core\";\r\nimport { Expression } from '../expression/index';\r\nimport { UIStateObservableParam } from \"../ui-state/index\";\r\n\r\ntype EventArgs = Expression.EventArgs;\r\ntype Listener = Expression.Listener;\r\n\r\n/**\r\n * \r\n */\r\nexport abstract class ChangeListener implements Listener {\r\n  protected subject: Subject<EventArgs> = new Subject<EventArgs>();\r\n  public get onEvent(): Observable<EventArgs> {\r\n    return this.subject;\r\n  }\r\n  abstract buildEventPath(change: Change | Modification |UIStateObservableParam): string[];\r\n  /**\r\n   * \r\n   * @param dataTypeInfo \r\n   * @param results \r\n   * @param paths \r\n   */\r\n  public findEntityPaths(dataTypeInfo: DataTypeInfo, results: any[], paths: string[] = []) {\r\n    const list: DataPropInfo[] = dataTypeInfo.getPropInfosByGroup(DataPropGroup.List);\r\n    if (list && list.length > 0) {\r\n      list.forEach((dataPropInfo: DataPropInfo) => {\r\n        paths.push(dataPropInfo.name);\r\n        const childrens: DataPropInfo[] = dataPropInfo.typeInfo.getPropInfosByGroup(DataPropGroup.List);\r\n        if (childrens && childrens.length > 0) {\r\n          childrens.forEach((dataPropInfo: DataPropInfo) => {\r\n            this.findEntityPaths(dataPropInfo.typeInfo, results, paths);\r\n          });\r\n        } else {\r\n          results.push(paths);\r\n        }\r\n      });\r\n    } else if (paths && paths.length > 0) {\r\n      results.push(paths);\r\n    }\r\n  }\r\n}","import { Injectable } from \"@angular/core\";\r\nimport { Expression as ExpressionEngineExpression, ExpressionContext, ExpressionEngine } from \"@farris/expression-engine\";\r\nimport { Expression } from '../expression/index';\r\n@Injectable()\r\nexport class ExpressionExecutor implements Expression.IExecutor {\r\n  /**\r\n   * \r\n   * @param expression \r\n   * @param context \r\n   * @returns \r\n   */\r\n  public compile(expressionObject: Expression.ExpressionObject, context?: { [prop: string]: any }): any {\r\n    if (Object.prototype.toString.call(context) !== '[object Object]') {\r\n      throw new Error('');\r\n    }\r\n    const expressionContext = this.buildContext(context);\r\n    if (!expressionObject.factory) {\r\n      const expression = new ExpressionEngineExpression(expressionObject.expression, expressionContext);\r\n      expressionObject.factory = expression.compile();\r\n    }\r\n    const expression: ExpressionEngineExpression = expressionObject.factory;\r\n    return expression.eval(expressionContext);\r\n  }\r\n  /**\r\n   * \r\n   * @param expression \r\n   * @param context \r\n   * @returns \r\n   */\r\n  public eval(expression: string, context?: { [prop: string]: any }) {\r\n    if (Object.prototype.toString.call(context) !== '[object Object]') {\r\n      throw new Error('');\r\n    }\r\n    const expressionContext = this.buildContext(context);\r\n    const expressionEngine = new ExpressionEngine(expressionContext);\r\n    return expressionEngine.eval(expression);\r\n  }\r\n  /**\r\n   * \r\n   * @param context \r\n   * @returns \r\n   */\r\n  private buildContext(context: { [prop: string]: any }): ExpressionContext {\r\n    const expressionContext = new ExpressionContext();\r\n    if (context && Object.keys(context).length > 0) {\r\n      Object.keys(context).forEach((key: string) => {\r\n        expressionContext.set(key, context[key]);\r\n      });\r\n    }\r\n    return expressionContext;\r\n  }\r\n}","import { Injectable, Injector } from \"@angular/core\";\r\n\r\n/**\r\n * \r\n */\r\n@Injectable()\r\nexport class ExpressionResult {\r\n  constructor(private injector: Injector) {\r\n  }\r\n  /**\r\n   * \r\n   * @param expressionId id\r\n   * @param result \r\n   */\r\n  public set(expressionId: string, result: any) {\r\n    this[expressionId] = result;\r\n  }\r\n}","import { Inject, Injectable, Injector } from \"@angular/core\";\r\nimport { BigNumber } from 'bignumber.js';\r\nimport { BindingData, BindingList, BindingObject } from \"../binding-data/index\";\r\nimport { EMPTY, Observable, of } from \"rxjs\";\r\nimport { AppContext } from \"../app/index\";\r\nimport { FrameContext } from \"../frame/index\";\r\nimport { Repository } from \"../repository/index\";\r\nimport { ENTITY_TEMPLATE, ResolveService } from \"../resolver/index\";\r\nimport { ExpressionUtil } from \"../utils/expression_util\";\r\nimport { ExpressionExecutor } from \"./expression_executor\";\r\nimport { ExpressionRegistry } from \"./expression_registry\";\r\nimport { Expression } from './types';\r\nimport { ViewModel } from \"../view-model/index\";\r\nimport { ExpressionResult } from \"./expression_result\";\r\nimport { IMessageService, INotifyService, MESSAGE_SERVICE_TOKEN, NOTIFY_SERVICE_TOKEN } from \"../core/index\";\r\nimport { Entity, EntityList } from \"../entity\";\r\nimport { Translate, TranslateToken } from \"../i18n\";\r\n\r\n@Injectable()\r\nexport class ExpressionManager {\r\n  private frameContext: FrameContext = null;\r\n  constructor(private injector: Injector, private resolveService: ResolveService, private expressionExecutor: ExpressionExecutor, private expressionRegistry: ExpressionRegistry, private expressionResult: ExpressionResult, @Inject(MESSAGE_SERVICE_TOKEN) private messageService: IMessageService, @Inject(NOTIFY_SERVICE_TOKEN) private notifyService: INotifyService) {\r\n    this.frameContext = this.injector.get<FrameContext>(FrameContext, null);\r\n  }\r\n  /**\r\n   * id\r\n   * @param expressionId id\r\n   * @param viewModel viewModel\r\n   * @param rowData rowData\r\n   * @returns \r\n   */\r\n  public eval(expressionId: string, viewModel?: ViewModel, rowData?: any) {\r\n    const expressionObject = this.expressionRegistry.getExpressionById(expressionId);\r\n    if (expressionObject) {\r\n      const customContext: Expression.ICustomContext = {};\r\n      const bindingPath = viewModel && viewModel.bindingPath || null;\r\n      if (bindingPath && rowData) {\r\n        const bindingPaths = bindingPath.split('/').filter(p => p);\r\n        const bindingList = this.frameContext.bindingData.getValue(bindingPaths) as BindingList;\r\n        let primaryKey = 'id';\r\n        if (bindingList) {\r\n          primaryKey = bindingList.primaryKey;\r\n        }\r\n        const primaryValue = rowData[primaryKey] || bindingList.currentId;\r\n        if (primaryValue) {\r\n          customContext.currentRows = [{ bindingPath: bindingPaths.join('/'), primaryValue }];\r\n        }\r\n      }\r\n      let result = this.execute(expressionObject.expression, customContext);\r\n      if (expressionObject.type === Expression.ExpressionType.Readonly || expressionObject.type === Expression.ExpressionType.Required || expressionObject.type === Expression.ExpressionType.Visible) {\r\n        result = result === true ? true : false;\r\n      }\r\n      this.expressionResult.set(expressionId, result);\r\n      return result;\r\n    } else {\r\n      // console.warn('ExpressionManager !');\r\n    }\r\n    return undefined;\r\n  }\r\n  public validate(expressionId: string, options: any) {\r\n    const expressionObject = this.expressionRegistry.getExpressionById(expressionId);\r\n    if (expressionObject) {\r\n      const patch = options && options.patch || null;\r\n      const customContext: Expression.ICustomContext = {};\r\n      if (patch) {\r\n        customContext.patch = patch;\r\n      }\r\n      const currentRow = options.currentRow || null;\r\n      const currentRows = options.currentRows || [];\r\n      if (currentRow) {\r\n        customContext.currentRows = customContext.currentRows || [];\r\n        customContext.currentRows.push(currentRow);\r\n      }\r\n      if (currentRows && currentRows.length > 0) {\r\n        customContext.currentRows = customContext.currentRows || [];\r\n        Array.prototype.push.apply(customContext.currentRows, currentRows)\r\n      }\r\n      const result = this.execute(expressionObject.expression, customContext);\r\n      this.expressionResult.set(expressionId, result);\r\n      return result;\r\n    } else {\r\n    }\r\n    return undefined;\r\n  }\r\n  /**\r\n   * \r\n   * @param event \r\n   */\r\n  public onDataPicking(configs: { expressionId: string }) {\r\n    const expressionId = configs && configs.expressionId || null;\r\n    if (!expressionId) {\r\n      return of(true);\r\n    }\r\n    const result = this.eval(expressionId);\r\n    if (!result) {\r\n      const expressionObject = this.expressionRegistry.getExpressionById(expressionId);\r\n      if (!expressionObject) {\r\n        return of(true);\r\n      }\r\n      const messageType = expressionObject.messageType || Expression.MessageType.warning;\r\n      const message = expressionObject.message;\r\n      if (message) {\r\n        this.notifyService[messageType](message, { hideTitle: true });\r\n      }\r\n      return EMPTY;\r\n    }\r\n    return of(result);\r\n  }\r\n  /**\r\n   * \r\n   * @param expression \r\n   * @param customContext \r\n   * @returns \r\n   */\r\n  private execute(expression: string, customContext?: Expression.ICustomContext): any {\r\n    const deps = this.resolveService.resolve(expression);\r\n    const groupDependencies = ExpressionUtil.getGroupFunctionDependency(expression, this.frameContext.repository.entityTypeInfo);\r\n    const entityContext = this.buildEntityContext(deps, groupDependencies, customContext);\r\n    const stateContext = this.buildStateContext();\r\n    const data = customContext && customContext.contexts || null;\r\n    const translate = this.injector.get<Translate>(TranslateToken, null);\r\n    const context = {\r\n      [this.entityOriginalNodeCode]: entityContext,\r\n      ...stateContext,\r\n      BigNumber,\r\n      frameContext: this.frameContext,\r\n      bindingData: this.frameContext.bindingData,\r\n      repository: this.frameContext.repository,\r\n      CurrentLanguage: translate.getCurrentLanguage() || 'zh-CHS',\r\n      ...data\r\n    }\r\n    if (!entityContext) {\r\n      return undefined;\r\n    }\r\n    return this.expressionExecutor.eval(expression, context);\r\n  }\r\n  /**\r\n   * \r\n   * @param expression \r\n   * @param customContext \r\n   * @returns \r\n   */\r\n  private executeAsync(expression: string, customContext?: Expression.ICustomContext): Observable<any> {\r\n    const result = this.execute(expression, customContext);\r\n    return of(result);\r\n  }\r\n  /**\r\n   * \r\n   * @param deps \r\n   * @param groupDependencies \r\n   * @param context \r\n   * @returns \r\n   */\r\n  private buildEntityContext(deps: string[], groupDependencies: string[], context?: Expression.ICustomContext) {\r\n\r\n    const currentRows = context && context.currentRows || null;\r\n    const index = deps.findIndex((dep: string) => {\r\n      const isEntityDependency = this.isEntityDependency(dep);\r\n      // statestate\r\n      // \r\n      if (isEntityDependency) {\r\n        const isGroupDependency = groupDependencies.findIndex(item => item === dep) !== -1;\r\n        // \r\n        if (isGroupDependency) {\r\n          const dependencyLength = dep.split('/').filter(p => p).length - 1;\r\n          if (dependencyLength === 1) {\r\n            // \r\n            return true;\r\n          } else {\r\n            // \r\n            return false;\r\n          }\r\n        } else {\r\n          // \r\n          return false;\r\n        }\r\n      }\r\n      return false;\r\n    })\r\n    const isGroupdMainEntity = index !== -1;\r\n\r\n    const options = {};\r\n    if (currentRows && currentRows.length > 0) {\r\n      currentRows.forEach((currentRow: Expression.ICurrentRow) => {\r\n        options[currentRow.bindingPath || '/'] = currentRow.primaryValue;\r\n      });\r\n    }\r\n    const entity = this.getEntity(options);\r\n    const patch = context && context.patch || null;\r\n    if (!entity) {\r\n      return {};\r\n    }\r\n    if (patch && Object.keys(patch).length > 0) {\r\n      Object.keys(patch).forEach((key: string) => {\r\n        const paths = key.split('/').filter(p => p);\r\n        const value = patch[key];\r\n        this.setValue(entity, paths, value);\r\n      });\r\n    }\r\n    if (isGroupdMainEntity) {\r\n      const collection = this.frameContext.repository.entityCollection.toJSON();\r\n      entity['__type__'] = 'List';\r\n      entity['__items__'] = collection;\r\n    }\r\n    return entity;\r\n  }\r\n  private setValue(target: any, paths: string[], value: any) {\r\n    if (paths.length === 1) {\r\n      target[paths[0]] = value;\r\n    } else {\r\n      const propertyName = paths.pop();\r\n      const result = paths.reduce((object: any, path: string) => {\r\n        return object && object[path];\r\n      }, target);\r\n      result[propertyName] = value;\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   * @param dep \r\n   * @returns \r\n   */\r\n  private isEntityDependency(dep: string) {\r\n    return dep.startsWith(ENTITY_TEMPLATE);\r\n  }\r\n  /**\r\n   * \r\n   * @param options \r\n   * @returns \r\n   */\r\n  public getEntity(options: { [bindingPath: string]: string }) {\r\n    const entityTypeInfo = this.frameContext.repository.entityTypeInfo;\r\n    const bindingData = this.frameContext.bindingData;\r\n    const childrenEntityPaths = [];\r\n\r\n    let entity = null;\r\n    if (options['/']) {\r\n      // \r\n      entity = this.frameContext.bindingData.list.findById(options['/']);\r\n      if (entity) {\r\n        entity = entity.toJSON();\r\n      }\r\n    } else {\r\n      entity = this.frameContext.bindingData.list.currentItem.toJSON();\r\n    }\r\n    if (!entity) {\r\n      return null;\r\n    }\r\n    ExpressionUtil.getChildrenEntityPaths(entityTypeInfo, childrenEntityPaths);\r\n    entity['__type__'] = 'Entity';\r\n    if (!childrenEntityPaths || childrenEntityPaths.length < 1) {\r\n      return entity;\r\n    }\r\n    // \r\n    childrenEntityPaths.forEach((paths: string[]) => {\r\n      let row = null;\r\n      if (options && options[paths.join('/')]) {\r\n        const parentPaths = paths.slice(0, 1);\r\n        if (paths.length == 2 && options[parentPaths.join('/')]) {\r\n          const parentRow = options[parentPaths.join('/')];\r\n          // \r\n          // \r\n          row = this.getPropertyValue(entity, parentPaths.concat([parentRow, paths[1], options[paths.join('/')]]));\r\n        } else {\r\n          // bindingData\r\n          const bindingList: BindingList = bindingData.getValue(paths) as BindingList;\r\n          const currentRowId = options[paths.join('/')];\r\n          let currentRow: BindingObject = null;\r\n          if (currentRowId !== bindingList.currentId) {\r\n            currentRow = bindingList.findById(currentRowId);\r\n          } else {\r\n            currentRow = bindingList.currentItem;\r\n          }\r\n          if (currentRow && currentRow.primaryKeyValue) {\r\n            row = currentRow.toJSON();\r\n          }\r\n        }\r\n      } else {\r\n        // \r\n        const parentTableCurrentRowChanged = options && !!Object.keys(options).find(path => {\r\n          const fullPath = path.split('/').join('/');\r\n          return paths.join('/').startsWith(fullPath);\r\n        }) || false;\r\n        if (parentTableCurrentRowChanged) {\r\n          const primaryValue = options && options['/'] || bindingData.list.currentId;\r\n          const entity = this.frameContext.repository.entityCollection.getEntityById(primaryValue);\r\n          const fullPaths = [];\r\n          const data = paths.reduce((object, path) => {\r\n            fullPaths.push(path);\r\n            const item = object && object[path] as EntityList<Entity>;\r\n            if (item) {\r\n              const currentRowId = options && options[fullPaths.join('/')] || item.items[0] && item.items[0].primaryValue || null;\r\n              if (currentRowId) {\r\n                const currentRow = item.get(currentRowId);\r\n                return currentRow || null;\r\n              }\r\n            }\r\n            return null;\r\n          }, entity) as Entity;\r\n          if (data) {\r\n            row = data.toJSON();\r\n          } else {\r\n            row = {};\r\n          }\r\n        } else {\r\n          row = ExpressionUtil.getCurrentRowByPaths(paths, bindingData);\r\n        }\r\n      }\r\n      const propertyName = paths.pop();\r\n      let parent = paths.reduce((object: any, path: string) => {\r\n        return object && object[path] || null;\r\n      }, entity);\r\n      const list = parent[propertyName];\r\n      const node: any = { __items__: [], ...row && row || {}, __type__: 'List' };\r\n      node.length = () => node.__items__.length;\r\n      if (list && Array.isArray(list)) {\r\n        node.__items__ = [].concat(list);\r\n      }\r\n      parent[propertyName] = node;\r\n    });\r\n    return entity;\r\n  }\r\n  private getPropertyValue(entity: any, paths: string[]) {\r\n    return paths.reduce((object: any, path: string) => {\r\n      if (object['__type__'] === 'List') {\r\n        return object['__items__'].find(item => item.id === path);\r\n      } else if (Array.isArray(object)) {\r\n        return object.find(item => item.id === path);\r\n      } else {\r\n        return object && object[path];\r\n      }\r\n    }, entity);\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  protected get entityOriginalNodeCode(): string {\r\n    const repository = this.injector.get(Repository);\r\n    return repository && repository.entityTypeInfo && repository.entityTypeInfo.entityInfo && repository.entityTypeInfo.entityInfo.originalCode || null;\r\n  }\r\n  /**\r\n   * \r\n   * @param event \r\n   * @returns \r\n   */\r\n  public buildStateContext() {\r\n    const result = {};\r\n    if (this.frameContext) {\r\n      const rootFrameContext = this.frameContext.getVirtualRootFrameContext();\r\n      if (rootFrameContext) {\r\n        const uiState = rootFrameContext.viewModel.uiState;\r\n        const propertyNames = Object.getOwnPropertyNames(uiState) || [];\r\n        propertyNames.forEach((prop: string) => {\r\n          if (prop.match(/^[a-zA-Z0-9_\\$]+$/g) !== null) {\r\n            result[prop] = uiState[prop];\r\n          }\r\n        });\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n}","import { Injectable, Injector } from \"@angular/core\";\r\nimport { ExpressionManager } from \"./expression_manager\";;\r\nimport { ExpressionRegistry } from \"./expression_registry\";\r\nimport { ExpressionResult } from \"./expression_result\"\r\nimport { Expression } from \"./types\";\r\n\r\n@Injectable()\r\nexport class ExpressionResultFactory {\r\n  constructor(private injector: Injector, private expressionRegistry: ExpressionRegistry, private expressionManager: ExpressionManager, private expressionResult: ExpressionResult) {\r\n    this.registeEvent();\r\n  }\r\n  private registeEvent() {\r\n    this.expressionRegistry.expressions.subscribe((expressionObjects: Expression.ExpressionObject[]) => {\r\n      // \r\n      expressionObjects.forEach((expressionObject: Expression.ExpressionObject) => {\r\n        if (expressionObject.deps && expressionObject.deps.length > 0) {\r\n          return;\r\n        }\r\n        const result = this.expressionManager.eval(expressionObject.id);\r\n        this.expressionResult[expressionObject.id] = result;\r\n      });\r\n    });\r\n  }\r\n}","import { Injectable, Injector, Inject } from '@angular/core';\r\n// import { FRAME_ID, NAMESPACE } from '../frame/index';\r\nimport { UIState, UIStateObservableParam } from '../ui-state/index';\r\nimport { ChangeListener } from './change_listener';\r\nimport { Expression } from '../expression/index';\r\nimport { BindingData } from '../binding-data/index';\r\nimport { FRAME_ID, NAMESPACE } from '../frame/tokens';\r\ntype EventArgs = Expression.EventArgs;\r\n/**\r\n * UIState\r\n */\r\n@Injectable()\r\nclass UIStateChangeListener extends ChangeListener {\r\n  constructor(private injector: Injector, private uiState: UIState, @Inject(NAMESPACE) private namespace, @Inject(FRAME_ID) private frameId: string, private bindingData: BindingData) {\r\n    super();\r\n    this.registerEvent();\r\n  }\r\n  public buildEventPath(change: UIStateObservableParam): string[] {\r\n    return null;\r\n  }\r\n  private registerEvent() {\r\n    if (this.uiState && this.uiState.changes) {\r\n      this.uiState.changes.subscribe((change: UIStateObservableParam) => {\r\n        const modification: EventArgs = {\r\n          ns: this.namespace,\r\n          path: [change.field],\r\n          type: Expression.EventType.ValueChanged,\r\n          value: change.value,\r\n          source: Expression.EventSource.State,\r\n          frameId: this.frameId\r\n        };\r\n        // console.log(\"UIStateChangeListener\", modification);\r\n        this.subject.next(modification);\r\n      });\r\n    }\r\n  }\r\n}\r\nexport { UIStateChangeListener };\r\n","import { InjectionToken } from '@angular/core';\r\nimport { Expression } from './types';\r\n\r\nexport const ASSIGNER_TOKEN = new InjectionToken<Expression.Assigner>('@Farris expression assigner');\r\nexport const EVENT_HANDLER_TOKEN = new InjectionToken<Expression.IEventHandler>('@Farris_event_handler');","import { Inject, Injectable, Injector } from '@angular/core';\r\nimport { Modification, ModifyType } from '../changeset/index';\r\nimport { Entity } from '../entity';\r\nimport { Repository } from '../repository/index';\r\nimport { ChangeListener } from './change_listener';\r\nimport { Expression } from '../expression/index';\r\nimport { BindingData } from '../binding-data/index';\r\nimport { NAMESPACE } from '../frame/tokens';\r\n\r\ntype EventArgs = Expression.EventArgs;\r\nconst EventType = Expression.EventType;\r\n\r\n@Injectable()\r\nclass RepositoryChangeListener extends ChangeListener {\r\n  private bindingData: BindingData;\r\n  constructor(private injector: Injector, private repository: Repository<Entity>, @Inject(NAMESPACE) private namespace) {\r\n    super();\r\n    this.bindingData = this.injector.get<BindingData>(BindingData, null);\r\n    this.registerEvent();\r\n  }\r\n\r\n  private registerEvent() {\r\n    if (this.repository && this.repository.changes) {\r\n      this.repository.changes.subscribe((change: Modification) => {\r\n        let eventType = this.convertEventType(change);\r\n        if (!eventType) {\r\n          return;\r\n        }\r\n        const path = this.buildEventPath(change);\r\n        const modification: EventArgs = {\r\n          ns: this.namespace,\r\n          type: eventType,\r\n          path: path,\r\n          value: change.value,\r\n          source: Expression.EventSource.Field,\r\n        };\r\n        // console.log(\"RepositoryChangeListener\", modification);\r\n        this.subject.next(modification);\r\n      });\r\n    }\r\n    // repository\r\n    if (this.repository && this.repository.entityCollectionChange) {\r\n      this.repository.entityCollectionChange.subscribe((change: Modification) => {\r\n        let eventType = this.convertEventType(change);\r\n        if (!eventType) {\r\n          return;\r\n        }\r\n        const path = this.buildEventPath(change);\r\n        const modification: EventArgs = {\r\n          ns: this.namespace,\r\n          type: eventType,\r\n          path: path,\r\n          value: change.value,\r\n          source: Expression.EventSource.Repository,\r\n        };\r\n        this.subject.next(modification);\r\n      });\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   * @param event event\r\n   * @description [id,prop] or [id,s,id,] or [id,udt,udt_prop]\r\n   * @returns \r\n   */\r\n  public buildEventPath(event: Modification): string[] {\r\n    const paths = event.path;\r\n    let result = [];\r\n    if (!paths || paths.length < 1) {\r\n      // path\r\n      return result;\r\n    }\r\n    // udtid\r\n    result = paths.filter((path: string, index: number) => {\r\n      if (index % 2 === 0 && path.includes(':')) {\r\n        if (path === ':') {\r\n          return false;\r\n        }\r\n        const primaryKey = path.split(':')[0];\r\n        if (primaryKey !== this.repository.primaryKey) {\r\n          return false;\r\n        }\r\n      }\r\n      return true;\r\n    });\r\n    // id\r\n    // result = paths.map((path: string, index: number) => {\r\n    //   if (path.includes(':') && index % 2 === 0) {\r\n    //     return path.split(':')[1];\r\n    //   }\r\n    //   return path;\r\n    // });\r\n    // result\r\n    return result;\r\n  }\r\n  private convertEventType(change: Modification): Expression.EventType {\r\n    let eventType = null;\r\n    if (change.type === ModifyType.Add || change.type === ModifyType.AddData || change.type === ModifyType.Insert) {\r\n      // eventType = Expression.EventType.Append;\r\n      // \r\n    } else if (change.type === ModifyType.Remove || change.type === ModifyType.RemoveData) {\r\n      // eventType = Expression.EventType.Remove;\r\n    } else if (change.type === ModifyType.Load) {\r\n      // eventType = Expression.EventType.Load;\r\n    } else if (change.type === ModifyType.ValueChange) {\r\n      //eventType = Expression.EventType.ValueChanged;\r\n      // \r\n    } else if (change.type === ModifyType.Update) {\r\n      eventType = Expression.EventType.Update\r\n    }\r\n    return eventType;\r\n  }\r\n}\r\n\r\nexport { RepositoryChangeListener }","import { Inject, Injectable, Injector, Optional } from '@angular/core';\r\nimport { LISTENER_TOKEN } from './tokens';\r\nimport { Expression } from '../expression/index';\r\ntype Listener = Expression.Listener;\r\n@Injectable()\r\nclass ListenerRegistry {\r\n  constructor(@Optional() @Inject(LISTENER_TOKEN) public listeners: Array<Listener>, @Optional() private injector: Injector) {\r\n  }\r\n}\r\nexport { ListenerRegistry };\r\n","import { Inject, Injectable, Injector } from '@angular/core';\r\nimport { BindingData, BindingList, Change, ChangeType } from '../binding-data/index';\r\nimport { ChangeListener } from './change_listener';\r\nimport { Expression } from '../expression/index';\r\nimport { NAMESPACE } from '../frame/index';\r\nimport { Repository } from '../repository/index';\r\n\r\ntype EventArgs = Expression.EventArgs;\r\nconst EventType = Expression.EventType;\r\n/**\r\n * bindingList\r\n * @description \r\n */\r\n@Injectable()\r\nclass BindingDataChangeListener extends ChangeListener {\r\n  private repository: Repository<any> = null;\r\n  constructor(private injector: Injector, private bindingData: BindingData, @Inject(NAMESPACE) private namespace) {\r\n    super();\r\n    this.repository = this.injector.get(Repository, null);\r\n    this.registerEvent();\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private registerEvent() {\r\n    if (this.bindingData && this.bindingData.changes && typeof this.bindingData.changes.subscribe === 'function') {\r\n      this.bindingData.changes.subscribe((change: Change) => {\r\n        if ((change.type === ChangeType.Append && change.isCloned !== true) || change.type === ChangeType.ValueChanged || change.type === ChangeType.Remove || change.type === ChangeType.Load || change.type === ChangeType.SelectionChanged) {\r\n          let eventType = null;\r\n          if (change.type === ChangeType.Append) {\r\n            eventType = EventType.Append;\r\n          } else if (change.type === ChangeType.ValueChanged) {\r\n            eventType = EventType.ValueChanged;\r\n          } else if (change.type === ChangeType.Remove) {\r\n            eventType = EventType.Remove;\r\n          } else if (change.type === ChangeType.Load) {\r\n            // \r\n            if (change.create === true) {\r\n              eventType = EventType.Append;\r\n            } else {\r\n              eventType = EventType.Load;\r\n            }\r\n          } else if (change.type === ChangeType.SelectionChanged) {\r\n            eventType = EventType.SelectionChanged\r\n          }\r\n          const path = this.buildEventPath(change);\r\n          const modification: EventArgs = {\r\n            ns: this.namespace,\r\n            path: path,\r\n            type: eventType,\r\n            source: Expression.EventSource.BindingData,\r\n            value: change.value,\r\n            id: change.id,\r\n            isTreeNodeLoadScene: change.isTreeNodeLoadScene\r\n          };\r\n          // console.log(\"BindingDataChangeListener\", modification);\r\n          this.subject.next(modification);\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  public buildEventPath(change: Change): string[] {\r\n    const path = change.path;\r\n    const paths = [];\r\n    // if (!path || path.length < 1) {\r\n    //   return paths;\r\n    // }\r\n    const primaryValue = this.bindingData.list.currentItem.primaryKeyValue || change.id;\r\n    if (primaryValue) {\r\n      if (!(change.type === ChangeType.Load && change.path.length === 0)) {\r\n        paths.push(`${this.bindingData.list.primaryKey}:${primaryValue}`);\r\n      }\r\n    }\r\n    const currentPath = [];\r\n    for (let index = 0; index < path.length; index++) {\r\n      const propertyName = path[index];\r\n      currentPath.push(propertyName);\r\n      const item = this.bindingData.getValue(currentPath);\r\n      paths.push(propertyName);\r\n      if (item instanceof BindingList) {\r\n        if (currentPath.length < path.length) {\r\n          const bindingList = item as BindingList;\r\n          let currentId = bindingList.currentItem.primaryKeyValue;\r\n          if (index === path.length - 2 && change.id) {\r\n            currentId = change.id;\r\n          }\r\n          paths.push(`${this.bindingData.list.primaryKey}:${currentId}`);\r\n        }\r\n      }\r\n    }\r\n    return paths;\r\n  }\r\n}\r\nexport { BindingDataChangeListener };\r\n","import { Inject, Injectable, Injector, Optional } from '@angular/core';\r\nimport { Observable, Subject } from 'rxjs';\r\nimport { ListenerRegistry } from './listener_registry';\r\nimport { Expression } from '../expression/index';\r\n\r\ntype EventArgs = Expression.EventArgs;\r\ntype Listener = Expression.Listener;\r\n\r\n/**\r\n * \r\n * @description bindingListUIState\r\n */\r\n@Injectable()\r\nclass Listeners {\r\n  private subject: Subject<EventArgs> = new Subject<EventArgs>();\r\n  public get onEvent(): Observable<EventArgs> {\r\n    return this.subject;\r\n  }\r\n  constructor(@Optional() private registry: ListenerRegistry) {\r\n    this.regist();\r\n  }\r\n  private regist() {\r\n    const listeners = this.registry && this.registry.listeners || [];\r\n    if (listeners && listeners.length > 0) {\r\n      listeners.forEach((listener: Listener) => {\r\n        listener.onEvent.subscribe((modification: EventArgs) => {\r\n          this.subject.next(modification);\r\n        });\r\n      });\r\n    }\r\n  }\r\n}\r\nexport { Listeners };\r\n","import { Injectable } from \"@angular/core\";\r\nimport { BehaviorSubject, Observable } from \"rxjs\";\r\nimport { Listeners } from \"../listener/index\";\r\nimport { Expression } from \"./types\";\r\n/**\r\n * \r\n * 1\r\n * 2\r\n *    \r\n * 3\r\n */\r\n@Injectable()\r\nexport class ExpressionEventEmitter {\r\n  private onEvent: BehaviorSubject<Array<Expression.EventArgs>>;\r\n  private events: Array<Expression.EventArgs>;\r\n  constructor(private listeners: Listeners) {\r\n    this.events = new Array<Expression.EventArgs>();\r\n    this.listeners.onEvent.subscribe((eventArgs: Expression.EventArgs) => {\r\n      if (this.onEvent && this.onEvent.observers.length > 0) {\r\n        let events = [];\r\n        if (this.events.length > 0) {\r\n          events = [...this.events];\r\n        }\r\n        events.push(eventArgs);\r\n        this.onEvent.next(events);\r\n        this.events = [];\r\n      } else {\r\n        this.events.push(eventArgs);\r\n      }\r\n    });\r\n  }\r\n  public attach(): Observable<Array<Expression.EventArgs>> {\r\n    if (!this.onEvent) {\r\n      this.onEvent = new BehaviorSubject<Array<Expression.EventArgs>>(this.events);\r\n    }\r\n    return this.onEvent.asObservable();\r\n  }\r\n}","import { InjectionToken } from '@angular/core';\r\nimport { Expression } from '../expression/index';\r\n\r\nexport const EFFECTOR_TOKEN = new InjectionToken<Expression.Effector>('@farris/effector_token');\r\n\r\n","import { Inject, Injectable, Injector } from '@angular/core';\r\nimport { BindingData } from '../binding-data/index';\r\nimport { Entity, EntityList } from '../entity/index';\r\nimport { Expression } from '../expression/index';\r\nimport { NAMESPACE } from '../frame/tokens';\r\nimport { Repository } from '../repository/index';\r\n/**\r\n * \r\n * @description \r\n */\r\n@Injectable()\r\nexport class RepositoryEffector implements Expression.Effector {\r\n  public ns: string;\r\n  constructor(private injector: Injector, private repository: Repository<Entity>, @Inject(NAMESPACE) private namespace, private bindingData: BindingData) {\r\n    this.ns = namespace;\r\n  }\r\n\r\n  public effect(path: string, value: any, options: Expression.EffectOptions) {\r\n    if (!options || !options.path) {\r\n      throw new Error('repository effector ');\r\n    }\r\n    const propertyPath = options.path;\r\n    const rowId = propertyPath[0] || this.bindingData.list.currentItem.primaryKeyValue;\r\n    let entity = this.repository.entityCollection.getEntityById(rowId);\r\n    if (rowId && !entity) {\r\n      return;\r\n    }\r\n    // propertyPath like : [1, child1s, 1.1, child2s, 1.1.1,propName] or [1,udt,propName] or [1,prop]\r\n    const propName = propertyPath.pop();\r\n    let object: any = entity;\r\n    for (let index = 1; index < propertyPath.length; index++) {\r\n      const propertyName = propertyPath[index];\r\n      if (object instanceof EntityList) {\r\n        object = object.get(propertyName);\r\n      } else {\r\n        object = object[propertyName];\r\n      }\r\n    }\r\n    if (object) {\r\n      if (object[propName] !== value) {\r\n        object[propName] = value;\r\n      }\r\n    } else {\r\n      // console.error(`${propertyPath.push(propName)}`);\r\n    }\r\n  }\r\n}","import { Inject, Injectable, Injector } from '@angular/core';\r\nimport { Expression } from '../expression/index';\r\nimport { NAMESPACE } from '../frame/tokens';\r\nimport { UIState } from '../ui-state/index';\r\n\r\n@Injectable()\r\nexport class UIStateEffector implements Expression.Effector {\r\n  public ns: string;\r\n  constructor(private injector: Injector, private uiState: UIState, @Inject(NAMESPACE) private namespace) {\r\n    this.ns = namespace;\r\n  }\r\n  public effect(path: string, value: any, options: Expression.EffectOptions) {\r\n    this.uiState.setPropertyValue(path, value);\r\n  }\r\n}","import { Inject, Injectable, Injector } from '@angular/core';\r\nimport { Expression } from '../expression/index';\r\nimport { FrameContext, NAMESPACE } from '../frame/index';\r\n\r\n/**\r\n * \r\n */\r\n@Injectable()\r\nexport class ReadonlyEffector implements Expression.Effector {\r\n  public ns: string;\r\n  constructor(private injector: Injector, @Inject(NAMESPACE) private namespace, private frameContext: FrameContext) {\r\n    this.ns = namespace;\r\n  }\r\n  public effect(path: string, value: any, options: Expression.EffectOptions) {\r\n    // suprise ?\r\n  }\r\n}","import { Inject, Injectable, Injector } from '@angular/core';\r\nimport { BindingData } from '../binding-data/index';\r\nimport { Entity, EntityList } from '../entity/index';\r\nimport { Expression } from '../expression/index';\r\nimport { NAMESPACE } from '../frame/tokens';\r\nimport { Repository } from '../repository/index';\r\n\r\n/**\r\n * \r\n * @description true\r\n * value==truenullnull\r\n */\r\n@Injectable()\r\nexport class DependencyEffector implements Expression.Effector {\r\n  public ns: string;\r\n  constructor(private injector: Injector, private repository: Repository<Entity>, @Inject(NAMESPACE) private namespace, private bindingData: BindingData) {\r\n    this.ns = namespace;\r\n  }\r\n  public effect(path: string, value: boolean, options: Expression.EffectOptions) {\r\n    if (!options || !options.path) {\r\n      throw new Error('DependencyEffector ');\r\n    }\r\n    if (typeof value !== 'boolean') {\r\n      console.warn(`DependencyEffector true/false${value}`);\r\n    }\r\n    const propertyPath = options.path;\r\n    const rowId = propertyPath[0] || this.bindingData.list.currentItem.primaryKeyValue;\r\n    let entity = this.repository.entityCollection.getEntityById(rowId);\r\n    if (rowId && !entity) {\r\n      throw new Error(`id${rowId}`);\r\n    }\r\n    // propertyPath like : [1, child1s, 1.1, child2s, 1.1.1,propName] or [1,udt,propName] or [1,prop]\r\n    const propName = propertyPath.pop();\r\n    let object: any = entity;\r\n    for (let index = 1; index < propertyPath.length; index++) {\r\n      const propertyName = propertyPath[index];\r\n      if (object instanceof EntityList) {\r\n        object = object.get(propertyName);\r\n      } else {\r\n        object = object[propertyName];\r\n      }\r\n    }\r\n    if (object) {\r\n      if (object[propName] !== null && value === true) {\r\n        object[propName] = null;\r\n      }\r\n    } else {\r\n      throw new Error(`[DependencyEffector] ${propertyPath.push(propName)}`);\r\n    }\r\n  }\r\n\r\n}","import { Inject, Injectable, Injector, Optional } from '@angular/core';\r\nimport { Expression } from '../expression/index';\r\nimport { EFFECTOR_TOKEN } from './tokens';\r\n\r\n@Injectable()\r\nexport class EffectorRegistry {\r\n  constructor(private injector: Injector, @Optional() @Inject(EFFECTOR_TOKEN) public effectors: Array<Expression.Effector>) { }\r\n}\r\n","import { Inject, Injectable, Injector } from '@angular/core';\r\nimport { Expression } from '../expression/index';\r\nimport { NAMESPACE } from '../frame/index';\r\nimport { MESSAGE_SERVICE_TOKEN, NOTIFY_SERVICE_TOKEN, IMessageService, INotifyService } from '../core/index';\r\n\r\n@Injectable()\r\nexport class RelativeEffector implements Expression.Effector {\r\n  public ns: string;\r\n  constructor(private injector: Injector, @Inject(MESSAGE_SERVICE_TOKEN) private messageService: IMessageService, @Inject(NOTIFY_SERVICE_TOKEN) private notifyService: INotifyService, @Inject(NAMESPACE) private namespace) {\r\n    this.ns = namespace;\r\n  }\r\n\r\n  public effect(path: string, value: any, options: Expression.EffectOptions) {\r\n    if (value === true && options.message && this.notifyService) {\r\n      const messageType = options.messageType || 'info';\r\n      this.notifyService[messageType](options.message, { hideTitle: true });\r\n    }\r\n  }\r\n}","import { Inject, Injectable, Injector } from '@angular/core';\r\nimport { Expression } from '../expression/index';\r\nimport { FrameContext } from '../frame/frame_context';\r\nimport { MESSAGE_SERVICE_TOKEN, NOTIFY_SERVICE_TOKEN, IMessageService, INotifyService, ComponentType } from '../core/index';\r\nimport { NgFormControl } from '../form/decorators';\r\nimport { RuleType } from '../form/index';\r\nimport { NAMESPACE } from '../frame/tokens';\r\n\r\n@Injectable()\r\nexport class ValidateEffector implements Expression.Effector {\r\n  public ns: string;\r\n  constructor(\r\n    private injector: Injector,\r\n    @Inject(MESSAGE_SERVICE_TOKEN) private messageService: IMessageService,\r\n    @Inject(NOTIFY_SERVICE_TOKEN) private notifyService: INotifyService,\r\n    @Inject(NAMESPACE) private namespace,\r\n    private frameContext: FrameContext\r\n  ) {\r\n    this.ns = namespace;\r\n  }\r\n  public effect(path: string, value: any, options: Expression.EffectOptions) {\r\n    // false\r\n    const domInfo: any = this.getDomInfoByEntityPath(path);\r\n    if (!domInfo) {\r\n      return;\r\n    }\r\n    const frameContext = domInfo.frameContext;\r\n    const rootFrameContext = frameContext && frameContext.getVirtualRootFrameContext();\r\n    // const rootViewModel = rootFrameContext.viewModel;\r\n    const expressionId = options.expressionId;\r\n    const domPropertyName = domInfo.domPropertyName;\r\n    if (expressionId) {\r\n      // \r\n      frameContext.form.addFieldValidateRule(domPropertyName, options.message, expressionId, RuleType.Validate);\r\n    }\r\n    if (value === false && options.message) {\r\n      // form\r\n      // grid\r\n      if (!domInfo.isGridComponent) {\r\n        const message = options.message.replace(/\\$property/g, domInfo.propertyName)\r\n        const formErrors = this.buildFormErrors(domPropertyName, message);\r\n        // // \r\n        frameContext.form.updateFormErrors(formErrors);\r\n      } else {\r\n        // if (expressionId) {\r\n        //   // \r\n        //   frameContext.form.addFieldValidateRule(domPropertyName, options.message, expressionId, RuleType.Validate);\r\n        // }\r\n      }\r\n      // \r\n      // const verifyInformations = this.buildVerifyInformations(domInfo.id, frameContext, domInfo.domPropertyName, options.message);\r\n      // \r\n      // rootViewModel.verifycationChanged.next(verifyInformations);\r\n      // \r\n    } else if (value === true) {\r\n      // \r\n      // const verifyInformations = this.removeValidateVerifyInformations(domInfo.id, this.frameContext);\r\n      // rootViewModel.verifycationChanged.next(verifyInformations);\r\n      const currentErrors = frameContext.form.getFormControlErrors(domPropertyName) || null;\r\n      if (currentErrors) {\r\n        if (currentErrors.hasOwnProperty('validate')) {\r\n          // requirerequire\r\n          delete currentErrors.validate;\r\n        }\r\n        frameContext.form.updateFormErrors({ [domPropertyName]: { errors: currentErrors } });\r\n      } else {\r\n        const formErrors = this.buildFormErrors(domPropertyName, null);\r\n        frameContext.form.updateFormErrors(formErrors);\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * dom\r\n   * @param entityPath \r\n   * @returns \r\n   */\r\n  private getDomInfoByEntityPath(entityPath: string): { domPropertyName: string, frameContext: FrameContext, id: string, isGridComponent: boolean } {\r\n    let result = null;\r\n    if (!entityPath) {\r\n      return result;\r\n    }\r\n    entityPath = entityPath.split('/').filter(p => p).join('.');\r\n    const frameContexts = this.frameContext && this.frameContext.appContext.frameContextManager.getFrameContextsByNamespace(this.namespace) || null;\r\n    if (frameContexts && frameContexts.length > 0) {\r\n      for (const frameContext of frameContexts) {\r\n        if (result) {\r\n          break;\r\n        }\r\n\r\n        const isValidFrameContext = frameContext && frameContext.form && frameContext.form.ngFormControls && Object.keys(frameContext.form.ngFormControls).length > 0\r\n        if (frameContext && frameContext.form && frameContext.form.ngFormControls && Object.keys(frameContext.form.ngFormControls).length > 0) {\r\n          const keys = Object.keys(frameContext.form.ngFormControls);\r\n          for (const propertyName of keys) {\r\n            const ngFormControl: NgFormControl = frameContext.form.ngFormControls[propertyName];\r\n            let bindingPath = frameContext.viewModel.bindingPath || '/';\r\n            const bindingPaths = bindingPath.split('/').filter(p => p);\r\n            let bindings = ngFormControl.binding.split('.');\r\n            bindings = bindingPaths.concat(bindings);\r\n            if (entityPath === bindings.join('.')) {\r\n              // \r\n              const dgColumnNames = frameContext.viewModel['dataGridColumnsName'] || null;\r\n              const dgColumnInfo: Array<Array<any>> = frameContext.viewModel[dgColumnNames] || null;\r\n              if (dgColumnInfo && Array.isArray(dgColumnInfo) && dgColumnInfo.length > 0) {\r\n                const isEditableGrid = dgColumnInfo.find((array: Array<any>) => {\r\n                  const readonlyGroup = array.every((column: any) => !(column.hasOwnProperty('editor') && column.editor));\r\n                  if (!readonlyGroup) {\r\n                    return true;\r\n                  } else {\r\n                    return false;\r\n                  }\r\n                });\r\n                if (!isEditableGrid) {\r\n                  continue;\r\n                }\r\n              }\r\n              // farris\r\n              const isFarrisTreeTableComponent = frameContext && frameContext.frameComponent && frameContext.frameComponent.componentType === ComponentType.farrisTreeTalbeComponent;\r\n              if (isFarrisTreeTableComponent) {\r\n                continue;\r\n              }\r\n              let isGridComponent = false;\r\n              if (dgColumnNames) {\r\n                isGridComponent = true;\r\n              }\r\n              result = {\r\n                domPropertyName: propertyName,\r\n                propertyName: ngFormControl.name || ngFormControl.defaultI18nValue,\r\n                frameContext,\r\n                id: ngFormControl.id,\r\n                isGridComponent\r\n              };\r\n              break;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n  private getVerifyInformations(frameContext: FrameContext) {\r\n    const rootFrameContext = frameContext && frameContext.getVirtualRootFrameContext();\r\n    const rootViewModel = rootFrameContext.viewModel;\r\n    const verifyInformations = rootViewModel.verifyInformations;\r\n    return verifyInformations;\r\n  }\r\n  private buildFormErrors(domPropertyName: string, message: string) {\r\n    if (message) {\r\n      message = message.replace(/\\$property/g, 'domPropertyName');\r\n      return {\r\n        [domPropertyName]: {\r\n          errors: {\r\n            'validate': {\r\n              name: message\r\n            }\r\n          }\r\n        }\r\n      };\r\n    } else {\r\n      return {\r\n        [domPropertyName]: {\r\n          errors: {}\r\n        }\r\n      };\r\n    }\r\n  }\r\n  private buildVerifyInformations(id: string, frameContext: FrameContext, domPropertyName: string, message: string) {\r\n    const verifyInformations = this.getVerifyInformations(frameContext);\r\n    const index = verifyInformations.findIndex((item: any) => {\r\n      return item.id === id\r\n    });\r\n    if (index !== -1) {\r\n      verifyInformations.splice(index, 1);\r\n    }\r\n    verifyInformations.push({\r\n      id: id,\r\n      namespace: frameContext.namespace,\r\n      targetField: domPropertyName,\r\n      index: verifyInformations.length + 1,\r\n      title: frameContext.form.formGroupName,\r\n      msg: message,\r\n      type: 'error'\r\n    });\r\n    return verifyInformations;\r\n  }\r\n  private removeValidateVerifyInformations(id: string, frameContext: FrameContext) {\r\n    const verifyInformations = this.getVerifyInformations(frameContext);\r\n    const index = verifyInformations.findIndex((item: any) => {\r\n      return item.id === id\r\n    });\r\n    if (index !== -1) {\r\n      verifyInformations.splice(index, 1);\r\n    }\r\n    return verifyInformations;\r\n  }\r\n}","import { Inject, Injectable, Injector } from '@angular/core';\r\nimport { ComponentType } from '../core/index';\r\nimport { Entity } from '../entity/index';\r\nimport { Expression } from '../expression/index';\r\nimport { NgFormControl, RuleType } from '../form/index';\r\nimport { FrameContext, NAMESPACE } from \"../frame/index\";\r\nimport { Translate, TranslateToken } from '../i18n';\r\nimport { Repository } from '../repository/index';\r\n\r\n/**\r\n * \r\n * @description true\r\n */\r\n@Injectable()\r\nexport class RequiredEffector implements Expression.Effector {\r\n  public ns: string;\r\n  constructor(private injector: Injector, private repository: Repository<Entity>, @Inject(NAMESPACE) private namespace, private frameContext: FrameContext) {\r\n    this.ns = namespace;\r\n  }\r\n  public effect(path: string, value: any, options: Expression.EffectOptions) {\r\n    // false\r\n    const domInfo: any = this.getDomInfoByEntityPath(path);\r\n    if (!domInfo) {\r\n      return;\r\n    }\r\n    const frameContext: FrameContext = domInfo.frameContext;\r\n    const rootFrameContext = frameContext && frameContext.getVirtualRootFrameContext();\r\n    const rootViewModel = rootFrameContext.viewModel;\r\n    const domPropertyName = domInfo.domPropertyName;\r\n    const pathValue = this.frameContext.bindingData.getValue(path.split('/').filter(p => p));\r\n    const expressionId = options.expressionId;\r\n    if (expressionId) {\r\n      // \r\n      frameContext.form.addFieldValidateRule(domPropertyName, options.message, expressionId, RuleType.Require);\r\n    }\r\n    if (value === true) {\r\n      if (options.message) {\r\n        // form\r\n        // grid\r\n        if (!domInfo.isGridComponent) {\r\n          const message = options.message.replace(/\\$property/g, domInfo.propertyName);\r\n          const formErrors = this.buildFormErrors(domPropertyName, message);\r\n          const isValidValue = this.isValidValue(path, pathValue);\r\n          if (!isValidValue) {\r\n            frameContext.form.updateFormErrors(formErrors);\r\n          }\r\n        } else {\r\n          this.updateColumnValidators(frameContext, domInfo.binding, domInfo.datagridColumns, true);\r\n        }\r\n      }\r\n    } else {\r\n      // true\r\n      if (domInfo.isGridComponent) {\r\n        this.updateColumnValidators(frameContext, domInfo.binding, domInfo.datagridColumns, false);\r\n      } else {\r\n        const currentErrors = frameContext.form.getFormControlErrors(domPropertyName) || null;\r\n        if (currentErrors) {\r\n          if (currentErrors.hasOwnProperty('require')) {\r\n            // requirerequire\r\n            delete currentErrors.require;\r\n          }\r\n          frameContext.form.updateFormErrors({ [domPropertyName]: { errors: currentErrors } });\r\n        } else {\r\n          const formErrors = this.buildFormErrors(domPropertyName, null);\r\n          frameContext.form.updateFormErrors(formErrors);\r\n        }\r\n\r\n      }\r\n    }\r\n  }\r\n  private updateColumnValidators(frameContext: FrameContext, field: string, datagridColumns: any[][], isRequired: boolean) {\r\n    const frameId = frameContext.frameId;\r\n    const componentRefs = frameContext.appContext.componentManager.get([frameId]) as Map<string, any>;\r\n    if (componentRefs && componentRefs.size > 0) {\r\n      const datagrid = Array.from(componentRefs.values())[0];\r\n      if (datagrid && typeof datagrid.updateColumn === 'function') {\r\n        const columns = datagridColumns.find((array: any[]) => {\r\n          return array.find(item => item.field === field);\r\n        });\r\n        const column = columns && columns.find(item => item.field === field) || null;\r\n        if (column) {\r\n          const validators: any[] = column.validators || [];\r\n          const index = validators.findIndex(item => item.type === 'required');\r\n          if (isRequired) {\r\n            if (index === -1) {\r\n              validators.push({ \"type\": \"required\", \"message\": \"\" });\r\n            }\r\n          } else {\r\n            if (index !== -1) {\r\n              validators.splice(index, 1);\r\n            }\r\n          }\r\n          datagrid.updateColumn(field, { validators: [...validators] });\r\n          datagrid.columnsChanged(false);\r\n        }\r\n      }\r\n    }\r\n  }\r\n  private getDomInfoByEntityPath(entityPath: string): { domPropertyName: string, frameContext: FrameContext, id: string, isGridComponent: boolean, binding: string, datagridColumns: any[][] } {\r\n    let result = null;\r\n    if (!entityPath) {\r\n      return result;\r\n    }\r\n    entityPath = entityPath.split('/').filter(p => p).join('.');\r\n    const frameContexts = this.frameContext && this.frameContext.appContext.frameContextManager.getFrameContextsByNamespace(this.namespace) || null;\r\n    if (frameContexts && frameContexts.length > 0) {\r\n      for (const frameContext of frameContexts) {\r\n        if (result) {\r\n          break;\r\n        }\r\n        if (frameContext && frameContext.form && frameContext.form.ngFormControls && Object.keys(frameContext.form.ngFormControls).length > 0) {\r\n          const keys = Object.keys(frameContext.form.ngFormControls);\r\n          for (const propertyName of keys) {\r\n            const ngFormControl: NgFormControl = frameContext.form.ngFormControls[propertyName];\r\n            let bindingPath = frameContext.viewModel.bindingPath || '/';\r\n            const bindingPaths = bindingPath.split('/').filter(p => p);\r\n            let bindings = ngFormControl.binding.split('.');\r\n            bindings = bindingPaths.concat(bindings);\r\n            if (entityPath === bindings.join('.')) {\r\n              // \r\n              const dgColumnNames = frameContext.viewModel['dataGridColumnsName'] || null;\r\n              const dgColumnInfo: Array<Array<any>> = frameContext.viewModel[dgColumnNames] || null;\r\n              if (dgColumnInfo && Array.isArray(dgColumnInfo) && dgColumnInfo.length > 0) {\r\n                const isEditableGrid = dgColumnInfo.find((array: Array<any>) => {\r\n                  const readonlyGroup = array.every((column: any) => !(column.hasOwnProperty('editor') && column.editor));\r\n                  if (!readonlyGroup) {\r\n                    return true;\r\n                  } else {\r\n                    return false;\r\n                  }\r\n                });\r\n                if (!isEditableGrid) {\r\n                  continue;\r\n                }\r\n              }\r\n              // farris\r\n              const isFarrisTreeTableComponent = frameContext && frameContext.frameComponent && frameContext.frameComponent.componentType === ComponentType.farrisTreeTalbeComponent;\r\n              if (isFarrisTreeTableComponent) {\r\n                continue;\r\n              }\r\n              let isGridComponent = false;\r\n              if (dgColumnNames) {\r\n                isGridComponent = true;\r\n              }\r\n              result = {\r\n                domPropertyName: propertyName,\r\n                propertyName: ngFormControl.name || ngFormControl.defaultI18nValue,\r\n                frameContext,\r\n                id: ngFormControl.id,\r\n                isGridComponent,\r\n                binding: ngFormControl.binding,\r\n                datagridColumns: dgColumnInfo\r\n              };\r\n              break;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n  private getDataPropInfo(path: string) {\r\n    if (!path) {\r\n      return null;\r\n    }\r\n    const paths = path.split('/').filter(p => p);\r\n    return this.frameContext.repository.entityTypeInfo.getPropInfoByPath(paths);\r\n  }\r\n  private isValidValue(path: string, value: any) {\r\n    const dataTypeInfo = this.getDataPropInfo(path);\r\n    if (dataTypeInfo && dataTypeInfo.metadataInfo && dataTypeInfo.metadataInfo.enableMultiLangInput === true) {\r\n      // \r\n      const translate = this.injector.get<Translate>(TranslateToken, null);\r\n      const currentLanguage = translate && translate.getCurrentLanguage() || 'zh-CHS';\r\n      if (Object.keys(value).length < 1) {\r\n        return false;\r\n      }\r\n      return !!value[currentLanguage];\r\n    } else if (value === null || value === '' || value === undefined) {\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n  private buildFormErrors(domPropertyName: string, message: string) {\r\n    if (message) {\r\n      return {\r\n        [domPropertyName]: {\r\n          errors: {\r\n            'require': {\r\n              name: message\r\n            }\r\n          }\r\n        }\r\n      };\r\n    } else {\r\n      return {\r\n        [domPropertyName]: {\r\n          errors: {}\r\n        }\r\n      };\r\n    }\r\n  }\r\n}","import { Inject, Injectable, Injector } from '@angular/core';\r\nimport { Expression } from '../expression/index';\r\nimport { FrameContext, NAMESPACE } from '../frame/index';\r\nimport { Repository } from '../repository/index';\r\nimport { ExpressionUtil } from '../utils/expression_util';\r\n\r\n@Injectable()\r\nexport class VisibleEffector implements Expression.Effector {\r\n  public ns: string;\r\n  constructor(\r\n    private injector: Injector,\r\n    @Inject(NAMESPACE) private namespace,\r\n    private frameContext: FrameContext,\r\n    private repository: Repository<any>) {\r\n    this.ns = namespace;\r\n  }\r\n  public effect(path: string, value: any, options: Expression.EffectOptions) {\r\n    // ignore\r\n    const paths = path.split('/').filter(p => p);\r\n    const bindingPaths = this.getTablePaths(paths);\r\n    const bindingPath = bindingPaths.join('/');\r\n    // \r\n    if (bindingPaths && bindingPaths.length > 0) {\r\n      const isGridComponent = this.isGridComponent(bindingPath);\r\n      if (isGridComponent) {\r\n        const datagridComponent = this.getDatagridComponent(bindingPath);\r\n        if (datagridComponent) {\r\n          // \r\n          // datagridComponent.columnsChanged();\r\n          const fieldPaths = this.getPropertyPaths(paths);\r\n          if (fieldPaths) {\r\n            const field = fieldPaths.join('.');\r\n            if (value) {\r\n              datagridComponent.showColumn(field, false);\r\n            } else {\r\n              datagridComponent.hideColumn(field, false);\r\n            }\r\n          }\r\n        }\r\n      }\r\n    } else {\r\n      const datagridComponent = this.getDatagridComponent(bindingPath);\r\n      if (datagridComponent) {\r\n        datagridComponent.columnsChanged(false);\r\n      }\r\n    }\r\n  }\r\n  private getTablePaths(paths: string[]): string[] {\r\n    const entityPaths = ExpressionUtil.getAvailableChildrenPathsFromEntityPaths(paths, this.repository.entityTypeInfo);\r\n    return entityPaths;\r\n  }\r\n  private getDatagridComponent(bindingPath: string) {\r\n    const frameContexts: FrameContext[] = this.frameContext.appContext.frameContextManager.getFrameContextsByNamespace(this.namespace) || [];\r\n    const matchedFrameContexts = frameContexts.filter((frameContext: FrameContext) => frameContext.viewModel && frameContext.viewModel.bindingPath.split('/').filter(p => p).toString() === bindingPath.split('/').filter(p => p).toString());\r\n    let result = null;\r\n    if (matchedFrameContexts) {\r\n      matchedFrameContexts.every((frameContext: FrameContext) => {\r\n        const frameId = frameContext.frameId;\r\n        const componentsMap = this.frameContext.appContext.componentManager.getComponentsByFrameId(frameId);\r\n        if (!componentsMap) {\r\n          return true;\r\n        }\r\n        const datagridComponent = Array.from(componentsMap.values()).find((component: any) => component && component['__component_type__'] === 'DatagridComponent');\r\n        if (datagridComponent) {\r\n          result = datagridComponent;\r\n          return false;\r\n        } else {\r\n          return true;\r\n        }\r\n      });\r\n    }\r\n    return result;\r\n  }\r\n  private getPropertyPaths(paths: string[]) {\r\n    const tablePaths = ExpressionUtil.getAvailableChildrenPathsFromEntityPaths(paths, this.repository.entityTypeInfo);\r\n    return paths.slice(tablePaths.length);\r\n  }\r\n  private isGridComponent(bindingPath: string) {\r\n    const frameContexts: FrameContext[] = this.frameContext.appContext.frameContextManager.getFrameContextsByNamespace(this.namespace) || [];\r\n    const frameContext = frameContexts.find((frameContext: FrameContext) => frameContext.viewModel && frameContext.viewModel.bindingPath.split('/').filter(p => p).toString() === bindingPath.split('/').filter(p => p).toString());\r\n    if (frameContext) {\r\n      return !!frameContext.viewModel['dataGridColumnsName'];\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n}","import { Expression } from '../expression/index';\r\nimport { Injectable, Injector } from '@angular/core';\r\nimport { EffectorRegistry } from './effector_registry';\r\nimport { RepositoryEffector } from './repository_effector';\r\nimport { UIStateEffector } from './uistate_effector';\r\nimport { ReadonlyEffector } from './readonly_effector';\r\nimport { DependencyEffector } from './dependency_effector';\r\nimport { RelativeEffector } from './relative_effector';\r\nimport { ValidateEffector } from './validate_effector';\r\nimport { RequiredEffector } from './required_effector';\r\nimport { VisibleEffector } from './visible_effector';\r\n// import { Core } from '../core/index';\r\n\r\n@Injectable()\r\nexport class EffectorFactory {\r\n  constructor(private injector: Injector, private effectorRegistry: EffectorRegistry) { }\r\n  public getEffector(expressionObject: Expression.ExpressionObject) {\r\n    const path = expressionObject.path;\r\n    const ns = expressionObject.ns;\r\n    const bindingType = expressionObject.bindingType;\r\n    const type = expressionObject.type;\r\n    const nsEffectors = this.effectorRegistry.effectors.filter((effector: Expression.Effector) => effector.ns == ns);\r\n    // \r\n    if (type === Expression.ExpressionType.Compute) {\r\n      if (bindingType === Expression.ExpressionBindingType.Field) {\r\n        return nsEffectors.find((effector: Expression.Effector) => effector instanceof RepositoryEffector);\r\n      } else if (bindingType === Expression.ExpressionBindingType.State) {\r\n        return nsEffectors.find((effector: Expression.Effector) => effector instanceof UIStateEffector);\r\n      } else {\r\n        throw new Error(`${bindingType}`);\r\n      }\r\n    } else if (type === Expression.ExpressionType.Readonly) {\r\n      // \r\n      return nsEffectors.find((effector: Expression.Effector) => effector instanceof ReadonlyEffector);\r\n    } else if (type === Expression.ExpressionType.Dependency) {\r\n      // \r\n      return nsEffectors.find((effector: Expression.Effector) => effector instanceof DependencyEffector);\r\n    } else if (type === Expression.ExpressionType.Relative) {\r\n      // \r\n      return nsEffectors.find((effector: Expression.Effector) => effector instanceof RelativeEffector);\r\n    } else if (type === Expression.ExpressionType.Validate) {\r\n      // \r\n      return nsEffectors.find((effector: Expression.Effector) => effector instanceof ValidateEffector);\r\n    } else if (type === Expression.ExpressionType.Required) {\r\n      // \r\n      return nsEffectors.find((effector: Expression.Effector) => effector instanceof RequiredEffector);\r\n    } else if (type === Expression.ExpressionType.Visible) {\r\n      // \r\n      return nsEffectors.find((effector: Expression.Effector) => effector instanceof VisibleEffector);\r\n    } else {\r\n      // Core.warn(`EffectorFactory  ${type}`);\r\n      return null;\r\n    }\r\n  }\r\n}\r\n","import { Injectable, Injector } from '@angular/core';\r\nimport { AppContext } from '../app/index';\r\nimport { BindingData, BindingList, BindingObject } from '../binding-data/index';\r\nimport { DataPropInfo } from '../core/index';\r\nimport { EffectorFactory } from '../effector/index';\r\nimport { BigNumber } from 'bignumber.js';\r\nimport { Expression, ExpressionExecutor, ExpressionRegistry, ExpressionResult } from '../expression/index';\r\nimport { Repository } from '../repository/index';\r\nimport { Entity, EntityList } from '../entity/index';\r\nimport { FrameContext } from '../frame';\r\nimport { ExpressionUtil } from '../utils/expression_util';\r\nimport { Translate } from '../i18n/translate';\r\nimport { TranslateToken } from '../i18n/translate_token';\r\n\r\n@Injectable()\r\nexport abstract class EventHandler implements Expression.IEventHandler {\r\n  protected frameContext: FrameContext;\r\n  constructor(protected injector: Injector, protected repository: Repository<any>, protected bindingData: BindingData, protected expressionRegistry: ExpressionRegistry, protected effectorFactory: EffectorFactory, protected expressionExecutor: ExpressionExecutor, protected expressionResult: ExpressionResult) {\r\n    this.frameContext = this.injector.get<FrameContext>(FrameContext);\r\n  }\r\n  public expressionObjects: Expression.ExpressionObject[];\r\n\r\n  public handleEvent(event: Expression.EventArgs, expressionObjects: Expression.ExpressionObject[]) {\r\n    event = Object.assign({}, event);\r\n    this.expressionObjects = expressionObjects;\r\n    this.dispatch(event);\r\n  }\r\n\r\n  //#region \r\n  /**\r\n   * \r\n   * @param event event\r\n   */\r\n  public abstract filter(event: Expression.EventArgs);\r\n  /**\r\n   * \r\n   * @param expressionObject \r\n   * @param event \r\n   */\r\n  public abstract dispatch(event: Expression.EventArgs): void;\r\n  //#endregion\r\n\r\n  //#region \r\n\r\n  /**\r\n   * \r\n   */\r\n  protected get primaryValue() {\r\n    return this.bindingData.list.currentItem.primaryKeyValue;\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  protected get entityOriginalNodeCode(): string {\r\n    return this.repository && this.repository.entityTypeInfo && this.repository.entityTypeInfo.entityInfo && this.repository.entityTypeInfo.entityInfo.originalCode || null;\r\n  }\r\n\r\n  //#endregion\r\n\r\n  //#region \r\n  /**\r\n   * \r\n   * @param expression \r\n   * @param context \r\n   * @returns any\r\n   */\r\n  public perform(expressionObject: Expression.ExpressionObject, context: any) {\r\n    return this.expressionExecutor.compile(expressionObject, context);\r\n  }\r\n  /**\r\n   * \r\n   * @param event event\r\n   * @param expressionObject expressionObject\r\n   */\r\n  public effect(event: Expression.EventArgs, expressionObject: Expression.ExpressionObject): void {\r\n    const effectTo = expressionObject.bindingType;\r\n    const effector = this.effectorFactory.getEffector(expressionObject);\r\n    if (!effector) {\r\n      // console.warn(`EventHandler ${expressionObject.type}`);\r\n      return;\r\n    }\r\n    if (effectTo === Expression.ExpressionBindingType.Field) {\r\n      const effectPaths = expressionObject.effectPaths || [];\r\n      if (effectPaths.length > 0) {\r\n        effectPaths.forEach((path: string) => {\r\n          const effectPath = path.split('/');\r\n          const effectOptions = { path: effectPath, message: expressionObject.message, expressionId: expressionObject.id };\r\n          effector.effect(expressionObject.path, expressionObject.result, effectOptions);\r\n        });\r\n      } else if (expressionObject.type === Expression.ExpressionType.Required || expressionObject.type === Expression.ExpressionType.Validate || expressionObject.type === Expression.ExpressionType.Readonly || expressionObject.type === Expression.ExpressionType.Visible) {\r\n        const effectOptions = { message: expressionObject.message, expressionId: expressionObject.id };\r\n        effector.effect(expressionObject.path, expressionObject.result, effectOptions);\r\n      }\r\n    } else {\r\n      throw new Error('not supported');\r\n    }\r\n  }\r\n\r\n  //#endregion\r\n\r\n  //#region util\r\n\r\n  protected isValidateOrRequiredExpression(expressionObject: Expression.ExpressionObject) {\r\n    return expressionObject && (expressionObject.type === Expression.ExpressionType.Validate || expressionObject.type === Expression.ExpressionType.Required);\r\n  }\r\n  /**\r\n   * \r\n   * @param event event\r\n   * @returns \r\n   */\r\n  protected getEntityPathFromEvent(event: Expression.EventArgs): string[] {\r\n    event = JSON.parse(JSON.stringify(event));\r\n    if (!event || !event.path || event.path.length < 1) {\r\n      return [];\r\n    }\r\n    const paths = event.path;\r\n    return this.getEntityPath(paths);\r\n  }\r\n  /**\r\n   * \r\n   * @param path path\r\n   * @returns \r\n   */\r\n  protected getEntityPath(path: string[]): string[] {\r\n    const paths = path.filter((value: string, index: number) => {\r\n      if (index % 2 === 0 && value.includes(':')) {\r\n        return false;\r\n      } else {\r\n        return true;\r\n      }\r\n    });\r\n    return paths;\r\n  }\r\n  /**\r\n   * \r\n   * @param path path\r\n   * @description id\r\n   * @returns \r\n   */\r\n  protected buildEntityPath(path: string[]): string[] {\r\n    const paths = path.filter((value: string, index: number) => {\r\n      if (index % 2 === 0 && value.includes(':')) {\r\n        return false;\r\n      } else {\r\n        return true;\r\n      }\r\n    });\r\n    return paths;\r\n  }\r\n  /**\r\n   * id\r\n   * @param path path\r\n   * @returns \r\n   */\r\n  protected cleanEventPath(path: string[]) {\r\n    path = path.filter(p => {\r\n      if (p && p !== ':') {\r\n        return true;\r\n      } else {\r\n        return false;\r\n      }\r\n    });\r\n    return path.map((item: string) => {\r\n      if (item.includes(':')) {\r\n        return item.split(':')[1];\r\n      } else {\r\n        return item;\r\n      }\r\n    });\r\n  }\r\n  /**\r\n   * \r\n   * @param paths \r\n   * @param event \r\n   * @returns \r\n   */\r\n  protected getCurrentRowByPaths(paths: string[]): null | { [prop: string]: any } {\r\n    let result = null;\r\n    const bindingList: BindingList = this.bindingData.getValue(paths) as BindingList;\r\n    if (bindingList && bindingList.length > 0) {\r\n      let primaryValue = bindingList.currentItem.primaryKeyValue || null;\r\n      if (primaryValue) {\r\n        const bindingObject = bindingList.findById(primaryValue);\r\n        if (bindingObject) {\r\n          result = bindingObject.toJSON();\r\n        }\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n  /**\r\n   * \r\n   * @param path \r\n   * @param tableCode \r\n   * @returns \r\n   */\r\n  protected getEventId(path: string[], tableCode: string) {\r\n    if (!path || path.length < 1) {\r\n      throw new Error('invalid path!');\r\n    }\r\n    const propertyIndex = path.findIndex(p => p === tableCode);\r\n    if (propertyIndex === -1) {\r\n      return null;\r\n    }\r\n    const idIndex = propertyIndex + 1;\r\n    if (idIndex > path.length - 1) {\r\n      throw new Error('invalid propertyName or path');\r\n    }\r\n    const id = path[idIndex];\r\n    if (id.indexOf(':') === -1) {\r\n      throw new Error('compute error.');\r\n    }\r\n    return id.split(':')[1];\r\n  }\r\n  //#endregion\r\n\r\n\r\n  //#region  \r\n\r\n  /**\r\n   * \r\n   * @param event \r\n   * @returns \r\n   */\r\n  public buildStateContext(event: Expression.EventArgs) {\r\n    const ns = event.ns;\r\n    const appContext = this.injector.get<AppContext>(AppContext, null);\r\n    const frameContexts = appContext.frameContextManager.getFrameContextsByNamespace(ns);\r\n    const result = {};\r\n    if (frameContexts && frameContexts.length > 0) {\r\n      const anonymousFrameContext = frameContexts[0];\r\n      const rootFrameContext = anonymousFrameContext.getVirtualRootFrameContext();\r\n      if (rootFrameContext) {\r\n        const uiState = rootFrameContext.viewModel.uiState;\r\n        const propertyNames = Object.getOwnPropertyNames(uiState) || [];\r\n        propertyNames.forEach((prop: string) => {\r\n          if (prop.match(/^[a-zA-Z0-9_\\$]+$/g) !== null) {\r\n            result[prop] = uiState[prop];\r\n          }\r\n        });\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n  /**\r\n   * \r\n   * @param event \r\n   * @returns \r\n   */\r\n  public buildEntityContext(event: Expression.EventArgs, expressionObject: Expression.ExpressionObject, currentRows?: Array<Expression.ICurrentRow>) {\r\n    const expressionBindingType = expressionObject.bindingType;\r\n    if (expressionBindingType === Expression.ExpressionBindingType.Field) {\r\n      const entityTypeInfo = this.repository.entityTypeInfo;\r\n      const childrenEntityPaths = [];\r\n      ExpressionUtil.getChildrenEntityPaths(entityTypeInfo, childrenEntityPaths);\r\n      // \r\n      const row = currentRows && currentRows.find(row => row.bindingPath === '' || row.bindingPath === '/') || null;\r\n      const primaryValue = row && row.primaryValue || this.bindingData.list.currentId;\r\n      let entity = this.bindingData.list.findById(primaryValue);\r\n      if (!entity) {\r\n        return {};\r\n      }\r\n      const object = entity.toJSON();\r\n      object['__type__'] = 'Entity';\r\n      if (!childrenEntityPaths || childrenEntityPaths.length < 1) {\r\n        return object;\r\n      }\r\n      childrenEntityPaths.sort((v1, v2) => v1.length - v2.length);\r\n      // \r\n      childrenEntityPaths.forEach((paths: string[]) => {\r\n        const bindingList = this.bindingData.getValue(paths) as BindingList;\r\n        let currentRowId = bindingList.currentId;\r\n        const propertyName = paths[paths.length - 1];\r\n        // parent entityentitylistnull\r\n        const parent = paths.slice(0, paths.length - 1).reduce((object: any, path: string) => {\r\n          return object && object[path] || null;\r\n        }, object);\r\n        if (!parent) {\r\n          return;\r\n        }\r\n        const data = parent;\r\n        let node: any = null;\r\n        if (!currentRowId) {\r\n          // \r\n          node = { __items__: [], __type__: 'List' };\r\n          node.length = () => node.__items__.length;\r\n        } else {\r\n          // \r\n          if (currentRows && currentRows.length > 0) {\r\n            // \r\n            const userAssignCurrentRow = currentRows.find(row => {\r\n              const bindingPaths = row.bindingPath.split('/').filter(p => p);\r\n              return bindingPaths.join('/') === paths.join('/');\r\n            });\r\n            if (userAssignCurrentRow) {\r\n              currentRowId = userAssignCurrentRow.primaryValue;\r\n            }\r\n          }\r\n          // \r\n          const row = bindingList.findById(currentRowId);\r\n          // \r\n          const list = parent[propertyName];\r\n          node = { __items__: [], ...row && row.toJSON() || {}, __type__: 'List' };\r\n          node.length = () => node.__items__.length;\r\n\r\n          if (list && Array.isArray(list)) {\r\n            node.__items__ = [].concat(list);\r\n          }\r\n        }\r\n        data[propertyName] = node;\r\n      });\r\n      return object;\r\n    } else if (expressionBindingType === Expression.ExpressionBindingType.State) {\r\n      // todo: \r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   * @param expressionObject \r\n   * @param event \r\n   * @param entityContext \r\n   * @param currentRows \r\n   * @returns \r\n   */\r\n  public buildContext(expressionObject: Expression.ExpressionObject, event: Expression.EventArgs, entityContext?: any, currentRows?: Array<Expression.ICurrentRow>): any {\r\n    let context = [];\r\n    if (entityContext) {\r\n      context.push(entityContext);\r\n    } else {\r\n      const entity = this.buildEntityContext(event, expressionObject, currentRows);\r\n      context.push(entity);\r\n    }\r\n    const stateContext = this.buildStateContext(event);\r\n    const entityCode = this.entityOriginalNodeCode;\r\n    let entity = null;\r\n    if (context.length === 1) {\r\n      entity = context.pop();\r\n    } else {\r\n      entity = context[0];\r\n      if (!entity['__type__']) {\r\n        entity['__type__'] = 'Entity';\r\n      }\r\n      entity['__items__'] = context;\r\n    }\r\n    const translate = this.injector.get<Translate>(TranslateToken, null);\r\n    return {\r\n      [entityCode]: entity,\r\n      ...stateContext,\r\n      BigNumber,\r\n      frameContext: this.frameContext,\r\n      bindingData: this.bindingData,\r\n      repository: this.repository,\r\n      CurrentLanguage: translate.getCurrentLanguage() || 'zh-CHS'\r\n    };\r\n  }\r\n  //#endregion\r\n  /**\r\n   * \r\n   * @param event \r\n   * @param expressionObject \r\n   * @returns \r\n   */\r\n  protected buildEffectPath(event: Expression.EventArgs, expressionObject: Expression.ExpressionObject): string[] {\r\n    const expressionPaths = expressionObject.path.split('/').filter(p => p);\r\n    const primaryValue = event.path[0] && event.path[0].split(':')[1];\r\n    if (!primaryValue) {\r\n      throw new Error('Invalid event path!');\r\n    }\r\n    if (expressionPaths.length === 1) {\r\n      // \r\n      return [primaryValue, expressionPaths.pop()];\r\n    } else {\r\n      const result = [primaryValue];\r\n      for (let index = 0; index < expressionPaths.length; index++) {\r\n        const propertyName = expressionPaths[index];\r\n        result.push(propertyName);\r\n        const currentPaths = expressionPaths.slice(0, index + 1);\r\n        const propertyInfo: DataPropInfo = this.repository.entityTypeInfo.getPropInfoByPath(currentPaths);\r\n        if (propertyInfo.group === 'List') {\r\n          let id = this.getEventId(event.path, propertyInfo.name) || null;\r\n          // \r\n          if (!id) {\r\n            const bindingList = this.bindingData.getValue(currentPaths) as BindingList;\r\n            if (bindingList) {\r\n              id = bindingList.currentId;\r\n            }\r\n          }\r\n          result.push(id);\r\n        }\r\n      }\r\n      return result;\r\n    }\r\n  }\r\n\r\n  //#region \r\n  protected getPathInfo(path: string): { path: string, propertyName: string, paths: string[], propertyNames: string[] } {\r\n    const paths = path.split('/').filter(p => p);\r\n    // udt\r\n    const entityPath = ExpressionUtil.getAvailableChildrenPathsFromEntityPaths(paths, this.repository.entityTypeInfo);\r\n    const propertyName = paths.slice(entityPath.length).join('/');\r\n    return { path: entityPath.join('/'), propertyName, paths: entityPath, propertyNames: propertyName.split('/').filter(p => p) };\r\n  }\r\n  /**\r\n   * get table paths from event paths\r\n   * @param paths event paths\r\n   * @returns \r\n   */\r\n  protected getTablePathsFromEventPaths(paths: string[]) {\r\n    paths = this.getEntityPath(paths);\r\n    const entityPaths = ExpressionUtil.getAvailableChildrenPathsFromEntityPaths(paths, this.repository.entityTypeInfo);\r\n    return entityPaths;\r\n  }\r\n  /**\r\n   * get property paths from event paths\r\n   * @param paths event paths\r\n   * @returns \r\n   */\r\n  protected getPropertyPathsFromEventPaths(paths: string[]) {\r\n    paths = this.getEntityPath(paths);\r\n    const tablePaths = ExpressionUtil.getAvailableChildrenPathsFromEntityPaths(paths, this.repository.entityTypeInfo);\r\n    return paths.slice(tablePaths.length);\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  protected analysis(event: Expression.EventArgs, expressionObject: Expression.ExpressionObject) {\r\n    const expressionPathInfo = this.getPathInfo(expressionObject.path);\r\n    const eventPaths = this.getEntityPath(event.path.slice(0));\r\n    const eventPathInfo = this.getPathInfo(eventPaths.join('/'));\r\n    if (!expressionPathInfo || !eventPathInfo) {\r\n      console.warn(``);\r\n      return null;\r\n    }\r\n    const expressionTablePaths = expressionPathInfo.path.split('/').filter(p => p);\r\n    const expressionPropertyNames = expressionPathInfo.propertyName.split('/').filter(p => p);\r\n    const eventTablePaths = eventPathInfo.path.split('/').filter(p => p);\r\n    const eventPropertyNames = eventPathInfo.propertyName.split('/').filter(p => p);\r\n    const result = {\r\n      distance: undefined,\r\n      eventFromChildren: undefined,\r\n      eventFromParent: undefined,\r\n      expressionTablePaths,\r\n      expressionPropertyNames,\r\n      eventTablePaths,\r\n      eventPropertyNames,\r\n      isSameTable: false\r\n    };\r\n    result.distance = Math.abs(expressionTablePaths.length - eventTablePaths.length);\r\n    if (result.distance === 1) {\r\n      result.eventFromChildren = eventTablePaths.length > expressionTablePaths.length && eventTablePaths.join('/').startsWith(expressionTablePaths.join('/'));\r\n      result.eventFromParent = eventTablePaths.length < expressionTablePaths.length && expressionTablePaths.join('/').startsWith(eventTablePaths.join('/'));\r\n    }\r\n    result.isSameTable = expressionTablePaths.join('/') === eventTablePaths.join('/');\r\n    return result;\r\n  }\r\n\r\n  protected buildCurrentRows(tablePaths: string[], fullPaths: string[]) {\r\n    const currentRows = new Array<Expression.ICurrentRow>();\r\n    if (!tablePaths || tablePaths.length < 1) {\r\n      currentRows.push({\r\n        bindingPath: '/',\r\n        primaryValue: fullPaths[0]\r\n      });\r\n    } else {\r\n      const paths = [];\r\n      tablePaths.forEach((path: string, index: number) => {\r\n        if (index === 0) {\r\n          currentRows.push({\r\n            bindingPath: '/',\r\n            primaryValue: fullPaths[0]\r\n          });\r\n        }\r\n        paths.push(path);\r\n        const primaryValue = fullPaths[index * 2 + 2];\r\n        currentRows.push({\r\n          bindingPath: paths.join('/'),\r\n          primaryValue: primaryValue\r\n        });\r\n      });\r\n    }\r\n    return currentRows;\r\n  }\r\n  protected convertBooleanTypeExpressionResult(expressionObject: Expression.ExpressionObject, result: any) {\r\n    if (this.isBooleanTypeExpression(expressionObject)) {\r\n      return result === true ? true : false;\r\n    } else {\r\n      return result;\r\n    }\r\n  }\r\n  protected isBooleanTypeExpression(expressionObject: Expression.ExpressionObject): boolean {\r\n    return this.isReadonlyExpression(expressionObject) || this.isVisibleExpression(expressionObject) || this.isValidateExpression(expressionObject) || this.isRequiredExpression(expressionObject) || this.isDependencyExpression(expressionObject);\r\n  }\r\n  private isReadonlyExpression(expressionObject: Expression.ExpressionObject): boolean {\r\n    return expressionObject && expressionObject.type === Expression.ExpressionType.Readonly || false;\r\n  }\r\n  private isVisibleExpression(expressionObject: Expression.ExpressionObject): boolean {\r\n    return expressionObject && expressionObject.type === Expression.ExpressionType.Visible;\r\n  }\r\n  private isValidateExpression(expressionObject: Expression.ExpressionObject): boolean {\r\n    return expressionObject && expressionObject.type === Expression.ExpressionType.Validate;\r\n  }\r\n  private isRequiredExpression(expressionObject: Expression.ExpressionObject): boolean {\r\n    return expressionObject && expressionObject.type === Expression.ExpressionType.Required;\r\n  }\r\n  private isDependencyExpression(expressionObject: Expression.ExpressionObject): boolean {\r\n    return expressionObject && expressionObject.type === Expression.ExpressionType.Dependency;\r\n  }\r\n  //#endregion\r\n}","import { Injectable } from '@angular/core';\r\nimport { DataPropInfo } from '../core';\r\nimport { Entity, EntityList } from '../entity/index';\r\nimport { Expression } from '../expression/index';\r\nimport { ENTITY_TEMPLATE } from '../resolver/index';\r\nimport { EventHandler } from './event_handler';\r\n/**\r\n * \r\n */\r\n@Injectable()\r\nexport class EntityValueChangedEventHandler extends EventHandler {\r\n  /**\r\n   * \r\n   * @param event event\r\n   */\r\n  public filter(event: Expression.EventArgs): Expression.ExpressionObject[] {\r\n    return null;\r\n  }\r\n  /**\r\n   * \r\n   * @param event event\r\n   */\r\n  public dispatch(event: Expression.EventArgs) {\r\n  }\r\n  /**\r\n   * \r\n   * @param paths \r\n   * @param event \r\n   * @returns \r\n   */\r\n  public getCurrentRowByEvent(paths: string[], event: Expression.EventArgs): null | { [prop: string]: any } {\r\n    return this.getCurrentRowByPaths(paths);\r\n  }\r\n}","import { Expression } from \"../expression/index\";\r\n\r\nexport class EffectorManager {\r\n  /**\r\n   * \r\n   * @param effector effector\r\n   * @param expressionObject \r\n   * @param paths \r\n   * @returns \r\n   */\r\n  public static effect(effector: Expression.Effector, expressionObject: Expression.ExpressionObject, paths: any[][]) {\r\n    if (!paths || paths.length < 1) {\r\n      return;\r\n    }\r\n    paths.forEach((path: any[]) => {\r\n      const effectOptions: Expression.EffectOptions = { path, message: expressionObject.message, expressionId: expressionObject.id };\r\n      effector.effect(expressionObject.path, expressionObject.result, effectOptions);\r\n    });\r\n  }\r\n}","import { Injectable } from \"@angular/core\";\r\nimport { EffectorManager } from \"../effector/effector_manager\";\r\nimport { Entity, EntityList } from \"../entity/index\";\r\nimport { Expression } from \"../expression/index\";\r\nimport { STATE_TEMPLATE } from \"../resolver/index\";\r\nimport { EventHandler } from \"./event_handler\";\r\n\r\n@Injectable()\r\nexport class StateValueChangedEventHandler extends EventHandler {\r\n\r\n  /**\r\n   * \r\n   * @param event event\r\n   */\r\n  public filter(event: Expression.EventArgs) {\r\n    if (this.expressionObjects && this.expressionObjects.length > 0) {\r\n      return this.expressionObjects.filter((expressionObject: Expression.ExpressionObject) => {\r\n        const deps = expressionObject.deps;\r\n        if (!deps || deps.length < 1 || event.ns !== expressionObject.ns) {\r\n          return false;\r\n        }\r\n        const changePaths = this.cleanEventPath(event.path);\r\n        changePaths.splice(0, 0, STATE_TEMPLATE);\r\n        const eventPath = changePaths.join('/');\r\n        if (deps.includes(eventPath)) {\r\n          return true;\r\n        } else {\r\n          return false;\r\n        }\r\n      });\r\n    }\r\n    return null;\r\n  }\r\n  /**\r\n   * \r\n   * @param event event\r\n   */\r\n  public dispatch(event: Expression.EventArgs) {\r\n    const expressions = this.filter(event);\r\n    if (expressions && expressions.length > 0) {\r\n      expressions.forEach((expressionObject: Expression.ExpressionObject) => {\r\n        // const entityContext = this.buildEntityContext(event, expressionObject);\r\n        const context = this.buildContext(expressionObject, event);\r\n        const result = this.perform(expressionObject, context);\r\n        if (result === undefined && !this.isValidateOrRequiredExpression(expressionObject)) {\r\n          return;\r\n        }\r\n        expressionObject.result = this.convertBooleanTypeExpressionResult(expressionObject, result);;\r\n        if (expressionObject.id) {\r\n          this.expressionResult.set(expressionObject.id, expressionObject.result);\r\n        }\r\n        this.effect(event, expressionObject);\r\n      });\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   * @param event event\r\n   * @param expressionObject expressionObject\r\n   */\r\n  public effect(event: Expression.EventArgs, expressionObject: Expression.ExpressionObject): void {\r\n    const effector = this.effectorFactory.getEffector(expressionObject);\r\n    const bindingType = expressionObject.bindingType;\r\n    if (!effector) {\r\n      return;\r\n    }\r\n    if (bindingType === Expression.ExpressionBindingType.State) {\r\n      // uistate\r\n      effector.effect(expressionObject.path, expressionObject.result, { message: expressionObject.message });\r\n    } else if (bindingType === Expression.ExpressionBindingType.Field) {\r\n      // \r\n      const expressionPathInfo = this.getPathInfo(expressionObject.path);\r\n      const bindingPaths = expressionPathInfo.paths;\r\n      const entities = this.repository.entityCollection.getAllEntities();\r\n      if (!entities || entities.length < 1 || expressionObject.type === Expression.ExpressionType.Visible) {\r\n        effector.effect(expressionObject.path, expressionObject.result, { message: expressionObject.message });\r\n      } else {\r\n        this.effectRows(entities, bindingPaths, expressionPathInfo.propertyNames, (currentRows: Expression.ICurrentRow[], paths: string[]) => {\r\n          this.output(event, expressionObject, currentRows, effector, [paths])\r\n        });\r\n      }\r\n    }\r\n  }\r\n  public output(event: Expression.EventArgs, expressionObject: Expression.ExpressionObject, currentRows: Expression.ICurrentRow[], effector: Expression.Effector, paths: any[][]) {\r\n    const context = this.buildContext(expressionObject, event, null, currentRows);\r\n    const value = this.perform(expressionObject, context);\r\n    if (value === undefined) {\r\n      return;\r\n    }\r\n    expressionObject.result = value;\r\n    if (expressionObject.id) {\r\n      this.expressionResult.set(expressionObject.id, expressionObject.result);\r\n    }\r\n    EffectorManager.effect(effector, expressionObject, paths);\r\n  }\r\n  private effectRows(entities: Entity[], bindingPaths: string[], propertyNames: string[], callback: (currentRows: Expression.ICurrentRow[], paths: string[]) => void, currentRows: Expression.ICurrentRow[] = [], prevPaths: string[] = [], paths: string[] = []) {\r\n    if (!bindingPaths || bindingPaths.length < 1) {\r\n      entities.forEach((entity: Entity) => {\r\n        if (!entity || !entity.primaryValue) {\r\n          return;\r\n        }\r\n        const currentPaths = paths.concat([entity.primaryValue]).concat(propertyNames);\r\n        const currentCurrentRows = currentRows.concat([{ bindingPath: prevPaths.join('/') || '/', primaryValue: entity.primaryValue }]);\r\n        callback(currentCurrentRows, currentPaths);\r\n      });\r\n      currentRows.length = 0;\r\n      paths.length = 0;\r\n    } else {\r\n      let flag = false;\r\n      let nextPrevPaths = prevPaths;\r\n      entities.forEach((entity: Entity) => {\r\n        const prop = bindingPaths[0];\r\n        const entityList = entity[prop] as EntityList<Entity>;\r\n        if (!entityList || entityList.count() < 1) {\r\n          // \r\n          return;\r\n        }\r\n        currentRows.push({ bindingPath: prevPaths.join('/') || '/', primaryValue: entity.primaryValue });\r\n        paths.push(entity.primaryValue);\r\n        paths.push(prop);\r\n        if (flag === false) {\r\n          flag = true;\r\n          nextPrevPaths.push(prop);\r\n        }\r\n        const nextBindingPaths = bindingPaths.slice(1);\r\n        this.effectRows(entityList.items, nextBindingPaths, propertyNames, callback, currentRows, nextPrevPaths, paths);\r\n      });\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   * @param paths \r\n   * @param event \r\n   * @returns \r\n   */\r\n  public getCurrentRowByEvent(paths: string[], event: Expression.EventArgs): { [prop: string]: any; } {\r\n    return this.getCurrentRowByPaths(paths);\r\n  }\r\n}","import { Injectable } from \"@angular/core\";\r\nimport { Entity } from \"../entity/index\";\r\nimport { Expression } from \"../expression\";\r\nimport { ENTITY_TEMPLATE } from \"../resolver/index\";\r\nimport { EventHandler } from \"./event_handler\";\r\n\r\n@Injectable()\r\nexport class RepositoryAddEntityEventHandler extends EventHandler {\r\n  /**\r\n   * \r\n   * @param event event\r\n   * @description \r\n   */\r\n  public filter(event: Expression.EventArgs) {\r\n    return null;\r\n  }\r\n  /**\r\n   * \r\n   * @param event event\r\n   */\r\n  public dispatch(event: Expression.EventArgs) {\r\n    const expressions = this.filter(event);\r\n    if (expressions && expressions.length > 0) {\r\n      expressions.forEach((expressionObject: Expression.ExpressionObject) => {\r\n        const entityContext = this.buildEntityContext(event,expressionObject);\r\n        const context = this.buildContext(expressionObject, event, entityContext);\r\n        const result = this.perform(expressionObject, context);\r\n        if (result === undefined&& !this.isValidateOrRequiredExpression(expressionObject)) {\r\n          return;\r\n        }\r\n        expressionObject.result = result;\r\n        if (expressionObject.id) {\r\n          this.expressionResult.set(expressionObject.id, expressionObject.result);\r\n        }\r\n        this.effect(event, expressionObject);\r\n      });\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   * @param paths \r\n   * @param event \r\n   * @returns \r\n   */\r\n  public getCurrentRowByEvent(paths: string[], event: Expression.EventArgs): null | { [prop: string]: any } {\r\n    return this.getCurrentRowByPaths(paths);\r\n  }\r\n}","import { Injectable } from \"@angular/core\";\r\nimport { BindingList } from \"../binding-data/index\";\r\nimport { Expression } from \"../expression\";\r\nimport { ENTITY_TEMPLATE } from \"../resolver/index\";\r\nimport { ExpressionUtil } from \"../utils/expression_util\";\r\nimport { EventHandler } from \"./event_handler\";\r\n\r\n@Injectable()\r\nexport class RepositoryRemoveEntityEventHandler extends EventHandler {\r\n  /**\r\n   * \r\n   * @param event event\r\n   */\r\n  public filter(event: Expression.EventArgs) {\r\n    return null;\r\n  }\r\n  /**\r\n   * \r\n   * @param event event\r\n   */\r\n  public dispatch(event: Expression.EventArgs) {\r\n  }\r\n}","import { EventHandler } from \"./event_handler\";\r\nimport { Expression } from \"../expression/index\";\r\nimport { Injectable } from \"@angular/core\";\r\n@Injectable()\r\nexport class RepositoryLoadEventHandler extends EventHandler {\r\n  public filter(event: Expression.EventArgs) {\r\n    return null;\r\n  }\r\n  /**\r\n   * \r\n   * @param event event\r\n   */\r\n  public dispatch(event: Expression.EventArgs) {\r\n    const expressions = this.filter(event);\r\n    if (expressions && expressions.length > 0) {\r\n      expressions.forEach((expressionObject: Expression.ExpressionObject) => {\r\n        const entityContext = this.buildEntityContext(event,expressionObject);\r\n        const context = this.buildContext(expressionObject, event, entityContext);\r\n        const result = this.perform(expressionObject, context);\r\n        if (result === undefined&& !this.isValidateOrRequiredExpression(expressionObject)) {\r\n          return;\r\n        }\r\n        expressionObject.result = result;\r\n        if (expressionObject.id) {\r\n          this.expressionResult.set(expressionObject.id, expressionObject.result);\r\n        } else {\r\n        }\r\n        this.effect(event, expressionObject);\r\n      });\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   * @param paths \r\n   * @param event \r\n   * @returns \r\n   */\r\n  public getCurrentRowByEvent(paths: string[], event: Expression.EventArgs): null | { [prop: string]: any } {\r\n    return this.getCurrentRowByPaths(paths);\r\n  }\r\n}","import { Injectable } from \"@angular/core\";\r\nimport { BindingList } from \"../binding-data/index\";\r\nimport { Expression } from \"../expression/index\";\r\nimport { ENTITY_TEMPLATE } from \"../resolver/index\";\r\nimport { ExpressionUtil } from \"../utils/expression_util\";\r\nimport { EventHandler } from \"./event_handler\";\r\n\r\n@Injectable()\r\nexport class EntityUpdateEventHandler extends EventHandler {\r\n  public filter(event: Expression.EventArgs) {\r\n    return this.expressionObjects.filter((expressionObject: Expression.ExpressionObject) => {\r\n      // \r\n      if (expressionObject.ns !== event.ns || !expressionObject.deps || expressionObject.deps.length === 0 || expressionObject.type === Expression.ExpressionType.Compute || expressionObject.type === Expression.ExpressionType.Dependency || expressionObject.type === Expression.ExpressionType.DataPicking) {\r\n        return false;\r\n      }\r\n      const result = this.analysis(event, expressionObject);\r\n      if (!result) {\r\n        return false;\r\n      }\r\n      // \r\n      if (result.expressionTablePaths.length !== 0) {\r\n        return false;\r\n      }\r\n      const index = expressionObject.deps.findIndex((dep: string) => {\r\n        if (!dep.startsWith(ENTITY_TEMPLATE)) {\r\n          return false;\r\n        }\r\n        const deps = dep.split(Expression.DEPENDENCY_SPLITER).filter(p => p).slice(1);\r\n        const depPathInfo = this.getPathInfo(deps.join('/'));\r\n        if (!depPathInfo) {\r\n          return false;\r\n        }\r\n        if (depPathInfo.paths.length !== 0) {\r\n          return false;\r\n        }\r\n        return true;\r\n      });\r\n      return index === -1 ? false : true;\r\n    });\r\n  }\r\n  /**\r\n   * \r\n   * @param event event\r\n   */\r\n  public dispatch(event: Expression.EventArgs) {\r\n    const expressions = this.filter(event);\r\n    if (expressions && expressions.length > 0) {\r\n      expressions.forEach((expressionObject: Expression.ExpressionObject) => {\r\n        const entityContext = this.buildEntityContext(event, expressionObject);\r\n        const context = this.buildContext(expressionObject, event, entityContext);\r\n        const result = this.perform(expressionObject, context);\r\n        if (result === undefined && !this.isValidateOrRequiredExpression(expressionObject)) {\r\n          return;\r\n        }\r\n        expressionObject.result = this.convertBooleanTypeExpressionResult(expressionObject, result);;\r\n        if (expressionObject.id) {\r\n          this.expressionResult.set(expressionObject.id, expressionObject.result);\r\n        } else {\r\n        }\r\n        this.effect(event, expressionObject);\r\n      });\r\n    }\r\n  }\r\n  public getCurrentRowByEvent(paths: string[], event: Expression.EventArgs) {\r\n    let result = null;\r\n    const bindingList: BindingList = this.bindingData.getValue(paths) as BindingList;\r\n    const eventEntityPath = this.getEntityPath(event.path);\r\n    if (bindingList && bindingList.length > 0) {\r\n      let primaryValue = bindingList.currentItem.primaryKeyValue || null;\r\n      // \r\n      const childrenPaths = ExpressionUtil.getAvailableChildrenPathsFromEntityPaths(eventEntityPath, this.repository.entityTypeInfo);\r\n      if (childrenPaths && childrenPaths.toString() === paths.toString()) {\r\n        // idid\r\n        primaryValue = event.id || null;\r\n        if (!primaryValue) {\r\n          primaryValue = this.getEventId(event.path, paths[paths.length - 1]);\r\n        }\r\n      }\r\n      if (primaryValue) {\r\n        const bindingObject = bindingList.findById(primaryValue);\r\n        if (bindingObject) {\r\n          result = bindingObject.toJSON();\r\n        }\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n}","import { Injectable } from \"@angular/core\";\r\nimport { BindingList, BindingObject } from \"../binding-data/index\";\r\nimport { EffectorManager } from \"../effector/effector_manager\";\r\nimport { Expression } from \"../expression/index\";\r\nimport { ENTITY_TEMPLATE, STATE_TEMPLATE } from \"../resolver/index\";\r\nimport { EventHandler } from \"./event_handler\";\r\n\r\n@Injectable()\r\nexport class BindingDataAppendObjectEventHandler extends EventHandler {\r\n  /**\r\n   * \r\n   * @param event event\r\n   * @returns \r\n   */\r\n  public filter(event: Expression.EventArgs): Expression.ExpressionObject[] {\r\n\r\n    if (this.expressionObjects && this.expressionObjects.length > 0) {\r\n      // const fullEventPath = event.path || [];\r\n      // event.path like [\"id:7dd77e50-ebed-4639-b483-d12004603640\", \"formEEUR1E1s\"] or undefined or []\r\n      // eventTablePaths like [] or [\"s\"]\r\n\r\n      // (),path\r\n      // vo\r\n      const groupExpressions = this.expressionObjects.filter((expressionObject: Expression.ExpressionObject) => {\r\n        if (expressionObject.ns !== event.ns || !expressionObject.deps || expressionObject.deps.length < 1) {\r\n          return false;\r\n        }\r\n        const eventTablePaths = this.buildEntityPath(event.path);\r\n        const info = this.analysis(event, expressionObject);\r\n        if (!info) {\r\n          return false;\r\n        }\r\n        // const eventEntityPath = this.buildEntityPath(event.path);\r\n        // \r\n        if (eventTablePaths.length === 0) {\r\n          if (expressionObject.bindingType === Expression.ExpressionBindingType.Field) {\r\n            // \r\n            return false;\r\n          }\r\n        }\r\n        // \r\n        eventTablePaths.splice(0, 0, ENTITY_TEMPLATE);\r\n        // eventEntityPath like ['ENTITY~','formEEUR1E1s'] // \r\n        // deps like ['ENTITY~/formEEUR1E1s/udt/udt_field','ENTITY~/formEEUR1E1s/ref/ref_udt/ref_udt_field']\r\n        // \r\n        if (info.eventTablePaths.length - 1 !== info.expressionTablePaths.length) {\r\n          return false;\r\n        }\r\n        // \r\n        if (!info.eventTablePaths.join(Expression.DEPENDENCY_SPLITER).startsWith(info.expressionTablePaths.join(Expression.DEPENDENCY_SPLITER))) {\r\n          return false;\r\n        }\r\n        const index = expressionObject.deps.findIndex((dep: string) => {\r\n          // \r\n          if (!dep.startsWith(eventTablePaths.join(Expression.DEPENDENCY_SPLITER))) {\r\n            return false;\r\n          }\r\n          const deps = dep.split(Expression.DEPENDENCY_SPLITER).filter(p => p).slice(1);\r\n          const dependPathInfo = this.getPathInfo(deps.join(Expression.DEPENDENCY_SPLITER));\r\n          if (dependPathInfo && dependPathInfo.paths.join(Expression.DEPENDENCY_SPLITER) === info.eventTablePaths.join(Expression.DEPENDENCY_SPLITER)) {\r\n            return true;\r\n          }\r\n          return false;\r\n        });\r\n        return index === -1 ? false : true;\r\n      });\r\n      const eventTablePaths = this.buildEntityPath(event.path);\r\n      // \r\n      const relativeExpressions = this.expressionObjects.filter((expressionObject: Expression.ExpressionObject) => {\r\n        // expressionObject.bindingType !== Expression.ExpressionBindingType.Field State\r\n        if (expressionObject.ns !== event.ns) {\r\n          return false;\r\n        }\r\n        const expressionPathInfo = this.getPathInfo(expressionObject.path);\r\n        // \r\n        if (expressionPathInfo.paths.join(Expression.DEPENDENCY_SPLITER) !== eventTablePaths.join(Expression.DEPENDENCY_SPLITER)) {\r\n          return false;\r\n        }\r\n        // \r\n        if ((expressionObject.type === Expression.ExpressionType.Compute || expressionObject.type === Expression.ExpressionType.Dependency) && event.isTreeNodeLoadScene) {\r\n          return false;\r\n        }\r\n        // \r\n        if (!expressionObject.deps || expressionObject.deps.length < 1) {\r\n          return true;\r\n        }\r\n        // State\r\n        const onlyDependOnState = expressionObject.deps.every((dep: string) => dep.startsWith(STATE_TEMPLATE));\r\n        // \r\n        // const onlyDependOnCurrentTable = expressionObject.deps.every((dep: string) => {\r\n        //   if (!dep.startsWith(ENTITY_TEMPLATE)) {\r\n        //     return false;\r\n        //   }\r\n        //   const deps = dep.split(Expression.DEPENDENCY_SPLITER).slice(1);\r\n        //   const dependPathInfo = this.getPathInfo(deps.join(Expression.DEPENDENCY_SPLITER));\r\n        //   return dependPathInfo.paths.join(Expression.DEPENDENCY_SPLITER) === eventTablePaths.join(Expression.DEPENDENCY_SPLITER) || eventTablePaths.join(Expression.DEPENDENCY_SPLITER).startsWith(dependPathInfo.paths.join(Expression.DEPENDENCY_SPLITER)) && dependPathInfo.paths.length + 1 == eventTablePaths.length;\r\n        // });\r\n        // if (onlyDependOnState || onlyDependOnCurrentTable) {\r\n        //   return true;\r\n        // }\r\n        if (onlyDependOnState) {\r\n          return true;\r\n        }\r\n\r\n        const result = this.analysis(event, expressionObject);\r\n        if (result && result.distance === 0 && result.isSameTable) {\r\n          return true;\r\n        }\r\n        // \r\n        return false;\r\n      });\r\n\r\n      // \r\n      const depExpressions = this.expressionObjects.filter((expressionObject: Expression.ExpressionObject) => {\r\n        if (expressionObject.ns !== event.ns || !expressionObject.deps || expressionObject.deps.length < 1 || (expressionObject.type !== Expression.ExpressionType.Visible && expressionObject.type !== Expression.ExpressionType.Required && expressionObject.type !== Expression.ExpressionType.Validate)) {\r\n          return false;\r\n        }\r\n        // \r\n        const deps = expressionObject.deps.filter((dep: string) => dep.startsWith(ENTITY_TEMPLATE));\r\n        if (!deps || deps.length < 1) {\r\n          return false;\r\n        }\r\n        const result = this.analysis(event, expressionObject);\r\n        if (!result) {\r\n          return false;\r\n        }\r\n        // \r\n        // 1\r\n        const eventPath = event.path.filter(p => p).join('/');\r\n        // 2\r\n        const index = deps.findIndex((dep: string) => {\r\n          // ENTITY~\r\n          const depPath = dep.split('/').slice(1).join('/');\r\n          // \r\n          const { path } = this.getPathInfo(depPath);\r\n          return path === eventPath;\r\n        });\r\n        return index !== -1;\r\n      });\r\n      return groupExpressions.concat(relativeExpressions, depExpressions);\r\n    }\r\n    return null;\r\n  }\r\n  /**\r\n   * \r\n   * @param event event\r\n   */\r\n  public dispatch(event: Expression.EventArgs) {\r\n    const expressions = this.filter(event);\r\n    if (expressions && expressions.length > 0) {\r\n      expressions.forEach((expressionObject: Expression.ExpressionObject) => {\r\n        const entityContext = this.buildEntityContext(event, expressionObject);\r\n        const context = this.buildContext(expressionObject, event, entityContext);\r\n        const result = this.perform(expressionObject, context);\r\n        if (result === undefined && !this.isValidateOrRequiredExpression(expressionObject)) {\r\n          return;\r\n        }\r\n        expressionObject.result = this.convertBooleanTypeExpressionResult(expressionObject, result);\r\n        if (expressionObject.id) {\r\n          this.expressionResult.set(expressionObject.id, expressionObject.result);\r\n        } else {\r\n          // console.warn(`EventHandler `);\r\n        }\r\n        this.effect(event, expressionObject);\r\n      });\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   * @param paths \r\n   * @param event \r\n   * @returns \r\n   */\r\n  public getCurrentRowByEvent(paths: string[], event: Expression.EventArgs): null | { [prop: string]: any } {\r\n    return this.getCurrentRowByPaths(paths);\r\n  }\r\n  /**\r\n   * \r\n   * @param event event\r\n   * @param expressionObject \r\n   * @returns \r\n   */\r\n  public effect(event: Expression.EventArgs, expressionObject: Expression.ExpressionObject): void {\r\n    const effectTo = expressionObject.bindingType;\r\n    const eventPath = this.cleanEventPath(event.path);\r\n    const effector = this.effectorFactory.getEffector(expressionObject);\r\n    if (!effector) {\r\n      return;\r\n    }\r\n    const info = this.analysis(event, expressionObject);\r\n    if (!info) {\r\n      return;\r\n    }\r\n    const expressionPaths = expressionObject.path.split('/').filter(p => p);\r\n    if (effectTo === Expression.ExpressionBindingType.Field) {\r\n      const paths: any[][] = [];\r\n      const propertyPaths = expressionPaths.slice(info.expressionTablePaths.length);\r\n      // \\\\\r\n      if (info.distance === 0) {\r\n        if (!info.isSameTable) {\r\n          return;\r\n        }\r\n        // \r\n        const prevPaths = eventPath.slice(0);\r\n        if (eventPath.length === 1) {\r\n          // \r\n          if (event.value && Array.isArray(event.value)) {\r\n            event.value.forEach((bindingObject: BindingObject) => {\r\n              paths.push([bindingObject.primaryKeyValue].concat(propertyPaths));\r\n            });\r\n          } else {\r\n            const path = prevPaths.concat(propertyPaths);\r\n            paths.push(path);\r\n          }\r\n        } else {\r\n          // \r\n          if (event.value && Array.isArray(event.value)) {\r\n            event.value.forEach((bindingObject: BindingObject) => {\r\n              paths.push(prevPaths.concat([bindingObject.primaryKeyValue]).concat(propertyPaths));\r\n            });\r\n          } else {\r\n            const bindingList = this.bindingData.getValue(info.eventTablePaths) as BindingList;\r\n            if (bindingList && bindingList.currentId) {\r\n              paths.push(prevPaths.concat(bindingList.currentId).concat(propertyPaths));\r\n            }\r\n          }\r\n        }\r\n      } else {\r\n        // \r\n        if (info.eventFromParent === true) {\r\n          // \r\n          if (info.expressionTablePaths.length > 1) {\r\n            return;\r\n          }\r\n          // \r\n          let prevPaths = eventPath.slice(0, eventPath.length);\r\n          // \r\n          if (eventPath && eventPath.length > 0) {\r\n            prevPaths = eventPath.slice(0, eventPath.length);\r\n          } else {\r\n            // \r\n            prevPaths = [this.bindingData.list.currentId, info.expressionTablePaths[0], null];\r\n          }\r\n\r\n          const path = prevPaths.concat(propertyPaths);\r\n          paths.push(path);\r\n        } else if (info.eventFromChildren === true) {\r\n          const prevPaths = eventPath.slice(0, eventPath.length - 1);\r\n          const path = prevPaths.concat(propertyPaths);\r\n          paths.push(path);\r\n        } else {\r\n          return;\r\n        }\r\n      }\r\n      paths.forEach((path: any[]) => {\r\n        const currentRows = this.buildCurrentRows(info.expressionTablePaths, path);\r\n        this.output(event, expressionObject, currentRows, effector, [path]);\r\n      });\r\n    } else if (effectTo === Expression.ExpressionBindingType.State) {\r\n      console.error('not supported');\r\n    }\r\n  }\r\n  public output(event: Expression.EventArgs, expressionObject: Expression.ExpressionObject, currentRows: Expression.ICurrentRow[], effector: Expression.Effector, paths: any[][]) {\r\n    const context = this.buildContext(expressionObject, event, null, currentRows);\r\n    const value = this.perform(expressionObject, context);\r\n    if (value === undefined) {\r\n      return;\r\n    }\r\n    expressionObject.result = value;\r\n    if (expressionObject.id) {\r\n      this.expressionResult.set(expressionObject.id, expressionObject.result);\r\n    }\r\n    EffectorManager.effect(effector, expressionObject, paths);\r\n  }\r\n}","import { Injectable } from '@angular/core';\r\nimport { EffectorManager } from '../effector/effector_manager';\r\nimport { BindingList } from '../binding-data';\r\nimport { DataPropInfo } from '../core/index';\r\nimport { Entity, EntityList } from '../entity/index';\r\nimport { Expression } from '../expression/index';\r\nimport { ENTITY_TEMPLATE } from '../resolver/index';\r\nimport { ExpressionUtil } from '../utils/expression_util';\r\nimport { EventHandler } from './event_handler';\r\n\r\n@Injectable()\r\nexport class BindingDataValueChangeEventHandler extends EventHandler {\r\n  public filter(event: Expression.EventArgs) {\r\n    if (this.expressionObjects && this.expressionObjects.length > 0) {\r\n      return this.expressionObjects.filter((expressionObject: Expression.ExpressionObject) => {\r\n        const deps = expressionObject.deps;\r\n        if (!deps || deps.length < 1 || event.ns !== expressionObject.ns) {\r\n          return false;\r\n        }\r\n        const eventEntityPaths = this.getEntityPath(event.path);\r\n        eventEntityPaths.splice(0, 0, ENTITY_TEMPLATE);\r\n        return deps.includes(eventEntityPaths.join('/'));\r\n      });\r\n    }\r\n    return null;\r\n  }\r\n  /**\r\n   * \r\n   * @param event event\r\n   */\r\n  public dispatch(event: Expression.EventArgs) {\r\n    const expressions = this.filter(event);\r\n    if (expressions && expressions.length > 0) {\r\n      expressions.forEach((expressionObject: Expression.ExpressionObject) => {\r\n        this.effect(event, expressionObject);\r\n      });\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   * @param event event\r\n   * @param expressionObject \r\n   * @returns \r\n   */\r\n  public effect(event: Expression.EventArgs, expressionObject: Expression.ExpressionObject): void {\r\n    // \r\n    const effector = this.effectorFactory.getEffector(expressionObject);\r\n    if (!effector) {\r\n      return;\r\n    }\r\n    const result = this.analysis(event, expressionObject);\r\n    if (!result) {\r\n      return;\r\n    }\r\n    const eventPaths = this.cleanEventPath(event.path);\r\n    const paths: any[][] = [];\r\n    if (result.distance === 0) {\r\n      // \r\n      if (result.isSameTable === false) {\r\n        // \r\n        //console.warn(`[BindingDataValueChangeEventHandler]`);\r\n        return;\r\n      }\r\n      const prevPaths = eventPaths.slice(0, eventPaths.length - result.eventPropertyNames.length);\r\n      const path = prevPaths.concat(result.expressionPropertyNames);\r\n      const currentRows = this.buildCurrentRows(result.eventTablePaths, path);\r\n      paths.push(path);\r\n      this.output(event, expressionObject, currentRows, effector, paths);\r\n    } else {\r\n      if (result.eventFromChildren === true) {\r\n        if (result.distance > 1) {\r\n          return;\r\n        }\r\n        // \r\n        const prevPaths = eventPaths.slice(0, eventPaths.length - result.eventPropertyNames.length - 2);\r\n        const path = prevPaths.concat(result.expressionPropertyNames);\r\n        paths.push(path);\r\n        const currentRows = this.buildCurrentRows(result.eventTablePaths, eventPaths);\r\n        this.output(event, expressionObject, currentRows, effector, paths);\r\n      } else if (result.eventFromParent === true) {\r\n        if (result.distance > 1) {\r\n          //console.warn(`[BindingDataValueChangeEventHandler]`);\r\n          return;\r\n        }\r\n        // \r\n        const prevPaths = eventPaths.slice(0, eventPaths.length - result.eventPropertyNames.length);\r\n        // nodecode\r\n        prevPaths.push(result.expressionTablePaths.slice(0).pop());\r\n        // \r\n        const bindingPaths = result.expressionTablePaths;\r\n        const primaryKeyValue = eventPaths[0];\r\n        if (!primaryKeyValue) {\r\n          return;\r\n        }\r\n        let object = this.frameContext.repository.entityCollection.getEntityById(primaryKeyValue);\r\n        // prevPaths like [1,c,1.1,cc]\r\n        for (let index = 1; index < prevPaths.length; index++) {\r\n          const propertyName = prevPaths[index];\r\n          if (object instanceof EntityList) {\r\n            object = object.get(propertyName);\r\n          } else {\r\n            object = object[propertyName];\r\n          }\r\n        }\r\n        const list = object;\r\n        if (list && list instanceof EntityList) {\r\n          if (list.count() === 0) {\r\n            if (expressionObject.type === Expression.ExpressionType.Visible || expressionObject.type === Expression.ExpressionType.Required) {\r\n              const context = this.buildContext(expressionObject, event);\r\n              const value = this.perform(expressionObject, context);\r\n              if (value === undefined && !this.isValidateOrRequiredExpression(expressionObject)) {\r\n                return;\r\n              }\r\n              expressionObject.result = this.convertBooleanTypeExpressionResult(expressionObject, value);\r\n              if (expressionObject.id) {\r\n                this.expressionResult.set(expressionObject.id, expressionObject.result);\r\n              }\r\n              super.effect(event, expressionObject);\r\n            }\r\n          } else {\r\n            for (let entity of list) {\r\n              if (entity && entity.primaryValue) {\r\n                const path = prevPaths.concat([entity.primaryValue]).concat(result.expressionPropertyNames);\r\n                const currentRows = this.buildCurrentRows(result.expressionTablePaths, path);\r\n                this.output(event, expressionObject, currentRows, effector, [path]);\r\n              }\r\n            }\r\n          }\r\n        }\r\n      } else {\r\n        // \r\n      }\r\n    }\r\n  }\r\n  public output(event: Expression.EventArgs, expressionObject: Expression.ExpressionObject, currentRows: Expression.ICurrentRow[], effector: Expression.Effector, paths: any[][]) {\r\n    const context = this.buildContext(expressionObject, event, null, currentRows);\r\n    const value = this.perform(expressionObject, context);\r\n    if (value === undefined && !this.isValidateOrRequiredExpression(expressionObject)) {\r\n      return;\r\n    }\r\n    expressionObject.result = this.convertBooleanTypeExpressionResult(expressionObject, value);;\r\n    if (expressionObject.id) {\r\n      this.expressionResult.set(expressionObject.id, expressionObject.result);\r\n    }\r\n    EffectorManager.effect(effector, expressionObject, paths);\r\n  }\r\n  /**\r\n   * \r\n   * @param paths \r\n   * @param event \r\n   * @returns \r\n   */\r\n  public getCurrentRowByEvent(paths: string[], event: Expression.EventArgs): null | { [prop: string]: any } {\r\n    event = JSON.parse(JSON.stringify(event));\r\n    let result = null;\r\n    const bindingList: BindingList = this.bindingData.getValue(paths) as BindingList;\r\n    const eventEntityPath = this.getEntityPath(event.path);\r\n    if (bindingList && bindingList.length > 0) {\r\n      let primaryValue = bindingList.currentItem.primaryKeyValue || null;\r\n      // \r\n      const childrenPaths = ExpressionUtil.getAvailableChildrenPathsFromEntityPaths(eventEntityPath, this.repository.entityTypeInfo);\r\n      if (childrenPaths && childrenPaths.toString() === paths.toString()) {\r\n        // idid\r\n        primaryValue = event.id || null;\r\n        if (!primaryValue) {\r\n          primaryValue = this.getEventId(event.path, paths[paths.length - 1]);\r\n        }\r\n      }\r\n      if (primaryValue) {\r\n        const bindingObject = bindingList.findById(primaryValue);\r\n        if (bindingObject) {\r\n          result = bindingObject.toJSON();\r\n        }\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n}","import { Injectable } from \"@angular/core\";\r\nimport { EffectorManager } from \"../effector/effector_manager\";\r\nimport { Expression } from \"../expression\";\r\nimport { ENTITY_TEMPLATE } from \"../resolver/index\";\r\nimport { EventHandler } from \"./event_handler\";\r\n\r\n/**\r\n * \r\n * 1\r\n */\r\n@Injectable()\r\nexport class BindingDataRemoveObjectEventHandler extends EventHandler {\r\n  /**\r\n   * \r\n   * @param event event\r\n   * @returns \r\n   */\r\n  public filter(event: Expression.EventArgs) {\r\n    if (this.expressionObjects && this.expressionObjects.length > 0) {\r\n      // \r\n      const expressions = this.expressionObjects.filter((expressionObject: Expression.ExpressionObject) => {\r\n        if (expressionObject.ns !== event.ns || !expressionObject.deps || expressionObject.deps.length < 1) {\r\n          return false;\r\n        }\r\n        const info = this.analysis(event, expressionObject);\r\n        if (!info) {\r\n          return false;\r\n        }\r\n        // event.path like [id:xxxx] or [id:xxxx,s]\r\n        const eventTablePaths = this.buildEntityPath(event.path);\r\n        // \r\n        if (eventTablePaths.length === 0) {\r\n          if (expressionObject.bindingType === Expression.ExpressionBindingType.Field) {\r\n            return false;\r\n          }\r\n        }\r\n        // \r\n        eventTablePaths.splice(0, 0, ENTITY_TEMPLATE);\r\n        // eventEntityPath like ['ENTITY~','formEEUR1E1s'] // \r\n        // deps like ['ENTITY~/formEEUR1E1s/udt/udt_field','ENTITY~/formEEUR1E1s/ref/ref_udt/ref_udt_field']\r\n        // \r\n        if (info.eventTablePaths.length - 1 !== info.expressionTablePaths.length) {\r\n          return false;\r\n        }\r\n        // \r\n        if (!info.eventTablePaths.join(Expression.DEPENDENCY_SPLITER).startsWith(info.expressionTablePaths.join(Expression.DEPENDENCY_SPLITER))) {\r\n          return false;\r\n        }\r\n        const index = expressionObject.deps.findIndex((dep: string) => {\r\n          // \r\n          if (!dep.startsWith(eventTablePaths.join(Expression.DEPENDENCY_SPLITER))) {\r\n            return false;\r\n          }\r\n          const deps = dep.split(Expression.DEPENDENCY_SPLITER).filter(p => p).slice(1);\r\n          const dependPathInfo = this.getPathInfo(deps.join(Expression.DEPENDENCY_SPLITER));\r\n          if (dependPathInfo && dependPathInfo.paths.join(Expression.DEPENDENCY_SPLITER) === info.eventTablePaths.join(Expression.DEPENDENCY_SPLITER)) {\r\n            return true;\r\n          }\r\n          return false;\r\n        });\r\n        return index === -1 ? false : true;\r\n      });\r\n      return expressions;\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   * @param event event\r\n   */\r\n  public dispatch(event: Expression.EventArgs) {\r\n    const expressions = this.filter(event);\r\n    if (expressions && expressions.length > 0) {\r\n      expressions.forEach((expressionObject: Expression.ExpressionObject) => {\r\n        const entityContext = this.buildEntityContext(event, expressionObject);\r\n        const context = this.buildContext(expressionObject, event, entityContext);\r\n        const result = this.perform(expressionObject, context);\r\n        if (result === undefined && !this.isValidateOrRequiredExpression(expressionObject)) {\r\n          return;\r\n        }\r\n        expressionObject.result = this.convertBooleanTypeExpressionResult(expressionObject, result);;\r\n        if (expressionObject.id) {\r\n          this.expressionResult.set(expressionObject.id, expressionObject.result);\r\n        }\r\n        this.effect(event, expressionObject);\r\n      });\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   * @param event event\r\n   * @param expressionObject \r\n   * @returns \r\n   */\r\n  public effect(event: Expression.EventArgs, expressionObject: Expression.ExpressionObject): void {\r\n    const effectTo = expressionObject.bindingType;\r\n    const eventPath = this.cleanEventPath(event.path);\r\n    const effector = this.effectorFactory.getEffector(expressionObject);\r\n    if (!effector) {\r\n      return;\r\n    }\r\n    const info = this.analysis(event, expressionObject);\r\n    if (!info) {\r\n      return;\r\n    }\r\n    const expressionPaths = expressionObject.path.split('/').filter(p => p);\r\n    if (effectTo === Expression.ExpressionBindingType.Field) {\r\n      const paths: any[][] = [];\r\n      const propertyPaths = expressionPaths.slice(info.expressionTablePaths.length);\r\n      // \r\n      if (info.distance !== 0) {\r\n        // \r\n        if (info.eventFromParent === true) {\r\n          // \r\n          return;\r\n        } else if (info.eventFromChildren === true) {\r\n          const prevPaths = eventPath.slice(0, eventPath.length - 1);\r\n          const path = prevPaths.concat(propertyPaths);\r\n          paths.push(path);\r\n        } else {\r\n          return;\r\n        }\r\n      }\r\n      EffectorManager.effect(effector, expressionObject, paths);\r\n    } else if (effectTo === Expression.ExpressionBindingType.State) {\r\n      console.error('not supported');\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   * @param paths \r\n   * @param event \r\n   * @returns \r\n   */\r\n  public getCurrentRowByEvent(paths: string[], event: Expression.EventArgs): null | { [prop: string]: any } {\r\n    return this.getCurrentRowByPaths(paths);\r\n  }\r\n}","import { Injectable } from \"@angular/core\";\r\nimport { Expression } from \"../expression/index\";\r\nimport { ENTITY_TEMPLATE } from \"../resolver\";\r\nimport { EventHandler } from \"./event_handler\";\r\n\r\n@Injectable()\r\nexport class BindingDataLoadEventHandler extends EventHandler {\r\n  public filter(event: Expression.EventArgs) {\r\n    // load\r\n    if ((!event.path || event.path.length === 0) && event.value && Array.isArray(event.value) && event.value.length === 0) {\r\n      return null;\r\n    }\r\n    // \r\n    if (this.expressionObjects && this.expressionObjects.length > 0) {\r\n      const expressions = this.expressionObjects.filter((expressionObject: Expression.ExpressionObject) => {\r\n        if (expressionObject.ns !== event.ns || (expressionObject.type !== Expression.ExpressionType.Readonly && expressionObject.type !== Expression.ExpressionType.Visible && expressionObject.type !== Expression.ExpressionType.Required && expressionObject.type !== Expression.ExpressionType.Validate)) {\r\n          return false;\r\n        }\r\n        const result = this.analysis(event, expressionObject);\r\n        if (!result) {\r\n          return false;\r\n        }\r\n        // \r\n        // \r\n        // 1\r\n        //    \r\n        // 2\r\n        //    \r\n        //    \r\n        if (result.isSameTable) {\r\n          return true;\r\n        }\r\n        // \r\n        if (!expressionObject.deps || expressionObject.deps.length === 0) {\r\n          return true;\r\n        }\r\n\r\n        // \r\n        const deps = expressionObject.deps.filter((dep: string) => dep.startsWith(ENTITY_TEMPLATE));\r\n        // uistate\r\n        if (!deps || deps.length < 1) {\r\n          return false;\r\n        }\r\n        // \r\n        // 1\r\n        const eventPath = event.path.filter(p => p).join('/');\r\n        // 2\r\n        const index = deps.findIndex((dep: string) => {\r\n          // ENTITY~\r\n          const depPath = dep.split('/').slice(1).join('/');\r\n          // \r\n          const { path } = this.getPathInfo(depPath);\r\n          return path === eventPath;\r\n        });\r\n        return index !== -1;\r\n      });\r\n      return expressions;\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   * @param event event\r\n   */\r\n  public dispatch(event: Expression.EventArgs) {\r\n    const expressions = this.filter(event);\r\n    if (expressions && expressions.length > 0) {\r\n      expressions.forEach((expressionObject: Expression.ExpressionObject) => {\r\n        const entityContext = this.buildEntityContext(event, expressionObject);\r\n        const context = this.buildContext(expressionObject, event, entityContext);\r\n        const result = this.perform(expressionObject, context);\r\n        if (result === undefined && !this.isValidateOrRequiredExpression(expressionObject)) {\r\n          return;\r\n        }\r\n        expressionObject.result = this.convertBooleanTypeExpressionResult(expressionObject, result);\r\n        if (expressionObject.id) {\r\n          this.expressionResult.set(expressionObject.id, expressionObject.result);\r\n        }\r\n        this.effect(event, expressionObject);\r\n      });\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   * @param paths \r\n   * @param event \r\n   * @returns \r\n   */\r\n  public getCurrentRowByEvent(paths: string[], event: Expression.EventArgs): null | { [prop: string]: any } {\r\n    return this.getCurrentRowByPaths(paths);\r\n  }\r\n}","import { Injectable } from \"@angular/core\";\r\nimport { Expression } from \"../expression/index\";\r\nimport { ENTITY_TEMPLATE } from \"../resolver/index\";\r\nimport { EventHandler } from \"./event_handler\";\r\n@Injectable()\r\nexport class BindingDataSelectionChangedEventHandler extends EventHandler {\r\n  /**\r\n   * \r\n   * @param event event\r\n   * @returns \r\n   */\r\n  public filter(event: Expression.EventArgs) {\r\n    if (this.expressionObjects && this.expressionObjects.length > 0) {\r\n      return this.expressionObjects.filter((expressionObject: Expression.ExpressionObject) => {\r\n        const deps = expressionObject.deps;\r\n        // \r\n        if (!deps || deps.length < 1) {\r\n          return false;\r\n        }\r\n        // \r\n        let index = deps.findIndex(dep => dep.startsWith(ENTITY_TEMPLATE));\r\n        if (index === -1) {\r\n          return false;\r\n        }\r\n        const result = this.analysis(event, expressionObject);\r\n        if (!result) {\r\n          return false;\r\n        }\r\n        // \r\n        if (result.eventTablePaths.length !== 1) {\r\n          return false;\r\n        }\r\n        // \r\n        if (result.expressionTablePaths.length !== 2) {\r\n          return false;\r\n        }\r\n        // \r\n        if (!result.expressionTablePaths.join('/').startsWith(result.eventTablePaths.join('/'))) {\r\n          return false;\r\n        }\r\n        // \r\n        index = deps.findIndex(dep => dep.startsWith(`${ENTITY_TEMPLATE}/${result.eventTablePaths[0]}`));\r\n        if (index === -1) {\r\n          return false;\r\n        }\r\n        return true;\r\n      });\r\n    }\r\n    return null;\r\n  }\r\n  public dispatch(event: Expression.EventArgs): void {\r\n    const expressions = this.filter(event);\r\n    if (expressions && expressions.length > 0) {\r\n      expressions.forEach((expressionObject: Expression.ExpressionObject) => {\r\n        const entityContext = this.buildEntityContext(event, expressionObject);\r\n        const context = this.buildContext(expressionObject, event, entityContext);\r\n        const result = this.perform(expressionObject, context);\r\n        if (result === undefined && !this.isValidateOrRequiredExpression(expressionObject)) {\r\n          return;\r\n        }\r\n        expressionObject.result = this.convertBooleanTypeExpressionResult(expressionObject, result);;\r\n        if (expressionObject.id) {\r\n          this.expressionResult.set(expressionObject.id, expressionObject.result);\r\n        }\r\n        this.effect(event, expressionObject);\r\n      });\r\n    }\r\n  }\r\n}","import { Inject, Injectable, Optional } from \"@angular/core\";\r\nimport { Expression } from \"../expression/index\";\r\nimport { EVENT_HANDLER_TOKEN } from \"../expression/tokens\";\r\nimport { RepositoryAddEntityEventHandler } from \"./repository_add_entity_event_handler\";\r\nimport { RepositoryRemoveEntityEventHandler } from \"./repository_remove_entity_event_handler\";\r\nimport { EntityValueChangedEventHandler } from \"./entity_value_changed_event_handler\";\r\nimport { StateValueChangedEventHandler } from \"./state_value_changed_event_handler\";\r\nimport { EntityUpdateEventHandler } from \"./entity_update_event_handler\";\r\nimport { RepositoryLoadEventHandler } from \"./repository_load_event_handler\";\r\nimport { BindingDataAppendObjectEventHandler } from \"./binding_data_append_object_event_handler\";\r\nimport { BindingDataValueChangeEventHandler } from \"./binding_data_value_change_event_handler\";\r\nimport { BindingDataRemoveObjectEventHandler } from \"./binding_data_remove_object_event_handler\";\r\nimport { BindingDataLoadEventHandler } from \"./binding_data_load_event_handler\";\r\nimport { BindingDataSelectionChangedEventHandler } from \"./binding_data_selection_changed_event_handler\";\r\n\r\n@Injectable()\r\nexport class EventHandlerRegistry {\r\n  constructor(@Optional() @Inject(EVENT_HANDLER_TOKEN) public handlers: Expression.IEventHandler[]) { }\r\n  /**\r\n   * \r\n   */\r\n  public get entityValueChangedEventHandler() {\r\n    return this.handlers && this.handlers.find((handler: Expression.IEventHandler) => handler instanceof EntityValueChangedEventHandler);\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  public get stateValueChangedEventHandler() {\r\n    return this.handlers && this.handlers.find((handler: Expression.IEventHandler) => handler instanceof StateValueChangedEventHandler);\r\n  }\r\n  public get repositoryAddEntityEventHandler() {\r\n    return this.handlers && this.handlers.find((handler: Expression.IEventHandler) => handler instanceof RepositoryAddEntityEventHandler);\r\n  }\r\n  public get repositoryRemoveEntityEventHandler() {\r\n    return this.handlers && this.handlers.find((handler: Expression.IEventHandler) => handler instanceof RepositoryRemoveEntityEventHandler);\r\n  }\r\n  public get entityUpdateEventHandler() {\r\n    return this.handlers && this.handlers.find((handler: Expression.IEventHandler) => handler instanceof EntityUpdateEventHandler);\r\n  }\r\n  public get repositoryLoadEventHandler() {\r\n    return this.handlers && this.handlers.find((handler: Expression.IEventHandler) => handler instanceof RepositoryLoadEventHandler);\r\n  }\r\n  public get bindingDataAppendEntityEventHandler() {\r\n    return this.handlers && this.handlers.find((handler: Expression.IEventHandler) => handler instanceof BindingDataAppendObjectEventHandler);\r\n  }\r\n  public get bindingDataValueChangeEventHandler() {\r\n    return this.handlers && this.handlers.find((handler: Expression.IEventHandler) => handler instanceof BindingDataValueChangeEventHandler);\r\n  }\r\n  public get bindingDataRemoveObjectEventHandler() {\r\n    return this.handlers && this.handlers.find((handler: Expression.IEventHandler) => handler instanceof BindingDataRemoveObjectEventHandler);\r\n  }\r\n  public get bindingDataLoadEventHandler() {\r\n    return this.handlers && this.handlers.find((handler: Expression.IEventHandler) => handler instanceof BindingDataLoadEventHandler);\r\n  }\r\n  public get bindingDataSelectionChangedHandler() {\r\n    return this.handlers && this.handlers.find((handler: Expression.IEventHandler) => handler instanceof BindingDataSelectionChangedEventHandler);\r\n  }\r\n}","import { Injectable, Injector } from \"@angular/core\";\r\nimport { ExpressionRegistry } from \"./expression_registry\";\r\nimport { ExpressionEventEmitter } from \"./expression_event_emitter\";\r\nimport { Expression } from './types';\r\nimport { ResolverRegistry, ResolveService } from \"../resolver/index\";\r\nimport { EventHandlerRegistry } from \"../event-handler/index\";\r\nimport { Core } from \"../core/index\";\r\n\r\n@Injectable()\r\nexport class ExpressionEngineImpl {\r\n  private expressionObjects: Array<Expression.ExpressionObject> = new Array<Expression.ExpressionObject>();\r\n  constructor(\r\n    private injector: Injector,\r\n    private expressionRegistry: ExpressionRegistry,\r\n    private expressionEventEmitter: ExpressionEventEmitter,\r\n    private resolverRegistry: ResolverRegistry,\r\n    private eventHandlerRegistry: EventHandlerRegistry,\r\n    private resolveService: ResolveService\r\n  ) {\r\n    this.expressionRegistry.expressions.subscribe((exprs: Expression.ExpressionObject[]) => {\r\n      if (exprs && exprs.length > 0) {\r\n        this.expressionObjects = exprs;\r\n        // \r\n        this.resolveDependency();\r\n      }\r\n      this.attachEvent();\r\n    });\r\n  }\r\n\r\n  private attachEvent() {\r\n    this.expressionEventEmitter.attach().subscribe((events: Expression.EventArgs[]) => {\r\n      if (!events || events.length < 1 || !this.expressionObjects || this.expressionObjects.length < 1) {\r\n        return;\r\n      }\r\n      events.forEach((event: Expression.EventArgs) => {\r\n        const handler = this.getEventHandler(event);\r\n        if (handler) {\r\n          handler.handleEvent(event, this.expressionObjects);\r\n        } else {\r\n          Core.warn(`,event=${event.type}`);\r\n        }\r\n      });\r\n    });\r\n  }\r\n  /**\r\n   * \r\n   * @returns \r\n   */\r\n  private resolveDependency() {\r\n    if (!this.resolverRegistry || !this.resolverRegistry.resolvers || this.resolverRegistry.resolvers.length < 1 || !this.expressionObjects || this.expressionObjects.length < 1 || !Array.isArray(this.expressionObjects)) {\r\n      return;\r\n    }\r\n    this.expressionObjects.forEach((expressionObject: Expression.ExpressionObject) => {\r\n      const expression = expressionObject.expression;\r\n      const dependencies = this.resolveService.resolve(expression);\r\n      expressionObject.deps = dependencies;\r\n    });\r\n  }\r\n  /**\r\n   * \r\n   * @param event event\r\n   * @returns \r\n   */\r\n  private getEventHandler(event: Expression.EventArgs): Expression.IEventHandler {\r\n    if (event.type === Expression.EventType.ValueChanged) {\r\n      // \r\n      if (event.source === Expression.EventSource.BindingData) {\r\n        return this.eventHandlerRegistry.bindingDataValueChangeEventHandler;\r\n      } else if (event.source === Expression.EventSource.Field) {\r\n        return this.eventHandlerRegistry.entityValueChangedEventHandler;\r\n      } else if (event.source === Expression.EventSource.State) {\r\n        return this.eventHandlerRegistry.stateValueChangedEventHandler;\r\n      }\r\n    } else if (event.type === Expression.EventType.Append) {\r\n      if (event.source === Expression.EventSource.Repository || event.source === Expression.EventSource.Field) {\r\n        return this.eventHandlerRegistry.repositoryAddEntityEventHandler;\r\n      } else if (event.source === Expression.EventSource.BindingData) {\r\n        return this.eventHandlerRegistry.bindingDataAppendEntityEventHandler;\r\n      }\r\n    } else if (event.type === Expression.EventType.Remove) {\r\n      if (event.source === Expression.EventSource.Repository || event.source === Expression.EventSource.Field) {\r\n        return this.eventHandlerRegistry.repositoryRemoveEntityEventHandler;\r\n      } else if (event.source === Expression.EventSource.BindingData) {\r\n        return this.eventHandlerRegistry.bindingDataRemoveObjectEventHandler;\r\n      }\r\n    } else if (event.type === Expression.EventType.Update) {\r\n      if (event.source === Expression.EventSource.Repository) {\r\n        return this.eventHandlerRegistry.entityUpdateEventHandler;\r\n      }\r\n    } else if (event.type === Expression.EventType.Load) {\r\n      if (event.source === Expression.EventSource.Repository || event.source === Expression.EventSource.Field) {\r\n        return this.eventHandlerRegistry.repositoryLoadEventHandler;\r\n      } else if (event.source === Expression.EventSource.BindingData) {\r\n        return this.eventHandlerRegistry.bindingDataLoadEventHandler;\r\n      }\r\n    } else if (event.type === Expression.EventType.SelectionChanged) {\r\n      if (event.source === Expression.EventSource.BindingData) {\r\n        return this.eventHandlerRegistry.bindingDataSelectionChangedHandler;\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n  \r\n}","import { ComponentRef } from \"@angular/core\";\r\n/**\r\n * \r\n */\r\nexport class ComponentRefManager {\r\n  private components: Map<string, any[]> = new Map<string, any[]>();\r\n  /**\r\n   * \r\n   * @param id \r\n   * @param component \r\n   */\r\n  public add(id: string, component: any) {\r\n    const components = this.components.get(id);\r\n    if (components) {\r\n      components.push(component);\r\n    } else {\r\n      this.components.set(id, [component]);\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   * @param id \r\n   */\r\n  public remove(id: string) {\r\n    const components = this.components.get(id);\r\n    if (components && components.length > 0) {\r\n      components.length = 0;\r\n      this.components.delete(id);\r\n    }\r\n  }\r\n  /**\r\n   * id\r\n   * @param id \r\n   * @returns \r\n   */\r\n  public get(id: string) {\r\n    if (id) {\r\n      const components = this.components.get(id);\r\n      if (components && components.length > 0) {\r\n        return components;\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  public clear() {\r\n    this.components.clear();\r\n  }\r\n}","import { Injector, Injectable, Optional, SkipSelf, InjectFlags, OnDestroy } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\nimport { Entity } from '../entity/index';\r\nimport { Repository } from '../repository/index';\r\nimport { BindingData } from '../binding-data/index';\r\nimport { UIState, PARAM_TYPE_TRANSFORM_TOKEN } from '../ui-state/index';\r\nimport { Form } from '../form/index';\r\nimport { StateMachine } from '../state-machine/index';\r\nimport { ViewModel } from '../view-model/index';\r\nimport { CommandBus, CommandHandlerExtenderRegistry, CommandHandlerFactory, CommandHandlerRegistry } from '../command/index';\r\nimport { Context } from '../context/index';\r\nimport { AppContext } from '../app/index';\r\nimport { RouterParamService } from '../misc/index';\r\nimport { FRAME_ID, NAMESPACE } from './tokens';\r\nimport { Change, ChangeType } from '../binding-data/index';\r\nimport { EventBus } from '../event-bus-new/index';\r\nimport { FrameComponent } from './frame_component';\r\nimport { IExceptionHandler } from '../exception/types';\r\nimport { EXCEPTION_HANDLER } from '../exception/tokens';\r\nimport { EntityUtil } from '../binding-data/entity_util';\r\nimport { TranslateToken } from '../i18n/translate_token';\r\nimport { VariableParseService } from '../variable/variable_parse_service';\r\nimport { IContextMetadata } from '../app/app_metadata';\r\nimport { TranslateService } from '../i18n/translate_service';\r\nimport { Translate } from '../i18n';\r\nimport { UserSettings } from '../i18n/types';\r\nimport { UserSettingsToken } from '../i18n/tokens';\r\nimport { UserSettingsService } from '../i18n/user_settings_service';\r\nimport { ExpressionEngineImpl } from '../expression/expression_engine_impl';\r\nimport { ExpressionManager } from '../expression/expression_manager';\r\nimport { ExpressionResult } from '../expression/expression_result';\r\nimport { ExpressionResultFactory } from '../expression/expression_result_factory';\r\nimport {\r\n  CommandVariableParser, DataVariableParser, FrameIdVariableParser,\r\n  StateMachineVariableParser, UIStateVariableParser\r\n} from '../variable';\r\nimport { ChangeSetPolicy, CHANGE_SET_POLICY_TOKEN, RunMode } from '../core';\r\nimport { Subject } from 'rxjs';\r\nimport { IDisposable } from '../core/index';\r\nimport { ComponentRefManager } from './component_ref_manager';\r\n\r\n\r\n/**\r\n * \r\n * @description \r\n * # \r\n * ## Overview\r\n * \r\n * FrameComponentFrameContext,`frameId``BindingData``Repository``ViewModel``StateMachine` * `UIState`FrameComponent\r\n * \r\n * ![image-20210806204755378](https://open.inspuronline.com/iGIX/assets/cloudplus/igix_2110/farris/devkit/guide/images/image-20210806204755378.png)\r\n * \r\n * `ViewModel``UIState` * `detail-form-component``root-component``detail-from-component`Angular * Angular`provider``No provider  * for xx`\r\n * \r\n * `detail-form-component``root-component`UIState\r\n * \r\n * ```typescript\r\n * // 1\r\n * const rootFrameContext = this.frameContext.root;\r\n * // 2\r\n * const rootFrameContext = this.frameContext.appContext.frameContextManager.getFrameContextById('root-component');\r\n * ```\r\n * \r\n * `Web`FrameContext\r\n * \r\n * ```javascript\r\n * import {FrameContext,BindingData,Repository} from '@farris/devkit';\r\n * \r\n * constructor(private frameContext:FrameContext){}\r\n * \r\n * public method(){\r\n *     const bindingData: BindingData = this.frameContext.bindingData;\r\n *     const repository: Repository = this.frameContext.repository;\r\n * }\r\n * ```\r\n * \r\n * > `FrameContext``ViewModelContext``MVVM``VM`\r\n * \r\n * `ViewModel``MVVM`VM`VM`\r\n * \r\n * ```typescript\r\n * import {BindingData,Repository,ViewModel} from '@farris/devkit';\r\n * \r\n * constructor(private viewModel:ViewModel){}\r\n * \r\n * public method(){\r\n *     const bindingData: BindingData = this.viewModel.bindingData;\r\n *     const repository: Repository = this.viewModel.repository;\r\n * }\r\n * ```\r\n * \r\n * \r\n * \r\n * ## \r\n * \r\n * ### \r\n * \r\n * ```typescript\r\n * this.frameContext.frameComponent;\r\n * ```\r\n * \r\n * ### \r\n * \r\n * ```typescript\r\n * this.frameContext.root;\r\n * ```\r\n * \r\n * ### appContext\r\n * \r\n * ```typescript\r\n * this.frameContext.appContext;\r\n * ```\r\n * \r\n * ### frameId\r\n * \r\n * ```typescript\r\n * this.frameContext.appContext.frameContextManager.getFrameContextById('data-grid-component');\r\n * ```\r\n * \r\n * ### \r\n * \r\n * ```typescript\r\n * this.frameContext.appContext.frameContextManager.getFrameContexts();\r\n * ```\r\n * \r\n * \r\n * \r\n * ## \r\n * \r\n * ### BindingData \r\n * \r\n * []([ (inspuronline.com)](https://open.inspuronline.com/iGIX/#/document/mddoc/igix-2103%2Ffarris%2Fdevkit%2Fguide%2F.md))\r\n * \r\n * ### Repository\r\n * \r\n * []([ (inspuronline.com)](https://open.inspuronline.com/iGIX/#/document/mddoc/igix-2103%2Ffarris%2Fdevkit%2Fguide%2F.md))\r\n * \r\n * ### ViewModel\r\n * \r\n * ViewModeMVVMVMFrameContextViewModelFrameContextFrameContextViewModel\r\n * \r\n * ### namespace\r\n * \r\n * ABB\r\n * \r\n * ### root\r\n * \r\n * \r\n * \r\n * ### uiState\r\n * \r\n * \r\n * \r\n * ### frameId\r\n * \r\n * \r\n */\r\n@Injectable()\r\nexport class FrameContext extends Context implements IDisposable, OnDestroy {\r\n\r\n  public typeName = 'FrameContext';\r\n\r\n  protected isDestoried = false;\r\n  public isDisposed = false;\r\n  /**\r\n   * id\r\n   */\r\n  public frameId: string;\r\n\r\n  /**\r\n   * \r\n   */\r\n  // public injector: Injector;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public appContext: AppContext;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public root: FrameContext;\r\n\r\n  /**\r\n   * ViewModel\r\n   */\r\n  public parent: FrameContext;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public children: Map<string, FrameContext>;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public repository: Repository<Entity>;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public commandBus: CommandBus;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public eventBus: EventBus;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public viewModel: ViewModel;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public bindingData: BindingData;\r\n\r\n  /**\r\n   * UI\r\n   */\r\n  public uiState: UIState;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public stateMachine: StateMachine;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public form: Form;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public frameComponent: FrameComponent;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public exceptionHandler: IExceptionHandler;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public namespace: string;\r\n\r\n  public variableParseService: VariableParseService;\r\n\r\n  public metadata: IContextMetadata = {\r\n    identify: '',\r\n    namespace: '',\r\n    commands: null,\r\n    form: null,\r\n    formControls: null,\r\n    subForms: null,\r\n    stateMachine: null,\r\n    uiStates: null,\r\n    bindingTo: ''\r\n  };\r\n\r\n  /**\r\n   * \r\n   */\r\n  public suspend: boolean;\r\n  public expressionEngineImpl: ExpressionEngineImpl;\r\n  public expressionManager: ExpressionManager;\r\n  public expressionResult: ExpressionResult;\r\n  /**\r\n   * (0)\r\n   */\r\n  public index: number;\r\n  /**\r\n   * \r\n   */\r\n  public translate: Translate;\r\n  /**\r\n   * \r\n   */\r\n  public destorySignal: Subject<any>;\r\n  /**\r\n   * \r\n   */\r\n  public componentRefManager: ComponentRefManager = new ComponentRefManager();\r\n  /**\r\n   * \r\n   * @param injector \r\n   */\r\n  constructor(public injector: Injector, @Optional() @SkipSelf() parent: FrameContext) {\r\n    super();\r\n    // AppContextnull\r\n    this.appContext = injector.get(AppContext);\r\n    this.destorySignal = new Subject<any>();\r\n    // \r\n    // appContext\r\n    // 1RootFrameContextRootFrameContext\r\n    // 2RootFrameContextVO\r\n    if (!parent || parent.appContext !== this.appContext) { //  appContext \r\n      this.parent = null;\r\n      this.root = this;\r\n    } else {\r\n      this.parent = parent;\r\n      this.root = parent.root;\r\n    }\r\n    this.frameId = injector.get<string>(FRAME_ID);\r\n    if (this.appContext.contextMetadataManager.exsit(this.frameId)) {\r\n      this.metadata = this.appContext.contextMetadataManager.getContextMetadataByName(this.frameId);\r\n    }\r\n    this.namespace = injector.get(NAMESPACE, null);\r\n    this.bindingData = this.injector.get<BindingData>(BindingData, new BindingData());\r\n    if (!this.appContext.useIsoluteEventBus || (this.appContext.useIsoluteEventBus && !this.appContext.isoluteEventBus)) {\r\n      this.eventBus = this.injector.get(EventBus, null, InjectFlags.Optional);\r\n    } else {\r\n      this.eventBus = this.appContext.isoluteEventBus;\r\n    }\r\n    this.form = this.injector.get<Form>(Form, new Form());\r\n    this.repository = this.injector.get(Repository, this.appContext.repository);\r\n    // \r\n    const changeSetPolicy = this.injector.get<ChangeSetPolicy>(CHANGE_SET_POLICY_TOKEN, 'valid');\r\n    if (this.repository) {\r\n      this.repository.entityCollection.changeSetPolicy = changeSetPolicy;\r\n    }\r\n    this.uiState = this.injector.get<UIState>(UIState, new UIState());\r\n    const defaultViewModel = new ViewModel();\r\n    defaultViewModel.setMetadata(this.metadata);\r\n    this.viewModel = this.injector.get<ViewModel>(ViewModel, defaultViewModel);\r\n    this.variableParseService = injector.get<VariableParseService>(VariableParseService, new VariableParseService([\r\n      new FrameIdVariableParser(),\r\n      new DataVariableParser(),\r\n      new UIStateVariableParser(),\r\n      new StateMachineVariableParser(),\r\n      new CommandVariableParser()\r\n    ]));\r\n    // exceptionHandler\r\n    this.exceptionHandler = injector.get<IExceptionHandler>(EXCEPTION_HANDLER, null, InjectFlags.Optional);\r\n    // \r\n    const translate = injector.get<Translate>(TranslateToken, null);\r\n    this.translate = translate;\r\n    TranslateService.setTranslate(translate);\r\n    // \r\n    const userSettings = injector.get<UserSettings>(UserSettingsToken, null);\r\n    UserSettingsService.setUserSettings(userSettings);\r\n    this.initializeRepository();\r\n    this.appContext.regFrameContext(this);\r\n    this.registerAppContextDestroyEvent();\r\n  }\r\n  dispose(options?: any): void {\r\n    if (this.isDisposed) {\r\n      return;\r\n    }\r\n    this.isDestoried = true;\r\n    this.isDisposed = true;\r\n    if (this.destorySignal) {\r\n      this.destorySignal.next();\r\n      this.destorySignal.complete();\r\n    }\r\n    if (this.appContext) {\r\n      this.appContext.frameContextManager.unregFrameContext(this);\r\n      this.appContext.frameComponentRefresher.unregFrameContext(this);\r\n    }\r\n    if (this.appContext && this.isRootFrameContext() === true) {\r\n      const viewModelNames = this['viewModelNames'];\r\n      if (viewModelNames && Array.isArray(viewModelNames)) {\r\n        viewModelNames.forEach(name => {\r\n          this[name] = null;\r\n        });\r\n      }\r\n      this.appContext.unregisterFromManager();\r\n    }\r\n    if (this.bindingData) {\r\n      this.bindingData.dispose();\r\n      // this.bindingData = null;\r\n    }\r\n    if (this.viewModel) {\r\n      this.viewModel.dispose();\r\n    }\r\n    if (this.form) {\r\n      this.form.dispose();\r\n      this.form = null;\r\n    }\r\n    if (this.commandBus) {\r\n      this.commandBus.dispose();\r\n      this.commandBus = null;\r\n    }\r\n    TranslateService.dispose();\r\n    // this.root = null;\r\n    // this.parent = null;\r\n    // this.uiState = null;\r\n    this.frameComponent = null;\r\n    this.repository = null;\r\n    // this.stateMachine = null;\r\n    // this.appContext = null;\r\n    this.exceptionHandler = null;\r\n    this.expressionManager = null;\r\n    this.expressionEngineImpl = null;\r\n    this.variableParseService = null;\r\n    this.eventBus = null;\r\n    this.translate = null;\r\n    this.injector = null;\r\n    this.expressionResult = null;\r\n    UserSettingsService.setUserSettings(null);\r\n  }\r\n  ngOnDestroy(): void {\r\n    this.dispose();\r\n  }\r\n  /**\r\n   * \r\n   * @param id \r\n   * @returns \r\n   */\r\n  public getComponentById<T>(id: string): T {\r\n    const components = this.componentRefManager.get(id);\r\n    if (components && components.length > 0) {\r\n      const component = components[0] as T;\r\n      return component;\r\n    }\r\n    return null;\r\n  }\r\n  /**\r\n   * \r\n   * @param id \r\n   */\r\n  public getComponentsById<T>(id: string): T[] {\r\n    return this.componentRefManager.get(id) as T[];\r\n  }\r\n  bindInjector(componentInjector: Injector) {\r\n    this.injector = componentInjector;\r\n  }\r\n\r\n  // #region \r\n\r\n  /**\r\n   * \r\n   * @todo:\r\n   * 1CommandHandlerContextCommandHandlerComponentContext\r\n   * 2ViewModelbuildCommandsCommandBusViewModelinit\r\n   */\r\n  public init(frameComponent: FrameComponent) {\r\n    this.frameComponent = frameComponent;\r\n    this.initializeBindingData();\r\n    this.initializeStateMachine();\r\n    this.initializeUiState();\r\n    this.initializeForm();\r\n    this.initializeCommandBus();\r\n    this.initializeViewModel();\r\n    this.registerExceptionHandler();\r\n    this.initExpression();\r\n    this.appContext.frameComponentRefresher.regFrameComponent(this.frameId, this.frameComponent);\r\n  }\r\n  public initExpression() {\r\n    this.expressionEngineImpl = this.injector.get<ExpressionEngineImpl>(ExpressionEngineImpl, null);\r\n    this.expressionManager = this.injector.get<ExpressionManager>(ExpressionManager, null);\r\n    const expressionResultFactory = this.injector.get<ExpressionResultFactory>(ExpressionResultFactory, null);\r\n    this.expressionResult = this.injector.get<ExpressionResult>(ExpressionResult, null);\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  protected registerExceptionHandler() {\r\n    // tslint:disable: no-string-literal\r\n    const formAppContext = this.getFormAppContext();\r\n    const applicationId = formAppContext.ApplicationId;\r\n    window[window.location.href] = applicationId;\r\n    if (this.exceptionHandler !== null) {\r\n      const applicationContext = window[applicationId] = window[applicationId] || {};\r\n      if (this.eventBus !== null && this.isRootFrameContext()) {\r\n        applicationContext.isExceptionHandlerExist = true;\r\n        this.exceptionHandler.setContext(this.appContext);\r\n        this.eventBus.on('Exception', '', 'onException', formAppContext, (error) => {\r\n          if (this.isDestoried === true) {\r\n            return;\r\n          }\r\n          if (error && error.error) {\r\n            try {\r\n              error.error.__frame_context__ = this;\r\n            } catch { }\r\n          }\r\n          this.exceptionHandler.handle(error);\r\n        });\r\n      }\r\n      this.destorySignal.subscribe(() => {\r\n        this.eventBus.off('Exception', '', 'onException', formAppContext);\r\n      });\r\n    }\r\n  }\r\n  protected registerAppContextDestroyEvent() {\r\n    if (this.appContext && this.appContext.destorySignal) {\r\n      this.appContext.destorySignal.subscribe(() => {\r\n        if (this.stateMachine) {\r\n          this.stateMachine.dispose();\r\n          this.stateMachine = null;\r\n        }\r\n        if (this.repository) {\r\n          this.repository.dispose();\r\n        }\r\n      });\r\n    }\r\n  }\r\n  /**\r\n   * appcontextappcontext\r\n   */\r\n  public getFormAppContext() {\r\n    return this.appContext;\r\n  }\r\n  /**\r\n   * frameId\r\n   * @description FrameIdframeIdnamespace_frameId\r\n   */\r\n  public getFrameId(relativeFrameId: string) {\r\n    if (!relativeFrameId) {\r\n      return this.frameId;\r\n    }\r\n    if (this.namespace && this.namespace.length > 0) {\r\n      return `${this.namespace}_${relativeFrameId}`;\r\n    } else {\r\n      return relativeFrameId;\r\n    }\r\n  }\r\n  /**\r\n   * Repository\r\n   */\r\n  private initializeRepository() {\r\n\r\n    this.repository.setPaginationConfig(this.repository.paginationInfo);\r\n  }\r\n\r\n  private initializeForm() {\r\n    // Form\r\n    // this.form.setTranslateService(translateService);\r\n    // FormFormControlFormControl\r\n    // this.form.init(this.bindingData, this.metadata.bindingTo, this);\r\n    // Form\r\n    this.form = this.injector.get<Form>(Form, null);\r\n    if (this.form) {\r\n      // Form\r\n      this.form.setTranslateService(this.injector.get(TranslateToken, null));\r\n      // FormFormControlFormControl\r\n      const bindingPath = this.viewModel.bindingPath || this.metadata.bindingTo;\r\n      this.form.init(this.bindingData, bindingPath, this);\r\n    }\r\n  }\r\n\r\n  private initializeStateMachine() {\r\n    // StateMachine \r\n    this.stateMachine = this.injector.get<StateMachine>(StateMachine, null);\r\n    if (this.stateMachine) {\r\n      this.stateMachine.initialize(this, this.variableParseService);\r\n    }\r\n  }\r\n\r\n  private initializeCommandBus() {\r\n    const handlerRegistry = this.injector.get<CommandHandlerRegistry>(CommandHandlerRegistry,\r\n      new CommandHandlerRegistry(this.metadata.commandHandlers));\r\n    const extendsRegistry = this.injector.get<CommandHandlerExtenderRegistry>(CommandHandlerExtenderRegistry,\r\n      new CommandHandlerExtenderRegistry(this.metadata.commandHandlerExtends));\r\n    const commandHandlerFactory = new CommandHandlerFactory(handlerRegistry, extendsRegistry, this, this.variableParseService);\r\n    this.commandBus = new CommandBus(commandHandlerFactory);\r\n  }\r\n\r\n  /**\r\n   * ViewModel\r\n   * @todo\r\n   * 1\r\n   * 2initContext\r\n   */\r\n  private initializeViewModel() {\r\n    if (!this.metadata.bindingTo) {\r\n      this.metadata.bindingTo = this.viewModel.bindingPath;\r\n    }\r\n    this.viewModel.init(this);\r\n    this.regViewModel(this.viewModel);\r\n  }\r\n\r\n\r\n  /**\r\n   * BindingData\r\n   * @summary\r\n   * repositoryNameRepository\r\n   * repositoryNameBindingData\r\n   */\r\n  private initializeBindingData() {\r\n    const repositoryName = this.repository.name;\r\n    const isRunAtHighSpeedMode = this.appContext.runMode === RunMode.highSpeed;\r\n    if (repositoryName && isRunAtHighSpeedMode) {\r\n      const repositoryBindingData = this.appContext.bindingDataManager.getBindingDataByName(repositoryName);\r\n      this.bindingData.initByBindingList(repositoryBindingData.list, this.viewModel.bindingPath);\r\n      this.bindingData.pagingInfo = repositoryBindingData.pagingInfo;\r\n      this.bindingData.setDataTypeInfo(this.repository.entityTypeInfo);\r\n      EntityUtil.watchReposiroty(this.repository, this.bindingData);\r\n    } else {\r\n      this.bindingData.initByRepository(this.repository, this.viewModel.bindingPath);\r\n      EntityUtil.watchReposiroty(this.repository, this.bindingData);\r\n      this.bindingData.changes.subscribe((change: Change) => {\r\n        if (change.type === ChangeType.GlobalSelectionChanged) {\r\n          this.appContext.handleSelectChange(change, this);\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n\r\n  /**\r\n   * UIState\r\n   * UIState\r\n   */\r\n  private initializeUiState() {\r\n    const isInFramework = window.location.href.indexOf('platform') > -1;\r\n    const paramTypeTransform = this.injector.get<boolean>(PARAM_TYPE_TRANSFORM_TOKEN, false);\r\n    // UIState\r\n    this.uiState = this.injector.get<UIState>(UIState, null);\r\n    if (!this.uiState) {\r\n      return;\r\n    }\r\n    this.uiState.paramTypeTransform = paramTypeTransform;\r\n    this.uiState.initialize(this);\r\n    // \r\n    const url = (this.appContext && this.appContext.router && this.appContext.router.url) || '';\r\n    const routerParamService = new RouterParamService();\r\n    const routerParams = routerParamService.getParams(url);\r\n\r\n    // UIState\r\n    Object.keys(routerParams).forEach((propName: string) => {\r\n      Object.defineProperty(this.uiState, propName, {\r\n        get: () => {\r\n          return routerParams[propName];\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * ViewModel\r\n   * @todo\r\n   * 1propName\r\n   */\r\n  public regViewModel(viewModel: ViewModel): void {\r\n    if (this.appContext && this.appContext.viewModelManager.exsit(viewModel.name) === false) {\r\n      this.appContext.viewModelManager.register(viewModel.name, viewModel);\r\n    }\r\n    const className = viewModel.constructor.name;\r\n    const parentContext = this.parent;\r\n    let parentViewModel = null;\r\n    if (parentContext && parentContext.viewModel) {\r\n      parentViewModel = parentContext.viewModel;\r\n    }\r\n    if (!parentViewModel) {\r\n      return;\r\n    }\r\n    // name\r\n    const childViewModels = parentViewModel['childViewModels'];\r\n    let viewModelName = null;\r\n    if (childViewModels) {\r\n      const name = viewModel.constructor.name;\r\n      viewModelName = childViewModels[viewModel.name] || childViewModels[name];\r\n    } else if (className.length === 1) {\r\n      const classNameTokens = viewModel.name.split('-').map((nameToken, index) => {\r\n        if (index > 0 && nameToken.length) {\r\n          const pasicalName = nameToken.charAt(0).toLocaleUpperCase() + nameToken.substr(1, nameToken.length - 1);\r\n          return pasicalName;\r\n        } else if (index === 0 && nameToken.length) {\r\n          const camelName = nameToken.charAt(0).toLocaleLowerCase() + nameToken.substr(1, nameToken.length - 1);\r\n          return camelName;\r\n        }\r\n        return nameToken;\r\n      });\r\n      viewModelName = classNameTokens.join('');\r\n    } else if (viewModel[\"relateChildName\"]) {\r\n      //   \r\n      viewModelName = viewModel[\"relateChildName\"];\r\n    }\r\n    // vm name\r\n    if (!viewModelName) {\r\n      viewModelName = className[0].toLowerCase() + className.substring(1, className.length);\r\n    }\r\n    parentViewModel['viewModelNames'] = parentViewModel['viewModelNames'] || [];\r\n    parentViewModel[viewModelName] = viewModel;\r\n    parentViewModel['viewModelNames'].push(viewModelName);\r\n    viewModel.bindToParent(parentViewModel);\r\n  }\r\n\r\n  // #endregion\r\n\r\n  /**\r\n   * FrameContext\r\n   * @summary\r\n   * FrameContextAppContextFrameContext\r\n   */\r\n  public isRootFrameContext() {\r\n    return this.parent === null || (this.appContext.runMode === RunMode.highSpeed && this.getVirtualRootFrameContext().frameComponent['isDialogRootComponent'] === true);\r\n  }\r\n  /**\r\n   * namespaceroot-framecontext()\r\n   * @description\r\n   * root-framecontextframecontextframecontext\r\n   */\r\n  public getVirtualRootFrameContext() {\r\n    let formFrameContext: FrameContext = this;\r\n    let parent = this.parent;\r\n    while (parent) {\r\n      // parent.namespaceroot-framecontext\r\n      if (parent.namespace === this.namespace) {\r\n        formFrameContext = parent;\r\n        parent = parent.parent;\r\n      } else {\r\n        break;\r\n      }\r\n    }\r\n    return formFrameContext;\r\n  }\r\n\r\n\r\n  public getContextById(identify: string): any {\r\n    return this.appContext.getContextById(identify);\r\n  }\r\n\r\n  public getViewModel(viewModelName: string): ViewModel {\r\n    const renderAppContext = this.appContext;\r\n    if (renderAppContext) {\r\n      return renderAppContext.viewModelManager.getViewModelByName(viewModelName);\r\n    }\r\n    return null;\r\n  }\r\n\r\n  public attachViewComponent(viewComponent: FrameComponent) {\r\n    this.frameComponent = viewComponent;\r\n    this.appContext.frameComponentRefresher.regFrameComponent(this.frameId, this.frameComponent);\r\n  }\r\n\r\n  public invoke(actionPath: string, $event: any) {\r\n    const actionBindingPath = actionPath.split('.');\r\n    const actionName = actionBindingPath[actionBindingPath.length - 1];\r\n    const bindingViewModel = actionBindingPath.length === 1 ? this.viewModel :\r\n      this.getViewModel(actionBindingPath[actionBindingPath.length - 2]);\r\n    if (!bindingViewModel) {\r\n      alert(`'${actionPath}'`);\r\n    }\r\n    return bindingViewModel[actionName]($event);\r\n  }\r\n}\r\n","/*\r\n * @Author: Witt\r\n * @Date: 2019-03-12 14:59:22\r\n * @Last Modified by: aalizzwell\r\n * @Last Modified time: 2019-06-15 17:26:07\r\n */\r\n\r\nimport { Injector, Injectable, InjectFlags, Optional, ChangeDetectorRef, OnDestroy, ElementRef, Renderer, Renderer2, RendererFactory2, ComponentRef, OnInit } from '@angular/core';\r\nimport { FrameContext } from './frame_context';\r\nimport { ViewModel } from '../view-model/index';\r\nimport { Subscription, Declaration } from '../event-mechanism/index';\r\nimport { EventPipe } from '../event-bus-new/index';\r\nimport { ComponentType, IDisposable } from '../core/index';\r\nimport { FRAME_COMPONENT_INIT_HANDLER_TOKEN, onFrameComponentInit } from './tokens';\r\nimport { Subject } from 'rxjs';\r\n\r\n@Injectable()\r\nabstract class FrameComponent implements OnInit, OnDestroy, IDisposable {\r\n\r\n  /**\r\n   * \r\n   */\r\n  private cd: ChangeDetectorRef;\r\n\r\n  /**\r\n   * ID\r\n   */\r\n  public id: string;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public context: FrameContext;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public viewModel: ViewModel;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public subscription: Subscription;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public declaration: Declaration;\r\n\r\n  /**\r\n   * EventPipes\r\n   */\r\n  private eventPipes: IDisposable[];\r\n\r\n  private initialized = false;\r\n  /**\r\n   * \r\n   */\r\n  public destorySignal: Subject<any>;\r\n  /**\r\n   * \r\n   */\r\n  public componentType: ComponentType;\r\n  /**\r\n   * \r\n   * @param injector \r\n   */\r\n  constructor(protected injector: Injector) {\r\n    this.context = this.injector.get<FrameContext>(FrameContext, null);\r\n    if (this.context) {\r\n      this.initialize();\r\n    }\r\n    this.destorySignal = new Subject<any>();\r\n    // this.context.init(this);\r\n    // this.viewModel = this.context.viewModel;\r\n    // this.cd = this.getChangeDetectorRef();\r\n\r\n    // // contextSubscription\r\n    // this.initPublicEvent();\r\n\r\n    // this.initSubscription();\r\n\r\n    // this.restComponent();\r\n  }\r\n  /**\r\n   * \r\n   * @description true/falseundefined\r\n   * @warning \r\n   */\r\n  public get isGridComponent() {\r\n    if (this.context && this.context.viewModel) {\r\n      const dataGridColumnsName = this.context.viewModel['dataGridColumnsName'] || null;\r\n      return dataGridColumnsName ? true : false;\r\n    }\r\n    return undefined;\r\n  }\r\n  dispose(options?: any) {\r\n    if (this.eventPipes) {\r\n      this.eventPipes.forEach((eventPipe: IDisposable) => {\r\n        (eventPipe as EventPipe).disposeByCaller(this);\r\n      });\r\n    }\r\n    this.cd = null;\r\n    // this.viewModel = null;\r\n    this.context.dispose();\r\n    if (this.destorySignal) {\r\n      this.destorySignal.next();\r\n      this.destorySignal.complete();\r\n    }\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    this.initialize();\r\n  }\r\n\r\n  private initialize() {\r\n    if (!this.initialized) {\r\n      this.context.init(this);\r\n      this.viewModel = this.context.viewModel;\r\n      this.cd = this.getChangeDetectorRef();\r\n\r\n      // contextSubscription\r\n      this.initPublicEvent();\r\n\r\n      this.initSubscription();\r\n\r\n      this.restComponent();\r\n\r\n      this.onFrameComponentInit();\r\n      this.initialized = true;\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  private onFrameComponentInit() {\r\n    const frameComponentInitHandlers = this.injector.get<onFrameComponentInit[]>(FRAME_COMPONENT_INIT_HANDLER_TOKEN, null);\r\n    if (frameComponentInitHandlers && Array.isArray(frameComponentInitHandlers) && frameComponentInitHandlers.length > 0) {\r\n      frameComponentInitHandlers.forEach((handler: onFrameComponentInit) => {\r\n        handler.onComponentInit(this.context);\r\n      });\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   * @todo\r\n   */\r\n  private getChangeDetectorRef() {\r\n\r\n    // const cd = this.get<ChangeDetectorRef>(ChangeDetectorRef, null, InjectFlags.Optional);\r\n    const cd = this.injector.get(ChangeDetectorRef, null);\r\n    return cd;\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public detach() {\r\n    if (this.isCdValid() === false) {\r\n      return;\r\n    }\r\n    this.cd.detach();\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public reattach() {\r\n    if (this.isCdValid() === false) {\r\n      return;\r\n    }\r\n    this.cd.reattach();\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public detectChanges() {\r\n    if (this.isCdValid() === false) {\r\n      return;\r\n    }\r\n    this.cd.detectChanges();\r\n  }\r\n\r\n  /**\r\n   * ChangeDetection\r\n   * @todo: Can't be depend on the destroyed property, destroyed.\r\n   */\r\n  private isCdValid() {\r\n    return this.cd && this.cd['destroyed'] === false || false;\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @todoAppContext\r\n   */\r\n  public restComponent() {\r\n\r\n    if (this.context !== this.context.root) {\r\n      return;\r\n    }\r\n\r\n    // 1AppContextrootAppContextroot;\r\n    // 2ModuleFARRIS_DEVKIT_APP_PROVIDERSAppContext\r\n    //    AppContextAppContextparent.parent\r\n    // session\r\n    if (this.context.appContext.parent !== null && this.context.appContext.parent.parent !== null) {\r\n      return;\r\n    }\r\n\r\n    // Repository\r\n    // @todorepositoryRepository\r\n    this.context.repository.reset();\r\n    // \r\n    this.context.bindingData.reset();\r\n  }\r\n\r\n  public ngOnDestroy() {\r\n    this.dispose();\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private initSubscription() {\r\n    this.subscription = this.getSubscription();\r\n    if (!this.subscription) {\r\n      return;\r\n    }\r\n\r\n    this.eventPipes = this.subscription.init(this);\r\n  }\r\n\r\n\r\n  /**\r\n   * component\r\n   * @returns \r\n   */\r\n  public getSubscription() {\r\n    return this.injector.get<Subscription>(Subscription, null);\r\n  }\r\n\r\n  private initPublicEvent() {\r\n\r\n    this.declaration = this.getDeclaration();\r\n    if (!this.declaration) {\r\n      return;\r\n    }\r\n\r\n    this.declaration.init(this);\r\n  }\r\n\r\n  /**\r\n   * componentdeclaration\r\n   * @returns \r\n   */\r\n  public getDeclaration() {\r\n    return this.injector.get<Declaration>(Declaration, null);\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param eventName \r\n   */\r\n  public trigger(eventName: string) {\r\n    const subscription = this.context.commandBus.executingCommandCount$.subscribe((executingCommandCount: number) => {\r\n      if (executingCommandCount !== 0) {\r\n        return;\r\n      }\r\n      this.innerTrigger(eventName);\r\n\r\n      // @todo\r\n      // subscriptionundefine\r\n      if (subscription) {\r\n        subscription.unsubscribe();\r\n      } else {\r\n        setTimeout(() => {\r\n          if (subscription) {\r\n            subscription.unsubscribe();\r\n          }\r\n        }, 0);\r\n      }\r\n\r\n    });\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private innerTrigger(eventName: string) {\r\n\r\n    // \r\n    const eventHandler: any = this.declaration && this.declaration[eventName];\r\n    if (!eventHandler) {\r\n      return;\r\n    }\r\n    // \r\n    eventHandler();\r\n  }\r\n\r\n}\r\n\r\nexport { FrameComponent };\r\n","\r\n/**\r\n * \r\n */\r\nclass FrameEvent {\r\n\r\n  /**\r\n   * \r\n   */\r\n  type: string;\r\n\r\n  /**\r\n   * \r\n   */\r\n  data?: any;\r\n\r\n  /**\r\n   * id\r\n   */\r\n  frameIds?: string[];\r\n}\r\n\r\nexport { FrameEvent };\r\n","import { Injectable } from '@angular/core';\r\nimport { Subject } from 'rxjs';\r\nimport { filter } from 'rxjs/operators';\r\nimport { FrameEvent } from './frame_event';\r\n\r\n\r\n/**\r\n * \r\n */\r\n@Injectable()\r\nclass FrameEventBus {\r\n\r\n  /**\r\n   * @todo \r\n   */\r\n  private subscriptions: any;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public events: Subject<FrameEvent> = new Subject<FrameEvent>();\r\n\r\n\r\n  /**\r\n   * \r\n   */\r\n  on(eventType: string, eventHandler: any, frameId: string) {\r\n    this.events.pipe(filter((event: FrameEvent) => {\r\n      if (event.type !== eventType) {\r\n        return false;\r\n      }\r\n      return !event.frameIds || event.frameIds.indexOf(frameId) > -1;\r\n    })).subscribe(eventHandler);\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  off(eventType: string, frameId: string): void {\r\n    throw new Error('');\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  trigger(eventType: string, eventData?: any, frameIds?: string[]) {\r\n    const event: FrameEvent = {\r\n      type: eventType,\r\n      data: eventData,\r\n      frameIds: frameIds\r\n    };\r\n    this.events.next(event);\r\n  }\r\n}\r\n\r\nexport { FrameEventBus };\r\n","/**\r\n * \r\n * @author Witt<jiwt@inspur.com>\r\n */\r\n\r\nimport { Injectable } from '@angular/core';\r\nimport { FrameContext } from '../frame/index';\r\nimport { CommandHandler } from './command_handler';\r\nimport { CommandHandlerRegistry } from './command_handler_registry';\r\nimport { CommandHandlerExtender } from './command_handler_extender';\r\nimport { CommandHandlerExtenderRegistry } from './command_handler_extender_registry';\r\nimport { VariableParseService } from '../variable/variable_parse_service';\r\n\r\n/**\r\n * \r\n */\r\n@Injectable()\r\nclass CommandHandlerFactory {\r\n\r\n  /**\r\n   * \r\n   * @param handlerRegistry  \r\n   * @param extenderRegistry \r\n   */\r\n  constructor(\r\n    private handlerRegistry: CommandHandlerRegistry,\r\n    private extenderRegistry: CommandHandlerExtenderRegistry,\r\n    private frameContext: FrameContext,\r\n    private variableParseService: VariableParseService\r\n  ) {\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param   commandName \r\n   * @returns \r\n   */\r\n  public create(commandName: string): CommandHandler {\r\n    const rawHandler = this.handlerRegistry.get(commandName);\r\n    rawHandler.init(this.frameContext, this.variableParseService);\r\n    const extenders = this.extenderRegistry.get(commandName);\r\n\r\n    // extendershandler\r\n    return extenders.reduce((handler: CommandHandler, extender: CommandHandlerExtender) => {\r\n      return extender.extend(handler);\r\n    }, rawHandler);\r\n  }\r\n  public dispose() {\r\n    this.handlerRegistry.dispose();\r\n    this.extenderRegistry.dispose();\r\n    this.frameContext = null;\r\n    this.variableParseService = null;\r\n  }\r\n}\r\n\r\nexport { CommandHandlerFactory };\r\n","/**\r\n * CommandBus\r\n * @author Witt<jiwt@inspur.com>\r\n */\r\n\r\nimport { HttpErrorResponse } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { IDisposable } from '../core';\r\nimport { Observable, BehaviorSubject, Subject } from 'rxjs';\r\nimport { tap } from 'rxjs/operators';\r\nimport { Command } from './command';\r\nimport { CommandHandlerFactory } from './command_handler_factory';\r\n\r\n/**\r\n * CommandBusCommandCommandCommandHandler\r\n */\r\n@Injectable()\r\nclass CommandBus implements IDisposable{\r\n\r\n  /**\r\n   * handler\r\n   */\r\n  private handlerFactory: CommandHandlerFactory;\r\n\r\n  /**\r\n   * \r\n   */\r\n  public executingCommandCount$: BehaviorSubject<number>;\r\n\r\n  /**\r\n   * \r\n   */\r\n  private executingCommands: Command[];\r\n\r\n  /**\r\n   * \r\n   */\r\n  public constructor(handlerFactory: CommandHandlerFactory) {\r\n    this.handlerFactory = handlerFactory;\r\n    this.executingCommands = [];\r\n    this.executingCommandCount$ = new BehaviorSubject<number>(this.executingCommands.length);\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param command \r\n   */\r\n  public dispatch(command: Command): Observable<any> {\r\n    const commandResult$ = new Subject();\r\n    this.executeCommand(command).subscribe({\r\n      next: (lastTaskResult: any) => {\r\n        commandResult$.next(lastTaskResult);\r\n        commandResult$.complete();\r\n      },\r\n      complete: () => {\r\n        commandResult$.complete();\r\n        this.removeCommandFromExecutingQueue(command);\r\n      },\r\n      error: (error: any) => {\r\n        commandResult$.error(error);\r\n        this.removeCommandFromExecutingQueue(command, !this.is401Error(error));\r\n      }\r\n    });\r\n    return commandResult$;\r\n  }\r\n\r\n  /**\r\n   * dispose\r\n   */\r\n  public dispose(){\r\n    this.handlerFactory.dispose();\r\n  }\r\n  /**\r\n   * \r\n   */\r\n  private executeCommand(command: Command): Observable<any> {\r\n    this.addCommandToExecutingQueue(command);\r\n    const commandName = command.name;\r\n    const handler = this.handlerFactory.create(commandName);\r\n    const lastTaskResult$ = handler.execute(command);\r\n    return lastTaskResult$;\r\n  }\r\n\r\n\r\n  /**\r\n   * \r\n   */\r\n  private addCommandToExecutingQueue(command: Command) {\r\n    this.executingCommands.push(command);\r\n    this.executingCommandCount$.next(this.executingCommands.length);\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private removeCommandFromExecutingQueue(command: Command, postOrNot: boolean = true) {\r\n    this.executingCommands = this.executingCommands.filter((executingCommand: Command) => {\r\n      return executingCommand !== command;\r\n    });\r\n    if (postOrNot === true) {\r\n      this.executingCommandCount$.next(this.executingCommands.length);\r\n    }\r\n  }\r\n\r\n  private is401Error(error: HttpErrorResponse) {\r\n    // error401\r\n    return error && error.status === 401;\r\n  }\r\n\r\n}\r\n\r\nexport { CommandBus };\r\n","import { ReflectiveInjector } from '@angular/core';\r\nimport { isObservable, of, Subject } from 'rxjs';\r\nimport { CommandContext } from './command_context';\r\nimport { CommandHandler } from './command_handler';\r\nimport {\r\n  ControllerMethod, DeterminingStage, ExecutingStage,\r\n  ForkStage, MethodStage, StageParam\r\n} from './dynamic_command_handler_metadata';\r\n\r\n/**\r\n * @Injectable()\r\n * @NgCommandHandler({\r\n *     commandName: 'add1'\r\n * })\r\n * export class add1Handler extends CommandHandler {\r\n *     constructor(\r\n *         public _ListDataService1: ListDataService1,\r\n *         public _StateMachineService1: StateMachineService1\r\n *     ) {\r\n *         super();\r\n *     }\r\n *\r\n *     schedule() {\r\n *         this.addTask('append', (context: CommandContext) => {\r\n *             const args = [];\r\n *             return this.invoke(this._ListDataService1, 'append', args, context);\r\n *         });\r\n *\r\n *         this.addTask('transit', (context: CommandContext) => {\r\n *             const args = [\r\n *                 'Create'\r\n *                     ];\r\n *             return this.invoke(this._StateMachineService1, 'transit', args, context);\r\n *         });\r\n *\r\n *         this.addLink('append', 'transit', `1==1`);\r\n *     }\r\n * }\r\n */\r\n\r\nconst controllerMap = {\r\n  imports: {\r\n\r\n  }\r\n};\r\n\r\ndeclare const System: any;\r\n\r\nexport class DynamicCommandHandler extends CommandHandler {\r\n\r\n  constructor(public commandName: string, private method: ControllerMethod) {\r\n    super();\r\n  }\r\n\r\n  public dynamicInvoke(serviceTocken: string, method: string, args: StageParam[], context: CommandContext) {\r\n    const serviceInstance = context.frameContext.injector.get(serviceTocken, null);\r\n    if (serviceInstance) {\r\n      this.setContextToServiceInstance(serviceInstance, context);\r\n      const parsedStageParams = this.parseService.parse(args, context) as StageParam[];\r\n      const parsedArgs = parsedStageParams.map(param => param.expression);\r\n      // tslint:disable-next-line: ban-types\r\n      const serviceMethod = serviceInstance[method] as Function;\r\n      return serviceMethod.apply(serviceInstance, parsedArgs);\r\n    }\r\n  }\r\n\r\n  public dynamicInvoke2(methodObject: ExecutingStage, context: CommandContext) {\r\n    const { source: serviceUri, service: serviceName, method } = methodObject;\r\n    const args = methodObject.params.map(stageParam => {\r\n      return Object.assign({}, stageParam);\r\n    });\r\n    const result$ = new Subject();\r\n    const serviceSpecifer = serviceUri && serviceUri.toLowerCase();\r\n    if (serviceSpecifer) {\r\n      let serviceModule = controllerMap.imports[serviceSpecifer];\r\n      if (serviceModule) {\r\n        // \r\n        setTimeout(() => {\r\n          this.executeWithServiceModule(serviceModule, serviceName, context, args, method, result$);\r\n        }, 0);\r\n      } else {\r\n        //  \r\n        System.import(serviceSpecifer)\r\n          .then((serviceModule: any) => {\r\n            if (serviceModule) {\r\n              controllerMap.imports[serviceSpecifer] = serviceModule;\r\n            }\r\n            this.executeWithServiceModule(serviceModule, serviceName, context, args, method, result$);\r\n          });\r\n      }\r\n    }\r\n    return result$;\r\n  }\r\n\r\n  private executeWithServiceModule(serviceModule: any, serviceName: string, context: CommandContext, args: StageParam[], method: string, result$: Subject<unknown>) {\r\n    const serviceConstructor = serviceModule[serviceName];\r\n    if (serviceConstructor) {\r\n      const originalContextInjector = context.frameContext.injector;\r\n      let serviceInstance;\r\n      // const resolvedReflectiveProviders = ReflectiveInjector.resolve([{ provide: serviceName, useClass: serviceConstructor }]);\r\n      if (context.frameContext.injector.get(serviceName, null)) {\r\n        serviceInstance = context.frameContext.injector.get(serviceName);\r\n      } else {\r\n        const resolvedReflectiveProviders = this.loadProvidersFromModule(serviceModule);\r\n        const reflectiveInjector = ReflectiveInjector.fromResolvedProviders(resolvedReflectiveProviders, context.frameContext.injector);\r\n        context.frameContext.injector = reflectiveInjector;\r\n        serviceInstance = reflectiveInjector.get(serviceName, null);\r\n      }\r\n\r\n      if (serviceInstance) {\r\n        this.setContextToServiceInstance(serviceInstance, context);\r\n        const parsedStageParams = this.parseService.parse(args, context) as StageParam[];\r\n        const parsedArgs = parsedStageParams.map(param => param.expression);\r\n        // tslint:disable-next-line: ban-types\r\n        const serviceMethod = serviceInstance[method] as Function;\r\n        if (!serviceMethod) {\r\n          console.error(\":\" + method);\r\n          return;\r\n        }\r\n        const serviceMethodResult = serviceMethod.apply(serviceInstance, parsedArgs);\r\n        const result$$ = isObservable(serviceMethodResult) ? serviceMethodResult : of(serviceMethodResult);\r\n        result$$.subscribe({\r\n          next: (result: any) => {\r\n            result$.next(result);\r\n          },\r\n          error: (error: any) => {\r\n            result$.error(error);\r\n          },\r\n          complete: () => {\r\n            result$.complete();\r\n            context.frameContext.injector = originalContextInjector;\r\n          },\r\n        });\r\n        // return serviceMethod.apply(serviceInstance, parsedArgs);\r\n      }\r\n    }\r\n  }\r\n\r\n  schedule() {\r\n    this.scheduleStages(this.method.stages, null);\r\n    // this.method.stages.reduce((preStage: MethodStage, currentStage: MethodStage) => {\r\n    //   if (currentStage.type === '0') {\r\n    //     this.addTask(currentStage.name, (context: CommandContext) => {\r\n    //       return this.dynamicInvoke2(currentStage as ExecutingStage, context);\r\n    //     });\r\n    //     if (preStage) {\r\n    //       this.addLink(preStage.name, currentStage.name, `1===1`);\r\n    //     }\r\n    //   } else if (currentStage.type === '2') {\r\n\r\n    //   } else {\r\n    //     throw new Error(`unknow method stage type, the ${currentStage.name}'s type is ${currentStage.type}`);\r\n    //   }\r\n    //   return currentStage;\r\n    // }, null);\r\n  }\r\n\r\n  scheduleStages(stages: MethodStage[], initialStage: MethodStage) {\r\n    stages.reduce((preStage: MethodStage, currentStage: MethodStage) => {\r\n      if (currentStage.type === 'executing') {\r\n        this.addTask(currentStage.name, (context: CommandContext) => {\r\n          return this.dynamicInvoke2(currentStage as ExecutingStage, context);\r\n        });\r\n      } else if (currentStage.type === 'fork') {\r\n        const forkStages = (currentStage as ForkStage).stages;\r\n        forkStages.forEach(forkStage => {\r\n          this.scheduleStages(forkStage.stages, forkStage);\r\n        });\r\n        this.scheduleStages((currentStage as DeterminingStage).stages, currentStage);\r\n      } else if (currentStage.type === 'determing') {\r\n        this.addTask(currentStage.name, (context: CommandContext) => {\r\n          return of(true);\r\n        });\r\n      } else {\r\n        throw new Error(`unknow method stage type, the ${currentStage.name}'s type is ${currentStage.type}`);\r\n      }\r\n      if (preStage) {\r\n        const condition = preStage.type === 'determing' ? (preStage as DeterminingStage).condition : `1===1`;\r\n        this.addLink(preStage.name, currentStage.name, condition);\r\n      }\r\n      return currentStage;\r\n    }, initialStage);\r\n  }\r\n\r\n  private loadProvidersFromModule(serviceModule: { [propertyName: string]: any }) {\r\n    const providerArray = [];\r\n    for (const propertyName in serviceModule) {\r\n      if (Object.prototype.hasOwnProperty.call(serviceModule, propertyName)) {\r\n        const propertyValue = serviceModule[propertyName];\r\n        if (this.isInjectableService(propertyValue)) {\r\n          // const providerName = propertyValue.name === 'e' ? propertyName : propertyValue.name;\r\n          const providerName = propertyName;\r\n          providerArray.push({ provide: providerName, useClass: propertyValue });\r\n          providerArray.push(propertyValue);\r\n        }\r\n      }\r\n    }\r\n    const resolvedReflectiveProviders = ReflectiveInjector.resolve(providerArray);\r\n    return resolvedReflectiveProviders;\r\n  }\r\n\r\n  private isInjectableService(propertyValue: any) {\r\n    let hasInjectableDecorator = false;\r\n    const isFunction = propertyValue instanceof Function;\r\n    if (isFunction && propertyValue.hasOwnProperty('decorators')) {\r\n      const decorators = propertyValue.decorators as any[];\r\n      const injectableDecorators = decorators.filter(decorator => {\r\n        if (decorator.type && decorator.type.prototype && decorator.type.prototype.ngMetadataName === 'Injectable') {\r\n          return decorator;\r\n        }\r\n      });\r\n      hasInjectableDecorator = injectableDecorators && injectableDecorators.length > 0;\r\n    } else if (isFunction && propertyValue.hasOwnProperty('__annotations__')) {\r\n      const decorators = propertyValue.__annotations__ as any[];\r\n      const injectableDecorators = decorators.filter(decoratorFactory => {\r\n        if (decoratorFactory && decoratorFactory.ngMetadataName && decoratorFactory.ngMetadataName === 'Injectable') {\r\n          return decoratorFactory;\r\n        }\r\n      });\r\n      hasInjectableDecorator = injectableDecorators && injectableDecorators.length > 0;\r\n    }\r\n    return hasInjectableDecorator;\r\n  }\r\n}\r\n","import { CommandHandlerRegistry } from './command_handler_registry';\r\nimport { CommandHandlerExtenderRegistry } from './command_handler_extender_registry';\r\nimport { CommandHandlerFactory } from './command_handler_factory';\r\nimport { CommandBus } from './command_bus';\r\n\r\n\r\nexport const COMMAND_PROVIDERS = [\r\n  CommandHandlerRegistry,\r\n  CommandHandlerExtenderRegistry,\r\n  CommandHandlerFactory,\r\n  CommandBus,\r\n];\r\n","/*\r\n * @Author: aalizzwell \r\n * @Date: 2019-05-30 11:08:18 \r\n * @Last Modified by: aalizzwell\r\n * @Last Modified time: 2019-06-01 17:10:04\r\n */\r\n\r\nimport { InjectionToken } from '@angular/core';\r\nimport { IValidationHandler } from './types';\r\nexport const VALIDATION_HANDLER = new InjectionToken<IValidationHandler>('@farris/common-service ValidationHandler');","import { Provider } from '@angular/core';\r\nimport { VARIABLE_PROVIDERS } from './variable/index';\r\nimport { AppContext, AppContextManager } from './app/index';\r\n\r\nimport { RestfulService } from './rest/index';\r\nimport { RouterParamService } from './misc/index';\r\n\r\nimport { COMMAND_PROVIDERS } from './command/index';\r\nimport { FrameContext, FrameEventBus } from './frame/index';\r\nimport { Subscription } from './event-mechanism/index';\r\nimport { EventBus } from './event-bus-new/index';\r\nimport { RepositoryChangeListener, UIStateChangeListener, ListenerRegistry, Listeners, LISTENER_TOKEN, BindingDataChangeListener } from './listener/index';\r\nimport { ExpressionEngineImpl, ExpressionEventEmitter, ExpressionRegistry, ExpressionExecutor, ExpressionManager, ExpressionResult, EVENT_HANDLER_TOKEN, ExpressionResultFactory } from './expression/index';\r\nimport { RepositoryEffector, UIStateEffector, ReadonlyEffector, EffectorFactory, EffectorRegistry, EFFECTOR_TOKEN, DependencyEffector, RelativeEffector, ValidateEffector, RequiredEffector, VisibleEffector } from './effector/index';\r\nimport { EntityDependencyResolver, StateDependencyResolver, ResolverRegistry, CommentDependencyResolver, RESOLVER_TOKEN, ResolveService } from './resolver/index';\r\nimport { RepositoryAddEntityEventHandler, RepositoryRemoveEntityEventHandler, EntityValueChangedEventHandler, StateValueChangedEventHandler, RepositoryLoadEventHandler, EntityUpdateEventHandler, BindingDataAppendObjectEventHandler, BindingDataValueChangeEventHandler, BindingDataRemoveObjectEventHandler, BindingDataLoadEventHandler, EventHandlerRegistry, BindingDataSelectionChangedEventHandler } from './event-handler/index';\r\n\r\n// --------------------------------------------------------------------------------\r\n// Legacy\r\n// --------------------------------------------------------------------------------\r\n\r\n/**\r\n * Providers for compatibility.\r\n */\r\nexport const FARRIS_DEVKIT_APP_PROVIDERS = [\r\n  EventBus,\r\n  Subscription,\r\n  RestfulService,\r\n  VARIABLE_PROVIDERS,\r\n\r\n  AppContext,\r\n  RouterParamService,\r\n  FrameEventBus,\r\n  AppContextManager\r\n];\r\n\r\n// --------------------------------------------------------------------------------\r\n// Current\r\n// --------------------------------------------------------------------------------\r\n\r\n/**\r\n * Providers for DevkitModule.\r\n */\r\nexport const FARRIS_DEVKIT_MODULE_PROVIDERS = [\r\n  EventBus,\r\n  Subscription,\r\n  RestfulService,\r\n  RouterParamService,\r\n  VARIABLE_PROVIDERS,\r\n  AppContextManager,\r\n];\r\n\r\n/**\r\n * Providers for root frame components.\r\n */\r\nexport const FARRIS_DEVKIT_ROOT_FRAME_PROVIDERS: Provider[] = [\r\n  AppContext,\r\n];\r\n/**\r\n * provider\r\n * @description root-component\r\n */\r\nexport const FARRIS_DEVKIT_EXPRESSION_ROOT_FRAME_PROVIDERS: Provider[] = [\r\n  ListenerRegistry,\r\n  Listeners,\r\n  EffectorRegistry,\r\n  EffectorFactory,\r\n  ExpressionRegistry,\r\n  ExpressionEventEmitter,\r\n  ExpressionExecutor,\r\n  ExpressionManager,\r\n  ExpressionResult,\r\n  ExpressionResultFactory,\r\n  { provide: RESOLVER_TOKEN, useClass: EntityDependencyResolver, multi: true },\r\n  { provide: RESOLVER_TOKEN, useClass: StateDependencyResolver, multi: true },\r\n  { provide: RESOLVER_TOKEN, useClass: CommentDependencyResolver, multi: true },\r\n  ResolverRegistry,\r\n  { provide: EVENT_HANDLER_TOKEN, useClass: RepositoryAddEntityEventHandler, multi: true },\r\n  { provide: EVENT_HANDLER_TOKEN, useClass: RepositoryRemoveEntityEventHandler, multi: true },\r\n  { provide: EVENT_HANDLER_TOKEN, useClass: EntityValueChangedEventHandler, multi: true },\r\n  { provide: EVENT_HANDLER_TOKEN, useClass: StateValueChangedEventHandler, multi: true },\r\n  { provide: EVENT_HANDLER_TOKEN, useClass: RepositoryLoadEventHandler, multi: true },\r\n  { provide: EVENT_HANDLER_TOKEN, useClass: EntityUpdateEventHandler, multi: true },\r\n  { provide: EVENT_HANDLER_TOKEN, useClass: BindingDataAppendObjectEventHandler, multi: true },\r\n  { provide: EVENT_HANDLER_TOKEN, useClass: BindingDataValueChangeEventHandler, multi: true },\r\n  { provide: EVENT_HANDLER_TOKEN, useClass: BindingDataRemoveObjectEventHandler, multi: true },\r\n  { provide: EVENT_HANDLER_TOKEN, useClass: BindingDataLoadEventHandler, multi: true },\r\n  { provide: EVENT_HANDLER_TOKEN, useClass: BindingDataSelectionChangedEventHandler, multi: true},\r\n  EventHandlerRegistry,\r\n  ExpressionEngineImpl,\r\n  ResolveService\r\n];\r\n/**\r\n * provider\r\n * @description rootroot\r\n */\r\nexport const FARRIS_DEVKIT_EXPRESSION_LISTENER_PROVIDERS: Provider[] = [\r\n  { provide: LISTENER_TOKEN, useClass: UIStateChangeListener, multi: true },\r\n  { provide: LISTENER_TOKEN, useClass: RepositoryChangeListener, multi: true },\r\n  { provide: LISTENER_TOKEN, useClass: BindingDataChangeListener, multi: true }\r\n];\r\n\r\nexport const FARRIS_DEVKIT_EXPRESSION_EFFECTOR_PROVIDERS: Provider[] = [\r\n  { provide: EFFECTOR_TOKEN, useClass: RepositoryEffector, multi: true },\r\n  { provide: EFFECTOR_TOKEN, useClass: UIStateEffector, multi: true },\r\n  { provide: EFFECTOR_TOKEN, useClass: ReadonlyEffector, multi: true },\r\n  { provide: EFFECTOR_TOKEN, useClass: DependencyEffector, multi: true },\r\n  { provide: EFFECTOR_TOKEN, useClass: RelativeEffector, multi: true },\r\n  { provide: EFFECTOR_TOKEN, useClass: ValidateEffector, multi: true },\r\n  { provide: EFFECTOR_TOKEN, useClass: RequiredEffector, multi: true },\r\n  { provide: EFFECTOR_TOKEN, useClass: VisibleEffector, multi: true }\r\n];\r\n\r\n/**\r\n * Providers for frame components.\r\n */\r\nexport const FARRIS_DEVKIT_FRAME_PROVIDERS = [\r\n  COMMAND_PROVIDERS,\r\n  FrameContext\r\n];\r\n","import { NgModule } from '@angular/core';\r\nimport { FARRIS_DEVKIT_MODULE_PROVIDERS } from './providers';\r\n/**\r\n * DevkitModule\r\n */\r\n@NgModule({\r\n  providers: FARRIS_DEVKIT_MODULE_PROVIDERS\r\n})\r\nclass DevkitModule {\r\n}\r\n\r\nexport { DevkitModule };\r\n","import { Inject, Injectable, Injector } from '@angular/core';\r\nimport { BindingData, Change } from '../binding-data/index';\r\nimport { ChangeListener } from './change_listener';\r\nimport { NAMESPACE } from '../frame/index';\r\n\r\n/**\r\n * bindingList\r\n * @description \r\n * @deprecated \r\n */\r\n@Injectable()\r\nclass DeprecatedBindingDataChangeListener extends ChangeListener {\r\n  constructor(private injector: Injector, private bindingData: BindingData, @Inject(NAMESPACE) private namespace) {\r\n    super();\r\n  }\r\n\r\n  public buildEventPath(change: Change): string[] {\r\n    return null;\r\n  }\r\n}\r\nexport { DeprecatedBindingDataChangeListener };\r\n","export type Type = (...args) => any;\r\nexport type TTL = number | Date;\r\nexport type Key = string | number | ICacheKey | ICacheKeyBuilder;\r\nexport interface ICacheKeyBuilder<T = any[], U = any> {\r\n  (context: U, args: T): any;\r\n}\r\nexport enum CacheReturnType {\r\n  Static = 1,\r\n  Promise\r\n}\r\nexport interface ICacheKey { }\r\nexport interface ICacheKeyCompare {\r\n  compare(key1: ICacheKey, key2: ICacheKey): boolean;\r\n}\r\nexport class CacheKeyCompare implements ICacheKeyCompare {\r\n  compare(key1: string | number, key2: string | number) {\r\n    return key1 === key2;\r\n  }\r\n}\r\nexport interface ICacheOptions<T> {\r\n  key?: Key;\r\n  // returnType?: CacheReturnType;\r\n  ttl?: TTL;\r\n  cacheKeyCompare?: ICacheKeyCompare;\r\n  provider: ICacheProvider<T>\r\n}\r\nexport interface ICacheObject<TValue> {\r\n  key: Key,\r\n  content: TValue,\r\n  ttl: TTL,\r\n  createAt: Date,\r\n  isExpired(): boolean;\r\n}\r\nexport interface ICacheProvider<TValue> {\r\n  has(key: Key): boolean;\r\n  length(): number;\r\n  set(value: ICacheObject<TValue>);\r\n  get(key: Key): ICacheObject<TValue>;\r\n  delete(key: Key);\r\n  clear();\r\n  keys(): IterableIterator<Key>;\r\n  values(): IterableIterator<ICacheObject<TValue>>;\r\n}\r\n","import { ICacheObject, Key, TTL } from \"../types\";\r\n\r\nexport class CacheObject<T> implements ICacheObject<T>{\r\n  public createAt: Date;\r\n  constructor(public key: Key, public content: T, public ttl: TTL) {\r\n    this.createAt = new Date();\r\n  }\r\n  public isExpired(): boolean {\r\n    if (typeof this.ttl === 'number') {\r\n      return Date.now().valueOf() > this.createAt.valueOf() + this.ttl;\r\n    } else {\r\n      return Date.now() > this.ttl.valueOf();\r\n    }\r\n  }\r\n}","import { ICacheObject, ICacheProvider, Key, TTL } from \"../types\";\r\nimport { CacheObject } from \"./cache_object\";\r\n\r\nexport class CacheContainer<T>{\r\n  constructor(protected provider: ICacheProvider<T>) {\r\n    this.provider = provider;\r\n  }\r\n  public get(key: Key): T {\r\n    const cacheObject: ICacheObject<T> = this.provider.get(key);\r\n    if (!cacheObject) {\r\n      return undefined;\r\n    }\r\n    const isExpired = this.isCacheObjectExpired(cacheObject);\r\n    return isExpired ? undefined : cacheObject.content;\r\n  }\r\n  public set(key: Key, value: T, ttl?: TTL) {\r\n    const cacheObject: ICacheObject<T> = new CacheObject(key, value, ttl || 0);\r\n    this.provider.set(cacheObject);\r\n  }\r\n  private isCacheObjectExpired(cacheObject: ICacheObject<T>) {\r\n    if (typeof cacheObject.ttl === 'number') {\r\n      return Date.now().valueOf() > cacheObject.createAt.valueOf() + cacheObject.ttl;\r\n    } else {\r\n      return Date.now() > cacheObject.ttl.valueOf();\r\n    }\r\n  }\r\n}","import { CacheKeyCompare, ICacheKeyCompare, ICacheObject, ICacheProvider, Key } from \"../types\";\r\n\r\nexport class MemoryCacheProvider<T> implements ICacheProvider<T> {\r\n  protected store: Array<ICacheObject<T>>;\r\n  protected cacheKeyCompare: ICacheKeyCompare;\r\n\r\n  constructor(cacheKeyCompare?: ICacheKeyCompare) {\r\n    this.store = new Array<ICacheObject<T>>();\r\n    this.cacheKeyCompare = cacheKeyCompare || new CacheKeyCompare();\r\n  }\r\n  public has(key: Key): boolean {\r\n    if (this.store.length < 1) {\r\n      return false;\r\n    }\r\n    const index = this.store.findIndex((item: ICacheObject<T>) => item && this.cacheKeyCompare.compare(key, item.key));\r\n    return index !== -1;\r\n  }\r\n  public length(): number {\r\n    return this.store.length;\r\n  }\r\n  public set(value: ICacheObject<T>) {\r\n    this.store.push(value);\r\n  }\r\n  public get(key: Key): ICacheObject<T> {\r\n    if (this.store.length < 1) {\r\n      return undefined;\r\n    }\r\n    return this.store.find((item: ICacheObject<T>) => this.cacheKeyCompare.compare(key, item.key));\r\n  }\r\n  public delete(key: Key) {\r\n    if (this.store.length < 1) {\r\n      return;\r\n    }\r\n    const index = this.store.findIndex((item: ICacheObject<T>) => item && this.cacheKeyCompare.compare(key, item.key));\r\n    this.store.splice(index, 1);\r\n  }\r\n  public clear() {\r\n    this.store.length = 0;\r\n  }\r\n  public keys(): IterableIterator<Key> {\r\n    return this.store.keys();\r\n  }\r\n  public values(): IterableIterator<ICacheObject<T>> {\r\n    return this.store.values();\r\n  }\r\n}","import { ICacheObject, ICacheProvider, Key } from \"../types\";\r\n\r\n/**\r\n * \r\n * @description\r\n * Mapkeykeykey\r\n */\r\nexport class DefaultCacheProvider<T> implements ICacheProvider<T>{\r\n  private buffer: Map<any, ICacheObject<T>>;\r\n\r\n  constructor() {\r\n    this.buffer = new Map<any, ICacheObject<T>>();\r\n  }\r\n  public has(key: Key): boolean {\r\n    return this.buffer.has(key);\r\n  }\r\n  public length(): number {\r\n    return this.buffer.size;\r\n  }\r\n  public set(value: ICacheObject<T>) {\r\n    this.buffer.set(value.key, value);\r\n  }\r\n  public get(key: Key): ICacheObject<T> {\r\n    return this.buffer.get(key);\r\n  }\r\n  public delete(key: Key) {\r\n    this.buffer.delete(key);\r\n  }\r\n  public clear() {\r\n    this.buffer.clear();\r\n  }\r\n  public keys(): IterableIterator<Key> {\r\n    return this.buffer.keys();\r\n  }\r\n  public values(): IterableIterator<ICacheObject<T>> {\r\n    return this.buffer.values();\r\n  }\r\n}","\r\n/**\r\n  * Encode a URL to a percent-encoded form, excluding already-encoded sequences.\r\n  *\r\n  * This function will take an already-encoded URL and encode all the non-URL\r\n  * code points. This function will not encode the \"%\" character unless it is\r\n  * not part of a valid sequence (`%20` will be left as-is, but `%foo` will\r\n  * be encoded as `%25foo`).\r\n  *\r\n  * This encode is meant to be \"safe\" and does not throw errors. It will try as\r\n  * hard as it can to properly encode the given URL, including replacing any raw,\r\n  * unpaired surrogate pairs with the Unicode replacement character prior to\r\n  * encoding.\r\n  *\r\n  * @param {string} url\r\n  * @return {string}\r\n  * @public\r\n  */\r\n\r\n export function encodeUrl(url) {\r\n  const ENCODE_CHARS_REGEXP = /(?:[^\\x21\\x25\\x26-\\x3B\\x3D\\x3F-\\x5B\\x5D\\x5F\\x61-\\x7A\\x7E]|%(?:[^0-9A-Fa-f]|[0-9A-Fa-f][^0-9A-Fa-f]|$))+/g;\r\n  const UNMATCHED_SURROGATE_PAIR_REGEXP = /(^|[^\\uD800-\\uDBFF])[\\uDC00-\\uDFFF]|[\\uD800-\\uDBFF]([^\\uDC00-\\uDFFF]|$)/g;\r\n  const UNMATCHED_SURROGATE_PAIR_REPLACE = '$1\\uFFFD$2';\r\n  return String(url)\r\n    .replace(UNMATCHED_SURROGATE_PAIR_REGEXP, UNMATCHED_SURROGATE_PAIR_REPLACE)\r\n    .replace(ENCODE_CHARS_REGEXP, encodeURI)\r\n    .replace(/#/g,'%23').replace(/&/g,'%26')\r\n}","import { ICacheObject, ICacheOptions } from \"../types\";\r\nimport { CacheObject } from \"./cache_object\";\r\n/**\r\n * \r\n * @param options ICacheOptions \r\n * @returns MethodDecorator\r\n */\r\nexport function Cacheable<T>(options?: ICacheOptions<T>): MethodDecorator {\r\n  return function (target: any, propertyKey: string | symbol, descriptor: PropertyDescriptor) {\r\n    if (descriptor === undefined) {\r\n      descriptor = Object.getOwnPropertyDescriptor(target, propertyKey);\r\n    }\r\n    const className = target.name || target && target.constructor && target.constructor.name;\r\n    const method = descriptor.value;\r\n    descriptor.value = function (...args: any[]) {\r\n      const ttl = options && options.ttl || 0;\r\n      const provider = options && options.provider;\r\n      if (!provider) {\r\n        throw new Error('cache provider is not defined.');\r\n      }\r\n      let key = options && options.key || undefined;\r\n      if (key && key instanceof Function) {\r\n        key = key(this, args);\r\n      }\r\n      let cacheKey = key;\r\n      if (!cacheKey) {\r\n        const argsString: string = JSON.stringify(args);\r\n        cacheKey = `${className}#${String(propertyKey)}#${argsString}`;\r\n      }\r\n      const cacheObject = provider.get(cacheKey);\r\n      if (!cacheObject || (ttl && cacheObject.isExpired() === true)) {\r\n        const result = method.apply(this, args);\r\n        const object: ICacheObject<T> = new CacheObject(cacheKey, result, ttl);\r\n        provider.set(object);\r\n        return result;\r\n      }\r\n\r\n      return cacheObject && cacheObject.content;\r\n    }\r\n    return descriptor;\r\n  }\r\n}"]}