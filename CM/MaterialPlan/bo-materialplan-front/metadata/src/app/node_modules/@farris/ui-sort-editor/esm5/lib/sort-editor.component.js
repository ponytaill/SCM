/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, HostBinding, Input, Output, EventEmitter, Injector } from '@angular/core';
import { MessagerService } from '@farris/ui-messager';
import { cloneDeep } from 'lodash-es';
import { SortTypes, SortType } from '@farris/ui-common/types';
import { DomSanitizer } from '@angular/platform-browser';
import { LocaleService } from '@farris/ui-locale';
var SortEditorComponent = /** @class */ (function () {
    function SortEditorComponent(messagerService, sanitizer, injector) {
        this.messagerService = messagerService;
        this.sanitizer = sanitizer;
        this.injector = injector;
        this.sortTypes = SortTypes;
        this.columnSizeData = [30, 120, 60];
        this.cls = 'f-sort-editor f-utils-flex-column f-utils-absolute-all';
        this.fieldEditor = { type: 'select', options: null };
        this.conditions = [];
        this.columns = [];
        this.sortsChanged = new EventEmitter();
        this.newCondition = {
            sortField: '',
            sortType: SortType.Asc,
        };
        this.currentCondition = null;
        this.localeService = this.injector.get(LocaleService);
        this.sortTypes = [
            { label: this.localeService.getValue('sortEditor.asc'), value: SortType.Asc },
            { label: this.localeService.getValue('sortEditor.desc'), value: SortType.Desc }
        ];
    }
    /**
     * @return {?}
     */
    SortEditorComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () { };
    /**
     * @param {?} $event
     * @return {?}
     */
    SortEditorComponent.prototype.selected = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        this.currentCondition = $event;
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    SortEditorComponent.prototype.isSelected = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        if (this.currentCondition) {
            return this.currentCondition.index === $event;
        }
        return false;
    };
    /**
     * @param {?} index
     * @return {?}
     */
    SortEditorComponent.prototype.insertCondition = /**
     * @param {?} index
     * @return {?}
     */
    function (index) {
        /** @type {?} */
        var _newCondition = Object.assign({}, this.newCondition);
        if (index === 0) {
            this.conditions = tslib_1.__spread([_newCondition], this.conditions);
        }
        else {
            /** @type {?} */
            var _data = cloneDeep(this.conditions);
            _data.splice(index, 0, _newCondition);
            this.conditions = tslib_1.__spread(_data);
        }
        this.changeConditionList('insert');
    };
    /**
     * @param {?} index
     * @return {?}
     */
    SortEditorComponent.prototype.removeCondition = /**
     * @param {?} index
     * @return {?}
     */
    function (index) {
        this.conditions.splice(index, 1);
        // this.conditions = [...this.conditions];
        this.changeConditionList('remove');
        if (this.currentCondition) {
            if (index === this.currentCondition.index) {
                this.currentCondition = null;
            }
        }
    };
    /**
     * @return {?}
     */
    SortEditorComponent.prototype.onAdd = /**
     * @return {?}
     */
    function () {
        this.conditions = tslib_1.__spread(this.conditions, [Object.assign({}, this.newCondition)]);
        this.changeConditionList('add');
    };
    /**
     * @return {?}
     */
    SortEditorComponent.prototype.onClear = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.messagerService.question('确认要清空当前所有排序字段吗？', (/**
         * @return {?}
         */
        function () {
            _this.conditions = [];
            _this.changeConditionList('clear');
        }));
    };
    /**
     * @return {?}
     */
    SortEditorComponent.prototype.onMoveTop = /**
     * @return {?}
     */
    function () {
        if (this.currentCondition) {
            this.conditions.unshift(this.currentCondition.condition);
            this.conditions.splice(this.currentCondition.index + 1, 1);
            this.currentCondition.index = 0;
            this.changeConditionList('moveTop');
        }
    };
    /**
     * @return {?}
     */
    SortEditorComponent.prototype.onMovePrev = /**
     * @return {?}
     */
    function () {
        var _a;
        if (this.currentCondition) {
            /** @type {?} */
            var index = this.currentCondition.index;
            /** @type {?} */
            var tempArr = this.conditions.splice(index, 1);
            (_a = this.conditions).splice.apply(_a, tslib_1.__spread([index - 1, 0], tempArr));
            this.currentCondition.index = index - 1;
            this.changeConditionList('movePrev');
        }
    };
    /**
     * @return {?}
     */
    SortEditorComponent.prototype.onMoveNext = /**
     * @return {?}
     */
    function () {
        var _a;
        if (this.currentCondition) {
            /** @type {?} */
            var index = this.currentCondition.index;
            /** @type {?} */
            var tempArr = this.conditions.splice(index, 1);
            (_a = this.conditions).splice.apply(_a, tslib_1.__spread([index + 1, 0], tempArr));
            this.currentCondition.index = index + 1;
            this.changeConditionList('moveNext');
        }
    };
    /**
     * @return {?}
     */
    SortEditorComponent.prototype.onMoveBottom = /**
     * @return {?}
     */
    function () {
        if (this.currentCondition) {
            this.conditions.push(this.currentCondition.condition);
            this.conditions.splice(this.currentCondition.index, 1);
            this.currentCondition.index = this.conditions.length - 1;
            this.changeConditionList('moveBottom');
        }
    };
    /**
     * @return {?}
     */
    SortEditorComponent.prototype.canUse = /**
     * @return {?}
     */
    function () {
        if (this.currentCondition) {
            return this.conditions.length > 1;
        }
        return false;
    };
    /**
     * @return {?}
     */
    SortEditorComponent.prototype.canMoveUp = /**
     * @return {?}
     */
    function () {
        if (this.canUse()) {
            return this.currentCondition.index > 0;
        }
        return false;
    };
    /**
     * @return {?}
     */
    SortEditorComponent.prototype.canMoveDown = /**
     * @return {?}
     */
    function () {
        if (this.canUse()) {
            return this.currentCondition.index < this.conditions.length - 1;
        }
        return false;
    };
    /**
     * @private
     * @param {?} action
     * @return {?}
     */
    SortEditorComponent.prototype.changeConditionList = /**
     * @private
     * @param {?} action
     * @return {?}
     */
    function (action) {
        this.sortsChanged.emit({ action: action, data: this.conditions });
    };
    SortEditorComponent.decorators = [
        { type: Component, args: [{
                    selector: 'sort-editor',
                    template: "<div class=\"table-header \" style=\"max-height: 35px;\">\r\n    <table class=\"table table-bordered sort-col-header\" style=\"margin-bottom: 0\">\r\n        <colgroup>\r\n            <col *ngFor=\"let s of columnSizeData\" [width]=\" s + 'px'\">\r\n        </colgroup>\r\n        <thead>\r\n            <tr>\r\n                <th></th>\r\n                <th>&nbsp;<b>{{ 'sortEditor.field'| locale }}</b></th>\r\n                <th>&nbsp;<b>{{ 'sortEditor.order'| locale }}</b></th>\r\n            </tr>\r\n        </thead>\r\n    </table>\r\n</div>\r\n<div class=\"table-body flex-fill\" style=\"overflow: hidden\" #tablebodybox>\r\n    <perfect-scrollbar [config]=\"{}\" style=\"height: 100%\">\r\n        <table class=\"table table-bordered\" style=\"margin: 0;\">\r\n            <colgroup>\r\n                <col *ngFor=\"let s of columnSizeData\" [width]=\" s + 'px'\">\r\n            </colgroup>\r\n            <tbody>\r\n                <tr *ngFor=\"let condition of conditions; let index=index;\" (click)=\"selected({'index':index, 'condition': condition})\" [class.selected]=\"isSelected(index)\" >\r\n                    <td style=\"padding-left: 0; padding-right: 0; text-align: center\">\r\n                        <button type=\"button\" (click)=\"insertCondition(index)\" class=\"k-button k-button-icon k-flat\"><span class=\"k-icon k-i-plus\"></span></button>\r\n                        <button type=\"button\" (click)=\"removeCondition(index)\" class=\"k-button k-button-icon k-flat\"><span class=\"k-icon k-i-minus\"></span></button>\r\n                    </td>\r\n                    <td>\r\n                        <select *ngIf=\"fieldEditor.type === 'select'\" class=\"form-control filter-select\" [(ngModel)]=\"condition.sortField\" name=\"sortField\">\r\n                            <option *ngFor=\"let col of columns\" [value]=\"col.value\">{{ col.label }}</option>\r\n                        </select>\r\n\r\n                        <farris-combo-lookup *ngIf=\"fieldEditor.type === 'combo-tree'\" name=\"sortField\"\r\n                            [idField]=\"fieldEditor?.options?.idField ||'value'\"\r\n                            [textField]=\"fieldEditor?.options?.textField ||'label'\"\r\n                            [displayType]=\"'LOOKUPTREELIST'\" [useValue]=\"true\"\r\n                            [useTreeView]=\"true\"\r\n                            [columns]=\"fieldEditor?.options?.columns || []\"\r\n                            [data]=\"columns\"\r\n                            [(ngModel)]=\"condition.sortField\"\r\n                            [remoteSearch]=\"false\"\r\n                            [autoWidth]=\"fieldEditor?.options?.autoWidth\"\r\n                            [panelWidth]=\"fieldEditor?.options?.panelWidth || 200\"\r\n                        >\r\n                        </farris-combo-lookup>\r\n\r\n                    </td>\r\n                    <td>\r\n                        <select class=\"form-control filter-select\" [(ngModel)]=\"condition.sortType\" name=\"sortType\">\r\n                            <option *ngFor=\"let item of sortTypes\" [value]=\"item.value\">{{ item.label }}</option>\r\n                        </select>\r\n                    </td>\r\n                </tr>\r\n            </tbody>\r\n        </table>\r\n    </perfect-scrollbar>\r\n</div>\r\n<div class=\"footer-container\" style=\"max-height: 32px;flex-shrink: 0; \">\r\n    <button type=\"button\" (click)=\"onAdd()\"\r\n        class=\"k-button k-button-icontext k-flat \"><span class=\"f-icon f-icon-add\"></span> {{ 'sortEditor.add'| locale }}</button>\r\n    <button type=\"button\" (click)=\"onClear()\" [disabled]=\"!conditions.length\"\r\n        class=\"k-button k-button-icontext k-flat \"><span class=\"f-icon f-icon-close\"></span> {{ 'sortEditor.clear'| locale }}</button>\r\n    <button type=\"button\" [disabled]=\"!canMoveUp()\" (click)=\"onMoveTop()\"\r\n        class=\"k-button k-button-icontext k-flat \"><span class=\"f-icon f-icon-arrow-end-up\"></span> {{ 'sortEditor.moveTop'| locale }}</button>\r\n    <button type=\"button\" [disabled]=\"!canMoveUp()\" (click)=\"onMovePrev()\"\r\n        class=\"k-button k-button-icontext k-flat \"><span class=\"f-icon f-icon-arrow-60-up\"></span> {{ 'sortEditor.moveUp'| locale }}</button>\r\n    <button type=\"button\" [disabled]=\"!canMoveDown()\" (click)=\"onMoveNext()\"\r\n        class=\"k-button k-button-icontext k-flat \"><span class=\"f-icon f-icon-arrow-60-down\"></span> {{ 'sortEditor.moveDown'| locale }}</button>\r\n    <button type=\"button\" [disabled]=\"!canMoveDown()\" (click)=\"onMoveBottom()\"\r\n        class=\"k-button k-button-icontext k-flat\"><span class=\"f-icon f-icon-arrow-end-down\"></span> {{ 'sortEditor.moveBottom'| locale }}</button>\r\n</div>",
                    styles: ["\n        .sort-col-header thead th { padding: 0; line-height: 35px;}\n        .filter-select { width:100%; padding-left: 0; padding-right: 0; }\n        .selected { background: #c2e4ff; }\n        "]
                }] }
    ];
    /** @nocollapse */
    SortEditorComponent.ctorParameters = function () { return [
        { type: MessagerService },
        { type: DomSanitizer },
        { type: Injector }
    ]; };
    SortEditorComponent.propDecorators = {
        cls: [{ type: HostBinding, args: ['class',] }],
        fieldEditor: [{ type: Input }],
        conditions: [{ type: Input }],
        columns: [{ type: Input }],
        height: [{ type: Input }],
        sortsChanged: [{ type: Output }]
    };
    return SortEditorComponent;
}());
export { SortEditorComponent };
if (false) {
    /** @type {?} */
    SortEditorComponent.prototype.sortTypes;
    /** @type {?} */
    SortEditorComponent.prototype.columnSizeData;
    /** @type {?} */
    SortEditorComponent.prototype.cls;
    /** @type {?} */
    SortEditorComponent.prototype.fieldEditor;
    /** @type {?} */
    SortEditorComponent.prototype.conditions;
    /** @type {?} */
    SortEditorComponent.prototype.columns;
    /** @type {?} */
    SortEditorComponent.prototype.height;
    /** @type {?} */
    SortEditorComponent.prototype.sortsChanged;
    /**
     * @type {?}
     * @private
     */
    SortEditorComponent.prototype.newCondition;
    /** @type {?} */
    SortEditorComponent.prototype.currentCondition;
    /** @type {?} */
    SortEditorComponent.prototype.localeService;
    /**
     * @type {?}
     * @private
     */
    SortEditorComponent.prototype.messagerService;
    /**
     * @type {?}
     * @private
     */
    SortEditorComponent.prototype.sanitizer;
    /**
     * @type {?}
     * @private
     */
    SortEditorComponent.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic29ydC1lZGl0b3IuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1zb3J0LWVkaXRvci8iLCJzb3VyY2VzIjpbImxpYi9zb3J0LWVkaXRvci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLFdBQVcsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBRSxRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDdEcsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3RELE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFDdEMsT0FBTyxFQUFpQixTQUFTLEVBQUUsUUFBUSxFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFDN0UsT0FBTyxFQUFhLFlBQVksRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ3BFLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUVsRDtJQWtDSSw2QkFBb0IsZUFBZ0MsRUFBVSxTQUF1QixFQUFVLFFBQWtCO1FBQTdGLG9CQUFlLEdBQWYsZUFBZSxDQUFpQjtRQUFVLGNBQVMsR0FBVCxTQUFTLENBQWM7UUFBVSxhQUFRLEdBQVIsUUFBUSxDQUFVO1FBcEJqSCxjQUFTLEdBQUcsU0FBUyxDQUFDO1FBRXRCLG1CQUFjLEdBQUcsQ0FBQyxFQUFFLEVBQUUsR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBRVQsUUFBRyxHQUFHLHdEQUF3RCxDQUFDO1FBRTVFLGdCQUFXLEdBQUcsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUMsQ0FBQztRQUMvQyxlQUFVLEdBQW9CLEVBQUUsQ0FBQztRQUNqQyxZQUFPLEdBQXFDLEVBQUUsQ0FBQztRQUc5QyxpQkFBWSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFFcEMsaUJBQVksR0FBRztZQUNuQixTQUFTLEVB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QUFPLEtBQUssQ0FBQztJQUNqQixDQUFDOzs7Ozs7SUFFTyxpREFBbUI7Ozs7O0lBQTNCLFVBQTRCLE1BQWtGO1FBQzFHLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLEVBQUUsTUFBTSxRQUFBLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxVQUFVLEVBQUMsQ0FBQyxDQUFDO0lBQzdELENBQUM7O2dCQTdKSixTQUFTLFNBQUM7b0JBQ1AsUUFBUSxFQUFFLGFBQWE7b0JBQ3ZCLDJzSkFBeUM7NkJBRXJDLHdNQUlDO2lCQUVSOzs7O2dCQWhCUSxlQUFlO2dCQUdKLFlBQVk7Z0JBSnNDLFFBQVE7OztzQkF5QnpFLFdBQVcsU0FBQyxPQUFPOzhCQUVuQixLQUFLOzZCQUNMLEtBQUs7MEJBQ0wsS0FBSzt5QkFDTCxLQUFLOytCQUVMLE1BQU07O0lBcUlYLDBCQUFDO0NBQUEsQUE5SkQsSUE4SkM7U0FsSlksbUJBQW1COzs7SUFFNUIsd0NBQXNCOztJQUV0Qiw2Q0FBK0I7O0lBRS9CLGtDQUFxRjs7SUFFckYsMENBQXdEOztJQUN4RCx5Q0FBMEM7O0lBQzFDLHNDQUF3RDs7SUFDeEQscUNBQXdCOztJQUV4QiwyQ0FBNEM7Ozs7O0lBRTVDLDJDQUdFOztJQUVGLCtDQUFxRTs7SUFDckUsNENBQTZCOzs7OztJQUNqQiw4Q0FBd0M7Ozs7O0lBQUUsd0NBQStCOzs7OztJQUFFLHVDQUEwQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBIb3N0QmluZGluZywgSW5wdXQsIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBJbmplY3RvciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBNZXNzYWdlclNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW1lc3NhZ2VyJztcclxuaW1wb3J0IHsgY2xvbmVEZWVwIH0gZnJvbSAnbG9kYXNoLWVzJztcclxuaW1wb3J0IHsgU29ydENvbmRpdGlvbiwgU29ydFR5cGVzLCBTb3J0VHlwZSB9IGZyb20gJ0BmYXJyaXMvdWktY29tbW9uL3R5cGVzJztcclxuaW1wb3J0IHsgU2FmZVN0eWxlLCBEb21TYW5pdGl6ZXIgfSBmcm9tICdAYW5ndWxhci9wbGF0Zm9ybS1icm93c2VyJztcclxuaW1wb3J0IHsgTG9jYWxlU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbG9jYWxlJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdzb3J0LWVkaXRvcicsXHJcbiAgICB0ZW1wbGF0ZVVybDogJ3NvcnQtZWRpdG9yLmNvbXBvbmVudC5odG1sJyxcclxuICAgIHN0eWxlczogW1xyXG4gICAgICAgIGBcclxuICAgICAgICAuc29ydC1jb2wtaGVhZGVyIHRoZWFkIHRoIHsgcGFkZGluZzogMDsgbGluZS1oZWlnaHQ6IDM1cHg7fVxyXG4gICAgICAgIC5maWx0ZXItc2VsZWN0IHsgd2lkdGg6MTAwJTsgcGFkZGluZy1sZWZ0OiAwOyBwYWRkaW5nLXJpZ2h0OiAwOyB9XHJcbiAgICAgICAgLnNlbGVjdGVkIHsgYmFja2dyb3VuZDogI2MyZTRmZjsgfVxyXG4gICAgICAgIGBcclxuICAgIF1cclxufSlcclxuXHJcbmV4cG9ydCBjbGFzcyBTb3J0RWRpdG9yQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuXHJcbiAgICBzb3J0VHlwZXMgPSBTb3J0VHlwZXM7XHJcblxyXG4gICAgY29sdW1uU2l6ZURhdGEgPSBbMzAsIDEyMCwgNjBdO1xyXG5cclxuICAgIEBIb3N0QmluZGluZygnY2xhc3MnKSBjbHMgPSAnZi1zb3J0LWVkaXRvciBmLXV0aWxzLWZsZXgtY29sdW1uIGYtdXRpbHMtYWJzb2x1dGUtYWxsJztcclxuXHJcbiAgICBASW5wdXQoKSBmaWVsZEVkaXRvciA9IHsgdHlwZTogJ3NlbGVjdCcsIG9wdGlvbnM6IG51bGx9O1xyXG4gICAgQElucHV0KCkgY29uZGl0aW9uczogU29ydENvbmRpdGlvbltdID0gW107XHJcbiAgICBASW5wdXQoKSBjb2x1bW5zOiB7bGFiZWw6IHN0cmluZywgdmFsdWU6IHN0cmluZ31bXSA9IFtdO1xyXG4gICAgQElucHV0KCkgaGVpZ2h0OiBudW1iZXI7XHJcblxyXG4gICAgQE91dHB1dCgpIHNvcnRzQ2hhbmdlZCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuXHJcbiAgICBwcml2YXRlIG5ld0NvbmRpdGlvbiA9IHtcclxuICAgICAgICBzb3J0RmllbGQ6ICcnLFxyXG4gICAgICAgIHNvcnRUeXBlOiBTb3J0VHlwZS5Bc2MsXHJcbiAgICB9O1xyXG5cclxuICAgIGN1cnJlbnRDb25kaXRpb246IHsgaW5kZXg6IG51bWJlciwgY29uZGl0aW9uOiBTb3J0Q29uZGl0aW9uIH0gPSBudWxsO1xyXG4gICAgbG9jYWxlU2VydmljZTogTG9jYWxlU2VydmljZTtcclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgbWVzc2FnZXJTZXJ2aWNlOiBNZXNzYWdlclNlcnZpY2UsIHByaXZhdGUgc2FuaXRpemVyOiBEb21TYW5pdGl6ZXIsIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yKSB7XHJcbiAgICAgICAgdGhpcy5sb2NhbGVTZXJ2aWNlID0gdGhpcy5pbmplY3Rvci5nZXQoTG9jYWxlU2VydmljZSk7XHJcblxyXG4gICAgICAgIHRoaXMuc29ydFR5cGVzID0gW1xyXG4gICAgICAgICAgICB7IGxhYmVsOiB0aGlzLmxvY2FsZVNlcnZpY2UuZ2V0VmFsdWUoJ3NvcnRFZGl0b3IuYXNjJyksIHZhbHVlOiBTb3J0VHlwZS5Bc2MgfSxcclxuICAgICAgICAgICAgeyBsYWJlbDogdGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKCdzb3J0RWRpdG9yLmRlc2MnKSwgdmFsdWU6IFNvcnRUeXBlLkRlc2MgfVxyXG4gICAgICAgIF07XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKSB7IH1cclxuXHJcbiAgICBzZWxlY3RlZCgkZXZlbnQpIHtcclxuICAgICAgICB0aGlzLmN1cnJlbnRDb25kaXRpb24gPSAkZXZlbnQ7XHJcbiAgICB9XHJcblxyXG4gICAgaXNTZWxlY3RlZCgkZXZlbnQ6IG51bWJlcikge1xyXG4gICAgICAgIGlmICh0aGlzLmN1cnJlbnRDb25kaXRpb24pIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudENvbmRpdGlvbi5pbmRleCA9PT0gJGV2ZW50O1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgaW5zZXJ0Q29uZGl0aW9uKGluZGV4OiBudW1iZXIpIHtcclxuICAgICAgICBjb25zdCBfbmV3Q29uZGl0aW9uID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5uZXdDb25kaXRpb24pO1xyXG4gICAgICAgIGlmIChpbmRleCAgPT09IDApIHtcclxuICAgICAgICAgICAgdGhpcy5jb25kaXRpb25zID0gW19uZXdDb25kaXRpb24sIC4uLnRoaXMuY29uZGl0aW9uc107XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY29uc3QgX2RhdGEgPSBjbG9uZURlZXAodGhpcy5jb25kaXRpb25zKTtcclxuICAgICAgICAgICAgX2RhdGEuc3BsaWNlKGluZGV4LCAwLCBfbmV3Q29uZGl0aW9uKTtcclxuICAgICAgICAgICAgdGhpcy5jb25kaXRpb25zID0gWy4uLl9kYXRhXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jaGFuZ2VDb25kaXRpb25MaXN0KCdpbnNlcnQnKTtcclxuICAgIH1cclxuXHJcbiAgICByZW1vdmVDb25kaXRpb24oaW5kZXg6IG51bWJlcikge1xyXG4gICAgICAgIHRoaXMuY29uZGl0aW9ucy5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgICAgIC8vIHRoaXMuY29uZGl0aW9ucyA9IFsuLi50aGlzLmNvbmRpdGlvbnNdO1xyXG4gICAgICAgIHRoaXMuY2hhbmdlQ29uZGl0aW9uTGlzdCgncmVtb3ZlJyk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmN1cnJlbnRDb25kaXRpb24pIHtcclxuICAgICAgICAgICAgaWYgKGluZGV4ID09PSB0aGlzLmN1cnJlbnRDb25kaXRpb24uaW5kZXgpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudENvbmRpdGlvbiA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgb25BZGQoKSB7XHJcbiAgICAgICAgdGhpcy5jb25kaXRpb25zID0gWy4uLnRoaXMuY29uZGl0aW9ucywgT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5uZXdDb25kaXRpb24pXTtcclxuICAgICAgICB0aGlzLmNoYW5nZUNvbmRpdGlvbkxpc3QoJ2FkZCcpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uQ2xlYXIoKSB7XHJcbiAgICAgICAgdGhpcy5tZXNzYWdlclNlcnZpY2UucXVlc3Rpb24oJ+ehruiupOimgea4heepuuW9k+WJjeaJgOacieaOkuW6j+Wtl+auteWQl++8nycsICgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5jb25kaXRpb25zID0gW107XHJcbiAgICAgICAgICAgIHRoaXMuY2hhbmdlQ29uZGl0aW9uTGlzdCgnY2xlYXInKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBvbk1vdmVUb3AoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuY3VycmVudENvbmRpdGlvbikge1xyXG4gICAgICAgICAgICB0aGlzLmNvbmRpdGlvbnMudW5zaGlmdCh0aGlzLmN1cnJlbnRDb25kaXRpb24uY29uZGl0aW9uKTtcclxuICAgICAgICAgICAgdGhpcy5jb25kaXRpb25zLnNwbGljZSh0aGlzLmN1cnJlbnRDb25kaXRpb24uaW5kZXggKyAxLCAxKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuY3VycmVudENvbmRpdGlvbi5pbmRleCA9IDA7XHJcbiAgICAgICAgICAgIHRoaXMuY2hhbmdlQ29uZGl0aW9uTGlzdCgnbW92ZVRvcCcpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBvbk1vdmVQcmV2KCkge1xyXG4gICAgICAgIGlmICh0aGlzLmN1cnJlbnRDb25kaXRpb24pIHtcclxuICAgICAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLmN1cnJlbnRDb25kaXRpb24uaW5kZXg7XHJcbiAgICAgICAgICAgIGNvbnN0IHRlbXBBcnIgPSB0aGlzLmNvbmRpdGlvbnMuc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgICAgICAgdGhpcy5jb25kaXRpb25zLnNwbGljZShpbmRleCAtIDEsIDAsIC4uLnRlbXBBcnIpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5jdXJyZW50Q29uZGl0aW9uLmluZGV4ID0gaW5kZXggLSAxO1xyXG4gICAgICAgICAgICB0aGlzLmNoYW5nZUNvbmRpdGlvbkxpc3QoJ21vdmVQcmV2Jyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgb25Nb3ZlTmV4dCgpIHtcclxuICAgICAgICBpZiAodGhpcy5jdXJyZW50Q29uZGl0aW9uKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5jdXJyZW50Q29uZGl0aW9uLmluZGV4O1xyXG4gICAgICAgICAgICBjb25zdCB0ZW1wQXJyID0gdGhpcy5jb25kaXRpb25zLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgICAgICAgIHRoaXMuY29uZGl0aW9ucy5zcGxpY2UoaW5kZXggKyAxLCAwLCAuLi50ZW1wQXJyKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuY3VycmVudENvbmRpdGlvbi5pbmRleCA9IGluZGV4ICsgMTtcclxuICAgICAgICAgICAgdGhpcy5jaGFuZ2VDb25kaXRpb25MaXN0KCdtb3ZlTmV4dCcpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIG9uTW92ZUJvdHRvbSgpIHtcclxuICAgICAgICBpZiAodGhpcy5jdXJyZW50Q29uZGl0aW9uKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29uZGl0aW9ucy5wdXNoKHRoaXMuY3VycmVudENvbmRpdGlvbi5jb25kaXRpb24pO1xyXG4gICAgICAgICAgICB0aGlzLmNvbmRpdGlvbnMuc3BsaWNlKHRoaXMuY3VycmVudENvbmRpdGlvbi5pbmRleCwgMSk7XHJcbiAgICAgICAgICAgIHRoaXMuY3VycmVudENvbmRpdGlvbi5pbmRleCA9IHRoaXMuY29uZGl0aW9ucy5sZW5ndGggLSAxO1xyXG4gICAgICAgICAgICB0aGlzLmNoYW5nZUNvbmRpdGlvbkxpc3QoJ21vdmVCb3R0b20nKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY2FuVXNlKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmN1cnJlbnRDb25kaXRpb24pIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29uZGl0aW9ucy5sZW5ndGggPiAxO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIGNhbk1vdmVVcCgpIHtcclxuICAgICAgICBpZiAodGhpcy5jYW5Vc2UoKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50Q29uZGl0aW9uLmluZGV4ID4gMDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBjYW5Nb3ZlRG93bigpIHtcclxuICAgICAgICBpZiAodGhpcy5jYW5Vc2UoKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50Q29uZGl0aW9uLmluZGV4IDwgdGhpcy5jb25kaXRpb25zLmxlbmd0aCAtIDE7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjaGFuZ2VDb25kaXRpb25MaXN0KGFjdGlvbjogJ2FkZCd8J21vdmVUb3AnfCdtb3ZlQm90dG9tJ3wnbW92ZVByZXYnfCdtb3ZlTmV4dCd8J2luc2VydCd8J2NsZWFyJ3xzdHJpbmcpIHtcclxuICAgICAgICB0aGlzLnNvcnRzQ2hhbmdlZC5lbWl0KHsgYWN0aW9uLCBkYXRhOiB0aGlzLmNvbmRpdGlvbnN9KTtcclxuICAgIH1cclxufVxyXG4iXX0=