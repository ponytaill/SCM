/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { debounceTime } from 'rxjs/operators';
import { Injector } from '@angular/core';
/*
 * @Author: 疯狂秀才(Lucas Huang)
 * @Date: 2019-08-14 11:41:00
 * @LastEditors: 疯狂秀才(Lucas Huang)
 * @LastEditTime: 2019-10-14 13:00:48
 * @QQ: 1055818239
 * @Version: v0.0.1
 */
import { Component, Renderer2, ElementRef, ViewChild } from '@angular/core';
import { DatagridBaseEditorDirective } from '../datagrid-base-editor.directive';
import { LookupDefaultOptions } from '../editor-default-options';
import { LookupGridComponent } from '@farris/ui-lookup';
import { RuntimeStateService } from '@farris/ui-common';
// 
var DatagridLookupComponent = /** @class */ (function (_super) {
    tslib_1.__extends(DatagridLookupComponent, _super);
    function DatagridLookupComponent(render, el, rts, injector) {
        var _this = _super.call(this, render, el, injector) || this;
        _this.rts = rts;
        _this.stopPropagation = false;
        _this.extInfoFormatter = (/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            if (_this.options.extInfoFormatter) {
                return _this.options.extInfoFormatter({ bindingData: _this.dr.rowData, instance: e.instance });
            }
            return '';
        });
        return _this;
    }
    Object.defineProperty(DatagridLookupComponent.prototype, "controlId", {
        set: /**
         * @param {?} id
         * @return {?}
         */
        function (id) {
            this.instance.controlId = id;
            if (this.instance.uri) {
                this.instance.controlId += '_' + this.instance.uri;
            }
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    DatagridLookupComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        _super.prototype.ngOnInit.call(this);
        if (!this.options.valueField) {
            this.options.valueField = this.options.idField;
        }
        this.options = Object.assign({}, LookupDefaultOptions, this.options);
    };
    /**
     * @return {?}
     */
    DatagridLookupComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.instance.changeDetector.detectChanges();
        if (this.options.viewType === 'tag') {
            this.inputElement = this.instance.tagbox.nativeElement;
        }
        else {
            this.inputElement = this.instance.inputGroup.textbox.nativeElement;
        }
        _super.prototype.ngAfterViewInit.call(this);
        if (this.options.loader) {
            if (this.instance['http']) {
                /** @type {?} */
                var getDataFn = this.instance['http'];
                this.instance['http'] = tslib_1.__assign({}, getDataFn, { getData: this.options.loader });
            }
            else {
                this.instance['http'] = { getData: this.options.loader };
            }
        }
        this.instance['host'] = this.dg;
        this.rts.state$.pipe(debounceTime(10)).subscribe((/**
         * @param {?} state
         * @return {?}
         */
        function (state) {
            if (state && state.form && state.form.lookup && _this.dg) {
                _this.pending = state.form.lookup.pending;
                _this.dg.pending = _this.pending;
            }
        }));
    };
    /**
     * @return {?}
     */
    DatagridLookupComponent.prototype.onDialogClosed = /**
     * @return {?}
     */
    function () {
        // this.lookup.changeDetector.detectChanges();
    };
    /**
     * @return {?}
     */
    DatagridLookupComponent.prototype.onDialogOpen = /**
     * @return {?}
     */
    function () {
        this.instance.changeDetector.detectChanges();
    };
    /**
     * @return {?}
     */
    DatagridLookupComponent.prototype.onLoadSuccess = /**
     * @return {?}
     */
    function () {
        this.instance.changeDetector.detectChanges();
    };
    /**
     * @param {?} event
     * @return {?}
     */
    DatagridLookupComponent.prototype.onClear = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        // const rowData = this.instance.selectionMgr.getBindingData();
        // this.instance['defaultMapping'].lookupFieldMap(null, this.instance.mapFields, rowData);
        this.instance.changeDetector.detectChanges();
        if (this.options.clear) {
            this.options.clear();
        }
    };
    /**
     * @param {?} $evnet
     * @return {?}
     */
    DatagridLookupComponent.prototype.onTagRemoved = /**
     * @param {?} $evnet
     * @return {?}
     */
    function ($evnet) {
        if (this.options.tagRemoved) {
            this.options.tagRemoved($evnet);
        }
    };
    DatagridLookupComponent.decorators = [
        { type: Component, args: [{
                    selector: 'grid-editor-lookup',
                    template: "\n    <div [formGroup]=\"group\" class=\"f-datagrid-cell-formgroup farris-group-auto\">\n        <datagrid-tooltip [control]=\"formControl\" [tooltipPosition]=\"'top-left'\" [message]=\"errorMessage\">\n            <farris-lookup-grid #lookup style=\"width: 100%\"\n                id=\"{{ controlId }}\"\n                [formControlName]=\"column.field\"\n                [uri]=\"options.uri\"\n                [helpId]=\"options.helpId\"\n                [displayType]=\"options.displayType\"\n                [singleSelect]=\"options.singleSelect\"\n                [idField]=\"options.idField\"\n                [pageSize]=\"options.pageSize || 20\"\n                [pageIndex]=\"options.pageSize || 1\"\n                [pagination]=\"options.pageination\"\n                [textField]=\"options.textField\"\n                [valueField]=\"options.valueField\"\n                [title]=\"options.title\"\n                [useFavorite]=\"options.useFavorite\"\n                [isRecordSize]=\"options.isRecordSize\"\n                [useTip]=\"options.useTip\"\n                [editable]=\"options.editable\"\n                [readonly]=\"options.readonly\"\n                [dialogWidth]=\"options.dialogWidth\"\n                [dialogHeight]=\"options.dialogHeight\"\n                [showMaxButton]=\"options.showMaxButton\"\n                [showCloseButton]=\"options.showCloseButton\"\n                [resizable]=\"options.resizable\"\n                [buttonAlign]=\"options.buttonAlign\"\n                [enableClear]=\"options.enableClear\"\n                [searchOnServer]=\"options.searchOnServer\"\n                [nosearch]=\"options.nosearch\"\n                [maxLength]=\"options.maxLength\"\n                [mappingFn]=\"options.mappingFn\"\n                [mapFields]=\"options.mapFields\"\n                [context]=\"options.context\"\n                [expandLevel]=\"options.expandLevel\"\n                [dictPicking]=\"options.dictPicking\"\n                [dictPicked]=\"options.dictPicked\"\n                [enableFullTree]=\"options.enableFullTree\"\n                [loadTreeDataType]=\"options.loadTreeDataType\"\n                [enableCascade]=\"options.enableCascade\"\n                [cascadeStatus]=\"options.cascadeStatus\"\n                [useExtendInfo]=\"options.useExtendInfo\"\n                [extInfoFields]=\"options.extInfoFields\"\n                [extInfoFormatter]=\"options.extInfoFormatter\"\n                [textAlign]=\"options.textAlign\"\n                [loadDataWhenOpen]=\"options.loadDataWhenOpen\"\n                [selectFirstInNav]=\"options.selectFirstInNav\"\n                [customNavFormatter]=\"options.customNavFormatter\"\n                [customFormatter]=\"options.customFormatter\"\n                [treeInfo]=\"options?.treeInfo\"\n                (dialogClosed)=\"onDialogClosed()\"\n                (dialogOpened)=\"onDialogOpen()\"\n                (clear)=\"onClear($event)\"\n                (loadSuccess)=\"onLoadSuccess()\"\n                [treeTableOptions]=\"options?.treeTableOptions\"\n                [showCheckAll]=\"options?.showCheckAll\"\n                [viewType]=\"options?.viewType\"\n                (tagRemoved)=\"onTagRemoved($event)\"\n                [quickSelect]=\"options?.quickSelect\"\n                [treeToList]=\"options?.treeToList\"\n                [navTreeToList]=\"options?.navTreeToList\"\n                [showCascadeControl]=\"options.showCascadeControl\"\n                [showNavigation]=\"options.showNavigation\"\n            ></farris-lookup-grid>\n        </datagrid-tooltip>\n    </div>\n    "
                }] }
    ];
    /** @nocollapse */
    DatagridLookupComponent.ctorParameters = function () { return [
        { type: Renderer2 },
        { type: ElementRef },
        { type: RuntimeStateService },
        { type: Injector }
    ]; };
    DatagridLookupComponent.propDecorators = {
        instance: [{ type: ViewChild, args: ['lookup',] }]
    };
    return DatagridLookupComponent;
}(DatagridBaseEditorDirective));
export { DatagridLookupComponent };
if (false) {
    /** @type {?} */
    DatagridLookupComponent.prototype.instance;
    /** @type {?} */
    DatagridLookupComponent.prototype.stopPropagation;
    /** @type {?} */
    DatagridLookupComponent.prototype.extInfoFormatter;
    /**
     * @type {?}
     * @private
     */
    DatagridLookupComponent.prototype.rts;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YWdyaWQtbG9va3VwLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktZGF0YWdyaWQtZWRpdG9ycy8iLCJzb3VyY2VzIjpbImxpYi9lZGl0b3JzL2RhdGFncmlkLWxvb2t1cC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDOUMsT0FBTyxFQUFxRCxRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7Ozs7Ozs7OztBQVM1RixPQUFPLEVBQUUsU0FBUyxFQUFVLFNBQVMsRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3BGLE9BQU8sRUFBRSwyQkFBMkIsRUFBRSxNQUFNLG1DQUFtQyxDQUFDO0FBQ2hGLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ2pFLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ3hELE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLG1CQUFtQixDQUFDOztBQUl4RDtJQXVFNkMsbURBQTJCO0lBWXBFLGlDQUFZLE1BQWlCLEVBQUUsRUFBYyxFQUFVLEdBQXdCLEVBQ25FLFFBQWtCO1FBRDlCLFlBRUksa0JBQU0sTUFBTSxFQUFFLEVBQUUsRUFBRSxRQUFRLENBQUMsU0FDOUI7UUFIc0QsU0FBRyxHQUFILEdBQUcsQ0FBcUI7UUFEL0UscUJBQWUsR0FBRyxLQUFLLENBQUM7UUF5RXhCLHNCQUFnQjs7OztRQUFHLFVBQUMsQ0FBQztZQUNqQixJQUFJLEtBQUksQ0FBQyxPQUFPLENBQUMsZ0JBQWdCLEVBQUU7Z0JBQy9CLE9BQU8sS0FBSSxDQUFDLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxFQUFFLFdBQVcsRUFBRSxLQUFJLENBQUMsRUFBRSxDQUFDLE9BQU8sRUFBRSxRQUFRLEVBQUUsQ0FBQyxDQUFDLFFBQVEsRUFBRSxD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LGNBQWMsQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUNqRCxDQUFDOzs7OztJQUVELHlDQUFPOzs7O0lBQVAsVUFBUSxLQUFpQjtRQUNyQiwrREFBK0Q7UUFDL0QsMEZBQTBGO1FBRTFGLElBQUksQ0FBQyxRQUFRLENBQUMsY0FBYyxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQzdDLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUU7WUFDcEIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsQ0FBQztTQUN4QjtJQUNMLENBQUM7Ozs7O0lBRUQsOENBQVk7Ozs7SUFBWixVQUFhLE1BQU07UUFDZixJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsVUFBVSxFQUFFO1lBQ3pCLElBQUksQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1NBQ25DO0lBQ0wsQ0FBQzs7Z0JBekpKLFNBQVMsU0FBQztvQkFDUCxRQUFRLEVBQUUsb0JBQW9CO29CQUM5QixRQUFRLEVBQUUscWpIQW1FVDtpQkFDSjs7OztnQkE5RTJCLFNBQVM7Z0JBQUUsVUFBVTtnQkFJeEMsbUJBQW1CO2dCQWJnQyxRQUFROzs7MkJBeUYvRCxTQUFTLFNBQUMsUUFBUTs7SUEwRnZCLDhCQUFDO0NBQUEsQUFsS0QsQ0F1RTZDLDJCQUEyQixHQTJGdkU7U0EzRlksdUJBQXVCOzs7SUFDaEMsMkNBQW1EOztJQVVuRCxrREFBd0I7O0lBeUV4QixtREFNQzs7Ozs7SUE5RThDLHNDQUFnQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGRlYm91bmNlVGltZSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgQWZ0ZXJWaWV3SW5pdCwgQXBwbGljYXRpb25SZWYsIEluamVjdCwgZm9yd2FyZFJlZiwgSW5qZWN0b3IgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuLypcclxuICogQEF1dGhvcjog55av54uC56eA5omNKEx1Y2FzIEh1YW5nKVxyXG4gKiBARGF0ZTogMjAxOS0wOC0xNCAxMTo0MTowMFxyXG4gKiBATGFzdEVkaXRvcnM6IOeWr+eLguengOaJjShMdWNhcyBIdWFuZylcclxuICogQExhc3RFZGl0VGltZTogMjAxOS0xMC0xNCAxMzowMDo0OFxyXG4gKiBAUVE6IDEwNTU4MTgyMzlcclxuICogQFZlcnNpb246IHYwLjAuMVxyXG4gKi9cclxuaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIFJlbmRlcmVyMiwgRWxlbWVudFJlZiwgVmlld0NoaWxkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IERhdGFncmlkQmFzZUVkaXRvckRpcmVjdGl2ZSB9IGZyb20gJy4uL2RhdGFncmlkLWJhc2UtZWRpdG9yLmRpcmVjdGl2ZSc7XHJcbmltcG9ydCB7IExvb2t1cERlZmF1bHRPcHRpb25zIH0gZnJvbSAnLi4vZWRpdG9yLWRlZmF1bHQtb3B0aW9ucyc7XHJcbmltcG9ydCB7IExvb2t1cEdyaWRDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLWxvb2t1cCc7XHJcbmltcG9ydCB7IFJ1bnRpbWVTdGF0ZVNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWNvbW1vbic7XHJcblxyXG5cclxuLy8gXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdncmlkLWVkaXRvci1sb29rdXAnLFxyXG4gICAgdGVtcGxhdGU6IGBcclxuICAgIDxkaXYgW2Zvcm1Hcm91cF09XCJncm91cFwiIGNsYXNzPVwiZi1kYXRhZ3JpZC1jZWxsLWZvcm1ncm91cCBmYXJyaXMtZ3JvdXAtYXV0b1wiPlxyXG4gICAgICAgIDxkYXRhZ3JpZC10b29sdGlwIFtjb250cm9sXT1cImZvcm1Db250cm9sXCIgW3Rvb2x0aXBQb3NpdGlvbl09XCIndG9wLWxlZnQnXCIgW21lc3NhZ2VdPVwiZXJyb3JNZXNzYWdlXCI+XHJcbiAgICAgICAgICAgIDxmYXJyaXMtbG9va3VwLWdyaWQgI2xvb2t1cCBzdHlsZT1cIndpZHRoOiAxMDAlXCJcclxuICAgICAgICAgICAgICAgIGlkPVwie3sgY29udHJvbElkIH19XCJcclxuICAgICAgICAgICAgICAgIFtmb3JtQ29udHJvbE5hbWVdPVwiY29sdW1uLmZpZWxkXCJcclxuICAgICAgICAgICAgICAgIFt1cmldPVwib3B0aW9ucy51cmlcIlxyXG4gICAgICAgICAgICAgICAgW2hlbHBJZF09XCJvcHRpb25zLmhlbHBJZFwiXHJcbiAgICAgICAgICAgICAgICBbZGlzcGxheVR5cGVdPVwib3B0aW9ucy5kaXNwbGF5VHlwZVwiXHJcbiAgICAgICAgICAgICAgICBbc2luZ2xlU2VsZWN0XT1cIm9wdGlvbnMuc2luZ2xlU2VsZWN0XCJcclxuICAgICAgICAgICAgICAgIFtpZEZpZWxkXT1cIm9wdGlvbnMuaWRGaWVsZFwiXHJcbiAgICAgICAgICAgICAgICBbcGFnZVNpemVdPVwib3B0aW9ucy5wYWdlU2l6ZSB8fCAyMFwiXHJcbiAgICAgICAgICAgICAgICBbcGFnZUluZGV4XT1cIm9wdGlvbnMucGFnZVNpemUgfHwgMVwiXHJcbiAgICAgICAgICAgICAgICBbcGFnaW5hdGlvbl09XCJvcHRpb25zLnBhZ2VpbmF0aW9uXCJcclxuICAgICAgICAgICAgICAgIFt0ZXh0RmllbGRdPVwib3B0aW9ucy50ZXh0RmllbGRcIlxyXG4gICAgICAgICAgICAgICAgW3ZhbHVlRmllbGRdPVwib3B0aW9ucy52YWx1ZUZpZWxkXCJcclxuICAgICAgICAgICAgICAgIFt0aXRsZV09XCJvcHRpb25zLnRpdGxlXCJcclxuICAgICAgICAgICAgICAgIFt1c2VGYXZvcml0ZV09XCJvcHRpb25zLnVzZUZhdm9yaXRlXCJcclxuICAgICAgICAgICAgICAgIFtpc1JlY29yZFNpemVdPVwib3B0aW9ucy5pc1JlY29yZFNpemVcIlxyXG4gICAgICAgICAgICAgICAgW3VzZVRpcF09XCJvcHRpb25zLnVzZVRpcFwiXHJcbiAgICAgICAgICAgICAgICBbZWRpdGFibGVdPVwib3B0aW9ucy5lZGl0YWJsZVwiXHJcbiAgICAgICAgICAgICAgICBbcmVhZG9ubHldPVwib3B0aW9ucy5yZWFkb25seVwiXHJcbiAgICAgICAgICAgICAgICBbZGlhbG9nV2lkdGhdPVwib3B0aW9ucy5kaWFsb2dXaWR0aFwiXHJcbiAgICAgICAgICAgICAgICBbZGlhbG9nSGVpZ2h0XT1cIm9wdGlvbnMuZGlhbG9nSGVpZ2h0XCJcclxuICAgICAgICAgICAgICAgIFtzaG93TWF4QnV0dG9uXT1cIm9wdGlvbnMuc2hvd01heEJ1dHRvblwiXHJcbiAgICAgICAgICAgICAgICBbc2hvd0Nsb3NlQnV0dG9uXT1cIm9wdGlvbnMuc2hvd0Nsb3NlQnV0dG9uXCJcclxuICAgICAgICAgICAgICAgIFtyZXNpemFibGVdPVwib3B0aW9ucy5yZXNpemFibGVcIlxyXG4gICAgICAgICAgICAgICAgW2J1dHRvbkFsaWduXT1cIm9wdGlvbnMuYnV0dG9uQWxpZ25cIlxyXG4gICAgICAgICAgICAgICAgW2VuYWJsZUNsZWFyXT1cIm9wdGlvbnMuZW5hYmxlQ2xlYXJcIlxyXG4gICAgICAgICAgICAgICAgW3NlYXJjaE9uU2VydmVyXT1cIm9wdGlvbnMuc2VhcmNoT25TZXJ2ZXJcIlxyXG4gICAgICAgICAgICAgICAgW25vc2VhcmNoXT1cIm9wdGlvbnMubm9zZWFyY2hcIlxyXG4gICAgICAgICAgICAgICAgW21heExlbmd0aF09XCJvcHRpb25zLm1heExlbmd0aFwiXHJcbiAgICAgICAgICAgICAgICBbbWFwcGluZ0ZuXT1cIm9wdGlvbnMubWFwcGluZ0ZuXCJcclxuICAgICAgICAgICAgICAgIFttYXBGaWVsZHNdPVwib3B0aW9ucy5tYXBGaWVsZHNcIlxyXG4gICAgICAgICAgICAgICAgW2NvbnRleHRdPVwib3B0aW9ucy5jb250ZXh0XCJcclxuICAgICAgICAgICAgICAgIFtleHBhbmRMZXZlbF09XCJvcHRpb25zLmV4cGFuZExldmVsXCJcclxuICAgICAgICAgICAgICAgIFtkaWN0UGlja2luZ109XCJvcHRpb25zLmRpY3RQaWNraW5nXCJcclxuICAgICAgICAgICAgICAgIFtkaWN0UGlja2VkXT1cIm9wdGlvbnMuZGljdFBpY2tlZFwiXHJcbiAgICAgICAgICAgICAgICBbZW5hYmxlRnVsbFRyZWVdPVwib3B0aW9ucy5lbmFibGVGdWxsVHJlZVwiXHJcbiAgICAgICAgICAgICAgICBbbG9hZFRyZWVEYXRhVHlwZV09XCJvcHRpb25zLmxvYWRUcmVlRGF0YVR5cGVcIlxyXG4gICAgICAgICAgICAgICAgW2VuYWJsZUNhc2NhZGVdPVwib3B0aW9ucy5lbmFibGVDYXNjYWRlXCJcclxuICAgICAgICAgICAgICAgIFtjYXNjYWRlU3RhdHVzXT1cIm9wdGlvbnMuY2FzY2FkZVN0YXR1c1wiXHJcbiAgICAgICAgICAgICAgICBbdXNlRXh0ZW5kSW5mb109XCJvcHRpb25zLnVzZUV4dGVuZEluZm9cIlxyXG4gICAgICAgICAgICAgICAgW2V4dEluZm9GaWVsZHNdPVwib3B0aW9ucy5leHRJbmZvRmllbGRzXCJcclxuICAgICAgICAgICAgICAgIFtleHRJbmZvRm9ybWF0dGVyXT1cIm9wdGlvbnMuZXh0SW5mb0Zvcm1hdHRlclwiXHJcbiAgICAgICAgICAgICAgICBbdGV4dEFsaWduXT1cIm9wdGlvbnMudGV4dEFsaWduXCJcclxuICAgICAgICAgICAgICAgIFtsb2FkRGF0YVdoZW5PcGVuXT1cIm9wdGlvbnMubG9hZERhdGFXaGVuT3BlblwiXHJcbiAgICAgICAgICAgICAgICBbc2VsZWN0Rmlyc3RJbk5hdl09XCJvcHRpb25zLnNlbGVjdEZpcnN0SW5OYXZcIlxyXG4gICAgICAgICAgICAgICAgW2N1c3RvbU5hdkZvcm1hdHRlcl09XCJvcHRpb25zLmN1c3RvbU5hdkZvcm1hdHRlclwiXHJcbiAgICAgICAgICAgICAgICBbY3VzdG9tRm9ybWF0dGVyXT1cIm9wdGlvbnMuY3VzdG9tRm9ybWF0dGVyXCJcclxuICAgICAgICAgICAgICAgIFt0cmVlSW5mb109XCJvcHRpb25zPy50cmVlSW5mb1wiXHJcbiAgICAgICAgICAgICAgICAoZGlhbG9nQ2xvc2VkKT1cIm9uRGlhbG9nQ2xvc2VkKClcIlxyXG4gICAgICAgICAgICAgICAgKGRpYWxvZ09wZW5lZCk9XCJvbkRpYWxvZ09wZW4oKVwiXHJcbiAgICAgICAgICAgICAgICAoY2xlYXIpPVwib25DbGVhcigkZXZlbnQpXCJcclxuICAgICAgICAgICAgICAgIChsb2FkU3VjY2Vzcyk9XCJvbkxvYWRTdWNjZXNzKClcIlxyXG4gICAgICAgICAgICAgICAgW3RyZWVUYWJsZU9wdGlvbnNdPVwib3B0aW9ucz8udHJlZVRhYmxlT3B0aW9uc1wiXHJcbiAgICAgICAgICAgICAgICBbc2hvd0NoZWNrQWxsXT1cIm9wdGlvbnM/LnNob3dDaGVja0FsbFwiXHJcbiAgICAgICAgICAgICAgICBbdmlld1R5cGVdPVwib3B0aW9ucz8udmlld1R5cGVcIlxyXG4gICAgICAgICAgICAgICAgKHRhZ1JlbW92ZWQpPVwib25UYWdSZW1vdmVkKCRldmVudClcIlxyXG4gICAgICAgICAgICAgICAgW3F1aWNrU2VsZWN0XT1cIm9wdGlvbnM/LnF1aWNrU2VsZWN0XCJcclxuICAgICAgICAgICAgICAgIFt0cmVlVG9MaXN0XT1cIm9wdGlvbnM/LnRyZWVUb0xpc3RcIlxyXG4gICAgICAgICAgICAgICAgW25hdlRyZWVUb0xpc3RdPVwib3B0aW9ucz8ubmF2VHJlZVRvTGlzdFwiXHJcbiAgICAgICAgICAgICAgICBbc2hvd0Nhc2NhZGVDb250cm9sXT1cIm9wdGlvbnMuc2hvd0Nhc2NhZGVDb250cm9sXCJcclxuICAgICAgICAgICAgICAgIFtzaG93TmF2aWdhdGlvbl09XCJvcHRpb25zLnNob3dOYXZpZ2F0aW9uXCJcclxuICAgICAgICAgICAgPjwvZmFycmlzLWxvb2t1cC1ncmlkPlxyXG4gICAgICAgIDwvZGF0YWdyaWQtdG9vbHRpcD5cclxuICAgIDwvZGl2PlxyXG4gICAgYCxcclxufSlcclxuZXhwb3J0IGNsYXNzIERhdGFncmlkTG9va3VwQ29tcG9uZW50IGV4dGVuZHMgRGF0YWdyaWRCYXNlRWRpdG9yRGlyZWN0aXZlIGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0IHtcclxuICAgIEBWaWV3Q2hpbGQoJ2xvb2t1cCcpIGluc3RhbmNlOiBMb29rdXBHcmlkQ29tcG9uZW50O1xyXG5cclxuXHJcbiAgICBzZXQgY29udHJvbElkKGlkKSB7XHJcbiAgICAgICAgdGhpcy5pbnN0YW5jZS5jb250cm9sSWQgPSBpZDtcclxuICAgICAgICBpZiAodGhpcy5pbnN0YW5jZS51cmkpIHtcclxuICAgICAgICAgICAgdGhpcy5pbnN0YW5jZS5jb250cm9sSWQgKz0gJ18nICsgdGhpcy5pbnN0YW5jZS51cmk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHN0b3BQcm9wYWdhdGlvbiA9IGZhbHNlO1xyXG4gICAgY29uc3RydWN0b3IocmVuZGVyOiBSZW5kZXJlcjIsIGVsOiBFbGVtZW50UmVmLCBwcml2YXRlIHJ0czogUnVudGltZVN0YXRlU2VydmljZSxcclxuICAgICAgICAgICAgICAgIGluamVjdG9yOiBJbmplY3Rvcikge1xyXG4gICAgICAgIHN1cGVyKHJlbmRlciwgZWwsIGluamVjdG9yKTtcclxuICAgIH1cclxuXHJcbiAgICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgICAgICBzdXBlci5uZ09uSW5pdCgpO1xyXG5cclxuICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy52YWx1ZUZpZWxkKSB7XHJcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy52YWx1ZUZpZWxkID0gdGhpcy5vcHRpb25zLmlkRmllbGRcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMub3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oIHt9ICwgTG9va3VwRGVmYXVsdE9wdGlvbnMsIHRoaXMub3B0aW9ucyk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdBZnRlclZpZXdJbml0KCkge1xyXG4gICAgICAgIHRoaXMuaW5zdGFuY2UuY2hhbmdlRGV0ZWN0b3IuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMudmlld1R5cGUgPT09ICd0YWcnKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5wdXRFbGVtZW50ID0gdGhpcy5pbnN0YW5jZS50YWdib3gubmF0aXZlRWxlbWVudDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmlucHV0RWxlbWVudCA9IHRoaXMuaW5zdGFuY2UuaW5wdXRHcm91cC50ZXh0Ym94Lm5hdGl2ZUVsZW1lbnQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHN1cGVyLm5nQWZ0ZXJWaWV3SW5pdCgpO1xyXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMubG9hZGVyKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmluc3RhbmNlWydodHRwJ10pIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGdldERhdGFGbiA9IHRoaXMuaW5zdGFuY2VbJ2h0dHAnXTtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5zdGFuY2VbJ2h0dHAnXSA9IHsuLi5nZXREYXRhRm4sIGdldERhdGE6IHRoaXMub3B0aW9ucy5sb2FkZXJ9O1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnN0YW5jZVsnaHR0cCddID0ge2dldERhdGE6IHRoaXMub3B0aW9ucy5sb2FkZXJ9O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmluc3RhbmNlWydob3N0J10gPSB0aGlzLmRnO1xyXG5cclxuICAgICAgICB0aGlzLnJ0cy5zdGF0ZSQucGlwZShcclxuICAgICAgICAgICAgZGVib3VuY2VUaW1lKDEwKVxyXG4gICAgICAgICkuc3Vic2NyaWJlKHN0YXRlID0+IHtcclxuICAgICAgICAgICAgaWYgKHN0YXRlICYmIHN0YXRlLmZvcm0gJiYgc3RhdGUuZm9ybS5sb29rdXAgJiYgdGhpcy5kZykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wZW5kaW5nID0gc3RhdGUuZm9ybS5sb29rdXAucGVuZGluZztcclxuICAgICAgICAgICAgICAgIHRoaXMuZGcucGVuZGluZyA9IHRoaXMucGVuZGluZztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIG9uRGlhbG9nQ2xvc2VkKCkge1xyXG4gICAgICAgIC8vIHRoaXMubG9va3VwLmNoYW5nZURldGVjdG9yLmRldGVjdENoYW5nZXMoKTtcclxuICAgIH1cclxuXHJcbiAgICBvbkRpYWxvZ09wZW4oKSB7XHJcbiAgICAgICAgdGhpcy5pbnN0YW5jZS5jaGFuZ2VEZXRlY3Rvci5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgb25Mb2FkU3VjY2VzcygpIHtcclxuICAgICAgICB0aGlzLmluc3RhbmNlLmNoYW5nZURldGVjdG9yLmRldGVjdENoYW5nZXMoKTtcclxuICAgIH1cclxuXHJcbiAgICBvbkNsZWFyKGV2ZW50OiBNb3VzZUV2ZW50KSB7XHJcbiAgICAgICAgLy8gY29uc3Qgcm93RGF0YSA9IHRoaXMuaW5zdGFuY2Uuc2VsZWN0aW9uTWdyLmdldEJpbmRpbmdEYXRhKCk7XHJcbiAgICAgICAgLy8gdGhpcy5pbnN0YW5jZVsnZGVmYXVsdE1hcHBpbmcnXS5sb29rdXBGaWVsZE1hcChudWxsLCB0aGlzLmluc3RhbmNlLm1hcEZpZWxkcywgcm93RGF0YSk7XHJcblxyXG4gICAgICAgIHRoaXMuaW5zdGFuY2UuY2hhbmdlRGV0ZWN0b3IuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuY2xlYXIpIHtcclxuICAgICAgICAgICAgdGhpcy5vcHRpb25zLmNsZWFyKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9uVGFnUmVtb3ZlZCgkZXZuZXQpIHtcclxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLnRhZ1JlbW92ZWQpIHtcclxuICAgICAgICAgICAgdGhpcy5vcHRpb25zLnRhZ1JlbW92ZWQoJGV2bmV0KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZXh0SW5mb0Zvcm1hdHRlciA9IChlKSA9PiB7XHJcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5leHRJbmZvRm9ybWF0dGVyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLm9wdGlvbnMuZXh0SW5mb0Zvcm1hdHRlcih7IGJpbmRpbmdEYXRhOiB0aGlzLmRyLnJvd0RhdGEsIGluc3RhbmNlOiBlLmluc3RhbmNlIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==