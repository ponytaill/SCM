/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, Output, Directive, TemplateRef, ContentChild, EventEmitter } from '@angular/core';
export class ProgressStepItemTemplateDirective {
    /**
     * @param {?} template
     */
    constructor(template) {
        this.template = template;
    }
}
ProgressStepItemTemplateDirective.decorators = [
    { type: Directive, args: [{
                selector: '[progressStepItem]'
            },] }
];
/** @nocollapse */
ProgressStepItemTemplateDirective.ctorParameters = () => [
    { type: TemplateRef }
];
if (false) {
    /** @type {?} */
    ProgressStepItemTemplateDirective.prototype.template;
}
export class ProgressStepExtendTemplateDirective {
    /**
     * @param {?} template
     */
    constructor(template) {
        this.template = template;
    }
}
ProgressStepExtendTemplateDirective.decorators = [
    { type: Directive, args: [{
                selector: '[progressStepExtend]'
            },] }
];
/** @nocollapse */
ProgressStepExtendTemplateDirective.ctorParameters = () => [
    { type: TemplateRef }
];
if (false) {
    /** @type {?} */
    ProgressStepExtendTemplateDirective.prototype.template;
}
/**
 * @record
 */
export function stepMessage() { }
if (false) {
    /** @type {?} */
    stepMessage.prototype.id;
    /** @type {?} */
    stepMessage.prototype.title;
    /** @type {?|undefined} */
    stepMessage.prototype.icon;
    /** @type {?|undefined} */
    stepMessage.prototype.status;
    /** @type {?|undefined} */
    stepMessage.prototype.clickDisable;
    /** @type {?|undefined} */
    stepMessage.prototype.hidden;
    /** @type {?|undefined} */
    stepMessage.prototype.class;
}
/**
 * @record
 */
export function progressData() { }
if (false) {
    /** @type {?} */
    progressData.prototype.activeIndex;
    /** @type {?} */
    progressData.prototype.stepMessages;
}
export class ProgressStepComponent {
    constructor() {
        //进度条数据
        // @Input() stepData:progressData;
        /**
         * 横向horizontal、竖向排列vertical
         */
        this.direction = 'horizontal';
        /**
         * 是否铺满
         */
        this.fill = false;
        /**
         * 是否支持点击
         */
        this.clickable = false;
        // 步骤条整体样式
        this.stepsCls = '';
        this.stepClick = new EventEmitter();
        this.storedIndexState = false;
        this.activeIndex = 0; //从0开始
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set subStepData(value) {
        this._subStepData = value;
    }
    /**
     * @return {?}
     */
    get subStepData() {
        return this._subStepData;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set stepData(value) {
        // if(value['stepMessages']&&value['stepMessages'].length){
        //   value['stepMessages'].forEach(step => {
        //     //if(typeof step.status === 'undefined'){
        //       step.status = '';
        //     //}
        //   });
        //   this.stepMessages = value['stepMessages'].filter((step) =>{
        //     return !step.hidden;
        //   });
        // }
        // this.activeIndex = value['activeIndex'];
        setTimeout((/**
         * @return {?}
         */
        () => {
            if (value) {
                this.stepInit(value);
            }
        }));
    }
    /**
     * @return {?}
     */
    get stepData() {
        return this._stepData;
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        // if (changes['stepData'] && this.stepData) {
        //   // if(this.stepData['stepMessages']&&this.stepData['stepMessages'].length){
        //   //   this.stepData['stepMessages'].forEach(step => {
        //   //     //if(typeof step.status === 'undefined'){
        //   //       step.status = '';
        //   //     //}
        //   //   });
        //   //   this.stepMessages = this.stepData['stepMessages'].filter((step) =>{
        //   //     return !step.hidden;
        //   //   });
        //   // }
        //   // this.activeIndex = this.stepData['activeIndex'];
        //   this.stepInit();
        // } else 
        if (changes['steps'] || changes['currentId']) {
            if (!this.steps || this.stepData) {
                return;
            }
            this.steps.forEach((/**
             * @param {?} item
             * @return {?}
             */
            item => item.status = ''));
            this.stepMessages = this.steps.filter((/**
             * @param {?} item
             * @return {?}
             */
            item => !item.hidden));
            /** @type {?} */
            let index = this.stepMessages.findIndex((/**
             * @param {?} item
             * @return {?}
             */
            item => item.id === this.currentId));
            this.activeIndex = index === -1 ? 0 : index;
        }
    }
    /**
     * 点击某一步
     * @param {?} step
     * @param {?} index
     * @return {?}
     */
    listClick(step, index) {
        if (this.clickable) {
            this.stepClick.emit({ 'step': step, 'index': index });
        }
    }
    /**
     * @param {?} index
     * @return {?}
     */
    goStep(index) {
        if (this.storedIndexState) {
            if (this.activeIndex == index) {
                this.currentIndex = null;
            }
            else {
                this.currentIndex = index;
            }
        }
        else {
            this.stepMessages.forEach((/**
             * @param {?} step
             * @param {?} i
             * @return {?}
             */
            (step, i) => {
                if (i < index) {
                    step.status = 'finish';
                }
                else if (i > index) {
                    step.status = '';
                }
                else {
                    step.status = 'active';
                }
            }));
            this.activeIndex = index;
        }
    }
    /**
     * 下一步
     * @return {?}
     */
    nextStep() {
        if (this.storedIndexState && this.currentIndex < this.stepMessages.length - 1) {
            this.currentIndex++;
        }
        if (this.activeIndex < this.stepMessages.length - 1) {
            this.stepMessages[this.activeIndex].status = 'finish';
            this.stepMessages[this.activeIndex + 1].status = 'active';
            this.activeIndex++;
            if (this.storedIndexState) {
                this.currentIndex = this.activeIndex;
            }
        }
        //return this.activeIndex;
    }
    /**
     * 上一步
     * @return {?}
     */
    prevStep() {
        // if(this.storedIndexState && this.currentIndex > 0){
        //   this.currentIndex--;
        // }
        if (this.activeIndex > 0) {
            // else if(this.activeIndex > 0 && !this.storedIndexState){
            this.stepMessages[this.activeIndex].status = '';
            this.stepMessages[this.activeIndex - 1].status = 'active';
            this.activeIndex--;
            if (this.storedIndexState) {
                this.currentIndex = this.activeIndex;
            }
        }
        //return this.activeIndex;
    }
    /**
     * @return {?}
     */
    getCurrentStepIndex() {
        return this.activeIndex;
    }
    /**
     * @param {?} data
     * @return {?}
     */
    stepInit(data) {
        if (data['stepMessages'] && data['stepMessages'].length) {
            data['stepMessages'].forEach((/**
             * @param {?} step
             * @return {?}
             */
            step => {
                //if(typeof step.status === 'undefined'){
                step.status = '';
                //}
            }));
            this.stepMessages = data['stepMessages'].filter((/**
             * @param {?} step
             * @return {?}
             */
            (step) => {
                return !step.hidden;
            }));
        }
        this.activeIndex = data['activeIndex'];
        if (this.storedIndexState) {
            this.currentIndex = this.activeIndex;
        }
    }
    /**
     * @param {?} progressData
     * @return {?}
     */
    setProgressData(progressData) {
        if (progressData) {
            //this.stepData = progressData;
            this.stepInit(progressData);
        }
    }
    /**
     * @param {?} num
     * @return {?}
     */
    setActiveIndex(num) {
        /** @type {?} */
        let activeNum = (num >= 0 && num < this.stepMessages.length) ? num : 0;
        this.activeIndex = activeNum;
    }
}
ProgressStepComponent.decorators = [
    { type: Component, args: [{
                selector: 'farris-progress-step',
                template: "<div class=\"f-progress-step\">\r\n    <ul class=\"{{stepsCls}}\"\r\n    [ngClass]=\"{'f-progress-step-list':direction ==='horizontal', 'f-progress-step-list-block': direction ==='vertical','f-progress-step-horizontal-fill':direction==='horizontal' && fill,'f-progress-step-vertical-fill':direction==='vertical' && fill,'f-progress-step-has-extend':progressStepExtendTmpl}\"\r\n    [ngStyle]=\"{'height': direction ==='vertical'? fHeight +'px' :''}\"\r\n    >\r\n        <ng-container *ngFor=\"let step of stepMessages;let i = index;\">\r\n            <li [ngStyle]=\"stepStyle\" class=\"step {{step.status? step.status:(i < activeIndex ? 'finish': '')}}  {{step.hasOwnProperty('class')?step.class:''}}\" *ngIf=\"!step.hidden\" [ngClass]=\"{'active': i == activeIndex,'clickable':clickable,'click-disable':step.clickDisable,'current':i == currentIndex,'step-has-extend':progressStepExtendTmpl}\" (click)=\"listClick(step,i)\">\r\n                <ng-container *ngIf=\"!progressStepTemplate;else stepElement\">\r\n                    <div class=\"f-progressstep-row {{step.status? 'step-'+ step.status:(i < activeIndex ? 'step-finish': '')}}\" [ngClass]=\"{'step-active': i == activeIndex,'step-current':i == currentIndex}\" *ngIf=\"!step['subSteps'] || !step['subSteps'].length\">\r\n                        <div class=\"f-progress-step-content\">\r\n                            <span class=\"step-icon\" [ngClass]=\"step.icon\" *ngIf=\"step.icon;else defaultIcon\" ></span>\r\n                            <ng-template #defaultIcon>\r\n                                    <span class=\"step-icon\" *ngIf=\"i >= activeIndex || i == currentIndex; else stepSuccess\">{{i+1}}</span>\r\n                                    <ng-template #stepSuccess>\r\n                                        <span class=\"step-icon step-success k-icon k-i-check\" [ngClass]=\"step.icon\"></span>\r\n                                    </ng-template>\r\n                            </ng-template>\r\n            \r\n                            <div class=\"f-progress-step-title\">  \r\n                                <p class=\"step-name\" [ngClass]=\"{'step-name-success': i <= activeIndex}\">{{step.title}}</p>\r\n                            </div>\r\n                        </div>\r\n                            \r\n                        <div class=\"f-progress-step-line\" [ngClass]=\"{'f-progress-step-line-success': i == activeIndex}\"  *ngIf=\"i !== (stepMessages.length-1)\">\r\n                            <span class=\"triangle\" [ngClass]=\"{'f-progress-step-vertical-triangle': direction ==='vertical'}\"></span>\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"f-progressstep-row f-progressstep-row-multi\" *ngIf=\"step['subSteps'] && step['subSteps'].length\">\r\n                        <div class=\"f-step-multi-item\" \r\n                        *ngFor=\"let subStep of step.subSteps;let subIndex = index\"  \r\n                        [ngClass]=\"{'f-step-multi-item-hidden': subStep.visible === false,\r\n                        'f-step-multi-item-active':(activeIndex == i && subStepData && subStepData[step.id] == subIndex),\r\n                        'f-step-multi-item-finish':(activeIndex > i && subStepData && subStepData[step.id] == subIndex)}\"\r\n                        >\r\n                            <div class=\"f-progress-step-content f-progressstep-multi-item-content\">\r\n                                <span class=\"step-icon\" \r\n                                *ngIf=\"(activeIndex <= i || i == currentIndex); else stepSuccess\"\r\n                                >{{i+1}}</span>\r\n                                <ng-template #stepSuccess>\r\n                                    <span class=\"step-icon step-icon-done k-icon k-i-check\" *ngIf=\"subStepData && subStepData[step.id] == subIndex;else doneTemplate\"></span>\r\n                                    <ng-template #doneTemplate>\r\n                                        <span class=\"step-icon k-icon k-i-check\"></span>\r\n                                    </ng-template>\r\n                                </ng-template>\r\n\r\n                                <div class=\"f-progress-step-title\">\r\n                                    <p class=\"step-name\">{{subStep.title}} </p>\r\n                                </div>\r\n                            </div>\r\n                            <div class=\"f-progress-step-line\"  [ngClass]=\"{'f-progress-step-line-success': (activeIndex == i && subStep.active)}\" *ngIf=\"i !== (step.length-1)\"><span class=\"triangle\"></span></div>\r\n                        </div>\r\n                    </div>\r\n                    <ng-container [ngTemplateOutlet]=\"progressStepExtendTmpl\" [ngTemplateOutletContext]=\"{ step: step, index: i,length: stepMessages.length, activeIndex: activeIndex, direction: direction}\"></ng-container>            \r\n                </ng-container>\r\n                \r\n                <ng-template #stepElement>\r\n                    <ng-container [ngTemplateOutlet]=\"progressStepTemplate\" [ngTemplateOutletContext]=\"{ step: step, index: i,length: stepMessages.length, activeIndex: activeIndex, direction: direction}\"></ng-container>\r\n                </ng-template>             \r\n                \r\n            </li>\r\n        </ng-container>\r\n    </ul>\r\n    <div *ngIf=\"!stepMessages || !stepMessages.length\" class=\"f-progress-step-empty\">{{ 'progressStep.empty' | locale }}</div>\r\n    <!-- <button (click)=\"nextStep()\" [disabled]=\"activeIndex >= (stepMessages.length-1)\">\u4E0B\u4E00\u6B65</button>\r\n    <button (click)=\"prevStep()\" [disabled]=\"activeIndex <= 0\">\u4E0A\u4E00\u6B65</button> -->\r\n</div>",
                styles: [".f-progress-step .f-progress-step-list{display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;-webkit-box-align:center;align-items:center}.f-progress-step .step{display:inline-block}.f-progress-step .step .f-progressstep-row{display:-webkit-box;display:flex;position:relative;padding-right:.4375rem;padding-bottom:.9375rem}.f-progress-step .step .f-progressstep-row .f-progress-step-content{display:inline-block}.f-progress-step .step .f-progressstep-row .f-progress-step-content .step-icon{display:inline-block;width:1.875rem;height:1.875rem;margin-right:.5rem;margin-left:.5rem;line-height:1.875rem;border-radius:100%;font-size:.75rem;text-align:center;color:#fff;vertical-align:middle}.f-progress-step .step .f-progressstep-row .f-progress-step-content .f-progress-step-title{display:inline-block;vertical-align:middle}.f-progress-step .step .f-progressstep-row .f-progress-step-content .f-progress-step-title .step-message,.f-progress-step .step .f-progressstep-row .f-progress-step-content .f-progress-step-title .step-name{margin-bottom:0}.f-progress-step .step .f-progressstep-row .f-progress-step-content .f-progress-step-title .step-name{font-size:.875rem;color:#8c8c8c;line-height:1.25rem;padding-right:.625rem}.f-progress-step .step .f-progressstep-row .f-progress-step-content .f-progress-step-title .step-name.step-name-success{color:#000;opacity:.85}.f-progress-step .step .f-progressstep-row .f-progress-step-line{-webkit-box-flex:1;flex:1 1 auto;position:relative;display:-webkit-inline-box;display:inline-flex;min-width:3.75rem;vertical-align:middle}.f-progress-step .step .f-progressstep-row .f-progress-step-line::after{content:'';left:0;height:.125rem;overflow:hidden;position:absolute;right:.625rem;top:50%;margin-top:-.0625rem}.f-progress-step .step .f-progressstep-row .f-progress-step-line .triangle{position:absolute;right:0;top:50%;display:inline-block;width:.4375rem;height:.4375rem;margin-top:-.21875rem;-webkit-transform:rotate(45deg);transform:rotate(45deg)}.f-progress-step .f-progress-step-list-block .step{display:block}.f-progress-step .f-progress-step-list-block .step .f-progressstep-row{padding:0;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column}.f-progress-step .f-progress-step-list-block .step .f-progressstep-row .f-progress-step-line{-webkit-box-flex:1;flex:1 1 auto;width:.625rem;min-width:.625rem;min-height:2.5rem;margin:.5rem 0 1.25rem 1.375rem}.f-progress-step .f-progress-step-list-block .step .f-progressstep-row .f-progress-step-line::after{content:'';border-top:0}.f-progress-step .f-progress-step-list-block .step .f-progressstep-row .f-progress-step-line .triangle{top:auto;left:-.3125rem;bottom:-.5rem;border-top:0}.f-progress-step .f-progress-step-list-block .step .f-progressstep-row .f-progress-step-line .f-progress-step-title .step-name{padding-right:.875rem}.f-progress-step .f-progress-step-horizontal-fill{display:-webkit-box;display:flex;-webkit-box-pack:justify;justify-content:space-between;flex-wrap:wrap}.f-progress-step .f-progress-step-horizontal-fill .step{-webkit-box-flex:1;flex:1 1 auto}.f-progress-step .f-progress-step-vertical-fill{display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column;align-content:space-between}.f-progress-step .f-progress-step-vertical-fill .step{display:-webkit-box;display:flex;-webkit-box-flex:1;flex:1 1 auto}.f-progress-step .f-progress-step-vertical-fill .step .f-progressstep-row{-webkit-box-flex:1;flex:1 1 auto;display:-webkit-box;display:flex}.f-progress-step li.clickable{cursor:pointer}.f-progress-step li.click-disable{cursor:not-allowed}.f-progress-step .f-progress-step-empty{color:#000;opacity:.65;font-size:.875rem}.f-progress-step .f-progressstep-row-multi{display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column;-webkit-box-align:left;align-items:left}.f-progress-step .f-progressstep-row-multi .f-progressstep-multi-item-content{display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;-webkit-box-align:center;align-items:center;cursor:pointer}.f-progress-step .f-progressstep-row-multi .f-step-multi-item{position:relative;padding-right:.4375rem;padding-bottom:.9375rem}.f-progress-step .f-progressstep-row-multi .f-step-multi-item:last-child{padding-bottom:0}.f-progress-step .f-progressstep-row-multi .f-step-multi-item.f-step-multi-item-active .f-progress-step-title .step-name,.f-progress-step .f-progressstep-row-multi .f-step-multi-item.f-step-multi-item-finish .f-progress-step-title .step-name{color:rgba(0,0,0,.85)!important}.f-progress-step .f-progress-step-list-block .step .f-progressstep-row.f-progressstep-row-multi{-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row}.f-progress-step .f-progress-step-list-block .step .f-progressstep-row.f-progressstep-row-multi .f-step-multi-item{padding:0;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column}.f-progress-step .f-progress-step-list-block .step .f-progressstep-row.f-progressstep-row-multi .f-step-multi-item .f-progress-step-line{display:block}"]
            }] }
];
/** @nocollapse */
ProgressStepComponent.ctorParameters = () => [];
ProgressStepComponent.propDecorators = {
    progressStepTemplate: [{ type: ContentChild, args: [ProgressStepItemTemplateDirective, { read: TemplateRef },] }],
    progressStepExtendTmpl: [{ type: ContentChild, args: [ProgressStepExtendTemplateDirective, { read: TemplateRef },] }],
    direction: [{ type: Input }],
    fill: [{ type: Input }],
    clickable: [{ type: Input }],
    stepsCls: [{ type: Input }],
    fHeight: [{ type: Input }],
    stepStyle: [{ type: Input }],
    stepClick: [{ type: Output, args: ['stepClick',] }],
    steps: [{ type: Input }],
    currentId: [{ type: Input }],
    storedIndexState: [{ type: Input }],
    subStepData: [{ type: Input }],
    stepData: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    ProgressStepComponent.prototype.progressStepTemplate;
    /** @type {?} */
    ProgressStepComponent.prototype.progressStepExtendTmpl;
    /**
     * 横向horizontal、竖向排列vertical
     * @type {?}
     */
    ProgressStepComponent.prototype.direction;
    /**
     * 是否铺满
     * @type {?}
     */
    ProgressStepComponent.prototype.fill;
    /**
     * 是否支持点击
     * @type {?}
     */
    ProgressStepComponent.prototype.clickable;
    /** @type {?} */
    ProgressStepComponent.prototype.stepsCls;
    /** @type {?} */
    ProgressStepComponent.prototype.fHeight;
    /** @type {?} */
    ProgressStepComponent.prototype.stepStyle;
    /** @type {?} */
    ProgressStepComponent.prototype.stepClick;
    /** @type {?} */
    ProgressStepComponent.prototype.steps;
    /** @type {?} */
    ProgressStepComponent.prototype.currentId;
    /** @type {?} */
    ProgressStepComponent.prototype.storedIndexState;
    /** @type {?} */
    ProgressStepComponent.prototype._subStepData;
    /** @type {?} */
    ProgressStepComponent.prototype.stepMessages;
    /** @type {?} */
    ProgressStepComponent.prototype.activeIndex;
    /** @type {?} */
    ProgressStepComponent.prototype.currentIndex;
    /**
     * @type {?}
     * @private
     */
    ProgressStepComponent.prototype.innerStepData;
    /** @type {?} */
    ProgressStepComponent.prototype._stepData;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvZ3Jlc3Mtc3RlcC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLXByb2dyZXNzLXN0ZXAvIiwic291cmNlcyI6WyJsaWIvcHJvZ3Jlc3Mtc3RlcC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsS0FBSyxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsV0FBVyxFQUFFLFlBQVksRUFBQyxZQUFZLEVBQTRCLE1BQU0sZUFBZSxDQUFDO0FBSzlJLE1BQU0sT0FBTyxpQ0FBaUM7Ozs7SUFDNUMsWUFBbUIsUUFBMEI7UUFBMUIsYUFBUSxHQUFSLFFBQVEsQ0FBa0I7SUFBRyxDQUFDOzs7WUFKbEQsU0FBUyxTQUFDO2dCQUNULFFBQVEsRUFBRSxvQkFBb0I7YUFDL0I7Ozs7WUFKcUQsV0FBVzs7OztJQU1uRCxxREFBaUM7O0FBTS9DLE1BQU0sT0FBTyxtQ0FBbUM7Ozs7SUFDOUMsWUFBbUIsUUFBMEI7UUFBMUIsYUFBUSxHQUFSLFFBQVEsQ0FBa0I7SUFBRyxDQUFDOzs7WUFKbEQsU0FBUyxTQUFDO2dCQUNULFFBQVEsRUFBRSxzQkFBc0I7YUFDakM7Ozs7WUFYcUQsV0FBVzs7OztJQWFuRCx1REFBaUM7Ozs7O0FBSS9DLGlDQVFDOzs7SUFQQyx5QkFBYTs7SUFDYiw0QkFBZ0I7O0lBQ2hCLDJCQUFlOztJQUNmLDZCQUFpQjs7SUFDakIsbUNBQXdCOztJQUN4Qiw2QkFBa0I7O0lBQ2xCLDRCQUFlOzs7OztBQUVqQixrQ0FHQzs7O0lBRkMsbUNBQW1COztJQUNuQixvQ0FBMEI7O0FBVTVCLE1BQU0sT0FBTyxxQkFBcUI7SUF5Q2hDOzs7Ozs7UUFoQ1MsY0FBUyxHQUFHLFlBQVksQ0FBQzs7OztRQUV6QixTQUFJLEdBQVcsS0FBSyxDQUFDOzs7O1FBRXJCLGNBQVMsR0FBVyxLQUFLLENBQUM7O1FBRTFCLGFBQVEsR0FBQyxFQUFFLENBQUM7UUFJQSxjQUFTLEdBQUcs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LCBEaXJlY3RpdmUsIFRlbXBsYXRlUmVmLCBDb250ZW50Q2hpbGQsRXZlbnRFbWl0dGVyLCBPbkNoYW5nZXMsIFNpbXBsZUNoYW5nZXMgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuXHJcbkBEaXJlY3RpdmUoe1xyXG4gIHNlbGVjdG9yOiAnW3Byb2dyZXNzU3RlcEl0ZW1dJ1xyXG59KVxyXG5leHBvcnQgY2xhc3MgUHJvZ3Jlc3NTdGVwSXRlbVRlbXBsYXRlRGlyZWN0aXZlIHtcclxuICBjb25zdHJ1Y3RvcihwdWJsaWMgdGVtcGxhdGU6IFRlbXBsYXRlUmVmPGFueT4pIHt9XHJcbn1cclxuXHJcbkBEaXJlY3RpdmUoe1xyXG4gIHNlbGVjdG9yOiAnW3Byb2dyZXNzU3RlcEV4dGVuZF0nXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBQcm9ncmVzc1N0ZXBFeHRlbmRUZW1wbGF0ZURpcmVjdGl2ZSB7XHJcbiAgY29uc3RydWN0b3IocHVibGljIHRlbXBsYXRlOiBUZW1wbGF0ZVJlZjxhbnk+KSB7fVxyXG59XHJcblxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBzdGVwTWVzc2FnZSB7XHJcbiAgXCJpZFwiOiBzdHJpbmcsXHJcbiAgXCJ0aXRsZVwiOiBzdHJpbmcsXHJcbiAgXCJpY29uXCI/OnN0cmluZyxcclxuICBcInN0YXR1c1wiPzpzdHJpbmcsXHJcbiAgXCJjbGlja0Rpc2FibGVcIj86Ym9vbGVhbixcclxuICBcImhpZGRlblwiPzpib29sZWFuLFxyXG4gIFwiY2xhc3NcIj86c3RyaW5nXHJcbn1cclxuZXhwb3J0IGludGVyZmFjZSBwcm9ncmVzc0RhdGEge1xyXG4gIGFjdGl2ZUluZGV4Om51bWJlcixcclxuICBzdGVwTWVzc2FnZXM6c3RlcE1lc3NhZ2VbXVxyXG59XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ2ZhcnJpcy1wcm9ncmVzcy1zdGVwJyxcclxuICB0ZW1wbGF0ZVVybDonLi9wcm9ncmVzcy1zdGVwLmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6W1xyXG4gICAgJy4vcHJvZ3Jlc3Mtc3RlcC5jb21wb25lbnQuc2NzcydcclxuICBdXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBQcm9ncmVzc1N0ZXBDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcyB7XHJcblxyXG4gIEBDb250ZW50Q2hpbGQoUHJvZ3Jlc3NTdGVwSXRlbVRlbXBsYXRlRGlyZWN0aXZlLCB7cmVhZDogVGVtcGxhdGVSZWZ9KSBwcm9ncmVzc1N0ZXBUZW1wbGF0ZTogVGVtcGxhdGVSZWY8YW55PjtcclxuICBAQ29udGVudENoaWxkKFByb2dyZXNzU3RlcEV4dGVuZFRlbXBsYXRlRGlyZWN0aXZlLCB7cmVhZDogVGVtcGxhdGVSZWZ9KSBwcm9ncmVzc1N0ZXBFeHRlbmRUbXBsOiBUZW1wbGF0ZVJlZjxhbnk+O1xyXG5cclxuICAvL+i/m+W6puadoeaVsOaNrlxyXG4gIC8vIEBJbnB1dCgpIHN0ZXBEYXRhOnByb2dyZXNzRGF0YTtcclxuXHJcbiAgLyoq5qiq5ZCRaG9yaXpvbnRhbOOAgeerluWQkeaOkuWIl3ZlcnRpY2FsKi9cclxuICBASW5wdXQoKSBkaXJlY3Rpb24gPSAnaG9yaXpvbnRhbCc7XHJcbiAgLyoq5piv5ZCm6ZO65ruhICovXHJcbiAgQElucHV0KCkgZmlsbDpib29sZWFuID0gZmFsc2U7XHJcbiAgLyoq5piv5ZCm5pSv5oyB54K55Ye7ICovXHJcbiAgQElucHV0KCkgY2xpY2thYmxlOmJvb2xlYW4gPSBmYWxzZTtcclxuICAvLyDmraXpqqTmnaHmlbTkvZPmoLflvI9cclxuICBASW5wdXQoKSBzdGVwc0Nscz0nJztcclxuICBASW5wdXQoKSBmSGVpZ2h0Om51bWJlcjtcclxuICAvLyDmraXpqqTmnaFTdHlsZSzlhpnms5UgW3N0ZXBTdHlsZV09XCJ7J21heC13aWR0aCc6JzEwMHB4J31cIlxyXG4gIEBJbnB1dCgpIHN0ZXBTdHlsZTphbnk7XHJcbiAgQE91dHB1dCgnc3RlcENsaWNrJykgc3RlcENsaWNrID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gIFxyXG5cclxuICBASW5wdXQoKSBzdGVwczogc3RlcE1lc3NhZ2VbXTtcclxuICBASW5wdXQoKSBjdXJyZW50SWQ6IHN0cmluZztcclxuICBASW5wdXQoKSBzdG9yZWRJbmRleFN0YXRlOmJvb2xlYW4gPSBmYWxzZTtcclxuXHJcbiAgX3N1YlN0ZXBEYXRhO1xyXG4gIEBJbnB1dCgpXHJcbiAgc2V0IHN1YlN0ZXBEYXRhKHZhbHVlKXtcclxuICAgIHRoaXMuX3N1YlN0ZXBEYXRhID0gdmFsdWU7XHJcbiAgfVxyXG4gIGdldCBzdWJTdGVwRGF0YSgpe1xyXG4gICAgcmV0dXJuIHRoaXMuX3N1YlN0ZXBEYXRhO1xyXG4gIH1cclxuXHJcbiAgc3RlcE1lc3NhZ2VzOiBzdGVwTWVzc2FnZVtdO1xyXG4gIGFjdGl2ZUluZGV4Om51bWJlciA9IDA7IC8v5LuOMOW8gOWni1xyXG4gIGN1cnJlbnRJbmRleDpudW1iZXI7XHJcblxyXG4gIHByaXZhdGUgaW5uZXJTdGVwRGF0YTogcHJvZ3Jlc3NEYXRhO1xyXG5cclxuICBjb25zdHJ1Y3RvcigpIHsgfVxyXG5cclxuICBuZ09uSW5pdCgpIHtcclxuICB9XHJcblxyXG4gIF9zdGVwRGF0YTpwcm9ncmVzc0RhdGE7XHJcbiAgQElucHV0KClcclxuICBzZXQgc3RlcERhdGEodmFsdWUpe1xyXG4gICAgLy8gaWYodmFsdWVbJ3N0ZXBNZXNzYWdlcyddJiZ2YWx1ZVsnc3RlcE1lc3NhZ2VzJ10ubGVuZ3RoKXtcclxuICAgIC8vICAgdmFsdWVbJ3N0ZXBNZXNzYWdlcyddLmZvckVhY2goc3RlcCA9PiB7XHJcbiAgICAvLyAgICAgLy9pZih0eXBlb2Ygc3RlcC5zdGF0dXMgPT09ICd1bmRlZmluZWQnKXtcclxuICAgIC8vICAgICAgIHN0ZXAuc3RhdHVzID0gJyc7XHJcbiAgICAvLyAgICAgLy99XHJcbiAgICAvLyAgIH0pO1xyXG4gICAgLy8gICB0aGlzLnN0ZXBNZXNzYWdlcyA9IHZhbHVlWydzdGVwTWVzc2FnZXMnXS5maWx0ZXIoKHN0ZXApID0+e1xyXG4gICAgLy8gICAgIHJldHVybiAhc3RlcC5oaWRkZW47XHJcbiAgICAvLyAgIH0pO1xyXG4gICAgLy8gfVxyXG4gICAgLy8gdGhpcy5hY3RpdmVJbmRleCA9IHZhbHVlWydhY3RpdmVJbmRleCddO1xyXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgIGlmKHZhbHVlKXtcclxuICAgICAgICB0aGlzLnN0ZXBJbml0KHZhbHVlKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG4gIGdldCBzdGVwRGF0YSgpe1xyXG4gICAgcmV0dXJuIHRoaXMuX3N0ZXBEYXRhO1xyXG4gIH1cclxuXHJcbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xyXG4gICAgLy8gaWYgKGNoYW5nZXNbJ3N0ZXBEYXRhJ10gJiYgdGhpcy5zdGVwRGF0YSkge1xyXG4gICAgLy8gICAvLyBpZih0aGlzLnN0ZXBEYXRhWydzdGVwTWVzc2FnZXMnXSYmdGhpcy5zdGVwRGF0YVsnc3RlcE1lc3NhZ2VzJ10ubGVuZ3RoKXtcclxuICAgIC8vICAgLy8gICB0aGlzLnN0ZXBEYXRhWydzdGVwTWVzc2FnZXMnXS5mb3JFYWNoKHN0ZXAgPT4ge1xyXG4gICAgLy8gICAvLyAgICAgLy9pZih0eXBlb2Ygc3RlcC5zdGF0dXMgPT09ICd1bmRlZmluZWQnKXtcclxuICAgIC8vICAgLy8gICAgICAgc3RlcC5zdGF0dXMgPSAnJztcclxuICAgIC8vICAgLy8gICAgIC8vfVxyXG4gICAgLy8gICAvLyAgIH0pO1xyXG4gICAgLy8gICAvLyAgIHRoaXMuc3RlcE1lc3NhZ2VzID0gdGhpcy5zdGVwRGF0YVsnc3RlcE1lc3NhZ2VzJ10uZmlsdGVyKChzdGVwKSA9PntcclxuICAgIC8vICAgLy8gICAgIHJldHVybiAhc3RlcC5oaWRkZW47XHJcbiAgICAvLyAgIC8vICAgfSk7XHJcbiAgICAvLyAgIC8vIH1cclxuICAgIC8vICAgLy8gdGhpcy5hY3RpdmVJbmRleCA9IHRoaXMuc3RlcERhdGFbJ2FjdGl2ZUluZGV4J107XHJcbiAgICAvLyAgIHRoaXMuc3RlcEluaXQoKTtcclxuICAgIC8vIH0gZWxzZSBcclxuICAgIGlmIChjaGFuZ2VzWydzdGVwcyddIHx8IGNoYW5nZXNbJ2N1cnJlbnRJZCddKSB7XHJcbiAgICAgIGlmICghdGhpcy5zdGVwcyB8fCB0aGlzLnN0ZXBEYXRhKSB7IHJldHVybjsgfVxyXG4gICAgICB0aGlzLnN0ZXBzLmZvckVhY2goaXRlbSA9PiBpdGVtLnN0YXR1cyA9ICcnKTtcclxuICAgICAgdGhpcy5zdGVwTWVzc2FnZXMgPSB0aGlzLnN0ZXBzLmZpbHRlcihpdGVtID0+ICFpdGVtLmhpZGRlbik7XHJcbiAgICAgIGxldCBpbmRleCA9IHRoaXMuc3RlcE1lc3NhZ2VzLmZpbmRJbmRleChpdGVtID0+IGl0ZW0uaWQgPT09IHRoaXMuY3VycmVudElkKTtcclxuICAgICAgdGhpcy5hY3RpdmVJbmRleCA9IGluZGV4ID09PSAtMSA/IDAgOiBpbmRleDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKueCueWHu+afkOS4gOatpSAqL1xyXG4gIGxpc3RDbGljayhzdGVwLGluZGV4KXtcclxuICAgIGlmKHRoaXMuY2xpY2thYmxlKXtcclxuICAgICAgdGhpcy5zdGVwQ2xpY2suZW1pdCh7J3N0ZXAnOnN0ZXAsJ2luZGV4JzppbmRleH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZ29TdGVwKGluZGV4KXtcclxuICAgIGlmKHRoaXMuc3RvcmVkSW5kZXhTdGF0ZSl7XHJcbiAgICAgIGlmKHRoaXMuYWN0aXZlSW5kZXggPT0gaW5kZXgpe1xyXG4gICAgICAgIHRoaXMuY3VycmVudEluZGV4ID0gbnVsbDtcclxuICAgICAgfVxyXG4gICAgICBlbHNle1xyXG4gICAgICAgIHRoaXMuY3VycmVudEluZGV4ID0gaW5kZXg7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGVsc2V7XHJcbiAgICAgIHRoaXMuc3RlcE1lc3NhZ2VzLmZvckVhY2goKHN0ZXAsIGkgKT0+IHtcclxuICAgICAgICBpZihpPGluZGV4KXtcclxuICAgICAgICAgIHN0ZXAuc3RhdHVzID0gJ2ZpbmlzaCc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYoaT5pbmRleCl7XHJcbiAgICAgICAgICBzdGVwLnN0YXR1cyA9ICcnO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNle1xyXG4gICAgICAgICAgc3RlcC5zdGF0dXMgPSAnYWN0aXZlJztcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgICB0aGlzLmFjdGl2ZUluZGV4ID0gaW5kZXg7XHJcbiAgICB9XHJcbiAgICBcclxuICB9XHJcblxyXG4gIC8qKuS4i+S4gOatpSAqL1xyXG4gIG5leHRTdGVwKCl7XHJcbiAgICBpZih0aGlzLnN0b3JlZEluZGV4U3RhdGUgJiYgdGhpcy5jdXJyZW50SW5kZXggPCB0aGlzLnN0ZXBNZXNzYWdlcy5sZW5ndGgtMSl7XHJcbiAgICAgIHRoaXMuY3VycmVudEluZGV4Kys7XHJcbiAgICB9XHJcbiAgICBpZih0aGlzLmFjdGl2ZUluZGV4IDwgdGhpcy5zdGVwTWVzc2FnZXMubGVuZ3RoLTEpe1xyXG4gICAgICB0aGlzLnN0ZXBNZXNzYWdlc1t0aGlzLmFjdGl2ZUluZGV4XS5zdGF0dXMgPSAnZmluaXNoJztcclxuICAgICAgdGhpcy5zdGVwTWVzc2FnZXNbdGhpcy5hY3RpdmVJbmRleCsxXS5zdGF0dXMgPSAnYWN0aXZlJztcclxuICAgICAgdGhpcy5hY3RpdmVJbmRleCsrO1xyXG4gICAgICBpZih0aGlzLnN0b3JlZEluZGV4U3RhdGUpe1xyXG4gICAgICAgIHRoaXMuY3VycmVudEluZGV4ID0gdGhpcy5hY3RpdmVJbmRleDtcclxuICAgICAgfVxyXG5cclxuICAgIH1cclxuICAgIC8vcmV0dXJuIHRoaXMuYWN0aXZlSW5kZXg7XHJcbiAgfVxyXG4gIC8qKuS4iuS4gOatpSAqL1xyXG4gIHByZXZTdGVwKCl7XHJcbiAgICAvLyBpZih0aGlzLnN0b3JlZEluZGV4U3RhdGUgJiYgdGhpcy5jdXJyZW50SW5kZXggPiAwKXtcclxuICAgIC8vICAgdGhpcy5jdXJyZW50SW5kZXgtLTtcclxuICAgIC8vIH1cclxuICAgIGlmKHRoaXMuYWN0aXZlSW5kZXggPiAwKXtcclxuICAgIC8vIGVsc2UgaWYodGhpcy5hY3RpdmVJbmRleCA+IDAgJiYgIXRoaXMuc3RvcmVkSW5kZXhTdGF0ZSl7XHJcbiAgICAgIHRoaXMuc3RlcE1lc3NhZ2VzW3RoaXMuYWN0aXZlSW5kZXhdLnN0YXR1cyA9ICcnO1xyXG4gICAgICB0aGlzLnN0ZXBNZXNzYWdlc1t0aGlzLmFjdGl2ZUluZGV4LTFdLnN0YXR1cyA9ICdhY3RpdmUnO1xyXG4gICAgICB0aGlzLmFjdGl2ZUluZGV4LS07XHJcbiAgICAgIGlmKHRoaXMuc3RvcmVkSW5kZXhTdGF0ZSl7XHJcbiAgICAgICAgdGhpcy5jdXJyZW50SW5kZXggPSB0aGlzLmFjdGl2ZUluZGV4O1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgfVxyXG4gICAgLy9yZXR1cm4gdGhpcy5hY3RpdmVJbmRleDtcclxuICB9XHJcblxyXG4gIGdldEN1cnJlbnRTdGVwSW5kZXgoKXtcclxuICAgIHJldHVybiB0aGlzLmFjdGl2ZUluZGV4O1xyXG4gIH1cclxuXHJcbiAgc3RlcEluaXQoZGF0YSl7XHJcbiAgICBpZihkYXRhWydzdGVwTWVzc2FnZXMnXSYmZGF0YVsnc3RlcE1lc3NhZ2VzJ10ubGVuZ3RoKXtcclxuICAgICAgZGF0YVsnc3RlcE1lc3NhZ2VzJ10uZm9yRWFjaChzdGVwID0+IHtcclxuICAgICAgICAvL2lmKHR5cGVvZiBzdGVwLnN0YXR1cyA9PT0gJ3VuZGVmaW5lZCcpe1xyXG4gICAgICAgICAgc3RlcC5zdGF0dXMgPSAnJztcclxuICAgICAgICAvL31cclxuICAgICAgfSk7XHJcbiAgICAgIHRoaXMuc3RlcE1lc3NhZ2VzID0gZGF0YVsnc3RlcE1lc3NhZ2VzJ10uZmlsdGVyKChzdGVwKSA9PntcclxuICAgICAgICByZXR1cm4gIXN0ZXAuaGlkZGVuO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICAgIHRoaXMuYWN0aXZlSW5kZXggPSBkYXRhWydhY3RpdmVJbmRleCddO1xyXG4gICAgaWYodGhpcy5zdG9yZWRJbmRleFN0YXRlKXtcclxuICAgICAgdGhpcy5jdXJyZW50SW5kZXggPSB0aGlzLmFjdGl2ZUluZGV4O1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgc2V0UHJvZ3Jlc3NEYXRhKHByb2dyZXNzRGF0YTpwcm9ncmVzc0RhdGEpe1xyXG4gICAgaWYocHJvZ3Jlc3NEYXRhKXtcclxuICAgICAgLy90aGlzLnN0ZXBEYXRhID0gcHJvZ3Jlc3NEYXRhO1xyXG4gICAgICB0aGlzLnN0ZXBJbml0KHByb2dyZXNzRGF0YSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBzZXRBY3RpdmVJbmRleChudW06bnVtYmVyKXtcclxuICAgIGxldCBhY3RpdmVOdW06bnVtYmVyICA9IChudW0+PSAwICYmIG51bSA8IHRoaXMuc3RlcE1lc3NhZ2VzLmxlbmd0aCk/IG51bTogMDtcclxuICAgIHRoaXMuYWN0aXZlSW5kZXggPSBhY3RpdmVOdW07XHJcbiAgICBcclxuICB9XHJcbn1cclxuIl19