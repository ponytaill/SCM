/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, Output, EventEmitter, Renderer2, ElementRef, ViewChild, ViewEncapsulation, HostListener } from '@angular/core';
import { QuerySolutionService } from '@farris/ui-filter-condition';
import { deepCopy } from './utils';
import { IdService } from '@farris/ui-common';
import { cloneDeep } from 'lodash-es';
// 用于显示点击 简单筛选 项的下拉面板
export class FilterPanelComponent {
    /**
     * @param {?} renderer
     * @param {?} elementRef
     * @param {?} filterConditionSer
     */
    constructor(renderer, elementRef, filterConditionSer) {
        this.renderer = renderer;
        this.elementRef = elementRef;
        this.filterConditionSer = filterConditionSer;
        this._hide = false;
        this.hidePanel = new EventEmitter();
        this.submit = new EventEmitter();
        this.filterSubmit = new EventEmitter();
        this.clearFilter = new EventEmitter();
        this.dataChange = new EventEmitter();
        this.canSubmit = false;
        this.fiexedLeft = true;
        // 全局标识，初始化标识元素没有发生mousemove
        this.hasMove = false;
        this._documentMouseUpEvent = null;
        this.currentItem = null;
        this.isNil = (/**
         * @param {?} val
         * @return {?}
         */
        (val) => val === null || val === undefined || val === '');
        this.el = this.elementRef.nativeElement;
    }
    /**
     * @param {?} val
     * @return {?}
     */
    set hide(val) {
        this._hide = val;
    }
    /**
     * @return {?}
     */
    get hide() {
        return this._hide;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        /** @type {?} */
        const self = this;
        this._documentMouseUpEvent = this.renderer.listen(this.filterPanel.nativeElement, 'mouseup', (/**
         * @param {?} event
         * @return {?}
         */
        (event) => {
            event.stopPropagation();
            /** @type {?} */
            const tar = event.target;
            if (tar.closest('#mainContainerTabset')) {
                // self.hidePanel.emit(event);
                this.panelFilterCancel(event);
                return;
            }
            if (this.hasMove) {
                return;
            }
            if (!tar.closest('.f-filter-panel')
                && !tar.closest('.modal')
                && !tar.closest('.overlay-container') && !tar.closest('.overlay-pane')) {
                // self.hidePanel.emit(event);
                this.panelFilterCancel(event);
            }
            this.hasMove = false;
        }));
        if (this.option.item && (this.option.item.control.controltype == 'dropdown' || this.option.item.control.controltype == 'radio')) {
            this.canSubmit = true;
        }
        if (this.injector) {
            this.idService = this.injector.get(IdService);
        }
        this.currentItem = cloneDeep({ value: Object.assign({}, this.option.item.value), type: this.option.item.control.controltype, id: this.option.item.id });
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        /** @type {?} */
        const _panel = this.el.querySelector('.f-filter-panel');
        if (_panel && this.option.target) {
            /** @type {?} */
            const h = _panel.offsetHeight;
            /** @type {?} */
            const rect = this.option.target.getBoundingClientRect();
            if (window['innerHeight'] - this.option.top < h) {
                if (rect.top > h) {
                    this.option.top = rect.top - h - 14;
                }
                else {
                    this.option.top = 32;
                }
                /** @type {?} */
                const arrow = this.el.querySelector('.f-filter-panel-arrow');
                if (arrow) {
                    arrow.style.display = 'none';
                }
            }
        }
        if (_panel && this.option.right) {
            if (this.option.left + _panel.offsetWidth > window['innerWidth']) {
                // 超出显示在做
                this.fiexedLeft = false;
                this.option.left = this.option.right - _panel.offsetWidth;
            }
            else {
                this.fiexedLeft = true;
            }
        }
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        if (this._documentMouseUpEvent) {
            this._documentMouseUpEvent();
            this._documentMouseUpEvent = null;
        }
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onMouseDown($event) {
        this.hasMove = false;
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onMouseMove($event) {
        this.hasMove = true;
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onSearch(event) {
        if (this.option.item.control.controltype == 'radio') {
            this.panelFilterSubmit();
        }
        else if (this.option.item.control.controltype == 'text' && event['type'] && event['type'] === 'enter') {
            this.panelFilterSubmit();
        }
        // this.filterItem = event;
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    panelFilterCancel($event) {
        // $event._instanceId = this.id;
        this.hidePanel.emit($event);
    }
    /**
     * @param {?=} clear
     * @return {?}
     */
    panelFilterSubmit(clear = false) {
        if (!clear && !this.canSubmit) {
            return;
        }
        if (this.option.item.control.controltype === 'text') {
            /** @type {?} */
            const farrisSearchRecord = this.option.item.valueText;
            /** @type {?} */
            let farrisSearchRecordArray = [];
            /** @type {?} */
            const storagelabelCode = this.option.item.labelCode;
            /** @type {?} */
            let filterPanelArray = JSON.parse(localStorage.getItem(this.option.localStorageKey));
            if (Array.isArray(filterPanelArray)) {
                filterPanelArray = null;
            }
            if (!filterPanelArray || !filterPanelArray[storagelabelCode] || !filterPanelArray[storagelabelCode].length
                && farrisSearchRecord && farrisSearchRecord.length) {
                farrisSearchRecordArray.push(farrisSearchRecord);
            }
            else {
                farrisSearchRecordArray = filterPanelArray[storagelabelCode];
                /** @type {?} */
                const index = filterPanelArray[storagelabelCode].indexOf(farrisSearchRecord);
                if (index < 0 && farrisSearchRecord && farrisSearchRecord.length) {
                    farrisSearchRecordArray.unshift(farrisSearchRecord);
                }
                farrisSearchRecordArray = farrisSearchRecordArray.slice(0, 6);
            }
            if (filterPanelArray == null) {
                filterPanelArray = {};
            }
            filterPanelArray[storagelabelCode] = farrisSearchRecordArray;
            localStorage.setItem(this.option.localStorageKey, JSON.stringify(filterPanelArray));
        }
        /** @type {?} */
        const conditions = this.filterConditionSer.setFilterConditions(this.option.item);
        if (!clear) {
            this.filterSubmit.emit({
                item: this.option.item,
                filter: conditions
            });
        }
        this.submit.emit(this.option.item);
    }
    /**
     * @return {?}
     */
    panelFilterClear() {
        this.panelFilterempty();
        this.panelFilterSubmit(true);
        this.clearFilter.emit(this.option.item);
    }
    /**
     * @return {?}
     */
    panelFilterempty() {
        this.filterClearValue(this.option.item);
        this.option.item.valueText = '';
        this.option.item.filled = false;
        this.option.item = deepCopy(this.option.item);
        this.canSubmit = false;
    }
    /**
     * @param {?} item
     * @return {?}
     */
    filterClearValue(item) {
        switch (item.control.controltype) {
            case 'text':
            case 'search':
            case 'singleDate':
            case 'year':
            case 'month':
            case 'dropdown':
            case 'singlenumber':
            case 'radio':
                item.value.value = null;
                break;
            case 'date':
            case 'datetime':
            case 'monthRange':
            case 'yearRange':
                item.value.startTime = null;
                item.value.endTime = null;
                break;
            case 'number':
                item.value.startValue = null;
                item.value.endValue = null;
                break;
            case 'help':
                item.value.value = [];
                item.value.valueField = null;
                item.value.textValue = null;
                break;
            case 'checkboxgroup':
            case 'bool-check':
                item.value.value = [];
                break;
            case 'input-group':
                item.value.value = [];
                item.value.textValue = null;
                item.value.textField = null;
                item.value.isInputText = null;
                break;
            case 'flexibleNumber':
            case 'flexibleDate':
                item.value.startValue = null;
                item.value.endValue = null;
                item.value.value = null;
                break;
            default:
                item.value.value = null;
                break;
        }
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onSubmitChange(event) {
        this.canSubmit = event;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    buildSmartHelpKey(value) {
        if (this.idService) {
            /** @type {?} */
            let prefix = '';
            if (location.hash) {
                /** @type {?} */
                const pathArr = location.hash.split('?');
                prefix = pathArr ? pathArr[0] : '';
            }
            else {
                /** @type {?} */
                const pathArr = location.pathname.split('/');
                prefix = pathArr ? pathArr[pathArr.length - 1] : '';
            }
            return this.idService.encrypt(prefix + '/list-filter/' + value);
        }
        else {
            return 'list-filter/' + value;
        }
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    updateCurrentItem($event) {
        this.currentItem = cloneDeep({ value: Object.assign({}, $event.value), type: $event.control.controltype, id: $event.id });
        this.dataChange.emit(this.currentItem);
    }
    /**
     * @return {?}
     */
    canClearSearch() {
        /** @type {?} */
        const item = this.currentItem;
        if (!item) {
            return true;
        }
        switch (item.type) {
            case 'text':
            case 'search':
            case 'singleDate':
            case 'year':
            case 'month':
            case 'dropdown':
            case 'singlenumber':
            case 'radio':
                return !this.isNil(item.value.value);
            case 'date':
            case 'datetime':
            case 'monthRange':
            case 'yearRange':
                return !this.isNil(item.value.startTime) || !this.isNil(item.value.endTime);
            case 'help':
            case 'checkboxgroup':
            case 'bool-check':
            case 'input-group':
                return item.value.value && item.value.value.length;
            case 'number':
            case 'flexibleNumber':
            case 'flexibleDate':
                if (item.value.single) {
                    return !this.isNil(item.value.value);
                }
                return !this.isNil(item.value.startValue) || !this.isNil(item.value.endValue);
            default:
                return !this.isNil(item.value.value);
        }
    }
}
FilterPanelComponent.decorators = [
    { type: Component, args: [{
                selector: 'farris-filter-panel',
                template: "<div class=\"f-filter-panel-wrapper\" #filterPanel [ngClass]=\"{'d-none': hide}\" >\r\n    <div  [class]=\"'f-filter-panel f-filter-panel-'+(option.item && option.item.control.controltype)\"\r\n        [ngStyle]=\"{\r\n            'left': option.left > 0 ? option.left+'px' : '0px',\r\n            'top': option.top > 0 ? option.top+'px' : '0px',\r\n            'width': (option.width && option.width > 0) ? option.width+'px':'',\r\n            'height': (option.height && option.height > 0) ? option.height+'px':'',\r\n            'max-width': (option.maxWidth && option.maxWidth > 0) ? option.maxWidth+'px':'',\r\n            'max-height': (option.maxHeight && option.maxHeight > 0) ? option.maxHeight+'px':''\r\n        }\">\r\n        <div class=\"f-filter-panel-inner\" [ngClass]=\"{'f-filter-panel-inner-xs': option.item && option.item.control.controltype == 'radio','f-filter-panel-inner-auto': !option.item}\">\r\n            <div class=\"f-filter-panel-arrow\" [ngStyle]=\"{'left':fiexedLeft?'26px':'auto','right':fiexedLeft?'auto':'26px'}\"></div>\r\n            <div class=\"f-filter-panel-extend\" *ngIf=\"option.panelExtendTemplate\">\r\n                <ng-container [ngTemplateOutlet]=\"option.panelExtendTemplate\"></ng-container>\r\n            </div>\r\n            <div class=\"f-filter-panel-header\" *ngIf=\"option.showLable && option.item && option.item.control.controltype != 'radio'\">\r\n                <div class=\"panel-header-title\">\r\n                    {{ 'filterPanel.filter' | locale }}\r\n                </div>\r\n                <!-- <div class=\"panel-header-toolbar\"></div> -->\r\n            </div>\r\n            <div class=\"f-filter-panel-content\" *ngIf=\"option.item\">\r\n                <div class=\"f-filter-panel-form\">\r\n                    <ng-container [ngSwitch]=\"option.item.control.controltype\">\r\n                        <div class=\"filter-input-item filter-type-input position-relative\" *ngSwitchCase=\"'text'\">\r\n                            <panel-filter-input [item]=\"option.item\" [localStorageKey]=\"option.localStorageKey\"\r\n                                (searchHandle)=\"onSearch($event)\" (submitChange)=\"onSubmitChange($event)\" class=\"form-group farris-form-group\"></panel-filter-input>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-search\" *ngSwitchCase=\"'search'\">\r\n                            <panel-filter-search [item]=\"option.item\"\r\n                                (searchHandle)=\"onSearch($event)\" (submitChange)=\"onSubmitChange($event)\" class=\"form-group farris-form-group\"></panel-filter-search>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-date\" *ngSwitchCase=\"'singleDate'\">\r\n                            <panel-filter-date [item]=\"option.item\"\r\n                                (searchHandle)=\"onSearch($event)\" (submitChange)=\"onSubmitChange($event)\" class=\"form-group farris-form-group\"></panel-filter-date>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-date\" *ngSwitchCase=\"'year'\">\r\n                            <panel-filter-date [item]=\"option.item\"\r\n                                (searchHandle)=\"onSearch($event)\" class=\"form-group farris-form-group\" [showType]=\"'3'\" (submitChange)=\"onSubmitChange($event)\"></panel-filter-date>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-date\" *ngSwitchCase=\"'month'\">\r\n                            <panel-filter-date [item]=\"option.item\"\r\n                                (searchHandle)=\"onSearch($event)\" class=\"form-group farris-form-group\" [showType]=\"'2'\" (submitChange)=\"onSubmitChange($event)\"></panel-filter-date>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-date\" *ngSwitchCase=\"'date'\">\r\n                            <panel-filter-daterange [item]=\"option.item\"\r\n                                (searchHandle)=\"onSearch($event)\" class=\"form-group farris-form-group\" (submitChange)=\"onSubmitChange($event)\"></panel-filter-daterange>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-date\" *ngSwitchCase=\"'datetime'\">\r\n                            <panel-filter-daterange [item]=\"option.item\" [showTime]=\"true\"\r\n                                (searchHandle)=\"onSearch($event)\" class=\"form-group farris-form-group\" (submitChange)=\"onSubmitChange($event)\"></panel-filter-daterange>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-date\" *ngSwitchCase=\"'monthRange'\">\r\n                            <panel-filter-daterange [item]=\"option.item\"\r\n                                (searchHandle)=\"onSearch($event)\" class=\"form-group farris-form-group\" [showType]=\"'2'\" (submitChange)=\"onSubmitChange($event)\"></panel-filter-daterange>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-date\" *ngSwitchCase=\"'yearRange'\">\r\n                            <panel-filter-daterange [item]=\"option.item\"\r\n                                (searchHandle)=\"onSearch($event)\" class=\"form-group farris-form-group\" [showType]=\"'3'\" (submitChange)=\"onSubmitChange($event)\"></panel-filter-daterange>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-dropdown\" *ngSwitchCase=\"'dropdown'\">\r\n                            <panel-filter-dropdown [item]=\"option.item\"\r\n                                (searchHandle)=\"onSearch($event)\" class=\"form-group farris-form-group\"  (submitChange)=\"onSubmitChange($event)\"></panel-filter-dropdown>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-number\" *ngSwitchCase=\"'number'\">\r\n                            <panel-filter-number [item]=\"option.item\"\r\n                                (searchHandle)=\"onSearch($event)\" class=\"form-group farris-form-group\" (submitChange)=\"onSubmitChange($event)\"></panel-filter-number>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-single-number\" *ngSwitchCase=\"'singlenumber'\">\r\n                            <panel-filter-single-number [item]=\"option.item\"\r\n                                (searchHandle)=\"onSearch($event)\" class=\"form-group farris-form-group\" (submitChange)=\"onSubmitChange($event)\"></panel-filter-single-number>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-help\" *ngSwitchCase=\"'help'\">\r\n                            <panel-filter-help [item]=\"option.item\" [instanceId]=\"buildSmartHelpKey(option.item.fieldCode)\"\r\n                                (searchHandle)=\"onSearch($event)\" class=\"form-group farris-form-group\" (submitChange)=\"onSubmitChange($event)\"></panel-filter-help>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-checkboxgroup\" *ngSwitchCase=\"'checkboxgroup'\">\r\n                            <panel-filter-checkbox [item]=\"option.item\"\r\n                                (searchHandle)=\"onSearch($event)\" class=\"form-group farris-form-group\"\r\n                                style=\"white-space: nowrap;\" (submitChange)=\"onSubmitChange($event)\"></panel-filter-checkbox>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-radio\" *ngSwitchCase=\"'radio'\">\r\n                            <panel-filter-radio [item]=\"option.item\"\r\n                                (searchHandle)=\"onSearch($event)\" class=\"form-group farris-form-group\"\r\n                                style=\"white-space: nowrap;\"></panel-filter-radio>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-radio\" *ngSwitchCase=\"'input-group'\">\r\n                            <panel-filter-inputgroup [item]=\"option.item\"\r\n                                (searchHandle)=\"onSearch($event)\" class=\"form-group farris-form-group\"\r\n                                style=\"white-space: nowrap;\"  (submitChange)=\"onSubmitChange($event)\"></panel-filter-inputgroup>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-flexiblenumber\" *ngSwitchCase=\"'flexibleNumber'\">\r\n                            <panel-filter-flexiblenumber [item]=\"option.item\" (itemChange)=\"updateCurrentItem($event)\"\r\n                                (searchHandle)=\"onSearch($event)\" class=\"form-group farris-form-group\"\r\n                                style=\"white-space: nowrap;\" (submitChange)=\"onSubmitChange($event)\"></panel-filter-flexiblenumber>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-flexibledate\" *ngSwitchCase=\"'flexibleDate'\">\r\n                            <panel-filter-flexibledate [item]=\"option.item\"  (itemChange)=\"updateCurrentItem($event)\"\r\n                                (searchHandle)=\"onSearch($event)\" class=\"form-group farris-form-group\"\r\n                                style=\"white-space: nowrap;\" (submitChange)=\"onSubmitChange($event)\"></panel-filter-flexibledate>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-boolcheck\" *ngSwitchCase=\"'bool-check'\">\r\n                            <panel-filter-checkbox [item]=\"option.item\" [boolcheck]=\"true\"\r\n                                (searchHandle)=\"onSearch($event)\" class=\"form-group farris-form-group\"\r\n                                style=\"white-space: nowrap;\" (submitChange)=\"onSubmitChange($event)\"></panel-filter-checkbox>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-default\" *ngSwitchDefault>\r\n                            <panel-filter-input [item]=\"option.item\" [localStorageKey]=\"option.localStorageKey\"\r\n                                (searchHandle)=\"onSearch($event)\" (submitChange)=\"onSubmitChange($event)\" class=\"form-group farris-form-group\"></panel-filter-input>\r\n                        </div>\r\n                    </ng-container>\r\n                </div>\r\n\r\n            </div>\r\n            <div class=\"f-filter-panel-footer\" *ngIf=\"option.item && option.item.control.controltype != 'radio'\">\r\n                <div class=\"filer-panel-clear\">\r\n                    <button class=\"btn btn-link\" (click)=\"panelFilterClear()\"  [disabled]=\"!canClearSearch()\">{{ 'filterPanel.reset' | locale }}</button>\r\n                    <!-- tfs 549371 2023-03-24 -->\r\n                    <!-- <button class=\"btn btn-link btn-empty\" (click)=\"panelFilterempty()\">{{ 'filterPanel.empty' | locale }}</button> -->\r\n                </div>\r\n                <div class=\"filter-panel-btns\">\r\n                    <button class=\"btn btn-secondary\" (click)=\"panelFilterCancel($event)\">{{ 'filterPanel.cancel' | locale }}</button>\r\n                    <button class=\"filter-panel-submit btn btn-primary\" (click)=\"panelFilterSubmit()\" [disabled]=\"!canSubmit\">{{ 'filterPanel.confirm' | locale }}</button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>",
                encapsulation: ViewEncapsulation.None
            }] }
];
/** @nocollapse */
FilterPanelComponent.ctorParameters = () => [
    { type: Renderer2 },
    { type: ElementRef },
    { type: QuerySolutionService }
];
FilterPanelComponent.propDecorators = {
    option: [{ type: Input }],
    hide: [{ type: Input }],
    hidePanel: [{ type: Output }],
    submit: [{ type: Output }],
    filterSubmit: [{ type: Output }],
    clearFilter: [{ type: Output }],
    dataChange: [{ type: Output }],
    filterPanel: [{ type: ViewChild, args: ['filterPanel',] }],
    onMouseDown: [{ type: HostListener, args: ['mousedown', ['$event'],] }],
    onMouseMove: [{ type: HostListener, args: ['mousemove', ['$event'],] }]
};
if (false) {
    /**
     * @type {?}
     * @private
     */
    FilterPanelComponent.prototype.el;
    /** @type {?} */
    FilterPanelComponent.prototype.option;
    /** @type {?} */
    FilterPanelComponent.prototype._hide;
    /** @type {?} */
    FilterPanelComponent.prototype.hidePanel;
    /** @type {?} */
    FilterPanelComponent.prototype.submit;
    /** @type {?} */
    FilterPanelComponent.prototype.filterSubmit;
    /** @type {?} */
    FilterPanelComponent.prototype.clearFilter;
    /** @type {?} */
    FilterPanelComponent.prototype.dataChange;
    /** @type {?} */
    FilterPanelComponent.prototype.filterPanel;
    /** @type {?} */
    FilterPanelComponent.prototype.canSubmit;
    /** @type {?} */
    FilterPanelComponent.prototype.fiexedLeft;
    /**
     * @type {?}
     * @private
     */
    FilterPanelComponent.prototype.hasMove;
    /**
     * @type {?}
     * @private
     */
    FilterPanelComponent.prototype._documentMouseUpEvent;
    /** @type {?} */
    FilterPanelComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    FilterPanelComponent.prototype.idService;
    /**
     * @type {?}
     * @private
     */
    FilterPanelComponent.prototype.currentItem;
    /**
     * @type {?}
     * @private
     */
    FilterPanelComponent.prototype.isNil;
    /**
     * @type {?}
     * @private
     */
    FilterPanelComponent.prototype.renderer;
    /**
     * @type {?}
     * @private
     */
    FilterPanelComponent.prototype.elementRef;
    /**
     * @type {?}
     * @private
     */
    FilterPanelComponent.prototype.filterConditionSer;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsdGVyLXBhbmVsLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktZmlsdGVyLXBhbmVsLyIsInNvdXJjZXMiOlsibGliL2ZpbHRlci1wYW5lbC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsS0FBSyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsU0FBUyxFQUMxRCxVQUFVLEVBQUUsU0FBUyxFQUFFLGlCQUFpQixFQUFFLFlBQVksRUFBNEIsTUFBTSxlQUFlLENBQUM7QUFFaEgsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFDbkUsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLFNBQVMsQ0FBQztBQUNuQyxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDOUMsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLFdBQVcsQ0FBQzs7QUFPdEMsTUFBTSxPQUFPLG9CQUFvQjs7Ozs7O0lBeUI3QixZQUFvQixRQUFtQixFQUFVLFVBQXNCLEVBQVUsa0JBQXdDO1FBQXJHLGFBQVEsR0FBUixRQUFRLENBQVc7UUFBVSxlQUFVLEdBQVYsVUFBVSxDQUFZO1FBQVUsdUJBQWtCLEdBQWxCLGtCQUFrQixDQUFzQjtRQXRCekgsVUFBSyxHQUFHLEtBQUssQ0FBQztRQVFKLGNBQVMsR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBQy9CLFdBQU0sR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBQzVCLGlCQUFZLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUNsQyxnQkFBVyxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFDakMsZUFBVSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFFMUMsY0FBUyxHQUFHLEtBQUssQ0FBQztRQUNsQixlQUFVLEdBQUMsSUFBSSxDQUFDOztRQUVSLFlBQU8sR0FBRyxLQUFLLENBQUM7UUFD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MkNBQTJDOztJQUMzQywwQ0FBMEM7O0lBQzFDLDJDQUFrRDs7SUFDbEQseUNBQWtCOztJQUNsQiwwQ0FBZ0I7Ozs7O0lBRWhCLHVDQUF3Qjs7Ozs7SUFDeEIscURBQXFDOztJQUNyQyx3Q0FBUzs7Ozs7SUFDVCx5Q0FBNkI7Ozs7O0lBQzdCLDJDQUEyQjs7Ozs7SUFnTzNCLHFDQUErRTs7Ozs7SUEvTm5FLHdDQUEyQjs7Ozs7SUFBRSwwQ0FBOEI7Ozs7O0lBQUUsa0RBQWdEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIElucHV0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgUmVuZGVyZXIyLFxyXG4gICAgICAgIEVsZW1lbnRSZWYsIFZpZXdDaGlsZCwgVmlld0VuY2Fwc3VsYXRpb24sIEhvc3RMaXN0ZW5lciwgT25EZXN0cm95LCBBZnRlclZpZXdJbml0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEZpbHRlclBhbmVsT3B0aW9uIH0gZnJvbSAnLi9maWx0ZXItcGFuZWwuaW50ZXJmYWNlJztcclxuaW1wb3J0IHsgUXVlcnlTb2x1dGlvblNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWZpbHRlci1jb25kaXRpb24nO1xyXG5pbXBvcnQgeyBkZWVwQ29weSB9IGZyb20gJy4vdXRpbHMnO1xyXG5pbXBvcnQgeyBJZFNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWNvbW1vbic7XHJcbmltcG9ydCB7IGNsb25lRGVlcCB9IGZyb20gJ2xvZGFzaC1lcyc7XHJcbi8vIOeUqOS6juaYvuekuueCueWHuyDnroDljZXnrZvpgIkg6aG555qE5LiL5ouJ6Z2i5p2/XHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdmYXJyaXMtZmlsdGVyLXBhbmVsJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnLi9maWx0ZXItcGFuZWwuY29tcG9uZW50Lmh0bWwnLFxyXG4gICAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZVxyXG59KVxyXG5leHBvcnQgY2xhc3MgRmlsdGVyUGFuZWxDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSwgQWZ0ZXJWaWV3SW5pdCB7XHJcbiAgICBwcml2YXRlIGVsOiBIVE1MRWxlbWVudDtcclxuICAgIEBJbnB1dCgpIG9wdGlvbjogRmlsdGVyUGFuZWxPcHRpb247XHJcbiAgICBfaGlkZSA9IGZhbHNlO1xyXG4gICAgQElucHV0KClcclxuICAgIHNldCBoaWRlKHZhbCkge1xyXG4gICAgICAgIHRoaXMuX2hpZGUgPSB2YWw7XHJcbiAgICB9XHJcbiAgICBnZXQgaGlkZSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5faGlkZTtcclxuICAgIH1cclxuICAgIEBPdXRwdXQoKSBoaWRlUGFuZWwgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgICBAT3V0cHV0KCkgc3VibWl0ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gICAgQE91dHB1dCgpIGZpbHRlclN1Ym1pdCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIEBPdXRwdXQoKSBjbGVhckZpbHRlciA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIEBPdXRwdXQoKSBkYXRhQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gICAgQFZpZXdDaGlsZCgnZmlsdGVyUGFuZWwnKSBmaWx0ZXJQYW5lbDogRWxlbWVudFJlZjtcclxuICAgIGNhblN1Ym1pdCA9IGZhbHNlO1xyXG4gICAgZmlleGVkTGVmdD10cnVlO1xyXG4gICAgLy8g5YWo5bGA5qCH6K+G77yM5Yid5aeL5YyW5qCH6K+G5YWD57Sg5rKh5pyJ5Y+R55SfbW91c2Vtb3ZlXHJcbiAgICBwcml2YXRlIGhhc01vdmUgPSBmYWxzZTtcclxuICAgIHByaXZhdGUgX2RvY3VtZW50TW91c2VVcEV2ZW50ID0gbnVsbDtcclxuICAgIGluamVjdG9yO1xyXG4gICAgcHJpdmF0ZSBpZFNlcnZpY2U6IElkU2VydmljZTtcclxuICAgIHByaXZhdGUgY3VycmVudEl0ZW0gPSBudWxsO1xyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSByZW5kZXJlcjogUmVuZGVyZXIyLCBwcml2YXRlIGVsZW1lbnRSZWY6IEVsZW1lbnRSZWYsIHByaXZhdGUgZmlsdGVyQ29uZGl0aW9uU2VyOiBRdWVyeVNvbHV0aW9uU2VydmljZSkge1xyXG4gICAgICAgIHRoaXMuZWwgPSB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudDtcclxuICAgIH1cclxuICAgIG5nT25Jbml0KCkge1xyXG4gICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIHRoaXMuX2RvY3VtZW50TW91c2VVcEV2ZW50ID0gdGhpcy5yZW5kZXJlci5saXN0ZW4odGhpcy5maWx0ZXJQYW5lbC5uYXRpdmVFbGVtZW50LCAnbW91c2V1cCcsIChldmVudDogTW91c2VFdmVudCkgPT4ge1xyXG4gICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICAgICAgY29uc3QgdGFyOiBhbnkgPSBldmVudC50YXJnZXQ7XHJcbiAgICAgICAgICAgIGlmICh0YXIuY2xvc2VzdCgnI21haW5Db250YWluZXJUYWJzZXQnKSkge1xyXG4gICAgICAgICAgICAgICAgLy8gc2VsZi5oaWRlUGFuZWwuZW1pdChldmVudCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnBhbmVsRmlsdGVyQ2FuY2VsKGV2ZW50KTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuaGFzTW92ZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoIXRhci5jbG9zZXN0KCcuZi1maWx0ZXItcGFuZWwnKVxyXG4gICAgICAgICAgICAgICAgJiYgIXRhci5jbG9zZXN0KCcubW9kYWwnKVxyXG4gICAgICAgICAgICAgICAgJiYgIXRhci5jbG9zZXN0KCcub3ZlcmxheS1jb250YWluZXInKSAmJiAhdGFyLmNsb3Nlc3QoJy5vdmVybGF5LXBhbmUnKSkge1xyXG4gICAgICAgICAgICAgICAgLy8gc2VsZi5oaWRlUGFuZWwuZW1pdChldmVudCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnBhbmVsRmlsdGVyQ2FuY2VsKGV2ZW50KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5oYXNNb3ZlID0gZmFsc2U7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgaWYgKHRoaXMub3B0aW9uLml0ZW0gJiYgKHRoaXMub3B0aW9uLml0ZW0uY29udHJvbC5jb250cm9sdHlwZSA9PSAnZHJvcGRvd24nIHx8IHRoaXMub3B0aW9uLml0ZW0uY29udHJvbC5jb250cm9sdHlwZSA9PSAncmFkaW8nKSkge1xyXG4gICAgICAgICAgICB0aGlzLmNhblN1Ym1pdCA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKHRoaXMuaW5qZWN0b3IpIHtcclxuICAgICAgICAgICAgdGhpcy5pZFNlcnZpY2UgPSB0aGlzLmluamVjdG9yLmdldChJZFNlcnZpY2UpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5jdXJyZW50SXRlbSA9IGNsb25lRGVlcCh7dmFsdWU6IHsuLi50aGlzLm9wdGlvbi5pdGVtLnZhbHVlfSwgdHlwZTogdGhpcy5vcHRpb24uaXRlbS5jb250cm9sLmNvbnRyb2x0eXBlLCBpZDogdGhpcy5vcHRpb24uaXRlbS5pZH0pO1xyXG4gICAgfVxyXG5cclxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcclxuICAgICAgICBjb25zdCBfcGFuZWw6IGFueSA9IHRoaXMuZWwucXVlcnlTZWxlY3RvcignLmYtZmlsdGVyLXBhbmVsJyk7XHJcbiAgICAgICAgaWYgKF9wYW5lbCAmJiB0aGlzLm9wdGlvbi50YXJnZXQpIHtcclxuICAgICAgICAgICAgY29uc3QgaCA9IF9wYW5lbC5vZmZzZXRIZWlnaHQ7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlY3QgPSB0aGlzLm9wdGlvbi50YXJnZXQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcbiAgICAgICAgICAgIGlmICh3aW5kb3dbJ2lubmVySGVpZ2h0J10gLSB0aGlzLm9wdGlvbi50b3AgPCBoKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVjdC50b3AgPiBoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vcHRpb24udG9wID0gcmVjdC50b3AgLSBoIC0gMTQ7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMub3B0aW9uLnRvcCA9IDMyO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY29uc3QgYXJyb3c6IGFueSA9IHRoaXMuZWwucXVlcnlTZWxlY3RvcignLmYtZmlsdGVyLXBhbmVsLWFycm93Jyk7XHJcbiAgICAgICAgICAgICAgICBpZiAoYXJyb3cpIHtcclxuICAgICAgICAgICAgICAgICAgICBhcnJvdy5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKF9wYW5lbCYmdGhpcy5vcHRpb24ucmlnaHQpe1xyXG4gICAgICAgICAgICBpZih0aGlzLm9wdGlvbi5sZWZ0K19wYW5lbC5vZmZzZXRXaWR0aD53aW5kb3dbJ2lubmVyV2lkdGgnXSl7XHJcbiAgICAgICAgICAgICAgICAvLyDotoXlh7rmmL7npLrlnKjlgZpcclxuICAgICAgICAgICAgICAgIHRoaXMuZmlleGVkTGVmdD1mYWxzZTtcclxuICAgICAgICAgICAgICAgIHRoaXMub3B0aW9uLmxlZnQ9dGhpcy5vcHRpb24ucmlnaHQtX3BhbmVsLm9mZnNldFdpZHRoO1xyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgIHRoaXMuZmlleGVkTGVmdD10cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG5nT25EZXN0cm95KCkge1xyXG4gICAgICAgIGlmICh0aGlzLl9kb2N1bWVudE1vdXNlVXBFdmVudCkge1xyXG4gICAgICAgICAgICB0aGlzLl9kb2N1bWVudE1vdXNlVXBFdmVudCgpO1xyXG4gICAgICAgICAgICB0aGlzLl9kb2N1bWVudE1vdXNlVXBFdmVudCA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcbiAgICBASG9zdExpc3RlbmVyKCdtb3VzZWRvd24nLCBbJyRldmVudCddKVxyXG4gICAgb25Nb3VzZURvd24oJGV2ZW50KSB7XHJcbiAgICAgICAgdGhpcy5oYXNNb3ZlID0gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgQEhvc3RMaXN0ZW5lcignbW91c2Vtb3ZlJywgWyckZXZlbnQnXSlcclxuICAgIG9uTW91c2VNb3ZlKCRldmVudCkge1xyXG4gICAgICAgIHRoaXMuaGFzTW92ZSA9IHRydWU7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIG9uU2VhcmNoKGV2ZW50KSB7XHJcbiAgICAgICAgaWYgKHRoaXMub3B0aW9uLml0ZW0uY29udHJvbC5jb250cm9sdHlwZSA9PSAncmFkaW8nKSB7XHJcbiAgICAgICAgICAgIHRoaXMucGFuZWxGaWx0ZXJTdWJtaXQoKTtcclxuICAgICAgICB9ZWxzZSBpZih0aGlzLm9wdGlvbi5pdGVtLmNvbnRyb2wuY29udHJvbHR5cGUgPT0gJ3RleHQnICYmICBldmVudFsndHlwZSddICYmIGV2ZW50Wyd0eXBlJ10gPT09ICdlbnRlcicpe1xyXG4gICAgICAgICAgICB0aGlzLnBhbmVsRmlsdGVyU3VibWl0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIHRoaXMuZmlsdGVySXRlbSA9IGV2ZW50O1xyXG4gICAgfVxyXG5cclxuICAgIHBhbmVsRmlsdGVyQ2FuY2VsKCRldmVudCkge1xyXG4gICAgICAgIC8vICRldmVudC5faW5zdGFuY2VJZCA9IHRoaXMuaWQ7XHJcbiAgICAgICAgdGhpcy5oaWRlUGFuZWwuZW1pdCgkZXZlbnQpO1xyXG4gICAgfVxyXG4gICAgcGFuZWxGaWx0ZXJTdWJtaXQoY2xlYXI6IGJvb2xlYW4gPSBmYWxzZSkge1xyXG4gICAgICAgIGlmICghY2xlYXIgJiYgIXRoaXMuY2FuU3VibWl0KSB7cmV0dXJuOyB9XHJcbiAgICAgICAgaWYgKHRoaXMub3B0aW9uLml0ZW0uY29udHJvbC5jb250cm9sdHlwZSA9PT0gJ3RleHQnKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGZhcnJpc1NlYXJjaFJlY29yZCA9IHRoaXMub3B0aW9uLml0ZW0udmFsdWVUZXh0O1xyXG4gICAgICAgICAgICBsZXQgZmFycmlzU2VhcmNoUmVjb3JkQXJyYXkgPSBbXTtcclxuICAgICAgICAgICAgY29uc3Qgc3RvcmFnZWxhYmVsQ29kZSA9IHRoaXMub3B0aW9uLml0ZW0ubGFiZWxDb2RlO1xyXG4gICAgICAgICAgICBsZXQgZmlsdGVyUGFuZWxBcnJheSA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0odGhpcy5vcHRpb24ubG9jYWxTdG9yYWdlS2V5KSk7XHJcbiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGZpbHRlclBhbmVsQXJyYXkpKSB7XHJcbiAgICAgICAgICAgICAgICBmaWx0ZXJQYW5lbEFycmF5ID0gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIWZpbHRlclBhbmVsQXJyYXkgfHwgIWZpbHRlclBhbmVsQXJyYXlbc3RvcmFnZWxhYmVsQ29kZV0gfHwgIWZpbHRlclBhbmVsQXJyYXlbc3RvcmFnZWxhYmVsQ29kZV0ubGVuZ3RoXHJcbiAgICAgICAgICAgICAgICAgICAgJiYgZmFycmlzU2VhcmNoUmVjb3JkICYmIGZhcnJpc1NlYXJjaFJlY29yZC5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIGZhcnJpc1NlYXJjaFJlY29yZEFycmF5LnB1c2goZmFycmlzU2VhcmNoUmVjb3JkKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGZhcnJpc1NlYXJjaFJlY29yZEFycmF5ID0gZmlsdGVyUGFuZWxBcnJheVtzdG9yYWdlbGFiZWxDb2RlXTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gZmlsdGVyUGFuZWxBcnJheVtzdG9yYWdlbGFiZWxDb2RlXS5pbmRleE9mKGZhcnJpc1NlYXJjaFJlY29yZCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPCAwICYmIGZhcnJpc1NlYXJjaFJlY29yZCAmJiBmYXJyaXNTZWFyY2hSZWNvcmQubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZmFycmlzU2VhcmNoUmVjb3JkQXJyYXkudW5zaGlmdChmYXJyaXNTZWFyY2hSZWNvcmQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZmFycmlzU2VhcmNoUmVjb3JkQXJyYXkgPSBmYXJyaXNTZWFyY2hSZWNvcmRBcnJheS5zbGljZSgwLCA2KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoZmlsdGVyUGFuZWxBcnJheSA9PSBudWxsKSB7IGZpbHRlclBhbmVsQXJyYXkgPSB7fTsgfVxyXG4gICAgICAgICAgICBmaWx0ZXJQYW5lbEFycmF5W3N0b3JhZ2VsYWJlbENvZGVdID0gZmFycmlzU2VhcmNoUmVjb3JkQXJyYXk7XHJcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKHRoaXMub3B0aW9uLmxvY2FsU3RvcmFnZUtleSwgSlNPTi5zdHJpbmdpZnkoZmlsdGVyUGFuZWxBcnJheSkpO1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGNvbmRpdGlvbnMgPSB0aGlzLmZpbHRlckNvbmRpdGlvblNlci5zZXRGaWx0ZXJDb25kaXRpb25zKHRoaXMub3B0aW9uLml0ZW0pO1xyXG4gICAgICAgIGlmICghY2xlYXIpIHtcclxuICAgICAgICAgICAgdGhpcy5maWx0ZXJTdWJtaXQuZW1pdCh7XHJcbiAgICAgICAgICAgICAgICBpdGVtOiB0aGlzLm9wdGlvbi5pdGVtLFxyXG4gICAgICAgICAgICAgICAgZmlsdGVyOiBjb25kaXRpb25zXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnN1Ym1pdC5lbWl0KHRoaXMub3B0aW9uLml0ZW0pO1xyXG4gICAgfVxyXG5cclxuICAgIHBhbmVsRmlsdGVyQ2xlYXIoKSB7XHJcbiAgICAgICAgdGhpcy5wYW5lbEZpbHRlcmVtcHR5KCk7XHJcbiAgICAgICAgdGhpcy5wYW5lbEZpbHRlclN1Ym1pdCh0cnVlKTtcclxuICAgICAgICB0aGlzLmNsZWFyRmlsdGVyLmVtaXQodGhpcy5vcHRpb24uaXRlbSk7XHJcbiAgICB9XHJcbiAgICBwYW5lbEZpbHRlcmVtcHR5KCkge1xyXG4gICAgICAgIHRoaXMuZmlsdGVyQ2xlYXJWYWx1ZSh0aGlzLm9wdGlvbi5pdGVtKTtcclxuICAgICAgICB0aGlzLm9wdGlvbi5pdGVtLnZhbHVlVGV4dCA9ICcnO1xyXG4gICAgICAgIHRoaXMub3B0aW9uLml0ZW0uZmlsbGVkID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5vcHRpb24uaXRlbSA9IGRlZXBDb3B5KHRoaXMub3B0aW9uLml0ZW0pO1xyXG4gICAgICAgIHRoaXMuY2FuU3VibWl0ID0gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgZmlsdGVyQ2xlYXJWYWx1ZShpdGVtKSB7XHJcbiAgICAgICAgc3dpdGNoIChpdGVtLmNvbnRyb2wuY29udHJvbHR5cGUpIHtcclxuICAgICAgICAgICAgY2FzZSAndGV4dCc6XHJcbiAgICAgICAgICAgIGNhc2UgJ3NlYXJjaCc6XHJcbiAgICAgICAgICAgIGNhc2UgJ3NpbmdsZURhdGUnOlxyXG4gICAgICAgICAgICBjYXNlICd5ZWFyJzpcclxuICAgICAgICAgICAgY2FzZSAnbW9udGgnOlxyXG4gICAgICAgICAgICBjYXNlICdkcm9wZG93bic6XHJcbiAgICAgICAgICAgIGNhc2UgJ3NpbmdsZW51bWJlcic6XHJcbiAgICAgICAgICAgIGNhc2UgJ3JhZGlvJzpcclxuICAgICAgICAgICAgICAgIGl0ZW0udmFsdWUudmFsdWUgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ2RhdGUnOlxyXG4gICAgICAgICAgICBjYXNlICdkYXRldGltZSc6XHJcbiAgICAgICAgICAgIGNhc2UgJ21vbnRoUmFuZ2UnOlxyXG4gICAgICAgICAgICBjYXNlICd5ZWFyUmFuZ2UnOlxyXG4gICAgICAgICAgICAgICAgaXRlbS52YWx1ZS5zdGFydFRpbWUgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgaXRlbS52YWx1ZS5lbmRUaW1lID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICdudW1iZXInOlxyXG4gICAgICAgICAgICAgICAgaXRlbS52YWx1ZS5zdGFydFZhbHVlID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIGl0ZW0udmFsdWUuZW5kVmFsdWUgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ2hlbHAnOlxyXG4gICAgICAgICAgICAgICAgaXRlbS52YWx1ZS52YWx1ZSA9IFtdO1xyXG4gICAgICAgICAgICAgICAgaXRlbS52YWx1ZS52YWx1ZUZpZWxkID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIGl0ZW0udmFsdWUudGV4dFZhbHVlID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICdjaGVja2JveGdyb3VwJzpcclxuICAgICAgICAgICAgY2FzZSAnYm9vbC1jaGVjayc6XHJcbiAgICAgICAgICAgICAgICBpdGVtLnZhbHVlLnZhbHVlID0gW107XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnaW5wdXQtZ3JvdXAnOlxyXG4gICAgICAgICAgICAgICAgaXRlbS52YWx1ZS52YWx1ZSA9IFtdO1xyXG4gICAgICAgICAgICAgICAgaXRlbS52YWx1ZS50ZXh0VmFsdWUgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgaXRlbS52YWx1ZS50ZXh0RmllbGQgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgaXRlbS52YWx1ZS5pc0lucHV0VGV4dCA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnZmxleGlibGVOdW1iZXInOlxyXG4gICAgICAgICAgICBjYXNlICdmbGV4aWJsZURhdGUnOlxyXG4gICAgICAgICAgICAgICAgaXRlbS52YWx1ZS5zdGFydFZhbHVlID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIGl0ZW0udmFsdWUuZW5kVmFsdWUgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgaXRlbS52YWx1ZS52YWx1ZSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICBpdGVtLnZhbHVlLnZhbHVlID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBvblN1Ym1pdENoYW5nZShldmVudCkge1xyXG4gICAgICAgIHRoaXMuY2FuU3VibWl0ID0gZXZlbnQ7XHJcbiAgICB9XHJcblxyXG4gICAgYnVpbGRTbWFydEhlbHBLZXkodmFsdWU6IHN0cmluZykge1xyXG4gICAgICAgIGlmKHRoaXMuaWRTZXJ2aWNlKSB7XHJcbiAgICAgICAgICAgIGxldCBwcmVmaXggPSAnJztcclxuICAgICAgICAgICAgaWYgKGxvY2F0aW9uLmhhc2gpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHBhdGhBcnIgPSBsb2NhdGlvbi5oYXNoLnNwbGl0KCc/Jyk7XHJcbiAgICAgICAgICAgICAgICBwcmVmaXggPSBwYXRoQXJyID8gcGF0aEFyclswXSA6ICcnO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcGF0aEFyciAgPSBsb2NhdGlvbi5wYXRobmFtZS5zcGxpdCgnLycpO1xyXG4gICAgICAgICAgICAgICAgcHJlZml4ID0gcGF0aEFyciA/IHBhdGhBcnJbcGF0aEFyci5sZW5ndGggLSAxXSA6ICcnO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmlkU2VydmljZS5lbmNyeXB0KHByZWZpeCArICcvbGlzdC1maWx0ZXIvJyArIHZhbHVlKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gJ2xpc3QtZmlsdGVyLycgKyB2YWx1ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdXBkYXRlQ3VycmVudEl0ZW0oJGV2ZW50KSB7XHJcbiAgICAgICAgdGhpcy5jdXJyZW50SXRlbSA9IGNsb25lRGVlcCh7dmFsdWU6IHsuLi4kZXZlbnQudmFsdWV9LCB0eXBlOiAkZXZlbnQuY29udHJvbC5jb250cm9sdHlwZSwgaWQ6ICRldmVudC5pZH0pO1xyXG4gICAgICAgIHRoaXMuZGF0YUNoYW5nZS5lbWl0KHRoaXMuY3VycmVudEl0ZW0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgaXNOaWwgPSAodmFsOiBhbnkpID0+IHZhbCA9PT0gbnVsbCAgfHwgdmFsID09PSB1bmRlZmluZWQgfHwgdmFsID09PSAnJztcclxuXHJcbiAgICBjYW5DbGVhclNlYXJjaCgpIHtcclxuICAgICAgICBjb25zdCBpdGVtID0gdGhpcy5jdXJyZW50SXRlbTtcclxuICAgICAgICBpZiAoIWl0ZW0pIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHN3aXRjaCAoaXRlbS50eXBlKSB7XHJcbiAgICAgICAgICAgIGNhc2UgJ3RleHQnOlxyXG4gICAgICAgICAgICBjYXNlICdzZWFyY2gnOlxyXG4gICAgICAgICAgICBjYXNlICdzaW5nbGVEYXRlJzpcclxuICAgICAgICAgICAgY2FzZSAneWVhcic6XHJcbiAgICAgICAgICAgIGNhc2UgJ21vbnRoJzpcclxuICAgICAgICAgICAgY2FzZSAnZHJvcGRvd24nOlxyXG4gICAgICAgICAgICBjYXNlICdzaW5nbGVudW1iZXInOlxyXG4gICAgICAgICAgICBjYXNlICdyYWRpbyc6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gIXRoaXMuaXNOaWwoaXRlbS52YWx1ZS52YWx1ZSk7XHJcbiAgICAgICAgICAgIGNhc2UgJ2RhdGUnOlxyXG4gICAgICAgICAgICBjYXNlICdkYXRldGltZSc6XHJcbiAgICAgICAgICAgIGNhc2UgJ21vbnRoUmFuZ2UnOlxyXG4gICAgICAgICAgICBjYXNlICd5ZWFyUmFuZ2UnOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuICF0aGlzLmlzTmlsKGl0ZW0udmFsdWUuc3RhcnRUaW1lKSB8fCAhdGhpcy5pc05pbChpdGVtLnZhbHVlLmVuZFRpbWUpO1xyXG4gICAgICAgICAgICBjYXNlICdoZWxwJzpcclxuICAgICAgICAgICAgY2FzZSAnY2hlY2tib3hncm91cCc6XHJcbiAgICAgICAgICAgIGNhc2UgJ2Jvb2wtY2hlY2snOlxyXG4gICAgICAgICAgICBjYXNlICdpbnB1dC1ncm91cCc6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaXRlbS52YWx1ZS52YWx1ZSAmJiBpdGVtLnZhbHVlLnZhbHVlLmxlbmd0aDtcclxuICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcclxuICAgICAgICAgICAgY2FzZSAnZmxleGlibGVOdW1iZXInOlxyXG4gICAgICAgICAgICBjYXNlICdmbGV4aWJsZURhdGUnOlxyXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0udmFsdWUuc2luZ2xlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICF0aGlzLmlzTmlsKGl0ZW0udmFsdWUudmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuICF0aGlzLmlzTmlsKGl0ZW0udmFsdWUuc3RhcnRWYWx1ZSkgfHwgIXRoaXMuaXNOaWwoaXRlbS52YWx1ZS5lbmRWYWx1ZSk7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gIXRoaXMuaXNOaWwoaXRlbS52YWx1ZS52YWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiJdfQ==