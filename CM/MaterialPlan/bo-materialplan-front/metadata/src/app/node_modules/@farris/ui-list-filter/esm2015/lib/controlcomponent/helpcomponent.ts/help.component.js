/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, HostBinding, Output, EventEmitter } from '@angular/core';
import { ControlType } from '../../entity/controltype';
import { SolutionService } from '../../service/solution.service';
// import { ServerSideToken } from '@farris/ui-lookup';
// import { LookupHttpBeQueryService } from './service/Lookup-http.service';
import { of } from 'rxjs';
export class HelpComponent {
    /**
     * @param {?} solutionService
     */
    constructor(solutionService) {
        this.solutionService = solutionService;
        this.searchHandle = new EventEmitter();
        /**
         * 判断是否是在扩展区域展示
         */
        this.extend = false;
        /**
         * 判断是否显示label
         */
        this.showlabel = true;
        /**
         * 某个字段发生值变化事件时，需要同步清空的字段，可能不是当前字段
         */
        this.changeFields = [];
        this.onSearch = (/**
         * @return {?}
         */
        () => {
            if (this.disabled) {
                return;
            }
            this.searchHandle.emit();
            return of(true);
        });
    }
    /**
     * @return {?}
     */
    get isExtend() {
        return !this.extend && this.autoLabel;
    }
    /**
     * @return {?}
     */
    get hidenLabel() {
        return !this.showlabel;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        if (this.item) {
            /** @type {?} */
            const type = Object.prototype.toString.call(this.item.placeHolder);
            if (type == '[object Undefined]') {
                if (this.item.control && this.item.control.hasOwnProperty('placeholder')) {
                    this.placeholder = this.item.control.placeholder;
                }
            }
            else {
                this.placeholder = this.item.placeHolder;
            }
        }
        this.getHelpBindingInfo();
        if (this.item && this.item.control && this.item.control.hasOwnProperty('isExtend')) {
            this.extend = this.item.control.isExtend;
            if (!this.extend) {
                this.showlabel = this.item.control.showLabel;
            }
        }
        this.solutionService.addFilterEditorInstance(this.item.fieldCode, this);
        ((/** @type {?} */ (this.item.value))).clear$.subscribe((/**
         * @return {?}
         */
        () => {
            this.textValue = '';
        }));
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        this.getHelpBindingInfo();
        if (changes['changeFields'] && changes['changeFields'].currentValue && !changes['changeFields'].firstChange) {
            /** @type {?} */
            const isChange = changes['changeFields'].currentValue.some((/**
             * @param {?} field
             * @return {?}
             */
            field => field == this.item.fieldCode));
            if (isChange) {
                this.textValue = ((/** @type {?} */ (this.item.value))).textValue;
            }
        }
    }
    /**
     * @param {?} selectedItem
     * @return {?}
     */
    selectedDataHandler(selectedItem) {
        // console.log(selectedItem);
        //    let mapFields=new Function('return'+(this.item.control as HelpContol).mapFields);
        //    let mapFieldsKeys=Object.keys(mapFields());
        //    (this.item.value as HelpValue).value=new Object();
        //    mapFieldsKeys.forEach(mapFeildKey => {
        //     (this.item.value as HelpValue).value[mapFeildKey]=selectedItem[mapFeildKey];
        //    });
        //    (this.item.value as HelpValue).valueField=(this.item.control as HelpContol).valueField;
        //    let textField=(this.item.control as HelpContol).textField;
        //    this.textValue=(this.item.value as HelpValue).value[textField];
        // console.log(selectedItem);
        //    let mapFields=new Function('return'+(this.item.control as HelpContol).mapFields);
        //    let mapFieldsKeys=Object.keys(mapFields());
        //    (this.item.value as HelpValue).value=new Object();
        //    mapFieldsKeys.forEach(mapFeildKey => {
        //     (this.item.value as HelpValue).value[mapFeildKey]=selectedItem[mapFeildKey];
        //    });
        //    (this.item.value as HelpValue).valueField=(this.item.control as HelpContol).valueField;
        //    let textField=(this.item.control as HelpContol).textField;
        //    this.textValue=(this.item.value as HelpValue).value[textField];
        /** @type {?} */
        const helpValue = ((/** @type {?} */ (this.item.value)));
        helpValue.value = this.singleSelect ? [selectedItem] : selectedItem; // 单选返回对象，多选返回数组
        helpValue.valueField = this.valueField;
        helpValue.textValue = helpValue.getTextValue(this.textField);
        this.textValue = helpValue.textValue;
        // this.conditionChange.emit();
        if (this.disabled) {
            return;
        }
        this.searchHandle.emit();
    }
    /**
     * @return {?}
     */
    getHelpBindingInfo() {
        if (this.item && this.item.control && this.item.control.getControlType() == ControlType.Help) {
            /** @type {?} */
            const helpList = ((/** @type {?} */ (this.item.control)));
            this.uri = helpList.uri;
            this.textField = helpList.textField;
            this.valueField = helpList.valueField;
            this.idField = helpList.idField;
            this.mapFields = helpList.mapFields;
            this.context = helpList.context;
            if (helpList.preEventCmd) {
                this.preEventCmd = (/**
                 * @param {?} e
                 * @return {?}
                 */
                (e) => {
                    e['hostRef'] = this.hostRef;
                    return helpList.preEventCmd(e);
                });
            }
            if (helpList.postEventCmd) {
                this.postEventCmd = (/**
                 * @param {?} e
                 * @return {?}
                 */
                (e) => {
                    e['hostRef'] = this.hostRef;
                    return helpList.postEventCmd(e);
                });
            }
            this.singleSelect = helpList.singleSelect;
            this.enableFullTree = helpList.enableFullTree;
            this.loadTreeDataType = helpList.loadTreeDataType;
            this.expandLevel = helpList.expandLevel;
            this.enableCascade = helpList.enableCascade;
            this.helpId = helpList.helpId;
            this.title = helpList.title;
            /** @type {?} */
            const helpValue = ((/** @type {?} */ (this.item.value)));
            this.clearFields = helpList.clearFields;
            // if (helpValue && helpValue.value) {
            //     // this.textValue = (this.item.value as HelpValue).value[this.textField];
            //     this.textValue = HelpValue.getPropValue(helpValue.value, this.textField.split('.'));
            // }
            this.displayType = helpList.displayType;
            if (helpValue.textValue == 'help-text-value-null') { // 旧数据兼容
                this.textValue = helpValue.getTextValue(this.textField);
            }
            else {
                this.textValue = helpValue.textValue;
            }
        }
    }
    // getConditionItemStyle(field: QueryCondition, controlType: any) {
    //     return this.solutionService.getConditionItemStyle(field,controlType);
    // }
    /**
     * @param {?} field
     * @return {?}
     */
    getConditionItemTitle(field) {
        return this.solutionService.getConditionItemTitle(field);
    }
    /**
     * @param {?} data
     * @return {?}
     */
    clearData(data) {
        ((/** @type {?} */ (this.item.value))).clearValue();
        this.searchHandle.emit();
    }
}
HelpComponent.decorators = [
    { type: Component, args: [{
                selector: 'app-filter-help',
                template: "<label class=\"col-form-label\" *ngIf=\"item && showlabel\" title=\"{{getConditionItemTitle(item)}}\">\r\n    <span class=\"farris-label-info text-danger\" *ngIf=\"item.control.required\">*</span>\r\n    <span class=\"farris-label-text\">{{item.fieldName}}</span>\r\n</label>\r\n<div class=\"farris-input-wrap\" *ngIf=\"item\">\r\n    <farris-lookup-grid  \r\n        [uri]=\"uri\"\r\n        [title]=\"title\"\r\n        [idField]=\"idField\" \r\n        [textField]=\"textField\" \r\n        [valueField]=\"valueField\" \r\n        [(ngModel)]=\"textValue\"\r\n        [displayType]=\"displayType\"\r\n        [editable]=\"false\"\r\n        [readonly]=\"disabled\"\r\n        (clear)=\"clearData($event)\"\r\n        (selectedData)=\"selectedDataHandler($event)\"\r\n        [placeholder]=\"placeholder\"\r\n        [mapFields]=\"mapFields\"\r\n        [dictPicking]=\"preEventCmd\"\r\n        [dictPicked]=\"postEventCmd\"\r\n        [context]=\"context\"\r\n        [enableFullTree]=\"enableFullTree\"\r\n        [loadTreeDataType]=\"loadTreeDataType\"\r\n        [singleSelect]=\"singleSelect\"\r\n        [expandLevel]=\"expandLevel\"\r\n        [enableCascade]=\"enableCascade\"\r\n        [clear-fields]=\"clearFields\"\r\n    >\r\n    </farris-lookup-grid>\r\n\r\n    <!-- [dictPicked]=\"onSearch\" -->\r\n    <!-- (selectedData)=\"selectedDataHandler($event)\" -->\r\n</div>"
                // providers: [{ provide: ServerSideToken, useClass: LookupHttpBeQueryService }]
            }] }
];
/** @nocollapse */
HelpComponent.ctorParameters = () => [
    { type: SolutionService }
];
HelpComponent.propDecorators = {
    item: [{ type: Input }],
    autoLabel: [{ type: Input }],
    disabled: [{ type: Input }],
    hostRef: [{ type: Input }],
    searchHandle: [{ type: Output }],
    isExtend: [{ type: HostBinding, args: ['class.filter-item-wrap',] }],
    hidenLabel: [{ type: HostBinding, args: ['class.filter-item-hiddenlabel',] }],
    changeFields: [{ type: Input }]
};
if (false) {
    /**
     * QueryCondition类型
     * @type {?}
     */
    HelpComponent.prototype.item;
    /** @type {?} */
    HelpComponent.prototype.autoLabel;
    /** @type {?} */
    HelpComponent.prototype.disabled;
    /** @type {?} */
    HelpComponent.prototype.hostRef;
    /** @type {?} */
    HelpComponent.prototype.searchHandle;
    /** @type {?} */
    HelpComponent.prototype.uri;
    /** @type {?} */
    HelpComponent.prototype.textField;
    /** @type {?} */
    HelpComponent.prototype.idField;
    /** @type {?} */
    HelpComponent.prototype.valueField;
    /** @type {?} */
    HelpComponent.prototype.textValue;
    /** @type {?} */
    HelpComponent.prototype.displayType;
    /** @type {?} */
    HelpComponent.prototype.mapFields;
    /** @type {?} */
    HelpComponent.prototype.context;
    /** @type {?} */
    HelpComponent.prototype.preEventCmd;
    /** @type {?} */
    HelpComponent.prototype.postEventCmd;
    /** @type {?} */
    HelpComponent.prototype.enableFullTree;
    /** @type {?} */
    HelpComponent.prototype.loadTreeDataType;
    /** @type {?} */
    HelpComponent.prototype.singleSelect;
    /** @type {?} */
    HelpComponent.prototype.expandLevel;
    /** @type {?} */
    HelpComponent.prototype.enableCascade;
    /** @type {?} */
    HelpComponent.prototype.helpId;
    /** @type {?} */
    HelpComponent.prototype.title;
    /**
     * 判断是否是在扩展区域展示
     * @type {?}
     */
    HelpComponent.prototype.extend;
    /**
     * 判断是否显示label
     * @type {?}
     */
    HelpComponent.prototype.showlabel;
    /** @type {?} */
    HelpComponent.prototype.placeholder;
    /**
     * 某个字段发生值变化事件时，需要同步清空的字段，可能不是当前字段
     * @type {?}
     */
    HelpComponent.prototype.changeFields;
    /**
     * 要清空的关联字段
     * @type {?}
     */
    HelpComponent.prototype.clearFields;
    /** @type {?} */
    HelpComponent.prototype.onSearch;
    /**
     * @type {?}
     * @private
     */
    HelpComponent.prototype.solutionService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGVscC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWxpc3QtZmlsdGVyLyIsInNvdXJjZXMiOlsibGliL2NvbnRyb2xjb21wb25lbnQvaGVscGNvbXBvbmVudC50cy9oZWxwLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQXFCLFdBQVcsRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUFpQixNQUFNLGVBQWUsQ0FBQztBQUV0SCxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFHdkQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLGdDQUFnQyxDQUFDOzs7QUFNakUsT0FBTyxFQUFFLEVBQUUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQVExQixNQUFNLE9BQU8sYUFBYTs7OztJQXFEdEIsWUFBb0IsZUFBZ0M7UUFBaEMsb0JBQWUsR0FBZixlQUFlLENBQWlCO1FBMUMxQyxpQkFBWSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7Ozs7UUFxQjVDLFdBQU0sR0FBRyxLQUFLLENBQUM7Ozs7UUFFZixjQUFTLEdBQUcsSUFBSSxDQUFDOzs7O1FBY1IsaUJBQVksR0FBa0IsRUFBRSxDQUFDO1FBd0gxQyxhQUFROzs7UUFBRyxHQUFHLEVBQUU7WUFDWixJQUFJLElBQUksQ0FBQyxRQUFRLEVBQUU7Z0JBQUUsT0FBTzthQUFFO1lBQzlCLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDekIsT0FBTyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDcEIsQ0FBQyxFQUFBO0lBdkh1RCxDQUFDOzs7O0lBaEJ6RCxJQUNJLFFBQVE7UUFDUixPQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDO0lBQzFDLENBQUM7Ozs7SUFDRCxJQUNJLFVBQVU7UUFDVixPQUFPLENBQUMsSUFBSSxDQUFDLFNB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LGlDQUlDOzs7OztJQXZIVyx3Q0FBd0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBPbkluaXQsIE9uQ2hhbmdlcywgSG9zdEJpbmRpbmcsIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBTaW1wbGVDaGFuZ2VzIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFF1ZXJ5Q29uZGl0aW9uIH0gZnJvbSAnLi4vLi4vZW50aXR5L3F1ZXJ5Y29uZGl0aW9uJztcclxuaW1wb3J0IHsgQ29udHJvbFR5cGUgfSBmcm9tICcuLi8uLi9lbnRpdHkvY29udHJvbHR5cGUnO1xyXG5pbXBvcnQgeyBIZWxwQ29udG9sIH0gZnJvbSAnLi4vLi4vZW50aXR5L2NvbnRyb2x0eXBlL2hlbHAvaGVscGNvbnRyb2wnO1xyXG5pbXBvcnQgeyBJQ29udHJvbCB9IGZyb20gJy4uLy4uL2VudGl0eS9jb250cm9sdHlwZS9pY29udHJvbCc7XHJcbmltcG9ydCB7IFNvbHV0aW9uU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2Uvc29sdXRpb24uc2VydmljZSc7XHJcbmltcG9ydCB7IEhlbHBWYWx1ZSB9IGZyb20gJy4uLy4uL2VudGl0eS9jb25kaXRpb252YWx1ZS9oZWxwdmFsdWUnO1xyXG5pbXBvcnQgeyBEaXNwbGF5VHlwZSB9IGZyb20gJy4uLy4uL2VudGl0eS9jb250cm9sdHlwZS9oZWxwL2Rpc3BsYXlUeXBlJztcclxuXHJcbi8vIGltcG9ydCB7IFNlcnZlclNpZGVUb2tlbiB9IGZyb20gJ0BmYXJyaXMvdWktbG9va3VwJztcclxuLy8gaW1wb3J0IHsgTG9va3VwSHR0cEJlUXVlcnlTZXJ2aWNlIH0gZnJvbSAnLi9zZXJ2aWNlL0xvb2t1cC1odHRwLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBvZiB9IGZyb20gJ3J4anMnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ2FwcC1maWx0ZXItaGVscCcsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vaGVscC5jb21wb25lbnQuaHRtbCdcclxuICAgIC8vIHByb3ZpZGVyczogW3sgcHJvdmlkZTogU2VydmVyU2lkZVRva2VuLCB1c2VDbGFzczogTG9va3VwSHR0cEJlUXVlcnlTZXJ2aWNlIH1dXHJcbn0pXHJcblxyXG5leHBvcnQgY2xhc3MgSGVscENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzIHtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFF1ZXJ5Q29uZGl0aW9u57G75Z6LXHJcbiAgICAgKi9cclxuICAgIEBJbnB1dCgpIGl0ZW06IGFueTtcclxuICAgIEBJbnB1dCgpIGF1dG9MYWJlbDogYm9vbGVhbjtcclxuICAgIEBJbnB1dCgpIGRpc2FibGVkOiBib29sZWFuO1xyXG5cclxuICAgIEBJbnB1dCgpIGhvc3RSZWY6IGFueTtcclxuXHJcbiAgICBAT3V0cHV0KCkgc2VhcmNoSGFuZGxlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG5cclxuICAgIHVyaTogc3RyaW5nO1xyXG4gICAgdGV4dEZpZWxkOiBzdHJpbmc7XHJcbiAgICBpZEZpZWxkOiBzdHJpbmc7XHJcbiAgICB2YWx1ZUZpZWxkOiBhbnk7XHJcbiAgICB0ZXh0VmFsdWU6IGFueTtcclxuICAgIGRpc3BsYXlUeXBlOiBEaXNwbGF5VHlwZTtcclxuICAgIG1hcEZpZWxkczogYW55O1xyXG4gICAgY29udGV4dDogYW55O1xyXG4gICAgcHJlRXZlbnRDbWQ6IGFueTtcclxuICAgIHBvc3RFdmVudENtZDogYW55O1xyXG4gICAgZW5hYmxlRnVsbFRyZWU6IGJvb2xlYW47XHJcbiAgICBsb2FkVHJlZURhdGFUeXBlOiAnZGVmYXVsdCcgfCAnbG9hZGFsbCcgfCAnbGF5ZXJsb2FkJztcclxuICAgIHNpbmdsZVNlbGVjdDogYm9vbGVhbjtcclxuICAgIGV4cGFuZExldmVsOiBudW1iZXI7XHJcbiAgICBlbmFibGVDYXNjYWRlOiBib29sZWFuO1xyXG4gICAgaGVscElkOiBzdHJpbmc7XHJcbiAgICB0aXRsZTogc3RyaW5nO1xyXG5cclxuICAgIC8qKiDliKTmlq3mmK/lkKbmmK/lnKjmianlsZXljLrln5/lsZXnpLogKi9cclxuICAgIGV4dGVuZCA9IGZhbHNlO1xyXG4gICAgLyoqIOWIpOaWreaYr+WQpuaYvuekumxhYmVsICovXHJcbiAgICBzaG93bGFiZWwgPSB0cnVlO1xyXG4gICAgcGxhY2Vob2xkZXI6IHN0cmluZztcclxuXHJcbiAgICBASG9zdEJpbmRpbmcoJ2NsYXNzLmZpbHRlci1pdGVtLXdyYXAnKVxyXG4gICAgZ2V0IGlzRXh0ZW5kKCk6IGJvb2xlYW4ge1xyXG4gICAgICAgIHJldHVybiAhdGhpcy5leHRlbmQgJiYgdGhpcy5hdXRvTGFiZWw7XHJcbiAgICB9XHJcbiAgICBASG9zdEJpbmRpbmcoJ2NsYXNzLmZpbHRlci1pdGVtLWhpZGRlbmxhYmVsJylcclxuICAgIGdldCBoaWRlbkxhYmVsKCk6IGJvb2xlYW4ge1xyXG4gICAgICAgIHJldHVybiAhdGhpcy5zaG93bGFiZWw7XHJcbiAgICB9XHJcbiAgICAgIC8qKlxyXG4gICAgICog5p+Q5Liq5a2X5q615Y+R55Sf5YC85Y+Y5YyW5LqL5Lu25pe277yM6ZyA6KaB5ZCM5q2l5riF56m655qE5a2X5q6177yM5Y+v6IO95LiN5piv5b2T5YmN5a2X5q61XHJcbiAgICAgKi9cclxuICAgIEBJbnB1dCgpIGNoYW5nZUZpZWxkczogQXJyYXk8c3RyaW5nPiA9IFtdO1xyXG4gICAgLyoqXHJcbiAgICAgKiDopoHmuIXnqbrnmoTlhbPogZTlrZfmrrVcclxuICAgICAqL1xyXG4gICAgY2xlYXJGaWVsZHM6IHN0cmluZztcclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgc29sdXRpb25TZXJ2aWNlOiBTb2x1dGlvblNlcnZpY2UpIHsgfVxyXG5cclxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgICAgIGlmICh0aGlzLml0ZW0pIHtcclxuICAgICAgICAgICAgY29uc3QgdHlwZSA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh0aGlzLml0ZW0ucGxhY2VIb2xkZXIpO1xyXG4gICAgICAgICAgICBpZiAodHlwZSA9PSAnW29iamVjdCBVbmRlZmluZWRdJykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaXRlbS5jb250cm9sICYmIHRoaXMuaXRlbS5jb250cm9sLmhhc093blByb3BlcnR5KCdwbGFjZWhvbGRlcicpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbGFjZWhvbGRlciA9IHRoaXMuaXRlbS5jb250cm9sLnBsYWNlaG9sZGVyO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wbGFjZWhvbGRlciA9IHRoaXMuaXRlbS5wbGFjZUhvbGRlcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmdldEhlbHBCaW5kaW5nSW5mbygpO1xyXG4gICAgICAgIGlmICh0aGlzLml0ZW0gJiYgdGhpcy5pdGVtLmNvbnRyb2wgJiYgdGhpcy5pdGVtLmNvbnRyb2wuaGFzT3duUHJvcGVydHkoJ2lzRXh0ZW5kJykpIHtcclxuICAgICAgICAgICAgdGhpcy5leHRlbmQgPSB0aGlzLml0ZW0uY29udHJvbC5pc0V4dGVuZDtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLmV4dGVuZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zaG93bGFiZWwgPSB0aGlzLml0ZW0uY29udHJvbC5zaG93TGFiZWw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuc29sdXRpb25TZXJ2aWNlLmFkZEZpbHRlckVkaXRvckluc3RhbmNlKHRoaXMuaXRlbS5maWVsZENvZGUsIHRoaXMpO1xyXG5cclxuICAgICAgICAodGhpcy5pdGVtLnZhbHVlIGFzIEhlbHBWYWx1ZSkuY2xlYXIkLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMudGV4dFZhbHVlID0gJyc7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgXHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuZ2V0SGVscEJpbmRpbmdJbmZvKCk7XHJcbiAgICAgICAgaWYoY2hhbmdlc1snY2hhbmdlRmllbGRzJ10gJiYgY2hhbmdlc1snY2hhbmdlRmllbGRzJ10uY3VycmVudFZhbHVlICYmICFjaGFuZ2VzWydjaGFuZ2VGaWVsZHMnXS5maXJzdENoYW5nZSkge1xyXG4gICAgICAgICAgICBjb25zdCBpc0NoYW5nZSA9IGNoYW5nZXNbJ2NoYW5nZUZpZWxkcyddLmN1cnJlbnRWYWx1ZS5zb21lKGZpZWxkID0+IGZpZWxkID09IHRoaXMuaXRlbS5maWVsZENvZGUpO1xyXG4gICAgICAgICAgICBpZihpc0NoYW5nZSl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRleHRWYWx1ZSA9ICh0aGlzLml0ZW0udmFsdWUgYXMgSGVscFZhbHVlKS50ZXh0VmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc2VsZWN0ZWREYXRhSGFuZGxlcihzZWxlY3RlZEl0ZW06IGFueSkge1xyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKHNlbGVjdGVkSXRlbSk7XHJcbiAgICAgICAgLy8gICAgbGV0IG1hcEZpZWxkcz1uZXcgRnVuY3Rpb24oJ3JldHVybicrKHRoaXMuaXRlbS5jb250cm9sIGFzIEhlbHBDb250b2wpLm1hcEZpZWxkcyk7XHJcbiAgICAgICAgLy8gICAgbGV0IG1hcEZpZWxkc0tleXM9T2JqZWN0LmtleXMobWFwRmllbGRzKCkpO1xyXG4gICAgICAgIC8vICAgICh0aGlzLml0ZW0udmFsdWUgYXMgSGVscFZhbHVlKS52YWx1ZT1uZXcgT2JqZWN0KCk7XHJcbiAgICAgICAgLy8gICAgbWFwRmllbGRzS2V5cy5mb3JFYWNoKG1hcEZlaWxkS2V5ID0+IHtcclxuICAgICAgICAvLyAgICAgKHRoaXMuaXRlbS52YWx1ZSBhcyBIZWxwVmFsdWUpLnZhbHVlW21hcEZlaWxkS2V5XT1zZWxlY3RlZEl0ZW1bbWFwRmVpbGRLZXldO1xyXG4gICAgICAgIC8vICAgIH0pO1xyXG4gICAgICAgIC8vICAgICh0aGlzLml0ZW0udmFsdWUgYXMgSGVscFZhbHVlKS52YWx1ZUZpZWxkPSh0aGlzLml0ZW0uY29udHJvbCBhcyBIZWxwQ29udG9sKS52YWx1ZUZpZWxkO1xyXG4gICAgICAgIC8vICAgIGxldCB0ZXh0RmllbGQ9KHRoaXMuaXRlbS5jb250cm9sIGFzIEhlbHBDb250b2wpLnRleHRGaWVsZDtcclxuICAgICAgICAvLyAgICB0aGlzLnRleHRWYWx1ZT0odGhpcy5pdGVtLnZhbHVlIGFzIEhlbHBWYWx1ZSkudmFsdWVbdGV4dEZpZWxkXTtcclxuXHJcbiAgICAgICAgY29uc3QgaGVscFZhbHVlID0gKHRoaXMuaXRlbS52YWx1ZSBhcyBIZWxwVmFsdWUpO1xyXG4gICAgICAgIGhlbHBWYWx1ZS52YWx1ZSA9IHRoaXMuc2luZ2xlU2VsZWN0ID8gW3NlbGVjdGVkSXRlbV0gOiBzZWxlY3RlZEl0ZW07IC8vIOWNlemAiei/lOWbnuWvueixoe+8jOWkmumAiei/lOWbnuaVsOe7hFxyXG4gICAgICAgIGhlbHBWYWx1ZS52YWx1ZUZpZWxkID0gdGhpcy52YWx1ZUZpZWxkO1xyXG4gICAgICAgIGhlbHBWYWx1ZS50ZXh0VmFsdWUgPSBoZWxwVmFsdWUuZ2V0VGV4dFZhbHVlKHRoaXMudGV4dEZpZWxkKTtcclxuICAgICAgICB0aGlzLnRleHRWYWx1ZSA9IGhlbHBWYWx1ZS50ZXh0VmFsdWU7XHJcbiAgICAgICAgLy8gdGhpcy5jb25kaXRpb25DaGFuZ2UuZW1pdCgpO1xyXG4gICAgICAgIGlmICh0aGlzLmRpc2FibGVkKSB7IHJldHVybjsgfVxyXG4gICAgICAgIHRoaXMuc2VhcmNoSGFuZGxlLmVtaXQoKTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgZ2V0SGVscEJpbmRpbmdJbmZvKCkge1xyXG4gICAgICAgIGlmICh0aGlzLml0ZW0gJiYgdGhpcy5pdGVtLmNvbnRyb2wgJiYgdGhpcy5pdGVtLmNvbnRyb2wuZ2V0Q29udHJvbFR5cGUoKSA9PSBDb250cm9sVHlwZS5IZWxwKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGhlbHBMaXN0ID0gKHRoaXMuaXRlbS5jb250cm9sIGFzIEhlbHBDb250b2wpO1xyXG4gICAgICAgICAgICB0aGlzLnVyaSA9IGhlbHBMaXN0LnVyaTtcclxuICAgICAgICAgICAgdGhpcy50ZXh0RmllbGQgPSBoZWxwTGlzdC50ZXh0RmllbGQ7XHJcbiAgICAgICAgICAgIHRoaXMudmFsdWVGaWVsZCA9IGhlbHBMaXN0LnZhbHVlRmllbGQ7XHJcbiAgICAgICAgICAgIHRoaXMuaWRGaWVsZCA9IGhlbHBMaXN0LmlkRmllbGQ7XHJcbiAgICAgICAgICAgIHRoaXMubWFwRmllbGRzID0gaGVscExpc3QubWFwRmllbGRzO1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRleHQgPSBoZWxwTGlzdC5jb250ZXh0O1xyXG4gICAgICAgICAgICBpZiAoaGVscExpc3QucHJlRXZlbnRDbWQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucHJlRXZlbnRDbWQgPSAoZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGVbJ2hvc3RSZWYnXSA9IHRoaXMuaG9zdFJlZjtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaGVscExpc3QucHJlRXZlbnRDbWQoZSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoaGVscExpc3QucG9zdEV2ZW50Q21kKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnBvc3RFdmVudENtZCA9IChlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZVsnaG9zdFJlZiddID0gdGhpcy5ob3N0UmVmO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBoZWxwTGlzdC5wb3N0RXZlbnRDbWQoZSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuc2luZ2xlU2VsZWN0ID0gaGVscExpc3Quc2luZ2xlU2VsZWN0O1xyXG4gICAgICAgICAgICB0aGlzLmVuYWJsZUZ1bGxUcmVlID0gaGVscExpc3QuZW5hYmxlRnVsbFRyZWU7XHJcbiAgICAgICAgICAgIHRoaXMubG9hZFRyZWVEYXRhVHlwZSA9IGhlbHBMaXN0LmxvYWRUcmVlRGF0YVR5cGU7XHJcbiAgICAgICAgICAgIHRoaXMuZXhwYW5kTGV2ZWwgPSBoZWxwTGlzdC5leHBhbmRMZXZlbDtcclxuICAgICAgICAgICAgdGhpcy5lbmFibGVDYXNjYWRlID0gaGVscExpc3QuZW5hYmxlQ2FzY2FkZTtcclxuICAgICAgICAgICAgdGhpcy5oZWxwSWQgPSBoZWxwTGlzdC5oZWxwSWQ7XHJcbiAgICAgICAgICAgIHRoaXMudGl0bGUgPSBoZWxwTGlzdC50aXRsZTtcclxuICAgICAgICAgICAgY29uc3QgaGVscFZhbHVlID0gKHRoaXMuaXRlbS52YWx1ZSBhcyBIZWxwVmFsdWUpO1xyXG4gICAgICAgICAgICB0aGlzLmNsZWFyRmllbGRzID0gaGVscExpc3QuY2xlYXJGaWVsZHM7XHJcbiAgICAgICAgICAgIC8vIGlmIChoZWxwVmFsdWUgJiYgaGVscFZhbHVlLnZhbHVlKSB7XHJcbiAgICAgICAgICAgIC8vICAgICAvLyB0aGlzLnRleHRWYWx1ZSA9ICh0aGlzLml0ZW0udmFsdWUgYXMgSGVscFZhbHVlKS52YWx1ZVt0aGlzLnRleHRGaWVsZF07XHJcbiAgICAgICAgICAgIC8vICAgICB0aGlzLnRleHRWYWx1ZSA9IEhlbHBWYWx1ZS5nZXRQcm9wVmFsdWUoaGVscFZhbHVlLnZhbHVlLCB0aGlzLnRleHRGaWVsZC5zcGxpdCgnLicpKTtcclxuICAgICAgICAgICAgLy8gfVxyXG4gICAgICAgICAgICB0aGlzLmRpc3BsYXlUeXBlID0gaGVscExpc3QuZGlzcGxheVR5cGU7XHJcbiAgICAgICAgICAgIGlmIChoZWxwVmFsdWUudGV4dFZhbHVlID09ICdoZWxwLXRleHQtdmFsdWUtbnVsbCcpIHsvLyDml6fmlbDmja7lhbzlrrlcclxuICAgICAgICAgICAgICAgIHRoaXMudGV4dFZhbHVlID0gaGVscFZhbHVlLmdldFRleHRWYWx1ZSh0aGlzLnRleHRGaWVsZCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRleHRWYWx1ZSA9IGhlbHBWYWx1ZS50ZXh0VmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIGdldENvbmRpdGlvbkl0ZW1TdHlsZShmaWVsZDogUXVlcnlDb25kaXRpb24sIGNvbnRyb2xUeXBlOiBhbnkpIHtcclxuICAgIC8vICAgICByZXR1cm4gdGhpcy5zb2x1dGlvblNlcnZpY2UuZ2V0Q29uZGl0aW9uSXRlbVN0eWxlKGZpZWxkLGNvbnRyb2xUeXBlKTtcclxuICAgIC8vIH1cclxuXHJcbiAgICBnZXRDb25kaXRpb25JdGVtVGl0bGUoZmllbGQ6IFF1ZXJ5Q29uZGl0aW9uKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc29sdXRpb25TZXJ2aWNlLmdldENvbmRpdGlvbkl0ZW1UaXRsZShmaWVsZCk7XHJcbiAgICB9XHJcblxyXG4gICAgb25TZWFyY2ggPSAoKSA9PiB7XHJcbiAgICAgICAgaWYgKHRoaXMuZGlzYWJsZWQpIHsgcmV0dXJuOyB9XHJcbiAgICAgICAgdGhpcy5zZWFyY2hIYW5kbGUuZW1pdCgpO1xyXG4gICAgICAgIHJldHVybiBvZih0cnVlKTtcclxuICAgIH1cclxuXHJcbiAgICBjbGVhckRhdGEoZGF0YTogYW55KSB7XHJcbiAgICAgICAgKHRoaXMuaXRlbS52YWx1ZSBhcyBIZWxwVmFsdWUpLmNsZWFyVmFsdWUoKTtcclxuICAgICAgICB0aGlzLnNlYXJjaEhhbmRsZS5lbWl0KCk7XHJcbiAgICB9XHJcblxyXG59XHJcbiJdfQ==