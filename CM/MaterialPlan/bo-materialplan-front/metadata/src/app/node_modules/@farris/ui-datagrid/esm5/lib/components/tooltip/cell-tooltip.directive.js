/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { DatagridComponent } from './../../datagrid.component';
import { Utils } from './../../utils/utils';
import { Input, ElementRef, Directive, Injector, NgZone, Renderer2 } from '@angular/core';
import { CommonUtils } from '@farris/ui-common';
import { DomHandler } from '../../services/domhandler';
var DatagridCellTooltipDirective = /** @class */ (function () {
    function DatagridCellTooltipDirective(el, injector) {
        this.el = el;
        this.injector = injector;
        this.position = 'top-left';
        this.delay = 1000;
        this.cls = '';
        this.type = 'info';
        this.tipMode = 'auto';
        this.showTipTimer = null;
        this._mouseenter = null;
        this._mouseleave = null;
        this._mouseclick = null;
        this.ngZone = null;
        this.render = null;
        if (this.injector) {
            this.commonUtils = this.injector.get(CommonUtils, new CommonUtils());
            this.ngZone = this.injector.get(NgZone);
            this.render = this.injector.get(Renderer2);
            this.dg = this.injector.get(DatagridComponent);
        }
        else {
            this.commonUtils = new CommonUtils();
        }
    }
    /**
     * @return {?}
     */
    DatagridCellTooltipDirective.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.ngZone) {
            this.ngZone.runOutsideAngular((/**
             * @return {?}
             */
            function () {
                _this._mouseenter = Utils.on(_this.el.nativeElement, 'mouseenter', _this.onMouseEnter.bind(_this), { target: '.f-datagrid-cell-content', options: { capture: true } });
                _this._mouseleave = Utils.on(_this.el.nativeElement, 'mouseleave', _this.onMouseLeave.bind(_this), { target: '.f-datagrid-cell-content', options: { capture: true } });
                _this._mouseclick = Utils.on(_this.el.nativeElement, 'mousedown', _this.onClick.bind(_this));
            }));
        }
    };
    /**
     * @return {?}
     */
    DatagridCellTooltipDirective.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.hide();
        if (this._mouseenter) {
            this._mouseenter();
        }
        if (this._mouseleave) {
            this._mouseleave();
        }
        if (this._mouseclick) {
            this._mouseclick();
        }
        // this.dg = null;
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    DatagridCellTooltipDirective.prototype.onMouseEnter = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        var _this = this;
        if ($event.fromElement) {
            if (!$event.fromElement.closest('.f-datagrid')) {
                return;
            }
        }
        /** @type {?} */
        var cellTiptimer = this.dg ? this.dg.cellTipTimer : 1000;
        if (this.showTipTimer) {
            clearTimeout(this.showTipTimer);
            this.showTipTimer = null;
        }
        this.showTipTimer = setTimeout((/**
         * @return {?}
         */
        function () {
            _this.show($event);
        }), cellTiptimer);
    };
    /**
     * @return {?}
     */
    DatagridCellTooltipDirective.prototype.onMouseLeave = /**
     * @return {?}
     */
    function () {
        this.hide();
    };
    /**
     * @param {?} e
     * @return {?}
     */
    DatagridCellTooltipDirective.prototype.onClick = /**
     * @param {?} e
     * @return {?}
     */
    function (e) {
        // e.stopPropagation();
        this.hide();
    };
    /**
     * @private
     * @return {?}
     */
    DatagridCellTooltipDirective.prototype.getTextContainer = /**
     * @private
     * @return {?}
     */
    function () {
        return DomHandler.findSingle(this.container, '.f-tooltip-text');
    };
    /**
     * @private
     * @param {?} target
     * @return {?}
     */
    DatagridCellTooltipDirective.prototype.donotShowTips = /**
     * @private
     * @param {?} target
     * @return {?}
     */
    function (target) {
        /** @type {?} */
        var tdWidth = target.offsetWidth;
        /** @type {?} */
        var tagetSty = window.getComputedStyle(target);
        /** @type {?} */
        var txtWidth = this.commonUtils.getTextWidth(this.message, tagetSty.font);
        var paddingLeft = tagetSty.paddingLeft, paddingRight = tagetSty.paddingRight;
        /** @type {?} */
        var _width = tdWidth - (Number(paddingLeft.replace('px', '')) || 0) - (Number(paddingRight.replace('px', '')) || 0);
        /** @type {?} */
        var tr = target.closest('tr');
        if (tr) {
            /** @type {?} */
            var trId = tr.id;
            tr = document.querySelector('#' + trId);
        }
        if (this.tipMode === 'auto') {
            if (tr) {
                return _width && _width > txtWidth;
            }
            return true;
        }
        else {
            return tr ? false : true;
        }
    };
    /**
     * @return {?}
     */
    DatagridCellTooltipDirective.prototype.hide = /**
     * @return {?}
     */
    function () {
        if (this.showTipTimer) {
            clearTimeout(this.showTipTimer);
            this.showTipTimer = null;
        }
        if (this.container && this.container.parentElement) {
            document.body.removeChild(this.container);
        }
        this.container = null;
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    DatagridCellTooltipDirective.prototype.show = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        /** @type {?} */
        var cellEl = (/** @type {?} */ ($event.target));
        this.enable = cellEl.getAttribute('cell-tooltip') === 'true';
        this.message = cellEl.getAttribute('message');
        this.tipMode = cellEl.getAttribute('tipMode') || 'auto';
        if (!this.enable || !this.message) {
            return;
        }
        /** @type {?} */
        var tipWidth = cellEl.getAttribute('tipWidth');
        /** @type {?} */
        var tipHeight = cellEl.getAttribute('tipHeight');
        this.position = cellEl.getAttribute('position') || 'top-left';
        // 检查下内容宽度是否超出列宽
        if (this.donotShowTips($event.target)) {
            return;
        }
        // const boxEl = this.el.nativeElement;
        /** @type {?} */
        var boxEl = $event.target;
        /** @type {?} */
        var elSize = this.getBoxSizeObj(boxEl);
        /** 如果存在则不新建，只需要修改里面的内容 */
        if (!this.container) {
            this.create(elSize);
        }
        else {
            DomHandler.findSingle(this.container, '.f-tooltip-text').innerHTML = this.message;
        }
        this.container.style.maxWidth = window.innerWidth - 30 + "px";
        this.container.style.minWidth = '35px';
        if (tipWidth) {
            this.container.style.width = tipWidth;
        }
        if (tipHeight) {
            this.container.style.height = tipHeight;
        }
        /** @type {?} */
        var offset = DomHandler.getOffset(boxEl);
        /** @type {?} */
        var targetTop = offset.top;
        /** @type {?} */
        var targetLeft = offset.left;
        /** @type {?} */
        var left;
        /** @type {?} */
        var top;
        this.container.style.display = 'block';
        this.changeTooltipPosition(boxEl);
        /** @type {?} */
        var arrow = DomHandler.findSingle(this.container, '.f-tooltip-arrow');
        /** @type {?} */
        var tooltipSize = this.getTooltipSize();
        // 检查内容高度
        if (window.innerHeight - 10 < tooltipSize.height) {
            this.container.style.height = window.innerHeight - 20 + "px";
            tooltipSize.height = window.innerHeight - 25;
            /** @type {?} */
            var textContainer = this.getTextContainer();
            textContainer.style.height = tooltipSize.height + "px";
            textContainer.style.overflow = 'hidden';
        }
        /** @type {?} */
        var n = this.updateArrowPosition(arrow, offset, $event);
        switch (this.position) {
            case 'right':
                left = targetLeft + elSize.width;
                top = n;
                break;
            case 'left':
                left = targetLeft - tooltipSize.width;
                top = n;
                break;
            case 'top-left':
                top = targetTop - tooltipSize.height - 7;
                left = n;
                break;
        }
        if (left) {
            this.container.style.left = left + 'px';
        }
        this.container.style.top = top + 'px';
        this.container.style.zIndex = 999999;
    };
    /**
     * @private
     * @param {?} arrow
     * @param {?} elOffset
     * @param {?} $event
     * @return {?}
     */
    DatagridCellTooltipDirective.prototype.updateArrowPosition = /**
     * @private
     * @param {?} arrow
     * @param {?} elOffset
     * @param {?} $event
     * @return {?}
     */
    function (arrow, elOffset, $event) {
        /** @type {?} */
        var tooltipSize = this.getTooltipSize();
        if (this.position === 'left' || this.position === 'right') {
            /** @type {?} */
            var targetTop = elOffset.top;
            /** @type {?} */
            var halfHeight = tooltipSize.height / 2;
            /** @type {?} */
            var top_1 = 10;
            if (targetTop > halfHeight && window.innerHeight - targetTop > halfHeight) {
                top_1 = targetTop - tooltipSize.height / 2;
            }
            // 调整箭头的位置
            if (arrow) {
                arrow.style.top = targetTop - top_1 + "px";
            }
            return top_1;
        }
        else if (this.position === 'top-left') {
            /** @type {?} */
            var left = $event.pageX - tooltipSize.width / 2;
            if (left < 10) {
                left = elOffset.left;
            }
            if (left + tooltipSize.width > window.innerWidth) {
                left = window.innerWidth - tooltipSize.width - 20;
            }
            // 调整箭头的位置
            if (arrow) {
                if ($event.pageX - left > 28) {
                    if ($event.pageX - left + 28 > tooltipSize.width) {
                        arrow.style.left = tooltipSize.width - 28 + "px";
                    }
                    else {
                        arrow.style.left = $event.pageX - left + "px";
                    }
                }
            }
            return left;
        }
    };
    /**
     * @param {?} elSize
     * @return {?}
     */
    DatagridCellTooltipDirective.prototype.create = /**
     * @param {?} elSize
     * @return {?}
     */
    function (elSize) {
        /** @type {?} */
        var styleClass = this.tooltipCls();
        this.container = document.createElement('div');
        if (this.tooltipStyleClass) {
            styleClass += ' ' + this.tooltipStyleClass;
        }
        this.container.className = styleClass;
        /** @type {?} */
        var tooltipArrow = document.createElement('div');
        tooltipArrow.className = 'f-tooltip-arrow ';
        this.container.appendChild(tooltipArrow);
        /** @type {?} */
        var tooltipText = document.createElement('div');
        tooltipText.className = 'f-tooltip-text ';
        tooltipText.innerHTML = this.message;
        /** @type {?} */
        var maxWidth = window.innerWidth - 50;
        tooltipText.style.maxWidth = maxWidth + "px";
        tooltipText.style.wordBreak = 'break-all';
        this.container.style.textAlign = 'center';
        if (this.positionStyle) {
            this.container.style.position = this.positionStyle;
        }
        this.container.appendChild(tooltipText);
        document.body.appendChild(this.container);
    };
    /**
     * @private
     * @return {?}
     */
    DatagridCellTooltipDirective.prototype.tooltipCls = /**
     * @private
     * @return {?}
     */
    function () {
        return 'datagrid-cell-tooltip f-tooltip ' + this.getThemeCls() + ' f-tooltip-' + this.position + ' ' + this.cls;
    };
    /**
     * @private
     * @return {?}
     */
    DatagridCellTooltipDirective.prototype.getThemeCls = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.type) {
            return 'f-tooltip-' + this.type;
        }
        return '';
    };
    /** 获取宿主尺寸 */
    /**
     * 获取宿主尺寸
     * @private
     * @param {?} boxEl
     * @return {?}
     */
    DatagridCellTooltipDirective.prototype.getBoxSizeObj = /**
     * 获取宿主尺寸
     * @private
     * @param {?} boxEl
     * @return {?}
     */
    function (boxEl) {
        /** @type {?} */
        var p = boxEl.getBoundingClientRect();
        return {
            width: DomHandler.getOuterWidth(boxEl),
            height: DomHandler.getOuterHeight(boxEl),
            left: p.left,
            right: p.right,
            top: p.top,
            bottom: p.bottom
        };
    };
    /** 获取tooltip 容器尺寸 */
    /**
     * 获取tooltip 容器尺寸
     * @private
     * @return {?}
     */
    DatagridCellTooltipDirective.prototype.getTooltipSize = /**
     * 获取tooltip 容器尺寸
     * @private
     * @return {?}
     */
    function () {
        return {
            width: DomHandler.getOuterWidth(this.container),
            height: DomHandler.getOuterHeight(this.container)
        };
    };
    /** 获取窗口尺寸 */
    /**
     * 获取窗口尺寸
     * @private
     * @return {?}
     */
    DatagridCellTooltipDirective.prototype.getWindowSize = /**
     * 获取窗口尺寸
     * @private
     * @return {?}
     */
    function () {
        return {
            width: window.innerWidth,
            height: window.innerHeight
        };
    };
    /** 根据内容的多少，自动更改tooltip 的位置 */
    /**
     * 根据内容的多少，自动更改tooltip 的位置
     * @private
     * @param {?} boxEl
     * @return {?}
     */
    DatagridCellTooltipDirective.prototype.changeTooltipPosition = /**
     * 根据内容的多少，自动更改tooltip 的位置
     * @private
     * @param {?} boxEl
     * @return {?}
     */
    function (boxEl) {
        /** @type {?} */
        var boxSize = this.getBoxSizeObj(boxEl);
        /** @type {?} */
        var tooltip = this.getTooltipSize();
        /** @type {?} */
        var winSize = this.getWindowSize();
        this.container.className = this.tooltipCls();
        if (tooltip.width < winSize.width && tooltip.height < boxSize.top) {
            // this.position = 'top-left';
            return;
        }
        else {
            /** @type {?} */
            var elOffset = DomHandler.getOffset(boxEl);
            /** @type {?} */
            var elLeft = elOffset.left;
            /** @type {?} */
            var elRight = winSize.width - elLeft - boxSize.width;
            if (elLeft > elRight) {
                this.position = 'left';
            }
            else {
                this.position = 'right';
            }
            /** @type {?} */
            var toolTipTextWidth = elLeft > elRight ? elLeft : elRight;
            /** @type {?} */
            var textEl = this.getTextContainer();
            textEl.style.maxWidth = toolTipTextWidth - 30 + "px";
            this.container.style.maxWidth = toolTipTextWidth + "px";
        }
    };
    DatagridCellTooltipDirective.decorators = [
        { type: Directive, args: [{
                    selector: '[cell-tooltip]',
                    exportAs: 'cellTooltip'
                },] }
    ];
    /** @nocollapse */
    DatagridCellTooltipDirective.ctorParameters = function () { return [
        { type: ElementRef },
        { type: Injector }
    ]; };
    DatagridCellTooltipDirective.propDecorators = {
        enable: [{ type: Input, args: ['cell-tooltip',] }],
        position: [{ type: Input }],
        positionStyle: [{ type: Input }],
        tooltipStyleClass: [{ type: Input }],
        message: [{ type: Input }],
        delay: [{ type: Input }],
        cls: [{ type: Input }],
        type: [{ type: Input }],
        tipMode: [{ type: Input }]
    };
    return DatagridCellTooltipDirective;
}());
export { DatagridCellTooltipDirective };
if (false) {
    /** @type {?} */
    DatagridCellTooltipDirective.prototype.enable;
    /** @type {?} */
    DatagridCellTooltipDirective.prototype.position;
    /** @type {?} */
    DatagridCellTooltipDirective.prototype.positionStyle;
    /** @type {?} */
    DatagridCellTooltipDirective.prototype.tooltipStyleClass;
    /** @type {?} */
    DatagridCellTooltipDirective.prototype.message;
    /** @type {?} */
    DatagridCellTooltipDirective.prototype.delay;
    /** @type {?} */
    DatagridCellTooltipDirective.prototype.cls;
    /** @type {?} */
    DatagridCellTooltipDirective.prototype.type;
    /** @type {?} */
    DatagridCellTooltipDirective.prototype.tipMode;
    /** @type {?} */
    DatagridCellTooltipDirective.prototype.container;
    /**
     * @type {?}
     * @private
     */
    DatagridCellTooltipDirective.prototype.commonUtils;
    /**
     * @type {?}
     * @private
     */
    DatagridCellTooltipDirective.prototype.showTipTimer;
    /**
     * @type {?}
     * @private
     */
    DatagridCellTooltipDirective.prototype._mouseenter;
    /**
     * @type {?}
     * @private
     */
    DatagridCellTooltipDirective.prototype._mouseleave;
    /**
     * @type {?}
     * @private
     */
    DatagridCellTooltipDirective.prototype._mouseclick;
    /**
     * @type {?}
     * @private
     */
    DatagridCellTooltipDirective.prototype.ngZone;
    /**
     * @type {?}
     * @private
     */
    DatagridCellTooltipDirective.prototype.render;
    /**
     * @type {?}
     * @private
     */
    DatagridCellTooltipDirective.prototype.dg;
    /**
     * @type {?}
     * @private
     */
    DatagridCellTooltipDirective.prototype.el;
    /**
     * @type {?}
     * @private
     */
    DatagridCellTooltipDirective.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2VsbC10b29sdGlwLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktZGF0YWdyaWQvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy90b29sdGlwL2NlbGwtdG9vbHRpcC5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBQy9ELE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUM1QyxPQUFPLEVBQWEsS0FBSyxFQUFnQixVQUFVLEVBQUUsU0FBUyxFQUFFLFFBQVEsRUFBVSxNQUFNLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNILE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNoRCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFFdkQ7SUE2Qkksc0NBQW9CLEVBQWMsRUFBVSxRQUFrQjtRQUExQyxPQUFFLEdBQUYsRUFBRSxDQUFZO1FBQVUsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQXZCckQsYUFBUSxHQUFrRixVQUFVLENBQUM7UUFJckcsVUFBSyxHQUFHLElBQUksQ0FBQztRQUViLFFBQUcsR0FBRyxFQUFFLENBQUM7UUFDVCxTQUFJLEdBQThDLE1BQU0sQ0FBQztRQUN6RCxZQUFPLEdBQXVCLE1BQU0sQ0FBQztRQU10QyxpQkFBWSxHQUFHLElBQUksQ0FBQztRQUdwQixnQkFBVyxHQUFHLElBQUksQ0FBQztRQUNuQixnQkFBVyxHQUFHLElBQUksQ0FBQztRQUNuQixnQkFBVyxHQUFHLElBQUksQ0FBQztRQUNuQixXQUFNLEdBQVcsSUFBSSxDQUFDO1FBQ3RCLFdBQU0sR0FBYyxJQUFJLENBQUM7UUFHN0IsSUFBSSxJQUFJLENBQUMsUUFBUSxFQUFFO1lBQ2YsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEdB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O0lBQ25DLCtDQUF5Qjs7SUFDekIsNkNBQXNCOztJQUV0QiwyQ0FBa0I7O0lBQ2xCLDRDQUFrRTs7SUFDbEUsK0NBQThDOztJQUk5QyxpREFBZTs7Ozs7SUFDZixtREFBaUM7Ozs7O0lBQ2pDLG9EQUE0Qjs7Ozs7SUFHNUIsbURBQTJCOzs7OztJQUMzQixtREFBMkI7Ozs7O0lBQzNCLG1EQUEyQjs7Ozs7SUFDM0IsOENBQThCOzs7OztJQUM5Qiw4Q0FBaUM7Ozs7O0lBQ2pDLDBDQUE4Qjs7Ozs7SUFDbEIsMENBQXNCOzs7OztJQUFFLGdEQUEwQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERhdGFncmlkQ29tcG9uZW50IH0gZnJvbSAnLi8uLi8uLi9kYXRhZ3JpZC5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBVdGlscyB9IGZyb20gJy4vLi4vLi4vdXRpbHMvdXRpbHMnO1xyXG5pbXBvcnQgeyBPbkRlc3Ryb3ksIElucHV0LCBIb3N0TGlzdGVuZXIsIEVsZW1lbnRSZWYsIERpcmVjdGl2ZSwgSW5qZWN0b3IsIE9uSW5pdCwgTmdab25lLCBSZW5kZXJlcjIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgQ29tbW9uVXRpbHMgfSBmcm9tICdAZmFycmlzL3VpLWNvbW1vbic7XHJcbmltcG9ydCB7IERvbUhhbmRsZXIgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9kb21oYW5kbGVyJztcclxuXHJcbkBEaXJlY3RpdmUoe1xyXG4gICAgc2VsZWN0b3I6ICdbY2VsbC10b29sdGlwXScsXHJcbiAgICBleHBvcnRBczogJ2NlbGxUb29sdGlwJ1xyXG59KVxyXG5leHBvcnQgY2xhc3MgRGF0YWdyaWRDZWxsVG9vbHRpcERpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95IHtcclxuICAgIEBJbnB1dCgnY2VsbC10b29sdGlwJykgZW5hYmxlOiBib29sZWFuO1xyXG4gICAgQElucHV0KCkgcG9zaXRpb246ICd0b3AnIHwgJ2JvdHRvbScgfCAnbGVmdCcgfCAncmlnaHQnIHwgJ3RvcC1sZWZ0JyB8ICd0b3AtY2VudGVyJyB8ICd0b3AtcmlnaHQnID0gJ3RvcC1sZWZ0JztcclxuICAgIEBJbnB1dCgpIHBvc2l0aW9uU3R5bGU6IHN0cmluZztcclxuICAgIEBJbnB1dCgpIHRvb2x0aXBTdHlsZUNsYXNzOiBzdHJpbmc7XHJcbiAgICBASW5wdXQoKSBtZXNzYWdlOiBzdHJpbmc7XHJcbiAgICBASW5wdXQoKSBkZWxheSA9IDEwMDA7XHJcblxyXG4gICAgQElucHV0KCkgY2xzID0gJyc7XHJcbiAgICBASW5wdXQoKSB0eXBlOiAnZGFuZ2VyJyB8ICdzdWNjZXNzJyB8ICdpbmZvJyB8ICd3YXJuaW5nJyA9ICdpbmZvJztcclxuICAgIEBJbnB1dCgpIHRpcE1vZGU6ICdhbGx3YXlzJyB8ICdhdXRvJyA9ICdhdXRvJztcclxuXHJcbiAgICAvLyBASG9zdEJpbmRpbmcoJ3N0eWxlLndpZHRoJykgY21wV2lkdGggPSAnMTAwJSc7XHJcblxyXG4gICAgY29udGFpbmVyOiBhbnk7XHJcbiAgICBwcml2YXRlIGNvbW1vblV0aWxzOiBDb21tb25VdGlscztcclxuICAgIHByaXZhdGUgc2hvd1RpcFRpbWVyID0gbnVsbDtcclxuXHJcblxyXG4gICAgcHJpdmF0ZSBfbW91c2VlbnRlciA9IG51bGw7XHJcbiAgICBwcml2YXRlIF9tb3VzZWxlYXZlID0gbnVsbDtcclxuICAgIHByaXZhdGUgX21vdXNlY2xpY2sgPSBudWxsO1xyXG4gICAgcHJpdmF0ZSBuZ1pvbmU6IE5nWm9uZSA9IG51bGw7XHJcbiAgICBwcml2YXRlIHJlbmRlcjogUmVuZGVyZXIyID0gbnVsbDtcclxuICAgIHByaXZhdGUgZGc6IERhdGFncmlkQ29tcG9uZW50O1xyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBlbDogRWxlbWVudFJlZiwgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IpIHtcclxuICAgICAgICBpZiAodGhpcy5pbmplY3Rvcikge1xyXG4gICAgICAgICAgICB0aGlzLmNvbW1vblV0aWxzID0gdGhpcy5pbmplY3Rvci5nZXQoQ29tbW9uVXRpbHMsIG5ldyBDb21tb25VdGlscygpKTtcclxuICAgICAgICAgICAgdGhpcy5uZ1pvbmUgPSB0aGlzLmluamVjdG9yLmdldChOZ1pvbmUpO1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlciA9IHRoaXMuaW5qZWN0b3IuZ2V0KFJlbmRlcmVyMik7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmRnID0gdGhpcy5pbmplY3Rvci5nZXQoRGF0YWdyaWRDb21wb25lbnQpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29tbW9uVXRpbHMgPSBuZXcgQ29tbW9uVXRpbHMoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMubmdab25lKSB7XHJcbiAgICAgICAgICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX21vdXNlZW50ZXIgPSBVdGlscy5vbih0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsICdtb3VzZWVudGVyJywgdGhpcy5vbk1vdXNlRW50ZXIuYmluZCh0aGlzKSwgeyB0YXJnZXQ6ICcuZi1kYXRhZ3JpZC1jZWxsLWNvbnRlbnQnLCBvcHRpb25zOiB7IGNhcHR1cmU6IHRydWUgfX0pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fbW91c2VsZWF2ZSA9IFV0aWxzLm9uKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgJ21vdXNlbGVhdmUnLCB0aGlzLm9uTW91c2VMZWF2ZS5iaW5kKHRoaXMpLCB7IHRhcmdldDogJy5mLWRhdGFncmlkLWNlbGwtY29udGVudCcsIG9wdGlvbnM6IHsgY2FwdHVyZTogdHJ1ZSB9fSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9tb3VzZWNsaWNrID0gVXRpbHMub24odGhpcy5lbC5uYXRpdmVFbGVtZW50LCAnbW91c2Vkb3duJywgdGhpcy5vbkNsaWNrLmJpbmQodGhpcykpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkRlc3Ryb3koKSB7XHJcbiAgICAgICAgdGhpcy5oaWRlKCk7XHJcbiAgICAgICAgaWYgKHRoaXMuX21vdXNlZW50ZXIpIHtcclxuICAgICAgICAgICAgdGhpcy5fbW91c2VlbnRlcigpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuX21vdXNlbGVhdmUpIHtcclxuICAgICAgICAgICAgdGhpcy5fbW91c2VsZWF2ZSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuX21vdXNlY2xpY2spIHtcclxuICAgICAgICAgICAgdGhpcy5fbW91c2VjbGljaygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gdGhpcy5kZyA9IG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgb25Nb3VzZUVudGVyKCRldmVudDogYW55KSB7XHJcblxyXG4gICAgICAgIGlmICgkZXZlbnQuZnJvbUVsZW1lbnQpIHtcclxuICAgICAgICAgICAgaWYgKCEkZXZlbnQuZnJvbUVsZW1lbnQuY2xvc2VzdCgnLmYtZGF0YWdyaWQnKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgY29uc3QgY2VsbFRpcHRpbWVyID0gdGhpcy5kZyA/IHRoaXMuZGcuY2VsbFRpcFRpbWVyIDogMTAwMDtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuc2hvd1RpcFRpbWVyKSB7XHJcbiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLnNob3dUaXBUaW1lcik7XHJcbiAgICAgICAgICAgIHRoaXMuc2hvd1RpcFRpbWVyID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zaG93VGlwVGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5zaG93KCRldmVudCk7XHJcbiAgICAgICAgfSwgY2VsbFRpcHRpbWVyKTtcclxuICAgIH1cclxuXHJcbiAgICBvbk1vdXNlTGVhdmUoKSB7XHJcbiAgICAgICAgdGhpcy5oaWRlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgb25DbGljayhlOiBNb3VzZUV2ZW50KSB7XHJcbiAgICAgICAgLy8gZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICB0aGlzLmhpZGUoKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldFRleHRDb250YWluZXIoKSB7XHJcbiAgICAgICAgcmV0dXJuIERvbUhhbmRsZXIuZmluZFNpbmdsZSh0aGlzLmNvbnRhaW5lciwgJy5mLXRvb2x0aXAtdGV4dCcpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZG9ub3RTaG93VGlwcyh0YXJnZXQ6IGFueSkge1xyXG4gICAgICAgIGNvbnN0IHRkV2lkdGggPSB0YXJnZXQub2Zmc2V0V2lkdGg7XHJcbiAgICAgICAgY29uc3QgdGFnZXRTdHkgPSAgd2luZG93LmdldENvbXB1dGVkU3R5bGUodGFyZ2V0KTtcclxuICAgICAgICBjb25zdCB0eHRXaWR0aCA9IHRoaXMuY29tbW9uVXRpbHMuZ2V0VGV4dFdpZHRoKHRoaXMubWVzc2FnZSwgdGFnZXRTdHkuZm9udCk7XHJcbiAgICAgICAgY29uc3QgeyBwYWRkaW5nTGVmdCwgcGFkZGluZ1JpZ2h0IH0gPSB0YWdldFN0eTtcclxuICAgICAgICBjb25zdCBfd2lkdGggPSB0ZFdpZHRoIC0gKE51bWJlcihwYWRkaW5nTGVmdC5yZXBsYWNlKCdweCcsICcnKSkgfHwgMCkgLSAoTnVtYmVyKHBhZGRpbmdSaWdodC5yZXBsYWNlKCdweCcsICcnKSkgfHwgMCk7XHJcblxyXG4gICAgICAgIGxldCB0ciA9IHRhcmdldC5jbG9zZXN0KCd0cicpO1xyXG4gICAgICAgIGlmICh0cikge1xyXG4gICAgICAgICAgICBjb25zdCB0cklkID0gdHIuaWQ7XHJcbiAgICAgICAgICAgIHRyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignIycrIHRySWQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMudGlwTW9kZSA9PT0gJ2F1dG8nKSB7XHJcbiAgICAgICAgICAgIGlmICh0cikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF93aWR0aCAmJiBfd2lkdGggPiB0eHRXaWR0aDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gdHIgPyBmYWxzZSA6IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGhpZGUoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuc2hvd1RpcFRpbWVyKSB7XHJcbiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLnNob3dUaXBUaW1lcik7XHJcbiAgICAgICAgICAgIHRoaXMuc2hvd1RpcFRpbWVyID0gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmNvbnRhaW5lciAmJiB0aGlzLmNvbnRhaW5lci5wYXJlbnRFbGVtZW50KSB7XHJcbiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQodGhpcy5jb250YWluZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmNvbnRhaW5lciA9IG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgc2hvdygkZXZlbnQ6IE1vdXNlRXZlbnQpIHtcclxuICAgICAgICBjb25zdCBjZWxsRWwgPSAkZXZlbnQudGFyZ2V0IGFzIGFueTtcclxuICAgICAgICB0aGlzLmVuYWJsZSA9IGNlbGxFbC5nZXRBdHRyaWJ1dGUoJ2NlbGwtdG9vbHRpcCcpID09PSAndHJ1ZSc7XHJcbiAgICAgICAgdGhpcy5tZXNzYWdlID0gY2VsbEVsLmdldEF0dHJpYnV0ZSgnbWVzc2FnZScpO1xyXG4gICAgICAgIHRoaXMudGlwTW9kZSA9IGNlbGxFbC5nZXRBdHRyaWJ1dGUoJ3RpcE1vZGUnKSB8fCAnYXV0byc7XHJcblxyXG4gICAgICAgIGlmICghdGhpcy5lbmFibGUgfHwgIXRoaXMubWVzc2FnZSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCB0aXBXaWR0aCA9IGNlbGxFbC5nZXRBdHRyaWJ1dGUoJ3RpcFdpZHRoJyk7XHJcbiAgICAgICAgY29uc3QgdGlwSGVpZ2h0ID0gY2VsbEVsLmdldEF0dHJpYnV0ZSgndGlwSGVpZ2h0Jyk7XHJcbiAgICAgICAgdGhpcy5wb3NpdGlvbiA9IGNlbGxFbC5nZXRBdHRyaWJ1dGUoJ3Bvc2l0aW9uJykgfHwgJ3RvcC1sZWZ0JztcclxuXHJcbiAgICAgICAgLy8g5qOA5p+l5LiL5YaF5a655a695bqm5piv5ZCm6LaF5Ye65YiX5a69XHJcbiAgICAgICAgaWYgKHRoaXMuZG9ub3RTaG93VGlwcygkZXZlbnQudGFyZ2V0KSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBjb25zdCBib3hFbCA9IHRoaXMuZWwubmF0aXZlRWxlbWVudDtcclxuICAgICAgICBjb25zdCBib3hFbCA9ICRldmVudC50YXJnZXQ7XHJcbiAgICAgICAgY29uc3QgZWxTaXplID0gdGhpcy5nZXRCb3hTaXplT2JqKGJveEVsKTtcclxuXHJcblxyXG4gICAgICAgIC8qKiDlpoLmnpzlrZjlnKjliJnkuI3mlrDlu7rvvIzlj6rpnIDopoHkv67mlLnph4zpnaLnmoTlhoXlrrkgKi9cclxuICAgICAgICBpZiAoIXRoaXMuY29udGFpbmVyKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlKGVsU2l6ZSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgRG9tSGFuZGxlci5maW5kU2luZ2xlKHRoaXMuY29udGFpbmVyLCAnLmYtdG9vbHRpcC10ZXh0JykuaW5uZXJIVE1MID0gdGhpcy5tZXNzYWdlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5jb250YWluZXIuc3R5bGUubWF4V2lkdGggPSBgJHt3aW5kb3cuaW5uZXJXaWR0aCAtIDMwfXB4YDtcclxuICAgICAgICB0aGlzLmNvbnRhaW5lci5zdHlsZS5taW5XaWR0aCA9ICczNXB4JztcclxuXHJcbiAgICAgICAgaWYgKHRpcFdpZHRoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLnN0eWxlLndpZHRoID0gdGlwV2lkdGg7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGlwSGVpZ2h0KSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLnN0eWxlLmhlaWdodCA9IHRpcEhlaWdodDtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBjb25zdCBvZmZzZXQgPSBEb21IYW5kbGVyLmdldE9mZnNldChib3hFbCk7XHJcbiAgICAgICAgY29uc3QgdGFyZ2V0VG9wID0gb2Zmc2V0LnRvcDtcclxuICAgICAgICBjb25zdCB0YXJnZXRMZWZ0ID0gb2Zmc2V0LmxlZnQ7XHJcbiAgICAgICAgbGV0IGxlZnQ6IG51bWJlcjtcclxuICAgICAgICBsZXQgdG9wOiBudW1iZXI7XHJcbiAgICAgICAgdGhpcy5jb250YWluZXIuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XHJcblxyXG4gICAgICAgIHRoaXMuY2hhbmdlVG9vbHRpcFBvc2l0aW9uKGJveEVsKTtcclxuICAgICAgICBjb25zdCBhcnJvdyA9IERvbUhhbmRsZXIuZmluZFNpbmdsZSh0aGlzLmNvbnRhaW5lciwgJy5mLXRvb2x0aXAtYXJyb3cnKTtcclxuICAgICAgICBjb25zdCB0b29sdGlwU2l6ZSA9IHRoaXMuZ2V0VG9vbHRpcFNpemUoKTtcclxuXHJcbiAgICAgICAgLy8g5qOA5p+l5YaF5a656auY5bqmXHJcbiAgICAgICAgaWYgKHdpbmRvdy5pbm5lckhlaWdodCAtIDEwIDwgdG9vbHRpcFNpemUuaGVpZ2h0KSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLnN0eWxlLmhlaWdodCA9IGAke3dpbmRvdy5pbm5lckhlaWdodCAtIDIwfXB4YDtcclxuXHJcbiAgICAgICAgICAgIHRvb2x0aXBTaXplLmhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodCAtIDI1O1xyXG4gICAgICAgICAgICBjb25zdCB0ZXh0Q29udGFpbmVyID0gdGhpcy5nZXRUZXh0Q29udGFpbmVyKCk7XHJcbiAgICAgICAgICAgIHRleHRDb250YWluZXIuc3R5bGUuaGVpZ2h0ID0gYCR7dG9vbHRpcFNpemUuaGVpZ2h0fXB4YDtcclxuICAgICAgICAgICAgdGV4dENvbnRhaW5lci5zdHlsZS5vdmVyZmxvdyA9ICdoaWRkZW4nO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGNvbnN0IG4gPSB0aGlzLnVwZGF0ZUFycm93UG9zaXRpb24oYXJyb3csIG9mZnNldCwgJGV2ZW50KTtcclxuICAgICAgICBzd2l0Y2ggKHRoaXMucG9zaXRpb24pIHtcclxuICAgICAgICAgICAgY2FzZSAncmlnaHQnOlxyXG4gICAgICAgICAgICAgICAgbGVmdCA9IHRhcmdldExlZnQgKyBlbFNpemUud2lkdGg7XHJcbiAgICAgICAgICAgICAgICB0b3AgPSBuO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ2xlZnQnOlxyXG4gICAgICAgICAgICAgICAgbGVmdCA9IHRhcmdldExlZnQgLSB0b29sdGlwU2l6ZS53aWR0aDtcclxuICAgICAgICAgICAgICAgIHRvcCA9IG47XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAndG9wLWxlZnQnOlxyXG4gICAgICAgICAgICAgICAgdG9wID0gdGFyZ2V0VG9wIC0gdG9vbHRpcFNpemUuaGVpZ2h0IC0gNztcclxuICAgICAgICAgICAgICAgIGxlZnQgPSBuO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAobGVmdCkge1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5zdHlsZS5sZWZ0ID0gbGVmdCArICdweCc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmNvbnRhaW5lci5zdHlsZS50b3AgPSB0b3AgKyAncHgnO1xyXG4gICAgICAgIHRoaXMuY29udGFpbmVyLnN0eWxlLnpJbmRleCA9IDk5OTk5OTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHVwZGF0ZUFycm93UG9zaXRpb24oYXJyb3c6IGFueSwgZWxPZmZzZXQ6IHsgdG9wLCBsZWZ0IH0sICRldmVudDogYW55KSB7XHJcbiAgICAgICAgY29uc3QgdG9vbHRpcFNpemUgPSB0aGlzLmdldFRvb2x0aXBTaXplKCk7XHJcbiAgICAgICAgaWYgKHRoaXMucG9zaXRpb24gPT09ICdsZWZ0JyB8fCB0aGlzLnBvc2l0aW9uID09PSAncmlnaHQnKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRhcmdldFRvcCA9IGVsT2Zmc2V0LnRvcDtcclxuICAgICAgICAgICAgY29uc3QgaGFsZkhlaWdodCA9IHRvb2x0aXBTaXplLmhlaWdodCAvIDI7XHJcbiAgICAgICAgICAgIGxldCB0b3AgPSAxMDtcclxuICAgICAgICAgICAgaWYgKHRhcmdldFRvcCA+IGhhbGZIZWlnaHQgJiYgd2luZG93LmlubmVySGVpZ2h0IC0gdGFyZ2V0VG9wID4gaGFsZkhlaWdodCkge1xyXG4gICAgICAgICAgICAgICAgdG9wID0gdGFyZ2V0VG9wIC0gdG9vbHRpcFNpemUuaGVpZ2h0IC8gMjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8g6LCD5pW0566t5aS055qE5L2N572uXHJcbiAgICAgICAgICAgIGlmIChhcnJvdykge1xyXG4gICAgICAgICAgICAgICAgYXJyb3cuc3R5bGUudG9wID0gYCR7dGFyZ2V0VG9wIC0gdG9wfXB4YDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHRvcDtcclxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMucG9zaXRpb24gPT09ICd0b3AtbGVmdCcpIHtcclxuICAgICAgICAgICAgbGV0IGxlZnQgPSAkZXZlbnQucGFnZVggLSB0b29sdGlwU2l6ZS53aWR0aCAvIDI7XHJcblxyXG4gICAgICAgICAgICBpZiAobGVmdCA8IDEwKSB7XHJcbiAgICAgICAgICAgICAgICBsZWZ0ID0gZWxPZmZzZXQubGVmdDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGxlZnQgKyB0b29sdGlwU2l6ZS53aWR0aCA+IHdpbmRvdy5pbm5lcldpZHRoKSB7XHJcbiAgICAgICAgICAgICAgICBsZWZ0ID0gd2luZG93LmlubmVyV2lkdGggLSB0b29sdGlwU2l6ZS53aWR0aCAtIDIwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIOiwg+aVtOeureWktOeahOS9jee9rlxyXG4gICAgICAgICAgICBpZiAoYXJyb3cpIHtcclxuICAgICAgICAgICAgICAgIGlmICgkZXZlbnQucGFnZVggLSBsZWZ0ID4gMjgpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoJGV2ZW50LnBhZ2VYIC0gbGVmdCArIDI4ID4gdG9vbHRpcFNpemUud2lkdGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXJyb3cuc3R5bGUubGVmdCA9IGAke3Rvb2x0aXBTaXplLndpZHRoIC0gMjggfXB4YDtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhcnJvdy5zdHlsZS5sZWZ0ID0gYCR7JGV2ZW50LnBhZ2VYIC0gbGVmdCB9cHhgO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGxlZnQ7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZShlbFNpemU6IGFueSkge1xyXG4gICAgICAgIGxldCBzdHlsZUNsYXNzID0gdGhpcy50b29sdGlwQ2xzKCk7XHJcbiAgICAgICAgdGhpcy5jb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICBpZiAodGhpcy50b29sdGlwU3R5bGVDbGFzcykge1xyXG4gICAgICAgICAgICBzdHlsZUNsYXNzICs9ICcgJyArIHRoaXMudG9vbHRpcFN0eWxlQ2xhc3M7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuY29udGFpbmVyLmNsYXNzTmFtZSA9IHN0eWxlQ2xhc3M7XHJcblxyXG4gICAgICAgIGNvbnN0IHRvb2x0aXBBcnJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgIHRvb2x0aXBBcnJvdy5jbGFzc05hbWUgPSAnZi10b29sdGlwLWFycm93ICc7XHJcbiAgICAgICAgdGhpcy5jb250YWluZXIuYXBwZW5kQ2hpbGQodG9vbHRpcEFycm93KTtcclxuXHJcbiAgICAgICAgY29uc3QgdG9vbHRpcFRleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICB0b29sdGlwVGV4dC5jbGFzc05hbWUgPSAnZi10b29sdGlwLXRleHQgJztcclxuICAgICAgICB0b29sdGlwVGV4dC5pbm5lckhUTUwgPSB0aGlzLm1lc3NhZ2U7XHJcblxyXG4gICAgICAgIGNvbnN0IG1heFdpZHRoID0gd2luZG93LmlubmVyV2lkdGggLSA1MDtcclxuICAgICAgICB0b29sdGlwVGV4dC5zdHlsZS5tYXhXaWR0aCA9IGAke21heFdpZHRofXB4YDtcclxuXHJcbiAgICAgICAgdG9vbHRpcFRleHQuc3R5bGUud29yZEJyZWFrID0gJ2JyZWFrLWFsbCc7XHJcbiAgICAgICAgdGhpcy5jb250YWluZXIuc3R5bGUudGV4dEFsaWduID0gJ2NlbnRlcic7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLnBvc2l0aW9uU3R5bGUpIHtcclxuICAgICAgICAgICAgdGhpcy5jb250YWluZXIuc3R5bGUucG9zaXRpb24gPSB0aGlzLnBvc2l0aW9uU3R5bGU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmNvbnRhaW5lci5hcHBlbmRDaGlsZCh0b29sdGlwVGV4dCk7XHJcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aGlzLmNvbnRhaW5lcik7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSB0b29sdGlwQ2xzKCkge1xyXG4gICAgICAgIHJldHVybiAnZGF0YWdyaWQtY2VsbC10b29sdGlwIGYtdG9vbHRpcCAnICsgdGhpcy5nZXRUaGVtZUNscygpICsgJyBmLXRvb2x0aXAtJyArIHRoaXMucG9zaXRpb24gKyAnICcgKyB0aGlzLmNscztcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldFRoZW1lQ2xzKCkge1xyXG4gICAgICAgIGlmICh0aGlzLnR5cGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuICdmLXRvb2x0aXAtJyArIHRoaXMudHlwZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKiDojrflj5blrr/kuLvlsLrlr7ggKi9cclxuICAgIHByaXZhdGUgZ2V0Qm94U2l6ZU9iaihib3hFbCkge1xyXG4gICAgICAgIGNvbnN0IHAgPSBib3hFbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICB3aWR0aDogRG9tSGFuZGxlci5nZXRPdXRlcldpZHRoKGJveEVsKSxcclxuICAgICAgICAgICAgaGVpZ2h0OiBEb21IYW5kbGVyLmdldE91dGVySGVpZ2h0KGJveEVsKSxcclxuICAgICAgICAgICAgbGVmdDogcC5sZWZ0LFxyXG4gICAgICAgICAgICByaWdodDogcC5yaWdodCxcclxuICAgICAgICAgICAgdG9wOiBwLnRvcCxcclxuICAgICAgICAgICAgYm90dG9tOiBwLmJvdHRvbVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIOiOt+WPlnRvb2x0aXAg5a655Zmo5bC65a+4ICovXHJcbiAgICBwcml2YXRlIGdldFRvb2x0aXBTaXplKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHdpZHRoOiBEb21IYW5kbGVyLmdldE91dGVyV2lkdGgodGhpcy5jb250YWluZXIpLFxyXG4gICAgICAgICAgICBoZWlnaHQ6IERvbUhhbmRsZXIuZ2V0T3V0ZXJIZWlnaHQodGhpcy5jb250YWluZXIpXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICAvKiog6I635Y+W56qX5Y+j5bC65a+4ICovXHJcbiAgICBwcml2YXRlIGdldFdpbmRvd1NpemUoKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgd2lkdGg6IHdpbmRvdy5pbm5lcldpZHRoLFxyXG4gICAgICAgICAgICBoZWlnaHQ6IHdpbmRvdy5pbm5lckhlaWdodFxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIOagueaNruWGheWuueeahOWkmuWwke+8jOiHquWKqOabtOaUuXRvb2x0aXAg55qE5L2N572uICovXHJcbiAgICBwcml2YXRlIGNoYW5nZVRvb2x0aXBQb3NpdGlvbihib3hFbDogYW55KSB7XHJcbiAgICAgICAgY29uc3QgYm94U2l6ZSA9IHRoaXMuZ2V0Qm94U2l6ZU9iaihib3hFbCk7XHJcbiAgICAgICAgY29uc3QgdG9vbHRpcCA9IHRoaXMuZ2V0VG9vbHRpcFNpemUoKTtcclxuICAgICAgICBjb25zdCB3aW5TaXplID0gdGhpcy5nZXRXaW5kb3dTaXplKCk7XHJcblxyXG4gICAgICAgIHRoaXMuY29udGFpbmVyLmNsYXNzTmFtZSA9IHRoaXMudG9vbHRpcENscygpO1xyXG5cclxuICAgICAgICBpZiAodG9vbHRpcC53aWR0aCA8IHdpblNpemUud2lkdGggJiYgdG9vbHRpcC5oZWlnaHQgPCBib3hTaXplLnRvcCkge1xyXG4gICAgICAgICAgICAvLyB0aGlzLnBvc2l0aW9uID0gJ3RvcC1sZWZ0JztcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGVsT2Zmc2V0ID0gRG9tSGFuZGxlci5nZXRPZmZzZXQoYm94RWwpO1xyXG4gICAgICAgICAgICBjb25zdCBlbExlZnQgPSBlbE9mZnNldC5sZWZ0O1xyXG4gICAgICAgICAgICBjb25zdCBlbFJpZ2h0ID0gd2luU2l6ZS53aWR0aCAtIGVsTGVmdCAtIGJveFNpemUud2lkdGg7XHJcblxyXG4gICAgICAgICAgICBpZiAoZWxMZWZ0ID4gZWxSaWdodCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wb3NpdGlvbiA9ICdsZWZ0JztcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucG9zaXRpb24gPSAncmlnaHQnO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjb25zdCB0b29sVGlwVGV4dFdpZHRoID0gZWxMZWZ0ID4gZWxSaWdodCA/IGVsTGVmdCA6IGVsUmlnaHQ7XHJcbiAgICAgICAgICAgIGNvbnN0IHRleHRFbCA9IHRoaXMuZ2V0VGV4dENvbnRhaW5lcigpO1xyXG4gICAgICAgICAgICB0ZXh0RWwuc3R5bGUubWF4V2lkdGggPSBgJHt0b29sVGlwVGV4dFdpZHRoIC0gMzB9cHhgO1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5zdHlsZS5tYXhXaWR0aCA9IGAke3Rvb2xUaXBUZXh0V2lkdGh9cHhgO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG59XHJcbiJdfQ==