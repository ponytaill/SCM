/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { takeUntil } from 'rxjs/operators';
import { LocaleService } from '@farris/ui-locale';
import { Subject } from 'rxjs';
import { Component, ViewEncapsulation, Injector, ChangeDetectorRef, ElementRef, ViewChild, Renderer2, Input, NgZone } from '@angular/core';
import { DatagridService } from './../../services/datagrid.service';
import ResizeObserver from 'resize-observer-polyfill';
import { DatagridComponent } from '../../datagrid.component';
export class DatagridFilterToolbarComponent {
    /**
     * @param {?} inject
     * @param {?} el
     * @param {?} cd
     * @param {?} dgs
     * @param {?} render
     * @param {?} ngZone
     * @param {?} localeSer
     */
    constructor(inject, el, cd, dgs, render, ngZone, localeSer) {
        this.inject = inject;
        this.el = el;
        this.cd = cd;
        this.dgs = dgs;
        this.render = render;
        this.ngZone = ngZone;
        this.localeSer = localeSer;
        this.empty = '[ 无 ]';
        this.filterText = this.empty;
        this.openFilterPanel = false;
        this.showExpand = false;
        this.enableFilterSetting = false;
        this.windowResizeHandler = null;
        this.ro = null;
        this.destory$ = new Subject();
        this.empty = this.localeSer.getValue('datagrid.filter.nofilter');
        this.filterText = this.empty;
    }
    /**
     * @return {?}
     */
    get toolbarWidth() {
        return this.filterToolbarRef.nativeElement.offsetWidth;
    }
    /**
     * @return {?}
     */
    get filterTextContainerWidth() {
        /** @type {?} */
        let actionW = 52;
        if (this.enableFilterSetting) {
            actionW = 65;
        }
        return this.toolbarWidth - 85 - actionW;
    }
    /**
     * @return {?}
     */
    get filterTextRealWidth() {
        this.render.setStyle(this.filterPanelTextRef.nativeElement, 'white-space', 'nowrap');
        /** @type {?} */
        const w = this.filterPanelTextRef.nativeElement.scrollWidth;
        this.render.setStyle(this.filterPanelTextRef.nativeElement, 'white-space', 'normal');
        return w;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.dg = this.inject.get(DatagridComponent);
        this.dfrs = this.dg.clientFilterService;
        this.dgs.clearFilter.pipe(takeUntil(this.destory$)).subscribe((/**
         * @return {?}
         */
        () => {
            this.filterText = this.empty;
            this.openFilterPanel = false;
            this.dgs.onFilterTextChange(this.filterText);
            this.cd.detectChanges();
        }));
        this.filterChangeSubscription = this.dgs.onFilterChanged.pipe(takeUntil(this.destory$)).subscribe((/**
         * @param {?} n
         * @return {?}
         */
        (n) => {
            this.filterText = this.dfrs.convertFilterCondition2String(n);
            if (!this.filterText) {
                this.filterText = this.empty;
            }
            this.updateExpandState();
            setTimeout((/**
             * @return {?}
             */
            () => {
                this.bindEvent();
            }), 100);
            if (!this.showExpand) {
                this.openFilterPanel = false;
            }
            this.cd.detectChanges();
            this.dgs.onFilterTextChange(this.filterText);
        }));
        this.ngZone.runOutsideAngular((/**
         * @return {?}
         */
        () => {
            this.ro = new ResizeObserver((/**
             * @return {?}
             */
            () => {
                setTimeout((/**
                 * @return {?}
                 */
                () => {
                    this.updateExpandState();
                    this.cd.detectChanges();
                }), 100);
            }));
            this.ro.observe(this.el.nativeElement.closest('div.f-datagrid'));
        }));
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.destory$.next();
        this.destory$.complete();
        this.ro.disconnect();
        if (this.filterChangeSubscription) {
            this.filterChangeSubscription.unsubscribe();
            this.filterChangeSubscription = null;
        }
        if (this.windowResizeHandler) {
            this.windowResizeHandler();
            this.windowResizeHandler = null;
        }
    }
    /**
     * @private
     * @return {?}
     */
    bindEvent() {
        this.ngZone.runOutsideAngular((/**
         * @return {?}
         */
        () => {
            /** @type {?} */
            const filterFields = this.filterToolbarRef.nativeElement.querySelectorAll('.filter-field');
            this.bindFilterFieldHandler(filterFields);
            /** @type {?} */
            const dropdownFilterFields = this.filterPanelTextRef.nativeElement.querySelectorAll('.filter-field');
            this.bindFilterFieldHandler(dropdownFilterFields, false);
        }));
    }
    /**
     * @private
     * @param {?} filterFields
     * @param {?=} hidePanel
     * @return {?}
     */
    bindFilterFieldHandler(filterFields, hidePanel = true) {
        if (filterFields && filterFields.length) {
            filterFields.forEach((/**
             * @param {?} ff
             * @return {?}
             */
            ff => {
                this.render.listen(ff, 'click', (/**
                 * @return {?}
                 */
                () => {
                    this.removeFilterField(ff, hidePanel);
                }));
            }));
        }
    }
    /**
     * @private
     * @param {?} ff
     * @param {?=} hidePanel
     * @return {?}
     */
    removeFilterField(ff, hidePanel = true) {
        /** @type {?} */
        const field = ff.classList[1].replace('filter-column-', '');
        delete this.dg.conditions[field];
        this.dfrs.removeFilterField(field);
        ff.remove();
        if (hidePanel) {
            this.openFilterPanel = false;
            this.updateExpandState();
        }
    }
    /**
     * @private
     * @return {?}
     */
    updateExpandState() {
        this.showExpand = this.isShowExpand();
    }
    /**
     * @return {?}
     */
    isShowExpand() {
        if (this.filterTextContainerWidth > this.filterTextRealWidth) {
            return false;
        }
        else if (this.filterTextRealWidth > this.filterTextContainerWidth) {
            return true;
        }
        else {
            return false;
        }
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    clearFilter($event) {
        this.filterText = this.empty;
        this.dgs.onClearFilter();
        this.dgs.onFilterChanged.emit({});
        return false;
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    refreshFilter($event) {
        this.dg.filterData();
        return false;
    }
    /**
     * @return {?}
     */
    showFilterTextPanel() {
        this.openFilterPanel = !this.openFilterPanel;
        this.cd.detectChanges();
    }
}
DatagridFilterToolbarComponent.decorators = [
    { type: Component, args: [{
                selector: 'filter-toolbar',
                template: `
        <div class="f-datagrid-filter-toolbar-panel" #filterPanel [class.show]="openFilterPanel" style="width: auto">
            <span class="filter-text" #filterPanelText [innerHTML]="filterText"></span>
        </div>
        <div class="f-datagrid-filter-toolbar" #filterToolbar>
            <span class="title">{{'datagrid.filter.title'| locale}}：</span>
            <span #filterbarTxt class="filter-text" [innerHTML]="filterText"> </span>
            <span class="filter-action" *ngIf="filterText !== empty ">
                <span *ngIf="showExpand" class="f-icon filter-action-item"
                    [class.f-icon-arrow-chevron-up]="openFilterPanel"
                    [class.f-icon-arrow-chevron-down]="!openFilterPanel"
                (click)="showFilterTextPanel()" title="{{'datagrid.filter.more'|locale}}"></span>
                <span title="{{'datagrid.filter.clearAll'|locale}}" class="f-icon f-icon-x filter-action-item filter-clear" (click)="clearFilter($event)"></span>
                <span title="refresh" class="f-icon f-icon-reload-sm filter-action-item filter-refresh" style="color: #388fff" (click)="refreshFilter($event)"></span>
                <span *ngIf="enableFilterSetting" class="f-icon f-icon-cog filter-action-item" title="{{'datagrid.filter.setting'|locale}}"></span>
            </span>
        </div>
    `,
                encapsulation: ViewEncapsulation.None
            }] }
];
/** @nocollapse */
DatagridFilterToolbarComponent.ctorParameters = () => [
    { type: Injector },
    { type: ElementRef },
    { type: ChangeDetectorRef },
    { type: DatagridService },
    { type: Renderer2 },
    { type: NgZone },
    { type: LocaleService }
];
DatagridFilterToolbarComponent.propDecorators = {
    enableFilterSetting: [{ type: Input }],
    filterPanelRef: [{ type: ViewChild, args: ['filterPanel',] }],
    filterPanelTextRef: [{ type: ViewChild, args: ['filterPanelText',] }],
    filterTextRef: [{ type: ViewChild, args: ['filterbarTxt',] }],
    filterToolbarRef: [{ type: ViewChild, args: ['filterToolbar',] }]
};
if (false) {
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.empty;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.filterText;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.openFilterPanel;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.showExpand;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.enableFilterSetting;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.filterPanelRef;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.filterPanelTextRef;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.filterTextRef;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.filterToolbarRef;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.filterChangeSubscription;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.windowResizeHandler;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.ro;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterToolbarComponent.prototype.destory$;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterToolbarComponent.prototype.dfrs;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterToolbarComponent.prototype.dg;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterToolbarComponent.prototype.inject;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterToolbarComponent.prototype.el;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterToolbarComponent.prototype.cd;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterToolbarComponent.prototype.dgs;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterToolbarComponent.prototype.render;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterToolbarComponent.prototype.ngZone;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterToolbarComponent.prototype.localeSer;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsdGVyLXRvb2xiYXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1kYXRhZ3JpZC8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2ZpbHRlci10b29sYmFyL2ZpbHRlci10b29sYmFyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzNDLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNsRCxPQUFPLEVBQUUsT0FBTyxFQUFnQixNQUFNLE1BQU0sQ0FBQztBQUM3QyxPQUFPLEVBQUUsU0FBUyxFQUFVLGlCQUFpQixFQUFFLFFBQVEsRUFBRSxpQkFBaUIsRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUE2QixNQUFNLGVBQWUsQ0FBQztBQUM5SyxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sbUNBQW1DLENBQUM7QUFHcEUsT0FBTyxjQUFjLE1BQU0sMEJBQTBCLENBQUM7QUFDdEQsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUF3QjdELE1BQU0sT0FBTyw4QkFBOEI7Ozs7Ozs7Ozs7SUF1Q3ZDLFlBQ1ksTUFBZ0IsRUFDaEIsRUFBYyxFQUNkLEVBQXFCLEVBQ3JCLEdBQW9CLEVBQ3BCLE1BQWlCLEVBQ2pCLE1BQWMsRUFDZCxTQUF3QjtRQU54QixXQUFNLEdBQU4sTUFBTSxDQUFVO1FBQ2hCLE9BQUUsR0FBRixFQUFFLENBQVk7UUFDZCxPQUFFLEdBQUYsRUFBRSxDQUFtQjtRQUNyQixRQUFHLEdBQUgsR0FBRyxDQUFpQjtRQUNwQixXQUFNLEdBQU4sTUFBTSxDQUFXO1FBQ2pCLFdBQU0sR0FBTixNQUFNLENBQVE7UUFDZCxjQUFTLEdBQVQsU0FBUyxDQUFlO1FBN0NwQyxVQUFLLEdBQUcsT0FBTyxDQUFDO1FBQ2hCLGVB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QUMxQixRQUFRLEVBQUU7Ozs7Ozs7Ozs7Ozs7Ozs7O0tBaUJUO2dCQUNELGFBQWEsRUFBRSxpQkFBaUIsQ0FBQyxJQUFJO2FBQ3hDOzs7O1lBNUI4QyxRQUFRO1lBQXFCLFVBQVU7WUFBN0IsaUJBQWlCO1lBQ2pFLGVBQWU7WUFEMkUsU0FBUztZQUFTLE1BQU07WUFGbEgsYUFBYTs7O2tDQXNDakIsS0FBSzs2QkFFTCxTQUFTLFNBQUMsYUFBYTtpQ0FDdkIsU0FBUyxTQUFDLGlCQUFpQjs0QkFDM0IsU0FBUyxTQUFDLGNBQWM7K0JBQ3hCLFNBQVMsU0FBQyxlQUFlOzs7O0lBWDFCLCtDQUFnQjs7SUFDaEIsb0RBQXdCOztJQUV4Qix5REFBd0I7O0lBQ3hCLG9EQUFtQjs7SUFFbkIsNkRBQXFDOztJQUVyQyx3REFBcUQ7O0lBQ3JELDREQUE2RDs7SUFDN0QsdURBQXFEOztJQUNyRCwwREFBeUQ7O0lBcUJ6RCxrRUFBdUM7O0lBQ3ZDLDZEQUEyQjs7SUFDM0IsNENBQTBCOzs7OztJQUMxQixrREFBaUM7Ozs7O0lBQ2pDLDhDQUFvQzs7Ozs7SUFDcEMsNENBQThCOzs7OztJQUUxQixnREFBd0I7Ozs7O0lBQ3hCLDRDQUFzQjs7Ozs7SUFDdEIsNENBQTZCOzs7OztJQUM3Qiw2Q0FBNEI7Ozs7O0lBQzVCLGdEQUF5Qjs7Ozs7SUFDekIsZ0RBQXNCOzs7OztJQUN0QixtREFBZ0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyB0YWtlVW50aWwgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7IExvY2FsZVNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWxvY2FsZSc7XHJcbmltcG9ydCB7IFN1YmplY3QsIFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgVmlld0VuY2Fwc3VsYXRpb24sIEluamVjdG9yLCBDaGFuZ2VEZXRlY3RvclJlZiwgRWxlbWVudFJlZiwgVmlld0NoaWxkLCBSZW5kZXJlcjIsIElucHV0LCBOZ1pvbmUsIE9uRGVzdHJveSwgT3B0aW9uYWwsIEhvc3QgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgRGF0YWdyaWRTZXJ2aWNlIH0gZnJvbSAnLi8uLi8uLi9zZXJ2aWNlcy9kYXRhZ3JpZC5zZXJ2aWNlJztcclxuaW1wb3J0IHsgRGF0YWdyaWRGaWx0ZXJTZXJ2aWNlIH0gZnJvbSAnLi8uLi8uLi9zZXJ2aWNlcy9kYXRhZ3JpZC1maWx0ZXIuc2VydmljZSc7XHJcbmltcG9ydCB7ICB9IGZyb20gJy4vLi4vLi4vc2VydmljZXMvZGF0YWdyaWQtZmFjYWRlLnNlcnZpY2UnO1xyXG5pbXBvcnQgUmVzaXplT2JzZXJ2ZXIgZnJvbSAncmVzaXplLW9ic2VydmVyLXBvbHlmaWxsJztcclxuaW1wb3J0IHsgRGF0YWdyaWRDb21wb25lbnQgfSBmcm9tICcuLi8uLi9kYXRhZ3JpZC5jb21wb25lbnQnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ2ZpbHRlci10b29sYmFyJyxcclxuICAgIHRlbXBsYXRlOiBgXHJcbiAgICAgICAgPGRpdiBjbGFzcz1cImYtZGF0YWdyaWQtZmlsdGVyLXRvb2xiYXItcGFuZWxcIiAjZmlsdGVyUGFuZWwgW2NsYXNzLnNob3ddPVwib3BlbkZpbHRlclBhbmVsXCIgc3R5bGU9XCJ3aWR0aDogYXV0b1wiPlxyXG4gICAgICAgICAgICA8c3BhbiBjbGFzcz1cImZpbHRlci10ZXh0XCIgI2ZpbHRlclBhbmVsVGV4dCBbaW5uZXJIVE1MXT1cImZpbHRlclRleHRcIj48L3NwYW4+XHJcbiAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgPGRpdiBjbGFzcz1cImYtZGF0YWdyaWQtZmlsdGVyLXRvb2xiYXJcIiAjZmlsdGVyVG9vbGJhcj5cclxuICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJ0aXRsZVwiPnt7J2RhdGFncmlkLmZpbHRlci50aXRsZSd8IGxvY2FsZX1977yaPC9zcGFuPlxyXG4gICAgICAgICAgICA8c3BhbiAjZmlsdGVyYmFyVHh0IGNsYXNzPVwiZmlsdGVyLXRleHRcIiBbaW5uZXJIVE1MXT1cImZpbHRlclRleHRcIj4gPC9zcGFuPlxyXG4gICAgICAgICAgICA8c3BhbiBjbGFzcz1cImZpbHRlci1hY3Rpb25cIiAqbmdJZj1cImZpbHRlclRleHQgIT09IGVtcHR5IFwiPlxyXG4gICAgICAgICAgICAgICAgPHNwYW4gKm5nSWY9XCJzaG93RXhwYW5kXCIgY2xhc3M9XCJmLWljb24gZmlsdGVyLWFjdGlvbi1pdGVtXCJcclxuICAgICAgICAgICAgICAgICAgICBbY2xhc3MuZi1pY29uLWFycm93LWNoZXZyb24tdXBdPVwib3BlbkZpbHRlclBhbmVsXCJcclxuICAgICAgICAgICAgICAgICAgICBbY2xhc3MuZi1pY29uLWFycm93LWNoZXZyb24tZG93bl09XCIhb3BlbkZpbHRlclBhbmVsXCJcclxuICAgICAgICAgICAgICAgIChjbGljayk9XCJzaG93RmlsdGVyVGV4dFBhbmVsKClcIiB0aXRsZT1cInt7J2RhdGFncmlkLmZpbHRlci5tb3JlJ3xsb2NhbGV9fVwiPjwvc3Bhbj5cclxuICAgICAgICAgICAgICAgIDxzcGFuIHRpdGxlPVwie3snZGF0YWdyaWQuZmlsdGVyLmNsZWFyQWxsJ3xsb2NhbGV9fVwiIGNsYXNzPVwiZi1pY29uIGYtaWNvbi14IGZpbHRlci1hY3Rpb24taXRlbSBmaWx0ZXItY2xlYXJcIiAoY2xpY2spPVwiY2xlYXJGaWx0ZXIoJGV2ZW50KVwiPjwvc3Bhbj5cclxuICAgICAgICAgICAgICAgIDxzcGFuIHRpdGxlPVwicmVmcmVzaFwiIGNsYXNzPVwiZi1pY29uIGYtaWNvbi1yZWxvYWQtc20gZmlsdGVyLWFjdGlvbi1pdGVtIGZpbHRlci1yZWZyZXNoXCIgc3R5bGU9XCJjb2xvcjogIzM4OGZmZlwiIChjbGljayk9XCJyZWZyZXNoRmlsdGVyKCRldmVudClcIj48L3NwYW4+XHJcbiAgICAgICAgICAgICAgICA8c3BhbiAqbmdJZj1cImVuYWJsZUZpbHRlclNldHRpbmdcIiBjbGFzcz1cImYtaWNvbiBmLWljb24tY29nIGZpbHRlci1hY3Rpb24taXRlbVwiIHRpdGxlPVwie3snZGF0YWdyaWQuZmlsdGVyLnNldHRpbmcnfGxvY2FsZX19XCI+PC9zcGFuPlxyXG4gICAgICAgICAgICA8L3NwYW4+XHJcbiAgICAgICAgPC9kaXY+XHJcbiAgICBgLFxyXG4gICAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZVxyXG59KVxyXG5leHBvcnQgY2xhc3MgRGF0YWdyaWRGaWx0ZXJUb29sYmFyQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3kge1xyXG4gICAgZW1wdHkgPSAnWyDml6AgXSc7XHJcbiAgICBmaWx0ZXJUZXh0ID0gdGhpcy5lbXB0eTtcclxuXHJcbiAgICBvcGVuRmlsdGVyUGFuZWwgPSBmYWxzZTtcclxuICAgIHNob3dFeHBhbmQgPSBmYWxzZTtcclxuXHJcbiAgICBASW5wdXQoKSBlbmFibGVGaWx0ZXJTZXR0aW5nID0gZmFsc2U7XHJcblxyXG4gICAgQFZpZXdDaGlsZCgnZmlsdGVyUGFuZWwnKSBmaWx0ZXJQYW5lbFJlZjogRWxlbWVudFJlZjtcclxuICAgIEBWaWV3Q2hpbGQoJ2ZpbHRlclBhbmVsVGV4dCcpIGZpbHRlclBhbmVsVGV4dFJlZjogRWxlbWVudFJlZjtcclxuICAgIEBWaWV3Q2hpbGQoJ2ZpbHRlcmJhclR4dCcpIGZpbHRlclRleHRSZWY6IEVsZW1lbnRSZWY7XHJcbiAgICBAVmlld0NoaWxkKCdmaWx0ZXJUb29sYmFyJykgZmlsdGVyVG9vbGJhclJlZjogRWxlbWVudFJlZjtcclxuXHJcbiAgICBnZXQgdG9vbGJhcldpZHRoKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmZpbHRlclRvb2xiYXJSZWYubmF0aXZlRWxlbWVudC5vZmZzZXRXaWR0aDtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgZmlsdGVyVGV4dENvbnRhaW5lcldpZHRoKCkge1xyXG4gICAgICAgIGxldCBhY3Rpb25XID0gNTI7XHJcbiAgICAgICAgaWYgKHRoaXMuZW5hYmxlRmlsdGVyU2V0dGluZykge1xyXG4gICAgICAgICAgICBhY3Rpb25XID0gNjU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLnRvb2xiYXJXaWR0aCAtIDg1IC0gYWN0aW9uVztcclxuICAgIH1cclxuXHJcbiAgICBnZXQgZmlsdGVyVGV4dFJlYWxXaWR0aCgpIHtcclxuICAgICAgICB0aGlzLnJlbmRlci5zZXRTdHlsZSh0aGlzLmZpbHRlclBhbmVsVGV4dFJlZi5uYXRpdmVFbGVtZW50LCAnd2hpdGUtc3BhY2UnLCAnbm93cmFwJyk7XHJcbiAgICAgICAgY29uc3QgdyA9IHRoaXMuZmlsdGVyUGFuZWxUZXh0UmVmLm5hdGl2ZUVsZW1lbnQuc2Nyb2xsV2lkdGg7XHJcbiAgICAgICAgdGhpcy5yZW5kZXIuc2V0U3R5bGUodGhpcy5maWx0ZXJQYW5lbFRleHRSZWYubmF0aXZlRWxlbWVudCwgJ3doaXRlLXNwYWNlJywgJ25vcm1hbCcpO1xyXG4gICAgICAgIHJldHVybiB3O1xyXG4gICAgfVxyXG5cclxuICAgIGZpbHRlckNoYW5nZVN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xyXG4gICAgd2luZG93UmVzaXplSGFuZGxlciA9IG51bGw7XHJcbiAgICBybzogUmVzaXplT2JzZXJ2ZXIgPSBudWxsO1xyXG4gICAgcHJpdmF0ZSBkZXN0b3J5JCA9IG5ldyBTdWJqZWN0KCk7XHJcbiAgICBwcml2YXRlIGRmcnM6IERhdGFncmlkRmlsdGVyU2VydmljZTtcclxuICAgIHByaXZhdGUgZGc6IERhdGFncmlkQ29tcG9uZW50O1xyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgcHJpdmF0ZSBpbmplY3Q6IEluamVjdG9yLFxyXG4gICAgICAgIHByaXZhdGUgZWw6IEVsZW1lbnRSZWYsXHJcbiAgICAgICAgcHJpdmF0ZSBjZDogQ2hhbmdlRGV0ZWN0b3JSZWYsXHJcbiAgICAgICAgcHJpdmF0ZSBkZ3M6IERhdGFncmlkU2VydmljZSxcclxuICAgICAgICBwcml2YXRlIHJlbmRlcjogUmVuZGVyZXIyLFxyXG4gICAgICAgIHByaXZhdGUgbmdab25lOiBOZ1pvbmUsXHJcbiAgICAgICAgcHJpdmF0ZSBsb2NhbGVTZXI6IExvY2FsZVNlcnZpY2UsXHJcbiAgICAgICkge1xyXG4gICAgICAgICAgICB0aGlzLmVtcHR5ID0gdGhpcy5sb2NhbGVTZXIuZ2V0VmFsdWUoJ2RhdGFncmlkLmZpbHRlci5ub2ZpbHRlcicpO1xyXG4gICAgICAgICAgICB0aGlzLmZpbHRlclRleHQgPSB0aGlzLmVtcHR5O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmRnID0gdGhpcy5pbmplY3QuZ2V0PERhdGFncmlkQ29tcG9uZW50PihEYXRhZ3JpZENvbXBvbmVudCk7XHJcbiAgICAgICAgdGhpcy5kZnJzID0gdGhpcy5kZy5jbGllbnRGaWx0ZXJTZXJ2aWNlO1xyXG5cclxuICAgICAgICB0aGlzLmRncy5jbGVhckZpbHRlci5waXBlKHRha2VVbnRpbCh0aGlzLmRlc3RvcnkkKSkuc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5maWx0ZXJUZXh0ID0gdGhpcy5lbXB0eTtcclxuICAgICAgICAgICAgdGhpcy5vcGVuRmlsdGVyUGFuZWwgPSBmYWxzZTtcclxuICAgICAgICAgICAgdGhpcy5kZ3Mub25GaWx0ZXJUZXh0Q2hhbmdlKHRoaXMuZmlsdGVyVGV4dCk7XHJcbiAgICAgICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLmZpbHRlckNoYW5nZVN1YnNjcmlwdGlvbiA9IHRoaXMuZGdzLm9uRmlsdGVyQ2hhbmdlZC5waXBlKHRha2VVbnRpbCh0aGlzLmRlc3RvcnkkKSkuc3Vic2NyaWJlKChuKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuZmlsdGVyVGV4dCA9IHRoaXMuZGZycy5jb252ZXJ0RmlsdGVyQ29uZGl0aW9uMlN0cmluZyhuKTtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLmZpbHRlclRleHQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZmlsdGVyVGV4dCA9IHRoaXMuZW1wdHk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlRXhwYW5kU3RhdGUoKTtcclxuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmJpbmRFdmVudCgpO1xyXG4gICAgICAgICAgICB9LCAxMDApO1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuc2hvd0V4cGFuZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5vcGVuRmlsdGVyUGFuZWwgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICAgICAgdGhpcy5kZ3Mub25GaWx0ZXJUZXh0Q2hhbmdlKHRoaXMuZmlsdGVyVGV4dCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcclxuXHJcbiAgICAgICAgICAgIHRoaXMucm8gPSBuZXcgUmVzaXplT2JzZXJ2ZXIoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVFeHBhbmRTdGF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgICAgICAgICAgfSwgMTAwKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLnJvLm9ic2VydmUodGhpcy5lbC5uYXRpdmVFbGVtZW50LmNsb3Nlc3QoJ2Rpdi5mLWRhdGFncmlkJykpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25EZXN0cm95KCkge1xyXG4gICAgICAgIHRoaXMuZGVzdG9yeSQubmV4dCgpO1xyXG4gICAgICAgIHRoaXMuZGVzdG9yeSQuY29tcGxldGUoKTtcclxuICAgICAgICB0aGlzLnJvLmRpc2Nvbm5lY3QoKTtcclxuICAgICAgICBpZiAodGhpcy5maWx0ZXJDaGFuZ2VTdWJzY3JpcHRpb24pIHtcclxuICAgICAgICAgICAgdGhpcy5maWx0ZXJDaGFuZ2VTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgdGhpcy5maWx0ZXJDaGFuZ2VTdWJzY3JpcHRpb24gPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy53aW5kb3dSZXNpemVIYW5kbGVyKSB7XHJcbiAgICAgICAgICAgIHRoaXMud2luZG93UmVzaXplSGFuZGxlcigpO1xyXG4gICAgICAgICAgICB0aGlzLndpbmRvd1Jlc2l6ZUhhbmRsZXIgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGJpbmRFdmVudCgpIHtcclxuICAgICAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGZpbHRlckZpZWxkcyA9IHRoaXMuZmlsdGVyVG9vbGJhclJlZi5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5maWx0ZXItZmllbGQnKTtcclxuICAgICAgICAgICAgdGhpcy5iaW5kRmlsdGVyRmllbGRIYW5kbGVyKGZpbHRlckZpZWxkcyk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBkcm9wZG93bkZpbHRlckZpZWxkcyA9IHRoaXMuZmlsdGVyUGFuZWxUZXh0UmVmLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmZpbHRlci1maWVsZCcpO1xyXG4gICAgICAgICAgICB0aGlzLmJpbmRGaWx0ZXJGaWVsZEhhbmRsZXIoZHJvcGRvd25GaWx0ZXJGaWVsZHMsIGZhbHNlKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGJpbmRGaWx0ZXJGaWVsZEhhbmRsZXIoZmlsdGVyRmllbGRzOiBhbnksIGhpZGVQYW5lbCA9IHRydWUpIHtcclxuICAgICAgICBpZiAoZmlsdGVyRmllbGRzICYmIGZpbHRlckZpZWxkcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgZmlsdGVyRmllbGRzLmZvckVhY2goZmYgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIubGlzdGVuKGZmLCAnY2xpY2snLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVGaWx0ZXJGaWVsZChmZiwgaGlkZVBhbmVsKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSByZW1vdmVGaWx0ZXJGaWVsZChmZjogYW55LCBoaWRlUGFuZWwgPSB0cnVlKSB7XHJcbiAgICAgICAgY29uc3QgZmllbGQgPSBmZi5jbGFzc0xpc3RbMV0ucmVwbGFjZSgnZmlsdGVyLWNvbHVtbi0nLCAnJyk7XHJcbiAgICAgICAgZGVsZXRlIHRoaXMuZGcuY29uZGl0aW9uc1tmaWVsZF07XHJcbiAgICAgICAgdGhpcy5kZnJzLnJlbW92ZUZpbHRlckZpZWxkKGZpZWxkKTtcclxuICAgICAgICBmZi5yZW1vdmUoKTtcclxuICAgICAgICBpZiAoaGlkZVBhbmVsKSB7XHJcbiAgICAgICAgICAgIHRoaXMub3BlbkZpbHRlclBhbmVsID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlRXhwYW5kU3RhdGUoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSB1cGRhdGVFeHBhbmRTdGF0ZSgpIHtcclxuICAgICAgICB0aGlzLnNob3dFeHBhbmQgPSB0aGlzLmlzU2hvd0V4cGFuZCgpO1xyXG4gICAgfVxyXG5cclxuICAgIGlzU2hvd0V4cGFuZCgpIHtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZmlsdGVyVGV4dENvbnRhaW5lcldpZHRoID4gdGhpcy5maWx0ZXJUZXh0UmVhbFdpZHRoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuZmlsdGVyVGV4dFJlYWxXaWR0aCA+IHRoaXMuZmlsdGVyVGV4dENvbnRhaW5lcldpZHRoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY2xlYXJGaWx0ZXIoJGV2ZW50KSB7XHJcbiAgICAgICAgdGhpcy5maWx0ZXJUZXh0ID0gdGhpcy5lbXB0eTtcclxuICAgICAgICB0aGlzLmRncy5vbkNsZWFyRmlsdGVyKCk7XHJcbiAgICAgICAgdGhpcy5kZ3Mub25GaWx0ZXJDaGFuZ2VkLmVtaXQoe30pO1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICByZWZyZXNoRmlsdGVyKCRldmVudCkge1xyXG4gICAgICAgIHRoaXMuZGcuZmlsdGVyRGF0YSgpO1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBzaG93RmlsdGVyVGV4dFBhbmVsKCkge1xyXG4gICAgICAgIHRoaXMub3BlbkZpbHRlclBhbmVsID0gIXRoaXMub3BlbkZpbHRlclBhbmVsO1xyXG4gICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==