import { Injectable, Optional } from '@angular/core';
import { of, empty, EMPTY } from 'rxjs';
import { tap, switchMap, concatMap } from 'rxjs/operators';
import { FrameContext, FieldMetadataUtil } from '@farris/devkit';
import { BefRepositoryUtil } from '@farris/bef';
import { FormLoadingService } from '../form-loading/form-loading.service';
import { FormNotifyService } from '../form-notify.service';
import { LanguageService } from '../languag.service';
import { FormMessageService } from '../form-message.service';
import { FormErrorService } from '../error/form-error.service';
import { BaseDataService } from './base-data.service';
import { TreeUtilFactory } from './tree-table/util/tree-util-factory';
import { TreeRepositoryFactory } from './tree-table/repository/tree-repository-factory';
// tslint:disable: no-string-literal
/**
 * 树数据服务
 */
class TreeDataService extends BaseDataService {
    /**
     * 构造函数
     */
    constructor(frameContext, messageService, loadingService, notifyService, errorService, languageService) {
        super(frameContext);
        this.messageService = messageService;
        this.loadingService = loadingService;
        this.notifyService = notifyService;
        this.errorService = errorService;
        this.languageService = languageService;
        if (!languageService) {
            this.languageService = LanguageService.getInstance();
        }
    }
    /**
     * 分级信息字段名
     */
    get hierarchyInfoKey() {
        return this.virtualRootFrameContext.getParam('hierarchyInfoKey');
    }
    get virtualRootFrameContext() {
        return this.frameContext.getVirtualRootFrameContext();
    }
    /**
     * 加载数据
     */
    load(filters, sorts) {
        const filtersArray = this.parseConditions(filters);
        const sortsArray = this.parseConditions(sorts);
        const correctSelectedNode = this.repository.entityCollection.count() === 0;
        const loadingTimerId = this.loadingService.showLoadingWithDelay(500);
        const query$ = this.repository.getEntities(filtersArray, sortsArray, null, null);
        return query$.pipe(tap(() => {
            // 纠正选中节点
            if (correctSelectedNode === true) {
                const hierarchyType = this.getHierarchyType();
                const treeNodeUtil = TreeUtilFactory.getInstance(hierarchyType);
                if (treeNodeUtil !== null) {
                    treeNodeUtil.selectFirstRootNode(this.bindingData, this.hierarchyInfoKey);
                }
            }
            this.loadingService.hideDelayLoading(loadingTimerId);
        }, (error) => {
            this.loadingService.hideDelayLoading(loadingTimerId);
            this.errorService.exception(this.languageService.loadFailed, error);
        }));
    }
    /**
     * 分层加载数据
     */
    loadByLevel(filters, sorts, frozenCurrentRow) {
        this.setLoadByLevelState(filters, sorts);
        const filtersArray = this.parseConditions(filters);
        const sortsArray = this.parseConditions(sorts);
        // const parentId = this.bindingData.list.currentId;
        const parentId = this.getIdToExpand();
        const correctSelectedNode = this.repository.entityCollection.count() === 0;
        if (frozenCurrentRow === undefined) {
            frozenCurrentRow = false;
        }
        if (typeof frozenCurrentRow !== 'boolean') {
            frozenCurrentRow = frozenCurrentRow === 'true' ? true : false;
        }
        const hierarchyType = this.getHierarchyType();
        const repository = TreeRepositoryFactory.getInstance(hierarchyType);
        if (repository === null) {
            return empty();
        }
        const loadingTimerId = this.loadingService.showLoadingWithDelay(500);
        // 构造分页信息
        const pagination = this.buildPaginationInfo(parentId);
        const reload = this.frameContext.params.get('_RELOAD_CHILDREN_') || false;
        const query$ = repository.loadByParentId(this.repository, this.hierarchyInfoKey, parentId, filtersArray, sortsArray, frozenCurrentRow, pagination, this.frameContext, reload);
        return query$.pipe(tap((entities) => {
            this.frameContext.params.delete('_RELOAD_CHILDREN_');
            // 纠正选中节点
            if (correctSelectedNode === true) {
                const treeNodeUtil = TreeUtilFactory.getInstance(hierarchyType);
                if (treeNodeUtil !== null) {
                    treeNodeUtil.selectFirstRootNode(this.bindingData, this.hierarchyInfoKey);
                }
            }
            const currentRowId = this.bindingData.list.currentItem.primaryKeyValue;
            if (frozenCurrentRow) {
                // 如果上一次选中行为本次加载数据中的一条，则应该重新选中该行
                const containsCurrentRow = entities.find(item => item.primaryValue === currentRowId);
                if (containsCurrentRow) {
                    this.setCurrentId(currentRowId);
                }
                // 原来的当前行不在已经加载的数据中，如展开到第三级，将第三级的某行设为当前行，全部收起，展开第一级
                if (!this.repository.entityCollection.getEntityById(currentRowId)) {
                    const firstChildId = entities && Array.isArray(entities) && entities.length > 0 && entities[0].primaryValue || null;
                    if (firstChildId) {
                        this.setCurrentId(firstChildId);
                    }
                }
            }
            this.loadingService.hideDelayLoading(loadingTimerId);
        }, error => {
            this.loadingService.hideDelayLoading(loadingTimerId);
            this.errorService.exception(this.languageService.loadFailed, error);
        }));
    }
    /**
     * 加载完整树
     * @param virtualPropertyName 虚拟字段
     * @param fullTreeType 是否是完整树加载 0：完整树 1：部分树
     * @param loadType 是否分级加载 0：全部加载 1：分级加载
     * @param filter 过滤条件
     * @param frozenCurrentRow 冻结当前行
     */
    loadFullTree(virtualPropertyName, fullTreeType, loadType, filters, frozenCurrentRow) {
        if (typeof fullTreeType !== 'string') {
            throw new Error('ArgumentError: fullTreeType 不能为空且必须为字符串。');
        }
        if (typeof loadType !== 'string') {
            throw new Error('ArgumentError: loadType 不能为空且必须为字符串。');
        }
        if (frozenCurrentRow === undefined) {
            frozenCurrentRow = false;
        }
        if (typeof frozenCurrentRow !== 'boolean') {
            frozenCurrentRow = frozenCurrentRow === 'true' ? true : false;
        }
        const virtualRootFrameContext = this.virtualRootFrameContext;
        // 还原上次设置的结果集
        virtualRootFrameContext.params.delete('_DEVKIT_expandRowIds');
        virtualRootFrameContext.params.delete('_DEVKIT_selectedRowId');
        virtualRootFrameContext.uiState.setPropertyValue('__DEVKIT__selectedRow', null);
        const filtersArray = this.parseConditions(filters);
        const parentId = this.getIdToExpand();
        const correctSelectedNode = this.repository.entityCollection.count() === 0;
        const hierarchyType = this.getHierarchyType();
        const repository = TreeRepositoryFactory.getInstance(hierarchyType);
        if (repository === null) {
            return EMPTY;
        }
        const loadingTimerId = this.loadingService.showLoadingWithDelay(500);
        const context = {
            frameContext: this.frameContext,
            frozenCurrentRow
        };
        // tslint:disable-next-line: max-line-length
        const query$ = repository.loadFullTree(this.repository, this.hierarchyInfoKey, parentId, virtualPropertyName, fullTreeType, loadType, filtersArray, context);
        return query$.pipe(tap((entities) => {
            const selectedRowId = virtualRootFrameContext.params.get('_DEVKIT_selectedRowId');
            // 纠正选中节点
            if (correctSelectedNode === true || !selectedRowId) {
                const treeNodeUtil = TreeUtilFactory.getInstance(hierarchyType);
                if (treeNodeUtil !== null) {
                    treeNodeUtil.selectFirstRootNode(this.bindingData, this.hierarchyInfoKey);
                }
            }
            const currentRowId = this.bindingData.list.currentItem.primaryKeyValue;
            if (frozenCurrentRow) {
                // 如果上一次选中行为本次加载数据中的一条，则应该重新选中该行
                const containsCurrentRow = entities.find(item => item.primaryValue === currentRowId);
                if (containsCurrentRow) {
                    this.setCurrentId(currentRowId);
                }
                // 原来的当前行不在已经加载的数据中，如展开到第三级，将第三级的某行设为当前行，全部收起，展开第一级
                if (!this.repository.entityCollection.getEntityById(currentRowId) && entities && entities.length > 0) {
                    const firstChildId = entities && Array.isArray(entities) && entities.length > 0 && entities[0].primaryValue || null;
                    if (firstChildId) {
                        this.setCurrentId(firstChildId);
                    }
                }
            }
            this.loadingService.hideDelayLoading(loadingTimerId);
        }, error => {
            this.loadingService.hideDelayLoading(loadingTimerId);
            this.errorService.exception(this.languageService.loadFailed, error);
        }));
    }
    /**
     * 获取最新展开的节点
     */
    getIdToExpand() {
        const expandNodes = this.virtualRootFrameContext.getParam('TREE_LATEST_EXPANDED_ID') || [];
        const idToExpand = expandNodes.pop();
        this.virtualRootFrameContext.setParam('TREE_LATEST_EXPANDED_ID', expandNodes);
        return idToExpand;
    }
    /**
     * 设置最新展开的节点
     */
    setIdToExpand(idToExpand) {
        const expandNodes = this.virtualRootFrameContext.getParam('TREE_LATEST_EXPANDED_ID') || [];
        expandNodes.push(idToExpand);
        this.virtualRootFrameContext.setParam('TREE_LATEST_EXPANDED_ID', expandNodes);
    }
    /**
     * 解析过滤条件
     */
    parseConditions(conditions) {
        const conditionsString = (!conditions || conditions === '') ? '[]' : conditions;
        return JSON.parse(conditionsString);
    }
    /**
     * 新增同级
     */
    addSibling(id) {
        // 设计时id的获取改为从命令参数上获取，但设计时没有参数必填检查，
        // 如果打开表单保存了（即更新了最新的命令构件），但没有配置该参数，可能会传递过来一个空值，
        // 为了兼容此情况，使用当前行id作为id的值
        id = id ? id : this.bindingData.list.currentId;
        // 参数检查
        if (!id || id === 'undefined') {
            id = '';
        }
        // 记录最近一次修改的数据id
        const lastModifiedId = this.bindingData.list.currentId;
        // 获取分级方式
        const hierarchyType = this.getHierarchyType();
        // 执行取数
        const loadingTimerId = this.loadingService.showLoadingWithDelay(500);
        const repository = TreeRepositoryFactory.getInstance(hierarchyType);
        if (!repository) {
            // 错误的分级码
            throw new Error(this.languageService['errorHierarchyKey']);
        }
        const result$ = repository.addSibling(this.repository, id);
        return result$.pipe(tap(() => {
            this.virtualRootFrameContext.setParam('IS_ADD', true);
            this.virtualRootFrameContext.setParam('LAST_MODIFIED_ID', lastModifiedId);
            this.loadingService.hideDelayLoading(loadingTimerId);
        }, error => {
            this.loadingService.hideDelayLoading(loadingTimerId);
            this.errorService.exception(this.languageService.addSiblingFailed, error);
        }));
    }
    /**
     * 新增下级
     */
    addChild(id) {
        // 原因同addSibling的修改
        id = id ? id : this.bindingData.list.currentId;
        // 参数检查
        if (!id) {
            // 请选择父节点
            this.notifyService.warning(this.languageService['plsSelectParentNode'], { hideTitle: true });
            return empty();
        }
        // 记录最近一次修改的数据id
        const lastModifiedId = this.bindingData.list.currentId;
        // 获取分级方式
        const hierarchyType = this.getHierarchyType();
        // 执行取数
        const loadingTimerId = this.loadingService.showLoadingWithDelay(500);
        // 新增的时候，要展开父节点
        this.setIdToExpand(id);
        const reloadChild$ = this.reloadByLevel();
        const repository = TreeRepositoryFactory.getInstance(hierarchyType);
        if (!repository) {
            throw new Error(this.languageService['errorHierarchyKey']);
        }
        const addChild$ = repository.addChild(this.repository, id);
        const result$ = reloadChild$.pipe(switchMap(() => {
            return addChild$;
        }), tap(() => {
            this.virtualRootFrameContext.setParam('IS_ADD', true);
            this.virtualRootFrameContext.setParam('LAST_MODIFIED_ID', lastModifiedId);
            this.loadingService.hideDelayLoading(loadingTimerId);
        }, error => {
            this.loadingService.hideDelayLoading(loadingTimerId);
            this.errorService.exception(this.languageService.addChildFailed, error);
        }));
        return result$;
    }
    /**
     * 批量保存
     */
    save() {
        if (this.messagePipe) {
            this.messagePipe.next({ messageType: 'save' });
        }
        const loadingTimerId = this.loadingService.showLoadingWithDelay(500);
        const save$ = this.repository.applyChanges();
        const result$ = save$.pipe(tap(() => {
            this.loadingService.hideDelayLoading(loadingTimerId);
            this.notifyService.success(this.languageService.saveSuccess, { hideTitle: true });
        }, error => {
            this.loadingService.hideDelayLoading(loadingTimerId);
            this.errorService.exception(this.languageService.multiSaveFailed, error);
        }));
        return result$;
    }
    /**
     * 删除
     */
    remove(id, successMsg) {
        // 原因同addSibling
        id = id ? id : this.bindingData.list.currentId;
        // 参数检查
        if (!id) {
            this.notifyService.warning(this.languageService['plsSelectDeleteData'], { hideTitle: true });
            return empty();
        }
        // 存在子节点不允许删除
        const treeNodesData = this.repository.entityCollection.toJSON();
        const hierarchyType = this.getHierarchyType();
        const treeNodeUtil = TreeUtilFactory.getInstance(hierarchyType);
        if (treeNodeUtil === null) {
            return empty();
        }
        if (treeNodeUtil.hasChildNodes(treeNodesData, this.hierarchyInfoKey, id) === true) {
            this.notifyService.warning(this.languageService['deleteChildFirst'], { hideTitle: true });
            return empty();
        }
        // 确认删除
        const action$ = this.messageService.question(this.languageService.confirmDeletion);
        return action$.pipe(concatMap(result => {
            if (!result) {
                return empty();
            }
            // 获取删除后要设置的节点id
            const nextNodeId = treeNodeUtil.getNextNodeId(treeNodesData, this.hierarchyInfoKey, id);
            // 执行删除
            const loadingTimerId = this.loadingService.showLoadingWithDelay(500);
            const remove$ = this.frameContext.repository.removeById(id);
            return remove$.pipe(tap(() => {
                // 设置选中节点
                treeNodeUtil.selectedNode(this.bindingData, this.hierarchyInfoKey, nextNodeId);
                this.loadingService.hideDelayLoading(loadingTimerId);
                if (successMsg && successMsg.trim()) {
                    this.notifyService.success(successMsg, { hideTitle: true });
                }
                else {
                    this.notifyService.success(this.languageService.deleteSuccess, { hideTitle: true });
                }
                // this.notifyService.success(this.languageService.deleteSuccess, { hideTitle: true });
            }, error => {
                this.loadingService.hideDelayLoading(loadingTimerId);
                this.errorService.exception(this.languageService.deleteFailed, error);
            }));
        }));
    }
    /**
     * 取消时检测未保存记录
     */
    cancel() {
        // 没有变更时直接取消
        // const cardDataService = this.frameContext.injector.get<CardDataService>(CardDataService);
        const befRepository = this.repository;
        const hasUnsavedData = BefRepositoryUtil.isExistUnsaveData(befRepository);
        if (!hasUnsavedData) {
            return this._cancel();
        }
        const confirmResult$ = this.messageService.question(this.languageService['cancelWithoutSave']).pipe(switchMap((ifCancel) => {
            if (ifCancel === false) {
                return EMPTY;
            }
            return this._cancel();
        }));
        return confirmResult$;
    }
    /**
     * 构造分页信息
     * @param parentId parentId
     * @returns
     */
    buildPaginationInfo(parentId) {
        const pagination = { pageIndex: 0, pageSize: 0 };
        const enableNodePagination = this.frameContext.params.get('enableNodePagination');
        if (!parentId) {
            // 一级分页
            const pageSize = this.repository.entityCollection.pageSize || 0;
            const pageIndex = this.repository.entityCollection.pageIndex || 0;
            // 启用了一级分页
            if (pageSize !== 0) {
                pagination.pageSize = pageSize;
                pagination.pageIndex = pageIndex;
            }
        }
        else {
            // 如果未启用节点分页或当前为顶级节点加载，则不处理节点分页
            if (enableNodePagination) {
                const nodePageSize = this.frameContext.params.get('nodePageSize') || 0;
                let nodePageIndex = this.frameContext.params.get(`_NODE_${parentId}_PAGE_INDEX_`);
                if (!nodePageIndex) {
                    this.frameContext.params.set(`_NODE_${parentId}_PAGE_INDEX_`, 1);
                    nodePageIndex = 1;
                }
                pagination.pageIndex = nodePageIndex;
                pagination.pageSize = nodePageSize;
            }
        }
        return pagination;
    }
    /**
     * 取消变更
     */
    _cancel() {
        const loadingTimerId = this.loadingService.showLoadingWithDelay(500);
        const cancel$ = this.repository.cancelChanges();
        return cancel$.pipe(switchMap(() => {
            const isAdd = this.virtualRootFrameContext.getParam('IS_ADD');
            const lastModifiedId = this.virtualRootFrameContext.getParam('LAST_MODIFIED_ID');
            const currentId = this.bindingData.list.currentId;
            if (isAdd === true) {
                this.repository.entityCollection.removeEntityById(currentId);
                // 重置编辑状态
                this.virtualRootFrameContext.setParam('IS_ADD', false);
                if (lastModifiedId) {
                    setTimeout(() => {
                        this.bindingData.list.setCurrentId(lastModifiedId, true, true);
                    }, 0);
                }
                return of(null);
            }
            else {
                return this.repository.updateById(currentId);
            }
        }), tap(() => {
            this.loadingService.hideDelayLoading(loadingTimerId);
        }, (error) => {
            this.loadingService.hideDelayLoading(loadingTimerId);
            this.errorService.exception(this.languageService.cancelFailed, error);
        }));
    }
    /**
     * 检查是否存在下级节点（内部方法，请勿使用）
     */
    hasChildNodes(id, treeNodesData) {
        const treeNodeUtil = this.getTreeNodeUtil();
        if (treeNodeUtil.hasChildNodes(treeNodesData, this.hierarchyInfoKey, id) === true) {
            return true;
        }
        return false;
    }
    /**
     * 计算删除后的当前节点id（内部方法，请勿使用）
     */
    getNextNodeIdAfterRemoving(idToRemove, treeNodesData) {
        const treeNodeUtil = this.getTreeNodeUtil();
        const nextNodeId = treeNodeUtil.getNextNodeId(treeNodesData, this.hierarchyInfoKey, idToRemove);
        return nextNodeId;
    }
    /**
     * 设置删除后的当前节点节点（内部方法，请勿使用）
     */
    setNextNodeAfterRemoving(nextNodeId) {
        const treeNodeUtil = this.getTreeNodeUtil();
        treeNodeUtil.selectedNode(this.bindingData, this.hierarchyInfoKey, nextNodeId);
    }
    /**
     * 设置树的当前行(给完整树使用)
     * @param id id
     */
    setCurrentId(id) {
        id = id || this.frameContext.getVirtualRootFrameContext().uiState['__DEVKIT__selectedRow'] || this.bindingData.list.currentItem.primaryKeyValue;
        this.frameContext.bindingData.list.setCurrentId(id, true, true, true);
    }
    /**
     * 选中树的第一个节点
     */
    selectFirstRow() {
        const hierarchyType = this.getHierarchyType();
        const treeNodeUtil = TreeUtilFactory.getInstance(hierarchyType);
        if (treeNodeUtil !== null) {
            treeNodeUtil.selectFirstRootNode(this.bindingData, this.hierarchyInfoKey);
        }
    }
    /**
     * 获取树节点工具类实例
     */
    getTreeNodeUtil() {
        const hierarchyType = this.getHierarchyType();
        const treeNodeUtil = TreeUtilFactory.getInstance(hierarchyType);
        if (treeNodeUtil === null) {
            throw new Error(`不支持${hierarchyType}类型的分级`);
        }
        return treeNodeUtil;
    }
    /**
     * 记录加载状态
     * @todo：待删除
     */
    setLoadByLevelState(filters, sorts) {
        // @todo：临时处理
        this.virtualRootFrameContext.setParam('isLoadTreeByLevel', true);
        this.virtualRootFrameContext.setParam('loadTreeByLevelFilter', filters);
        this.virtualRootFrameContext.setParam('loadTreeByLevelSort', sorts);
    }
    /**
     * 展开当前节点
     * @todo：待删除
     */
    reloadByLevel() {
        const isLoadByLevel = this.virtualRootFrameContext.getParam('isLoadTreeByLevel');
        if (isLoadByLevel === true) {
            const filters = this.virtualRootFrameContext.getParam('loadTreeByLevelFilter');
            const sorts = this.virtualRootFrameContext.getParam('loadTreeByLevelSort');
            return this.loadByLevel(filters, sorts);
        }
        return of([]);
    }
    getHierarchyType() {
        const ngObjects = FieldMetadataUtil.getNgObjects(this.repository.entityType);
        const hierarchyInfoNgObjectInfo = ngObjects[this.hierarchyInfoKey];
        let hierarchyType = 'path'; // 分级码默认为path，兼容原表单
        if (hierarchyInfoNgObjectInfo.hasOwnProperty('hierarchyType') && hierarchyInfoNgObjectInfo['hierarchyType'] != null) {
            hierarchyType = hierarchyInfoNgObjectInfo['hierarchyType'];
        }
        if (hierarchyType == null || hierarchyType.length < 1) {
            // '分级码配置信息错误'
            throw new Error(this.languageService['incorrectHierarchyConfig']);
        }
        return hierarchyType;
    }
    /**
     * 获取根组件消息管道
     */
    get messagePipe() {
        if (this.frameContext) {
            const appContext = this.frameContext.getFormAppContext() || null;
            if (appContext) {
                return appContext.messagePipe || null;
            }
        }
        return null;
    }
}
TreeDataService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
TreeDataService.ctorParameters = () => [
    { type: FrameContext },
    { type: FormMessageService },
    { type: FormLoadingService },
    { type: FormNotifyService },
    { type: FormErrorService },
    { type: LanguageService, decorators: [{ type: Optional }] }
];
export { TreeDataService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJlZS1kYXRhLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2NvbW1hbmQtc2VydmljZXMvIiwic291cmNlcyI6WyJsaWIvZGF0YS1zZXJ2aWNlcy90cmVlLWRhdGEuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNyRCxPQUFPLEVBQWMsRUFBRSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDcEQsT0FBTyxFQUFFLEdBQUcsRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFM0QsT0FBTyxFQUFVLFlBQVksRUFBRSxpQkFBaUIsRUFBbUIsTUFBTSxnQkFBZ0IsQ0FBQztBQUMxRixPQUFPLEVBQWlCLGlCQUFpQixFQUFFLE1BQU0sYUFBYSxDQUFDO0FBRS9ELE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLHNDQUFzQyxDQUFDO0FBQzFFLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQzNELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUNyRCxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUM3RCxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUUvRCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFFdEQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHFDQUFxQyxDQUFDO0FBQ3RFLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLGlEQUFpRCxDQUFDO0FBQ3hGLG9DQUFvQztBQUVwQzs7R0FFRztBQUNILE1BQ00sZUFBZ0IsU0FBUSxlQUFlO0lBWTNDOztPQUVHO0lBQ0gsWUFDRSxZQUEwQixFQUNsQixjQUFrQyxFQUNsQyxjQUFrQyxFQUNs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RTtRQUNELElBQUksYUFBYSxJQUFJLElBQUksSUFBSSxhQUFhLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUNyRCxjQUFjO1lBQ2QsTUFBTSxJQUFJLEtBQUssQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLDBCQUEwQixDQUFDLENBQUMsQ0FBQztTQUNuRTtRQUNELE9BQU8sYUFBYSxDQUFDO0lBQ3ZCLENBQUM7SUFDRDs7T0FFRztJQUNILElBQVksV0FBVztRQUNyQixJQUFJLElBQUksQ0FBQyxZQUFZLEVBQUU7WUFDckIsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxpQkFBaUIsRUFBRSxJQUFJLElBQUksQ0FBQztZQUNqRSxJQUFJLFVBQVUsRUFBRTtnQkFDZCxPQUFPLFVBQVUsQ0FBQyxXQUFXLElBQUksSUFBSSxDQUFDO2FBQ3ZDO1NBQ0Y7UUFDRCxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7OztZQW5tQkYsVUFBVTs7OztZQWxCTSxZQUFZO1lBTXBCLGtCQUFrQjtZQUhsQixrQkFBa0I7WUFDbEIsaUJBQWlCO1lBR2pCLGdCQUFnQjtZQUZoQixlQUFlLHVCQW1DbkIsUUFBUTs7QUEra0JiLE9BQU8sRUFBRSxlQUFlLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIE9wdGlvbmFsIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IE9ic2VydmFibGUsIG9mLCBlbXB0eSwgRU1QVFkgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgdGFwLCBzd2l0Y2hNYXAsIGNvbmNhdE1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuXHJcbmltcG9ydCB7IEVudGl0eSwgRnJhbWVDb250ZXh0LCBGaWVsZE1ldGFkYXRhVXRpbCwgTmdGaWVsZFByb3BlcnR5IH0gZnJvbSAnQGZhcnJpcy9kZXZraXQnO1xyXG5pbXBvcnQgeyBCZWZSZXBvc2l0b3J5LCBCZWZSZXBvc2l0b3J5VXRpbCB9IGZyb20gJ0BmYXJyaXMvYmVmJztcclxuXHJcbmltcG9ydCB7IEZvcm1Mb2FkaW5nU2VydmljZSB9IGZyb20gJy4uL2Zvcm0tbG9hZGluZy9mb3JtLWxvYWRpbmcuc2VydmljZSc7XHJcbmltcG9ydCB7IEZvcm1Ob3RpZnlTZXJ2aWNlIH0gZnJvbSAnLi4vZm9ybS1ub3RpZnkuc2VydmljZSc7XHJcbmltcG9ydCB7IExhbmd1YWdlU2VydmljZSB9IGZyb20gJy4uL2xhbmd1YWcuc2VydmljZSc7XHJcbmltcG9ydCB7IEZvcm1NZXNzYWdlU2VydmljZSB9IGZyb20gJy4uL2Zvcm0tbWVzc2FnZS5zZXJ2aWNlJztcclxuaW1wb3J0IHsgRm9ybUVycm9yU2VydmljZSB9IGZyb20gJy4uL2Vycm9yL2Zvcm0tZXJyb3Iuc2VydmljZSc7XHJcblxyXG5pbXBvcnQgeyBCYXNlRGF0YVNlcnZpY2UgfSBmcm9tICcuL2Jhc2UtZGF0YS5zZXJ2aWNlJztcclxuaW1wb3J0IHsgRWRpdFN0YXRlVXRpbCB9IGZyb20gJy4vdXRpbHMvaW5kZXgnO1xyXG5pbXBvcnQgeyBUcmVlVXRpbEZhY3RvcnkgfSBmcm9tICcuL3RyZWUtdGFibGUvdXRpbC90cmVlLXV0aWwtZmFjdG9yeSc7XHJcbmltcG9ydCB7IFRyZWVSZXBvc2l0b3J5RmFjdG9yeSB9IGZyb20gJy4vdHJlZS10YWJsZS9yZXBvc2l0b3J5L3RyZWUtcmVwb3NpdG9yeS1mYWN0b3J5JztcclxuLy8gdHNsaW50OmRpc2FibGU6IG5vLXN0cmluZy1saXRlcmFsXHJcblxyXG4vKipcclxuICog5qCR5pWw5o2u5pyN5YqhXHJcbiAqL1xyXG5ASW5qZWN0YWJsZSgpXHJcbmNsYXNzIFRyZWVEYXRhU2VydmljZSBleHRlbmRzIEJhc2VEYXRhU2VydmljZSB7XHJcblxyXG4gIC8qKlxyXG4gICAqIOWIhue6p+S/oeaBr+Wtl+auteWQjVxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0IGhpZXJhcmNoeUluZm9LZXkoKTogc3RyaW5nIHtcclxuICAgIHJldHVybiB0aGlzLnZpcnR1YWxSb290RnJhbWVDb250ZXh0LmdldFBhcmFtKCdoaWVyYXJjaHlJbmZvS2V5Jyk7XHJcbiAgfVxyXG4gIHByaXZhdGUgZ2V0IHZpcnR1YWxSb290RnJhbWVDb250ZXh0KCkge1xyXG4gICAgcmV0dXJuIHRoaXMuZnJhbWVDb250ZXh0LmdldFZpcnR1YWxSb290RnJhbWVDb250ZXh0KCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmnoTpgKDlh73mlbBcclxuICAgKi9cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIGZyYW1lQ29udGV4dDogRnJhbWVDb250ZXh0LFxyXG4gICAgcHJpdmF0ZSBtZXNzYWdlU2VydmljZTogRm9ybU1lc3NhZ2VTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBsb2FkaW5nU2VydmljZTogRm9ybUxvYWRpbmdTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBub3RpZnlTZXJ2aWNlOiBGb3JtTm90aWZ5U2VydmljZSxcclxuICAgIHByaXZhdGUgZXJyb3JTZXJ2aWNlOiBGb3JtRXJyb3JTZXJ2aWNlLFxyXG4gICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSBsYW5ndWFnZVNlcnZpY2U6IExhbmd1YWdlU2VydmljZVxyXG4gICkge1xyXG4gICAgc3VwZXIoZnJhbWVDb250ZXh0KTtcclxuICAgIGlmICghbGFuZ3VhZ2VTZXJ2aWNlKSB7XHJcbiAgICAgIHRoaXMubGFuZ3VhZ2VTZXJ2aWNlID0gTGFuZ3VhZ2VTZXJ2aWNlLmdldEluc3RhbmNlKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDliqDovb3mlbDmja5cclxuICAgKi9cclxuICBwdWJsaWMgbG9hZChmaWx0ZXJzPzogc3RyaW5nLCBzb3J0cz86IHN0cmluZyk6IE9ic2VydmFibGU8RW50aXR5W10+IHtcclxuICAgIGNvbnN0IGZpbHRlcnNBcnJheSA9IHRoaXMucGFyc2VDb25kaXRpb25zKGZpbHRlcnMpO1xyXG4gICAgY29uc3Qgc29ydHNBcnJheSA9IHRoaXMucGFyc2VDb25kaXRpb25zKHNvcnRzKTtcclxuICAgIGNvbnN0IGNvcnJlY3RTZWxlY3RlZE5vZGUgPSB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5jb3VudCgpID09PSAwO1xyXG5cclxuICAgIGNvbnN0IGxvYWRpbmdUaW1lcklkID0gdGhpcy5sb2FkaW5nU2VydmljZS5zaG93TG9hZGluZ1dpdGhEZWxheSg1MDApO1xyXG4gICAgY29uc3QgcXVlcnkkID0gdGhpcy5yZXBvc2l0b3J5LmdldEVudGl0aWVzKGZpbHRlcnNBcnJheSwgc29ydHNBcnJheSwgbnVsbCwgbnVsbCk7XHJcbiAgICByZXR1cm4gcXVlcnkkLnBpcGUoXHJcbiAgICAgIHRhcChcclxuICAgICAgICAoKSA9PiB7XHJcblxyXG4gICAgICAgICAgLy8g57qg5q2j6YCJ5Lit6IqC54K5XHJcbiAgICAgICAgICBpZiAoY29ycmVjdFNlbGVjdGVkTm9kZSA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICBjb25zdCBoaWVyYXJjaHlUeXBlID0gdGhpcy5nZXRIaWVyYXJjaHlUeXBlKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHRyZWVOb2RlVXRpbCA9IFRyZWVVdGlsRmFjdG9yeS5nZXRJbnN0YW5jZShoaWVyYXJjaHlUeXBlKTtcclxuICAgICAgICAgICAgaWYgKHRyZWVOb2RlVXRpbCAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgIHRyZWVOb2RlVXRpbC5zZWxlY3RGaXJzdFJvb3ROb2RlKHRoaXMuYmluZGluZ0RhdGEsIHRoaXMuaGllcmFyY2h5SW5mb0tleSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICB0aGlzLmxvYWRpbmdTZXJ2aWNlLmhpZGVEZWxheUxvYWRpbmcobG9hZGluZ1RpbWVySWQpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgKGVycm9yOiBhbnkpID0+IHtcclxuICAgICAgICAgIHRoaXMubG9hZGluZ1NlcnZpY2UuaGlkZURlbGF5TG9hZGluZyhsb2FkaW5nVGltZXJJZCk7XHJcbiAgICAgICAgICB0aGlzLmVycm9yU2VydmljZS5leGNlcHRpb24odGhpcy5sYW5ndWFnZVNlcnZpY2UubG9hZEZhaWxlZCwgZXJyb3IpO1xyXG4gICAgICAgIH1cclxuICAgICAgKVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWIhuWxguWKoOi9veaVsOaNrlxyXG4gICAqL1xyXG4gIHB1YmxpYyBsb2FkQnlMZXZlbChmaWx0ZXJzPzogc3RyaW5nLCBzb3J0cz86IHN0cmluZywgZnJvemVuQ3VycmVudFJvdz86IGJvb2xlYW4gfCBzdHJpbmcpOiBPYnNlcnZhYmxlPEVudGl0eVtdPiB7XHJcbiAgICB0aGlzLnNldExvYWRCeUxldmVsU3RhdGUoZmlsdGVycywgc29ydHMpO1xyXG4gICAgY29uc3QgZmlsdGVyc0FycmF5ID0gdGhpcy5wYXJzZUNvbmRpdGlvbnMoZmlsdGVycyk7XHJcbiAgICBjb25zdCBzb3J0c0FycmF5ID0gdGhpcy5wYXJzZUNvbmRpdGlvbnMoc29ydHMpO1xyXG4gICAgLy8gY29uc3QgcGFyZW50SWQgPSB0aGlzLmJpbmRpbmdEYXRhLmxpc3QuY3VycmVudElkO1xyXG4gICAgY29uc3QgcGFyZW50SWQgPSB0aGlzLmdldElkVG9FeHBhbmQoKTtcclxuICAgIGNvbnN0IGNvcnJlY3RTZWxlY3RlZE5vZGUgPSB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5jb3VudCgpID09PSAwO1xyXG4gICAgaWYgKGZyb3plbkN1cnJlbnRSb3cgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICBmcm96ZW5DdXJyZW50Um93ID0gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBpZiAodHlwZW9mIGZyb3plbkN1cnJlbnRSb3cgIT09ICdib29sZWFuJykge1xyXG4gICAgICBmcm96ZW5DdXJyZW50Um93ID0gZnJvemVuQ3VycmVudFJvdyA9PT0gJ3RydWUnID8gdHJ1ZSA6IGZhbHNlO1xyXG4gICAgfVxyXG4gICAgY29uc3QgaGllcmFyY2h5VHlwZSA9IHRoaXMuZ2V0SGllcmFyY2h5VHlwZSgpO1xyXG4gICAgY29uc3QgcmVwb3NpdG9yeSA9IFRyZWVSZXBvc2l0b3J5RmFjdG9yeS5nZXRJbnN0YW5jZShoaWVyYXJjaHlUeXBlKTtcclxuXHJcbiAgICBpZiAocmVwb3NpdG9yeSA9PT0gbnVsbCkge1xyXG4gICAgICByZXR1cm4gZW1wdHkoKTtcclxuICAgIH1cclxuICAgIGNvbnN0IGxvYWRpbmdUaW1lcklkID0gdGhpcy5sb2FkaW5nU2VydmljZS5zaG93TG9hZGluZ1dpdGhEZWxheSg1MDApO1xyXG4gICAgLy8g5p6E6YCg5YiG6aG15L+h5oGvXHJcbiAgICBjb25zdCBwYWdpbmF0aW9uID0gdGhpcy5idWlsZFBhZ2luYXRpb25JbmZvKHBhcmVudElkKTtcclxuICAgIGNvbnN0IHJlbG9hZCA9IHRoaXMuZnJhbWVDb250ZXh0LnBhcmFtcy5nZXQoJ19SRUxPQURfQ0hJTERSRU5fJykgfHwgZmFsc2U7XHJcbiAgICBjb25zdCBxdWVyeSQgPSByZXBvc2l0b3J5LmxvYWRCeVBhcmVudElkKHRoaXMucmVwb3NpdG9yeSwgdGhpcy5oaWVyYXJjaHlJbmZvS2V5LCBwYXJlbnRJZCwgZmlsdGVyc0FycmF5LCBzb3J0c0FycmF5LCBmcm96ZW5DdXJyZW50Um93LCBwYWdpbmF0aW9uLCB0aGlzLmZyYW1lQ29udGV4dCwgcmVsb2FkKTtcclxuICAgIHJldHVybiBxdWVyeSQucGlwZShcclxuICAgICAgdGFwKFxyXG4gICAgICAgIChlbnRpdGllczogRW50aXR5W10pID0+IHtcclxuICAgICAgICAgIHRoaXMuZnJhbWVDb250ZXh0LnBhcmFtcy5kZWxldGUoJ19SRUxPQURfQ0hJTERSRU5fJyk7XHJcbiAgICAgICAgICAvLyDnuqDmraPpgInkuK3oioLngrlcclxuICAgICAgICAgIGlmIChjb3JyZWN0U2VsZWN0ZWROb2RlID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRyZWVOb2RlVXRpbCA9IFRyZWVVdGlsRmFjdG9yeS5nZXRJbnN0YW5jZShoaWVyYXJjaHlUeXBlKTtcclxuICAgICAgICAgICAgaWYgKHRyZWVOb2RlVXRpbCAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgIHRyZWVOb2RlVXRpbC5zZWxlY3RGaXJzdFJvb3ROb2RlKHRoaXMuYmluZGluZ0RhdGEsIHRoaXMuaGllcmFyY2h5SW5mb0tleSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGNvbnN0IGN1cnJlbnRSb3dJZCA9IHRoaXMuYmluZGluZ0RhdGEubGlzdC5jdXJyZW50SXRlbS5wcmltYXJ5S2V5VmFsdWU7XHJcbiAgICAgICAgICBpZiAoZnJvemVuQ3VycmVudFJvdykge1xyXG4gICAgICAgICAgICAvLyDlpoLmnpzkuIrkuIDmrKHpgInkuK3ooYzkuLrmnKzmrKHliqDovb3mlbDmja7kuK3nmoTkuIDmnaHvvIzliJnlupTor6Xph43mlrDpgInkuK3or6XooYxcclxuICAgICAgICAgICAgY29uc3QgY29udGFpbnNDdXJyZW50Um93ID0gZW50aXRpZXMuZmluZChpdGVtID0+IGl0ZW0ucHJpbWFyeVZhbHVlID09PSBjdXJyZW50Um93SWQpO1xyXG4gICAgICAgICAgICBpZiAoY29udGFpbnNDdXJyZW50Um93KSB7XHJcbiAgICAgICAgICAgICAgdGhpcy5zZXRDdXJyZW50SWQoY3VycmVudFJvd0lkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyDljp/mnaXnmoTlvZPliY3ooYzkuI3lnKjlt7Lnu4/liqDovb3nmoTmlbDmja7kuK3vvIzlpoLlsZXlvIDliLDnrKzkuInnuqfvvIzlsIbnrKzkuInnuqfnmoTmn5DooYzorr7kuLrlvZPliY3ooYzvvIzlhajpg6jmlLbotbfvvIzlsZXlvIDnrKzkuIDnuqdcclxuICAgICAgICAgICAgaWYgKCF0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5nZXRFbnRpdHlCeUlkKGN1cnJlbnRSb3dJZCkpIHtcclxuICAgICAgICAgICAgICBjb25zdCBmaXJzdENoaWxkSWQgPSBlbnRpdGllcyAmJiBBcnJheS5pc0FycmF5KGVudGl0aWVzKSAmJiBlbnRpdGllcy5sZW5ndGggPiAwICYmIGVudGl0aWVzWzBdLnByaW1hcnlWYWx1ZSB8fCBudWxsO1xyXG4gICAgICAgICAgICAgIGlmIChmaXJzdENoaWxkSWQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2V0Q3VycmVudElkKGZpcnN0Q2hpbGRJZCk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICB0aGlzLmxvYWRpbmdTZXJ2aWNlLmhpZGVEZWxheUxvYWRpbmcobG9hZGluZ1RpbWVySWQpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZXJyb3IgPT4ge1xyXG4gICAgICAgICAgdGhpcy5sb2FkaW5nU2VydmljZS5oaWRlRGVsYXlMb2FkaW5nKGxvYWRpbmdUaW1lcklkKTtcclxuICAgICAgICAgIHRoaXMuZXJyb3JTZXJ2aWNlLmV4Y2VwdGlvbih0aGlzLmxhbmd1YWdlU2VydmljZS5sb2FkRmFpbGVkLCBlcnJvcik7XHJcbiAgICAgICAgfVxyXG4gICAgICApXHJcbiAgICApO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDliqDovb3lrozmlbTmoJFcclxuICAgKiBAcGFyYW0gdmlydHVhbFByb3BlcnR5TmFtZSDomZrmi5/lrZfmrrVcclxuICAgKiBAcGFyYW0gZnVsbFRyZWVUeXBlIOaYr+WQpuaYr+WujOaVtOagkeWKoOi9vSAw77ya5a6M5pW05qCRIDHvvJrpg6jliIbmoJFcclxuICAgKiBAcGFyYW0gbG9hZFR5cGUg5piv5ZCm5YiG57qn5Yqg6L29IDDvvJrlhajpg6jliqDovb0gMe+8muWIhue6p+WKoOi9vVxyXG4gICAqIEBwYXJhbSBmaWx0ZXIg6L+H5ruk5p2h5Lu2XHJcbiAgICogQHBhcmFtIGZyb3plbkN1cnJlbnRSb3cg5Ya757uT5b2T5YmN6KGMXHJcbiAgICovXHJcbiAgcHVibGljIGxvYWRGdWxsVHJlZSh2aXJ0dWFsUHJvcGVydHlOYW1lOiBzdHJpbmcsIGZ1bGxUcmVlVHlwZTogc3RyaW5nLCBsb2FkVHlwZTogc3RyaW5nLCBmaWx0ZXJzOiBzdHJpbmcsIGZyb3plbkN1cnJlbnRSb3c/OiBib29sZWFuIHwgc3RyaW5nKTogT2JzZXJ2YWJsZTxFbnRpdHlbXT4ge1xyXG4gICAgaWYgKHR5cGVvZiBmdWxsVHJlZVR5cGUgIT09ICdzdHJpbmcnKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignQXJndW1lbnRFcnJvcjogZnVsbFRyZWVUeXBlIOS4jeiDveS4uuepuuS4lOW/hemhu+S4uuWtl+espuS4suOAgicpO1xyXG4gICAgfVxyXG4gICAgaWYgKHR5cGVvZiBsb2FkVHlwZSAhPT0gJ3N0cmluZycpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdBcmd1bWVudEVycm9yOiBsb2FkVHlwZSDkuI3og73kuLrnqbrkuJTlv4XpobvkuLrlrZfnrKbkuLLjgIInKTtcclxuICAgIH1cclxuICAgIGlmIChmcm96ZW5DdXJyZW50Um93ID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgZnJvemVuQ3VycmVudFJvdyA9IGZhbHNlO1xyXG4gICAgfVxyXG4gICAgaWYgKHR5cGVvZiBmcm96ZW5DdXJyZW50Um93ICE9PSAnYm9vbGVhbicpIHtcclxuICAgICAgZnJvemVuQ3VycmVudFJvdyA9IGZyb3plbkN1cnJlbnRSb3cgPT09ICd0cnVlJyA/IHRydWUgOiBmYWxzZTtcclxuICAgIH1cclxuICAgIGNvbnN0IHZpcnR1YWxSb290RnJhbWVDb250ZXh0ID0gdGhpcy52aXJ0dWFsUm9vdEZyYW1lQ29udGV4dDtcclxuICAgIC8vIOi/mOWOn+S4iuasoeiuvue9rueahOe7k+aenOmbhlxyXG4gICAgdmlydHVhbFJvb3RGcmFtZUNvbnRleHQucGFyYW1zLmRlbGV0ZSgnX0RFVktJVF9leHBhbmRSb3dJZHMnKTtcclxuICAgIHZpcnR1YWxSb290RnJhbWVDb250ZXh0LnBhcmFtcy5kZWxldGUoJ19ERVZLSVRfc2VsZWN0ZWRSb3dJZCcpO1xyXG4gICAgdmlydHVhbFJvb3RGcmFtZUNvbnRleHQudWlTdGF0ZS5zZXRQcm9wZXJ0eVZhbHVlKCdfX0RFVktJVF9fc2VsZWN0ZWRSb3cnLCBudWxsKTtcclxuICAgIGNvbnN0IGZpbHRlcnNBcnJheSA9IHRoaXMucGFyc2VDb25kaXRpb25zKGZpbHRlcnMpO1xyXG4gICAgY29uc3QgcGFyZW50SWQgPSB0aGlzLmdldElkVG9FeHBhbmQoKTtcclxuICAgIGNvbnN0IGNvcnJlY3RTZWxlY3RlZE5vZGUgPSB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5jb3VudCgpID09PSAwO1xyXG4gICAgY29uc3QgaGllcmFyY2h5VHlwZSA9IHRoaXMuZ2V0SGllcmFyY2h5VHlwZSgpO1xyXG4gICAgY29uc3QgcmVwb3NpdG9yeSA9IFRyZWVSZXBvc2l0b3J5RmFjdG9yeS5nZXRJbnN0YW5jZShoaWVyYXJjaHlUeXBlKTtcclxuXHJcbiAgICBpZiAocmVwb3NpdG9yeSA9PT0gbnVsbCkge1xyXG4gICAgICByZXR1cm4gRU1QVFk7XHJcbiAgICB9XHJcbiAgICBjb25zdCBsb2FkaW5nVGltZXJJZCA9IHRoaXMubG9hZGluZ1NlcnZpY2Uuc2hvd0xvYWRpbmdXaXRoRGVsYXkoNTAwKTtcclxuICAgIGNvbnN0IGNvbnRleHQgPSB7XHJcbiAgICAgIGZyYW1lQ29udGV4dDogdGhpcy5mcmFtZUNvbnRleHQsXHJcbiAgICAgIGZyb3plbkN1cnJlbnRSb3dcclxuICAgIH07XHJcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IG1heC1saW5lLWxlbmd0aFxyXG4gICAgY29uc3QgcXVlcnkkID0gcmVwb3NpdG9yeS5sb2FkRnVsbFRyZWUodGhpcy5yZXBvc2l0b3J5LCB0aGlzLmhpZXJhcmNoeUluZm9LZXksIHBhcmVudElkLCB2aXJ0dWFsUHJvcGVydHlOYW1lLCBmdWxsVHJlZVR5cGUsIGxvYWRUeXBlLCBmaWx0ZXJzQXJyYXksIGNvbnRleHQpO1xyXG4gICAgcmV0dXJuIHF1ZXJ5JC5waXBlKFxyXG4gICAgICB0YXAoXHJcbiAgICAgICAgKGVudGl0aWVzOiBFbnRpdHlbXSkgPT4ge1xyXG4gICAgICAgICAgY29uc3Qgc2VsZWN0ZWRSb3dJZCA9IHZpcnR1YWxSb290RnJhbWVDb250ZXh0LnBhcmFtcy5nZXQoJ19ERVZLSVRfc2VsZWN0ZWRSb3dJZCcpO1xyXG4gICAgICAgICAgLy8g57qg5q2j6YCJ5Lit6IqC54K5XHJcbiAgICAgICAgICBpZiAoY29ycmVjdFNlbGVjdGVkTm9kZSA9PT0gdHJ1ZSB8fCAhc2VsZWN0ZWRSb3dJZCkge1xyXG4gICAgICAgICAgICBjb25zdCB0cmVlTm9kZVV0aWwgPSBUcmVlVXRpbEZhY3RvcnkuZ2V0SW5zdGFuY2UoaGllcmFyY2h5VHlwZSk7XHJcbiAgICAgICAgICAgIGlmICh0cmVlTm9kZVV0aWwgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICB0cmVlTm9kZVV0aWwuc2VsZWN0Rmlyc3RSb290Tm9kZSh0aGlzLmJpbmRpbmdEYXRhLCB0aGlzLmhpZXJhcmNoeUluZm9LZXkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBjb25zdCBjdXJyZW50Um93SWQgPSB0aGlzLmJpbmRpbmdEYXRhLmxpc3QuY3VycmVudEl0ZW0ucHJpbWFyeUtleVZhbHVlO1xyXG4gICAgICAgICAgaWYgKGZyb3plbkN1cnJlbnRSb3cpIHtcclxuICAgICAgICAgICAgLy8g5aaC5p6c5LiK5LiA5qyh6YCJ5Lit6KGM5Li65pys5qyh5Yqg6L295pWw5o2u5Lit55qE5LiA5p2h77yM5YiZ5bqU6K+l6YeN5paw6YCJ5Lit6K+l6KGMXHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5zQ3VycmVudFJvdyA9IGVudGl0aWVzLmZpbmQoaXRlbSA9PiBpdGVtLnByaW1hcnlWYWx1ZSA9PT0gY3VycmVudFJvd0lkKTtcclxuICAgICAgICAgICAgaWYgKGNvbnRhaW5zQ3VycmVudFJvdykge1xyXG4gICAgICAgICAgICAgIHRoaXMuc2V0Q3VycmVudElkKGN1cnJlbnRSb3dJZCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8g5Y6f5p2l55qE5b2T5YmN6KGM5LiN5Zyo5bey57uP5Yqg6L2955qE5pWw5o2u5Lit77yM5aaC5bGV5byA5Yiw56ys5LiJ57qn77yM5bCG56ys5LiJ57qn55qE5p+Q6KGM6K6+5Li65b2T5YmN6KGM77yM5YWo6YOo5pS26LW377yM5bGV5byA56ys5LiA57qnXHJcbiAgICAgICAgICAgIGlmICghdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24uZ2V0RW50aXR5QnlJZChjdXJyZW50Um93SWQpICYmIGVudGl0aWVzICYmIGVudGl0aWVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICBjb25zdCBmaXJzdENoaWxkSWQgPSBlbnRpdGllcyAmJiBBcnJheS5pc0FycmF5KGVudGl0aWVzKSAmJiBlbnRpdGllcy5sZW5ndGggPiAwICYmIGVudGl0aWVzWzBdLnByaW1hcnlWYWx1ZSB8fCBudWxsO1xyXG4gICAgICAgICAgICAgIGlmIChmaXJzdENoaWxkSWQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2V0Q3VycmVudElkKGZpcnN0Q2hpbGRJZCk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICB0aGlzLmxvYWRpbmdTZXJ2aWNlLmhpZGVEZWxheUxvYWRpbmcobG9hZGluZ1RpbWVySWQpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZXJyb3IgPT4ge1xyXG4gICAgICAgICAgdGhpcy5sb2FkaW5nU2VydmljZS5oaWRlRGVsYXlMb2FkaW5nKGxvYWRpbmdUaW1lcklkKTtcclxuICAgICAgICAgIHRoaXMuZXJyb3JTZXJ2aWNlLmV4Y2VwdGlvbih0aGlzLmxhbmd1YWdlU2VydmljZS5sb2FkRmFpbGVkLCBlcnJvcik7XHJcbiAgICAgICAgfVxyXG4gICAgICApXHJcbiAgICApO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDojrflj5bmnIDmlrDlsZXlvIDnmoToioLngrlcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0SWRUb0V4cGFuZCgpIHtcclxuICAgIGNvbnN0IGV4cGFuZE5vZGVzID0gdGhpcy52aXJ0dWFsUm9vdEZyYW1lQ29udGV4dC5nZXRQYXJhbSgnVFJFRV9MQVRFU1RfRVhQQU5ERURfSUQnKSB8fCBbXTtcclxuICAgIGNvbnN0IGlkVG9FeHBhbmQgPSBleHBhbmROb2Rlcy5wb3AoKTtcclxuICAgIHRoaXMudmlydHVhbFJvb3RGcmFtZUNvbnRleHQuc2V0UGFyYW0oJ1RSRUVfTEFURVNUX0VYUEFOREVEX0lEJywgZXhwYW5kTm9kZXMpO1xyXG4gICAgcmV0dXJuIGlkVG9FeHBhbmQ7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDorr7nva7mnIDmlrDlsZXlvIDnmoToioLngrlcclxuICAgKi9cclxuICBwdWJsaWMgc2V0SWRUb0V4cGFuZChpZFRvRXhwYW5kOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgIGNvbnN0IGV4cGFuZE5vZGVzID0gdGhpcy52aXJ0dWFsUm9vdEZyYW1lQ29udGV4dC5nZXRQYXJhbSgnVFJFRV9MQVRFU1RfRVhQQU5ERURfSUQnKSB8fCBbXTtcclxuICAgIGV4cGFuZE5vZGVzLnB1c2goaWRUb0V4cGFuZCk7XHJcbiAgICB0aGlzLnZpcnR1YWxSb290RnJhbWVDb250ZXh0LnNldFBhcmFtKCdUUkVFX0xBVEVTVF9FWFBBTkRFRF9JRCcsIGV4cGFuZE5vZGVzKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOino+aekOi/h+a7pOadoeS7tlxyXG4gICAqL1xyXG4gIHB1YmxpYyBwYXJzZUNvbmRpdGlvbnMoY29uZGl0aW9ucz86IHN0cmluZyk6IGFueVtdIHtcclxuICAgIGNvbnN0IGNvbmRpdGlvbnNTdHJpbmcgPSAoIWNvbmRpdGlvbnMgfHwgY29uZGl0aW9ucyA9PT0gJycpID8gJ1tdJyA6IGNvbmRpdGlvbnM7XHJcbiAgICByZXR1cm4gSlNPTi5wYXJzZShjb25kaXRpb25zU3RyaW5nKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaWsOWinuWQjOe6p1xyXG4gICAqL1xyXG4gIHB1YmxpYyBhZGRTaWJsaW5nKGlkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG5cclxuICAgIC8vIOiuvuiuoeaXtmlk55qE6I635Y+W5pS55Li65LuO5ZG95Luk5Y+C5pWw5LiK6I635Y+W77yM5L2G6K6+6K6h5pe25rKh5pyJ5Y+C5pWw5b+F5aGr5qOA5p+l77yMXHJcbiAgICAvLyDlpoLmnpzmiZPlvIDooajljZXkv53lrZjkuobvvIjljbPmm7TmlrDkuobmnIDmlrDnmoTlkb3ku6TmnoTku7bvvInvvIzkvYbmsqHmnInphY3nva7or6Xlj4LmlbDvvIzlj6/og73kvJrkvKDpgJLov4fmnaXkuIDkuKrnqbrlgLzvvIxcclxuICAgIC8vIOS4uuS6huWFvOWuueatpOaDheWGte+8jOS9v+eUqOW9k+WJjeihjGlk5L2c5Li6aWTnmoTlgLxcclxuICAgIGlkID0gaWQgPyBpZCA6IHRoaXMuYmluZGluZ0RhdGEubGlzdC5jdXJyZW50SWQ7XHJcblxyXG4gICAgLy8g5Y+C5pWw5qOA5p+lXHJcbiAgICBpZiAoIWlkIHx8IGlkID09PSAndW5kZWZpbmVkJykge1xyXG4gICAgICBpZCA9ICcnO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOiusOW9leacgOi/keS4gOasoeS/ruaUueeahOaVsOaNrmlkXHJcbiAgICBjb25zdCBsYXN0TW9kaWZpZWRJZCA9IHRoaXMuYmluZGluZ0RhdGEubGlzdC5jdXJyZW50SWQ7XHJcbiAgICAvLyDojrflj5bliIbnuqfmlrnlvI9cclxuICAgIGNvbnN0IGhpZXJhcmNoeVR5cGU6IHN0cmluZyA9IHRoaXMuZ2V0SGllcmFyY2h5VHlwZSgpO1xyXG4gICAgLy8g5omn6KGM5Y+W5pWwXHJcbiAgICBjb25zdCBsb2FkaW5nVGltZXJJZCA9IHRoaXMubG9hZGluZ1NlcnZpY2Uuc2hvd0xvYWRpbmdXaXRoRGVsYXkoNTAwKTtcclxuICAgIGNvbnN0IHJlcG9zaXRvcnkgPSBUcmVlUmVwb3NpdG9yeUZhY3RvcnkuZ2V0SW5zdGFuY2UoaGllcmFyY2h5VHlwZSk7XHJcbiAgICBpZiAoIXJlcG9zaXRvcnkpIHtcclxuICAgICAgLy8g6ZSZ6K+v55qE5YiG57qn56CBXHJcbiAgICAgIHRocm93IG5ldyBFcnJvcih0aGlzLmxhbmd1YWdlU2VydmljZVsnZXJyb3JIaWVyYXJjaHlLZXknXSk7XHJcbiAgICB9XHJcbiAgICBjb25zdCByZXN1bHQkID0gcmVwb3NpdG9yeS5hZGRTaWJsaW5nKHRoaXMucmVwb3NpdG9yeSwgaWQpO1xyXG4gICAgcmV0dXJuIHJlc3VsdCQucGlwZShcclxuICAgICAgdGFwKFxyXG4gICAgICAgICgpID0+IHtcclxuICAgICAgICAgIHRoaXMudmlydHVhbFJvb3RGcmFtZUNvbnRleHQuc2V0UGFyYW0oJ0lTX0FERCcsIHRydWUpO1xyXG4gICAgICAgICAgdGhpcy52aXJ0dWFsUm9vdEZyYW1lQ29udGV4dC5zZXRQYXJhbSgnTEFTVF9NT0RJRklFRF9JRCcsIGxhc3RNb2RpZmllZElkKTtcclxuICAgICAgICAgIHRoaXMubG9hZGluZ1NlcnZpY2UuaGlkZURlbGF5TG9hZGluZyhsb2FkaW5nVGltZXJJZCk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlcnJvciA9PiB7XHJcbiAgICAgICAgICB0aGlzLmxvYWRpbmdTZXJ2aWNlLmhpZGVEZWxheUxvYWRpbmcobG9hZGluZ1RpbWVySWQpO1xyXG4gICAgICAgICAgdGhpcy5lcnJvclNlcnZpY2UuZXhjZXB0aW9uKHRoaXMubGFuZ3VhZ2VTZXJ2aWNlLmFkZFNpYmxpbmdGYWlsZWQsIGVycm9yKTtcclxuICAgICAgICB9XHJcbiAgICAgIClcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmlrDlop7kuIvnuqdcclxuICAgKi9cclxuICBwdWJsaWMgYWRkQ2hpbGQoaWQ6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XHJcblxyXG4gICAgLy8g5Y6f5Zug5ZCMYWRkU2libGluZ+eahOS/ruaUuVxyXG4gICAgaWQgPSBpZCA/IGlkIDogdGhpcy5iaW5kaW5nRGF0YS5saXN0LmN1cnJlbnRJZDtcclxuXHJcbiAgICAvLyDlj4LmlbDmo4Dmn6VcclxuICAgIGlmICghaWQpIHtcclxuICAgICAgLy8g6K+36YCJ5oup54i26IqC54K5XHJcbiAgICAgIHRoaXMubm90aWZ5U2VydmljZS53YXJuaW5nKHRoaXMubGFuZ3VhZ2VTZXJ2aWNlWydwbHNTZWxlY3RQYXJlbnROb2RlJ10sIHsgaGlkZVRpdGxlOiB0cnVlIH0pO1xyXG4gICAgICByZXR1cm4gZW1wdHkoKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyDorrDlvZXmnIDov5HkuIDmrKHkv67mlLnnmoTmlbDmja5pZFxyXG4gICAgY29uc3QgbGFzdE1vZGlmaWVkSWQgPSB0aGlzLmJpbmRpbmdEYXRhLmxpc3QuY3VycmVudElkO1xyXG4gICAgLy8g6I635Y+W5YiG57qn5pa55byPXHJcbiAgICBjb25zdCBoaWVyYXJjaHlUeXBlID0gdGhpcy5nZXRIaWVyYXJjaHlUeXBlKCk7XHJcbiAgICAvLyDmiafooYzlj5bmlbBcclxuICAgIGNvbnN0IGxvYWRpbmdUaW1lcklkID0gdGhpcy5sb2FkaW5nU2VydmljZS5zaG93TG9hZGluZ1dpdGhEZWxheSg1MDApO1xyXG5cclxuICAgIC8vIOaWsOWinueahOaXtuWAme+8jOimgeWxleW8gOeItuiKgueCuVxyXG4gICAgdGhpcy5zZXRJZFRvRXhwYW5kKGlkKTtcclxuICAgIGNvbnN0IHJlbG9hZENoaWxkJCA9IHRoaXMucmVsb2FkQnlMZXZlbCgpO1xyXG5cclxuICAgIGNvbnN0IHJlcG9zaXRvcnkgPSBUcmVlUmVwb3NpdG9yeUZhY3RvcnkuZ2V0SW5zdGFuY2UoaGllcmFyY2h5VHlwZSk7XHJcbiAgICBpZiAoIXJlcG9zaXRvcnkpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKHRoaXMubGFuZ3VhZ2VTZXJ2aWNlWydlcnJvckhpZXJhcmNoeUtleSddKTtcclxuICAgIH1cclxuICAgIGNvbnN0IGFkZENoaWxkJCA9IHJlcG9zaXRvcnkuYWRkQ2hpbGQodGhpcy5yZXBvc2l0b3J5LCBpZCk7XHJcbiAgICBjb25zdCByZXN1bHQkID0gcmVsb2FkQ2hpbGQkLnBpcGUoXHJcbiAgICAgIHN3aXRjaE1hcCgoKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIGFkZENoaWxkJDtcclxuICAgICAgfSksXHJcbiAgICAgIHRhcChcclxuICAgICAgICAoKSA9PiB7XHJcbiAgICAgICAgICB0aGlzLnZpcnR1YWxSb290RnJhbWVDb250ZXh0LnNldFBhcmFtKCdJU19BREQnLCB0cnVlKTtcclxuICAgICAgICAgIHRoaXMudmlydHVhbFJvb3RGcmFtZUNvbnRleHQuc2V0UGFyYW0oJ0xBU1RfTU9ESUZJRURfSUQnLCBsYXN0TW9kaWZpZWRJZCk7XHJcbiAgICAgICAgICB0aGlzLmxvYWRpbmdTZXJ2aWNlLmhpZGVEZWxheUxvYWRpbmcobG9hZGluZ1RpbWVySWQpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZXJyb3IgPT4ge1xyXG4gICAgICAgICAgdGhpcy5sb2FkaW5nU2VydmljZS5oaWRlRGVsYXlMb2FkaW5nKGxvYWRpbmdUaW1lcklkKTtcclxuICAgICAgICAgIHRoaXMuZXJyb3JTZXJ2aWNlLmV4Y2VwdGlvbih0aGlzLmxhbmd1YWdlU2VydmljZS5hZGRDaGlsZEZhaWxlZCwgZXJyb3IpO1xyXG4gICAgICAgIH1cclxuICAgICAgKVxyXG4gICAgKTtcclxuICAgIHJldHVybiByZXN1bHQkO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmibnph4/kv53lrZhcclxuICAgKi9cclxuICBwdWJsaWMgc2F2ZSgpOiBPYnNlcnZhYmxlPGJvb2xlYW4+IHtcclxuICAgIGlmICh0aGlzLm1lc3NhZ2VQaXBlKSB7XHJcbiAgICAgIHRoaXMubWVzc2FnZVBpcGUubmV4dCh7IG1lc3NhZ2VUeXBlOiAnc2F2ZScgfSk7XHJcbiAgICB9XHJcbiAgICBjb25zdCBsb2FkaW5nVGltZXJJZCA9IHRoaXMubG9hZGluZ1NlcnZpY2Uuc2hvd0xvYWRpbmdXaXRoRGVsYXkoNTAwKTtcclxuICAgIGNvbnN0IHNhdmUkID0gdGhpcy5yZXBvc2l0b3J5LmFwcGx5Q2hhbmdlcygpO1xyXG4gICAgY29uc3QgcmVzdWx0JCA9IHNhdmUkLnBpcGUoXHJcbiAgICAgIHRhcChcclxuICAgICAgICAoKSA9PiB7XHJcbiAgICAgICAgICB0aGlzLmxvYWRpbmdTZXJ2aWNlLmhpZGVEZWxheUxvYWRpbmcobG9hZGluZ1RpbWVySWQpO1xyXG4gICAgICAgICAgdGhpcy5ub3RpZnlTZXJ2aWNlLnN1Y2Nlc3ModGhpcy5sYW5ndWFnZVNlcnZpY2Uuc2F2ZVN1Y2Nlc3MsIHsgaGlkZVRpdGxlOiB0cnVlIH0pO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZXJyb3IgPT4ge1xyXG4gICAgICAgICAgdGhpcy5sb2FkaW5nU2VydmljZS5oaWRlRGVsYXlMb2FkaW5nKGxvYWRpbmdUaW1lcklkKTtcclxuICAgICAgICAgIHRoaXMuZXJyb3JTZXJ2aWNlLmV4Y2VwdGlvbih0aGlzLmxhbmd1YWdlU2VydmljZS5tdWx0aVNhdmVGYWlsZWQsIGVycm9yKTtcclxuICAgICAgICB9XHJcbiAgICAgIClcclxuICAgICk7XHJcbiAgICByZXR1cm4gcmVzdWx0JDtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5Yig6ZmkXHJcbiAgICovXHJcbiAgcHVibGljIHJlbW92ZShpZDogc3RyaW5nLCBzdWNjZXNzTXNnPzogc3RyaW5nKTogT2JzZXJ2YWJsZTxib29sZWFuPiB7XHJcblxyXG4gICAgLy8g5Y6f5Zug5ZCMYWRkU2libGluZ1xyXG4gICAgaWQgPSBpZCA/IGlkIDogdGhpcy5iaW5kaW5nRGF0YS5saXN0LmN1cnJlbnRJZDtcclxuXHJcbiAgICAvLyDlj4LmlbDmo4Dmn6VcclxuICAgIGlmICghaWQpIHtcclxuICAgICAgdGhpcy5ub3RpZnlTZXJ2aWNlLndhcm5pbmcodGhpcy5sYW5ndWFnZVNlcnZpY2VbJ3Bsc1NlbGVjdERlbGV0ZURhdGEnXSwgeyBoaWRlVGl0bGU6IHRydWUgfSk7XHJcbiAgICAgIHJldHVybiBlbXB0eSgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOWtmOWcqOWtkOiKgueCueS4jeWFgeiuuOWIoOmZpFxyXG4gICAgY29uc3QgdHJlZU5vZGVzRGF0YSA9IHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLnRvSlNPTigpO1xyXG4gICAgY29uc3QgaGllcmFyY2h5VHlwZSA9IHRoaXMuZ2V0SGllcmFyY2h5VHlwZSgpO1xyXG4gICAgY29uc3QgdHJlZU5vZGVVdGlsID0gVHJlZVV0aWxGYWN0b3J5LmdldEluc3RhbmNlKGhpZXJhcmNoeVR5cGUpO1xyXG4gICAgaWYgKHRyZWVOb2RlVXRpbCA9PT0gbnVsbCkge1xyXG4gICAgICByZXR1cm4gZW1wdHkoKTtcclxuICAgIH1cclxuICAgIGlmICh0cmVlTm9kZVV0aWwuaGFzQ2hpbGROb2Rlcyh0cmVlTm9kZXNEYXRhLCB0aGlzLmhpZXJhcmNoeUluZm9LZXksIGlkKSA9PT0gdHJ1ZSkge1xyXG4gICAgICB0aGlzLm5vdGlmeVNlcnZpY2Uud2FybmluZyh0aGlzLmxhbmd1YWdlU2VydmljZVsnZGVsZXRlQ2hpbGRGaXJzdCddLCB7IGhpZGVUaXRsZTogdHJ1ZSB9KTtcclxuICAgICAgcmV0dXJuIGVtcHR5KCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g56Gu6K6k5Yig6ZmkXHJcbiAgICBjb25zdCBhY3Rpb24kID0gdGhpcy5tZXNzYWdlU2VydmljZS5xdWVzdGlvbih0aGlzLmxhbmd1YWdlU2VydmljZS5jb25maXJtRGVsZXRpb24pO1xyXG4gICAgcmV0dXJuIGFjdGlvbiQucGlwZShcclxuICAgICAgY29uY2F0TWFwKHJlc3VsdCA9PiB7XHJcbiAgICAgICAgaWYgKCFyZXN1bHQpIHtcclxuICAgICAgICAgIHJldHVybiBlbXB0eSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8g6I635Y+W5Yig6Zmk5ZCO6KaB6K6+572u55qE6IqC54K5aWRcclxuICAgICAgICBjb25zdCBuZXh0Tm9kZUlkID0gdHJlZU5vZGVVdGlsLmdldE5leHROb2RlSWQodHJlZU5vZGVzRGF0YSwgdGhpcy5oaWVyYXJjaHlJbmZvS2V5LCBpZCk7XHJcblxyXG4gICAgICAgIC8vIOaJp+ihjOWIoOmZpFxyXG4gICAgICAgIGNvbnN0IGxvYWRpbmdUaW1lcklkID0gdGhpcy5sb2FkaW5nU2VydmljZS5zaG93TG9hZGluZ1dpdGhEZWxheSg1MDApO1xyXG4gICAgICAgIGNvbnN0IHJlbW92ZSQgPSB0aGlzLmZyYW1lQ29udGV4dC5yZXBvc2l0b3J5LnJlbW92ZUJ5SWQoaWQpO1xyXG4gICAgICAgIHJldHVybiByZW1vdmUkLnBpcGUoXHJcbiAgICAgICAgICB0YXAoKCkgPT4ge1xyXG5cclxuICAgICAgICAgICAgLy8g6K6+572u6YCJ5Lit6IqC54K5XHJcbiAgICAgICAgICAgIHRyZWVOb2RlVXRpbC5zZWxlY3RlZE5vZGUodGhpcy5iaW5kaW5nRGF0YSwgdGhpcy5oaWVyYXJjaHlJbmZvS2V5LCBuZXh0Tm9kZUlkKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMubG9hZGluZ1NlcnZpY2UuaGlkZURlbGF5TG9hZGluZyhsb2FkaW5nVGltZXJJZCk7XHJcbiAgICAgICAgICAgIGlmIChzdWNjZXNzTXNnICYmIHN1Y2Nlc3NNc2cudHJpbSgpKSB7XHJcbiAgICAgICAgICAgICAgdGhpcy5ub3RpZnlTZXJ2aWNlLnN1Y2Nlc3Moc3VjY2Vzc01zZywgeyBoaWRlVGl0bGU6IHRydWUgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgdGhpcy5ub3RpZnlTZXJ2aWNlLnN1Y2Nlc3ModGhpcy5sYW5ndWFnZVNlcnZpY2UuZGVsZXRlU3VjY2VzcywgeyBoaWRlVGl0bGU6IHRydWUgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gdGhpcy5ub3RpZnlTZXJ2aWNlLnN1Y2Nlc3ModGhpcy5sYW5ndWFnZVNlcnZpY2UuZGVsZXRlU3VjY2VzcywgeyBoaWRlVGl0bGU6IHRydWUgfSk7XHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBlcnJvciA9PiB7XHJcbiAgICAgICAgICAgICAgdGhpcy5sb2FkaW5nU2VydmljZS5oaWRlRGVsYXlMb2FkaW5nKGxvYWRpbmdUaW1lcklkKTtcclxuICAgICAgICAgICAgICB0aGlzLmVycm9yU2VydmljZS5leGNlcHRpb24odGhpcy5sYW5ndWFnZVNlcnZpY2UuZGVsZXRlRmFpbGVkLCBlcnJvcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIClcclxuICAgICAgICApO1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWPlua2iOaXtuajgOa1i+acquS/neWtmOiusOW9lVxyXG4gICAqL1xyXG4gIHB1YmxpYyBjYW5jZWwoKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuXHJcbiAgICAvLyDmsqHmnInlj5jmm7Tml7bnm7TmjqXlj5bmtohcclxuICAgIC8vIGNvbnN0IGNhcmREYXRhU2VydmljZSA9IHRoaXMuZnJhbWVDb250ZXh0LmluamVjdG9yLmdldDxDYXJkRGF0YVNlcnZpY2U+KENhcmREYXRhU2VydmljZSk7XHJcbiAgICBjb25zdCBiZWZSZXBvc2l0b3J5ID0gdGhpcy5yZXBvc2l0b3J5IGFzIEJlZlJlcG9zaXRvcnk8YW55PjtcclxuICAgIGNvbnN0IGhhc1Vuc2F2ZWREYXRhID0gQmVmUmVwb3NpdG9yeVV0aWwuaXNFeGlzdFVuc2F2ZURhdGEoYmVmUmVwb3NpdG9yeSk7XHJcbiAgICBpZiAoIWhhc1Vuc2F2ZWREYXRhKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLl9jYW5jZWwoKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBjb25maXJtUmVzdWx0JCA9IHRoaXMubWVzc2FnZVNlcnZpY2UucXVlc3Rpb24odGhpcy5sYW5ndWFnZVNlcnZpY2VbJ2NhbmNlbFdpdGhvdXRTYXZlJ10pLnBpcGUoXHJcbiAgICAgIHN3aXRjaE1hcCgoaWZDYW5jZWw6IGJvb2xlYW4pID0+IHtcclxuICAgICAgICBpZiAoaWZDYW5jZWwgPT09IGZhbHNlKSB7XHJcbiAgICAgICAgICByZXR1cm4gRU1QVFk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLl9jYW5jZWwoKTtcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgICByZXR1cm4gY29uZmlybVJlc3VsdCQ7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOaehOmAoOWIhumhteS/oeaBr1xyXG4gICAqIEBwYXJhbSBwYXJlbnRJZCBwYXJlbnRJZFxyXG4gICAqIEByZXR1cm5zIFxyXG4gICAqL1xyXG4gIHByaXZhdGUgYnVpbGRQYWdpbmF0aW9uSW5mbyhwYXJlbnRJZDogYW55KSB7XHJcbiAgICBjb25zdCBwYWdpbmF0aW9uOiBhbnkgPSB7IHBhZ2VJbmRleDogMCwgcGFnZVNpemU6IDAgfTtcclxuICAgIGNvbnN0IGVuYWJsZU5vZGVQYWdpbmF0aW9uID0gdGhpcy5mcmFtZUNvbnRleHQucGFyYW1zLmdldCgnZW5hYmxlTm9kZVBhZ2luYXRpb24nKTtcclxuICAgIGlmICghcGFyZW50SWQpIHtcclxuICAgICAgLy8g5LiA57qn5YiG6aG1XHJcbiAgICAgIGNvbnN0IHBhZ2VTaXplID0gdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24ucGFnZVNpemUgfHwgMDtcclxuICAgICAgY29uc3QgcGFnZUluZGV4ID0gdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24ucGFnZUluZGV4IHx8IDA7XHJcbiAgICAgIC8vIOWQr+eUqOS6huS4gOe6p+WIhumhtVxyXG4gICAgICBpZiAocGFnZVNpemUgIT09IDApIHtcclxuICAgICAgICBwYWdpbmF0aW9uLnBhZ2VTaXplID0gcGFnZVNpemU7XHJcbiAgICAgICAgcGFnaW5hdGlvbi5wYWdlSW5kZXggPSBwYWdlSW5kZXg7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIC8vIOWmguaenOacquWQr+eUqOiKgueCueWIhumhteaIluW9k+WJjeS4uumhtue6p+iKgueCueWKoOi9ve+8jOWImeS4jeWkhOeQhuiKgueCueWIhumhtVxyXG4gICAgICBpZiAoZW5hYmxlTm9kZVBhZ2luYXRpb24pIHtcclxuICAgICAgICBjb25zdCBub2RlUGFnZVNpemUgPSB0aGlzLmZyYW1lQ29udGV4dC5wYXJhbXMuZ2V0KCdub2RlUGFnZVNpemUnKSB8fCAwO1xyXG4gICAgICAgIGxldCBub2RlUGFnZUluZGV4ID0gdGhpcy5mcmFtZUNvbnRleHQucGFyYW1zLmdldChgX05PREVfJHtwYXJlbnRJZH1fUEFHRV9JTkRFWF9gKTtcclxuICAgICAgICBpZiAoIW5vZGVQYWdlSW5kZXgpIHtcclxuICAgICAgICAgIHRoaXMuZnJhbWVDb250ZXh0LnBhcmFtcy5zZXQoYF9OT0RFXyR7cGFyZW50SWR9X1BBR0VfSU5ERVhfYCwgMSk7XHJcbiAgICAgICAgICBub2RlUGFnZUluZGV4ID0gMTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcGFnaW5hdGlvbi5wYWdlSW5kZXggPSBub2RlUGFnZUluZGV4O1xyXG4gICAgICAgIHBhZ2luYXRpb24ucGFnZVNpemUgPSBub2RlUGFnZVNpemU7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBwYWdpbmF0aW9uO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Y+W5raI5Y+Y5pu0XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBfY2FuY2VsKCk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBjb25zdCBsb2FkaW5nVGltZXJJZCA9IHRoaXMubG9hZGluZ1NlcnZpY2Uuc2hvd0xvYWRpbmdXaXRoRGVsYXkoNTAwKTtcclxuICAgIGNvbnN0IGNhbmNlbCQgPSB0aGlzLnJlcG9zaXRvcnkuY2FuY2VsQ2hhbmdlcygpO1xyXG4gICAgcmV0dXJuIGNhbmNlbCQucGlwZShcclxuICAgICAgc3dpdGNoTWFwKCgpID0+IHtcclxuICAgICAgICBjb25zdCBpc0FkZCA9IHRoaXMudmlydHVhbFJvb3RGcmFtZUNvbnRleHQuZ2V0UGFyYW0oJ0lTX0FERCcpO1xyXG4gICAgICAgIGNvbnN0IGxhc3RNb2RpZmllZElkID0gdGhpcy52aXJ0dWFsUm9vdEZyYW1lQ29udGV4dC5nZXRQYXJhbSgnTEFTVF9NT0RJRklFRF9JRCcpO1xyXG4gICAgICAgIGNvbnN0IGN1cnJlbnRJZCA9IHRoaXMuYmluZGluZ0RhdGEubGlzdC5jdXJyZW50SWQ7XHJcblxyXG4gICAgICAgIGlmIChpc0FkZCA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24ucmVtb3ZlRW50aXR5QnlJZChjdXJyZW50SWQpO1xyXG5cclxuICAgICAgICAgIC8vIOmHjee9rue8lui+keeKtuaAgVxyXG4gICAgICAgICAgdGhpcy52aXJ0dWFsUm9vdEZyYW1lQ29udGV4dC5zZXRQYXJhbSgnSVNfQUREJywgZmFsc2UpO1xyXG4gICAgICAgICAgaWYgKGxhc3RNb2RpZmllZElkKSB7XHJcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgIHRoaXMuYmluZGluZ0RhdGEubGlzdC5zZXRDdXJyZW50SWQobGFzdE1vZGlmaWVkSWQsIHRydWUsIHRydWUpO1xyXG4gICAgICAgICAgICB9LCAwKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHJldHVybiBvZihudWxsKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgcmV0dXJuIHRoaXMucmVwb3NpdG9yeS51cGRhdGVCeUlkKGN1cnJlbnRJZCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KSxcclxuICAgICAgdGFwKFxyXG4gICAgICAgICgpID0+IHtcclxuICAgICAgICAgIHRoaXMubG9hZGluZ1NlcnZpY2UuaGlkZURlbGF5TG9hZGluZyhsb2FkaW5nVGltZXJJZCk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICAoZXJyb3I6IGFueSkgPT4ge1xyXG4gICAgICAgICAgdGhpcy5sb2FkaW5nU2VydmljZS5oaWRlRGVsYXlMb2FkaW5nKGxvYWRpbmdUaW1lcklkKTtcclxuICAgICAgICAgIHRoaXMuZXJyb3JTZXJ2aWNlLmV4Y2VwdGlvbih0aGlzLmxhbmd1YWdlU2VydmljZS5jYW5jZWxGYWlsZWQsIGVycm9yKTtcclxuICAgICAgICB9XHJcbiAgICAgIClcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmo4Dmn6XmmK/lkKblrZjlnKjkuIvnuqfoioLngrnvvIjlhoXpg6jmlrnms5XvvIzor7fli7/kvb/nlKjvvIlcclxuICAgKi9cclxuICBwdWJsaWMgaGFzQ2hpbGROb2RlcyhpZDogc3RyaW5nLCB0cmVlTm9kZXNEYXRhOiBhbnlbXSk6IGJvb2xlYW4ge1xyXG4gICAgY29uc3QgdHJlZU5vZGVVdGlsID0gdGhpcy5nZXRUcmVlTm9kZVV0aWwoKTtcclxuICAgIGlmICh0cmVlTm9kZVV0aWwuaGFzQ2hpbGROb2Rlcyh0cmVlTm9kZXNEYXRhLCB0aGlzLmhpZXJhcmNoeUluZm9LZXksIGlkKSA9PT0gdHJ1ZSkge1xyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiuoeeul+WIoOmZpOWQjueahOW9k+WJjeiKgueCuWlk77yI5YaF6YOo5pa55rOV77yM6K+35Yu/5L2/55So77yJXHJcbiAgICovXHJcbiAgcHVibGljIGdldE5leHROb2RlSWRBZnRlclJlbW92aW5nKGlkVG9SZW1vdmU6IHN0cmluZywgdHJlZU5vZGVzRGF0YTogYW55W10pOiBzdHJpbmcge1xyXG4gICAgY29uc3QgdHJlZU5vZGVVdGlsID0gdGhpcy5nZXRUcmVlTm9kZVV0aWwoKTtcclxuICAgIGNvbnN0IG5leHROb2RlSWQgPSB0cmVlTm9kZVV0aWwuZ2V0TmV4dE5vZGVJZCh0cmVlTm9kZXNEYXRhLCB0aGlzLmhpZXJhcmNoeUluZm9LZXksIGlkVG9SZW1vdmUpO1xyXG4gICAgcmV0dXJuIG5leHROb2RlSWQ7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDorr7nva7liKDpmaTlkI7nmoTlvZPliY3oioLngrnoioLngrnvvIjlhoXpg6jmlrnms5XvvIzor7fli7/kvb/nlKjvvIlcclxuICAgKi9cclxuICBwdWJsaWMgc2V0TmV4dE5vZGVBZnRlclJlbW92aW5nKG5leHROb2RlSWQ6IHN0cmluZyk6IHZvaWQge1xyXG4gICAgY29uc3QgdHJlZU5vZGVVdGlsID0gdGhpcy5nZXRUcmVlTm9kZVV0aWwoKTtcclxuICAgIHRyZWVOb2RlVXRpbC5zZWxlY3RlZE5vZGUodGhpcy5iaW5kaW5nRGF0YSwgdGhpcy5oaWVyYXJjaHlJbmZvS2V5LCBuZXh0Tm9kZUlkKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6K6+572u5qCR55qE5b2T5YmN6KGMKOe7meWujOaVtOagkeS9v+eUqClcclxuICAgKiBAcGFyYW0gaWQgaWRcclxuICAgKi9cclxuICBwdWJsaWMgc2V0Q3VycmVudElkKGlkOiBzdHJpbmcpIHtcclxuICAgIGlkID0gaWQgfHwgdGhpcy5mcmFtZUNvbnRleHQuZ2V0VmlydHVhbFJvb3RGcmFtZUNvbnRleHQoKS51aVN0YXRlWydfX0RFVktJVF9fc2VsZWN0ZWRSb3cnXSB8fCB0aGlzLmJpbmRpbmdEYXRhLmxpc3QuY3VycmVudEl0ZW0ucHJpbWFyeUtleVZhbHVlO1xyXG4gICAgdGhpcy5mcmFtZUNvbnRleHQuYmluZGluZ0RhdGEubGlzdC5zZXRDdXJyZW50SWQoaWQsIHRydWUsIHRydWUsIHRydWUpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDpgInkuK3moJHnmoTnrKzkuIDkuKroioLngrlcclxuICAgKi9cclxuICBwdWJsaWMgc2VsZWN0Rmlyc3RSb3coKSB7XHJcbiAgICBjb25zdCBoaWVyYXJjaHlUeXBlID0gdGhpcy5nZXRIaWVyYXJjaHlUeXBlKCk7XHJcbiAgICBjb25zdCB0cmVlTm9kZVV0aWwgPSBUcmVlVXRpbEZhY3RvcnkuZ2V0SW5zdGFuY2UoaGllcmFyY2h5VHlwZSk7XHJcbiAgICBpZiAodHJlZU5vZGVVdGlsICE9PSBudWxsKSB7XHJcbiAgICAgIHRyZWVOb2RlVXRpbC5zZWxlY3RGaXJzdFJvb3ROb2RlKHRoaXMuYmluZGluZ0RhdGEsIHRoaXMuaGllcmFyY2h5SW5mb0tleSk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluagkeiKgueCueW3peWFt+exu+WunuS+i1xyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0VHJlZU5vZGVVdGlsKCk6IGFueSB7XHJcbiAgICBjb25zdCBoaWVyYXJjaHlUeXBlID0gdGhpcy5nZXRIaWVyYXJjaHlUeXBlKCk7XHJcbiAgICBjb25zdCB0cmVlTm9kZVV0aWwgPSBUcmVlVXRpbEZhY3RvcnkuZ2V0SW5zdGFuY2UoaGllcmFyY2h5VHlwZSk7XHJcbiAgICBpZiAodHJlZU5vZGVVdGlsID09PSBudWxsKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihg5LiN5pSv5oyBJHtoaWVyYXJjaHlUeXBlfeexu+Wei+eahOWIhue6p2ApO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRyZWVOb2RlVXRpbDtcclxuICB9XHJcblxyXG5cclxuXHJcbiAgLyoqXHJcbiAgICog6K6w5b2V5Yqg6L2954q25oCBXHJcbiAgICogQHRvZG/vvJrlvoXliKDpmaRcclxuICAgKi9cclxuICBwcml2YXRlIHNldExvYWRCeUxldmVsU3RhdGUoZmlsdGVyczogc3RyaW5nLCBzb3J0czogc3RyaW5nKSB7XHJcblxyXG4gICAgLy8gQHRvZG/vvJrkuLTml7blpITnkIZcclxuICAgIHRoaXMudmlydHVhbFJvb3RGcmFtZUNvbnRleHQuc2V0UGFyYW0oJ2lzTG9hZFRyZWVCeUxldmVsJywgdHJ1ZSk7XHJcbiAgICB0aGlzLnZpcnR1YWxSb290RnJhbWVDb250ZXh0LnNldFBhcmFtKCdsb2FkVHJlZUJ5TGV2ZWxGaWx0ZXInLCBmaWx0ZXJzKTtcclxuICAgIHRoaXMudmlydHVhbFJvb3RGcmFtZUNvbnRleHQuc2V0UGFyYW0oJ2xvYWRUcmVlQnlMZXZlbFNvcnQnLCBzb3J0cyk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlsZXlvIDlvZPliY3oioLngrlcclxuICAgKiBAdG9kb++8muW+heWIoOmZpFxyXG4gICAqL1xyXG4gIHByaXZhdGUgcmVsb2FkQnlMZXZlbCgpOiBPYnNlcnZhYmxlPEVudGl0eVtdPiB7XHJcbiAgICBjb25zdCBpc0xvYWRCeUxldmVsID0gdGhpcy52aXJ0dWFsUm9vdEZyYW1lQ29udGV4dC5nZXRQYXJhbSgnaXNMb2FkVHJlZUJ5TGV2ZWwnKTtcclxuICAgIGlmIChpc0xvYWRCeUxldmVsID09PSB0cnVlKSB7XHJcbiAgICAgIGNvbnN0IGZpbHRlcnMgPSB0aGlzLnZpcnR1YWxSb290RnJhbWVDb250ZXh0LmdldFBhcmFtKCdsb2FkVHJlZUJ5TGV2ZWxGaWx0ZXInKTtcclxuICAgICAgY29uc3Qgc29ydHMgPSB0aGlzLnZpcnR1YWxSb290RnJhbWVDb250ZXh0LmdldFBhcmFtKCdsb2FkVHJlZUJ5TGV2ZWxTb3J0Jyk7XHJcbiAgICAgIHJldHVybiB0aGlzLmxvYWRCeUxldmVsKGZpbHRlcnMsIHNvcnRzKTtcclxuICAgIH1cclxuICAgIHJldHVybiBvZihbXSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldEhpZXJhcmNoeVR5cGUoKSB7XHJcbiAgICBjb25zdCBuZ09iamVjdHMgPSBGaWVsZE1ldGFkYXRhVXRpbC5nZXROZ09iamVjdHModGhpcy5yZXBvc2l0b3J5LmVudGl0eVR5cGUpO1xyXG4gICAgY29uc3QgaGllcmFyY2h5SW5mb05nT2JqZWN0SW5mbyA9IG5nT2JqZWN0c1t0aGlzLmhpZXJhcmNoeUluZm9LZXldO1xyXG4gICAgbGV0IGhpZXJhcmNoeVR5cGUgPSAncGF0aCc7IC8vIOWIhue6p+eggem7mOiupOS4unBhdGjvvIzlhbzlrrnljp/ooajljZVcclxuICAgIGlmIChoaWVyYXJjaHlJbmZvTmdPYmplY3RJbmZvLmhhc093blByb3BlcnR5KCdoaWVyYXJjaHlUeXBlJykgJiYgaGllcmFyY2h5SW5mb05nT2JqZWN0SW5mb1snaGllcmFyY2h5VHlwZSddICE9IG51bGwpIHtcclxuICAgICAgaGllcmFyY2h5VHlwZSA9IGhpZXJhcmNoeUluZm9OZ09iamVjdEluZm9bJ2hpZXJhcmNoeVR5cGUnXSBhcyBzdHJpbmc7XHJcbiAgICB9XHJcbiAgICBpZiAoaGllcmFyY2h5VHlwZSA9PSBudWxsIHx8IGhpZXJhcmNoeVR5cGUubGVuZ3RoIDwgMSkge1xyXG4gICAgICAvLyAn5YiG57qn56CB6YWN572u5L+h5oGv6ZSZ6K+vJ1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IodGhpcy5sYW5ndWFnZVNlcnZpY2VbJ2luY29ycmVjdEhpZXJhcmNoeUNvbmZpZyddKTtcclxuICAgIH1cclxuICAgIHJldHVybiBoaWVyYXJjaHlUeXBlO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDojrflj5bmoLnnu4Tku7bmtojmga/nrqHpgZNcclxuICAgKi9cclxuICBwcml2YXRlIGdldCBtZXNzYWdlUGlwZSgpIHtcclxuICAgIGlmICh0aGlzLmZyYW1lQ29udGV4dCkge1xyXG4gICAgICBjb25zdCBhcHBDb250ZXh0ID0gdGhpcy5mcmFtZUNvbnRleHQuZ2V0Rm9ybUFwcENvbnRleHQoKSB8fCBudWxsO1xyXG4gICAgICBpZiAoYXBwQ29udGV4dCkge1xyXG4gICAgICAgIHJldHVybiBhcHBDb250ZXh0Lm1lc3NhZ2VQaXBlIHx8IG51bGw7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxufVxyXG5leHBvcnQgeyBUcmVlRGF0YVNlcnZpY2UgfTtcclxuIl19