import { Injectable, ComponentFactoryResolver, ReflectiveInjector, InjectFlags, Injector, Optional } from '@angular/core';
import { BsModalService } from '@farris/ui-modal';
import { FarrisFormService } from './farris-form.service';
import { FrameContext } from '@farris/devkit';
import { of, Subject } from 'rxjs';
import { LanguageService } from './languag.service';
import { switchMap } from 'rxjs/operators';
/**
 * 弹窗服务
 * @scope FormModule
 */
class DialogService {
    constructor(modalService, farrisFormService, _componentFactoryResolver, frameContext, injector) {
        this.modalService = modalService;
        this.farrisFormService = farrisFormService;
        this._componentFactoryResolver = _componentFactoryResolver;
        this.frameContext = frameContext;
        this.injector = injector;
        this._providers = [];
        this.modals = {};
        this.setLanguageService();
    }
    /**
     * 设置语言服务
     */
    setLanguageService() {
        // FrameContext不一定存在，不能直接用
        const frameContext = this.getFrameContext();
        if (frameContext) {
            const injector = this.frameContext.injector;
            this.languageService = injector.get(LanguageService, null, InjectFlags.Optional);
        }
        if (!this.languageService) {
            this.languageService = LanguageService.getInstance();
        }
    }
    /**
     * 兼容旧弹窗，获取frameContext
     */
    getFrameContext() {
        if (this.frameContext) {
            return this.frameContext;
        }
        if (this['context'] && this['context']['frameContext']) {
            return this['context']['frameContext'];
        }
        return null;
    }
    /**
     * 兼容旧弹窗，获取ComponentFactoryResolver
     */
    getComponentFactoryResolver() {
        const frameContext = this.getFrameContext();
        let componentFactoryResolver;
        if (frameContext) {
            componentFactoryResolver = frameContext.injector.get(ComponentFactoryResolver);
        }
        return componentFactoryResolver;
    }
    /**
     * 获取config转换成对象类型的配置
     * @param config 配置项
     */
    getObjectTypeConfig(config) {
        let objectTypeConfig;
        if (typeof config === 'string') {
            if (config.length) {
                try {
                    objectTypeConfig = JSON.parse(config);
                }
                catch (_a) {
                    throw new Error(config + '不是合法的json字符串');
                }
            }
            else {
                objectTypeConfig = {};
            }
        }
        else if (typeof config === 'object') {
            objectTypeConfig = Object.assign({}, config);
        }
        else {
            throw new Error('填写对象格式或json字符串');
        }
        return objectTypeConfig;
    }
    /**
     * 创建模态框内组件实例，并返回模态框实例；做了兼容老表单处理
     * @param config 弹窗配置
     * @param compnent 弹窗内组件
     * @param uiStateObject 绑定弹窗内组件uiState
     */
    createModalComponentRef(config, component, uiStateObject) {
        let componentRef;
        let modalRef;
        const frameContext = this.getFrameContext();
        const componentFactoryResolver = this.getComponentFactoryResolver();
        if (frameContext && componentFactoryResolver) {
            const contentCmptFactory = componentFactoryResolver.resolveComponentFactory(component);
            const modalContentInjector = ReflectiveInjector.resolveAndCreate([...this._providers], frameContext.injector);
            componentRef = contentCmptFactory.create(modalContentInjector);
            if (componentRef && componentRef.instance && componentRef.instance.viewModel && componentRef.instance.viewModel.uiState) {
                if (typeof uiStateObject === 'object' && Object.keys(uiStateObject).length) {
                    Object.keys(uiStateObject).forEach(item => {
                        componentRef.instance.viewModel.uiState.setPropertyValue(item, uiStateObject[item]);
                    });
                }
                // 附加isDialog参数
                componentRef.instance.viewModel.uiState.setPropertyValue('DEVKIT_DIALOG', true);
            }
            modalRef = this.modalService.show(componentRef, config);
        }
        else {
            modalRef = this.modalService.show(component, config);
        }
        return modalRef;
    }
    /**
     *
     * @param config 模态框本身配置
     * @param modalId 模态框内组件的id
     * @param uiStateConfig 模态框内组件uiState上的字段及值
     */
    openModal(config = {}, modalId, uiStateConfig = {}, callback) {
        const configObj = this.getObjectTypeConfig(config);
        const uiStateObject = this.getObjectTypeConfig(uiStateConfig);
        let innerCompopnent = this.farrisFormService.getControls(modalId);
        let modalRef;
        let modalConfig = {
            title: this.languageService.defaultDialogTitle,
            width: 760,
            height: 450,
            showButtons: false
        };
        modalConfig = Object.assign(modalConfig, configObj);
        const onClosingHandler = modalConfig.beforeClose;
        // tslint:disable: no-string-literal
        const cancelChanges = modalConfig['cancelChanges'] || false;
        modalConfig.beforeClose = (ref) => {
            // if (ref && ref.modalRef && ref.modalRef.content) {
            //   ref.modalRef.content.isDialogRootComponent = false;
            // }
            if (!!onClosingHandler && typeof onClosingHandler === 'function') {
                return onClosingHandler(ref).pipe(switchMap(result => {
                    if (result) {
                        if (cancelChanges) {
                            return this.cancelChanges(ref);
                        }
                    }
                    return of(result);
                }));
            }
            if (cancelChanges) {
                return this.cancelChanges(ref);
            }
            else {
                return of(true);
            }
        };
        const remote = modalConfig.remote || false;
        if (remote) {
            this.createRemoteForm(modalConfig, uiStateObject).subscribe((modalRef) => {
                this.modalRef = modalRef;
                if (modalRef && !!modalRef.content) {
                    modalRef.content.isDialogRootComponent = true;
                    modalRef.content.dialogRef = modalRef;
                }
                callback(modalRef);
            });
        }
        else {
            if (!innerCompopnent) {
                console.error(`获取控件失败，modalId=${modalId}`);
                return;
            }
            if (typeof innerCompopnent === 'string') {
                modalConfig.dialogType = 'iframe';
                modalRef = this.modalService.show(innerCompopnent, modalConfig);
            }
            else if (typeof innerCompopnent === 'function') {
                modalRef = this.createModalComponentRef(modalConfig, innerCompopnent, uiStateObject);
            }
            else if (typeof innerCompopnent === 'object') {
                // 如果是对象 且使用独立js加载
                // {"useIsolateJs":true,"modalInstance":f()}
                if (innerCompopnent.useIsolateJs) {
                    const parameter = {
                        injector: this.injector,
                        uiState: uiStateObject,
                        modalService: this.modalService,
                        dialogServiceInstance: this,
                        eventBus: this.frameContext.getVirtualRootFrameContext().eventBus,
                        componentCallback: this.componentModify,
                        modalInstanceCallback: this.modalInstanceCallback
                    };
                    // 会在内部进行
                    return innerCompopnent["modalInstance"](modalConfig, parameter);
                }
                else {
                    modalRef = this.modalService.show(innerCompopnent, modalConfig);
                }
            }
            this.modalRef = modalRef;
            if (modalRef && !!modalRef.content) {
                modalRef.content.isDialogRootComponent = true;
                modalRef.content.dialogRef = modalRef;
            }
            return modalRef;
        }
    }
    componentModify(cmpRef, parameter) {
        if (cmpRef && cmpRef.instance && cmpRef.instance.viewModel && cmpRef.instance.viewModel.uiState) {
            if (parameter.uistate && typeof parameter.uistate === "string") {
                parameter.uistate = JSON.parse(parameter.uistate);
            }
            if (typeof parameter.uistate === 'object' && Object.keys(parameter.uistate).length) {
                Object.keys(parameter.uistate).forEach(item => {
                    cmpRef.instance.viewModel.uiState.setPropertyValue(item, parameter.uistate[item]);
                });
            }
            // 附加isDialog参数
            cmpRef.instance.viewModel.uiState.setPropertyValue('DEVKIT_DIALOG', true);
        }
    }
    modalInstanceCallback(cmpRef, options, parameter) {
        if (parameter && parameter.modalService) {
            const modalRef = parameter.modalService.show(cmpRef, options);
            if (modalRef && !!modalRef.content) {
                modalRef.content.isDialogRootComponent = true;
                modalRef.content.dialogRef = modalRef;
            }
            return modalRef;
        }
    }
    /**
     * 打开类帮助表单
     * @param frameId
     * @param params
     * @param configs
     * @description 弹出表单和弹出远端表单区别为弹出表单需要配置字段映射
     */
    openHelpModal(frameId, params, configs) {
        const events = this['context']['eventParam'] || {};
        // 卡片场景传递过来的事件是自定义对象，包含event和options。列表场景传递过来的事件参数是普通事件参数，在参数中携带了editor.options
        const event = events.event || events;
        const options = events.options || events.editor && events.editor.options || {};
        const context = events && events.context;
        const subject = new Subject();
        // modalId在两种场景下都需要，用来区分实例
        const { modalId = null } = options;
        if (!configs) {
            configs = '{}';
        }
        if (typeof configs === 'string' && configs.length > 0) {
            configs = JSON.parse(configs);
        }
        const { remote = false, currentRow = false, areaResponse = undefined } = configs || {};
        // 支持areaResponse配置
        if (areaResponse !== undefined && options.areaResponse === undefined) {
            options.areaResponse = areaResponse;
        }
        if (remote) {
            const mapFields = configs.mapFields || {};
            options.remote = remote + '?v=' + new Date().valueOf();
            this.openModal(options, modalId, params, (dialogRef) => {
                // 新增event参数（为了以后调用event中的formControl以适配列表中的智能输入框弹出表单）
                this.modals[modalId] = { subject, frameId: frameId, mapFields, dialogRef, currentRow, event: event, context };
            });
        }
        else {
            const dialogRef = this.openModal(options, modalId, params);
            const mapFields = options.mapFields || {};
            this.modals[modalId] = { subject, frameId: frameId, mapFields, dialogRef, currentRow, event: event, context };
        }
        return subject;
    }
    /**
     * 打开带回调的弹窗
     * @param frameId frameId
     * @param params 参数
     * @param configs 配置
     * @returns
     */
    openCallbackableModal(frameId, params, configs) {
        if (!configs) {
            configs = '{}';
        }
        if (typeof configs === 'string') {
            configs = JSON.parse(configs);
        }
        const events = this['context'] && this['context']['eventParam'] || {};
        const options = events.options;
        options.showButtons = true;
        options.buttons = [
            {
                text: this.languageService.confirm, cls: 'btn btn-primary', handle: (event) => {
                    const { modalId = null } = options || {};
                    if (modalId) {
                        const modal = this.modals[modalId];
                        const { subject = null, dialogRef = null, frameId = null, handle = null, currentRow = false } = modal || {};
                        const formCmp = dialogRef.content; // 弹窗表单实例
                        if (!formCmp) {
                            throw new Error('不支持的表单类型');
                        }
                        let selectedItems = [];
                        if (currentRow === true) {
                            let frameComtext;
                            if (formCmp.context) {
                                frameComtext = formCmp.context.appContext.frameContextManager.getFrameContextById(frameId);
                            }
                            else {
                                frameComtext = formCmp.appContext.frameContextManager.getFrameContextById(frameId);
                            }
                            if (!frameComtext) {
                                throw new Error(`无效的frameId：${frameId}，请确认命令中frameId正确。`);
                            }
                            const bindingList = frameComtext.bindingData.getList();
                            const item = bindingList && bindingList.currentItem && bindingList.currentItem.toJSON();
                            selectedItems = [item];
                        }
                        else {
                            let rows;
                            // 如果context为空 那么尝试从对应的appcontext读取，主要目的是为了解析表单的弹出
                            if (formCmp.context) {
                                rows = formCmp.context.appContext.frameContextManager.getFrameContextById(frameId).uiState.rows || new Map();
                            }
                            else {
                                rows = formCmp.appContext.frameContextManager.getFrameContextById(frameId).uiState.rows || new Map();
                            }
                            selectedItems = Array.from(rows.values());
                        }
                        if (typeof handle === 'function') {
                            handle(selectedItems);
                        }
                        if (subject) {
                            subject.next();
                        }
                        dialogRef.close(options);
                    }
                }
            },
            { text: this.languageService.cancel, cls: 'btn', handle: (event) => this.cancel(options) }
        ];
        const subject = new Subject();
        const { modalId = null } = options;
        const { remote = null, currentRow = false, areaResponse = undefined } = configs;
        const handle = options.handle;
        // 支持areaResponse配置
        if (areaResponse !== undefined && options.areaResponse === undefined) {
            options.areaResponse = areaResponse;
        }
        if (remote) {
            options.remote = remote + '?v=' + new Date().valueOf();
            this.openModal(options, modalId, params, (dialogRef) => {
                this.modals[modalId] = { subject, frameId: frameId, dialogRef, handle, currentRow, event: events.event };
            });
        }
        else {
            const dialogRef = this.openModal(options, modalId, params);
            this.modals[modalId] = { subject, frameId: frameId, dialogRef, handle, currentRow, event: events.event };
        }
        return subject;
    }
    /**
     * 确认按钮事件
     * @param args
     */
    confirm() {
        const events = this['context'] && this['context']['eventParam'] || {};
        const { modalId = null } = events || {};
        if (modalId) {
            const modal = this.modals[modalId];
            const { subject = null, dialogRef = null, mapFields = {}, frameId = null, currentRow = false, event = null, context = null } = modal || {};
            const formCmp = dialogRef.content; // 弹窗表单实例
            if (!formCmp) {
                throw new Error('不支持的表单类型');
            }
            // const selectedIds = formCmp.context.appContext.frameContextManager.getFrameContextById(frameId).uiState.ids;
            let selectedItems = [];
            if (currentRow === true) {
                const frameComtext = formCmp.context.appContext.frameContextManager.getFrameContextById(frameId);
                if (!frameComtext) {
                    throw new Error(`无效的frameId：${frameId}，请确认命令中frameId正确。`);
                }
                const bindingList = frameComtext.bindingData.getList();
                const item = bindingList && bindingList.currentItem && bindingList.currentItem.toJSON();
                if (item && Object.keys(item).length > 0) {
                    selectedItems = [item];
                }
            }
            else {
                const rows = formCmp.context.appContext.frameContextManager.getFrameContextById(frameId).uiState.rows || new Map();
                selectedItems = Array.from(rows.values());
            }
            // 映射字段数据
            // 获取触发弹框的编辑器的字段名称
            let editorField = undefined;
            if (event && event.editor && event.editor.column) {
                editorField = event.editor.column.field;
            }
            if (selectedItems && mapFields) {
                Object.keys(mapFields).forEach(k => {
                    const targetField = mapFields[k];
                    const sourceKeyArray = k.split('.').filter(p => p) || [];
                    const targetValue = selectedItems.map(r => {
                        return sourceKeyArray.reduce((target, key) => {
                            if (target && (target.hasOwnProperty(key) || target['__proto__'].hasOwnProperty(key))) {
                                return target[key];
                            }
                            else {
                                return '';
                            }
                        }, r);
                    }).join(',');
                    if (targetField) {
                        const bindingPaths = this.frameContext.viewModel.bindingPath.split('/').filter(p => p);
                        const targetFields = targetField.split(',').filter(p => p);
                        targetFields.forEach(target => {
                            if (context) {
                                this.setValueByPath(context, target, targetValue);
                            }
                            else {
                                const targetPath = target.split('.');
                                this.frameContext.bindingData.setValue(bindingPaths.concat(targetPath), targetValue, true, true);
                            }
                        });
                    }
                });
            }
            if (subject) {
                subject.next();
            }
            dialogRef.close();
        }
    }
    /**
     * 取消按钮事件
     * @param args
     */
    cancel(event) {
        const events = event || this['context'] && this['context']['eventParam'] || {};
        const { modalId = null } = events || {};
        if (modalId) {
            const modal = this.modals[modalId];
            const { subject = null, dialogRef = null } = modal || {};
            if (subject) {
                subject.next();
            }
            if (dialogRef) {
                dialogRef.close();
            }
        }
    }
    /**
     * 取消服务器变更集
     */
    cancelChanges(ref) {
        if (ref && ref.modalRef && ref.modalRef.content) {
            const component = ref.modalRef.content;
            if (component && component.context) {
                const repository = component.context.repository || null;
                if (repository) {
                    return repository.cancelChanges().pipe(switchMap(() => of(true)));
                }
            }
        }
        return of(true);
    }
    /**
     * 关闭该弹窗
     */
    closeModal() {
        if (this.modalRef) {
            this.modalRef.close();
        }
    }
    /**
     * 创建远程表单实例
     * @param options dialog配置
     * @param uiState uistate
     */
    createRemoteForm(options, uiState) {
        const remote = options.remote || false;
        const subject = new Subject();
        if (remote) {
            let moduleName = options.moduleName || null;
            System.import(remote).then((module) => {
                if (!moduleName) {
                    moduleName = Object.keys(module).pop();
                }
                const moduleFactory = module[moduleName];
                const moduleRef = moduleFactory.create(this.injector);
                const entryComponent = moduleRef['_bootstrapComponents'][0];
                if (entryComponent) {
                    const compFactory = moduleRef.componentFactoryResolver.resolveComponentFactory(entryComponent);
                    const componentRef = compFactory.create(this.injector);
                    if (componentRef && componentRef.instance && componentRef.instance.viewModel && componentRef.instance.viewModel.uiState) {
                        if (typeof uiState === 'object' && Object.keys(uiState).length) {
                            Object.keys(uiState).forEach(item => {
                                componentRef.instance.viewModel.uiState.setPropertyValue(item, uiState[item]);
                            });
                        }
                        // 附加isDialog参数
                        componentRef.instance.viewModel.uiState.setPropertyValue('DEVKIT_DIALOG', true);
                    }
                    const modalRef = this.modalService.show(componentRef, options);
                    subject.next(modalRef);
                }
                else {
                    throw new Error(`无法找到入口表单！`);
                }
            });
        }
        return subject;
    }
    setValueByPath(target, path, value) {
        if (target) {
            const paths = path.split('.');
            if (paths.length <= 1) {
                target[path] = value;
            }
            else {
                paths.slice(0, -1).reduce((prev, path) => {
                    if (!(prev.hasOwnProperty(path) || prev['__proto__'].hasOwnProperty(path))) {
                        prev[path] = {};
                    }
                    return prev[path];
                }, target)[paths[paths.length - 1]] = value;
            }
        }
    }
}
DialogService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
DialogService.ctorParameters = () => [
    { type: BsModalService },
    { type: FarrisFormService },
    { type: ComponentFactoryResolver },
    { type: FrameContext },
    { type: Injector, decorators: [{ type: Optional }] }
];
export { DialogService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGlhbG9nLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2NvbW1hbmQtc2VydmljZXMvIiwic291cmNlcyI6WyJsaWIvZGlhbG9nLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSx3QkFBd0IsRUFBRSxrQkFBa0IsRUFBMEIsV0FBVyxFQUFtQixRQUFRLEVBQUUsUUFBUSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ25LLE9BQU8sRUFBRSxjQUFjLEVBQWdCLE1BQU0sa0JBQWtCLENBQUM7QUFDaEUsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDMUQsT0FBTyxFQUFFLFlBQVksRUFBK0IsTUFBTSxnQkFBZ0IsQ0FBQztBQUMzRSxPQUFPLEVBQUUsRUFBRSxFQUFjLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMvQyxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDcEQsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRTNDOzs7R0FHRztBQUNILE1BQ00sYUFBYTtJQVFqQixZQUNVLFlBQTRCLEVBQzVCLGlCQUFvQyxFQUNwQyx5QkFBbUQsRUFDbkQsWUFBMkIsRUFDZixRQUFtQjtRQUovQixpQkFBWSxHQUFaLFlBQVksQ0FBZ0I7UUFDNUIsc0JBQWlCLEdBQWpCLGlCQUFpQixDQUFtQjtRQUNwQyw4QkFBeUIsR0FBekIseUJBQXlCLENBQTBCO1FBQ25ELGlCQUFZLEdBQVosWUFBWSxDQUFlO1FBQ2YsYUFBUSxHQUFSLFFBQVEsQ0FBVztRQVhqQyxlQUFVLEdBQWUsRUFBRSxDQUFDO1FBSTVCLFdBQU0sR0FBUSxFQUFFLENBQUM7UUFTdkIsSUFBSSxDQUFDLGtCQUFrQixFQUFFLENBQUM7SUFDNUIsQ0FBQztJQUVEOztPQUVHO0lBQ0ssa0JBQWtCO1FBRXhCLDBCQUEwQjtRQUMxQixNQUFNLFlBQVksR0FB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QUFDLE1BQWMsRUFBRSxJQUFZLEVBQUUsS0FBVTtRQUM3RCxJQUFJLE1BQU0sRUFBRTtZQUNWLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDOUIsSUFBSSxLQUFLLENBQUMsTUFBTSxJQUFJLENBQUMsRUFBRTtnQkFDckIsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLEtBQUssQ0FBQzthQUN0QjtpQkFBTTtnQkFDTCxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsRUFBRTtvQkFDdkMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUU7d0JBQzFFLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUM7cUJBQ2pCO29CQUNELE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUNwQixDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxLQUFLLENBQUM7YUFDN0M7U0FDRjtJQUNILENBQUM7OztZQXJoQkYsVUFBVTs7OztZQVhGLGNBQWM7WUFDZCxpQkFBaUI7WUFGTCx3QkFBd0I7WUFHcEMsWUFBWTtZQUhvRyxRQUFRLHVCQTBCNUgsUUFBUTs7QUEwZ0JiLE9BQU8sRUFBRSxhQUFhLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciwgUmVmbGVjdGl2ZUluamVjdG9yLCBQcm92aWRlciwgQ29tcG9uZW50UmVmLCBJbmplY3RGbGFncywgTmdNb2R1bGVGYWN0b3J5LCBJbmplY3RvciwgT3B0aW9uYWwgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgQnNNb2RhbFNlcnZpY2UsIE1vZGFsT3B0aW9ucyB9IGZyb20gJ0BmYXJyaXMvdWktbW9kYWwnO1xyXG5pbXBvcnQgeyBGYXJyaXNGb3JtU2VydmljZSB9IGZyb20gJy4vZmFycmlzLWZvcm0uc2VydmljZSc7XHJcbmltcG9ydCB7IEZyYW1lQ29udGV4dCwgRnJhbWVDb21wb25lbnQsIEJpbmRpbmdMaXN0IH0gZnJvbSAnQGZhcnJpcy9kZXZraXQnO1xyXG5pbXBvcnQgeyBvZiwgT2JzZXJ2YWJsZSwgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBMYW5ndWFnZVNlcnZpY2UgfSBmcm9tICcuL2xhbmd1YWcuc2VydmljZSc7XHJcbmltcG9ydCB7IHN3aXRjaE1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuZGVjbGFyZSBjb25zdCBTeXN0ZW06IGFueTtcclxuLyoqXHJcbiAqIOW8ueeql+acjeWKoVxyXG4gKiBAc2NvcGUgRm9ybU1vZHVsZVxyXG4gKi9cclxuQEluamVjdGFibGUoKVxyXG5jbGFzcyBEaWFsb2dTZXJ2aWNlIHtcclxuXHJcbiAgcHJpdmF0ZSBfcHJvdmlkZXJzOiBQcm92aWRlcltdID0gW107XHJcblxyXG4gIHByaXZhdGUgbGFuZ3VhZ2VTZXJ2aWNlOiBMYW5ndWFnZVNlcnZpY2U7XHJcbiAgcHJpdmF0ZSBtb2RhbFJlZjogYW55O1xyXG4gIHByaXZhdGUgbW9kYWxzOiBhbnkgPSB7fTtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIG1vZGFsU2VydmljZTogQnNNb2RhbFNlcnZpY2UsXHJcbiAgICBwcml2YXRlIGZhcnJpc0Zvcm1TZXJ2aWNlOiBGYXJyaXNGb3JtU2VydmljZSxcclxuICAgIHByaXZhdGUgX2NvbXBvbmVudEZhY3RvcnlSZXNvbHZlcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxyXG4gICAgcHJpdmF0ZSBmcmFtZUNvbnRleHQ/OiBGcmFtZUNvbnRleHQsXHJcbiAgICBAT3B0aW9uYWwoKSBwcml2YXRlIGluamVjdG9yPzogSW5qZWN0b3JcclxuICApIHtcclxuICAgIHRoaXMuc2V0TGFuZ3VhZ2VTZXJ2aWNlKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDorr7nva7or63oqIDmnI3liqFcclxuICAgKi9cclxuICBwcml2YXRlIHNldExhbmd1YWdlU2VydmljZSgpIHtcclxuXHJcbiAgICAvLyBGcmFtZUNvbnRleHTkuI3kuIDlrprlrZjlnKjvvIzkuI3og73nm7TmjqXnlKhcclxuICAgIGNvbnN0IGZyYW1lQ29udGV4dCA9IHRoaXMuZ2V0RnJhbWVDb250ZXh0KCk7XHJcbiAgICBpZiAoZnJhbWVDb250ZXh0KSB7XHJcbiAgICAgIGNvbnN0IGluamVjdG9yID0gdGhpcy5mcmFtZUNvbnRleHQuaW5qZWN0b3I7XHJcbiAgICAgIHRoaXMubGFuZ3VhZ2VTZXJ2aWNlID0gaW5qZWN0b3IuZ2V0PExhbmd1YWdlU2VydmljZT4oTGFuZ3VhZ2VTZXJ2aWNlLCBudWxsLCBJbmplY3RGbGFncy5PcHRpb25hbCk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCF0aGlzLmxhbmd1YWdlU2VydmljZSkge1xyXG4gICAgICB0aGlzLmxhbmd1YWdlU2VydmljZSA9IExhbmd1YWdlU2VydmljZS5nZXRJbnN0YW5jZSgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5YW85a655pen5by556qX77yM6I635Y+WZnJhbWVDb250ZXh0XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXRGcmFtZUNvbnRleHQoKSB7XHJcbiAgICBpZiAodGhpcy5mcmFtZUNvbnRleHQpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuZnJhbWVDb250ZXh0XHJcbiAgICB9XHJcbiAgICBpZiAodGhpc1snY29udGV4dCddICYmIHRoaXNbJ2NvbnRleHQnXVsnZnJhbWVDb250ZXh0J10pIHtcclxuICAgICAgcmV0dXJuIHRoaXNbJ2NvbnRleHQnXVsnZnJhbWVDb250ZXh0J107XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5YW85a655pen5by556qX77yM6I635Y+WQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXRDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIoKSB7XHJcbiAgICBjb25zdCBmcmFtZUNvbnRleHQgPSB0aGlzLmdldEZyYW1lQ29udGV4dCgpO1xyXG4gICAgbGV0IGNvbXBvbmVudEZhY3RvcnlSZXNvbHZlcjogYW55O1xyXG4gICAgaWYgKGZyYW1lQ29udGV4dCkge1xyXG4gICAgICBjb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIgPSBmcmFtZUNvbnRleHQuaW5qZWN0b3IuZ2V0KENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcik7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gY29tcG9uZW50RmFjdG9yeVJlc29sdmVyO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+WY29uZmln6L2s5o2i5oiQ5a+56LGh57G75Z6L55qE6YWN572uXHJcbiAgICogQHBhcmFtIGNvbmZpZyDphY3nva7poblcclxuICAgKi9cclxuICBwcml2YXRlIGdldE9iamVjdFR5cGVDb25maWcoY29uZmlnOiBhbnkpIHtcclxuICAgIGxldCBvYmplY3RUeXBlQ29uZmlnOiBhbnlcclxuICAgIGlmICh0eXBlb2YgY29uZmlnID09PSAnc3RyaW5nJykge1xyXG4gICAgICBpZiAoY29uZmlnLmxlbmd0aCkge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICBvYmplY3RUeXBlQ29uZmlnID0gSlNPTi5wYXJzZShjb25maWcpO1xyXG4gICAgICAgIH0gY2F0Y2gge1xyXG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGNvbmZpZyArICfkuI3mmK/lkIjms5XnmoRqc29u5a2X56ym5LiyJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIG9iamVjdFR5cGVDb25maWcgPSB7fTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIGlmICh0eXBlb2YgY29uZmlnID09PSAnb2JqZWN0Jykge1xyXG4gICAgICBvYmplY3RUeXBlQ29uZmlnID0gT2JqZWN0LmFzc2lnbih7fSwgY29uZmlnKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcign5aGr5YaZ5a+56LGh5qC85byP5oiWanNvbuWtl+espuS4sicpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIG9iamVjdFR5cGVDb25maWc7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDliJvlu7rmqKHmgIHmoYblhoXnu4Tku7blrp7kvovvvIzlubbov5Tlm57mqKHmgIHmoYblrp7kvovvvJvlgZrkuoblhbzlrrnogIHooajljZXlpITnkIZcclxuICAgKiBAcGFyYW0gY29uZmlnIOW8ueeql+mFjee9rlxyXG4gICAqIEBwYXJhbSBjb21wbmVudCDlvLnnqpflhoXnu4Tku7ZcclxuICAgKiBAcGFyYW0gdWlTdGF0ZU9iamVjdCDnu5HlrprlvLnnqpflhoXnu4Tku7Z1aVN0YXRlXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBjcmVhdGVNb2RhbENvbXBvbmVudFJlZihjb25maWc6IGFueSwgY29tcG9uZW50OiBhbnksIHVpU3RhdGVPYmplY3Q6IGFueSkge1xyXG4gICAgbGV0IGNvbXBvbmVudFJlZjogYW55O1xyXG4gICAgbGV0IG1vZGFsUmVmOiBhbnk7XHJcbiAgICBjb25zdCBmcmFtZUNvbnRleHQgPSB0aGlzLmdldEZyYW1lQ29udGV4dCgpO1xyXG4gICAgY29uc3QgY29tcG9uZW50RmFjdG9yeVJlc29sdmVyID0gdGhpcy5nZXRDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIoKTtcclxuICAgIGlmIChmcmFtZUNvbnRleHQgJiYgY29tcG9uZW50RmFjdG9yeVJlc29sdmVyKSB7XHJcbiAgICAgIGNvbnN0IGNvbnRlbnRDbXB0RmFjdG9yeSA9IGNvbXBvbmVudEZhY3RvcnlSZXNvbHZlci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShjb21wb25lbnQpO1xyXG4gICAgICBjb25zdCBtb2RhbENvbnRlbnRJbmplY3RvciA9IFJlZmxlY3RpdmVJbmplY3Rvci5yZXNvbHZlQW5kQ3JlYXRlKFsuLi50aGlzLl9wcm92aWRlcnNdLCBmcmFtZUNvbnRleHQuaW5qZWN0b3IpO1xyXG4gICAgICBjb21wb25lbnRSZWYgPSBjb250ZW50Q21wdEZhY3RvcnkuY3JlYXRlKG1vZGFsQ29udGVudEluamVjdG9yKTtcclxuICAgICAgaWYgKGNvbXBvbmVudFJlZiAmJiBjb21wb25lbnRSZWYuaW5zdGFuY2UgJiYgY29tcG9uZW50UmVmLmluc3RhbmNlLnZpZXdNb2RlbCAmJiBjb21wb25lbnRSZWYuaW5zdGFuY2Uudmlld01vZGVsLnVpU3RhdGUpIHtcclxuICAgICAgICBpZiAodHlwZW9mIHVpU3RhdGVPYmplY3QgPT09ICdvYmplY3QnICYmIE9iamVjdC5rZXlzKHVpU3RhdGVPYmplY3QpLmxlbmd0aCkge1xyXG4gICAgICAgICAgT2JqZWN0LmtleXModWlTdGF0ZU9iamVjdCkuZm9yRWFjaChpdGVtID0+IHtcclxuICAgICAgICAgICAgY29tcG9uZW50UmVmLmluc3RhbmNlLnZpZXdNb2RlbC51aVN0YXRlLnNldFByb3BlcnR5VmFsdWUoaXRlbSwgdWlTdGF0ZU9iamVjdFtpdGVtXSk7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8g6ZmE5YqgaXNEaWFsb2flj4LmlbBcclxuICAgICAgICBjb21wb25lbnRSZWYuaW5zdGFuY2Uudmlld01vZGVsLnVpU3RhdGUuc2V0UHJvcGVydHlWYWx1ZSgnREVWS0lUX0RJQUxPRycsIHRydWUpO1xyXG4gICAgICB9XHJcbiAgICAgIG1vZGFsUmVmID0gdGhpcy5tb2RhbFNlcnZpY2Uuc2hvdyhjb21wb25lbnRSZWYsIGNvbmZpZyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBtb2RhbFJlZiA9IHRoaXMubW9kYWxTZXJ2aWNlLnNob3coY29tcG9uZW50LCBjb25maWcpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIG1vZGFsUmVmO1xyXG4gIH1cclxuICAvKipcclxuICAgKiBcclxuICAgKiBAcGFyYW0gY29uZmlnIOaooeaAgeahhuacrOi6q+mFjee9rlxyXG4gICAqIEBwYXJhbSBtb2RhbElkIOaooeaAgeahhuWGhee7hOS7tueahGlkXHJcbiAgICogQHBhcmFtIHVpU3RhdGVDb25maWcg5qih5oCB5qGG5YaF57uE5Lu2dWlTdGF0ZeS4iueahOWtl+auteWPiuWAvFxyXG4gICAqL1xyXG4gIHB1YmxpYyBvcGVuTW9kYWwoY29uZmlnOiBhbnkgPSB7fSwgbW9kYWxJZDogc3RyaW5nLCB1aVN0YXRlQ29uZmlnOiBhbnkgPSB7fSwgY2FsbGJhY2s/OiAobW9kYWxSZWY6IGFueSkgPT4gYW55KSB7XHJcblxyXG4gICAgY29uc3QgY29uZmlnT2JqID0gdGhpcy5nZXRPYmplY3RUeXBlQ29uZmlnKGNvbmZpZyk7XHJcbiAgICBjb25zdCB1aVN0YXRlT2JqZWN0ID0gdGhpcy5nZXRPYmplY3RUeXBlQ29uZmlnKHVpU3RhdGVDb25maWcpO1xyXG4gICAgbGV0IGlubmVyQ29tcG9wbmVudCA9IHRoaXMuZmFycmlzRm9ybVNlcnZpY2UuZ2V0Q29udHJvbHMobW9kYWxJZCk7XHJcbiAgICBsZXQgbW9kYWxSZWY6IGFueTtcclxuICAgIGxldCBtb2RhbENvbmZpZzogYW55ID0ge1xyXG4gICAgICB0aXRsZTogdGhpcy5sYW5ndWFnZVNlcnZpY2UuZGVmYXVsdERpYWxvZ1RpdGxlLFxyXG4gICAgICB3aWR0aDogNzYwLFxyXG4gICAgICBoZWlnaHQ6IDQ1MCxcclxuICAgICAgc2hvd0J1dHRvbnM6IGZhbHNlXHJcbiAgICB9O1xyXG4gICAgbW9kYWxDb25maWcgPSBPYmplY3QuYXNzaWduKG1vZGFsQ29uZmlnLCBjb25maWdPYmopO1xyXG4gICAgY29uc3Qgb25DbG9zaW5nSGFuZGxlciA9IG1vZGFsQ29uZmlnLmJlZm9yZUNsb3NlO1xyXG4gICAgLy8gdHNsaW50OmRpc2FibGU6IG5vLXN0cmluZy1saXRlcmFsXHJcbiAgICBjb25zdCBjYW5jZWxDaGFuZ2VzID0gbW9kYWxDb25maWdbJ2NhbmNlbENoYW5nZXMnXSB8fCBmYWxzZTtcclxuICAgIG1vZGFsQ29uZmlnLmJlZm9yZUNsb3NlID0gKHJlZikgPT4ge1xyXG4gICAgICAvLyBpZiAocmVmICYmIHJlZi5tb2RhbFJlZiAmJiByZWYubW9kYWxSZWYuY29udGVudCkge1xyXG4gICAgICAvLyAgIHJlZi5tb2RhbFJlZi5jb250ZW50LmlzRGlhbG9nUm9vdENvbXBvbmVudCA9IGZhbHNlO1xyXG4gICAgICAvLyB9XHJcbiAgICAgIGlmICghIW9uQ2xvc2luZ0hhbmRsZXIgJiYgdHlwZW9mIG9uQ2xvc2luZ0hhbmRsZXIgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICByZXR1cm4gb25DbG9zaW5nSGFuZGxlcihyZWYpLnBpcGUoXHJcbiAgICAgICAgICBzd2l0Y2hNYXAocmVzdWx0ID0+IHtcclxuICAgICAgICAgICAgaWYgKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgIGlmIChjYW5jZWxDaGFuZ2VzKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jYW5jZWxDaGFuZ2VzKHJlZik7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBvZihyZXN1bHQpO1xyXG4gICAgICAgICAgfSlcclxuICAgICAgICApO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChjYW5jZWxDaGFuZ2VzKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2FuY2VsQ2hhbmdlcyhyZWYpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJldHVybiBvZih0cnVlKTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgIGNvbnN0IHJlbW90ZSA9IG1vZGFsQ29uZmlnLnJlbW90ZSB8fCBmYWxzZTtcclxuICAgIGlmIChyZW1vdGUpIHtcclxuICAgICAgdGhpcy5jcmVhdGVSZW1vdGVGb3JtKG1vZGFsQ29uZmlnLCB1aVN0YXRlT2JqZWN0KS5zdWJzY3JpYmUoXHJcbiAgICAgICAgKG1vZGFsUmVmOiBhbnkpID0+IHtcclxuICAgICAgICAgIHRoaXMubW9kYWxSZWYgPSBtb2RhbFJlZjtcclxuICAgICAgICAgIGlmIChtb2RhbFJlZiAmJiAhIW1vZGFsUmVmLmNvbnRlbnQpIHtcclxuICAgICAgICAgICAgbW9kYWxSZWYuY29udGVudC5pc0RpYWxvZ1Jvb3RDb21wb25lbnQgPSB0cnVlO1xyXG4gICAgICAgICAgICBtb2RhbFJlZi5jb250ZW50LmRpYWxvZ1JlZiA9IG1vZGFsUmVmO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgY2FsbGJhY2sobW9kYWxSZWYpO1xyXG4gICAgICAgIH1cclxuICAgICAgKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGlmICghaW5uZXJDb21wb3BuZW50KSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihg6I635Y+W5o6n5Lu25aSx6LSl77yMbW9kYWxJZD0ke21vZGFsSWR9YCk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICh0eXBlb2YgaW5uZXJDb21wb3BuZW50ID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgIG1vZGFsQ29uZmlnLmRpYWxvZ1R5cGUgPSAnaWZyYW1lJztcclxuICAgICAgICBtb2RhbFJlZiA9IHRoaXMubW9kYWxTZXJ2aWNlLnNob3coaW5uZXJDb21wb3BuZW50LCBtb2RhbENvbmZpZyk7XHJcbiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGlubmVyQ29tcG9wbmVudCA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgIG1vZGFsUmVmID0gdGhpcy5jcmVhdGVNb2RhbENvbXBvbmVudFJlZihtb2RhbENvbmZpZywgaW5uZXJDb21wb3BuZW50LCB1aVN0YXRlT2JqZWN0KTtcclxuICAgICAgfSBlbHNlIGlmICh0eXBlb2YgaW5uZXJDb21wb3BuZW50ID09PSAnb2JqZWN0Jykge1xyXG4gICAgICAgIC8vIOWmguaenOaYr+WvueixoSDkuJTkvb/nlKjni6znq4tqc+WKoOi9vVxyXG4gICAgICAgIC8vIHtcInVzZUlzb2xhdGVKc1wiOnRydWUsXCJtb2RhbEluc3RhbmNlXCI6ZigpfVxyXG4gICAgICAgIGlmIChpbm5lckNvbXBvcG5lbnQudXNlSXNvbGF0ZUpzKSB7XHJcbiAgICAgICAgICBjb25zdCBwYXJhbWV0ZXIgPSB7XHJcbiAgICAgICAgICAgIGluamVjdG9yOiB0aGlzLmluamVjdG9yLFxyXG4gICAgICAgICAgICB1aVN0YXRlOiB1aVN0YXRlT2JqZWN0LFxyXG4gICAgICAgICAgICBtb2RhbFNlcnZpY2U6IHRoaXMubW9kYWxTZXJ2aWNlLFxyXG4gICAgICAgICAgICBkaWFsb2dTZXJ2aWNlSW5zdGFuY2U6IHRoaXMsXHJcbiAgICAgICAgICAgIGV2ZW50QnVzOiB0aGlzLmZyYW1lQ29udGV4dC5nZXRWaXJ0dWFsUm9vdEZyYW1lQ29udGV4dCgpLmV2ZW50QnVzLFxyXG4gICAgICAgICAgICBjb21wb25lbnRDYWxsYmFjazogdGhpcy5jb21wb25lbnRNb2RpZnksXHJcbiAgICAgICAgICAgIG1vZGFsSW5zdGFuY2VDYWxsYmFjazogdGhpcy5tb2RhbEluc3RhbmNlQ2FsbGJhY2tcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgICAvLyDkvJrlnKjlhoXpg6jov5vooYxcclxuICAgICAgICAgIHJldHVybiBpbm5lckNvbXBvcG5lbnRbXCJtb2RhbEluc3RhbmNlXCJdKG1vZGFsQ29uZmlnLCBwYXJhbWV0ZXIpO1xyXG5cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgbW9kYWxSZWYgPSB0aGlzLm1vZGFsU2VydmljZS5zaG93KGlubmVyQ29tcG9wbmVudCwgbW9kYWxDb25maWcpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgdGhpcy5tb2RhbFJlZiA9IG1vZGFsUmVmO1xyXG4gICAgICBpZiAobW9kYWxSZWYgJiYgISFtb2RhbFJlZi5jb250ZW50KSB7XHJcbiAgICAgICAgbW9kYWxSZWYuY29udGVudC5pc0RpYWxvZ1Jvb3RDb21wb25lbnQgPSB0cnVlO1xyXG4gICAgICAgIG1vZGFsUmVmLmNvbnRlbnQuZGlhbG9nUmVmID0gbW9kYWxSZWY7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIG1vZGFsUmVmO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBjb21wb25lbnRNb2RpZnkoY21wUmVmOiBhbnksIHBhcmFtZXRlcjoge1xyXG4gICAgdWlzdGF0ZTogYW55XHJcbiAgfSkge1xyXG4gICAgaWYgKGNtcFJlZiAmJiBjbXBSZWYuaW5zdGFuY2UgJiYgY21wUmVmLmluc3RhbmNlLnZpZXdNb2RlbCAmJiBjbXBSZWYuaW5zdGFuY2Uudmlld01vZGVsLnVpU3RhdGUpIHtcclxuICAgICAgaWYgKHBhcmFtZXRlci51aXN0YXRlICYmIHR5cGVvZiBwYXJhbWV0ZXIudWlzdGF0ZSA9PT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgIHBhcmFtZXRlci51aXN0YXRlID0gSlNPTi5wYXJzZShwYXJhbWV0ZXIudWlzdGF0ZSk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKHR5cGVvZiBwYXJhbWV0ZXIudWlzdGF0ZSA9PT0gJ29iamVjdCcgJiYgT2JqZWN0LmtleXMocGFyYW1ldGVyLnVpc3RhdGUpLmxlbmd0aCkge1xyXG4gICAgICAgIE9iamVjdC5rZXlzKHBhcmFtZXRlci51aXN0YXRlKS5mb3JFYWNoKGl0ZW0gPT4ge1xyXG4gICAgICAgICAgY21wUmVmLmluc3RhbmNlLnZpZXdNb2RlbC51aVN0YXRlLnNldFByb3BlcnR5VmFsdWUoaXRlbSwgcGFyYW1ldGVyLnVpc3RhdGVbaXRlbV0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICAgIC8vIOmZhOWKoGlzRGlhbG9n5Y+C5pWwXHJcbiAgICAgIGNtcFJlZi5pbnN0YW5jZS52aWV3TW9kZWwudWlTdGF0ZS5zZXRQcm9wZXJ0eVZhbHVlKCdERVZLSVRfRElBTE9HJywgdHJ1ZSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIG1vZGFsSW5zdGFuY2VDYWxsYmFjayhjbXBSZWY6IGFueSwgb3B0aW9uczogYW55LCBwYXJhbWV0ZXI6IGFueSkge1xyXG4gICAgaWYgKHBhcmFtZXRlciAmJiBwYXJhbWV0ZXIubW9kYWxTZXJ2aWNlKSB7XHJcbiAgICAgIGNvbnN0IG1vZGFsUmVmID0gcGFyYW1ldGVyLm1vZGFsU2VydmljZS5zaG93KGNtcFJlZiwgb3B0aW9ucyk7XHJcbiAgICAgIGlmIChtb2RhbFJlZiAmJiAhIW1vZGFsUmVmLmNvbnRlbnQpIHtcclxuICAgICAgICBtb2RhbFJlZi5jb250ZW50LmlzRGlhbG9nUm9vdENvbXBvbmVudCA9IHRydWU7XHJcbiAgICAgICAgbW9kYWxSZWYuY29udGVudC5kaWFsb2dSZWYgPSBtb2RhbFJlZjtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gbW9kYWxSZWY7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmiZPlvIDnsbvluK7liqnooajljZVcclxuICAgKiBAcGFyYW0gZnJhbWVJZCBcclxuICAgKiBAcGFyYW0gcGFyYW1zIFxyXG4gICAqIEBwYXJhbSBjb25maWdzIFxyXG4gICAqIEBkZXNjcmlwdGlvbiDlvLnlh7rooajljZXlkozlvLnlh7rov5znq6/ooajljZXljLrliKvkuLrlvLnlh7rooajljZXpnIDopoHphY3nva7lrZfmrrXmmKDlsIRcclxuICAgKi9cclxuICBwdWJsaWMgb3BlbkhlbHBNb2RhbChmcmFtZUlkOiBzdHJpbmcsIHBhcmFtczogc3RyaW5nLCBjb25maWdzPzogYW55KSB7XHJcbiAgICBjb25zdCBldmVudHMgPSB0aGlzWydjb250ZXh0J11bJ2V2ZW50UGFyYW0nXSB8fCB7fTtcclxuICAgIC8vIOWNoeeJh+WcuuaZr+S8oOmAkui/h+adpeeahOS6i+S7tuaYr+iHquWumuS5ieWvueixoe+8jOWMheWQq2V2ZW505ZKMb3B0aW9uc+OAguWIl+ihqOWcuuaZr+S8oOmAkui/h+adpeeahOS6i+S7tuWPguaVsOaYr+aZrumAmuS6i+S7tuWPguaVsO+8jOWcqOWPguaVsOS4reaQuuW4puS6hmVkaXRvci5vcHRpb25zXHJcbiAgICBjb25zdCBldmVudCA9IGV2ZW50cy5ldmVudCB8fCBldmVudHM7XHJcbiAgICBjb25zdCBvcHRpb25zID0gZXZlbnRzLm9wdGlvbnMgfHwgZXZlbnRzLmVkaXRvciAmJiBldmVudHMuZWRpdG9yLm9wdGlvbnMgfHwge307XHJcbiAgICBjb25zdCBjb250ZXh0ID0gZXZlbnRzICYmIGV2ZW50cy5jb250ZXh0O1xyXG4gICAgY29uc3Qgc3ViamVjdCA9IG5ldyBTdWJqZWN0PGFueT4oKTtcclxuICAgIC8vIG1vZGFsSWTlnKjkuKTnp43lnLrmma/kuIvpg73pnIDopoHvvIznlKjmnaXljLrliIblrp7kvotcclxuICAgIGNvbnN0IHsgbW9kYWxJZCA9IG51bGwgfSA9IG9wdGlvbnM7XHJcbiAgICBpZiAoIWNvbmZpZ3MpIHtcclxuICAgICAgY29uZmlncyA9ICd7fSc7XHJcbiAgICB9XHJcbiAgICBpZiAodHlwZW9mIGNvbmZpZ3MgPT09ICdzdHJpbmcnICYmIGNvbmZpZ3MubGVuZ3RoID4gMCkge1xyXG4gICAgICBjb25maWdzID0gSlNPTi5wYXJzZShjb25maWdzKTtcclxuICAgIH1cclxuICAgIGNvbnN0IHsgcmVtb3RlID0gZmFsc2UsIGN1cnJlbnRSb3cgPSBmYWxzZSwgYXJlYVJlc3BvbnNlID0gdW5kZWZpbmVkIH0gPSBjb25maWdzIHx8IHt9O1xyXG4gICAgLy8g5pSv5oyBYXJlYVJlc3BvbnNl6YWN572uXHJcbiAgICBpZiAoYXJlYVJlc3BvbnNlICE9PSB1bmRlZmluZWQgJiYgb3B0aW9ucy5hcmVhUmVzcG9uc2UgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICBvcHRpb25zLmFyZWFSZXNwb25zZSA9IGFyZWFSZXNwb25zZTtcclxuICAgIH1cclxuICAgIGlmIChyZW1vdGUpIHtcclxuICAgICAgY29uc3QgbWFwRmllbGRzID0gY29uZmlncy5tYXBGaWVsZHMgfHwge307XHJcbiAgICAgIG9wdGlvbnMucmVtb3RlID0gcmVtb3RlICsgJz92PScgKyBuZXcgRGF0ZSgpLnZhbHVlT2YoKTtcclxuICAgICAgdGhpcy5vcGVuTW9kYWwob3B0aW9ucywgbW9kYWxJZCwgcGFyYW1zLCAoZGlhbG9nUmVmOiBhbnkpID0+IHtcclxuICAgICAgICAvLyDmlrDlop5ldmVudOWPguaVsO+8iOS4uuS6huS7peWQjuiwg+eUqGV2ZW505Lit55qEZm9ybUNvbnRyb2zku6XpgILphY3liJfooajkuK3nmoTmmbrog73ovpPlhaXmoYblvLnlh7rooajljZXvvIlcclxuICAgICAgICB0aGlzLm1vZGFsc1ttb2RhbElkXSA9IHsgc3ViamVjdCwgZnJhbWVJZDogZnJhbWVJZCwgbWFwRmllbGRzLCBkaWFsb2dSZWYsIGN1cnJlbnRSb3csIGV2ZW50OiBldmVudCwgY29udGV4dCB9O1xyXG4gICAgICB9KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnN0IGRpYWxvZ1JlZiA9IHRoaXMub3Blbk1vZGFsKG9wdGlvbnMsIG1vZGFsSWQsIHBhcmFtcyk7XHJcbiAgICAgIGNvbnN0IG1hcEZpZWxkcyA9IG9wdGlvbnMubWFwRmllbGRzIHx8IHt9O1xyXG4gICAgICB0aGlzLm1vZGFsc1ttb2RhbElkXSA9IHsgc3ViamVjdCwgZnJhbWVJZDogZnJhbWVJZCwgbWFwRmllbGRzLCBkaWFsb2dSZWYsIGN1cnJlbnRSb3csIGV2ZW50OiBldmVudCwgY29udGV4dCB9O1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHN1YmplY3Q7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmiZPlvIDluKblm57osIPnmoTlvLnnqpdcclxuICAgKiBAcGFyYW0gZnJhbWVJZCBmcmFtZUlkXHJcbiAgICogQHBhcmFtIHBhcmFtcyDlj4LmlbBcclxuICAgKiBAcGFyYW0gY29uZmlncyDphY3nva5cclxuICAgKiBAcmV0dXJucyBcclxuICAgKi9cclxuICBwdWJsaWMgb3BlbkNhbGxiYWNrYWJsZU1vZGFsKGZyYW1lSWQ6IHN0cmluZywgcGFyYW1zPzogc3RyaW5nLCBjb25maWdzPzogYW55KSB7XHJcbiAgICBpZiAoIWNvbmZpZ3MpIHtcclxuICAgICAgY29uZmlncyA9ICd7fSc7XHJcbiAgICB9XHJcbiAgICBpZiAodHlwZW9mIGNvbmZpZ3MgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgIGNvbmZpZ3MgPSBKU09OLnBhcnNlKGNvbmZpZ3MpO1xyXG4gICAgfVxyXG4gICAgY29uc3QgZXZlbnRzID0gdGhpc1snY29udGV4dCddICYmIHRoaXNbJ2NvbnRleHQnXVsnZXZlbnRQYXJhbSddIHx8IHt9O1xyXG4gICAgY29uc3Qgb3B0aW9ucyA9IGV2ZW50cy5vcHRpb25zO1xyXG4gICAgb3B0aW9ucy5zaG93QnV0dG9ucyA9IHRydWU7XHJcbiAgICBvcHRpb25zLmJ1dHRvbnMgPSBbXHJcbiAgICAgIHtcclxuICAgICAgICB0ZXh0OiB0aGlzLmxhbmd1YWdlU2VydmljZS5jb25maXJtLCBjbHM6ICdidG4gYnRuLXByaW1hcnknLCBoYW5kbGU6IChldmVudDogYW55KSA9PiB7XHJcbiAgICAgICAgICBjb25zdCB7IG1vZGFsSWQgPSBudWxsIH0gPSBvcHRpb25zIHx8IHt9O1xyXG4gICAgICAgICAgaWYgKG1vZGFsSWQpIHtcclxuICAgICAgICAgICAgY29uc3QgbW9kYWwgPSB0aGlzLm1vZGFsc1ttb2RhbElkXTtcclxuICAgICAgICAgICAgY29uc3QgeyBzdWJqZWN0ID0gbnVsbCwgZGlhbG9nUmVmID0gbnVsbCwgZnJhbWVJZCA9IG51bGwsIGhhbmRsZSA9IG51bGwsIGN1cnJlbnRSb3cgPSBmYWxzZSB9ID0gbW9kYWwgfHwge307XHJcbiAgICAgICAgICAgIGNvbnN0IGZvcm1DbXAgPSBkaWFsb2dSZWYuY29udGVudDsgLy8g5by556qX6KGo5Y2V5a6e5L6LXHJcbiAgICAgICAgICAgIGlmICghZm9ybUNtcCkge1xyXG4gICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcign5LiN5pSv5oyB55qE6KGo5Y2V57G75Z6LJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbGV0IHNlbGVjdGVkSXRlbXMgPSBbXTtcclxuICAgICAgICAgICAgaWYgKGN1cnJlbnRSb3cgPT09IHRydWUpIHtcclxuICAgICAgICAgICAgICBsZXQgZnJhbWVDb210ZXh0OiBGcmFtZUNvbnRleHQ7XHJcbiAgICAgICAgICAgICAgaWYgKGZvcm1DbXAuY29udGV4dCkge1xyXG4gICAgICAgICAgICAgICAgZnJhbWVDb210ZXh0ID0gZm9ybUNtcC5jb250ZXh0LmFwcENvbnRleHQuZnJhbWVDb250ZXh0TWFuYWdlci5nZXRGcmFtZUNvbnRleHRCeUlkKGZyYW1lSWQpIGFzIEZyYW1lQ29udGV4dDtcclxuICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgZnJhbWVDb210ZXh0ID0gZm9ybUNtcC5hcHBDb250ZXh0LmZyYW1lQ29udGV4dE1hbmFnZXIuZ2V0RnJhbWVDb250ZXh0QnlJZChmcmFtZUlkKSBhcyBGcmFtZUNvbnRleHQ7XHJcbiAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICBpZiAoIWZyYW1lQ29tdGV4dCkge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGDml6DmlYjnmoRmcmFtZUlk77yaJHtmcmFtZUlkfe+8jOivt+ehruiupOWRveS7pOS4rWZyYW1lSWTmraPnoa7jgIJgKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgY29uc3QgYmluZGluZ0xpc3QgPSBmcmFtZUNvbXRleHQuYmluZGluZ0RhdGEuZ2V0TGlzdCgpIGFzIEJpbmRpbmdMaXN0O1xyXG4gICAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSBiaW5kaW5nTGlzdCAmJiBiaW5kaW5nTGlzdC5jdXJyZW50SXRlbSAmJiBiaW5kaW5nTGlzdC5jdXJyZW50SXRlbS50b0pTT04oKTtcclxuICAgICAgICAgICAgICBzZWxlY3RlZEl0ZW1zID0gW2l0ZW1dO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgIGxldCByb3dzOiBNYXA8c3RyaW5nLCBhbnk+O1xyXG4gICAgICAgICAgICAgIC8vIOWmguaenGNvbnRleHTkuLrnqbog6YKj5LmI5bCd6K+V5LuO5a+55bqU55qEYXBwY29udGV4dOivu+WPlu+8jOS4u+imgeebrueahOaYr+S4uuS6huino+aekOihqOWNleeahOW8ueWHulxyXG4gICAgICAgICAgICAgIGlmIChmb3JtQ21wLmNvbnRleHQpIHtcclxuICAgICAgICAgICAgICAgIHJvd3MgPSBmb3JtQ21wLmNvbnRleHQuYXBwQ29udGV4dC5mcmFtZUNvbnRleHRNYW5hZ2VyLmdldEZyYW1lQ29udGV4dEJ5SWQoZnJhbWVJZCkudWlTdGF0ZS5yb3dzIHx8IG5ldyBNYXA8c3RyaW5nLCBhbnk+KCk7XHJcbiAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJvd3MgPSBmb3JtQ21wLmFwcENvbnRleHQuZnJhbWVDb250ZXh0TWFuYWdlci5nZXRGcmFtZUNvbnRleHRCeUlkKGZyYW1lSWQpLnVpU3RhdGUucm93cyB8fCBuZXcgTWFwPHN0cmluZywgYW55PigpO1xyXG4gICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgc2VsZWN0ZWRJdGVtcyA9IEFycmF5LmZyb20ocm93cy52YWx1ZXMoKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBoYW5kbGUgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgICBoYW5kbGUoc2VsZWN0ZWRJdGVtcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHN1YmplY3QpIHtcclxuICAgICAgICAgICAgICBzdWJqZWN0Lm5leHQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBkaWFsb2dSZWYuY2xvc2Uob3B0aW9ucyk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9LFxyXG4gICAgICB7IHRleHQ6IHRoaXMubGFuZ3VhZ2VTZXJ2aWNlLmNhbmNlbCwgY2xzOiAnYnRuJywgaGFuZGxlOiAoZXZlbnQ6IGFueSkgPT4gdGhpcy5jYW5jZWwob3B0aW9ucykgfVxyXG4gICAgXTtcclxuXHJcbiAgICBjb25zdCBzdWJqZWN0ID0gbmV3IFN1YmplY3Q8YW55PigpO1xyXG4gICAgY29uc3QgeyBtb2RhbElkID0gbnVsbCB9ID0gb3B0aW9ucztcclxuICAgIGNvbnN0IHsgcmVtb3RlID0gbnVsbCwgY3VycmVudFJvdyA9IGZhbHNlLCBhcmVhUmVzcG9uc2UgPSB1bmRlZmluZWQgfSA9IGNvbmZpZ3M7XHJcbiAgICBjb25zdCBoYW5kbGUgPSBvcHRpb25zLmhhbmRsZTtcclxuICAgIC8vIOaUr+aMgWFyZWFSZXNwb25zZemFjee9rlxyXG4gICAgaWYgKGFyZWFSZXNwb25zZSAhPT0gdW5kZWZpbmVkICYmIG9wdGlvbnMuYXJlYVJlc3BvbnNlID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgb3B0aW9ucy5hcmVhUmVzcG9uc2UgPSBhcmVhUmVzcG9uc2U7XHJcbiAgICB9XHJcbiAgICBpZiAocmVtb3RlKSB7XHJcbiAgICAgIG9wdGlvbnMucmVtb3RlID0gcmVtb3RlICsgJz92PScgKyBuZXcgRGF0ZSgpLnZhbHVlT2YoKTtcclxuICAgICAgdGhpcy5vcGVuTW9kYWwob3B0aW9ucywgbW9kYWxJZCwgcGFyYW1zLCAoZGlhbG9nUmVmOiBhbnkpID0+IHtcclxuICAgICAgICB0aGlzLm1vZGFsc1ttb2RhbElkXSA9IHsgc3ViamVjdCwgZnJhbWVJZDogZnJhbWVJZCwgZGlhbG9nUmVmLCBoYW5kbGUsIGN1cnJlbnRSb3csIGV2ZW50OiBldmVudHMuZXZlbnQgfTtcclxuICAgICAgfSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zdCBkaWFsb2dSZWYgPSB0aGlzLm9wZW5Nb2RhbChvcHRpb25zLCBtb2RhbElkLCBwYXJhbXMpO1xyXG4gICAgICB0aGlzLm1vZGFsc1ttb2RhbElkXSA9IHsgc3ViamVjdCwgZnJhbWVJZDogZnJhbWVJZCwgZGlhbG9nUmVmLCBoYW5kbGUsIGN1cnJlbnRSb3csIGV2ZW50OiBldmVudHMuZXZlbnQgfTtcclxuICAgIH1cclxuICAgIHJldHVybiBzdWJqZWN0O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog56Gu6K6k5oyJ6ZKu5LqL5Lu2XHJcbiAgICogQHBhcmFtIGFyZ3MgXHJcbiAgICovXHJcbiAgcHVibGljIGNvbmZpcm0oKSB7XHJcbiAgICBjb25zdCBldmVudHMgPSB0aGlzWydjb250ZXh0J10gJiYgdGhpc1snY29udGV4dCddWydldmVudFBhcmFtJ10gfHwge307XHJcbiAgICBjb25zdCB7IG1vZGFsSWQgPSBudWxsIH0gPSBldmVudHMgfHwge307XHJcbiAgICBpZiAobW9kYWxJZCkge1xyXG4gICAgICBjb25zdCBtb2RhbCA9IHRoaXMubW9kYWxzW21vZGFsSWRdO1xyXG4gICAgICBjb25zdCB7IHN1YmplY3QgPSBudWxsLCBkaWFsb2dSZWYgPSBudWxsLCBtYXBGaWVsZHMgPSB7fSwgZnJhbWVJZCA9IG51bGwsIGN1cnJlbnRSb3cgPSBmYWxzZSwgZXZlbnQgPSBudWxsLCBjb250ZXh0ID0gbnVsbCB9ID0gbW9kYWwgfHwge307XHJcbiAgICAgIGNvbnN0IGZvcm1DbXAgPSBkaWFsb2dSZWYuY29udGVudDsgLy8g5by556qX6KGo5Y2V5a6e5L6LXHJcbiAgICAgIGlmICghZm9ybUNtcCkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcign5LiN5pSv5oyB55qE6KGo5Y2V57G75Z6LJyk7XHJcbiAgICAgIH1cclxuICAgICAgLy8gY29uc3Qgc2VsZWN0ZWRJZHMgPSBmb3JtQ21wLmNvbnRleHQuYXBwQ29udGV4dC5mcmFtZUNvbnRleHRNYW5hZ2VyLmdldEZyYW1lQ29udGV4dEJ5SWQoZnJhbWVJZCkudWlTdGF0ZS5pZHM7XHJcblxyXG4gICAgICBsZXQgc2VsZWN0ZWRJdGVtcyA9IFtdO1xyXG4gICAgICBpZiAoY3VycmVudFJvdyA9PT0gdHJ1ZSkge1xyXG4gICAgICAgIGNvbnN0IGZyYW1lQ29tdGV4dCA9IGZvcm1DbXAuY29udGV4dC5hcHBDb250ZXh0LmZyYW1lQ29udGV4dE1hbmFnZXIuZ2V0RnJhbWVDb250ZXh0QnlJZChmcmFtZUlkKSBhcyBGcmFtZUNvbnRleHQ7XHJcbiAgICAgICAgaWYgKCFmcmFtZUNvbXRleHQpIHtcclxuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihg5peg5pWI55qEZnJhbWVJZO+8miR7ZnJhbWVJZH3vvIzor7fnoa7orqTlkb3ku6TkuK1mcmFtZUlk5q2j56Gu44CCYCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGJpbmRpbmdMaXN0ID0gZnJhbWVDb210ZXh0LmJpbmRpbmdEYXRhLmdldExpc3QoKSBhcyBCaW5kaW5nTGlzdDtcclxuICAgICAgICBjb25zdCBpdGVtID0gYmluZGluZ0xpc3QgJiYgYmluZGluZ0xpc3QuY3VycmVudEl0ZW0gJiYgYmluZGluZ0xpc3QuY3VycmVudEl0ZW0udG9KU09OKCk7XHJcbiAgICAgICAgaWYgKGl0ZW0gJiYgT2JqZWN0LmtleXMoaXRlbSkubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgc2VsZWN0ZWRJdGVtcyA9IFtpdGVtXTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uc3Qgcm93czogTWFwPHN0cmluZywgYW55PiA9IGZvcm1DbXAuY29udGV4dC5hcHBDb250ZXh0LmZyYW1lQ29udGV4dE1hbmFnZXIuZ2V0RnJhbWVDb250ZXh0QnlJZChmcmFtZUlkKS51aVN0YXRlLnJvd3MgfHwgbmV3IE1hcDxzdHJpbmcsIGFueT4oKTtcclxuICAgICAgICBzZWxlY3RlZEl0ZW1zID0gQXJyYXkuZnJvbShyb3dzLnZhbHVlcygpKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8g5pig5bCE5a2X5q615pWw5o2uXHJcbiAgICAgIC8vIOiOt+WPluinpuWPkeW8ueahhueahOe8lui+keWZqOeahOWtl+auteWQjeensFxyXG4gICAgICBsZXQgZWRpdG9yRmllbGQgPSB1bmRlZmluZWQ7XHJcbiAgICAgIGlmIChldmVudCAmJiBldmVudC5lZGl0b3IgJiYgZXZlbnQuZWRpdG9yLmNvbHVtbikge1xyXG4gICAgICAgIGVkaXRvckZpZWxkID0gZXZlbnQuZWRpdG9yLmNvbHVtbi5maWVsZDtcclxuICAgICAgfVxyXG4gICAgICBpZiAoc2VsZWN0ZWRJdGVtcyAmJiBtYXBGaWVsZHMpIHtcclxuICAgICAgICBPYmplY3Qua2V5cyhtYXBGaWVsZHMpLmZvckVhY2goayA9PiB7XHJcbiAgICAgICAgICBjb25zdCB0YXJnZXRGaWVsZDogc3RyaW5nID0gbWFwRmllbGRzW2tdO1xyXG4gICAgICAgICAgY29uc3Qgc291cmNlS2V5QXJyYXkgPSBrLnNwbGl0KCcuJykuZmlsdGVyKHAgPT4gcCkgfHwgW107XHJcbiAgICAgICAgICBjb25zdCB0YXJnZXRWYWx1ZSA9IHNlbGVjdGVkSXRlbXMubWFwKHIgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gc291cmNlS2V5QXJyYXkucmVkdWNlKCh0YXJnZXQsIGtleSkgPT4ge1xyXG4gICAgICAgICAgICAgIGlmICh0YXJnZXQgJiYgKHRhcmdldC5oYXNPd25Qcm9wZXJ0eShrZXkpIHx8IHRhcmdldFsnX19wcm90b19fJ10uaGFzT3duUHJvcGVydHkoa2V5KSkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0YXJnZXRba2V5XTtcclxuICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgcik7XHJcbiAgICAgICAgICB9KS5qb2luKCcsJyk7XHJcbiAgICAgICAgICBpZiAodGFyZ2V0RmllbGQpIHtcclxuICAgICAgICAgICAgY29uc3QgYmluZGluZ1BhdGhzID0gdGhpcy5mcmFtZUNvbnRleHQudmlld01vZGVsLmJpbmRpbmdQYXRoLnNwbGl0KCcvJykuZmlsdGVyKHAgPT4gcCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHRhcmdldEZpZWxkcyA9IHRhcmdldEZpZWxkLnNwbGl0KCcsJykuZmlsdGVyKHAgPT4gcCk7XHJcbiAgICAgICAgICAgIHRhcmdldEZpZWxkcy5mb3JFYWNoKHRhcmdldCA9PiB7XHJcbiAgICAgICAgICAgICAgaWYgKGNvbnRleHQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2V0VmFsdWVCeVBhdGgoY29udGV4dCwgdGFyZ2V0LCB0YXJnZXRWYWx1ZSk7XHJcbiAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldFBhdGggPSB0YXJnZXQuc3BsaXQoJy4nKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZnJhbWVDb250ZXh0LmJpbmRpbmdEYXRhLnNldFZhbHVlKGJpbmRpbmdQYXRocy5jb25jYXQodGFyZ2V0UGF0aCksIHRhcmdldFZhbHVlLCB0cnVlLCB0cnVlKTtcclxuICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgICB9XHJcbiAgICAgIGlmIChzdWJqZWN0KSB7XHJcbiAgICAgICAgc3ViamVjdC5uZXh0KCk7XHJcbiAgICAgIH1cclxuICAgICAgZGlhbG9nUmVmLmNsb3NlKCk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWPlua2iOaMiemSruS6i+S7tlxyXG4gICAqIEBwYXJhbSBhcmdzIFxyXG4gICAqL1xyXG4gIHB1YmxpYyBjYW5jZWwoZXZlbnQ/OiBhbnkpIHtcclxuICAgIGNvbnN0IGV2ZW50cyA9IGV2ZW50IHx8IHRoaXNbJ2NvbnRleHQnXSAmJiB0aGlzWydjb250ZXh0J11bJ2V2ZW50UGFyYW0nXSB8fCB7fTtcclxuICAgIGNvbnN0IHsgbW9kYWxJZCA9IG51bGwgfSA9IGV2ZW50cyB8fCB7fTtcclxuICAgIGlmIChtb2RhbElkKSB7XHJcbiAgICAgIGNvbnN0IG1vZGFsID0gdGhpcy5tb2RhbHNbbW9kYWxJZF07XHJcbiAgICAgIGNvbnN0IHsgc3ViamVjdCA9IG51bGwsIGRpYWxvZ1JlZiA9IG51bGwgfSA9IG1vZGFsIHx8IHt9O1xyXG4gICAgICBpZiAoc3ViamVjdCkge1xyXG4gICAgICAgIHN1YmplY3QubmV4dCgpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChkaWFsb2dSZWYpIHtcclxuICAgICAgICBkaWFsb2dSZWYuY2xvc2UoKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuICAvKipcclxuICAgKiDlj5bmtojmnI3liqHlmajlj5jmm7Tpm4ZcclxuICAgKi9cclxuICBwcml2YXRlIGNhbmNlbENoYW5nZXMocmVmOiBhbnkpOiBPYnNlcnZhYmxlPGJvb2xlYW4+IHtcclxuICAgIGlmIChyZWYgJiYgcmVmLm1vZGFsUmVmICYmIHJlZi5tb2RhbFJlZi5jb250ZW50KSB7XHJcbiAgICAgIGNvbnN0IGNvbXBvbmVudDogRnJhbWVDb21wb25lbnQgPSByZWYubW9kYWxSZWYuY29udGVudCBhcyBGcmFtZUNvbXBvbmVudDtcclxuICAgICAgaWYgKGNvbXBvbmVudCAmJiBjb21wb25lbnQuY29udGV4dCkge1xyXG4gICAgICAgIGNvbnN0IHJlcG9zaXRvcnkgPSBjb21wb25lbnQuY29udGV4dC5yZXBvc2l0b3J5IHx8IG51bGw7XHJcbiAgICAgICAgaWYgKHJlcG9zaXRvcnkpIHtcclxuICAgICAgICAgIHJldHVybiByZXBvc2l0b3J5LmNhbmNlbENoYW5nZXMoKS5waXBlKHN3aXRjaE1hcCgoKSA9PiBvZih0cnVlKSkpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDlhbPpl63or6XlvLnnqpdcclxuICAgKi9cclxuICBjbG9zZU1vZGFsKCkge1xyXG4gICAgaWYgKHRoaXMubW9kYWxSZWYpIHtcclxuICAgICAgdGhpcy5tb2RhbFJlZi5jbG9zZSgpO1xyXG4gICAgfVxyXG4gIH1cclxuICAvKipcclxuICAgKiDliJvlu7rov5znqIvooajljZXlrp7kvotcclxuICAgKiBAcGFyYW0gb3B0aW9ucyBkaWFsb2fphY3nva5cclxuICAgKiBAcGFyYW0gdWlTdGF0ZSB1aXN0YXRlXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBjcmVhdGVSZW1vdGVGb3JtKG9wdGlvbnM6IGFueSwgdWlTdGF0ZTogYW55KTogU3ViamVjdDxhbnk+IHtcclxuICAgIGNvbnN0IHJlbW90ZSA9IG9wdGlvbnMucmVtb3RlIHx8IGZhbHNlO1xyXG4gICAgY29uc3Qgc3ViamVjdCA9IG5ldyBTdWJqZWN0PGFueT4oKTtcclxuICAgIGlmIChyZW1vdGUpIHtcclxuICAgICAgbGV0IG1vZHVsZU5hbWUgPSBvcHRpb25zLm1vZHVsZU5hbWUgfHwgbnVsbDtcclxuICAgICAgU3lzdGVtLmltcG9ydChyZW1vdGUpLnRoZW4oKG1vZHVsZTogYW55KSA9PiB7XHJcbiAgICAgICAgaWYgKCFtb2R1bGVOYW1lKSB7XHJcbiAgICAgICAgICBtb2R1bGVOYW1lID0gT2JqZWN0LmtleXMobW9kdWxlKS5wb3AoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgbW9kdWxlRmFjdG9yeSA9IG1vZHVsZVttb2R1bGVOYW1lXSBhcyBOZ01vZHVsZUZhY3Rvcnk8YW55PjtcclxuICAgICAgICBjb25zdCBtb2R1bGVSZWYgPSBtb2R1bGVGYWN0b3J5LmNyZWF0ZSh0aGlzLmluamVjdG9yKTtcclxuICAgICAgICBjb25zdCBlbnRyeUNvbXBvbmVudCA9IG1vZHVsZVJlZlsnX2Jvb3RzdHJhcENvbXBvbmVudHMnXVswXTtcclxuICAgICAgICBpZiAoZW50cnlDb21wb25lbnQpIHtcclxuICAgICAgICAgIGNvbnN0IGNvbXBGYWN0b3J5ID0gbW9kdWxlUmVmLmNvbXBvbmVudEZhY3RvcnlSZXNvbHZlci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShlbnRyeUNvbXBvbmVudCk7XHJcbiAgICAgICAgICBjb25zdCBjb21wb25lbnRSZWY6IENvbXBvbmVudFJlZjxhbnk+ID0gY29tcEZhY3RvcnkuY3JlYXRlKHRoaXMuaW5qZWN0b3IpO1xyXG5cclxuICAgICAgICAgIGlmIChjb21wb25lbnRSZWYgJiYgY29tcG9uZW50UmVmLmluc3RhbmNlICYmIGNvbXBvbmVudFJlZi5pbnN0YW5jZS52aWV3TW9kZWwgJiYgY29tcG9uZW50UmVmLmluc3RhbmNlLnZpZXdNb2RlbC51aVN0YXRlKSB7XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdWlTdGF0ZSA9PT0gJ29iamVjdCcgJiYgT2JqZWN0LmtleXModWlTdGF0ZSkubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgT2JqZWN0LmtleXModWlTdGF0ZSkuZm9yRWFjaChpdGVtID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbXBvbmVudFJlZi5pbnN0YW5jZS52aWV3TW9kZWwudWlTdGF0ZS5zZXRQcm9wZXJ0eVZhbHVlKGl0ZW0sIHVpU3RhdGVbaXRlbV0pO1xyXG4gICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIOmZhOWKoGlzRGlhbG9n5Y+C5pWwXHJcbiAgICAgICAgICAgIGNvbXBvbmVudFJlZi5pbnN0YW5jZS52aWV3TW9kZWwudWlTdGF0ZS5zZXRQcm9wZXJ0eVZhbHVlKCdERVZLSVRfRElBTE9HJywgdHJ1ZSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBjb25zdCBtb2RhbFJlZiA9IHRoaXMubW9kYWxTZXJ2aWNlLnNob3coY29tcG9uZW50UmVmLCBvcHRpb25zKTtcclxuICAgICAgICAgIHN1YmplY3QubmV4dChtb2RhbFJlZik7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihg5peg5rOV5om+5Yiw5YWl5Y+j6KGo5Y2V77yBYCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICAgIHJldHVybiBzdWJqZWN0O1xyXG4gIH1cclxuICBwcml2YXRlIHNldFZhbHVlQnlQYXRoKHRhcmdldDogb2JqZWN0LCBwYXRoOiBzdHJpbmcsIHZhbHVlOiBhbnkpIHtcclxuICAgIGlmICh0YXJnZXQpIHtcclxuICAgICAgY29uc3QgcGF0aHMgPSBwYXRoLnNwbGl0KCcuJyk7XHJcbiAgICAgIGlmIChwYXRocy5sZW5ndGggPD0gMSkge1xyXG4gICAgICAgIHRhcmdldFtwYXRoXSA9IHZhbHVlO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHBhdGhzLnNsaWNlKDAsIC0xKS5yZWR1Y2UoKHByZXYsIHBhdGgpID0+IHtcclxuICAgICAgICAgIGlmICghKHByZXYuaGFzT3duUHJvcGVydHkocGF0aCkgfHwgcHJldlsnX19wcm90b19fJ10uaGFzT3duUHJvcGVydHkocGF0aCkpKSB7XHJcbiAgICAgICAgICAgIHByZXZbcGF0aF0gPSB7fTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHJldHVybiBwcmV2W3BhdGhdO1xyXG4gICAgICAgIH0sIHRhcmdldClbcGF0aHNbcGF0aHMubGVuZ3RoIC0gMV1dID0gdmFsdWU7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCB7IERpYWxvZ1NlcnZpY2UgfTtcclxuIl19