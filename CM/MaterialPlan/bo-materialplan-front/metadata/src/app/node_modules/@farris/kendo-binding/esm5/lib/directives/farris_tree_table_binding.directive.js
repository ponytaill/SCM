/*
 * @Author: aalizzwell
 * @Date: 2020-02-27 11:33:41
 * @Last Modified by: aalizzwell
 * @Last Modified time: 2020-02-27 11:34:16
 */
// tslint:disable: no-string-literal
import { Directive, Input, HostListener, Output, EventEmitter } from '@angular/core';
import { FrameContext, ChangeType } from '@farris/devkit';
import { TreeTableComponent } from '@farris/ui-treetable';
import { Subject } from 'rxjs';
import { debounceTime } from 'rxjs/operators';
import { FarrisTreetableFormatService } from '../format/index';
import { TreeNodeBuilderFactory } from './tree_table_node_builder/tree_node_builder_factory';
/**
 * 树表格绑定指令
 */
var FarrisTreeTableBindingDirective = /** @class */ (function () {
    /**
     * 构造函数
     */
    function FarrisTreeTableBindingDirective(treeTable, treetableFormatSer, frameContext) {
        var _this = this;
        this.treeTable = treeTable;
        this.treetableFormatSer = treetableFormatSer;
        this.frameContext = frameContext;
        this.renderSubject = new Subject();
        /**
         * 启用节点分页
         */
        // @Input('enableNodePagination')
        // public enableNodePagination: boolean;
        /**
         * 节点分页大小
         */
        this.nodePageSize = 100;
        /* 设置行样式 */
        this.rowClass = new EventEmitter();
        /* 设置列样式 */
        this.cellClass = new EventEmitter();
        this._PROP = null;
        this.listeners = [];
        this.storage = [];
        this.viewModel.uiState.setPropertyValue('ids', this.treeTable.checkValues);
        this.renderSubject.pipe(debounceTime(500)).subscribe(function () {
            _this.bindData();
        });
    }
    Object.defineProperty(FarrisTreeTableBindingDirective.prototype, "bindingData", {
        /**
         * 绑定数据
         */
        get: function () {
            return this.frameContext.bindingData;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FarrisTreeTableBindingDirective.prototype, "bindingList", {
        /**
         * 绑定数据列表
         */
        get: function () {
            // @todo：只支持主表，没有处理bindingPath
            return this.bindingData.list;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FarrisTreeTableBindingDirective.prototype, "prop", {
        get: function () {
            return this._PROP;
        },
        set: function (value) {
            this._PROP = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FarrisTreeTableBindingDirective.prototype, "viewModel", {
        /**
         * 获取当前vm
         */
        get: function () {
            return this.frameContext.viewModel;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * 指令初始化
     */
    FarrisTreeTableBindingDirective.prototype.ngOnInit = function () {
        var _this = this;
        // 将分级码信息保存到root-component，而非整个表单的app-context
        var virtualRootFrameContext = this.frameContext.getVirtualRootFrameContext();
        virtualRootFrameContext.setParam('hierarchyInfoKey', this.hierarchyInfoKey);
        this.bindData();
        this.bindingData.changes.subscribe(function (change) {
            if (change && (change.type === ChangeType.ValueChanged || change.type === ChangeType.PaginationInfoChange)) {
                _this.renderSubject.next(change);
            }
            else {
                _this.bindData();
            }
            // 设置当前行
            var currentId = _this.bindingList.currentId;
            if (!_this.frameContext.bindingData.rowSelectedEventSuspend && currentId) {
                _this.setSelectedIdToTree(_this.bindingList.currentId);
            }
            _this.updateCheckedRows(change);
        });
        // 设置 树表 格式化
        this.treetableFormatSer.setFormat(this.treeTable);
        /* 行样式 */
        this.rowClass.emit(this.treeTable);
        /* 列样式  单元格样式 */
        this.cellClass.emit(this.treeTable);
        this.setComponentRef();
        this.setNodePaginationInfo();
        this.registerEvent();
    };
    /**
     * 指令输入变更
     */
    FarrisTreeTableBindingDirective.prototype.ngOnChanges = function (changes) {
    };
    FarrisTreeTableBindingDirective.prototype.registerEvent = function () {
        var _this = this;
        this.treeTable.columnSorted.subscribe(function (event) {
            var _a = event.sortName, sortName = _a === void 0 ? null : _a, _b = event.sortOrder, sortOrder = _b === void 0 ? null : _b;
            var remoteSort = _this.treeTable.remoteSort;
            if (remoteSort === false) {
                if (sortName && sortOrder) {
                    _this.bindingList.sortBy(sortName, sortOrder);
                }
            }
            _this.bindData();
        });
    };
    /**
     * 收集树组件实例
     */
    FarrisTreeTableBindingDirective.prototype.setComponentRef = function () {
        var appContext = this.viewModel && this.viewModel.frameContext && this.viewModel.frameContext.getFormAppContext();
        var frameId = this.viewModel && this.viewModel.frameContext && this.viewModel.frameContext.frameId;
        var id = this.treeTable && this.treeTable.el.nativeElement.id || null;
        // 如果frameId不存在或treetable没有id属性，说明不符合使用场景
        if (!frameId || !id) {
            return;
        }
        var map = appContext && appContext.componentRefs && appContext.componentRefs.get(frameId) || new Map();
        appContext && appContext.componentRefs && appContext.componentRefs.set(frameId, map.set(id, this.treeTable));
    };
    FarrisTreeTableBindingDirective.prototype.setNodePaginationInfo = function () {
        if (this.frameContext) {
            var enableNodePagination = this.treeTable.paginationForChildren || false; //this.enableNodePagination || false;
            this.frameContext.params.set('enableNodePagination', enableNodePagination);
            var nodePageSize = this.nodePageSize || 0;
            this.frameContext.params.set('nodePageSize', nodePageSize);
        }
    };
    /**
     * 绑定数据
     */
    FarrisTreeTableBindingDirective.prototype.bindData = function () {
        var oldTreeNodes = this.treeTable.data;
        var treeNodesData = this.bindingList.toJSON({ ignoreMultiLangInput: true });
        // if (!this.shouldComponentUpdate(treeNodesData)) {
        //   return;
        // }
        this.prop = treeNodesData;
        var treeNodes = [];
        if (!!treeNodesData && treeNodesData.length > 0) {
            var hierarchyInfo = treeNodesData[0][this.hierarchyInfoKey];
            var builder = this.builder;
            if (!builder) {
                this.builder = TreeNodeBuilderFactory.getBuilder(hierarchyInfo);
                builder = this.builder;
            }
            // 服务器返回的分级节点信息匹配不到现有工厂里面的任何一种情况。确认新加的builder已经在工厂中注册
            if (builder == null) {
                throw new Error('TreeTable builder is null!');
            }
            var expandLevel = -1;
            var treeExpandLevel = this.treeTable['expandLevel'];
            if (typeof treeExpandLevel !== 'undefined') {
                expandLevel = treeExpandLevel;
            }
            var virtualRootFrameContext = this.frameContext.getVirtualRootFrameContext();
            var nodesShouldExpand = (virtualRootFrameContext.params.get('_DEVKIT_expandRowIds') || '').split(',') || [];
            var context = {
                expandLevel: expandLevel,
                addTreeLoadCompleteListener: this.addTreeLoadCompleteListener.bind(this),
                component: this.treeTable,
                storage: this.storage,
                nodesShouldExpand: nodesShouldExpand,
                frameContext: this.frameContext,
            };
            //if (!this.treeNodesBuilder) {
            this.treeNodesBuilder = new builder(treeNodesData, oldTreeNodes, this.bindingList.primaryKey, this.hierarchyInfoKey, context);
            //}
            // this.treeNodesBuilder.updateTreeNode(treeNodesData, oldTreeNodes);
            treeNodes = this.treeNodesBuilder.build();
        }
        this.treeTable.data = treeNodes;
        // 设置分页信息
        this.updatePageInfo(this.treeTable);
        this.onTreeLoadComplete();
    };
    FarrisTreeTableBindingDirective.prototype.onTreeLoadComplete = function () {
        if (this.listeners && this.listeners.length > 0) {
            this.listeners.forEach(function (listener) {
                listener();
            });
        }
    };
    FarrisTreeTableBindingDirective.prototype.addTreeLoadCompleteListener = function (listener) {
        this.listeners.push(listener);
    };
    FarrisTreeTableBindingDirective.prototype.shouldComponentUpdate = function (newProp) {
        if (JSON.stringify(this.prop) === JSON.stringify(newProp)) {
            return false;
        }
        return true;
    };
    /**
     * 从树组件上获取选中行的id
     */
    FarrisTreeTableBindingDirective.prototype.getSelectedIdFromTree = function () {
        var selectedRow = this.treeTable.selectedRow;
        return selectedRow ? selectedRow.data['id'] : null;
    };
    /**
     * 设置TreeTable的当前行
     */
    FarrisTreeTableBindingDirective.prototype.setSelectedIdToTree = function (selectedId) {
        if (!selectedId) {
            return;
        }
        // 如果新的currentId和树上的selectedId不一致，重置树的当前行
        var oldSelectedId = this.getSelectedIdFromTree();
        var nodePageChanged = this.frameContext.params.get('_NODE_PAGE_CHANGED_') || false;
        if (!oldSelectedId && nodePageChanged) {
            this.frameContext.params.delete('_NODE_PAGE_CHANGED_');
            return;
        }
        if (oldSelectedId !== selectedId) {
            this.treeTable.clearSelections();
            this.treeTable.selectNode(selectedId);
        }
    };
    /**
     * 设置BindingList的CurrentId
     */
    FarrisTreeTableBindingDirective.prototype.setCurrentIdToBindingList = function (selectedId) {
        var oldCurrentId = this.bindingData.list.currentId;
        // 单选模式下将当前行设置到ids
        if (!this.treeTable.multiSelect) {
            this.setChecks(selectedId);
            this.setCheckedRows([selectedId]);
        }
        if (oldCurrentId === selectedId) {
            return;
        }
        this.bindingData.list.setCurrentId(selectedId, true);
    };
    FarrisTreeTableBindingDirective.prototype.updateCheckedRows = function (changes) {
        if (changes.type === ChangeType.Load) {
            this.setCheckedRows();
        }
        else if (changes.type === ChangeType.ValueChanged || changes.type === ChangeType.Remove) {
            var ids = this.getChecks();
            if (changes.id && ids.includes(changes.id)) {
                this.setCheckedRows();
            }
        }
    };
    /**
     * 更新勾选行数据
     */
    FarrisTreeTableBindingDirective.prototype.setCheckedRows = function (ids) {
        var _this = this;
        if (typeof ids === 'undefined') {
            ids = this.viewModel.uiState['ids'] || [];
        }
        if (!Array.isArray(ids)) {
            return;
        }
        var list = this.bindingList.toJSON();
        var rows = this.viewModel.uiState['rows'] || new Map();
        var result = new Map();
        ids.forEach(function (id) {
            var item = list.find(function (item) { return item[_this.bindingList.primaryKey] === id; });
            var otherPageItem = rows.get(id);
            if (item) {
                result.set(id, item);
            }
            else if (otherPageItem) {
                result.set(id, otherPageItem);
            }
        });
        this.viewModel.uiState.setPropertyValue('rows', result);
    };
    /**
     * 设置ids变量
     * @param idOrIds id or ids
     */
    FarrisTreeTableBindingDirective.prototype.setChecks = function (idOrIds) {
        if (typeof idOrIds === 'string') {
            idOrIds = idOrIds.split(',').filter(function (p) { return p; });
        }
        this.viewModel.uiState.setPropertyValue('ids', idOrIds);
    };
    /**
     * 获取勾选行id数组
     * @returns
     */
    FarrisTreeTableBindingDirective.prototype.getChecks = function () {
        return this.viewModel.uiState['ids'] || [];
    };
    /**
     * 获取分页信息
     */
    FarrisTreeTableBindingDirective.prototype.getPagingInfo = function () {
        var bindingPath = this.viewModel.bindingPath;
        var bindingData = this.viewModel.bindingData;
        var pagingInfo = bindingData.pagingInfo;
        if (bindingPath === '/') {
            return pagingInfo;
        }
        else {
            var bindingPaths = bindingPath.substr(1).split('/').filter(function (item) { return !!item && item.length > 0; }).map(function (item) {
                return item.substring(0, item.length - 1);
            });
            bindingPaths.forEach(function (path) {
                pagingInfo = pagingInfo && pagingInfo[path];
            });
            return pagingInfo;
        }
    };
    FarrisTreeTableBindingDirective.prototype.updatePageInfo = function (treeTable) {
        var _a = this.getPagingInfo(), pageIndex = _a.pageIndex, pageSize = _a.pageSize, total = _a.total;
        if (pageSize === 0) {
            treeTable.pagination = false;
            return;
        }
        treeTable.pagination = true;
        treeTable.updatePageInfo({ pageIndex: pageIndex, pageSize: pageSize, total: total });
    };
    //#region 组件事件
    /**
     * 行切换
     */
    FarrisTreeTableBindingDirective.prototype.selectionChangeHandler = function (event) {
        if (event && event.node && event.node.hasOwnProperty('data')) {
            var idField = this.treeTable.idField;
            var id = event.node.data[idField];
            this.setCurrentIdToBindingList(id);
        }
    };
    /**
     * 勾选节点发生变化
     * @param event event
     */
    FarrisTreeTableBindingDirective.prototype.checkValuesChange = function (event) {
        // this.viewModel.uiState.setPropertyValue('ids', this.treeTable.checkValues);
        this.setChecks(this.treeTable.checkValues);
        this.setCheckedRows();
    };
    /**
     * 将被展开的节点设置为当前行
     */
    FarrisTreeTableBindingDirective.prototype.expandHandler = function (event) {
        var selectedId = event.data['id'];
        var virtualRootFrameContext = this.frameContext.getVirtualRootFrameContext();
        // 展开时不再选中
        // this.setSelectedIdToTree(selectedId);
        var expandNodes = virtualRootFrameContext.getParam('TREE_LATEST_EXPANDED_ID') || [];
        expandNodes.push(selectedId);
        virtualRootFrameContext.setParam('TREE_LATEST_EXPANDED_ID', expandNodes);
    };
    FarrisTreeTableBindingDirective.prototype.onPageChanged = function (event) {
        var _a = event || {}, _b = _a.pageSize, pageSize = _b === void 0 ? 20 : _b, _c = _a.pageIndex, pageIndex = _c === void 0 ? 1 : _c;
        if (pageIndex < 1) {
            pageIndex = 1;
        }
        var skip = (pageIndex - 1) * pageSize;
        this.bindingData.setPagingInfo(skip, pageSize, this.bindingData.bindingPath);
    };
    FarrisTreeTableBindingDirective.prototype.onPageSizeChanged = function (event) {
        var pageSize = event ? event : 20;
        var skip = 0;
        this.bindingData.setPagingInfo(skip, pageSize, this.bindingData.bindingPath);
    };
    /**
     * 节点页码切换事件
     * @param event event
     */
    FarrisTreeTableBindingDirective.prototype.onNodePageChanged = function (event) {
        var _a = event.pageIndex, pageIndex = _a === void 0 ? 1 : _a, _b = event.pageSize, pageSize = _b === void 0 ? this.nodePageSize : _b, _c = event.node, node = _c === void 0 ? {} : _c;
        var id = node && node.id || null;
        if (id) {
            var virtualRootFrameContext = this.frameContext.getVirtualRootFrameContext();
            var expandNodes = virtualRootFrameContext.getParam('TREE_LATEST_EXPANDED_ID') || [];
            expandNodes.push(id);
            virtualRootFrameContext.setParam('TREE_LATEST_EXPANDED_ID', expandNodes);
            this.frameContext.params.set("_NODE_" + id + "_PAGE_INDEX_", pageIndex);
            this.frameContext.params.set("_RELOAD_CHILDREN_", true);
            this.frameContext.params.set('_NODE_PAGE_CHANGED_', true);
        }
    };
    FarrisTreeTableBindingDirective.decorators = [
        { type: Directive, args: [{
                    selector: '[farrisTreeTableBinding]'
                },] }
    ];
    /** @nocollapse */
    FarrisTreeTableBindingDirective.ctorParameters = function () { return [
        { type: TreeTableComponent },
        { type: FarrisTreetableFormatService },
        { type: FrameContext }
    ]; };
    FarrisTreeTableBindingDirective.propDecorators = {
        hierarchyInfoKey: [{ type: Input, args: ['farrisHierarchyInfoKey',] }],
        rowClassName: [{ type: Input }],
        cellClassName: [{ type: Input }],
        nodePageSize: [{ type: Input, args: ['nodePageSize',] }],
        rowClass: [{ type: Output }],
        cellClass: [{ type: Output }],
        selectionChangeHandler: [{ type: HostListener, args: ['nodeSelected', ['$event'],] }],
        checkValuesChange: [{ type: HostListener, args: ['checkValuesChange', ['$event'],] }],
        expandHandler: [{ type: HostListener, args: ['expand', ['$event'],] }],
        onPageChanged: [{ type: HostListener, args: ['pageChanged', ['$event'],] }],
        onPageSizeChanged: [{ type: HostListener, args: ['pageSizeChanged', ['$event'],] }],
        onNodePageChanged: [{ type: HostListener, args: ['childsPageChanged', ['$event'],] }]
    };
    return FarrisTreeTableBindingDirective;
}());
export { FarrisTreeTableBindingDirective };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmFycmlzX3RyZWVfdGFibGVfYmluZGluZy5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2tlbmRvLWJpbmRpbmcvIiwic291cmNlcyI6WyJsaWIvZGlyZWN0aXZlcy9mYXJyaXNfdHJlZV90YWJsZV9iaW5kaW5nLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7R0FLRztBQUNILG9DQUFvQztBQUVwQyxPQUFPLEVBQUUsU0FBUyxFQUFvQyxLQUFLLEVBQUUsWUFBWSxFQUFRLE1BQU0sRUFBRSxZQUFZLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDN0gsT0FBTyxFQUE0QixZQUFZLEVBQVUsVUFBVSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDNUYsT0FBTyxFQUFFLGtCQUFrQixFQUFZLE1BQU0sc0JBQXNCLENBQUM7QUFDcEUsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMvQixPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDOUMsT0FBTyxFQUFFLDRCQUE0QixFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDL0QsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0scURBQXFELENBQUM7QUFFN0Y7O0dBRUc7QUFDSDtJQTBFRTs7T0FFRztJQUNILHlDQUNVLFNBQTZCLEVBQzdCLGtCQUFnRCxFQUNoRCxZQUEwQjtRQUhwQyxpQkFjQztRQWJTLGNBQVMsR0FBVCxTQUFTLENBQW9CO1FBQzdCLHVCQUFrQixHQUFsQixrQkFBa0IsQ0FBOEI7UUFDaEQsaUJBQVksR0FBWixZQUFZLENBQWM7UUF4RTVCLGtCQUFhLEdBQWlCLElBQUksT0FBTyxFQUFPLENBQUM7UUFpQnpEOztXQUVHO1FBQ0gsaUNBQWlDO1FBQ2pDLHdDQUF3QztRQUN4Qzs7V0FFRztRQUVJLGlCQUFZLEdBQVcsR0FBRyxDQUFDO1FBa0JsQyxXQUFXO1FBRVgsYUFBUSxHQUFzQixJQUFJLFlBQVksRUFB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KiBARGF0ZTogMjAyMC0wMi0yNyAxMTozMzo0MSBcclxuICogQExhc3QgTW9kaWZpZWQgYnk6IGFhbGl6endlbGxcclxuICogQExhc3QgTW9kaWZpZWQgdGltZTogMjAyMC0wMi0yNyAxMTozNDoxNlxyXG4gKi9cclxuLy8gdHNsaW50OmRpc2FibGU6IG5vLXN0cmluZy1saXRlcmFsXHJcblxyXG5pbXBvcnQgeyBEaXJlY3RpdmUsIE9uSW5pdCwgT25DaGFuZ2VzLCBTaW1wbGVDaGFuZ2VzLCBJbnB1dCwgSG9zdExpc3RlbmVyLCBUeXBlLCBPdXRwdXQsIEV2ZW50RW1pdHRlciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBCaW5kaW5nRGF0YSwgQmluZGluZ0xpc3QsIEZyYW1lQ29udGV4dCwgQ2hhbmdlLCBDaGFuZ2VUeXBlIH0gZnJvbSAnQGZhcnJpcy9kZXZraXQnO1xyXG5pbXBvcnQgeyBUcmVlVGFibGVDb21wb25lbnQsIFRyZWVOb2RlIH0gZnJvbSAnQGZhcnJpcy91aS10cmVldGFibGUnO1xyXG5pbXBvcnQgeyBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IGRlYm91bmNlVGltZSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgRmFycmlzVHJlZXRhYmxlRm9ybWF0U2VydmljZSB9IGZyb20gJy4uL2Zvcm1hdC9pbmRleCc7XHJcbmltcG9ydCB7IFRyZWVOb2RlQnVpbGRlckZhY3RvcnkgfSBmcm9tICcuL3RyZWVfdGFibGVfbm9kZV9idWlsZGVyL3RyZWVfbm9kZV9idWlsZGVyX2ZhY3RvcnknO1xyXG5cclxuLyoqXHJcbiAqIOagkeihqOagvOe7keWumuaMh+S7pFxyXG4gKi9cclxuQERpcmVjdGl2ZSh7XHJcbiAgc2VsZWN0b3I6ICdbZmFycmlzVHJlZVRhYmxlQmluZGluZ10nXHJcbn0pXHJcbmNsYXNzIEZhcnJpc1RyZWVUYWJsZUJpbmRpbmdEaXJlY3RpdmUgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcyB7XHJcbiAgLyoqXHJcbiAgICog5qCR5a2Y5YKo56m66Ze0XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzdG9yYWdlOiBhbnk7XHJcbiAgcHJpdmF0ZSByZW5kZXJTdWJqZWN0OiBTdWJqZWN0PGFueT4gPSBuZXcgU3ViamVjdDxhbnk+KCk7XHJcbiAgcHJpdmF0ZSBidWlsZGVyOiBUeXBlPGFueT47XHJcbiAgcHJpdmF0ZSB0cmVlTm9kZXNCdWlsZGVyOiBhbnk7XHJcbiAgLyoqXHJcbiAgICog5YiG57qn56CB5L+h5oGv55qEa2V5XHJcbiAgICovXHJcbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBuby1pbnB1dC1yZW5hbWVcclxuICBASW5wdXQoJ2ZhcnJpc0hpZXJhcmNoeUluZm9LZXknKVxyXG4gIHB1YmxpYyBoaWVyYXJjaHlJbmZvS2V5OiBzdHJpbmc7XHJcblxyXG4gIC8qIOihjOagt+W8jyAqL1xyXG4gIEBJbnB1dCgpXHJcbiAgcm93Q2xhc3NOYW1lOiAoY29udGV4dDogYW55KSA9PiBhbnk7XHJcblxyXG4gIC8qIOWIl+WSjOWNleWFg+agvOagt+W8jyAqL1xyXG4gIEBJbnB1dCgpXHJcbiAgY2VsbENsYXNzTmFtZTogKGRhdGE6IGFueSwgZmllbGQ6IGFueSkgPT4gYW55O1xyXG4gIC8qKlxyXG4gICAqIOWQr+eUqOiKgueCueWIhumhtVxyXG4gICAqL1xyXG4gIC8vIEBJbnB1dCgnZW5hYmxlTm9kZVBhZ2luYXRpb24nKVxyXG4gIC8vIHB1YmxpYyBlbmFibGVOb2RlUGFnaW5hdGlvbjogYm9vbGVhbjtcclxuICAvKipcclxuICAgKiDoioLngrnliIbpobXlpKflsI9cclxuICAgKi9cclxuICBASW5wdXQoJ25vZGVQYWdlU2l6ZScpXHJcbiAgcHVibGljIG5vZGVQYWdlU2l6ZTogbnVtYmVyID0gMTAwO1xyXG4gIC8qKlxyXG4gICAqIOe7keWumuaVsOaNrlxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0IGJpbmRpbmdEYXRhKCk6IEJpbmRpbmdEYXRhIHtcclxuICAgIHJldHVybiB0aGlzLmZyYW1lQ29udGV4dC5iaW5kaW5nRGF0YTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOe7keWumuaVsOaNruWIl+ihqFxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0IGJpbmRpbmdMaXN0KCk6IEJpbmRpbmdMaXN0IHtcclxuXHJcbiAgICAvLyBAdG9kb++8muWPquaUr+aMgeS4u+ihqO+8jOayoeacieWkhOeQhmJpbmRpbmdQYXRoXHJcbiAgICByZXR1cm4gdGhpcy5iaW5kaW5nRGF0YS5saXN0O1xyXG4gIH1cclxuXHJcblxyXG4gIC8qIOiuvue9ruihjOagt+W8jyAqL1xyXG4gIEBPdXRwdXQoKVxyXG4gIHJvd0NsYXNzOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG5cclxuICAvKiDorr7nva7liJfmoLflvI8gKi9cclxuICBAT3V0cHV0KClcclxuICBjZWxsQ2xhc3M6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcblxyXG4gIHByaXZhdGUgX1BST1A6IGFueSA9IG51bGw7XHJcbiAgcHJpdmF0ZSBsaXN0ZW5lcnM6IGFueVtdO1xyXG4gIHByaXZhdGUgZ2V0IHByb3AoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fUFJPUDtcclxuICB9XHJcbiAgcHJpdmF0ZSBzZXQgcHJvcCh2YWx1ZSkge1xyXG4gICAgdGhpcy5fUFJPUCA9IHZhbHVlO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDojrflj5blvZPliY12bVxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0IHZpZXdNb2RlbCgpIHtcclxuICAgIHJldHVybiB0aGlzLmZyYW1lQ29udGV4dC52aWV3TW9kZWw7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOaehOmAoOWHveaVsFxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJpdmF0ZSB0cmVlVGFibGU6IFRyZWVUYWJsZUNvbXBvbmVudCxcclxuICAgIHByaXZhdGUgdHJlZXRhYmxlRm9ybWF0U2VyOiBGYXJyaXNUcmVldGFibGVGb3JtYXRTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBmcmFtZUNvbnRleHQ6IEZyYW1lQ29udGV4dFxyXG4gICkge1xyXG4gICAgdGhpcy5saXN0ZW5lcnMgPSBbXTtcclxuICAgIHRoaXMuc3RvcmFnZSA9IFtdO1xyXG4gICAgdGhpcy52aWV3TW9kZWwudWlTdGF0ZS5zZXRQcm9wZXJ0eVZhbHVlKCdpZHMnLCB0aGlzLnRyZWVUYWJsZS5jaGVja1ZhbHVlcyk7XHJcbiAgICB0aGlzLnJlbmRlclN1YmplY3QucGlwZShcclxuICAgICAgZGVib3VuY2VUaW1lKDUwMClcclxuICAgICkuc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgdGhpcy5iaW5kRGF0YSgpO1xyXG4gICAgfSk7XHJcblxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5oyH5Luk5Yid5aeL5YyWXHJcbiAgICovXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICAvLyDlsIbliIbnuqfnoIHkv6Hmga/kv53lrZjliLByb290LWNvbXBvbmVudO+8jOiAjOmdnuaVtOS4quihqOWNleeahGFwcC1jb250ZXh0XHJcbiAgICBjb25zdCB2aXJ0dWFsUm9vdEZyYW1lQ29udGV4dCA9IHRoaXMuZnJhbWVDb250ZXh0LmdldFZpcnR1YWxSb290RnJhbWVDb250ZXh0KCk7XHJcbiAgICB2aXJ0dWFsUm9vdEZyYW1lQ29udGV4dC5zZXRQYXJhbSgnaGllcmFyY2h5SW5mb0tleScsIHRoaXMuaGllcmFyY2h5SW5mb0tleSk7XHJcbiAgICB0aGlzLmJpbmREYXRhKCk7XHJcbiAgICB0aGlzLmJpbmRpbmdEYXRhLmNoYW5nZXMuc3Vic2NyaWJlKChjaGFuZ2U6IENoYW5nZSkgPT4ge1xyXG4gICAgICBpZiAoY2hhbmdlICYmIChjaGFuZ2UudHlwZSA9PT0gQ2hhbmdlVHlwZS5WYWx1ZUNoYW5nZWQgfHwgY2hhbmdlLnR5cGUgPT09IENoYW5nZVR5cGUuUGFnaW5hdGlvbkluZm9DaGFuZ2UpKSB7XHJcbiAgICAgICAgdGhpcy5yZW5kZXJTdWJqZWN0Lm5leHQoY2hhbmdlKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLmJpbmREYXRhKCk7XHJcbiAgICAgIH1cclxuICAgICAgLy8g6K6+572u5b2T5YmN6KGMXHJcbiAgICAgIGNvbnN0IGN1cnJlbnRJZCA9IHRoaXMuYmluZGluZ0xpc3QuY3VycmVudElkO1xyXG4gICAgICBpZiAoIXRoaXMuZnJhbWVDb250ZXh0LmJpbmRpbmdEYXRhLnJvd1NlbGVjdGVkRXZlbnRTdXNwZW5kICYmIGN1cnJlbnRJZCkge1xyXG4gICAgICAgIHRoaXMuc2V0U2VsZWN0ZWRJZFRvVHJlZSh0aGlzLmJpbmRpbmdMaXN0LmN1cnJlbnRJZCk7XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy51cGRhdGVDaGVja2VkUm93cyhjaGFuZ2UpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgLy8g6K6+572uIOagkeihqCDmoLzlvI/ljJZcclxuICAgIHRoaXMudHJlZXRhYmxlRm9ybWF0U2VyLnNldEZvcm1hdCh0aGlzLnRyZWVUYWJsZSk7XHJcblxyXG4gICAgLyog6KGM5qC35byPICovXHJcbiAgICB0aGlzLnJvd0NsYXNzLmVtaXQodGhpcy50cmVlVGFibGUpO1xyXG5cclxuICAgIC8qIOWIl+agt+W8jyAg5Y2V5YWD5qC85qC35byPICovXHJcbiAgICB0aGlzLmNlbGxDbGFzcy5lbWl0KHRoaXMudHJlZVRhYmxlKTtcclxuICAgIHRoaXMuc2V0Q29tcG9uZW50UmVmKCk7XHJcbiAgICB0aGlzLnNldE5vZGVQYWdpbmF0aW9uSW5mbygpO1xyXG4gICAgdGhpcy5yZWdpc3RlckV2ZW50KCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmjIfku6TovpPlhaXlj5jmm7RcclxuICAgKi9cclxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XHJcbiAgfVxyXG4gIHByaXZhdGUgcmVnaXN0ZXJFdmVudCgpIHtcclxuICAgIHRoaXMudHJlZVRhYmxlLmNvbHVtblNvcnRlZC5zdWJzY3JpYmUoKGV2ZW50OiB7IHNvcnROYW1lOiBzdHJpbmcsIHNvcnRPcmRlcjogc3RyaW5nIH0pID0+IHtcclxuICAgICAgY29uc3QgeyBzb3J0TmFtZSA9IG51bGwsIHNvcnRPcmRlciA9IG51bGwgfSA9IGV2ZW50O1xyXG4gICAgICBjb25zdCByZW1vdGVTb3J0ID0gdGhpcy50cmVlVGFibGUucmVtb3RlU29ydDtcclxuICAgICAgaWYgKHJlbW90ZVNvcnQgPT09IGZhbHNlKSB7XHJcbiAgICAgICAgaWYgKHNvcnROYW1lICYmIHNvcnRPcmRlcikge1xyXG4gICAgICAgICAgdGhpcy5iaW5kaW5nTGlzdC5zb3J0Qnkoc29ydE5hbWUsIHNvcnRPcmRlcik7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIHRoaXMuYmluZERhdGEoKTtcclxuICAgIH0pO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmlLbpm4bmoJHnu4Tku7blrp7kvotcclxuICAgKi9cclxuICBwcml2YXRlIHNldENvbXBvbmVudFJlZigpIHtcclxuICAgIGNvbnN0IGFwcENvbnRleHQgPSB0aGlzLnZpZXdNb2RlbCAmJiB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQgJiYgdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LmdldEZvcm1BcHBDb250ZXh0KCk7XHJcbiAgICBjb25zdCBmcmFtZUlkID0gdGhpcy52aWV3TW9kZWwgJiYgdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0ICYmIHRoaXMudmlld01vZGVsLmZyYW1lQ29udGV4dC5mcmFtZUlkO1xyXG4gICAgY29uc3QgaWQgPSB0aGlzLnRyZWVUYWJsZSAmJiB0aGlzLnRyZWVUYWJsZS5lbC5uYXRpdmVFbGVtZW50LmlkIHx8IG51bGw7XHJcbiAgICAvLyDlpoLmnpxmcmFtZUlk5LiN5a2Y5Zyo5oiWdHJlZXRhYmxl5rKh5pyJaWTlsZ7mgKfvvIzor7TmmI7kuI3nrKblkIjkvb/nlKjlnLrmma9cclxuICAgIGlmICghZnJhbWVJZCB8fCAhaWQpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgY29uc3QgbWFwID0gYXBwQ29udGV4dCAmJiBhcHBDb250ZXh0LmNvbXBvbmVudFJlZnMgJiYgYXBwQ29udGV4dC5jb21wb25lbnRSZWZzLmdldChmcmFtZUlkKSB8fCBuZXcgTWFwPHN0cmluZywgYW55PigpO1xyXG4gICAgYXBwQ29udGV4dCAmJiBhcHBDb250ZXh0LmNvbXBvbmVudFJlZnMgJiYgYXBwQ29udGV4dC5jb21wb25lbnRSZWZzLnNldChmcmFtZUlkLCBtYXAuc2V0KGlkLCB0aGlzLnRyZWVUYWJsZSkpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBzZXROb2RlUGFnaW5hdGlvbkluZm8oKSB7XHJcbiAgICBpZiAodGhpcy5mcmFtZUNvbnRleHQpIHtcclxuICAgICAgY29uc3QgZW5hYmxlTm9kZVBhZ2luYXRpb24gPSB0aGlzLnRyZWVUYWJsZS5wYWdpbmF0aW9uRm9yQ2hpbGRyZW4gfHwgZmFsc2U7Ly90aGlzLmVuYWJsZU5vZGVQYWdpbmF0aW9uIHx8IGZhbHNlO1xyXG4gICAgICB0aGlzLmZyYW1lQ29udGV4dC5wYXJhbXMuc2V0KCdlbmFibGVOb2RlUGFnaW5hdGlvbicsIGVuYWJsZU5vZGVQYWdpbmF0aW9uKTtcclxuICAgICAgY29uc3Qgbm9kZVBhZ2VTaXplID0gdGhpcy5ub2RlUGFnZVNpemUgfHwgMDtcclxuICAgICAgdGhpcy5mcmFtZUNvbnRleHQucGFyYW1zLnNldCgnbm9kZVBhZ2VTaXplJywgbm9kZVBhZ2VTaXplKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOe7keWumuaVsOaNrlxyXG4gICAqL1xyXG4gIHByaXZhdGUgYmluZERhdGEoKSB7XHJcbiAgICBjb25zdCBvbGRUcmVlTm9kZXMgPSB0aGlzLnRyZWVUYWJsZS5kYXRhO1xyXG4gICAgY29uc3QgdHJlZU5vZGVzRGF0YSA9IHRoaXMuYmluZGluZ0xpc3QudG9KU09OKHsgaWdub3JlTXVsdGlMYW5nSW5wdXQ6IHRydWUgfSk7XHJcbiAgICAvLyBpZiAoIXRoaXMuc2hvdWxkQ29tcG9uZW50VXBkYXRlKHRyZWVOb2Rlc0RhdGEpKSB7XHJcbiAgICAvLyAgIHJldHVybjtcclxuICAgIC8vIH1cclxuICAgIHRoaXMucHJvcCA9IHRyZWVOb2Rlc0RhdGE7XHJcblxyXG4gICAgbGV0IHRyZWVOb2RlczogVHJlZU5vZGVbXSA9IFtdO1xyXG4gICAgaWYgKCEhdHJlZU5vZGVzRGF0YSAmJiB0cmVlTm9kZXNEYXRhLmxlbmd0aCA+IDApIHtcclxuICAgICAgY29uc3QgaGllcmFyY2h5SW5mbyA9IHRyZWVOb2Rlc0RhdGFbMF1bdGhpcy5oaWVyYXJjaHlJbmZvS2V5XTtcclxuICAgICAgbGV0IGJ1aWxkZXI6IFR5cGU8YW55PiA9IHRoaXMuYnVpbGRlcjtcclxuICAgICAgaWYgKCFidWlsZGVyKSB7XHJcbiAgICAgICAgdGhpcy5idWlsZGVyID0gVHJlZU5vZGVCdWlsZGVyRmFjdG9yeS5nZXRCdWlsZGVyKGhpZXJhcmNoeUluZm8pO1xyXG4gICAgICAgIGJ1aWxkZXIgPSB0aGlzLmJ1aWxkZXI7XHJcbiAgICAgIH1cclxuICAgICAgLy8g5pyN5Yqh5Zmo6L+U5Zue55qE5YiG57qn6IqC54K55L+h5oGv5Yy56YWN5LiN5Yiw546w5pyJ5bel5Y6C6YeM6Z2i55qE5Lu75L2V5LiA56eN5oOF5Ya144CC56Gu6K6k5paw5Yqg55qEYnVpbGRlcuW3sue7j+WcqOW3peWOguS4reazqOWGjFxyXG4gICAgICBpZiAoYnVpbGRlciA9PSBudWxsKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUcmVlVGFibGUgYnVpbGRlciBpcyBudWxsIScpO1xyXG4gICAgICB9XHJcbiAgICAgIGxldCBleHBhbmRMZXZlbCA9IC0xO1xyXG4gICAgICBjb25zdCB0cmVlRXhwYW5kTGV2ZWwgPSB0aGlzLnRyZWVUYWJsZVsnZXhwYW5kTGV2ZWwnXTtcclxuICAgICAgaWYgKHR5cGVvZiB0cmVlRXhwYW5kTGV2ZWwgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgZXhwYW5kTGV2ZWwgPSB0cmVlRXhwYW5kTGV2ZWw7XHJcbiAgICAgIH1cclxuICAgICAgY29uc3QgdmlydHVhbFJvb3RGcmFtZUNvbnRleHQgPSB0aGlzLmZyYW1lQ29udGV4dC5nZXRWaXJ0dWFsUm9vdEZyYW1lQ29udGV4dCgpO1xyXG4gICAgICBjb25zdCBub2Rlc1Nob3VsZEV4cGFuZCA9ICh2aXJ0dWFsUm9vdEZyYW1lQ29udGV4dC5wYXJhbXMuZ2V0KCdfREVWS0lUX2V4cGFuZFJvd0lkcycpIHx8ICcnKS5zcGxpdCgnLCcpIHx8IFtdO1xyXG4gICAgICBjb25zdCBjb250ZXh0ID0ge1xyXG4gICAgICAgIGV4cGFuZExldmVsLFxyXG4gICAgICAgIGFkZFRyZWVMb2FkQ29tcGxldGVMaXN0ZW5lcjogdGhpcy5hZGRUcmVlTG9hZENvbXBsZXRlTGlzdGVuZXIuYmluZCh0aGlzKSxcclxuICAgICAgICBjb21wb25lbnQ6IHRoaXMudHJlZVRhYmxlLFxyXG4gICAgICAgIHN0b3JhZ2U6IHRoaXMuc3RvcmFnZSxcclxuICAgICAgICBub2Rlc1Nob3VsZEV4cGFuZDogbm9kZXNTaG91bGRFeHBhbmQsXHJcbiAgICAgICAgZnJhbWVDb250ZXh0OiB0aGlzLmZyYW1lQ29udGV4dCxcclxuICAgICAgfTtcclxuICAgICAgLy9pZiAoIXRoaXMudHJlZU5vZGVzQnVpbGRlcikge1xyXG4gICAgICB0aGlzLnRyZWVOb2Rlc0J1aWxkZXIgPSBuZXcgYnVpbGRlcihcclxuICAgICAgICB0cmVlTm9kZXNEYXRhLCBvbGRUcmVlTm9kZXMsXHJcbiAgICAgICAgdGhpcy5iaW5kaW5nTGlzdC5wcmltYXJ5S2V5LCB0aGlzLmhpZXJhcmNoeUluZm9LZXksIGNvbnRleHRcclxuICAgICAgKTtcclxuICAgICAgLy99XHJcbiAgICAgIC8vIHRoaXMudHJlZU5vZGVzQnVpbGRlci51cGRhdGVUcmVlTm9kZSh0cmVlTm9kZXNEYXRhLCBvbGRUcmVlTm9kZXMpO1xyXG4gICAgICB0cmVlTm9kZXMgPSB0aGlzLnRyZWVOb2Rlc0J1aWxkZXIuYnVpbGQoKTtcclxuICAgIH1cclxuICAgIHRoaXMudHJlZVRhYmxlLmRhdGEgPSB0cmVlTm9kZXM7XHJcbiAgICAvLyDorr7nva7liIbpobXkv6Hmga9cclxuICAgIHRoaXMudXBkYXRlUGFnZUluZm8odGhpcy50cmVlVGFibGUpO1xyXG4gICAgdGhpcy5vblRyZWVMb2FkQ29tcGxldGUoKTtcclxuICB9XHJcbiAgcHJpdmF0ZSBvblRyZWVMb2FkQ29tcGxldGUoKSB7XHJcbiAgICBpZiAodGhpcy5saXN0ZW5lcnMgJiYgdGhpcy5saXN0ZW5lcnMubGVuZ3RoID4gMCkge1xyXG4gICAgICB0aGlzLmxpc3RlbmVycy5mb3JFYWNoKGxpc3RlbmVyID0+IHtcclxuICAgICAgICBsaXN0ZW5lcigpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcbiAgcHJpdmF0ZSBhZGRUcmVlTG9hZENvbXBsZXRlTGlzdGVuZXIobGlzdGVuZXI6IGFueSkge1xyXG4gICAgdGhpcy5saXN0ZW5lcnMucHVzaChsaXN0ZW5lcik7XHJcbiAgfVxyXG4gIHByaXZhdGUgc2hvdWxkQ29tcG9uZW50VXBkYXRlKG5ld1Byb3A6IGFueSkge1xyXG4gICAgaWYgKEpTT04uc3RyaW5naWZ5KHRoaXMucHJvcCkgPT09IEpTT04uc3RyaW5naWZ5KG5ld1Byb3ApKSB7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICAgIHJldHVybiB0cnVlO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDku47moJHnu4Tku7bkuIrojrflj5bpgInkuK3ooYznmoRpZFxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0U2VsZWN0ZWRJZEZyb21UcmVlKCk6IHN0cmluZyB7XHJcbiAgICBjb25zdCBzZWxlY3RlZFJvdyA9IHRoaXMudHJlZVRhYmxlLnNlbGVjdGVkUm93O1xyXG4gICAgcmV0dXJuIHNlbGVjdGVkUm93ID8gc2VsZWN0ZWRSb3cuZGF0YVsnaWQnXSA6IG51bGw7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDorr7nva5UcmVlVGFibGXnmoTlvZPliY3ooYxcclxuICAgKi9cclxuICBwcml2YXRlIHNldFNlbGVjdGVkSWRUb1RyZWUoc2VsZWN0ZWRJZDogc3RyaW5nKTogdm9pZCB7XHJcbiAgICBpZiAoIXNlbGVjdGVkSWQpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgLy8g5aaC5p6c5paw55qEY3VycmVudElk5ZKM5qCR5LiK55qEc2VsZWN0ZWRJZOS4jeS4gOiHtO+8jOmHjee9ruagkeeahOW9k+WJjeihjFxyXG4gICAgY29uc3Qgb2xkU2VsZWN0ZWRJZCA9IHRoaXMuZ2V0U2VsZWN0ZWRJZEZyb21UcmVlKCk7XHJcbiAgICBjb25zdCBub2RlUGFnZUNoYW5nZWQgPSB0aGlzLmZyYW1lQ29udGV4dC5wYXJhbXMuZ2V0KCdfTk9ERV9QQUdFX0NIQU5HRURfJykgfHwgZmFsc2U7XHJcbiAgICBpZiAoIW9sZFNlbGVjdGVkSWQgJiYgbm9kZVBhZ2VDaGFuZ2VkKSB7XHJcbiAgICAgIHRoaXMuZnJhbWVDb250ZXh0LnBhcmFtcy5kZWxldGUoJ19OT0RFX1BBR0VfQ0hBTkdFRF8nKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKG9sZFNlbGVjdGVkSWQgIT09IHNlbGVjdGVkSWQpIHtcclxuICAgICAgdGhpcy50cmVlVGFibGUuY2xlYXJTZWxlY3Rpb25zKCk7XHJcbiAgICAgIHRoaXMudHJlZVRhYmxlLnNlbGVjdE5vZGUoc2VsZWN0ZWRJZCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDorr7nva5CaW5kaW5nTGlzdOeahEN1cnJlbnRJZFxyXG4gICAqL1xyXG4gIHByaXZhdGUgc2V0Q3VycmVudElkVG9CaW5kaW5nTGlzdChzZWxlY3RlZElkOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgIGNvbnN0IG9sZEN1cnJlbnRJZCA9IHRoaXMuYmluZGluZ0RhdGEubGlzdC5jdXJyZW50SWQ7XHJcbiAgICAvLyDljZXpgInmqKHlvI/kuIvlsIblvZPliY3ooYzorr7nva7liLBpZHNcclxuICAgIGlmICghdGhpcy50cmVlVGFibGUubXVsdGlTZWxlY3QpIHtcclxuICAgICAgdGhpcy5zZXRDaGVja3Moc2VsZWN0ZWRJZCk7XHJcbiAgICAgIHRoaXMuc2V0Q2hlY2tlZFJvd3MoW3NlbGVjdGVkSWRdKTtcclxuICAgIH1cclxuICAgIGlmIChvbGRDdXJyZW50SWQgPT09IHNlbGVjdGVkSWQpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy5iaW5kaW5nRGF0YS5saXN0LnNldEN1cnJlbnRJZChzZWxlY3RlZElkLCB0cnVlKTtcclxuICB9XHJcbiAgcHJpdmF0ZSB1cGRhdGVDaGVja2VkUm93cyhjaGFuZ2VzOiBDaGFuZ2UpIHtcclxuICAgIGlmIChjaGFuZ2VzLnR5cGUgPT09IENoYW5nZVR5cGUuTG9hZCkge1xyXG4gICAgICB0aGlzLnNldENoZWNrZWRSb3dzKCk7XHJcbiAgICB9IGVsc2UgaWYgKGNoYW5nZXMudHlwZSA9PT0gQ2hhbmdlVHlwZS5WYWx1ZUNoYW5nZWQgfHwgY2hhbmdlcy50eXBlID09PSBDaGFuZ2VUeXBlLlJlbW92ZSkge1xyXG4gICAgICBjb25zdCBpZHMgPSB0aGlzLmdldENoZWNrcygpO1xyXG4gICAgICBpZiAoY2hhbmdlcy5pZCAmJiBpZHMuaW5jbHVkZXMoY2hhbmdlcy5pZCkpIHtcclxuICAgICAgICB0aGlzLnNldENoZWNrZWRSb3dzKCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbiAgLyoqXHJcbiAgICog5pu05paw5Yu+6YCJ6KGM5pWw5o2uXHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIHNldENoZWNrZWRSb3dzKGlkcz86IHN0cmluZ1tdKSB7XHJcbiAgICBpZiAodHlwZW9mIGlkcyA9PT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgaWRzID0gdGhpcy52aWV3TW9kZWwudWlTdGF0ZVsnaWRzJ10gfHwgW107XHJcbiAgICB9XHJcbiAgICBpZiAoIUFycmF5LmlzQXJyYXkoaWRzKSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBjb25zdCBsaXN0ID0gdGhpcy5iaW5kaW5nTGlzdC50b0pTT04oKTtcclxuICAgIGNvbnN0IHJvd3M6IE1hcDxzdHJpbmcsIGFueT4gPSB0aGlzLnZpZXdNb2RlbC51aVN0YXRlWydyb3dzJ10gfHwgbmV3IE1hcDxzdHJpbmcsIGFueT4oKTtcclxuXHJcbiAgICBjb25zdCByZXN1bHQgPSBuZXcgTWFwPHN0cmluZywgYW55PigpO1xyXG4gICAgaWRzLmZvckVhY2goKGlkOiBhbnkpID0+IHtcclxuICAgICAgY29uc3QgaXRlbSA9IGxpc3QuZmluZChpdGVtID0+IGl0ZW1bdGhpcy5iaW5kaW5nTGlzdC5wcmltYXJ5S2V5XSA9PT0gaWQpO1xyXG4gICAgICBjb25zdCBvdGhlclBhZ2VJdGVtID0gcm93cy5nZXQoaWQpO1xyXG4gICAgICBpZiAoaXRlbSkge1xyXG4gICAgICAgIHJlc3VsdC5zZXQoaWQsIGl0ZW0pO1xyXG4gICAgICB9IGVsc2UgaWYgKG90aGVyUGFnZUl0ZW0pIHtcclxuICAgICAgICByZXN1bHQuc2V0KGlkLCBvdGhlclBhZ2VJdGVtKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICB0aGlzLnZpZXdNb2RlbC51aVN0YXRlLnNldFByb3BlcnR5VmFsdWUoJ3Jvd3MnLCByZXN1bHQpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDorr7nva5pZHPlj5jph49cclxuICAgKiBAcGFyYW0gaWRPcklkcyBpZCBvciBpZHNcclxuICAgKi9cclxuICBwcm90ZWN0ZWQgc2V0Q2hlY2tzKGlkT3JJZHM6IHN0cmluZyB8IHN0cmluZ1tdKSB7XHJcbiAgICBpZiAodHlwZW9mIGlkT3JJZHMgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgIGlkT3JJZHMgPSBpZE9ySWRzLnNwbGl0KCcsJykuZmlsdGVyKHAgPT4gcCk7XHJcbiAgICB9XHJcbiAgICB0aGlzLnZpZXdNb2RlbC51aVN0YXRlLnNldFByb3BlcnR5VmFsdWUoJ2lkcycsIGlkT3JJZHMpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDojrflj5bli77pgInooYxpZOaVsOe7hFxyXG4gICAqIEByZXR1cm5zIFxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBnZXRDaGVja3MoKTogc3RyaW5nW10ge1xyXG4gICAgcmV0dXJuIHRoaXMudmlld01vZGVsLnVpU3RhdGVbJ2lkcyddIHx8IFtdO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDojrflj5bliIbpobXkv6Hmga9cclxuICAgKi9cclxuICBwcml2YXRlIGdldFBhZ2luZ0luZm8oKSB7XHJcbiAgICBjb25zdCBiaW5kaW5nUGF0aCA9IHRoaXMudmlld01vZGVsLmJpbmRpbmdQYXRoO1xyXG4gICAgY29uc3QgYmluZGluZ0RhdGEgPSB0aGlzLnZpZXdNb2RlbC5iaW5kaW5nRGF0YTtcclxuICAgIGxldCBwYWdpbmdJbmZvID0gYmluZGluZ0RhdGEucGFnaW5nSW5mbztcclxuICAgIGlmIChiaW5kaW5nUGF0aCA9PT0gJy8nKSB7XHJcbiAgICAgIHJldHVybiBwYWdpbmdJbmZvO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY29uc3QgYmluZGluZ1BhdGhzID0gYmluZGluZ1BhdGguc3Vic3RyKDEpLnNwbGl0KCcvJykuZmlsdGVyKGl0ZW0gPT4gISFpdGVtICYmIGl0ZW0ubGVuZ3RoID4gMCkubWFwKGl0ZW0gPT4ge1xyXG4gICAgICAgIHJldHVybiBpdGVtLnN1YnN0cmluZygwLCBpdGVtLmxlbmd0aCAtIDEpO1xyXG4gICAgICB9KTtcclxuICAgICAgYmluZGluZ1BhdGhzLmZvckVhY2gocGF0aCA9PiB7XHJcbiAgICAgICAgcGFnaW5nSW5mbyA9IHBhZ2luZ0luZm8gJiYgcGFnaW5nSW5mb1twYXRoXTtcclxuICAgICAgfSk7XHJcbiAgICAgIHJldHVybiBwYWdpbmdJbmZvO1xyXG4gICAgfVxyXG4gIH1cclxuICBwcml2YXRlIHVwZGF0ZVBhZ2VJbmZvKHRyZWVUYWJsZTogVHJlZVRhYmxlQ29tcG9uZW50KSB7XHJcbiAgICBjb25zdCB7IHBhZ2VJbmRleCwgcGFnZVNpemUsIHRvdGFsIH0gPSB0aGlzLmdldFBhZ2luZ0luZm8oKTtcclxuICAgIGlmIChwYWdlU2l6ZSA9PT0gMCkge1xyXG4gICAgICB0cmVlVGFibGUucGFnaW5hdGlvbiA9IGZhbHNlO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB0cmVlVGFibGUucGFnaW5hdGlvbiA9IHRydWU7XHJcbiAgICB0cmVlVGFibGUudXBkYXRlUGFnZUluZm8oeyBwYWdlSW5kZXgsIHBhZ2VTaXplLCB0b3RhbCB9KTtcclxuICB9XHJcbiAgLy8jcmVnaW9uIOe7hOS7tuS6i+S7tlxyXG4gIC8qKlxyXG4gICAqIOihjOWIh+aNolxyXG4gICAqL1xyXG4gIEBIb3N0TGlzdGVuZXIoJ25vZGVTZWxlY3RlZCcsIFsnJGV2ZW50J10pXHJcbiAgcHVibGljIHNlbGVjdGlvbkNoYW5nZUhhbmRsZXIoZXZlbnQ6IGFueSkge1xyXG4gICAgaWYgKGV2ZW50ICYmIGV2ZW50Lm5vZGUgJiYgZXZlbnQubm9kZS5oYXNPd25Qcm9wZXJ0eSgnZGF0YScpKSB7XHJcbiAgICAgIGNvbnN0IGlkRmllbGQgPSB0aGlzLnRyZWVUYWJsZS5pZEZpZWxkO1xyXG4gICAgICBjb25zdCBpZCA9IGV2ZW50Lm5vZGUuZGF0YVtpZEZpZWxkXTtcclxuICAgICAgdGhpcy5zZXRDdXJyZW50SWRUb0JpbmRpbmdMaXN0KGlkKTtcclxuICAgIH1cclxuICB9XHJcbiAgLyoqXHJcbiAgICog5Yu+6YCJ6IqC54K55Y+R55Sf5Y+Y5YyWXHJcbiAgICogQHBhcmFtIGV2ZW50IGV2ZW50XHJcbiAgICovXHJcbiAgQEhvc3RMaXN0ZW5lcignY2hlY2tWYWx1ZXNDaGFuZ2UnLCBbJyRldmVudCddKVxyXG4gIHB1YmxpYyBjaGVja1ZhbHVlc0NoYW5nZShldmVudDogYW55KSB7XHJcbiAgICAvLyB0aGlzLnZpZXdNb2RlbC51aVN0YXRlLnNldFByb3BlcnR5VmFsdWUoJ2lkcycsIHRoaXMudHJlZVRhYmxlLmNoZWNrVmFsdWVzKTtcclxuICAgIHRoaXMuc2V0Q2hlY2tzKHRoaXMudHJlZVRhYmxlLmNoZWNrVmFsdWVzKTtcclxuICAgIHRoaXMuc2V0Q2hlY2tlZFJvd3MoKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5bCG6KKr5bGV5byA55qE6IqC54K56K6+572u5Li65b2T5YmN6KGMXHJcbiAgICovXHJcbiAgQEhvc3RMaXN0ZW5lcignZXhwYW5kJywgWyckZXZlbnQnXSlcclxuICBwdWJsaWMgZXhwYW5kSGFuZGxlcihldmVudDogYW55KSB7XHJcbiAgICBjb25zdCBzZWxlY3RlZElkID0gZXZlbnQuZGF0YVsnaWQnXTtcclxuICAgIGNvbnN0IHZpcnR1YWxSb290RnJhbWVDb250ZXh0ID0gdGhpcy5mcmFtZUNvbnRleHQuZ2V0VmlydHVhbFJvb3RGcmFtZUNvbnRleHQoKTtcclxuICAgIC8vIOWxleW8gOaXtuS4jeWGjemAieS4rVxyXG4gICAgLy8gdGhpcy5zZXRTZWxlY3RlZElkVG9UcmVlKHNlbGVjdGVkSWQpO1xyXG4gICAgY29uc3QgZXhwYW5kTm9kZXMgPSB2aXJ0dWFsUm9vdEZyYW1lQ29udGV4dC5nZXRQYXJhbSgnVFJFRV9MQVRFU1RfRVhQQU5ERURfSUQnKSB8fCBbXTtcclxuICAgIGV4cGFuZE5vZGVzLnB1c2goc2VsZWN0ZWRJZCk7XHJcbiAgICB2aXJ0dWFsUm9vdEZyYW1lQ29udGV4dC5zZXRQYXJhbSgnVFJFRV9MQVRFU1RfRVhQQU5ERURfSUQnLCBleHBhbmROb2Rlcyk7XHJcbiAgfVxyXG4gIEBIb3N0TGlzdGVuZXIoJ3BhZ2VDaGFuZ2VkJywgWyckZXZlbnQnXSlcclxuICBwdWJsaWMgb25QYWdlQ2hhbmdlZChldmVudDogYW55KSB7XHJcbiAgICBsZXQgeyBwYWdlU2l6ZSA9IDIwLCBwYWdlSW5kZXggPSAxIH0gPSBldmVudCB8fCB7fTtcclxuICAgIGlmIChwYWdlSW5kZXggPCAxKSB7XHJcbiAgICAgIHBhZ2VJbmRleCA9IDE7XHJcbiAgICB9XHJcbiAgICBjb25zdCBza2lwID0gKHBhZ2VJbmRleCAtIDEpICogcGFnZVNpemU7XHJcbiAgICB0aGlzLmJpbmRpbmdEYXRhLnNldFBhZ2luZ0luZm8oc2tpcCwgcGFnZVNpemUsIHRoaXMuYmluZGluZ0RhdGEuYmluZGluZ1BhdGgpO1xyXG4gIH1cclxuICBASG9zdExpc3RlbmVyKCdwYWdlU2l6ZUNoYW5nZWQnLCBbJyRldmVudCddKVxyXG4gIHB1YmxpYyBvblBhZ2VTaXplQ2hhbmdlZChldmVudDogYW55KSB7XHJcbiAgICBjb25zdCBwYWdlU2l6ZSA9IGV2ZW50ID8gZXZlbnQgOiAyMDtcclxuICAgIGNvbnN0IHNraXAgPSAwO1xyXG4gICAgdGhpcy5iaW5kaW5nRGF0YS5zZXRQYWdpbmdJbmZvKHNraXAsIHBhZ2VTaXplLCB0aGlzLmJpbmRpbmdEYXRhLmJpbmRpbmdQYXRoKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6IqC54K56aG156CB5YiH5o2i5LqL5Lu2XHJcbiAgICogQHBhcmFtIGV2ZW50IGV2ZW50XHJcbiAgICovXHJcbiAgQEhvc3RMaXN0ZW5lcignY2hpbGRzUGFnZUNoYW5nZWQnLCBbJyRldmVudCddKVxyXG4gIHB1YmxpYyBvbk5vZGVQYWdlQ2hhbmdlZChldmVudDogYW55KSB7XHJcbiAgICBjb25zdCB7IHBhZ2VJbmRleCA9IDEsIHBhZ2VTaXplID0gdGhpcy5ub2RlUGFnZVNpemUsIG5vZGUgPSB7fSB9ID0gZXZlbnQ7XHJcbiAgICBjb25zdCBpZCA9IG5vZGUgJiYgbm9kZS5pZCB8fCBudWxsO1xyXG4gICAgaWYgKGlkKSB7XHJcbiAgICAgIGNvbnN0IHZpcnR1YWxSb290RnJhbWVDb250ZXh0ID0gdGhpcy5mcmFtZUNvbnRleHQuZ2V0VmlydHVhbFJvb3RGcmFtZUNvbnRleHQoKTtcclxuICAgICAgY29uc3QgZXhwYW5kTm9kZXMgPSB2aXJ0dWFsUm9vdEZyYW1lQ29udGV4dC5nZXRQYXJhbSgnVFJFRV9MQVRFU1RfRVhQQU5ERURfSUQnKSB8fCBbXTtcclxuICAgICAgZXhwYW5kTm9kZXMucHVzaChpZCk7XHJcbiAgICAgIHZpcnR1YWxSb290RnJhbWVDb250ZXh0LnNldFBhcmFtKCdUUkVFX0xBVEVTVF9FWFBBTkRFRF9JRCcsIGV4cGFuZE5vZGVzKTtcclxuICAgICAgdGhpcy5mcmFtZUNvbnRleHQucGFyYW1zLnNldChgX05PREVfJHtpZH1fUEFHRV9JTkRFWF9gLCBwYWdlSW5kZXgpO1xyXG4gICAgICB0aGlzLmZyYW1lQ29udGV4dC5wYXJhbXMuc2V0KGBfUkVMT0FEX0NISUxEUkVOX2AsIHRydWUpO1xyXG4gICAgICB0aGlzLmZyYW1lQ29udGV4dC5wYXJhbXMuc2V0KCdfTk9ERV9QQUdFX0NIQU5HRURfJywgdHJ1ZSk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8vI2VuZHJlZ2lvblxyXG59XHJcblxyXG5leHBvcnQgeyBGYXJyaXNUcmVlVGFibGVCaW5kaW5nRGlyZWN0aXZlIH07XHJcbiJdfQ==