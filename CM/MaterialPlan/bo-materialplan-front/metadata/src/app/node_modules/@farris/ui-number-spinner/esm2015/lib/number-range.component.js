/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { BigNumber } from 'bignumber.js';
import { Component, forwardRef, Input, Output, ViewChild, ElementRef, EventEmitter } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { NumberSpinnerComponent } from './number-spinner.component';
import { PopoverDirective } from '@farris/ui-popover';
export class NumberRangeComponent extends NumberSpinnerComponent {
    constructor() {
        super(...arguments);
        this.beginPlaceHolder = '';
        this.endPlaceHolder = '';
        this.separator = '~';
        this.__value = '';
        this.beginValueChange = new EventEmitter();
        this.endValueChange = new EventEmitter();
        this.prevValue = '';
        this.nextValue = '';
        this._beginValue = '';
        this._endValue = '';
        this.focusState = {
            isFocus: false,
            target: '' // begin | end
        };
        //#endregion
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set beginValue(value) {
        this.prevValue = this.format(value);
        this._beginValue = this.isEmpty(value) ? '' : value;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set endValue(value) {
        this.nextValue = this.format(value);
        this._endValue = this.isEmpty(value) ? '' : value;
    }
    /**
     * @return {?}
     */
    get value() {
        return this.__value;
    }
    /**
     * @param {?} v
     * @return {?}
     */
    set value(v) {
        if (v !== this.__value) {
            this.__value = v === '~' ? '' : v;
        }
    }
    /**
     * @return {?}
     */
    get preNumValue() {
        /** @type {?} */
        const v = this.getRealValue(this.parser ? this.prevValue : this._beginValue);
        if (this.canNull && this.isEmpty(v)) {
            return '';
        }
        else {
            return v || 0;
        }
    }
    /**
     * @return {?}
     */
    get nextNumValue() {
        /** @type {?} */
        const v = this.getRealValue(this.parser ? this.nextValue : this._endValue);
        if (this.canNull && this.isEmpty(v)) {
            return '';
        }
        else {
            return v || 0;
        }
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        super.ngOnInit();
        this.showButton = false;
        this.initPlaceHolderInfo();
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        this.documentClick = this.render.listen(document, 'click', (/**
         * @param {?} e
         * @return {?}
         */
        e => {
            this.render.setStyle(this.prevWrapper.nativeElement, 'flex', 1);
            this.render.setStyle(this.nextWrapper.nativeElement, 'flex', 1);
        }));
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        super.ngOnChanges(changes);
        if (changes.value && !changes.value.isFirstChange()) {
            this.setValue(changes.value.currentValue);
        }
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        if (this.documentClick) {
            this.documentClick();
        }
    }
    /**
     * @private
     * @return {?}
     */
    initPlaceHolderInfo() {
        if (!this.beginPlaceHolder) {
            this.beginPlaceHolder = this.localeService.getValue('numberSpinner.range.begin') || this.placeholder;
        }
        if (!this.endPlaceHolder) {
            this.endPlaceHolder = this.localeService.getValue('numberSpinner.range.end') || this.placeholder;
        }
    }
    /**
     * @private
     * @return {?}
     */
    getRangeValue() {
        return this.preNumValue + this.separator + this.nextNumValue;
    }
    /**
     * @private
     * @return {?}
     */
    getEndValue() {
        return this.getRealValue(this.nextValue);
    }
    /**
     * @private
     * @return {?}
     */
    getBeginValue() {
        return this.getRealValue(this.prevValue);
    }
    /**
     * @param {?} val
     * @return {?}
     */
    getRealValue(val) {
        if (this.parser) {
            return this.parser(val);
        }
        /** @type {?} */
        let _n = this.validInterval(new BigNumber(val));
        if (_n.isNaN()) {
            /** @type {?} */
            const minBigNum = new BigNumber('' + this.min);
            if (this.canNull || minBigNum.isNaN()) {
                return null;
            }
            else {
                _n = minBigNum;
            }
        }
        return (/** @type {?} */ (this._getRealValue(_n)));
    }
    /**
     * @param {?} val
     * @param {?=} type
     * @return {?}
     */
    onModelChange(val, type) {
        if (type === 'begin') {
            this._beginValue = val;
        }
        else if (type === 'end') {
            this._endValue = val;
        }
        this.value = this.getRangeValue();
        this.onChangeCallback(this.value);
        this.onTouchedCallback();
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onClick($event) {
        $event.stopPropagation();
    }
    /**
     * @param {?} e
     * @param {?} type
     * @return {?}
     */
    onBlur(e, type) {
        if (!this.readonly && !this.disabled) {
            /** @type {?} */
            const tmpValue = e.value;
            this.focusState = { isFocus: false, target: type };
            if (type === 'begin') {
                /** @type {?} */
                const nextVal = this.getEndValue();
                /** @type {?} */
                const minValue = this.isEmpty(tmpValue)
                    ? ''
                    : this.isEmpty(nextVal)
                        ? tmpValue
                        : BigNumber.min(tmpValue, nextVal).toFixed();
                // this.prevValue = this.format(minValue);
                this.beginValue = this.validInterval(new BigNumber(minValue)).toFixed();
                // this.beginValue = this.getRealValue(this.prevValue);
                this.inputPrev.nativeElement.value = this.prevValue;
                this.onModelChange(minValue, type);
            }
            else {
                /** @type {?} */
                const beginVal = this.getBeginValue();
                /** @type {?} */
                const maxValue = this.isEmpty(tmpValue)
                    ? ''
                    : this.isEmpty(beginVal)
                        ? tmpValue
                        : BigNumber.max(tmpValue, beginVal).toFixed();
                // this.nextValue = this.format(maxValue);
                // this.endValue = this.getRealValue(this.nextValue);
                this.endValue = this.validInterval(new BigNumber(maxValue)).toFixed();
                this.inputNext.nativeElement.value = this.nextValue;
                this.onModelChange(maxValue, type);
            }
        }
        this.valueChange.emit(this.value);
        if (type === 'begin') {
            this.beginValueChange.emit(this.preNumValue);
        }
        else {
            this.endValueChange.emit(this.nextNumValue);
        }
        this.blur.emit();
    }
    /**
     * @param {?=} type
     * @return {?}
     */
    onFocus(type) {
        if (!this.readonly && !this.disabled) {
            this.focusState = { isFocus: true, target: type };
            if (type === 'begin') {
                this.inputPrev.nativeElement.value = this._beginValue;
                this.inputPrev.nativeElement.setSelectionRange(0, this._beginValue.length);
                this.expendWidth('begin', 3);
            }
            else {
                this.inputNext.nativeElement.value = this._endValue;
                this.inputNext.nativeElement.setSelectionRange(0, this._endValue.length);
                this.expendWidth('end', 3);
            }
        }
        this.focus.emit(type);
    }
    /**
     * @param {?} which
     * @param {?} num
     * @return {?}
     */
    expendWidth(which, num) {
        /** @type {?} */
        let target;
        /** @type {?} */
        let other;
        if (which === 'begin') {
            target = this.prevWrapper.nativeElement;
            other = this.nextWrapper.nativeElement;
        }
        else {
            target = this.nextWrapper.nativeElement;
            other = this.prevWrapper.nativeElement;
        }
        const { width } = target.getBoundingClientRect();
        if (width < 150) {
            this.render.setStyle(target, 'flex', num);
            this.render.setStyle(other, 'flex', 1);
        }
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onMouseEnter(event) {
        this.isActiveTip = this.isShowPopover();
        if (this.nextValue && this.prevValue) {
            this.popValue = this.prevValue + '~' + this.nextValue;
        }
        else {
            this.popValue = '';
        }
    }
    /**
     * @return {?}
     */
    isShowPopover() {
        const { width } = this.el.nativeElement.getBoundingClientRect();
        if (width && width < 200) {
            return true;
        }
        return false;
    }
    /**
     * @param {?} $event
     * @param {?} typ
     * @return {?}
     */
    onKeyDownRange($event, typ) {
        if ($event.key === 'ArrowDown') {
            $event.preventDefault();
            this.down($event, typ);
        }
        if ($event.key === 'ArrowUp') {
            $event.preventDefault();
            this.up($event, typ);
        }
        $event.stopPropagation();
    }
    /**
     * @param {?} val
     * @return {?}
     */
    writeValue(val) {
        this.setValue(val);
    }
    /**
     * @param {?} val
     * @return {?}
     */
    setValue(val) {
        if (typeof val === 'string') {
            /** @type {?} */
            const valArr = val.split(this.separator);
            this._beginValue = valArr[0] ? valArr[0] : '';
            this._endValue = valArr[1] ? valArr[1] : '';
        }
        else {
            this._beginValue = '';
            this._beginValue = '';
        }
        this.prevValue = this.format(this._beginValue);
        this.nextValue = this.format(this._endValue);
    }
    //#region 上下操作按钮 或 上下方向键
    /**
     * @param {?} e
     * @param {?} type
     * @return {?}
     */
    up(e, type) {
        e.stopPropagation();
        this._compute(type, 'up', ((/** @type {?} */ (e.target))).value);
    }
    /**
     * @param {?} e
     * @param {?} type
     * @return {?}
     */
    down(e, type) {
        e.stopPropagation();
        this._compute(type, 'down', ((/** @type {?} */ (e.target))).value);
    }
    /**
     * @private
     * @param {?} type
     * @param {?} dir
     * @param {?} tagVal
     * @return {?}
     */
    _compute(type, dir, tagVal) {
        /** @type {?} */
        const m = dir === 'up' ? 'plus' : 'minus';
        if (type === 'begin' && this.isDisableOfBtn(dir, this.prevValue)) {
            /** @type {?} */
            const bv = tagVal || 0;
            /** @type {?} */
            const ev = this.getRealValue(this.nextValue);
            /** @type {?} */
            const r = new BigNumber(bv)[m](Number(this.step));
            /** @type {?} */
            let v = r.toFixed();
            /** @type {?} */
            const minValue = BigNumber.min(v, ev);
            if (!minValue.eq(v) && !this.isEmpty(ev)) {
                v = ev;
            }
            this._beginValue = v;
            // this.prevValue = this.format(v);
            this.inputPrev.nativeElement.value = v;
            this.onModelChange(v, type);
            this.beginValueChange.emit(v);
        }
        else if (type === 'end' && this.isDisableOfBtn(dir, this.nextValue)) {
            /** @type {?} */
            const bv = this.getRealValue(this.prevValue);
            /** @type {?} */
            const ev = tagVal || 0;
            /** @type {?} */
            const r = new BigNumber(ev)[m](Number(this.step));
            /** @type {?} */
            let v = r.toFixed();
            /** @type {?} */
            const maxValue = BigNumber.max(bv, v);
            if (!maxValue.eq(v) && !this.isEmpty(bv)) {
                v = bv;
            }
            this._endValue = v;
            // this.nextValue = this.format(v);
            this.inputNext.nativeElement.value = v;
            this.onModelChange(v, type);
            this.endValueChange.emit(v);
        }
        this.valueChange.emit(this.value);
        this.expendWidth(type, 3);
    }
}
NumberRangeComponent.decorators = [
    { type: Component, args: [{
                selector: 'farris-number-range',
                template: "<div\r\n    class=\"input-group number-range f-cmp-number-spinner\"\r\n    [ngClass]=\"{\r\n        'f-state-disabled': disabled,\r\n        'f-state-readonly': readonly\r\n    }\"\r\n    (click)=\"$event.stopPropagation()\" (mouseenter)=\"onMouseEnter($event)\"\r\n>\r\n    <div class=\"form-control input-container\"\r\n        #popover=\"bs-popover\"\r\n        farrisPopover\r\n        [popover]=\"popValue\"\r\n        [triggers]=\"'hover'\"\r\n        [popActive]=\"isActiveTip\"\r\n        [showAction]=\"'show2'\"\r\n        [container]=\"'body'\"\r\n    >\r\n        <div class=\"sub-input-group\" #prevWrapper>\r\n            <input\r\n                type=\"text\"\r\n                number-only\r\n                [precision]=\"precision\"\r\n                autocomplete=\"off\"\r\n                class=\"sub-input form-control f-state-focus f-state-hover\"\r\n                [(ngModel)]=\"prevValue\"\r\n                #inputPrev\r\n                (blur)=\"onBlur(inputPrev, 'begin')\"\r\n                (focus)=\"onFocus('begin')\"\r\n                (ngModelChange)=\"onModelChange($event, 'begin')\"\r\n                [placeholder]=\"disabled || readonly ?'':beginPlaceHolder\"\r\n                [readOnly]=\"disabled || readonly ? 'readonly' : ''\"\r\n                [style.text-align]=\"textAlign\"\r\n                (keydown)=\"onKeyDownRange($event, 'begin')\"\r\n                (click)=\"onClick($event)\"\r\n            />\r\n            <div\r\n                class=\"input-group-append btn-group btn-group-number sub-btn-group\"\r\n                *ngIf=\"!readonly && !disabled && showButton\"\r\n            >\r\n                <button\r\n                    class=\"btn btn-secondary btn-number-flag btn-number-flag-up\"\r\n                    [style.cursor]=\"isDisableOfBtn('up', prevValue) ? 'pointer' : 'not-allowed'\"\r\n                    (click)=\"up($event, 'begin')\"\r\n                >\r\n                    <span class=\"f-icon f-icon-dropdown number-arrow-chevron\"></span>\r\n                </button>\r\n                <button\r\n                    class=\"btn btn-secondary btn-number-flag  btn-number-flag-down\"\r\n                    [style.cursor]=\"isDisableOfBtn('down', prevValue) ? 'pointer' : 'not-allowed'\"\r\n                    (click)=\"down($event, 'begin')\"\r\n                >\r\n                    <span class=\"f-icon f-icon-dropdown number-arrow-chevron\"></span>\r\n                </button>\r\n            </div>\r\n        </div>\r\n        <span class=\"spliter\">~</span>\r\n        <div class=\"sub-input-group\" #nextWrapper>\r\n            <input\r\n                type=\"text\"\r\n                number-only\r\n                [precision]=\"precision\"\r\n                autocomplete=\"off\"\r\n                class=\"sub-input form-control f-state-focus f-state-hover\"\r\n                [(ngModel)]=\"nextValue\"\r\n                #inputNext\r\n                (blur)=\"onBlur(inputNext, 'end')\"\r\n                (focus)=\"onFocus('end')\"\r\n                (ngModelChange)=\"onModelChange($event, 'end')\"\r\n                [placeholder]=\"disabled || readonly ?'':endPlaceHolder\"\r\n                [readOnly]=\"disabled || readonly ? 'readonly' : ''\"\r\n                [style.text-align]=\"textAlign\"\r\n                (keydown)=\"onKeyDownRange($event, 'end')\"\r\n                (click)=\"onClick($event)\"\r\n            />\r\n            <div\r\n                class=\"input-group-append btn-group btn-group-number sub-btn-group\"\r\n                *ngIf=\"!readonly && !disabled  && showButton\"\r\n                [style.text-align]=\"textAlign\"\r\n            >\r\n                <button\r\n                    class=\"btn btn-secondary btn-number-flag\"\r\n                    [style.cursor]=\"isDisableOfBtn('up', nextValue) ? 'pointer' : 'not-allowed'\"\r\n                    (click)=\"up($event, 'end')\"\r\n                >\r\n                    <span class=\"icon k-i-arrow-chevron-up number-arrow-chevron\"></span>\r\n                </button>\r\n                <button\r\n                    class=\"btn btn-secondary btn-number-flag\"\r\n                    [style.cursor]=\"isDisableOfBtn('down', nextValue) ? 'pointer' : 'not-allowed'\"\r\n                    (click)=\"down($event, 'end')\"\r\n                >\r\n                    <span class=\"icon k-i-arrow-chevron-down number-arrow-chevron\"></span>\r\n                </button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n",
                providers: [
                    {
                        provide: NG_VALUE_ACCESSOR,
                        useExisting: forwardRef((/**
                         * @return {?}
                         */
                        () => NumberRangeComponent)),
                        multi: true
                    }
                ],
                styles: [".input-group .btn-group-number{height:1.50003rem;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column;background-color:#fff}.input-group .btn-group-number .btn-number-flag{height:50%;display:-webkit-box;display:flex;box-shadow:none;padding:0 5px;margin-left:1px;border-left:1px solid #d9d9d9;overflow:hidden;-webkit-transition:.1s linear;transition:.1s linear}.input-group .btn-group-number .btn-number-flag .number-arrow-chevron{-webkit-box-flex:1;flex:1;line-height:1}.input-group .btn-group-number .btn-number-flag:hover{height:60%!important}.input-group .btn-group-number .btn-number-flag:nth-child(2){border-top:1px solid #d9d9d9}input::-webkit-inner-spin-button,input::-webkit-outer-spin-button{-webkit-appearance:none!important;margin:0}.number-range{position:relative}.number-range .input-container{display:-webkit-box;display:flex;padding:0}.number-range .input-container .sub-input-group{-webkit-box-flex:1;flex:1;position:relative;display:-webkit-box;display:flex;-webkit-transition:.3s ease-out;transition:.3s ease-out}.number-range .input-container .sub-input-group .sub-input{width:100%;border:none;outline:0;background-color:rgba(0,0,0,0);min-width:2px;padding:.125rem 4px .125rem .5rem}.number-range .input-container .spliter{width:15px;text-align:center}"]
            }] }
];
NumberRangeComponent.propDecorators = {
    beginPlaceHolder: [{ type: Input }],
    endPlaceHolder: [{ type: Input }],
    inputPrev: [{ type: ViewChild, args: ['inputPrev',] }],
    inputNext: [{ type: ViewChild, args: ['inputNext',] }],
    prevWrapper: [{ type: ViewChild, args: ['prevWrapper',] }],
    nextWrapper: [{ type: ViewChild, args: ['nextWrapper',] }],
    popover: [{ type: ViewChild, args: ['popover',] }],
    separator: [{ type: Input }],
    beginValue: [{ type: Input }],
    endValue: [{ type: Input }],
    value: [{ type: Input }],
    beginValueChange: [{ type: Output }],
    endValueChange: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    NumberRangeComponent.prototype.beginPlaceHolder;
    /** @type {?} */
    NumberRangeComponent.prototype.endPlaceHolder;
    /** @type {?} */
    NumberRangeComponent.prototype.inputPrev;
    /** @type {?} */
    NumberRangeComponent.prototype.inputNext;
    /** @type {?} */
    NumberRangeComponent.prototype.prevWrapper;
    /** @type {?} */
    NumberRangeComponent.prototype.nextWrapper;
    /** @type {?} */
    NumberRangeComponent.prototype.popover;
    /** @type {?} */
    NumberRangeComponent.prototype.separator;
    /**
     * @type {?}
     * @private
     */
    NumberRangeComponent.prototype.__value;
    /** @type {?} */
    NumberRangeComponent.prototype.beginValueChange;
    /** @type {?} */
    NumberRangeComponent.prototype.endValueChange;
    /** @type {?} */
    NumberRangeComponent.prototype.prevValue;
    /** @type {?} */
    NumberRangeComponent.prototype.nextValue;
    /**
     * @type {?}
     * @private
     */
    NumberRangeComponent.prototype._beginValue;
    /**
     * @type {?}
     * @private
     */
    NumberRangeComponent.prototype._endValue;
    /**
     * @type {?}
     * @private
     */
    NumberRangeComponent.prototype.documentClick;
    /**
     * @type {?}
     * @private
     */
    NumberRangeComponent.prototype.focusState;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibnVtYmVyLXJhbmdlLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktbnVtYmVyLXNwaW5uZXIvIiwic291cmNlcyI6WyJsaWIvbnVtYmVyLXJhbmdlLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUV6QyxPQUFPLEVBQ0gsU0FBUyxFQUFFLFVBQVUsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUNyQixTQUFTLEVBQUUsVUFBVSxFQUNwQyxZQUFZLEVBR2YsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDbkQsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDcEUsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFjdEQsTUFBTSxPQUFPLG9CQUFxQixTQUFRLHNCQUFzQjtJQVpoRTs7UUFjYSxxQkFBZ0IsR0FBRyxFQUFFLENBQUM7UUFDdEIsbUJBQWMsR0FBRyxFQUFFLENBQUM7UUFRcEIsY0FBUyxHQUFHLEdBQUcsQ0FBQztRQWNqQixZQUFPLEdBQUcsRUFBRSxDQUFDO1FBWVgscUJBQWdCLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUN0QyxtQkFBYyxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFFOUMsY0FBUyxHQUFRLEVBQUUsQ0FBQztRQUNwQixjQUFTLEdBQVEsRUFBRSxDQUFDO1FBRVosZ0JBQVcsR0FBRyxFQUFFLENBQUM7UUFDakIsY0FBUyxHQUFHLEVBQUUsQ0FBQztRQW9CZixlQUFVLEdBQUc7WUFDakIsT0FBTyxFQUFFLEtBQUs7WUFDZCxNQUFNLEVBQUUsRUFBRSxDQUFJLGNBQWM7U0FDL0IsQ0FBQztRQTJQRixZQUFZO0lBRWhCLENBQUM7Ozs7O0lBblRHLElBQ0ksVUFBVSxDQUFDLEtBQUs7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LGdEQUErQjs7SUFDL0IsOENBQTZCOztJQUU3Qix5Q0FBOEM7O0lBQzlDLHlDQUE4Qzs7SUFDOUMsMkNBQWtEOztJQUNsRCwyQ0FBa0Q7O0lBQ2xELHVDQUFnRDs7SUFFaEQseUNBQXlCOzs7OztJQWN6Qix1Q0FBcUI7O0lBWXJCLGdEQUFnRDs7SUFDaEQsOENBQThDOztJQUU5Qyx5Q0FBb0I7O0lBQ3BCLHlDQUFvQjs7Ozs7SUFFcEIsMkNBQXlCOzs7OztJQUN6Qix5Q0FBdUI7Ozs7O0lBbUJ2Qiw2Q0FBc0I7Ozs7O0lBQ3RCLDBDQUdFIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQmlnTnVtYmVyIH0gZnJvbSAnYmlnbnVtYmVyLmpzJztcclxuXHJcbmltcG9ydCB7XHJcbiAgICBDb21wb25lbnQsIGZvcndhcmRSZWYsIElucHV0LCBPdXRwdXQsXHJcbiAgICBBZnRlclZpZXdJbml0LCBWaWV3Q2hpbGQsIEVsZW1lbnRSZWYsIE9uRGVzdHJveSwgU2ltcGxlQ2hhbmdlcyxcclxuICAgIEV2ZW50RW1pdHRlcixcclxuICAgIE9uSW5pdCxcclxuICAgIE9uQ2hhbmdlc1xyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBOR19WQUxVRV9BQ0NFU1NPUiB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcclxuaW1wb3J0IHsgTnVtYmVyU3Bpbm5lckNvbXBvbmVudCB9IGZyb20gJy4vbnVtYmVyLXNwaW5uZXIuY29tcG9uZW50JztcclxuaW1wb3J0IHsgUG9wb3ZlckRpcmVjdGl2ZSB9IGZyb20gJ0BmYXJyaXMvdWktcG9wb3Zlcic7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAnZmFycmlzLW51bWJlci1yYW5nZScsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vbnVtYmVyLXJhbmdlLmNvbXBvbmVudC5odG1sJyxcclxuICAgIHN0eWxlVXJsczogWycuL251bWJlci5jb21wb25lbnQuc2NzcyddLFxyXG4gICAgcHJvdmlkZXJzOiBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBwcm92aWRlOiBOR19WQUxVRV9BQ0NFU1NPUixcclxuICAgICAgICAgICAgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gTnVtYmVyUmFuZ2VDb21wb25lbnQpLFxyXG4gICAgICAgICAgICBtdWx0aTogdHJ1ZVxyXG4gICAgICAgIH1cclxuICAgIF1cclxufSlcclxuZXhwb3J0IGNsYXNzIE51bWJlclJhbmdlQ29tcG9uZW50IGV4dGVuZHMgTnVtYmVyU3Bpbm5lckNvbXBvbmVudCBpbXBsZW1lbnRzIEFmdGVyVmlld0luaXQsIE9uRGVzdHJveSwgT25Jbml0LCBPbkNoYW5nZXMge1xyXG5cclxuICAgIEBJbnB1dCgpIGJlZ2luUGxhY2VIb2xkZXIgPSAnJztcclxuICAgIEBJbnB1dCgpIGVuZFBsYWNlSG9sZGVyID0gJyc7XHJcblxyXG4gICAgQFZpZXdDaGlsZCgnaW5wdXRQcmV2JykgaW5wdXRQcmV2OiBFbGVtZW50UmVmO1xyXG4gICAgQFZpZXdDaGlsZCgnaW5wdXROZXh0JykgaW5wdXROZXh0OiBFbGVtZW50UmVmO1xyXG4gICAgQFZpZXdDaGlsZCgncHJldldyYXBwZXInKSBwcmV2V3JhcHBlcjogRWxlbWVudFJlZjtcclxuICAgIEBWaWV3Q2hpbGQoJ25leHRXcmFwcGVyJykgbmV4dFdyYXBwZXI6IEVsZW1lbnRSZWY7XHJcbiAgICBAVmlld0NoaWxkKCdwb3BvdmVyJykgcG9wb3ZlcjogUG9wb3ZlckRpcmVjdGl2ZTtcclxuXHJcbiAgICBASW5wdXQoKSBzZXBhcmF0b3IgPSAnfic7XHJcblxyXG4gICAgQElucHV0KClcclxuICAgIHNldCBiZWdpblZhbHVlKHZhbHVlKSB7XHJcbiAgICAgICAgdGhpcy5wcmV2VmFsdWUgPSB0aGlzLmZvcm1hdCh2YWx1ZSk7XHJcbiAgICAgICAgdGhpcy5fYmVnaW5WYWx1ZSA9IHRoaXMuaXNFbXB0eSh2YWx1ZSkgPyAnJyA6IHZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIEBJbnB1dCgpXHJcbiAgICBzZXQgZW5kVmFsdWUodmFsdWUpIHtcclxuICAgICAgICB0aGlzLm5leHRWYWx1ZSA9IHRoaXMuZm9ybWF0KHZhbHVlKTtcclxuICAgICAgICB0aGlzLl9lbmRWYWx1ZSA9IHRoaXMuaXNFbXB0eSh2YWx1ZSkgPyAnJyA6IHZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgX192YWx1ZSA9ICcnO1xyXG4gICAgQElucHV0KClcclxuICAgIGdldCB2YWx1ZSgpOiBhbnkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9fdmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IHZhbHVlKHY6IGFueSkge1xyXG4gICAgICAgIGlmICh2ICE9PSB0aGlzLl9fdmFsdWUpIHtcclxuICAgICAgICAgICAgdGhpcy5fX3ZhbHVlID0gdiA9PT0gJ34nID8gJycgOiB2O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBAT3V0cHV0KCkgYmVnaW5WYWx1ZUNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIEBPdXRwdXQoKSBlbmRWYWx1ZUNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuXHJcbiAgICBwcmV2VmFsdWU6IGFueSA9ICcnO1xyXG4gICAgbmV4dFZhbHVlOiBhbnkgPSAnJztcclxuXHJcbiAgICBwcml2YXRlIF9iZWdpblZhbHVlID0gJyc7XHJcbiAgICBwcml2YXRlIF9lbmRWYWx1ZSA9ICcnO1xyXG4gICAgZ2V0IHByZU51bVZhbHVlKCkge1xyXG4gICAgICAgIGNvbnN0IHYgPSB0aGlzLmdldFJlYWxWYWx1ZSh0aGlzLnBhcnNlciA/IHRoaXMucHJldlZhbHVlIDogdGhpcy5fYmVnaW5WYWx1ZSk7XHJcbiAgICAgICAgaWYgKHRoaXMuY2FuTnVsbCAmJiB0aGlzLmlzRW1wdHkodikpIHtcclxuICAgICAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiB2IHx8IDA7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldCBuZXh0TnVtVmFsdWUoKSB7XHJcbiAgICAgICAgY29uc3QgdiA9IHRoaXMuZ2V0UmVhbFZhbHVlKHRoaXMucGFyc2VyID8gdGhpcy5uZXh0VmFsdWUgOiB0aGlzLl9lbmRWYWx1ZSk7XHJcbiAgICAgICAgaWYgKHRoaXMuY2FuTnVsbCAmJiB0aGlzLmlzRW1wdHkodikpIHtcclxuICAgICAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiB2IHx8IDA7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZG9jdW1lbnRDbGljaztcclxuICAgIHByaXZhdGUgZm9jdXNTdGF0ZSA9IHtcclxuICAgICAgICBpc0ZvY3VzOiBmYWxzZSxcclxuICAgICAgICB0YXJnZXQ6ICcnICAgIC8vIGJlZ2luIHwgZW5kXHJcbiAgICB9O1xyXG5cclxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgICAgIHN1cGVyLm5nT25Jbml0KCk7XHJcbiAgICAgICAgdGhpcy5zaG93QnV0dG9uID0gZmFsc2U7XHJcblxyXG4gICAgICAgIHRoaXMuaW5pdFBsYWNlSG9sZGVySW5mbygpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcclxuICAgICAgICB0aGlzLmRvY3VtZW50Q2xpY2sgPSB0aGlzLnJlbmRlci5saXN0ZW4oZG9jdW1lbnQsICdjbGljaycsIGUgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlci5zZXRTdHlsZSh0aGlzLnByZXZXcmFwcGVyLm5hdGl2ZUVsZW1lbnQsICdmbGV4JywgMSk7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyLnNldFN0eWxlKHRoaXMubmV4dFdyYXBwZXIubmF0aXZlRWxlbWVudCwgJ2ZsZXgnLCAxKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XHJcbiAgICAgICAgc3VwZXIubmdPbkNoYW5nZXMoY2hhbmdlcyk7XHJcbiAgICAgICAgaWYgKGNoYW5nZXMudmFsdWUgJiYgIWNoYW5nZXMudmFsdWUuaXNGaXJzdENoYW5nZSgpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0VmFsdWUoY2hhbmdlcy52YWx1ZS5jdXJyZW50VmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBuZ09uRGVzdHJveSgpIHtcclxuICAgICAgICBpZiAodGhpcy5kb2N1bWVudENsaWNrKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZG9jdW1lbnRDbGljaygpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGluaXRQbGFjZUhvbGRlckluZm8oKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmJlZ2luUGxhY2VIb2xkZXIpIHtcclxuICAgICAgICAgICAgdGhpcy5iZWdpblBsYWNlSG9sZGVyID0gdGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKCdudW1iZXJTcGlubmVyLnJhbmdlLmJlZ2luJykgfHwgdGhpcy5wbGFjZWhvbGRlcjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCF0aGlzLmVuZFBsYWNlSG9sZGVyKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZW5kUGxhY2VIb2xkZXIgPSAgdGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKCdudW1iZXJTcGlubmVyLnJhbmdlLmVuZCcpIHx8IHRoaXMucGxhY2Vob2xkZXI7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0UmFuZ2VWYWx1ZSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5wcmVOdW1WYWx1ZSArIHRoaXMuc2VwYXJhdG9yICsgdGhpcy5uZXh0TnVtVmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRFbmRWYWx1ZSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXRSZWFsVmFsdWUodGhpcy5uZXh0VmFsdWUpO1xyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSBnZXRCZWdpblZhbHVlKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldFJlYWxWYWx1ZSh0aGlzLnByZXZWYWx1ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0UmVhbFZhbHVlKHZhbDogYW55KSB7XHJcbiAgICAgICAgaWYgKHRoaXMucGFyc2VyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlcih2YWwpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgX24gPSB0aGlzLnZhbGlkSW50ZXJ2YWwobmV3IEJpZ051bWJlcih2YWwpKTtcclxuICAgICAgICBpZiAoX24uaXNOYU4oKSkge1xyXG4gICAgICAgICAgICBjb25zdCBtaW5CaWdOdW0gPSBuZXcgQmlnTnVtYmVyKCcnICsgdGhpcy5taW4pO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5jYW5OdWxsIHx8IG1pbkJpZ051bS5pc05hTigpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIF9uID0gbWluQmlnTnVtO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5fZ2V0UmVhbFZhbHVlKF9uKSBhcyBhbnk7XHJcbiAgICB9XHJcblxyXG4gICAgb25Nb2RlbENoYW5nZSh2YWwsIHR5cGU/OiBzdHJpbmcpIHtcclxuICAgICAgICBpZiAodHlwZSA9PT0gJ2JlZ2luJykge1xyXG4gICAgICAgICAgICB0aGlzLl9iZWdpblZhbHVlID0gdmFsO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ2VuZCcpIHtcclxuICAgICAgICAgICAgdGhpcy5fZW5kVmFsdWUgPSB2YWw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLmdldFJhbmdlVmFsdWUoKTtcclxuICAgICAgICB0aGlzLm9uQ2hhbmdlQ2FsbGJhY2sodGhpcy52YWx1ZSk7XHJcbiAgICAgICAgdGhpcy5vblRvdWNoZWRDYWxsYmFjaygpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uQ2xpY2soJGV2ZW50KSB7XHJcbiAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uQmx1cihlOiBhbnksIHR5cGU6IHN0cmluZykge1xyXG4gICAgICAgIGlmICghdGhpcy5yZWFkb25seSAmJiAhdGhpcy5kaXNhYmxlZCkge1xyXG4gICAgICAgICAgICBjb25zdCB0bXBWYWx1ZSA9IGUudmFsdWU7XHJcbiAgICAgICAgICAgIHRoaXMuZm9jdXNTdGF0ZSA9IHsgaXNGb2N1czogZmFsc2UsIHRhcmdldDogdHlwZSB9O1xyXG4gICAgICAgICAgICBpZiAodHlwZSA9PT0gJ2JlZ2luJykge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbmV4dFZhbCA9IHRoaXMuZ2V0RW5kVmFsdWUoKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG1pblZhbHVlID0gdGhpcy5pc0VtcHR5KHRtcFZhbHVlKVxyXG4gICAgICAgICAgICAgICAgICAgID8gJydcclxuICAgICAgICAgICAgICAgICAgICA6IHRoaXMuaXNFbXB0eShuZXh0VmFsKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICA/IHRtcFZhbHVlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDogQmlnTnVtYmVyLm1pbih0bXBWYWx1ZSwgbmV4dFZhbCkudG9GaXhlZCgpO1xyXG4gICAgICAgICAgICAgICAgLy8gdGhpcy5wcmV2VmFsdWUgPSB0aGlzLmZvcm1hdChtaW5WYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmJlZ2luVmFsdWUgPSB0aGlzLnZhbGlkSW50ZXJ2YWwobmV3IEJpZ051bWJlcihtaW5WYWx1ZSkpLnRvRml4ZWQoKTtcclxuICAgICAgICAgICAgICAgIC8vIHRoaXMuYmVnaW5WYWx1ZSA9IHRoaXMuZ2V0UmVhbFZhbHVlKHRoaXMucHJldlZhbHVlKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5wdXRQcmV2Lm5hdGl2ZUVsZW1lbnQudmFsdWUgPSB0aGlzLnByZXZWYWx1ZTtcclxuICAgICAgICAgICAgICAgIHRoaXMub25Nb2RlbENoYW5nZShtaW5WYWx1ZSwgdHlwZSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBiZWdpblZhbCA9IHRoaXMuZ2V0QmVnaW5WYWx1ZSgpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbWF4VmFsdWUgPSB0aGlzLmlzRW1wdHkodG1wVmFsdWUpXHJcbiAgICAgICAgICAgICAgICAgICAgPyAnJ1xyXG4gICAgICAgICAgICAgICAgICAgIDogdGhpcy5pc0VtcHR5KGJlZ2luVmFsKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICA/IHRtcFZhbHVlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDogQmlnTnVtYmVyLm1heCh0bXBWYWx1ZSwgYmVnaW5WYWwpLnRvRml4ZWQoKTtcclxuICAgICAgICAgICAgICAgIC8vIHRoaXMubmV4dFZhbHVlID0gdGhpcy5mb3JtYXQobWF4VmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgLy8gdGhpcy5lbmRWYWx1ZSA9IHRoaXMuZ2V0UmVhbFZhbHVlKHRoaXMubmV4dFZhbHVlKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZW5kVmFsdWUgPSB0aGlzLnZhbGlkSW50ZXJ2YWwobmV3IEJpZ051bWJlcihtYXhWYWx1ZSkpLnRvRml4ZWQoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5wdXROZXh0Lm5hdGl2ZUVsZW1lbnQudmFsdWUgPSB0aGlzLm5leHRWYWx1ZTtcclxuICAgICAgICAgICAgICAgIHRoaXMub25Nb2RlbENoYW5nZShtYXhWYWx1ZSwgdHlwZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMudmFsdWVDaGFuZ2UuZW1pdCh0aGlzLnZhbHVlKTtcclxuICAgICAgICBpZiAodHlwZSA9PT0gJ2JlZ2luJykge1xyXG4gICAgICAgICAgICB0aGlzLmJlZ2luVmFsdWVDaGFuZ2UuZW1pdCh0aGlzLnByZU51bVZhbHVlKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmVuZFZhbHVlQ2hhbmdlLmVtaXQodGhpcy5uZXh0TnVtVmFsdWUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5ibHVyLmVtaXQoKTtcclxuICAgIH1cclxuXHJcbiAgICBvbkZvY3VzKHR5cGU/OiBzdHJpbmcpIHtcclxuICAgICAgICBpZiAoIXRoaXMucmVhZG9ubHkgJiYgIXRoaXMuZGlzYWJsZWQpIHtcclxuICAgICAgICAgICAgdGhpcy5mb2N1c1N0YXRlID0geyBpc0ZvY3VzOiB0cnVlLCB0YXJnZXQ6IHR5cGUgfTtcclxuICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdiZWdpbicpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5wdXRQcmV2Lm5hdGl2ZUVsZW1lbnQudmFsdWUgPSB0aGlzLl9iZWdpblZhbHVlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnB1dFByZXYubmF0aXZlRWxlbWVudC5zZXRTZWxlY3Rpb25SYW5nZSgwLCB0aGlzLl9iZWdpblZhbHVlLmxlbmd0aCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmV4cGVuZFdpZHRoKCdiZWdpbicsIDMpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnB1dE5leHQubmF0aXZlRWxlbWVudC52YWx1ZSA9IHRoaXMuX2VuZFZhbHVlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnB1dE5leHQubmF0aXZlRWxlbWVudC5zZXRTZWxlY3Rpb25SYW5nZSgwLCB0aGlzLl9lbmRWYWx1ZS5sZW5ndGgpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5leHBlbmRXaWR0aCgnZW5kJywgMyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuZm9jdXMuZW1pdCh0eXBlKTtcclxuICAgIH1cclxuXHJcbiAgICBleHBlbmRXaWR0aCh3aGljaDogc3RyaW5nLCBudW06IG51bWJlcikge1xyXG4gICAgICAgIGxldCB0YXJnZXQ6IEVsZW1lbnQ7XHJcbiAgICAgICAgbGV0IG90aGVyOiBFbGVtZW50O1xyXG4gICAgICAgIGlmICh3aGljaCA9PT0gJ2JlZ2luJykge1xyXG4gICAgICAgICAgICB0YXJnZXQgPSB0aGlzLnByZXZXcmFwcGVyLm5hdGl2ZUVsZW1lbnQ7XHJcbiAgICAgICAgICAgIG90aGVyID0gdGhpcy5uZXh0V3JhcHBlci5uYXRpdmVFbGVtZW50O1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRhcmdldCA9IHRoaXMubmV4dFdyYXBwZXIubmF0aXZlRWxlbWVudDtcclxuICAgICAgICAgICAgb3RoZXIgPSB0aGlzLnByZXZXcmFwcGVyLm5hdGl2ZUVsZW1lbnQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHsgd2lkdGggfSA9IHRhcmdldC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgICAgICBpZiAod2lkdGggPCAxNTApIHtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXIuc2V0U3R5bGUodGFyZ2V0LCAnZmxleCcsIG51bSk7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyLnNldFN0eWxlKG90aGVyLCAnZmxleCcsIDEpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBvbk1vdXNlRW50ZXIoZXZlbnQpIHtcclxuICAgICAgICB0aGlzLmlzQWN0aXZlVGlwID0gdGhpcy5pc1Nob3dQb3BvdmVyKCk7XHJcbiAgICAgICAgaWYgKHRoaXMubmV4dFZhbHVlICYmIHRoaXMucHJldlZhbHVlKSB7XHJcbiAgICAgICAgICAgIHRoaXMucG9wVmFsdWUgPSB0aGlzLnByZXZWYWx1ZSArICd+JyArIHRoaXMubmV4dFZhbHVlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMucG9wVmFsdWUgPSAnJztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaXNTaG93UG9wb3ZlcigpIHtcclxuICAgICAgICBjb25zdCB7IHdpZHRoIH0gPSB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcbiAgICAgICAgaWYgKHdpZHRoICYmIHdpZHRoIDwgMjAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgb25LZXlEb3duUmFuZ2UoJGV2ZW50OiBLZXlib2FyZEV2ZW50LCB0eXA6ICdiZWdpbid8J2VuZCcpIHtcclxuICAgICAgICBpZiAoJGV2ZW50LmtleSA9PT0gJ0Fycm93RG93bicpIHtcclxuICAgICAgICAgICAgJGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgIHRoaXMuZG93bigkZXZlbnQsIHR5cCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoJGV2ZW50LmtleSA9PT0gJ0Fycm93VXAnKSB7XHJcbiAgICAgICAgICAgICRldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICB0aGlzLnVwKCRldmVudCwgdHlwKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgIH1cclxuXHJcbiAgICB3cml0ZVZhbHVlKHZhbDogYW55KTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5zZXRWYWx1ZSh2YWwpO1xyXG4gICAgfVxyXG5cclxuICAgIHNldFZhbHVlKHZhbDogYW55KSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiB2YWwgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHZhbEFyciA9IHZhbC5zcGxpdCh0aGlzLnNlcGFyYXRvcik7XHJcbiAgICAgICAgICAgIHRoaXMuX2JlZ2luVmFsdWUgPSB2YWxBcnJbMF0gPyB2YWxBcnJbMF0gOiAnJztcclxuICAgICAgICAgICAgdGhpcy5fZW5kVmFsdWUgPSB2YWxBcnJbMV0gPyB2YWxBcnJbMV0gOiAnJztcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLl9iZWdpblZhbHVlID0gJyc7XHJcbiAgICAgICAgICAgIHRoaXMuX2JlZ2luVmFsdWUgPSAnJztcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5wcmV2VmFsdWUgPSB0aGlzLmZvcm1hdCh0aGlzLl9iZWdpblZhbHVlKTtcclxuICAgICAgICB0aGlzLm5leHRWYWx1ZSA9IHRoaXMuZm9ybWF0KHRoaXMuX2VuZFZhbHVlKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgLy8jcmVnaW9uIOS4iuS4i+aTjeS9nOaMiemSriDmiJYg5LiK5LiL5pa55ZCR6ZSuXHJcbiAgICB1cChlOiBFdmVudCwgdHlwZTogc3RyaW5nKSB7XHJcbiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICB0aGlzLl9jb21wdXRlKHR5cGUsICd1cCcsIChlLnRhcmdldCBhcyBhbnkpLnZhbHVlKTtcclxuICAgIH1cclxuXHJcbiAgICBkb3duKGU6IEV2ZW50LCB0eXBlOiBzdHJpbmcpIHtcclxuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgIHRoaXMuX2NvbXB1dGUodHlwZSwgJ2Rvd24nLCAoZS50YXJnZXQgYXMgYW55KS52YWx1ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfY29tcHV0ZSh0eXBlOiBzdHJpbmcsIGRpcjogJ3VwJyB8ICdkb3duJywgdGFnVmFsKSB7XHJcbiAgICAgICAgY29uc3QgbSA9IGRpciA9PT0gJ3VwJyA/ICdwbHVzJyA6ICdtaW51cyc7XHJcbiAgICAgICAgaWYgKHR5cGUgPT09ICdiZWdpbicgJiYgdGhpcy5pc0Rpc2FibGVPZkJ0bihkaXIsIHRoaXMucHJldlZhbHVlKSkge1xyXG4gICAgICAgICAgICBjb25zdCBidiA9IHRhZ1ZhbCB8fCAwO1xyXG4gICAgICAgICAgICBjb25zdCBldiA9IHRoaXMuZ2V0UmVhbFZhbHVlKHRoaXMubmV4dFZhbHVlKTtcclxuICAgICAgICAgICAgY29uc3QgciA9IG5ldyBCaWdOdW1iZXIoYnYpW21dKE51bWJlcih0aGlzLnN0ZXApKTtcclxuICAgICAgICAgICAgbGV0IHYgPSByLnRvRml4ZWQoKTtcclxuICAgICAgICAgICAgY29uc3QgbWluVmFsdWUgPSBCaWdOdW1iZXIubWluKHYsIGV2KTtcclxuICAgICAgICAgICAgaWYgKCFtaW5WYWx1ZS5lcSh2KSAmJiAhdGhpcy5pc0VtcHR5KGV2KSkge1xyXG4gICAgICAgICAgICAgICAgdiA9IGV2O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuX2JlZ2luVmFsdWUgPSB2O1xyXG4gICAgICAgICAgICAvLyB0aGlzLnByZXZWYWx1ZSA9IHRoaXMuZm9ybWF0KHYpO1xyXG4gICAgICAgICAgICB0aGlzLmlucHV0UHJldi5uYXRpdmVFbGVtZW50LnZhbHVlID0gdjtcclxuICAgICAgICAgICAgdGhpcy5vbk1vZGVsQ2hhbmdlKHYsIHR5cGUpO1xyXG4gICAgICAgICAgICB0aGlzLmJlZ2luVmFsdWVDaGFuZ2UuZW1pdCh2KTtcclxuICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdlbmQnICYmIHRoaXMuaXNEaXNhYmxlT2ZCdG4oZGlyLCB0aGlzLm5leHRWYWx1ZSkpIHtcclxuICAgICAgICAgICAgY29uc3QgYnYgPSB0aGlzLmdldFJlYWxWYWx1ZSh0aGlzLnByZXZWYWx1ZSk7XHJcbiAgICAgICAgICAgIGNvbnN0IGV2ID0gdGFnVmFsIHx8IDA7XHJcbiAgICAgICAgICAgIGNvbnN0IHIgPSBuZXcgQmlnTnVtYmVyKGV2KVttXShOdW1iZXIodGhpcy5zdGVwKSk7XHJcbiAgICAgICAgICAgIGxldCB2ID0gci50b0ZpeGVkKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IG1heFZhbHVlID0gQmlnTnVtYmVyLm1heChidiwgdik7XHJcbiAgICAgICAgICAgIGlmICghbWF4VmFsdWUuZXEodikgJiYgIXRoaXMuaXNFbXB0eShidikpIHtcclxuICAgICAgICAgICAgICAgIHYgPSBidjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLl9lbmRWYWx1ZSA9IHY7XHJcbiAgICAgICAgICAgIC8vIHRoaXMubmV4dFZhbHVlID0gdGhpcy5mb3JtYXQodik7XHJcbiAgICAgICAgICAgIHRoaXMuaW5wdXROZXh0Lm5hdGl2ZUVsZW1lbnQudmFsdWUgPSB2O1xyXG4gICAgICAgICAgICB0aGlzLm9uTW9kZWxDaGFuZ2UodiwgdHlwZSk7XHJcbiAgICAgICAgICAgIHRoaXMuZW5kVmFsdWVDaGFuZ2UuZW1pdCh2KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy52YWx1ZUNoYW5nZS5lbWl0KHRoaXMudmFsdWUpO1xyXG4gICAgICAgIHRoaXMuZXhwZW5kV2lkdGgodHlwZSwgMyk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8jZW5kcmVnaW9uXHJcblxyXG59XHJcbiJdfQ==