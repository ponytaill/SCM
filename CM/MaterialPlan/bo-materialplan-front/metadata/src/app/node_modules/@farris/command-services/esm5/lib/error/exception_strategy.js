import * as tslib_1 from "tslib";
import { Optional } from '@angular/core';
import { MessagerService } from '@farris/ui-messager';
import { LanguageService } from '../languag.service';
import { DeviceAbility } from '../util/device-ability';
import moment from 'moment';
/**
 * 异常处理基类
 */
var ExceptionStrategy = /** @class */ (function () {
    function ExceptionStrategy(messagerService, languageService) {
        this.messagerService = messagerService;
        this.languageService = languageService;
    }
    /** @nocollapse */
    ExceptionStrategy.ctorParameters = function () { return [
        { type: MessagerService },
        { type: LanguageService, decorators: [{ type: Optional }] }
    ]; };
    return ExceptionStrategy;
}());
export { ExceptionStrategy };
/**
 * 信息级别异常处理
 */
var InfoExceptionStrategy = /** @class */ (function (_super) {
    tslib_1.__extends(InfoExceptionStrategy, _super);
    function InfoExceptionStrategy(messagerService, languageService) {
        return _super.call(this, messagerService, languageService) || this;
    }
    InfoExceptionStrategy.prototype.handleException = function (error) {
        if (!error) {
            return;
        }
        this.messagerService.info(error.Message);
    };
    /** @nocollapse */
    InfoExceptionStrategy.ctorParameters = function () { return [
        { type: MessagerService },
        { type: LanguageService, decorators: [{ type: Optional }] }
    ]; };
    return InfoExceptionStrategy;
}(ExceptionStrategy));
export { InfoExceptionStrategy };
/**
 * 警告级别异常处理
 */
var WarningExceptionStrategy = /** @class */ (function (_super) {
    tslib_1.__extends(WarningExceptionStrategy, _super);
    function WarningExceptionStrategy(messagerService, languageService) {
        return _super.call(this, messagerService, languageService) || this;
    }
    WarningExceptionStrategy.prototype.handleException = function (error) {
        if (!error) {
            return;
        }
        this.messagerService.warning(error.Message);
    };
    /** @nocollapse */
    WarningExceptionStrategy.ctorParameters = function () { return [
        { type: MessagerService },
        { type: LanguageService, decorators: [{ type: Optional }] }
    ]; };
    return WarningExceptionStrategy;
}(ExceptionStrategy));
export { WarningExceptionStrategy };
/**
 * 错误级别异常处理
 */
var ErrorExceptionStrategy = /** @class */ (function (_super) {
    tslib_1.__extends(ErrorExceptionStrategy, _super);
    function ErrorExceptionStrategy(messagerService, languageService) {
        var _this = _super.call(this, messagerService, languageService) || this;
        _this.langService = null;
        _this.langService = languageService;
        if (!_this.langService) {
            _this.langService = new LanguageService();
        }
        return _this;
    }
    ErrorExceptionStrategy.prototype.handleException = function (error) {
        if (!error) {
            return;
        }
        this.handleErrorLevel(error);
    };
    ErrorExceptionStrategy.prototype.handleErrorLevel = function (error) {
        var _this = this;
        var exceptionMsg = error.Message || '';
        var date = error.date || new Date();
        var localDate = moment(date).format('YYYY-MM-DD HH:mm:ss');
        var detail = error.Detail || error.Message + "\r\n\u53D1\u751F\u65F6\u95F4\uFF1A" + localDate + "\r\n\u8BE6\u7EC6\u4FE1\u606F\uFF1A" + error.innerMessage || '';
        var innerMessage = error.innerMessage || null;
        var bsModalRef;
        var options = {
            // title: this.languageService.serverNotifyTitle,
            showMaxButton: false,
            buttons: [
                {
                    text: this.langService.roger,
                    cls: 'btn btn-primary btn-lg',
                    handle: function () {
                        bsModalRef.close();
                    }
                }
            ],
            // showHeader: false,
            width: 440,
            height: 200,
            safeHtml: false,
            exception: {
                date: localDate,
                message: innerMessage,
                copyButton: {
                    text: this.langService.copy,
                    onClick: function (e) {
                        var result = DeviceAbility.copyToClipboard(detail);
                        var text = result ? _this.langService.copySuccess : _this.langService.copyFailed;
                        bsModalRef.content.showMiniNotify(text, 1500);
                    }
                }
            }
        };
        this.displayError(error);
        bsModalRef = this.messagerService.show('exception', exceptionMsg, options);
    };
    /**
     * 在控制台中显示错误信息
     */
    ErrorExceptionStrategy.prototype.displayError = function (error) {
        if (!error) {
            return;
        }
        if (!console || !console.error) {
            return;
        }
        console.error(error);
    };
    /** @nocollapse */
    ErrorExceptionStrategy.ctorParameters = function () { return [
        { type: MessagerService },
        { type: LanguageService, decorators: [{ type: Optional }] }
    ]; };
    return ErrorExceptionStrategy;
}(ExceptionStrategy));
export { ErrorExceptionStrategy };
/**
 * 致命错误级别异常处理
 */
var FatalExceptionStrategy = /** @class */ (function (_super) {
    tslib_1.__extends(FatalExceptionStrategy, _super);
    function FatalExceptionStrategy(messagerService, languageService) {
        return _super.call(this, messagerService, languageService) || this;
    }
    FatalExceptionStrategy.prototype.handleException = function (error) {
        if (!error) {
            return;
        }
        this.messagerService.error(error.Message);
    };
    /** @nocollapse */
    FatalExceptionStrategy.ctorParameters = function () { return [
        { type: MessagerService },
        { type: LanguageService, decorators: [{ type: Optional }] }
    ]; };
    return FatalExceptionStrategy;
}(ExceptionStrategy));
export { FatalExceptionStrategy };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXhjZXB0aW9uX3N0cmF0ZWd5LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9jb21tYW5kLXNlcnZpY2VzLyIsInNvdXJjZXMiOlsibGliL2Vycm9yL2V4Y2VwdGlvbl9zdHJhdGVneS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQ0EsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN6QyxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDdEQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBRXJELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUl2RCxPQUFPLE1BQU0sTUFBTSxRQUFRLENBQUM7QUFTNUI7O0dBRUc7QUFDSDtJQUNFLDJCQUNTLGVBQWdDLEVBQ3BCLGVBQWdDO1FBRDVDLG9CQUFlLEdBQWYsZUFBZSxDQUFpQjtRQUNwQixvQkFBZSxHQUFmLGVBQWUsQ0FBaUI7SUFDckQsQ0FBQzs7O2dCQXZCTSxlQUFlO2dCQUNmLGVBQWUsdUJBcUJuQixRQUFROztJQUViLHdCQUFDO0NBQUEsQUFMRCxJQUtDO1NBTFksaUJBQWlCO0FBTzlCOztHQUVHO0FBQ0g7SUFBMkMsaURBQWlCO0lBQzFELCtCQUNFLGVBQWdDLEVBQ3BCLGVBQWdDO2VBQzVDLGtCQUFNLGVBQWUsRUFBRSxlQUFlLENBQUM7SUFDekMsQ0FBQztJQUVNLCtDQUFlLEdBQXRCLFVBQXVCLEtBQTRCO1FBQ2pELElBQUksQ0FBQyxLQUFLLEVBQUU7WUFDVixPQUFPO1NBQ1I7UUFFRCxJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDM0MsQ0FBQzs7O2dCQTFDTSxlQUFlO2dCQUNmLGVBQWUsdUJBK0JuQixRQUFROztJQVdiLDRCQUFDO0NBQUEsQUFkRCxDQUEyQyxpQkFBaUIsR0FjM0Q7U0FkWSxxQkFBcUI7QUFpQmxDOztHQUVHO0FB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QUFDO1FBQ0YsSUFBSSxDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUN6QixVQUFVLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFLFlBQVksRUFBRSxPQUFPLENBQUMsQ0FBQztJQUM3RSxDQUFDO0lBQ0Q7O09BRUc7SUFDSyw2Q0FBWSxHQUFwQixVQUFxQixLQUE0QjtRQUMvQyxJQUFJLENBQUMsS0FBSyxFQUFFO1lBQ1YsT0FBTztTQUNSO1FBQ0QsSUFBSSxDQUFDLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUU7WUFDOUIsT0FBTztTQUNSO1FBQ0QsT0FBTyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUN2QixDQUFDOzs7Z0JBN0lNLGVBQWU7Z0JBQ2YsZUFBZSx1QkF3RW5CLFFBQVE7O0lBcUViLDZCQUFDO0NBQUEsQUF6RUQsQ0FBNEMsaUJBQWlCLEdBeUU1RDtTQXpFWSxzQkFBc0I7QUEyRW5DOztHQUVHO0FBQ0g7SUFBNEMsa0RBQWlCO0lBQzNELGdDQUNFLGVBQWdDLEVBQ3BCLGVBQWdDO2VBQzVDLGtCQUFNLGVBQWUsRUFBRSxlQUFlLENBQUM7SUFDekMsQ0FBQztJQUVNLGdEQUFlLEdBQXRCLFVBQXVCLEtBQTRCO1FBQ2pELElBQUksQ0FBQyxLQUFLLEVBQUU7WUFDVixPQUFPO1NBQ1I7UUFFRCxJQUFJLENBQUMsZUFBZSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDNUMsQ0FBQzs7O2dCQWhLTSxlQUFlO2dCQUNmLGVBQWUsdUJBcUpuQixRQUFROztJQVdiLDZCQUFDO0NBQUEsQUFkRCxDQUE0QyxpQkFBaUIsR0FjNUQ7U0FkWSxzQkFBc0IiLCJzb3VyY2VzQ29udGVudCI6WyJcbmltcG9ydCB7IE9wdGlvbmFsIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBNZXNzYWdlclNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW1lc3NhZ2VyJztcbmltcG9ydCB7IExhbmd1YWdlU2VydmljZSB9IGZyb20gJy4uL2xhbmd1YWcuc2VydmljZSc7XG5pbXBvcnQgeyBTZXJ2ZXJFeGNlcHRpb25FbnRpdHkgfSBmcm9tICcuL3R5cGVzJztcbmltcG9ydCB7IERldmljZUFiaWxpdHkgfSBmcm9tICcuLi91dGlsL2RldmljZS1hYmlsaXR5JztcbmltcG9ydCB7IEJzTW9kYWxSZWYgfSBmcm9tICdAZmFycmlzL3VpLW1vZGFsJztcbmltcG9ydCB7IEZvcm1Ob3RpZnlTZXJ2aWNlIH0gZnJvbSAnLi4vZm9ybS1ub3RpZnkuc2VydmljZSc7XG5pbXBvcnQgeyBGcmFtZUNvbnRleHQgfSBmcm9tICdAZmFycmlzL2RldmtpdCc7XG5pbXBvcnQgbW9tZW50IGZyb20gJ21vbWVudCc7XG4vKipcbiAqIOW8guW4uOWkhOeQhuaOpeWPo1xuICovXG5leHBvcnQgaW50ZXJmYWNlIElFeGNlcHRpb25TdHJhdGVneSB7XG4gIGhhbmRsZUV4Y2VwdGlvbihlcnJvcjogU2VydmVyRXhjZXB0aW9uRW50aXR5KTogdm9pZDtcbn1cblxuXG4vKipcbiAqIOW8guW4uOWkhOeQhuWfuuexu1xuICovXG5leHBvcnQgY2xhc3MgRXhjZXB0aW9uU3RyYXRlZ3kge1xuICBjb25zdHJ1Y3RvcihcbiAgICBwdWJsaWMgbWVzc2FnZXJTZXJ2aWNlOiBNZXNzYWdlclNlcnZpY2UsXG4gICAgQE9wdGlvbmFsKCkgcHVibGljIGxhbmd1YWdlU2VydmljZTogTGFuZ3VhZ2VTZXJ2aWNlKSB7XG4gIH1cbn1cblxuLyoqXG4gKiDkv6Hmga/nuqfliKvlvILluLjlpITnkIZcbiAqL1xuZXhwb3J0IGNsYXNzIEluZm9FeGNlcHRpb25TdHJhdGVneSBleHRlbmRzIEV4Y2VwdGlvblN0cmF0ZWd5IGltcGxlbWVudHMgSUV4Y2VwdGlvblN0cmF0ZWd5IHtcbiAgY29uc3RydWN0b3IoXG4gICAgbWVzc2FnZXJTZXJ2aWNlOiBNZXNzYWdlclNlcnZpY2UsXG4gICAgQE9wdGlvbmFsKCkgbGFuZ3VhZ2VTZXJ2aWNlOiBMYW5ndWFnZVNlcnZpY2UpIHtcbiAgICBzdXBlcihtZXNzYWdlclNlcnZpY2UsIGxhbmd1YWdlU2VydmljZSk7XG4gIH1cblxuICBwdWJsaWMgaGFuZGxlRXhjZXB0aW9uKGVycm9yOiBTZXJ2ZXJFeGNlcHRpb25FbnRpdHkpOiB2b2lkIHtcbiAgICBpZiAoIWVycm9yKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5tZXNzYWdlclNlcnZpY2UuaW5mbyhlcnJvci5NZXNzYWdlKTtcbiAgfVxufVxuXG5cbi8qKlxuICog6K2m5ZGK57qn5Yir5byC5bi45aSE55CGXG4gKi9cbmV4cG9ydCBjbGFzcyBXYXJuaW5nRXhjZXB0aW9uU3RyYXRlZ3kgZXh0ZW5kcyBFeGNlcHRpb25TdHJhdGVneSBpbXBsZW1lbnRzIElFeGNlcHRpb25TdHJhdGVneSB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIG1lc3NhZ2VyU2VydmljZTogTWVzc2FnZXJTZXJ2aWNlLFxuICAgIEBPcHRpb25hbCgpIGxhbmd1YWdlU2VydmljZTogTGFuZ3VhZ2VTZXJ2aWNlKSB7XG4gICAgc3VwZXIobWVzc2FnZXJTZXJ2aWNlLCBsYW5ndWFnZVNlcnZpY2UpO1xuICB9XG5cbiAgcHVibGljIGhhbmRsZUV4Y2VwdGlvbihlcnJvcjogU2VydmVyRXhjZXB0aW9uRW50aXR5KTogdm9pZCB7XG4gICAgaWYgKCFlcnJvcikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMubWVzc2FnZXJTZXJ2aWNlLndhcm5pbmcoZXJyb3IuTWVzc2FnZSk7XG4gIH1cbn1cblxuXG4vKipcbiAqIOmUmeivr+e6p+WIq+W8guW4uOWkhOeQhlxuICovXG5leHBvcnQgY2xhc3MgRXJyb3JFeGNlcHRpb25TdHJhdGVneSBleHRlbmRzIEV4Y2VwdGlvblN0cmF0ZWd5IGltcGxlbWVudHMgSUV4Y2VwdGlvblN0cmF0ZWd5IHtcbiAgcHJpdmF0ZSBsYW5nU2VydmljZTogTGFuZ3VhZ2VTZXJ2aWNlID0gbnVsbDtcbiAgY29uc3RydWN0b3IoXG4gICAgbWVzc2FnZXJTZXJ2aWNlOiBNZXNzYWdlclNlcnZpY2UsXG4gICAgQE9wdGlvbmFsKCkgbGFuZ3VhZ2VTZXJ2aWNlOiBMYW5ndWFnZVNlcnZpY2UpIHtcbiAgICBzdXBlcihtZXNzYWdlclNlcnZpY2UsIGxhbmd1YWdlU2VydmljZSk7XG4gICAgdGhpcy5sYW5nU2VydmljZSA9IGxhbmd1YWdlU2VydmljZTtcbiAgICBpZiAoIXRoaXMubGFuZ1NlcnZpY2UpIHtcbiAgICAgIHRoaXMubGFuZ1NlcnZpY2UgPSBuZXcgTGFuZ3VhZ2VTZXJ2aWNlKCk7XG4gICAgfVxuXG4gIH1cblxuICBwdWJsaWMgaGFuZGxlRXhjZXB0aW9uKGVycm9yOiBTZXJ2ZXJFeGNlcHRpb25FbnRpdHkpOiB2b2lkIHtcbiAgICBpZiAoIWVycm9yKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5oYW5kbGVFcnJvckxldmVsKGVycm9yKTtcbiAgfVxuXG4gIHByaXZhdGUgaGFuZGxlRXJyb3JMZXZlbChlcnJvcjogU2VydmVyRXhjZXB0aW9uRW50aXR5KTogdm9pZCB7XG4gICAgY29uc3QgZXhjZXB0aW9uTXNnID0gZXJyb3IuTWVzc2FnZSB8fCAnJztcbiAgICBjb25zdCBkYXRlID0gZXJyb3IuZGF0ZSB8fCBuZXcgRGF0ZSgpO1xuICAgIGNvbnN0IGxvY2FsRGF0ZSA9IG1vbWVudChkYXRlKS5mb3JtYXQoJ1lZWVktTU0tREQgSEg6bW06c3MnKTtcbiAgICBjb25zdCBkZXRhaWwgPSBlcnJvci5EZXRhaWwgfHwgYCR7ZXJyb3IuTWVzc2FnZX1cXHJcXG7lj5HnlJ/ml7bpl7TvvJoke2xvY2FsRGF0ZX1cXHJcXG7or6bnu4bkv6Hmga/vvJoke2Vycm9yLmlubmVyTWVzc2FnZX1gIHx8ICcnO1xuXG4gICAgY29uc3QgaW5uZXJNZXNzYWdlID0gZXJyb3IuaW5uZXJNZXNzYWdlIHx8IG51bGw7XG4gICAgbGV0IGJzTW9kYWxSZWY6IEJzTW9kYWxSZWY7XG4gICAgY29uc3Qgb3B0aW9ucyA9IHtcbiAgICAgIC8vIHRpdGxlOiB0aGlzLmxhbmd1YWdlU2VydmljZS5zZXJ2ZXJOb3RpZnlUaXRsZSxcbiAgICAgIHNob3dNYXhCdXR0b246IGZhbHNlLFxuICAgICAgYnV0dG9uczogW1xuICAgICAgICB7XG4gICAgICAgICAgdGV4dDogdGhpcy5sYW5nU2VydmljZS5yb2dlcixcbiAgICAgICAgICBjbHM6ICdidG4gYnRuLXByaW1hcnkgYnRuLWxnJyxcbiAgICAgICAgICBoYW5kbGU6ICgpID0+IHtcbiAgICAgICAgICAgIGJzTW9kYWxSZWYuY2xvc2UoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIF0sXG4gICAgICAvLyBzaG93SGVhZGVyOiBmYWxzZSxcbiAgICAgIHdpZHRoOiA0NDAsXG4gICAgICBoZWlnaHQ6IDIwMCxcbiAgICAgIHNhZmVIdG1sOiBmYWxzZSxcbiAgICAgIGV4Y2VwdGlvbjoge1xuICAgICAgICBkYXRlOiBsb2NhbERhdGUsXG4gICAgICAgIG1lc3NhZ2U6IGlubmVyTWVzc2FnZSxcbiAgICAgICAgY29weUJ1dHRvbjoge1xuICAgICAgICAgIHRleHQ6IHRoaXMubGFuZ1NlcnZpY2UuY29weSxcbiAgICAgICAgICBvbkNsaWNrOiAoZSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gRGV2aWNlQWJpbGl0eS5jb3B5VG9DbGlwYm9hcmQoZGV0YWlsKTtcbiAgICAgICAgICAgIGNvbnN0IHRleHQgPSByZXN1bHQgPyB0aGlzLmxhbmdTZXJ2aWNlLmNvcHlTdWNjZXNzIDogdGhpcy5sYW5nU2VydmljZS5jb3B5RmFpbGVkO1xuICAgICAgICAgICAgYnNNb2RhbFJlZi5jb250ZW50LnNob3dNaW5pTm90aWZ5KHRleHQsIDE1MDApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG4gICAgdGhpcy5kaXNwbGF5RXJyb3IoZXJyb3IpO1xuICAgIGJzTW9kYWxSZWYgPSB0aGlzLm1lc3NhZ2VyU2VydmljZS5zaG93KCdleGNlcHRpb24nLCBleGNlcHRpb25Nc2csIG9wdGlvbnMpO1xuICB9XG4gIC8qKlxuICAgKiDlnKjmjqfliLblj7DkuK3mmL7npLrplJnor6/kv6Hmga9cbiAgICovXG4gIHByaXZhdGUgZGlzcGxheUVycm9yKGVycm9yOiBTZXJ2ZXJFeGNlcHRpb25FbnRpdHkpIHtcbiAgICBpZiAoIWVycm9yKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICghY29uc29sZSB8fCAhY29uc29sZS5lcnJvcikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgfVxufVxuXG4vKipcbiAqIOiHtOWRvemUmeivr+e6p+WIq+W8guW4uOWkhOeQhlxuICovXG5leHBvcnQgY2xhc3MgRmF0YWxFeGNlcHRpb25TdHJhdGVneSBleHRlbmRzIEV4Y2VwdGlvblN0cmF0ZWd5IGltcGxlbWVudHMgSUV4Y2VwdGlvblN0cmF0ZWd5IHtcbiAgY29uc3RydWN0b3IoXG4gICAgbWVzc2FnZXJTZXJ2aWNlOiBNZXNzYWdlclNlcnZpY2UsXG4gICAgQE9wdGlvbmFsKCkgbGFuZ3VhZ2VTZXJ2aWNlOiBMYW5ndWFnZVNlcnZpY2UpIHtcbiAgICBzdXBlcihtZXNzYWdlclNlcnZpY2UsIGxhbmd1YWdlU2VydmljZSk7XG4gIH1cblxuICBwdWJsaWMgaGFuZGxlRXhjZXB0aW9uKGVycm9yOiBTZXJ2ZXJFeGNlcHRpb25FbnRpdHkpOiB2b2lkIHtcbiAgICBpZiAoIWVycm9yKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5tZXNzYWdlclNlcnZpY2UuZXJyb3IoZXJyb3IuTWVzc2FnZSk7XG4gIH1cbn1cbiJdfQ==