/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { map, switchMap } from 'rxjs/operators';
import { forkJoin, of, timer } from 'rxjs';
import { Injectable, Injector, InjectionToken, ComponentFactoryResolver, ApplicationRef } from '@angular/core';
import { BsModalService } from '@farris/ui-modal';
import { MessagerService } from '@farris/ui-messager';
import { DatagridSettingsComponent } from './datagrid-settings.component';
import { cloneDeep } from 'lodash-es';
import { LocaleService } from '@farris/ui-locale';
import { IdService } from '@farris/ui-common';
import { SimpleColumnsComponent } from './simple-mode/simple-columns.component';
import { DatagridSchemeService } from './datagrid-scheme.service';
import { NewSchemeComponent } from './scheme/newscheme.component';
import { SchemeListComponent } from './scheme/scheme-list.component';
import { NotifyService } from '@farris/ui-notify';
/** @type {?} */
export var GRID_SETTINGS_WEBAPI = new InjectionToken(' Farris DataGrid User Setting WebApi URI.');
var DatagridSettingsService = /** @class */ (function () {
    function DatagridSettingsService(injector, modalSer, messager, idService, localeSer) {
        this.injector = injector;
        this.modalSer = modalSer;
        this.messager = messager;
        this.idService = idService;
        this.localeSer = localeSer;
        this.multiSortMsg = '列表中未开启多列排序的功能。 请检查！';
        this.columnsSortableMsg = '未开启列的排序功能。请检查！';
        this.notSupportHeaderGroupMsg = '暂不支持多表头设置';
        this.notShowDialog = '多表头暂不支持列显示设置；同时未启用列排序功能。';
        this._httpRestService = null;
        this.languages = [];
        this.gridRefs = null;
        this.activeSchemeItem = null;
        this.saving = false;
        this.cfr = null;
        this.app = null;
        this.schemeListSubscription = null;
        this.cfr = this.injector.get(ComponentFactoryResolver);
        this.app = this.injector.get(ApplicationRef);
        this.notifyService = this.injector.get(NotifyService, null);
        this.schemeService = new DatagridSchemeService();
    }
    Object.defineProperty(DatagridSettingsService.prototype, "httpRestService", {
        get: /**
         * @return {?}
         */
        function () {
            return this._httpRestService;
        },
        set: /**
         * @param {?} httpSer
         * @return {?}
         */
        function (httpSer) {
            this._httpRestService = httpSer;
            if (this.schemeService) {
                this.schemeService.setRestService(httpSer);
            }
        },
        enumerable: true,
        configurable: true
    });
    ;
    /**
     * @param {?=} id
     * @return {?}
     */
    DatagridSettingsService.prototype.destroy = /**
     * @param {?=} id
     * @return {?}
     */
    function (id) {
        if (id && this.gridRefs && this.gridRefs[id]) {
            delete this.gridRefs[id];
        }
        else {
            this.gridRefs = null;
        }
        this.saving = false;
        this.setActiveSchemeItem(id, null);
    };
    /**
     * @param {?} dg
     * @return {?}
     */
    DatagridSettingsService.prototype.registerGridInstance = /**
     * @param {?} dg
     * @return {?}
     */
    function (dg) {
        if (!dg) {
            console.log('DatagridSettingService: grid instance is null.');
            return;
        }
        /** @type {?} */
        var id = dg.id;
        this.gridRefs = this.gridRefs || {};
        if (!this.gridRefs[id]) {
            this.gridRefs[id] = dg;
        }
    };
    /**
     * @param {?} dgID
     * @return {?}
     */
    DatagridSettingsService.prototype.getGridInstance = /**
     * @param {?} dgID
     * @return {?}
     */
    function (dgID) {
        return this.gridRefs ? this.gridRefs[dgID] : null;
    };
    /** 更新方案中的配置数据 */
    /**
     * 更新方案中的配置数据
     * @private
     * @param {?} schemeItem
     * @param {?} settings
     * @return {?}
     */
    DatagridSettingsService.prototype.updateSchemeSettings = /**
     * 更新方案中的配置数据
     * @private
     * @param {?} schemeItem
     * @param {?} settings
     * @return {?}
     */
    function (schemeItem, settings) {
        if (schemeItem && settings) {
            /** @type {?} */
            var schemeContentObj = JSON.parse(schemeItem.queryConditionString);
            if (schemeContentObj) {
                if (schemeContentObj[this.localeSer.localeId]) {
                    /** @type {?} */
                    var schemeSettings = schemeContentObj[this.localeSer.localeId];
                    schemeContentObj[this.localeSer.localeId] = Object.assign(schemeSettings, settings);
                }
                else {
                    schemeContentObj[this.localeSer.localeId] = settings;
                }
                schemeItem.queryConditionString = JSON.stringify(schemeContentObj);
            }
        }
    };
    /** 更新当前方案配置数据 */
    /**
     * 更新当前方案配置数据
     * @param {?} dgId
     * @param {?} settings
     * @return {?}
     */
    DatagridSettingsService.prototype.updateActiveSchemeItemSettings = /**
     * 更新当前方案配置数据
     * @param {?} dgId
     * @param {?} settings
     * @return {?}
     */
    function (dgId, settings) {
        /** @type {?} */
        var schemeItem = this.getActiveSchemeItem(dgId);
        this.updateSchemeSettings(schemeItem, settings);
    };
    /** 设置活动的方案 */
    /**
     * 设置活动的方案
     * @param {?} dgId
     * @param {?} activeItem
     * @return {?}
     */
    DatagridSettingsService.prototype.setActiveSchemeItem = /**
     * 设置活动的方案
     * @param {?} dgId
     * @param {?} activeItem
     * @return {?}
     */
    function (dgId, activeItem) {
        /** @type {?} */
        var schemekey = this.schemeService.getSchemeKey(dgId);
        this.activeSchemeItem = this.activeSchemeItem || {};
        this.activeSchemeItem[schemekey] = activeItem;
    };
    /** 获取当前活动的方案 */
    /**
     * 获取当前活动的方案
     * @param {?} dgId
     * @return {?}
     */
    DatagridSettingsService.prototype.getActiveSchemeItem = /**
     * 获取当前活动的方案
     * @param {?} dgId
     * @return {?}
     */
    function (dgId) {
        /** @type {?} */
        var schemekey = this.schemeService.getSchemeKey(dgId);
        return this.activeSchemeItem ? this.activeSchemeItem[schemekey] : null;
    };
    /**
     * @return {?}
     */
    DatagridSettingsService.prototype.getSearchTypes = /**
     * @return {?}
     */
    function () {
        return [
            { value: 'all', title: this.localeSer.getValue('datagrid.settings.allColumns') },
            { value: 'visible', title: this.localeSer.getValue('datagrid.settings.visibleColumns') },
            { value: 'hidden', title: this.localeSer.getValue('datagrid.settings.hiddenColumns') }
        ];
    };
    /**
     * @param {?} gridInstance
     * @param {?=} settings
     * @param {?=} selectedSchemeItem
     * @return {?}
     */
    DatagridSettingsService.prototype.showSimple = /**
     * @param {?} gridInstance
     * @param {?=} settings
     * @param {?=} selectedSchemeItem
     * @return {?}
     */
    function (gridInstance, settings, selectedSchemeItem) {
        var _this = this;
        /** @type {?} */
        var columns = this.convertColumnsToSimple(gridInstance.columns);
        columns[0] = columns[0].filter((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n.field && n.field !== gridInstance.ControlPanelFeild; }));
        /** @type {?} */
        var searchTypes = this.getSearchTypes();
        if (this.cfr) {
            /** @type {?} */
            var cmpFactory = this.cfr.resolveComponentFactory(SimpleColumnsComponent);
            /** @type {?} */
            var simpleRef_1 = cmpFactory.create(this.injector);
            this.app.attachView(simpleRef_1.hostView);
            simpleRef_1.instance.columns = columns;
            simpleRef_1.instance.seartTypes = searchTypes;
            simpleRef_1.instance.gridInstance = gridInstance;
            if (document.querySelector('#page-wrapper')) {
                simpleRef_1.instance.top = 76;
            }
            simpleRef_1.instance.enableScheme = gridInstance.enableScheme;
            if (gridInstance.enableScheme) {
                if (settings) {
                    if (selectedSchemeItem) {
                        this.updateSchemeSettings(selectedSchemeItem, settings);
                        simpleRef_1.instance.currentSchemeItem = selectedSchemeItem;
                    }
                    else {
                        simpleRef_1.instance.currentSchemeItem = null;
                        simpleRef_1.instance.settings = settings;
                    }
                }
                else {
                    /** @type {?} */
                    var _currentSchemtItem = this.getActiveSchemeItem(gridInstance.id);
                    simpleRef_1.instance.currentSchemeItem = _currentSchemtItem;
                }
            }
            document.body.appendChild(simpleRef_1.location.nativeElement);
            simpleRef_1.instance.closed.pipe(switchMap((/**
             * @return {?}
             */
            function () {
                simpleRef_1.instance.container.nativeElement.style.right = '-500px';
                return timer(500);
            }))).subscribe((/**
             * @return {?}
             */
            function () {
                simpleRef_1.location.nativeElement.remove();
                simpleRef_1.destroy();
                simpleRef_1 = null;
                if (_this.schemeListSubscription) {
                    _this.schemeListSubscription.unsubscribe();
                }
            }));
            simpleRef_1.instance.advanced.subscribe((/**
             * @param {?} __0
             * @return {?}
             */
            function (_a) {
                var viewFields = _a.viewFields;
                if (viewFields && viewFields.length) {
                    _this.updateSchemeSettings(simpleRef_1.instance.currentSchemeItem, { viewColumns: viewFields });
                }
                _this.showAdvanced(gridInstance, null, simpleRef_1.instance.currentSchemeItem);
            }));
            simpleRef_1.instance.submit.subscribe((/**
             * @param {?} e
             * @return {?}
             */
            function (e) {
                e.target.disabled = true;
                if (_this.saving) {
                    return;
                }
                if (!_this.saving) {
                    if (e.currentScheme) {
                        _this.setActiveSchemeItem(gridInstance.id, e.currentScheme);
                    }
                    _this.updateGridView(e, gridInstance, e.target);
                }
            }));
            simpleRef_1.instance.fieldsChange.subscribe((/**
             * @param {?} visibleFields
             * @return {?}
             */
            function (visibleFields) {
                _this.updateActiveSchemeItemSettings(gridInstance.id, { viewColumns: visibleFields });
            }));
            // 打开新增方案窗口
            simpleRef_1.instance.addNewScheme.subscribe((/**
             * @return {?}
             */
            function () {
                _this.showNewSchemeDialog(gridInstance, simpleRef_1);
            }));
            simpleRef_1.instance.schemeList = this.schemeService.getStateValue(gridInstance.id, 'list') || [];
            // 打开方案管理列表窗口
            simpleRef_1.instance.showSchemeList.subscribe((/**
             * @return {?}
             */
            function () {
                _this.schemeService.getSchemeList(gridInstance.id).pipe(switchMap((/**
                 * @param {?} t
                 * @return {?}
                 */
                function (t) {
                    return _this.schemeService.checkAuthority().pipe(map((/**
                     * @param {?} auth
                     * @return {?}
                     */
                    function (auth) {
                        return tslib_1.__assign({ list: t }, auth);
                    })));
                }))).subscribe((/**
                 * @param {?} t
                 * @return {?}
                 */
                function (t) {
                    _this.schemeService.setSchemeList(gridInstance.id, t.list || []);
                    _this.showSchemeListDialog(gridInstance, cloneDeep(t.list || []), t.success);
                }));
            }));
            this.schemeListSubscription = this.schemeService.schemeList$.subscribe((/**
             * @param {?} list
             * @return {?}
             */
            function (list) {
                simpleRef_1.instance.schemeList = list;
                if (!list || !list.length) {
                    _this.setActiveSchemeItem(gridInstance.id, null);
                    return;
                }
                /** @type {?} */
                var _activeSchemeItem = _this.getActiveSchemeItem(gridInstance.id);
                if (_activeSchemeItem) {
                    /** @type {?} */
                    var hasActiveItem = list.find((/**
                     * @param {?} n
                     * @return {?}
                     */
                    function (n) { return n.id === _activeSchemeItem.id; }));
                    if (!hasActiveItem) {
                        hasActiveItem = _this.getDefaultScheme(list); // 获取设置为当前方案的项
                        _this.setActiveSchemeItem(gridInstance.id, hasActiveItem || null);
                    }
                    simpleRef_1.instance.currentSchemeItem = hasActiveItem;
                }
            }));
            // 切换方案
            simpleRef_1.instance.activeItemChange.subscribe((/**
             * @param {?} r
             * @return {?}
             */
            function (r) {
                _this.setActiveSchemeItem(gridInstance.id, r);
            }));
            simpleRef_1.hostView.detectChanges();
            simpleRef_1.instance.container.nativeElement.style.right = '0px';
            return simpleRef_1;
        }
    };
    /**
     * @param {?} gridInstance
     * @param {?=} opts
     * @return {?}
     */
    DatagridSettingsService.prototype.show = /**
     * @param {?} gridInstance
     * @param {?=} opts
     * @return {?}
     */
    function (gridInstance, opts) {
        this.registerGridInstance(gridInstance);
        if (gridInstance.enableSimpleMode) {
            return this.showSimple(gridInstance);
        }
        else {
            return this.showAdvanced(gridInstance, opts);
        }
    };
    /**
     * @private
     * @param {?} gridInstance
     * @param {?=} opts
     * @param {?=} selectedSchemeItem
     * @return {?}
     */
    DatagridSettingsService.prototype.showAdvanced = /**
     * @private
     * @param {?} gridInstance
     * @param {?=} opts
     * @param {?=} selectedSchemeItem
     * @return {?}
     */
    function (gridInstance, opts, selectedSchemeItem) {
        var _this = this;
        /** @type {?} */
        var _editColSortInfo = true;
        /** @type {?} */
        var editColSortInfo = this.canSetColumnSort(gridInstance);
        if (editColSortInfo !== true) {
            // this.messager.warning(msg);
            // return;
            _editColSortInfo = false;
        }
        /** @type {?} */
        var showSetColumnsTab = !this.isHeaderGroup(gridInstance);
        /** @type {?} */
        var getActiveTabIndex = (/**
         * @return {?}
         */
        function () {
            if (showSetColumnsTab) {
                return 1;
            }
            else {
                if (_editColSortInfo) {
                    return 2;
                }
                else {
                    return -1;
                }
            }
        });
        /** @type {?} */
        var activeTabIndex = getActiveTabIndex();
        if (activeTabIndex === -1) {
            this.messager.warning(this.notShowDialog);
            return;
        }
        /** @type {?} */
        var columns = this.convertColumnsToSimple(gridInstance.columns);
        // 获取当前方案中当前语言的配置数据
        /** @type {?} */
        var currentSettings = null;
        if (selectedSchemeItem && selectedSchemeItem.queryConditionString) {
            currentSettings = JSON.parse(selectedSchemeItem.queryConditionString)[this.localeSer.localeId];
            if (currentSettings.columnFormat && currentSettings.columnFormat.length) {
                columns[0] = columns[0].map((/**
                 * @param {?} col
                 * @return {?}
                 */
                function (col) {
                    /** @type {?} */
                    var fcol = currentSettings.columnFormat.find((/**
                     * @param {?} n
                     * @return {?}
                     */
                    function (n) { return n.field === col.field; }));
                    if (fcol) {
                        col = Object.assign(col, fcol);
                    }
                    return col;
                }));
            }
        }
        columns[0] = columns[0].filter((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n.field && n.field !== gridInstance.ControlPanelFeild; }));
        /** @type {?} */
        var treeData = this.convertColumns2TreeData(cloneDeep(columns), true);
        /** @type {?} */
        var viewColumnsTreeData = this.convertColumns2TreeData(cloneDeep(columns), false);
        this.checkViewTreeNodes(viewColumnsTreeData);
        /** @type {?} */
        var modalRef = null;
        /** @type {?} */
        var okText = this.localeSer.getValue('datagrid.settings.ok') || '确定';
        /** @type {?} */
        var cancelText = this.localeSer.getValue('datagrid.settings.cancel') || '取消';
        /** @type {?} */
        var resetText = this.localeSer.getValue('datagrid.settings.reset') || '重置';
        /** @type {?} */
        var defaultOpts = {
            width: 760, height: 560, showHeader: false, title: '控制面板',
            initialState: {
                columns: columns,
                sortTreeData: treeData,
                viewTreeData: viewColumnsTreeData,
                gridInstance: gridInstance,
                canSetColumnSort: _editColSortInfo,
                canSetColumnVisible: showSetColumnsTab,
                activeTabIndex: activeTabIndex,
                schemeInfo: currentSettings
            },
            showButtons: false
        };
        /** @type {?} */
        var modalOpts = Object.assign(defaultOpts, opts || {});
        modalRef = this.modalSer.show(DatagridSettingsComponent, modalOpts);
        /** @type {?} */
        var instance = (/** @type {?} */ (modalRef.content));
        instance.enableReset = true;
        instance.modalRef = modalRef;
        instance.canSetColumnSort = _editColSortInfo;
        instance.canSetColumnVisible = !this.isHeaderGroup(gridInstance);
        instance.submitHandle.subscribe((/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            e.target.disabled = true;
            if (_this.saving) {
                return;
            }
            if (!_this.saving) {
                if (selectedSchemeItem) {
                    _this.setActiveSchemeItem(gridInstance.id, selectedSchemeItem);
                }
                _this.updateGridView(modalRef, gridInstance, e.target);
            }
        }));
        instance.cancelHandle.subscribe((/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            modalRef.close();
        }));
        // 切换到侧边栏简洁模式
        instance.concise.subscribe((/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            modalRef.close();
            /** @type {?} */
            var settings = modalRef.content;
            var sortInfo = settings.sortInfo, viewColumns = settings.viewColumns, columnFormat = settings.columnFormat, groupField = settings.groupField;
            _this.showSimple(gridInstance, { sortInfo: sortInfo, viewColumns: viewColumns, columnFormat: columnFormat, groupField: groupField }, selectedSchemeItem);
        }));
        /** @type {?} */
        var modalContainer = (/** @type {?} */ (modalRef.dialog.instance));
        modalContainer.draggbar.handle = instance.header.nativeElement;
        return modalRef;
    };
    /**
     * @private
     * @param {?} gridInstance
     * @return {?}
     */
    DatagridSettingsService.prototype.canSetColumnSort = /**
     * @private
     * @param {?} gridInstance
     * @return {?}
     */
    function (gridInstance) {
        if (gridInstance.multiSort && this.hasEnableSortColumns(gridInstance)) {
            return true;
        }
        else {
            if (!this.hasEnableSortColumns(gridInstance)) {
                return this.columnsSortableMsg;
            }
            else if (!gridInstance.multiSort) {
                return this.multiSortMsg;
            }
        }
    };
    /**
     * @private
     * @param {?} gridInstance
     * @return {?}
     */
    DatagridSettingsService.prototype.hasEnableSortColumns = /**
     * @private
     * @param {?} gridInstance
     * @return {?}
     */
    function (gridInstance) {
        /** @type {?} */
        var sortColumnsCount = gridInstance.flatColumns.reduce((/**
         * @param {?} c
         * @param {?} r
         * @return {?}
         */
        function (c, r) {
            if (r.sortable) {
                return c + 1;
            }
            return c;
        }), 0);
        return sortColumnsCount > 0;
    };
    /**
     * @private
     * @param {?} grid
     * @return {?}
     */
    DatagridSettingsService.prototype.isHeaderGroup = /**
     * @private
     * @param {?} grid
     * @return {?}
     */
    function (grid) {
        /** @type {?} */
        var flag = grid.columns.length > 1;
        if (flag) {
            return this.notSupportHeaderGroupMsg;
        }
        return flag;
    };
    /**
     * @private
     * @param {?} cols
     * @param {?} rowIndex
     * @param {?} colStartIndex
     * @param {?} colCount
     * @param {?=} forSort
     * @return {?}
     */
    DatagridSettingsService.prototype.getChilds = /**
     * @private
     * @param {?} cols
     * @param {?} rowIndex
     * @param {?} colStartIndex
     * @param {?} colCount
     * @param {?=} forSort
     * @return {?}
     */
    function (cols, rowIndex, colStartIndex, colCount, forSort) {
        var _this = this;
        if (forSort === void 0) { forSort = false; }
        /** @type {?} */
        var childCols = [];
        /** @type {?} */
        var _count = colStartIndex;
        if (!cols[rowIndex]) {
            return [];
        }
        cols[rowIndex].slice().forEach((/**
         * @param {?} element
         * @return {?}
         */
        function (element) {
            _count = _count + element.colspan;
            if (_count <= colCount) {
                childCols.push(element);
            }
        }));
        cols[rowIndex].splice(0, childCols.length);
        return childCols.map((/**
         * @param {?} c
         * @param {?} i
         * @return {?}
         */
        function (c, i) {
            /** @type {?} */
            var n = {
                data: c,
                selectable: forSort ? !!c.sortable : true
            };
            if (c.colspan && c.colspan > 1) {
                n = {
                    data: c,
                    selectable: false,
                    expanded: true,
                    children: _this.getChilds(cols, rowIndex + 1, 0, c.colspan)
                };
            }
            return n;
        }));
    };
    /**
     * @param {?} cols
     * @param {?=} forSort
     * @return {?}
     */
    DatagridSettingsService.prototype.convertColumns2TreeData = /**
     * @param {?} cols
     * @param {?=} forSort
     * @return {?}
     */
    function (cols, forSort) {
        var _this = this;
        if (forSort === void 0) { forSort = false; }
        /** @type {?} */
        var columns = cols.map((/**
         * @param {?} c
         * @return {?}
         */
        function (c) {
            c.map((/**
             * @param {?} _
             * @return {?}
             */
            function (_) {
                _.colspan = _.colspan || 1;
                return _;
            }));
            return c;
        }));
        if (columns.length === 1) {
            return columns[0].map((/**
             * @param {?} c
             * @return {?}
             */
            function (c) {
                return {
                    data: c,
                    selectable: forSort ? !!c.sortable : true
                };
            }));
        }
        else {
            return columns[0].map((/**
             * @param {?} c
             * @param {?} i
             * @return {?}
             */
            function (c, i) {
                if (c.colspan && c.colspan > 1) {
                    return {
                        data: c,
                        selectable: false,
                        expanded: true,
                        children: _this.getChilds(columns, 1, 0, c.colspan, forSort)
                    };
                }
                else {
                    return {
                        data: c,
                        selectable: forSort ? !!c.sortable : true
                    };
                }
            }));
        }
    };
    /**
     * @private
     * @param {?} treeNodes
     * @return {?}
     */
    DatagridSettingsService.prototype.checkViewTreeNodes = /**
     * @private
     * @param {?} treeNodes
     * @return {?}
     */
    function (treeNodes) {
        var _this = this;
        treeNodes.forEach((/**
         * @param {?} tn
         * @return {?}
         */
        function (tn) {
            if (!tn.children || !tn.children.length) {
                tn.selectable = true;
            }
            else {
                tn.selectable = false;
                _this.checkViewTreeNodes(tn.children);
            }
        }));
    };
    /**
     * @private
     * @param {?} cols
     * @return {?}
     */
    DatagridSettingsService.prototype.convertColumnsToSimple = /**
     * @private
     * @param {?} cols
     * @return {?}
     */
    function (cols) {
        // 移除设置列
        return cols.map((/**
         * @param {?} _cols
         * @return {?}
         */
        function (_cols) {
            return _cols.map((/**
             * @param {?} c
             * @return {?}
             */
            function (c) {
                if (c.field !== '_datagrid-setting-control_') {
                    return {
                        field: c.field,
                        title: c.title,
                        colspan: c.colspan,
                        rowspan: c.rowspan,
                        sortable: c.sortable,
                        order: c.order,
                        halign: c.halign || 'left',
                        align: c.align || 'left',
                        visible: c.visible,
                        allowGrouping: c.allowGrouping,
                        groupFooter: c.groupFooter,
                        footer: c.footer,
                        width: c.width || 100,
                        dataType: c.dataType || 'string'
                    };
                }
            })).filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n; }));
        }));
    };
    /**
     * @private
     * @param {?} gridInstance
     * @return {?}
     */
    DatagridSettingsService.prototype.resetGridView = /**
     * @private
     * @param {?} gridInstance
     * @return {?}
     */
    function (gridInstance) {
        if (!gridInstance) {
            return;
        }
        /** @type {?} */
        var dfs = gridInstance.dfs;
        if (dfs) {
            /** @type {?} */
            var options = dfs['_state'].initialOptions;
            if (options.sort) {
                if (options.sort.sortName) {
                    gridInstance.sortName = options.sort.sortName;
                }
                if (options.sort.sortOrder) {
                    gridInstance.sortOrder = options.sort.sortOrder;
                }
            }
            gridInstance.groupField = options.groupField || '';
            // TODO: 还需要修正默认列的显示顺序
            if (options.columnFields && options.columnFields.length) {
                /** @type {?} */
                var newColumns_1 = [];
                options.columnFields.forEach((/**
                 * @param {?} c
                 * @return {?}
                 */
                function (c) {
                    /** @type {?} */
                    var col = gridInstance.columns[0].find((/**
                     * @param {?} n
                     * @return {?}
                     */
                    function (n) { return n.field === c.field; }));
                    if (col) {
                        col.visible = c.visible;
                        col.halign = c.halign;
                        col.align = c.align;
                        col.width = c.width;
                        col.footer = c.footer;
                        col.groupFooter = c.groupFooter;
                        newColumns_1.push(col);
                    }
                }));
                gridInstance.columns[0] = newColumns_1;
            }
            // gridInstance['checkOptions']();
            gridInstance['columnsChanged']();
        }
    };
    /**
     * @private
     * @param {?} modalRef
     * @param {?} gridInstance
     * @param {?=} btn
     * @return {?}
     */
    DatagridSettingsService.prototype.updateGridView = /**
     * @private
     * @param {?} modalRef
     * @param {?} gridInstance
     * @param {?=} btn
     * @return {?}
     */
    function (modalRef, gridInstance, btn) {
        var _this = this;
        if (btn === void 0) { btn = null; }
        /** @type {?} */
        var settings = modalRef.content;
        if (settings) {
            var sortInfo_1 = settings.sortInfo, viewColumns_1 = settings.viewColumns, columnFormat_1 = settings.columnFormat, groupField = settings.groupField;
            this.updateActiveSchemeItemSettings(gridInstance.id, { sortInfo: sortInfo_1, viewColumns: viewColumns_1, columnFormat: columnFormat_1, groupField: groupField });
            this.saving = true;
            /** @type {?} */
            var _groupField = '';
            if (gridInstance.groupRows && groupField && groupField.length) {
                _groupField = groupField.join(',');
            }
            gridInstance.groupField = _groupField;
            /** @type {?} */
            var _colformats = columnFormat_1 ? this.convertColumnsToSimple([columnFormat_1])[0] : [];
            /** @type {?} */
            var saveData = { sortInfo: sortInfo_1, viewColumns: viewColumns_1, groupField: _groupField, columnFormat: _colformats };
            this.setUserConfig(gridInstance.id, saveData).subscribe((/**
             * @return {?}
             */
            function () {
                if (btn) {
                    btn.disabled = false;
                }
                _this.saving = false;
                if (viewColumns_1 && viewColumns_1.length) {
                    gridInstance.columns = gridInstance.columns.map((/**
                     * @param {?} cols
                     * @return {?}
                     */
                    function (cols) {
                        _this.updateColumnFormat(cols, columnFormat_1, gridInstance);
                        return _this.newVisibleOrderColumns(cols, viewColumns_1, columnFormat_1, gridInstance);
                    }));
                }
                gridInstance.columnsChanged(true);
                if (sortInfo_1 && Object.keys(sortInfo_1).length) {
                    var sortName = sortInfo_1.sortName, sortOrder = sortInfo_1.sortOrder;
                    if (sortName && sortName.length) {
                        gridInstance.sort(sortName.join(','), sortOrder.join(','));
                    }
                    else {
                        gridInstance.clearSort();
                    }
                }
                else {
                    gridInstance.clearSort();
                }
                modalRef.close();
            }));
        }
        else {
            modalRef.close();
        }
    };
    /**
     * @param {?} cols
     * @param {?} viewColumns
     * @param {?} columnFormat
     * @param {?} gridInstance
     * @return {?}
     */
    DatagridSettingsService.prototype.newVisibleOrderColumns = /**
     * @param {?} cols
     * @param {?} viewColumns
     * @param {?} columnFormat
     * @param {?} gridInstance
     * @return {?}
     */
    function (cols, viewColumns, columnFormat, gridInstance) {
        var _this = this;
        /** @type {?} */
        var hideColumns = [];
        cols.forEach((/**
         * @param {?} element
         * @param {?} index
         * @return {?}
         */
        function (element, index) {
            if (_this.isNewAddColumn(element.field, columnFormat) && element.field !== '_datagrid-setting-control_' && !gridInstance.enableScheme) {
                viewColumns.push(element.field);
            }
            else {
                element.visible = viewColumns.includes(element.field);
                if (!element.visible) {
                    hideColumns.push(element);
                }
            }
        }));
        // 清理不存在的列
        /** @type {?} */
        var newCols = viewColumns.map((/**
         * @param {?} field
         * @return {?}
         */
        function (field) {
            return cols.find((/**
             * @param {?} c
             * @return {?}
             */
            function (c) { return c.field === field; }));
        })).filter((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n; }));
        if (hideColumns.length) {
            newCols = newCols.concat(hideColumns);
        }
        return newCols.filter((/**
         * @param {?} c
         * @return {?}
         */
        function (c) { return c && c.field && c.field !== '_datagrid-setting-control_'; }));
    };
    /**
     * 是否为新增加的字段
     * 新增的字段，需要在列表中展示出来，并保存到个性化设置中
     */
    /**
     * 是否为新增加的字段
     * 新增的字段，需要在列表中展示出来，并保存到个性化设置中
     * @private
     * @param {?} field
     * @param {?} columns
     * @return {?}
     */
    DatagridSettingsService.prototype.isNewAddColumn = /**
     * 是否为新增加的字段
     * 新增的字段，需要在列表中展示出来，并保存到个性化设置中
     * @private
     * @param {?} field
     * @param {?} columns
     * @return {?}
     */
    function (field, columns) {
        columns = columns || [];
        return !columns.find((/**
         * @param {?} c
         * @return {?}
         */
        function (c) { return c.field === field; }));
    };
    /**
     * @param {?} cols
     * @param {?} columnFormat
     * @param {?} gridInstance
     * @return {?}
     */
    DatagridSettingsService.prototype.updateColumnFormat = /**
     * @param {?} cols
     * @param {?} columnFormat
     * @param {?} gridInstance
     * @return {?}
     */
    function (cols, columnFormat, gridInstance) {
        if (columnFormat && columnFormat.length) {
            cols.forEach((/**
             * @param {?} col
             * @return {?}
             */
            function (col) {
                /** @type {?} */
                var formatCol = columnFormat.find((/**
                 * @param {?} f
                 * @return {?}
                 */
                function (f) { return f.field === col.field; }));
                if (formatCol) {
                    col.width = formatCol.width;
                    col.halign = formatCol.halign || 'left';
                    col.align = formatCol.align || 'left';
                    if (gridInstance.groupRows && (col.allowGrouping || col.allowGrouping === undefined)) {
                        if (!col.groupFooter) {
                            col.groupFooter = formatCol.groupFooter;
                        }
                        if (col.groupFooter && col.groupFooter.options) {
                            col.groupFooter.options.text = formatCol.groupFooter.options.text || '';
                            col.groupFooter.options.calculationType =
                                formatCol.groupFooter.options.calculationType !== undefined &&
                                    formatCol.groupFooter.options.calculationType !== null ?
                                    parseInt(formatCol.groupFooter.options.calculationType, 10) : -1;
                        }
                    }
                    if (gridInstance.showFooter && !gridInstance.footerTemplate) {
                        if (!col.footer) {
                            col.footer = formatCol.footer;
                        }
                        if (col.footer && col.footer.options) {
                            col.footer.options.text = formatCol.footer.options.text || '';
                            col.footer.options.calculationType =
                                formatCol.footer.options.calculationType !== undefined &&
                                    formatCol.footer.options.calculationType !== null ?
                                    parseInt(formatCol.footer.options.calculationType, 10) : -1;
                        }
                    }
                }
            }));
        }
    };
    // 创建唯一key, 由uri + gridId 组成，并混淆
    // 创建唯一key, 由uri + gridId 组成，并混淆
    /**
     * @private
     * @param {?} gridId
     * @return {?}
     */
    DatagridSettingsService.prototype.createConfigKey = 
    // 创建唯一key, 由uri + gridId 组成，并混淆
    /**
     * @private
     * @param {?} gridId
     * @return {?}
     */
    function (gridId) {
        /** @type {?} */
        var grid = this.getGridInstance(gridId);
        if (grid) {
            return grid.dgs.createConfigKey(gridId);
        }
        else {
            console.log('DatagridSettingService: Can not find the grid instance.');
        }
    };
    /**
     * @private
     * @param {?} gridId
     * @return {?}
     */
    DatagridSettingsService.prototype.getCurrentUserSettings = /**
     * @private
     * @param {?} gridId
     * @return {?}
     */
    function (gridId) {
        /** @type {?} */
        var gridInstance = this.getGridInstance(gridId);
        /** @type {?} */
        var config = { sortInfo: {}, viewColumns: [], groupField: '', columnFormat: [] };
        if (gridInstance) {
            var sortName = gridInstance.sortName, sortOrder = gridInstance.sortOrder, columns = gridInstance.columns;
            if (sortName) {
                /** @type {?} */
                var sortInfo = {
                    sortName: sortName.split(','),
                    sortOrder: sortOrder.split(',')
                };
                config.sortInfo = sortInfo;
            }
            /** @type {?} */
            var viewColumns = columns[0].filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n.visible || n.visible === undefined; })).map((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n.field; }));
            config.viewColumns = viewColumns;
            config.columnFormat = this.convertColumnsToSimple(columns)[0];
            if (gridInstance.groupRows) {
                config.groupField = gridInstance.groupField;
            }
        }
        return config;
    };
    /**
     * @param {?} gridId
     * @return {?}
     */
    DatagridSettingsService.prototype.saveUserConfig = /**
     * @param {?} gridId
     * @return {?}
     */
    function (gridId) {
        /** @type {?} */
        var config = this.getCurrentUserSettings(gridId);
        return this.setUserConfig(gridId, config);
    };
    /**
     * @param {?} gridId
     * @param {?} config
     * @return {?}
     */
    DatagridSettingsService.prototype.setUserConfig = /**
     * @param {?} gridId
     * @param {?} config
     * @return {?}
     */
    function (gridId, config) {
        var _this = this;
        /** @type {?} */
        var key = this.createConfigKey(gridId);
        /** @type {?} */
        var LOCALEID = this.localeSer.localeId;
        /** @type {?} */
        var currentConfig = localStorage.getItem(key);
        /** @type {?} */
        var _config = (currentConfig ? JSON.parse(currentConfig) : {}) || {};
        if (config) {
            if (_config) {
                _config[LOCALEID] = config;
            }
            localStorage.setItem(key, JSON.stringify(_config));
        }
        else {
            localStorage.removeItem(key);
        }
        if (this.httpRestService) {
            /** @type {?} */
            var gridIns = this.getGridInstance(gridId);
            if (gridIns && gridIns.enableScheme) {
                /** @type {?} */
                var activeScheme_1 = this.getActiveSchemeItem(gridId);
                if (activeScheme_1) {
                    // return this.updateScheme(gridId, config);
                    if (activeScheme_1.type === 'private') {
                        return this.schemeService.saveScheme(activeScheme_1, gridId, true);
                    }
                    else {
                        return this.schemeService.checkAuthority().pipe(switchMap((/**
                         * @param {?} t
                         * @return {?}
                         */
                        function (t) {
                            if (t.success) {
                                /** @type {?} */
                                var hasOrgAuthority = t.authOrganizationData && t.authOrganizationData.length;
                                if (activeScheme_1.type === 'public' || (activeScheme_1.type === 'org' && hasOrgAuthority)) {
                                    return _this.schemeService.saveScheme(activeScheme_1, gridId, true);
                                }
                            }
                            return of(true);
                        })));
                    }
                }
                else {
                    return of(true);
                }
            }
            // 保存至数据库
            return this._saveUserConfig(key, config ? _config : '');
        }
        return of(true);
    };
    /**
     * @param {?} key
     * @return {?}
     */
    DatagridSettingsService.prototype.getUserConfig = /**
     * @param {?} key
     * @return {?}
     */
    function (key) {
        if (this.httpRestService) {
            return this._getUserConfig(key);
        }
        else {
            /** @type {?} */
            var config = localStorage.getItem(key);
            if (config) {
                /** @type {?} */
                var con = JSON.parse(config);
                if (con[this.localeSer.localeId]) {
                    return of(con[this.localeSer.localeId]);
                }
                else {
                    if (Object.keys(con).indexOf('viewColumns') > -1) {
                        return of(con);
                    }
                    return null;
                }
            }
            else {
                return of(null);
            }
        }
    };
    /**
     * @private
     * @param {?} schemeList
     * @return {?}
     */
    DatagridSettingsService.prototype.getDefaultScheme = /**
     * @private
     * @param {?} schemeList
     * @return {?}
     */
    function (schemeList) {
        // 1、有个人默认的返回个人默认方案
        // 2、没有个人默认方案的，返回公共方案第1个
        // 3、没有公共方案，返回组织方案第1个
        // 4、没有组织方案的, 返回个人方案第1个
        // 5、没有个人方案的，返回系统预制，即表单设计时的格式
        // 1、有个人默认的返回个人默认方案
        // 2、没有个人默认方案的，返回公共方案第1个
        // 3、没有公共方案，返回组织方案第1个
        // 4、没有组织方案的, 返回个人方案第1个
        // 5、没有个人方案的，返回系统预制，即表单设计时的格式
        /** @type {?} */
        var defaultScheme = null;
        if (!schemeList || !schemeList.length) {
            return defaultScheme;
        }
        else {
            defaultScheme = schemeList.find((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n.isDefault; }));
            if (!defaultScheme) {
                /** @type {?} */
                var publicSchemes = schemeList.filter((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return n.type === 'public'; }));
                if (!publicSchemes.length) {
                    publicSchemes = schemeList.filter((/**
                     * @param {?} n
                     * @return {?}
                     */
                    function (n) { return n.type === 'org'; }));
                }
                if (publicSchemes.length) {
                    defaultScheme = publicSchemes[0];
                }
                else {
                    defaultScheme = schemeList[0];
                }
            }
        }
        return defaultScheme;
    };
    /**
     * @param {?} gridId
     * @return {?}
     */
    DatagridSettingsService.prototype.getSettings = /**
     * @param {?} gridId
     * @return {?}
     */
    function (gridId) {
        var _this = this;
        /** @type {?} */
        var key = this.createConfigKey(gridId);
        /** @type {?} */
        var gridIns = this.getGridInstance(gridId);
        /** @type {?} */
        var schemeList$ = of([]);
        if (gridIns && gridIns.enableScheme) {
            schemeList$ = this.getSchemeList(gridId);
        }
        return forkJoin(schemeList$, this.getUserConfig(key), this.schemeService.getLanguages()).pipe(map((/**
         * @param {?} __0
         * @return {?}
         */
        function (_a) {
            var _b = tslib_1.__read(_a, 3), schemeList = _b[0], userSetting = _b[1], supportedLanguages = _b[2];
            schemeList = schemeList || [];
            _this.languages = supportedLanguages;
            if (!schemeList.length) {
                return userSetting;
            }
            else {
                // 缓存方案列表
                _this.setSchemeList(schemeList, gridId);
                // 查找默认方案
                /** @type {?} */
                var defaultScheme = _this.getDefaultScheme(schemeList);
                if (!defaultScheme) {
                    return userSetting;
                }
                else {
                    _this.setActiveSchemeItem(gridId, defaultScheme);
                    /** @type {?} */
                    var userSettings = JSON.parse(defaultScheme.queryConditionString);
                    if (userSettings) {
                        /** @type {?} */
                        var localeId = _this.localeSer.localeId;
                        if (userSettings[localeId]) {
                            localStorage.setItem(key, JSON.stringify(userSettings));
                            return userSettings[localeId];
                        }
                        else {
                            userSettings[localeId] = null;
                            localStorage.setItem(key, JSON.stringify(userSettings));
                            return null;
                        }
                    }
                    else {
                        return null;
                    }
                }
            }
        })));
    };
    /**
     * @private
     * @param {?} key
     * @param {?} config
     * @return {?}
     */
    DatagridSettingsService.prototype._saveUserConfig = /**
     * @private
     * @param {?} key
     * @param {?} config
     * @return {?}
     */
    function (key, config) {
        try {
            /** @type {?} */
            var userConfigSetting = {
                configkey1: key,
                configkey2: '',
                configkey3: '',
                textvalue: config ? JSON.stringify(config) : ''
            };
            return this.httpRestService.saveUserSettings(userConfigSetting);
        }
        catch (e) {
            console.error(e);
        }
    };
    /**
     * @param {?} gridInstance
     * @param {?} modalRef
     * @return {?}
     */
    DatagridSettingsService.prototype.resetUserConfig = /**
     * @param {?} gridInstance
     * @param {?} modalRef
     * @return {?}
     */
    function (gridInstance, modalRef) {
        var _this = this;
        /** @type {?} */
        var restorDefaultText = this.localeSer.getValue('datagrid.settings.restoreDefaultSettingsText') || '确认要恢复默认设置吗？';
        this.messager.confirm(restorDefaultText).pipe(switchMap((/**
         * @param {?} t
         * @return {?}
         */
        function (t) {
            if (t) {
                return _this.setUserConfig(gridInstance.id, '');
            }
            return of(t);
        }))).subscribe((/**
         * @param {?} t
         * @return {?}
         */
        function (t) {
            if (t) {
                _this.resetGridView(gridInstance);
                modalRef.close();
            }
        }));
    };
    /**
     * @private
     * @param {?} key
     * @return {?}
     */
    DatagridSettingsService.prototype._getUserConfig = /**
     * @private
     * @param {?} key
     * @return {?}
     */
    function (key) {
        var _this = this;
        try {
            return this.httpRestService.getUserSettings(key).pipe(map((/**
             * @param {?} ucs
             * @return {?}
             */
            function (ucs) {
                if (ucs && ucs.textValue) {
                    /** @type {?} */
                    var c = JSON.parse(ucs.textValue);
                    if (c) {
                        if (c[_this.localeSer.localeId]) {
                            localStorage.setItem(key, ucs.textValue);
                            return c[_this.localeSer.localeId];
                        }
                        else {
                            c[_this.localeSer.localeId] = null;
                            localStorage.setItem(key, JSON.stringify(c));
                            // if (Object.keys(c).indexOf('viewColumns') > -1) {
                            //     return c;
                            // }
                            return null;
                        }
                    }
                    return null;
                }
                return null;
            })));
        }
        catch (e) {
            console.error(e);
        }
    };
    /**
     * @private
     * @param {?} gridId
     * @param {?=} settings
     * @return {?}
     */
    DatagridSettingsService.prototype.buildSubmitData = /**
     * @private
     * @param {?} gridId
     * @param {?=} settings
     * @return {?}
     */
    function (gridId, settings) {
        if (settings === void 0) { settings = null; }
        /** @type {?} */
        var LOCALEID = this.localeSer.localeId;
        if (!settings) {
            settings = this.getCurrentUserSettings(gridId);
        }
        /** @type {?} */
        var localeKey = this.createConfigKey(gridId);
        /** @type {?} */
        var currentConfig = localStorage.getItem(localeKey);
        /** @type {?} */
        var _config = (currentConfig ? JSON.parse(currentConfig) : {}) || {};
        if (_config) {
            _config[LOCALEID] = settings;
        }
        return _config;
    };
    // ----------------------------------------------------------------------------------------------- \\
    // ----------------------------------------------------------------------------------------------- \\
    /**
     * @private
     * @param {?} gridInstance
     * @param {?} schemeList
     * @param {?=} canDel
     * @return {?}
     */
    DatagridSettingsService.prototype.showSchemeListDialog = 
    // ----------------------------------------------------------------------------------------------- \\
    /**
     * @private
     * @param {?} gridInstance
     * @param {?} schemeList
     * @param {?=} canDel
     * @return {?}
     */
    function (gridInstance, schemeList, canDel) {
        var _this = this;
        if (canDel === void 0) { canDel = true; }
        /** @type {?} */
        var modalOpts = {
            width: 760, height: 577, showHeader: false, title: '控制面板',
            initialState: {
                items: schemeList || [],
                removeItem: canDel
            },
            showButtons: false
        };
        /** @type {?} */
        var schemeListDlg = this.modalSer.show(SchemeListComponent, modalOpts);
        /** @type {?} */
        var instance = (/** @type {?} */ (schemeListDlg.content));
        instance.closeModal.subscribe((/**
         * @return {?}
         */
        function () {
            schemeListDlg.close();
        }));
        instance.submitModal.subscribe((/**
         * @param {?} t
         * @return {?}
         */
        function (t) {
            _this.schemeService.updateScheme(t, gridInstance.id).subscribe((/**
             * @param {?} e
             * @return {?}
             */
            function (e) {
                if (e === false) {
                    schemeListDlg.close();
                    return;
                }
                /** @type {?} */
                var msg = '列设置方案保存成功。';
                if (_this.notifyService) {
                    _this.notifyService.success(msg);
                }
                else {
                    _this.messager.success(msg);
                }
                /** @type {?} */
                var schemeList = _this.schemeService.getStateValue(gridInstance.id, 'list');
                if (t.defaultId) {
                    schemeList.forEach((/**
                     * @param {?} n
                     * @return {?}
                     */
                    function (n) {
                        n.isDefault = false;
                        if (n.id === t.defaultId) {
                            n.isDefault = true;
                            // this.setActiveSchemeItem(gridInstance.id, n);
                        }
                    }));
                }
                /** @type {?} */
                var newSchemeList = schemeList;
                if (t.deletedIds && t.deletedIds.length) {
                    newSchemeList = schemeList.filter((/**
                     * @param {?} n
                     * @return {?}
                     */
                    function (n) {
                        return !t.deletedIds.includes(n.id);
                    }));
                }
                _this.schemeService.setSchemeList(gridInstance.id, newSchemeList);
                schemeListDlg.close();
            }));
        }));
        /** @type {?} */
        var modalContainer = (/** @type {?} */ (schemeListDlg.dialog.instance));
        modalContainer.draggbar.handle = instance.header.nativeElement;
    };
    // 新增或另存方案
    // 新增或另存方案
    /**
     * @private
     * @param {?} gridInstance
     * @param {?} simpleRef
     * @return {?}
     */
    DatagridSettingsService.prototype.showNewSchemeDialog = 
    // 新增或另存方案
    /**
     * @private
     * @param {?} gridInstance
     * @param {?} simpleRef
     * @return {?}
     */
    function (gridInstance, simpleRef) {
        var _this = this;
        /** @type {?} */
        var modalOpts = {
            width: 480, height: 269, showHeader: false, title: '控制面板',
            initialState: {
                languages: this.languages
            },
            showButtons: false,
            resizable: false
        };
        /** @type {?} */
        var newSchemeDlg = this.modalSer.show(NewSchemeComponent, modalOpts);
        /** @type {?} */
        var instance = (/** @type {?} */ (newSchemeDlg.content));
        instance.closeModal.subscribe((/**
         * @return {?}
         */
        function () {
            newSchemeDlg.close();
        }));
        instance.submitModal.pipe(switchMap((/**
         * @param {?} t
         * @return {?}
         */
        function (t) {
            return _this.createNewScheme(gridInstance.id, t);
        }))).subscribe((/**
         * @param {?} t
         * @return {?}
         */
        function (t) {
            if (t.flag === false) {
                /** @type {?} */
                var msg = t.msg || '请输入方案名称';
                if (_this.notifyService) {
                    _this.notifyService.info(msg);
                }
                else {
                    _this.messager.info(msg);
                }
                return;
            }
            // 更新方案列表
            /** @type {?} */
            var schemeList = _this.schemeService.getStateValue(gridInstance.id, 'list') || [];
            if (t.isDefault) {
                schemeList.forEach((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) {
                    n.isDefault = false;
                }));
            }
            schemeList.push(t);
            _this.setActiveSchemeItem(gridInstance.id, t);
            _this.schemeService.setSchemeList(gridInstance.id, schemeList);
            newSchemeDlg.close();
        }));
        instance.checkAuthority.pipe(switchMap((/**
         * @param {?} t
         * @return {?}
         */
        function (t) {
            return _this.schemeService.checkAuthority().pipe(map((/**
             * @param {?} auth
             * @return {?}
             */
            function (auth) {
                return tslib_1.__assign({ type: t }, auth);
            })));
        }))).subscribe((/**
         * @param {?} t
         * @return {?}
         */
        function (t) {
            /** @type {?} */
            var hasAuthority = { public: true, org: true };
            /** @type {?} */
            var msg = '您没有将方案的使用范围设置为公共的权限。';
            if (t.type.value === 'org') {
                msg = '您没有将方案的使用范围设置为组织的权限。';
            }
            if (t.success) {
                /** @type {?} */
                var hasPublicAuthority = t.authOperationData && t.authOperationData.length;
                hasAuthority.public = hasPublicAuthority;
                /** @type {?} */
                var hasOrgAuthority = t.authOrganizationData && t.authOrganizationData.length;
                hasAuthority.org = hasOrgAuthority;
                if (t.type.value === 'public') {
                    instance.schemeInfo.type = t.type.value;
                }
                else if (t.type.value === 'org') {
                    if (!hasOrgAuthority) {
                        _this.notifyService.warning(msg);
                    }
                    else {
                        instance.schemeInfo.type = t.type.value;
                        instance.schemeInfo.orgids = t.authOrganizationData.join(',');
                        instance.dataPermissionIds = t.authOrganizationData;
                    }
                }
            }
            else {
                _this.notifyService.warning(msg);
                hasAuthority = { public: false, org: false };
                ;
            }
            instance.refresh(hasAuthority);
        }));
        /** @type {?} */
        var modalContainer = (/** @type {?} */ (newSchemeDlg.dialog.instance));
        modalContainer.draggbar.handle = instance.header.nativeElement;
    };
    /**
     * @param {?} gridId
     * @return {?}
     */
    DatagridSettingsService.prototype.getSchemeList = /**
     * @param {?} gridId
     * @return {?}
     */
    function (gridId) {
        return this.schemeService.getSchemeList(gridId);
    };
    /**
     * @param {?} gridId
     * @param {?} data
     * @return {?}
     */
    DatagridSettingsService.prototype.createNewScheme = /**
     * @param {?} gridId
     * @param {?} data
     * @return {?}
     */
    function (gridId, data) {
        if (!data.name) {
            return of({ flag: false, msg: '请输入方案名称' });
        }
        else {
            /** @type {?} */
            var hasName = this.schemeService.hasSchemeName(gridId, data.name);
            if (typeof hasName === 'boolean' && hasName) {
                return of({ flag: false, msg: '方案名称已存在，请修改。' });
            }
            else if (Array.isArray(hasName) && hasName.length) {
                /** @type {?} */
                var msgs = hasName.map((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) {
                    if (n === 'zh-CHS') {
                        return '简体中文名称已存在。';
                    }
                    else if (n === 'zh-CHT') {
                        return '繁体中文名称已存在。';
                    }
                    else {
                        return '英文名称已存在。';
                    }
                }));
                return of({ flag: false, msg: msgs.join('') });
            }
        }
        /** @type {?} */
        var requiredName = [];
        this.languages.forEach((/**
         * @param {?} n
         * @return {?}
         */
        function (n) {
            if (data.name[n.code] === '' || data.name[n.code] === undefined) {
                requiredName.push(n.code);
            }
        }));
        if (requiredName.length) {
            /** @type {?} */
            var msgs = requiredName.map((/**
             * @param {?} n
             * @return {?}
             */
            function (n) {
                if (n === 'zh-CHS') {
                    return '请输入简体中文名称。';
                }
                else if (n === 'zh-CHT') {
                    return '请输入繁体中文名称。';
                }
                else {
                    return '请输入英文名称。';
                }
            }));
            return of({ flag: false, msg: msgs.join('') });
        }
        if (data.type && data.type === 'org' && (!data.orgids || !data.orgids.length)) {
            return of({ flag: false, msg: '请选择组织' });
        }
        /** @type {?} */
        var _config = null;
        /** @type {?} */
        var selectedSettings = this.getCurrentSchemeSettings(gridId);
        if (selectedSettings) {
            _config = selectedSettings;
        }
        else {
            // 收集当前方案配置数据
            _config = this.buildSubmitData(gridId);
        }
        /** @type {?} */
        var newId = this.idService.guid();
        /** @type {?} */
        var isDefault = data.isDefault;
        if (isDefault) {
            if (data.type !== 'private') {
                isDefault = false;
            }
        }
        if (data.name && typeof data.name === 'object') {
            data.name = JSON.stringify(data.name);
        }
        /** @type {?} */
        var scheme = {
            id: newId,
            belongId: '',
            code: '',
            name: data.name,
            type: data.type,
            isDefault: isDefault,
            isSystem: false,
            extendId: 'datagrid-settings-scheme',
            extendInfo: this.buildOrgAndSchemeRelations(newId, data.orgids),
            queryConditionString: _config ? JSON.stringify(_config) : '',
        };
        return this.schemeService.saveScheme(scheme, gridId).pipe(map((/**
         * @return {?}
         */
        function () {
            return scheme;
        })));
    };
    /**
     * @param {?} schemeList
     * @param {?} gridId
     * @return {?}
     */
    DatagridSettingsService.prototype.setSchemeList = /**
     * @param {?} schemeList
     * @param {?} gridId
     * @return {?}
     */
    function (schemeList, gridId) {
        this.schemeService.update({ list: schemeList }, gridId);
    };
    /**
     * @private
     * @param {?} schemeId
     * @param {?} orgIds
     * @return {?}
     */
    DatagridSettingsService.prototype.buildOrgAndSchemeRelations = /**
     * @private
     * @param {?} schemeId
     * @param {?} orgIds
     * @return {?}
     */
    function (schemeId, orgIds) {
        var _this = this;
        if (!orgIds || !orgIds.length) {
            return [];
        }
        return orgIds.map((/**
         * @param {?} n
         * @return {?}
         */
        function (n) {
            return {
                id: _this.idService.guid(),
                orgId: n,
                relatedId: schemeId
            };
        }));
    };
    /**
     * @private
     * @param {?} gridId
     * @return {?}
     */
    DatagridSettingsService.prototype.getCurrentSchemeSettings = /**
     * @private
     * @param {?} gridId
     * @return {?}
     */
    function (gridId) {
        /** @type {?} */
        var activeScheme = (/** @type {?} */ (this.getActiveSchemeItem(gridId)));
        if (activeScheme && activeScheme.queryConditionString) {
            return JSON.parse(activeScheme.queryConditionString);
        }
        return null;
    };
    DatagridSettingsService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    DatagridSettingsService.ctorParameters = function () { return [
        { type: Injector },
        { type: BsModalService },
        { type: MessagerService },
        { type: IdService },
        { type: LocaleService }
    ]; };
    return DatagridSettingsService;
}());
export { DatagridSettingsService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.multiSortMsg;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.columnsSortableMsg;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.notSupportHeaderGroupMsg;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.notShowDialog;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype._httpRestService;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.languages;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.gridRefs;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.activeSchemeItem;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.saving;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.cfr;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.app;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.schemeListSubscription;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.schemeService;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.notifyService;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.modalSer;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.messager;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.idService;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.localeSer;
    /* Skipping unhandled member: ;*/
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YWdyaWQtc2V0dGluZ3Muc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktZGF0YWdyaWQtc2V0dGluZ3MvIiwic291cmNlcyI6WyJsaWIvZGF0YWdyaWQtc2V0dGluZ3Muc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFPLE1BQU0sZ0JBQWdCLENBQUM7QUFDckQsT0FBTyxFQUFFLFFBQVEsRUFBYyxFQUFFLEVBQWdCLEtBQUssRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNyRSxPQUFPLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxjQUFjLEVBQUUsd0JBQXdCLEVBQUUsY0FBYyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRS9HLE9BQU8sRUFBRSxjQUFjLEVBQXlDLE1BQU0sa0JBQWtCLENBQUM7QUFDekYsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3RELE9BQU8sRUFBRSx5QkFBeUIsRUFBRSxNQUFNLCtCQUErQixDQUFDO0FBQzFFLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFDdEMsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBRWxELE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUM5QyxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSx3Q0FBd0MsQ0FBQztBQUNoRixPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUNsRSxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUNsRSxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUNyRSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7O0FBSWxELE1BQU0sS0FBTyxvQkFBb0IsR0FBSSxJQUFJLGNBQWMsQ0FBQywy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R0FBRyxtQkFBQSxJQUFJLENBQUMsbUJBQW1CLENBQUMsTUFBTSxDQUFDLEVBQXVCO1FBQzVFLElBQUksWUFBWSxJQUFJLFlBQVksQ0FBQyxvQkFBb0IsRUFBRTtZQUNuRCxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLG9CQUFvQixDQUFDLENBQUM7U0FDeEQ7UUFDRCxPQUFPLElBQUksQ0FBQztJQUNoQixDQUFDOztnQkFuckNKLFVBQVU7Ozs7Z0JBbkJVLFFBQVE7Z0JBRXBCLGNBQWM7Z0JBQ2QsZUFBZTtnQkFLZixTQUFTO2dCQUZULGFBQWE7O0lBaXNDdEIsOEJBQUM7Q0FBQSxBQXByQ0QsSUFvckNDO1NBbnJDWSx1QkFBdUI7Ozs7OztJQUVoQywrQ0FBNkM7Ozs7O0lBQzdDLHFEQUE4Qzs7Ozs7SUFDOUMsMkRBQStDOzs7OztJQUMvQyxnREFBbUQ7Ozs7O0lBRW5ELG1EQUFnQzs7Ozs7SUFFaEMsNENBQTRCOzs7OztJQWM1QiwyQ0FBNEQ7Ozs7O0lBQzVELG1EQUEyRDs7Ozs7SUFFM0QseUNBQXVCOzs7OztJQUN2QixzQ0FBNkM7Ozs7O0lBQzdDLHNDQUFtQzs7Ozs7SUFDbkMseURBQW9EOzs7OztJQUVwRCxnREFBNkM7Ozs7O0lBQzdDLGdEQUFxQzs7Ozs7SUFDekIsMkNBQTBCOzs7OztJQUFFLDJDQUFnQzs7Ozs7SUFDNUQsMkNBQWlDOzs7OztJQUFFLDRDQUE0Qjs7Ozs7SUFDL0QsNENBQWdDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgbWFwLCBzd2l0Y2hNYXAsIHRhcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgZm9ya0pvaW4sIE9ic2VydmFibGUsIG9mLCBTdWJzY3JpcHRpb24sIHRpbWVyIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IEluamVjdGFibGUsIEluamVjdG9yLCBJbmplY3Rpb25Ub2tlbiwgQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLCBBcHBsaWNhdGlvblJlZiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZENvbXBvbmVudCwgRGF0YUNvbHVtbiB9IGZyb20gJ0BmYXJyaXMvdWktZGF0YWdyaWQnO1xyXG5pbXBvcnQgeyBCc01vZGFsU2VydmljZSwgTW9kYWxPcHRpb25zLCBNb2RhbENvbnRhaW5lckNvbXBvbmVudCB9IGZyb20gJ0BmYXJyaXMvdWktbW9kYWwnO1xyXG5pbXBvcnQgeyBNZXNzYWdlclNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW1lc3NhZ2VyJztcclxuaW1wb3J0IHsgRGF0YWdyaWRTZXR0aW5nc0NvbXBvbmVudCB9IGZyb20gJy4vZGF0YWdyaWQtc2V0dGluZ3MuY29tcG9uZW50JztcclxuaW1wb3J0IHsgY2xvbmVEZWVwIH0gZnJvbSAnbG9kYXNoLWVzJztcclxuaW1wb3J0IHsgTG9jYWxlU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbG9jYWxlJztcclxuaW1wb3J0IHsgVHJlZU5vZGUgfSBmcm9tICdAZmFycmlzL3VpLXRyZWV0YWJsZSc7XHJcbmltcG9ydCB7IElkU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktY29tbW9uJztcclxuaW1wb3J0IHsgU2ltcGxlQ29sdW1uc0NvbXBvbmVudCB9IGZyb20gJy4vc2ltcGxlLW1vZGUvc2ltcGxlLWNvbHVtbnMuY29tcG9uZW50JztcclxuaW1wb3J0IHsgRGF0YWdyaWRTY2hlbWVTZXJ2aWNlIH0gZnJvbSAnLi9kYXRhZ3JpZC1zY2hlbWUuc2VydmljZSc7XHJcbmltcG9ydCB7IE5ld1NjaGVtZUNvbXBvbmVudCB9IGZyb20gJy4vc2NoZW1lL25ld3NjaGVtZS5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBTY2hlbWVMaXN0Q29tcG9uZW50IH0gZnJvbSAnLi9zY2hlbWUvc2NoZW1lLWxpc3QuY29tcG9uZW50JztcclxuaW1wb3J0IHsgTm90aWZ5U2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbm90aWZ5JztcclxuaW1wb3J0IHsgRGF0YWdyaWRTY2hlbWVNb2RlbCwgU2NoZW1lQXV0aE1vZGVsLCBTZXR0aW5nTW9kZWwgfSBmcm9tICcuL3NldHRpbmcubW9kZWwnO1xyXG5cclxuXHJcbmV4cG9ydCBjb25zdCBHUklEX1NFVFRJTkdTX1dFQkFQSSA9ICBuZXcgSW5qZWN0aW9uVG9rZW4oJyBGYXJyaXMgRGF0YUdyaWQgVXNlciBTZXR0aW5nIFdlYkFwaSBVUkkuJyk7XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBEYXRhZ3JpZFNldHRpbmdzU2VydmljZSB7XHJcblxyXG4gICAgcHJpdmF0ZSBtdWx0aVNvcnRNc2cgPSAn5YiX6KGo5Lit5pyq5byA5ZCv5aSa5YiX5o6S5bqP55qE5Yqf6IO944CCIOivt+ajgOafpe+8gSc7XHJcbiAgICBwcml2YXRlIGNvbHVtbnNTb3J0YWJsZU1zZyA9ICfmnKrlvIDlkK/liJfnmoTmjpLluo/lip/og73jgILor7fmo4Dmn6XvvIEnO1xyXG4gICAgcHJpdmF0ZSBub3RTdXBwb3J0SGVhZGVyR3JvdXBNc2cgPSAn5pqC5LiN5pSv5oyB5aSa6KGo5aS06K6+572uJztcclxuICAgIHByaXZhdGUgbm90U2hvd0RpYWxvZyA9ICflpJrooajlpLTmmoLkuI3mlK/mjIHliJfmmL7npLrorr7nva7vvJvlkIzml7bmnKrlkK/nlKjliJfmjpLluo/lip/og73jgIInO1xyXG5cclxuICAgIHByaXZhdGUgX2h0dHBSZXN0U2VydmljZSA9IG51bGw7XHJcblxyXG4gICAgcHJpdmF0ZSBsYW5ndWFnZXM6IGFueSA9IFtdO1xyXG5cclxuICAgIGdldCBodHRwUmVzdFNlcnZpY2UoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2h0dHBSZXN0U2VydmljZTtcclxuICAgIH07XHJcblxyXG4gICAgc2V0IGh0dHBSZXN0U2VydmljZShodHRwU2VyKSB7XHJcbiAgICAgICAgdGhpcy5faHR0cFJlc3RTZXJ2aWNlID0gaHR0cFNlcjtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuc2NoZW1lU2VydmljZSkge1xyXG4gICAgICAgICAgICB0aGlzLnNjaGVtZVNlcnZpY2Uuc2V0UmVzdFNlcnZpY2UoaHR0cFNlcik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ3JpZFJlZnM6IHtba2V5OiBzdHJpbmddOiBEYXRhZ3JpZENvbXBvbmVudH0gPSBudWxsO1xyXG4gICAgcHJpdmF0ZSBhY3RpdmVTY2hlbWVJdGVtOiB7W3NjaGVtZWlkOiBzdHJpbmddOiBhbnl9ID0gbnVsbDtcclxuXHJcbiAgICBwcml2YXRlIHNhdmluZyA9IGZhbHNlO1xyXG4gICAgcHJpdmF0ZSBjZnI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciA9IG51bGw7XHJcbiAgICBwcml2YXRlIGFwcDogQXBwbGljYXRpb25SZWYgPSBudWxsO1xyXG4gICAgcHJpdmF0ZSBzY2hlbWVMaXN0U3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb24gPSBudWxsO1xyXG5cclxuICAgIHByaXZhdGUgc2NoZW1lU2VydmljZTogRGF0YWdyaWRTY2hlbWVTZXJ2aWNlO1xyXG4gICAgcHJpdmF0ZSBub3RpZnlTZXJ2aWNlOiBOb3RpZnlTZXJ2aWNlO1xyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IsIHByaXZhdGUgbW9kYWxTZXI6IEJzTW9kYWxTZXJ2aWNlLFxyXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBtZXNzYWdlcjogTWVzc2FnZXJTZXJ2aWNlLCBwcml2YXRlIGlkU2VydmljZTogSWRTZXJ2aWNlLFxyXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBsb2NhbGVTZXI6IExvY2FsZVNlcnZpY2UpIHtcclxuXHJcbiAgICAgICAgdGhpcy5jZnIgPSB0aGlzLmluamVjdG9yLmdldChDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIpO1xyXG4gICAgICAgIHRoaXMuYXBwID0gdGhpcy5pbmplY3Rvci5nZXQoQXBwbGljYXRpb25SZWYpO1xyXG4gICAgICAgIHRoaXMubm90aWZ5U2VydmljZSA9IHRoaXMuaW5qZWN0b3IuZ2V0KE5vdGlmeVNlcnZpY2UsIG51bGwpO1xyXG4gICAgICAgIHRoaXMuc2NoZW1lU2VydmljZSA9IG5ldyBEYXRhZ3JpZFNjaGVtZVNlcnZpY2UoKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgZGVzdHJveShpZD86IHN0cmluZykge1xyXG4gICAgICAgIGlmIChpZCAmJiB0aGlzLmdyaWRSZWZzICYmIHRoaXMuZ3JpZFJlZnNbaWRdKSB7XHJcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmdyaWRSZWZzW2lkXTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmdyaWRSZWZzID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zYXZpbmcgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLnNldEFjdGl2ZVNjaGVtZUl0ZW0oaWQsIG51bGwpO1xyXG4gICAgfVxyXG5cclxuICAgIHJlZ2lzdGVyR3JpZEluc3RhbmNlKGRnOiBEYXRhZ3JpZENvbXBvbmVudCkge1xyXG4gICAgICAgIGlmICghZGcpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ0RhdGFncmlkU2V0dGluZ1NlcnZpY2U6IGdyaWQgaW5zdGFuY2UgaXMgbnVsbC4nKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBpZCA9IGRnLmlkO1xyXG4gICAgICAgIHRoaXMuZ3JpZFJlZnMgPSB0aGlzLmdyaWRSZWZzIHx8IHt9O1xyXG4gICAgICAgIGlmICghdGhpcy5ncmlkUmVmc1tpZF0pIHtcclxuICAgICAgICAgICAgdGhpcy5ncmlkUmVmc1tpZF0gPSBkZztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0R3JpZEluc3RhbmNlKGRnSUQ6IHN0cmluZykge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdyaWRSZWZzID8gdGhpcy5ncmlkUmVmc1tkZ0lEXSA6IG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIOabtOaWsOaWueahiOS4reeahOmFjee9ruaVsOaNriAqL1xyXG4gICAgcHJpdmF0ZSB1cGRhdGVTY2hlbWVTZXR0aW5ncyhzY2hlbWVJdGVtOiBEYXRhZ3JpZFNjaGVtZU1vZGVsLCBzZXR0aW5nczogUGFydGlhbDxTZXR0aW5nTW9kZWw+KSB7XHJcbiAgICAgICAgaWYgKHNjaGVtZUl0ZW0gJiYgc2V0dGluZ3MpIHtcclxuICAgICAgICAgICAgY29uc3Qgc2NoZW1lQ29udGVudE9iaiA9IEpTT04ucGFyc2Uoc2NoZW1lSXRlbS5xdWVyeUNvbmRpdGlvblN0cmluZyk7XHJcbiAgICAgICAgICAgIGlmIChzY2hlbWVDb250ZW50T2JqKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIHNjaGVtZUNvbnRlbnRPYmpbdGhpcy5sb2NhbGVTZXIubG9jYWxlSWRdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2NoZW1lU2V0dGluZ3MgPSBzY2hlbWVDb250ZW50T2JqW3RoaXMubG9jYWxlU2VyLmxvY2FsZUlkXTtcclxuICAgICAgICAgICAgICAgICAgICBzY2hlbWVDb250ZW50T2JqW3RoaXMubG9jYWxlU2VyLmxvY2FsZUlkXSA9IE9iamVjdC5hc3NpZ24oc2NoZW1lU2V0dGluZ3MsIHNldHRpbmdzKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NoZW1lQ29udGVudE9ialt0aGlzLmxvY2FsZVNlci5sb2NhbGVJZF0gPSAgc2V0dGluZ3M7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBzY2hlbWVJdGVtLnF1ZXJ5Q29uZGl0aW9uU3RyaW5nID0gSlNPTi5zdHJpbmdpZnkoc2NoZW1lQ29udGVudE9iaik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIOabtOaWsOW9k+WJjeaWueahiOmFjee9ruaVsOaNriAqL1xyXG4gICAgdXBkYXRlQWN0aXZlU2NoZW1lSXRlbVNldHRpbmdzKGRnSWQ6IHN0cmluZywgc2V0dGluZ3M6IFBhcnRpYWw8U2V0dGluZ01vZGVsPikge1xyXG4gICAgICAgIGNvbnN0IHNjaGVtZUl0ZW0gPSB0aGlzLmdldEFjdGl2ZVNjaGVtZUl0ZW0oZGdJZCk7XHJcbiAgICAgICAgdGhpcy51cGRhdGVTY2hlbWVTZXR0aW5ncyhzY2hlbWVJdGVtLCBzZXR0aW5ncyk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIOiuvue9rua0u+WKqOeahOaWueahiCAqL1xyXG4gICAgc2V0QWN0aXZlU2NoZW1lSXRlbShkZ0lkOiBzdHJpbmcsIGFjdGl2ZUl0ZW06IGFueSkge1xyXG4gICAgICAgIGNvbnN0IHNjaGVtZWtleSA9IHRoaXMuc2NoZW1lU2VydmljZS5nZXRTY2hlbWVLZXkoZGdJZCk7XHJcbiAgICAgICAgdGhpcy5hY3RpdmVTY2hlbWVJdGVtID0gdGhpcy5hY3RpdmVTY2hlbWVJdGVtIHx8IHt9O1xyXG4gICAgICAgIHRoaXMuYWN0aXZlU2NoZW1lSXRlbVtzY2hlbWVrZXldID0gYWN0aXZlSXRlbTtcclxuICAgIH1cclxuICAgIC8qKiDojrflj5blvZPliY3mtLvliqjnmoTmlrnmoYggKi9cclxuICAgIGdldEFjdGl2ZVNjaGVtZUl0ZW0oZGdJZDogc3RyaW5nKTogRGF0YWdyaWRTY2hlbWVNb2RlbCB7XHJcbiAgICAgICAgY29uc3Qgc2NoZW1la2V5ID0gdGhpcy5zY2hlbWVTZXJ2aWNlLmdldFNjaGVtZUtleShkZ0lkKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5hY3RpdmVTY2hlbWVJdGVtID8gdGhpcy5hY3RpdmVTY2hlbWVJdGVtW3NjaGVtZWtleV0gOiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIGdldFNlYXJjaFR5cGVzKCkge1xyXG4gICAgICAgIHJldHVybiBbXHJcbiAgICAgICAgICAgIHsgdmFsdWU6ICdhbGwnLCB0aXRsZTogdGhpcy5sb2NhbGVTZXIuZ2V0VmFsdWUoJ2RhdGFncmlkLnNldHRpbmdzLmFsbENvbHVtbnMnKSB9LFxyXG4gICAgICAgICAgICB7IHZhbHVlOiAndmlzaWJsZScsIHRpdGxlOiB0aGlzLmxvY2FsZVNlci5nZXRWYWx1ZSgnZGF0YWdyaWQuc2V0dGluZ3MudmlzaWJsZUNvbHVtbnMnKSB9LFxyXG4gICAgICAgICAgICB7IHZhbHVlOiAnaGlkZGVuJywgdGl0bGU6IHRoaXMubG9jYWxlU2VyLmdldFZhbHVlKCdkYXRhZ3JpZC5zZXR0aW5ncy5oaWRkZW5Db2x1bW5zJykgfVxyXG4gICAgICAgIF07XHJcbiAgICB9XHJcblxyXG4gICAgc2hvd1NpbXBsZShncmlkSW5zdGFuY2U6IERhdGFncmlkQ29tcG9uZW50LCBzZXR0aW5ncz86IFNldHRpbmdNb2RlbCwgc2VsZWN0ZWRTY2hlbWVJdGVtPzogRGF0YWdyaWRTY2hlbWVNb2RlbCkge1xyXG4gICAgICAgIGNvbnN0IGNvbHVtbnMgPSB0aGlzLmNvbnZlcnRDb2x1bW5zVG9TaW1wbGUoZ3JpZEluc3RhbmNlLmNvbHVtbnMpO1xyXG4gICAgICAgIGNvbHVtbnNbMF0gPSBjb2x1bW5zWzBdLmZpbHRlcihuID0+IG4uZmllbGQgJiYgbi5maWVsZCAhPT0gZ3JpZEluc3RhbmNlLkNvbnRyb2xQYW5lbEZlaWxkKTtcclxuXHJcbiAgICAgICAgY29uc3Qgc2VhcmNoVHlwZXMgPSB0aGlzLmdldFNlYXJjaFR5cGVzKCk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmNmcikge1xyXG4gICAgICAgICAgICBjb25zdCBjbXBGYWN0b3J5ID0gdGhpcy5jZnIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoU2ltcGxlQ29sdW1uc0NvbXBvbmVudCk7XHJcbiAgICAgICAgICAgIGxldCBzaW1wbGVSZWYgPSBjbXBGYWN0b3J5LmNyZWF0ZSh0aGlzLmluamVjdG9yKTtcclxuICAgICAgICAgICAgdGhpcy5hcHAuYXR0YWNoVmlldyhzaW1wbGVSZWYuaG9zdFZpZXcpO1xyXG4gICAgICAgICAgICBzaW1wbGVSZWYuaW5zdGFuY2UuY29sdW1ucyA9IGNvbHVtbnM7XHJcbiAgICAgICAgICAgIHNpbXBsZVJlZi5pbnN0YW5jZS5zZWFydFR5cGVzID0gc2VhcmNoVHlwZXM7XHJcbiAgICAgICAgICAgIHNpbXBsZVJlZi5pbnN0YW5jZS5ncmlkSW5zdGFuY2UgPSBncmlkSW5zdGFuY2U7XHJcblxyXG4gICAgICAgICAgICBpZiAoZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3BhZ2Utd3JhcHBlcicpKSB7XHJcbiAgICAgICAgICAgICAgICBzaW1wbGVSZWYuaW5zdGFuY2UudG9wID0gNzY7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHNpbXBsZVJlZi5pbnN0YW5jZS5lbmFibGVTY2hlbWUgPSBncmlkSW5zdGFuY2UuZW5hYmxlU2NoZW1lO1xyXG4gICAgICAgICAgICBpZiAoZ3JpZEluc3RhbmNlLmVuYWJsZVNjaGVtZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHNldHRpbmdzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGVjdGVkU2NoZW1lSXRlbSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVNjaGVtZVNldHRpbmdzKHNlbGVjdGVkU2NoZW1lSXRlbSwgc2V0dGluZ3MpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzaW1wbGVSZWYuaW5zdGFuY2UuY3VycmVudFNjaGVtZUl0ZW0gPSBzZWxlY3RlZFNjaGVtZUl0ZW07XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2ltcGxlUmVmLmluc3RhbmNlLmN1cnJlbnRTY2hlbWVJdGVtID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2ltcGxlUmVmLmluc3RhbmNlLnNldHRpbmdzID0gc2V0dGluZ3M7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBfY3VycmVudFNjaGVtdEl0ZW0gPSB0aGlzLmdldEFjdGl2ZVNjaGVtZUl0ZW0oZ3JpZEluc3RhbmNlLmlkKTtcclxuICAgICAgICAgICAgICAgICAgICBzaW1wbGVSZWYuaW5zdGFuY2UuY3VycmVudFNjaGVtZUl0ZW0gPSBfY3VycmVudFNjaGVtdEl0ZW07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoc2ltcGxlUmVmLmxvY2F0aW9uLm5hdGl2ZUVsZW1lbnQpO1xyXG5cclxuICAgICAgICAgICAgc2ltcGxlUmVmLmluc3RhbmNlLmNsb3NlZC5waXBlKFxyXG4gICAgICAgICAgICAgICAgc3dpdGNoTWFwKCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2ltcGxlUmVmLmluc3RhbmNlLmNvbnRhaW5lci5uYXRpdmVFbGVtZW50LnN0eWxlLnJpZ2h0ID0gJy01MDBweCc7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRpbWVyKDUwMCk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICApLnN1YnNjcmliZSggKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgc2ltcGxlUmVmLmxvY2F0aW9uLm5hdGl2ZUVsZW1lbnQucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgICAgICBzaW1wbGVSZWYuZGVzdHJveSgpO1xyXG4gICAgICAgICAgICAgICAgc2ltcGxlUmVmID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNjaGVtZUxpc3RTdWJzY3JpcHRpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNjaGVtZUxpc3RTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBzaW1wbGVSZWYuaW5zdGFuY2UuYWR2YW5jZWQuc3Vic2NyaWJlKCh7IHZpZXdGaWVsZHMgfSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHZpZXdGaWVsZHMgJiYgdmlld0ZpZWxkcy5sZW5ndGgpe1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlU2NoZW1lU2V0dGluZ3Moc2ltcGxlUmVmLmluc3RhbmNlLmN1cnJlbnRTY2hlbWVJdGVtLCB7dmlld0NvbHVtbnM6IHZpZXdGaWVsZHN9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRoaXMuc2hvd0FkdmFuY2VkKGdyaWRJbnN0YW5jZSwgbnVsbCwgc2ltcGxlUmVmLmluc3RhbmNlLmN1cnJlbnRTY2hlbWVJdGVtKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBzaW1wbGVSZWYuaW5zdGFuY2Uuc3VibWl0LnN1YnNjcmliZSggKGU6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgZS50YXJnZXQuZGlzYWJsZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2F2aW5nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLnNhdmluZykge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoZS5jdXJyZW50U2NoZW1lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0QWN0aXZlU2NoZW1lSXRlbShncmlkSW5zdGFuY2UuaWQsIGUuY3VycmVudFNjaGVtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUdyaWRWaWV3KGUsIGdyaWRJbnN0YW5jZSwgZS50YXJnZXQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHNpbXBsZVJlZi5pbnN0YW5jZS5maWVsZHNDaGFuZ2Uuc3Vic2NyaWJlKCh2aXNpYmxlRmllbGRzOiBzdHJpbmdbXSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVBY3RpdmVTY2hlbWVJdGVtU2V0dGluZ3MoZ3JpZEluc3RhbmNlLmlkLCB7dmlld0NvbHVtbnM6IHZpc2libGVGaWVsZHN9KVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIC8vIOaJk+W8gOaWsOWinuaWueahiOeql+WPo1xyXG4gICAgICAgICAgICBzaW1wbGVSZWYuaW5zdGFuY2UuYWRkTmV3U2NoZW1lLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNob3dOZXdTY2hlbWVEaWFsb2coZ3JpZEluc3RhbmNlLCBzaW1wbGVSZWYpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHNpbXBsZVJlZi5pbnN0YW5jZS5zY2hlbWVMaXN0ID0gdGhpcy5zY2hlbWVTZXJ2aWNlLmdldFN0YXRlVmFsdWUoZ3JpZEluc3RhbmNlLmlkLCAnbGlzdCcpIHx8IFtdO1xyXG5cclxuICAgICAgICAgICAgLy8g5omT5byA5pa55qGI566h55CG5YiX6KGo56qX5Y+jXHJcbiAgICAgICAgICAgIHNpbXBsZVJlZi5pbnN0YW5jZS5zaG93U2NoZW1lTGlzdC5zdWJzY3JpYmUoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zY2hlbWVTZXJ2aWNlLmdldFNjaGVtZUxpc3QoZ3JpZEluc3RhbmNlLmlkKS5waXBlKFxyXG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaE1hcCgodCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zY2hlbWVTZXJ2aWNlLmNoZWNrQXV0aG9yaXR5KCkucGlwZShcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcCgoYXV0aDogU2NoZW1lQXV0aE1vZGVsKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlzdDogdCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLi4uYXV0aFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgKS5zdWJzY3JpYmUoKHQ6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2NoZW1lU2VydmljZS5zZXRTY2hlbWVMaXN0KGdyaWRJbnN0YW5jZS5pZCwgdC5saXN0IHx8IFtdKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dTY2hlbWVMaXN0RGlhbG9nKGdyaWRJbnN0YW5jZSwgY2xvbmVEZWVwKHQubGlzdCB8fCBbXSksIHQuc3VjY2Vzcyk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLnNjaGVtZUxpc3RTdWJzY3JpcHRpb24gPSB0aGlzLnNjaGVtZVNlcnZpY2Uuc2NoZW1lTGlzdCQuc3Vic2NyaWJlKChsaXN0OiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIHNpbXBsZVJlZi5pbnN0YW5jZS5zY2hlbWVMaXN0ID0gbGlzdDtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoIWxpc3QgfHwgIWxpc3QubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRBY3RpdmVTY2hlbWVJdGVtKGdyaWRJbnN0YW5jZS5pZCwgbnVsbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IF9hY3RpdmVTY2hlbWVJdGVtID0gdGhpcy5nZXRBY3RpdmVTY2hlbWVJdGVtKGdyaWRJbnN0YW5jZS5pZCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoX2FjdGl2ZVNjaGVtZUl0ZW0pIHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgaGFzQWN0aXZlSXRlbSA9IGxpc3QuZmluZChuID0+IG4uaWQgPT09IF9hY3RpdmVTY2hlbWVJdGVtLmlkKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIWhhc0FjdGl2ZUl0ZW0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaGFzQWN0aXZlSXRlbSA9IHRoaXMuZ2V0RGVmYXVsdFNjaGVtZShsaXN0KTsgLy8g6I635Y+W6K6+572u5Li65b2T5YmN5pa55qGI55qE6aG5XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0QWN0aXZlU2NoZW1lSXRlbShncmlkSW5zdGFuY2UuaWQsIGhhc0FjdGl2ZUl0ZW0gfHwgbnVsbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBzaW1wbGVSZWYuaW5zdGFuY2UuY3VycmVudFNjaGVtZUl0ZW0gPSBoYXNBY3RpdmVJdGVtO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIC8vIOWIh+aNouaWueahiFxyXG4gICAgICAgICAgICBzaW1wbGVSZWYuaW5zdGFuY2UuYWN0aXZlSXRlbUNoYW5nZS5zdWJzY3JpYmUoKHI6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRBY3RpdmVTY2hlbWVJdGVtKGdyaWRJbnN0YW5jZS5pZCwgcik7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgc2ltcGxlUmVmLmhvc3RWaWV3LmRldGVjdENoYW5nZXMoKTtcclxuXHJcbiAgICAgICAgICAgIHNpbXBsZVJlZi5pbnN0YW5jZS5jb250YWluZXIubmF0aXZlRWxlbWVudC5zdHlsZS5yaWdodCA9ICcwcHgnO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHNpbXBsZVJlZjtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHNob3coZ3JpZEluc3RhbmNlOiBEYXRhZ3JpZENvbXBvbmVudCwgb3B0cz86IE1vZGFsT3B0aW9ucykge1xyXG4gICAgICAgIHRoaXMucmVnaXN0ZXJHcmlkSW5zdGFuY2UoZ3JpZEluc3RhbmNlKTtcclxuXHJcbiAgICAgICAgaWYgKGdyaWRJbnN0YW5jZS5lbmFibGVTaW1wbGVNb2RlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnNob3dTaW1wbGUoZ3JpZEluc3RhbmNlKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zaG93QWR2YW5jZWQoZ3JpZEluc3RhbmNlLCBvcHRzKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzaG93QWR2YW5jZWQoZ3JpZEluc3RhbmNlOiBEYXRhZ3JpZENvbXBvbmVudCwgb3B0cz86IE1vZGFsT3B0aW9ucywgc2VsZWN0ZWRTY2hlbWVJdGVtPzogRGF0YWdyaWRTY2hlbWVNb2RlbCkge1xyXG4gICAgICAgIGxldCBfZWRpdENvbFNvcnRJbmZvID0gdHJ1ZTtcclxuICAgICAgICBjb25zdCBlZGl0Q29sU29ydEluZm8gPSB0aGlzLmNhblNldENvbHVtblNvcnQoZ3JpZEluc3RhbmNlKTtcclxuICAgICAgICBpZiAoZWRpdENvbFNvcnRJbmZvICE9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgIC8vIHRoaXMubWVzc2FnZXIud2FybmluZyhtc2cpO1xyXG4gICAgICAgICAgICAvLyByZXR1cm47XHJcbiAgICAgICAgICAgIF9lZGl0Q29sU29ydEluZm8gPSBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHNob3dTZXRDb2x1bW5zVGFiID0gIXRoaXMuaXNIZWFkZXJHcm91cChncmlkSW5zdGFuY2UpO1xyXG4gICAgICAgIGNvbnN0IGdldEFjdGl2ZVRhYkluZGV4ID0gKCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoc2hvd1NldENvbHVtbnNUYWIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAxO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKF9lZGl0Q29sU29ydEluZm8pIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gMjtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICBjb25zdCBhY3RpdmVUYWJJbmRleCA9IGdldEFjdGl2ZVRhYkluZGV4KCk7XHJcblxyXG4gICAgICAgIGlmIChhY3RpdmVUYWJJbmRleCA9PT0gLTEpIHtcclxuICAgICAgICAgICAgdGhpcy5tZXNzYWdlci53YXJuaW5nKHRoaXMubm90U2hvd0RpYWxvZyk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGNvbHVtbnMgPSB0aGlzLmNvbnZlcnRDb2x1bW5zVG9TaW1wbGUoZ3JpZEluc3RhbmNlLmNvbHVtbnMpO1xyXG5cclxuICAgICAgICAvLyDojrflj5blvZPliY3mlrnmoYjkuK3lvZPliY3or63oqIDnmoTphY3nva7mlbDmja5cclxuICAgICAgICBsZXQgY3VycmVudFNldHRpbmdzOiBTZXR0aW5nTW9kZWwgPSBudWxsO1xyXG4gICAgICAgIGlmIChzZWxlY3RlZFNjaGVtZUl0ZW0gJiYgc2VsZWN0ZWRTY2hlbWVJdGVtLnF1ZXJ5Q29uZGl0aW9uU3RyaW5nKSB7XHJcbiAgICAgICAgICAgIGN1cnJlbnRTZXR0aW5ncyA9IEpTT04ucGFyc2Uoc2VsZWN0ZWRTY2hlbWVJdGVtLnF1ZXJ5Q29uZGl0aW9uU3RyaW5nKVt0aGlzLmxvY2FsZVNlci5sb2NhbGVJZF07XHJcblxyXG4gICAgICAgICAgICBpZiAoY3VycmVudFNldHRpbmdzLmNvbHVtbkZvcm1hdCAmJiBjdXJyZW50U2V0dGluZ3MuY29sdW1uRm9ybWF0Lmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgY29sdW1uc1swXSA9IGNvbHVtbnNbMF0ubWFwKChjb2wpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBmY29sID0gY3VycmVudFNldHRpbmdzLmNvbHVtbkZvcm1hdC5maW5kKG4gPT4gbi5maWVsZCA9PT0gY29sLmZpZWxkKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZmNvbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2wgPSBPYmplY3QuYXNzaWduKGNvbCwgZmNvbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjb2w7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGNvbHVtbnNbMF0gPSBjb2x1bW5zWzBdLmZpbHRlcihuID0+IG4uZmllbGQgJiYgbi5maWVsZCAhPT0gZ3JpZEluc3RhbmNlLkNvbnRyb2xQYW5lbEZlaWxkKTtcclxuICAgICAgICBjb25zdCB0cmVlRGF0YSA9IHRoaXMuY29udmVydENvbHVtbnMyVHJlZURhdGEoY2xvbmVEZWVwKGNvbHVtbnMpLCB0cnVlKTtcclxuICAgICAgICBjb25zdCB2aWV3Q29sdW1uc1RyZWVEYXRhID0gdGhpcy5jb252ZXJ0Q29sdW1uczJUcmVlRGF0YShjbG9uZURlZXAoY29sdW1ucyksIGZhbHNlKTtcclxuICAgICAgICB0aGlzLmNoZWNrVmlld1RyZWVOb2Rlcyh2aWV3Q29sdW1uc1RyZWVEYXRhKTtcclxuXHJcbiAgICAgICAgbGV0IG1vZGFsUmVmID0gbnVsbDtcclxuXHJcbiAgICAgICAgY29uc3Qgb2tUZXh0ID0gdGhpcy5sb2NhbGVTZXIuZ2V0VmFsdWUoJ2RhdGFncmlkLnNldHRpbmdzLm9rJykgfHwgJ+ehruWumic7XHJcbiAgICAgICAgY29uc3QgY2FuY2VsVGV4dCA9IHRoaXMubG9jYWxlU2VyLmdldFZhbHVlKCdkYXRhZ3JpZC5zZXR0aW5ncy5jYW5jZWwnKSB8fCAn5Y+W5raIJztcclxuICAgICAgICBjb25zdCByZXNldFRleHQgPSAgdGhpcy5sb2NhbGVTZXIuZ2V0VmFsdWUoJ2RhdGFncmlkLnNldHRpbmdzLnJlc2V0JykgfHwgJ+mHjee9ric7XHJcblxyXG4gICAgICAgIGNvbnN0IGRlZmF1bHRPcHRzID0ge1xyXG4gICAgICAgICAgICB3aWR0aDogNzYwLCBoZWlnaHQ6IDU2MCwgc2hvd0hlYWRlcjogZmFsc2UsIHRpdGxlOiAn5o6n5Yi26Z2i5p2/JyxcclxuICAgICAgICAgICAgaW5pdGlhbFN0YXRlOiB7XHJcbiAgICAgICAgICAgICAgICBjb2x1bW5zLFxyXG4gICAgICAgICAgICAgICAgc29ydFRyZWVEYXRhOiB0cmVlRGF0YSxcclxuICAgICAgICAgICAgICAgIHZpZXdUcmVlRGF0YTogdmlld0NvbHVtbnNUcmVlRGF0YSxcclxuICAgICAgICAgICAgICAgIGdyaWRJbnN0YW5jZSxcclxuICAgICAgICAgICAgICAgIGNhblNldENvbHVtblNvcnQ6IF9lZGl0Q29sU29ydEluZm8sXHJcbiAgICAgICAgICAgICAgICBjYW5TZXRDb2x1bW5WaXNpYmxlOiBzaG93U2V0Q29sdW1uc1RhYixcclxuICAgICAgICAgICAgICAgIGFjdGl2ZVRhYkluZGV4LFxyXG4gICAgICAgICAgICAgICAgc2NoZW1lSW5mbzogY3VycmVudFNldHRpbmdzXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHNob3dCdXR0b25zOiBmYWxzZVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgY29uc3QgbW9kYWxPcHRzID0gT2JqZWN0LmFzc2lnbihkZWZhdWx0T3B0cywgb3B0cyB8fCB7fSk7XHJcblxyXG4gICAgICAgIG1vZGFsUmVmID0gdGhpcy5tb2RhbFNlci5zaG93KERhdGFncmlkU2V0dGluZ3NDb21wb25lbnQsIG1vZGFsT3B0cyk7XHJcbiAgICAgICAgY29uc3QgaW5zdGFuY2UgPSBtb2RhbFJlZi5jb250ZW50IGFzIERhdGFncmlkU2V0dGluZ3NDb21wb25lbnQ7XHJcbiAgICAgICAgaW5zdGFuY2UuZW5hYmxlUmVzZXQgPSB0cnVlO1xyXG4gICAgICAgIGluc3RhbmNlLm1vZGFsUmVmID0gbW9kYWxSZWY7XHJcbiAgICAgICAgaW5zdGFuY2UuY2FuU2V0Q29sdW1uU29ydCA9IF9lZGl0Q29sU29ydEluZm87XHJcbiAgICAgICAgaW5zdGFuY2UuY2FuU2V0Q29sdW1uVmlzaWJsZSA9ICF0aGlzLmlzSGVhZGVyR3JvdXAoZ3JpZEluc3RhbmNlKTtcclxuXHJcbiAgICAgICAgaW5zdGFuY2Uuc3VibWl0SGFuZGxlLnN1YnNjcmliZSgoZSkgPT4ge1xyXG4gICAgICAgICAgICBlLnRhcmdldC5kaXNhYmxlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNhdmluZykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5zYXZpbmcpIHtcclxuICAgICAgICAgICAgICAgIGlmIChzZWxlY3RlZFNjaGVtZUl0ZW0pIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEFjdGl2ZVNjaGVtZUl0ZW0oZ3JpZEluc3RhbmNlLmlkLCBzZWxlY3RlZFNjaGVtZUl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVHcmlkVmlldyhtb2RhbFJlZiwgZ3JpZEluc3RhbmNlLCBlLnRhcmdldCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaW5zdGFuY2UuY2FuY2VsSGFuZGxlLnN1YnNjcmliZSgoZSkgPT4ge1xyXG4gICAgICAgICAgICBtb2RhbFJlZi5jbG9zZSgpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyDliIfmjaLliLDkvqfovrnmoI/nroDmtIHmqKHlvI9cclxuICAgICAgICBpbnN0YW5jZS5jb25jaXNlLnN1YnNjcmliZSgoZSkgPT4ge1xyXG4gICAgICAgICAgICBtb2RhbFJlZi5jbG9zZSgpO1xyXG4gICAgICAgICAgICBjb25zdCBzZXR0aW5ncyA9IG1vZGFsUmVmLmNvbnRlbnQ7XHJcbiAgICAgICAgICAgIGNvbnN0IHsgc29ydEluZm8sIHZpZXdDb2x1bW5zLCBjb2x1bW5Gb3JtYXQsIGdyb3VwRmllbGQgfSA9IHNldHRpbmdzO1xyXG4gICAgICAgICAgICB0aGlzLnNob3dTaW1wbGUoZ3JpZEluc3RhbmNlLCB7IHNvcnRJbmZvLCB2aWV3Q29sdW1ucywgY29sdW1uRm9ybWF0LCBncm91cEZpZWxkIH0sIHNlbGVjdGVkU2NoZW1lSXRlbSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGNvbnN0IG1vZGFsQ29udGFpbmVyID0gbW9kYWxSZWYuZGlhbG9nLmluc3RhbmNlIGFzIE1vZGFsQ29udGFpbmVyQ29tcG9uZW50O1xyXG4gICAgICAgIG1vZGFsQ29udGFpbmVyLmRyYWdnYmFyLmhhbmRsZSA9IGluc3RhbmNlLmhlYWRlci5uYXRpdmVFbGVtZW50O1xyXG4gICAgICAgIHJldHVybiBtb2RhbFJlZjtcclxuICAgIH1cclxuXHJcblxyXG5cclxuICAgIHByaXZhdGUgY2FuU2V0Q29sdW1uU29ydChncmlkSW5zdGFuY2U6IERhdGFncmlkQ29tcG9uZW50KSB7XHJcbiAgICAgICAgaWYgKGdyaWRJbnN0YW5jZS5tdWx0aVNvcnQgJiYgdGhpcy5oYXNFbmFibGVTb3J0Q29sdW1ucyhncmlkSW5zdGFuY2UpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5oYXNFbmFibGVTb3J0Q29sdW1ucyhncmlkSW5zdGFuY2UpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jb2x1bW5zU29ydGFibGVNc2c7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoIWdyaWRJbnN0YW5jZS5tdWx0aVNvcnQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm11bHRpU29ydE1zZztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGhhc0VuYWJsZVNvcnRDb2x1bW5zKGdyaWRJbnN0YW5jZTogRGF0YWdyaWRDb21wb25lbnQpIHtcclxuICAgICAgICBjb25zdCBzb3J0Q29sdW1uc0NvdW50ID0gZ3JpZEluc3RhbmNlLmZsYXRDb2x1bW5zLnJlZHVjZSgoYywgcikgPT4ge1xyXG4gICAgICAgICAgICBpZiAoci5zb3J0YWJsZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGMgKyAxO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBjO1xyXG4gICAgICAgIH0sIDApO1xyXG5cclxuICAgICAgICByZXR1cm4gc29ydENvbHVtbnNDb3VudCA+IDA7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBpc0hlYWRlckdyb3VwKGdyaWQ6IERhdGFncmlkQ29tcG9uZW50KSB7XHJcbiAgICAgICAgY29uc3QgZmxhZyA9IGdyaWQuY29sdW1ucy5sZW5ndGggPiAxO1xyXG4gICAgICAgIGlmIChmbGFnKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLm5vdFN1cHBvcnRIZWFkZXJHcm91cE1zZztcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZsYWc7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRDaGlsZHMoY29scywgcm93SW5kZXgsIGNvbFN0YXJ0SW5kZXgsIGNvbENvdW50LCBmb3JTb3J0ID0gZmFsc2UpIHtcclxuICAgICAgICBjb25zdCBjaGlsZENvbHMgPSBbXTtcclxuICAgICAgICBsZXQgX2NvdW50ID0gY29sU3RhcnRJbmRleDtcclxuICAgICAgICBpZiAoIWNvbHNbcm93SW5kZXhdKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAgW107XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb2xzW3Jvd0luZGV4XS5zbGljZSgpLmZvckVhY2goZWxlbWVudCA9PiB7XHJcbiAgICAgICAgICAgIF9jb3VudCA9IF9jb3VudCArIGVsZW1lbnQuY29sc3BhbjtcclxuICAgICAgICAgICAgaWYgKCBfY291bnQgPD0gY29sQ291bnQgKSB7XHJcbiAgICAgICAgICAgICAgICBjaGlsZENvbHMucHVzaChlbGVtZW50KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBjb2xzW3Jvd0luZGV4XS5zcGxpY2UoMCwgY2hpbGRDb2xzLmxlbmd0aCk7XHJcblxyXG4gICAgICAgIHJldHVybiBjaGlsZENvbHMubWFwKChjLCBpKSA9PiB7XHJcbiAgICAgICAgICAgIGxldCBuOiBhbnkgPSB7XHJcbiAgICAgICAgICAgICAgICBkYXRhOiBjLFxyXG4gICAgICAgICAgICAgICAgc2VsZWN0YWJsZTogZm9yU29ydCA/ICEhYy5zb3J0YWJsZSA6IHRydWVcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGlmIChjLmNvbHNwYW4gJiYgYy5jb2xzcGFuID4gMSkge1xyXG4gICAgICAgICAgICAgICAgbiA9IHtcclxuICAgICAgICAgICAgICAgICAgICBkYXRhOiBjLFxyXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGFibGU6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgIGV4cGFuZGVkOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIGNoaWxkcmVuOiB0aGlzLmdldENoaWxkcyhjb2xzLCByb3dJbmRleCArIDEsIDAgLCBjLmNvbHNwYW4pXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBuO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgY29udmVydENvbHVtbnMyVHJlZURhdGEoY29sczogRGF0YUNvbHVtbltdW10sIGZvclNvcnQgPSBmYWxzZSkge1xyXG4gICAgICAgIGNvbnN0IGNvbHVtbnMgPSBjb2xzLm1hcCgoYzogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIGMubWFwKChfKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBfLmNvbHNwYW4gPSBfLmNvbHNwYW4gfHwgMTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBfO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIGM7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgaWYgKGNvbHVtbnMubGVuZ3RoID09PSAxKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBjb2x1bW5zWzBdLm1hcChjID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogYyxcclxuICAgICAgICAgICAgICAgICAgICBzZWxlY3RhYmxlOiBmb3JTb3J0ID8gISFjLnNvcnRhYmxlIDogdHJ1ZVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIGNvbHVtbnNbMF0ubWFwKChjLCBpKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoYy5jb2xzcGFuICYmIGMuY29sc3BhbiA+IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBjLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RhYmxlOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXhwYW5kZWQ6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkcmVuOiB0aGlzLmdldENoaWxkcyhjb2x1bW5zLCAxLCAwLCBjLmNvbHNwYW4sIGZvclNvcnQpXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogYyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0YWJsZTogZm9yU29ydCA/ICEhYy5zb3J0YWJsZSA6IHRydWVcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHByaXZhdGUgY2hlY2tWaWV3VHJlZU5vZGVzKHRyZWVOb2RlczogVHJlZU5vZGVbXSkge1xyXG4gICAgICAgIHRyZWVOb2Rlcy5mb3JFYWNoKCh0bjogVHJlZU5vZGUpID0+IHtcclxuICAgICAgICAgICAgaWYgKCF0bi5jaGlsZHJlbiB8fCAhdG4uY2hpbGRyZW4ubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICB0bi5zZWxlY3RhYmxlID0gdHJ1ZTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRuLnNlbGVjdGFibGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tWaWV3VHJlZU5vZGVzKHRuLmNoaWxkcmVuKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY29udmVydENvbHVtbnNUb1NpbXBsZShjb2xzOiBhbnkpIHtcclxuICAgICAgICAvLyDnp7vpmaTorr7nva7liJdcclxuICAgICAgICByZXR1cm4gY29scy5tYXAoIChfY29sczogRGF0YUNvbHVtbltdKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiBfY29scy5tYXAoIChjOiBEYXRhQ29sdW1uKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoYy5maWVsZCAhPT0gJ19kYXRhZ3JpZC1zZXR0aW5nLWNvbnRyb2xfJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkOiBjLmZpZWxkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogYy50aXRsZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29sc3BhbjogYy5jb2xzcGFuLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByb3dzcGFuOiBjLnJvd3NwYW4sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvcnRhYmxlOiBjLnNvcnRhYmxlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvcmRlcjogYy5vcmRlcixcclxuICAgICAgICAgICAgICAgICAgICAgICAgaGFsaWduOiBjLmhhbGlnbiB8fCAnbGVmdCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFsaWduOiBjLmFsaWduIHx8ICdsZWZ0JyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJsZTogYy52aXNpYmxlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhbGxvd0dyb3VwaW5nOiBjLmFsbG93R3JvdXBpbmcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwRm9vdGVyOiBjLmdyb3VwRm9vdGVyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb290ZXI6IGMuZm9vdGVyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogYy53aWR0aCB8fCAxMDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlOiBjLmRhdGFUeXBlIHx8ICdzdHJpbmcnXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSkuZmlsdGVyKG4gPT4gbik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSByZXNldEdyaWRWaWV3KGdyaWRJbnN0YW5jZTogYW55KSB7XHJcbiAgICAgICAgaWYgKCFncmlkSW5zdGFuY2UpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBkZnMgPSBncmlkSW5zdGFuY2UuZGZzO1xyXG4gICAgICAgIGlmIChkZnMpIHtcclxuICAgICAgICAgICAgY29uc3Qgb3B0aW9ucyA9IGRmc1snX3N0YXRlJ10uaW5pdGlhbE9wdGlvbnM7XHJcblxyXG4gICAgICAgICAgICBpZiAob3B0aW9ucy5zb3J0KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5zb3J0LnNvcnROYW1lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZ3JpZEluc3RhbmNlLnNvcnROYW1lID0gb3B0aW9ucy5zb3J0LnNvcnROYW1lO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuc29ydC5zb3J0T3JkZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICBncmlkSW5zdGFuY2Uuc29ydE9yZGVyID0gb3B0aW9ucy5zb3J0LnNvcnRPcmRlcjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZ3JpZEluc3RhbmNlLmdyb3VwRmllbGQgPSBvcHRpb25zLmdyb3VwRmllbGQgfHwgJyc7XHJcbiAgICAgICAgICAgIC8vIFRPRE86IOi/mOmcgOimgeS/ruato+m7mOiupOWIl+eahOaYvuekuumhuuW6j1xyXG4gICAgICAgICAgICBpZiAob3B0aW9ucy5jb2x1bW5GaWVsZHMgJiYgb3B0aW9ucy5jb2x1bW5GaWVsZHMubGVuZ3RoKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgbmV3Q29sdW1ucyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgb3B0aW9ucy5jb2x1bW5GaWVsZHMuZm9yRWFjaChjID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb2wgPSBncmlkSW5zdGFuY2UuY29sdW1uc1swXS5maW5kKChuOiBhbnkpID0+IG4uZmllbGQgPT09IGMuZmllbGQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjb2wpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29sLnZpc2libGUgPSBjLnZpc2libGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbC5oYWxpZ24gPSBjLmhhbGlnbjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29sLmFsaWduID0gYy5hbGlnbjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29sLndpZHRoID0gYy53aWR0aDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29sLmZvb3RlciA9IGMuZm9vdGVyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2wuZ3JvdXBGb290ZXIgPSBjLmdyb3VwRm9vdGVyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdDb2x1bW5zLnB1c2goY29sKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBncmlkSW5zdGFuY2UuY29sdW1uc1swXSA9IG5ld0NvbHVtbnM7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIGdyaWRJbnN0YW5jZVsnY2hlY2tPcHRpb25zJ10oKTtcclxuICAgICAgICAgICAgZ3JpZEluc3RhbmNlWydjb2x1bW5zQ2hhbmdlZCddKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgdXBkYXRlR3JpZFZpZXcobW9kYWxSZWYsIGdyaWRJbnN0YW5jZSwgYnRuID0gbnVsbCkge1xyXG4gICAgICAgIGNvbnN0IHNldHRpbmdzID0gbW9kYWxSZWYuY29udGVudDtcclxuXHJcbiAgICAgICAgaWYgKHNldHRpbmdzKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHsgc29ydEluZm8sIHZpZXdDb2x1bW5zLCBjb2x1bW5Gb3JtYXQsIGdyb3VwRmllbGQgfSA9IHNldHRpbmdzO1xyXG5cclxuICAgICAgICAgICAgdGhpcy51cGRhdGVBY3RpdmVTY2hlbWVJdGVtU2V0dGluZ3MoZ3JpZEluc3RhbmNlLmlkLCB7c29ydEluZm8sIHZpZXdDb2x1bW5zLCBjb2x1bW5Gb3JtYXQsIGdyb3VwRmllbGR9KTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuc2F2aW5nID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgIGxldCBfZ3JvdXBGaWVsZCA9ICcnO1xyXG4gICAgICAgICAgICBpZiAoZ3JpZEluc3RhbmNlLmdyb3VwUm93cyAmJiBncm91cEZpZWxkICYmIGdyb3VwRmllbGQubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICBfZ3JvdXBGaWVsZCA9IGdyb3VwRmllbGQuam9pbignLCcpIDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBncmlkSW5zdGFuY2UuZ3JvdXBGaWVsZCA9IF9ncm91cEZpZWxkO1xyXG4gICAgICAgICAgICBjb25zdCBfY29sZm9ybWF0cyA9IGNvbHVtbkZvcm1hdCA/IHRoaXMuY29udmVydENvbHVtbnNUb1NpbXBsZShbY29sdW1uRm9ybWF0XSlbMF0gOiBbXTtcclxuICAgICAgICAgICAgY29uc3Qgc2F2ZURhdGEgPSB7IHNvcnRJbmZvLCB2aWV3Q29sdW1ucywgZ3JvdXBGaWVsZDogX2dyb3VwRmllbGQsIGNvbHVtbkZvcm1hdDogX2NvbGZvcm1hdHMgfTtcclxuICAgICAgICAgICAgdGhpcy5zZXRVc2VyQ29uZmlnKGdyaWRJbnN0YW5jZS5pZCwgc2F2ZURhdGEpLnN1YnNjcmliZSggKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKGJ0bikge1xyXG4gICAgICAgICAgICAgICAgICAgIGJ0bi5kaXNhYmxlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGhpcy5zYXZpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGlmICh2aWV3Q29sdW1ucyAmJiB2aWV3Q29sdW1ucy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICBncmlkSW5zdGFuY2UuY29sdW1ucyA9IGdyaWRJbnN0YW5jZS5jb2x1bW5zLm1hcChjb2xzID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVDb2x1bW5Gb3JtYXQoY29scywgY29sdW1uRm9ybWF0LCBncmlkSW5zdGFuY2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5uZXdWaXNpYmxlT3JkZXJDb2x1bW5zKGNvbHMsIHZpZXdDb2x1bW5zLCBjb2x1bW5Gb3JtYXQsIGdyaWRJbnN0YW5jZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgZ3JpZEluc3RhbmNlLmNvbHVtbnNDaGFuZ2VkKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHNvcnRJbmZvICYmIE9iamVjdC5rZXlzKHNvcnRJbmZvKS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCB7IHNvcnROYW1lLCBzb3J0T3JkZXIgfSA9IHNvcnRJbmZvO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzb3J0TmFtZSAmJiBzb3J0TmFtZS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ3JpZEluc3RhbmNlLnNvcnQoc29ydE5hbWUuam9pbignLCcpLCBzb3J0T3JkZXIuam9pbignLCcpKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBncmlkSW5zdGFuY2UuY2xlYXJTb3J0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBncmlkSW5zdGFuY2UuY2xlYXJTb3J0KCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgbW9kYWxSZWYuY2xvc2UoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgbW9kYWxSZWYuY2xvc2UoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxuICAgIG5ld1Zpc2libGVPcmRlckNvbHVtbnMoY29sczogYW55LCB2aWV3Q29sdW1uczogYW55LCBjb2x1bW5Gb3JtYXQ6IGFueSwgZ3JpZEluc3RhbmNlOiBhbnkpIHtcclxuICAgICAgICBjb25zdCBoaWRlQ29sdW1ucyA9IFtdO1xyXG4gICAgICAgIGNvbHMuZm9yRWFjaCgoZWxlbWVudCwgaW5kZXgpID0+IHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuaXNOZXdBZGRDb2x1bW4oZWxlbWVudC5maWVsZCwgY29sdW1uRm9ybWF0KSAmJiBlbGVtZW50LmZpZWxkICE9PSAnX2RhdGFncmlkLXNldHRpbmctY29udHJvbF8nICYmICFncmlkSW5zdGFuY2UuZW5hYmxlU2NoZW1lKSB7XHJcbiAgICAgICAgICAgICAgICB2aWV3Q29sdW1ucy5wdXNoKGVsZW1lbnQuZmllbGQpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudC52aXNpYmxlID0gdmlld0NvbHVtbnMuaW5jbHVkZXMoZWxlbWVudC5maWVsZCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoIWVsZW1lbnQudmlzaWJsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGhpZGVDb2x1bW5zLnB1c2goZWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8g5riF55CG5LiN5a2Y5Zyo55qE5YiXXHJcbiAgICAgICAgbGV0IG5ld0NvbHMgPSB2aWV3Q29sdW1ucy5tYXAoIGZpZWxkID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIGNvbHMuZmluZChjID0+IGMuZmllbGQgPT09IGZpZWxkKTtcclxuICAgICAgICB9KS5maWx0ZXIobiA9PiBuKTtcclxuXHJcbiAgICAgICAgaWYgKGhpZGVDb2x1bW5zLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBuZXdDb2xzID0gbmV3Q29scy5jb25jYXQoaGlkZUNvbHVtbnMpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIG5ld0NvbHMuZmlsdGVyKGMgPT4gYyAmJiBjLmZpZWxkICYmIGMuZmllbGQgIT09ICdfZGF0YWdyaWQtc2V0dGluZy1jb250cm9sXycgKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOaYr+WQpuS4uuaWsOWinuWKoOeahOWtl+autVxyXG4gICAgICog5paw5aKe55qE5a2X5q6177yM6ZyA6KaB5Zyo5YiX6KGo5Lit5bGV56S65Ye65p2l77yM5bm25L+d5a2Y5Yiw5Liq5oCn5YyW6K6+572u5LitXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgaXNOZXdBZGRDb2x1bW4oZmllbGQ6IGFueSwgY29sdW1uczogYW55KSB7XHJcbiAgICAgICAgY29sdW1ucyA9IGNvbHVtbnMgfHwgW107XHJcbiAgICAgICAgcmV0dXJuICFjb2x1bW5zLmZpbmQoYyA9PiBjLmZpZWxkID09PSBmaWVsZCk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHVwZGF0ZUNvbHVtbkZvcm1hdChjb2xzOiBhbnlbXSwgY29sdW1uRm9ybWF0OiBhbnlbXSwgZ3JpZEluc3RhbmNlKSB7XHJcbiAgICAgICAgaWYgKGNvbHVtbkZvcm1hdCAmJiBjb2x1bW5Gb3JtYXQubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGNvbHMuZm9yRWFjaChjb2wgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZm9ybWF0Q29sID0gY29sdW1uRm9ybWF0LmZpbmQoZj0+IGYuZmllbGQgPT09IGNvbC5maWVsZCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoZm9ybWF0Q29sKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29sLndpZHRoID0gZm9ybWF0Q29sLndpZHRoO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbC5oYWxpZ24gPSBmb3JtYXRDb2wuaGFsaWduIHx8ICdsZWZ0JztcclxuICAgICAgICAgICAgICAgICAgICBjb2wuYWxpZ24gPSBmb3JtYXRDb2wuYWxpZ24gfHwgJ2xlZnQnO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoZ3JpZEluc3RhbmNlLmdyb3VwUm93cyAmJiAoY29sLmFsbG93R3JvdXBpbmcgfHwgY29sLmFsbG93R3JvdXBpbmcgPT09IHVuZGVmaW5lZCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFjb2wuZ3JvdXBGb290ZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbC5ncm91cEZvb3RlciA9IGZvcm1hdENvbC5ncm91cEZvb3RlcjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbC5ncm91cEZvb3RlciAmJiBjb2wuZ3JvdXBGb290ZXIub3B0aW9ucykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sLmdyb3VwRm9vdGVyLm9wdGlvbnMudGV4dCA9IGZvcm1hdENvbC5ncm91cEZvb3Rlci5vcHRpb25zLnRleHQgfHwgJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2wuZ3JvdXBGb290ZXIub3B0aW9ucy5jYWxjdWxhdGlvblR5cGUgPVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdENvbC5ncm91cEZvb3Rlci5vcHRpb25zLmNhbGN1bGF0aW9uVHlwZSAhPT0gdW5kZWZpbmVkICYmXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWF0Q29sLmdyb3VwRm9vdGVyLm9wdGlvbnMuY2FsY3VsYXRpb25UeXBlICE9PSBudWxsID9cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZUludChmb3JtYXRDb2wuZ3JvdXBGb290ZXIub3B0aW9ucy5jYWxjdWxhdGlvblR5cGUsIDEwKSA6IC0xO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoZ3JpZEluc3RhbmNlLnNob3dGb290ZXIgJiYgIWdyaWRJbnN0YW5jZS5mb290ZXJUZW1wbGF0ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWNvbC5mb290ZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbC5mb290ZXIgPSBmb3JtYXRDb2wuZm9vdGVyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29sLmZvb3RlciAmJiBjb2wuZm9vdGVyLm9wdGlvbnMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbC5mb290ZXIub3B0aW9ucy50ZXh0ID0gZm9ybWF0Q29sLmZvb3Rlci5vcHRpb25zLnRleHQgfHwgJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2wuZm9vdGVyLm9wdGlvbnMuY2FsY3VsYXRpb25UeXBlID1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXRDb2wuZm9vdGVyLm9wdGlvbnMuY2FsY3VsYXRpb25UeXBlICE9PSB1bmRlZmluZWQgJiZcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXRDb2wuZm9vdGVyLm9wdGlvbnMuY2FsY3VsYXRpb25UeXBlICE9PSBudWxsID9cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZUludChmb3JtYXRDb2wuZm9vdGVyLm9wdGlvbnMuY2FsY3VsYXRpb25UeXBlLCAxMCkgOiAtMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIOWIm+W7uuWUr+S4gGtleSwg55SxdXJpICsgZ3JpZElkIOe7hOaIkO+8jOW5tua3t+a3hlxyXG4gICAgcHJpdmF0ZSBjcmVhdGVDb25maWdLZXkoZ3JpZElkOiBzdHJpbmcpIHtcclxuICAgICAgICBjb25zdCBncmlkID0gdGhpcy5nZXRHcmlkSW5zdGFuY2UoZ3JpZElkKTtcclxuICAgICAgICBpZiAoZ3JpZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZ3JpZC5kZ3MuY3JlYXRlQ29uZmlnS2V5KGdyaWRJZCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ0RhdGFncmlkU2V0dGluZ1NlcnZpY2U6IENhbiBub3QgZmluZCB0aGUgZ3JpZCBpbnN0YW5jZS4nKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwcml2YXRlIGdldEN1cnJlbnRVc2VyU2V0dGluZ3MoZ3JpZElkOiBzdHJpbmcpIHtcclxuICAgICAgICBjb25zdCBncmlkSW5zdGFuY2UgPSB0aGlzLmdldEdyaWRJbnN0YW5jZShncmlkSWQpO1xyXG4gICAgICAgIGNvbnN0IGNvbmZpZyA9IHtzb3J0SW5mbzoge30sIHZpZXdDb2x1bW5zOiBbXSwgZ3JvdXBGaWVsZDogJycsIGNvbHVtbkZvcm1hdDogW119O1xyXG5cclxuICAgICAgICBpZiAoZ3JpZEluc3RhbmNlKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHsgc29ydE5hbWUsIHNvcnRPcmRlciwgY29sdW1uc30gPSBncmlkSW5zdGFuY2U7XHJcbiAgICAgICAgICAgIGlmIChzb3J0TmFtZSkge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgc29ydEluZm8gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc29ydE5hbWU6IHNvcnROYW1lLnNwbGl0KCcsJyksXHJcbiAgICAgICAgICAgICAgICAgICAgc29ydE9yZGVyOiBzb3J0T3JkZXIuc3BsaXQoJywnKVxyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25maWcuc29ydEluZm8gPSBzb3J0SW5mbztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY29uc3Qgdmlld0NvbHVtbnMgPSBjb2x1bW5zWzBdLmZpbHRlcihuID0+IG4udmlzaWJsZSB8fCBuLnZpc2libGUgPT09IHVuZGVmaW5lZCkubWFwKG4gPT4gbi5maWVsZCk7XHJcbiAgICAgICAgICAgIGNvbmZpZy52aWV3Q29sdW1ucyA9IHZpZXdDb2x1bW5zO1xyXG4gICAgICAgICAgICBjb25maWcuY29sdW1uRm9ybWF0ID0gdGhpcy5jb252ZXJ0Q29sdW1uc1RvU2ltcGxlKGNvbHVtbnMpWzBdO1xyXG5cclxuICAgICAgICAgICAgaWYgKGdyaWRJbnN0YW5jZS5ncm91cFJvd3MpIHtcclxuICAgICAgICAgICAgICAgIGNvbmZpZy5ncm91cEZpZWxkID0gZ3JpZEluc3RhbmNlLmdyb3VwRmllbGQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGNvbmZpZztcclxuICAgIH1cclxuXHJcblxyXG4gICAgc2F2ZVVzZXJDb25maWcoZ3JpZElkOiBzdHJpbmcpIHtcclxuICAgICAgICBjb25zdCBjb25maWcgPSB0aGlzLmdldEN1cnJlbnRVc2VyU2V0dGluZ3MoZ3JpZElkKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5zZXRVc2VyQ29uZmlnKGdyaWRJZCwgY29uZmlnKTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRVc2VyQ29uZmlnKGdyaWRJZDogc3RyaW5nLCBjb25maWc6IGFueSApOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgICAgIGNvbnN0IGtleSA9IHRoaXMuY3JlYXRlQ29uZmlnS2V5KGdyaWRJZCk7XHJcbiAgICAgICAgY29uc3QgTE9DQUxFSUQgPSB0aGlzLmxvY2FsZVNlci5sb2NhbGVJZDtcclxuICAgICAgICBjb25zdCBjdXJyZW50Q29uZmlnID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oa2V5KTtcclxuICAgICAgICBjb25zdCBfY29uZmlnID0gKGN1cnJlbnRDb25maWcgPyBKU09OLnBhcnNlKGN1cnJlbnRDb25maWcpIDogeyB9KSB8fCB7fTtcclxuICAgICAgICBpZiAoY29uZmlnKSB7XHJcbiAgICAgICAgICAgIGlmIChfY29uZmlnKSB7XHJcbiAgICAgICAgICAgICAgICBfY29uZmlnW0xPQ0FMRUlEXSA9IGNvbmZpZztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oa2V5LCBKU09OLnN0cmluZ2lmeShfY29uZmlnKSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oa2V5KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuaHR0cFJlc3RTZXJ2aWNlKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGdyaWRJbnMgPSB0aGlzLmdldEdyaWRJbnN0YW5jZShncmlkSWQpO1xyXG4gICAgICAgICAgICBpZiAoZ3JpZElucyAmJiBncmlkSW5zLmVuYWJsZVNjaGVtZSkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgYWN0aXZlU2NoZW1lID0gdGhpcy5nZXRBY3RpdmVTY2hlbWVJdGVtKGdyaWRJZCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoYWN0aXZlU2NoZW1lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gcmV0dXJuIHRoaXMudXBkYXRlU2NoZW1lKGdyaWRJZCwgY29uZmlnKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYWN0aXZlU2NoZW1lLnR5cGUgPT09ICdwcml2YXRlJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zY2hlbWVTZXJ2aWNlLnNhdmVTY2hlbWUoYWN0aXZlU2NoZW1lLCBncmlkSWQsIHRydWUpXHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2NoZW1lU2VydmljZS5jaGVja0F1dGhvcml0eSgpLnBpcGUoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2hNYXAoKHQ6IFNjaGVtZUF1dGhNb2RlbCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0LnN1Y2Nlc3MpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaGFzT3JnQXV0aG9yaXR5ID0gdC5hdXRoT3JnYW5pemF0aW9uRGF0YSAmJiB0LmF1dGhPcmdhbml6YXRpb25EYXRhLmxlbmd0aDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFjdGl2ZVNjaGVtZS50eXBlID09PSAncHVibGljJyB8fCAoYWN0aXZlU2NoZW1lLnR5cGUgPT09ICdvcmcnICYmIGhhc09yZ0F1dGhvcml0eSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNjaGVtZVNlcnZpY2Uuc2F2ZVNjaGVtZShhY3RpdmVTY2hlbWUsIGdyaWRJZCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvZih0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICApXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2YodHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8g5L+d5a2Y6Iez5pWw5o2u5bqTXHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zYXZlVXNlckNvbmZpZyhrZXksICBjb25maWcgPyBfY29uZmlnIDogICcnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBvZih0cnVlKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRVc2VyQ29uZmlnKGtleSk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICAgICAgaWYgKHRoaXMuaHR0cFJlc3RTZXJ2aWNlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9nZXRVc2VyQ29uZmlnKGtleSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY29uc3QgY29uZmlnID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oa2V5KTtcclxuICAgICAgICAgICAgaWYgKGNvbmZpZykge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgY29uID0gSlNPTi5wYXJzZShjb25maWcpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNvblt0aGlzLmxvY2FsZVNlci5sb2NhbGVJZF0pIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2YoY29uW3RoaXMubG9jYWxlU2VyLmxvY2FsZUlkXSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChPYmplY3Qua2V5cyhjb24pLmluZGV4T2YoJ3ZpZXdDb2x1bW5zJykgPiAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2YoY29uKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gb2YobnVsbCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXREZWZhdWx0U2NoZW1lKHNjaGVtZUxpc3Q6IEFycmF5PERhdGFncmlkU2NoZW1lTW9kZWw+KSB7XHJcbiAgICAgICAgLy8gMeOAgeacieS4quS6uum7mOiupOeahOi/lOWbnuS4quS6uum7mOiupOaWueahiFxyXG4gICAgICAgIC8vIDLjgIHmsqHmnInkuKrkurrpu5jorqTmlrnmoYjnmoTvvIzov5Tlm57lhazlhbHmlrnmoYjnrKwx5LiqXHJcbiAgICAgICAgLy8gM+OAgeayoeacieWFrOWFseaWueahiO+8jOi/lOWbnue7hOe7h+aWueahiOesrDHkuKpcclxuICAgICAgICAvLyA044CB5rKh5pyJ57uE57uH5pa55qGI55qELCDov5Tlm57kuKrkurrmlrnmoYjnrKwx5LiqXHJcbiAgICAgICAgLy8gNeOAgeayoeacieS4quS6uuaWueahiOeahO+8jOi/lOWbnuezu+e7n+mihOWItu+8jOWNs+ihqOWNleiuvuiuoeaXtueahOagvOW8j1xyXG5cclxuICAgICAgICBsZXQgZGVmYXVsdFNjaGVtZSA9IG51bGw7XHJcbiAgICAgICAgaWYgKCFzY2hlbWVMaXN0IHx8ICFzY2hlbWVMaXN0Lmxlbmd0aCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZGVmYXVsdFNjaGVtZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBkZWZhdWx0U2NoZW1lID0gc2NoZW1lTGlzdC5maW5kKG4gPT4gbi5pc0RlZmF1bHQpO1xyXG4gICAgICAgICAgICBpZiAoIWRlZmF1bHRTY2hlbWUpIHtcclxuICAgICAgICAgICAgICAgIGxldCBwdWJsaWNTY2hlbWVzID0gc2NoZW1lTGlzdC5maWx0ZXIobiA9PiBuLnR5cGUgPT09ICdwdWJsaWMnKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoIXB1YmxpY1NjaGVtZXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcHVibGljU2NoZW1lcyA9IHNjaGVtZUxpc3QuZmlsdGVyKG4gPT4gbi50eXBlID09PSAnb3JnJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHB1YmxpY1NjaGVtZXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdFNjaGVtZSA9IHB1YmxpY1NjaGVtZXNbMF07XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHRTY2hlbWUgPSBzY2hlbWVMaXN0WzBdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gZGVmYXVsdFNjaGVtZTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgZ2V0U2V0dGluZ3MoZ3JpZElkOiBzdHJpbmcpIHtcclxuICAgICAgICBjb25zdCBrZXkgPSB0aGlzLmNyZWF0ZUNvbmZpZ0tleShncmlkSWQpO1xyXG4gICAgICAgIGNvbnN0IGdyaWRJbnMgPSB0aGlzLmdldEdyaWRJbnN0YW5jZShncmlkSWQpO1xyXG5cclxuICAgICAgICBsZXQgc2NoZW1lTGlzdCQgPSBvZihbXSk7XHJcbiAgICAgICAgaWYgKGdyaWRJbnMgJiYgZ3JpZElucy5lbmFibGVTY2hlbWUpIHtcclxuICAgICAgICAgICAgc2NoZW1lTGlzdCQgPSB0aGlzLmdldFNjaGVtZUxpc3QoZ3JpZElkKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBmb3JrSm9pbihzY2hlbWVMaXN0JCwgdGhpcy5nZXRVc2VyQ29uZmlnKGtleSksIHRoaXMuc2NoZW1lU2VydmljZS5nZXRMYW5ndWFnZXMoKSkucGlwZShcclxuICAgICAgICAgICAgbWFwKChbc2NoZW1lTGlzdCwgdXNlclNldHRpbmcsIHN1cHBvcnRlZExhbmd1YWdlc10pID0+IHtcclxuICAgICAgICAgICAgICAgIHNjaGVtZUxpc3QgPSBzY2hlbWVMaXN0IHx8IFtdO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5sYW5ndWFnZXMgPSBzdXBwb3J0ZWRMYW5ndWFnZXM7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXNjaGVtZUxpc3QubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVzZXJTZXR0aW5nO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyDnvJPlrZjmlrnmoYjliJfooahcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFNjaGVtZUxpc3Qoc2NoZW1lTGlzdCwgZ3JpZElkKTtcclxuICAgICAgICAgICAgICAgICAgICAvLyDmn6Xmib7pu5jorqTmlrnmoYhcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBkZWZhdWx0U2NoZW1lOiBEYXRhZ3JpZFNjaGVtZU1vZGVsID0gdGhpcy5nZXREZWZhdWx0U2NoZW1lKHNjaGVtZUxpc3QpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghZGVmYXVsdFNjaGVtZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXNlclNldHRpbmc7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRBY3RpdmVTY2hlbWVJdGVtKGdyaWRJZCwgZGVmYXVsdFNjaGVtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHVzZXJTZXR0aW5ncyA9IEpTT04ucGFyc2UoZGVmYXVsdFNjaGVtZS5xdWVyeUNvbmRpdGlvblN0cmluZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1c2VyU2V0dGluZ3MpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxvY2FsZUlkID0gdGhpcy5sb2NhbGVTZXIubG9jYWxlSWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodXNlclNldHRpbmdzW2xvY2FsZUlkXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGtleSwgSlNPTi5zdHJpbmdpZnkodXNlclNldHRpbmdzKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVzZXJTZXR0aW5nc1tsb2NhbGVJZF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJTZXR0aW5nc1tsb2NhbGVJZF0gPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGtleSwgSlNPTi5zdHJpbmdpZnkodXNlclNldHRpbmdzKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwcml2YXRlIF9zYXZlVXNlckNvbmZpZyhrZXksIGNvbmZpZykge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHVzZXJDb25maWdTZXR0aW5nID0ge1xyXG4gICAgICAgICAgICAgICAgY29uZmlna2V5MToga2V5LFxyXG4gICAgICAgICAgICAgICAgY29uZmlna2V5MjogJycsXHJcbiAgICAgICAgICAgICAgICBjb25maWdrZXkzOiAnJyxcclxuICAgICAgICAgICAgICAgIHRleHR2YWx1ZTogY29uZmlnID8gSlNPTi5zdHJpbmdpZnkoY29uZmlnKSA6ICAnJ1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaHR0cFJlc3RTZXJ2aWNlLnNhdmVVc2VyU2V0dGluZ3ModXNlckNvbmZpZ1NldHRpbmcpO1xyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmVzZXRVc2VyQ29uZmlnKGdyaWRJbnN0YW5jZSwgbW9kYWxSZWYpIHtcclxuICAgICAgICBjb25zdCByZXN0b3JEZWZhdWx0VGV4dCA9IHRoaXMubG9jYWxlU2VyLmdldFZhbHVlKCdkYXRhZ3JpZC5zZXR0aW5ncy5yZXN0b3JlRGVmYXVsdFNldHRpbmdzVGV4dCcpIHx8ICfnoa7orqTopoHmgaLlpI3pu5jorqTorr7nva7lkJfvvJ8nO1xyXG4gICAgICAgIHRoaXMubWVzc2FnZXIuY29uZmlybShyZXN0b3JEZWZhdWx0VGV4dCkucGlwZShcclxuICAgICAgICAgICAgc3dpdGNoTWFwKCAodDogYm9vbGVhbikgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHQpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zZXRVc2VyQ29uZmlnKGdyaWRJbnN0YW5jZS5pZCwgJycpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG9mKHQpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICkuc3Vic2NyaWJlKCh0OiBib29sZWFuKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlc2V0R3JpZFZpZXcoZ3JpZEluc3RhbmNlKTtcclxuICAgICAgICAgICAgICAgIG1vZGFsUmVmLmNsb3NlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIF9nZXRVc2VyQ29uZmlnKGtleSkge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmh0dHBSZXN0U2VydmljZS5nZXRVc2VyU2V0dGluZ3Moa2V5KS5waXBlKFxyXG4gICAgICAgICAgICAgICAgbWFwKCh1Y3M6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh1Y3MgJiYgdWNzLnRleHRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjID0gSlNPTi5wYXJzZSh1Y3MudGV4dFZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjW3RoaXMubG9jYWxlU2VyLmxvY2FsZUlkXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGtleSwgdWNzLnRleHRWYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNbdGhpcy5sb2NhbGVTZXIubG9jYWxlSWRdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjW3RoaXMubG9jYWxlU2VyLmxvY2FsZUlkXSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oa2V5LCBKU09OLnN0cmluZ2lmeShjKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgKE9iamVjdC5rZXlzKGMpLmluZGV4T2YoJ3ZpZXdDb2x1bW5zJykgPiAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICByZXR1cm4gYztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGJ1aWxkU3VibWl0RGF0YShncmlkSWQ6IHN0cmluZywgc2V0dGluZ3MgPSBudWxsKSB7XHJcbiAgICAgICAgY29uc3QgTE9DQUxFSUQgPSB0aGlzLmxvY2FsZVNlci5sb2NhbGVJZDtcclxuICAgICAgICBpZiAoIXNldHRpbmdzKSB7XHJcbiAgICAgICAgICAgIHNldHRpbmdzID0gdGhpcy5nZXRDdXJyZW50VXNlclNldHRpbmdzKGdyaWRJZCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGxvY2FsZUtleSA9IHRoaXMuY3JlYXRlQ29uZmlnS2V5KGdyaWRJZCk7XHJcbiAgICAgICAgY29uc3QgY3VycmVudENvbmZpZyA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKGxvY2FsZUtleSk7XHJcbiAgICAgICAgY29uc3QgX2NvbmZpZyA9IChjdXJyZW50Q29uZmlnID8gSlNPTi5wYXJzZShjdXJyZW50Q29uZmlnKSA6IHsgfSkgfHwge307XHJcbiAgICAgICAgaWYgKF9jb25maWcpIHtcclxuICAgICAgICAgICAgX2NvbmZpZ1tMT0NBTEVJRF0gPSBzZXR0aW5ncztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBfY29uZmlnO1xyXG4gICAgfVxyXG5cclxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gXFxcXFxyXG5cclxuICAgIHByaXZhdGUgc2hvd1NjaGVtZUxpc3REaWFsb2coZ3JpZEluc3RhbmNlOiBhbnksIHNjaGVtZUxpc3Q6IGFueSwgY2FuRGVsID0gdHJ1ZSkge1xyXG4gICAgICAgIGNvbnN0IG1vZGFsT3B0cyA9IHtcclxuICAgICAgICAgICAgd2lkdGg6IDc2MCwgaGVpZ2h0OiA1NzcsIHNob3dIZWFkZXI6IGZhbHNlLCB0aXRsZTogJ+aOp+WItumdouadvycsXHJcbiAgICAgICAgICAgIGluaXRpYWxTdGF0ZToge1xyXG4gICAgICAgICAgICAgICAgaXRlbXM6IHNjaGVtZUxpc3QgfHwgW10sXHJcbiAgICAgICAgICAgICAgICByZW1vdmVJdGVtOiBjYW5EZWxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgc2hvd0J1dHRvbnM6IGZhbHNlXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgY29uc3Qgc2NoZW1lTGlzdERsZyA9IHRoaXMubW9kYWxTZXIuc2hvdyhTY2hlbWVMaXN0Q29tcG9uZW50LCBtb2RhbE9wdHMpO1xyXG4gICAgICAgIGNvbnN0IGluc3RhbmNlID0gc2NoZW1lTGlzdERsZy5jb250ZW50IGFzIFNjaGVtZUxpc3RDb21wb25lbnQ7XHJcbiAgICAgICAgaW5zdGFuY2UuY2xvc2VNb2RhbC5zdWJzY3JpYmUoICgpID0+IHtcclxuICAgICAgICAgICAgc2NoZW1lTGlzdERsZy5jbG9zZSgpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpbnN0YW5jZS5zdWJtaXRNb2RhbC5zdWJzY3JpYmUoKHQ6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnNjaGVtZVNlcnZpY2UudXBkYXRlU2NoZW1lKHQsIGdyaWRJbnN0YW5jZS5pZCkuc3Vic2NyaWJlKChlOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmKGUgPT09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NoZW1lTGlzdERsZy5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGNvbnN0IG1zZyA9ICfliJforr7nva7mlrnmoYjkv53lrZjmiJDlip/jgIInO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubm90aWZ5U2VydmljZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubm90aWZ5U2VydmljZS5zdWNjZXNzKG1zZyk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubWVzc2FnZXIuc3VjY2Vzcyhtc2cpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IHNjaGVtZUxpc3QgPSB0aGlzLnNjaGVtZVNlcnZpY2UuZ2V0U3RhdGVWYWx1ZShncmlkSW5zdGFuY2UuaWQsICdsaXN0Jyk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYodC5kZWZhdWx0SWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBzY2hlbWVMaXN0LmZvckVhY2gobiA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG4uaXNEZWZhdWx0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuLmlkID09PSB0LmRlZmF1bHRJZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbi5pc0RlZmF1bHQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5zZXRBY3RpdmVTY2hlbWVJdGVtKGdyaWRJbnN0YW5jZS5pZCwgbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBsZXQgbmV3U2NoZW1lTGlzdCA9IHNjaGVtZUxpc3Q7XHJcbiAgICAgICAgICAgICAgICBpZiAodC5kZWxldGVkSWRzICYmIHQuZGVsZXRlZElkcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICBuZXdTY2hlbWVMaXN0ID0gc2NoZW1lTGlzdC5maWx0ZXIobiA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAhdC5kZWxldGVkSWRzLmluY2x1ZGVzKG4uaWQpXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5zY2hlbWVTZXJ2aWNlLnNldFNjaGVtZUxpc3QoZ3JpZEluc3RhbmNlLmlkLCBuZXdTY2hlbWVMaXN0KTtcclxuICAgICAgICAgICAgICAgIHNjaGVtZUxpc3REbGcuY2xvc2UoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGNvbnN0IG1vZGFsQ29udGFpbmVyID0gc2NoZW1lTGlzdERsZy5kaWFsb2cuaW5zdGFuY2UgYXMgTW9kYWxDb250YWluZXJDb21wb25lbnQ7XHJcbiAgICAgICAgbW9kYWxDb250YWluZXIuZHJhZ2diYXIuaGFuZGxlID0gaW5zdGFuY2UuaGVhZGVyLm5hdGl2ZUVsZW1lbnQ7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5paw5aKe5oiW5Y+m5a2Y5pa55qGIXHJcbiAgICBwcml2YXRlIHNob3dOZXdTY2hlbWVEaWFsb2coZ3JpZEluc3RhbmNlLCBzaW1wbGVSZWYgKSB7XHJcbiAgICAgICAgY29uc3QgbW9kYWxPcHRzID0ge1xyXG4gICAgICAgICAgICB3aWR0aDogNDgwLCBoZWlnaHQ6IDI2OSwgc2hvd0hlYWRlcjogZmFsc2UsIHRpdGxlOiAn5o6n5Yi26Z2i5p2/JyxcclxuICAgICAgICAgICAgaW5pdGlhbFN0YXRlOiB7XHJcbiAgICAgICAgICAgICAgICBsYW5ndWFnZXM6IHRoaXMubGFuZ3VhZ2VzXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHNob3dCdXR0b25zOiBmYWxzZSxcclxuICAgICAgICAgICAgcmVzaXphYmxlOiBmYWxzZVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGNvbnN0IG5ld1NjaGVtZURsZyA9IHRoaXMubW9kYWxTZXIuc2hvdyhOZXdTY2hlbWVDb21wb25lbnQsIG1vZGFsT3B0cyk7XHJcbiAgICAgICAgY29uc3QgaW5zdGFuY2UgPSBuZXdTY2hlbWVEbGcuY29udGVudCBhcyBOZXdTY2hlbWVDb21wb25lbnQ7XHJcbiAgICAgICAgaW5zdGFuY2UuY2xvc2VNb2RhbC5zdWJzY3JpYmUoICgpID0+IHtcclxuICAgICAgICAgICAgbmV3U2NoZW1lRGxnLmNsb3NlKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGluc3RhbmNlLnN1Ym1pdE1vZGFsLnBpcGUoXHJcbiAgICAgICAgICAgIHN3aXRjaE1hcCgodDogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVOZXdTY2hlbWUoZ3JpZEluc3RhbmNlLmlkLCB0KTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICApLnN1YnNjcmliZSgodDogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0LmZsYWcgPT09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBtc2cgPSB0Lm1zZyB8fCAn6K+36L6T5YWl5pa55qGI5ZCN56ewJztcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLm5vdGlmeVNlcnZpY2UpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm5vdGlmeVNlcnZpY2UuaW5mbyhtc2cpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm1lc3NhZ2VyLmluZm8obXNnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyDmm7TmlrDmlrnmoYjliJfooahcclxuICAgICAgICAgICAgY29uc3Qgc2NoZW1lTGlzdCA9IHRoaXMuc2NoZW1lU2VydmljZS5nZXRTdGF0ZVZhbHVlKGdyaWRJbnN0YW5jZS5pZCwgJ2xpc3QnKSB8fCBbXTtcclxuICAgICAgICAgICAgaWYgKHQuaXNEZWZhdWx0KSB7XHJcbiAgICAgICAgICAgICAgICBzY2hlbWVMaXN0LmZvckVhY2gobiA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbi5pc0RlZmF1bHQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNjaGVtZUxpc3QucHVzaCh0KTtcclxuICAgICAgICAgICAgdGhpcy5zZXRBY3RpdmVTY2hlbWVJdGVtKGdyaWRJbnN0YW5jZS5pZCwgdCk7XHJcbiAgICAgICAgICAgIHRoaXMuc2NoZW1lU2VydmljZS5zZXRTY2hlbWVMaXN0KGdyaWRJbnN0YW5jZS5pZCwgc2NoZW1lTGlzdCk7XHJcbiAgICAgICAgICAgIG5ld1NjaGVtZURsZy5jbG9zZSgpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpbnN0YW5jZS5jaGVja0F1dGhvcml0eS5waXBlKFxyXG4gICAgICAgICAgICBzd2l0Y2hNYXAoKHQ6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2NoZW1lU2VydmljZS5jaGVja0F1dGhvcml0eSgpLnBpcGUoXHJcbiAgICAgICAgICAgICAgICAgICAgbWFwKChhdXRoOiBTY2hlbWVBdXRoTW9kZWwpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IHQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuLi5hdXRoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICkuc3Vic2NyaWJlKCh0OiBhbnkpID0+IHtcclxuICAgICAgICAgICAgbGV0IGhhc0F1dGhvcml0eSA9IHsgcHVibGljOiB0cnVlLCBvcmc6IHRydWUgfTtcclxuICAgICAgICAgICAgbGV0IG1zZyA9ICfmgqjmsqHmnInlsIbmlrnmoYjnmoTkvb/nlKjojIPlm7Torr7nva7kuLrlhazlhbHnmoTmnYPpmZDjgIInO1xyXG4gICAgICAgICAgICBpZiAodC50eXBlLnZhbHVlID09PSAnb3JnJykge1xyXG4gICAgICAgICAgICAgICAgbXNnID0gJ+aCqOayoeacieWwhuaWueahiOeahOS9v+eUqOiMg+WbtOiuvue9ruS4uue7hOe7h+eahOadg+mZkOOAgic7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHQuc3VjY2Vzcykge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaGFzUHVibGljQXV0aG9yaXR5ID0gdC5hdXRoT3BlcmF0aW9uRGF0YSAmJiB0LmF1dGhPcGVyYXRpb25EYXRhLmxlbmd0aDtcclxuICAgICAgICAgICAgICAgIGhhc0F1dGhvcml0eS5wdWJsaWMgPSBoYXNQdWJsaWNBdXRob3JpdHk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBoYXNPcmdBdXRob3JpdHkgPSB0LmF1dGhPcmdhbml6YXRpb25EYXRhICYmIHQuYXV0aE9yZ2FuaXphdGlvbkRhdGEubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgaGFzQXV0aG9yaXR5Lm9yZyA9IGhhc09yZ0F1dGhvcml0eTtcclxuICAgICAgICAgICAgICAgIGlmICh0LnR5cGUudmFsdWUgPT09ICdwdWJsaWMnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2Uuc2NoZW1lSW5mby50eXBlID0gdC50eXBlLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0LnR5cGUudmFsdWUgPT09ICdvcmcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFoYXNPcmdBdXRob3JpdHkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5ub3RpZnlTZXJ2aWNlLndhcm5pbmcobXNnKTtcclxuICAgICAgICAgICAgICAgICAgICB9ZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGluc3RhbmNlLnNjaGVtZUluZm8udHlwZSA9IHQudHlwZS52YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2Uuc2NoZW1lSW5mby5vcmdpZHMgPSB0LmF1dGhPcmdhbml6YXRpb25EYXRhLmpvaW4oJywnKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZS5kYXRhUGVybWlzc2lvbklkcyA9IHQuYXV0aE9yZ2FuaXphdGlvbkRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5ub3RpZnlTZXJ2aWNlLndhcm5pbmcobXNnKTtcclxuICAgICAgICAgICAgICAgIGhhc0F1dGhvcml0eSA9IHsgcHVibGljOiBmYWxzZSwgb3JnOiBmYWxzZSB9OztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpbnN0YW5jZS5yZWZyZXNoKGhhc0F1dGhvcml0eSk7XHJcbiAgICAgICAgfSlcclxuXHJcbiAgICAgICAgY29uc3QgbW9kYWxDb250YWluZXIgPSBuZXdTY2hlbWVEbGcuZGlhbG9nLmluc3RhbmNlIGFzIE1vZGFsQ29udGFpbmVyQ29tcG9uZW50O1xyXG4gICAgICAgIG1vZGFsQ29udGFpbmVyLmRyYWdnYmFyLmhhbmRsZSA9IGluc3RhbmNlLmhlYWRlci5uYXRpdmVFbGVtZW50O1xyXG4gICAgfVxyXG5cclxuICAgIGdldFNjaGVtZUxpc3QoZ3JpZElkOiBzdHJpbmcpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5zY2hlbWVTZXJ2aWNlLmdldFNjaGVtZUxpc3QoZ3JpZElkKTtcclxuICAgIH1cclxuXHJcbiAgICBjcmVhdGVOZXdTY2hlbWUoZ3JpZElkOiBzdHJpbmcsIGRhdGE6IGFueSkge1xyXG4gICAgICAgIGlmKCFkYXRhLm5hbWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG9mKHtmbGFnOiBmYWxzZSwgbXNnOiAn6K+36L6T5YWl5pa55qGI5ZCN56ewJ30pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGhhc05hbWUgPSB0aGlzLnNjaGVtZVNlcnZpY2UuaGFzU2NoZW1lTmFtZShncmlkSWQsIGRhdGEubmFtZSk7XHJcblxyXG4gICAgICAgICAgICBpZiAodHlwZW9mIGhhc05hbWUgPT09ICdib29sZWFuJyAmJiBoYXNOYW1lKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gb2Yoe2ZsYWc6IGZhbHNlLCBtc2c6ICfmlrnmoYjlkI3np7Dlt7LlrZjlnKjvvIzor7fkv67mlLnjgIInfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShoYXNOYW1lKSAmJiBoYXNOYW1lLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbXNncyA9ICBoYXNOYW1lLm1hcChuID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobiA9PT0gJ3poLUNIUycpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICfnroDkvZPkuK3mloflkI3np7Dlt7LlrZjlnKjjgIInO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZihuID09PSAnemgtQ0hUJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ+e5geS9k+S4reaWh+WQjeensOW3suWtmOWcqOOAgic7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICfoi7HmloflkI3np7Dlt7LlrZjlnKjjgIInO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBvZih7ZmxhZzogZmFsc2UsIG1zZzogbXNncy5qb2luKCcnKX0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCByZXF1aXJlZE5hbWUgPSBbXTtcclxuICAgICAgICB0aGlzLmxhbmd1YWdlcy5mb3JFYWNoKG4gPT4ge1xyXG4gICAgICAgICAgICBpZiAoZGF0YS5uYW1lW24uY29kZV0gPT09ICcnIHx8IGRhdGEubmFtZVtuLmNvZGVdID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIHJlcXVpcmVkTmFtZS5wdXNoKG4uY29kZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaWYgKHJlcXVpcmVkTmFtZS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgY29uc3QgbXNncyA9ICByZXF1aXJlZE5hbWUubWFwKG4gPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKG4gPT09ICd6aC1DSFMnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICfor7fovpPlhaXnroDkvZPkuK3mloflkI3np7DjgIInO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmKG4gPT09ICd6aC1DSFQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICfor7fovpPlhaXnuYHkvZPkuK3mloflkI3np7DjgIInO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ+ivt+i+k+WFpeiLseaWh+WQjeensOOAgic7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gb2Yoe2ZsYWc6IGZhbHNlLCBtc2c6IG1zZ3Muam9pbignJyl9KTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBpZiAoZGF0YS50eXBlICYmIGRhdGEudHlwZSA9PT0gJ29yZycgJiYgKCFkYXRhLm9yZ2lkcyB8fCAhZGF0YS5vcmdpZHMubGVuZ3RoKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gb2Yoe2ZsYWc6IGZhbHNlLCBtc2c6ICfor7fpgInmi6nnu4Tnu4cnfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCBfY29uZmlnID0gbnVsbDtcclxuICAgICAgICBjb25zdCBzZWxlY3RlZFNldHRpbmdzID0gdGhpcy5nZXRDdXJyZW50U2NoZW1lU2V0dGluZ3MoZ3JpZElkKTtcclxuICAgICAgICBpZiAoc2VsZWN0ZWRTZXR0aW5ncykge1xyXG4gICAgICAgICAgICBfY29uZmlnID0gc2VsZWN0ZWRTZXR0aW5ncztcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyDmlLbpm4blvZPliY3mlrnmoYjphY3nva7mlbDmja5cclxuICAgICAgICAgICAgX2NvbmZpZyA9IHRoaXMuYnVpbGRTdWJtaXREYXRhKGdyaWRJZCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBuZXdJZCA9IHRoaXMuaWRTZXJ2aWNlLmd1aWQoKTtcclxuICAgICAgICBsZXQgaXNEZWZhdWx0ID0gZGF0YS5pc0RlZmF1bHQ7XHJcbiAgICAgICAgaWYgKGlzRGVmYXVsdCkge1xyXG4gICAgICAgICAgICBpZiAoZGF0YS50eXBlICE9PSAncHJpdmF0ZScpIHtcclxuICAgICAgICAgICAgICAgIGlzRGVmYXVsdCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoZGF0YS5uYW1lICYmIHR5cGVvZiBkYXRhLm5hbWUgPT09ICdvYmplY3QnKSB7XHJcbiAgICAgICAgICAgIGRhdGEubmFtZSA9IEpTT04uc3RyaW5naWZ5KGRhdGEubmFtZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBzY2hlbWU6IERhdGFncmlkU2NoZW1lTW9kZWwgPSB7XHJcbiAgICAgICAgICAgIGlkOiBuZXdJZCxcclxuICAgICAgICAgICAgYmVsb25nSWQ6ICcnLFxyXG4gICAgICAgICAgICBjb2RlOiAnJyxcclxuICAgICAgICAgICAgbmFtZTogZGF0YS5uYW1lLFxyXG4gICAgICAgICAgICB0eXBlOiBkYXRhLnR5cGUsXHJcbiAgICAgICAgICAgIGlzRGVmYXVsdDogaXNEZWZhdWx0LFxyXG4gICAgICAgICAgICBpc1N5c3RlbTogZmFsc2UsXHJcbiAgICAgICAgICAgIGV4dGVuZElkOiAnZGF0YWdyaWQtc2V0dGluZ3Mtc2NoZW1lJyxcclxuICAgICAgICAgICAgZXh0ZW5kSW5mbzogdGhpcy5idWlsZE9yZ0FuZFNjaGVtZVJlbGF0aW9ucyhuZXdJZCwgZGF0YS5vcmdpZHMpLFxyXG4gICAgICAgICAgICBxdWVyeUNvbmRpdGlvblN0cmluZzogX2NvbmZpZz8gSlNPTi5zdHJpbmdpZnkoX2NvbmZpZyk6ICcnLFxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLnNjaGVtZVNlcnZpY2Uuc2F2ZVNjaGVtZShzY2hlbWUsIGdyaWRJZCkucGlwZShcclxuICAgICAgICAgICAgbWFwKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBzY2hlbWU7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRTY2hlbWVMaXN0KHNjaGVtZUxpc3Q6IERhdGFncmlkU2NoZW1lTW9kZWxbXSwgZ3JpZElkOiBzdHJpbmcpIHtcclxuICAgICAgICB0aGlzLnNjaGVtZVNlcnZpY2UudXBkYXRlKHtsaXN0OiBzY2hlbWVMaXN0fSwgZ3JpZElkKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGJ1aWxkT3JnQW5kU2NoZW1lUmVsYXRpb25zKHNjaGVtZUlkOiBzdHJpbmcsIG9yZ0lkczogc3RyaW5nW10pIHtcclxuICAgICAgICBpZiAoIW9yZ0lkcyB8fCAhb3JnSWRzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICByZXR1cm4gIFtdO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gb3JnSWRzLm1hcChuID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIGlkOiB0aGlzLmlkU2VydmljZS5ndWlkKCksXHJcbiAgICAgICAgICAgICAgICBvcmdJZDogbixcclxuICAgICAgICAgICAgICAgIHJlbGF0ZWRJZDogc2NoZW1lSWRcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0Q3VycmVudFNjaGVtZVNldHRpbmdzKGdyaWRJZDogc3RyaW5nKTogU2V0dGluZ01vZGVsIHtcclxuICAgICAgICBjb25zdCBhY3RpdmVTY2hlbWUgPSB0aGlzLmdldEFjdGl2ZVNjaGVtZUl0ZW0oZ3JpZElkKSBhcyBEYXRhZ3JpZFNjaGVtZU1vZGVsO1xyXG4gICAgICAgIGlmIChhY3RpdmVTY2hlbWUgJiYgYWN0aXZlU2NoZW1lLnF1ZXJ5Q29uZGl0aW9uU3RyaW5nKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBKU09OLnBhcnNlKGFjdGl2ZVNjaGVtZS5xdWVyeUNvbmRpdGlvblN0cmluZyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==