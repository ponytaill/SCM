import { Injectable } from '@angular/core';
import { FrameContext, BindingList } from '@farris/devkit';
import { EntityTraversingService } from './entity-traversing.service';
/**
 * 实体聚合服务
 */
class EntityAggregationService {
    constructor(frameContext) {
        this.frameContext = frameContext;
        this.traversingService = this.frameContext.injector.get(EntityTraversingService);
    }
    get bindingData() {
        return this.frameContext.bindingData;
    }
    /**
     * 获取path对应列表记录的条数
     */
    count(path) {
        const splitedPath = this.splitPath(path);
        const entityListData = this.traversingService.getEntityListData(splitedPath.listPath);
        return entityListData.length;
    }
    /**
     * 获取path对应字段的和
     */
    sum(path) {
        const splitedPath = this.splitPath(path);
        const entityListData = this.traversingService.getEntityListData(splitedPath.listPath);
        const total = entityListData.reduce((accTotal, entityData) => {
            let propValue = parseFloat(this.getPropValue(entityData, splitedPath.propPath));
            propValue = isNaN(propValue) ? 0 : propValue;
            accTotal += propValue;
            return accTotal;
        }, 0);
        return total;
    }
    /**
     * 获取path对应字段的平均值
     */
    avg(path) {
        const count = this.count(path);
        const total = this.sum(path);
        return count !== 0 ? total / count : 0;
    }
    /**
     * 获取path对应字段的最大值
     */
    max(path) {
        const splitedPath = this.splitPath(path);
        const entityListData = this.traversingService.getEntityListData(splitedPath.listPath);
        const max = entityListData.reduce((accMax, entityData) => {
            const propValue = parseFloat(this.getPropValue(entityData, splitedPath.propPath));
            if (isNaN(propValue) === false && (!accMax || propValue > accMax)) {
                accMax = propValue;
            }
            return accMax;
        }, null);
        return max ? max : 0;
    }
    /**
     * 获取path对应字段的最小值
     */
    min(path) {
        const splitedPath = this.splitPath(path);
        const entityListData = this.traversingService.getEntityListData(splitedPath.listPath);
        const min = entityListData.reduce((accMin, entityData) => {
            const propValue = parseFloat(this.getPropValue(entityData, splitedPath.propPath));
            if (isNaN(propValue) === false && (!accMin || propValue < accMin)) {
                accMin = propValue;
            }
            return accMin;
        }, null);
        return min ? min : 0;
    }
    /**
     * 获取属性值
     */
    getPropValue(entityData, path) {
        let currentData = entityData;
        path.forEach((pathItem) => {
            // 提前退出的都重置为null，主要针对关联对象未赋值场景
            if (!currentData) {
                currentData = null;
                return;
            }
            currentData = currentData[pathItem];
        });
        return currentData;
    }
    /**
     * 分隔路径，分隔符列表路径和属性路径
     * @return 形如 {parentListPath: [], propertyPath: []}
     */
    splitPath(path) {
        const listPath = path.concat([]);
        const propPath = [];
        let currentNode = this.bindingData.getValue(listPath);
        while (currentNode instanceof BindingList !== true) {
            const propPathItem = listPath.pop();
            if (!propPathItem) {
                return;
            }
            propPath.unshift(propPathItem);
            currentNode = this.bindingData.getValue(listPath);
        }
        return {
            listPath: listPath,
            propPath: propPath
        };
    }
}
EntityAggregationService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
EntityAggregationService.ctorParameters = () => [
    { type: FrameContext }
];
export { EntityAggregationService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW50aXR5LWFnZ3JlZ2F0aW9uLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2NvbW1hbmQtc2VydmljZXMvIiwic291cmNlcyI6WyJsaWIvZW50aXR5LXNlcnZpY2VzL2VudGl0eS1hZ2dyZWdhdGlvbi5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLFlBQVksRUFBZSxXQUFXLEVBQWlCLE1BQU0sZ0JBQWdCLENBQUM7QUFDdkYsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFPdEU7O0dBRUc7QUFDSCxNQUNNLHdCQUF3QjtJQVE1QixZQUFvQixZQUEwQjtRQUExQixpQkFBWSxHQUFaLFlBQVksQ0FBYztRQUM1QyxJQUFJLENBQUMsaUJBQWlCLEdBQUssSUFBSSxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUEwQix1QkFBdUIsQ0FBQyxDQUFDO0lBQzlHLENBQUM7SUFSRCxJQUFZLFdBQVc7UUFDckIsT0FBTyxJQUFJLENBQUMsWUFBWSxDQUFDLFdBQVcsQ0FBQztJQUN2QyxDQUFDO0lBUUQ7O09BRUc7SUFDSSxLQUFLLENBQUMsSUFBYztRQUN6QixNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3pDLE1BQU0sY0FBYyxHQUFHLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxpQkFBaUIsQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDdEYsT0FBTyxjQUFjLENBQUMsTUFBTSxDQUFDO0lBQy9CLENBQUM7SUFFRDs7T0FFRztJQUNJLEdBQUcsQ0FBQyxJQUFjO1FBQ3ZCLE1BQU0sV0FBVyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDekMsTUFBTSxjQUFjLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixDQUFD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LFVBQWUsRUFBRSxJQUFjO1FBQ2xELElBQUksV0FBVyxHQUFHLFVBQVUsQ0FBQztRQUM3QixJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsUUFBZ0IsRUFBRSxFQUFFO1lBRWhDLDhCQUE4QjtZQUM5QixJQUFJLENBQUMsV0FBVyxFQUFFO2dCQUNoQixXQUFXLEdBQUcsSUFBSSxDQUFDO2dCQUNuQixPQUFPO2FBQ1I7WUFDRCxXQUFXLEdBQUcsV0FBVyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ3RDLENBQUMsQ0FBQyxDQUFDO1FBRUgsT0FBTyxXQUFXLENBQUM7SUFDckIsQ0FBQztJQUVEOzs7T0FHRztJQUNLLFNBQVMsQ0FBQyxJQUFjO1FBQzlCLE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDakMsTUFBTSxRQUFRLEdBQUcsRUFBRSxDQUFDO1FBQ3BCLElBQUksV0FBVyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ3RELE9BQU8sV0FBVyxZQUFZLFdBQVcsS0FBSyxJQUFJLEVBQUU7WUFDbEQsTUFBTSxZQUFZLEdBQUcsUUFBUSxDQUFDLEdBQUcsRUFBRSxDQUFDO1lBQ3BDLElBQUksQ0FBQyxZQUFZLEVBQUU7Z0JBQ2pCLE9BQU87YUFDUjtZQUNELFFBQVEsQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUM7WUFDL0IsV0FBVyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1NBQ25EO1FBRUQsT0FBTztZQUNMLFFBQVEsRUFBRSxRQUFRO1lBQ2xCLFFBQVEsRUFBRSxRQUFRO1NBQ25CLENBQUM7SUFDSixDQUFDOzs7WUF4SEYsVUFBVTs7OztZQVhGLFlBQVk7O0FBdUlyQixPQUFPLEVBQUUsd0JBQXdCLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEZyYW1lQ29udGV4dCwgQmluZGluZ0RhdGEsIEJpbmRpbmdMaXN0LCBCaW5kaW5nT2JqZWN0IH0gZnJvbSAnQGZhcnJpcy9kZXZraXQnO1xuaW1wb3J0IHsgRW50aXR5VHJhdmVyc2luZ1NlcnZpY2UgfSBmcm9tICcuL2VudGl0eS10cmF2ZXJzaW5nLnNlcnZpY2UnO1xuXG5pbnRlcmZhY2UgU3BsaXRlZFBhdGgge1xuICBsaXN0UGF0aDogc3RyaW5nW107XG4gIHByb3BQYXRoOiBzdHJpbmdbXTtcbn1cblxuLyoqXG4gKiDlrp7kvZPogZrlkIjmnI3liqFcbiAqL1xuQEluamVjdGFibGUoKVxuY2xhc3MgRW50aXR5QWdncmVnYXRpb25TZXJ2aWNlIHtcblxuICBwcml2YXRlIGdldCBiaW5kaW5nRGF0YSgpOiBCaW5kaW5nRGF0YSB7XG4gICAgcmV0dXJuIHRoaXMuZnJhbWVDb250ZXh0LmJpbmRpbmdEYXRhO1xuICB9XG5cbiAgcHJpdmF0ZSB0cmF2ZXJzaW5nU2VydmljZTogRW50aXR5VHJhdmVyc2luZ1NlcnZpY2U7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBmcmFtZUNvbnRleHQ6IEZyYW1lQ29udGV4dCkge1xuICAgIHRoaXMudHJhdmVyc2luZ1NlcnZpY2UgICA9IHRoaXMuZnJhbWVDb250ZXh0LmluamVjdG9yLmdldDxFbnRpdHlUcmF2ZXJzaW5nU2VydmljZT4oRW50aXR5VHJhdmVyc2luZ1NlcnZpY2UpO1xuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPlnBhdGjlr7nlupTliJfooajorrDlvZXnmoTmnaHmlbBcbiAgICovXG4gIHB1YmxpYyBjb3VudChwYXRoOiBzdHJpbmdbXSk6IG51bWJlciB7XG4gICAgY29uc3Qgc3BsaXRlZFBhdGggPSB0aGlzLnNwbGl0UGF0aChwYXRoKTtcbiAgICBjb25zdCBlbnRpdHlMaXN0RGF0YSA9IHRoaXMudHJhdmVyc2luZ1NlcnZpY2UuZ2V0RW50aXR5TGlzdERhdGEoc3BsaXRlZFBhdGgubGlzdFBhdGgpO1xuICAgIHJldHVybiBlbnRpdHlMaXN0RGF0YS5sZW5ndGg7XG4gIH1cblxuICAvKipcbiAgICog6I635Y+WcGF0aOWvueW6lOWtl+auteeahOWSjFxuICAgKi9cbiAgcHVibGljIHN1bShwYXRoOiBzdHJpbmdbXSkge1xuICAgIGNvbnN0IHNwbGl0ZWRQYXRoID0gdGhpcy5zcGxpdFBhdGgocGF0aCk7XG4gICAgY29uc3QgZW50aXR5TGlzdERhdGEgPSB0aGlzLnRyYXZlcnNpbmdTZXJ2aWNlLmdldEVudGl0eUxpc3REYXRhKHNwbGl0ZWRQYXRoLmxpc3RQYXRoKTtcblxuICAgIGNvbnN0IHRvdGFsID0gZW50aXR5TGlzdERhdGEucmVkdWNlKChhY2NUb3RhbDogbnVtYmVyLCBlbnRpdHlEYXRhOiBhbnkpID0+IHtcbiAgICAgIGxldCBwcm9wVmFsdWUgPSBwYXJzZUZsb2F0KHRoaXMuZ2V0UHJvcFZhbHVlKGVudGl0eURhdGEsIHNwbGl0ZWRQYXRoLnByb3BQYXRoKSk7XG4gICAgICBwcm9wVmFsdWUgPSBpc05hTihwcm9wVmFsdWUpID8gMCA6IHByb3BWYWx1ZTtcbiAgICAgIGFjY1RvdGFsICs9IHByb3BWYWx1ZTtcbiAgICAgIHJldHVybiBhY2NUb3RhbDtcbiAgICB9LCAwKTtcbiAgICByZXR1cm4gdG90YWw7XG4gIH1cblxuICAvKipcbiAgICog6I635Y+WcGF0aOWvueW6lOWtl+auteeahOW5s+Wdh+WAvFxuICAgKi9cbiAgcHVibGljIGF2ZyhwYXRoOiBzdHJpbmdbXSkge1xuICAgIGNvbnN0IGNvdW50ID0gdGhpcy5jb3VudChwYXRoKTtcbiAgICBjb25zdCB0b3RhbCA9IHRoaXMuc3VtKHBhdGgpO1xuICAgIHJldHVybiBjb3VudCAhPT0gMCA/IHRvdGFsIC8gY291bnQgOiAwO1xuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPlnBhdGjlr7nlupTlrZfmrrXnmoTmnIDlpKflgLxcbiAgICovXG4gIHB1YmxpYyBtYXgocGF0aDogc3RyaW5nW10pOiBudW1iZXIge1xuICAgIGNvbnN0IHNwbGl0ZWRQYXRoID0gdGhpcy5zcGxpdFBhdGgocGF0aCk7XG4gICAgY29uc3QgZW50aXR5TGlzdERhdGEgPSB0aGlzLnRyYXZlcnNpbmdTZXJ2aWNlLmdldEVudGl0eUxpc3REYXRhKHNwbGl0ZWRQYXRoLmxpc3RQYXRoKTtcblxuICAgIGNvbnN0IG1heCA9ICBlbnRpdHlMaXN0RGF0YS5yZWR1Y2UoKGFjY01heDogbnVtYmVyLCBlbnRpdHlEYXRhOiBhbnkpID0+IHtcbiAgICAgIGNvbnN0IHByb3BWYWx1ZSA9IHBhcnNlRmxvYXQodGhpcy5nZXRQcm9wVmFsdWUoZW50aXR5RGF0YSwgc3BsaXRlZFBhdGgucHJvcFBhdGgpKTtcbiAgICAgIGlmIChpc05hTihwcm9wVmFsdWUpID09PSBmYWxzZSAmJiAoICFhY2NNYXggfHwgcHJvcFZhbHVlID4gYWNjTWF4KSkge1xuICAgICAgICBhY2NNYXggPSBwcm9wVmFsdWU7XG4gICAgICB9XG4gICAgICByZXR1cm4gYWNjTWF4O1xuICAgIH0sIG51bGwpO1xuICAgIHJldHVybiBtYXggPyBtYXggOiAwO1xuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPlnBhdGjlr7nlupTlrZfmrrXnmoTmnIDlsI/lgLxcbiAgICovXG4gIHB1YmxpYyBtaW4ocGF0aDogc3RyaW5nW10pOiBudW1iZXIge1xuICAgIGNvbnN0IHNwbGl0ZWRQYXRoID0gdGhpcy5zcGxpdFBhdGgocGF0aCk7XG4gICAgY29uc3QgZW50aXR5TGlzdERhdGEgPSB0aGlzLnRyYXZlcnNpbmdTZXJ2aWNlLmdldEVudGl0eUxpc3REYXRhKHNwbGl0ZWRQYXRoLmxpc3RQYXRoKTtcblxuICAgIGNvbnN0IG1pbiA9IGVudGl0eUxpc3REYXRhLnJlZHVjZSgoYWNjTWluOiBudW1iZXIsIGVudGl0eURhdGE6IGFueSkgPT4ge1xuICAgICAgY29uc3QgcHJvcFZhbHVlID0gcGFyc2VGbG9hdCh0aGlzLmdldFByb3BWYWx1ZShlbnRpdHlEYXRhLCBzcGxpdGVkUGF0aC5wcm9wUGF0aCkpO1xuICAgICAgaWYgKGlzTmFOKHByb3BWYWx1ZSkgPT09IGZhbHNlICYmICggIWFjY01pbiB8fCBwcm9wVmFsdWUgPCBhY2NNaW4pKSB7XG4gICAgICAgIGFjY01pbiA9IHByb3BWYWx1ZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBhY2NNaW47XG4gICAgfSwgbnVsbCk7XG4gICAgcmV0dXJuIG1pbiA/IG1pbiA6IDA7XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W5bGe5oCn5YC8XG4gICAqL1xuICBwcml2YXRlIGdldFByb3BWYWx1ZShlbnRpdHlEYXRhOiBhbnksIHBhdGg6IHN0cmluZ1tdKSB7XG4gICAgbGV0IGN1cnJlbnREYXRhID0gZW50aXR5RGF0YTtcbiAgICBwYXRoLmZvckVhY2goKHBhdGhJdGVtOiBzdHJpbmcpID0+IHtcblxuICAgICAgLy8g5o+Q5YmN6YCA5Ye655qE6YO96YeN572u5Li6bnVsbO+8jOS4u+imgemSiOWvueWFs+iBlOWvueixoeacqui1i+WAvOWcuuaZr1xuICAgICAgaWYgKCFjdXJyZW50RGF0YSkge1xuICAgICAgICBjdXJyZW50RGF0YSA9IG51bGw7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGN1cnJlbnREYXRhID0gY3VycmVudERhdGFbcGF0aEl0ZW1dO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIGN1cnJlbnREYXRhO1xuICB9XG5cbiAgLyoqXG4gICAqIOWIhumalOi3r+W+hO+8jOWIhumalOespuWIl+ihqOi3r+W+hOWSjOWxnuaAp+i3r+W+hFxuICAgKiBAcmV0dXJuIOW9ouWmgiB7cGFyZW50TGlzdFBhdGg6IFtdLCBwcm9wZXJ0eVBhdGg6IFtdfVxuICAgKi9cbiAgcHJpdmF0ZSBzcGxpdFBhdGgocGF0aDogc3RyaW5nW10pOiBTcGxpdGVkUGF0aCB7XG4gICAgY29uc3QgbGlzdFBhdGggPSBwYXRoLmNvbmNhdChbXSk7XG4gICAgY29uc3QgcHJvcFBhdGggPSBbXTtcbiAgICBsZXQgY3VycmVudE5vZGUgPSB0aGlzLmJpbmRpbmdEYXRhLmdldFZhbHVlKGxpc3RQYXRoKTtcbiAgICB3aGlsZSAoY3VycmVudE5vZGUgaW5zdGFuY2VvZiBCaW5kaW5nTGlzdCAhPT0gdHJ1ZSkge1xuICAgICAgY29uc3QgcHJvcFBhdGhJdGVtID0gbGlzdFBhdGgucG9wKCk7XG4gICAgICBpZiAoIXByb3BQYXRoSXRlbSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBwcm9wUGF0aC51bnNoaWZ0KHByb3BQYXRoSXRlbSk7XG4gICAgICBjdXJyZW50Tm9kZSA9IHRoaXMuYmluZGluZ0RhdGEuZ2V0VmFsdWUobGlzdFBhdGgpO1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICBsaXN0UGF0aDogbGlzdFBhdGgsXG4gICAgICBwcm9wUGF0aDogcHJvcFBhdGhcbiAgICB9O1xuICB9XG5cbn1cblxuZXhwb3J0IHsgRW50aXR5QWdncmVnYXRpb25TZXJ2aWNlIH07XG4iXX0=