/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
/*
* @Author: 疯狂秀才(Lucas Huang)
* @Date: 2018-12-14 14:40:48
 * @LastEditors: 疯狂秀才(Lucas Huang)
 * @LastEditTime: 2019-09-25 18:10:29
* @Company: Inspur
* @Version: v0.0.1
*/
import { Component, ViewChild, ViewContainerRef, EventEmitter, Output, ComponentFactoryResolver, ChangeDetectorRef } from '@angular/core';
import { of } from 'rxjs';
import { DataTableComponent } from '@farris/ui-datatable';
import { TreeTableComponent } from '@farris/ui-treetable';
import { switchMap } from 'rxjs/operators';
var LookupLeftComponent = /** @class */ (function () {
    function LookupLeftComponent(cfr, cd) {
        this.cfr = cfr;
        this.cd = cd;
        this.selected = new EventEmitter();
        this.unselected = new EventEmitter();
        this.search = new EventEmitter();
        this.pageChanged = new EventEmitter();
        this._searchState = null;
        this._sortState = null;
        this.allData = null;
    }
    /**
     * @return {?}
     */
    LookupLeftComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.lookupCmp && this.isTreeList()) {
            this.lookupCmp.includeSubordinates$$ = this.lookupCmp.includeSubordinates$.subscribe((/**
             * @param {?} val
             * @return {?}
             */
            function (val) {
                if (_this.cmpRef) {
                    /** @type {?} */
                    var tt = (/** @type {?} */ (_this.cmpRef.instance));
                    if (tt.selectedRow) {
                        _this.selected.emit({ data: tt.selectedRow.data, node: tt.selectedRow });
                    }
                }
            }));
        }
    };
    /**
     * @return {?}
     */
    LookupLeftComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this._searchState = null;
        this._sortState = null;
    };
    /**
     * @return {?}
     */
    LookupLeftComponent.prototype.createComponent = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var dtFac = null;
        if (!this.isTreeList()) {
            dtFac = this.cfr.resolveComponentFactory(DataTableComponent);
        }
        else {
            dtFac = this.cfr.resolveComponentFactory(TreeTableComponent);
        }
        this.navOptions['keepSelect'] = false;
        // 左侧查询过滤条，隐藏掉；
        this.navOptions['showFilterBar'] = true;
        // if (this.navOptions.width) {
        //     this.navOptions.width = this.navOptions.width - 2;
        // }
        this.navOptions.width = this.lookupCmp.leftPanelWidth - 2;
        // const injector: Injector = ReflectiveInjector.resolveAndCreate([
        //     { provide: DataTableService, useFactory: () => { new DataTableService()}}
        // ]);
        this.cmpRef = this.cmpContainer.createComponent(dtFac);
        if (!this.isTreeList()) {
            this.navOptions['fill'] = true;
            this.cmpRef.instance.maxSize = 5;
            this.cmpRef.instance.fill = true;
        }
        else {
            this.navOptions['fit'] = true;
        }
        // this.cmpRef.instance.fit = true;
        if (this.navOptions.pageInfo) {
            if (this.navOptions.pageInfo.pageList) {
                this.navOptions.pageList = this.navOptions.pageInfo.pageList;
            }
            this.navOptions.pagination = this.navOptions.pageInfo.enablePager;
            this.navOptions.pageIndex = this.navOptions.pageInfo.pageIndex;
            this.navOptions.pageSize = this.navOptions.pageInfo.pageSize;
        }
        else {
            this.navOptions.pagination = false;
        }
        Object.assign(this.cmpRef.instance, this.navOptions);
        this.loadData();
        return of(this.cmpRef);
    };
    /**
     * @return {?}
     */
    LookupLeftComponent.prototype.update = /**
     * @return {?}
     */
    function () {
        this.cd.detectChanges();
    };
    /**
     * @param {?=} size
     * @return {?}
     */
    LookupLeftComponent.prototype.resize = /**
     * @param {?=} size
     * @return {?}
     */
    function (size) {
        if (size) {
            size.width = size.width - 2;
            // if (this.cmpRef.instance instanceof TreeTableComponent) {
            //     size.height += 46;
            // }
            this.cmpRef.instance.resize(size);
        }
    };
    /**
     * @return {?}
     */
    LookupLeftComponent.prototype.isTreeList = /**
     * @return {?}
     */
    function () {
        return this.navOptions.displayType.toLowerCase() === 'treelist' && !this.lookupCmp.navTreeToList;
    };
    /**
     * @private
     * @param {?} items
     * @param {?} dt
     * @return {?}
     */
    LookupLeftComponent.prototype.selectLeftDataTableRow = /**
     * @private
     * @param {?} items
     * @param {?} dt
     * @return {?}
     */
    function (items, dt) {
        var _this = this;
        if (items && items.length) {
            /** @type {?} */
            var item = null;
            if (this.lookupCmp.navSelectedIds) {
                item = items.find((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return n[dt.idField] == _this.lookupCmp.navSelectedIds; }));
            }
            else {
                if (this.lookupCmp.selectFirstInNav) {
                    item = items[0];
                }
            }
            if (item) {
                dt.dtBody.selectedRowIndex = -1;
                dt.dtBody.selectedRow('', 0, item);
            }
        }
    };
    /**
     * @private
     * @return {?}
     */
    LookupLeftComponent.prototype.closeLoading = /**
     * @private
     * @return {?}
     */
    function () {
        this.lookupCmp.closeLoading();
    };
    /**
     * @private
     * @param {?} dt
     * @return {?}
     */
    LookupLeftComponent.prototype.initDataTable = /**
     * @private
     * @param {?} dt
     * @return {?}
     */
    function (dt) {
        var _this = this;
        dt.loadData({
            pageSize: this.navOptions.pageSize,
            pageIndex: this.navOptions.pageIndex,
            total: this.navOptions.total,
            data: this.navOptions.items,
        });
        dt.resize({ width: 320, height: this.navOptions.height });
        // 行选中
        dt.selectedRow.subscribe((/**
         * @param {?} d
         * @return {?}
         */
        function (d) {
            _this.selected.emit({ data: d.data });
        }));
        dt.unSelectRow.subscribe((/**
         * @param {?} d
         * @return {?}
         */
        function (d) {
            _this.selected.emit(null);
        }));
        /** @type {?} */
        var p = { pageInfo: { pageIndex: 1, pageSize: this.navOptions.pageSize }, search: '' };
        /** @type {?} */
        var loadTableData = {
            next: (/**
             * @param {?} data
             * @return {?}
             */
            function (data) {
                _this.closeLoading();
                dataTableReLoad(data);
            }),
            error: (/**
             * @param {?} err
             * @return {?}
             */
            function (err) {
                _this.closeLoading();
            })
        };
        // 查询
        dt.search.subscribe((/**
         * @param {?} searchData
         * @return {?}
         */
        function (searchData) {
            _this._searchState = searchData;
            _this.search.emit(searchData);
            p.search = searchData;
            p.pageInfo.pageSize = dt.pageSize;
            _this.lookupCmp.navigationFilter = null;
            if (_this._sortState && _this._sortState.sortName) {
                p['sortName'] = _this._sortState.sortName;
                p['sortOrder'] = _this._sortState.sortOrder;
            }
            else {
                delete p['sortName'];
                delete p['sortOrder'];
            }
            _this.lookupCmp.httpMgr.getData(p, 'navsearch').subscribe(loadTableData);
        }));
        /** @type {?} */
        var dataTableReLoad = (/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            dt.loadData({
                pageSize: data.pageInfo.pageSize,
                pageIndex: data.pageInfo.pageIndex,
                total: data.total,
                data: data.items,
            });
            _this.selectLeftDataTableRow(data.items, dt);
            dt.cd.markForCheck();
        });
        // 分页
        dt.pageChanged.subscribe((/**
         * @param {?} d
         * @return {?}
         */
        function (d) {
            _this.pageChanged.emit(d);
            _this.lookupCmp.navigationFilter = null;
            _this.lookupCmp.httpMgr.getData(d, 'navsearch').subscribe(loadTableData);
        }));
        dt.pageSizeChanged.subscribe((/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            _this.lookupCmp.navigationFilter = null;
            _this.lookupCmp.httpMgr.getData(e, 'navsearch').subscribe(loadTableData);
        }));
        dt.columnSorted.subscribe((/**
         * @param {?} sort
         * @return {?}
         */
        function (sort) {
            var _a = tslib_1.__assign({}, sort), sortName = _a.sortName, sortOrder = _a.sortOrder;
            _this._sortState = sort;
            _this.lookupCmp.navigationFilter = null;
            /** @type {?} */
            var param = {
                sortName: sortName,
                sortOrder: sortOrder,
                search: _this._searchState,
                pageInfo: {
                    pageSize: dt.pageSize,
                    pageIndex: 1
                }
            };
            _this.lookupCmp.httpMgr.getData(param, 'navsearch').subscribe(loadTableData);
        }));
        dt.clearSearchValue.subscribe((/**
         * @return {?}
         */
        function () {
            _this._searchState = null;
        }));
        this.selectLeftDataTableRow(this.navOptions.items, dt);
    };
    /**
     * @private
     * @param {?} params
     * @return {?}
     */
    LookupLeftComponent.prototype.buildParams = /**
     * @private
     * @param {?} params
     * @return {?}
     */
    function (params) {
        return tslib_1.__assign({}, params, { treeToList: this.lookupCmp.treeToList, navTreeToList: this.lookupCmp.navTreeToList });
    };
    /**
     * @private
     * @param {?} tt
     * @return {?}
     */
    LookupLeftComponent.prototype.initTreeTable = /**
     * @private
     * @param {?} tt
     * @return {?}
     */
    function (tt) {
        var _this = this;
        tt.virtualized = true;
        tt.fast = true;
        tt.nodeSelected.subscribe((/**
         * @param {?} d
         * @return {?}
         */
        function (d) {
            _this.selected.emit({ data: d.node.data, node: d.node });
        }));
        tt.nodeUnSelect.subscribe((/**
         * @param {?} d
         * @return {?}
         */
        function (d) {
            _this.selected.emit(null);
        }));
        tt.fixedHeader = true;
        // tt.fit = true;
        this.lookupCmp.treeNodeHelper.updateTreeNodeExpanded(this.navOptions.items, this.navOptions.treeInfo);
        tt.loadDataType = this.navOptions.treeInfo.loadDataType;
        // 检查完整树过滤条件 By Lucas 20200302
        this.navOptions.items = this.lookupCmp.checkNodeCanBeSelect(this.navOptions.items, this.navOptions.treeInfo.loadDataType === 'all');
        tt.loadData(this.navOptions.items);
        if (this.lookupCmp.navSelectedIds) {
            tt.selectNode(this.lookupCmp.navSelectedIds);
        }
        else if (this.lookupCmp.selectFirstInNav) {
            tt.selectFirstNode();
        }
        this.allData = this.navOptions.items;
        /** @type {?} */
        var loadTreeData = {
            next: (/**
             * @param {?} resData
             * @return {?}
             */
            function (resData) {
                _this.closeLoading();
                tt.clearAll();
                /** @type {?} */
                var items = _this.lookupCmp.checkNodeCanBeSelect(resData.items, _this.navOptions.treeInfo.loadDataType === 'all' && (!_this._searchState || !_this._searchState.value));
                if (items && items.length && items[0].children && items[0].children.length) {
                    items[0].expanded = true;
                    items[0].children = _this.lookupCmp.expandFirstNode(items[0].children);
                }
                tt.loadData(items);
                tt.resize();
            }),
            error: (/**
             * @param {?} err
             * @return {?}
             */
            function (err) {
                _this.closeLoading();
            })
        };
        tt.search.subscribe((/**
         * @param {?} search
         * @return {?}
         */
        function (search) {
            _this._searchState = search;
            _this.lookupCmp.navigationFilter = null;
            /** @type {?} */
            var p = _this.buildParams({ search: search });
            if (_this._sortState && _this._sortState.sortName) {
                p['sortName'] = _this._sortState.sortName;
                p['sortOrder'] = _this._sortState.sortOrder;
            }
            _this.lookupCmp.httpMgr.getData(p, 'navsearch').subscribe(loadTreeData);
        }));
        tt.columnSorted.subscribe((/**
         * @param {?} sort
         * @return {?}
         */
        function (sort) {
            _this.lookupCmp.navigationFilter = null;
            if (tt.loadDataType === 'all') {
                tt.clientSort();
            }
            else {
                var _a = tslib_1.__assign({}, sort), sortName = _a.sortName, sortOrder = _a.sortOrder;
                _this._sortState = sort;
                // const param = Object.assign({ sortName, sortOrder }, this._searchState);
                /** @type {?} */
                var param = _this.buildParams({ sortName: sortName, sortOrder: sortOrder, search: _this._searchState });
                /** @type {?} */
                var requestType = 'nav';
                if (_this._searchState && _this._searchState.value) {
                    requestType = 'navsearch';
                }
                _this.lookupCmp.httpMgr.getData(param, requestType).subscribe(loadTreeData);
            }
        }));
        tt.clearSearchValue.subscribe((/**
         * @return {?}
         */
        function () {
            _this._searchState = null;
            if (!_this._sortState || !_this._sortState.sortName) {
                tt.loadData(_this.allData);
            }
            else {
                /** @type {?} */
                var p = _this.buildParams({});
                if (_this._sortState && _this._sortState.sortName) {
                    p['sortName'] = _this._sortState.sortName;
                    p['sortOrder'] = _this._sortState.sortOrder;
                }
                _this.lookupCmp.httpMgr.getData(p, 'nav').subscribe(loadTreeData);
            }
        }));
        tt.expand.subscribe((/**
         * @param {?} tn
         * @return {?}
         */
        function (tn) {
            _this.onNodeExpanded(tn, tt);
        }));
    };
    /**
     * @private
     * @param {?} tn
     * @param {?} tt
     * @return {?}
     */
    LookupLeftComponent.prototype.onNodeExpanded = /**
     * @private
     * @param {?} tn
     * @param {?} tt
     * @return {?}
     */
    function (tn, tt) {
        var _this = this;
        if (tn.leaf) {
            return;
        }
        if (!tn.children || !tn.children.length) {
            /** @type {?} */
            var treeInfo = this.navOptions.treeInfo;
            if (this.navOptions.treeInfo.loadDataType === 'async') {
                /** @type {?} */
                var parentPath_1 = '';
                /** @type {?} */
                var parentLayer_1 = -1;
                var _a = tslib_1.__assign({}, tt.searchData), _b = _a.field, field = _b === void 0 ? '*' : _b, _c = _a.value, value = _c === void 0 ? '' : _c;
                tn['showLoading'] = true;
                tt.detectChanges();
                if (treeInfo.layerType === 'parentId') {
                    // 父ID加载方式
                    parentPath_1 = tn['id'];
                }
                else {
                    /** @type {?} */
                    var treeInfoField = treeInfo.dataField;
                    if (treeInfoField) {
                        // parentPath = tn.data[treeInfoField][treeInfo.pathField];
                        // parentLayer = tn.data[treeInfoField][treeInfo.layerField];
                        parentPath_1 = this.lookupCmp.getPathCode(tn.data, treeInfo);
                        parentLayer_1 = this.lookupCmp.getLayerData(tn.data, treeInfo);
                    }
                    else {
                        console.log('未找到分级信息。');
                    }
                }
                if (!this.lookupCmp.uri) {
                    this.lookupCmp.expandTreeNode.emit({
                        instance: tt, node: tn,
                        parentIdOrPath: parentPath_1, parentLayer: parentLayer_1, search: { value: value, field: field }
                    });
                    return;
                }
                this.getChildren(parentPath_1, parentLayer_1, { searchField: field === '*' ? '*' : field, searchValue: value }, tt).pipe(switchMap((/**
                 * @param {?} data
                 * @return {?}
                 */
                function (data) {
                    if (data && data.items && data.items.length) {
                        return of(data);
                    }
                    else {
                        return _this.getChildren(parentPath_1, parentLayer_1, { searchField: '*', searchValue: '' }, tt);
                    }
                }))).subscribe((/**
                 * @param {?} data
                 * @return {?}
                 */
                function (data) {
                    if (tt) {
                        if (tn && data.items && data.items.length) {
                            tt.appendChildren(data.items, tn);
                        }
                        tn['showLoading'] = false;
                        tt.detectChanges();
                    }
                }));
            }
        }
    };
    /**
     * @private
     * @param {?} parentPath
     * @param {?} parentLayer
     * @param {?} searchData
     * @param {?} tt
     * @return {?}
     */
    LookupLeftComponent.prototype.getChildren = /**
     * @private
     * @param {?} parentPath
     * @param {?} parentLayer
     * @param {?} searchData
     * @param {?} tt
     * @return {?}
     */
    function (parentPath, parentLayer, searchData, tt) {
        /** @type {?} */
        var uri = this.lookupCmp.gridOptions.uri;
        /** @type {?} */
        var search = tslib_1.__assign({ parentLayer: parentLayer, category: 'nav' }, searchData);
        if (this.navOptions.treeInfo.layerType === 'parentId') {
            search['parentId'] = parentPath;
        }
        else {
            search['parentPath'] = parentPath;
        }
        /** @type {?} */
        var param = this.buildParams({
            searchValue: JSON.stringify(search),
            customData: this.lookupCmp.customData,
            enableFullTree: false,
            loadTreeDataType: 'layerload',
        });
        if (this.lookupCmp.helpId) {
            param['helpId'] = this.lookupCmp.helpId;
        }
        if (tt && tt.sortName) {
            search['sortName'] = tt.sortName;
            search['sortOrder'] = tt.sortOrder;
            param.searchValue = JSON.stringify(search);
        }
        return this.lookupCmp.http.getData(uri, param);
    };
    /**
     * @return {?}
     */
    LookupLeftComponent.prototype.loadData = /**
     * @return {?}
     */
    function () {
        this.cmpRef.instance.allColumnsTitle = this.lookupCmp.allColumnsTitle;
        if (!this.isTreeList()) {
            /** @type {?} */
            var dt = (/** @type {?} */ (this.cmpRef.instance));
            this.initDataTable(dt);
        }
        else {
            /** @type {?} */
            var tt = (/** @type {?} */ (this.cmpRef.instance));
            this.initTreeTable(tt);
        }
    };
    LookupLeftComponent.decorators = [
        { type: Component, args: [{
                    selector: 'lookup-left',
                    template: "<div style=\"height: 100%;position: relative;\">\r\n    <ng-container #container></ng-container>\r\n</div>"
                }] }
    ];
    /** @nocollapse */
    LookupLeftComponent.ctorParameters = function () { return [
        { type: ComponentFactoryResolver },
        { type: ChangeDetectorRef }
    ]; };
    LookupLeftComponent.propDecorators = {
        cmpContainer: [{ type: ViewChild, args: ['container', { read: ViewContainerRef },] }],
        selected: [{ type: Output }],
        unselected: [{ type: Output }],
        search: [{ type: Output }],
        pageChanged: [{ type: Output }]
    };
    return LookupLeftComponent;
}());
export { LookupLeftComponent };
if (false) {
    /** @type {?} */
    LookupLeftComponent.prototype.cmpRef;
    /** @type {?} */
    LookupLeftComponent.prototype.navOptions;
    /** @type {?} */
    LookupLeftComponent.prototype.lookupCmp;
    /** @type {?} */
    LookupLeftComponent.prototype.cmpContainer;
    /** @type {?} */
    LookupLeftComponent.prototype.selected;
    /** @type {?} */
    LookupLeftComponent.prototype.unselected;
    /** @type {?} */
    LookupLeftComponent.prototype.search;
    /** @type {?} */
    LookupLeftComponent.prototype.pageChanged;
    /**
     * @type {?}
     * @private
     */
    LookupLeftComponent.prototype._searchState;
    /**
     * @type {?}
     * @private
     */
    LookupLeftComponent.prototype._sortState;
    /**
     * @type {?}
     * @private
     */
    LookupLeftComponent.prototype.allData;
    /**
     * @type {?}
     * @private
     */
    LookupLeftComponent.prototype.cfr;
    /**
     * @type {?}
     * @private
     */
    LookupLeftComponent.prototype.cd;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9va3VwLWxlZnQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1sb29rdXAvIiwic291cmNlcyI6WyJsaWIvbG9va3VwLWxlZnQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFTQSxPQUFPLEVBQUUsU0FBUyxFQUFVLFNBQVMsRUFBRSxnQkFBZ0IsRUFBRSxZQUFZLEVBQUUsTUFBTSxFQUN6RSx3QkFBd0IsRUFBZ0IsaUJBQWlCLEVBQzVELE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBYyxFQUFFLEVBQWdCLE1BQU0sTUFBTSxDQUFDO0FBRXBELE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQzFELE9BQU8sRUFBWSxrQkFBa0IsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBSXBFLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUUzQztJQXFCSSw2QkFBb0IsR0FBNkIsRUFBVSxFQUFxQjtRQUE1RCxRQUFHLEdBQUgsR0FBRyxDQUEwQjtRQUFVLE9BQUUsR0FBRixFQUFFLENBQW1CO1FBUnRFLGFBQVEsR0FBRyxJQUFJLFlBQVksRUFBNEIsQ0FBQztRQUN4RCxlQUFVLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUNoQyxXQUFNLEdBQUcsSUFBSSxZQUFZLEVBQW9DLENBQUM7UUFDOUQsZ0JBQVcsR0FBRyxJQUFJLFlBQVksRUFBK0YsQ0FBQztRQUVoSSxpQkFBWSxHQUFHLElBQUksQ0FBQztRQUNwQixlQUFVLEdBQUcsSUFBSSxDQUFDO1FBQ2xCLFlBQU8sR0FBRyxJQUFJLENBQUM7SUFDNkQsQ0FBQzs7OztJQUVyRixzQ0FBUTs7O0lBQVI7UUFBQSxpQkFXQztRQVZHLElBQUksSUFBSSxDQUFDLFNBQVMsSUFBSSxJQUFJLENBQUMsVUFBVSxFQUFFLEVBQUU7WUFDckMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxxQkFBcUIsR0FB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Q0FBd0k7Ozs7O0lBRXhJLDJDQUE0Qjs7Ozs7SUFDNUIseUNBQTBCOzs7OztJQUMxQixzQ0FBdUI7Ozs7O0lBQ1gsa0NBQXFDOzs7OztJQUFFLGlDQUE2QiIsInNvdXJjZXNDb250ZW50IjpbIi8qXHJcbiogQEF1dGhvcjog55av54uC56eA5omNKEx1Y2FzIEh1YW5nKVxyXG4qIEBEYXRlOiAyMDE4LTEyLTE0IDE0OjQwOjQ4XHJcbiAqIEBMYXN0RWRpdG9yczog55av54uC56eA5omNKEx1Y2FzIEh1YW5nKVxyXG4gKiBATGFzdEVkaXRUaW1lOiAyMDE5LTA5LTI1IDE4OjEwOjI5XHJcbiogQENvbXBhbnk6IEluc3B1clxyXG4qIEBWZXJzaW9uOiB2MC4wLjFcclxuKi9cclxuXHJcbmltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBWaWV3Q2hpbGQsIFZpZXdDb250YWluZXJSZWYsIEV2ZW50RW1pdHRlciwgT3V0cHV0LFxyXG4gICAgQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLCBDb21wb25lbnRSZWYsIENoYW5nZURldGVjdG9yUmVmLCBJbmplY3RvciwgUmVmbGVjdGl2ZUluamVjdG9yLCBPbkRlc3Ryb3lcclxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgb2YsIFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xyXG5cclxuaW1wb3J0IHsgRGF0YVRhYmxlQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1kYXRhdGFibGUnO1xyXG5pbXBvcnQgeyBUcmVlTm9kZSwgVHJlZVRhYmxlQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS10cmVldGFibGUnO1xyXG5cclxuaW1wb3J0IHsgTE9BRF9EQVRBX1RZUEUsIExvb2t1cEdyaWRPcHRpb25zLCBMb29rdXBHcmlkUmVzdWx0IH0gZnJvbSAnLi9sb29rdXAtZ3JpZC1vcHRpb25zJztcclxuaW1wb3J0IHsgTG9va3VwR3JpZENvbXBvbmVudCB9IGZyb20gJy4vbG9va3VwLWdyaWQuY29tcG9uZW50JztcclxuaW1wb3J0IHsgc3dpdGNoTWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ2xvb2t1cC1sZWZ0JyxcclxuICAgIHRlbXBsYXRlVXJsOiAnLi9sb29rdXAtbGVmdC5jb21wb25lbnQuaHRtbCdcclxufSlcclxuXHJcbmV4cG9ydCBjbGFzcyBMb29rdXBMZWZ0Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3kge1xyXG5cclxuICAgIGNtcFJlZjogQ29tcG9uZW50UmVmPGFueT47XHJcbiAgICBuYXZPcHRpb25zOiBMb29rdXBHcmlkT3B0aW9ucztcclxuICAgIGxvb2t1cENtcDogTG9va3VwR3JpZENvbXBvbmVudDtcclxuXHJcblxyXG4gICAgQFZpZXdDaGlsZCgnY29udGFpbmVyJywge3JlYWQ6IFZpZXdDb250YWluZXJSZWZ9KSBjbXBDb250YWluZXI6IFZpZXdDb250YWluZXJSZWY7XHJcbiAgICBAT3V0cHV0KCkgc2VsZWN0ZWQgPSBuZXcgRXZlbnRFbWl0dGVyPHsgZGF0YTogYW55LCBub2RlPzogYW55fT4oKTtcclxuICAgIEBPdXRwdXQoKSB1bnNlbGVjdGVkID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gICAgQE91dHB1dCgpIHNlYXJjaCA9IG5ldyBFdmVudEVtaXR0ZXI8eyBmaWVsZDogc3RyaW5nLCB2YWx1ZTogc3RyaW5nIH0+KCk7XHJcbiAgICBAT3V0cHV0KCkgcGFnZUNoYW5nZWQgPSBuZXcgRXZlbnRFbWl0dGVyPHsgcGFnZUluZm86IHtwYWdlSW5kZXg6IG51bWJlciwgcGFnZVNpemU6IG51bWJlcn0sIHNlYXJjaDoge2ZpZWxkOiBzdHJpbmcsIHZhbHVlOiBzdHJpbmd9IH0+KCk7XHJcblxyXG4gICAgcHJpdmF0ZSBfc2VhcmNoU3RhdGUgPSBudWxsO1xyXG4gICAgcHJpdmF0ZSBfc29ydFN0YXRlID0gbnVsbDtcclxuICAgIHByaXZhdGUgYWxsRGF0YSA9IG51bGw7XHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGNmcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLCBwcml2YXRlIGNkOiBDaGFuZ2VEZXRlY3RvclJlZikgeyB9XHJcblxyXG4gICAgbmdPbkluaXQoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMubG9va3VwQ21wICYmIHRoaXMuaXNUcmVlTGlzdCgpKSB7XHJcbiAgICAgICAgICAgIHRoaXMubG9va3VwQ21wLmluY2x1ZGVTdWJvcmRpbmF0ZXMkJCA9IHRoaXMubG9va3VwQ21wLmluY2x1ZGVTdWJvcmRpbmF0ZXMkLnN1YnNjcmliZSgodmFsOiBib29sZWFuKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jbXBSZWYpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCB0dCA9IHRoaXMuY21wUmVmLmluc3RhbmNlIGFzIFRyZWVUYWJsZUNvbXBvbmVudDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodHQuc2VsZWN0ZWRSb3cpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZC5lbWl0KHsgZGF0YTogdHQuc2VsZWN0ZWRSb3cuZGF0YSwgbm9kZTogdHQuc2VsZWN0ZWRSb3cgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5fc2VhcmNoU3RhdGUgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuX3NvcnRTdGF0ZSA9IG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgY3JlYXRlQ29tcG9uZW50KCk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICAgICAgbGV0IGR0RmFjID0gbnVsbDtcclxuICAgICAgICBpZiAoIXRoaXMuaXNUcmVlTGlzdCgpKSB7XHJcbiAgICAgICAgICAgIGR0RmFjID0gdGhpcy5jZnIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoRGF0YVRhYmxlQ29tcG9uZW50KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBkdEZhYyA9IHRoaXMuY2ZyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KFRyZWVUYWJsZUNvbXBvbmVudCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMubmF2T3B0aW9uc1sna2VlcFNlbGVjdCddID0gZmFsc2U7XHJcbiAgICAgICAgLy8g5bem5L6n5p+l6K+i6L+H5ruk5p2h77yM6ZqQ6JeP5o6J77ybXHJcbiAgICAgICAgdGhpcy5uYXZPcHRpb25zWydzaG93RmlsdGVyQmFyJ10gPSB0cnVlO1xyXG4gICAgICAgIC8vIGlmICh0aGlzLm5hdk9wdGlvbnMud2lkdGgpIHtcclxuICAgICAgICAvLyAgICAgdGhpcy5uYXZPcHRpb25zLndpZHRoID0gdGhpcy5uYXZPcHRpb25zLndpZHRoIC0gMjtcclxuICAgICAgICAvLyB9XHJcblxyXG4gICAgICAgIHRoaXMubmF2T3B0aW9ucy53aWR0aCA9IHRoaXMubG9va3VwQ21wLmxlZnRQYW5lbFdpZHRoIC0gMjtcclxuXHJcbiAgICAgICAgLy8gY29uc3QgaW5qZWN0b3I6IEluamVjdG9yID0gUmVmbGVjdGl2ZUluamVjdG9yLnJlc29sdmVBbmRDcmVhdGUoW1xyXG4gICAgICAgIC8vICAgICB7IHByb3ZpZGU6IERhdGFUYWJsZVNlcnZpY2UsIHVzZUZhY3Rvcnk6ICgpID0+IHsgbmV3IERhdGFUYWJsZVNlcnZpY2UoKX19XHJcbiAgICAgICAgLy8gXSk7XHJcblxyXG4gICAgICAgIHRoaXMuY21wUmVmID0gdGhpcy5jbXBDb250YWluZXIuY3JlYXRlQ29tcG9uZW50KGR0RmFjKTtcclxuXHJcbiAgICAgICAgaWYgKCF0aGlzLmlzVHJlZUxpc3QoKSkge1xyXG4gICAgICAgICAgICB0aGlzLm5hdk9wdGlvbnNbJ2ZpbGwnXSA9IHRydWU7XHJcbiAgICAgICAgICAgIHRoaXMuY21wUmVmLmluc3RhbmNlLm1heFNpemUgPSA1O1xyXG4gICAgICAgICAgICB0aGlzLmNtcFJlZi5pbnN0YW5jZS5maWxsID0gdHJ1ZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLm5hdk9wdGlvbnNbJ2ZpdCddID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gdGhpcy5jbXBSZWYuaW5zdGFuY2UuZml0ID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMubmF2T3B0aW9ucy5wYWdlSW5mbykge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5uYXZPcHRpb25zLnBhZ2VJbmZvLnBhZ2VMaXN0KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm5hdk9wdGlvbnMucGFnZUxpc3QgPSB0aGlzLm5hdk9wdGlvbnMucGFnZUluZm8ucGFnZUxpc3Q7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5uYXZPcHRpb25zLnBhZ2luYXRpb24gPSB0aGlzLm5hdk9wdGlvbnMucGFnZUluZm8uZW5hYmxlUGFnZXI7XHJcbiAgICAgICAgICAgIHRoaXMubmF2T3B0aW9ucy5wYWdlSW5kZXggPSB0aGlzLm5hdk9wdGlvbnMucGFnZUluZm8ucGFnZUluZGV4O1xyXG4gICAgICAgICAgICB0aGlzLm5hdk9wdGlvbnMucGFnZVNpemUgPSB0aGlzLm5hdk9wdGlvbnMucGFnZUluZm8ucGFnZVNpemU7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5uYXZPcHRpb25zLnBhZ2luYXRpb24gPSBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIE9iamVjdC5hc3NpZ24odGhpcy5jbXBSZWYuaW5zdGFuY2UsIHRoaXMubmF2T3B0aW9ucyk7XHJcblxyXG4gICAgICAgIHRoaXMubG9hZERhdGEoKTtcclxuICAgICAgICByZXR1cm4gb2YodGhpcy5jbXBSZWYpO1xyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZSgpIHtcclxuICAgICAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcclxuICAgIH1cclxuXHJcbiAgICByZXNpemUoc2l6ZT86IHt3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlcn0pIHtcclxuICAgICAgICBpZiAoc2l6ZSkge1xyXG4gICAgICAgICAgICBzaXplLndpZHRoID0gc2l6ZS53aWR0aCAtIDI7XHJcbiAgICAgICAgICAgIC8vIGlmICh0aGlzLmNtcFJlZi5pbnN0YW5jZSBpbnN0YW5jZW9mIFRyZWVUYWJsZUNvbXBvbmVudCkge1xyXG4gICAgICAgICAgICAvLyAgICAgc2l6ZS5oZWlnaHQgKz0gNDY7XHJcbiAgICAgICAgICAgIC8vIH1cclxuICAgICAgICAgICAgdGhpcy5jbXBSZWYuaW5zdGFuY2UucmVzaXplKHNpemUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBpc1RyZWVMaXN0KCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLm5hdk9wdGlvbnMuZGlzcGxheVR5cGUudG9Mb3dlckNhc2UoKSA9PT0gJ3RyZWVsaXN0JyAmJiAhdGhpcy5sb29rdXBDbXAubmF2VHJlZVRvTGlzdDtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNlbGVjdExlZnREYXRhVGFibGVSb3coaXRlbXM6IGFueSwgZHQ6IERhdGFUYWJsZUNvbXBvbmVudCkge1xyXG4gICAgICAgIGlmIChpdGVtcyAmJiBpdGVtcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgbGV0IGl0ZW0gPSBudWxsO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5sb29rdXBDbXAubmF2U2VsZWN0ZWRJZHMpIHtcclxuICAgICAgICAgICAgICAgIGl0ZW0gPSBpdGVtcy5maW5kKG4gPT4gbltkdC5pZEZpZWxkXSA9PSB0aGlzLmxvb2t1cENtcC5uYXZTZWxlY3RlZElkcyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5sb29rdXBDbXAuc2VsZWN0Rmlyc3RJbk5hdikge1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW0gPSBpdGVtc1swXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgIGR0LmR0Qm9keS5zZWxlY3RlZFJvd0luZGV4ID0gLTE7XHJcbiAgICAgICAgICAgICAgICBkdC5kdEJvZHkuc2VsZWN0ZWRSb3coJycsIDAsIGl0ZW0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY2xvc2VMb2FkaW5nKCkge1xyXG4gICAgICAgIHRoaXMubG9va3VwQ21wLmNsb3NlTG9hZGluZygpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgaW5pdERhdGFUYWJsZShkdDogRGF0YVRhYmxlQ29tcG9uZW50KSB7XHJcbiAgICAgICAgZHQubG9hZERhdGEoe1xyXG4gICAgICAgICAgICBwYWdlU2l6ZTogdGhpcy5uYXZPcHRpb25zLnBhZ2VTaXplLFxyXG4gICAgICAgICAgICBwYWdlSW5kZXg6IHRoaXMubmF2T3B0aW9ucy5wYWdlSW5kZXgsXHJcbiAgICAgICAgICAgIHRvdGFsOiB0aGlzLm5hdk9wdGlvbnMudG90YWwsXHJcbiAgICAgICAgICAgIGRhdGE6IHRoaXMubmF2T3B0aW9ucy5pdGVtcyxcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgZHQucmVzaXplKHsgd2lkdGg6IDMyMCwgaGVpZ2h0OiB0aGlzLm5hdk9wdGlvbnMuaGVpZ2h0fSk7XHJcbiAgICAgICAgLy8g6KGM6YCJ5LitXHJcbiAgICAgICAgZHQuc2VsZWN0ZWRSb3cuc3Vic2NyaWJlKGQgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkLmVtaXQoeyBkYXRhOiBkLmRhdGEgfSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGR0LnVuU2VsZWN0Um93LnN1YnNjcmliZShkID0+IHtcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZC5lbWl0KG51bGwpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBjb25zdCBwID0geyBwYWdlSW5mbzogeyBwYWdlSW5kZXg6IDEsIHBhZ2VTaXplOiB0aGlzLm5hdk9wdGlvbnMucGFnZVNpemUgfSwgc2VhcmNoOiAnJyB9O1xyXG5cclxuXHJcbiAgICAgICAgY29uc3QgbG9hZFRhYmxlRGF0YSA9IHtcclxuICAgICAgICAgICAgbmV4dDogKGRhdGE6IExvb2t1cEdyaWRSZXN1bHQpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VMb2FkaW5nKCk7XHJcbiAgICAgICAgICAgICAgICBkYXRhVGFibGVSZUxvYWQoZGF0YSk7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGVycm9yOiAoZXJyKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlTG9hZGluZygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLy8g5p+l6K+iXHJcbiAgICAgICAgZHQuc2VhcmNoLnN1YnNjcmliZSggc2VhcmNoRGF0YSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuX3NlYXJjaFN0YXRlID0gc2VhcmNoRGF0YTtcclxuICAgICAgICAgICAgdGhpcy5zZWFyY2guZW1pdChzZWFyY2hEYXRhKTtcclxuICAgICAgICAgICAgcC5zZWFyY2ggPSBzZWFyY2hEYXRhO1xyXG4gICAgICAgICAgICBwLnBhZ2VJbmZvLnBhZ2VTaXplID0gZHQucGFnZVNpemU7XHJcbiAgICAgICAgICAgIHRoaXMubG9va3VwQ21wLm5hdmlnYXRpb25GaWx0ZXIgPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuX3NvcnRTdGF0ZSAmJiB0aGlzLl9zb3J0U3RhdGUuc29ydE5hbWUpIHtcclxuICAgICAgICAgICAgICAgIHBbJ3NvcnROYW1lJ10gPSB0aGlzLl9zb3J0U3RhdGUuc29ydE5hbWU7XHJcbiAgICAgICAgICAgICAgICBwWydzb3J0T3JkZXInXSA9IHRoaXMuX3NvcnRTdGF0ZS5zb3J0T3JkZXI7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBkZWxldGUgcFsnc29ydE5hbWUnXTtcclxuICAgICAgICAgICAgICAgIGRlbGV0ZSBwWydzb3J0T3JkZXInXTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5sb29rdXBDbXAuaHR0cE1nci5nZXREYXRhKHAsICduYXZzZWFyY2gnKS5zdWJzY3JpYmUobG9hZFRhYmxlRGF0YSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGNvbnN0IGRhdGFUYWJsZVJlTG9hZCA9IChkYXRhKSA9PiB7XHJcbiAgICAgICAgICAgIGR0LmxvYWREYXRhKHtcclxuICAgICAgICAgICAgICAgIHBhZ2VTaXplOiBkYXRhLnBhZ2VJbmZvLnBhZ2VTaXplLFxyXG4gICAgICAgICAgICAgICAgcGFnZUluZGV4OiBkYXRhLnBhZ2VJbmZvLnBhZ2VJbmRleCxcclxuICAgICAgICAgICAgICAgIHRvdGFsOiBkYXRhLnRvdGFsLFxyXG4gICAgICAgICAgICAgICAgZGF0YTogZGF0YS5pdGVtcyxcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdExlZnREYXRhVGFibGVSb3coZGF0YS5pdGVtcywgZHQpO1xyXG4gICAgICAgICAgICBkdC5jZC5tYXJrRm9yQ2hlY2soKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvLyDliIbpobVcclxuICAgICAgICBkdC5wYWdlQ2hhbmdlZC5zdWJzY3JpYmUoZCA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMucGFnZUNoYW5nZWQuZW1pdChkKTtcclxuICAgICAgICAgICAgdGhpcy5sb29rdXBDbXAubmF2aWdhdGlvbkZpbHRlciA9IG51bGw7XHJcbiAgICAgICAgICAgIHRoaXMubG9va3VwQ21wLmh0dHBNZ3IuZ2V0RGF0YShkLCAnbmF2c2VhcmNoJykuc3Vic2NyaWJlKGxvYWRUYWJsZURhdGEpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBkdC5wYWdlU2l6ZUNoYW5nZWQuc3Vic2NyaWJlKChlKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMubG9va3VwQ21wLm5hdmlnYXRpb25GaWx0ZXIgPSBudWxsO1xyXG4gICAgICAgICAgICB0aGlzLmxvb2t1cENtcC5odHRwTWdyLmdldERhdGEoZSwgJ25hdnNlYXJjaCcpLnN1YnNjcmliZShsb2FkVGFibGVEYXRhKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgZHQuY29sdW1uU29ydGVkLnN1YnNjcmliZSggKHNvcnQ6IHtzb3J0TmFtZTogc3RyaW5nLCBzb3J0T3JkZXI6IGFueX0pID0+IHtcclxuICAgICAgICAgICAgY29uc3QgeyBzb3J0TmFtZSwgc29ydE9yZGVyIH0gPSB7Li4uc29ydH07XHJcbiAgICAgICAgICAgIHRoaXMuX3NvcnRTdGF0ZSA9IHNvcnQ7XHJcbiAgICAgICAgICAgIHRoaXMubG9va3VwQ21wLm5hdmlnYXRpb25GaWx0ZXIgPSBudWxsO1xyXG4gICAgICAgICAgICBjb25zdCBwYXJhbSA9IHsgXHJcbiAgICAgICAgICAgICAgICBzb3J0TmFtZSxcclxuICAgICAgICAgICAgICAgIHNvcnRPcmRlcixcclxuICAgICAgICAgICAgICAgIHNlYXJjaDogdGhpcy5fc2VhcmNoU3RhdGUsICBcclxuICAgICAgICAgICAgICAgIHBhZ2VJbmZvOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGFnZVNpemU6IGR0LnBhZ2VTaXplLFxyXG4gICAgICAgICAgICAgICAgICAgIHBhZ2VJbmRleDogMVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB0aGlzLmxvb2t1cENtcC5odHRwTWdyLmdldERhdGEocGFyYW0sICduYXZzZWFyY2gnKS5zdWJzY3JpYmUobG9hZFRhYmxlRGF0YSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGR0LmNsZWFyU2VhcmNoVmFsdWUuc3Vic2NyaWJlKCAoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuX3NlYXJjaFN0YXRlID0gbnVsbDtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGhpcy5zZWxlY3RMZWZ0RGF0YVRhYmxlUm93KHRoaXMubmF2T3B0aW9ucy5pdGVtcywgZHQpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgYnVpbGRQYXJhbXMocGFyYW1zOiB7fSk6IHtba2V5OiBzdHJpbmddOmFueX0ge1xyXG4gICAgICAgIHJldHVybiB7IC4uLnBhcmFtcywgdHJlZVRvTGlzdDogdGhpcy5sb29rdXBDbXAudHJlZVRvTGlzdCwgbmF2VHJlZVRvTGlzdDogdGhpcy5sb29rdXBDbXAubmF2VHJlZVRvTGlzdH07XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBpbml0VHJlZVRhYmxlKHR0OiBUcmVlVGFibGVDb21wb25lbnQpIHtcclxuICAgICAgICB0dC52aXJ0dWFsaXplZCA9IHRydWU7XHJcbiAgICAgICAgdHQuZmFzdCA9IHRydWU7XHJcbiAgICAgICAgdHQubm9kZVNlbGVjdGVkLnN1YnNjcmliZShkID0+IHtcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZC5lbWl0KHtkYXRhOiBkLm5vZGUuZGF0YSwgbm9kZTogZC5ub2RlfSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHR0Lm5vZGVVblNlbGVjdC5zdWJzY3JpYmUoZCA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWQuZW1pdChudWxsKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdHQuZml4ZWRIZWFkZXIgPSB0cnVlO1xyXG5cclxuICAgICAgICAvLyB0dC5maXQgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMubG9va3VwQ21wLnRyZWVOb2RlSGVscGVyLnVwZGF0ZVRyZWVOb2RlRXhwYW5kZWQodGhpcy5uYXZPcHRpb25zLml0ZW1zLCB0aGlzLm5hdk9wdGlvbnMudHJlZUluZm8pO1xyXG5cclxuICAgICAgICB0dC5sb2FkRGF0YVR5cGUgPSB0aGlzLm5hdk9wdGlvbnMudHJlZUluZm8ubG9hZERhdGFUeXBlO1xyXG4gICAgICAgIC8vIOajgOafpeWujOaVtOagkei/h+a7pOadoeS7tiBCeSBMdWNhcyAyMDIwMDMwMlxyXG4gICAgICAgIHRoaXMubmF2T3B0aW9ucy5pdGVtcyA9IHRoaXMubG9va3VwQ21wLmNoZWNrTm9kZUNhbkJlU2VsZWN0KHRoaXMubmF2T3B0aW9ucy5pdGVtcywgdGhpcy5uYXZPcHRpb25zLnRyZWVJbmZvLmxvYWREYXRhVHlwZSA9PT0gJ2FsbCcpO1xyXG4gICAgICAgIHR0LmxvYWREYXRhKHRoaXMubmF2T3B0aW9ucy5pdGVtcyk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmxvb2t1cENtcC5uYXZTZWxlY3RlZElkcykge1xyXG4gICAgICAgICAgICB0dC5zZWxlY3ROb2RlKHRoaXMubG9va3VwQ21wLm5hdlNlbGVjdGVkSWRzKTtcclxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMubG9va3VwQ21wLnNlbGVjdEZpcnN0SW5OYXYpIHtcclxuICAgICAgICAgICAgdHQuc2VsZWN0Rmlyc3ROb2RlKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmFsbERhdGEgPSB0aGlzLm5hdk9wdGlvbnMuaXRlbXM7XHJcblxyXG4gICAgICAgIGNvbnN0IGxvYWRUcmVlRGF0YSA9IHtcclxuICAgICAgICAgICAgbmV4dDogKHJlc0RhdGE6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZUxvYWRpbmcoKTtcclxuICAgICAgICAgICAgICAgIHR0LmNsZWFyQWxsKCk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBpdGVtcyA9IHRoaXMubG9va3VwQ21wLmNoZWNrTm9kZUNhbkJlU2VsZWN0KHJlc0RhdGEuaXRlbXMsIHRoaXMubmF2T3B0aW9ucy50cmVlSW5mby5sb2FkRGF0YVR5cGUgPT09ICdhbGwnICYmICghdGhpcy5fc2VhcmNoU3RhdGUgfHwgIXRoaXMuX3NlYXJjaFN0YXRlLnZhbHVlKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW1zICYmIGl0ZW1zLmxlbmd0aCAmJiBpdGVtc1swXS5jaGlsZHJlbiAmJiBpdGVtc1swXS5jaGlsZHJlbi5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICBpdGVtc1swXS5leHBhbmRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbXNbMF0uY2hpbGRyZW4gPSB0aGlzLmxvb2t1cENtcC5leHBhbmRGaXJzdE5vZGUoaXRlbXNbMF0uY2hpbGRyZW4pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHR0LmxvYWREYXRhKGl0ZW1zKTtcclxuICAgICAgICAgICAgICAgIHR0LnJlc2l6ZSgpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBlcnJvcjogKGVycikgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZUxvYWRpbmcoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG5cclxuICAgICAgICB0dC5zZWFyY2guc3Vic2NyaWJlKHNlYXJjaCA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuX3NlYXJjaFN0YXRlID0gc2VhcmNoO1xyXG4gICAgICAgICAgICB0aGlzLmxvb2t1cENtcC5uYXZpZ2F0aW9uRmlsdGVyID0gbnVsbDtcclxuICAgICAgICAgICAgY29uc3QgcCA9IHRoaXMuYnVpbGRQYXJhbXMoeyBzZWFyY2ggfSk7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLl9zb3J0U3RhdGUgJiYgdGhpcy5fc29ydFN0YXRlLnNvcnROYW1lKSB7XHJcbiAgICAgICAgICAgICAgICBwWydzb3J0TmFtZSddID0gdGhpcy5fc29ydFN0YXRlLnNvcnROYW1lO1xyXG4gICAgICAgICAgICAgICAgcFsnc29ydE9yZGVyJ10gPSB0aGlzLl9zb3J0U3RhdGUuc29ydE9yZGVyO1xyXG4gICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgdGhpcy5sb29rdXBDbXAuaHR0cE1nci5nZXREYXRhKHAsICduYXZzZWFyY2gnKS5zdWJzY3JpYmUobG9hZFRyZWVEYXRhKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdHQuY29sdW1uU29ydGVkLnN1YnNjcmliZSggKHNvcnQ6IHtzb3J0TmFtZTogc3RyaW5nLCBzb3J0T3JkZXI6IGFueX0pID0+IHtcclxuICAgICAgICAgICAgdGhpcy5sb29rdXBDbXAubmF2aWdhdGlvbkZpbHRlciA9IG51bGw7XHJcbiAgICAgICAgICAgIGlmICh0dC5sb2FkRGF0YVR5cGUgPT09ICdhbGwnKSB7XHJcbiAgICAgICAgICAgICAgICB0dC5jbGllbnRTb3J0KCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB7IHNvcnROYW1lLCBzb3J0T3JkZXIgfSA9IHsuLi5zb3J0fTtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3NvcnRTdGF0ZSA9IHNvcnQ7XHJcbiAgICAgICAgICAgICAgICAvLyBjb25zdCBwYXJhbSA9IE9iamVjdC5hc3NpZ24oeyBzb3J0TmFtZSwgc29ydE9yZGVyIH0sIHRoaXMuX3NlYXJjaFN0YXRlKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHBhcmFtID0gdGhpcy5idWlsZFBhcmFtcyh7IHNvcnROYW1lLCBzb3J0T3JkZXIsIHNlYXJjaDogdGhpcy5fc2VhcmNoU3RhdGUgfSk7XHJcbiAgICAgICAgICAgICAgICBsZXQgcmVxdWVzdFR5cGU6IExPQURfREFUQV9UWVBFID0gJ25hdic7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fc2VhcmNoU3RhdGUgJiYgdGhpcy5fc2VhcmNoU3RhdGUudmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0VHlwZSA9ICduYXZzZWFyY2gnO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGhpcy5sb29rdXBDbXAuaHR0cE1nci5nZXREYXRhKHBhcmFtLCByZXF1ZXN0VHlwZSkuc3Vic2NyaWJlKGxvYWRUcmVlRGF0YSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdHQuY2xlYXJTZWFyY2hWYWx1ZS5zdWJzY3JpYmUoICgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5fc2VhcmNoU3RhdGUgPSBudWxsO1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuX3NvcnRTdGF0ZSB8fCAhdGhpcy5fc29ydFN0YXRlLnNvcnROYW1lKSB7XHJcbiAgICAgICAgICAgICAgICB0dC5sb2FkRGF0YSh0aGlzLmFsbERhdGEpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcCA9IHRoaXMuYnVpbGRQYXJhbXMoe30pO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX3NvcnRTdGF0ZSAmJiB0aGlzLl9zb3J0U3RhdGUuc29ydE5hbWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBwWydzb3J0TmFtZSddID0gdGhpcy5fc29ydFN0YXRlLnNvcnROYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgIHBbJ3NvcnRPcmRlciddID0gdGhpcy5fc29ydFN0YXRlLnNvcnRPcmRlcjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRoaXMubG9va3VwQ21wLmh0dHBNZ3IuZ2V0RGF0YShwLCAnbmF2Jykuc3Vic2NyaWJlKGxvYWRUcmVlRGF0YSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcblxyXG4gICAgICAgIHR0LmV4cGFuZC5zdWJzY3JpYmUoKHRuOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5vbk5vZGVFeHBhbmRlZCh0biwgdHQpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwcml2YXRlIG9uTm9kZUV4cGFuZGVkKHRuOiBhbnksIHR0KSB7XHJcbiAgICAgICAgaWYgKHRuLmxlYWYpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIXRuLmNoaWxkcmVuIHx8ICF0bi5jaGlsZHJlbi5sZW5ndGgpIHtcclxuICAgICAgICAgICAgY29uc3QgdHJlZUluZm8gPSB0aGlzLm5hdk9wdGlvbnMudHJlZUluZm87XHJcbiAgICAgICAgICAgIGlmICh0aGlzLm5hdk9wdGlvbnMudHJlZUluZm8ubG9hZERhdGFUeXBlID09PSAnYXN5bmMnKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgcGFyZW50UGF0aCA9ICcnO1xyXG4gICAgICAgICAgICAgICAgbGV0IHBhcmVudExheWVyID0gLTE7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB7IGZpZWxkID0gJyonLCB2YWx1ZSA9ICcnIH0gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLi4udHQuc2VhcmNoRGF0YVxyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICB0blsnc2hvd0xvYWRpbmcnXSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB0dC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgICAgICAgICBpZiAodHJlZUluZm8ubGF5ZXJUeXBlID09PSAncGFyZW50SWQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8g54i2SUTliqDovb3mlrnlvI9cclxuICAgICAgICAgICAgICAgICAgICBwYXJlbnRQYXRoID0gdG5bJ2lkJ107XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHRyZWVJbmZvRmllbGQgPSB0cmVlSW5mby5kYXRhRmllbGQ7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRyZWVJbmZvRmllbGQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gcGFyZW50UGF0aCA9IHRuLmRhdGFbdHJlZUluZm9GaWVsZF1bdHJlZUluZm8ucGF0aEZpZWxkXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gcGFyZW50TGF5ZXIgPSB0bi5kYXRhW3RyZWVJbmZvRmllbGRdW3RyZWVJbmZvLmxheWVyRmllbGRdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRQYXRoID0gdGhpcy5sb29rdXBDbXAuZ2V0UGF0aENvZGUodG4uZGF0YSwgdHJlZUluZm8pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRMYXllcj0gdGhpcy5sb29rdXBDbXAuZ2V0TGF5ZXJEYXRhKHRuLmRhdGEsIHRyZWVJbmZvKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygn5pyq5om+5Yiw5YiG57qn5L+h5oGv44CCJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5sb29rdXBDbXAudXJpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb29rdXBDbXAuZXhwYW5kVHJlZU5vZGUuZW1pdCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGluc3RhbmNlOiB0dCwgbm9kZTogdG4sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudElkT3JQYXRoOiBwYXJlbnRQYXRoLCBwYXJlbnRMYXllciwgc2VhcmNoOiB7IHZhbHVlLCBmaWVsZCB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0Q2hpbGRyZW4oXHJcbiAgICAgICAgICAgICAgICAgICAgcGFyZW50UGF0aCwgcGFyZW50TGF5ZXIsIHtzZWFyY2hGaWVsZDogZmllbGQgPT09ICcqJyA/ICcqJyA6IGZpZWxkLCBzZWFyY2hWYWx1ZTogdmFsdWV9LCB0dFxyXG4gICAgICAgICAgICAgICAgKS5waXBlKFxyXG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaE1hcCgoZGF0YTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhICYmIGRhdGEuaXRlbXMgJiYgZGF0YS5pdGVtcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvZihkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldENoaWxkcmVuKHBhcmVudFBhdGgsIHBhcmVudExheWVyLCB7IHNlYXJjaEZpZWxkOiAnKicsIHNlYXJjaFZhbHVlOiAnJyAgfSwgdHQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgKS5zdWJzY3JpYmUoZGF0YSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0biAmJiBkYXRhLml0ZW1zICYmIGRhdGEuaXRlbXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0dC5hcHBlbmRDaGlsZHJlbihkYXRhLml0ZW1zLCB0bik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgdG5bJ3Nob3dMb2FkaW5nJ10gPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHQuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0Q2hpbGRyZW4oIHBhcmVudFBhdGgsIHBhcmVudExheWVyLCBzZWFyY2hEYXRhOiB7IHNlYXJjaEZpZWxkOiBzdHJpbmc7IHNlYXJjaFZhbHVlOiBzdHJpbmcgfSwgdHQgKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgICAgICBjb25zdCB1cmkgPSB0aGlzLmxvb2t1cENtcC5ncmlkT3B0aW9ucy51cmk7XHJcbiAgICAgICAgY29uc3Qgc2VhcmNoID0geyBwYXJlbnRMYXllciwgY2F0ZWdvcnk6ICduYXYnLCAuLi5zZWFyY2hEYXRhIH07XHJcbiAgICAgICAgaWYgKHRoaXMubmF2T3B0aW9ucy50cmVlSW5mby5sYXllclR5cGUgPT09ICdwYXJlbnRJZCcpIHtcclxuICAgICAgICAgICAgc2VhcmNoWydwYXJlbnRJZCddID0gcGFyZW50UGF0aDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBzZWFyY2hbJ3BhcmVudFBhdGgnXSA9IHBhcmVudFBhdGg7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBwYXJhbTogYW55ID0gdGhpcy5idWlsZFBhcmFtcyh7XHJcbiAgICAgICAgICAgIHNlYXJjaFZhbHVlOiBKU09OLnN0cmluZ2lmeShzZWFyY2gpLFxyXG4gICAgICAgICAgICBjdXN0b21EYXRhOiB0aGlzLmxvb2t1cENtcC5jdXN0b21EYXRhLFxyXG4gICAgICAgICAgICBlbmFibGVGdWxsVHJlZTogZmFsc2UsXHJcbiAgICAgICAgICAgIGxvYWRUcmVlRGF0YVR5cGU6ICdsYXllcmxvYWQnLFxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5sb29rdXBDbXAuaGVscElkKSB7XHJcbiAgICAgICAgICAgIHBhcmFtWydoZWxwSWQnXSA9IHRoaXMubG9va3VwQ21wLmhlbHBJZDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0dCAmJiB0dC5zb3J0TmFtZSkge1xyXG4gICAgICAgICAgICBzZWFyY2hbJ3NvcnROYW1lJ10gPSB0dC5zb3J0TmFtZTtcclxuICAgICAgICAgICAgc2VhcmNoWydzb3J0T3JkZXInXSA9IHR0LnNvcnRPcmRlcjtcclxuICAgICAgICAgICAgcGFyYW0uc2VhcmNoVmFsdWUgPSBKU09OLnN0cmluZ2lmeShzZWFyY2gpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMubG9va3VwQ21wLmh0dHAuZ2V0RGF0YSh1cmkgLCBwYXJhbSk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGxvYWREYXRhKCkge1xyXG4gICAgICAgIHRoaXMuY21wUmVmLmluc3RhbmNlLmFsbENvbHVtbnNUaXRsZSA9IHRoaXMubG9va3VwQ21wLmFsbENvbHVtbnNUaXRsZTtcclxuICAgICAgICBpZiAoIXRoaXMuaXNUcmVlTGlzdCgpKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGR0ID0gdGhpcy5jbXBSZWYuaW5zdGFuY2UgYXMgRGF0YVRhYmxlQ29tcG9uZW50O1xyXG4gICAgICAgICAgICB0aGlzLmluaXREYXRhVGFibGUoZHQpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHR0ID0gdGhpcy5jbXBSZWYuaW5zdGFuY2UgYXMgVHJlZVRhYmxlQ29tcG9uZW50O1xyXG4gICAgICAgICAgICB0aGlzLmluaXRUcmVlVGFibGUodHQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iXX0=