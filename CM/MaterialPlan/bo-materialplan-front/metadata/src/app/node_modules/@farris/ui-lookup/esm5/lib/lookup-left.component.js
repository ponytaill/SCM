/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
/*
* @Author: 疯狂秀才(Lucas Huang)
* @Date: 2018-12-14 14:40:48
 * @LastEditors: 疯狂秀才(Lucas Huang)
 * @LastEditTime: 2019-09-25 18:10:29
* @Company: Inspur
* @Version: v0.0.1
*/
import { Component, ViewChild, ViewContainerRef, EventEmitter, Output, ComponentFactoryResolver, ChangeDetectorRef } from '@angular/core';
import { of } from 'rxjs';
import { DataTableComponent } from '@farris/ui-datatable';
import { TreeTableComponent } from '@farris/ui-treetable';
var LookupLeftComponent = /** @class */ (function () {
    function LookupLeftComponent(cfr, cd) {
        this.cfr = cfr;
        this.cd = cd;
        this.selected = new EventEmitter();
        this.unselected = new EventEmitter();
        this.search = new EventEmitter();
        this.pageChanged = new EventEmitter();
        this._searchState = null;
        this.allData = null;
    }
    /**
     * @return {?}
     */
    LookupLeftComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @return {?}
     */
    LookupLeftComponent.prototype.createComponent = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var dtFac = null;
        if (!this.isTreeList()) {
            dtFac = this.cfr.resolveComponentFactory(DataTableComponent);
        }
        else {
            dtFac = this.cfr.resolveComponentFactory(TreeTableComponent);
        }
        this.navOptions['keepSelect'] = false;
        // 左侧查询过滤条，隐藏掉；
        this.navOptions['showFilterBar'] = true;
        // if (this.navOptions.width) {
        //     this.navOptions.width = this.navOptions.width - 2;
        // }
        this.navOptions.width = this.lookupCmp.leftPanelWidth - 2;
        // const injector: Injector = ReflectiveInjector.resolveAndCreate([
        //     { provide: DataTableService, useFactory: () => { new DataTableService()}}
        // ]);
        this.cmpRef = this.cmpContainer.createComponent(dtFac);
        if (!this.isTreeList()) {
            this.navOptions['fill'] = true;
            this.cmpRef.instance.maxSize = 5;
            this.cmpRef.instance.fill = true;
        }
        else {
            this.navOptions['fit'] = true;
        }
        // this.cmpRef.instance.fit = true;
        if (this.navOptions.pageInfo) {
            if (this.navOptions.pageInfo.pageList) {
                this.navOptions.pageList = this.navOptions.pageInfo.pageList;
            }
            this.navOptions.pagination = this.navOptions.pageInfo.enablePager;
            this.navOptions.pageIndex = this.navOptions.pageInfo.pageIndex;
            this.navOptions.pageSize = this.navOptions.pageInfo.pageSize;
        }
        else {
            this.navOptions.pagination = false;
        }
        Object.assign(this.cmpRef.instance, this.navOptions);
        this.loadData();
        return of(this.cmpRef);
    };
    /**
     * @return {?}
     */
    LookupLeftComponent.prototype.update = /**
     * @return {?}
     */
    function () {
        this.cd.detectChanges();
    };
    /**
     * @param {?=} size
     * @return {?}
     */
    LookupLeftComponent.prototype.resize = /**
     * @param {?=} size
     * @return {?}
     */
    function (size) {
        if (size) {
            size.width = size.width - 2;
            // if (this.cmpRef.instance instanceof TreeTableComponent) {
            //     size.height += 46;
            // }
            this.cmpRef.instance.resize(size);
        }
    };
    /**
     * @return {?}
     */
    LookupLeftComponent.prototype.isTreeList = /**
     * @return {?}
     */
    function () {
        return this.navOptions.displayType.toLowerCase() === 'treelist';
    };
    /**
     * @private
     * @param {?} items
     * @param {?} dt
     * @return {?}
     */
    LookupLeftComponent.prototype.selectLeftDataTableRow = /**
     * @private
     * @param {?} items
     * @param {?} dt
     * @return {?}
     */
    function (items, dt) {
        var _this = this;
        if (items && items.length) {
            /** @type {?} */
            var item = null;
            if (this.lookupCmp.navSelectedIds) {
                item = items.find((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return n[dt.idField] == _this.lookupCmp.navSelectedIds; }));
            }
            else {
                if (this.lookupCmp.selectFirstInNav) {
                    item = items[0];
                }
            }
            if (item) {
                dt.dtBody.selectedRowIndex = -1;
                dt.dtBody.selectedRow('', 0, item);
            }
        }
    };
    /**
     * @private
     * @return {?}
     */
    LookupLeftComponent.prototype.closeLoading = /**
     * @private
     * @return {?}
     */
    function () {
        this.lookupCmp.closeLoading();
    };
    /**
     * @private
     * @param {?} dt
     * @return {?}
     */
    LookupLeftComponent.prototype.initDataTable = /**
     * @private
     * @param {?} dt
     * @return {?}
     */
    function (dt) {
        var _this = this;
        dt.loadData({
            pageSize: this.navOptions.pageSize,
            pageIndex: this.navOptions.pageIndex,
            total: this.navOptions.total,
            data: this.navOptions.items,
        });
        dt.resize({ width: 320, height: this.navOptions.height });
        // 行选中
        dt.selectedRow.subscribe((/**
         * @param {?} d
         * @return {?}
         */
        function (d) {
            _this.selected.emit({ data: d.data });
        }));
        dt.unSelectRow.subscribe((/**
         * @param {?} d
         * @return {?}
         */
        function (d) {
            _this.selected.emit(null);
        }));
        /** @type {?} */
        var p = { pageInfo: { pageIndex: 1, pageSize: this.navOptions.pageSize }, search: '' };
        /** @type {?} */
        var loadTableData = {
            next: (/**
             * @param {?} data
             * @return {?}
             */
            function (data) {
                _this.closeLoading();
                dataTableReLoad(data);
            }),
            error: (/**
             * @param {?} err
             * @return {?}
             */
            function (err) {
                _this.closeLoading();
            })
        };
        // 查询
        dt.search.subscribe((/**
         * @param {?} searchData
         * @return {?}
         */
        function (searchData) {
            _this._searchState = searchData;
            _this.search.emit(searchData);
            p.search = searchData;
            p.pageInfo.pageSize = dt.pageSize;
            _this.lookupCmp.navigationFilter = null;
            _this.lookupCmp.httpMgr.getData(p, 'navsearch').subscribe(loadTableData);
        }));
        /** @type {?} */
        var dataTableReLoad = (/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            dt.loadData({
                pageSize: data.pageInfo.pageSize,
                pageIndex: data.pageInfo.pageIndex,
                total: data.total,
                data: data.items,
            });
            _this.selectLeftDataTableRow(data.items, dt);
            dt.cd.markForCheck();
        });
        // 分页
        dt.pageChanged.subscribe((/**
         * @param {?} d
         * @return {?}
         */
        function (d) {
            _this.pageChanged.emit(d);
            _this.lookupCmp.navigationFilter = null;
            _this.lookupCmp.httpMgr.getData(d, 'navsearch').subscribe(loadTableData);
        }));
        dt.pageSizeChanged.subscribe((/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            _this.lookupCmp.navigationFilter = null;
            _this.lookupCmp.httpMgr.getData(e, 'navsearch').subscribe(loadTableData);
        }));
        dt.columnSorted.subscribe((/**
         * @param {?} sort
         * @return {?}
         */
        function (sort) {
            var _a = tslib_1.__assign({}, sort), sortName = _a.sortName, sortOrder = _a.sortOrder;
            _this.lookupCmp.navigationFilter = null;
            /** @type {?} */
            var param = Object.assign({ sortName: sortName, sortOrder: sortOrder }, _this._searchState);
            _this.lookupCmp.httpMgr.getData(param, 'navsearch').subscribe(loadTableData);
        }));
        dt.clearSearchValue.subscribe((/**
         * @return {?}
         */
        function () {
            _this._searchState = null;
        }));
        this.selectLeftDataTableRow(this.navOptions.items, dt);
    };
    /**
     * @private
     * @param {?} tt
     * @return {?}
     */
    LookupLeftComponent.prototype.initTreeTable = /**
     * @private
     * @param {?} tt
     * @return {?}
     */
    function (tt) {
        var _this = this;
        tt.virtualized = true;
        tt.nodeSelected.subscribe((/**
         * @param {?} d
         * @return {?}
         */
        function (d) {
            _this.selected.emit({ data: d.node.data });
        }));
        tt.nodeUnSelect.subscribe((/**
         * @param {?} d
         * @return {?}
         */
        function (d) {
            _this.selected.emit(null);
        }));
        tt.fixedHeader = true;
        // tt.fit = true;
        this.lookupCmp.treeNodeHelper.updateTreeNodeExpanded(this.navOptions.items, this.navOptions.treeInfo);
        tt.loadDataType = this.navOptions.treeInfo.loadDataType;
        // 检查完整树过滤条件 By Lucas 20200302
        this.navOptions.items = this.lookupCmp.checkNodeCanBeSelect(this.navOptions.items, this.navOptions.treeInfo.loadDataType === 'all');
        tt.loadData(this.navOptions.items);
        if (this.lookupCmp.navSelectedIds) {
            tt.selectNode(this.lookupCmp.navSelectedIds);
        }
        else if (this.lookupCmp.selectFirstInNav) {
            tt.selectFirstNode();
        }
        this.allData = this.navOptions.items;
        /** @type {?} */
        var loadTreeData = {
            next: (/**
             * @param {?} resData
             * @return {?}
             */
            function (resData) {
                _this.closeLoading();
                tt.clearAll();
                /** @type {?} */
                var items = _this.lookupCmp.checkNodeCanBeSelect(resData.items, _this.navOptions.treeInfo.loadDataType === 'all');
                tt.loadData(items);
                tt.resize();
            }),
            error: (/**
             * @param {?} err
             * @return {?}
             */
            function (err) {
                _this.closeLoading();
            })
        };
        tt.search.subscribe((/**
         * @param {?} search
         * @return {?}
         */
        function (search) {
            _this._searchState = search;
            _this.lookupCmp.navigationFilter = null;
            _this.lookupCmp.httpMgr.getData({ search: search }, 'navsearch').subscribe(loadTreeData);
        }));
        tt.columnSorted.subscribe((/**
         * @param {?} sort
         * @return {?}
         */
        function (sort) {
            _this.lookupCmp.navigationFilter = null;
            if (tt.loadDataType === 'all') {
                tt.clientSort();
            }
            else {
                var _a = tslib_1.__assign({}, sort), sortName = _a.sortName, sortOrder = _a.sortOrder;
                /** @type {?} */
                var param = Object.assign({ sortName: sortName, sortOrder: sortOrder }, _this._searchState);
                _this.lookupCmp.httpMgr.getData(param, 'nav').subscribe(loadTreeData);
            }
        }));
        tt.clearSearchValue.subscribe((/**
         * @return {?}
         */
        function () {
            _this._searchState = null;
            tt.loadData(_this.allData);
        }));
        tt.expand.subscribe((/**
         * @param {?} tn
         * @return {?}
         */
        function (tn) {
            _this.onNodeExpanded(tn, tt);
        }));
    };
    /**
     * @private
     * @param {?} tn
     * @param {?} tt
     * @return {?}
     */
    LookupLeftComponent.prototype.onNodeExpanded = /**
     * @private
     * @param {?} tn
     * @param {?} tt
     * @return {?}
     */
    function (tn, tt) {
        if (tn.leaf) {
            return;
        }
        if (!tn.children || !tn.children.length) {
            /** @type {?} */
            var treeInfo = this.navOptions.treeInfo;
            if (this.navOptions.treeInfo.loadDataType === 'async') {
                /** @type {?} */
                var parentPath = '';
                /** @type {?} */
                var parentLayer = -1;
                var _a = tslib_1.__assign({}, tt.searchData), _b = _a.field, field = _b === void 0 ? '*' : _b, _c = _a.value, value = _c === void 0 ? '' : _c;
                tn['showLoading'] = true;
                tt.detectChanges();
                if (treeInfo.layerType === 'parentId') {
                    // 父ID加载方式
                    parentPath = tn['id'];
                }
                else {
                    /** @type {?} */
                    var treeInfoField = treeInfo.dataField;
                    if (treeInfoField) {
                        parentPath = tn.data[treeInfoField][treeInfo.pathField];
                        parentLayer = tn.data[treeInfoField][treeInfo.layerField];
                    }
                    else {
                        console.log('未找到分级信息。');
                    }
                }
                if (!this.lookupCmp.uri) {
                    this.lookupCmp.expandTreeNode.emit({
                        instance: tt, node: tn,
                        parentIdOrPath: parentPath, parentLayer: parentLayer, search: { value: value, field: field }
                    });
                    return;
                }
                this.getChildren(parentPath, parentLayer, { searchField: field === '*' ? '*' : field, searchValue: value }, tt).subscribe((/**
                 * @param {?} data
                 * @return {?}
                 */
                function (data) {
                    if (tt) {
                        if (tn && data.items && data.items.length) {
                            tt.appendChildren(data.items, tn);
                        }
                        tn['showLoading'] = false;
                        tt.detectChanges();
                    }
                }));
            }
        }
    };
    /**
     * @private
     * @param {?} parentPath
     * @param {?} parentLayer
     * @param {?} searchData
     * @param {?} tt
     * @return {?}
     */
    LookupLeftComponent.prototype.getChildren = /**
     * @private
     * @param {?} parentPath
     * @param {?} parentLayer
     * @param {?} searchData
     * @param {?} tt
     * @return {?}
     */
    function (parentPath, parentLayer, searchData, tt) {
        /** @type {?} */
        var uri = this.lookupCmp.gridOptions.uri;
        /** @type {?} */
        var search = tslib_1.__assign({ parentLayer: parentLayer, category: 'nav' }, searchData);
        if (this.navOptions.treeInfo.layerType === 'parentId') {
            search['parentId'] = parentPath;
        }
        else {
            search['parentPath'] = parentPath;
        }
        /** @type {?} */
        var param = {
            searchValue: JSON.stringify(search),
            customData: this.lookupCmp.customData,
            enableFullTree: false,
            loadTreeDataType: 'layerload'
        };
        if (this.lookupCmp.helpId) {
            param['helpId'] = this.lookupCmp.helpId;
        }
        if (tt && tt.sortName) {
            Object.assign(param, {
                sortName: tt.sortName,
                sortOrder: tt.sortOrder
            });
        }
        return this.lookupCmp.http.getData(uri, param);
    };
    /**
     * @return {?}
     */
    LookupLeftComponent.prototype.loadData = /**
     * @return {?}
     */
    function () {
        this.cmpRef.instance.allColumnsTitle = this.lookupCmp.allColumnsTitle;
        if (!this.isTreeList()) {
            /** @type {?} */
            var dt = (/** @type {?} */ (this.cmpRef.instance));
            this.initDataTable(dt);
        }
        else {
            /** @type {?} */
            var tt = (/** @type {?} */ (this.cmpRef.instance));
            this.initTreeTable(tt);
        }
    };
    LookupLeftComponent.decorators = [
        { type: Component, args: [{
                    selector: 'lookup-left',
                    template: "<div style=\"height: 100%;position: relative;\">\r\n    <ng-container #container></ng-container>\r\n</div>"
                }] }
    ];
    /** @nocollapse */
    LookupLeftComponent.ctorParameters = function () { return [
        { type: ComponentFactoryResolver },
        { type: ChangeDetectorRef }
    ]; };
    LookupLeftComponent.propDecorators = {
        cmpContainer: [{ type: ViewChild, args: ['container', { read: ViewContainerRef },] }],
        selected: [{ type: Output }],
        unselected: [{ type: Output }],
        search: [{ type: Output }],
        pageChanged: [{ type: Output }]
    };
    return LookupLeftComponent;
}());
export { LookupLeftComponent };
if (false) {
    /** @type {?} */
    LookupLeftComponent.prototype.cmpRef;
    /** @type {?} */
    LookupLeftComponent.prototype.navOptions;
    /** @type {?} */
    LookupLeftComponent.prototype.lookupCmp;
    /** @type {?} */
    LookupLeftComponent.prototype.cmpContainer;
    /** @type {?} */
    LookupLeftComponent.prototype.selected;
    /** @type {?} */
    LookupLeftComponent.prototype.unselected;
    /** @type {?} */
    LookupLeftComponent.prototype.search;
    /** @type {?} */
    LookupLeftComponent.prototype.pageChanged;
    /**
     * @type {?}
     * @private
     */
    LookupLeftComponent.prototype._searchState;
    /**
     * @type {?}
     * @private
     */
    LookupLeftComponent.prototype.allData;
    /**
     * @type {?}
     * @private
     */
    LookupLeftComponent.prototype.cfr;
    /**
     * @type {?}
     * @private
     */
    LookupLeftComponent.prototype.cd;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9va3VwLWxlZnQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1sb29rdXAvIiwic291cmNlcyI6WyJsaWIvbG9va3VwLWxlZnQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFTQSxPQUFPLEVBQUUsU0FBUyxFQUFVLFNBQVMsRUFBRSxnQkFBZ0IsRUFBRSxZQUFZLEVBQUUsTUFBTSxFQUN6RSx3QkFBd0IsRUFBZ0IsaUJBQWlCLEVBQzVELE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBYyxFQUFFLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFFdEMsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDMUQsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFLMUQ7SUFxQkksNkJBQW9CLEdBQTZCLEVBQVUsRUFBcUI7UUFBNUQsUUFBRyxHQUFILEdBQUcsQ0FBMEI7UUFBVSxPQUFFLEdBQUYsRUFBRSxDQUFtQjtRQVJ0RSxhQUFRLEdBQUcsSUFBSSxZQUFZLEVBQWdCLENBQUM7UUFDNUMsZUFBVSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFDaEMsV0FBTSxHQUFHLElBQUksWUFBWSxFQUFvQyxDQUFDO1FBQzlELGdCQUFXLEdBQUcsSUFBSSxZQUFZLEVBQStGLENBQUM7UUFFaEksaUJBQVksR0FBRyxJQUFJLENBQUM7UUFDcEIsWUFBTyxHQUFHLElBQUksQ0FBQztJQUU2RCxDQUFDOzs7O0lBRXJGLHNDQUFROzs7SUFBUjtJQUNBLENBQUM7Ozs7SUFFRCw2Q0FBZTs7O0lBQWY7O1lBQ1EsS0FBSyxHQUFHLElBQUk7UUFDaEIsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsRUFBRTtZQUNwQixLQUFLLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyx1QkFBdUIsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO1NBQ2hFO2FBQU07WUFD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QyxPQUFPLENBQUMsR0FBRyxFQUFHLEtBQUssQ0FBQyxDQUFDO0lBQ3BELENBQUM7Ozs7SUFHRCxzQ0FBUTs7O0lBQVI7UUFDSSxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxlQUFlLENBQUM7UUFDdEUsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsRUFBRTs7Z0JBQ2QsRUFBRSxHQUFHLG1CQUFBLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxFQUFzQjtZQUNyRCxJQUFJLENBQUMsYUFBYSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1NBQzFCO2FBQU07O2dCQUNHLEVBQUUsR0FBRyxtQkFBQSxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsRUFBc0I7WUFDckQsSUFBSSxDQUFDLGFBQWEsQ0FBQyxFQUFFLENBQUMsQ0FBQztTQUMxQjtJQUNMLENBQUM7O2dCQXBXSixTQUFTLFNBQUM7b0JBQ1AsUUFBUSxFQUFFLGFBQWE7b0JBQ3ZCLHNIQUEyQztpQkFDOUM7Ozs7Z0JBYkcsd0JBQXdCO2dCQUFnQixpQkFBaUI7OzsrQkFzQnhELFNBQVMsU0FBQyxXQUFXLEVBQUUsRUFBQyxJQUFJLEVBQUUsZ0JBQWdCLEVBQUM7MkJBQy9DLE1BQU07NkJBQ04sTUFBTTt5QkFDTixNQUFNOzhCQUNOLE1BQU07O0lBcVZYLDBCQUFDO0NBQUEsQUFyV0QsSUFxV0M7U0FoV1ksbUJBQW1COzs7SUFFNUIscUNBQTBCOztJQUMxQix5Q0FBOEI7O0lBQzlCLHdDQUErQjs7SUFHL0IsMkNBQWlGOztJQUNqRix1Q0FBc0Q7O0lBQ3RELHlDQUEwQzs7SUFDMUMscUNBQXdFOztJQUN4RSwwQ0FBd0k7Ozs7O0lBRXhJLDJDQUE0Qjs7Ozs7SUFDNUIsc0NBQXVCOzs7OztJQUVYLGtDQUFxQzs7Ozs7SUFBRSxpQ0FBNkIiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxyXG4qIEBBdXRob3I6IOeWr+eLguengOaJjShMdWNhcyBIdWFuZylcclxuKiBARGF0ZTogMjAxOC0xMi0xNCAxNDo0MDo0OFxyXG4gKiBATGFzdEVkaXRvcnM6IOeWr+eLguengOaJjShMdWNhcyBIdWFuZylcclxuICogQExhc3RFZGl0VGltZTogMjAxOS0wOS0yNSAxODoxMDoyOVxyXG4qIEBDb21wYW55OiBJbnNwdXJcclxuKiBAVmVyc2lvbjogdjAuMC4xXHJcbiovXHJcblxyXG5pbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgVmlld0NoaWxkLCBWaWV3Q29udGFpbmVyUmVmLCBFdmVudEVtaXR0ZXIsIE91dHB1dCxcclxuICAgIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciwgQ29tcG9uZW50UmVmLCBDaGFuZ2VEZXRlY3RvclJlZiwgSW5qZWN0b3IsIFJlZmxlY3RpdmVJbmplY3RvclxyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBvZiB9IGZyb20gJ3J4anMnO1xyXG5cclxuaW1wb3J0IHsgRGF0YVRhYmxlQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1kYXRhdGFibGUnO1xyXG5pbXBvcnQgeyBUcmVlVGFibGVDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLXRyZWV0YWJsZSc7XHJcblxyXG5pbXBvcnQgeyBMb29rdXBHcmlkT3B0aW9ucywgTG9va3VwR3JpZFJlc3VsdCB9IGZyb20gJy4vbG9va3VwLWdyaWQtb3B0aW9ucyc7XHJcbmltcG9ydCB7IExvb2t1cEdyaWRDb21wb25lbnQgfSBmcm9tICcuL2xvb2t1cC1ncmlkLmNvbXBvbmVudCc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAnbG9va3VwLWxlZnQnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcuL2xvb2t1cC1sZWZ0LmNvbXBvbmVudC5odG1sJ1xyXG59KVxyXG5cclxuZXhwb3J0IGNsYXNzIExvb2t1cExlZnRDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG5cclxuICAgIGNtcFJlZjogQ29tcG9uZW50UmVmPGFueT47XHJcbiAgICBuYXZPcHRpb25zOiBMb29rdXBHcmlkT3B0aW9ucztcclxuICAgIGxvb2t1cENtcDogTG9va3VwR3JpZENvbXBvbmVudDtcclxuXHJcblxyXG4gICAgQFZpZXdDaGlsZCgnY29udGFpbmVyJywge3JlYWQ6IFZpZXdDb250YWluZXJSZWZ9KSBjbXBDb250YWluZXI6IFZpZXdDb250YWluZXJSZWY7XHJcbiAgICBAT3V0cHV0KCkgc2VsZWN0ZWQgPSBuZXcgRXZlbnRFbWl0dGVyPHsgZGF0YTogYW55fT4oKTtcclxuICAgIEBPdXRwdXQoKSB1bnNlbGVjdGVkID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gICAgQE91dHB1dCgpIHNlYXJjaCA9IG5ldyBFdmVudEVtaXR0ZXI8eyBmaWVsZDogc3RyaW5nLCB2YWx1ZTogc3RyaW5nIH0+KCk7XHJcbiAgICBAT3V0cHV0KCkgcGFnZUNoYW5nZWQgPSBuZXcgRXZlbnRFbWl0dGVyPHsgcGFnZUluZm86IHtwYWdlSW5kZXg6IG51bWJlciwgcGFnZVNpemU6IG51bWJlcn0sIHNlYXJjaDoge2ZpZWxkOiBzdHJpbmcsIHZhbHVlOiBzdHJpbmd9IH0+KCk7XHJcblxyXG4gICAgcHJpdmF0ZSBfc2VhcmNoU3RhdGUgPSBudWxsO1xyXG4gICAgcHJpdmF0ZSBhbGxEYXRhID0gbnVsbDtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGNmcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLCBwcml2YXRlIGNkOiBDaGFuZ2VEZXRlY3RvclJlZikgeyB9XHJcblxyXG4gICAgbmdPbkluaXQoKSB7XHJcbiAgICB9XHJcblxyXG4gICAgY3JlYXRlQ29tcG9uZW50KCk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICAgICAgbGV0IGR0RmFjID0gbnVsbDtcclxuICAgICAgICBpZiAoIXRoaXMuaXNUcmVlTGlzdCgpKSB7XHJcbiAgICAgICAgICAgIGR0RmFjID0gdGhpcy5jZnIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoRGF0YVRhYmxlQ29tcG9uZW50KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBkdEZhYyA9IHRoaXMuY2ZyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KFRyZWVUYWJsZUNvbXBvbmVudCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMubmF2T3B0aW9uc1sna2VlcFNlbGVjdCddID0gZmFsc2U7XHJcbiAgICAgICAgLy8g5bem5L6n5p+l6K+i6L+H5ruk5p2h77yM6ZqQ6JeP5o6J77ybXHJcbiAgICAgICAgdGhpcy5uYXZPcHRpb25zWydzaG93RmlsdGVyQmFyJ10gPSB0cnVlO1xyXG4gICAgICAgIC8vIGlmICh0aGlzLm5hdk9wdGlvbnMud2lkdGgpIHtcclxuICAgICAgICAvLyAgICAgdGhpcy5uYXZPcHRpb25zLndpZHRoID0gdGhpcy5uYXZPcHRpb25zLndpZHRoIC0gMjtcclxuICAgICAgICAvLyB9XHJcblxyXG4gICAgICAgIHRoaXMubmF2T3B0aW9ucy53aWR0aCA9IHRoaXMubG9va3VwQ21wLmxlZnRQYW5lbFdpZHRoIC0gMjtcclxuXHJcbiAgICAgICAgLy8gY29uc3QgaW5qZWN0b3I6IEluamVjdG9yID0gUmVmbGVjdGl2ZUluamVjdG9yLnJlc29sdmVBbmRDcmVhdGUoW1xyXG4gICAgICAgIC8vICAgICB7IHByb3ZpZGU6IERhdGFUYWJsZVNlcnZpY2UsIHVzZUZhY3Rvcnk6ICgpID0+IHsgbmV3IERhdGFUYWJsZVNlcnZpY2UoKX19XHJcbiAgICAgICAgLy8gXSk7XHJcblxyXG4gICAgICAgIHRoaXMuY21wUmVmID0gdGhpcy5jbXBDb250YWluZXIuY3JlYXRlQ29tcG9uZW50KGR0RmFjKTtcclxuXHJcbiAgICAgICAgaWYgKCF0aGlzLmlzVHJlZUxpc3QoKSkge1xyXG4gICAgICAgICAgICB0aGlzLm5hdk9wdGlvbnNbJ2ZpbGwnXSA9IHRydWU7XHJcbiAgICAgICAgICAgIHRoaXMuY21wUmVmLmluc3RhbmNlLm1heFNpemUgPSA1O1xyXG4gICAgICAgICAgICB0aGlzLmNtcFJlZi5pbnN0YW5jZS5maWxsID0gdHJ1ZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLm5hdk9wdGlvbnNbJ2ZpdCddID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gdGhpcy5jbXBSZWYuaW5zdGFuY2UuZml0ID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMubmF2T3B0aW9ucy5wYWdlSW5mbykge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5uYXZPcHRpb25zLnBhZ2VJbmZvLnBhZ2VMaXN0KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm5hdk9wdGlvbnMucGFnZUxpc3QgPSB0aGlzLm5hdk9wdGlvbnMucGFnZUluZm8ucGFnZUxpc3Q7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5uYXZPcHRpb25zLnBhZ2luYXRpb24gPSB0aGlzLm5hdk9wdGlvbnMucGFnZUluZm8uZW5hYmxlUGFnZXI7XHJcbiAgICAgICAgICAgIHRoaXMubmF2T3B0aW9ucy5wYWdlSW5kZXggPSB0aGlzLm5hdk9wdGlvbnMucGFnZUluZm8ucGFnZUluZGV4O1xyXG4gICAgICAgICAgICB0aGlzLm5hdk9wdGlvbnMucGFnZVNpemUgPSB0aGlzLm5hdk9wdGlvbnMucGFnZUluZm8ucGFnZVNpemU7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5uYXZPcHRpb25zLnBhZ2luYXRpb24gPSBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIE9iamVjdC5hc3NpZ24odGhpcy5jbXBSZWYuaW5zdGFuY2UsIHRoaXMubmF2T3B0aW9ucyk7XHJcblxyXG4gICAgICAgIHRoaXMubG9hZERhdGEoKTtcclxuICAgICAgICByZXR1cm4gb2YodGhpcy5jbXBSZWYpO1xyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZSgpIHtcclxuICAgICAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcclxuICAgIH1cclxuXHJcbiAgICByZXNpemUoc2l6ZT86IHt3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlcn0pIHtcclxuICAgICAgICBpZiAoc2l6ZSkge1xyXG4gICAgICAgICAgICBzaXplLndpZHRoID0gc2l6ZS53aWR0aCAtIDI7XHJcbiAgICAgICAgICAgIC8vIGlmICh0aGlzLmNtcFJlZi5pbnN0YW5jZSBpbnN0YW5jZW9mIFRyZWVUYWJsZUNvbXBvbmVudCkge1xyXG4gICAgICAgICAgICAvLyAgICAgc2l6ZS5oZWlnaHQgKz0gNDY7XHJcbiAgICAgICAgICAgIC8vIH1cclxuICAgICAgICAgICAgdGhpcy5jbXBSZWYuaW5zdGFuY2UucmVzaXplKHNpemUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBpc1RyZWVMaXN0KCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLm5hdk9wdGlvbnMuZGlzcGxheVR5cGUudG9Mb3dlckNhc2UoKSA9PT0gJ3RyZWVsaXN0JztcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNlbGVjdExlZnREYXRhVGFibGVSb3coaXRlbXM6IGFueSwgZHQ6IERhdGFUYWJsZUNvbXBvbmVudCkge1xyXG4gICAgICAgIGlmIChpdGVtcyAmJiBpdGVtcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgbGV0IGl0ZW0gPSBudWxsO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5sb29rdXBDbXAubmF2U2VsZWN0ZWRJZHMpIHtcclxuICAgICAgICAgICAgICAgIGl0ZW0gPSBpdGVtcy5maW5kKG4gPT4gbltkdC5pZEZpZWxkXSA9PSB0aGlzLmxvb2t1cENtcC5uYXZTZWxlY3RlZElkcyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5sb29rdXBDbXAuc2VsZWN0Rmlyc3RJbk5hdikge1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW0gPSBpdGVtc1swXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgIGR0LmR0Qm9keS5zZWxlY3RlZFJvd0luZGV4ID0gLTE7XHJcbiAgICAgICAgICAgICAgICBkdC5kdEJvZHkuc2VsZWN0ZWRSb3coJycsIDAsIGl0ZW0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY2xvc2VMb2FkaW5nKCkge1xyXG4gICAgICAgIHRoaXMubG9va3VwQ21wLmNsb3NlTG9hZGluZygpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgaW5pdERhdGFUYWJsZShkdDogRGF0YVRhYmxlQ29tcG9uZW50KSB7XHJcbiAgICAgICAgZHQubG9hZERhdGEoe1xyXG4gICAgICAgICAgICBwYWdlU2l6ZTogdGhpcy5uYXZPcHRpb25zLnBhZ2VTaXplLFxyXG4gICAgICAgICAgICBwYWdlSW5kZXg6IHRoaXMubmF2T3B0aW9ucy5wYWdlSW5kZXgsXHJcbiAgICAgICAgICAgIHRvdGFsOiB0aGlzLm5hdk9wdGlvbnMudG90YWwsXHJcbiAgICAgICAgICAgIGRhdGE6IHRoaXMubmF2T3B0aW9ucy5pdGVtcyxcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgZHQucmVzaXplKHsgd2lkdGg6IDMyMCwgaGVpZ2h0OiB0aGlzLm5hdk9wdGlvbnMuaGVpZ2h0fSk7XHJcbiAgICAgICAgLy8g6KGM6YCJ5LitXHJcbiAgICAgICAgZHQuc2VsZWN0ZWRSb3cuc3Vic2NyaWJlKGQgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkLmVtaXQoeyBkYXRhOiBkLmRhdGEgfSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGR0LnVuU2VsZWN0Um93LnN1YnNjcmliZShkID0+IHtcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZC5lbWl0KG51bGwpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBjb25zdCBwID0geyBwYWdlSW5mbzogeyBwYWdlSW5kZXg6IDEsIHBhZ2VTaXplOiB0aGlzLm5hdk9wdGlvbnMucGFnZVNpemUgfSwgc2VhcmNoOiAnJyB9O1xyXG5cclxuXHJcbiAgICAgICAgY29uc3QgbG9hZFRhYmxlRGF0YSA9IHtcclxuICAgICAgICAgICAgbmV4dDogKGRhdGE6IExvb2t1cEdyaWRSZXN1bHQpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VMb2FkaW5nKCk7XHJcbiAgICAgICAgICAgICAgICBkYXRhVGFibGVSZUxvYWQoZGF0YSk7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGVycm9yOiAoZXJyKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlTG9hZGluZygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLy8g5p+l6K+iXHJcbiAgICAgICAgZHQuc2VhcmNoLnN1YnNjcmliZSggc2VhcmNoRGF0YSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuX3NlYXJjaFN0YXRlID0gc2VhcmNoRGF0YTtcclxuICAgICAgICAgICAgdGhpcy5zZWFyY2guZW1pdChzZWFyY2hEYXRhKTtcclxuICAgICAgICAgICAgcC5zZWFyY2ggPSBzZWFyY2hEYXRhO1xyXG4gICAgICAgICAgICBwLnBhZ2VJbmZvLnBhZ2VTaXplID0gZHQucGFnZVNpemU7XHJcbiAgICAgICAgICAgIHRoaXMubG9va3VwQ21wLm5hdmlnYXRpb25GaWx0ZXIgPSBudWxsO1xyXG4gICAgICAgICAgICB0aGlzLmxvb2t1cENtcC5odHRwTWdyLmdldERhdGEocCwgJ25hdnNlYXJjaCcpLnN1YnNjcmliZShsb2FkVGFibGVEYXRhKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgY29uc3QgZGF0YVRhYmxlUmVMb2FkID0gKGRhdGEpID0+IHtcclxuICAgICAgICAgICAgZHQubG9hZERhdGEoe1xyXG4gICAgICAgICAgICAgICAgcGFnZVNpemU6IGRhdGEucGFnZUluZm8ucGFnZVNpemUsXHJcbiAgICAgICAgICAgICAgICBwYWdlSW5kZXg6IGRhdGEucGFnZUluZm8ucGFnZUluZGV4LFxyXG4gICAgICAgICAgICAgICAgdG90YWw6IGRhdGEudG90YWwsXHJcbiAgICAgICAgICAgICAgICBkYXRhOiBkYXRhLml0ZW1zLFxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0TGVmdERhdGFUYWJsZVJvdyhkYXRhLml0ZW1zLCBkdCk7XHJcbiAgICAgICAgICAgIGR0LmNkLm1hcmtGb3JDaGVjaygpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vIOWIhumhtVxyXG4gICAgICAgIGR0LnBhZ2VDaGFuZ2VkLnN1YnNjcmliZShkID0+IHtcclxuICAgICAgICAgICAgdGhpcy5wYWdlQ2hhbmdlZC5lbWl0KGQpO1xyXG4gICAgICAgICAgICB0aGlzLmxvb2t1cENtcC5uYXZpZ2F0aW9uRmlsdGVyID0gbnVsbDtcclxuICAgICAgICAgICAgdGhpcy5sb29rdXBDbXAuaHR0cE1nci5nZXREYXRhKGQsICduYXZzZWFyY2gnKS5zdWJzY3JpYmUobG9hZFRhYmxlRGF0YSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGR0LnBhZ2VTaXplQ2hhbmdlZC5zdWJzY3JpYmUoKGUpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5sb29rdXBDbXAubmF2aWdhdGlvbkZpbHRlciA9IG51bGw7XHJcbiAgICAgICAgICAgIHRoaXMubG9va3VwQ21wLmh0dHBNZ3IuZ2V0RGF0YShlLCAnbmF2c2VhcmNoJykuc3Vic2NyaWJlKGxvYWRUYWJsZURhdGEpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBkdC5jb2x1bW5Tb3J0ZWQuc3Vic2NyaWJlKCAoc29ydDoge3NvcnROYW1lOiBzdHJpbmcsIHNvcnRPcmRlcjogYW55fSkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCB7IHNvcnROYW1lLCBzb3J0T3JkZXIgfSA9IHsuLi5zb3J0fTtcclxuICAgICAgICAgICAgdGhpcy5sb29rdXBDbXAubmF2aWdhdGlvbkZpbHRlciA9IG51bGw7XHJcbiAgICAgICAgICAgIGNvbnN0IHBhcmFtID0gT2JqZWN0LmFzc2lnbih7IHNvcnROYW1lLCBzb3J0T3JkZXIgfSwgdGhpcy5fc2VhcmNoU3RhdGUpO1xyXG4gICAgICAgICAgICB0aGlzLmxvb2t1cENtcC5odHRwTWdyLmdldERhdGEocGFyYW0sICduYXZzZWFyY2gnKS5zdWJzY3JpYmUobG9hZFRhYmxlRGF0YSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGR0LmNsZWFyU2VhcmNoVmFsdWUuc3Vic2NyaWJlKCAoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuX3NlYXJjaFN0YXRlID0gbnVsbDtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGhpcy5zZWxlY3RMZWZ0RGF0YVRhYmxlUm93KHRoaXMubmF2T3B0aW9ucy5pdGVtcywgZHQpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgaW5pdFRyZWVUYWJsZSh0dDogVHJlZVRhYmxlQ29tcG9uZW50KSB7XHJcbiAgICAgICAgdHQudmlydHVhbGl6ZWQgPSB0cnVlO1xyXG4gICAgICAgIHR0Lm5vZGVTZWxlY3RlZC5zdWJzY3JpYmUoZCA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWQuZW1pdCh7ZGF0YTogZC5ub2RlLmRhdGF9KTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdHQubm9kZVVuU2VsZWN0LnN1YnNjcmliZShkID0+IHtcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZC5lbWl0KG51bGwpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0dC5maXhlZEhlYWRlciA9IHRydWU7XHJcblxyXG4gICAgICAgIC8vIHR0LmZpdCA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5sb29rdXBDbXAudHJlZU5vZGVIZWxwZXIudXBkYXRlVHJlZU5vZGVFeHBhbmRlZCh0aGlzLm5hdk9wdGlvbnMuaXRlbXMsIHRoaXMubmF2T3B0aW9ucy50cmVlSW5mbyk7XHJcblxyXG4gICAgICAgIHR0LmxvYWREYXRhVHlwZSA9IHRoaXMubmF2T3B0aW9ucy50cmVlSW5mby5sb2FkRGF0YVR5cGU7XHJcbiAgICAgICAgLy8g5qOA5p+l5a6M5pW05qCR6L+H5ruk5p2h5Lu2IEJ5IEx1Y2FzIDIwMjAwMzAyXHJcbiAgICAgICAgdGhpcy5uYXZPcHRpb25zLml0ZW1zID0gdGhpcy5sb29rdXBDbXAuY2hlY2tOb2RlQ2FuQmVTZWxlY3QodGhpcy5uYXZPcHRpb25zLml0ZW1zLCB0aGlzLm5hdk9wdGlvbnMudHJlZUluZm8ubG9hZERhdGFUeXBlID09PSAnYWxsJyk7XHJcbiAgICAgICAgdHQubG9hZERhdGEodGhpcy5uYXZPcHRpb25zLml0ZW1zKTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMubG9va3VwQ21wLm5hdlNlbGVjdGVkSWRzKSB7XHJcbiAgICAgICAgICAgIHR0LnNlbGVjdE5vZGUodGhpcy5sb29rdXBDbXAubmF2U2VsZWN0ZWRJZHMpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5sb29rdXBDbXAuc2VsZWN0Rmlyc3RJbk5hdikge1xyXG4gICAgICAgICAgICB0dC5zZWxlY3RGaXJzdE5vZGUoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuYWxsRGF0YSA9IHRoaXMubmF2T3B0aW9ucy5pdGVtcztcclxuXHJcbiAgICAgICAgY29uc3QgbG9hZFRyZWVEYXRhID0ge1xyXG4gICAgICAgICAgICBuZXh0OiAocmVzRGF0YTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlTG9hZGluZygpO1xyXG4gICAgICAgICAgICAgICAgdHQuY2xlYXJBbGwoKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW1zID0gdGhpcy5sb29rdXBDbXAuY2hlY2tOb2RlQ2FuQmVTZWxlY3QocmVzRGF0YS5pdGVtcywgdGhpcy5uYXZPcHRpb25zLnRyZWVJbmZvLmxvYWREYXRhVHlwZSA9PT0gJ2FsbCcpO1xyXG4gICAgICAgICAgICAgICAgdHQubG9hZERhdGEoaXRlbXMpO1xyXG4gICAgICAgICAgICAgICAgdHQucmVzaXplKCk7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGVycm9yOiAoZXJyKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlTG9hZGluZygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcblxyXG4gICAgICAgIHR0LnNlYXJjaC5zdWJzY3JpYmUoc2VhcmNoID0+IHtcclxuICAgICAgICAgICAgdGhpcy5fc2VhcmNoU3RhdGUgPSBzZWFyY2g7XHJcbiAgICAgICAgICAgIHRoaXMubG9va3VwQ21wLm5hdmlnYXRpb25GaWx0ZXIgPSBudWxsO1xyXG4gICAgICAgICAgICB0aGlzLmxvb2t1cENtcC5odHRwTWdyLmdldERhdGEoeyBzZWFyY2ggfSwgJ25hdnNlYXJjaCcpLnN1YnNjcmliZShsb2FkVHJlZURhdGEpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0dC5jb2x1bW5Tb3J0ZWQuc3Vic2NyaWJlKCAoc29ydDoge3NvcnROYW1lOiBzdHJpbmcsIHNvcnRPcmRlcjogYW55fSkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmxvb2t1cENtcC5uYXZpZ2F0aW9uRmlsdGVyID0gbnVsbDtcclxuICAgICAgICAgICAgaWYgKHR0LmxvYWREYXRhVHlwZSA9PT0gJ2FsbCcpIHtcclxuICAgICAgICAgICAgICAgIHR0LmNsaWVudFNvcnQoKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHsgc29ydE5hbWUsIHNvcnRPcmRlciB9ID0gey4uLnNvcnR9O1xyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IHBhcmFtID0gT2JqZWN0LmFzc2lnbih7IHNvcnROYW1lLCBzb3J0T3JkZXIgfSwgdGhpcy5fc2VhcmNoU3RhdGUpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5sb29rdXBDbXAuaHR0cE1nci5nZXREYXRhKHBhcmFtLCAnbmF2Jykuc3Vic2NyaWJlKGxvYWRUcmVlRGF0YSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdHQuY2xlYXJTZWFyY2hWYWx1ZS5zdWJzY3JpYmUoICgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5fc2VhcmNoU3RhdGUgPSBudWxsO1xyXG4gICAgICAgICAgICB0dC5sb2FkRGF0YSh0aGlzLmFsbERhdGEpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuXHJcbiAgICAgICAgdHQuZXhwYW5kLnN1YnNjcmliZSgodG46IGFueSkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLm9uTm9kZUV4cGFuZGVkKHRuLCB0dCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHByaXZhdGUgb25Ob2RlRXhwYW5kZWQodG46IGFueSwgdHQpIHtcclxuICAgICAgICBpZiAodG4ubGVhZikge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghdG4uY2hpbGRyZW4gfHwgIXRuLmNoaWxkcmVuLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBjb25zdCB0cmVlSW5mbyA9IHRoaXMubmF2T3B0aW9ucy50cmVlSW5mbztcclxuICAgICAgICAgICAgaWYgKHRoaXMubmF2T3B0aW9ucy50cmVlSW5mby5sb2FkRGF0YVR5cGUgPT09ICdhc3luYycpIHtcclxuICAgICAgICAgICAgICAgIGxldCBwYXJlbnRQYXRoID0gJyc7XHJcbiAgICAgICAgICAgICAgICBsZXQgcGFyZW50TGF5ZXIgPSAtMTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHsgZmllbGQgPSAnKicsIHZhbHVlID0gJycgfSA9IHtcclxuICAgICAgICAgICAgICAgICAgICAuLi50dC5zZWFyY2hEYXRhXHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHRuWydzaG93TG9hZGluZyddID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHR0LmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICAgICAgICAgIGlmICh0cmVlSW5mby5sYXllclR5cGUgPT09ICdwYXJlbnRJZCcpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyDniLZJROWKoOi9veaWueW8j1xyXG4gICAgICAgICAgICAgICAgICAgIHBhcmVudFBhdGggPSB0blsnaWQnXTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdHJlZUluZm9GaWVsZCA9IHRyZWVJbmZvLmRhdGFGaWVsZDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodHJlZUluZm9GaWVsZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRQYXRoID0gdG4uZGF0YVt0cmVlSW5mb0ZpZWxkXVt0cmVlSW5mby5wYXRoRmllbGRdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRMYXllciA9IHRuLmRhdGFbdHJlZUluZm9GaWVsZF1bdHJlZUluZm8ubGF5ZXJGaWVsZF07XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ+acquaJvuWIsOWIhue6p+S/oeaBr+OAgicpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMubG9va3VwQ21wLnVyaSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9va3VwQ21wLmV4cGFuZFRyZWVOb2RlLmVtaXQoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZTogdHQsIG5vZGU6IHRuLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRJZE9yUGF0aDogcGFyZW50UGF0aCwgcGFyZW50TGF5ZXIsIHNlYXJjaDogeyB2YWx1ZSwgZmllbGQgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLmdldENoaWxkcmVuKFxyXG4gICAgICAgICAgICAgICAgICAgIHBhcmVudFBhdGgsIHBhcmVudExheWVyLCB7c2VhcmNoRmllbGQ6IGZpZWxkID09PSAnKicgPyAnKicgOiBmaWVsZCwgc2VhcmNoVmFsdWU6IHZhbHVlfSwgdHRcclxuICAgICAgICAgICAgICAgICkuc3Vic2NyaWJlKGRhdGEgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0dCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodG4gJiYgZGF0YS5pdGVtcyAmJiBkYXRhLml0ZW1zLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHQuYXBwZW5kQ2hpbGRyZW4oZGF0YS5pdGVtcywgdG4pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRuWydzaG93TG9hZGluZyddID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHR0LmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldENoaWxkcmVuKCBwYXJlbnRQYXRoLCBwYXJlbnRMYXllciwgc2VhcmNoRGF0YTogeyBzZWFyY2hGaWVsZDogc3RyaW5nOyBzZWFyY2hWYWx1ZTogc3RyaW5nIH0sIHR0ICk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICAgICAgY29uc3QgdXJpID0gdGhpcy5sb29rdXBDbXAuZ3JpZE9wdGlvbnMudXJpO1xyXG4gICAgICAgIGNvbnN0IHNlYXJjaCA9IHsgcGFyZW50TGF5ZXIsIGNhdGVnb3J5OiAnbmF2JywgLi4uc2VhcmNoRGF0YSB9O1xyXG4gICAgICAgIGlmICh0aGlzLm5hdk9wdGlvbnMudHJlZUluZm8ubGF5ZXJUeXBlID09PSAncGFyZW50SWQnKSB7XHJcbiAgICAgICAgICAgIHNlYXJjaFsncGFyZW50SWQnXSA9IHBhcmVudFBhdGg7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgc2VhcmNoWydwYXJlbnRQYXRoJ10gPSBwYXJlbnRQYXRoO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgcGFyYW0gPSB7XHJcbiAgICAgICAgICAgIHNlYXJjaFZhbHVlOiBKU09OLnN0cmluZ2lmeShzZWFyY2gpLFxyXG4gICAgICAgICAgICBjdXN0b21EYXRhOiB0aGlzLmxvb2t1cENtcC5jdXN0b21EYXRhLFxyXG4gICAgICAgICAgICBlbmFibGVGdWxsVHJlZTogZmFsc2UsXHJcbiAgICAgICAgICAgIGxvYWRUcmVlRGF0YVR5cGU6ICdsYXllcmxvYWQnXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMubG9va3VwQ21wLmhlbHBJZCkge1xyXG4gICAgICAgICAgICBwYXJhbVsnaGVscElkJ10gPSB0aGlzLmxvb2t1cENtcC5oZWxwSWQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodHQgJiYgdHQuc29ydE5hbWUpIHtcclxuICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihwYXJhbSwge1xyXG4gICAgICAgICAgICAgICAgc29ydE5hbWU6IHR0LnNvcnROYW1lLFxyXG4gICAgICAgICAgICAgICAgc29ydE9yZGVyOiB0dC5zb3J0T3JkZXJcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5sb29rdXBDbXAuaHR0cC5nZXREYXRhKHVyaSAsIHBhcmFtKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgbG9hZERhdGEoKSB7XHJcbiAgICAgICAgdGhpcy5jbXBSZWYuaW5zdGFuY2UuYWxsQ29sdW1uc1RpdGxlID0gdGhpcy5sb29rdXBDbXAuYWxsQ29sdW1uc1RpdGxlO1xyXG4gICAgICAgIGlmICghdGhpcy5pc1RyZWVMaXN0KCkpIHtcclxuICAgICAgICAgICAgY29uc3QgZHQgPSB0aGlzLmNtcFJlZi5pbnN0YW5jZSBhcyBEYXRhVGFibGVDb21wb25lbnQ7XHJcbiAgICAgICAgICAgIHRoaXMuaW5pdERhdGFUYWJsZShkdCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY29uc3QgdHQgPSB0aGlzLmNtcFJlZi5pbnN0YW5jZSBhcyBUcmVlVGFibGVDb21wb25lbnQ7XHJcbiAgICAgICAgICAgIHRoaXMuaW5pdFRyZWVUYWJsZSh0dCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiJdfQ==