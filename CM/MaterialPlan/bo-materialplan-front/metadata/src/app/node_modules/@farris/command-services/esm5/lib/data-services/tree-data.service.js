import * as tslib_1 from "tslib";
import { Injectable, Optional } from '@angular/core';
import { of, empty, EMPTY } from 'rxjs';
import { tap, switchMap, concatMap } from 'rxjs/operators';
import { FrameContext, FieldMetadataUtil } from '@farris/devkit';
import { BefRepositoryUtil } from '@farris/bef';
import { FormLoadingService } from '../form-loading/form-loading.service';
import { FormNotifyService } from '../form-notify.service';
import { LanguageService } from '../languag.service';
import { FormMessageService } from '../form-message.service';
import { FormErrorService } from '../error/form-error.service';
import { BaseDataService } from './base-data.service';
import { TreeUtilFactory } from './tree-table/util/tree-util-factory';
import { TreeRepositoryFactory } from './tree-table/repository/tree-repository-factory';
// tslint:disable: no-string-literal
/**
 * 树数据服务
 */
var TreeDataService = /** @class */ (function (_super) {
    tslib_1.__extends(TreeDataService, _super);
    /**
     * 构造函数
     */
    function TreeDataService(frameContext, messageService, loadingService, notifyService, errorService, languageService) {
        var _this = _super.call(this, frameContext) || this;
        _this.messageService = messageService;
        _this.loadingService = loadingService;
        _this.notifyService = notifyService;
        _this.errorService = errorService;
        _this.languageService = languageService;
        if (!languageService) {
            _this.languageService = LanguageService.getInstance();
        }
        return _this;
    }
    Object.defineProperty(TreeDataService.prototype, "hierarchyInfoKey", {
        /**
         * 分级信息字段名
         */
        get: function () {
            return this.virtualRootFrameContext.getParam('hierarchyInfoKey');
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TreeDataService.prototype, "virtualRootFrameContext", {
        get: function () {
            return this.frameContext.getVirtualRootFrameContext();
        },
        enumerable: true,
        configurable: true
    });
    /**
     * 加载数据
     */
    TreeDataService.prototype.load = function (filters, sorts) {
        var _this = this;
        var filtersArray = this.parseConditions(filters);
        var sortsArray = this.parseConditions(sorts);
        var correctSelectedNode = this.repository.entityCollection.count() === 0;
        var loadingTimerId = this.loadingService.showLoadingWithDelay(500);
        var query$ = this.repository.getEntities(filtersArray, sortsArray, null, null);
        return query$.pipe(tap(function () {
            // 纠正选中节点
            if (correctSelectedNode === true) {
                var hierarchyType = _this.getHierarchyType();
                var treeNodeUtil = TreeUtilFactory.getInstance(hierarchyType);
                if (treeNodeUtil !== null) {
                    treeNodeUtil.selectFirstRootNode(_this.bindingData, _this.hierarchyInfoKey);
                }
            }
            _this.loadingService.hideDelayLoading(loadingTimerId);
        }, function (error) {
            _this.loadingService.hideDelayLoading(loadingTimerId);
            _this.errorService.exception(_this.languageService.loadFailed, error);
        }));
    };
    /**
     * 分层加载数据
     */
    TreeDataService.prototype.loadByLevel = function (filters, sorts, frozenCurrentRow) {
        var _this = this;
        this.setLoadByLevelState(filters, sorts);
        var filtersArray = this.parseConditions(filters);
        var sortsArray = this.parseConditions(sorts);
        // const parentId = this.bindingData.list.currentId;
        var parentId = this.getIdToExpand();
        var correctSelectedNode = this.repository.entityCollection.count() === 0;
        if (frozenCurrentRow === undefined) {
            frozenCurrentRow = false;
        }
        if (typeof frozenCurrentRow !== 'boolean') {
            frozenCurrentRow = frozenCurrentRow === 'true' ? true : false;
        }
        var hierarchyType = this.getHierarchyType();
        var repository = TreeRepositoryFactory.getInstance(hierarchyType);
        if (repository === null) {
            return empty();
        }
        var loadingTimerId = this.loadingService.showLoadingWithDelay(500);
        // 构造分页信息
        var pagination = this.buildPaginationInfo(parentId);
        var reload = this.frameContext.params.get('_RELOAD_CHILDREN_') || false;
        var query$ = repository.loadByParentId(this.repository, this.hierarchyInfoKey, parentId, filtersArray, sortsArray, frozenCurrentRow, pagination, this.frameContext, reload);
        return query$.pipe(tap(function (entities) {
            _this.frameContext.params.delete('_RELOAD_CHILDREN_');
            // 纠正选中节点
            if (correctSelectedNode === true) {
                var treeNodeUtil = TreeUtilFactory.getInstance(hierarchyType);
                if (treeNodeUtil !== null) {
                    treeNodeUtil.selectFirstRootNode(_this.bindingData, _this.hierarchyInfoKey);
                }
            }
            var currentRowId = _this.bindingData.list.currentItem.primaryKeyValue;
            if (frozenCurrentRow) {
                // 如果上一次选中行为本次加载数据中的一条，则应该重新选中该行
                var containsCurrentRow = entities.find(function (item) { return item.primaryValue === currentRowId; });
                if (containsCurrentRow) {
                    _this.setCurrentId(currentRowId);
                }
                // 原来的当前行不在已经加载的数据中，如展开到第三级，将第三级的某行设为当前行，全部收起，展开第一级
                if (!_this.repository.entityCollection.getEntityById(currentRowId)) {
                    var firstChildId = entities && Array.isArray(entities) && entities.length > 0 && entities[0].primaryValue || null;
                    if (firstChildId) {
                        _this.setCurrentId(firstChildId);
                    }
                }
            }
            _this.loadingService.hideDelayLoading(loadingTimerId);
        }, function (error) {
            _this.loadingService.hideDelayLoading(loadingTimerId);
            _this.errorService.exception(_this.languageService.loadFailed, error);
        }));
    };
    /**
     * 加载完整树
     * @param virtualPropertyName 虚拟字段
     * @param fullTreeType 是否是完整树加载 0：完整树 1：部分树
     * @param loadType 是否分级加载 0：全部加载 1：分级加载
     * @param filter 过滤条件
     * @param frozenCurrentRow 冻结当前行
     */
    TreeDataService.prototype.loadFullTree = function (virtualPropertyName, fullTreeType, loadType, filters, frozenCurrentRow) {
        var _this = this;
        if (typeof fullTreeType !== 'string') {
            throw new Error('ArgumentError: fullTreeType 不能为空且必须为字符串。');
        }
        if (typeof loadType !== 'string') {
            throw new Error('ArgumentError: loadType 不能为空且必须为字符串。');
        }
        if (frozenCurrentRow === undefined) {
            frozenCurrentRow = false;
        }
        if (typeof frozenCurrentRow !== 'boolean') {
            frozenCurrentRow = frozenCurrentRow === 'true' ? true : false;
        }
        var virtualRootFrameContext = this.virtualRootFrameContext;
        // 还原上次设置的结果集
        virtualRootFrameContext.params.delete('_DEVKIT_expandRowIds');
        virtualRootFrameContext.params.delete('_DEVKIT_selectedRowId');
        virtualRootFrameContext.uiState.setPropertyValue('__DEVKIT__selectedRow', null);
        var filtersArray = this.parseConditions(filters);
        var parentId = this.getIdToExpand();
        var correctSelectedNode = this.repository.entityCollection.count() === 0;
        var hierarchyType = this.getHierarchyType();
        var repository = TreeRepositoryFactory.getInstance(hierarchyType);
        if (repository === null) {
            return EMPTY;
        }
        var loadingTimerId = this.loadingService.showLoadingWithDelay(500);
        var context = {
            frameContext: this.frameContext,
            frozenCurrentRow: frozenCurrentRow
        };
        // tslint:disable-next-line: max-line-length
        var query$ = repository.loadFullTree(this.repository, this.hierarchyInfoKey, parentId, virtualPropertyName, fullTreeType, loadType, filtersArray, context);
        return query$.pipe(tap(function (entities) {
            var selectedRowId = virtualRootFrameContext.params.get('_DEVKIT_selectedRowId');
            // 纠正选中节点
            if (correctSelectedNode === true || !selectedRowId) {
                var treeNodeUtil = TreeUtilFactory.getInstance(hierarchyType);
                if (treeNodeUtil !== null) {
                    treeNodeUtil.selectFirstRootNode(_this.bindingData, _this.hierarchyInfoKey);
                }
            }
            var currentRowId = _this.bindingData.list.currentItem.primaryKeyValue;
            if (frozenCurrentRow) {
                // 如果上一次选中行为本次加载数据中的一条，则应该重新选中该行
                var containsCurrentRow = entities.find(function (item) { return item.primaryValue === currentRowId; });
                if (containsCurrentRow) {
                    _this.setCurrentId(currentRowId);
                }
                // 原来的当前行不在已经加载的数据中，如展开到第三级，将第三级的某行设为当前行，全部收起，展开第一级
                if (!_this.repository.entityCollection.getEntityById(currentRowId) && entities && entities.length > 0) {
                    var firstChildId = entities && Array.isArray(entities) && entities.length > 0 && entities[0].primaryValue || null;
                    if (firstChildId) {
                        _this.setCurrentId(firstChildId);
                    }
                }
            }
            _this.loadingService.hideDelayLoading(loadingTimerId);
        }, function (error) {
            _this.loadingService.hideDelayLoading(loadingTimerId);
            _this.errorService.exception(_this.languageService.loadFailed, error);
        }));
    };
    /**
     * 获取最新展开的节点
     */
    TreeDataService.prototype.getIdToExpand = function () {
        var expandNodes = this.virtualRootFrameContext.getParam('TREE_LATEST_EXPANDED_ID') || [];
        var idToExpand = expandNodes.pop();
        this.virtualRootFrameContext.setParam('TREE_LATEST_EXPANDED_ID', expandNodes);
        return idToExpand;
    };
    /**
     * 设置最新展开的节点
     */
    TreeDataService.prototype.setIdToExpand = function (idToExpand) {
        var expandNodes = this.virtualRootFrameContext.getParam('TREE_LATEST_EXPANDED_ID') || [];
        expandNodes.push(idToExpand);
        this.virtualRootFrameContext.setParam('TREE_LATEST_EXPANDED_ID', expandNodes);
    };
    /**
     * 解析过滤条件
     */
    TreeDataService.prototype.parseConditions = function (conditions) {
        var conditionsString = (!conditions || conditions === '') ? '[]' : conditions;
        return JSON.parse(conditionsString);
    };
    /**
     * 新增同级
     */
    TreeDataService.prototype.addSibling = function (id) {
        var _this = this;
        // 设计时id的获取改为从命令参数上获取，但设计时没有参数必填检查，
        // 如果打开表单保存了（即更新了最新的命令构件），但没有配置该参数，可能会传递过来一个空值，
        // 为了兼容此情况，使用当前行id作为id的值
        id = id ? id : this.bindingData.list.currentId;
        // 参数检查
        if (!id || id === 'undefined') {
            id = '';
        }
        // 记录最近一次修改的数据id
        var lastModifiedId = this.bindingData.list.currentId;
        // 获取分级方式
        var hierarchyType = this.getHierarchyType();
        // 执行取数
        var loadingTimerId = this.loadingService.showLoadingWithDelay(500);
        var repository = TreeRepositoryFactory.getInstance(hierarchyType);
        if (!repository) {
            // 错误的分级码
            throw new Error(this.languageService['errorHierarchyKey']);
        }
        var result$ = repository.addSibling(this.repository, id);
        return result$.pipe(tap(function () {
            _this.virtualRootFrameContext.setParam('IS_ADD', true);
            _this.virtualRootFrameContext.setParam('LAST_MODIFIED_ID', lastModifiedId);
            _this.loadingService.hideDelayLoading(loadingTimerId);
        }, function (error) {
            _this.loadingService.hideDelayLoading(loadingTimerId);
            _this.errorService.exception(_this.languageService.addSiblingFailed, error);
        }));
    };
    /**
     * 新增下级
     */
    TreeDataService.prototype.addChild = function (id) {
        var _this = this;
        // 原因同addSibling的修改
        id = id ? id : this.bindingData.list.currentId;
        // 参数检查
        if (!id) {
            // 请选择父节点
            this.notifyService.warning(this.languageService['plsSelectParentNode'], { hideTitle: true });
            return empty();
        }
        // 记录最近一次修改的数据id
        var lastModifiedId = this.bindingData.list.currentId;
        // 获取分级方式
        var hierarchyType = this.getHierarchyType();
        // 执行取数
        var loadingTimerId = this.loadingService.showLoadingWithDelay(500);
        // 新增的时候，要展开父节点
        this.setIdToExpand(id);
        var reloadChild$ = this.reloadByLevel();
        var repository = TreeRepositoryFactory.getInstance(hierarchyType);
        if (!repository) {
            throw new Error(this.languageService['errorHierarchyKey']);
        }
        var addChild$ = repository.addChild(this.repository, id);
        var result$ = reloadChild$.pipe(switchMap(function () {
            return addChild$;
        }), tap(function () {
            _this.virtualRootFrameContext.setParam('IS_ADD', true);
            _this.virtualRootFrameContext.setParam('LAST_MODIFIED_ID', lastModifiedId);
            _this.loadingService.hideDelayLoading(loadingTimerId);
        }, function (error) {
            _this.loadingService.hideDelayLoading(loadingTimerId);
            _this.errorService.exception(_this.languageService.addChildFailed, error);
        }));
        return result$;
    };
    /**
     * 批量保存
     */
    TreeDataService.prototype.save = function () {
        var _this = this;
        if (this.messagePipe) {
            this.messagePipe.next({ messageType: 'save' });
        }
        var loadingTimerId = this.loadingService.showLoadingWithDelay(500);
        var save$ = this.repository.applyChanges();
        var result$ = save$.pipe(tap(function () {
            _this.loadingService.hideDelayLoading(loadingTimerId);
            _this.notifyService.success(_this.languageService.saveSuccess, { hideTitle: true });
        }, function (error) {
            _this.loadingService.hideDelayLoading(loadingTimerId);
            _this.errorService.exception(_this.languageService.multiSaveFailed, error);
        }));
        return result$;
    };
    /**
     * 删除
     */
    TreeDataService.prototype.remove = function (id, successMsg) {
        var _this = this;
        // 原因同addSibling
        id = id ? id : this.bindingData.list.currentId;
        // 参数检查
        if (!id) {
            this.notifyService.warning(this.languageService['plsSelectDeleteData'], { hideTitle: true });
            return empty();
        }
        // 存在子节点不允许删除
        var treeNodesData = this.repository.entityCollection.toJSON();
        var hierarchyType = this.getHierarchyType();
        var treeNodeUtil = TreeUtilFactory.getInstance(hierarchyType);
        if (treeNodeUtil === null) {
            return empty();
        }
        if (treeNodeUtil.hasChildNodes(treeNodesData, this.hierarchyInfoKey, id) === true) {
            this.notifyService.warning(this.languageService['deleteChildFirst'], { hideTitle: true });
            return empty();
        }
        // 确认删除
        var action$ = this.messageService.question(this.languageService.confirmDeletion);
        return action$.pipe(concatMap(function (result) {
            if (!result) {
                return empty();
            }
            // 获取删除后要设置的节点id
            var nextNodeId = treeNodeUtil.getNextNodeId(treeNodesData, _this.hierarchyInfoKey, id);
            // 执行删除
            var loadingTimerId = _this.loadingService.showLoadingWithDelay(500);
            var remove$ = _this.frameContext.repository.removeById(id);
            return remove$.pipe(tap(function () {
                // 设置选中节点
                treeNodeUtil.selectedNode(_this.bindingData, _this.hierarchyInfoKey, nextNodeId);
                _this.loadingService.hideDelayLoading(loadingTimerId);
                if (successMsg && successMsg.trim()) {
                    _this.notifyService.success(successMsg, { hideTitle: true });
                }
                else {
                    _this.notifyService.success(_this.languageService.deleteSuccess, { hideTitle: true });
                }
                // this.notifyService.success(this.languageService.deleteSuccess, { hideTitle: true });
            }, function (error) {
                _this.loadingService.hideDelayLoading(loadingTimerId);
                _this.errorService.exception(_this.languageService.deleteFailed, error);
            }));
        }));
    };
    /**
     * 取消时检测未保存记录
     */
    TreeDataService.prototype.cancel = function () {
        var _this = this;
        // 没有变更时直接取消
        // const cardDataService = this.frameContext.injector.get<CardDataService>(CardDataService);
        var befRepository = this.repository;
        var hasUnsavedData = BefRepositoryUtil.isExistUnsaveData(befRepository);
        if (!hasUnsavedData) {
            return this._cancel();
        }
        var confirmResult$ = this.messageService.question(this.languageService['cancelWithoutSave']).pipe(switchMap(function (ifCancel) {
            if (ifCancel === false) {
                return EMPTY;
            }
            return _this._cancel();
        }));
        return confirmResult$;
    };
    /**
     * 构造分页信息
     * @param parentId parentId
     * @returns
     */
    TreeDataService.prototype.buildPaginationInfo = function (parentId) {
        var pagination = { pageIndex: 0, pageSize: 0 };
        var enableNodePagination = this.frameContext.params.get('enableNodePagination');
        if (!parentId) {
            // 一级分页
            var pageSize = this.repository.entityCollection.pageSize || 0;
            var pageIndex = this.repository.entityCollection.pageIndex || 0;
            // 启用了一级分页
            if (pageSize !== 0) {
                pagination.pageSize = pageSize;
                pagination.pageIndex = pageIndex;
            }
        }
        else {
            // 如果未启用节点分页或当前为顶级节点加载，则不处理节点分页
            if (enableNodePagination) {
                var nodePageSize = this.frameContext.params.get('nodePageSize') || 0;
                var nodePageIndex = this.frameContext.params.get("_NODE_" + parentId + "_PAGE_INDEX_");
                if (!nodePageIndex) {
                    this.frameContext.params.set("_NODE_" + parentId + "_PAGE_INDEX_", 1);
                    nodePageIndex = 1;
                }
                pagination.pageIndex = nodePageIndex;
                pagination.pageSize = nodePageSize;
            }
        }
        return pagination;
    };
    /**
     * 取消变更
     */
    TreeDataService.prototype._cancel = function () {
        var _this = this;
        var loadingTimerId = this.loadingService.showLoadingWithDelay(500);
        var cancel$ = this.repository.cancelChanges();
        return cancel$.pipe(switchMap(function () {
            var isAdd = _this.virtualRootFrameContext.getParam('IS_ADD');
            var lastModifiedId = _this.virtualRootFrameContext.getParam('LAST_MODIFIED_ID');
            var currentId = _this.bindingData.list.currentId;
            if (isAdd === true) {
                _this.repository.entityCollection.removeEntityById(currentId);
                // 重置编辑状态
                _this.virtualRootFrameContext.setParam('IS_ADD', false);
                if (lastModifiedId) {
                    setTimeout(function () {
                        _this.bindingData.list.setCurrentId(lastModifiedId, true, true);
                    }, 0);
                }
                return of(null);
            }
            else {
                return _this.repository.updateById(currentId);
            }
        }), tap(function () {
            _this.loadingService.hideDelayLoading(loadingTimerId);
        }, function (error) {
            _this.loadingService.hideDelayLoading(loadingTimerId);
            _this.errorService.exception(_this.languageService.cancelFailed, error);
        }));
    };
    /**
     * 检查是否存在下级节点（内部方法，请勿使用）
     */
    TreeDataService.prototype.hasChildNodes = function (id, treeNodesData) {
        var treeNodeUtil = this.getTreeNodeUtil();
        if (treeNodeUtil.hasChildNodes(treeNodesData, this.hierarchyInfoKey, id) === true) {
            return true;
        }
        return false;
    };
    /**
     * 计算删除后的当前节点id（内部方法，请勿使用）
     */
    TreeDataService.prototype.getNextNodeIdAfterRemoving = function (idToRemove, treeNodesData) {
        var treeNodeUtil = this.getTreeNodeUtil();
        var nextNodeId = treeNodeUtil.getNextNodeId(treeNodesData, this.hierarchyInfoKey, idToRemove);
        return nextNodeId;
    };
    /**
     * 设置删除后的当前节点节点（内部方法，请勿使用）
     */
    TreeDataService.prototype.setNextNodeAfterRemoving = function (nextNodeId) {
        var treeNodeUtil = this.getTreeNodeUtil();
        treeNodeUtil.selectedNode(this.bindingData, this.hierarchyInfoKey, nextNodeId);
    };
    /**
     * 设置树的当前行(给完整树使用)
     * @param id id
     */
    TreeDataService.prototype.setCurrentId = function (id) {
        id = id || this.frameContext.getVirtualRootFrameContext().uiState['__DEVKIT__selectedRow'] || this.bindingData.list.currentItem.primaryKeyValue;
        this.frameContext.bindingData.list.setCurrentId(id, true, true, true);
    };
    /**
     * 选中树的第一个节点
     */
    TreeDataService.prototype.selectFirstRow = function () {
        var hierarchyType = this.getHierarchyType();
        var treeNodeUtil = TreeUtilFactory.getInstance(hierarchyType);
        if (treeNodeUtil !== null) {
            treeNodeUtil.selectFirstRootNode(this.bindingData, this.hierarchyInfoKey);
        }
    };
    /**
     * 获取树节点工具类实例
     */
    TreeDataService.prototype.getTreeNodeUtil = function () {
        var hierarchyType = this.getHierarchyType();
        var treeNodeUtil = TreeUtilFactory.getInstance(hierarchyType);
        if (treeNodeUtil === null) {
            throw new Error("\u4E0D\u652F\u6301" + hierarchyType + "\u7C7B\u578B\u7684\u5206\u7EA7");
        }
        return treeNodeUtil;
    };
    /**
     * 记录加载状态
     * @todo：待删除
     */
    TreeDataService.prototype.setLoadByLevelState = function (filters, sorts) {
        // @todo：临时处理
        this.virtualRootFrameContext.setParam('isLoadTreeByLevel', true);
        this.virtualRootFrameContext.setParam('loadTreeByLevelFilter', filters);
        this.virtualRootFrameContext.setParam('loadTreeByLevelSort', sorts);
    };
    /**
     * 展开当前节点
     * @todo：待删除
     */
    TreeDataService.prototype.reloadByLevel = function () {
        var isLoadByLevel = this.virtualRootFrameContext.getParam('isLoadTreeByLevel');
        if (isLoadByLevel === true) {
            var filters = this.virtualRootFrameContext.getParam('loadTreeByLevelFilter');
            var sorts = this.virtualRootFrameContext.getParam('loadTreeByLevelSort');
            return this.loadByLevel(filters, sorts);
        }
        return of([]);
    };
    TreeDataService.prototype.getHierarchyType = function () {
        var ngObjects = FieldMetadataUtil.getNgObjects(this.repository.entityType);
        var hierarchyInfoNgObjectInfo = ngObjects[this.hierarchyInfoKey];
        var hierarchyType = 'path'; // 分级码默认为path，兼容原表单
        if (hierarchyInfoNgObjectInfo.hasOwnProperty('hierarchyType') && hierarchyInfoNgObjectInfo['hierarchyType'] != null) {
            hierarchyType = hierarchyInfoNgObjectInfo['hierarchyType'];
        }
        if (hierarchyType == null || hierarchyType.length < 1) {
            // '分级码配置信息错误'
            throw new Error(this.languageService['incorrectHierarchyConfig']);
        }
        return hierarchyType;
    };
    Object.defineProperty(TreeDataService.prototype, "messagePipe", {
        /**
         * 获取根组件消息管道
         */
        get: function () {
            if (this.frameContext) {
                var appContext = this.frameContext.getFormAppContext() || null;
                if (appContext) {
                    return appContext.messagePipe || null;
                }
            }
            return null;
        },
        enumerable: true,
        configurable: true
    });
    TreeDataService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    TreeDataService.ctorParameters = function () { return [
        { type: FrameContext },
        { type: FormMessageService },
        { type: FormLoadingService },
        { type: FormNotifyService },
        { type: FormErrorService },
        { type: LanguageService, decorators: [{ type: Optional }] }
    ]; };
    return TreeDataService;
}(BaseDataService));
export { TreeDataService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJlZS1kYXRhLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2NvbW1hbmQtc2VydmljZXMvIiwic291cmNlcyI6WyJsaWIvZGF0YS1zZXJ2aWNlcy90cmVlLWRhdGEuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDckQsT0FBTyxFQUFjLEVBQUUsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ3BELE9BQU8sRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRTNELE9BQU8sRUFBVSxZQUFZLEVBQUUsaUJBQWlCLEVBQW1CLE1BQU0sZ0JBQWdCLENBQUM7QUFDMUYsT0FBTyxFQUFpQixpQkFBaUIsRUFBRSxNQUFNLGFBQWEsQ0FBQztBQUUvRCxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxzQ0FBc0MsQ0FBQztBQUMxRSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUMzRCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDckQsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFDN0QsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFFL0QsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBRXRELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQ0FBcUMsQ0FBQztBQUN0RSxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSxpREFBaUQsQ0FBQztBQUN4RixvQ0FBb0M7QUFFcEM7O0dBRUc7QUFDSDtJQUM4QiwyQ0FBZTtJQVkzQzs7T0FFRztJQUNILHlCQUNFLFlBQTBCLEVBQ2xCLGNBQWtDLEVBQ2xDLGNBQWtDLEVBQ2xDLGFBQWdD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QUMsQ0FBQyxtQkFBbUI7UUFDL0MsSUFBSSx5QkFBeUIsQ0FBQyxjQUFjLENBQUMsZUFBZSxDQUFDLElBQUkseUJBQXlCLENBQUMsZUFBZSxDQUFDLElBQUksSUFBSSxFQUFFO1lBQ25ILGFBQWEsR0FBRyx5QkFBeUIsQ0FBQyxlQUFlLENBQVcsQ0FBQztTQUN0RTtRQUNELElBQUksYUFBYSxJQUFJLElBQUksSUFBSSxhQUFhLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUNyRCxjQUFjO1lBQ2QsTUFBTSxJQUFJLEtBQUssQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLDBCQUEwQixDQUFDLENBQUMsQ0FBQztTQUNuRTtRQUNELE9BQU8sYUFBYSxDQUFDO0lBQ3ZCLENBQUM7SUFJRCxzQkFBWSx3Q0FBVztRQUh2Qjs7V0FFRzthQUNIO1lBQ0UsSUFBSSxJQUFJLENBQUMsWUFBWSxFQUFFO2dCQUNyQixJQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLGlCQUFpQixFQUFFLElBQUksSUFBSSxDQUFDO2dCQUNqRSxJQUFJLFVBQVUsRUFBRTtvQkFDZCxPQUFPLFVBQVUsQ0FBQyxXQUFXLElBQUksSUFBSSxDQUFDO2lCQUN2QzthQUNGO1lBQ0QsT0FBTyxJQUFJLENBQUM7UUFDZCxDQUFDOzs7T0FBQTs7Z0JBbm1CRixVQUFVOzs7O2dCQWxCTSxZQUFZO2dCQU1wQixrQkFBa0I7Z0JBSGxCLGtCQUFrQjtnQkFDbEIsaUJBQWlCO2dCQUdqQixnQkFBZ0I7Z0JBRmhCLGVBQWUsdUJBbUNuQixRQUFROztJQThrQmIsc0JBQUM7Q0FBQSxBQXBtQkQsQ0FDOEIsZUFBZSxHQW1tQjVDO0FBQ0QsT0FBTyxFQUFFLGVBQWUsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgT3B0aW9uYWwgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgb2YsIGVtcHR5LCBFTVBUWSB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyB0YXAsIHN3aXRjaE1hcCwgY29uY2F0TWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5cclxuaW1wb3J0IHsgRW50aXR5LCBGcmFtZUNvbnRleHQsIEZpZWxkTWV0YWRhdGFVdGlsLCBOZ0ZpZWxkUHJvcGVydHkgfSBmcm9tICdAZmFycmlzL2RldmtpdCc7XHJcbmltcG9ydCB7IEJlZlJlcG9zaXRvcnksIEJlZlJlcG9zaXRvcnlVdGlsIH0gZnJvbSAnQGZhcnJpcy9iZWYnO1xyXG5cclxuaW1wb3J0IHsgRm9ybUxvYWRpbmdTZXJ2aWNlIH0gZnJvbSAnLi4vZm9ybS1sb2FkaW5nL2Zvcm0tbG9hZGluZy5zZXJ2aWNlJztcclxuaW1wb3J0IHsgRm9ybU5vdGlmeVNlcnZpY2UgfSBmcm9tICcuLi9mb3JtLW5vdGlmeS5zZXJ2aWNlJztcclxuaW1wb3J0IHsgTGFuZ3VhZ2VTZXJ2aWNlIH0gZnJvbSAnLi4vbGFuZ3VhZy5zZXJ2aWNlJztcclxuaW1wb3J0IHsgRm9ybU1lc3NhZ2VTZXJ2aWNlIH0gZnJvbSAnLi4vZm9ybS1tZXNzYWdlLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBGb3JtRXJyb3JTZXJ2aWNlIH0gZnJvbSAnLi4vZXJyb3IvZm9ybS1lcnJvci5zZXJ2aWNlJztcclxuXHJcbmltcG9ydCB7IEJhc2VEYXRhU2VydmljZSB9IGZyb20gJy4vYmFzZS1kYXRhLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBFZGl0U3RhdGVVdGlsIH0gZnJvbSAnLi91dGlscy9pbmRleCc7XHJcbmltcG9ydCB7IFRyZWVVdGlsRmFjdG9yeSB9IGZyb20gJy4vdHJlZS10YWJsZS91dGlsL3RyZWUtdXRpbC1mYWN0b3J5JztcclxuaW1wb3J0IHsgVHJlZVJlcG9zaXRvcnlGYWN0b3J5IH0gZnJvbSAnLi90cmVlLXRhYmxlL3JlcG9zaXRvcnkvdHJlZS1yZXBvc2l0b3J5LWZhY3RvcnknO1xyXG4vLyB0c2xpbnQ6ZGlzYWJsZTogbm8tc3RyaW5nLWxpdGVyYWxcclxuXHJcbi8qKlxyXG4gKiDmoJHmlbDmja7mnI3liqFcclxuICovXHJcbkBJbmplY3RhYmxlKClcclxuY2xhc3MgVHJlZURhdGFTZXJ2aWNlIGV4dGVuZHMgQmFzZURhdGFTZXJ2aWNlIHtcclxuXHJcbiAgLyoqXHJcbiAgICog5YiG57qn5L+h5oGv5a2X5q615ZCNXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXQgaGllcmFyY2h5SW5mb0tleSgpOiBzdHJpbmcge1xyXG4gICAgcmV0dXJuIHRoaXMudmlydHVhbFJvb3RGcmFtZUNvbnRleHQuZ2V0UGFyYW0oJ2hpZXJhcmNoeUluZm9LZXknKTtcclxuICB9XHJcbiAgcHJpdmF0ZSBnZXQgdmlydHVhbFJvb3RGcmFtZUNvbnRleHQoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5mcmFtZUNvbnRleHQuZ2V0VmlydHVhbFJvb3RGcmFtZUNvbnRleHQoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaehOmAoOWHveaVsFxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgZnJhbWVDb250ZXh0OiBGcmFtZUNvbnRleHQsXHJcbiAgICBwcml2YXRlIG1lc3NhZ2VTZXJ2aWNlOiBGb3JtTWVzc2FnZVNlcnZpY2UsXHJcbiAgICBwcml2YXRlIGxvYWRpbmdTZXJ2aWNlOiBGb3JtTG9hZGluZ1NlcnZpY2UsXHJcbiAgICBwcml2YXRlIG5vdGlmeVNlcnZpY2U6IEZvcm1Ob3RpZnlTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBlcnJvclNlcnZpY2U6IEZvcm1FcnJvclNlcnZpY2UsXHJcbiAgICBAT3B0aW9uYWwoKSBwcml2YXRlIGxhbmd1YWdlU2VydmljZTogTGFuZ3VhZ2VTZXJ2aWNlXHJcbiAgKSB7XHJcbiAgICBzdXBlcihmcmFtZUNvbnRleHQpO1xyXG4gICAgaWYgKCFsYW5ndWFnZVNlcnZpY2UpIHtcclxuICAgICAgdGhpcy5sYW5ndWFnZVNlcnZpY2UgPSBMYW5ndWFnZVNlcnZpY2UuZ2V0SW5zdGFuY2UoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWKoOi9veaVsOaNrlxyXG4gICAqL1xyXG4gIHB1YmxpYyBsb2FkKGZpbHRlcnM/OiBzdHJpbmcsIHNvcnRzPzogc3RyaW5nKTogT2JzZXJ2YWJsZTxFbnRpdHlbXT4ge1xyXG4gICAgY29uc3QgZmlsdGVyc0FycmF5ID0gdGhpcy5wYXJzZUNvbmRpdGlvbnMoZmlsdGVycyk7XHJcbiAgICBjb25zdCBzb3J0c0FycmF5ID0gdGhpcy5wYXJzZUNvbmRpdGlvbnMoc29ydHMpO1xyXG4gICAgY29uc3QgY29ycmVjdFNlbGVjdGVkTm9kZSA9IHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmNvdW50KCkgPT09IDA7XHJcblxyXG4gICAgY29uc3QgbG9hZGluZ1RpbWVySWQgPSB0aGlzLmxvYWRpbmdTZXJ2aWNlLnNob3dMb2FkaW5nV2l0aERlbGF5KDUwMCk7XHJcbiAgICBjb25zdCBxdWVyeSQgPSB0aGlzLnJlcG9zaXRvcnkuZ2V0RW50aXRpZXMoZmlsdGVyc0FycmF5LCBzb3J0c0FycmF5LCBudWxsLCBudWxsKTtcclxuICAgIHJldHVybiBxdWVyeSQucGlwZShcclxuICAgICAgdGFwKFxyXG4gICAgICAgICgpID0+IHtcclxuXHJcbiAgICAgICAgICAvLyDnuqDmraPpgInkuK3oioLngrlcclxuICAgICAgICAgIGlmIChjb3JyZWN0U2VsZWN0ZWROb2RlID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGhpZXJhcmNoeVR5cGUgPSB0aGlzLmdldEhpZXJhcmNoeVR5cGUoKTtcclxuICAgICAgICAgICAgY29uc3QgdHJlZU5vZGVVdGlsID0gVHJlZVV0aWxGYWN0b3J5LmdldEluc3RhbmNlKGhpZXJhcmNoeVR5cGUpO1xyXG4gICAgICAgICAgICBpZiAodHJlZU5vZGVVdGlsICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgdHJlZU5vZGVVdGlsLnNlbGVjdEZpcnN0Um9vdE5vZGUodGhpcy5iaW5kaW5nRGF0YSwgdGhpcy5oaWVyYXJjaHlJbmZvS2V5KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIHRoaXMubG9hZGluZ1NlcnZpY2UuaGlkZURlbGF5TG9hZGluZyhsb2FkaW5nVGltZXJJZCk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICAoZXJyb3I6IGFueSkgPT4ge1xyXG4gICAgICAgICAgdGhpcy5sb2FkaW5nU2VydmljZS5oaWRlRGVsYXlMb2FkaW5nKGxvYWRpbmdUaW1lcklkKTtcclxuICAgICAgICAgIHRoaXMuZXJyb3JTZXJ2aWNlLmV4Y2VwdGlvbih0aGlzLmxhbmd1YWdlU2VydmljZS5sb2FkRmFpbGVkLCBlcnJvcik7XHJcbiAgICAgICAgfVxyXG4gICAgICApXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5YiG5bGC5Yqg6L295pWw5o2uXHJcbiAgICovXHJcbiAgcHVibGljIGxvYWRCeUxldmVsKGZpbHRlcnM/OiBzdHJpbmcsIHNvcnRzPzogc3RyaW5nLCBmcm96ZW5DdXJyZW50Um93PzogYm9vbGVhbiB8IHN0cmluZyk6IE9ic2VydmFibGU8RW50aXR5W10+IHtcclxuICAgIHRoaXMuc2V0TG9hZEJ5TGV2ZWxTdGF0ZShmaWx0ZXJzLCBzb3J0cyk7XHJcbiAgICBjb25zdCBmaWx0ZXJzQXJyYXkgPSB0aGlzLnBhcnNlQ29uZGl0aW9ucyhmaWx0ZXJzKTtcclxuICAgIGNvbnN0IHNvcnRzQXJyYXkgPSB0aGlzLnBhcnNlQ29uZGl0aW9ucyhzb3J0cyk7XHJcbiAgICAvLyBjb25zdCBwYXJlbnRJZCA9IHRoaXMuYmluZGluZ0RhdGEubGlzdC5jdXJyZW50SWQ7XHJcbiAgICBjb25zdCBwYXJlbnRJZCA9IHRoaXMuZ2V0SWRUb0V4cGFuZCgpO1xyXG4gICAgY29uc3QgY29ycmVjdFNlbGVjdGVkTm9kZSA9IHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmNvdW50KCkgPT09IDA7XHJcbiAgICBpZiAoZnJvemVuQ3VycmVudFJvdyA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIGZyb3plbkN1cnJlbnRSb3cgPSBmYWxzZTtcclxuICAgIH1cclxuICAgIGlmICh0eXBlb2YgZnJvemVuQ3VycmVudFJvdyAhPT0gJ2Jvb2xlYW4nKSB7XHJcbiAgICAgIGZyb3plbkN1cnJlbnRSb3cgPSBmcm96ZW5DdXJyZW50Um93ID09PSAndHJ1ZScgPyB0cnVlIDogZmFsc2U7XHJcbiAgICB9XHJcbiAgICBjb25zdCBoaWVyYXJjaHlUeXBlID0gdGhpcy5nZXRIaWVyYXJjaHlUeXBlKCk7XHJcbiAgICBjb25zdCByZXBvc2l0b3J5ID0gVHJlZVJlcG9zaXRvcnlGYWN0b3J5LmdldEluc3RhbmNlKGhpZXJhcmNoeVR5cGUpO1xyXG5cclxuICAgIGlmIChyZXBvc2l0b3J5ID09PSBudWxsKSB7XHJcbiAgICAgIHJldHVybiBlbXB0eSgpO1xyXG4gICAgfVxyXG4gICAgY29uc3QgbG9hZGluZ1RpbWVySWQgPSB0aGlzLmxvYWRpbmdTZXJ2aWNlLnNob3dMb2FkaW5nV2l0aERlbGF5KDUwMCk7XHJcbiAgICAvLyDmnoTpgKDliIbpobXkv6Hmga9cclxuICAgIGNvbnN0IHBhZ2luYXRpb24gPSB0aGlzLmJ1aWxkUGFnaW5hdGlvbkluZm8ocGFyZW50SWQpO1xyXG4gICAgY29uc3QgcmVsb2FkID0gdGhpcy5mcmFtZUNvbnRleHQucGFyYW1zLmdldCgnX1JFTE9BRF9DSElMRFJFTl8nKSB8fCBmYWxzZTtcclxuICAgIGNvbnN0IHF1ZXJ5JCA9IHJlcG9zaXRvcnkubG9hZEJ5UGFyZW50SWQodGhpcy5yZXBvc2l0b3J5LCB0aGlzLmhpZXJhcmNoeUluZm9LZXksIHBhcmVudElkLCBmaWx0ZXJzQXJyYXksIHNvcnRzQXJyYXksIGZyb3plbkN1cnJlbnRSb3csIHBhZ2luYXRpb24sIHRoaXMuZnJhbWVDb250ZXh0LCByZWxvYWQpO1xyXG4gICAgcmV0dXJuIHF1ZXJ5JC5waXBlKFxyXG4gICAgICB0YXAoXHJcbiAgICAgICAgKGVudGl0aWVzOiBFbnRpdHlbXSkgPT4ge1xyXG4gICAgICAgICAgdGhpcy5mcmFtZUNvbnRleHQucGFyYW1zLmRlbGV0ZSgnX1JFTE9BRF9DSElMRFJFTl8nKTtcclxuICAgICAgICAgIC8vIOe6oOato+mAieS4reiKgueCuVxyXG4gICAgICAgICAgaWYgKGNvcnJlY3RTZWxlY3RlZE5vZGUgPT09IHRydWUpIHtcclxuICAgICAgICAgICAgY29uc3QgdHJlZU5vZGVVdGlsID0gVHJlZVV0aWxGYWN0b3J5LmdldEluc3RhbmNlKGhpZXJhcmNoeVR5cGUpO1xyXG4gICAgICAgICAgICBpZiAodHJlZU5vZGVVdGlsICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgdHJlZU5vZGVVdGlsLnNlbGVjdEZpcnN0Um9vdE5vZGUodGhpcy5iaW5kaW5nRGF0YSwgdGhpcy5oaWVyYXJjaHlJbmZvS2V5KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgY29uc3QgY3VycmVudFJvd0lkID0gdGhpcy5iaW5kaW5nRGF0YS5saXN0LmN1cnJlbnRJdGVtLnByaW1hcnlLZXlWYWx1ZTtcclxuICAgICAgICAgIGlmIChmcm96ZW5DdXJyZW50Um93KSB7XHJcbiAgICAgICAgICAgIC8vIOWmguaenOS4iuS4gOasoemAieS4reihjOS4uuacrOasoeWKoOi9veaVsOaNruS4reeahOS4gOadoe+8jOWImeW6lOivpemHjeaWsOmAieS4reivpeihjFxyXG4gICAgICAgICAgICBjb25zdCBjb250YWluc0N1cnJlbnRSb3cgPSBlbnRpdGllcy5maW5kKGl0ZW0gPT4gaXRlbS5wcmltYXJ5VmFsdWUgPT09IGN1cnJlbnRSb3dJZCk7XHJcbiAgICAgICAgICAgIGlmIChjb250YWluc0N1cnJlbnRSb3cpIHtcclxuICAgICAgICAgICAgICB0aGlzLnNldEN1cnJlbnRJZChjdXJyZW50Um93SWQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIOWOn+adpeeahOW9k+WJjeihjOS4jeWcqOW3sue7j+WKoOi9veeahOaVsOaNruS4re+8jOWmguWxleW8gOWIsOesrOS4iee6p++8jOWwhuesrOS4iee6p+eahOafkOihjOiuvuS4uuW9k+WJjeihjO+8jOWFqOmDqOaUtui1t++8jOWxleW8gOesrOS4gOe6p1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmdldEVudGl0eUJ5SWQoY3VycmVudFJvd0lkKSkge1xyXG4gICAgICAgICAgICAgIGNvbnN0IGZpcnN0Q2hpbGRJZCA9IGVudGl0aWVzICYmIEFycmF5LmlzQXJyYXkoZW50aXRpZXMpICYmIGVudGl0aWVzLmxlbmd0aCA+IDAgJiYgZW50aXRpZXNbMF0ucHJpbWFyeVZhbHVlIHx8IG51bGw7XHJcbiAgICAgICAgICAgICAgaWYgKGZpcnN0Q2hpbGRJZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRDdXJyZW50SWQoZmlyc3RDaGlsZElkKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHRoaXMubG9hZGluZ1NlcnZpY2UuaGlkZURlbGF5TG9hZGluZyhsb2FkaW5nVGltZXJJZCk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlcnJvciA9PiB7XHJcbiAgICAgICAgICB0aGlzLmxvYWRpbmdTZXJ2aWNlLmhpZGVEZWxheUxvYWRpbmcobG9hZGluZ1RpbWVySWQpO1xyXG4gICAgICAgICAgdGhpcy5lcnJvclNlcnZpY2UuZXhjZXB0aW9uKHRoaXMubGFuZ3VhZ2VTZXJ2aWNlLmxvYWRGYWlsZWQsIGVycm9yKTtcclxuICAgICAgICB9XHJcbiAgICAgIClcclxuICAgICk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWKoOi9veWujOaVtOagkVxyXG4gICAqIEBwYXJhbSB2aXJ0dWFsUHJvcGVydHlOYW1lIOiZmuaLn+Wtl+autVxyXG4gICAqIEBwYXJhbSBmdWxsVHJlZVR5cGUg5piv5ZCm5piv5a6M5pW05qCR5Yqg6L29IDDvvJrlrozmlbTmoJEgMe+8mumDqOWIhuagkVxyXG4gICAqIEBwYXJhbSBsb2FkVHlwZSDmmK/lkKbliIbnuqfliqDovb0gMO+8muWFqOmDqOWKoOi9vSAx77ya5YiG57qn5Yqg6L29XHJcbiAgICogQHBhcmFtIGZpbHRlciDov4fmu6TmnaHku7ZcclxuICAgKiBAcGFyYW0gZnJvemVuQ3VycmVudFJvdyDlhrvnu5PlvZPliY3ooYxcclxuICAgKi9cclxuICBwdWJsaWMgbG9hZEZ1bGxUcmVlKHZpcnR1YWxQcm9wZXJ0eU5hbWU6IHN0cmluZywgZnVsbFRyZWVUeXBlOiBzdHJpbmcsIGxvYWRUeXBlOiBzdHJpbmcsIGZpbHRlcnM6IHN0cmluZywgZnJvemVuQ3VycmVudFJvdz86IGJvb2xlYW4gfCBzdHJpbmcpOiBPYnNlcnZhYmxlPEVudGl0eVtdPiB7XHJcbiAgICBpZiAodHlwZW9mIGZ1bGxUcmVlVHlwZSAhPT0gJ3N0cmluZycpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdBcmd1bWVudEVycm9yOiBmdWxsVHJlZVR5cGUg5LiN6IO95Li656m65LiU5b+F6aG75Li65a2X56ym5Liy44CCJyk7XHJcbiAgICB9XHJcbiAgICBpZiAodHlwZW9mIGxvYWRUeXBlICE9PSAnc3RyaW5nJykge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0FyZ3VtZW50RXJyb3I6IGxvYWRUeXBlIOS4jeiDveS4uuepuuS4lOW/hemhu+S4uuWtl+espuS4suOAgicpO1xyXG4gICAgfVxyXG4gICAgaWYgKGZyb3plbkN1cnJlbnRSb3cgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICBmcm96ZW5DdXJyZW50Um93ID0gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBpZiAodHlwZW9mIGZyb3plbkN1cnJlbnRSb3cgIT09ICdib29sZWFuJykge1xyXG4gICAgICBmcm96ZW5DdXJyZW50Um93ID0gZnJvemVuQ3VycmVudFJvdyA9PT0gJ3RydWUnID8gdHJ1ZSA6IGZhbHNlO1xyXG4gICAgfVxyXG4gICAgY29uc3QgdmlydHVhbFJvb3RGcmFtZUNvbnRleHQgPSB0aGlzLnZpcnR1YWxSb290RnJhbWVDb250ZXh0O1xyXG4gICAgLy8g6L+Y5Y6f5LiK5qyh6K6+572u55qE57uT5p6c6ZuGXHJcbiAgICB2aXJ0dWFsUm9vdEZyYW1lQ29udGV4dC5wYXJhbXMuZGVsZXRlKCdfREVWS0lUX2V4cGFuZFJvd0lkcycpO1xyXG4gICAgdmlydHVhbFJvb3RGcmFtZUNvbnRleHQucGFyYW1zLmRlbGV0ZSgnX0RFVktJVF9zZWxlY3RlZFJvd0lkJyk7XHJcbiAgICB2aXJ0dWFsUm9vdEZyYW1lQ29udGV4dC51aVN0YXRlLnNldFByb3BlcnR5VmFsdWUoJ19fREVWS0lUX19zZWxlY3RlZFJvdycsIG51bGwpO1xyXG4gICAgY29uc3QgZmlsdGVyc0FycmF5ID0gdGhpcy5wYXJzZUNvbmRpdGlvbnMoZmlsdGVycyk7XHJcbiAgICBjb25zdCBwYXJlbnRJZCA9IHRoaXMuZ2V0SWRUb0V4cGFuZCgpO1xyXG4gICAgY29uc3QgY29ycmVjdFNlbGVjdGVkTm9kZSA9IHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmNvdW50KCkgPT09IDA7XHJcbiAgICBjb25zdCBoaWVyYXJjaHlUeXBlID0gdGhpcy5nZXRIaWVyYXJjaHlUeXBlKCk7XHJcbiAgICBjb25zdCByZXBvc2l0b3J5ID0gVHJlZVJlcG9zaXRvcnlGYWN0b3J5LmdldEluc3RhbmNlKGhpZXJhcmNoeVR5cGUpO1xyXG5cclxuICAgIGlmIChyZXBvc2l0b3J5ID09PSBudWxsKSB7XHJcbiAgICAgIHJldHVybiBFTVBUWTtcclxuICAgIH1cclxuICAgIGNvbnN0IGxvYWRpbmdUaW1lcklkID0gdGhpcy5sb2FkaW5nU2VydmljZS5zaG93TG9hZGluZ1dpdGhEZWxheSg1MDApO1xyXG4gICAgY29uc3QgY29udGV4dCA9IHtcclxuICAgICAgZnJhbWVDb250ZXh0OiB0aGlzLmZyYW1lQ29udGV4dCxcclxuICAgICAgZnJvemVuQ3VycmVudFJvd1xyXG4gICAgfTtcclxuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogbWF4LWxpbmUtbGVuZ3RoXHJcbiAgICBjb25zdCBxdWVyeSQgPSByZXBvc2l0b3J5LmxvYWRGdWxsVHJlZSh0aGlzLnJlcG9zaXRvcnksIHRoaXMuaGllcmFyY2h5SW5mb0tleSwgcGFyZW50SWQsIHZpcnR1YWxQcm9wZXJ0eU5hbWUsIGZ1bGxUcmVlVHlwZSwgbG9hZFR5cGUsIGZpbHRlcnNBcnJheSwgY29udGV4dCk7XHJcbiAgICByZXR1cm4gcXVlcnkkLnBpcGUoXHJcbiAgICAgIHRhcChcclxuICAgICAgICAoZW50aXRpZXM6IEVudGl0eVtdKSA9PiB7XHJcbiAgICAgICAgICBjb25zdCBzZWxlY3RlZFJvd0lkID0gdmlydHVhbFJvb3RGcmFtZUNvbnRleHQucGFyYW1zLmdldCgnX0RFVktJVF9zZWxlY3RlZFJvd0lkJyk7XHJcbiAgICAgICAgICAvLyDnuqDmraPpgInkuK3oioLngrlcclxuICAgICAgICAgIGlmIChjb3JyZWN0U2VsZWN0ZWROb2RlID09PSB0cnVlIHx8ICFzZWxlY3RlZFJvd0lkKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRyZWVOb2RlVXRpbCA9IFRyZWVVdGlsRmFjdG9yeS5nZXRJbnN0YW5jZShoaWVyYXJjaHlUeXBlKTtcclxuICAgICAgICAgICAgaWYgKHRyZWVOb2RlVXRpbCAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgIHRyZWVOb2RlVXRpbC5zZWxlY3RGaXJzdFJvb3ROb2RlKHRoaXMuYmluZGluZ0RhdGEsIHRoaXMuaGllcmFyY2h5SW5mb0tleSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGNvbnN0IGN1cnJlbnRSb3dJZCA9IHRoaXMuYmluZGluZ0RhdGEubGlzdC5jdXJyZW50SXRlbS5wcmltYXJ5S2V5VmFsdWU7XHJcbiAgICAgICAgICBpZiAoZnJvemVuQ3VycmVudFJvdykge1xyXG4gICAgICAgICAgICAvLyDlpoLmnpzkuIrkuIDmrKHpgInkuK3ooYzkuLrmnKzmrKHliqDovb3mlbDmja7kuK3nmoTkuIDmnaHvvIzliJnlupTor6Xph43mlrDpgInkuK3or6XooYxcclxuICAgICAgICAgICAgY29uc3QgY29udGFpbnNDdXJyZW50Um93ID0gZW50aXRpZXMuZmluZChpdGVtID0+IGl0ZW0ucHJpbWFyeVZhbHVlID09PSBjdXJyZW50Um93SWQpO1xyXG4gICAgICAgICAgICBpZiAoY29udGFpbnNDdXJyZW50Um93KSB7XHJcbiAgICAgICAgICAgICAgdGhpcy5zZXRDdXJyZW50SWQoY3VycmVudFJvd0lkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyDljp/mnaXnmoTlvZPliY3ooYzkuI3lnKjlt7Lnu4/liqDovb3nmoTmlbDmja7kuK3vvIzlpoLlsZXlvIDliLDnrKzkuInnuqfvvIzlsIbnrKzkuInnuqfnmoTmn5DooYzorr7kuLrlvZPliY3ooYzvvIzlhajpg6jmlLbotbfvvIzlsZXlvIDnrKzkuIDnuqdcclxuICAgICAgICAgICAgaWYgKCF0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5nZXRFbnRpdHlCeUlkKGN1cnJlbnRSb3dJZCkgJiYgZW50aXRpZXMgJiYgZW50aXRpZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgIGNvbnN0IGZpcnN0Q2hpbGRJZCA9IGVudGl0aWVzICYmIEFycmF5LmlzQXJyYXkoZW50aXRpZXMpICYmIGVudGl0aWVzLmxlbmd0aCA+IDAgJiYgZW50aXRpZXNbMF0ucHJpbWFyeVZhbHVlIHx8IG51bGw7XHJcbiAgICAgICAgICAgICAgaWYgKGZpcnN0Q2hpbGRJZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRDdXJyZW50SWQoZmlyc3RDaGlsZElkKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHRoaXMubG9hZGluZ1NlcnZpY2UuaGlkZURlbGF5TG9hZGluZyhsb2FkaW5nVGltZXJJZCk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlcnJvciA9PiB7XHJcbiAgICAgICAgICB0aGlzLmxvYWRpbmdTZXJ2aWNlLmhpZGVEZWxheUxvYWRpbmcobG9hZGluZ1RpbWVySWQpO1xyXG4gICAgICAgICAgdGhpcy5lcnJvclNlcnZpY2UuZXhjZXB0aW9uKHRoaXMubGFuZ3VhZ2VTZXJ2aWNlLmxvYWRGYWlsZWQsIGVycm9yKTtcclxuICAgICAgICB9XHJcbiAgICAgIClcclxuICAgICk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluacgOaWsOWxleW8gOeahOiKgueCuVxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRJZFRvRXhwYW5kKCkge1xyXG4gICAgY29uc3QgZXhwYW5kTm9kZXMgPSB0aGlzLnZpcnR1YWxSb290RnJhbWVDb250ZXh0LmdldFBhcmFtKCdUUkVFX0xBVEVTVF9FWFBBTkRFRF9JRCcpIHx8IFtdO1xyXG4gICAgY29uc3QgaWRUb0V4cGFuZCA9IGV4cGFuZE5vZGVzLnBvcCgpO1xyXG4gICAgdGhpcy52aXJ0dWFsUm9vdEZyYW1lQ29udGV4dC5zZXRQYXJhbSgnVFJFRV9MQVRFU1RfRVhQQU5ERURfSUQnLCBleHBhbmROb2Rlcyk7XHJcbiAgICByZXR1cm4gaWRUb0V4cGFuZDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiuvue9ruacgOaWsOWxleW8gOeahOiKgueCuVxyXG4gICAqL1xyXG4gIHB1YmxpYyBzZXRJZFRvRXhwYW5kKGlkVG9FeHBhbmQ6IHN0cmluZyk6IHZvaWQge1xyXG4gICAgY29uc3QgZXhwYW5kTm9kZXMgPSB0aGlzLnZpcnR1YWxSb290RnJhbWVDb250ZXh0LmdldFBhcmFtKCdUUkVFX0xBVEVTVF9FWFBBTkRFRF9JRCcpIHx8IFtdO1xyXG4gICAgZXhwYW5kTm9kZXMucHVzaChpZFRvRXhwYW5kKTtcclxuICAgIHRoaXMudmlydHVhbFJvb3RGcmFtZUNvbnRleHQuc2V0UGFyYW0oJ1RSRUVfTEFURVNUX0VYUEFOREVEX0lEJywgZXhwYW5kTm9kZXMpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6Kej5p6Q6L+H5ruk5p2h5Lu2XHJcbiAgICovXHJcbiAgcHVibGljIHBhcnNlQ29uZGl0aW9ucyhjb25kaXRpb25zPzogc3RyaW5nKTogYW55W10ge1xyXG4gICAgY29uc3QgY29uZGl0aW9uc1N0cmluZyA9ICghY29uZGl0aW9ucyB8fCBjb25kaXRpb25zID09PSAnJykgPyAnW10nIDogY29uZGl0aW9ucztcclxuICAgIHJldHVybiBKU09OLnBhcnNlKGNvbmRpdGlvbnNTdHJpbmcpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5paw5aKe5ZCM57qnXHJcbiAgICovXHJcbiAgcHVibGljIGFkZFNpYmxpbmcoaWQ6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XHJcblxyXG4gICAgLy8g6K6+6K6h5pe2aWTnmoTojrflj5bmlLnkuLrku47lkb3ku6Tlj4LmlbDkuIrojrflj5bvvIzkvYborr7orqHml7bmsqHmnInlj4LmlbDlv4Xloavmo4Dmn6XvvIxcclxuICAgIC8vIOWmguaenOaJk+W8gOihqOWNleS/neWtmOS6hu+8iOWNs+abtOaWsOS6huacgOaWsOeahOWRveS7pOaehOS7tu+8ie+8jOS9huayoeaciemFjee9ruivpeWPguaVsO+8jOWPr+iDveS8muS8oOmAkui/h+adpeS4gOS4quepuuWAvO+8jFxyXG4gICAgLy8g5Li65LqG5YW85a655q2k5oOF5Ya177yM5L2/55So5b2T5YmN6KGMaWTkvZzkuLppZOeahOWAvFxyXG4gICAgaWQgPSBpZCA/IGlkIDogdGhpcy5iaW5kaW5nRGF0YS5saXN0LmN1cnJlbnRJZDtcclxuXHJcbiAgICAvLyDlj4LmlbDmo4Dmn6VcclxuICAgIGlmICghaWQgfHwgaWQgPT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgIGlkID0gJyc7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g6K6w5b2V5pyA6L+R5LiA5qyh5L+u5pS555qE5pWw5o2uaWRcclxuICAgIGNvbnN0IGxhc3RNb2RpZmllZElkID0gdGhpcy5iaW5kaW5nRGF0YS5saXN0LmN1cnJlbnRJZDtcclxuICAgIC8vIOiOt+WPluWIhue6p+aWueW8j1xyXG4gICAgY29uc3QgaGllcmFyY2h5VHlwZTogc3RyaW5nID0gdGhpcy5nZXRIaWVyYXJjaHlUeXBlKCk7XHJcbiAgICAvLyDmiafooYzlj5bmlbBcclxuICAgIGNvbnN0IGxvYWRpbmdUaW1lcklkID0gdGhpcy5sb2FkaW5nU2VydmljZS5zaG93TG9hZGluZ1dpdGhEZWxheSg1MDApO1xyXG4gICAgY29uc3QgcmVwb3NpdG9yeSA9IFRyZWVSZXBvc2l0b3J5RmFjdG9yeS5nZXRJbnN0YW5jZShoaWVyYXJjaHlUeXBlKTtcclxuICAgIGlmICghcmVwb3NpdG9yeSkge1xyXG4gICAgICAvLyDplJnor6/nmoTliIbnuqfnoIFcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKHRoaXMubGFuZ3VhZ2VTZXJ2aWNlWydlcnJvckhpZXJhcmNoeUtleSddKTtcclxuICAgIH1cclxuICAgIGNvbnN0IHJlc3VsdCQgPSByZXBvc2l0b3J5LmFkZFNpYmxpbmcodGhpcy5yZXBvc2l0b3J5LCBpZCk7XHJcbiAgICByZXR1cm4gcmVzdWx0JC5waXBlKFxyXG4gICAgICB0YXAoXHJcbiAgICAgICAgKCkgPT4ge1xyXG4gICAgICAgICAgdGhpcy52aXJ0dWFsUm9vdEZyYW1lQ29udGV4dC5zZXRQYXJhbSgnSVNfQUREJywgdHJ1ZSk7XHJcbiAgICAgICAgICB0aGlzLnZpcnR1YWxSb290RnJhbWVDb250ZXh0LnNldFBhcmFtKCdMQVNUX01PRElGSUVEX0lEJywgbGFzdE1vZGlmaWVkSWQpO1xyXG4gICAgICAgICAgdGhpcy5sb2FkaW5nU2VydmljZS5oaWRlRGVsYXlMb2FkaW5nKGxvYWRpbmdUaW1lcklkKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVycm9yID0+IHtcclxuICAgICAgICAgIHRoaXMubG9hZGluZ1NlcnZpY2UuaGlkZURlbGF5TG9hZGluZyhsb2FkaW5nVGltZXJJZCk7XHJcbiAgICAgICAgICB0aGlzLmVycm9yU2VydmljZS5leGNlcHRpb24odGhpcy5sYW5ndWFnZVNlcnZpY2UuYWRkU2libGluZ0ZhaWxlZCwgZXJyb3IpO1xyXG4gICAgICAgIH1cclxuICAgICAgKVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaWsOWinuS4i+e6p1xyXG4gICAqL1xyXG4gIHB1YmxpYyBhZGRDaGlsZChpZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuXHJcbiAgICAvLyDljp/lm6DlkIxhZGRTaWJsaW5n55qE5L+u5pS5XHJcbiAgICBpZCA9IGlkID8gaWQgOiB0aGlzLmJpbmRpbmdEYXRhLmxpc3QuY3VycmVudElkO1xyXG5cclxuICAgIC8vIOWPguaVsOajgOafpVxyXG4gICAgaWYgKCFpZCkge1xyXG4gICAgICAvLyDor7fpgInmi6nniLboioLngrlcclxuICAgICAgdGhpcy5ub3RpZnlTZXJ2aWNlLndhcm5pbmcodGhpcy5sYW5ndWFnZVNlcnZpY2VbJ3Bsc1NlbGVjdFBhcmVudE5vZGUnXSwgeyBoaWRlVGl0bGU6IHRydWUgfSk7XHJcbiAgICAgIHJldHVybiBlbXB0eSgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOiusOW9leacgOi/keS4gOasoeS/ruaUueeahOaVsOaNrmlkXHJcbiAgICBjb25zdCBsYXN0TW9kaWZpZWRJZCA9IHRoaXMuYmluZGluZ0RhdGEubGlzdC5jdXJyZW50SWQ7XHJcbiAgICAvLyDojrflj5bliIbnuqfmlrnlvI9cclxuICAgIGNvbnN0IGhpZXJhcmNoeVR5cGUgPSB0aGlzLmdldEhpZXJhcmNoeVR5cGUoKTtcclxuICAgIC8vIOaJp+ihjOWPluaVsFxyXG4gICAgY29uc3QgbG9hZGluZ1RpbWVySWQgPSB0aGlzLmxvYWRpbmdTZXJ2aWNlLnNob3dMb2FkaW5nV2l0aERlbGF5KDUwMCk7XHJcblxyXG4gICAgLy8g5paw5aKe55qE5pe25YCZ77yM6KaB5bGV5byA54i26IqC54K5XHJcbiAgICB0aGlzLnNldElkVG9FeHBhbmQoaWQpO1xyXG4gICAgY29uc3QgcmVsb2FkQ2hpbGQkID0gdGhpcy5yZWxvYWRCeUxldmVsKCk7XHJcblxyXG4gICAgY29uc3QgcmVwb3NpdG9yeSA9IFRyZWVSZXBvc2l0b3J5RmFjdG9yeS5nZXRJbnN0YW5jZShoaWVyYXJjaHlUeXBlKTtcclxuICAgIGlmICghcmVwb3NpdG9yeSkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IodGhpcy5sYW5ndWFnZVNlcnZpY2VbJ2Vycm9ySGllcmFyY2h5S2V5J10pO1xyXG4gICAgfVxyXG4gICAgY29uc3QgYWRkQ2hpbGQkID0gcmVwb3NpdG9yeS5hZGRDaGlsZCh0aGlzLnJlcG9zaXRvcnksIGlkKTtcclxuICAgIGNvbnN0IHJlc3VsdCQgPSByZWxvYWRDaGlsZCQucGlwZShcclxuICAgICAgc3dpdGNoTWFwKCgpID0+IHtcclxuICAgICAgICByZXR1cm4gYWRkQ2hpbGQkO1xyXG4gICAgICB9KSxcclxuICAgICAgdGFwKFxyXG4gICAgICAgICgpID0+IHtcclxuICAgICAgICAgIHRoaXMudmlydHVhbFJvb3RGcmFtZUNvbnRleHQuc2V0UGFyYW0oJ0lTX0FERCcsIHRydWUpO1xyXG4gICAgICAgICAgdGhpcy52aXJ0dWFsUm9vdEZyYW1lQ29udGV4dC5zZXRQYXJhbSgnTEFTVF9NT0RJRklFRF9JRCcsIGxhc3RNb2RpZmllZElkKTtcclxuICAgICAgICAgIHRoaXMubG9hZGluZ1NlcnZpY2UuaGlkZURlbGF5TG9hZGluZyhsb2FkaW5nVGltZXJJZCk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlcnJvciA9PiB7XHJcbiAgICAgICAgICB0aGlzLmxvYWRpbmdTZXJ2aWNlLmhpZGVEZWxheUxvYWRpbmcobG9hZGluZ1RpbWVySWQpO1xyXG4gICAgICAgICAgdGhpcy5lcnJvclNlcnZpY2UuZXhjZXB0aW9uKHRoaXMubGFuZ3VhZ2VTZXJ2aWNlLmFkZENoaWxkRmFpbGVkLCBlcnJvcik7XHJcbiAgICAgICAgfVxyXG4gICAgICApXHJcbiAgICApO1xyXG4gICAgcmV0dXJuIHJlc3VsdCQ7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOaJuemHj+S/neWtmFxyXG4gICAqL1xyXG4gIHB1YmxpYyBzYXZlKCk6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xyXG4gICAgaWYgKHRoaXMubWVzc2FnZVBpcGUpIHtcclxuICAgICAgdGhpcy5tZXNzYWdlUGlwZS5uZXh0KHsgbWVzc2FnZVR5cGU6ICdzYXZlJyB9KTtcclxuICAgIH1cclxuICAgIGNvbnN0IGxvYWRpbmdUaW1lcklkID0gdGhpcy5sb2FkaW5nU2VydmljZS5zaG93TG9hZGluZ1dpdGhEZWxheSg1MDApO1xyXG4gICAgY29uc3Qgc2F2ZSQgPSB0aGlzLnJlcG9zaXRvcnkuYXBwbHlDaGFuZ2VzKCk7XHJcbiAgICBjb25zdCByZXN1bHQkID0gc2F2ZSQucGlwZShcclxuICAgICAgdGFwKFxyXG4gICAgICAgICgpID0+IHtcclxuICAgICAgICAgIHRoaXMubG9hZGluZ1NlcnZpY2UuaGlkZURlbGF5TG9hZGluZyhsb2FkaW5nVGltZXJJZCk7XHJcbiAgICAgICAgICB0aGlzLm5vdGlmeVNlcnZpY2Uuc3VjY2Vzcyh0aGlzLmxhbmd1YWdlU2VydmljZS5zYXZlU3VjY2VzcywgeyBoaWRlVGl0bGU6IHRydWUgfSk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlcnJvciA9PiB7XHJcbiAgICAgICAgICB0aGlzLmxvYWRpbmdTZXJ2aWNlLmhpZGVEZWxheUxvYWRpbmcobG9hZGluZ1RpbWVySWQpO1xyXG4gICAgICAgICAgdGhpcy5lcnJvclNlcnZpY2UuZXhjZXB0aW9uKHRoaXMubGFuZ3VhZ2VTZXJ2aWNlLm11bHRpU2F2ZUZhaWxlZCwgZXJyb3IpO1xyXG4gICAgICAgIH1cclxuICAgICAgKVxyXG4gICAgKTtcclxuICAgIHJldHVybiByZXN1bHQkO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDliKDpmaRcclxuICAgKi9cclxuICBwdWJsaWMgcmVtb3ZlKGlkOiBzdHJpbmcsIHN1Y2Nlc3NNc2c/OiBzdHJpbmcpOiBPYnNlcnZhYmxlPGJvb2xlYW4+IHtcclxuXHJcbiAgICAvLyDljp/lm6DlkIxhZGRTaWJsaW5nXHJcbiAgICBpZCA9IGlkID8gaWQgOiB0aGlzLmJpbmRpbmdEYXRhLmxpc3QuY3VycmVudElkO1xyXG5cclxuICAgIC8vIOWPguaVsOajgOafpVxyXG4gICAgaWYgKCFpZCkge1xyXG4gICAgICB0aGlzLm5vdGlmeVNlcnZpY2Uud2FybmluZyh0aGlzLmxhbmd1YWdlU2VydmljZVsncGxzU2VsZWN0RGVsZXRlRGF0YSddLCB7IGhpZGVUaXRsZTogdHJ1ZSB9KTtcclxuICAgICAgcmV0dXJuIGVtcHR5KCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5a2Y5Zyo5a2Q6IqC54K55LiN5YWB6K645Yig6ZmkXHJcbiAgICBjb25zdCB0cmVlTm9kZXNEYXRhID0gdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24udG9KU09OKCk7XHJcbiAgICBjb25zdCBoaWVyYXJjaHlUeXBlID0gdGhpcy5nZXRIaWVyYXJjaHlUeXBlKCk7XHJcbiAgICBjb25zdCB0cmVlTm9kZVV0aWwgPSBUcmVlVXRpbEZhY3RvcnkuZ2V0SW5zdGFuY2UoaGllcmFyY2h5VHlwZSk7XHJcbiAgICBpZiAodHJlZU5vZGVVdGlsID09PSBudWxsKSB7XHJcbiAgICAgIHJldHVybiBlbXB0eSgpO1xyXG4gICAgfVxyXG4gICAgaWYgKHRyZWVOb2RlVXRpbC5oYXNDaGlsZE5vZGVzKHRyZWVOb2Rlc0RhdGEsIHRoaXMuaGllcmFyY2h5SW5mb0tleSwgaWQpID09PSB0cnVlKSB7XHJcbiAgICAgIHRoaXMubm90aWZ5U2VydmljZS53YXJuaW5nKHRoaXMubGFuZ3VhZ2VTZXJ2aWNlWydkZWxldGVDaGlsZEZpcnN0J10sIHsgaGlkZVRpdGxlOiB0cnVlIH0pO1xyXG4gICAgICByZXR1cm4gZW1wdHkoKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyDnoa7orqTliKDpmaRcclxuICAgIGNvbnN0IGFjdGlvbiQgPSB0aGlzLm1lc3NhZ2VTZXJ2aWNlLnF1ZXN0aW9uKHRoaXMubGFuZ3VhZ2VTZXJ2aWNlLmNvbmZpcm1EZWxldGlvbik7XHJcbiAgICByZXR1cm4gYWN0aW9uJC5waXBlKFxyXG4gICAgICBjb25jYXRNYXAocmVzdWx0ID0+IHtcclxuICAgICAgICBpZiAoIXJlc3VsdCkge1xyXG4gICAgICAgICAgcmV0dXJuIGVtcHR5KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyDojrflj5bliKDpmaTlkI7opoHorr7nva7nmoToioLngrlpZFxyXG4gICAgICAgIGNvbnN0IG5leHROb2RlSWQgPSB0cmVlTm9kZVV0aWwuZ2V0TmV4dE5vZGVJZCh0cmVlTm9kZXNEYXRhLCB0aGlzLmhpZXJhcmNoeUluZm9LZXksIGlkKTtcclxuXHJcbiAgICAgICAgLy8g5omn6KGM5Yig6ZmkXHJcbiAgICAgICAgY29uc3QgbG9hZGluZ1RpbWVySWQgPSB0aGlzLmxvYWRpbmdTZXJ2aWNlLnNob3dMb2FkaW5nV2l0aERlbGF5KDUwMCk7XHJcbiAgICAgICAgY29uc3QgcmVtb3ZlJCA9IHRoaXMuZnJhbWVDb250ZXh0LnJlcG9zaXRvcnkucmVtb3ZlQnlJZChpZCk7XHJcbiAgICAgICAgcmV0dXJuIHJlbW92ZSQucGlwZShcclxuICAgICAgICAgIHRhcCgoKSA9PiB7XHJcblxyXG4gICAgICAgICAgICAvLyDorr7nva7pgInkuK3oioLngrlcclxuICAgICAgICAgICAgdHJlZU5vZGVVdGlsLnNlbGVjdGVkTm9kZSh0aGlzLmJpbmRpbmdEYXRhLCB0aGlzLmhpZXJhcmNoeUluZm9LZXksIG5leHROb2RlSWQpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5sb2FkaW5nU2VydmljZS5oaWRlRGVsYXlMb2FkaW5nKGxvYWRpbmdUaW1lcklkKTtcclxuICAgICAgICAgICAgaWYgKHN1Y2Nlc3NNc2cgJiYgc3VjY2Vzc01zZy50cmltKCkpIHtcclxuICAgICAgICAgICAgICB0aGlzLm5vdGlmeVNlcnZpY2Uuc3VjY2VzcyhzdWNjZXNzTXNnLCB7IGhpZGVUaXRsZTogdHJ1ZSB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICB0aGlzLm5vdGlmeVNlcnZpY2Uuc3VjY2Vzcyh0aGlzLmxhbmd1YWdlU2VydmljZS5kZWxldGVTdWNjZXNzLCB7IGhpZGVUaXRsZTogdHJ1ZSB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyB0aGlzLm5vdGlmeVNlcnZpY2Uuc3VjY2Vzcyh0aGlzLmxhbmd1YWdlU2VydmljZS5kZWxldGVTdWNjZXNzLCB7IGhpZGVUaXRsZTogdHJ1ZSB9KTtcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGVycm9yID0+IHtcclxuICAgICAgICAgICAgICB0aGlzLmxvYWRpbmdTZXJ2aWNlLmhpZGVEZWxheUxvYWRpbmcobG9hZGluZ1RpbWVySWQpO1xyXG4gICAgICAgICAgICAgIHRoaXMuZXJyb3JTZXJ2aWNlLmV4Y2VwdGlvbih0aGlzLmxhbmd1YWdlU2VydmljZS5kZWxldGVGYWlsZWQsIGVycm9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgKVxyXG4gICAgICAgICk7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Y+W5raI5pe25qOA5rWL5pyq5L+d5a2Y6K6w5b2VXHJcbiAgICovXHJcbiAgcHVibGljIGNhbmNlbCgpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG5cclxuICAgIC8vIOayoeacieWPmOabtOaXtuebtOaOpeWPlua2iFxyXG4gICAgLy8gY29uc3QgY2FyZERhdGFTZXJ2aWNlID0gdGhpcy5mcmFtZUNvbnRleHQuaW5qZWN0b3IuZ2V0PENhcmREYXRhU2VydmljZT4oQ2FyZERhdGFTZXJ2aWNlKTtcclxuICAgIGNvbnN0IGJlZlJlcG9zaXRvcnkgPSB0aGlzLnJlcG9zaXRvcnkgYXMgQmVmUmVwb3NpdG9yeTxhbnk+O1xyXG4gICAgY29uc3QgaGFzVW5zYXZlZERhdGEgPSBCZWZSZXBvc2l0b3J5VXRpbC5pc0V4aXN0VW5zYXZlRGF0YShiZWZSZXBvc2l0b3J5KTtcclxuICAgIGlmICghaGFzVW5zYXZlZERhdGEpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuX2NhbmNlbCgpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGNvbmZpcm1SZXN1bHQkID0gdGhpcy5tZXNzYWdlU2VydmljZS5xdWVzdGlvbih0aGlzLmxhbmd1YWdlU2VydmljZVsnY2FuY2VsV2l0aG91dFNhdmUnXSkucGlwZShcclxuICAgICAgc3dpdGNoTWFwKChpZkNhbmNlbDogYm9vbGVhbikgPT4ge1xyXG4gICAgICAgIGlmIChpZkNhbmNlbCA9PT0gZmFsc2UpIHtcclxuICAgICAgICAgIHJldHVybiBFTVBUWTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NhbmNlbCgpO1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICAgIHJldHVybiBjb25maXJtUmVzdWx0JDtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5p6E6YCg5YiG6aG15L+h5oGvXHJcbiAgICogQHBhcmFtIHBhcmVudElkIHBhcmVudElkXHJcbiAgICogQHJldHVybnMgXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBidWlsZFBhZ2luYXRpb25JbmZvKHBhcmVudElkOiBhbnkpIHtcclxuICAgIGNvbnN0IHBhZ2luYXRpb246IGFueSA9IHsgcGFnZUluZGV4OiAwLCBwYWdlU2l6ZTogMCB9O1xyXG4gICAgY29uc3QgZW5hYmxlTm9kZVBhZ2luYXRpb24gPSB0aGlzLmZyYW1lQ29udGV4dC5wYXJhbXMuZ2V0KCdlbmFibGVOb2RlUGFnaW5hdGlvbicpO1xyXG4gICAgaWYgKCFwYXJlbnRJZCkge1xyXG4gICAgICAvLyDkuIDnuqfliIbpobVcclxuICAgICAgY29uc3QgcGFnZVNpemUgPSB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5wYWdlU2l6ZSB8fCAwO1xyXG4gICAgICBjb25zdCBwYWdlSW5kZXggPSB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5wYWdlSW5kZXggfHwgMDtcclxuICAgICAgLy8g5ZCv55So5LqG5LiA57qn5YiG6aG1XHJcbiAgICAgIGlmIChwYWdlU2l6ZSAhPT0gMCkge1xyXG4gICAgICAgIHBhZ2luYXRpb24ucGFnZVNpemUgPSBwYWdlU2l6ZTtcclxuICAgICAgICBwYWdpbmF0aW9uLnBhZ2VJbmRleCA9IHBhZ2VJbmRleDtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8g5aaC5p6c5pyq5ZCv55So6IqC54K55YiG6aG15oiW5b2T5YmN5Li66aG257qn6IqC54K55Yqg6L2977yM5YiZ5LiN5aSE55CG6IqC54K55YiG6aG1XHJcbiAgICAgIGlmIChlbmFibGVOb2RlUGFnaW5hdGlvbikge1xyXG4gICAgICAgIGNvbnN0IG5vZGVQYWdlU2l6ZSA9IHRoaXMuZnJhbWVDb250ZXh0LnBhcmFtcy5nZXQoJ25vZGVQYWdlU2l6ZScpIHx8IDA7XHJcbiAgICAgICAgbGV0IG5vZGVQYWdlSW5kZXggPSB0aGlzLmZyYW1lQ29udGV4dC5wYXJhbXMuZ2V0KGBfTk9ERV8ke3BhcmVudElkfV9QQUdFX0lOREVYX2ApO1xyXG4gICAgICAgIGlmICghbm9kZVBhZ2VJbmRleCkge1xyXG4gICAgICAgICAgdGhpcy5mcmFtZUNvbnRleHQucGFyYW1zLnNldChgX05PREVfJHtwYXJlbnRJZH1fUEFHRV9JTkRFWF9gLCAxKTtcclxuICAgICAgICAgIG5vZGVQYWdlSW5kZXggPSAxO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwYWdpbmF0aW9uLnBhZ2VJbmRleCA9IG5vZGVQYWdlSW5kZXg7XHJcbiAgICAgICAgcGFnaW5hdGlvbi5wYWdlU2l6ZSA9IG5vZGVQYWdlU2l6ZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHBhZ2luYXRpb247XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlj5bmtojlj5jmm7RcclxuICAgKi9cclxuICBwcml2YXRlIF9jYW5jZWwoKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IGxvYWRpbmdUaW1lcklkID0gdGhpcy5sb2FkaW5nU2VydmljZS5zaG93TG9hZGluZ1dpdGhEZWxheSg1MDApO1xyXG4gICAgY29uc3QgY2FuY2VsJCA9IHRoaXMucmVwb3NpdG9yeS5jYW5jZWxDaGFuZ2VzKCk7XHJcbiAgICByZXR1cm4gY2FuY2VsJC5waXBlKFxyXG4gICAgICBzd2l0Y2hNYXAoKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGlzQWRkID0gdGhpcy52aXJ0dWFsUm9vdEZyYW1lQ29udGV4dC5nZXRQYXJhbSgnSVNfQUREJyk7XHJcbiAgICAgICAgY29uc3QgbGFzdE1vZGlmaWVkSWQgPSB0aGlzLnZpcnR1YWxSb290RnJhbWVDb250ZXh0LmdldFBhcmFtKCdMQVNUX01PRElGSUVEX0lEJyk7XHJcbiAgICAgICAgY29uc3QgY3VycmVudElkID0gdGhpcy5iaW5kaW5nRGF0YS5saXN0LmN1cnJlbnRJZDtcclxuXHJcbiAgICAgICAgaWYgKGlzQWRkID09PSB0cnVlKSB7XHJcbiAgICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5yZW1vdmVFbnRpdHlCeUlkKGN1cnJlbnRJZCk7XHJcblxyXG4gICAgICAgICAgLy8g6YeN572u57yW6L6R54q25oCBXHJcbiAgICAgICAgICB0aGlzLnZpcnR1YWxSb290RnJhbWVDb250ZXh0LnNldFBhcmFtKCdJU19BREQnLCBmYWxzZSk7XHJcbiAgICAgICAgICBpZiAobGFzdE1vZGlmaWVkSWQpIHtcclxuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgdGhpcy5iaW5kaW5nRGF0YS5saXN0LnNldEN1cnJlbnRJZChsYXN0TW9kaWZpZWRJZCwgdHJ1ZSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIH0sIDApO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgcmV0dXJuIG9mKG51bGwpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByZXR1cm4gdGhpcy5yZXBvc2l0b3J5LnVwZGF0ZUJ5SWQoY3VycmVudElkKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pLFxyXG4gICAgICB0YXAoXHJcbiAgICAgICAgKCkgPT4ge1xyXG4gICAgICAgICAgdGhpcy5sb2FkaW5nU2VydmljZS5oaWRlRGVsYXlMb2FkaW5nKGxvYWRpbmdUaW1lcklkKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIChlcnJvcjogYW55KSA9PiB7XHJcbiAgICAgICAgICB0aGlzLmxvYWRpbmdTZXJ2aWNlLmhpZGVEZWxheUxvYWRpbmcobG9hZGluZ1RpbWVySWQpO1xyXG4gICAgICAgICAgdGhpcy5lcnJvclNlcnZpY2UuZXhjZXB0aW9uKHRoaXMubGFuZ3VhZ2VTZXJ2aWNlLmNhbmNlbEZhaWxlZCwgZXJyb3IpO1xyXG4gICAgICAgIH1cclxuICAgICAgKVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOajgOafpeaYr+WQpuWtmOWcqOS4i+e6p+iKgueCue+8iOWGhemDqOaWueazle+8jOivt+WLv+S9v+eUqO+8iVxyXG4gICAqL1xyXG4gIHB1YmxpYyBoYXNDaGlsZE5vZGVzKGlkOiBzdHJpbmcsIHRyZWVOb2Rlc0RhdGE6IGFueVtdKTogYm9vbGVhbiB7XHJcbiAgICBjb25zdCB0cmVlTm9kZVV0aWwgPSB0aGlzLmdldFRyZWVOb2RlVXRpbCgpO1xyXG4gICAgaWYgKHRyZWVOb2RlVXRpbC5oYXNDaGlsZE5vZGVzKHRyZWVOb2Rlc0RhdGEsIHRoaXMuaGllcmFyY2h5SW5mb0tleSwgaWQpID09PSB0cnVlKSB7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6K6h566X5Yig6Zmk5ZCO55qE5b2T5YmN6IqC54K5aWTvvIjlhoXpg6jmlrnms5XvvIzor7fli7/kvb/nlKjvvIlcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0TmV4dE5vZGVJZEFmdGVyUmVtb3ZpbmcoaWRUb1JlbW92ZTogc3RyaW5nLCB0cmVlTm9kZXNEYXRhOiBhbnlbXSk6IHN0cmluZyB7XHJcbiAgICBjb25zdCB0cmVlTm9kZVV0aWwgPSB0aGlzLmdldFRyZWVOb2RlVXRpbCgpO1xyXG4gICAgY29uc3QgbmV4dE5vZGVJZCA9IHRyZWVOb2RlVXRpbC5nZXROZXh0Tm9kZUlkKHRyZWVOb2Rlc0RhdGEsIHRoaXMuaGllcmFyY2h5SW5mb0tleSwgaWRUb1JlbW92ZSk7XHJcbiAgICByZXR1cm4gbmV4dE5vZGVJZDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiuvue9ruWIoOmZpOWQjueahOW9k+WJjeiKgueCueiKgueCue+8iOWGhemDqOaWueazle+8jOivt+WLv+S9v+eUqO+8iVxyXG4gICAqL1xyXG4gIHB1YmxpYyBzZXROZXh0Tm9kZUFmdGVyUmVtb3ZpbmcobmV4dE5vZGVJZDogc3RyaW5nKTogdm9pZCB7XHJcbiAgICBjb25zdCB0cmVlTm9kZVV0aWwgPSB0aGlzLmdldFRyZWVOb2RlVXRpbCgpO1xyXG4gICAgdHJlZU5vZGVVdGlsLnNlbGVjdGVkTm9kZSh0aGlzLmJpbmRpbmdEYXRhLCB0aGlzLmhpZXJhcmNoeUluZm9LZXksIG5leHROb2RlSWQpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDorr7nva7moJHnmoTlvZPliY3ooYwo57uZ5a6M5pW05qCR5L2/55SoKVxyXG4gICAqIEBwYXJhbSBpZCBpZFxyXG4gICAqL1xyXG4gIHB1YmxpYyBzZXRDdXJyZW50SWQoaWQ6IHN0cmluZykge1xyXG4gICAgaWQgPSBpZCB8fCB0aGlzLmZyYW1lQ29udGV4dC5nZXRWaXJ0dWFsUm9vdEZyYW1lQ29udGV4dCgpLnVpU3RhdGVbJ19fREVWS0lUX19zZWxlY3RlZFJvdyddIHx8IHRoaXMuYmluZGluZ0RhdGEubGlzdC5jdXJyZW50SXRlbS5wcmltYXJ5S2V5VmFsdWU7XHJcbiAgICB0aGlzLmZyYW1lQ29udGV4dC5iaW5kaW5nRGF0YS5saXN0LnNldEN1cnJlbnRJZChpZCwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOmAieS4reagkeeahOesrOS4gOS4quiKgueCuVxyXG4gICAqL1xyXG4gIHB1YmxpYyBzZWxlY3RGaXJzdFJvdygpIHtcclxuICAgIGNvbnN0IGhpZXJhcmNoeVR5cGUgPSB0aGlzLmdldEhpZXJhcmNoeVR5cGUoKTtcclxuICAgIGNvbnN0IHRyZWVOb2RlVXRpbCA9IFRyZWVVdGlsRmFjdG9yeS5nZXRJbnN0YW5jZShoaWVyYXJjaHlUeXBlKTtcclxuICAgIGlmICh0cmVlTm9kZVV0aWwgIT09IG51bGwpIHtcclxuICAgICAgdHJlZU5vZGVVdGlsLnNlbGVjdEZpcnN0Um9vdE5vZGUodGhpcy5iaW5kaW5nRGF0YSwgdGhpcy5oaWVyYXJjaHlJbmZvS2V5KTtcclxuICAgIH1cclxuICB9XHJcbiAgLyoqXHJcbiAgICog6I635Y+W5qCR6IqC54K55bel5YW357G75a6e5L6LXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXRUcmVlTm9kZVV0aWwoKTogYW55IHtcclxuICAgIGNvbnN0IGhpZXJhcmNoeVR5cGUgPSB0aGlzLmdldEhpZXJhcmNoeVR5cGUoKTtcclxuICAgIGNvbnN0IHRyZWVOb2RlVXRpbCA9IFRyZWVVdGlsRmFjdG9yeS5nZXRJbnN0YW5jZShoaWVyYXJjaHlUeXBlKTtcclxuICAgIGlmICh0cmVlTm9kZVV0aWwgPT09IG51bGwpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKGDkuI3mlK/mjIEke2hpZXJhcmNoeVR5cGV957G75Z6L55qE5YiG57qnYCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdHJlZU5vZGVVdGlsO1xyXG4gIH1cclxuXHJcblxyXG5cclxuICAvKipcclxuICAgKiDorrDlvZXliqDovb3nirbmgIFcclxuICAgKiBAdG9kb++8muW+heWIoOmZpFxyXG4gICAqL1xyXG4gIHByaXZhdGUgc2V0TG9hZEJ5TGV2ZWxTdGF0ZShmaWx0ZXJzOiBzdHJpbmcsIHNvcnRzOiBzdHJpbmcpIHtcclxuXHJcbiAgICAvLyBAdG9kb++8muS4tOaXtuWkhOeQhlxyXG4gICAgdGhpcy52aXJ0dWFsUm9vdEZyYW1lQ29udGV4dC5zZXRQYXJhbSgnaXNMb2FkVHJlZUJ5TGV2ZWwnLCB0cnVlKTtcclxuICAgIHRoaXMudmlydHVhbFJvb3RGcmFtZUNvbnRleHQuc2V0UGFyYW0oJ2xvYWRUcmVlQnlMZXZlbEZpbHRlcicsIGZpbHRlcnMpO1xyXG4gICAgdGhpcy52aXJ0dWFsUm9vdEZyYW1lQ29udGV4dC5zZXRQYXJhbSgnbG9hZFRyZWVCeUxldmVsU29ydCcsIHNvcnRzKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWxleW8gOW9k+WJjeiKgueCuVxyXG4gICAqIEB0b2Rv77ya5b6F5Yig6ZmkXHJcbiAgICovXHJcbiAgcHJpdmF0ZSByZWxvYWRCeUxldmVsKCk6IE9ic2VydmFibGU8RW50aXR5W10+IHtcclxuICAgIGNvbnN0IGlzTG9hZEJ5TGV2ZWwgPSB0aGlzLnZpcnR1YWxSb290RnJhbWVDb250ZXh0LmdldFBhcmFtKCdpc0xvYWRUcmVlQnlMZXZlbCcpO1xyXG4gICAgaWYgKGlzTG9hZEJ5TGV2ZWwgPT09IHRydWUpIHtcclxuICAgICAgY29uc3QgZmlsdGVycyA9IHRoaXMudmlydHVhbFJvb3RGcmFtZUNvbnRleHQuZ2V0UGFyYW0oJ2xvYWRUcmVlQnlMZXZlbEZpbHRlcicpO1xyXG4gICAgICBjb25zdCBzb3J0cyA9IHRoaXMudmlydHVhbFJvb3RGcmFtZUNvbnRleHQuZ2V0UGFyYW0oJ2xvYWRUcmVlQnlMZXZlbFNvcnQnKTtcclxuICAgICAgcmV0dXJuIHRoaXMubG9hZEJ5TGV2ZWwoZmlsdGVycywgc29ydHMpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIG9mKFtdKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0SGllcmFyY2h5VHlwZSgpIHtcclxuICAgIGNvbnN0IG5nT2JqZWN0cyA9IEZpZWxkTWV0YWRhdGFVdGlsLmdldE5nT2JqZWN0cyh0aGlzLnJlcG9zaXRvcnkuZW50aXR5VHlwZSk7XHJcbiAgICBjb25zdCBoaWVyYXJjaHlJbmZvTmdPYmplY3RJbmZvID0gbmdPYmplY3RzW3RoaXMuaGllcmFyY2h5SW5mb0tleV07XHJcbiAgICBsZXQgaGllcmFyY2h5VHlwZSA9ICdwYXRoJzsgLy8g5YiG57qn56CB6buY6K6k5Li6cGF0aO+8jOWFvOWuueWOn+ihqOWNlVxyXG4gICAgaWYgKGhpZXJhcmNoeUluZm9OZ09iamVjdEluZm8uaGFzT3duUHJvcGVydHkoJ2hpZXJhcmNoeVR5cGUnKSAmJiBoaWVyYXJjaHlJbmZvTmdPYmplY3RJbmZvWydoaWVyYXJjaHlUeXBlJ10gIT0gbnVsbCkge1xyXG4gICAgICBoaWVyYXJjaHlUeXBlID0gaGllcmFyY2h5SW5mb05nT2JqZWN0SW5mb1snaGllcmFyY2h5VHlwZSddIGFzIHN0cmluZztcclxuICAgIH1cclxuICAgIGlmIChoaWVyYXJjaHlUeXBlID09IG51bGwgfHwgaGllcmFyY2h5VHlwZS5sZW5ndGggPCAxKSB7XHJcbiAgICAgIC8vICfliIbnuqfnoIHphY3nva7kv6Hmga/plJnor68nXHJcbiAgICAgIHRocm93IG5ldyBFcnJvcih0aGlzLmxhbmd1YWdlU2VydmljZVsnaW5jb3JyZWN0SGllcmFyY2h5Q29uZmlnJ10pO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGhpZXJhcmNoeVR5cGU7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluaguee7hOS7tua2iOaBr+euoemBk1xyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0IG1lc3NhZ2VQaXBlKCkge1xyXG4gICAgaWYgKHRoaXMuZnJhbWVDb250ZXh0KSB7XHJcbiAgICAgIGNvbnN0IGFwcENvbnRleHQgPSB0aGlzLmZyYW1lQ29udGV4dC5nZXRGb3JtQXBwQ29udGV4dCgpIHx8IG51bGw7XHJcbiAgICAgIGlmIChhcHBDb250ZXh0KSB7XHJcbiAgICAgICAgcmV0dXJuIGFwcENvbnRleHQubWVzc2FnZVBpcGUgfHwgbnVsbDtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG59XHJcbmV4cG9ydCB7IFRyZWVEYXRhU2VydmljZSB9O1xyXG4iXX0=