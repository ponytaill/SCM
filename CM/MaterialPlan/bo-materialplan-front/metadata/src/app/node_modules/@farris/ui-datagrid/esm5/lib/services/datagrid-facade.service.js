/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
/*
 * @Author: 疯狂秀才(Lucas Huang)
 * @Date: 2019-08-06 07:43:53
 * @LastEditors: 疯狂秀才(Lucas Huang)
 * @LastEditTime: 2019-11-20 07:39:45
 * @QQ: 1055818239
 * @Version: v0.0.1
 */
import { Injectable, EventEmitter } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { BehaviorSubject, of, Subject } from 'rxjs';
import { map, distinctUntilChanged, filter, switchMap } from 'rxjs/operators';
import { CalculationType } from '../types';
import { initDataGridState, ROW_INDEX_FIELD, IS_GROUP_ROW_FIELD, GROUP_ROW_FIELD, IS_GROUP_FOOTER_ROW_FIELD, GROUP_VISIBLE_FIELD, GROUP_LEVEL_FIELD } from './state';
import { cloneDeep, groupBy, isPlainObject, flatten } from 'lodash-es';
import { Utils } from '../utils/utils';
import { DatagridColumnsHelper } from './datagrid-columns.helper';
import { BigNumber } from 'bignumber.js';
var DatagridFacadeService = /** @class */ (function () {
    function DatagridFacadeService(http) {
        this.http = http;
        this.localId = 'zh-CHS';
        // public virtualizedService: VirtualizedLoaderService;
        this.store = new BehaviorSubject(null);
        this.virtualRowSubject = new BehaviorSubject(null);
        this.gridSizeSubject = new Subject();
        this.errorSubject = new Subject();
        this.selectRowSubject = new Subject();
        this.unSelectRowSubject = new Subject();
        this.columnResizeSubject = new Subject();
        this.clearSelectionSubject = new Subject();
        this.checkRowSubject = new Subject();
        this.unCheckRowSubject = new Subject();
        this.clearCheckedsSubject = new Subject();
        this.clearAllSubject = new Subject();
        this.checkAllSubject = new Subject();
        this.unCheckAllSubject = new Subject();
        this.selectAllSubject = new Subject();
        this.selectCellSubject = new Subject();
        this.error$ = this.errorSubject.asObservable();
        this.selectRow$ = this.selectRowSubject.asObservable();
        this.unSelectRow$ = this.unSelectRowSubject.asObservable();
        this.columnResize$ = this.columnResizeSubject.asObservable();
        this.clearSelections$ = this.clearSelectionSubject.asObservable();
        this.checkRow$ = this.checkRowSubject.asObservable();
        this.unCheckRow$ = this.unCheckRowSubject.asObservable();
        this.clearCheckeds$ = this.clearCheckedsSubject.asObservable();
        this.clearAll$ = this.clearAllSubject.asObservable();
        this.checkAll$ = this.checkAllSubject.asObservable();
        this.unCheckAll$ = this.unCheckAllSubject.asObservable();
        this.selectAll$ = this.selectAllSubject.asObservable();
        this.currentCell$ = this.selectCellSubject.asObservable();
        this.editCell$ = new EventEmitter();
        this.clientSort$ = new EventEmitter();
        this.rowAppend$ = new EventEmitter();
        this.rowUpdate$ = new EventEmitter();
        this.rowDelete$ = new EventEmitter();
        this.expandGroupRow = new EventEmitter();
        this.collapseGroupRow = new EventEmitter();
        this.updateCheckboxState$ = new EventEmitter();
        this.state$ = this.store.asObservable().pipe(filter((/**
         * @param {?} state
         * @return {?}
         */
        function (state) { return state; })));
        this.columnGroup$ = this.gridSizeSubject.asObservable().pipe(filter((/**
         * @param {?} state
         * @return {?}
         */
        function (state) { return state; })), map((/**
         * @param {?} state
         * @return {?}
         */
        function (state) { return state.columnsGroup; })), switchMap((/**
         * @param {?} colgroup
         * @return {?}
         */
        function (colgroup) {
            return of(colgroup);
        })), distinctUntilChanged());
        this.gridSize$ = this.gridSizeSubject.asObservable().pipe(filter((/**
         * @param {?} state
         * @return {?}
         */
        function (state) { return state; })), map((/**
         * @param {?} state
         * @return {?}
         */
        function (state) {
            var _a = tslib_1.__assign({}, state), headerHeight = _a.headerHeight, pagerHeight = _a.pagerHeight, width = _a.width, columnsGroup = _a.columnsGroup, height = _a.height, rowHeight = _a.rowHeight;
            return { headerHeight: headerHeight, pagerHeight: pagerHeight, width: width, columnsGroup: columnsGroup, height: height, rowHeight: rowHeight };
        })), distinctUntilChanged());
        this.data$ = this.virtualRowSubject.pipe(filter((/**
         * @param {?} vs
         * @return {?}
         */
        function (vs) { return vs; })), switchMap((/**
         * @param {?} vs
         * @return {?}
         */
        function (vs) {
            return of({
                index: vs.startIndex || 0,
                rows: vs.virtualRows || [],
                top: vs.topHideHeight,
                bottom: vs.bottomHideHeight,
                scrolling: vs.isScrollChange
            });
        })), distinctUntilChanged());
        this.difference = (/**
         * @param {?} first
         * @param {?} second
         * @return {?}
         */
        function (first, second) { return first.filter((/**
         * @param {?} item
         * @return {?}
         */
        function (item) { return !second.includes(item); })); });
        this.differenceBy = (/**
         * @param {?} a
         * @param {?} b
         * @param {?} fn
         * @return {?}
         */
        function (a, b, fn) {
            /** @type {?} */
            var s = new Set(b.map(fn));
            return a.map(fn).filter((/**
             * @param {?} el
             * @return {?}
             */
            function (el) { return !s.has(el); }));
        });
        this._state = cloneDeep(initDataGridState);
    }
    /**
     * @param {?} scrolltop
     * @param {?=} isScrollChange
     * @return {?}
     */
    DatagridFacadeService.prototype.updateVirthualRows = /**
     * @param {?} scrolltop
     * @param {?=} isScrollChange
     * @return {?}
     */
    function (scrolltop, isScrollChange) {
        if (isScrollChange === void 0) { isScrollChange = false; }
        /** @type {?} */
        var virtual = this.getVirthualRows(scrolltop);
        virtual.isScrollChange = isScrollChange;
        this.updateState({ virtual: virtual }, false);
        this.virtualRowSubject.next(virtual);
    };
    /**
     * @param {?} scrolltop
     * @return {?}
     */
    DatagridFacadeService.prototype.getVirthualRows = /**
     * @param {?} scrolltop
     * @return {?}
     */
    function (scrolltop) {
        if (scrolltop === undefined) {
            scrolltop = 0;
        }
        /** @type {?} */
        var data = this._state.data || [];
        /** @type {?} */
        var virtual = { rowIndex: 0, virtualRows: data, topHideHeight: 0, bottomHideHeight: 0 };
        if (data.length === 0 || (this._state.autoHeight && !this._state.groupRows)) {
            virtual.virtualRows = data;
            return virtual;
        }
        if (this._state.flatColumns && this._state.flatColumns.length) {
            // data = this._state.data;
            // if (!this._state.groupRows) {
            //     if (this._state.virtual && this._state.virtualized) {
            //         this.virtualizedService.state = this._state;
            //         const rows = this.virtualizedService.getRows(scrolltop);
            //         virtual = { ...this._state.virtual, ...rows };
            //     } else {
            //         virtual.virtualRows = data;
            //     }
            // } else {
            //     // 行分组数据处理
            //     const groupRows = this.groupRows2(cloneDeep(data));
            //     virtual.virtualRows = groupRows;
            // }
            if (this._state.groupRows) {
                // 行分组数据处理
                /** @type {?} */
                var groupRows = this.groupRows2(cloneDeep(data));
                virtual.virtualRows = groupRows;
            }
        }
        if (this._state.mergeCell && this._state.enableClientSortForMergeCell) {
            virtual.virtualRows = this.sort(virtual.virtualRows);
        }
        return virtual;
    };
    /**
     * @param {?=} original
     * @return {?}
     */
    DatagridFacadeService.prototype.getData = /**
     * @param {?=} original
     * @return {?}
     */
    function (original) {
        if (original === void 0) { original = false; }
        if (original) {
            return this._state.originalData || [];
        }
        return this._state.data || [];
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.getState = /**
     * @return {?}
     */
    function () {
        return this._state;
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.getVirtualState = /**
     * @return {?}
     */
    function () {
        return this._state.virtual;
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.getPageInfo = /**
     * @return {?}
     */
    function () {
        var _a = tslib_1.__assign({}, this._state), pageIndex = _a.pageIndex, pageSize = _a.pageSize;
        return { pageIndex: pageIndex, pageSize: pageSize };
    };
    /**
     * @param {?} state
     * @return {?}
     */
    DatagridFacadeService.prototype.initState = /**
     * @param {?} state
     * @return {?}
     */
    function (state) {
        this.updateState(state, false);
        this._state.originalData = cloneDeep(this._state.data);
        this.initColumns();
        this.gridSizeSubject.next(this._state);
        this.updateVirthualRows(0);
    };
    /** 加载数据
     * @param data: 数据列表
     * @param updateOriginalData 是否更新原始数据, 默认为 true
     */
    /**
     * 加载数据
     * @param {?} data
     * @param {?=} updateOriginalData 是否更新原始数据, 默认为 true
     * @param {?=} sortable
     * @return {?}
     */
    DatagridFacadeService.prototype.loadData = /**
     * 加载数据
     * @param {?} data
     * @param {?=} updateOriginalData 是否更新原始数据, 默认为 true
     * @param {?=} sortable
     * @return {?}
     */
    function (data, updateOriginalData, sortable) {
        if (updateOriginalData === void 0) { updateOriginalData = true; }
        if (sortable === void 0) { sortable = false; }
        data = data || [];
        this.updateState({ data: data }, false);
        if (updateOriginalData) {
            this._state.originalData = cloneDeep(this._state.data);
        }
        if (sortable && this._state.sortName) {
            /** @type {?} */
            var sortedData = this.sort(this._state.data);
            this.updateState({ data: sortedData }, false);
        }
        else {
            // this.updateState({ data: this._state.originalData }, false);
        }
        this.updateVirthualRows(this._state.virtual.scrollTop || 0);
    };
    /** 复原指定行的数据 */
    /**
     * 复原指定行的数据
     * @param {?} rowId
     * @return {?}
     */
    DatagridFacadeService.prototype.resetRow = /**
     * 复原指定行的数据
     * @param {?} rowId
     * @return {?}
     */
    function (rowId) {
        var _this = this;
        /** @type {?} */
        var origData = this._state.originalData;
        if (origData) {
            /** @type {?} */
            var origRowData = origData.find((/**
             * @param {?} r
             * @return {?}
             */
            function (r) { return _this.primaryId(r) === rowId; }));
            this.getCurrentRow().data = cloneDeep(origRowData);
            this.updateRow(rowId, origRowData);
        }
    };
    // loadDataForVirtual(data: any) {
    //     this.updateState({ data }, false);
    //     // this.virtualizedService.state = this._state;
    //     const virtual = { ...this._state.virtual, ...this.virtualizedService.reload() };
    //     this.virtualRowSubject.next(virtual);
    //     this.updateState({virtual});
    // }
    // loadDataForVirtual(data: any) {
    //     this.updateState({ data }, false);
    //     // this.virtualizedService.state = this._state;
    //     const virtual = { ...this._state.virtual, ...this.virtualizedService.reload() };
    //     this.virtualRowSubject.next(virtual);
    //     this.updateState({virtual});
    // }
    /**
     * @param {?} url
     * @return {?}
     */
    DatagridFacadeService.prototype.fetchData = 
    // loadDataForVirtual(data: any) {
    //     this.updateState({ data }, false);
    //     // this.virtualizedService.state = this._state;
    //     const virtual = { ...this._state.virtual, ...this.virtualizedService.reload() };
    //     this.virtualRowSubject.next(virtual);
    //     this.updateState({virtual});
    // }
    /**
     * @param {?} url
     * @return {?}
     */
    function (url) {
        return this.http.get(url).pipe(map((/**
         * @param {?} r
         * @return {?}
         */
        function (r) { return (/** @type {?} */ (r)); })));
    };
    /**
     * @param {?} total
     * @return {?}
     */
    DatagridFacadeService.prototype.setTotal = /**
     * @param {?} total
     * @return {?}
     */
    function (total) {
        this.updateState({ total: total }, false);
    };
    /**
     * @param {?} property
     * @param {?} value
     * @return {?}
     */
    DatagridFacadeService.prototype.updateProperty = /**
     * @param {?} property
     * @param {?} value
     * @return {?}
     */
    function (property, value) {
        var _a;
        this.updateState((_a = {}, _a[property] = value, _a), false);
    };
    /**
     * @param {?} pageIndex
     * @param {?} pageSize
     * @param {?} total
     * @return {?}
     */
    DatagridFacadeService.prototype.setPagination = /**
     * @param {?} pageIndex
     * @param {?} pageSize
     * @param {?} total
     * @return {?}
     */
    function (pageIndex, pageSize, total) {
        this.updateState({ pageIndex: pageIndex, pageSize: pageSize, total: total }, false);
    };
    /**
     * @param {?} scrollTop
     * @return {?}
     */
    DatagridFacadeService.prototype.setScrollTop = /**
     * @param {?} scrollTop
     * @return {?}
     */
    function (scrollTop) {
        /** @type {?} */
        var virtual = tslib_1.__assign({}, this._state.virtual, { scrollTop: scrollTop });
        this.updateState({ virtual: virtual }, false);
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.isMultiSelect = /**
     * @return {?}
     */
    function () {
        return this._state.multiSelect;
    };
    /**
     * @private
     * @param {?} id
     * @return {?}
     */
    DatagridFacadeService.prototype._isRowSelected = /**
     * @private
     * @param {?} id
     * @return {?}
     */
    function (id) {
        if (!id || !this._state.currentRow) {
            return false;
        }
        else {
            return this._state.currentRow.id.toString() === id.toString();
        }
    };
    /**
     * @param {?} id
     * @param {?=} selections
     * @return {?}
     */
    DatagridFacadeService.prototype.isRowSelected = /**
     * @param {?} id
     * @param {?=} selections
     * @return {?}
     */
    function (id, selections) {
        if (selections === void 0) { selections = null; }
        /** @type {?} */
        var flag = this._isRowSelected(id);
        if (!this.isMultiSelect() || this._state.onlySelectSelf) {
            return flag;
        }
        else {
            if (!selections) {
                selections = this._state.selections;
            }
            if (this._canCancelSelectWhenMulti()) {
                return flag;
            }
            if (!selections || selections.length === 0) {
                return false;
            }
            else {
                return selections.findIndex((/**
                 * @param {?} sr
                 * @return {?}
                 */
                function (sr) { return sr.id == id; })) > -1;
            }
        }
    };
    /**
     * @param {?} id
     * @param {?=} checkeds
     * @return {?}
     */
    DatagridFacadeService.prototype.isRowChecked = /**
     * @param {?} id
     * @param {?=} checkeds
     * @return {?}
     */
    function (id, checkeds) {
        if (checkeds === void 0) { checkeds = null; }
        if (!checkeds) {
            checkeds = this.getCheckeds();
        }
        if (!id || !checkeds.length) {
            return false;
        }
        return checkeds.findIndex((/**
         * @param {?} sr
         * @return {?}
         */
        function (sr) { return sr.id.toString() === id.toString(); })) > -1;
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.isCheckAll = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var allRows = this.getAllRowsForLive().map((/**
         * @param {?} r
         * @return {?}
         */
        function (r) { return _this.primaryId(r); }));
        /** @type {?} */
        var checkIds = this._state.checkedRows.map((/**
         * @param {?} r
         * @return {?}
         */
        function (r) { return r.id; }));
        if (this.difference(allRows, checkIds).length) {
            return false; // this._state.checkedRows.length === allRows.length;
        }
        else {
            return true;
        }
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.getCurrentPageCheckeds = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var allRows = this.getAllRowsForLive().map((/**
         * @param {?} r
         * @return {?}
         */
        function (r) { return _this.primaryId(r); }));
        return this._state.checkedRows.filter((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return allRows.indexOf(n.id) > -1; }));
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.getCurrentRow = /**
     * @return {?}
     */
    function () {
        return this._state.currentRow || undefined;
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.getSelections = /**
     * @return {?}
     */
    function () {
        var _this = this;
        // 如果数据源变了，需要重新计算
        /** @type {?} */
        var data = this._state.data;
        if (this._state.selections && this._state.selections.length) {
            if (!data || !data.length) {
                this._state.selections = [];
            }
            else {
                /** @type {?} */
                var temp_1 = data.map((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return _this.primaryId(n); }));
                this._state.selections = this._state.selections.filter((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) {
                    return temp_1.includes(n.id);
                }));
            }
        }
        return this._state.selections || [];
    };
    /**
     * @private
     * @return {?}
     */
    DatagridFacadeService.prototype.getCheckedRowsFromSource = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        return (this._state.checkedRows || []).map((/**
         * @param {?} n
         * @return {?}
         */
        function (n) {
            /** @type {?} */
            var d = _this.findRow(n.id);
            if (d && d.data) {
                n.data = d.data;
            }
            return n;
        }));
    };
    /**
     * @param {?=} fromDataSource
     * @return {?}
     */
    DatagridFacadeService.prototype.getCheckeds = /**
     * @param {?=} fromDataSource
     * @return {?}
     */
    function (fromDataSource) {
        if (fromDataSource === void 0) { fromDataSource = false; }
        if (fromDataSource) {
            this._state.checkedRows = this.getCheckedRowsFromSource();
        }
        return this._state.checkedRows || [];
    };
    /**
     * @param {?} rowid
     * @param {?} rowData
     * @return {?}
     */
    DatagridFacadeService.prototype.updateCheckedData = /**
     * @param {?} rowid
     * @param {?} rowData
     * @return {?}
     */
    function (rowid, rowData) {
        var _this = this;
        /** @type {?} */
        var checkeds = this.getCheckeds();
        if (checkeds.length) {
            /** @type {?} */
            var item_1 = checkeds.find((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return _this.primaryId(n) == rowid; }));
            if (item_1) {
                Object.keys(rowData).forEach((/**
                 * @param {?} k
                 * @return {?}
                 */
                function (k) {
                    Utils.setValue(k, rowData[k], item_1.data);
                }));
            }
        }
    };
    /**
     * @param {?} ids
     * @param {?=} checked
     * @return {?}
     */
    DatagridFacadeService.prototype.setCheckedRows = /**
     * @param {?} ids
     * @param {?=} checked
     * @return {?}
     */
    function (ids, checked) {
        var _this = this;
        if (checked === void 0) { checked = true; }
        if (ids && ids.length) {
            /** @type {?} */
            var checkeds_1 = this._state.checkedRows || [];
            ids.forEach((/**
             * @param {?} id
             * @return {?}
             */
            function (id) {
                /** @type {?} */
                var row = _this.findRow(id);
                if (checked && row) {
                    if (!_this.isRowChecked(id, checkeds_1)) {
                        /** @type {?} */
                        var srow = { id: _this.primaryId(row.data), data: row.data, index: row.index };
                        checkeds_1.push(srow);
                    }
                }
                else {
                    if (!_this._state.enableMorePageSelect || !checked) {
                        checkeds_1 = checkeds_1.filter((/**
                         * @param {?} sr
                         * @return {?}
                         */
                        function (sr) { return sr.id !== id; }));
                    }
                }
            }));
            this._state.checkedRows = checkeds_1;
        }
        else {
            this._clearCheckeds();
        }
    };
    /**
     * @param {?} id
     * @param {?=} checked
     * @return {?}
     */
    DatagridFacadeService.prototype.checkRecord = /**
     * @param {?} id
     * @param {?=} checked
     * @return {?}
     */
    function (id, checked) {
        if (checked === void 0) { checked = true; }
        if (id) {
            /** @type {?} */
            var row = this.findRow(id);
            if (row) {
                var _a = tslib_1.__assign({}, row), rowIndex = _a.index, rowData = _a.data;
                if (checked) {
                    this.checkRow(rowIndex, rowData);
                }
                else {
                    this.unCheckRow(rowIndex, rowData);
                }
            }
            else {
                this.errorSubject.next("\u672A\u627E\u5230ID\u4E3A" + id + "\u7684\u6570\u636E\u3002");
            }
        }
        else {
            this.errorSubject.next("\u53C2\u6570id \u4E0D\u80FD\u4E3A\u7A7A\u3002");
        }
    };
    /**
     * @param {?} rowIndex
     * @param {?} rowData
     * @param {?=} grid
     * @return {?}
     */
    DatagridFacadeService.prototype.checkRow = /**
     * @param {?} rowIndex
     * @param {?} rowData
     * @param {?=} grid
     * @return {?}
     */
    function (rowIndex, rowData, grid) {
        var _this = this;
        if (grid === void 0) { grid = null; }
        if (!this._state.multiSelect) {
            this._clearCheckeds();
        }
        /** @type {?} */
        var id = this.primaryId(rowData);
        /** @type {?} */
        var checkeds = this._state.checkedRows || [];
        /** @type {?} */
        var srow = { id: id, data: rowData, index: rowIndex };
        if (id && !this.isRowChecked(id, checkeds)) {
            checkeds.push(srow);
            this._state.checkedRows = checkeds;
            if (this._state.selectOnCheck) {
                if (grid && grid.instance && grid.instance.beforeSelect) {
                    grid.instance.beforeSelect({ rowIndex: rowIndex, rowData: rowData, gridInstance: grid.instance }).subscribe((/**
                     * @param {?} e
                     * @return {?}
                     */
                    function (e) {
                        if (e) {
                            _this.selectRow(rowIndex, rowData);
                        }
                    }));
                }
                else {
                    this.selectRow(rowIndex, rowData);
                }
            }
            this.checkRowSubject.next(srow);
        }
        this.updateCheckboxState$.emit(tslib_1.__assign({}, srow, { checked: true }));
    };
    /**
     * @param {?} rowIndex
     * @param {?} rowData
     * @param {?=} grid
     * @return {?}
     */
    DatagridFacadeService.prototype.unCheckRow = /**
     * @param {?} rowIndex
     * @param {?} rowData
     * @param {?=} grid
     * @return {?}
     */
    function (rowIndex, rowData, grid) {
        var _this = this;
        if (grid === void 0) { grid = null; }
        /** @type {?} */
        var id = this.primaryId(rowData);
        /** @type {?} */
        var checkeds = this._state.checkedRows || [];
        /** @type {?} */
        var srow = { id: id, data: rowData, index: rowIndex };
        if (this.isRowChecked(id, checkeds)) {
            checkeds = checkeds.filter((/**
             * @param {?} sr
             * @return {?}
             */
            function (sr) { return '' + sr.id !== '' + id; }));
            this._state.checkedRows = checkeds;
            if (this._state.selectOnCheck) {
                if (grid && grid.instance && grid.instance.beforeUnselect) {
                    grid.instance.beforeUnselect({ rowIndex: rowIndex, rowData: rowData, gridInstance: grid.instance }).subscribe((/**
                     * @param {?} e
                     * @return {?}
                     */
                    function (e) {
                        if (e) {
                            _this.unSelectRow(rowIndex, rowData);
                        }
                    }));
                }
                else {
                    this.unSelectRow(rowIndex, rowData);
                }
            }
            this.unCheckRowSubject.next(srow);
        }
        this.updateCheckboxState$.emit(tslib_1.__assign({}, srow, { checked: false }));
    };
    /**
     * @param {?} data
     * @return {?}
     */
    DatagridFacadeService.prototype.setCurrentPageData = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        this._state.currentPageData = data;
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.getCurrentPageData = /**
     * @return {?}
     */
    function () {
        return this._state.currentPageData || [];
    };
    /** 获取所有可以操作的行 */
    /**
     * 获取所有可以操作的行
     * @private
     * @return {?}
     */
    DatagridFacadeService.prototype.getAllRowsForLive = /**
     * 获取所有可以操作的行
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var allData = this._state.data || [];
        if (this._state.pagination && !this._state.pagerOnServer) {
            // 获取当前页数据
            allData = this.getCurrentPageData();
        }
        // 排除掉禁用的行
        if (this._state.disableRow) {
            allData = allData.filter((/**
             * @param {?} n
             * @param {?} i
             * @return {?}
             */
            function (n, i) { return !_this._state.disableRow(n, i); }));
        }
        return allData;
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.checkAll = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this._state.checkedRows = this._state.checkedRows || [];
        /** @type {?} */
        var allData = this.getAllRowsForLive();
        /** @type {?} */
        var allCheckeds = allData.map((/**
         * @param {?} r
         * @param {?} i
         * @return {?}
         */
        function (r, i) {
            return {
                id: _this.primaryId(r),
                index: i,
                data: r
            };
        }));
        if (!this._state.checkedRows.length) {
            this._state.checkedRows = allCheckeds;
        }
        else {
            /** @type {?} */
            var _checkeds_1 = [];
            allCheckeds.forEach((/**
             * @param {?} element
             * @return {?}
             */
            function (element) {
                if (!_this._state.checkedRows.find((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return n.id == element.id; }))) {
                    _checkeds_1.push(element);
                }
            }));
            this._state.checkedRows = this._state.checkedRows.concat(_checkeds_1);
        }
        if (this._state.selectOnCheck && !this._state.onlySelectSelf) {
            this._state.selections = [];
            this._state.selections = allData.map((/**
             * @param {?} r
             * @param {?} i
             * @return {?}
             */
            function (r, i) {
                return {
                    id: _this.primaryId(r),
                    index: i,
                    data: r
                };
            }));
        }
        this.checkAllSubject.next(this._state.checkedRows);
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.selectAll = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this._state.selections = [];
        /** @type {?} */
        var allData = this.getAllRowsForLive();
        this._state.selections = allData.map((/**
         * @param {?} r
         * @param {?} i
         * @return {?}
         */
        function (r, i) {
            return {
                id: _this.primaryId(r),
                index: i,
                data: r
            };
        }));
        if (this._state.checkOnSelect) {
            this._state.checkedRows = [];
            this._state.checkedRows = allData.map((/**
             * @param {?} r
             * @param {?} i
             * @return {?}
             */
            function (r, i) {
                return {
                    id: _this.primaryId(r),
                    index: i,
                    data: r
                };
            }));
        }
        this.selectAllSubject.next(this._state.selections);
    };
    /**
     * @param {?} id
     * @return {?}
     */
    DatagridFacadeService.prototype.findRow = /**
     * @param {?} id
     * @return {?}
     */
    function (id) {
        var _this = this;
        if (this._state.data && this._state.data.length) {
            /** @type {?} */
            var index_1 = -1;
            /** @type {?} */
            var data = this._state.data.find((/**
             * @param {?} n
             * @param {?} i
             * @return {?}
             */
            function (n, i) {
                /** @type {?} */
                var r = _this.primaryId(n) == id;
                if (r) {
                    index_1 = i;
                }
                return r;
            }));
            if (index_1 === -1) {
                return null;
            }
            return { index: index_1, data: data };
        }
        return null;
    };
    /**
     * @param {?} id
     * @return {?}
     */
    DatagridFacadeService.prototype.findRowIndex = /**
     * @param {?} id
     * @return {?}
     */
    function (id) {
        var _this = this;
        if (this._state.data && this._state.data.length) {
            return this._state.data.findIndex((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return _this.primaryId(n) === id; }));
        }
        return -1;
    };
    /**
     * 设置选中行，不触发grid 选中事件，取消选中事件
     */
    /**
     * 设置选中行，不触发grid 选中事件，取消选中事件
     * @param {?} id
     * @param {?=} select
     * @param {?=} emit
     * @return {?}
     */
    DatagridFacadeService.prototype.setSelectRow = /**
     * 设置选中行，不触发grid 选中事件，取消选中事件
     * @param {?} id
     * @param {?=} select
     * @param {?=} emit
     * @return {?}
     */
    function (id, select, emit) {
        if (select === void 0) { select = true; }
        if (emit === void 0) { emit = true; }
        /** @type {?} */
        var row = this.findRow(id);
        var _a = tslib_1.__assign({}, row), rowIndex = _a.index, rowData = _a.data;
        /** @type {?} */
        var srow = { id: id, data: rowData, index: rowIndex };
        if (this.isMultiSelect()) {
            if (select) {
                this.selectRowForMulti(srow, false, emit);
            }
            else {
                this.unSelectRowForMulti(srow, false, emit);
            }
        }
        /** @type {?} */
        var _sr = select ? srow : null;
        this.updateState({ currentRow: _sr }, false);
    };
    /**
     * @param {?} id
     * @param {?=} select
     * @return {?}
     */
    DatagridFacadeService.prototype.selectRecord = /**
     * @param {?} id
     * @param {?=} select
     * @return {?}
     */
    function (id, select) {
        if (select === void 0) { select = true; }
        if (id) {
            /** @type {?} */
            var row = this.findRow(id);
            if (row) {
                var _a = tslib_1.__assign({}, row), rowIndex = _a.index, rowData = _a.data;
                if (select) {
                    this.selectRow(rowIndex, rowData);
                }
                else {
                    this.unSelectRow(rowIndex, rowData);
                }
            }
            else {
                this.errorSubject.next("\u672A\u627E\u5230ID\u4E3A" + id + "\u7684\u6570\u636E\u3002");
            }
        }
        else {
            this.errorSubject.next("\u53C2\u6570id \u4E0D\u80FD\u4E3A\u7A7A\u3002");
        }
    };
    /**
     * @param {?} rowIndex
     * @param {?} rowData
     * @param {?=} gridOpts
     * @return {?}
     */
    DatagridFacadeService.prototype.selectRow = /**
     * @param {?} rowIndex
     * @param {?} rowData
     * @param {?=} gridOpts
     * @return {?}
     */
    function (rowIndex, rowData, gridOpts) {
        var _this = this;
        if (gridOpts === void 0) { gridOpts = null; }
        /** @type {?} */
        var isMultiSelect = this.isMultiSelect();
        /** @type {?} */
        var id = this.primaryId(rowData);
        /** @type {?} */
        var srow = { id: id, data: rowData, index: rowIndex };
        if (!this.isRowSelected(id) || !this._state.currentRow) {
            if (!isMultiSelect) {
                this.updateState({ currentRow: srow }, false);
                this.selectRowSubject.next(this._state.currentRow);
                if (this._state.showCheckbox && this._state.checkOnSelect) {
                    this._state.checkedRows = [srow];
                    if (gridOpts && gridOpts.instance && gridOpts.instance.beforeCheck) {
                        gridOpts.instance.beforeCheck({ rowIndex: rowIndex, rowData: rowData, gridInstance: gridOpts.instance }).subscribe((/**
                         * @return {?}
                         */
                        function () {
                            _this.checkRowSubject.next(srow);
                        }));
                    }
                    else {
                        this.checkRowSubject.next(srow);
                    }
                }
            }
            else {
                this.selectRowForMulti(srow, true, gridOpts);
            }
        }
    };
    /**
     * @private
     * @param {?} srow
     * @param {?=} emit
     * @param {?=} gridOpts
     * @return {?}
     */
    DatagridFacadeService.prototype.selectRowForMulti = /**
     * @private
     * @param {?} srow
     * @param {?=} emit
     * @param {?=} gridOpts
     * @return {?}
     */
    function (srow, emit, gridOpts) {
        if (emit === void 0) { emit = true; }
        if (gridOpts === void 0) { gridOpts = null; }
        if (this._state.onlySelectSelf) {
            this._clearSelections();
            this.updateState({ currentRow: srow, selections: [srow] }, false);
        }
        else {
            this._state.selections = this._state.selections || [];
            this._state.selections = this._state.selections.filter((/**
             * @param {?} sr
             * @return {?}
             */
            function (sr) { return sr.id !== srow.id; }));
            this._state.selections.push(srow);
        }
        if (emit) {
            this.selectRowSubject.next(srow);
        }
        if (this._state.checkOnSelect) {
            this.checkRow(srow.index, srow.data, gridOpts);
        }
    };
    /**
     * @private
     * @param {?} srow
     * @param {?=} emit
     * @param {?=} gridOpts
     * @return {?}
     */
    DatagridFacadeService.prototype.unSelectRowForMulti = /**
     * @private
     * @param {?} srow
     * @param {?=} emit
     * @param {?=} gridOpts
     * @return {?}
     */
    function (srow, emit, gridOpts) {
        if (emit === void 0) { emit = true; }
        if (gridOpts === void 0) { gridOpts = null; }
        this._state.selections = this._state.selections.filter((/**
         * @param {?} sr
         * @return {?}
         */
        function (sr) { return sr.id !== srow.id; }));
        if (this._canCancelSelectWhenMulti() || (this._state.currentRow && this._state.currentRow.id === srow.id)) {
            this.updateState({ currentRow: null });
        }
        if (this._state.checkOnSelect) {
            this.unCheckRow(srow.index, srow.data, gridOpts);
        }
        if (emit) {
            this.unSelectRowSubject.next(srow);
        }
    };
    /**
     * @param {?} rowIndex
     * @param {?} rowData
     * @param {?=} gridOpts
     * @return {?}
     */
    DatagridFacadeService.prototype.unSelectRow = /**
     * @param {?} rowIndex
     * @param {?} rowData
     * @param {?=} gridOpts
     * @return {?}
     */
    function (rowIndex, rowData, gridOpts) {
        if (gridOpts === void 0) { gridOpts = null; }
        /** @type {?} */
        var id = this.primaryId(rowData);
        /** @type {?} */
        var isMultiSelect = this.isMultiSelect();
        /** @type {?} */
        var srow = { id: id, index: rowIndex, data: rowData };
        if (!isMultiSelect) {
            if (this._state.currentRow) {
                this.updateState({ currentRow: null });
                this.unSelectRowSubject.next(srow);
                if (this._state.showCheckbox) {
                    this.unCheckRow(srow.index, srow.data, gridOpts);
                }
            }
        }
        else {
            this.unSelectRowForMulti(srow, true, gridOpts);
        }
    };
    /**
     * @private
     * @return {?}
     */
    DatagridFacadeService.prototype._canCancelSelectWhenMulti = /**
     * @private
     * @return {?}
     */
    function () {
        return !this._state.keepSelect && this._state.onlySelectSelf;
    };
    /**
     * @private
     * @param {?=} excludeIds
     * @return {?}
     */
    DatagridFacadeService.prototype._clearSelections = /**
     * @private
     * @param {?=} excludeIds
     * @return {?}
     */
    function (excludeIds) {
        this._state.currentRow = null;
        if (!excludeIds || !excludeIds.length) {
            this._state.selections = [];
        }
        else {
            this._state.selections = this._state.selections.filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) {
                return excludeIds.findIndex((/**
                 * @param {?} i
                 * @return {?}
                 */
                function (i) { return i == n.id; })) > -1;
            }));
        }
    };
    /**
     * @private
     * @param {?=} rows
     * @return {?}
     */
    DatagridFacadeService.prototype._clearCheckeds = /**
     * @private
     * @param {?=} rows
     * @return {?}
     */
    function (rows) {
        var _this = this;
        if (rows === void 0) { rows = []; }
        if (!rows.length) {
            this._state.checkedRows = [];
        }
        else {
            this._state.checkedRows = this._state.checkedRows.filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return rows.findIndex((/**
             * @param {?} r
             * @return {?}
             */
            function (r) { return _this.primaryId(r) === n.id; })) == -1; }));
        }
    };
    /**
     * @param {?=} excludeIds
     * @return {?}
     */
    DatagridFacadeService.prototype.clearSelections = /**
     * @param {?=} excludeIds
     * @return {?}
     */
    function (excludeIds) {
        /** @type {?} */
        var rows = this._state.selections;
        excludeIds = excludeIds || [];
        this._clearSelections(excludeIds);
        /** @type {?} */
        var unCheckRows = rows.filter((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return excludeIds.findIndex((/**
         * @param {?} i
         * @return {?}
         */
        function (i) { return i == n.id; })) == -1; }));
        if (this._state.checkOnSelect || (!this._state.multiSelect && this._state.showCheckbox)) {
            // this._state.checkedRows = [];
            // this.clearCheckedsSubject.next(rows);
            this._state.checkedRows = this._state.checkedRows.filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) {
                return !rows.find((/**
                 * @param {?} t1
                 * @return {?}
                 */
                function (t1) { return t1.id == n.id && excludeIds.findIndex((/**
                 * @param {?} i
                 * @return {?}
                 */
                function (i) { return i == n.id; })) == -1; }));
            }));
            this.clearCheckedsSubject.next(unCheckRows);
        }
        this.clearSelectionSubject.next(unCheckRows);
    };
    /**
     * @param {?=} clearAll
     * @return {?}
     */
    DatagridFacadeService.prototype.clearCheckeds = /**
     * @param {?=} clearAll
     * @return {?}
     */
    function (clearAll) {
        if (clearAll === void 0) { clearAll = true; }
        /** @type {?} */
        var rows = this.getAllRowsForLive();
        /** @type {?} */
        var _rows = clearAll ? [] : rows;
        this._clearCheckeds(_rows);
        if (this._state.selectOnCheck) {
            this._clearSelections();
        }
        this.clearCheckedsSubject.next(rows);
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.clearAll = /**
     * @return {?}
     */
    function () {
        this._clearCheckeds();
        this._clearSelections();
        this.clearAllSubject.next();
    };
    /**
     * @param {?} flag
     * @return {?}
     */
    DatagridFacadeService.prototype.setMultiSelect = /**
     * @param {?} flag
     * @return {?}
     */
    function (flag) {
        this._state.multiSelect = flag;
    };
    /**
     * @param {?} flag
     * @return {?}
     */
    DatagridFacadeService.prototype.setCheckOnSelect = /**
     * @param {?} flag
     * @return {?}
     */
    function (flag) {
        this._state.checkOnSelect = flag;
    };
    /**
     * @param {?} flag
     * @return {?}
     */
    DatagridFacadeService.prototype.setSelectOnCheck = /**
     * @param {?} flag
     * @return {?}
     */
    function (flag) {
        this._state.selectOnCheck = flag;
    };
    /**
     * @param {?} dr
     * @param {?} field
     * @param {?=} cellElement
     * @param {?=} cellRef
     * @return {?}
     */
    DatagridFacadeService.prototype.setCurrentCell = /**
     * @param {?} dr
     * @param {?} field
     * @param {?=} cellElement
     * @param {?=} cellRef
     * @return {?}
     */
    function (dr, field, cellElement, cellRef) {
        var _a = tslib_1.__assign({}, dr), rowIndex = _a.rowIndex, rowData = _a.rowData;
        /** @type {?} */
        var currentCell = tslib_1.__assign({}, this._state.currentCell, { rowIndex: rowIndex, rowData: rowData, field: field, rowId: this.primaryId(rowData), cellElement: cellElement });
        if (field !== this._state.ControlPanelFeild) {
            if (cellRef) {
                currentCell.cellRef = cellRef;
            }
            if (field) {
                currentCell.column = this.getColumn(field);
            }
            /** @type {?} */
            var isLastRow = rowIndex === this.getData().length - 1;
            currentCell['lastRow'] = isLastRow;
        }
        else {
            currentCell = null;
        }
        this._state.currentCell = null;
        this.updateState({ currentCell: currentCell }, false);
        this.selectRow(rowIndex, rowData);
        if (this._state.currentRow) {
            this._state.currentRow.dr = dr;
        }
        this.selectCellSubject.next(currentCell);
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.cancelSelectCell = /**
     * @return {?}
     */
    function () {
        if (this._state.currentCell) {
            this._state.currentCell = null;
            this.updateState({ currentCell: null }, false);
            this.selectCellSubject.next(null);
        }
    };
    /**
     * @param {?} rowData
     * @return {?}
     */
    DatagridFacadeService.prototype.primaryId = /**
     * @param {?} rowData
     * @return {?}
     */
    function (rowData) {
        return rowData[this._state.idField];
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.getCurrentCell = /**
     * @return {?}
     */
    function () {
        return this._state.currentCell;
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.editCell = /**
     * @return {?}
     */
    function () {
        if (this._state.currentCell) {
            if (!this._state.currentCell.isEditing) {
                /** @type {?} */
                var cei = tslib_1.__assign({}, this._state.currentCell, { isEditing: true });
                this.updateState({ currentCell: cei }, false);
                this.selectCellSubject.next(cei);
                // this.editCell$.next(cei);
            }
        }
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.endEditCell = /**
     * @return {?}
     */
    function () {
        if (this._state.currentCell && this._state.currentCell.isEditing) {
            /** @type {?} */
            var cei = tslib_1.__assign({}, this._state.currentCell, { isEditing: false });
            this.updateState({ currentCell: cei }, false);
            this.selectCellSubject.next(cei);
            // this.editCell$.next(cei);
        }
    };
    /**
     * @param {?} rowData
     * @return {?}
     */
    DatagridFacadeService.prototype.appendRow = /**
     * @param {?} rowData
     * @return {?}
     */
    function (rowData) {
        if (rowData && this.primaryId(rowData)) {
            /** @type {?} */
            var pid = this.primaryId(rowData);
            if (this.findRowIndex(pid) === -1) {
                this._state.data.push(rowData);
                /** @type {?} */
                var newData = tslib_1.__spread(this._state.data);
                this.updateState({ data: newData }, false);
                this._state.originalData = cloneDeep(this._state.data);
                this.refresh();
                this.rowAppend$.emit(rowData);
            }
            else {
                throw new Error("\u4E3B\u952EID \u5DF2\u5B58\u5728\uFF01ID: " + pid);
            }
        }
        else {
            throw new Error("\u4E3B\u952E\u6807\u8BC6\u5B57\u6BB5\u4E0D\u80FD\u4E3A\u7A7A\u3002");
        }
    };
    /**
     * @param {?} rowid
     * @param {?} rowData
     * @return {?}
     */
    DatagridFacadeService.prototype.updateRow = /**
     * @param {?} rowid
     * @param {?} rowData
     * @return {?}
     */
    function (rowid, rowData) {
        /** @type {?} */
        var row = this.findRow(rowid);
        if (row && row.data) {
            if (rowData) {
                /** @type {?} */
                var keys = Object.keys(rowData);
                keys.forEach((/**
                 * @param {?} field
                 * @return {?}
                 */
                function (field) {
                    Utils.setValue(field, rowData[field], row.data);
                }));
                // 更新已勾选的数据
                this.updateCheckedData(rowid, rowData);
                /** @type {?} */
                var rowUpdateParam = tslib_1.__assign({}, row, { keyID: rowid });
                this.rowUpdate$.emit(rowUpdateParam);
            }
        }
    };
    /**
     * @param {?} rowid
     * @return {?}
     */
    DatagridFacadeService.prototype.deleteRow = /**
     * @param {?} rowid
     * @return {?}
     */
    function (rowid) {
        /** @type {?} */
        var row = this.findRow(rowid);
        if (row) {
            /** @type {?} */
            var newData = this.removeRow(this._state.data, rowid);
            this.updateState({ data: newData }, false);
            this._state.originalData = cloneDeep(this._state.data);
            this.refresh();
            this.rowDelete$.emit(rowid);
            return row;
        }
    };
    /**
     * 从数组中删除指定的ID
     * @param data 数组
     * @param rowId 要删除的ID
     */
    /**
     * 从数组中删除指定的ID
     * @param {?} data 数组
     * @param {?} rowId 要删除的ID
     * @return {?}
     */
    DatagridFacadeService.prototype.removeRow = /**
     * 从数组中删除指定的ID
     * @param {?} data 数组
     * @param {?} rowId 要删除的ID
     * @return {?}
     */
    function (data, rowId) {
        var _this = this;
        /** @type {?} */
        var newData = data.filter((/**
         * @param {?} n
         * @return {?}
         */
        function (n) {
            /** @type {?} */
            var id = _this.primaryId(n);
            return rowId !== id;
        }));
        return newData;
    };
    /**
     * @param {?} cellInfo
     * @return {?}
     */
    DatagridFacadeService.prototype.isCellSelected = /**
     * @param {?} cellInfo
     * @return {?}
     */
    function (cellInfo) {
        /** @type {?} */
        var cc = this.getCurrentCell();
        if (!cc) {
            return false;
        }
        else {
            if (this._state.currentRow.index === cc.rowIndex) {
                return cc.field === cellInfo.field;
            }
            return false;
        }
    };
    /**
     * @protected
     * @param {?} state
     * @param {?=} emit
     * @return {?}
     */
    DatagridFacadeService.prototype.updateState = /**
     * @protected
     * @param {?} state
     * @param {?=} emit
     * @return {?}
     */
    function (state, emit) {
        if (emit === void 0) { emit = true; }
        /** @type {?} */
        var newState = tslib_1.__assign({}, this._state, state);
        this._state = newState;
        if (emit) {
            this.store.next(this._state);
        }
    };
    /**
     * @param {?=} newSize
     * @return {?}
     */
    DatagridFacadeService.prototype.resize = /**
     * @param {?=} newSize
     * @return {?}
     */
    function (newSize) {
        if (newSize) {
            this.updateState(newSize, false);
        }
        this.resetColumnsSize();
        if (!this._state.groupRows) {
            this.updateVirthualRows(this._state.virtual.scrollTop);
        }
    };
    /**
     * @param {?} fit
     * @return {?}
     */
    DatagridFacadeService.prototype.fitColumns = /**
     * @param {?} fit
     * @return {?}
     */
    function (fit) {
        this.updateState({ fitColumns: fit }, false);
        // const r = this.useUserSetColumnSize();
        // this.setFitColumnsWidth(this._state.columnsGroup, true, r);
        // this.gridSizeSubject.next(this._state);
        this.resetColumnsSize();
    };
    /**
     * @private
     * @return {?}
     */
    DatagridFacadeService.prototype.useUserSetColumnSize = /**
     * @private
     * @return {?}
     */
    function () {
        if (this._state.autoFitColumns) {
            /** @type {?} */
            var gridWidth = this._state.width;
            /** @type {?} */
            var userSetColumnWidth = this._state.columnsGroup.originalTotalWidth;
            return userSetColumnWidth > gridWidth;
        }
        return false;
    };
    /**
     * @private
     * @return {?}
     */
    DatagridFacadeService.prototype.resetColumnsSize = /**
     * @private
     * @return {?}
     */
    function () {
        if (this._state.fitColumns) {
            // 20200421
            /** @type {?} */
            var r = this.useUserSetColumnSize();
            this.setFitColumnsWidth(this._state.columnsGroup, r, r);
        }
        this.gridSizeSubject.next(this._state);
    };
    /**
     * 更新列设置
     * @param columns 新的列集合
     * @param restitute 是否还原初始宽度 默认为 false
     */
    /**
     * 更新列设置
     * @param {?} columns 新的列集合
     * @param {?=} restitute 是否还原初始宽度 默认为 false
     * @param {?=} emit
     * @return {?}
     */
    DatagridFacadeService.prototype.updateColumns = /**
     * 更新列设置
     * @param {?} columns 新的列集合
     * @param {?=} restitute 是否还原初始宽度 默认为 false
     * @param {?=} emit
     * @return {?}
     */
    function (columns, restitute, emit) {
        if (restitute === void 0) { restitute = false; }
        if (emit === void 0) { emit = false; }
        this._state.columns = columns;
        this.initColumns(emit, restitute);
        this.resizeColumns(restitute);
    };
    /**
     * @param {?} columns
     * @return {?}
     */
    DatagridFacadeService.prototype.getGroupColumns = /**
     * @param {?} columns
     * @return {?}
     */
    function (columns) {
        var _this = this;
        /** @type {?} */
        var arr = [];
        /** @type {?} */
        var allCols = this.getAllFlatColumns();
        columns.forEach((/**
         * @param {?} c
         * @return {?}
         */
        function (c) {
            if (!c.colspan || c.colspan == 1) {
                if (!arr.find((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return n.field === c.field; }))) {
                    arr.push(c);
                }
            }
            else {
                arr = arr.concat(_this.getGroupColumns(allCols.filter((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return n.parentId == c.id; }))));
            }
        }));
        return arr;
    };
    /**
     * @param {?=} emit
     * @param {?=} restColumnWidth
     * @return {?}
     */
    DatagridFacadeService.prototype.initColumns = /**
     * @param {?=} emit
     * @param {?=} restColumnWidth
     * @return {?}
     */
    function (emit, restColumnWidth) {
        if (emit === void 0) { emit = false; }
        if (restColumnWidth === void 0) { restColumnWidth = false; }
        /** @type {?} */
        var columns = this._state.flatColumns;
        /** @type {?} */
        var colgroup = {
            leftFixed: [],
            rightFixed: [],
            normalColumns: [],
            columns: []
        };
        if (columns && columns.length) {
            /** @type {?} */
            var leftFixedCols = this.getFixedCols('left');
            /** @type {?} */
            var rightFixedCols = this.getFixedCols('right');
            /** @type {?} */
            var normalCols = this.getFixedCols();
            columns.forEach((/**
             * @param {?} c
             * @return {?}
             */
            function (c) {
                if (!c.originalWidth) {
                    c.originalWidth = c.width;
                }
                else {
                    if (restColumnWidth) {
                        c.width = c.originalWidth;
                    }
                }
            }));
            colgroup = {
                leftFixed: leftFixedCols,
                rightFixed: rightFixedCols,
                normalColumns: normalCols,
                columns: leftFixedCols.concat(normalCols).concat(rightFixedCols)
            };
            this.initColumnsWidth(colgroup, restColumnWidth);
            if (this._state.fitColumns) {
                this.setFitColumnsWidth(colgroup, true);
            }
            this.updateState({ columnsGroup: colgroup }, emit);
        }
        else {
            colgroup.leftFixedWidth = 0;
            colgroup.rightFixedWidth = 0;
            colgroup.normalWidth = 0;
            colgroup.totalWidth = 0;
            this.updateState({ columnsGroup: colgroup }, emit);
        }
    };
    /**
     * @param {?} field
     * @param {?=} fixed
     * @return {?}
     */
    DatagridFacadeService.prototype.getColumnIndex = /**
     * @param {?} field
     * @param {?=} fixed
     * @return {?}
     */
    function (field, fixed) {
        if (fixed === void 0) { fixed = ''; }
        /** @type {?} */
        var colgroup = this._state.columnsGroup;
        if (!fixed || this._state.fast) {
            return colgroup.normalColumns.findIndex((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n.field === field; }));
        }
        else {
            if (fixed === 'left') {
                return colgroup.leftFixed.findIndex((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return n.field === field; }));
            }
            else if (fixed === 'right') {
                return colgroup.rightFixed.findIndex((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return n.field === field; }));
            }
        }
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.columnResizeEnd = /**
     * @return {?}
     */
    function () {
        // const colgroup = this._state.columnsGroup;
        // this.initColumnsWidth(colgroup, false);
        // this.updateState({ columnsGroup:  {...colgroup} }, false);
        // this.gridSizeSubject.next(this._state);
        this.resizeColumns();
    };
    /**
     * @param {?=} restitute
     * @return {?}
     */
    DatagridFacadeService.prototype.resizeColumns = /**
     * @param {?=} restitute
     * @return {?}
     */
    function (restitute) {
        if (restitute === void 0) { restitute = false; }
        /** @type {?} */
        var colgroup = this._state.columnsGroup;
        this.initColumnsWidth(colgroup, restitute);
        if (this._state.fitColumns) {
            /** @type {?} */
            var r = this.useUserSetColumnSize();
            if (r) {
                this.setFitColumnsWidth(colgroup, restitute, r);
            }
            else {
                this.setFitColumnsWidth(colgroup, restitute);
            }
        }
        this.updateState({ columnsGroup: tslib_1.__assign({}, colgroup) }, false);
        this.gridSizeSubject.next(this._state);
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.getAllFlatColumns = /**
     * @return {?}
     */
    function () {
        return flatten(this._state.columns);
    };
    /**
     * @param {?} fieldName
     * @return {?}
     */
    DatagridFacadeService.prototype.getColumn = /**
     * @param {?} fieldName
     * @return {?}
     */
    function (fieldName) {
        return this.getAllFlatColumns().find((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n.field === fieldName; }));
    };
    /**
     * @param {?} colgroup
     * @param {?=} restitute
     * @param {?=} useUserSetColumnSize
     * @return {?}
     */
    DatagridFacadeService.prototype.setFitColumnsWidth = /**
     * @param {?} colgroup
     * @param {?=} restitute
     * @param {?=} useUserSetColumnSize
     * @return {?}
     */
    function (colgroup, restitute, useUserSetColumnSize) {
        if (restitute === void 0) { restitute = false; }
        if (useUserSetColumnSize === void 0) { useUserSetColumnSize = false; }
        if (!colgroup) {
            return;
        }
        colgroup.normalWidth = this._state.width - colgroup.leftFixedWidth - colgroup.rightFixedWidth;
        if (!colgroup.normalWidth || colgroup.normalWidth < 0) {
            return;
        }
        if (useUserSetColumnSize) {
            colgroup.totalWidth = colgroup.originalTotalWidth;
            if (restitute) {
                colgroup.normalColumns.forEach((/**
                 * @param {?} col
                 * @return {?}
                 */
                function (col) {
                    col.width = col.originalWidth;
                }));
            }
            // 更新 normalColumns width
            colgroup.normalWidth = colgroup.normalColumns.reduce((/**
             * @param {?} totalWidth
             * @param {?} col
             * @return {?}
             */
            function (totalWidth, col) {
                if (!restitute && col.width) {
                    return totalWidth += col.width;
                }
                else {
                    return totalWidth += col.originalWidth;
                }
            }), 0);
            colgroup.totalWidth = colgroup.leftFixedWidth + colgroup.rightFixedWidth + colgroup.normalWidth;
        }
        else {
            /** @type {?} */
            var minWidth_1 = colgroup.normalColumns.reduce((/**
             * @param {?} totalWidth
             * @param {?} col
             * @return {?}
             */
            function (totalWidth, col) {
                if (!restitute) {
                    return totalWidth += col.width;
                }
                else {
                    return totalWidth += col.originalWidth;
                }
            }), 0);
            // colgroup.normalWidth = colgroup.normalWidth - 2;
            colgroup.normalColumns.forEach((/**
             * @param {?} col
             * @return {?}
             */
            function (col) {
                if (!restitute) {
                    // col.width = Math.floor( col.width / minWidth * colgroup.normalWidth );
                    col.width = Number((col.width / minWidth_1 * colgroup.normalWidth).toFixed(2));
                }
                else {
                    // col.width = Math.floor( col.originalWidth / minWidth * colgroup.normalWidth );
                    col.width = Number((col.originalWidth / minWidth_1 * colgroup.normalWidth).toFixed(2));
                }
            }));
            colgroup.totalWidth = colgroup.leftFixedWidth + colgroup.rightFixedWidth + colgroup.normalWidth;
        }
    };
    /**
     * @private
     * @param {?=} direction
     * @return {?}
     */
    DatagridFacadeService.prototype.getFixedCols = /**
     * @private
     * @param {?=} direction
     * @return {?}
     */
    function (direction) {
        if (direction === void 0) { direction = ''; }
        /** @type {?} */
        var cols = [];
        if (!direction) {
            cols = this._state.flatColumns.filter((/**
             * @param {?} col
             * @return {?}
             */
            function (col) { return !col.fixed; }));
        }
        else {
            cols = this._state.flatColumns.filter((/**
             * @param {?} col
             * @return {?}
             */
            function (col) { return col.fixed === direction; }));
        }
        // 多表头，重新计算列的顺序
        if (this._state.columns.length > 1 && cols.length) {
            /** @type {?} */
            var fields = DatagridColumnsHelper.getFields(this._state.columns);
            /** @type {?} */
            var newcols_1 = [];
            fields.forEach((/**
             * @param {?} f
             * @return {?}
             */
            function (f) {
                /** @type {?} */
                var c = cols.find((/**
                 * @param {?} col
                 * @return {?}
                 */
                function (col) { return (col.field || '') === f; }));
                if (c) {
                    newcols_1.push(c);
                }
            }));
            return newcols_1;
        }
        return cols;
    };
    // restitute: 还原初始宽度，默认 false
    // restitute: 还原初始宽度，默认 false
    /**
     * @private
     * @param {?} colgroup
     * @param {?=} restitute
     * @return {?}
     */
    DatagridFacadeService.prototype.initColumnsWidth = 
    // restitute: 还原初始宽度，默认 false
    /**
     * @private
     * @param {?} colgroup
     * @param {?=} restitute
     * @return {?}
     */
    function (colgroup, restitute) {
        if (restitute === void 0) { restitute = false; }
        /** @type {?} */
        var offset = 0;
        offset = this._state.showLineNumber ? offset + this._state.lineNumberWidth : offset;
        offset = this._state.showCheckbox ? offset + this._state.checkboxColumnWidth : offset;
        /** @type {?} */
        var getColsWidth = (/**
         * @param {?} cols
         * @param {?} val
         * @param {?} reset
         * @return {?}
         */
        function (cols, val, reset) {
            return cols.reduce((/**
             * @param {?} r
             * @param {?} c
             * @return {?}
             */
            function (r, c) {
                c.left = r;
                if (!reset) {
                    return r + c.width;
                }
                else {
                    return r + c.originalWidth;
                }
            }), val);
        });
        colgroup.leftFixedWidth = offset;
        if (colgroup.leftFixed && colgroup.leftFixed.length) {
            colgroup.leftFixedWidth = getColsWidth(colgroup.leftFixed, offset, restitute);
        }
        colgroup.rightFixedWidth = 0;
        if (colgroup.rightFixed && colgroup.rightFixed.length) {
            colgroup.rightFixedWidth = getColsWidth(colgroup.rightFixed, 0, restitute);
        }
        colgroup.normalWidth = 0;
        if (this._state.columns && this._state.columns.length) {
            colgroup.normalWidth = getColsWidth(colgroup.normalColumns, 0, restitute);
            colgroup.originalTotalWidth = getColsWidth(colgroup.normalColumns, 0, true);
        }
        colgroup.totalWidth = colgroup.leftFixedWidth + colgroup.rightFixedWidth + colgroup.normalWidth;
    };
    /**
     * @param {?=} isShow
     * @return {?}
     */
    DatagridFacadeService.prototype.showCheckbox = /**
     * @param {?=} isShow
     * @return {?}
     */
    function (isShow) {
        if (isShow === void 0) { isShow = true; }
        /** @type {?} */
        var colgroup = this._state.columnsGroup;
        this.updateState({ showCheckbox: isShow }, false);
        if (isShow) {
            colgroup.leftFixedWidth = colgroup.leftFixedWidth + this._state.checkboxColumnWidth;
        }
        else {
            colgroup.leftFixedWidth = colgroup.leftFixedWidth - this._state.checkboxColumnWidth;
        }
        this.columnResizeSubject.next(colgroup);
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.hideCheckbox = /**
     * @return {?}
     */
    function () {
        this.showCheckbox(false);
    };
    /**
     * @param {?=} isShow
     * @return {?}
     */
    DatagridFacadeService.prototype.showLineNumber = /**
     * @param {?=} isShow
     * @return {?}
     */
    function (isShow) {
        if (isShow === void 0) { isShow = true; }
        /** @type {?} */
        var colgroup = this._state.columnsGroup;
        this.updateState({ showLineNumber: isShow }, false);
        if (isShow) {
            colgroup.leftFixedWidth = colgroup.leftFixedWidth + this._state.lineNumberWidth;
        }
        else {
            colgroup.leftFixedWidth = colgroup.leftFixedWidth - this._state.lineNumberWidth;
        }
        this.columnResizeSubject.next(colgroup);
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.hideLineNumber = /**
     * @return {?}
     */
    function () {
        this.showLineNumber(false);
    };
    /**
     * @param {?} sortName
     * @param {?} sortOrder
     * @return {?}
     */
    DatagridFacadeService.prototype.setSortInfo = /**
     * @param {?} sortName
     * @param {?} sortOrder
     * @return {?}
     */
    function (sortName, sortOrder) {
        sortName = sortName || '';
        sortOrder = sortOrder || '';
        /** @type {?} */
        var fields = sortName.split(',');
        /** @type {?} */
        var orders = sortOrder.split(',');
        // if (!this._state.multiSort) {
        /** @type {?} */
        var colgroup = this._state.columnsGroup;
        /** @type {?} */
        var updateFieldOrder = (/**
         * @param {?} cols
         * @return {?}
         */
        function (cols) {
            if (!cols || !cols.length) {
                return;
            }
            cols.forEach((/**
             * @param {?} col
             * @return {?}
             */
            function (col) {
                col.order = undefined;
                /** @type {?} */
                var i = fields.findIndex((/**
                 * @param {?} f
                 * @return {?}
                 */
                function (f) { return f === col.field; }));
                if (i > -1) {
                    col.order = orders[i];
                }
            }));
        });
        updateFieldOrder(colgroup.normalColumns);
        updateFieldOrder(colgroup.leftFixed);
        updateFieldOrder(colgroup.rightFixed);
        // }
        this.updateState({ sortName: sortName, sortOrder: sortOrder }, false);
    };
    /**
     * @param {?} arr
     * @param {?} props
     * @param {?} orders
     * @return {?}
     */
    DatagridFacadeService.prototype.orderBy = /**
     * @param {?} arr
     * @param {?} props
     * @param {?} orders
     * @return {?}
     */
    function (arr, props, orders) {
        var _this = this;
        /** @type {?} */
        var colObj = props.reduce((/**
         * @param {?} c
         * @param {?} n
         * @return {?}
         */
        function (c, n) {
            c[n] = _this.getColumn(n);
            return c;
        }), {});
        return tslib_1.__spread(arr).sort((/**
         * @param {?} a
         * @param {?} b
         * @return {?}
         */
        function (a, b) {
            return props.reduce((/**
             * @param {?} acc
             * @param {?} prop
             * @param {?} i
             * @return {?}
             */
            function (acc, prop, i) {
                if (acc === 0) {
                    /** @type {?} */
                    var valA = Utils.getValue(prop, a);
                    /** @type {?} */
                    var valB = Utils.getValue(prop, b);
                    if (colObj[prop] && colObj[prop]['isMultilingualField']) {
                        valA = Utils.getMultilingualValue(valA, _this.localId);
                        valB = Utils.getMultilingualValue(valB, _this.localId);
                    }
                    if (valA === undefined || valA === null) {
                        valA = '';
                    }
                    if (valB === undefined || valB === null) {
                        valB = '';
                    }
                    var _a = tslib_1.__read(orders && orders[i] === 'desc' ? [valB, valA] : [valA, valB], 2), p1 = _a[0], p2 = _a[1];
                    if (typeof p1 === 'string') {
                        acc = p1.localeCompare(p2);
                    }
                    else {
                        acc = p1 > p2 ? 1 : p1 < p2 ? -1 : 0;
                    }
                }
                return acc;
            }), 0);
        }));
    };
    /**
     * @param {?} data
     * @return {?}
     */
    DatagridFacadeService.prototype.sort = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        /** @type {?} */
        var orders = this._state.sortOrder.split(',');
        /** @type {?} */
        var fields = this._state.sortName.split(',');
        if (this._state.mergeCell && this._state.mergeFields && this._state.mergeFields.length) {
            /** @type {?} */
            var newOrders_1 = [];
            /** @type {?} */
            var newFields_1 = tslib_1.__spread(this._state.mergeFields);
            fields.forEach((/**
             * @param {?} f
             * @param {?} i
             * @return {?}
             */
            function (f, i) {
                /** @type {?} */
                var k = newFields_1.indexOf(f);
                if (k == -1) {
                    newFields_1.push(f);
                    k = newFields_1.length - 1;
                }
                newOrders_1[k] = orders[i];
            }));
            return this.orderBy(data, newFields_1, newOrders_1);
        }
        return this.orderBy(data, fields, orders);
    };
    /**
     * @param {?=} data
     * @return {?}
     */
    DatagridFacadeService.prototype.clientSort = /**
     * @param {?=} data
     * @return {?}
     */
    function (data) {
        if (this._state.sortName) {
            if (data) {
                this.updateState({ data: data }, false);
            }
            /** @type {?} */
            var sortedData = this.sort(this._state.data);
            this.loadData(sortedData, false);
        }
        else {
            this.clearSort();
        }
        this.clientSort$.emit({ sortName: this._state.sortName, sortOrder: this._state.sortOrder });
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.clearSort = /**
     * @return {?}
     */
    function () {
        this.loadData(this._state.originalData, false);
    };
    /**
     * @param {?} filterData
     * @return {?}
     */
    DatagridFacadeService.prototype.loadFilterData = /**
     * @param {?} filterData
     * @return {?}
     */
    function (filterData) {
        this.loadData(filterData, false);
    };
    //#region 变更集
    //#region 变更集
    /**
     * @private
     * @param {?} rowid
     * @return {?}
     */
    DatagridFacadeService.prototype.hasRowChanges = 
    //#region 变更集
    /**
     * @private
     * @param {?} rowid
     * @return {?}
     */
    function (rowid) {
        /** @type {?} */
        var _changes = this._state.changes;
        if (!_changes) {
            return false;
        }
        return _changes[rowid];
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    DatagridFacadeService.prototype.appendChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        if (!changes) {
            return;
        }
        /** @type {?} */
        var id = changes[this._state.idField];
        if (!id) {
            return;
        }
        /** @type {?} */
        var _id = '' + id;
        if (!this.hasRowChanges(_id)) {
            this._state.changes = this._state.changes || {};
            this._state.changes[_id] = changes;
        }
        else {
            this._state.changes[_id] = Object.assign(this._state.changes[_id], changes);
        }
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.acceptChanges = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var changes = this._state.changes;
        if (changes) {
            /** @type {?} */
            var keys = Object.keys(changes);
            keys.forEach((/**
             * @param {?} id
             * @return {?}
             */
            function (id) {
                _this.updateRow(id, changes[id]);
            }));
            this._state.originalData = cloneDeep(this._state.data);
        }
    };
    /**
     * @param {?=} rowid
     * @return {?}
     */
    DatagridFacadeService.prototype.rejectChanges = /**
     * @param {?=} rowid
     * @return {?}
     */
    function (rowid) {
        var _this = this;
        if (rowid === void 0) { rowid = null; }
        /** @type {?} */
        var changes = this._state.changes;
        if (changes) {
            if (!rowid) {
                this._state.data = cloneDeep(this._state.originalData);
                this._state.changes = null;
            }
            else {
                /** @type {?} */
                var rowChanges = this._state.changes['' + rowid];
                if (rowChanges) {
                    /** @type {?} */
                    var orgiRow_1 = this._state.originalData.find((/**
                     * @param {?} r
                     * @return {?}
                     */
                    function (r) { return _this.primaryId(r) === rowid; }));
                    this._state.data.forEach((/**
                     * @param {?} r
                     * @return {?}
                     */
                    function (r) {
                        if (_this.primaryId(r) === rowid) {
                            r = cloneDeep(orgiRow_1);
                        }
                    }));
                }
            }
            this.refresh();
        }
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.getChanges = /**
     * @return {?}
     */
    function () {
        return this._state.changes;
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.refresh = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var data = cloneDeep(this._state.data);
        this.loadData(data);
    };
    //#endregion
    /**
     * 构造合计行
     * @param data 数据集合
     */
    //#endregion
    /**
     * 构造合计行
     * @param {?} data 数据集合
     * @return {?}
     */
    DatagridFacadeService.prototype.getFooterData = 
    //#endregion
    /**
     * 构造合计行
     * @param {?} data 数据集合
     * @return {?}
     */
    function (data) {
        var _this = this;
        if (!data || !data.length) {
            return [];
        }
        // const columns = this._state.flatColumns;
        /** @type {?} */
        var columns = flatten(this._state.columns).filter((/**
         * @param {?} col
         * @return {?}
         */
        function (col) { return !col.colspan; }));
        /** @type {?} */
        var footerRow = {};
        columns.forEach((/**
         * @param {?} col
         * @return {?}
         */
        function (col) {
            if (col.footer && col.footer.options) {
                /** @type {?} */
                var options = col.footer.options;
                /** @type {?} */
                var text = options.text;
                /** @type {?} */
                var typ = (/** @type {?} */ (options.calculationType));
                if (typ !== undefined && typ != -1) {
                    /** @type {?} */
                    var val = _this.calculation(data, typ, col);
                    footerRow[col.field] = val;
                }
                else {
                    footerRow[col.field] = text || '';
                }
            }
            else {
                footerRow[col.field] = '';
            }
        }));
        return [footerRow];
    };
    /**
     * @private
     * @param {?} items
     * @param {?} fields
     * @return {?}
     */
    DatagridFacadeService.prototype.arrToGroup = /**
     * @private
     * @param {?} items
     * @param {?} fields
     * @return {?}
     */
    function (items, fields) {
        if (fields.length) {
            /** @type {?} */
            var first_1 = fields.shift();
            /** @type {?} */
            var g1 = groupBy(items, (/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return Utils.getValue(first_1, n); }));
            this.toGroup(g1, fields);
            return g1;
        }
    };
    /**
     * @private
     * @param {?} g1
     * @param {?} fieldArr
     * @return {?}
     */
    DatagridFacadeService.prototype.toGroup = /**
     * @private
     * @param {?} g1
     * @param {?} fieldArr
     * @return {?}
     */
    function (g1, fieldArr) {
        var _this = this;
        if (fieldArr.length) {
            Object.keys(g1).forEach((/**
             * @param {?} k
             * @return {?}
             */
            function (k) {
                /** @type {?} */
                var items = g1[k];
                /** @type {?} */
                var _nextFields = fieldArr.map((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return n; }));
                /** @type {?} */
                var _f = _nextFields.shift();
                g1[k] = groupBy(items, (/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return Utils.getValue(_f, n); }));
                if (_nextFields.length) {
                    _this.toGroup(g1[k], _nextFields);
                }
            }));
        }
    };
    /**
     * @private
     * @param {?} groupRows
     * @param {?} initLevel
     * @param {?} parent
     * @return {?}
     */
    DatagridFacadeService.prototype.groupRows2Flat = /**
     * @private
     * @param {?} groupRows
     * @param {?} initLevel
     * @param {?} parent
     * @return {?}
     */
    function (groupRows, initLevel, parent) {
        var _this = this;
        /** @type {?} */
        var results = [];
        if (initLevel === undefined) {
            initLevel = 0;
        }
        /** @type {?} */
        var idfield = this._state.idField;
        /** @type {?} */
        var columns = this._state.flatColumns;
        /** @type {?} */
        var data = this._state.data;
        /** @type {?} */
        var groupFieldArr = this._state.groupField.split(',');
        /** @type {?} */
        var pid = parent ? parent[idfield] : null;
        /** @type {?} */
        var colspan = this._state.columnsGroup.normalColumns.length;
        /** @type {?} */
        var expandGroupRows = this._state.expandGroupRows;
        Object.keys(groupRows).forEach((/**
         * @param {?} k
         * @param {?} m
         * @return {?}
         */
        function (k, m) {
            var _a, _b;
            /** @type {?} */
            var groupItem = (_a = {}, _a[idfield] = Utils.uuid(), _a[IS_GROUP_ROW_FIELD] = true, _a[GROUP_LEVEL_FIELD] = initLevel, _a.data = {}, _a.value = k, _a[GROUP_VISIBLE_FIELD] = true, _a.expanded = expandGroupRows, _a.field = groupFieldArr[initLevel], _a.colspan = colspan, _a.total = 0, _a.rows = [], _a[GROUP_ROW_FIELD] = pid, _a);
            // TFS: 356955
            if (parent) {
                groupItem.rows = parent.rows.filter((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return !n[IS_GROUP_ROW_FIELD] &&
                    !n[IS_GROUP_FOOTER_ROW_FIELD] && Utils.getValue(groupFieldArr[initLevel], n) === k; }));
                groupItem[GROUP_VISIBLE_FIELD] = expandGroupRows;
            }
            else {
                groupItem.rows = data.filter((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return '' + Utils.getValue(groupFieldArr[initLevel], n) === k; }));
            }
            if (parent) {
                parent.rows.push(groupItem);
            }
            groupItem.total = groupItem.rows.filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return !n[IS_GROUP_ROW_FIELD] && !n[IS_GROUP_FOOTER_ROW_FIELD]; })).length;
            results.push(groupItem);
            /** @type {?} */
            var items = groupRows[k];
            if (isPlainObject(items)) {
                /** @type {?} */
                var level = initLevel + 1;
                results = results.concat(_this.groupRows2Flat(items, level, groupItem));
            }
            else {
                groupItem.total = items.length;
                items = items.map((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) {
                    n[GROUP_ROW_FIELD] = groupItem[idfield];
                    n[GROUP_VISIBLE_FIELD] = expandGroupRows;
                    n[GROUP_LEVEL_FIELD] = groupItem[GROUP_LEVEL_FIELD] + 1;
                    return n;
                }));
                groupItem.rows = items;
                results = results.concat(items);
            }
            if (_this._state.groupFooter) {
                /** @type {?} */
                var footerItem = (_b = {},
                    _b[IS_GROUP_FOOTER_ROW_FIELD] = true,
                    _b[GROUP_ROW_FIELD] = groupItem[idfield],
                    _b[GROUP_VISIBLE_FIELD] = expandGroupRows,
                    _b[GROUP_LEVEL_FIELD] = initLevel,
                    _b.data = {},
                    _b);
                groupItem.rows.push(footerItem);
                results.push(footerItem);
            }
        }));
        return results;
    };
    /** 更新分组合计行数据 */
    /**
     * 更新分组合计行数据
     * @private
     * @param {?} groupFooterRow
     * @param {?} columns
     * @param {?} groupRows
     * @return {?}
     */
    DatagridFacadeService.prototype.updateGroupFooterData = /**
     * 更新分组合计行数据
     * @private
     * @param {?} groupFooterRow
     * @param {?} columns
     * @param {?} groupRows
     * @return {?}
     */
    function (groupFooterRow, columns, groupRows) {
        var _this = this;
        columns.forEach((/**
         * @param {?} col
         * @return {?}
         */
        function (col) {
            if (col.groupFooter && col.groupFooter.options) {
                /** @type {?} */
                var options = col.groupFooter.options;
                /** @type {?} */
                var text = options.text;
                /** @type {?} */
                var typ = (/** @type {?} */ (options.calculationType));
                if (typ !== undefined && typ != -1) {
                    /** @type {?} */
                    var val = _this.calculation(groupRows, typ, col);
                    groupFooterRow.data[col.field] = val;
                }
                else {
                    groupFooterRow.data[col.field] = text || '';
                }
            }
            else {
                groupFooterRow.data[col.field] = '';
            }
        }));
    };
    /** 多字段分组
     * groupField 以逗号分隔，从左到右依次进行分组
     */
    /**
     * 多字段分组
     * groupField 以逗号分隔，从左到右依次进行分组
     * @private
     * @param {?} data
     * @return {?}
     */
    DatagridFacadeService.prototype.groupRows2 = /**
     * 多字段分组
     * groupField 以逗号分隔，从左到右依次进行分组
     * @private
     * @param {?} data
     * @return {?}
     */
    function (data) {
        var _this = this;
        if (data && data.length) {
            /** @type {?} */
            var columns_1 = this._state.flatColumns;
            /** @type {?} */
            var groupField = this._state.groupField || '';
            if (!groupField) {
                return data;
            }
            /** @type {?} */
            var groupData = this.arrToGroup(data, groupField.split(','));
            /** @type {?} */
            var result_1 = this.groupRows2Flat(groupData, 0, null);
            /** @type {?} */
            var k_1 = 0;
            /** @type {?} */
            var prow_1 = (/**
             * @param {?} pid
             * @return {?}
             */
            function (pid) { return result_1.find((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n[_this._state.idField] === pid; })); });
            result_1.map((/**
             * @param {?} n
             * @param {?} i
             * @return {?}
             */
            function (n, i) {
                if (!n[IS_GROUP_ROW_FIELD] && !n[IS_GROUP_FOOTER_ROW_FIELD]) {
                    n[ROW_INDEX_FIELD] = k_1;
                    k_1++;
                }
                // 更新合计行数据
                if (n[IS_GROUP_FOOTER_ROW_FIELD]) {
                    /** @type {?} */
                    var rows = prow_1(n[GROUP_ROW_FIELD]).rows.filter((/**
                     * @param {?} r
                     * @return {?}
                     */
                    function (r) { return !r[IS_GROUP_ROW_FIELD] && !r[IS_GROUP_FOOTER_ROW_FIELD]; }));
                    _this.updateGroupFooterData(n, columns_1, rows);
                }
                return n;
            }));
            return result_1;
        }
        return [];
    };
    /**
     * @param {?} groupFooter
     * @return {?}
     */
    DatagridFacadeService.prototype.showGroupFooter = /**
     * @param {?} groupFooter
     * @return {?}
     */
    function (groupFooter) {
        this.updateState({ groupFooter: groupFooter }, false);
        this.updateVirthualRows(0);
    };
    /**
     * @param {?} groupRowId
     * @return {?}
     */
    DatagridFacadeService.prototype.updateGroupFooter = /**
     * @param {?} groupRowId
     * @return {?}
     */
    function (groupRowId) {
        var _this = this;
        /** @type {?} */
        var groupRow = this._state.virtual.virtualRows.find((/**
         * @param {?} n
         * @return {?}
         */
        function (n) {
            return n['id'] === groupRowId;
        }));
        if (groupRow) {
            /** @type {?} */
            var groupRows = groupRow.rows;
            /** @type {?} */
            var groupFooterRows = groupRows.filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n['__group_footer__']; }));
            /** @type {?} */
            var columns_2 = this._state.flatColumns;
            /** @type {?} */
            var rows_1 = groupRows.filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return !n['__group_footer__']; }));
            groupFooterRows.forEach((/**
             * @param {?} n
             * @return {?}
             */
            function (n) {
                _this.updateGroupFooterData(n, columns_2, rows_1);
            }));
        }
    };
    /**
     * @private
     * @param {?} data
     * @param {?} typ
     * @param {?} col
     * @return {?}
     */
    DatagridFacadeService.prototype.calculation = /**
     * @private
     * @param {?} data
     * @param {?} typ
     * @param {?} col
     * @return {?}
     */
    function (data, typ, col) {
        /** @type {?} */
        var val = '';
        // TFS: 357000
        // http://10.24.1.11:8080/tfs/GSP/GSPCloud/web/_queries?id=357000&triage=true&fullScreen=false&_a=edit
        if (!data || !data.length) {
            return '';
        }
        /** @type {?} */
        var field = col.field;
        /** @type {?} */
        var arr = data.map((/**
         * @param {?} o
         * @return {?}
         */
        function (o) { return Utils.getValue(field, o) || 0; }));
        switch (typ) {
            case CalculationType.sum:
                // val = sumBy(data, (o) => Utils.getValue(field, o));
                val = BigNumber.sum.apply(null, arr).toFixed();
                break;
            case CalculationType.max:
                // const maxObj = maxBy(data, (o) => Utils.getValue(field, o));
                // val = Utils.getValue(field, maxObj);
                val = BigNumber.max.apply(null, arr).toFixed();
                break;
            case CalculationType.min:
                // const minObj = minBy(data, (o) => Utils.getValue(field, o));
                // val = Utils.getValue(field, minObj);
                val = BigNumber.min.apply(null, arr).toFixed();
                break;
            case CalculationType.average:
                // val = meanBy(data, (o) => Utils.getValue(field, o));
                val = BigNumber.sum.apply(null, arr).div(arr.length).toFixed();
                break;
            case CalculationType.count:
                val = data.length;
                break;
        }
        return val;
    };
    /**
     * @param {?} row
     * @param {?} open
     * @param {?=} emit
     * @return {?}
     */
    DatagridFacadeService.prototype.setGroupRowsVisible = /**
     * @param {?} row
     * @param {?} open
     * @param {?=} emit
     * @return {?}
     */
    function (row, open, emit) {
        var _this = this;
        if (emit === void 0) { emit = true; }
        if (row.rows) {
            // if (!this._state.virtualized) {
            /** @type {?} */
            var groupRows = row.rows.filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n[IS_GROUP_ROW_FIELD]; }));
            /** @type {?} */
            var footerRows = row.rows.filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n[IS_GROUP_FOOTER_ROW_FIELD]; }));
            if (footerRows && footerRows.length) {
                footerRows.forEach((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) {
                    n[GROUP_VISIBLE_FIELD] = open && row.expanded;
                }));
            }
            groupRows.forEach((/**
             * @param {?} t
             * @return {?}
             */
            function (t) {
                t[GROUP_VISIBLE_FIELD] = open && row.expanded && row[GROUP_VISIBLE_FIELD];
                _this.setGroupRowsVisible(t, open, false);
            }));
            if (!groupRows.length) {
                row.rows.forEach((/**
                 * @param {?} t
                 * @return {?}
                 */
                function (t) {
                    t[GROUP_VISIBLE_FIELD] = open && row.expanded && row[GROUP_VISIBLE_FIELD];
                }));
            }
            // }
            // 触发行展开或折叠事件
            if (emit) {
                if (open) {
                    this.expandGroupRow.emit({ data: row });
                }
                else {
                    this.collapseGroupRow.emit({ data: row });
                }
            }
        }
    };
    //#region 组件初始属性
    //#region 组件初始属性
    /**
     * @param {?} opts
     * @return {?}
     */
    DatagridFacadeService.prototype.setinitialOptions = 
    //#region 组件初始属性
    /**
     * @param {?} opts
     * @return {?}
     */
    function (opts) {
        this._state.initialOptions = {};
        // 分组
        this._state.initialOptions['groupField'] = opts.groupField;
        // 排序
        this._state.initialOptions['sort'] = {
            sortName: opts.sortName,
            sortOrder: opts.sortOrder
        };
        // 列显示隐藏、对齐方式
        if (opts.columns && opts.columns[0]) {
            this._state.initialOptions['columnFields'] = ((/** @type {?} */ (opts.columns[0]))).map((/**
             * @param {?} n
             * @return {?}
             */
            function (n) {
                return {
                    width: n.width || 100,
                    field: n.field,
                    halign: n.halign,
                    align: n.align,
                    visible: n.visible,
                    footer: cloneDeep(n.footer || {}),
                    groupFooter: cloneDeep(n.groupFooter || {})
                };
            }));
        }
    };
    DatagridFacadeService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    DatagridFacadeService.ctorParameters = function () { return [
        { type: HttpClient }
    ]; };
    return DatagridFacadeService;
}());
export { DatagridFacadeService };
if (false) {
    /** @type {?} */
    DatagridFacadeService.prototype.localId;
    /**
     * @type {?}
     * @protected
     */
    DatagridFacadeService.prototype._state;
    /** @type {?} */
    DatagridFacadeService.prototype.store;
    /** @type {?} */
    DatagridFacadeService.prototype.virtualRowSubject;
    /** @type {?} */
    DatagridFacadeService.prototype.gridSizeSubject;
    /** @type {?} */
    DatagridFacadeService.prototype.errorSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.selectRowSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.unSelectRowSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.columnResizeSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.clearSelectionSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.checkRowSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.unCheckRowSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.clearCheckedsSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.clearAllSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.checkAllSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.unCheckAllSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.selectAllSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.selectCellSubject;
    /** @type {?} */
    DatagridFacadeService.prototype.error$;
    /** @type {?} */
    DatagridFacadeService.prototype.selectRow$;
    /** @type {?} */
    DatagridFacadeService.prototype.unSelectRow$;
    /** @type {?} */
    DatagridFacadeService.prototype.columnResize$;
    /** @type {?} */
    DatagridFacadeService.prototype.clearSelections$;
    /** @type {?} */
    DatagridFacadeService.prototype.checkRow$;
    /** @type {?} */
    DatagridFacadeService.prototype.unCheckRow$;
    /** @type {?} */
    DatagridFacadeService.prototype.clearCheckeds$;
    /** @type {?} */
    DatagridFacadeService.prototype.clearAll$;
    /** @type {?} */
    DatagridFacadeService.prototype.checkAll$;
    /** @type {?} */
    DatagridFacadeService.prototype.unCheckAll$;
    /** @type {?} */
    DatagridFacadeService.prototype.selectAll$;
    /** @type {?} */
    DatagridFacadeService.prototype.currentCell$;
    /** @type {?} */
    DatagridFacadeService.prototype.editCell$;
    /** @type {?} */
    DatagridFacadeService.prototype.clientSort$;
    /** @type {?} */
    DatagridFacadeService.prototype.rowAppend$;
    /** @type {?} */
    DatagridFacadeService.prototype.rowUpdate$;
    /** @type {?} */
    DatagridFacadeService.prototype.rowDelete$;
    /** @type {?} */
    DatagridFacadeService.prototype.expandGroupRow;
    /** @type {?} */
    DatagridFacadeService.prototype.collapseGroupRow;
    /** @type {?} */
    DatagridFacadeService.prototype.updateCheckboxState$;
    /** @type {?} */
    DatagridFacadeService.prototype.state$;
    /** @type {?} */
    DatagridFacadeService.prototype.columnGroup$;
    /** @type {?} */
    DatagridFacadeService.prototype.gridSize$;
    /** @type {?} */
    DatagridFacadeService.prototype.data$;
    /** @type {?} */
    DatagridFacadeService.prototype.difference;
    /** @type {?} */
    DatagridFacadeService.prototype.differenceBy;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.http;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YWdyaWQtZmFjYWRlLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWRhdGFncmlkLyIsInNvdXJjZXMiOlsibGliL3NlcnZpY2VzL2RhdGFncmlkLWZhY2FkZS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFTQSxPQUFPLEVBQUUsVUFBVSxFQUFFLFlBQVksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN6RCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDbEQsT0FBTyxFQUFFLGVBQWUsRUFBYyxFQUFFLEVBQVMsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ3ZFLE9BQU8sRUFBRSxHQUFHLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBcUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUNqSCxPQUFPLEVBQTJCLGVBQWUsRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUNwRSxPQUFPLEVBQXVCLGlCQUFpQixFQUN2QixlQUFlLEVBQUUsa0JBQWtCLEVBQUUsZUFBZSxFQUFFLHlCQUF5QixFQUFFLG1CQUFtQixFQUFFLGlCQUFpQixFQUFFLE1BQU0sU0FBUyxDQUFDO0FBR2pLLE9BQU8sRUFBRSxTQUFTLEVBQUUsT0FBTyxFQUErQixhQUFhLEVBQUUsT0FBTyxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBQ3BHLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUN2QyxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUNsRSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sY0FBYyxDQUFDO0FBQ3pDO0lBNEZJLCtCQUFvQixJQUFnQjtRQUFoQixTQUFJLEdBQUosSUFBSSxDQUFZO1FBekZwQyxZQUFPLEdBQUcsUUFBUSxDQUFDOztRQUtuQixVQUFLLEdBQUcsSUFBSSxlQUFlLENBQXNCLElBQUksQ0FBQyxDQUFDO1FBRXZELHNC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QUd0QyxzQ0FBdUQ7O0lBRXZELGtEQUFtRDs7SUFDbkQsZ0RBQXFDOztJQUNyQyw2Q0FBNkI7Ozs7O0lBQzdCLGlEQUE4Qzs7Ozs7SUFDOUMsbURBQWdEOzs7OztJQUNoRCxvREFBaUQ7Ozs7O0lBQ2pELHNEQUE4Qzs7Ozs7SUFDOUMsZ0RBQTZDOzs7OztJQUM3QyxrREFBK0M7Ozs7O0lBQy9DLHFEQUFrRDs7Ozs7SUFDbEQsZ0RBQTZDOzs7OztJQUM3QyxnREFBd0M7Ozs7O0lBQ3hDLGtEQUEyQzs7Ozs7SUFDM0MsaURBQXlDOzs7OztJQUN6QyxrREFBMEM7O0lBRTFDLHVDQUEwQzs7SUFDMUMsMkNBQWtEOztJQUNsRCw2Q0FBdUQ7O0lBQ3ZELDhDQUF3RDs7SUFDeEQsaURBQTZEOztJQUM3RCwwQ0FBZ0Q7O0lBQ2hELDRDQUFvRDs7SUFDcEQsK0NBQTBEOztJQUMxRCwwQ0FBZ0Q7O0lBQ2hELDBDQUFnRDs7SUFDaEQsNENBQW9EOztJQUNwRCwyQ0FBa0Q7O0lBQ2xELDZDQUFxRDs7SUFDckQsMENBQStCOztJQUMvQiw0Q0FBaUM7O0lBQ2pDLDJDQUFnQzs7SUFDaEMsMkNBQWdDOztJQUNoQywyQ0FBZ0M7O0lBRWhDLCtDQUFxQzs7SUFDckMsaURBQXVDOztJQUV2QyxxREFBMEM7O0lBRTFDLHVDQUVFOztJQUVGLDZDQU9FOztJQUVGLDBDQU9FOztJQUVGLHNDQVlFOztJQUVGLDJDQUEyRjs7SUFDM0YsNkNBR0M7Ozs7O0lBRVcscUNBQXdCIiwic291cmNlc0NvbnRlbnQiOlsiLypcclxuICogQEF1dGhvcjog55av54uC56eA5omNKEx1Y2FzIEh1YW5nKVxyXG4gKiBARGF0ZTogMjAxOS0wOC0wNiAwNzo0Mzo1M1xyXG4gKiBATGFzdEVkaXRvcnM6IOeWr+eLguengOaJjShMdWNhcyBIdWFuZylcclxuICogQExhc3RFZGl0VGltZTogMjAxOS0xMS0yMCAwNzozOTo0NVxyXG4gKiBAUVE6IDEwNTU4MTgyMzlcclxuICogQFZlcnNpb246IHYwLjAuMVxyXG4gKi9cclxuXHJcbmltcG9ydCB7IEluamVjdGFibGUsIEV2ZW50RW1pdHRlciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBIdHRwQ2xpZW50IH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xyXG5pbXBvcnQgeyBCZWhhdmlvclN1YmplY3QsIE9ic2VydmFibGUsIG9mLCBtZXJnZSwgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBtYXAsIGRpc3RpbmN0VW50aWxDaGFuZ2VkLCBmaWx0ZXIsIHN3aXRjaE1hcCwgYXVkaXRUaW1lLCBkZWJvdW5jZVRpbWUsIGRlYm91bmNlIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBEYXRhQ29sdW1uLCBDb2x1bW5Hcm91cCwgQ2FsY3VsYXRpb25UeXBlIH0gZnJvbSAnLi4vdHlwZXMnO1xyXG5pbXBvcnQgeyBGYXJyaXNEYXRhZ3JpZFN0YXRlLCBpbml0RGF0YUdyaWRTdGF0ZSwgRGF0YVJlc3VsdCwgQ2VsbEluZm8sIFZpcnR1YWxpemVkU3RhdGUsIFNlbGVjdGVkUm93LFxyXG4gICAgICAgIFJvd0RhdGFDaGFuZ2VzLCBST1dfSU5ERVhfRklFTEQsIElTX0dST1VQX1JPV19GSUVMRCwgR1JPVVBfUk9XX0ZJRUxELCBJU19HUk9VUF9GT09URVJfUk9XX0ZJRUxELCBHUk9VUF9WSVNJQkxFX0ZJRUxELCBHUk9VUF9MRVZFTF9GSUVMRCB9IGZyb20gJy4vc3RhdGUnO1xyXG5pbXBvcnQgeyBWaXJ0dWFsaXplZExvYWRlclNlcnZpY2UgfSBmcm9tICcuL3ZpcnR1YWxpemVkLWxvYWRlci5zZXJ2aWNlJztcclxuaW1wb3J0IHsgRGF0YWdyaWRSb3cgfSBmcm9tICcuLi90eXBlcy9kYXRhZ3JpZC1yb3cnO1xyXG5pbXBvcnQgeyBjbG9uZURlZXAsIGdyb3VwQnksIHN1bUJ5LCBtYXhCeSwgbWluQnksIG1lYW5CeSwgaXNQbGFpbk9iamVjdCwgZmxhdHRlbiB9IGZyb20gJ2xvZGFzaC1lcyc7XHJcbmltcG9ydCB7IFV0aWxzIH0gZnJvbSAnLi4vdXRpbHMvdXRpbHMnO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZENvbHVtbnNIZWxwZXIgfSBmcm9tICcuL2RhdGFncmlkLWNvbHVtbnMuaGVscGVyJztcclxuaW1wb3J0IHsgQmlnTnVtYmVyIH0gZnJvbSAnYmlnbnVtYmVyLmpzJztcclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgRGF0YWdyaWRGYWNhZGVTZXJ2aWNlIHtcclxuXHJcbiAgICBsb2NhbElkID0gJ3poLUNIUyc7XHJcblxyXG4gICAgcHJvdGVjdGVkIF9zdGF0ZTogRmFycmlzRGF0YWdyaWRTdGF0ZTtcclxuICAgIC8vIHB1YmxpYyB2aXJ0dWFsaXplZFNlcnZpY2U6IFZpcnR1YWxpemVkTG9hZGVyU2VydmljZTtcclxuXHJcbiAgICBzdG9yZSA9IG5ldyBCZWhhdmlvclN1YmplY3Q8RmFycmlzRGF0YWdyaWRTdGF0ZT4obnVsbCk7XHJcblxyXG4gICAgdmlydHVhbFJvd1N1YmplY3QgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PGFueT4obnVsbCk7XHJcbiAgICBncmlkU2l6ZVN1YmplY3QgPSBuZXcgU3ViamVjdDxhbnk+KCk7XHJcbiAgICBlcnJvclN1YmplY3QgPSBuZXcgU3ViamVjdCgpO1xyXG4gICAgcHJpdmF0ZSBzZWxlY3RSb3dTdWJqZWN0ID0gbmV3IFN1YmplY3Q8YW55PigpO1xyXG4gICAgcHJpdmF0ZSB1blNlbGVjdFJvd1N1YmplY3QgPSBuZXcgU3ViamVjdDxhbnk+KCk7XHJcbiAgICBwcml2YXRlIGNvbHVtblJlc2l6ZVN1YmplY3QgPSBuZXcgU3ViamVjdDxhbnk+KCk7XHJcbiAgICBwcml2YXRlIGNsZWFyU2VsZWN0aW9uU3ViamVjdCA9IG5ldyBTdWJqZWN0KCk7XHJcbiAgICBwcml2YXRlIGNoZWNrUm93U3ViamVjdCA9IG5ldyBTdWJqZWN0PGFueT4oKTtcclxuICAgIHByaXZhdGUgdW5DaGVja1Jvd1N1YmplY3QgPSBuZXcgU3ViamVjdDxhbnk+KCk7XHJcbiAgICBwcml2YXRlIGNsZWFyQ2hlY2tlZHNTdWJqZWN0ID0gbmV3IFN1YmplY3Q8YW55PigpO1xyXG4gICAgcHJpdmF0ZSBjbGVhckFsbFN1YmplY3QgPSBuZXcgU3ViamVjdDxhbnk+KCk7XHJcbiAgICBwcml2YXRlIGNoZWNrQWxsU3ViamVjdCA9IG5ldyBTdWJqZWN0KCk7XHJcbiAgICBwcml2YXRlIHVuQ2hlY2tBbGxTdWJqZWN0ID0gIG5ldyBTdWJqZWN0KCk7XHJcbiAgICBwcml2YXRlIHNlbGVjdEFsbFN1YmplY3QgPSBuZXcgU3ViamVjdCgpO1xyXG4gICAgcHJpdmF0ZSBzZWxlY3RDZWxsU3ViamVjdCA9IG5ldyBTdWJqZWN0KCk7XHJcblxyXG4gICAgZXJyb3IkID0gdGhpcy5lcnJvclN1YmplY3QuYXNPYnNlcnZhYmxlKCk7XHJcbiAgICBzZWxlY3RSb3ckID0gdGhpcy5zZWxlY3RSb3dTdWJqZWN0LmFzT2JzZXJ2YWJsZSgpO1xyXG4gICAgdW5TZWxlY3RSb3ckID0gIHRoaXMudW5TZWxlY3RSb3dTdWJqZWN0LmFzT2JzZXJ2YWJsZSgpO1xyXG4gICAgY29sdW1uUmVzaXplJCA9IHRoaXMuY29sdW1uUmVzaXplU3ViamVjdC5hc09ic2VydmFibGUoKTtcclxuICAgIGNsZWFyU2VsZWN0aW9ucyQgPSB0aGlzLmNsZWFyU2VsZWN0aW9uU3ViamVjdC5hc09ic2VydmFibGUoKTtcclxuICAgIGNoZWNrUm93JCA9IHRoaXMuY2hlY2tSb3dTdWJqZWN0LmFzT2JzZXJ2YWJsZSgpO1xyXG4gICAgdW5DaGVja1JvdyQgPSB0aGlzLnVuQ2hlY2tSb3dTdWJqZWN0LmFzT2JzZXJ2YWJsZSgpO1xyXG4gICAgY2xlYXJDaGVja2VkcyQgPSB0aGlzLmNsZWFyQ2hlY2tlZHNTdWJqZWN0LmFzT2JzZXJ2YWJsZSgpO1xyXG4gICAgY2xlYXJBbGwkID0gdGhpcy5jbGVhckFsbFN1YmplY3QuYXNPYnNlcnZhYmxlKCk7XHJcbiAgICBjaGVja0FsbCQgPSB0aGlzLmNoZWNrQWxsU3ViamVjdC5hc09ic2VydmFibGUoKTtcclxuICAgIHVuQ2hlY2tBbGwkID0gdGhpcy51bkNoZWNrQWxsU3ViamVjdC5hc09ic2VydmFibGUoKTtcclxuICAgIHNlbGVjdEFsbCQgPSB0aGlzLnNlbGVjdEFsbFN1YmplY3QuYXNPYnNlcnZhYmxlKCk7XHJcbiAgICBjdXJyZW50Q2VsbCQgPSB0aGlzLnNlbGVjdENlbGxTdWJqZWN0LmFzT2JzZXJ2YWJsZSgpO1xyXG4gICAgZWRpdENlbGwkID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gICAgY2xpZW50U29ydCQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgICByb3dBcHBlbmQkID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gICAgcm93VXBkYXRlJCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIHJvd0RlbGV0ZSQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcblxyXG4gICAgZXhwYW5kR3JvdXBSb3cgPSAgbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gICAgY29sbGFwc2VHcm91cFJvdyA9ICBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcblxyXG4gICAgdXBkYXRlQ2hlY2tib3hTdGF0ZSQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcblxyXG4gICAgcmVhZG9ubHkgc3RhdGUkID0gdGhpcy5zdG9yZS5hc09ic2VydmFibGUoKS5waXBlKFxyXG4gICAgICAgIGZpbHRlciggKHN0YXRlOiBhbnkpID0+IHN0YXRlKVxyXG4gICAgKTtcclxuXHJcbiAgICByZWFkb25seSBjb2x1bW5Hcm91cCQgPSB0aGlzLmdyaWRTaXplU3ViamVjdC5hc09ic2VydmFibGUoKS5waXBlKFxyXG4gICAgICAgIGZpbHRlciggKHN0YXRlOiBhbnkpID0+IHN0YXRlKSxcclxuICAgICAgICBtYXAoKHN0YXRlOiBGYXJyaXNEYXRhZ3JpZFN0YXRlKSA9PiBzdGF0ZS5jb2x1bW5zR3JvdXApLFxyXG4gICAgICAgIHN3aXRjaE1hcCgoY29sZ3JvdXA6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gb2YoIGNvbGdyb3VwKTtcclxuICAgICAgICB9KSxcclxuICAgICAgICBkaXN0aW5jdFVudGlsQ2hhbmdlZCgpXHJcbiAgICApO1xyXG5cclxuICAgIGdyaWRTaXplJCA9IHRoaXMuZ3JpZFNpemVTdWJqZWN0LmFzT2JzZXJ2YWJsZSgpLnBpcGUoXHJcbiAgICAgICAgZmlsdGVyKCAoc3RhdGU6IGFueSkgPT4gc3RhdGUpLFxyXG4gICAgICAgIG1hcCgoc3RhdGU6IEZhcnJpc0RhdGFncmlkU3RhdGUpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgeyBoZWFkZXJIZWlnaHQsIHBhZ2VySGVpZ2h0LCB3aWR0aCwgY29sdW1uc0dyb3VwLCBoZWlnaHQsIHJvd0hlaWdodCB9ID0gey4uLnN0YXRlfTtcclxuICAgICAgICAgICAgcmV0dXJuIHsgaGVhZGVySGVpZ2h0LCBwYWdlckhlaWdodCwgd2lkdGgsIGNvbHVtbnNHcm91cCwgaGVpZ2h0LCByb3dIZWlnaHQgfTtcclxuICAgICAgICB9KSxcclxuICAgICAgICBkaXN0aW5jdFVudGlsQ2hhbmdlZCgpXHJcbiAgICApO1xyXG5cclxuICAgIHJlYWRvbmx5IGRhdGEkID0gdGhpcy52aXJ0dWFsUm93U3ViamVjdC5waXBlKFxyXG4gICAgICAgIGZpbHRlcih2cyA9PiB2cyksXHJcbiAgICAgICAgc3dpdGNoTWFwKCh2czogVmlydHVhbGl6ZWRTdGF0ZSkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gb2Yoe1xyXG4gICAgICAgICAgICAgICAgaW5kZXg6IHZzLnN0YXJ0SW5kZXggfHwgMCxcclxuICAgICAgICAgICAgICAgIHJvd3M6IHZzLnZpcnR1YWxSb3dzIHx8IFtdLFxyXG4gICAgICAgICAgICAgICAgdG9wOiB2cy50b3BIaWRlSGVpZ2h0LFxyXG4gICAgICAgICAgICAgICAgYm90dG9tOiB2cy5ib3R0b21IaWRlSGVpZ2h0LFxyXG4gICAgICAgICAgICAgICAgc2Nyb2xsaW5nOiB2cy5pc1Njcm9sbENoYW5nZVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KSxcclxuICAgICAgICBkaXN0aW5jdFVudGlsQ2hhbmdlZCgpXHJcbiAgICApO1xyXG5cclxuICAgIGRpZmZlcmVuY2UgPSAoZmlyc3Q6IGFueVtdLCBzZWNvbmQ6IGFueVtdKSA9PiBmaXJzdC5maWx0ZXIoaXRlbSA9PiAhc2Vjb25kLmluY2x1ZGVzKGl0ZW0pKTtcclxuICAgIGRpZmZlcmVuY2VCeSA9IChhLCBiLCBmbikgPT4ge1xyXG4gICAgICAgIGNvbnN0IHMgPSBuZXcgU2V0KGIubWFwKGZuKSk7XHJcbiAgICAgICAgcmV0dXJuIGEubWFwKGZuKS5maWx0ZXIoZWwgPT4gIXMuaGFzKGVsKSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBodHRwOiBIdHRwQ2xpZW50KSB7XHJcbiAgICAgICAgdGhpcy5fc3RhdGUgPSAgY2xvbmVEZWVwKGluaXREYXRhR3JpZFN0YXRlKTtcclxuICAgIH1cclxuXHJcbiAgICB1cGRhdGVWaXJ0aHVhbFJvd3Moc2Nyb2xsdG9wOiBudW1iZXIsIGlzU2Nyb2xsQ2hhbmdlID0gZmFsc2UpIHtcclxuICAgICAgICBjb25zdCB2aXJ0dWFsID0gdGhpcy5nZXRWaXJ0aHVhbFJvd3Moc2Nyb2xsdG9wKTtcclxuICAgICAgICB2aXJ0dWFsLmlzU2Nyb2xsQ2hhbmdlID0gaXNTY3JvbGxDaGFuZ2U7XHJcbiAgICAgICAgdGhpcy51cGRhdGVTdGF0ZSh7dmlydHVhbH0sIGZhbHNlKTtcclxuICAgICAgICB0aGlzLnZpcnR1YWxSb3dTdWJqZWN0Lm5leHQodmlydHVhbCk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0VmlydGh1YWxSb3dzKHNjcm9sbHRvcCk6IFZpcnR1YWxpemVkU3RhdGUge1xyXG4gICAgICAgIGlmIChzY3JvbGx0b3AgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICBzY3JvbGx0b3AgPSAwO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgZGF0YSA9ICB0aGlzLl9zdGF0ZS5kYXRhIHx8IFtdO1xyXG4gICAgICAgIGNvbnN0IHZpcnR1YWwgPSB7cm93SW5kZXg6IDAsIHZpcnR1YWxSb3dzOiBkYXRhLCB0b3BIaWRlSGVpZ2h0OiAwLCBib3R0b21IaWRlSGVpZ2h0OiAwIH07XHJcblxyXG4gICAgICAgIGlmIChkYXRhLmxlbmd0aCA9PT0gMCB8fCAodGhpcy5fc3RhdGUuYXV0b0hlaWdodCAmJiAhdGhpcy5fc3RhdGUuZ3JvdXBSb3dzKSkge1xyXG4gICAgICAgICAgICB2aXJ0dWFsLnZpcnR1YWxSb3dzID0gZGF0YTtcclxuICAgICAgICAgICAgcmV0dXJuIHZpcnR1YWw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5fc3RhdGUuZmxhdENvbHVtbnMgJiYgdGhpcy5fc3RhdGUuZmxhdENvbHVtbnMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIC8vIGRhdGEgPSB0aGlzLl9zdGF0ZS5kYXRhO1xyXG5cclxuICAgICAgICAgICAgLy8gaWYgKCF0aGlzLl9zdGF0ZS5ncm91cFJvd3MpIHtcclxuICAgICAgICAgICAgLy8gICAgIGlmICh0aGlzLl9zdGF0ZS52aXJ0dWFsICYmIHRoaXMuX3N0YXRlLnZpcnR1YWxpemVkKSB7XHJcbiAgICAgICAgICAgIC8vICAgICAgICAgdGhpcy52aXJ0dWFsaXplZFNlcnZpY2Uuc3RhdGUgPSB0aGlzLl9zdGF0ZTtcclxuICAgICAgICAgICAgLy8gICAgICAgICBjb25zdCByb3dzID0gdGhpcy52aXJ0dWFsaXplZFNlcnZpY2UuZ2V0Um93cyhzY3JvbGx0b3ApO1xyXG4gICAgICAgICAgICAvLyAgICAgICAgIHZpcnR1YWwgPSB7IC4uLnRoaXMuX3N0YXRlLnZpcnR1YWwsIC4uLnJvd3MgfTtcclxuICAgICAgICAgICAgLy8gICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vICAgICAgICAgdmlydHVhbC52aXJ0dWFsUm93cyA9IGRhdGE7XHJcbiAgICAgICAgICAgIC8vICAgICB9XHJcbiAgICAgICAgICAgIC8vIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vICAgICAvLyDooYzliIbnu4TmlbDmja7lpITnkIZcclxuICAgICAgICAgICAgLy8gICAgIGNvbnN0IGdyb3VwUm93cyA9IHRoaXMuZ3JvdXBSb3dzMihjbG9uZURlZXAoZGF0YSkpO1xyXG4gICAgICAgICAgICAvLyAgICAgdmlydHVhbC52aXJ0dWFsUm93cyA9IGdyb3VwUm93cztcclxuICAgICAgICAgICAgLy8gfVxyXG4gICAgICAgICAgICBpZiAodGhpcy5fc3RhdGUuZ3JvdXBSb3dzKSB7XHJcbiAgICAgICAgICAgICAgICAvLyDooYzliIbnu4TmlbDmja7lpITnkIZcclxuICAgICAgICAgICAgICAgIGNvbnN0IGdyb3VwUm93cyA9IHRoaXMuZ3JvdXBSb3dzMihjbG9uZURlZXAoZGF0YSkpO1xyXG4gICAgICAgICAgICAgICAgdmlydHVhbC52aXJ0dWFsUm93cyA9IGdyb3VwUm93cztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuX3N0YXRlLm1lcmdlQ2VsbCAmJiB0aGlzLl9zdGF0ZS5lbmFibGVDbGllbnRTb3J0Rm9yTWVyZ2VDZWxsKSB7XHJcbiAgICAgICAgICAgIHZpcnR1YWwudmlydHVhbFJvd3MgPSB0aGlzLnNvcnQodmlydHVhbC52aXJ0dWFsUm93cyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gdmlydHVhbDtcclxuICAgIH1cclxuXHJcbiAgICBnZXREYXRhKG9yaWdpbmFsID0gZmFsc2UpIHtcclxuICAgICAgICBpZiAob3JpZ2luYWwpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3N0YXRlLm9yaWdpbmFsRGF0YSB8fCBbXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3N0YXRlLmRhdGEgfHwgW107XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0U3RhdGUoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3N0YXRlO1xyXG4gICAgfVxyXG5cclxuICAgIGdldFZpcnR1YWxTdGF0ZSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fc3RhdGUudmlydHVhbDtcclxuICAgIH1cclxuXHJcbiAgICBnZXRQYWdlSW5mbygpIHtcclxuICAgICAgICBjb25zdCB7IHBhZ2VJbmRleCwgcGFnZVNpemUgfSA9IHsuLi50aGlzLl9zdGF0ZX07XHJcbiAgICAgICAgcmV0dXJuIHsgcGFnZUluZGV4LCBwYWdlU2l6ZSB9O1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBpbml0U3RhdGUoc3RhdGU6IFBhcnRpYWw8RmFycmlzRGF0YWdyaWRTdGF0ZT4pIHtcclxuICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlKHN0YXRlLCBmYWxzZSk7XHJcbiAgICAgICAgdGhpcy5fc3RhdGUub3JpZ2luYWxEYXRhID0gY2xvbmVEZWVwKHRoaXMuX3N0YXRlLmRhdGEpO1xyXG4gICAgICAgIHRoaXMuaW5pdENvbHVtbnMoKTtcclxuXHJcbiAgICAgICAgdGhpcy5ncmlkU2l6ZVN1YmplY3QubmV4dCh0aGlzLl9zdGF0ZSk7XHJcbiAgICAgICAgdGhpcy51cGRhdGVWaXJ0aHVhbFJvd3MoMCk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIC8qKiDliqDovb3mlbDmja5cclxuICAgICAqIEBwYXJhbSBkYXRhOiDmlbDmja7liJfooahcclxuICAgICAqIEBwYXJhbSB1cGRhdGVPcmlnaW5hbERhdGEg5piv5ZCm5pu05paw5Y6f5aeL5pWw5o2uLCDpu5jorqTkuLogdHJ1ZVxyXG4gICAgICovXHJcbiAgICBsb2FkRGF0YShkYXRhOiBhbnksIHVwZGF0ZU9yaWdpbmFsRGF0YSA9IHRydWUsIHNvcnRhYmxlID0gZmFsc2UpIHtcclxuICAgICAgICBkYXRhID0gZGF0YSB8fCBbXTtcclxuICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlKHsgZGF0YSB9LCBmYWxzZSk7XHJcblxyXG4gICAgICAgIGlmICh1cGRhdGVPcmlnaW5hbERhdGEpIHtcclxuICAgICAgICAgICAgdGhpcy5fc3RhdGUub3JpZ2luYWxEYXRhID0gY2xvbmVEZWVwKHRoaXMuX3N0YXRlLmRhdGEpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoc29ydGFibGUgJiYgdGhpcy5fc3RhdGUuc29ydE5hbWUpIHtcclxuICAgICAgICAgICAgY29uc3Qgc29ydGVkRGF0YSA9IHRoaXMuc29ydCh0aGlzLl9zdGF0ZS5kYXRhKTtcclxuICAgICAgICAgICAgdGhpcy51cGRhdGVTdGF0ZSh7IGRhdGE6IHNvcnRlZERhdGEgfSwgZmFsc2UpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIHRoaXMudXBkYXRlU3RhdGUoeyBkYXRhOiB0aGlzLl9zdGF0ZS5vcmlnaW5hbERhdGEgfSwgZmFsc2UpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy51cGRhdGVWaXJ0aHVhbFJvd3ModGhpcy5fc3RhdGUudmlydHVhbC5zY3JvbGxUb3AgfHwgMCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIOWkjeWOn+aMh+WumuihjOeahOaVsOaNriAqL1xyXG4gICAgcmVzZXRSb3cocm93SWQ6IGFueSkge1xyXG4gICAgICAgIGNvbnN0IG9yaWdEYXRhID0gdGhpcy5fc3RhdGUub3JpZ2luYWxEYXRhO1xyXG4gICAgICAgIGlmIChvcmlnRGF0YSkge1xyXG4gICAgICAgICAgICBjb25zdCBvcmlnUm93RGF0YSA9IG9yaWdEYXRhLmZpbmQociA9PiB0aGlzLnByaW1hcnlJZChyKSA9PT0gcm93SWQpO1xyXG4gICAgICAgICAgICB0aGlzLmdldEN1cnJlbnRSb3coKS5kYXRhID0gY2xvbmVEZWVwKG9yaWdSb3dEYXRhKTtcclxuICAgICAgICAgICAgdGhpcy51cGRhdGVSb3cocm93SWQsIG9yaWdSb3dEYXRhKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gbG9hZERhdGFGb3JWaXJ0dWFsKGRhdGE6IGFueSkge1xyXG4gICAgLy8gICAgIHRoaXMudXBkYXRlU3RhdGUoeyBkYXRhIH0sIGZhbHNlKTtcclxuICAgIC8vICAgICAvLyB0aGlzLnZpcnR1YWxpemVkU2VydmljZS5zdGF0ZSA9IHRoaXMuX3N0YXRlO1xyXG4gICAgLy8gICAgIGNvbnN0IHZpcnR1YWwgPSB7IC4uLnRoaXMuX3N0YXRlLnZpcnR1YWwsIC4uLnRoaXMudmlydHVhbGl6ZWRTZXJ2aWNlLnJlbG9hZCgpIH07XHJcbiAgICAvLyAgICAgdGhpcy52aXJ0dWFsUm93U3ViamVjdC5uZXh0KHZpcnR1YWwpO1xyXG4gICAgLy8gICAgIHRoaXMudXBkYXRlU3RhdGUoe3ZpcnR1YWx9KTtcclxuICAgIC8vIH1cclxuXHJcbiAgICBmZXRjaERhdGEodXJsOiBzdHJpbmcpOiBPYnNlcnZhYmxlPERhdGFSZXN1bHQ+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5odHRwLmdldCh1cmwpLnBpcGUoXHJcbiAgICAgICAgICAgIG1hcCggciA9PiByIGFzIERhdGFSZXN1bHQgKVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0VG90YWwodG90YWw6IG51bWJlcikge1xyXG4gICAgICAgIHRoaXMudXBkYXRlU3RhdGUoIHt0b3RhbH0sIGZhbHNlICk7XHJcbiAgICB9XHJcblxyXG4gICAgdXBkYXRlUHJvcGVydHkocHJvcGVydHk6IHN0cmluZywgdmFsdWU6IGFueSkge1xyXG4gICAgICAgIHRoaXMudXBkYXRlU3RhdGUoeyBbcHJvcGVydHldOiB2YWx1ZSB9LCBmYWxzZSk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0UGFnaW5hdGlvbihwYWdlSW5kZXg6IG51bWJlciwgcGFnZVNpemU6IG51bWJlciwgdG90YWw6IG51bWJlcikge1xyXG4gICAgICAgIHRoaXMudXBkYXRlU3RhdGUoIHsgcGFnZUluZGV4LCBwYWdlU2l6ZSwgdG90YWwgfSwgZmFsc2UpO1xyXG4gICAgfVxyXG5cclxuICAgIHNldFNjcm9sbFRvcChzY3JvbGxUb3A6IG51bWJlcikge1xyXG4gICAgICAgIGNvbnN0IHZpcnR1YWwgPSB7IC4uLnRoaXMuX3N0YXRlLnZpcnR1YWwsIHNjcm9sbFRvcH07XHJcbiAgICAgICAgdGhpcy51cGRhdGVTdGF0ZSh7dmlydHVhbH0sIGZhbHNlKTtcclxuICAgIH1cclxuXHJcbiAgICBpc011bHRpU2VsZWN0KCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9zdGF0ZS5tdWx0aVNlbGVjdDtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIF9pc1Jvd1NlbGVjdGVkKGlkOiBhbnkpIHtcclxuICAgICAgICBpZiAoIWlkIHx8ICF0aGlzLl9zdGF0ZS5jdXJyZW50Um93KSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fc3RhdGUuY3VycmVudFJvdy5pZC50b1N0cmluZygpID09PSBpZC50b1N0cmluZygpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBpc1Jvd1NlbGVjdGVkKGlkOiBhbnksIHNlbGVjdGlvbnMgPSBudWxsKSB7XHJcbiAgICAgICAgY29uc3QgZmxhZyA9IHRoaXMuX2lzUm93U2VsZWN0ZWQoaWQpO1xyXG4gICAgICAgIGlmICghdGhpcy5pc011bHRpU2VsZWN0KCkgfHwgdGhpcy5fc3RhdGUub25seVNlbGVjdFNlbGYpIHtcclxuICAgICAgICAgICByZXR1cm4gZmxhZztcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAoIXNlbGVjdGlvbnMpIHtcclxuICAgICAgICAgICAgICAgIHNlbGVjdGlvbnMgPSB0aGlzLl9zdGF0ZS5zZWxlY3Rpb25zO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5fY2FuQ2FuY2VsU2VsZWN0V2hlbk11bHRpKCkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmbGFnO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoIXNlbGVjdGlvbnMgfHwgc2VsZWN0aW9ucy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBzZWxlY3Rpb25zLmZpbmRJbmRleChzciA9PiBzci5pZCA9PSBpZCkgPiAtMTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBpc1Jvd0NoZWNrZWQoaWQ6IGFueSwgY2hlY2tlZHMgPSBudWxsKSB7XHJcbiAgICAgICAgaWYgKCFjaGVja2Vkcykge1xyXG4gICAgICAgICAgICBjaGVja2VkcyA9IHRoaXMuZ2V0Q2hlY2tlZHMoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCFpZCB8fCAhY2hlY2tlZHMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBjaGVja2Vkcy5maW5kSW5kZXgoc3IgPT4gc3IuaWQudG9TdHJpbmcoKSA9PT0gaWQudG9TdHJpbmcoKSkgPiAtMTtcclxuICAgIH1cclxuXHJcbiAgICBpc0NoZWNrQWxsKCkge1xyXG4gICAgICAgIGNvbnN0IGFsbFJvd3MgPSB0aGlzLmdldEFsbFJvd3NGb3JMaXZlKCkubWFwKHIgPT4gdGhpcy5wcmltYXJ5SWQocikpO1xyXG4gICAgICAgIGNvbnN0IGNoZWNrSWRzID0gdGhpcy5fc3RhdGUuY2hlY2tlZFJvd3MubWFwKHIgPT4gci5pZCk7XHJcbiAgICAgICAgaWYgKHRoaXMuZGlmZmVyZW5jZShhbGxSb3dzLCBjaGVja0lkcykubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTsgLy8gdGhpcy5fc3RhdGUuY2hlY2tlZFJvd3MubGVuZ3RoID09PSBhbGxSb3dzLmxlbmd0aDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0Q3VycmVudFBhZ2VDaGVja2VkcygpIHtcclxuICAgICAgICBjb25zdCBhbGxSb3dzID0gdGhpcy5nZXRBbGxSb3dzRm9yTGl2ZSgpLm1hcChyID0+IHRoaXMucHJpbWFyeUlkKHIpKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5fc3RhdGUuY2hlY2tlZFJvd3MuZmlsdGVyKG4gPT4gYWxsUm93cy5pbmRleE9mKG4uaWQpID4gLTEpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldEN1cnJlbnRSb3coKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3N0YXRlLmN1cnJlbnRSb3cgfHwgdW5kZWZpbmVkO1xyXG4gICAgfVxyXG5cclxuICAgIGdldFNlbGVjdGlvbnMoKSB7XHJcbiAgICAgICAgLy8g5aaC5p6c5pWw5o2u5rqQ5Y+Y5LqG77yM6ZyA6KaB6YeN5paw6K6h566XXHJcbiAgICAgICAgY29uc3QgZGF0YSA9IHRoaXMuX3N0YXRlLmRhdGE7XHJcbiAgICAgICAgaWYgKHRoaXMuX3N0YXRlLnNlbGVjdGlvbnMgJiYgdGhpcy5fc3RhdGUuc2VsZWN0aW9ucy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgaWYgKCFkYXRhIHx8ICFkYXRhLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fc3RhdGUuc2VsZWN0aW9ucyA9IFtdO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdGVtcDogYW55W10gPSBkYXRhLm1hcChuID0+IHRoaXMucHJpbWFyeUlkKG4pKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3N0YXRlLnNlbGVjdGlvbnMgPSB0aGlzLl9zdGF0ZS5zZWxlY3Rpb25zLmZpbHRlcihuID0+IHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGVtcC5pbmNsdWRlcyhuLmlkKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLl9zdGF0ZS5zZWxlY3Rpb25zIHx8IFtdO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0Q2hlY2tlZFJvd3NGcm9tU291cmNlKCkge1xyXG4gICAgICAgIHJldHVybiAodGhpcy5fc3RhdGUuY2hlY2tlZFJvd3MgfHwgW10pLm1hcChuID0+IHtcclxuICAgICAgICAgICAgY29uc3QgZCA9IHRoaXMuZmluZFJvdyhuLmlkKTtcclxuICAgICAgICAgICAgaWYgKGQgJiYgZC5kYXRhKSB7XHJcbiAgICAgICAgICAgICAgICBuLmRhdGEgPSBkLmRhdGE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIG47XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0Q2hlY2tlZHMoZnJvbURhdGFTb3VyY2UgPSBmYWxzZSkge1xyXG4gICAgICAgIGlmIChmcm9tRGF0YVNvdXJjZSkge1xyXG4gICAgICAgICAgICB0aGlzLl9zdGF0ZS5jaGVja2VkUm93cyA9IHRoaXMuZ2V0Q2hlY2tlZFJvd3NGcm9tU291cmNlKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5fc3RhdGUuY2hlY2tlZFJvd3MgfHwgW107XHJcbiAgICB9XHJcblxyXG4gICAgdXBkYXRlQ2hlY2tlZERhdGEocm93aWQ6IGFueSwgcm93RGF0YTogeyBba2V5OiBzdHJpbmddOiBzdHJpbmcgfSkge1xyXG4gICAgICAgIGNvbnN0IGNoZWNrZWRzID0gdGhpcy5nZXRDaGVja2VkcygpO1xyXG4gICAgICAgIGlmIChjaGVja2Vkcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgY29uc3QgaXRlbSA9IGNoZWNrZWRzLmZpbmQobiA9PiB0aGlzLnByaW1hcnlJZChuKSA9PSByb3dpZCk7XHJcbiAgICAgICAgICAgIGlmIChpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICBPYmplY3Qua2V5cyhyb3dEYXRhKS5mb3JFYWNoKGsgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIFV0aWxzLnNldFZhbHVlKGssIHJvd0RhdGFba10sIGl0ZW0uZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzZXRDaGVja2VkUm93cyhpZHM6IHN0cmluZ1tdLCBjaGVja2VkID0gdHJ1ZSkge1xyXG4gICAgICAgIGlmIChpZHMgJiYgaWRzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBsZXQgY2hlY2tlZHMgPSB0aGlzLl9zdGF0ZS5jaGVja2VkUm93cyB8fCBbXTtcclxuXHJcbiAgICAgICAgICAgIGlkcy5mb3JFYWNoKGlkID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHJvdyA9IHRoaXMuZmluZFJvdyhpZCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2hlY2tlZCAmJiByb3cpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoICF0aGlzLmlzUm93Q2hlY2tlZChpZCwgY2hlY2tlZHMpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNyb3cgPSB7IGlkOiB0aGlzLnByaW1hcnlJZChyb3cuZGF0YSksIGRhdGE6IHJvdy5kYXRhLCBpbmRleDogcm93LmluZGV4IH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrZWRzLnB1c2goc3Jvdyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX3N0YXRlLmVuYWJsZU1vcmVQYWdlU2VsZWN0IHx8ICFjaGVja2VkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrZWRzID0gY2hlY2tlZHMuZmlsdGVyKHNyID0+IHNyLmlkICE9PSBpZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdGhpcy5fc3RhdGUuY2hlY2tlZFJvd3MgPSBjaGVja2VkcztcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLl9jbGVhckNoZWNrZWRzKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNoZWNrUmVjb3JkKGlkOiBhbnksIGNoZWNrZWQgPSB0cnVlKSB7XHJcbiAgICAgICAgaWYgKGlkKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJvdyA9IHRoaXMuZmluZFJvdyhpZCk7XHJcbiAgICAgICAgICAgIGlmIChyb3cpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHtpbmRleDogcm93SW5kZXgsIGRhdGE6IHJvd0RhdGF9ID0gey4uLnJvd307XHJcbiAgICAgICAgICAgICAgICBpZiAoY2hlY2tlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tSb3cocm93SW5kZXgsIHJvd0RhdGEpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnVuQ2hlY2tSb3cocm93SW5kZXgsIHJvd0RhdGEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5lcnJvclN1YmplY3QubmV4dChg5pyq5om+5YiwSUTkuLoke2lkfeeahOaVsOaNruOAgmApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5lcnJvclN1YmplY3QubmV4dChg5Y+C5pWwaWQg5LiN6IO95Li656m644CCYCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNoZWNrUm93KHJvd0luZGV4OiBudW1iZXIsIHJvd0RhdGE6IGFueSwgZ3JpZDogYW55ID0gbnVsbCkge1xyXG4gICAgICAgIGlmICghdGhpcy5fc3RhdGUubXVsdGlTZWxlY3QpIHtcclxuICAgICAgICAgICAgdGhpcy5fY2xlYXJDaGVja2VkcygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgaWQgPSB0aGlzLnByaW1hcnlJZChyb3dEYXRhKTtcclxuICAgICAgICBjb25zdCBjaGVja2VkcyA9IHRoaXMuX3N0YXRlLmNoZWNrZWRSb3dzIHx8IFtdO1xyXG5cclxuICAgICAgICBjb25zdCBzcm93ID0geyBpZCwgZGF0YTogcm93RGF0YSwgaW5kZXg6IHJvd0luZGV4IH07XHJcbiAgICAgICAgaWYgKGlkICYmICF0aGlzLmlzUm93Q2hlY2tlZChpZCwgY2hlY2tlZHMpKSB7XHJcbiAgICAgICAgICAgIGNoZWNrZWRzLnB1c2goc3Jvdyk7XHJcbiAgICAgICAgICAgIHRoaXMuX3N0YXRlLmNoZWNrZWRSb3dzID0gY2hlY2tlZHM7XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5fc3RhdGUuc2VsZWN0T25DaGVjaykge1xyXG4gICAgICAgICAgICAgICAgaWYgKGdyaWQgJiYgZ3JpZC5pbnN0YW5jZSAmJiBncmlkLmluc3RhbmNlLmJlZm9yZVNlbGVjdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGdyaWQuaW5zdGFuY2UuYmVmb3JlU2VsZWN0KHsgcm93SW5kZXgsIHJvd0RhdGEsIGdyaWRJbnN0YW5jZTogZ3JpZC5pbnN0YW5jZSB9KS5zdWJzY3JpYmUoKGUpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0Um93KHJvd0luZGV4LCByb3dEYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdFJvdyhyb3dJbmRleCwgcm93RGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMuY2hlY2tSb3dTdWJqZWN0Lm5leHQoc3Jvdyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnVwZGF0ZUNoZWNrYm94U3RhdGUkLmVtaXQoey4uLnNyb3csIGNoZWNrZWQ6IHRydWV9KTtcclxuICAgIH1cclxuXHJcbiAgICB1bkNoZWNrUm93KHJvd0luZGV4OiBudW1iZXIsIHJvd0RhdGE6IGFueSwgZ3JpZDogYW55ID0gbnVsbCkge1xyXG4gICAgICAgIGNvbnN0IGlkID0gdGhpcy5wcmltYXJ5SWQocm93RGF0YSk7XHJcbiAgICAgICAgbGV0IGNoZWNrZWRzID0gdGhpcy5fc3RhdGUuY2hlY2tlZFJvd3MgfHwgW107XHJcbiAgICAgICAgY29uc3Qgc3JvdyA9IHsgaWQsIGRhdGE6IHJvd0RhdGEsIGluZGV4OiByb3dJbmRleCB9O1xyXG4gICAgICAgIGlmICh0aGlzLmlzUm93Q2hlY2tlZChpZCwgY2hlY2tlZHMpKSB7XHJcbiAgICAgICAgICAgIGNoZWNrZWRzID0gY2hlY2tlZHMuZmlsdGVyKHNyID0+ICcnICsgc3IuaWQgIT09ICcnICsgaWQpO1xyXG4gICAgICAgICAgICB0aGlzLl9zdGF0ZS5jaGVja2VkUm93cyA9IGNoZWNrZWRzO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuX3N0YXRlLnNlbGVjdE9uQ2hlY2spIHtcclxuICAgICAgICAgICAgICAgIGlmIChncmlkICYmIGdyaWQuaW5zdGFuY2UgJiYgZ3JpZC5pbnN0YW5jZS5iZWZvcmVVbnNlbGVjdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGdyaWQuaW5zdGFuY2UuYmVmb3JlVW5zZWxlY3QoeyByb3dJbmRleCwgcm93RGF0YSwgZ3JpZEluc3RhbmNlOiBncmlkLmluc3RhbmNlIH0pLnN1YnNjcmliZSgoZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51blNlbGVjdFJvdyhyb3dJbmRleCwgcm93RGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSAge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudW5TZWxlY3RSb3cocm93SW5kZXgsIHJvd0RhdGEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLnVuQ2hlY2tSb3dTdWJqZWN0Lm5leHQoc3Jvdyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnVwZGF0ZUNoZWNrYm94U3RhdGUkLmVtaXQoey4uLnNyb3csIGNoZWNrZWQ6IGZhbHNlfSk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0Q3VycmVudFBhZ2VEYXRhKGRhdGE6IGFueSkge1xyXG4gICAgICAgIHRoaXMuX3N0YXRlLmN1cnJlbnRQYWdlRGF0YSA9IGRhdGE7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0Q3VycmVudFBhZ2VEYXRhKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9zdGF0ZS5jdXJyZW50UGFnZURhdGEgfHwgW107XHJcbiAgICB9XHJcblxyXG5cclxuICAgIC8qKiDojrflj5bmiYDmnInlj6/ku6Xmk43kvZznmoTooYwgKi9cclxuICAgIHByaXZhdGUgZ2V0QWxsUm93c0ZvckxpdmUoKSB7XHJcbiAgICAgICAgbGV0IGFsbERhdGEgPSB0aGlzLl9zdGF0ZS5kYXRhIHx8IFtdO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5fc3RhdGUucGFnaW5hdGlvbiAmJiAhdGhpcy5fc3RhdGUucGFnZXJPblNlcnZlcikge1xyXG4gICAgICAgICAgICAvLyDojrflj5blvZPliY3pobXmlbDmja5cclxuICAgICAgICAgICAgYWxsRGF0YSA9IHRoaXMuZ2V0Q3VycmVudFBhZ2VEYXRhKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyDmjpLpmaTmjonnpoHnlKjnmoTooYxcclxuICAgICAgICBpZiAodGhpcy5fc3RhdGUuZGlzYWJsZVJvdykge1xyXG4gICAgICAgICAgICBhbGxEYXRhID0gYWxsRGF0YS5maWx0ZXIoKG4sIGkpID0+ICF0aGlzLl9zdGF0ZS5kaXNhYmxlUm93KG4sIGkpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGFsbERhdGE7XHJcbiAgICB9XHJcblxyXG4gICAgY2hlY2tBbGwoKSB7XHJcbiAgICAgICAgdGhpcy5fc3RhdGUuY2hlY2tlZFJvd3MgPSB0aGlzLl9zdGF0ZS5jaGVja2VkUm93cyB8fCBbXTtcclxuICAgICAgICBjb25zdCBhbGxEYXRhID0gdGhpcy5nZXRBbGxSb3dzRm9yTGl2ZSgpO1xyXG4gICAgICAgIGNvbnN0IGFsbENoZWNrZWRzID0gYWxsRGF0YS5tYXAoIChyLCBpKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICBpZDogdGhpcy5wcmltYXJ5SWQociksXHJcbiAgICAgICAgICAgICAgICBpbmRleDogaSxcclxuICAgICAgICAgICAgICAgIGRhdGE6IHJcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaWYgKCF0aGlzLl9zdGF0ZS5jaGVja2VkUm93cy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgdGhpcy5fc3RhdGUuY2hlY2tlZFJvd3MgPSBhbGxDaGVja2VkcztcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zdCBfY2hlY2tlZHMgPSBbXTtcclxuICAgICAgICAgICAgYWxsQ2hlY2tlZHMuZm9yRWFjaChlbGVtZW50ID0+IHtcclxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5fc3RhdGUuY2hlY2tlZFJvd3MuZmluZChuID0+IG4uaWQgPT0gZWxlbWVudC5pZCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBfY2hlY2tlZHMucHVzaChlbGVtZW50KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLl9zdGF0ZS5jaGVja2VkUm93cyA9IHRoaXMuX3N0YXRlLmNoZWNrZWRSb3dzLmNvbmNhdChfY2hlY2tlZHMpO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGlmICh0aGlzLl9zdGF0ZS5zZWxlY3RPbkNoZWNrICYmICF0aGlzLl9zdGF0ZS5vbmx5U2VsZWN0U2VsZikge1xyXG4gICAgICAgICAgICB0aGlzLl9zdGF0ZS5zZWxlY3Rpb25zID0gW107XHJcbiAgICAgICAgICAgIHRoaXMuX3N0YXRlLnNlbGVjdGlvbnMgPSBhbGxEYXRhLm1hcCggKHIsIGkpID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWQ6IHRoaXMucHJpbWFyeUlkKHIpLFxyXG4gICAgICAgICAgICAgICAgICAgIGluZGV4OiBpLFxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IHJcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5jaGVja0FsbFN1YmplY3QubmV4dCh0aGlzLl9zdGF0ZS5jaGVja2VkUm93cyk7XHJcbiAgICB9XHJcblxyXG4gICAgc2VsZWN0QWxsKCkge1xyXG4gICAgICAgIHRoaXMuX3N0YXRlLnNlbGVjdGlvbnMgPSBbXTtcclxuXHJcbiAgICAgICAgY29uc3QgYWxsRGF0YSA9IHRoaXMuZ2V0QWxsUm93c0ZvckxpdmUoKTtcclxuXHJcbiAgICAgICAgdGhpcy5fc3RhdGUuc2VsZWN0aW9ucyA9IGFsbERhdGEubWFwKCAociwgaSkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgaWQ6IHRoaXMucHJpbWFyeUlkKHIpLFxyXG4gICAgICAgICAgICAgICAgaW5kZXg6IGksXHJcbiAgICAgICAgICAgICAgICBkYXRhOiByXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLl9zdGF0ZS5jaGVja09uU2VsZWN0KSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3N0YXRlLmNoZWNrZWRSb3dzID0gW107XHJcbiAgICAgICAgICAgIHRoaXMuX3N0YXRlLmNoZWNrZWRSb3dzID0gYWxsRGF0YS5tYXAoIChyLCBpKSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlkOiB0aGlzLnByaW1hcnlJZChyKSxcclxuICAgICAgICAgICAgICAgICAgICBpbmRleDogaSxcclxuICAgICAgICAgICAgICAgICAgICBkYXRhOiByXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuc2VsZWN0QWxsU3ViamVjdC5uZXh0KHRoaXMuX3N0YXRlLnNlbGVjdGlvbnMpO1xyXG4gICAgfVxyXG5cclxuICAgIGZpbmRSb3coaWQpOiB7aW5kZXg6IG51bWJlciwgZGF0YTogYW55fSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX3N0YXRlLmRhdGEgJiYgdGhpcy5fc3RhdGUuZGF0YS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgbGV0IGluZGV4ID0gLTE7XHJcbiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLl9zdGF0ZS5kYXRhLmZpbmQoIChuLCBpKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCByID0gdGhpcy5wcmltYXJ5SWQobikgPT0gaWQ7XHJcbiAgICAgICAgICAgICAgICBpZiAocikge1xyXG4gICAgICAgICAgICAgICAgICAgIGluZGV4ID0gaTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiByO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgaWYgKGluZGV4ID09PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHtpbmRleCwgZGF0YX07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIGZpbmRSb3dJbmRleChpZCkge1xyXG4gICAgICAgIGlmICh0aGlzLl9zdGF0ZS5kYXRhICYmIHRoaXMuX3N0YXRlLmRhdGEubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zdGF0ZS5kYXRhLmZpbmRJbmRleChuID0+IHRoaXMucHJpbWFyeUlkKG4pID09PSBpZCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiAtMTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog6K6+572u6YCJ5Lit6KGM77yM5LiN6Kem5Y+RZ3JpZCDpgInkuK3kuovku7bvvIzlj5bmtojpgInkuK3kuovku7ZcclxuICAgICAqL1xyXG4gICAgc2V0U2VsZWN0Um93KGlkOiBzdHJpbmcsIHNlbGVjdCA9IHRydWUsIGVtaXQgPSB0cnVlKSB7XHJcbiAgICAgICAgY29uc3Qgcm93ID0gdGhpcy5maW5kUm93KGlkKTtcclxuICAgICAgICBjb25zdCB7aW5kZXg6IHJvd0luZGV4LCBkYXRhOiByb3dEYXRhfSA9IHsuLi5yb3d9O1xyXG4gICAgICAgIGNvbnN0IHNyb3cgPSB7IGlkLCBkYXRhOiByb3dEYXRhLCBpbmRleDogcm93SW5kZXggfTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuaXNNdWx0aVNlbGVjdCgpKSB7XHJcbiAgICAgICAgICAgIGlmIChzZWxlY3QpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0Um93Rm9yTXVsdGkoc3JvdywgZmFsc2UsIGVtaXQpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy51blNlbGVjdFJvd0Zvck11bHRpKHNyb3csIGZhbHNlLCBlbWl0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgX3NyID0gc2VsZWN0ID8gc3JvdyA6IG51bGw7XHJcbiAgICAgICAgdGhpcy51cGRhdGVTdGF0ZSh7IGN1cnJlbnRSb3c6IF9zcn0sIGZhbHNlKTtcclxuICAgIH1cclxuXHJcbiAgICBzZWxlY3RSZWNvcmQoaWQ6IGFueSwgc2VsZWN0ID0gdHJ1ZSkge1xyXG4gICAgICAgIGlmIChpZCkge1xyXG4gICAgICAgICAgICBjb25zdCByb3cgPSB0aGlzLmZpbmRSb3coaWQpO1xyXG4gICAgICAgICAgICBpZiAocm93KSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB7aW5kZXg6IHJvd0luZGV4LCBkYXRhOiByb3dEYXRhfSA9IHsuLi5yb3d9O1xyXG4gICAgICAgICAgICAgICAgaWYgKHNlbGVjdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0Um93KHJvd0luZGV4LCByb3dEYXRhKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51blNlbGVjdFJvdyhyb3dJbmRleCwgcm93RGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmVycm9yU3ViamVjdC5uZXh0KGDmnKrmib7liLBJROS4uiR7aWR955qE5pWw5o2u44CCYCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmVycm9yU3ViamVjdC5uZXh0KGDlj4LmlbBpZCDkuI3og73kuLrnqbrjgIJgKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc2VsZWN0Um93KHJvd0luZGV4OiBudW1iZXIsIHJvd0RhdGE6IGFueSwgZ3JpZE9wdHMgPSBudWxsKSB7XHJcbiAgICAgICAgY29uc3QgaXNNdWx0aVNlbGVjdCA9IHRoaXMuaXNNdWx0aVNlbGVjdCgpO1xyXG4gICAgICAgIGNvbnN0IGlkID0gdGhpcy5wcmltYXJ5SWQocm93RGF0YSk7XHJcbiAgICAgICAgY29uc3Qgc3JvdyA9IHsgaWQsIGRhdGE6IHJvd0RhdGEsIGluZGV4OiByb3dJbmRleCB9O1xyXG5cclxuICAgICAgICBpZiAoIXRoaXMuaXNSb3dTZWxlY3RlZChpZCkgfHwgIXRoaXMuX3N0YXRlLmN1cnJlbnRSb3cpIHtcclxuICAgICAgICAgICAgaWYgKCFpc011bHRpU2VsZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlKHsgY3VycmVudFJvdzogc3JvdyB9LCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdFJvd1N1YmplY3QubmV4dCh0aGlzLl9zdGF0ZS5jdXJyZW50Um93KTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fc3RhdGUuc2hvd0NoZWNrYm94ICYmIHRoaXMuX3N0YXRlLmNoZWNrT25TZWxlY3QpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9zdGF0ZS5jaGVja2VkUm93cyA9IFsgc3JvdyBdO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoZ3JpZE9wdHMgJiYgZ3JpZE9wdHMuaW5zdGFuY2UgJiYgZ3JpZE9wdHMuaW5zdGFuY2UuYmVmb3JlQ2hlY2spIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ3JpZE9wdHMuaW5zdGFuY2UuYmVmb3JlQ2hlY2soeyByb3dJbmRleCwgcm93RGF0YSwgZ3JpZEluc3RhbmNlOiBncmlkT3B0cy5pbnN0YW5jZSB9KS5zdWJzY3JpYmUoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jaGVja1Jvd1N1YmplY3QubmV4dChzcm93KTsgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tSb3dTdWJqZWN0Lm5leHQoc3Jvdyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RSb3dGb3JNdWx0aShzcm93LCB0cnVlLCBncmlkT3B0cyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzZWxlY3RSb3dGb3JNdWx0aShzcm93OiB7IGlkOiBhbnksIGRhdGE6IGFueSwgaW5kZXg6IGFueSB9LCBlbWl0ID0gdHJ1ZSwgZ3JpZE9wdHMgPSBudWxsKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX3N0YXRlLm9ubHlTZWxlY3RTZWxmKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2NsZWFyU2VsZWN0aW9ucygpO1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlKHsgY3VycmVudFJvdzogc3Jvdywgc2VsZWN0aW9uczogW3Nyb3ddIH0sIGZhbHNlKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLl9zdGF0ZS5zZWxlY3Rpb25zID0gdGhpcy5fc3RhdGUuc2VsZWN0aW9ucyB8fCBbXTtcclxuICAgICAgICAgICAgdGhpcy5fc3RhdGUuc2VsZWN0aW9ucyA9IHRoaXMuX3N0YXRlLnNlbGVjdGlvbnMuZmlsdGVyKHNyID0+IHNyLmlkICE9PSBzcm93LmlkKTtcclxuICAgICAgICAgICAgdGhpcy5fc3RhdGUuc2VsZWN0aW9ucy5wdXNoKHNyb3cpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoZW1pdCkge1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdFJvd1N1YmplY3QubmV4dChzcm93KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLl9zdGF0ZS5jaGVja09uU2VsZWN0KSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2hlY2tSb3coc3Jvdy5pbmRleCwgc3Jvdy5kYXRhLCBncmlkT3B0cyk7ICAgICAgICBcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSB1blNlbGVjdFJvd0Zvck11bHRpKHNyb3c6IHsgaWQ6IGFueSwgZGF0YTogYW55LCBpbmRleDogYW55IH0sIGVtaXQgPSB0cnVlLCBncmlkT3B0cyA9IG51bGwpIHtcclxuICAgICAgICB0aGlzLl9zdGF0ZS5zZWxlY3Rpb25zID0gdGhpcy5fc3RhdGUuc2VsZWN0aW9ucy5maWx0ZXIoc3IgPT4gc3IuaWQgIT09IHNyb3cuaWQpO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5fY2FuQ2FuY2VsU2VsZWN0V2hlbk11bHRpKCkgfHwgKHRoaXMuX3N0YXRlLmN1cnJlbnRSb3cgJiYgdGhpcy5fc3RhdGUuY3VycmVudFJvdy5pZCA9PT0gc3Jvdy5pZCkpIHtcclxuICAgICAgICAgICAgdGhpcy51cGRhdGVTdGF0ZSh7IGN1cnJlbnRSb3c6IG51bGwgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5fc3RhdGUuY2hlY2tPblNlbGVjdCkge1xyXG4gICAgICAgICAgICB0aGlzLnVuQ2hlY2tSb3coc3Jvdy5pbmRleCwgc3Jvdy5kYXRhLCBncmlkT3B0cyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoZW1pdCkge1xyXG4gICAgICAgICAgICB0aGlzLnVuU2VsZWN0Um93U3ViamVjdC5uZXh0KHNyb3cpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcblxyXG4gICAgdW5TZWxlY3RSb3cocm93SW5kZXg6IG51bWJlciwgcm93RGF0YTogYW55LCBncmlkT3B0cyA9IG51bGwpIHtcclxuICAgICAgICBjb25zdCBpZCA9IHRoaXMucHJpbWFyeUlkKHJvd0RhdGEpO1xyXG4gICAgICAgIGNvbnN0IGlzTXVsdGlTZWxlY3QgPSB0aGlzLmlzTXVsdGlTZWxlY3QoKTtcclxuICAgICAgICBjb25zdCBzcm93ID0ge2lkLCBpbmRleDogcm93SW5kZXgsIGRhdGE6IHJvd0RhdGF9O1xyXG4gICAgICAgIGlmICghaXNNdWx0aVNlbGVjdCkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5fc3RhdGUuY3VycmVudFJvdykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVTdGF0ZSh7IGN1cnJlbnRSb3c6IG51bGwgfSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnVuU2VsZWN0Um93U3ViamVjdC5uZXh0KHNyb3cpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX3N0YXRlLnNob3dDaGVja2JveCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudW5DaGVja1Jvdyhzcm93LmluZGV4LCBzcm93LmRhdGEsIGdyaWRPcHRzKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMudW5TZWxlY3RSb3dGb3JNdWx0aShzcm93LCB0cnVlLCBncmlkT3B0cyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgX2NhbkNhbmNlbFNlbGVjdFdoZW5NdWx0aSgpIHtcclxuICAgICAgICByZXR1cm4gIXRoaXMuX3N0YXRlLmtlZXBTZWxlY3QgJiYgdGhpcy5fc3RhdGUub25seVNlbGVjdFNlbGY7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfY2xlYXJTZWxlY3Rpb25zKGV4Y2x1ZGVJZHM/OiBzdHJpbmdbXSkge1xyXG4gICAgICAgIHRoaXMuX3N0YXRlLmN1cnJlbnRSb3cgPSBudWxsO1xyXG5cclxuICAgICAgICBpZiAoIWV4Y2x1ZGVJZHMgfHwgIWV4Y2x1ZGVJZHMubGVuZ3RoICkge1xyXG4gICAgICAgICAgICB0aGlzLl9zdGF0ZS5zZWxlY3Rpb25zID0gW107XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5fc3RhdGUuc2VsZWN0aW9ucyA9IHRoaXMuX3N0YXRlLnNlbGVjdGlvbnMuZmlsdGVyKG4gPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGV4Y2x1ZGVJZHMuZmluZEluZGV4KGkgPT4gaSA9PSBuLmlkKSA+IC0xO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfY2xlYXJDaGVja2Vkcyhyb3dzID0gW10pIHtcclxuICAgICAgICBpZiAoIXJvd3MubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3N0YXRlLmNoZWNrZWRSb3dzID0gW107XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5fc3RhdGUuY2hlY2tlZFJvd3MgPSB0aGlzLl9zdGF0ZS5jaGVja2VkUm93cy5maWx0ZXIobiA9PiByb3dzLmZpbmRJbmRleChyID0+IHRoaXMucHJpbWFyeUlkKHIpID09PSBuLmlkKSA9PSAtMSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNsZWFyU2VsZWN0aW9ucyhleGNsdWRlSWRzPzogc3RyaW5nW10pIHtcclxuICAgICAgICBjb25zdCByb3dzID0gdGhpcy5fc3RhdGUuc2VsZWN0aW9ucztcclxuICAgICAgICBleGNsdWRlSWRzID0gZXhjbHVkZUlkcyB8fCBbXTtcclxuICAgICAgICB0aGlzLl9jbGVhclNlbGVjdGlvbnMoZXhjbHVkZUlkcyk7XHJcbiAgICAgICAgY29uc3QgdW5DaGVja1Jvd3MgPSByb3dzLmZpbHRlcihuID0+IGV4Y2x1ZGVJZHMuZmluZEluZGV4KGkgPT4gaSA9PSBuLmlkKSA9PSAtMSk7XHJcbiAgICAgICAgaWYgKHRoaXMuX3N0YXRlLmNoZWNrT25TZWxlY3QgfHwgKCF0aGlzLl9zdGF0ZS5tdWx0aVNlbGVjdCAmJiB0aGlzLl9zdGF0ZS5zaG93Q2hlY2tib3gpKSB7XHJcbiAgICAgICAgICAgIC8vIHRoaXMuX3N0YXRlLmNoZWNrZWRSb3dzID0gW107XHJcbiAgICAgICAgICAgIC8vIHRoaXMuY2xlYXJDaGVja2Vkc1N1YmplY3QubmV4dChyb3dzKTtcclxuICAgICAgICAgICAgdGhpcy5fc3RhdGUuY2hlY2tlZFJvd3MgPSB0aGlzLl9zdGF0ZS5jaGVja2VkUm93cy5maWx0ZXIobiA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gIXJvd3MuZmluZCh0MSA9PiB0MS5pZCA9PSBuLmlkICYmIGV4Y2x1ZGVJZHMuZmluZEluZGV4KGkgPT4gaSA9PSBuLmlkKSA9PSAtMSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB0aGlzLmNsZWFyQ2hlY2tlZHNTdWJqZWN0Lm5leHQodW5DaGVja1Jvd3MpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmNsZWFyU2VsZWN0aW9uU3ViamVjdC5uZXh0KHVuQ2hlY2tSb3dzKTtcclxuICAgIH1cclxuXHJcbiAgICBjbGVhckNoZWNrZWRzKGNsZWFyQWxsID0gdHJ1ZSkge1xyXG4gICAgICAgIGNvbnN0IHJvd3MgPSB0aGlzLmdldEFsbFJvd3NGb3JMaXZlKCk7XHJcbiAgICAgICAgY29uc3QgX3Jvd3MgPSBjbGVhckFsbCA/IFtdIDogcm93cztcclxuICAgICAgICB0aGlzLl9jbGVhckNoZWNrZWRzKF9yb3dzKTtcclxuICAgICAgICBpZiAodGhpcy5fc3RhdGUuc2VsZWN0T25DaGVjaykge1xyXG4gICAgICAgICAgIHRoaXMuX2NsZWFyU2VsZWN0aW9ucygpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmNsZWFyQ2hlY2tlZHNTdWJqZWN0Lm5leHQocm93cyk7XHJcbiAgICB9XHJcblxyXG4gICAgY2xlYXJBbGwoKSB7XHJcbiAgICAgICAgdGhpcy5fY2xlYXJDaGVja2VkcygpO1xyXG4gICAgICAgIHRoaXMuX2NsZWFyU2VsZWN0aW9ucygpO1xyXG4gICAgICAgIHRoaXMuY2xlYXJBbGxTdWJqZWN0Lm5leHQoKTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRNdWx0aVNlbGVjdChmbGFnOiBib29sZWFuKSB7XHJcbiAgICAgICAgdGhpcy5fc3RhdGUubXVsdGlTZWxlY3QgPSBmbGFnO1xyXG4gICAgfVxyXG5cclxuICAgIHNldENoZWNrT25TZWxlY3QoZmxhZzogYm9vbGVhbikge1xyXG4gICAgICAgIHRoaXMuX3N0YXRlLmNoZWNrT25TZWxlY3QgPSBmbGFnO1xyXG4gICAgfVxyXG5cclxuICAgIHNldFNlbGVjdE9uQ2hlY2soZmxhZzogYm9vbGVhbikge1xyXG4gICAgICAgIHRoaXMuX3N0YXRlLnNlbGVjdE9uQ2hlY2sgPSBmbGFnO1xyXG4gICAgfVxyXG5cclxuICAgIHNldEN1cnJlbnRDZWxsKGRyOiBEYXRhZ3JpZFJvdywgZmllbGQ6IHN0cmluZywgY2VsbEVsZW1lbnQ/OiBhbnksIGNlbGxSZWY/OiBhbnkgKSB7XHJcbiAgICAgICAgY29uc3QgeyByb3dJbmRleCwgcm93RGF0YSB9ID0gey4uLmRyfTtcclxuICAgICAgICBsZXQgY3VycmVudENlbGwgPSB7Li4udGhpcy5fc3RhdGUuY3VycmVudENlbGwsIHJvd0luZGV4LCByb3dEYXRhLCBmaWVsZCwgcm93SWQ6IHRoaXMucHJpbWFyeUlkKHJvd0RhdGEpLCBjZWxsRWxlbWVudCB9O1xyXG5cclxuICAgICAgICBpZiAoZmllbGQgIT09IHRoaXMuX3N0YXRlLkNvbnRyb2xQYW5lbEZlaWxkKSB7XHJcbiAgICAgICAgICAgIGlmIChjZWxsUmVmKSB7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50Q2VsbC5jZWxsUmVmID0gY2VsbFJlZjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGZpZWxkKSB7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50Q2VsbC5jb2x1bW4gPSB0aGlzLmdldENvbHVtbihmaWVsZCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGlzTGFzdFJvdyA9IHJvd0luZGV4ID09PSB0aGlzLmdldERhdGEoKS5sZW5ndGggLSAxO1xyXG4gICAgICAgICAgICBjdXJyZW50Q2VsbFsnbGFzdFJvdyddID0gaXNMYXN0Um93O1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGN1cnJlbnRDZWxsID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5fc3RhdGUuY3VycmVudENlbGwgPSBudWxsO1xyXG4gICAgICAgIHRoaXMudXBkYXRlU3RhdGUoe2N1cnJlbnRDZWxsfSwgZmFsc2UpO1xyXG4gICAgICAgIHRoaXMuc2VsZWN0Um93KHJvd0luZGV4LCByb3dEYXRhKTtcclxuICAgICAgICBpZiAodGhpcy5fc3RhdGUuY3VycmVudFJvdykge1xyXG4gICAgICAgICAgICB0aGlzLl9zdGF0ZS5jdXJyZW50Um93LmRyID0gZHI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuc2VsZWN0Q2VsbFN1YmplY3QubmV4dChjdXJyZW50Q2VsbCk7XHJcbiAgICB9XHJcblxyXG4gICAgY2FuY2VsU2VsZWN0Q2VsbCgpIHtcclxuICAgICAgICBpZiAodGhpcy5fc3RhdGUuY3VycmVudENlbGwpIHtcclxuICAgICAgICAgICAgdGhpcy5fc3RhdGUuY3VycmVudENlbGwgPSBudWxsO1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlKHtjdXJyZW50Q2VsbDogbnVsbH0sIGZhbHNlKTtcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RDZWxsU3ViamVjdC5uZXh0KG51bGwpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcmltYXJ5SWQocm93RGF0YTogYW55KSB7XHJcbiAgICAgICAgcmV0dXJuIHJvd0RhdGFbdGhpcy5fc3RhdGUuaWRGaWVsZF07XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0Q3VycmVudENlbGwoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3N0YXRlLmN1cnJlbnRDZWxsO1xyXG4gICAgfVxyXG5cclxuICAgIGVkaXRDZWxsKCkge1xyXG4gICAgICAgIGlmICh0aGlzLl9zdGF0ZS5jdXJyZW50Q2VsbCkge1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuX3N0YXRlLmN1cnJlbnRDZWxsLmlzRWRpdGluZykge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgY2VpID0geyAuLi50aGlzLl9zdGF0ZS5jdXJyZW50Q2VsbCwgaXNFZGl0aW5nOiB0cnVlIH07XHJcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlKHsgY3VycmVudENlbGw6IGNlaSB9LCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdENlbGxTdWJqZWN0Lm5leHQoY2VpKTtcclxuICAgICAgICAgICAgICAgIC8vIHRoaXMuZWRpdENlbGwkLm5leHQoY2VpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBlbmRFZGl0Q2VsbCgpIHtcclxuICAgICAgICBpZiAodGhpcy5fc3RhdGUuY3VycmVudENlbGwgJiYgdGhpcy5fc3RhdGUuY3VycmVudENlbGwuaXNFZGl0aW5nKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNlaSA9IHsgLi4udGhpcy5fc3RhdGUuY3VycmVudENlbGwsIGlzRWRpdGluZzogZmFsc2UgfTtcclxuICAgICAgICAgICAgdGhpcy51cGRhdGVTdGF0ZSh7IGN1cnJlbnRDZWxsOiBjZWkgfSwgZmFsc2UpO1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdENlbGxTdWJqZWN0Lm5leHQoY2VpKTtcclxuICAgICAgICAgICAgLy8gdGhpcy5lZGl0Q2VsbCQubmV4dChjZWkpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBhcHBlbmRSb3cocm93RGF0YTogYW55KSB7XHJcbiAgICAgICAgaWYgKHJvd0RhdGEgJiYgdGhpcy5wcmltYXJ5SWQocm93RGF0YSkpIHtcclxuICAgICAgICAgICAgY29uc3QgcGlkID0gdGhpcy5wcmltYXJ5SWQocm93RGF0YSk7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmZpbmRSb3dJbmRleChwaWQpID09PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fc3RhdGUuZGF0YS5wdXNoKHJvd0RhdGEpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbmV3RGF0YSA9IFsuLi50aGlzLl9zdGF0ZS5kYXRhXTtcclxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlU3RhdGUoe2RhdGE6IG5ld0RhdGF9LCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9zdGF0ZS5vcmlnaW5hbERhdGEgPSBjbG9uZURlZXAodGhpcy5fc3RhdGUuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlZnJlc2goKTtcclxuICAgICAgICAgICAgICAgIHRoaXMucm93QXBwZW5kJC5lbWl0KHJvd0RhdGEpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGDkuLvplK5JRCDlt7LlrZjlnKjvvIFJRDogJHtwaWR9YCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYOS4u+mUruagh+ivhuWtl+auteS4jeiDveS4uuepuuOAgmApO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB1cGRhdGVSb3cocm93aWQ6IGFueSwgcm93RGF0YTogYW55KSB7XHJcbiAgICAgICAgY29uc3Qgcm93ID0gdGhpcy5maW5kUm93KHJvd2lkKTtcclxuICAgICAgICBpZiAocm93ICYmIHJvdy5kYXRhKSB7XHJcbiAgICAgICAgICAgIGlmIChyb3dEYXRhKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMocm93RGF0YSk7XHJcbiAgICAgICAgICAgICAgICBrZXlzLmZvckVhY2goZmllbGQgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIFV0aWxzLnNldFZhbHVlKGZpZWxkLCByb3dEYXRhW2ZpZWxkXSwgcm93LmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAvLyDmm7TmlrDlt7Lli77pgInnmoTmlbDmja5cclxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlQ2hlY2tlZERhdGEocm93aWQsIHJvd0RhdGEpO1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgcm93VXBkYXRlUGFyYW0gPSB7Li4ucm93LCBrZXlJRDogcm93aWR9O1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yb3dVcGRhdGUkLmVtaXQocm93VXBkYXRlUGFyYW0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGRlbGV0ZVJvdyhyb3dpZCkge1xyXG4gICAgICAgIGNvbnN0IHJvdyA9IHRoaXMuZmluZFJvdyhyb3dpZCk7XHJcbiAgICAgICAgaWYgKHJvdykge1xyXG4gICAgICAgICAgICBjb25zdCBuZXdEYXRhID0gdGhpcy5yZW1vdmVSb3codGhpcy5fc3RhdGUuZGF0YSwgcm93aWQpO1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlKHtkYXRhOiBuZXdEYXRhfSwgZmFsc2UpO1xyXG4gICAgICAgICAgICB0aGlzLl9zdGF0ZS5vcmlnaW5hbERhdGEgPSBjbG9uZURlZXAodGhpcy5fc3RhdGUuZGF0YSk7XHJcbiAgICAgICAgICAgIHRoaXMucmVmcmVzaCgpO1xyXG4gICAgICAgICAgICB0aGlzLnJvd0RlbGV0ZSQuZW1pdChyb3dpZCk7XHJcbiAgICAgICAgICAgIHJldHVybiByb3c7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDku47mlbDnu4TkuK3liKDpmaTmjIflrprnmoRJRFxyXG4gICAgICogQHBhcmFtIGRhdGEg5pWw57uEXHJcbiAgICAgKiBAcGFyYW0gcm93SWQg6KaB5Yig6Zmk55qESURcclxuICAgICAqL1xyXG4gICAgcmVtb3ZlUm93KGRhdGEsIHJvd0lkKSB7XHJcbiAgICAgICAgY29uc3QgbmV3RGF0YSA9IGRhdGEuZmlsdGVyKG4gPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBpZCA9IHRoaXMucHJpbWFyeUlkKG4pO1xyXG4gICAgICAgICAgICByZXR1cm4gcm93SWQgIT09IGlkO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gbmV3RGF0YTtcclxuICAgIH1cclxuXHJcbiAgICBpc0NlbGxTZWxlY3RlZChjZWxsSW5mbzogQ2VsbEluZm8pIHtcclxuICAgICAgICBjb25zdCBjYyA9IHRoaXMuZ2V0Q3VycmVudENlbGwoKTtcclxuICAgICAgICBpZiAoIWNjKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAoIHRoaXMuX3N0YXRlLmN1cnJlbnRSb3cuaW5kZXggPT09IGNjLnJvd0luZGV4KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY2MuZmllbGQgPT09IGNlbGxJbmZvLmZpZWxkO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJvdGVjdGVkIHVwZGF0ZVN0YXRlKHN0YXRlOiBQYXJ0aWFsPEZhcnJpc0RhdGFncmlkU3RhdGU+LCBlbWl0ID0gdHJ1ZSkge1xyXG4gICAgICAgIGNvbnN0IG5ld1N0YXRlID0geyAuLi50aGlzLl9zdGF0ZSwgLi4uc3RhdGUgfTtcclxuICAgICAgICB0aGlzLl9zdGF0ZSA9IG5ld1N0YXRlO1xyXG4gICAgICAgIGlmIChlbWl0KSB7XHJcbiAgICAgICAgICAgIHRoaXMuc3RvcmUubmV4dCh0aGlzLl9zdGF0ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJlc2l6ZShuZXdTaXplPzoge3dpZHRoOiBudW1iZXIsIGhlaWdodDogbnVtYmVyLCBba2V5OiBzdHJpbmddOiBhbnl9KSB7XHJcbiAgICAgICAgaWYgKG5ld1NpemUpIHtcclxuICAgICAgICAgICAgdGhpcy51cGRhdGVTdGF0ZShuZXdTaXplLCBmYWxzZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMucmVzZXRDb2x1bW5zU2l6ZSgpO1xyXG4gICAgICAgIGlmICghdGhpcy5fc3RhdGUuZ3JvdXBSb3dzKSB7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlVmlydGh1YWxSb3dzKHRoaXMuX3N0YXRlLnZpcnR1YWwuc2Nyb2xsVG9wKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZml0Q29sdW1ucyhmaXQpIHtcclxuICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlKHtmaXRDb2x1bW5zOiBmaXR9LCBmYWxzZSk7XHJcbiAgICAgICAgLy8gY29uc3QgciA9IHRoaXMudXNlVXNlclNldENvbHVtblNpemUoKTtcclxuICAgICAgICAvLyB0aGlzLnNldEZpdENvbHVtbnNXaWR0aCh0aGlzLl9zdGF0ZS5jb2x1bW5zR3JvdXAsIHRydWUsIHIpO1xyXG4gICAgICAgIC8vIHRoaXMuZ3JpZFNpemVTdWJqZWN0Lm5leHQodGhpcy5fc3RhdGUpO1xyXG4gICAgICAgIHRoaXMucmVzZXRDb2x1bW5zU2l6ZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgdXNlVXNlclNldENvbHVtblNpemUoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX3N0YXRlLmF1dG9GaXRDb2x1bW5zKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGdyaWRXaWR0aCA9IHRoaXMuX3N0YXRlLndpZHRoO1xyXG4gICAgICAgICAgICBjb25zdCB1c2VyU2V0Q29sdW1uV2lkdGggPSB0aGlzLl9zdGF0ZS5jb2x1bW5zR3JvdXAub3JpZ2luYWxUb3RhbFdpZHRoO1xyXG4gICAgICAgICAgICByZXR1cm4gdXNlclNldENvbHVtbldpZHRoID4gZ3JpZFdpZHRoO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSByZXNldENvbHVtbnNTaXplKCkge1xyXG4gICAgICAgIGlmICh0aGlzLl9zdGF0ZS5maXRDb2x1bW5zKSB7XHJcbiAgICAgICAgICAgIC8vIDIwMjAwNDIxXHJcbiAgICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLnVzZVVzZXJTZXRDb2x1bW5TaXplKCk7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0Rml0Q29sdW1uc1dpZHRoKHRoaXMuX3N0YXRlLmNvbHVtbnNHcm91cCwgciwgcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZ3JpZFNpemVTdWJqZWN0Lm5leHQodGhpcy5fc3RhdGUpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5pu05paw5YiX6K6+572uXHJcbiAgICAgKiBAcGFyYW0gY29sdW1ucyDmlrDnmoTliJfpm4blkIhcclxuICAgICAqIEBwYXJhbSByZXN0aXR1dGUg5piv5ZCm6L+Y5Y6f5Yid5aeL5a695bqmIOm7mOiupOS4uiBmYWxzZVxyXG4gICAgICovXHJcbiAgICB1cGRhdGVDb2x1bW5zKGNvbHVtbnMsIHJlc3RpdHV0ZSA9IGZhbHNlLCBlbWl0ID0gZmFsc2UpIHtcclxuICAgICAgICB0aGlzLl9zdGF0ZS5jb2x1bW5zID0gY29sdW1ucztcclxuICAgICAgICB0aGlzLmluaXRDb2x1bW5zKGVtaXQsIHJlc3RpdHV0ZSk7XHJcbiAgICAgICAgdGhpcy5yZXNpemVDb2x1bW5zKHJlc3RpdHV0ZSk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGdldEdyb3VwQ29sdW1ucyhjb2x1bW5zKSB7XHJcbiAgICAgICAgbGV0IGFyciA9IFtdO1xyXG4gICAgICAgIGNvbnN0IGFsbENvbHMgPSB0aGlzLmdldEFsbEZsYXRDb2x1bW5zKCk7XHJcbiAgICAgICAgY29sdW1ucy5mb3JFYWNoKGMgPT4ge1xyXG4gICAgICAgICAgICBpZiAoIWMuY29sc3BhbiB8fCBjLmNvbHNwYW4gPT0gMSkgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIWFyci5maW5kKG4gPT4gbi5maWVsZCA9PT0gYy5maWVsZCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBhcnIucHVzaChjKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICBhcnIgPSBhcnIuY29uY2F0KHRoaXMuZ2V0R3JvdXBDb2x1bW5zKGFsbENvbHMuZmlsdGVyKG4gPT4gbi5wYXJlbnRJZCA9PSBjLmlkXHQpKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gYXJyO1xyXG4gICAgfVxyXG5cclxuXHJcblxyXG4gICAgaW5pdENvbHVtbnMoZW1pdCA9IGZhbHNlLCByZXN0Q29sdW1uV2lkdGggPSBmYWxzZSkge1xyXG4gICAgICAgIGNvbnN0IGNvbHVtbnMgPSB0aGlzLl9zdGF0ZS5mbGF0Q29sdW1ucztcclxuICAgICAgICBsZXQgY29sZ3JvdXA6IGFueSA9IHtcclxuICAgICAgICAgICAgbGVmdEZpeGVkOiBbXSxcclxuICAgICAgICAgICAgcmlnaHRGaXhlZDogW10sXHJcbiAgICAgICAgICAgIG5vcm1hbENvbHVtbnM6IFtdLFxyXG4gICAgICAgICAgICBjb2x1bW5zOiBbXVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgaWYgKGNvbHVtbnMgJiYgY29sdW1ucy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgY29uc3QgbGVmdEZpeGVkQ29scyA9IHRoaXMuZ2V0Rml4ZWRDb2xzKCdsZWZ0Jyk7XHJcbiAgICAgICAgICAgIGNvbnN0IHJpZ2h0Rml4ZWRDb2xzID0gdGhpcy5nZXRGaXhlZENvbHMoJ3JpZ2h0Jyk7XHJcbiAgICAgICAgICAgIGNvbnN0IG5vcm1hbENvbHMgPSB0aGlzLmdldEZpeGVkQ29scygpO1xyXG5cclxuICAgICAgICAgICAgY29sdW1ucy5mb3JFYWNoKGMgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFjLm9yaWdpbmFsV2lkdGgpIHtcclxuICAgICAgICAgICAgICAgICAgICBjLm9yaWdpbmFsV2lkdGggPSBjLndpZHRoO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzdENvbHVtbldpZHRoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGMud2lkdGggPSBjLm9yaWdpbmFsV2lkdGg7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGNvbGdyb3VwID0ge1xyXG4gICAgICAgICAgICAgICAgbGVmdEZpeGVkOiBsZWZ0Rml4ZWRDb2xzLFxyXG4gICAgICAgICAgICAgICAgcmlnaHRGaXhlZDogcmlnaHRGaXhlZENvbHMsXHJcbiAgICAgICAgICAgICAgICBub3JtYWxDb2x1bW5zOiBub3JtYWxDb2xzLFxyXG4gICAgICAgICAgICAgICAgY29sdW1uczogbGVmdEZpeGVkQ29scy5jb25jYXQobm9ybWFsQ29scykuY29uY2F0KHJpZ2h0Rml4ZWRDb2xzKVxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgdGhpcy5pbml0Q29sdW1uc1dpZHRoKGNvbGdyb3VwLCByZXN0Q29sdW1uV2lkdGgpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuX3N0YXRlLmZpdENvbHVtbnMpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2V0Rml0Q29sdW1uc1dpZHRoKGNvbGdyb3VwLCB0cnVlKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy51cGRhdGVTdGF0ZSh7IGNvbHVtbnNHcm91cDogY29sZ3JvdXAgfSwgZW1pdCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY29sZ3JvdXAubGVmdEZpeGVkV2lkdGggPSAwO1xyXG4gICAgICAgICAgICBjb2xncm91cC5yaWdodEZpeGVkV2lkdGggPSAwO1xyXG4gICAgICAgICAgICBjb2xncm91cC5ub3JtYWxXaWR0aCA9IDA7XHJcbiAgICAgICAgICAgIGNvbGdyb3VwLnRvdGFsV2lkdGggPSAwO1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlKHsgY29sdW1uc0dyb3VwOiBjb2xncm91cCB9LCBlbWl0KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0Q29sdW1uSW5kZXgoZmllbGQ6IHN0cmluZywgZml4ZWQ6ICdyaWdodCd8ICcnIHwgJ2xlZnQnIHwgJ2NlbnRlcicgPSAnJykge1xyXG4gICAgICAgIGNvbnN0IGNvbGdyb3VwID0gdGhpcy5fc3RhdGUuY29sdW1uc0dyb3VwO1xyXG4gICAgICAgIGlmICghZml4ZWQgfHwgdGhpcy5fc3RhdGUuZmFzdCkge1xyXG4gICAgICAgICAgICByZXR1cm4gY29sZ3JvdXAubm9ybWFsQ29sdW1ucy5maW5kSW5kZXgobiA9PiBuLmZpZWxkID09PSBmaWVsZCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKGZpeGVkID09PSAnbGVmdCcpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBjb2xncm91cC5sZWZ0Rml4ZWQuZmluZEluZGV4KG4gPT4gbi5maWVsZCA9PT0gZmllbGQpO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGZpeGVkID09PSAncmlnaHQnKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY29sZ3JvdXAucmlnaHRGaXhlZC5maW5kSW5kZXgobiA9PiBuLmZpZWxkID09PSBmaWVsZCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY29sdW1uUmVzaXplRW5kKCkge1xyXG4gICAgICAgIC8vIGNvbnN0IGNvbGdyb3VwID0gdGhpcy5fc3RhdGUuY29sdW1uc0dyb3VwO1xyXG4gICAgICAgIC8vIHRoaXMuaW5pdENvbHVtbnNXaWR0aChjb2xncm91cCwgZmFsc2UpO1xyXG4gICAgICAgIC8vIHRoaXMudXBkYXRlU3RhdGUoeyBjb2x1bW5zR3JvdXA6ICB7Li4uY29sZ3JvdXB9IH0sIGZhbHNlKTtcclxuICAgICAgICAvLyB0aGlzLmdyaWRTaXplU3ViamVjdC5uZXh0KHRoaXMuX3N0YXRlKTtcclxuICAgICAgICB0aGlzLnJlc2l6ZUNvbHVtbnMoKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgcmVzaXplQ29sdW1ucyhyZXN0aXR1dGUgPSBmYWxzZSkge1xyXG4gICAgICAgIGNvbnN0IGNvbGdyb3VwID0gdGhpcy5fc3RhdGUuY29sdW1uc0dyb3VwO1xyXG4gICAgICAgIHRoaXMuaW5pdENvbHVtbnNXaWR0aChjb2xncm91cCwgcmVzdGl0dXRlKTtcclxuICAgICAgICBpZiAodGhpcy5fc3RhdGUuZml0Q29sdW1ucykge1xyXG4gICAgICAgICAgICBjb25zdCByID0gdGhpcy51c2VVc2VyU2V0Q29sdW1uU2l6ZSgpO1xyXG4gICAgICAgICAgICBpZiAocikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRGaXRDb2x1bW5zV2lkdGgoY29sZ3JvdXAsIHJlc3RpdHV0ZSwgcik7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldEZpdENvbHVtbnNXaWR0aChjb2xncm91cCwgcmVzdGl0dXRlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlKHsgY29sdW1uc0dyb3VwOiAgey4uLmNvbGdyb3VwfSB9LCBmYWxzZSk7XHJcbiAgICAgICAgdGhpcy5ncmlkU2l6ZVN1YmplY3QubmV4dCh0aGlzLl9zdGF0ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0QWxsRmxhdENvbHVtbnMoKSB7XHJcbiAgICAgICAgcmV0dXJuIGZsYXR0ZW48RGF0YUNvbHVtbj4odGhpcy5fc3RhdGUuY29sdW1ucyk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0Q29sdW1uKGZpZWxkTmFtZTogc3RyaW5nKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QWxsRmxhdENvbHVtbnMoKS5maW5kKG4gPT4gbi5maWVsZCA9PT0gZmllbGROYW1lKTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRGaXRDb2x1bW5zV2lkdGgoY29sZ3JvdXA6IENvbHVtbkdyb3VwLCByZXN0aXR1dGUgPSBmYWxzZSwgdXNlVXNlclNldENvbHVtblNpemUgPSBmYWxzZSkge1xyXG4gICAgICAgIGlmICghY29sZ3JvdXApIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb2xncm91cC5ub3JtYWxXaWR0aCA9IHRoaXMuX3N0YXRlLndpZHRoIC0gY29sZ3JvdXAubGVmdEZpeGVkV2lkdGggLSBjb2xncm91cC5yaWdodEZpeGVkV2lkdGg7XHJcblxyXG4gICAgICAgIGlmICghY29sZ3JvdXAubm9ybWFsV2lkdGggfHwgY29sZ3JvdXAubm9ybWFsV2lkdGggPCAwICkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgaWYgKHVzZVVzZXJTZXRDb2x1bW5TaXplKSB7XHJcbiAgICAgICAgICAgIGNvbGdyb3VwLnRvdGFsV2lkdGggPSBjb2xncm91cC5vcmlnaW5hbFRvdGFsV2lkdGg7XHJcbiAgICAgICAgICAgIGlmIChyZXN0aXR1dGUpIHtcclxuICAgICAgICAgICAgICAgIGNvbGdyb3VwLm5vcm1hbENvbHVtbnMuZm9yRWFjaCggY29sID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBjb2wud2lkdGggPSBjb2wub3JpZ2luYWxXaWR0aDtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIOabtOaWsCBub3JtYWxDb2x1bW5zIHdpZHRoXHJcbiAgICAgICAgICAgIGNvbGdyb3VwLm5vcm1hbFdpZHRoID0gY29sZ3JvdXAubm9ybWFsQ29sdW1ucy5yZWR1Y2UoKHRvdGFsV2lkdGgsIGNvbCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFyZXN0aXR1dGUgJiYgY29sLndpZHRoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRvdGFsV2lkdGggKz0gY29sLndpZHRoO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdG90YWxXaWR0aCArPSBjb2wub3JpZ2luYWxXaWR0aDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgMCk7XHJcblxyXG4gICAgICAgICAgICBjb2xncm91cC50b3RhbFdpZHRoID0gY29sZ3JvdXAubGVmdEZpeGVkV2lkdGggKyBjb2xncm91cC5yaWdodEZpeGVkV2lkdGggKyBjb2xncm91cC5ub3JtYWxXaWR0aDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zdCBtaW5XaWR0aCA9IGNvbGdyb3VwLm5vcm1hbENvbHVtbnMucmVkdWNlKCh0b3RhbFdpZHRoLCBjb2wpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmICghcmVzdGl0dXRlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRvdGFsV2lkdGggKz0gY29sLndpZHRoO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdG90YWxXaWR0aCArPSBjb2wub3JpZ2luYWxXaWR0aDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgMCk7XHJcblxyXG4gICAgICAgICAgICAvLyBjb2xncm91cC5ub3JtYWxXaWR0aCA9IGNvbGdyb3VwLm5vcm1hbFdpZHRoIC0gMjtcclxuXHJcbiAgICAgICAgICAgIGNvbGdyb3VwLm5vcm1hbENvbHVtbnMuZm9yRWFjaCggY29sID0+IHtcclxuICAgICAgICAgICAgICAgIGlmICghcmVzdGl0dXRlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gY29sLndpZHRoID0gTWF0aC5mbG9vciggY29sLndpZHRoIC8gbWluV2lkdGggKiBjb2xncm91cC5ub3JtYWxXaWR0aCApO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbC53aWR0aCA9IE51bWJlcigoY29sLndpZHRoIC8gbWluV2lkdGggKiBjb2xncm91cC5ub3JtYWxXaWR0aCApLnRvRml4ZWQoMikpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBjb2wud2lkdGggPSBNYXRoLmZsb29yKCBjb2wub3JpZ2luYWxXaWR0aCAvIG1pbldpZHRoICogY29sZ3JvdXAubm9ybWFsV2lkdGggKTtcclxuICAgICAgICAgICAgICAgICAgICBjb2wud2lkdGggPSAgTnVtYmVyKCggY29sLm9yaWdpbmFsV2lkdGggLyBtaW5XaWR0aCAqIGNvbGdyb3VwLm5vcm1hbFdpZHRoICkudG9GaXhlZCgyKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBjb2xncm91cC50b3RhbFdpZHRoID0gY29sZ3JvdXAubGVmdEZpeGVkV2lkdGggKyBjb2xncm91cC5yaWdodEZpeGVkV2lkdGggKyBjb2xncm91cC5ub3JtYWxXaWR0aDtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0Rml4ZWRDb2xzKGRpcmVjdGlvbjogJ2xlZnQnIHwgJ3JpZ2h0JyB8ICcnID0gJycpIHtcclxuICAgICAgICBsZXQgY29scyA9IFtdO1xyXG4gICAgICAgIGlmICghZGlyZWN0aW9uKSB7XHJcbiAgICAgICAgICAgIGNvbHMgPSB0aGlzLl9zdGF0ZS5mbGF0Q29sdW1ucy5maWx0ZXIoY29sID0+ICFjb2wuZml4ZWQpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbHMgPSB0aGlzLl9zdGF0ZS5mbGF0Q29sdW1ucy5maWx0ZXIoY29sID0+IGNvbC5maXhlZCA9PT0gZGlyZWN0aW9uKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIOWkmuihqOWktO+8jOmHjeaWsOiuoeeul+WIl+eahOmhuuW6j1xyXG4gICAgICAgIGlmICh0aGlzLl9zdGF0ZS5jb2x1bW5zLmxlbmd0aCA+IDEgJiYgY29scy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgY29uc3QgZmllbGRzID0gRGF0YWdyaWRDb2x1bW5zSGVscGVyLmdldEZpZWxkcyh0aGlzLl9zdGF0ZS5jb2x1bW5zKTtcclxuICAgICAgICAgICAgY29uc3QgbmV3Y29scyA9IFtdO1xyXG4gICAgICAgICAgICBmaWVsZHMuZm9yRWFjaChmID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGMgPSAgY29scy5maW5kKGNvbCA9PiAoY29sLmZpZWxkIHx8ICcnICkgPT09IGYpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGMpIHtcclxuICAgICAgICAgICAgICAgICAgICBuZXdjb2xzLnB1c2goYyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3Y29scztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBjb2xzO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIHJlc3RpdHV0ZTog6L+Y5Y6f5Yid5aeL5a695bqm77yM6buY6K6kIGZhbHNlXHJcbiAgICBwcml2YXRlIGluaXRDb2x1bW5zV2lkdGgoY29sZ3JvdXA6IENvbHVtbkdyb3VwLCAgcmVzdGl0dXRlID0gZmFsc2UpIHtcclxuICAgICAgICBsZXQgb2Zmc2V0ID0gMDtcclxuICAgICAgICBvZmZzZXQgPSB0aGlzLl9zdGF0ZS5zaG93TGluZU51bWJlciA/IG9mZnNldCArIHRoaXMuX3N0YXRlLmxpbmVOdW1iZXJXaWR0aCA6IG9mZnNldDtcclxuICAgICAgICBvZmZzZXQgPSB0aGlzLl9zdGF0ZS5zaG93Q2hlY2tib3ggPyBvZmZzZXQgKyB0aGlzLl9zdGF0ZS5jaGVja2JveENvbHVtbldpZHRoIDogb2Zmc2V0O1xyXG5cclxuICAgICAgICBjb25zdCBnZXRDb2xzV2lkdGggPSAoY29scywgdmFsLCByZXNldCkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gY29scy5yZWR1Y2UoKHIsIGMpID0+IHtcclxuICAgICAgICAgICAgICAgIGMubGVmdCA9IHI7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXJlc2V0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHIgKyBjLndpZHRoO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gciArIGMub3JpZ2luYWxXaWR0aDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgdmFsKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBjb2xncm91cC5sZWZ0Rml4ZWRXaWR0aCA9IG9mZnNldDtcclxuICAgICAgICBpZiAoY29sZ3JvdXAubGVmdEZpeGVkICYmIGNvbGdyb3VwLmxlZnRGaXhlZC5sZW5ndGgpIHtcclxuICAgICAgICAgICAgY29sZ3JvdXAubGVmdEZpeGVkV2lkdGggPSBnZXRDb2xzV2lkdGgoY29sZ3JvdXAubGVmdEZpeGVkLCBvZmZzZXQsIHJlc3RpdHV0ZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb2xncm91cC5yaWdodEZpeGVkV2lkdGggPSAwO1xyXG4gICAgICAgIGlmIChjb2xncm91cC5yaWdodEZpeGVkICYmIGNvbGdyb3VwLnJpZ2h0Rml4ZWQubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGNvbGdyb3VwLnJpZ2h0Rml4ZWRXaWR0aCA9IGdldENvbHNXaWR0aChjb2xncm91cC5yaWdodEZpeGVkLCAwLCByZXN0aXR1dGUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29sZ3JvdXAubm9ybWFsV2lkdGggPSAwO1xyXG4gICAgICAgIGlmICh0aGlzLl9zdGF0ZS5jb2x1bW5zICYmIHRoaXMuX3N0YXRlLmNvbHVtbnMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGNvbGdyb3VwLm5vcm1hbFdpZHRoID0gZ2V0Q29sc1dpZHRoKGNvbGdyb3VwLm5vcm1hbENvbHVtbnMsIDAsIHJlc3RpdHV0ZSk7XHJcbiAgICAgICAgICAgIGNvbGdyb3VwLm9yaWdpbmFsVG90YWxXaWR0aCA9IGdldENvbHNXaWR0aChjb2xncm91cC5ub3JtYWxDb2x1bW5zLCAwLCB0cnVlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbGdyb3VwLnRvdGFsV2lkdGggPSBjb2xncm91cC5sZWZ0Rml4ZWRXaWR0aCArIGNvbGdyb3VwLnJpZ2h0Rml4ZWRXaWR0aCArIGNvbGdyb3VwLm5vcm1hbFdpZHRoO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBzaG93Q2hlY2tib3goaXNTaG93ID0gdHJ1ZSkge1xyXG4gICAgICAgIGNvbnN0IGNvbGdyb3VwID0gdGhpcy5fc3RhdGUuY29sdW1uc0dyb3VwO1xyXG4gICAgICAgIHRoaXMudXBkYXRlU3RhdGUoe3Nob3dDaGVja2JveDogaXNTaG93fSwgZmFsc2UpO1xyXG4gICAgICAgIGlmIChpc1Nob3cpIHtcclxuICAgICAgICAgICAgY29sZ3JvdXAubGVmdEZpeGVkV2lkdGggPSBjb2xncm91cC5sZWZ0Rml4ZWRXaWR0aCArIHRoaXMuX3N0YXRlLmNoZWNrYm94Q29sdW1uV2lkdGg7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY29sZ3JvdXAubGVmdEZpeGVkV2lkdGggPSBjb2xncm91cC5sZWZ0Rml4ZWRXaWR0aCAtIHRoaXMuX3N0YXRlLmNoZWNrYm94Q29sdW1uV2lkdGg7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmNvbHVtblJlc2l6ZVN1YmplY3QubmV4dChjb2xncm91cCk7XHJcbiAgICB9XHJcblxyXG4gICAgaGlkZUNoZWNrYm94KCkge1xyXG4gICAgICAgIHRoaXMuc2hvd0NoZWNrYm94KGZhbHNlKTtcclxuICAgIH1cclxuXHJcbiAgICBzaG93TGluZU51bWJlcihpc1Nob3cgPSB0cnVlKSB7XHJcbiAgICAgICAgY29uc3QgY29sZ3JvdXAgPSB0aGlzLl9zdGF0ZS5jb2x1bW5zR3JvdXA7XHJcbiAgICAgICAgdGhpcy51cGRhdGVTdGF0ZSh7c2hvd0xpbmVOdW1iZXI6IGlzU2hvd30sIGZhbHNlKTtcclxuICAgICAgICBpZiAoaXNTaG93KSB7XHJcbiAgICAgICAgICAgIGNvbGdyb3VwLmxlZnRGaXhlZFdpZHRoID0gY29sZ3JvdXAubGVmdEZpeGVkV2lkdGggKyB0aGlzLl9zdGF0ZS5saW5lTnVtYmVyV2lkdGg7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY29sZ3JvdXAubGVmdEZpeGVkV2lkdGggPSBjb2xncm91cC5sZWZ0Rml4ZWRXaWR0aCAtIHRoaXMuX3N0YXRlLmxpbmVOdW1iZXJXaWR0aDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuY29sdW1uUmVzaXplU3ViamVjdC5uZXh0KGNvbGdyb3VwKTtcclxuICAgIH1cclxuXHJcbiAgICBoaWRlTGluZU51bWJlcigpIHtcclxuICAgICAgICB0aGlzLnNob3dMaW5lTnVtYmVyKGZhbHNlKTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRTb3J0SW5mbyhzb3J0TmFtZSwgc29ydE9yZGVyKSB7XHJcbiAgICAgICAgc29ydE5hbWUgPSBzb3J0TmFtZSB8fCAnJztcclxuICAgICAgICBzb3J0T3JkZXIgPSBzb3J0T3JkZXIgfHwgJyc7XHJcbiAgICAgICAgY29uc3QgZmllbGRzID0gc29ydE5hbWUuc3BsaXQoJywnKTtcclxuICAgICAgICBjb25zdCBvcmRlcnMgPSBzb3J0T3JkZXIuc3BsaXQoJywnKTtcclxuICAgICAgICAvLyBpZiAoIXRoaXMuX3N0YXRlLm11bHRpU29ydCkge1xyXG4gICAgICAgIGNvbnN0IGNvbGdyb3VwID0gdGhpcy5fc3RhdGUuY29sdW1uc0dyb3VwO1xyXG5cclxuICAgICAgICBjb25zdCB1cGRhdGVGaWVsZE9yZGVyID0gKGNvbHM6IERhdGFDb2x1bW5bXSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoIWNvbHMgfHwgIWNvbHMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29scy5mb3JFYWNoKCBjb2wgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29sLm9yZGVyID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaSA9IGZpZWxkcy5maW5kSW5kZXgoZiA9PiBmID09PSBjb2wuZmllbGQpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGkgPiAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbC5vcmRlciA9IG9yZGVyc1tpXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdXBkYXRlRmllbGRPcmRlcihjb2xncm91cC5ub3JtYWxDb2x1bW5zKTtcclxuICAgICAgICB1cGRhdGVGaWVsZE9yZGVyKGNvbGdyb3VwLmxlZnRGaXhlZCk7XHJcbiAgICAgICAgdXBkYXRlRmllbGRPcmRlcihjb2xncm91cC5yaWdodEZpeGVkKTtcclxuICAgICAgICAvLyB9XHJcblxyXG4gICAgICAgIHRoaXMudXBkYXRlU3RhdGUoe3NvcnROYW1lLCBzb3J0T3JkZXJ9LCBmYWxzZSk7XHJcbiAgICB9XHJcblxyXG4gICAgb3JkZXJCeShhcnIsIHByb3BzOiBhbnlbXSwgb3JkZXJzOiBhbnlbXSkge1xyXG4gICAgICAgIGNvbnN0IGNvbE9iaiA9IHByb3BzLnJlZHVjZSgoYywgbikgPT4ge1xyXG4gICAgICAgICAgICBjW25dID0gdGhpcy5nZXRDb2x1bW4obik7XHJcbiAgICAgICAgICAgIHJldHVybiBjO1xyXG4gICAgICAgIH0sIHt9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIFsuLi5hcnJdLnNvcnQoKGEsIGIpID0+XHJcbiAgICAgICAgICAgIHByb3BzLnJlZHVjZSgoYWNjLCBwcm9wLCBpKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoYWNjID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHZhbEEgPSBVdGlscy5nZXRWYWx1ZShwcm9wLCBhKTtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgdmFsQiA9IFV0aWxzLmdldFZhbHVlKHByb3AsIGIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoY29sT2JqW3Byb3BdICYmIGNvbE9ialtwcm9wXVsnaXNNdWx0aWxpbmd1YWxGaWVsZCddKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbEEgPSBVdGlscy5nZXRNdWx0aWxpbmd1YWxWYWx1ZSh2YWxBLCB0aGlzLmxvY2FsSWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWxCID0gVXRpbHMuZ2V0TXVsdGlsaW5ndWFsVmFsdWUodmFsQiwgdGhpcy5sb2NhbElkKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWxBID09PSB1bmRlZmluZWQgfHwgdmFsQSA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWxBID0gJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWxCID09PSB1bmRlZmluZWQgfHwgdmFsQiA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWxCID0gJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBbcDEsIHAyXSA9IG9yZGVycyAmJiBvcmRlcnNbaV0gPT09ICdkZXNjJyA/IFt2YWxCLCB2YWxBXSA6IFt2YWxBLCB2YWxCXTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHAxID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhY2MgPSBwMS5sb2NhbGVDb21wYXJlKHAyKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhY2MgPSBwMSA+IHAyID8gMSA6IHAxIDwgcDIgPyAtMSA6IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGFjYztcclxuICAgICAgICAgICAgfSwgMClcclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIHNvcnQoZGF0YTogYW55KSB7XHJcbiAgICAgICAgY29uc3Qgb3JkZXJzID0gdGhpcy5fc3RhdGUuc29ydE9yZGVyLnNwbGl0KCcsJyk7XHJcbiAgICAgICAgY29uc3QgZmllbGRzID0gdGhpcy5fc3RhdGUuc29ydE5hbWUuc3BsaXQoJywnKTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuX3N0YXRlLm1lcmdlQ2VsbCAmJiB0aGlzLl9zdGF0ZS5tZXJnZUZpZWxkcyAmJiB0aGlzLl9zdGF0ZS5tZXJnZUZpZWxkcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgY29uc3QgbmV3T3JkZXJzID0gW107XHJcbiAgICAgICAgICAgIGNvbnN0IG5ld0ZpZWxkcyA9IFsuLi50aGlzLl9zdGF0ZS5tZXJnZUZpZWxkc107XHJcbiAgICAgICAgICAgIGZpZWxkcy5mb3JFYWNoKChmLCBpKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgayA9IG5ld0ZpZWxkcy5pbmRleE9mKGYpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGsgPT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICBuZXdGaWVsZHMucHVzaChmKTtcclxuICAgICAgICAgICAgICAgICAgICBrID0gbmV3RmllbGRzLmxlbmd0aCAtIDE7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBuZXdPcmRlcnNba10gPSBvcmRlcnNbaV07XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMub3JkZXJCeShkYXRhLCBuZXdGaWVsZHMsIG5ld09yZGVycyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5vcmRlckJ5KGRhdGEsIGZpZWxkcywgb3JkZXJzKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgY2xpZW50U29ydChkYXRhPzogYW55KSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX3N0YXRlLnNvcnROYW1lKSB7XHJcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlKHsgZGF0YSB9LCBmYWxzZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29uc3Qgc29ydGVkRGF0YSA9IHRoaXMuc29ydCh0aGlzLl9zdGF0ZS5kYXRhKTtcclxuICAgICAgICAgICAgdGhpcy5sb2FkRGF0YShzb3J0ZWREYXRhLCBmYWxzZSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5jbGVhclNvcnQoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuY2xpZW50U29ydCQuZW1pdCh7c29ydE5hbWU6IHRoaXMuX3N0YXRlLnNvcnROYW1lLCBzb3J0T3JkZXI6IHRoaXMuX3N0YXRlLnNvcnRPcmRlcn0pO1xyXG4gICAgfVxyXG5cclxuICAgIGNsZWFyU29ydCgpIHtcclxuICAgICAgICB0aGlzLmxvYWREYXRhKHRoaXMuX3N0YXRlLm9yaWdpbmFsRGF0YSwgZmFsc2UpO1xyXG4gICAgfVxyXG5cclxuICAgIGxvYWRGaWx0ZXJEYXRhKGZpbHRlckRhdGE6IGFueVtdKSB7XHJcbiAgICAgICAgdGhpcy5sb2FkRGF0YShmaWx0ZXJEYXRhLCBmYWxzZSk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIC8vI3JlZ2lvbiDlj5jmm7Tpm4ZcclxuXHJcbiAgICBwcml2YXRlIGhhc1Jvd0NoYW5nZXMocm93aWQ6IGFueSkge1xyXG4gICAgICAgIGNvbnN0IF9jaGFuZ2VzID0gdGhpcy5fc3RhdGUuY2hhbmdlcztcclxuICAgICAgICBpZiAoIV9jaGFuZ2VzKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIF9jaGFuZ2VzW3Jvd2lkXTtcclxuICAgIH1cclxuXHJcbiAgICBhcHBlbmRDaGFuZ2VzKGNoYW5nZXM6IFJvd0RhdGFDaGFuZ2VzKSB7XHJcbiAgICAgICAgaWYgKCFjaGFuZ2VzKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgaWQgPSBjaGFuZ2VzW3RoaXMuX3N0YXRlLmlkRmllbGRdO1xyXG4gICAgICAgIGlmICghaWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBfaWQgPSAnJyArIGlkO1xyXG4gICAgICAgIGlmICghdGhpcy5oYXNSb3dDaGFuZ2VzKF9pZCkpIHtcclxuICAgICAgICAgICAgdGhpcy5fc3RhdGUuY2hhbmdlcyA9IHRoaXMuX3N0YXRlLmNoYW5nZXMgfHwge307XHJcbiAgICAgICAgICAgIHRoaXMuX3N0YXRlLmNoYW5nZXNbX2lkXSA9IGNoYW5nZXM7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5fc3RhdGUuY2hhbmdlc1tfaWRdID0gT2JqZWN0LmFzc2lnbih0aGlzLl9zdGF0ZS5jaGFuZ2VzW19pZF0sIGNoYW5nZXMpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBhY2NlcHRDaGFuZ2VzKCkge1xyXG4gICAgICAgIGNvbnN0IGNoYW5nZXMgPSB0aGlzLl9zdGF0ZS5jaGFuZ2VzO1xyXG4gICAgICAgIGlmIChjaGFuZ2VzKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyhjaGFuZ2VzKTtcclxuICAgICAgICAgICAga2V5cy5mb3JFYWNoKGlkID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlUm93KGlkLCBjaGFuZ2VzW2lkXSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB0aGlzLl9zdGF0ZS5vcmlnaW5hbERhdGEgPSBjbG9uZURlZXAodGhpcy5fc3RhdGUuZGF0YSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmVqZWN0Q2hhbmdlcyhyb3dpZCA9IG51bGwpIHtcclxuICAgICAgICBjb25zdCBjaGFuZ2VzID0gdGhpcy5fc3RhdGUuY2hhbmdlcztcclxuICAgICAgICBpZiAoY2hhbmdlcykge1xyXG4gICAgICAgICAgICBpZiAoIXJvd2lkKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9zdGF0ZS5kYXRhID0gY2xvbmVEZWVwKHRoaXMuX3N0YXRlLm9yaWdpbmFsRGF0YSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9zdGF0ZS5jaGFuZ2VzID0gbnVsbDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHJvd0NoYW5nZXMgPSAgdGhpcy5fc3RhdGUuY2hhbmdlc1snJyArIHJvd2lkXTtcclxuICAgICAgICAgICAgICAgIGlmIChyb3dDaGFuZ2VzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3JnaVJvdyA9IHRoaXMuX3N0YXRlLm9yaWdpbmFsRGF0YS5maW5kKHIgPT4gdGhpcy5wcmltYXJ5SWQocikgPT09IHJvd2lkKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9zdGF0ZS5kYXRhLmZvckVhY2gociA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnByaW1hcnlJZChyKSA9PT0gcm93aWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHIgPSBjbG9uZURlZXAob3JnaVJvdyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5yZWZyZXNoKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldENoYW5nZXMoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3N0YXRlLmNoYW5nZXM7XHJcbiAgICB9XHJcblxyXG4gICAgcmVmcmVzaCgpIHtcclxuICAgICAgICBjb25zdCBkYXRhID0gY2xvbmVEZWVwKHRoaXMuX3N0YXRlLmRhdGEpO1xyXG4gICAgICAgIHRoaXMubG9hZERhdGEoZGF0YSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8jZW5kcmVnaW9uXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmnoTpgKDlkIjorqHooYxcclxuICAgICAqIEBwYXJhbSBkYXRhIOaVsOaNrumbhuWQiFxyXG4gICAgICovXHJcbiAgICBnZXRGb290ZXJEYXRhKGRhdGEpIHtcclxuICAgICAgICBpZiAoIWRhdGEgfHwgIWRhdGEubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBbXTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIGNvbnN0IGNvbHVtbnMgPSB0aGlzLl9zdGF0ZS5mbGF0Q29sdW1ucztcclxuICAgICAgICBjb25zdCBjb2x1bW5zID0gZmxhdHRlbjxEYXRhQ29sdW1uPih0aGlzLl9zdGF0ZS5jb2x1bW5zKS5maWx0ZXIoKGNvbDogRGF0YUNvbHVtbikgPT4gIWNvbC5jb2xzcGFuKTtcclxuICAgICAgICBjb25zdCBmb290ZXJSb3cgPSB7fTtcclxuXHJcbiAgICAgICAgY29sdW1ucy5mb3JFYWNoKGNvbCA9PiB7XHJcbiAgICAgICAgICAgIGlmIChjb2wuZm9vdGVyICYmIGNvbC5mb290ZXIub3B0aW9ucykge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgb3B0aW9ucyA9IGNvbC5mb290ZXIub3B0aW9ucztcclxuICAgICAgICAgICAgICAgIGNvbnN0IHRleHQgPSBvcHRpb25zLnRleHQ7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB0eXAgPSBvcHRpb25zLmNhbGN1bGF0aW9uVHlwZSBhcyBDYWxjdWxhdGlvblR5cGU7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHR5cCAhPT0gdW5kZWZpbmVkICYmIHR5cCAhPSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbCA9IHRoaXMuY2FsY3VsYXRpb24oZGF0YSwgdHlwLCBjb2wpO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvb3RlclJvd1tjb2wuZmllbGRdID0gdmFsO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBmb290ZXJSb3dbY29sLmZpZWxkXSA9IHRleHQgfHwgJyc7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBmb290ZXJSb3dbY29sLmZpZWxkXSA9ICcnO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiBbZm9vdGVyUm93XTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGFyclRvR3JvdXAoaXRlbXMsIGZpZWxkczogc3RyaW5nW10pIHtcclxuICAgICAgICBpZiAoZmllbGRzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBjb25zdCBmaXJzdCA9IGZpZWxkcy5zaGlmdCgpO1xyXG4gICAgICAgICAgICBjb25zdCBnMSA9IGdyb3VwQnkoaXRlbXMsIChuKSA9PiBVdGlscy5nZXRWYWx1ZShmaXJzdCwgbikpO1xyXG4gICAgICAgICAgICB0aGlzLnRvR3JvdXAoZzEsIGZpZWxkcyk7XHJcbiAgICAgICAgICAgIHJldHVybiBnMTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSB0b0dyb3VwKGcxLCBmaWVsZEFycikge1xyXG4gICAgICAgIGlmIChmaWVsZEFyci5sZW5ndGgpIHtcclxuICAgICAgICAgICAgT2JqZWN0LmtleXMoZzEpLmZvckVhY2goKGspID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW1zID0gZzFba107XHJcbiAgICAgICAgICAgICAgICBjb25zdCBfbmV4dEZpZWxkcyA9IGZpZWxkQXJyLm1hcCgobikgPT4gbik7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBfZiA9IF9uZXh0RmllbGRzLnNoaWZ0KCk7XHJcbiAgICAgICAgICAgICAgICBnMVtrXSA9IGdyb3VwQnkoaXRlbXMsIChuKSA9PiBVdGlscy5nZXRWYWx1ZShfZiwgbikpO1xyXG4gICAgICAgICAgICAgICAgaWYgKF9uZXh0RmllbGRzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudG9Hcm91cChnMVtrXSwgX25leHRGaWVsZHMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBncm91cFJvd3MyRmxhdChncm91cFJvd3MsIGluaXRMZXZlbCwgcGFyZW50KSB7XHJcbiAgICAgICAgbGV0IHJlc3VsdHMgPSBbXTtcclxuICAgICAgICBpZiAoaW5pdExldmVsID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgaW5pdExldmVsID0gMDtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgaWRmaWVsZCA9IHRoaXMuX3N0YXRlLmlkRmllbGQ7XHJcbiAgICAgICAgY29uc3QgY29sdW1ucyA9IHRoaXMuX3N0YXRlLmZsYXRDb2x1bW5zO1xyXG4gICAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLl9zdGF0ZS5kYXRhO1xyXG4gICAgICAgIGNvbnN0IGdyb3VwRmllbGRBcnIgPSB0aGlzLl9zdGF0ZS5ncm91cEZpZWxkLnNwbGl0KCcsJyk7XHJcbiAgICAgICAgY29uc3QgcGlkID0gcGFyZW50ID8gcGFyZW50W2lkZmllbGRdIDogbnVsbDtcclxuICAgICAgICBjb25zdCBjb2xzcGFuID0gdGhpcy5fc3RhdGUuY29sdW1uc0dyb3VwLm5vcm1hbENvbHVtbnMubGVuZ3RoO1xyXG5cclxuICAgICAgICBjb25zdCBleHBhbmRHcm91cFJvd3MgPSB0aGlzLl9zdGF0ZS5leHBhbmRHcm91cFJvd3M7XHJcblxyXG4gICAgICAgIE9iamVjdC5rZXlzKGdyb3VwUm93cykuZm9yRWFjaCgoaywgbSkgPT4ge1xyXG5cclxuICAgICAgICAgICAgY29uc3QgZ3JvdXBJdGVtID0geyBbaWRmaWVsZF06IFV0aWxzLnV1aWQoKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbSVNfR1JPVVBfUk9XX0ZJRUxEXTogdHJ1ZSwgW0dST1VQX0xFVkVMX0ZJRUxEXTogaW5pdExldmVsLCBkYXRhOiB7IH0sIHZhbHVlOiBrLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtHUk9VUF9WSVNJQkxFX0ZJRUxEXTogdHJ1ZSwgZXhwYW5kZWQ6IGV4cGFuZEdyb3VwUm93cywgZmllbGQ6IGdyb3VwRmllbGRBcnJbaW5pdExldmVsXSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xzcGFuLCB0b3RhbDogMCwgcm93czogW10sIFtHUk9VUF9ST1dfRklFTERdOiBwaWR9O1xyXG5cclxuICAgICAgICAgICAgLy8gVEZTOiAzNTY5NTVcclxuICAgICAgICAgICAgaWYgKHBhcmVudCkge1xyXG4gICAgICAgICAgICAgICAgZ3JvdXBJdGVtLnJvd3MgPSBwYXJlbnQucm93cy5maWx0ZXIobiA9PiAhbltJU19HUk9VUF9ST1dfRklFTERdICYmXHJcbiAgICAgICAgICAgICAgICAgICAgIW5bSVNfR1JPVVBfRk9PVEVSX1JPV19GSUVMRF0gJiYgIFV0aWxzLmdldFZhbHVlKGdyb3VwRmllbGRBcnJbaW5pdExldmVsXSwgbikgPT09IGspO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBncm91cEl0ZW1bR1JPVVBfVklTSUJMRV9GSUVMRF0gPSBleHBhbmRHcm91cFJvd3M7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBncm91cEl0ZW0ucm93cyA9IGRhdGEuZmlsdGVyKG4gPT4gJycgKyBVdGlscy5nZXRWYWx1ZShncm91cEZpZWxkQXJyW2luaXRMZXZlbF0sIG4pID09PSBrKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHBhcmVudCkge1xyXG4gICAgICAgICAgICAgICAgcGFyZW50LnJvd3MucHVzaChncm91cEl0ZW0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBncm91cEl0ZW0udG90YWwgPSBncm91cEl0ZW0ucm93cy5maWx0ZXIobiA9PiAhbltJU19HUk9VUF9ST1dfRklFTERdICYmICFuW0lTX0dST1VQX0ZPT1RFUl9ST1dfRklFTERdKS5sZW5ndGg7XHJcblxyXG4gICAgICAgICAgICByZXN1bHRzLnB1c2goZ3JvdXBJdGVtKTtcclxuICAgICAgICAgICAgbGV0IGl0ZW1zID0gZ3JvdXBSb3dzW2tdO1xyXG4gICAgICAgICAgICBpZiAoaXNQbGFpbk9iamVjdChpdGVtcykpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGxldmVsID0gaW5pdExldmVsICsgMTtcclxuICAgICAgICAgICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmNvbmNhdCh0aGlzLmdyb3VwUm93czJGbGF0KGl0ZW1zLCBsZXZlbCwgZ3JvdXBJdGVtKSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBncm91cEl0ZW0udG90YWwgPSBpdGVtcy5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICBpdGVtcyA9IGl0ZW1zLm1hcChuID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBuW0dST1VQX1JPV19GSUVMRF0gPSBncm91cEl0ZW1baWRmaWVsZF07XHJcbiAgICAgICAgICAgICAgICAgICAgbltHUk9VUF9WSVNJQkxFX0ZJRUxEXSA9IGV4cGFuZEdyb3VwUm93cztcclxuICAgICAgICAgICAgICAgICAgICBuW0dST1VQX0xFVkVMX0ZJRUxEXSA9IGdyb3VwSXRlbVtHUk9VUF9MRVZFTF9GSUVMRF0gKyAxO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBncm91cEl0ZW0ucm93cyA9IGl0ZW1zO1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuY29uY2F0KGl0ZW1zKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuX3N0YXRlLmdyb3VwRm9vdGVyKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBmb290ZXJJdGVtID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIFtJU19HUk9VUF9GT09URVJfUk9XX0ZJRUxEXTogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICBbR1JPVVBfUk9XX0ZJRUxEXTogZ3JvdXBJdGVtW2lkZmllbGRdLFxyXG4gICAgICAgICAgICAgICAgICAgIFtHUk9VUF9WSVNJQkxFX0ZJRUxEXTogZXhwYW5kR3JvdXBSb3dzLFxyXG4gICAgICAgICAgICAgICAgICAgIFtHUk9VUF9MRVZFTF9GSUVMRF06IGluaXRMZXZlbCxcclxuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7fVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIGdyb3VwSXRlbS5yb3dzLnB1c2goZm9vdGVySXRlbSk7XHJcbiAgICAgICAgICAgICAgICByZXN1bHRzLnB1c2goZm9vdGVySXRlbSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gcmVzdWx0cztcclxuICAgIH1cclxuXHJcbiAgICAvKiog5pu05paw5YiG57uE5ZCI6K6h6KGM5pWw5o2uICovXHJcbiAgICBwcml2YXRlIHVwZGF0ZUdyb3VwRm9vdGVyRGF0YShncm91cEZvb3RlclJvdzogYW55LCBjb2x1bW5zOiBhbnksIGdyb3VwUm93czogYW55KSB7XHJcbiAgICAgICAgY29sdW1ucy5mb3JFYWNoKGNvbCA9PiB7XHJcbiAgICAgICAgICAgIGlmIChjb2wuZ3JvdXBGb290ZXIgJiYgY29sLmdyb3VwRm9vdGVyLm9wdGlvbnMpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG9wdGlvbnMgPSBjb2wuZ3JvdXBGb290ZXIub3B0aW9ucztcclxuICAgICAgICAgICAgICAgIGNvbnN0IHRleHQgPSBvcHRpb25zLnRleHQ7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB0eXAgPSBvcHRpb25zLmNhbGN1bGF0aW9uVHlwZSBhcyBDYWxjdWxhdGlvblR5cGU7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHR5cCAhPT0gdW5kZWZpbmVkICYmIHR5cCAhPSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbCA9IHRoaXMuY2FsY3VsYXRpb24oZ3JvdXBSb3dzLCB0eXAsIGNvbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZ3JvdXBGb290ZXJSb3cuZGF0YVtjb2wuZmllbGRdID0gdmFsO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBncm91cEZvb3RlclJvdy5kYXRhW2NvbC5maWVsZF0gPSB0ZXh0IHx8ICcnO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgZ3JvdXBGb290ZXJSb3cuZGF0YVtjb2wuZmllbGRdID0gJyc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvKiog5aSa5a2X5q615YiG57uEXHJcbiAgICAgKiBncm91cEZpZWxkIOS7pemAl+WPt+WIhumalO+8jOS7juW3puWIsOWPs+S+neasoei/m+ihjOWIhue7hFxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGdyb3VwUm93czIoZGF0YTogYW55W10pIHtcclxuICAgICAgICBpZiAoZGF0YSAmJiBkYXRhLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBjb25zdCBjb2x1bW5zID0gdGhpcy5fc3RhdGUuZmxhdENvbHVtbnM7XHJcbiAgICAgICAgICAgIGNvbnN0IGdyb3VwRmllbGQgPSB0aGlzLl9zdGF0ZS5ncm91cEZpZWxkIHx8ICcnO1xyXG5cclxuICAgICAgICAgICAgaWYgKCFncm91cEZpZWxkKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY29uc3QgZ3JvdXBEYXRhID0gdGhpcy5hcnJUb0dyb3VwKGRhdGEsIGdyb3VwRmllbGQuc3BsaXQoJywnKSk7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMuZ3JvdXBSb3dzMkZsYXQoZ3JvdXBEYXRhLCAwLCBudWxsKTtcclxuXHJcbiAgICAgICAgICAgIGxldCBrID0gMDtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHByb3cgPSAocGlkKSA9PiByZXN1bHQuZmluZChuID0+IG5bdGhpcy5fc3RhdGUuaWRGaWVsZF0gPT09IHBpZCk7XHJcblxyXG4gICAgICAgICAgICByZXN1bHQubWFwKChuLCBpKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIW5bSVNfR1JPVVBfUk9XX0ZJRUxEXSAmJiAhbltJU19HUk9VUF9GT09URVJfUk9XX0ZJRUxEXSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5bUk9XX0lOREVYX0ZJRUxEXSA9IGs7XHJcbiAgICAgICAgICAgICAgICAgICAgaysrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIOabtOaWsOWQiOiuoeihjOaVsOaNrlxyXG4gICAgICAgICAgICAgICAgaWYgKG5bSVNfR1JPVVBfRk9PVEVSX1JPV19GSUVMRF0pIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCByb3dzID0gcHJvdyhuW0dST1VQX1JPV19GSUVMRF0pLnJvd3MuZmlsdGVyKChyOiBhbnkpID0+ICFyW0lTX0dST1VQX1JPV19GSUVMRF0gJiYgIXJbSVNfR1JPVVBfRk9PVEVSX1JPV19GSUVMRF0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlR3JvdXBGb290ZXJEYXRhKG4sIGNvbHVtbnMsIHJvd3MpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBuO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBbXTtcclxuICAgIH1cclxuXHJcbiAgICBzaG93R3JvdXBGb290ZXIoZ3JvdXBGb290ZXIpIHtcclxuICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlKHtncm91cEZvb3Rlcn0sIGZhbHNlKTtcclxuICAgICAgICB0aGlzLnVwZGF0ZVZpcnRodWFsUm93cygwKTtcclxuICAgIH1cclxuXHJcbiAgICB1cGRhdGVHcm91cEZvb3Rlcihncm91cFJvd0lkOiBzdHJpbmcpIHtcclxuICAgICAgICBjb25zdCBncm91cFJvdyA9IHRoaXMuX3N0YXRlLnZpcnR1YWwudmlydHVhbFJvd3MuZmluZCgobjogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiBuWydpZCddID09PSBncm91cFJvd0lkO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpZiAoZ3JvdXBSb3cpIHtcclxuICAgICAgICAgICAgY29uc3QgZ3JvdXBSb3dzID0gZ3JvdXBSb3cucm93cztcclxuICAgICAgICAgICAgY29uc3QgZ3JvdXBGb290ZXJSb3dzID0gZ3JvdXBSb3dzLmZpbHRlcigobjogYW55KSA9PiBuWydfX2dyb3VwX2Zvb3Rlcl9fJ10pO1xyXG4gICAgICAgICAgICBjb25zdCBjb2x1bW5zID0gdGhpcy5fc3RhdGUuZmxhdENvbHVtbnM7XHJcblxyXG4gICAgICAgICAgICBjb25zdCByb3dzID0gZ3JvdXBSb3dzLmZpbHRlcigobjogYW55KSA9PiAhblsnX19ncm91cF9mb290ZXJfXyddKTtcclxuXHJcbiAgICAgICAgICAgIGdyb3VwRm9vdGVyUm93cy5mb3JFYWNoKChuOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlR3JvdXBGb290ZXJEYXRhKG4sIGNvbHVtbnMsIHJvd3MpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjYWxjdWxhdGlvbihkYXRhOiBhbnksIHR5cDogQ2FsY3VsYXRpb25UeXBlLCBjb2w6IGFueSkge1xyXG4gICAgICAgIGxldCB2YWw6IGFueSA9ICcnO1xyXG4gICAgICAgIC8vIFRGUzogMzU3MDAwXHJcbiAgICAgICAgLy8gaHR0cDovLzEwLjI0LjEuMTE6ODA4MC90ZnMvR1NQL0dTUENsb3VkL3dlYi9fcXVlcmllcz9pZD0zNTcwMDAmdHJpYWdlPXRydWUmZnVsbFNjcmVlbj1mYWxzZSZfYT1lZGl0XHJcbiAgICAgICAgaWYgKCFkYXRhIHx8ICFkYXRhLmxlbmd0aCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJyc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGZpZWxkID0gY29sLmZpZWxkO1xyXG4gICAgICAgIGNvbnN0IGFyciA9IGRhdGEubWFwKChvKSA9PiBVdGlscy5nZXRWYWx1ZShmaWVsZCwgbykgfHwgMCk7XHJcbiAgICAgICAgc3dpdGNoICh0eXApIHtcclxuICAgICAgICAgICAgY2FzZSBDYWxjdWxhdGlvblR5cGUuc3VtOlxyXG4gICAgICAgICAgICAgICAgLy8gdmFsID0gc3VtQnkoZGF0YSwgKG8pID0+IFV0aWxzLmdldFZhbHVlKGZpZWxkLCBvKSk7XHJcbiAgICAgICAgICAgICAgICB2YWwgPSBCaWdOdW1iZXIuc3VtLmFwcGx5KG51bGwsIGFycikudG9GaXhlZCgpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgQ2FsY3VsYXRpb25UeXBlLm1heDpcclxuICAgICAgICAgICAgICAgIC8vIGNvbnN0IG1heE9iaiA9IG1heEJ5KGRhdGEsIChvKSA9PiBVdGlscy5nZXRWYWx1ZShmaWVsZCwgbykpO1xyXG4gICAgICAgICAgICAgICAgLy8gdmFsID0gVXRpbHMuZ2V0VmFsdWUoZmllbGQsIG1heE9iaik7XHJcbiAgICAgICAgICAgICAgICB2YWwgPSBCaWdOdW1iZXIubWF4LmFwcGx5KG51bGwsIGFycikudG9GaXhlZCgpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgQ2FsY3VsYXRpb25UeXBlLm1pbjpcclxuICAgICAgICAgICAgICAgIC8vIGNvbnN0IG1pbk9iaiA9IG1pbkJ5KGRhdGEsIChvKSA9PiBVdGlscy5nZXRWYWx1ZShmaWVsZCwgbykpO1xyXG4gICAgICAgICAgICAgICAgLy8gdmFsID0gVXRpbHMuZ2V0VmFsdWUoZmllbGQsIG1pbk9iaik7XHJcbiAgICAgICAgICAgICAgICB2YWwgPSBCaWdOdW1iZXIubWluLmFwcGx5KG51bGwsIGFycikudG9GaXhlZCgpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgQ2FsY3VsYXRpb25UeXBlLmF2ZXJhZ2U6XHJcbiAgICAgICAgICAgICAgICAvLyB2YWwgPSBtZWFuQnkoZGF0YSwgKG8pID0+IFV0aWxzLmdldFZhbHVlKGZpZWxkLCBvKSk7XHJcbiAgICAgICAgICAgICAgICB2YWwgPSBCaWdOdW1iZXIuc3VtLmFwcGx5KG51bGwsIGFycikuZGl2KGFyci5sZW5ndGgpLnRvRml4ZWQoKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIENhbGN1bGF0aW9uVHlwZS5jb3VudDpcclxuICAgICAgICAgICAgICAgIHZhbCA9IGRhdGEubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB2YWw7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0R3JvdXBSb3dzVmlzaWJsZShyb3csIG9wZW46IGJvb2xlYW4sIGVtaXQgPSB0cnVlKSB7XHJcblxyXG4gICAgICAgIGlmIChyb3cucm93cykge1xyXG5cclxuICAgICAgICAgICAgLy8gaWYgKCF0aGlzLl9zdGF0ZS52aXJ0dWFsaXplZCkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZ3JvdXBSb3dzID0gcm93LnJvd3MuZmlsdGVyKG4gPT4gbltJU19HUk9VUF9ST1dfRklFTERdKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGZvb3RlclJvd3MgPSByb3cucm93cy5maWx0ZXIobiA9PiBuW0lTX0dST1VQX0ZPT1RFUl9ST1dfRklFTERdKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoZm9vdGVyUm93cyAmJiBmb290ZXJSb3dzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZvb3RlclJvd3MuZm9yRWFjaChuID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbltHUk9VUF9WSVNJQkxFX0ZJRUxEXSA9IG9wZW4gJiYgcm93LmV4cGFuZGVkO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGdyb3VwUm93cy5mb3JFYWNoKHQgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRbR1JPVVBfVklTSUJMRV9GSUVMRF0gPSBvcGVuICYmIHJvdy5leHBhbmRlZCAmJiByb3dbR1JPVVBfVklTSUJMRV9GSUVMRF07XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRHcm91cFJvd3NWaXNpYmxlKHQsIG9wZW4sIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICghZ3JvdXBSb3dzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJvdy5yb3dzLmZvckVhY2godCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRbR1JPVVBfVklTSUJMRV9GSUVMRF0gPSBvcGVuICYmIHJvdy5leHBhbmRlZCAmJiByb3dbR1JPVVBfVklTSUJMRV9GSUVMRF07XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIH1cclxuXHJcbiAgICAgICAgICAgIC8vIOinpuWPkeihjOWxleW8gOaIluaKmOWPoOS6i+S7tlxyXG4gICAgICAgICAgICBpZiAoZW1pdCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKG9wZW4pIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmV4cGFuZEdyb3VwUm93LmVtaXQoeyBkYXRhOiByb3cgfSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29sbGFwc2VHcm91cFJvdy5lbWl0KHsgZGF0YTogcm93IH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vI3JlZ2lvbiDnu4Tku7bliJ3lp4vlsZ7mgKdcclxuXHJcbiAgICBzZXRpbml0aWFsT3B0aW9ucyhvcHRzOiB7W2tleTogc3RyaW5nXTogYW55fSkge1xyXG4gICAgICAgIHRoaXMuX3N0YXRlLmluaXRpYWxPcHRpb25zID0ge307XHJcbiAgICAgICAgLy8g5YiG57uEXHJcbiAgICAgICAgdGhpcy5fc3RhdGUuaW5pdGlhbE9wdGlvbnNbJ2dyb3VwRmllbGQnXSA9IG9wdHMuZ3JvdXBGaWVsZDtcclxuXHJcbiAgICAgICAgLy8g5o6S5bqPXHJcbiAgICAgICAgdGhpcy5fc3RhdGUuaW5pdGlhbE9wdGlvbnNbJ3NvcnQnXSA9IHtcclxuICAgICAgICAgICAgc29ydE5hbWU6IG9wdHMuc29ydE5hbWUsXHJcbiAgICAgICAgICAgIHNvcnRPcmRlcjogb3B0cy5zb3J0T3JkZXJcclxuICAgICAgICB9O1xyXG4gICAgICAgIC8vIOWIl+aYvuekuumakOiXj+OAgeWvuem9kOaWueW8j1xyXG4gICAgICAgIGlmIChvcHRzLmNvbHVtbnMgJiYgb3B0cy5jb2x1bW5zWzBdKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3N0YXRlLmluaXRpYWxPcHRpb25zWydjb2x1bW5GaWVsZHMnXSA9IChvcHRzLmNvbHVtbnNbMF0gYXMgYW55KS5tYXAobiA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHdpZHRoOiBuLndpZHRoIHx8IDEwMCxcclxuICAgICAgICAgICAgICAgICAgICBmaWVsZDogbi5maWVsZCxcclxuICAgICAgICAgICAgICAgICAgICBoYWxpZ246IG4uaGFsaWduLFxyXG4gICAgICAgICAgICAgICAgICAgIGFsaWduOiBuLmFsaWduLFxyXG4gICAgICAgICAgICAgICAgICAgIHZpc2libGU6IG4udmlzaWJsZSxcclxuICAgICAgICAgICAgICAgICAgICBmb290ZXI6IGNsb25lRGVlcChuLmZvb3RlciB8fCB7fSksXHJcbiAgICAgICAgICAgICAgICAgICAgZ3JvdXBGb290ZXI6IGNsb25lRGVlcChuLmdyb3VwRm9vdGVyIHx8IHt9KVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vI2VuZHJlZ2lvblxyXG59XHJcbiJdfQ==