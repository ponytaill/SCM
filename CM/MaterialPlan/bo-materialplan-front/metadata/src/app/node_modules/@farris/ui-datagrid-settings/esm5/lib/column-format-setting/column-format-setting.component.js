/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { LocaleService } from '@farris/ui-locale';
import { Component, Input, Injector, ViewChild, Output, EventEmitter, ChangeDetectorRef, ViewEncapsulation } from '@angular/core';
import { NgForm } from '@angular/forms';
import { DatagridSettingsComponent } from '../datagrid-settings.component';
var ColumnFormatSettingComponent = /** @class */ (function () {
    function ColumnFormatSettingComponent(injector, gridSettingComponentRef, cd) {
        this.injector = injector;
        this.gridSettingComponentRef = gridSettingComponentRef;
        this.cd = cd;
        this.columns = [];
        this.fields = [];
        this.formatChange = new EventEmitter();
        this.fieldsChange = new EventEmitter();
        this.allCols = [];
        /**
         * format Data
         */
        this.formatData = [];
        this.columnType = 'all';
        this.activeField = null;
        this.showGridFooter = false;
        this.searchItems = [];
        this.alignItems = [];
        this.summaryItems = [];
        this.summaryItems2 = [];
        this.isEn = false;
        this.switchValue = false;
        this._searchResult = 0;
        this.showGridFooter = this.gridSettingComponentRef.gridInstance.showFooter &&
            !this.gridSettingComponentRef.gridInstance.footerTemplate;
        this.localeSer = this.injector.get(LocaleService, null);
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ColumnFormatSettingComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        if (changes.columns && !changes.columns.isFirstChange()) {
            this.setFormatData();
            this.allCols = this.columns[0];
            this.activeField = this.columns[0][0];
            this.checkColumnOptions();
        }
    };
    /**
     * @return {?}
     */
    ColumnFormatSettingComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.isEn = this.localeSer.localeId === 'en';
        this.initData();
        if (this.colForm) {
            this.colForm.valueChanges.subscribe((/**
             * @param {?} v
             * @return {?}
             */
            function (v) {
                if (!_this.colForm.pristine) {
                    _this.formatChange.emit(_this.formatData);
                }
            }));
        }
    };
    /**
     * @private
     * @return {?}
     */
    ColumnFormatSettingComponent.prototype.setFormatData = /**
     * @private
     * @return {?}
     */
    function () {
        // this.formatData = this.fields.map(n => {
        //     return this.columns[0].find(col => col.field === n);
        // });
        this.formatData = this.columns[0];
    };
    /**
     * @private
     * @return {?}
     */
    ColumnFormatSettingComponent.prototype.initData = /**
     * @private
     * @return {?}
     */
    function () {
        this.alignItems = this.gridSettingComponentRef.alignItems;
        this.searchItems = this.gridSettingComponentRef.searchItems;
        this.summaryItems = this.gridSettingComponentRef.summaryItems;
        this.summaryItems2 = this.gridSettingComponentRef.summaryItems2;
        this.setFormatData();
        this.allCols = this.columns[0];
        this.activeField = this.columns[0][0];
        this.checkColumnOptions();
    };
    /**
     * @private
     * @return {?}
     */
    ColumnFormatSettingComponent.prototype.checkColumnOptions = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.activeField) {
            if (this.activeField.allowGrouping === undefined) {
                this.activeField.allowGrouping = true;
            }
            if (this.activeField.groupFooter === undefined) {
                this.activeField.groupFooter = { options: { calculationType: -1 } };
            }
            else {
                this.activeField.groupFooter.options = this.activeField.groupFooter.options || { calculationType: -1 };
                if (this.activeField.groupFooter.options.calculationType === undefined) {
                    this.activeField.groupFooter.options.calculationType = -1;
                }
            }
            if (this.activeField.footer === undefined) {
                this.activeField.footer = { options: { calculationType: -1 } };
            }
            else {
                this.activeField.footer.options = this.activeField.footer.options || { calculationType: -1 };
                if (this.activeField.footer.options.calculationType === undefined) {
                    this.activeField.footer.options.calculationType = -1;
                }
            }
        }
    };
    // 根据列的类型进行筛选过滤，
    // all 所有列
    // visible 可见列
    // hidden 隐藏列
    // group 分组列
    // 根据列的类型进行筛选过滤，
    // all 所有列
    // visible 可见列
    // hidden 隐藏列
    // group 分组列
    /**
     * @param {?=} searchWords
     * @return {?}
     */
    ColumnFormatSettingComponent.prototype.filterColumns = 
    // 根据列的类型进行筛选过滤，
    // all 所有列
    // visible 可见列
    // hidden 隐藏列
    // group 分组列
    /**
     * @param {?=} searchWords
     * @return {?}
     */
    function (searchWords) {
        var _this = this;
        if (searchWords === void 0) { searchWords = ''; }
        /** @type {?} */
        var cols = [];
        if (this.switchValue) {
            cols = this.columns[0].filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return _this.fields.indexOf(n.field) > -1; }));
        }
        else {
            cols = this.columns[0];
        }
        if (searchWords) {
            cols = cols.filter((/**
             * @param {?} c
             * @return {?}
             */
            function (c) { return c.title.toLowerCase().indexOf(searchWords) > -1; }));
        }
        this.allCols = cols;
        this._searchResult = this.allCols.filter((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n.visible; })).length;
    };
    /**
     * @param {?} col
     * @param {?} $event
     * @return {?}
     */
    ColumnFormatSettingComponent.prototype.onFieldClick = /**
     * @param {?} col
     * @param {?} $event
     * @return {?}
     */
    function (col, $event) {
        this.activeField = col;
        this.checkColumnOptions();
    };
    /**
     * @private
     * @return {?}
     */
    ColumnFormatSettingComponent.prototype.onFieldsChanged = /**
     * @private
     * @return {?}
     */
    function () {
        this.setFormatData();
        this.fieldsChange.emit(this.fields);
    };
    /**
     * @param {?} $event
     * @param {?} col
     * @return {?}
     */
    ColumnFormatSettingComponent.prototype.onDblClick = /**
     * @param {?} $event
     * @param {?} col
     * @return {?}
     */
    function ($event, col) {
        this.onCheckboxClick($event, col);
    };
    /**
     * @param {?} $event
     * @param {?} col
     * @return {?}
     */
    ColumnFormatSettingComponent.prototype.onCheckboxClick = /**
     * @param {?} $event
     * @param {?} col
     * @return {?}
     */
    function ($event, col) {
        var _this = this;
        $event.stopPropagation();
        /** @type {?} */
        var index = this.fields.indexOf(col.field);
        if (index === -1) {
            this.fields.push(col.field);
        }
        else {
            this.fields.splice(index, 1);
        }
        this.columns[0].forEach((/**
         * @param {?} f
         * @return {?}
         */
        function (f) {
            f.visible = _this.fields.indexOf(f.field) > -1;
        }));
        this.fields = this.columns[0].filter((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n.visible; })).map((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n.field; }));
        this.onFieldsChanged();
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    ColumnFormatSettingComponent.prototype.searchColumn = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        /** @type {?} */
        var txt = $event.target.value;
        this.filterColumns(txt);
    };
    /**
     * @param {?} fieldInfo
     * @param {?} txt
     * @param {?} ulElRef
     * @return {?}
     */
    ColumnFormatSettingComponent.prototype.onFieldDrop = /**
     * @param {?} fieldInfo
     * @param {?} txt
     * @param {?} ulElRef
     * @return {?}
     */
    function (fieldInfo, txt, ulElRef) {
        var _a;
        var removedIndex = fieldInfo.removedIndex, addedIndex = fieldInfo.addedIndex;
        /** @type {?} */
        var moveItem = this.allCols[removedIndex];
        /** @type {?} */
        var targetItem = this.allCols[addedIndex];
        /** @type {?} */
        var moveItemIndex = this.columns[0].findIndex((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n.field === moveItem.field; }));
        /** @type {?} */
        var targetItemIndex = this.columns[0].findIndex((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n.field === targetItem.field; }));
        /** @type {?} */
        var removedItem = this.columns[0].splice(moveItemIndex, 1);
        (_a = this.columns[0]).splice.apply(_a, tslib_1.__spread([targetItemIndex, 0], removedItem));
        this.fields = this.columns[0].filter((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n.visible; })).map((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n.field; }));
        this.onFieldsChanged();
        this.filterColumns(txt);
        // if (ulElRef) {
        //     ulElRef.querySelectorAll('li .field-drag-handle').forEach(el => {
        //         el.style.cursor = 'grab';
        //     });
        // }
    };
    /**
     * 0: 1个也没有选中； 1: 全部选中； 2: 有选中的也有没选中的
     */
    /**
     * 0: 1个也没有选中； 1: 全部选中； 2: 有选中的也有没选中的
     * @private
     * @param {?=} search
     * @return {?}
     */
    ColumnFormatSettingComponent.prototype.getCheckAllState = /**
     * 0: 1个也没有选中； 1: 全部选中； 2: 有选中的也有没选中的
     * @private
     * @param {?=} search
     * @return {?}
     */
    function (search) {
        if (search === void 0) { search = false; }
        if (this.fields.length === 0) {
            return 0;
        }
        else {
            if (search) {
                if (this._searchResult === this.allCols.length) {
                    return 1;
                }
            }
            else {
                if (this.fields.length === this.columns[0].length) {
                    return 1;
                }
            }
            return 2;
        }
    };
    /**
     * @param {?} $event
     * @param {?} txt
     * @return {?}
     */
    ColumnFormatSettingComponent.prototype.onCheckAllClick = /**
     * @param {?} $event
     * @param {?} txt
     * @return {?}
     */
    function ($event, txt) {
        var _this = this;
        /** @type {?} */
        var state = this.getCheckAllState(txt);
        /** @type {?} */
        var isVisible = state === 0 || state === 2;
        if (txt == '') {
            if (isVisible) {
                // 执行全选
                this.columns[0].forEach((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return n.visible = true; }));
                this.fields = this.columns[0].map((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return n.field; }));
            }
            else {
                // 取消全选
                this.columns[0].forEach((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return n.visible = false; }));
                this.fields = [];
            }
        }
        else {
            this.allCols.forEach((/**
             * @param {?} c
             * @return {?}
             */
            function (c) {
                /** @type {?} */
                var col = _this.columns[0].find((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return c.field === n.field; }));
                col.visible = isVisible;
                c.visible = isVisible;
            }));
            this.fields = this.columns[0].filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n.visible; })).map((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n.field; }));
        }
        this.onFieldsChanged();
        this.filterColumns(txt);
    };
    // 仅显示可见列
    // 仅显示可见列
    /**
     * @param {?} $event
     * @param {?} txt
     * @return {?}
     */
    ColumnFormatSettingComponent.prototype.onlySeeVisibleColumns = 
    // 仅显示可见列
    /**
     * @param {?} $event
     * @param {?} txt
     * @return {?}
     */
    function ($event, txt) {
        this.switchValue = $event;
        this.filterColumns(txt);
    };
    /**
     * @param {?} $event
     * @param {?} searchInput
     * @return {?}
     */
    ColumnFormatSettingComponent.prototype.clearSearch = /**
     * @param {?} $event
     * @param {?} searchInput
     * @return {?}
     */
    function ($event, searchInput) {
        if (searchInput && searchInput.value) {
            this.filterColumns('');
            searchInput.value = '';
        }
    };
    ColumnFormatSettingComponent.decorators = [
        { type: Component, args: [{
                    selector: 'column-format-setting',
                    template: "<div class=\"d-flex flex-row flex-fill dg-column-format-setting\" style=\"height: 100%\">\r\n    <div region=\"west\" class=\"west d-flex flex-column \">\r\n        <div style=\"margin: 0 6px;\">\r\n\r\n            <div class=\"input-group mb-2 scheme-manager__search-box\">\r\n                <input #inputWord type=\"text\" class=\"form-control\" placeholder=\"{{'datagrid.settings.searchPlaceholder' | locale}}\" (input)=\"searchColumn($event)\" style=\"height: 30px;\">\r\n                <div  class=\"input-group-append\" style=\"cursor: pointer\">\r\n                    <span  class=\"fa f-icon-search\" [class.f-icon-close]=\"inputWord.value\" (click)=\"clearSearch($event, inputWord)\"></span>\r\n                </div>\r\n            </div>\r\n            <div style=\"padding: 5px 0px;background-color: #fff;justify-content: space-between;align-items: center;\" class=\"d-flex flex-row\">\r\n                <button class=\"btn btn-link\" \r\n                    style=\"height: 32px;padding-left: 4px;\" (click)=\"onCheckAllClick($event, inputWord.value)\">\r\n                    <span class=\"f-icon f-icon-minus-outline checkbox\" [class.f-icon-checkbox]=\"inputWord.value.length ? !_searchResult : !fields.length\"\r\n                        [class.f-icon-checkbox-checked]=\"inputWord.value.length? (_searchResult && _searchResult == allCols.length)  : (fields.length && fields.length === columns[0].length)\"></span>\r\n                    {{ 'datagrid.settings.checkall' | locale }}\r\n                </button>\r\n\r\n                <!-- <farris-combo-list #ct \r\n                [data]=\"searchItems\" \r\n                [editable]=\"false\"\r\n                [ngModel]=\"'all'\" [idField]=\"'value'\"\r\n                [textField]=\"'title'\"\r\n                [enableClear]=\"false\"\r\n                (valueChange)=\"filterColumns(ct.selectedValues, inputWord.value)\"\r\n                style=\"float: right;\" [style.width.px]=\"isEn ? 120: 80\"\r\n                class=\"format-setting-searchitem\"></farris-combo-list> -->\r\n                <div class=\"d-flex flex-row\">{{'datagrid-scheme.onlyshowcolumns' | locale}} \r\n                    <farris-switch style=\"position: relative;\r\n                    top: 2px;\r\n                    margin-left: 5px;\"\r\n                    id=\"only-visible-columns\"\r\n                    [square]=\"false\" [size]=\"'small'\"\r\n                    [ngModel]=\"switchValue\" \r\n                    (valueChange)=\"onlySeeVisibleColumns($event, inputWord.value)\"\r\n                    ></farris-switch>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div style=\"overflow: auto;padding-right:3px\" class=\"flex-fill\">\r\n            <ul class=\"list-group  list-group-flush\" #ul column-visible-drag (drop)=\"onFieldDrop($event, inputWord.value, ul)\">\r\n                <li class=\"list-group-item list-group-item-action smooth-dnd-draggable-wrapper format-setting-column\" *ngFor=\"let col of allCols\" \r\n                    (click)=\"onFieldClick(col, $event)\" [class.active]=\"activeField && activeField.field === col.field\"\r\n                    (dblclick)=\"onDblClick($event, col)\">\r\n                    <span class=\"f-icon checkbox\"\r\n                        [class.f-icon-checkbox-checked]=\"fields.indexOf(col.field) > -1\"\r\n                        [class.f-icon-checkbox]=\"fields.indexOf(col.field) == -1\"\r\n                        (click)=\"onCheckboxClick($event, col)\"></span>\r\n                    {{ col.title}} \r\n\r\n                    <span class=\"f-icon f-icon-drag-vertical field-drag-handle\"></span>\r\n                </li>\r\n            </ul>\r\n        </div>\r\n      \r\n    </div>\r\n    <div region=\"center\" class=\"center flex-fill\" style=\"overflow:auto;padding: 0 10px; padding-left: 20px;border-right: 0;\">\r\n\r\n        <h6 style=\"margin: 15px 0px;font-weight: bold;\">{{ 'datagrid.settings.properties' | locale }}</h6>\r\n\r\n        <form #colformatform=\"ngForm\" style=\"margin-top: 5px;\">\r\n            <div class=\"farris-group-wrap mb-3\">\r\n                <div class=\"form-group farris-form-group\">\r\n                    <label for=\"hpinput01\" class=\"col-form-label\">\r\n                        <span class=\"farris-label-text\" >{{ 'datagrid.settings.headeralign' | locale }}</span>\r\n                    </label>\r\n                    <div class=\"farris-input-wrap\">\r\n\r\n                        <farris-combo-list name=\"halign\" \r\n                        [data]=\"alignItems\" \r\n                        [editable]=\"false\"\r\n                        [(ngModel)]=\"activeField!.halign\"\r\n                        [idField]=\"'value'\"\r\n                        [textField]=\"'title'\"\r\n                        [enableClear]=\"false\"></farris-combo-list>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div class=\"farris-group-wrap  mb-3\">\r\n                <div class=\"form-group farris-form-group\">\r\n                    <label for=\"hpinput01\" class=\"col-form-label\">\r\n                        <span class=\"farris-label-text\">{{ 'datagrid.settings.dataalign' | locale }}</span>\r\n                    </label>\r\n                    <div class=\"farris-input-wrap\">\r\n\r\n                        <farris-combo-list name=\"align\" \r\n                        [data]=\"alignItems\" \r\n                        [editable]=\"false\"\r\n                        [(ngModel)]=\"activeField!.align\"\r\n                        [idField]=\"'value'\"\r\n                        [textField]=\"'title'\"\r\n                        [enableClear]=\"false\"></farris-combo-list>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div class=\"farris-group-wrap  mb-3\" *ngIf=\"showGridFooter\">\r\n                <div class=\"form-group farris-form-group\">\r\n                    <label for=\"hpinput01\" class=\"col-form-label\">\r\n                        <span class=\"farris-label-text\">{{ 'datagrid.settings.summarytype' | locale }}</span>\r\n                    </label>\r\n                    <div class=\"farris-input-wrap \">\r\n                       \r\n                        <farris-combo-list name=\"footer.options.calculationType\" \r\n                        [data]=\" activeField.dataType === 'number'?  summaryItems : summaryItems2 \" \r\n                        [editable]=\"false\"\r\n                        [(ngModel)]=\"activeField.footer.options.calculationType\"\r\n                        [idField]=\"'value'\"\r\n                        [textField]=\"'title'\"\r\n                        [enableClear]=\"false\"></farris-combo-list>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <div class=\"farris-group-wrap  mb-3\" *ngIf=\"showGridFooter && (!activeField.footer.options.calculationType || activeField.footer.options.calculationType == -1)\">\r\n                <div class=\"form-group farris-form-group\">\r\n                    <label for=\"hpinput01\" class=\"col-form-label\">\r\n                        <span class=\"farris-label-text\">{{ 'datagrid.settings.summarytext' | locale }}</span>\r\n                    </label>\r\n                    <div class=\"farris-input-wrap\">\r\n                        <input type=\"input\" name=\"footer.options.text\" class=\"form-control\" [(ngModel)]=\"activeField.footer.options.text\">\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n        </form>\r\n    </div>\r\n   \r\n</div>",
                    encapsulation: ViewEncapsulation.None
                }] }
    ];
    /** @nocollapse */
    ColumnFormatSettingComponent.ctorParameters = function () { return [
        { type: Injector },
        { type: DatagridSettingsComponent },
        { type: ChangeDetectorRef }
    ]; };
    ColumnFormatSettingComponent.propDecorators = {
        columns: [{ type: Input }],
        fields: [{ type: Input }],
        colForm: [{ type: ViewChild, args: ['colformatform',] }],
        formatChange: [{ type: Output }],
        fieldsChange: [{ type: Output }]
    };
    return ColumnFormatSettingComponent;
}());
export { ColumnFormatSettingComponent };
if (false) {
    /** @type {?} */
    ColumnFormatSettingComponent.prototype.columns;
    /** @type {?} */
    ColumnFormatSettingComponent.prototype.fields;
    /** @type {?} */
    ColumnFormatSettingComponent.prototype.colForm;
    /** @type {?} */
    ColumnFormatSettingComponent.prototype.formatChange;
    /** @type {?} */
    ColumnFormatSettingComponent.prototype.fieldsChange;
    /** @type {?} */
    ColumnFormatSettingComponent.prototype.allCols;
    /**
     * format Data
     * @type {?}
     */
    ColumnFormatSettingComponent.prototype.formatData;
    /** @type {?} */
    ColumnFormatSettingComponent.prototype.columnType;
    /** @type {?} */
    ColumnFormatSettingComponent.prototype.activeField;
    /** @type {?} */
    ColumnFormatSettingComponent.prototype.showGridFooter;
    /** @type {?} */
    ColumnFormatSettingComponent.prototype.searchItems;
    /** @type {?} */
    ColumnFormatSettingComponent.prototype.alignItems;
    /** @type {?} */
    ColumnFormatSettingComponent.prototype.summaryItems;
    /** @type {?} */
    ColumnFormatSettingComponent.prototype.summaryItems2;
    /** @type {?} */
    ColumnFormatSettingComponent.prototype.localeSer;
    /** @type {?} */
    ColumnFormatSettingComponent.prototype.isEn;
    /** @type {?} */
    ColumnFormatSettingComponent.prototype.switchValue;
    /** @type {?} */
    ColumnFormatSettingComponent.prototype._searchResult;
    /**
     * @type {?}
     * @private
     */
    ColumnFormatSettingComponent.prototype.injector;
    /** @type {?} */
    ColumnFormatSettingComponent.prototype.gridSettingComponentRef;
    /**
     * @type {?}
     * @private
     */
    ColumnFormatSettingComponent.prototype.cd;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sdW1uLWZvcm1hdC1zZXR0aW5nLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktZGF0YWdyaWQtc2V0dGluZ3MvIiwic291cmNlcyI6WyJsaWIvY29sdW1uLWZvcm1hdC1zZXR0aW5nL2NvbHVtbi1mb3JtYXQtc2V0dGluZy5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDbEQsT0FBTyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQVUsUUFBUSxFQUFFLFNBQVMsRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUFFLGlCQUFpQixFQUE0QixpQkFBaUIsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNwSyxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDeEMsT0FBTyxFQUFFLHlCQUF5QixFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFFM0U7SUFpQ0ksc0NBQW9CLFFBQWtCLEVBQVMsdUJBQWtELEVBQVUsRUFBcUI7UUFBNUcsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUFTLDRCQUF1QixHQUF2Qix1QkFBdUIsQ0FBMkI7UUFBVSxPQUFFLEdBQUYsRUFBRSxDQUFtQjtRQTNCdkgsWUFBTyxHQUFHLEVBQUUsQ0FBQztRQUNiLFdBQU0sR0FBRyxFQUFFLENBQUM7UUFJWCxpQkFBWSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFDbEMsaUJBQVksR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBRTVDLFlBQU8sR0FBRyxFQUFFLENBQUM7Ozs7UUFHYixlQUFVLEdBQUcsRUFBRSxDQUFDO1FBQ2hCLGVBQVUsR0FBRyxLQUFLLENBQUM7UUFDbkIsZ0JBQVcsR0FBRyxJQUFJLENBQUM7UUFDbkIsbUJBQWMsR0FBRyxLQUFLLENBQUM7UUFFdkIsZ0JBQVcsR0FBRyxFQUFFLENBQUM7UUFDakIsZUFBVSxHQUFHLEVBQUUsQ0FBQztR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Qiw0Q0FBYTs7SUFFYixtREFBb0I7O0lBRXBCLHFEQUFrQjs7Ozs7SUFFTixnREFBMEI7O0lBQUUsK0RBQXlEOzs7OztJQUFFLDBDQUE2QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IExvY2FsZVNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWxvY2FsZSc7XHJcbmltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQsIE9uSW5pdCwgSW5qZWN0b3IsIFZpZXdDaGlsZCwgT3V0cHV0LCBFdmVudEVtaXR0ZXIsIENoYW5nZURldGVjdG9yUmVmLCBPbkNoYW5nZXMsIFNpbXBsZUNoYW5nZXMsIFZpZXdFbmNhcHN1bGF0aW9uIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IE5nRm9ybSB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcclxuaW1wb3J0IHsgRGF0YWdyaWRTZXR0aW5nc0NvbXBvbmVudCB9IGZyb20gJy4uL2RhdGFncmlkLXNldHRpbmdzLmNvbXBvbmVudCc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAnY29sdW1uLWZvcm1hdC1zZXR0aW5nJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnLi9jb2x1bW4tZm9ybWF0LXNldHRpbmcuY29tcG9uZW50Lmh0bWwnLFxyXG4gICAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZVxyXG59KVxyXG5leHBvcnQgY2xhc3MgQ29sdW1uRm9ybWF0U2V0dGluZ0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzIHtcclxuICAgIEBJbnB1dCgpIGNvbHVtbnMgPSBbXTtcclxuICAgIEBJbnB1dCgpIGZpZWxkcyA9IFtdO1xyXG5cclxuICAgIEBWaWV3Q2hpbGQoJ2NvbGZvcm1hdGZvcm0nKSBjb2xGb3JtOiBOZ0Zvcm07XHJcblxyXG4gICAgQE91dHB1dCgpIGZvcm1hdENoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIEBPdXRwdXQoKSBmaWVsZHNDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcblxyXG4gICAgYWxsQ29scyA9IFtdO1xyXG5cclxuICAgIC8qKiBmb3JtYXQgRGF0YSAqL1xyXG4gICAgZm9ybWF0RGF0YSA9IFtdO1xyXG4gICAgY29sdW1uVHlwZSA9ICdhbGwnO1xyXG4gICAgYWN0aXZlRmllbGQgPSBudWxsO1xyXG4gICAgc2hvd0dyaWRGb290ZXIgPSBmYWxzZTtcclxuXHJcbiAgICBzZWFyY2hJdGVtcyA9IFtdO1xyXG4gICAgYWxpZ25JdGVtcyA9IFtdO1xyXG4gICAgc3VtbWFyeUl0ZW1zID0gW107XHJcbiAgICBzdW1tYXJ5SXRlbXMyID0gW107XHJcbiAgICBsb2NhbGVTZXI6IExvY2FsZVNlcnZpY2U7XHJcbiAgICBpc0VuID0gZmFsc2U7XHJcblxyXG4gICAgc3dpdGNoVmFsdWUgPSBmYWxzZTtcclxuXHJcbiAgICBfc2VhcmNoUmVzdWx0ID0gMDtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGluamVjdG9yOiBJbmplY3RvciwgcHVibGljIGdyaWRTZXR0aW5nQ29tcG9uZW50UmVmOiBEYXRhZ3JpZFNldHRpbmdzQ29tcG9uZW50LCBwcml2YXRlIGNkOiBDaGFuZ2VEZXRlY3RvclJlZikge1xyXG4gICAgICAgIHRoaXMuc2hvd0dyaWRGb290ZXIgPSB0aGlzLmdyaWRTZXR0aW5nQ29tcG9uZW50UmVmLmdyaWRJbnN0YW5jZS5zaG93Rm9vdGVyICYmXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIXRoaXMuZ3JpZFNldHRpbmdDb21wb25lbnRSZWYuZ3JpZEluc3RhbmNlLmZvb3RlclRlbXBsYXRlO1xyXG4gICAgICAgIHRoaXMubG9jYWxlU2VyID0gdGhpcy5pbmplY3Rvci5nZXQoTG9jYWxlU2VydmljZSwgbnVsbCk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xyXG4gICAgICAgIGlmIChjaGFuZ2VzLmNvbHVtbnMgJiYgIWNoYW5nZXMuY29sdW1ucy5pc0ZpcnN0Q2hhbmdlKCkpIHtcclxuICAgICAgICAgICAgdGhpcy5zZXRGb3JtYXREYXRhKCk7XHJcbiAgICAgICAgICAgIHRoaXMuYWxsQ29scyA9IHRoaXMuY29sdW1uc1swXTtcclxuICAgICAgICAgICAgdGhpcy5hY3RpdmVGaWVsZCA9IHRoaXMuY29sdW1uc1swXVswXTtcclxuICAgICAgICAgICAgdGhpcy5jaGVja0NvbHVtbk9wdGlvbnMoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKTogdm9pZCB7XHJcblxyXG4gICAgICAgIHRoaXMuaXNFbiA9IHRoaXMubG9jYWxlU2VyLmxvY2FsZUlkID09PSAnZW4nO1xyXG5cclxuICAgICAgICB0aGlzLmluaXREYXRhKCk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmNvbEZvcm0pIHtcclxuICAgICAgICAgICAgdGhpcy5jb2xGb3JtLnZhbHVlQ2hhbmdlcy5zdWJzY3JpYmUodiA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuY29sRm9ybS5wcmlzdGluZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZm9ybWF0Q2hhbmdlLmVtaXQodGhpcy5mb3JtYXREYXRhKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2V0Rm9ybWF0RGF0YSgpIHtcclxuICAgICAgICAvLyB0aGlzLmZvcm1hdERhdGEgPSB0aGlzLmZpZWxkcy5tYXAobiA9PiB7XHJcbiAgICAgICAgLy8gICAgIHJldHVybiB0aGlzLmNvbHVtbnNbMF0uZmluZChjb2wgPT4gY29sLmZpZWxkID09PSBuKTtcclxuICAgICAgICAvLyB9KTtcclxuICAgICAgICB0aGlzLmZvcm1hdERhdGEgPSAgdGhpcy5jb2x1bW5zWzBdO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgaW5pdERhdGEoKSB7XHJcblxyXG4gICAgICAgIHRoaXMuYWxpZ25JdGVtcyA9IHRoaXMuZ3JpZFNldHRpbmdDb21wb25lbnRSZWYuYWxpZ25JdGVtcztcclxuICAgICAgICB0aGlzLnNlYXJjaEl0ZW1zID0gdGhpcy5ncmlkU2V0dGluZ0NvbXBvbmVudFJlZi5zZWFyY2hJdGVtcztcclxuICAgICAgICB0aGlzLnN1bW1hcnlJdGVtcyA9IHRoaXMuZ3JpZFNldHRpbmdDb21wb25lbnRSZWYuc3VtbWFyeUl0ZW1zO1xyXG4gICAgICAgIHRoaXMuc3VtbWFyeUl0ZW1zMiA9IHRoaXMuZ3JpZFNldHRpbmdDb21wb25lbnRSZWYuc3VtbWFyeUl0ZW1zMjtcclxuXHJcblxyXG4gICAgICAgIHRoaXMuc2V0Rm9ybWF0RGF0YSgpO1xyXG4gICAgICAgIHRoaXMuYWxsQ29scyA9IHRoaXMuY29sdW1uc1swXTtcclxuICAgICAgICB0aGlzLmFjdGl2ZUZpZWxkID0gdGhpcy5jb2x1bW5zWzBdWzBdO1xyXG4gICAgICAgIHRoaXMuY2hlY2tDb2x1bW5PcHRpb25zKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjaGVja0NvbHVtbk9wdGlvbnMoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuYWN0aXZlRmllbGQpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlRmllbGQuYWxsb3dHcm91cGluZyA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZUZpZWxkLmFsbG93R3JvdXBpbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVGaWVsZC5ncm91cEZvb3RlciA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZUZpZWxkLmdyb3VwRm9vdGVyID0geyBvcHRpb25zOiB7Y2FsY3VsYXRpb25UeXBlOiAtMX0gfTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlRmllbGQuZ3JvdXBGb290ZXIub3B0aW9ucyA9IHRoaXMuYWN0aXZlRmllbGQuZ3JvdXBGb290ZXIub3B0aW9ucyB8fCB7Y2FsY3VsYXRpb25UeXBlOiAtMX07XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVGaWVsZC5ncm91cEZvb3Rlci5vcHRpb25zLmNhbGN1bGF0aW9uVHlwZSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hY3RpdmVGaWVsZC5ncm91cEZvb3Rlci5vcHRpb25zLmNhbGN1bGF0aW9uVHlwZSA9IC0xO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVGaWVsZC5mb290ZXIgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hY3RpdmVGaWVsZC5mb290ZXIgPSAgeyBvcHRpb25zOiB7Y2FsY3VsYXRpb25UeXBlOiAtMX0gfTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlRmllbGQuZm9vdGVyLm9wdGlvbnMgPSB0aGlzLmFjdGl2ZUZpZWxkLmZvb3Rlci5vcHRpb25zIHx8IHtjYWxjdWxhdGlvblR5cGU6IC0xfTtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUZpZWxkLmZvb3Rlci5vcHRpb25zLmNhbGN1bGF0aW9uVHlwZSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hY3RpdmVGaWVsZC5mb290ZXIub3B0aW9ucy5jYWxjdWxhdGlvblR5cGUgPSAtMTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyDmoLnmja7liJfnmoTnsbvlnovov5vooYznrZvpgInov4fmu6TvvIxcclxuICAgIC8vIGFsbCDmiYDmnInliJdcclxuICAgIC8vIHZpc2libGUg5Y+v6KeB5YiXXHJcbiAgICAvLyBoaWRkZW4g6ZqQ6JeP5YiXXHJcbiAgICAvLyBncm91cCDliIbnu4TliJdcclxuICAgIGZpbHRlckNvbHVtbnMoIHNlYXJjaFdvcmRzID0gJycpIHtcclxuICAgICAgICBsZXQgY29scyA9IFtdO1xyXG4gICAgIFxyXG4gICAgICAgIGlmICh0aGlzLnN3aXRjaFZhbHVlKSB7XHJcbiAgICAgICAgICAgIGNvbHMgPSB0aGlzLmNvbHVtbnNbMF0uZmlsdGVyKG4gPT4gdGhpcy5maWVsZHMuaW5kZXhPZihuLmZpZWxkKSA+IC0xKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb2xzID0gdGhpcy5jb2x1bW5zWzBdO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGlmIChzZWFyY2hXb3Jkcykge1xyXG4gICAgICAgICAgICBjb2xzID0gY29scy5maWx0ZXIoYyA9PiBjLnRpdGxlLnRvTG93ZXJDYXNlKCkuaW5kZXhPZihzZWFyY2hXb3JkcykgPiAtMSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmFsbENvbHMgPSBjb2xzO1xyXG4gICAgICAgIHRoaXMuX3NlYXJjaFJlc3VsdCA9IHRoaXMuYWxsQ29scy5maWx0ZXIobiA9PiBuLnZpc2libGUpLmxlbmd0aDtcclxuICAgIH1cclxuXHJcbiAgICBvbkZpZWxkQ2xpY2soY29sLCAkZXZlbnQpIHtcclxuICAgICAgICB0aGlzLmFjdGl2ZUZpZWxkID0gY29sO1xyXG4gICAgICAgIHRoaXMuY2hlY2tDb2x1bW5PcHRpb25zKCk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHByaXZhdGUgb25GaWVsZHNDaGFuZ2VkKCkge1xyXG4gICAgICAgIHRoaXMuc2V0Rm9ybWF0RGF0YSgpO1xyXG4gICAgICAgIHRoaXMuZmllbGRzQ2hhbmdlLmVtaXQodGhpcy5maWVsZHMpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uRGJsQ2xpY2soJGV2ZW50LCBjb2wpIHtcclxuICAgICAgICB0aGlzLm9uQ2hlY2tib3hDbGljaygkZXZlbnQsIGNvbCk7XHJcbiAgICB9XHJcblxyXG4gICAgb25DaGVja2JveENsaWNrKCRldmVudCwgY29sKSB7XHJcbiAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5maWVsZHMuaW5kZXhPZihjb2wuZmllbGQpO1xyXG4gICAgICAgIGlmIChpbmRleCA9PT0gLTEpIHtcclxuICAgICAgICAgICAgdGhpcy5maWVsZHMucHVzaChjb2wuZmllbGQpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuZmllbGRzLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmNvbHVtbnNbMF0uZm9yRWFjaChmID0+IHtcclxuICAgICAgICAgICAgZi52aXNpYmxlID0gdGhpcy5maWVsZHMuaW5kZXhPZihmLmZpZWxkKSA+IC0xO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLmZpZWxkcyA9IHRoaXMuY29sdW1uc1swXS5maWx0ZXIobiA9PiBuLnZpc2libGUpLm1hcChuID0+IG4uZmllbGQpO1xyXG5cclxuICAgICAgICB0aGlzLm9uRmllbGRzQ2hhbmdlZCgpO1xyXG4gICAgfVxyXG5cclxuICAgIHNlYXJjaENvbHVtbigkZXZlbnQpIHtcclxuICAgICAgICBjb25zdCB0eHQgPSAkZXZlbnQudGFyZ2V0LnZhbHVlO1xyXG4gICAgICAgIHRoaXMuZmlsdGVyQ29sdW1ucyh0eHQpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uRmllbGREcm9wKGZpZWxkSW5mbywgdHh0LCB1bEVsUmVmOiBhbnkpIHtcclxuICAgICAgICBjb25zdCB7IHJlbW92ZWRJbmRleCwgYWRkZWRJbmRleCB9ID0gZmllbGRJbmZvO1xyXG5cclxuICAgICAgICBjb25zdCBtb3ZlSXRlbSA9IHRoaXMuYWxsQ29sc1tyZW1vdmVkSW5kZXhdO1xyXG4gICAgICAgIGNvbnN0IHRhcmdldEl0ZW0gPSB0aGlzLmFsbENvbHNbYWRkZWRJbmRleF07XHJcblxyXG4gICAgICAgIGNvbnN0IG1vdmVJdGVtSW5kZXggPSB0aGlzLmNvbHVtbnNbMF0uZmluZEluZGV4KG4gPT4gbi5maWVsZCA9PT0gbW92ZUl0ZW0uZmllbGQpO1xyXG4gICAgICAgIGNvbnN0IHRhcmdldEl0ZW1JbmRleCA9IHRoaXMuY29sdW1uc1swXS5maW5kSW5kZXgobiA9PiBuLmZpZWxkID09PSB0YXJnZXRJdGVtLmZpZWxkKTtcclxuXHJcbiAgICAgICAgY29uc3QgcmVtb3ZlZEl0ZW0gPSB0aGlzLmNvbHVtbnNbMF0uc3BsaWNlKG1vdmVJdGVtSW5kZXgsIDEpO1xyXG4gICAgICAgIHRoaXMuY29sdW1uc1swXS5zcGxpY2UodGFyZ2V0SXRlbUluZGV4LCAwLCAuLi5yZW1vdmVkSXRlbSk7XHJcblxyXG4gICAgICAgIHRoaXMuZmllbGRzID0gdGhpcy5jb2x1bW5zWzBdLmZpbHRlcihuID0+IG4udmlzaWJsZSkubWFwKG4gPT4gbi5maWVsZCk7XHJcbiAgICAgICAgdGhpcy5vbkZpZWxkc0NoYW5nZWQoKTtcclxuXHJcbiAgICAgICAgdGhpcy5maWx0ZXJDb2x1bW5zKHR4dCk7XHJcblxyXG4gICAgICAgIC8vIGlmICh1bEVsUmVmKSB7XHJcbiAgICAgICAgLy8gICAgIHVsRWxSZWYucXVlcnlTZWxlY3RvckFsbCgnbGkgLmZpZWxkLWRyYWctaGFuZGxlJykuZm9yRWFjaChlbCA9PiB7XHJcbiAgICAgICAgLy8gICAgICAgICBlbC5zdHlsZS5jdXJzb3IgPSAnZ3JhYic7XHJcbiAgICAgICAgLy8gICAgIH0pO1xyXG4gICAgICAgIC8vIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIDA6IDHkuKrkuZ/msqHmnInpgInkuK3vvJsgMTog5YWo6YOo6YCJ5Lit77ybIDI6IOaciemAieS4reeahOS5n+acieayoemAieS4reeahFxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGdldENoZWNrQWxsU3RhdGUoc2VhcmNoID0gZmFsc2UpIHtcclxuICAgICAgICBpZiAodGhpcy5maWVsZHMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlmIChzZWFyY2gpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9zZWFyY2hSZXN1bHQgPT09IHRoaXMuYWxsQ29scy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmZpZWxkcy5sZW5ndGggPT09IHRoaXMuY29sdW1uc1swXS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gMjtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgb25DaGVja0FsbENsaWNrKCRldmVudCwgdHh0KSB7XHJcbiAgICAgICAgY29uc3Qgc3RhdGUgPSB0aGlzLmdldENoZWNrQWxsU3RhdGUodHh0KTtcclxuICAgICAgICBjb25zdCBpc1Zpc2libGUgPSBzdGF0ZSA9PT0gMCB8fCBzdGF0ZSA9PT0gMjtcclxuICAgICAgICBpZiAodHh0ID09ICcnKSB7XHJcbiAgICAgICAgICAgIGlmIChpc1Zpc2libGUpIHtcclxuICAgICAgICAgICAgICAgIC8vIOaJp+ihjOWFqOmAiVxyXG4gICAgICAgICAgICAgICAgdGhpcy5jb2x1bW5zWzBdLmZvckVhY2gobiA9PiBuLnZpc2libGUgPSB0cnVlKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZmllbGRzID0gdGhpcy5jb2x1bW5zWzBdLm1hcChuID0+IG4uZmllbGQpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8g5Y+W5raI5YWo6YCJXHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbHVtbnNbMF0uZm9yRWFjaChuID0+IG4udmlzaWJsZSA9IGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZmllbGRzID0gW107XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmFsbENvbHMuZm9yRWFjaChjID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNvbCA9IHRoaXMuY29sdW1uc1swXS5maW5kKG4gPT4gYy5maWVsZCA9PT0gbi5maWVsZCk7XHJcbiAgICAgICAgICAgICAgICBjb2wudmlzaWJsZSA9IGlzVmlzaWJsZTtcclxuICAgICAgICAgICAgICAgIGMudmlzaWJsZSA9IGlzVmlzaWJsZTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHRoaXMuZmllbGRzID0gdGhpcy5jb2x1bW5zWzBdLmZpbHRlcihuID0+IG4udmlzaWJsZSkubWFwKG4gPT4gbi5maWVsZCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLm9uRmllbGRzQ2hhbmdlZCgpO1xyXG4gICAgICAgIHRoaXMuZmlsdGVyQ29sdW1ucyh0eHQpO1xyXG4gICAgfVxyXG5cclxuICAgICAvLyDku4XmmL7npLrlj6/op4HliJdcclxuICAgICBvbmx5U2VlVmlzaWJsZUNvbHVtbnMoJGV2ZW50LCB0eHQpIHtcclxuICAgICAgICB0aGlzLnN3aXRjaFZhbHVlID0gJGV2ZW50O1xyXG4gICAgICAgIHRoaXMuZmlsdGVyQ29sdW1ucyh0eHQpO1xyXG4gICAgfVxyXG5cclxuICAgIGNsZWFyU2VhcmNoKCRldmVudCwgc2VhcmNoSW5wdXQpIHtcclxuICAgICAgICBpZiAoc2VhcmNoSW5wdXQgJiYgc2VhcmNoSW5wdXQudmFsdWUpIHtcclxuICAgICAgICAgICAgdGhpcy5maWx0ZXJDb2x1bW5zKCcnKTtcclxuICAgICAgICAgICAgc2VhcmNoSW5wdXQudmFsdWUgPSAnJztcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIl19