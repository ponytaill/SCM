/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { LocaleService } from '@farris/ui-locale';
import { Component, Input, ComponentFactoryResolver, Injector, ApplicationRef, Renderer2, ViewChild, ElementRef, ChangeDetectorRef, NgZone } from '@angular/core';
import { delay, filter } from 'rxjs/operators';
import ResizeObserver from 'resize-observer-polyfill';
import { ColumnFilterType } from '@farris/ui-datagrid';
import { FilterOperator, TextFilterOperators, NumberOrDateFilterOperators, FilterConditionValue, } from './../operations/operators';
import { FilterRowPanelComponent } from './filter-row-panel.component';
import { DatagridFilterRowService } from '../datagrid-filter-row.service';
import { FilterRowEditorComponent } from './filter-row-editor.component';
export class FilterTextboxComponent extends FilterRowEditorComponent {
    /**
     * @param {?} cfr
     * @param {?} injector
     * @param {?} app
     * @param {?} dfrs
     * @param {?} render
     * @param {?} cd
     * @param {?} localSer
     */
    constructor(cfr, injector, app, dfrs, render, cd, localSer) {
        super();
        this.cfr = cfr;
        this.injector = injector;
        this.app = app;
        this.dfrs = dfrs;
        this.render = render;
        this.cd = cd;
        this.localSer = localSer;
        this.disabled = false;
        this.delay = 300;
        this.filterStr = '';
        this.filterPanelSubscription = null;
        this.ro = null;
        this.zone = null;
        this.el = null;
        this.zone = this.injector.get(NgZone);
        this.el = this.injector.get(ElementRef);
        this.dfrs.filterTextboxChanged.pipe(filter((/**
         * @param {?} v
         * @return {?}
         */
        v => v[this.column.field] !== undefined)), delay(this.delay)).subscribe((/**
         * @param {?} obj
         * @return {?}
         */
        (obj) => {
            /** @type {?} */
            const val = obj[this.column.field];
            if (val !== '') {
                /** @type {?} */
                const _condition = { operator1: FilterOperator.Contains, value1: val };
                if (this.column.filter.type === ColumnFilterType.number) {
                    _condition.operator1 = FilterOperator.Equal;
                }
                this.dfrs.updateColumnConditions(this.column.field, _condition);
            }
            else {
                this.dfrs.updateColumnConditions(this.column.field, FilterConditionValue.All);
            }
        }));
        this.dfrs.removeField.subscribe((/**
         * @param {?} f
         * @return {?}
         */
        f => {
            if (f === this.column.field) {
                this.clearValue();
            }
        }));
    }
    /**
     * @return {?}
     */
    get inputType() {
        if (this.column.filter.type === ColumnFilterType.number) {
            return 'number';
        }
        return 'text';
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        if (this.ro) {
            this.ro.disconnect();
        }
    }
    /**
     * @param {?} event
     * @return {?}
     */
    show(event) {
        this.close();
        event.stopPropagation();
        /** @type {?} */
        const dgContainerEle = ((/** @type {?} */ (event.target))).closest('.f-datagrid');
        if (dgContainerEle) {
            dgContainerEle.addEventListener('click', (/**
             * @param {?} e
             * @return {?}
             */
            (e) => {
                this.close();
            }));
        }
        if (!this.dfrs.gridInstance) {
            this.dfrs.gridInstance = this.gridInstance;
        }
        /** @type {?} */
        const cf = this.cfr.resolveComponentFactory(FilterRowPanelComponent);
        this.filterPanelRef = cf.create(this.injector);
        this.app.attachView(this.filterPanelRef.hostView);
        this.filterPanelRef.instance.column = this.column;
        this.filterPanelRef.instance.gridInstance = this.gridInstance;
        this.initOperators(this.filterPanelRef.instance);
        if (this.column.filter !== false && this.column.filter !== undefined) {
            this.filterPanelRef.instance.datatype = this.column.filter.type;
            if (this.column.filter.type === ColumnFilterType.enum ||
                this.column.filter.type === ColumnFilterType.fromdata) {
                this.filterPanelRef.instance.height = 300;
            }
        }
        /** @type {?} */
        const currentColumnCondition = this.dfrs.columnConditions[this.column.field];
        if (currentColumnCondition) {
            this.filterPanelRef.instance.condition = (/** @type {?} */ (currentColumnCondition));
        }
        else {
            this.filterPanelRef.instance.condition = {
                operator1: 0,
                value1: '',
                relation: '',
                operator2: 0,
                value2: ''
            };
            // this.initOperators(this.filterPanelRef.instance);
        }
        this.filterPanelSubscription = this.filterPanelRef.instance.conditionChange.subscribe((/**
         * @param {?} condition
         * @return {?}
         */
        (condition) => {
            if (condition) {
                this.dfrs.updateColumnConditions(this.column.field, condition);
                this.filterStr = this.dfrs.condition2string(this.column, condition);
                if (this.column.filter.type < 2) {
                    this.disabled = !!this.filterStr;
                }
                this.cd.detectChanges();
            }
            else {
                this.clearValue();
                this.dfrs.updateColumnConditions(this.column.field, FilterConditionValue.All);
            }
        }));
        document.body.appendChild(this.filterPanelRef.location.nativeElement);
        document.body.style.overflow = 'hidden';
        this.updateFilterPanelPosition(event.target);
        this.dfrs.setFilterPanel(this.filterPanelRef);
        const { width: dgWidth, height: dgHeight } = dgContainerEle.getBoundingClientRect();
        this.zone.runOutsideAngular((/**
         * @return {?}
         */
        () => {
            this.ro = new ResizeObserver((/**
             * @param {?} entries
             * @param {?} observer
             * @return {?}
             */
            (entries, observer) => {
                const { width, height } = entries[0].target.getBoundingClientRect();
                if (width !== dgWidth || height !== dgHeight) {
                    this.close();
                }
            }));
            this.ro.observe(dgContainerEle);
        }));
        this.filterPanelRef.instance.target = event;
        this.filterPanelRef.changeDetectorRef.markForCheck();
        this.filterPanelRef.changeDetectorRef.detectChanges();
    }
    /**
     * @return {?}
     */
    close() {
        this.dfrs.closeFilterPanel();
        if (this.filterPanelSubscription) {
            this.filterPanelSubscription.unsubscribe();
            this.filterPanelSubscription = null;
        }
    }
    /**
     * @private
     * @param {?} ins
     * @return {?}
     */
    initOperators(ins) {
        if (this.column.filter.type === ColumnFilterType.string) {
            ins.operators = TextFilterOperators;
            ins.condition.operator1 = FilterOperator.Contains;
            ins.condition.operator2 = FilterOperator.Contains;
        }
        else if (this.column.filter.type === ColumnFilterType.number || this.column.filter.type === ColumnFilterType.datetime
            || this.column.filter.type === ColumnFilterType.date || this.column.filter.type === ColumnFilterType.time) {
            ins.operators = NumberOrDateFilterOperators;
            ins.condition.operator1 = FilterOperator.Equal;
            ins.condition.operator2 = FilterOperator.Equal;
        }
        if (ins.operators) {
            ins.operators.forEach((/**
             * @param {?} o
             * @return {?}
             */
            o => {
                o.label = this.dfrs.getOperatorLabel(o.code);
            }));
        }
    }
    /**
     * @private
     * @param {?} target
     * @return {?}
     */
    updateFilterPanelPosition(target) {
        if (target) {
            /** @type {?} */
            const filterIconParent = target.parentElement;
            if (filterIconParent) {
                /** @type {?} */
                const pos = filterIconParent.getBoundingClientRect();
                /** @type {?} */
                const tr = target.closest('tr');
                /** @type {?} */
                const td = target.closest('td');
                /** @type {?} */
                const headerPos = target.closest('.f-datagrid-header').getBoundingClientRect();
                /** @type {?} */
                const panelWidth = this.filterPanelRef.instance.width;
                /** @type {?} */
                let left = pos.left;
                if (headerPos.width + headerPos.x < pos.x + panelWidth) { // this.column.filter.type === ColumnFilterType.enum
                    left = td.getBoundingClientRect().left + td.offsetWidth - panelWidth;
                    this.filterPanelRef.location.nativeElement.querySelector('.panel-icon').style.left = `${panelWidth - 40}px`;
                }
                // const top = pos.top
                /** @type {?} */
                const panel = this.filterPanelRef.location.nativeElement.querySelector('div');
                if (panel) {
                    this.render.setStyle(panel, 'top', `${pos.top}px`);
                    this.render.setStyle(panel, 'left', `${left}px`);
                }
            }
        }
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onTextValueChange($event) {
        /** @type {?} */
        const value = $event.target.value;
        this.dfrs.filterTextboxChanged.emit({ [this.column.field]: value });
    }
    /**
     * @return {?}
     */
    clearValue() {
        this.filterStr = '';
        if (this.input) {
            this.input.nativeElement.value = '';
        }
        if (this.column.filter.type < 2) {
            this.disabled = false;
        }
        this.cd.detectChanges();
    }
    /**
     * @param {?} condition
     * @return {?}
     */
    initFilter(condition) {
        this.filterStr = this.dfrs.condition2string(this.column, condition);
        this.disabled = !!this.filterStr;
        this.dfrs._updateColumnConditions(this.column.field, condition);
        this.cd.detectChanges();
    }
}
FilterTextboxComponent.decorators = [
    { type: Component, args: [{
                selector: 'filter-textbox',
                template: `
    <div class="f-datagrid-header-cell-content f-datagrid-filter-cell d-flex" style="padding-right: 5px">
        <div class="f-datagrid-cell-formgroup farris-group-auto flex-fill">
            <input *ngIf="!disabled" class="form-control" [attr.type]="inputType" [value]="filterStr"
                (input)="onTextValueChange($event)" #input>
            <input *ngIf="disabled" class="form-control" type="text" [value]="filterStr"
            [attr.title]="filterStr" [disabled]="disabled" [class.filter-editor-disabled]="disabled" >
        </div>
        <div style="min-width: 26px; text-align: center; align-items: center;
            display: flex; justify-content: center;" *ngIf="column.filter.enableOperator">
            <span style="cursor: pointer;" class="f-icon f-icon-filter-sm" (click)="show($event)"></span>
        </div>
    </div>
    `
            }] }
];
/** @nocollapse */
FilterTextboxComponent.ctorParameters = () => [
    { type: ComponentFactoryResolver },
    { type: Injector },
    { type: ApplicationRef },
    { type: DatagridFilterRowService },
    { type: Renderer2 },
    { type: ChangeDetectorRef },
    { type: LocaleService }
];
FilterTextboxComponent.propDecorators = {
    column: [{ type: Input }],
    disabled: [{ type: Input }],
    delay: [{ type: Input }],
    input: [{ type: ViewChild, args: ['input',] }]
};
if (false) {
    /** @type {?} */
    FilterTextboxComponent.prototype.column;
    /** @type {?} */
    FilterTextboxComponent.prototype.disabled;
    /** @type {?} */
    FilterTextboxComponent.prototype.delay;
    /** @type {?} */
    FilterTextboxComponent.prototype.filterStr;
    /** @type {?} */
    FilterTextboxComponent.prototype.gridInstance;
    /** @type {?} */
    FilterTextboxComponent.prototype.filterPanelRef;
    /** @type {?} */
    FilterTextboxComponent.prototype.filterPanelSubscription;
    /** @type {?} */
    FilterTextboxComponent.prototype.input;
    /**
     * @type {?}
     * @private
     */
    FilterTextboxComponent.prototype.ro;
    /**
     * @type {?}
     * @private
     */
    FilterTextboxComponent.prototype.zone;
    /**
     * @type {?}
     * @private
     */
    FilterTextboxComponent.prototype.el;
    /**
     * @type {?}
     * @private
     */
    FilterTextboxComponent.prototype.cfr;
    /**
     * @type {?}
     * @private
     */
    FilterTextboxComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    FilterTextboxComponent.prototype.app;
    /** @type {?} */
    FilterTextboxComponent.prototype.dfrs;
    /**
     * @type {?}
     * @private
     */
    FilterTextboxComponent.prototype.render;
    /**
     * @type {?}
     * @private
     */
    FilterTextboxComponent.prototype.cd;
    /**
     * @type {?}
     * @private
     */
    FilterTextboxComponent.prototype.localSer;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsdGVyLXJvdy10ZXh0Ym94LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktZGF0YWdyaWQtZmlsdGVyLyIsInNvdXJjZXMiOlsibGliL2ZpbHRlci1lZGl0b3JzL2ZpbHRlci1yb3ctdGV4dGJveC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNsRCxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSx3QkFBd0IsRUFBRSxRQUFRLEVBQWdCLGNBQWMsRUFDdkYsU0FBUyxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxFQUFhLE1BQU0sZUFBZSxDQUFDO0FBRWxHLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFnQixNQUFNLGdCQUFnQixDQUFDO0FBRTdELE9BQU8sY0FBYyxNQUFNLDBCQUEwQixDQUFDO0FBRXRELE9BQU8sRUFBRSxnQkFBZ0IsRUFBcUIsTUFBTSxxQkFBcUIsQ0FBQztBQUUxRSxPQUFPLEVBQUUsY0FBYyxFQUNmLG1CQUFtQixFQUFFLDJCQUEyQixFQUFFLG9CQUFvQixHQUFHLE1BQU0sMkJBQTJCLENBQUM7QUFDbkgsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFDdkUsT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFDMUUsT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFtQnpFLE1BQU0sT0FBTyxzQkFBdUIsU0FBUSx3QkFBd0I7Ozs7Ozs7Ozs7SUF5QmhFLFlBQ1ksR0FBNkIsRUFBVSxRQUFrQixFQUFVLEdBQW1CLEVBQ3ZGLElBQThCLEVBQVUsTUFBaUIsRUFBVSxFQUFxQixFQUN2RixRQUF1QjtRQUUvQixLQUFLLEVBQUUsQ0FBQztRQUpBLFFBQUcsR0FBSCxHQUFHLENBQTBCO1FB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ZSB9IGZyb20gJ0BmYXJyaXMvdWktbG9jYWxlJztcclxuaW1wb3J0IHsgQ29tcG9uZW50LCBJbnB1dCwgQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLCBJbmplY3RvciwgQ29tcG9uZW50UmVmLCBBcHBsaWNhdGlvblJlZixcclxuICAgIFJlbmRlcmVyMiwgVmlld0NoaWxkLCBFbGVtZW50UmVmLCBDaGFuZ2VEZXRlY3RvclJlZiwgTmdab25lLCBPbkRlc3Ryb3kgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IGRlbGF5LCBmaWx0ZXIsIGRlYm91bmNlVGltZSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuXHJcbmltcG9ydCBSZXNpemVPYnNlcnZlciBmcm9tICdyZXNpemUtb2JzZXJ2ZXItcG9seWZpbGwnO1xyXG5cclxuaW1wb3J0IHsgQ29sdW1uRmlsdGVyVHlwZSwgRGF0YWdyaWRDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLWRhdGFncmlkJztcclxuXHJcbmltcG9ydCB7IEZpbHRlck9wZXJhdG9yLCBGaWx0ZXJDb25kaXRpb24sXHJcbiAgICAgICAgVGV4dEZpbHRlck9wZXJhdG9ycywgTnVtYmVyT3JEYXRlRmlsdGVyT3BlcmF0b3JzLCBGaWx0ZXJDb25kaXRpb25WYWx1ZSwgfSBmcm9tICcuLy4uL29wZXJhdGlvbnMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgRmlsdGVyUm93UGFuZWxDb21wb25lbnQgfSBmcm9tICcuL2ZpbHRlci1yb3ctcGFuZWwuY29tcG9uZW50JztcclxuaW1wb3J0IHsgRGF0YWdyaWRGaWx0ZXJSb3dTZXJ2aWNlIH0gZnJvbSAnLi4vZGF0YWdyaWQtZmlsdGVyLXJvdy5zZXJ2aWNlJztcclxuaW1wb3J0IHsgRmlsdGVyUm93RWRpdG9yQ29tcG9uZW50IH0gZnJvbSAnLi9maWx0ZXItcm93LWVkaXRvci5jb21wb25lbnQnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ2ZpbHRlci10ZXh0Ym94JyxcclxuICAgIHRlbXBsYXRlOiBgXHJcbiAgICA8ZGl2IGNsYXNzPVwiZi1kYXRhZ3JpZC1oZWFkZXItY2VsbC1jb250ZW50IGYtZGF0YWdyaWQtZmlsdGVyLWNlbGwgZC1mbGV4XCIgc3R5bGU9XCJwYWRkaW5nLXJpZ2h0OiA1cHhcIj5cclxuICAgICAgICA8ZGl2IGNsYXNzPVwiZi1kYXRhZ3JpZC1jZWxsLWZvcm1ncm91cCBmYXJyaXMtZ3JvdXAtYXV0byBmbGV4LWZpbGxcIj5cclxuICAgICAgICAgICAgPGlucHV0ICpuZ0lmPVwiIWRpc2FibGVkXCIgY2xhc3M9XCJmb3JtLWNvbnRyb2xcIiBbYXR0ci50eXBlXT1cImlucHV0VHlwZVwiIFt2YWx1ZV09XCJmaWx0ZXJTdHJcIlxyXG4gICAgICAgICAgICAgICAgKGlucHV0KT1cIm9uVGV4dFZhbHVlQ2hhbmdlKCRldmVudClcIiAjaW5wdXQ+XHJcbiAgICAgICAgICAgIDxpbnB1dCAqbmdJZj1cImRpc2FibGVkXCIgY2xhc3M9XCJmb3JtLWNvbnRyb2xcIiB0eXBlPVwidGV4dFwiIFt2YWx1ZV09XCJmaWx0ZXJTdHJcIlxyXG4gICAgICAgICAgICBbYXR0ci50aXRsZV09XCJmaWx0ZXJTdHJcIiBbZGlzYWJsZWRdPVwiZGlzYWJsZWRcIiBbY2xhc3MuZmlsdGVyLWVkaXRvci1kaXNhYmxlZF09XCJkaXNhYmxlZFwiID5cclxuICAgICAgICA8L2Rpdj5cclxuICAgICAgICA8ZGl2IHN0eWxlPVwibWluLXdpZHRoOiAyNnB4OyB0ZXh0LWFsaWduOiBjZW50ZXI7IGFsaWduLWl0ZW1zOiBjZW50ZXI7XHJcbiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7IGp1c3RpZnktY29udGVudDogY2VudGVyO1wiICpuZ0lmPVwiY29sdW1uLmZpbHRlci5lbmFibGVPcGVyYXRvclwiPlxyXG4gICAgICAgICAgICA8c3BhbiBzdHlsZT1cImN1cnNvcjogcG9pbnRlcjtcIiBjbGFzcz1cImYtaWNvbiBmLWljb24tZmlsdGVyLXNtXCIgKGNsaWNrKT1cInNob3coJGV2ZW50KVwiPjwvc3Bhbj5cclxuICAgICAgICA8L2Rpdj5cclxuICAgIDwvZGl2PlxyXG4gICAgYFxyXG59KVxyXG5leHBvcnQgY2xhc3MgRmlsdGVyVGV4dGJveENvbXBvbmVudCBleHRlbmRzIEZpbHRlclJvd0VkaXRvckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uRGVzdHJveSB7XHJcbiAgICBASW5wdXQoKSBjb2x1bW46IGFueTtcclxuICAgIEBJbnB1dCgpIGRpc2FibGVkID0gZmFsc2U7XHJcbiAgICBASW5wdXQoKSBkZWxheSA9IDMwMDtcclxuICAgIGZpbHRlclN0ciA9ICcnO1xyXG5cclxuICAgIGdldCBpbnB1dFR5cGUoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuY29sdW1uLmZpbHRlci50eXBlID09PSBDb2x1bW5GaWx0ZXJUeXBlLm51bWJlciApIHtcclxuICAgICAgICAgICAgcmV0dXJuICdudW1iZXInO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gJ3RleHQnO1xyXG4gICAgfVxyXG5cclxuICAgIGdyaWRJbnN0YW5jZTogRGF0YWdyaWRDb21wb25lbnQ7XHJcblxyXG4gICAgZmlsdGVyUGFuZWxSZWY6IENvbXBvbmVudFJlZjxGaWx0ZXJSb3dQYW5lbENvbXBvbmVudD47XHJcblxyXG4gICAgZmlsdGVyUGFuZWxTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbiA9IG51bGw7XHJcblxyXG4gICAgQFZpZXdDaGlsZCgnaW5wdXQnKSBpbnB1dDogRWxlbWVudFJlZjtcclxuXHJcbiAgICBwcml2YXRlIHJvOiBSZXNpemVPYnNlcnZlciB8IG51bGwgPSBudWxsO1xyXG4gICAgcHJpdmF0ZSB6b25lOiBOZ1pvbmUgPSBudWxsO1xyXG4gICAgcHJpdmF0ZSBlbDogRWxlbWVudFJlZiA9IG51bGw7XHJcblxyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgcHJpdmF0ZSBjZnI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciwgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IsIHByaXZhdGUgYXBwOiBBcHBsaWNhdGlvblJlZixcclxuICAgICAgICBwdWJsaWMgZGZyczogRGF0YWdyaWRGaWx0ZXJSb3dTZXJ2aWNlLCBwcml2YXRlIHJlbmRlcjogUmVuZGVyZXIyLCBwcml2YXRlIGNkOiBDaGFuZ2VEZXRlY3RvclJlZixcclxuICAgICAgICBwcml2YXRlIGxvY2FsU2VyOiBMb2NhbGVTZXJ2aWNlXHJcbiAgICApIHtcclxuICAgICAgICBzdXBlcigpO1xyXG5cclxuICAgICAgICB0aGlzLnpvbmUgPSB0aGlzLmluamVjdG9yLmdldChOZ1pvbmUpO1xyXG4gICAgICAgIHRoaXMuZWwgPSB0aGlzLmluamVjdG9yLmdldChFbGVtZW50UmVmKTtcclxuXHJcbiAgICAgICAgdGhpcy5kZnJzLmZpbHRlclRleHRib3hDaGFuZ2VkLnBpcGUoXHJcbiAgICAgICAgICAgIGZpbHRlcih2ID0+IHZbdGhpcy5jb2x1bW4uZmllbGRdICE9PSB1bmRlZmluZWQpLFxyXG4gICAgICAgICAgICBkZWxheSh0aGlzLmRlbGF5KVxyXG4gICAgICAgICkuc3Vic2NyaWJlKChvYmo6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCB2YWwgPSBvYmpbdGhpcy5jb2x1bW4uZmllbGRdO1xyXG4gICAgICAgICAgICBpZiAodmFsICE9PSAnJykge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgX2NvbmRpdGlvbiA9IHsgb3BlcmF0b3IxOiBGaWx0ZXJPcGVyYXRvci5Db250YWlucywgdmFsdWUxOiB2YWwgfTtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbHVtbi5maWx0ZXIudHlwZSA9PT0gQ29sdW1uRmlsdGVyVHlwZS5udW1iZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICBfY29uZGl0aW9uLm9wZXJhdG9yMSA9IEZpbHRlck9wZXJhdG9yLkVxdWFsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMuZGZycy51cGRhdGVDb2x1bW5Db25kaXRpb25zKHRoaXMuY29sdW1uLmZpZWxkLCBfY29uZGl0aW9uICk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRmcnMudXBkYXRlQ29sdW1uQ29uZGl0aW9ucyh0aGlzLmNvbHVtbi5maWVsZCwgRmlsdGVyQ29uZGl0aW9uVmFsdWUuQWxsICk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGhpcy5kZnJzLnJlbW92ZUZpZWxkLnN1YnNjcmliZShmID0+IHtcclxuICAgICAgICAgICAgaWYgKGYgPT09IHRoaXMuY29sdW1uLmZpZWxkKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsZWFyVmFsdWUoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25EZXN0cm95KCk6IHZvaWQge1xyXG4gICAgICAgIGlmICh0aGlzLnJvKSB7XHJcbiAgICAgICAgICAgIHRoaXMucm8uZGlzY29ubmVjdCgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzaG93KGV2ZW50OiBNb3VzZUV2ZW50KSB7XHJcbiAgICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG5cclxuICAgICAgICBjb25zdCBkZ0NvbnRhaW5lckVsZSA9IChldmVudC50YXJnZXQgYXMgYW55KS5jbG9zZXN0KCcuZi1kYXRhZ3JpZCcpO1xyXG4gICAgICAgIGlmIChkZ0NvbnRhaW5lckVsZSkge1xyXG4gICAgICAgICAgICBkZ0NvbnRhaW5lckVsZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCF0aGlzLmRmcnMuZ3JpZEluc3RhbmNlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGZycy5ncmlkSW5zdGFuY2UgPSB0aGlzLmdyaWRJbnN0YW5jZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGNmID0gdGhpcy5jZnIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoRmlsdGVyUm93UGFuZWxDb21wb25lbnQpO1xyXG4gICAgICAgIHRoaXMuZmlsdGVyUGFuZWxSZWYgPSBjZi5jcmVhdGUodGhpcy5pbmplY3Rvcik7XHJcbiAgICAgICAgdGhpcy5hcHAuYXR0YWNoVmlldyh0aGlzLmZpbHRlclBhbmVsUmVmLmhvc3RWaWV3KTtcclxuICAgICAgICB0aGlzLmZpbHRlclBhbmVsUmVmLmluc3RhbmNlLmNvbHVtbiA9IHRoaXMuY29sdW1uO1xyXG4gICAgICAgIHRoaXMuZmlsdGVyUGFuZWxSZWYuaW5zdGFuY2UuZ3JpZEluc3RhbmNlID0gdGhpcy5ncmlkSW5zdGFuY2U7XHJcblxyXG4gICAgICAgIHRoaXMuaW5pdE9wZXJhdG9ycyh0aGlzLmZpbHRlclBhbmVsUmVmLmluc3RhbmNlKTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuY29sdW1uLmZpbHRlciAhPT0gZmFsc2UgJiYgdGhpcy5jb2x1bW4uZmlsdGVyICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgdGhpcy5maWx0ZXJQYW5lbFJlZi5pbnN0YW5jZS5kYXRhdHlwZSA9IHRoaXMuY29sdW1uLmZpbHRlci50eXBlO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuY29sdW1uLmZpbHRlci50eXBlID09PSBDb2x1bW5GaWx0ZXJUeXBlLmVudW0gfHxcclxuICAgICAgICAgICAgICAgIHRoaXMuY29sdW1uLmZpbHRlci50eXBlID09PSBDb2x1bW5GaWx0ZXJUeXBlLmZyb21kYXRhKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZpbHRlclBhbmVsUmVmLmluc3RhbmNlLmhlaWdodCA9ICAzMDA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGN1cnJlbnRDb2x1bW5Db25kaXRpb24gPSB0aGlzLmRmcnMuY29sdW1uQ29uZGl0aW9uc1t0aGlzLmNvbHVtbi5maWVsZF07XHJcbiAgICAgICAgaWYgKGN1cnJlbnRDb2x1bW5Db25kaXRpb24pIHtcclxuICAgICAgICAgICAgdGhpcy5maWx0ZXJQYW5lbFJlZi5pbnN0YW5jZS5jb25kaXRpb24gPSBjdXJyZW50Q29sdW1uQ29uZGl0aW9uIGFzIEZpbHRlckNvbmRpdGlvbjtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmZpbHRlclBhbmVsUmVmLmluc3RhbmNlLmNvbmRpdGlvbiA9IHtcclxuICAgICAgICAgICAgICAgIG9wZXJhdG9yMTogMCxcclxuICAgICAgICAgICAgICAgIHZhbHVlMTogJycsXHJcbiAgICAgICAgICAgICAgICByZWxhdGlvbjogJycsXHJcbiAgICAgICAgICAgICAgICBvcGVyYXRvcjI6IDAsXHJcbiAgICAgICAgICAgICAgICB2YWx1ZTI6ICcnXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIC8vIHRoaXMuaW5pdE9wZXJhdG9ycyh0aGlzLmZpbHRlclBhbmVsUmVmLmluc3RhbmNlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuZmlsdGVyUGFuZWxTdWJzY3JpcHRpb24gPSB0aGlzLmZpbHRlclBhbmVsUmVmLmluc3RhbmNlLmNvbmRpdGlvbkNoYW5nZS5zdWJzY3JpYmUoKGNvbmRpdGlvbjogRmlsdGVyQ29uZGl0aW9uKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChjb25kaXRpb24pIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGZycy51cGRhdGVDb2x1bW5Db25kaXRpb25zKHRoaXMuY29sdW1uLmZpZWxkLCBjb25kaXRpb24gKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZmlsdGVyU3RyID0gdGhpcy5kZnJzLmNvbmRpdGlvbjJzdHJpbmcodGhpcy5jb2x1bW4sIGNvbmRpdGlvbik7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jb2x1bW4uZmlsdGVyLnR5cGUgPCAyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXNhYmxlZCA9ICEhdGhpcy5maWx0ZXJTdHI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2xlYXJWYWx1ZSgpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kZnJzLnVwZGF0ZUNvbHVtbkNvbmRpdGlvbnModGhpcy5jb2x1bW4uZmllbGQsIEZpbHRlckNvbmRpdGlvblZhbHVlLkFsbCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aGlzLmZpbHRlclBhbmVsUmVmLmxvY2F0aW9uLm5hdGl2ZUVsZW1lbnQpO1xyXG4gICAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUub3ZlcmZsb3cgPSAnaGlkZGVuJztcclxuXHJcbiAgICAgICAgdGhpcy51cGRhdGVGaWx0ZXJQYW5lbFBvc2l0aW9uKGV2ZW50LnRhcmdldCk7XHJcbiAgICAgICAgdGhpcy5kZnJzLnNldEZpbHRlclBhbmVsKHRoaXMuZmlsdGVyUGFuZWxSZWYpO1xyXG4gICAgICAgIGNvbnN0IHsgd2lkdGg6IGRnV2lkdGgsIGhlaWdodDogZGdIZWlnaHQgfSA9IGRnQ29udGFpbmVyRWxlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gICAgICAgIHRoaXMuem9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMucm8gPSBuZXcgUmVzaXplT2JzZXJ2ZXIoKGVudHJpZXMsIG9ic2VydmVyKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB7IHdpZHRoLCBoZWlnaHQgfSA9IGVudHJpZXNbMF0udGFyZ2V0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHdpZHRoICE9PSBkZ1dpZHRoIHx8IGhlaWdodCAhPT0gZGdIZWlnaHQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB0aGlzLnJvLm9ic2VydmUoZGdDb250YWluZXJFbGUpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLmZpbHRlclBhbmVsUmVmLmluc3RhbmNlLnRhcmdldCA9IGV2ZW50O1xyXG4gICAgICAgIHRoaXMuZmlsdGVyUGFuZWxSZWYuY2hhbmdlRGV0ZWN0b3JSZWYubWFya0ZvckNoZWNrKCk7XHJcbiAgICAgICAgdGhpcy5maWx0ZXJQYW5lbFJlZi5jaGFuZ2VEZXRlY3RvclJlZi5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgY2xvc2UoKSB7XHJcbiAgICAgICAgdGhpcy5kZnJzLmNsb3NlRmlsdGVyUGFuZWwoKTtcclxuICAgICAgICBpZiAodGhpcy5maWx0ZXJQYW5lbFN1YnNjcmlwdGlvbikge1xyXG4gICAgICAgICAgICB0aGlzLmZpbHRlclBhbmVsU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuZmlsdGVyUGFuZWxTdWJzY3JpcHRpb24gPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGluaXRPcGVyYXRvcnMoaW5zOiBGaWx0ZXJSb3dQYW5lbENvbXBvbmVudCkge1xyXG4gICAgICAgIGlmICh0aGlzLmNvbHVtbi5maWx0ZXIudHlwZSA9PT0gQ29sdW1uRmlsdGVyVHlwZS5zdHJpbmcpIHtcclxuICAgICAgICAgICAgaW5zLm9wZXJhdG9ycyA9IFRleHRGaWx0ZXJPcGVyYXRvcnM7XHJcbiAgICAgICAgICAgIGlucy5jb25kaXRpb24ub3BlcmF0b3IxID0gRmlsdGVyT3BlcmF0b3IuQ29udGFpbnM7XHJcbiAgICAgICAgICAgIGlucy5jb25kaXRpb24ub3BlcmF0b3IyID0gRmlsdGVyT3BlcmF0b3IuQ29udGFpbnM7XHJcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmNvbHVtbi5maWx0ZXIudHlwZSA9PT0gQ29sdW1uRmlsdGVyVHlwZS5udW1iZXIgfHwgdGhpcy5jb2x1bW4uZmlsdGVyLnR5cGUgPT09IENvbHVtbkZpbHRlclR5cGUuZGF0ZXRpbWVcclxuICAgICAgICAgICAgfHwgdGhpcy5jb2x1bW4uZmlsdGVyLnR5cGUgPT09IENvbHVtbkZpbHRlclR5cGUuZGF0ZSB8fCB0aGlzLmNvbHVtbi5maWx0ZXIudHlwZSA9PT0gQ29sdW1uRmlsdGVyVHlwZS50aW1lKSB7XHJcbiAgICAgICAgICAgIGlucy5vcGVyYXRvcnMgPSBOdW1iZXJPckRhdGVGaWx0ZXJPcGVyYXRvcnM7XHJcbiAgICAgICAgICAgIGlucy5jb25kaXRpb24ub3BlcmF0b3IxID0gRmlsdGVyT3BlcmF0b3IuRXF1YWw7XHJcbiAgICAgICAgICAgIGlucy5jb25kaXRpb24ub3BlcmF0b3IyID0gRmlsdGVyT3BlcmF0b3IuRXF1YWw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoaW5zLm9wZXJhdG9ycykge1xyXG4gICAgICAgICAgICBpbnMub3BlcmF0b3JzLmZvckVhY2gobyA9PiB7XHJcbiAgICAgICAgICAgICAgICBvLmxhYmVsID0gdGhpcy5kZnJzLmdldE9wZXJhdG9yTGFiZWwoby5jb2RlKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgdXBkYXRlRmlsdGVyUGFuZWxQb3NpdGlvbih0YXJnZXQpIHtcclxuICAgICAgICBpZiAodGFyZ2V0KSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGZpbHRlckljb25QYXJlbnQgPSB0YXJnZXQucGFyZW50RWxlbWVudDtcclxuICAgICAgICAgICAgaWYgKGZpbHRlckljb25QYXJlbnQpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHBvcyA9IGZpbHRlckljb25QYXJlbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB0ciA9IHRhcmdldC5jbG9zZXN0KCd0cicpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdGQgPSB0YXJnZXQuY2xvc2VzdCgndGQnKTtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBoZWFkZXJQb3MgPSB0YXJnZXQuY2xvc2VzdCgnLmYtZGF0YWdyaWQtaGVhZGVyJykuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBwYW5lbFdpZHRoID0gdGhpcy5maWx0ZXJQYW5lbFJlZi5pbnN0YW5jZS53aWR0aDtcclxuICAgICAgICAgICAgICAgIGxldCBsZWZ0ID0gcG9zLmxlZnQ7XHJcbiAgICAgICAgICAgICAgICBpZiAoaGVhZGVyUG9zLndpZHRoICsgaGVhZGVyUG9zLnggPCBwb3MueCArIHBhbmVsV2lkdGggKSB7IC8vIHRoaXMuY29sdW1uLmZpbHRlci50eXBlID09PSBDb2x1bW5GaWx0ZXJUeXBlLmVudW1cclxuICAgICAgICAgICAgICAgICAgICBsZWZ0ID0gdGQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkubGVmdCArIHRkLm9mZnNldFdpZHRoIC0gcGFuZWxXaWR0aDtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmZpbHRlclBhbmVsUmVmLmxvY2F0aW9uLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcignLnBhbmVsLWljb24nKS5zdHlsZS5sZWZ0ID0gYCR7cGFuZWxXaWR0aCAtIDQwfXB4YDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vIGNvbnN0IHRvcCA9IHBvcy50b3BcclxuICAgICAgICAgICAgICAgIGNvbnN0IHBhbmVsID0gdGhpcy5maWx0ZXJQYW5lbFJlZi5sb2NhdGlvbi5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ2RpdicpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHBhbmVsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIuc2V0U3R5bGUocGFuZWwsICd0b3AnLCBgJHtwb3MudG9wfXB4YCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIuc2V0U3R5bGUocGFuZWwsICdsZWZ0JywgYCR7bGVmdH1weGApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9uVGV4dFZhbHVlQ2hhbmdlKCRldmVudCkge1xyXG4gICAgICAgIGNvbnN0IHZhbHVlID0gJGV2ZW50LnRhcmdldC52YWx1ZTtcclxuICAgICAgICB0aGlzLmRmcnMuZmlsdGVyVGV4dGJveENoYW5nZWQuZW1pdCh7IFt0aGlzLmNvbHVtbi5maWVsZF06IHZhbHVlIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGNsZWFyVmFsdWUoKSB7XHJcbiAgICAgICAgdGhpcy5maWx0ZXJTdHIgPSAnJztcclxuICAgICAgICBpZiAodGhpcy5pbnB1dCkge1xyXG4gICAgICAgICAgICB0aGlzLmlucHV0Lm5hdGl2ZUVsZW1lbnQudmFsdWUgPSAnJztcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuY29sdW1uLmZpbHRlci50eXBlIDwgMikge1xyXG4gICAgICAgICAgICB0aGlzLmRpc2FibGVkID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgfVxyXG5cclxuICAgIGluaXRGaWx0ZXIoY29uZGl0aW9uOiBhbnkpIHtcclxuICAgICAgICB0aGlzLmZpbHRlclN0ciA9IHRoaXMuZGZycy5jb25kaXRpb24yc3RyaW5nKHRoaXMuY29sdW1uLCBjb25kaXRpb24pO1xyXG4gICAgICAgIHRoaXMuZGlzYWJsZWQgPSAhIXRoaXMuZmlsdGVyU3RyO1xyXG4gICAgICAgIHRoaXMuZGZycy5fdXBkYXRlQ29sdW1uQ29uZGl0aW9ucyh0aGlzLmNvbHVtbi5maWVsZCwgY29uZGl0aW9uKTtcclxuICAgICAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcclxuICAgIH1cclxufVxyXG4iXX0=