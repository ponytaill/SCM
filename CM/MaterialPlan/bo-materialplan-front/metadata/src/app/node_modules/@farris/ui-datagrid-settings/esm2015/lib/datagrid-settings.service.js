/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { map, switchMap } from 'rxjs/operators';
import { forkJoin, of, timer } from 'rxjs';
import { Injectable, Injector, InjectionToken, ComponentFactoryResolver, ApplicationRef } from '@angular/core';
import { BsModalService } from '@farris/ui-modal';
import { MessagerService } from '@farris/ui-messager';
import { DatagridSettingsComponent } from './datagrid-settings.component';
import { cloneDeep } from 'lodash-es';
import { LocaleService } from '@farris/ui-locale';
import { DebugService, IdService } from '@farris/ui-common';
import { SimpleColumnsComponent } from './simple-mode/simple-columns.component';
import { DatagridSchemeService } from './datagrid-scheme.service';
import { NewSchemeComponent } from './scheme/newscheme.component';
import { SchemeListComponent } from './scheme/scheme-list.component';
import { NotifyService } from '@farris/ui-notify';
import { DATAGRID_SETTINGS_LOCALEDATA } from './datagrid-settings-locale';
/** @type {?} */
export const GRID_SETTINGS_WEBAPI = new InjectionToken(' Farris DataGrid User Setting WebApi URI.');
export class DatagridSettingsService {
    /**
     * @param {?} injector
     * @param {?} modalSer
     * @param {?} messager
     * @param {?} idService
     * @param {?} localeSer
     */
    constructor(injector, modalSer, messager, idService, localeSer) {
        this.injector = injector;
        this.modalSer = modalSer;
        this.messager = messager;
        this.idService = idService;
        this.localeSer = localeSer;
        this.multiSortMsg = '列表中未开启多列排序的功能。 请检查！';
        this.columnsSortableMsg = '未开启列的排序功能。请检查！';
        this.notSupportHeaderGroupMsg = '暂不支持多表头设置';
        this.notShowDialog = '多表头暂不支持列显示设置；同时未启用列排序功能。';
        this._httpRestService = null;
        this.languages = [];
        this.gridRefs = null;
        this.activeSchemeItem = null;
        this.saving = false;
        this.cfr = null;
        this.app = null;
        this.schemeListSubscription = null;
        this.currentSchemeitem = null;
        this.debugSer = null;
        this.cfr = this.injector.get(ComponentFactoryResolver);
        this.app = this.injector.get(ApplicationRef);
        this.notifyService = this.injector.get(NotifyService, null);
        this.debugSer = this.injector.get(DebugService, null);
        this.schemeService = new DatagridSchemeService();
        this.localeSer.setLocaleData(DATAGRID_SETTINGS_LOCALEDATA);
    }
    /**
     * @return {?}
     */
    get httpRestService() {
        return this._httpRestService;
    }
    ;
    /**
     * @param {?} httpSer
     * @return {?}
     */
    set httpRestService(httpSer) {
        this._httpRestService = httpSer;
        if (this.schemeService) {
            this.schemeService.setRestService(httpSer);
        }
    }
    /**
     * @param {?=} id
     * @return {?}
     */
    destroy(id) {
        if (this.gridRefs) {
            if (id && this.gridRefs[id]) {
                this.gridRefs[id] = null;
                delete this.gridRefs[id];
            }
            else {
                if (!Object.keys(this.gridRefs).length) {
                    this.gridRefs = null;
                }
            }
        }
        this.saving = false;
        this.setActiveSchemeItem(id, null);
    }
    /**
     * @private
     * @param {?} msg
     * @param {?=} type
     * @return {?}
     */
    writeDebugMsg(msg, type = 'warn') {
        if (this.debugSer) {
            if (this.debugSer[type]) {
                this.debugSer[type](msg);
            }
            else {
                console[type](msg);
            }
        }
    }
    /**
     * @param {?} dg
     * @return {?}
     */
    registerGridInstance(dg) {
        if (!dg) {
            this.writeDebugMsg('DatagridSettingService: grid instance is null.');
            return;
        }
        /** @type {?} */
        const id = dg.id;
        this.gridRefs = this.gridRefs || {};
        if (!this.gridRefs[id]) {
            this.gridRefs[id] = dg;
        }
    }
    /**
     * @param {?} dgID
     * @return {?}
     */
    getGridInstance(dgID) {
        return this.gridRefs ? this.gridRefs[dgID] : null;
    }
    /**
     * 更新方案中的配置数据
     * @private
     * @param {?} schemeItem
     * @param {?} settings
     * @return {?}
     */
    updateSchemeSettings(schemeItem, settings) {
        if (schemeItem && settings) {
            /** @type {?} */
            const schemeContentObj = schemeItem.queryConditionString ? JSON.parse(schemeItem.queryConditionString) : {};
            if (schemeContentObj) {
                if (schemeContentObj[this.localeSer.localeId]) {
                    /** @type {?} */
                    const schemeSettings = schemeContentObj[this.localeSer.localeId] || {};
                    schemeContentObj[this.localeSer.localeId] = Object.assign(schemeSettings, settings);
                }
                else {
                    schemeContentObj[this.localeSer.localeId] = settings;
                }
                schemeItem.queryConditionString = JSON.stringify(schemeContentObj);
            }
        }
    }
    /**
     * 更新当前方案配置数据
     * @param {?} dgId
     * @param {?} settings
     * @return {?}
     */
    updateActiveSchemeItemSettings(dgId, settings) {
        /** @type {?} */
        const schemeItem = this.getActiveSchemeItem(dgId);
        this.updateSchemeSettings(schemeItem, settings);
    }
    /**
     * 设置活动的方案
     * @param {?} dgId
     * @param {?} activeItem
     * @return {?}
     */
    setActiveSchemeItem(dgId, activeItem) {
        /** @type {?} */
        const schemekey = this.schemeService.getSchemeKey(dgId);
        this.activeSchemeItem = this.activeSchemeItem || {};
        this.activeSchemeItem[schemekey] = activeItem;
    }
    /**
     * 获取当前活动的方案
     * @param {?} dgId
     * @return {?}
     */
    getActiveSchemeItem(dgId) {
        /** @type {?} */
        const schemekey = this.schemeService.getSchemeKey(dgId);
        return this.activeSchemeItem ? this.activeSchemeItem[schemekey] : null;
    }
    /**
     * @return {?}
     */
    getSearchTypes() {
        return [
            { value: 'all', title: this.localeSer.getValue('datagrid.settings.allColumns') },
            { value: 'visible', title: this.localeSer.getValue('datagrid.settings.visibleColumns') },
            { value: 'hidden', title: this.localeSer.getValue('datagrid.settings.hiddenColumns') }
        ];
    }
    /**
     * @param {?} gridInstance
     * @param {?=} settings
     * @param {?=} selectedSchemeItem
     * @return {?}
     */
    showSimple(gridInstance, settings, selectedSchemeItem) {
        /** @type {?} */
        const columns = this.convertColumnsToSimple(gridInstance.columns);
        columns[0] = [...columns[0].filter((/**
             * @param {?} n
             * @return {?}
             */
            n => n.field && n.field !== gridInstance.ControlPanelFeild))];
        /** @type {?} */
        const searchTypes = this.getSearchTypes();
        if (this.cfr) {
            /** @type {?} */
            const cmpFactory = this.cfr.resolveComponentFactory(SimpleColumnsComponent);
            /** @type {?} */
            let simpleRef = cmpFactory.create(this.injector);
            this.app.attachView(simpleRef.hostView);
            simpleRef.instance.columns = columns;
            simpleRef.instance.seartTypes = searchTypes;
            simpleRef.instance.gridInstance = gridInstance;
            if (document.querySelector('#page-wrapper')) {
                simpleRef.instance.top = 76;
            }
            simpleRef.instance.enableScheme = gridInstance.enableScheme;
            if (gridInstance.enableScheme) {
                if (settings) {
                    if (selectedSchemeItem) {
                        this.updateSchemeSettings(selectedSchemeItem, settings);
                        simpleRef.instance.currentSchemeItem = selectedSchemeItem;
                    }
                    else {
                        simpleRef.instance.currentSchemeItem = null;
                        simpleRef.instance.settings = settings;
                    }
                }
                else {
                    /** @type {?} */
                    const _currentSchemtItem = this.getActiveSchemeItem(gridInstance.id);
                    this.currentSchemeitem = _currentSchemtItem;
                    simpleRef.instance.currentSchemeItem = _currentSchemtItem;
                }
            }
            document.body.appendChild(simpleRef.location.nativeElement);
            simpleRef.instance.closed.pipe(switchMap((/**
             * @return {?}
             */
            () => {
                if (simpleRef) {
                    simpleRef.instance.container.nativeElement.style.right = '-500px';
                    return timer(500);
                }
            }))).subscribe((/**
             * @return {?}
             */
            () => {
                simpleRef.location.nativeElement.remove();
                simpleRef.destroy();
                simpleRef = null;
                if (this.schemeListSubscription) {
                    this.schemeListSubscription.unsubscribe();
                }
                /** @type {?} */
                const _activeSchemtItem = this.getActiveSchemeItem(gridInstance.id);
                if ((!this.currentSchemeitem || (_activeSchemtItem && _activeSchemtItem.id !== this.currentSchemeitem.id)) && (_activeSchemtItem && _activeSchemtItem.queryConditionString)) {
                    /** @type {?} */
                    const _currentSettings = JSON.parse(_activeSchemtItem.queryConditionString)[this.localeSer.localeId];
                    if (_currentSettings) {
                        columns[0].forEach((/**
                         * @param {?} f
                         * @return {?}
                         */
                        f => {
                            f.visible = _currentSettings.viewColumns.indexOf(f.field) > -1;
                        }));
                    }
                }
            }));
            simpleRef.instance.advanced.subscribe((/**
             * @param {?} __0
             * @return {?}
             */
            ({ viewFields }) => {
                if (viewFields && viewFields.length) {
                    this.updateSchemeSettings(simpleRef.instance.currentSchemeItem, { viewColumns: viewFields });
                }
                this.showAdvanced(gridInstance, null, simpleRef.instance.currentSchemeItem);
            }));
            simpleRef.instance.submit.subscribe((/**
             * @param {?} e
             * @return {?}
             */
            (e) => {
                e.target.disabled = true;
                if (this.saving) {
                    return;
                }
                if (!this.saving) {
                    this.setActiveSchemeItem(gridInstance.id, e.currentScheme);
                    this.updateGridView(e, gridInstance, e.target);
                }
            }));
            simpleRef.instance.fieldsChange.subscribe((/**
             * @param {?} visibleFields
             * @return {?}
             */
            (visibleFields) => {
                this.updateActiveSchemeItemSettings(gridInstance.id, { viewColumns: visibleFields });
            }));
            // 打开新增方案窗口
            simpleRef.instance.addNewScheme.subscribe((/**
             * @param {?} e
             * @return {?}
             */
            (e) => {
                this.showNewSchemeDialog(gridInstance, e, simpleRef);
            }));
            simpleRef.instance.schemeList = this.schemeService.getStateValue(gridInstance.id, 'list') || [];
            // 打开方案管理列表窗口
            simpleRef.instance.showSchemeList.subscribe((/**
             * @return {?}
             */
            () => {
                this.schemeService.getSchemeList(gridInstance.id).pipe(switchMap((/**
                 * @param {?} t
                 * @return {?}
                 */
                (t) => {
                    return this.schemeService.checkAuthority().pipe(map((/**
                     * @param {?} auth
                     * @return {?}
                     */
                    (auth) => {
                        return Object.assign({ list: t }, auth);
                    })));
                }))).subscribe((/**
                 * @param {?} t
                 * @return {?}
                 */
                (t) => {
                    this.schemeService.setSchemeList(gridInstance.id, t.list || []);
                    this.showSchemeListDialog(gridInstance, cloneDeep(t.list || []), t, simpleRef);
                }));
            }));
            this.schemeListSubscription = this.schemeService.schemeList$.subscribe((/**
             * @param {?} list
             * @return {?}
             */
            (list) => {
                simpleRef.instance.schemeList = list;
                if (!list || !list.length) {
                    this.setActiveSchemeItem(gridInstance.id, null);
                    return;
                }
                /** @type {?} */
                const _activeSchemeItem = this.getActiveSchemeItem(gridInstance.id);
                if (_activeSchemeItem) {
                    /** @type {?} */
                    let hasActiveItem = list.find((/**
                     * @param {?} n
                     * @return {?}
                     */
                    n => n.id === _activeSchemeItem.id));
                    if (!hasActiveItem) {
                        hasActiveItem = this.getDefaultScheme(list); // 获取设置为当前方案的项
                        this.setActiveSchemeItem(gridInstance.id, hasActiveItem || null);
                    }
                    simpleRef.instance.currentSchemeItem = hasActiveItem;
                }
            }));
            // 切换方案
            // simpleRef.instance.activeItemChange.subscribe((r: any) => {
            //     this.setActiveSchemeItem(gridInstance.id, r);
            // });
            simpleRef.instance.schemeChanged.subscribe((/**
             * @param {?} t
             * @return {?}
             */
            (t) => {
                this.currentSchemeitem = t;
            }));
            simpleRef.hostView.detectChanges();
            simpleRef.instance.container.nativeElement.style.right = '0px';
            return simpleRef;
        }
    }
    /**
     * @param {?} gridInstance
     * @param {?=} opts
     * @return {?}
     */
    show(gridInstance, opts) {
        this.registerGridInstance(gridInstance);
        if (gridInstance.enableSimpleMode) {
            return this.showSimple(gridInstance);
        }
        else {
            return this.showAdvanced(gridInstance, opts);
        }
    }
    /**
     * @private
     * @param {?} gridInstance
     * @param {?=} opts
     * @param {?=} selectedSchemeItem
     * @return {?}
     */
    showAdvanced(gridInstance, opts, selectedSchemeItem) {
        /** @type {?} */
        let _editColSortInfo = true;
        /** @type {?} */
        const editColSortInfo = this.canSetColumnSort(gridInstance);
        if (editColSortInfo !== true) {
            // this.messager.warning(msg);
            // return;
            _editColSortInfo = false;
        }
        /** @type {?} */
        const showSetColumnsTab = !this.isHeaderGroup(gridInstance);
        /** @type {?} */
        const getActiveTabIndex = (/**
         * @return {?}
         */
        () => {
            if (showSetColumnsTab) {
                return 1;
            }
            else {
                if (_editColSortInfo) {
                    return 2;
                }
                else {
                    return -1;
                }
            }
        });
        /** @type {?} */
        const activeTabIndex = getActiveTabIndex();
        if (activeTabIndex === -1) {
            this.messager.warning(this.notShowDialog);
            return;
        }
        /** @type {?} */
        const columns = this.convertColumnsToSimple(gridInstance.columns);
        // 获取当前方案中当前语言的配置数据
        /** @type {?} */
        let currentSettings = null;
        if (selectedSchemeItem && selectedSchemeItem.queryConditionString) {
            currentSettings = JSON.parse(selectedSchemeItem.queryConditionString)[this.localeSer.localeId];
            if (currentSettings.columnFormat && currentSettings.columnFormat.length) {
                columns[0] = columns[0].map((/**
                 * @param {?} col
                 * @return {?}
                 */
                (col) => {
                    /** @type {?} */
                    const fcol = currentSettings.columnFormat.find((/**
                     * @param {?} n
                     * @return {?}
                     */
                    n => n.field === col.field));
                    if (fcol) {
                        col = Object.assign(col, fcol);
                    }
                    return col;
                }));
            }
            if (currentSettings.viewColumns && currentSettings.viewColumns.length) {
                columns[0].forEach((/**
                 * @param {?} f
                 * @return {?}
                 */
                f => {
                    f.visible = currentSettings.viewColumns.indexOf(f.field) > -1;
                }));
            }
        }
        columns[0] = columns[0].filter((/**
         * @param {?} n
         * @return {?}
         */
        n => n.field && n.field !== gridInstance.ControlPanelFeild));
        /** @type {?} */
        const treeData = this.convertColumns2TreeData(cloneDeep(columns), true);
        /** @type {?} */
        const viewColumnsTreeData = this.convertColumns2TreeData(cloneDeep(columns), false);
        this.checkViewTreeNodes(viewColumnsTreeData);
        /** @type {?} */
        let modalRef = null;
        /** @type {?} */
        const okText = this.localeSer.getValue('datagrid.settings.ok') || '确定';
        /** @type {?} */
        const cancelText = this.localeSer.getValue('datagrid.settings.cancel') || '取消';
        /** @type {?} */
        const resetText = this.localeSer.getValue('datagrid.settings.reset') || '重置';
        /** @type {?} */
        const defaultOpts = {
            width: 760, height: 560, showHeader: false, title: '控制面板',
            initialState: {
                columns,
                sortTreeData: treeData,
                viewTreeData: viewColumnsTreeData,
                gridInstance,
                canSetColumnSort: _editColSortInfo,
                canSetColumnVisible: showSetColumnsTab,
                activeTabIndex,
                schemeInfo: currentSettings
            },
            showButtons: false
        };
        /** @type {?} */
        const modalOpts = Object.assign(defaultOpts, opts || {});
        modalRef = this.modalSer.show(DatagridSettingsComponent, modalOpts);
        /** @type {?} */
        const instance = (/** @type {?} */ (modalRef.content));
        instance.enableReset = true;
        instance.modalRef = modalRef;
        instance.canSetColumnSort = _editColSortInfo;
        instance.canSetColumnVisible = !this.isHeaderGroup(gridInstance);
        instance.submitHandle.subscribe((/**
         * @param {?} e
         * @return {?}
         */
        (e) => {
            e.target.disabled = true;
            if (this.saving) {
                return;
            }
            if (!this.saving) {
                if (selectedSchemeItem) {
                    this.setActiveSchemeItem(gridInstance.id, selectedSchemeItem);
                }
                this.updateGridView(modalRef, gridInstance, e.target);
            }
        }));
        instance.cancelHandle.subscribe((/**
         * @param {?} e
         * @return {?}
         */
        (e) => {
            modalRef.close();
        }));
        // 切换到侧边栏简洁模式
        instance.concise.subscribe((/**
         * @param {?} e
         * @return {?}
         */
        (e) => {
            modalRef.close();
            /** @type {?} */
            const settings = modalRef.content;
            const { sortInfo, viewColumns, columnFormat, groupField } = settings;
            this.showSimple(gridInstance, { sortInfo, viewColumns, columnFormat, groupField }, selectedSchemeItem);
        }));
        /** @type {?} */
        const modalContainer = (/** @type {?} */ (modalRef.dialog.instance));
        modalContainer.draggbar.handle = instance.header.nativeElement;
        return modalRef;
    }
    /**
     * @private
     * @param {?} gridInstance
     * @return {?}
     */
    canSetColumnSort(gridInstance) {
        if (gridInstance.multiSort && this.hasEnableSortColumns(gridInstance)) {
            return true;
        }
        else {
            if (!this.hasEnableSortColumns(gridInstance)) {
                return this.columnsSortableMsg;
            }
            else if (!gridInstance.multiSort) {
                return this.multiSortMsg;
            }
        }
    }
    /**
     * @private
     * @param {?} gridInstance
     * @return {?}
     */
    hasEnableSortColumns(gridInstance) {
        /** @type {?} */
        const sortColumnsCount = gridInstance.flatColumns.reduce((/**
         * @param {?} c
         * @param {?} r
         * @return {?}
         */
        (c, r) => {
            if (r.sortable) {
                return c + 1;
            }
            return c;
        }), 0);
        return sortColumnsCount > 0;
    }
    /**
     * @private
     * @param {?} grid
     * @return {?}
     */
    isHeaderGroup(grid) {
        /** @type {?} */
        const flag = grid.columns.length > 1;
        if (flag) {
            return this.notSupportHeaderGroupMsg;
        }
        return flag;
    }
    /**
     * @private
     * @param {?} cols
     * @param {?} rowIndex
     * @param {?} colStartIndex
     * @param {?} colCount
     * @param {?=} forSort
     * @return {?}
     */
    getChilds(cols, rowIndex, colStartIndex, colCount, forSort = false) {
        /** @type {?} */
        const childCols = [];
        /** @type {?} */
        let _count = colStartIndex;
        if (!cols[rowIndex]) {
            return [];
        }
        cols[rowIndex].slice().forEach((/**
         * @param {?} element
         * @return {?}
         */
        element => {
            _count = _count + element.colspan;
            if (_count <= colCount) {
                childCols.push(element);
            }
        }));
        cols[rowIndex].splice(0, childCols.length);
        return childCols.map((/**
         * @param {?} c
         * @param {?} i
         * @return {?}
         */
        (c, i) => {
            /** @type {?} */
            let n = {
                data: c,
                selectable: forSort ? !!c.sortable : true
            };
            if (c.colspan && c.colspan > 1) {
                n = {
                    data: c,
                    selectable: false,
                    expanded: true,
                    children: this.getChilds(cols, rowIndex + 1, 0, c.colspan)
                };
            }
            return n;
        }));
    }
    /**
     * @param {?} cols
     * @param {?=} forSort
     * @return {?}
     */
    convertColumns2TreeData(cols, forSort = false) {
        /** @type {?} */
        const columns = cols.map((/**
         * @param {?} c
         * @return {?}
         */
        (c) => {
            /** @type {?} */
            const aa = c.map((/**
             * @param {?} _
             * @return {?}
             */
            (_) => {
                if (_.field.indexOf('farris-datagrid-column_') == -1) {
                    _.colspan = _.colspan || 1;
                    return _;
                }
                return null;
            }));
            return aa.filter((/**
             * @param {?} n
             * @return {?}
             */
            n => n));
        }));
        if (columns.length === 1) {
            return columns[0].map((/**
             * @param {?} c
             * @return {?}
             */
            c => {
                return {
                    data: c,
                    selectable: forSort ? !!c.sortable : true
                };
            }));
        }
        else {
            return columns[0].map((/**
             * @param {?} c
             * @param {?} i
             * @return {?}
             */
            (c, i) => {
                if (c.colspan && c.colspan > 1) {
                    return {
                        data: c,
                        selectable: false,
                        expanded: true,
                        children: this.getChilds(columns, 1, 0, c.colspan, forSort)
                    };
                }
                else {
                    return {
                        data: c,
                        selectable: forSort ? !!c.sortable : true
                    };
                }
            }));
        }
    }
    /**
     * @private
     * @param {?} treeNodes
     * @return {?}
     */
    checkViewTreeNodes(treeNodes) {
        treeNodes.forEach((/**
         * @param {?} tn
         * @return {?}
         */
        (tn) => {
            if (!tn.children || !tn.children.length) {
                tn.selectable = true;
            }
            else {
                tn.selectable = false;
                this.checkViewTreeNodes(tn.children);
            }
        }));
    }
    /**
     * @private
     * @param {?} gridInstance
     * @return {?}
     */
    _convertColumnsToSimple(gridInstance) {
        /** @type {?} */
        let cols = gridInstance.columns;
        // 重置列顺序为最初设计时的顺序
        /** @type {?} */
        const gridOpts = gridInstance.dfs._state.initialOptions;
        if (gridOpts.columnFields) {
            /** @type {?} */
            let desginCols = gridOpts.columnFields;
            /** @type {?} */
            const newColumns = [];
            desginCols.forEach((/**
             * @param {?} c
             * @return {?}
             */
            c => {
                if (c.field !== '_datagrid-setting-control_') {
                    /** @type {?} */
                    const col = gridInstance.columns[0].find((/**
                     * @param {?} n
                     * @return {?}
                     */
                    (n) => n.field === c.field));
                    if (col) {
                        newColumns.push(col);
                    }
                }
            }));
            cols = [newColumns];
        }
        return cols;
    }
    /**
     * @param {?} cols
     * @return {?}
     */
    convertColumnsToSimple(cols) {
        return cols.map((/**
         * @param {?} _cols
         * @return {?}
         */
        (_cols) => {
            return _cols.map((/**
             * @param {?} c
             * @return {?}
             */
            (c) => {
                if (c.field !== '_datagrid-setting-control_') {
                    return {
                        field: c.field,
                        title: c.title,
                        colspan: c.colspan,
                        rowspan: c.rowspan,
                        sortable: c.sortable,
                        order: c.order,
                        halign: c.halign || 'left',
                        align: c.align || 'left',
                        visible: c.visible,
                        allowGrouping: c.allowGrouping,
                        groupFooter: c.groupFooter,
                        footer: c.footer,
                        width: c.width || 100,
                        dataType: c.dataType || 'string'
                    };
                }
            })).filter((/**
             * @param {?} n
             * @return {?}
             */
            n => n));
        }));
    }
    /**
     * @private
     * @param {?} gridInstance
     * @return {?}
     */
    resetGridView(gridInstance) {
        if (!gridInstance) {
            return;
        }
        /** @type {?} */
        const dfs = gridInstance.dfs;
        if (dfs) {
            /** @type {?} */
            const options = dfs['_state'].initialOptions;
            if (options.sort) {
                if (options.sort.sortName) {
                    gridInstance.sortName = options.sort.sortName;
                }
                if (options.sort.sortOrder) {
                    gridInstance.sortOrder = options.sort.sortOrder;
                }
            }
            gridInstance.groupField = options.groupField || '';
            // TODO: 还需要修正默认列的显示顺序
            if (options.columnFields && options.columnFields.length) {
                /** @type {?} */
                const newColumns = [];
                options.columnFields.forEach((/**
                 * @param {?} c
                 * @return {?}
                 */
                c => {
                    /** @type {?} */
                    const col = gridInstance.columns[0].find((/**
                     * @param {?} n
                     * @return {?}
                     */
                    (n) => n.field === c.field));
                    if (col) {
                        col.visible = c.visible;
                        col.halign = c.halign;
                        col.align = c.align;
                        col.width = c.width;
                        col.footer = c.footer;
                        col.groupFooter = c.groupFooter;
                        newColumns.push(col);
                    }
                }));
                gridInstance.columns[0] = newColumns;
            }
            // gridInstance['checkOptions']();
            gridInstance['columnsChanged']();
        }
    }
    /**
     * @private
     * @param {?} modalRef
     * @param {?} gridInstance
     * @param {?=} btn
     * @return {?}
     */
    updateGridView(modalRef, gridInstance, btn = null) {
        /** @type {?} */
        const settings = modalRef.content;
        if (settings) {
            const { sortInfo, viewColumns, columnFormat, groupField, groupRowState } = settings;
            /** @type {?} */
            const _colformats = columnFormat ? this.convertColumnsToSimple([columnFormat])[0] : [];
            this.updateActiveSchemeItemSettings(gridInstance.id, { sortInfo, viewColumns, columnFormat: _colformats, groupField });
            this.saving = true;
            /** @type {?} */
            let _groupField = '';
            if (gridInstance.groupRows && groupField && groupField.length) {
                _groupField = groupField.join(',');
                gridInstance.expandGroupRows = groupRowState;
            }
            gridInstance.groupField = _groupField;
            /** @type {?} */
            const saveData = { sortInfo, viewColumns, groupField: _groupField, columnFormat: _colformats, expandGroupRows: groupRowState };
            this.setUserConfig(gridInstance.id, saveData).subscribe((/**
             * @return {?}
             */
            () => {
                if (btn) {
                    btn.disabled = false;
                }
                this.saving = false;
                if (viewColumns && viewColumns.length) {
                    gridInstance.columns = gridInstance.columns.map((/**
                     * @param {?} cols
                     * @return {?}
                     */
                    cols => {
                        this.updateColumnFormat(cols, columnFormat, gridInstance);
                        return this.newVisibleOrderColumns(cols, viewColumns, columnFormat, gridInstance);
                    }));
                }
                gridInstance.columnsChanged(true);
                if (sortInfo && Object.keys(sortInfo).length) {
                    const { sortName, sortOrder } = sortInfo;
                    if (sortName && sortName.length) {
                        gridInstance.sort(sortName.join(','), sortOrder.join(','));
                    }
                    else {
                        gridInstance.clearSort();
                    }
                }
                else {
                    gridInstance.clearSort();
                }
                modalRef.close();
            }));
        }
        else {
            modalRef.close();
        }
    }
    /**
     * @param {?} cols
     * @param {?} viewColumns
     * @param {?} columnFormat
     * @param {?} gridInstance
     * @return {?}
     */
    newVisibleOrderColumns(cols, viewColumns, columnFormat, gridInstance) {
        /** @type {?} */
        const hideColumns = [];
        cols.forEach((/**
         * @param {?} element
         * @param {?} index
         * @return {?}
         */
        (element, index) => {
            if (this.isNewAddColumn(element.field, columnFormat) && element.field !== '_datagrid-setting-control_' && !gridInstance.enableScheme) {
                viewColumns.push(element.field);
            }
            else {
                element.visible = viewColumns.includes(element.field);
                if (!element.visible) {
                    hideColumns.push(element);
                }
            }
        }));
        // 清理不存在的列
        /** @type {?} */
        let newCols = viewColumns.map((/**
         * @param {?} field
         * @return {?}
         */
        field => {
            return cols.find((/**
             * @param {?} c
             * @return {?}
             */
            c => c.field === field));
        })).filter((/**
         * @param {?} n
         * @return {?}
         */
        n => n));
        if (hideColumns.length) {
            newCols = newCols.concat(hideColumns);
        }
        return newCols.filter((/**
         * @param {?} c
         * @return {?}
         */
        c => c && c.field && c.field !== '_datagrid-setting-control_'));
    }
    /**
     * 是否为新增加的字段
     * 新增的字段，需要在列表中展示出来，并保存到个性化设置中
     * @private
     * @param {?} field
     * @param {?} columns
     * @return {?}
     */
    isNewAddColumn(field, columns) {
        columns = columns || [];
        return !columns.find((/**
         * @param {?} c
         * @return {?}
         */
        c => c.field === field));
    }
    /**
     * @param {?} cols
     * @param {?} columnFormat
     * @param {?} gridInstance
     * @return {?}
     */
    updateColumnFormat(cols, columnFormat, gridInstance) {
        if (columnFormat && columnFormat.length) {
            cols.forEach((/**
             * @param {?} col
             * @return {?}
             */
            col => {
                /** @type {?} */
                const formatCol = columnFormat.find((/**
                 * @param {?} f
                 * @return {?}
                 */
                f => f.field === col.field));
                if (formatCol) {
                    col.width = formatCol.width;
                    col.halign = formatCol.halign || 'left';
                    col.align = formatCol.align || 'left';
                    if (gridInstance.groupRows && (col.allowGrouping || col.allowGrouping === undefined)) {
                        if (!col.groupFooter) {
                            col.groupFooter = formatCol.groupFooter;
                        }
                        if (col.groupFooter && col.groupFooter.options) {
                            col.groupFooter.options.text = formatCol.groupFooter.options.text || '';
                            col.groupFooter.options.calculationType =
                                formatCol.groupFooter.options.calculationType !== undefined &&
                                    formatCol.groupFooter.options.calculationType !== null ?
                                    parseInt(formatCol.groupFooter.options.calculationType, 10) : -1;
                        }
                    }
                    if (gridInstance.showFooter && !gridInstance.footerTemplate) {
                        if (!col.footer) {
                            col.footer = formatCol.footer;
                        }
                        if (col.footer && col.footer.options) {
                            col.footer.options.text = formatCol.footer.options.text || '';
                            col.footer.options.calculationType =
                                formatCol.footer.options.calculationType !== undefined &&
                                    formatCol.footer.options.calculationType !== null ?
                                    parseInt(formatCol.footer.options.calculationType, 10) : -1;
                        }
                    }
                }
            }));
        }
    }
    // 创建唯一key, 由uri + gridId 组成，并混淆
    /**
     * @private
     * @param {?} gridId
     * @return {?}
     */
    createConfigKey(gridId) {
        /** @type {?} */
        const grid = this.getGridInstance(gridId);
        if (grid) {
            return grid.dgs.createConfigKey(gridId);
        }
        else {
            this.writeDebugMsg('DatagridSettingService: Can not find the grid instance.');
        }
    }
    /**
     * @private
     * @param {?} gridId
     * @return {?}
     */
    getCurrentUserSettings(gridId) {
        /** @type {?} */
        const gridInstance = this.getGridInstance(gridId);
        /** @type {?} */
        const config = { sortInfo: {}, viewColumns: [], groupField: '', columnFormat: [] };
        if (gridInstance) {
            const { sortName, sortOrder, columns } = gridInstance;
            if (sortName) {
                /** @type {?} */
                const sortInfo = {
                    sortName: sortName.split(','),
                    sortOrder: sortOrder.split(',')
                };
                config.sortInfo = sortInfo;
            }
            /** @type {?} */
            const viewColumns = columns[0].filter((/**
             * @param {?} n
             * @return {?}
             */
            n => n.visible || n.visible === undefined)).map((/**
             * @param {?} n
             * @return {?}
             */
            n => n.field));
            config.viewColumns = viewColumns;
            config.columnFormat = this.convertColumnsToSimple(this._convertColumnsToSimple(gridInstance))[0];
            if (gridInstance.groupRows) {
                config.groupField = gridInstance.groupField;
            }
        }
        return config;
    }
    /**
     * @param {?} gridId
     * @return {?}
     */
    saveUserConfig(gridId) {
        /** @type {?} */
        const config = this.getCurrentUserSettings(gridId);
        return this.setUserConfig(gridId, config);
    }
    /**
     * @param {?} gridId
     * @param {?} config
     * @return {?}
     */
    setUserConfig(gridId, config) {
        /** @type {?} */
        const key = this.createConfigKey(gridId);
        /** @type {?} */
        const LOCALEID = this.localeSer.localeId;
        /** @type {?} */
        const currentConfig = localStorage.getItem(key);
        /** @type {?} */
        const _config = (currentConfig ? JSON.parse(currentConfig) : {}) || {};
        if (config) {
            if (_config) {
                _config[LOCALEID] = config;
            }
            localStorage.setItem(key, JSON.stringify(_config));
        }
        else {
            localStorage.removeItem(key);
        }
        if (this.httpRestService) {
            /** @type {?} */
            const gridIns = this.getGridInstance(gridId);
            if (gridIns && gridIns.enableScheme) {
                /** @type {?} */
                const activeScheme = this.getActiveSchemeItem(gridId);
                if (activeScheme) {
                    // return this.updateScheme(gridId, config);
                    if (activeScheme.type === 'private') {
                        return this.schemeService.saveScheme(activeScheme, gridId, true);
                    }
                    else {
                        return this.schemeService.checkAuthority().pipe(switchMap((/**
                         * @param {?} t
                         * @return {?}
                         */
                        (t) => {
                            if (t.success) {
                                /** @type {?} */
                                const hasOrgAuthority = t.authOrganizationData && t.authOrganizationData.length;
                                if (activeScheme.type === 'public' || (activeScheme.type === 'org' && hasOrgAuthority)) {
                                    return this.schemeService.saveScheme(activeScheme, gridId, true);
                                }
                            }
                            return of(true);
                        })));
                    }
                }
                else {
                    return of(true);
                }
            }
            // 保存至数据库
            return this._saveUserConfig(key, config ? _config : '');
        }
        return of(true);
    }
    /**
     * @param {?} key
     * @return {?}
     */
    getUserConfig(key) {
        if (this.httpRestService) {
            return this._getUserConfig(key);
        }
        else {
            /** @type {?} */
            const config = localStorage.getItem(key);
            if (config) {
                /** @type {?} */
                const con = JSON.parse(config);
                if (con[this.localeSer.localeId]) {
                    return of(con[this.localeSer.localeId]);
                }
                else {
                    if (Object.keys(con).indexOf('viewColumns') > -1) {
                        return of(con);
                    }
                    return null;
                }
            }
            else {
                return of(null);
            }
        }
    }
    /**
     * @private
     * @param {?} schemeList
     * @return {?}
     */
    getDefaultScheme(schemeList) {
        // 1、有个人默认的返回个人默认方案
        // 2、没有个人默认方案的，返回公共方案第1个
        // 3、没有公共方案，返回组织方案第1个
        // 4、没有组织方案的, 返回个人方案第1个
        // 5、没有个人方案的，返回系统预制，即表单设计时的格式
        // 1、有个人默认的返回个人默认方案
        // 2、没有个人默认方案的，返回公共方案第1个
        // 3、没有公共方案，返回组织方案第1个
        // 4、没有组织方案的, 返回个人方案第1个
        // 5、没有个人方案的，返回系统预制，即表单设计时的格式
        /** @type {?} */
        let defaultScheme = null;
        if (!schemeList || !schemeList.length) {
            return defaultScheme;
        }
        else {
            defaultScheme = schemeList.find((/**
             * @param {?} n
             * @return {?}
             */
            n => n.isDefault));
            if (!defaultScheme) {
                /** @type {?} */
                let publicSchemes = schemeList.filter((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => n.type === 'public'));
                if (!publicSchemes.length) {
                    publicSchemes = schemeList.filter((/**
                     * @param {?} n
                     * @return {?}
                     */
                    n => n.type === 'org'));
                }
                if (publicSchemes.length) {
                    defaultScheme = publicSchemes[0];
                }
                else {
                    defaultScheme = schemeList[0];
                }
            }
        }
        return defaultScheme;
    }
    /**
     * @param {?} gridId
     * @return {?}
     */
    getSettings(gridId) {
        /** @type {?} */
        const key = this.createConfigKey(gridId);
        /** @type {?} */
        const gridIns = this.getGridInstance(gridId);
        /** @type {?} */
        let schemeList$ = of([]);
        if (gridIns && gridIns.enableScheme) {
            schemeList$ = this.getSchemeList(gridId);
        }
        return forkJoin(schemeList$, this.getUserConfig(key), this.schemeService.getLanguages()).pipe(map((/**
         * @param {?} __0
         * @return {?}
         */
        ([schemeList, userSetting, supportedLanguages]) => {
            schemeList = schemeList || [];
            this.languages = supportedLanguages;
            if (!schemeList.length) {
                return userSetting;
            }
            else {
                // 缓存方案列表
                this.setSchemeList(schemeList, gridId);
                // 查找默认方案
                /** @type {?} */
                const defaultScheme = this.getDefaultScheme(schemeList);
                if (!defaultScheme) {
                    return userSetting;
                }
                else {
                    this.setActiveSchemeItem(gridId, defaultScheme);
                    /** @type {?} */
                    let userSettings = null;
                    if (defaultScheme.queryConditionString) {
                        userSettings = JSON.parse(defaultScheme.queryConditionString);
                    }
                    if (userSettings) {
                        /** @type {?} */
                        const localeId = this.localeSer.localeId;
                        if (userSettings[localeId]) {
                            localStorage.setItem(key, JSON.stringify(userSettings));
                            return userSettings[localeId];
                        }
                        else {
                            userSettings[localeId] = null;
                            localStorage.setItem(key, JSON.stringify(userSettings));
                            return null;
                        }
                    }
                    else {
                        return null;
                    }
                }
            }
        })));
    }
    /**
     * @private
     * @param {?} key
     * @param {?} config
     * @return {?}
     */
    _saveUserConfig(key, config) {
        try {
            /** @type {?} */
            const userConfigSetting = {
                configkey1: key,
                configkey2: '',
                configkey3: '',
                textvalue: config ? JSON.stringify(config) : ''
            };
            return this.httpRestService.saveUserSettings(userConfigSetting);
        }
        catch (e) {
            this.writeDebugMsg(e, 'error');
        }
    }
    /**
     * @param {?} gridInstance
     * @param {?} modalRef
     * @return {?}
     */
    resetUserConfig(gridInstance, modalRef) {
        /** @type {?} */
        const restorDefaultText = this.localeSer.getValue('datagrid.settings.restoreDefaultSettingsText') || '确认要恢复默认设置吗？';
        this.messager.confirm(restorDefaultText).pipe(switchMap((/**
         * @param {?} t
         * @return {?}
         */
        (t) => {
            if (t) {
                return this.setUserConfig(gridInstance.id, '');
            }
            return of(t);
        }))).subscribe((/**
         * @param {?} t
         * @return {?}
         */
        (t) => {
            if (t) {
                this.resetGridView(gridInstance);
                modalRef.close();
            }
        }));
    }
    /**
     * @private
     * @param {?} key
     * @return {?}
     */
    _getUserConfig(key) {
        try {
            return this.httpRestService.getUserSettings(key).pipe(map((/**
             * @param {?} ucs
             * @return {?}
             */
            (ucs) => {
                if (ucs && ucs.textValue) {
                    /** @type {?} */
                    const c = JSON.parse(ucs.textValue);
                    if (c) {
                        if (c[this.localeSer.localeId]) {
                            localStorage.setItem(key, ucs.textValue);
                            return c[this.localeSer.localeId];
                        }
                        else {
                            c[this.localeSer.localeId] = null;
                            localStorage.setItem(key, JSON.stringify(c));
                            // if (Object.keys(c).indexOf('viewColumns') > -1) {
                            //     return c;
                            // }
                            return null;
                        }
                    }
                    return null;
                }
                return null;
            })));
        }
        catch (e) {
            if (this.debugSer) {
                this.debugSer.error(e);
            }
        }
    }
    /**
     * @private
     * @param {?} gridId
     * @param {?=} settings
     * @return {?}
     */
    buildSubmitData(gridId, settings = null) {
        /** @type {?} */
        const LOCALEID = this.localeSer.localeId;
        if (!settings) {
            settings = this.getCurrentUserSettings(gridId);
        }
        /** @type {?} */
        const localeKey = this.createConfigKey(gridId);
        /** @type {?} */
        const currentConfig = localStorage.getItem(localeKey);
        /** @type {?} */
        const _config = (currentConfig ? JSON.parse(currentConfig) : {}) || {};
        if (_config) {
            _config[LOCALEID] = settings;
        }
        return _config;
    }
    // ----------------------------------------------------------------------------------------------- \\
    /**
     * @private
     * @param {?} gridInstance
     * @param {?} schemeList
     * @param {?} authInfo
     * @param {?} simpleRef
     * @return {?}
     */
    showSchemeListDialog(gridInstance, schemeList, authInfo, simpleRef) {
        /** @type {?} */
        const modalOpts = {
            width: 760, height: 577, showHeader: false, title: '控制面板',
            initialState: {
                items: schemeList || [],
                removeItem: authInfo.success,
                currentUserId: authInfo.currentUserId
            },
            showButtons: false
        };
        /** @type {?} */
        const schemeListDlg = this.modalSer.show(SchemeListComponent, modalOpts);
        schemeListDlg.dialog.location.nativeElement.style.zIndex = 2031;
        /** @type {?} */
        const instance = (/** @type {?} */ (schemeListDlg.content));
        instance.closeModal.subscribe((/**
         * @return {?}
         */
        () => {
            schemeListDlg.close();
        }));
        instance.submitModal.subscribe((/**
         * @param {?} t
         * @return {?}
         */
        (t) => {
            this.schemeService.updateScheme(t, gridInstance.id).subscribe((/**
             * @param {?} e
             * @return {?}
             */
            (e) => {
                if (e === false) {
                    schemeListDlg.close();
                    return;
                }
                /** @type {?} */
                const msg = '列设置方案保存成功。';
                if (this.notifyService) {
                    this.notifyService.success(msg);
                }
                else {
                    this.messager.success(msg);
                }
                if (t.defaultId) {
                    schemeList.forEach((/**
                     * @param {?} n
                     * @return {?}
                     */
                    n => {
                        n.isDefault = false;
                        if (n.id === t.defaultId) {
                            n.isDefault = true;
                            // this.setActiveSchemeItem(gridInstance.id, n);
                        }
                    }));
                }
                /** @type {?} */
                let newSchemeList = schemeList;
                if (t.deletedIds && t.deletedIds.length) {
                    newSchemeList = schemeList.filter((/**
                     * @param {?} n
                     * @return {?}
                     */
                    n => {
                        return !t.deletedIds.includes(n.id);
                    }));
                }
                this.schemeService.setSchemeList(gridInstance.id, newSchemeList);
                /** @type {?} */
                const currentScheme = this.getActiveSchemeItem(gridInstance.id);
                if (!currentScheme) {
                    this.setActiveSchemeItem(gridInstance.id, null);
                    simpleRef.instance.currentSchemeItem = null;
                    simpleRef.instance.reset2Default();
                }
                schemeListDlg.close();
            }));
        }));
        /** @type {?} */
        const modalContainer = (/** @type {?} */ (schemeListDlg.dialog.instance));
        modalContainer.draggbar.handle = instance.header.nativeElement;
    }
    // 新增或另存方案
    /**
     * @private
     * @param {?} gridInstance
     * @param {?} e
     * @param {?} simpleRef
     * @return {?}
     */
    showNewSchemeDialog(gridInstance, e, simpleRef) {
        /** @type {?} */
        const modalOpts = {
            width: 480, height: 269, showHeader: false, title: '控制面板',
            initialState: {
                languages: this.languages
            },
            showButtons: false,
            resizable: false
        };
        /** @type {?} */
        const newSchemeDlg = this.modalSer.show(NewSchemeComponent, modalOpts);
        newSchemeDlg.dialog.location.nativeElement.style.zIndex = 2031;
        /** @type {?} */
        const instance = (/** @type {?} */ (newSchemeDlg.content));
        instance.closeModal.subscribe((/**
         * @return {?}
         */
        () => {
            newSchemeDlg.close();
        }));
        instance.submitModal.pipe(switchMap((/**
         * @param {?} t
         * @return {?}
         */
        (t) => {
            return this.createNewScheme(gridInstance.id, t, e.type === 'new', simpleRef.instance.collectSettings());
        }))).subscribe((/**
         * @param {?} t
         * @return {?}
         */
        (t) => {
            if (t.flag === false) {
                /** @type {?} */
                const msg = t.msg;
                /** @type {?} */
                let _msg = msg;
                if (msg) {
                    if (msg.indexOf('|') > -1) {
                        _msg = msg.split('|').map((/**
                         * @param {?} langcode
                         * @return {?}
                         */
                        (langcode) => {
                            return this.localeSer.getValue('datagrid-settings.' + langcode);
                        })).join('');
                    }
                    else {
                        _msg = this.localeSer.getValue('datagrid-settings.' + msg);
                    }
                    if (this.notifyService) {
                        this.notifyService.info(_msg);
                    }
                    else {
                        this.messager.info(_msg);
                    }
                }
                return;
            }
            // 更新方案列表
            /** @type {?} */
            const schemeList = this.schemeService.getStateValue(gridInstance.id, 'list') || [];
            if (t.isDefault) {
                schemeList.forEach((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => {
                    n.isDefault = false;
                }));
            }
            schemeList.push(t);
            // this.setActiveSchemeItem(gridInstance.id, t);
            this.schemeService.setSchemeList(gridInstance.id, schemeList);
            // 更换为新的方案
            simpleRef.instance.onSchemeItemClick(null, t);
            newSchemeDlg.close();
        }));
        instance.checkAuthority.pipe(switchMap((/**
         * @param {?} t
         * @return {?}
         */
        (t) => {
            return this.schemeService.checkAuthority().pipe(map((/**
             * @param {?} auth
             * @return {?}
             */
            (auth) => {
                return Object.assign({ type: t }, auth);
            })));
        }))).subscribe((/**
         * @param {?} t
         * @return {?}
         */
        (t) => {
            /** @type {?} */
            let hasAuthority = { public: true, org: true };
            // 您没有将方案的使用范围设置为公共的权限。
            /** @type {?} */
            let _msg = 'noAuth.public';
            if (t.type.value === 'org') {
                // 您没有将方案的使用范围设置为组织的权限。
                _msg = 'noAuth.org';
            }
            /** @type {?} */
            const msg = this.localeSer.getValue('datagrid-settings.' + _msg);
            if (t.success) {
                /** @type {?} */
                const hasPublicAuthority = t.authOperationData && t.authOperationData.length;
                hasAuthority.public = hasPublicAuthority;
                /** @type {?} */
                const hasOrgAuthority = t.authOrganizationData && t.authOrganizationData.length;
                hasAuthority.org = hasOrgAuthority;
                if (t.type.value === 'public') {
                    instance.schemeInfo.type = t.type.value;
                }
                else if (t.type.value === 'org') {
                    if (!hasOrgAuthority) {
                        this.notifyService.warning(msg);
                    }
                    else {
                        instance.schemeInfo.type = t.type.value;
                        instance.schemeInfo.orgids = t.authOrganizationData.join(',');
                        instance.dataPermissionIds = t.authOrganizationData;
                    }
                }
            }
            else {
                this.notifyService.warning(msg);
                hasAuthority = { public: false, org: false };
                ;
            }
            instance.refresh(hasAuthority);
        }));
        /** @type {?} */
        const modalContainer = (/** @type {?} */ (newSchemeDlg.dialog.instance));
        modalContainer.draggbar.handle = instance.header.nativeElement;
    }
    /**
     * @param {?} gridId
     * @return {?}
     */
    getSchemeList(gridId) {
        return this.schemeService.getSchemeList(gridId);
    }
    /**
     * 新增方案
     *  isNewScheme，是否新加方案，否则为另存为
     *  currentSettings： 当前配置信息
     *  data: 新建方案窗口传递数据
     * @param {?} gridId
     * @param {?} data
     * @param {?=} isNewScheme
     * @param {?=} currentSettings
     * @return {?}
     */
    createNewScheme(gridId, data, isNewScheme = true, currentSettings) {
        if (!data.name) {
            // msg 请输入方案名称
            return of({ flag: false, msg: 'required.schemeName' });
        }
        else {
            /** @type {?} */
            const hasName = this.schemeService.hasSchemeName(gridId, data.name);
            if (typeof hasName === 'boolean' && hasName) {
                // msg '方案名称已存在，请修改。'
                return of({ flag: false, msg: 'has.exist' });
            }
            else if (Array.isArray(hasName) && hasName.length) {
                /** @type {?} */
                const getMessageCode = (/**
                 * @param {?} langCode
                 * @return {?}
                 */
                (langCode) => {
                    if (langCode === 'zh-CHS') {
                        return 'has.chs'; // 简体中文名称已存在。
                    }
                    else if (langCode === 'zh-CHT') {
                        return 'has.cht'; // 繁體中文名稱已存在。
                    }
                    else {
                        return 'has.en'; // 英文名称已存在
                    }
                });
                if (hasName.includes(this.localeSer.localeId)) {
                    /** @type {?} */
                    const msg = getMessageCode(this.localeSer.localeId);
                    return of({ flag: false, msg });
                }
                else {
                    /** @type {?} */
                    const msgs = hasName.map((/**
                     * @param {?} n
                     * @return {?}
                     */
                    n => {
                        return getMessageCode(n);
                    }));
                    return of({ flag: false, msg: msgs.join('|') });
                }
            }
        }
        /** @type {?} */
        const requiredName = [];
        if (!data.name[this.localeSer.localeId]) {
            requiredName.push(this.localeSer.localeId);
        }
        // this.languages.forEach(n => {
        //     if (data.name[n.code] === '' || data.name[n.code] === undefined) {
        //         requiredName.push(n.code);
        //     }
        // });
        if (requiredName.length) {
            /** @type {?} */
            const msgs = requiredName.map((/**
             * @param {?} n
             * @return {?}
             */
            n => {
                if (n === 'zh-CHS') {
                    return 'required.chs'; //'请输入简体中文名称。';
                }
                else if (n === 'zh-CHT') {
                    return 'required.cht'; //'请输入繁体中文名称。';
                }
                else {
                    return 'required.en'; // '请输入英文名称。';
                }
            }));
            return of({ flag: false, msg: msgs.join('|') });
        }
        if (data.type && data.type === 'org' && (!data.orgids || !data.orgids.length)) {
            // msg '请选择组织'
            return of({ flag: false, msg: 'required.org' });
        }
        /** @type {?} */
        let _config = null;
        if (!isNewScheme) {
            /** @type {?} */
            const LOCALEID = this.localeSer.localeId;
            if (currentSettings && currentSettings.columnFormat) {
                currentSettings.columnFormat = this.convertColumnsToSimple([currentSettings.columnFormat]);
            }
            _config = { [LOCALEID]: currentSettings };
        }
        /** @type {?} */
        const newId = this.idService.guid();
        /** @type {?} */
        let isDefault = data.isDefault;
        if (isDefault) {
            if (data.type !== 'private') {
                isDefault = false;
            }
        }
        if (data.name && typeof data.name === 'object') {
            data.name = JSON.stringify(data.name);
        }
        /** @type {?} */
        const scheme = {
            id: newId,
            belongId: '',
            code: '',
            name: data.name,
            type: data.type,
            isDefault: isDefault,
            isSystem: false,
            extendId: 'datagrid-settings-scheme',
            extendInfo: this.buildOrgAndSchemeRelations(newId, data.orgids),
            queryConditionString: _config ? JSON.stringify(_config) : '',
        };
        return this.schemeService.saveScheme(scheme, gridId).pipe(map((/**
         * @return {?}
         */
        () => {
            return scheme;
        })));
    }
    /**
     * @param {?} schemeList
     * @param {?} gridId
     * @return {?}
     */
    setSchemeList(schemeList, gridId) {
        this.schemeService.update({ list: schemeList }, gridId);
    }
    /**
     * @private
     * @param {?} schemeId
     * @param {?} orgIds
     * @return {?}
     */
    buildOrgAndSchemeRelations(schemeId, orgIds) {
        if (!orgIds || !orgIds.length) {
            return [];
        }
        if (typeof orgIds === 'string') {
            orgIds = orgIds.split(',');
        }
        return orgIds.map((/**
         * @param {?} n
         * @return {?}
         */
        n => {
            return {
                id: this.idService.guid(),
                orgId: n,
                relatedId: schemeId
            };
        }));
    }
    /**
     * @private
     * @param {?} gridId
     * @return {?}
     */
    getCurrentSchemeSettings(gridId) {
        /** @type {?} */
        const activeScheme = (/** @type {?} */ (this.getActiveSchemeItem(gridId)));
        if (activeScheme && activeScheme.queryConditionString) {
            return JSON.parse(activeScheme.queryConditionString);
        }
        return null;
    }
}
DatagridSettingsService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
DatagridSettingsService.ctorParameters = () => [
    { type: Injector },
    { type: BsModalService },
    { type: MessagerService },
    { type: IdService },
    { type: LocaleService }
];
if (false) {
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.multiSortMsg;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.columnsSortableMsg;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.notSupportHeaderGroupMsg;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.notShowDialog;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype._httpRestService;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.languages;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.gridRefs;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.activeSchemeItem;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.saving;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.cfr;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.app;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.schemeListSubscription;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.schemeService;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.notifyService;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.currentSchemeitem;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.debugSer;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.modalSer;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.messager;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.idService;
    /**
     * @type {?}
     * @private
     */
    DatagridSettingsService.prototype.localeSer;
    /* Skipping unhandled member: ;*/
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YWdyaWQtc2V0dGluZ3Muc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktZGF0YWdyaWQtc2V0dGluZ3MvIiwic291cmNlcyI6WyJsaWIvZGF0YWdyaWQtc2V0dGluZ3Muc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFnQixHQUFHLEVBQUUsU0FBUyxFQUFPLE1BQU0sZ0JBQWdCLENBQUM7QUFDbkUsT0FBTyxFQUFFLFFBQVEsRUFBYyxFQUFFLEVBQWdCLEtBQUssRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNyRSxPQUFPLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxjQUFjLEVBQUUsd0JBQXdCLEVBQUUsY0FBYyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRS9HLE9BQU8sRUFBRSxjQUFjLEVBQXlDLE1BQU0sa0JBQWtCLENBQUM7QUFDekYsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3RELE9BQU8sRUFBRSx5QkFBeUIsRUFBRSxNQUFNLCtCQUErQixDQUFDO0FBQzFFLE9BQU8sRUFBRSxTQUFTLEVBQVksTUFBTSxXQUFXLENBQUM7QUFDaEQsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBRWxELE9BQU8sRUFBRSxZQUFZLEVBQUUsU0FBUyxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDNUQsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sd0NBQXdDLENBQUM7QUFDaEYsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDbEUsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFDbEUsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFDckUsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBR2xELE9BQU8sRUFBRSw0QkFBNEIsRUFBRSxNQUFPLDRC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QyxvQkFBb0IsRUFBRTtZQUNuRCxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLG9CQUFvQixDQUFDLENBQUM7U0FDeEQ7UUFDRCxPQUFPLElBQUksQ0FBQztJQUNoQixDQUFDOzs7WUE5ekNKLFVBQVU7Ozs7WUFwQlUsUUFBUTtZQUVwQixjQUFjO1lBQ2QsZUFBZTtZQUtELFNBQVM7WUFGdkIsYUFBYTs7Ozs7OztJQWlCbEIsK0NBQTZDOzs7OztJQUM3QyxxREFBOEM7Ozs7O0lBQzlDLDJEQUErQzs7Ozs7SUFDL0MsZ0RBQW1EOzs7OztJQUVuRCxtREFBZ0M7Ozs7O0lBRWhDLDRDQUE0Qjs7Ozs7SUFjNUIsMkNBQTREOzs7OztJQUM1RCxtREFBMkQ7Ozs7O0lBRTNELHlDQUF1Qjs7Ozs7SUFDdkIsc0NBQTZDOzs7OztJQUM3QyxzQ0FBbUM7Ozs7O0lBQ25DLHlEQUFvRDs7Ozs7SUFFcEQsZ0RBQTZDOzs7OztJQUM3QyxnREFBcUM7Ozs7O0lBR3JDLG9EQUFpQzs7Ozs7SUFDakMsMkNBQXNDOzs7OztJQUUxQiwyQ0FBMEI7Ozs7O0lBQUUsMkNBQWdDOzs7OztJQUM1RCwyQ0FBaUM7Ozs7O0lBQUUsNENBQTRCOzs7OztJQUMvRCw0Q0FBZ0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBkZWJvdW5jZVRpbWUsIG1hcCwgc3dpdGNoTWFwLCB0YXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7IGZvcmtKb2luLCBPYnNlcnZhYmxlLCBvZiwgU3Vic2NyaXB0aW9uLCB0aW1lciB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBJbmplY3RhYmxlLCBJbmplY3RvciwgSW5qZWN0aW9uVG9rZW4sIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciwgQXBwbGljYXRpb25SZWYgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgRGF0YWdyaWRDb21wb25lbnQsIERhdGFDb2x1bW4gfSBmcm9tICdAZmFycmlzL3VpLWRhdGFncmlkJztcclxuaW1wb3J0IHsgQnNNb2RhbFNlcnZpY2UsIE1vZGFsT3B0aW9ucywgTW9kYWxDb250YWluZXJDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLW1vZGFsJztcclxuaW1wb3J0IHsgTWVzc2FnZXJTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1tZXNzYWdlcic7XHJcbmltcG9ydCB7IERhdGFncmlkU2V0dGluZ3NDb21wb25lbnQgfSBmcm9tICcuL2RhdGFncmlkLXNldHRpbmdzLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IGNsb25lRGVlcCwgZGVib3VuY2UgfSBmcm9tICdsb2Rhc2gtZXMnO1xyXG5pbXBvcnQgeyBMb2NhbGVTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1sb2NhbGUnO1xyXG5pbXBvcnQgeyBUcmVlTm9kZSB9IGZyb20gJ0BmYXJyaXMvdWktdHJlZXRhYmxlJztcclxuaW1wb3J0IHsgRGVidWdTZXJ2aWNlLCBJZFNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWNvbW1vbic7XHJcbmltcG9ydCB7IFNpbXBsZUNvbHVtbnNDb21wb25lbnQgfSBmcm9tICcuL3NpbXBsZS1tb2RlL3NpbXBsZS1jb2x1bW5zLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IERhdGFncmlkU2NoZW1lU2VydmljZSB9IGZyb20gJy4vZGF0YWdyaWQtc2NoZW1lLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBOZXdTY2hlbWVDb21wb25lbnQgfSBmcm9tICcuL3NjaGVtZS9uZXdzY2hlbWUuY29tcG9uZW50JztcclxuaW1wb3J0IHsgU2NoZW1lTGlzdENvbXBvbmVudCB9IGZyb20gJy4vc2NoZW1lL3NjaGVtZS1saXN0LmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IE5vdGlmeVNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW5vdGlmeSc7XHJcbmltcG9ydCB7IERhdGFncmlkU2NoZW1lTW9kZWwsIFNjaGVtZUF1dGhNb2RlbCwgU2V0dGluZ01vZGVsIH0gZnJvbSAnLi9zZXR0aW5nLm1vZGVsJztcclxuXHJcbmltcG9ydCB7IERBVEFHUklEX1NFVFRJTkdTX0xPQ0FMRURBVEEgfSAgZnJvbSAnLi9kYXRhZ3JpZC1zZXR0aW5ncy1sb2NhbGUnO1xyXG5cclxuZXhwb3J0IGNvbnN0IEdSSURfU0VUVElOR1NfV0VCQVBJID0gIG5ldyBJbmplY3Rpb25Ub2tlbignIEZhcnJpcyBEYXRhR3JpZCBVc2VyIFNldHRpbmcgV2ViQXBpIFVSSS4nKTtcclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIERhdGFncmlkU2V0dGluZ3NTZXJ2aWNlIHtcclxuXHJcbiAgICBwcml2YXRlIG11bHRpU29ydE1zZyA9ICfliJfooajkuK3mnKrlvIDlkK/lpJrliJfmjpLluo/nmoTlip/og73jgIIg6K+35qOA5p+l77yBJztcclxuICAgIHByaXZhdGUgY29sdW1uc1NvcnRhYmxlTXNnID0gJ+acquW8gOWQr+WIl+eahOaOkuW6j+WKn+iDveOAguivt+ajgOafpe+8gSc7XHJcbiAgICBwcml2YXRlIG5vdFN1cHBvcnRIZWFkZXJHcm91cE1zZyA9ICfmmoLkuI3mlK/mjIHlpJrooajlpLTorr7nva4nO1xyXG4gICAgcHJpdmF0ZSBub3RTaG93RGlhbG9nID0gJ+WkmuihqOWktOaaguS4jeaUr+aMgeWIl+aYvuekuuiuvue9ru+8m+WQjOaXtuacquWQr+eUqOWIl+aOkuW6j+WKn+iDveOAgic7XHJcblxyXG4gICAgcHJpdmF0ZSBfaHR0cFJlc3RTZXJ2aWNlID0gbnVsbDtcclxuXHJcbiAgICBwcml2YXRlIGxhbmd1YWdlczogYW55ID0gW107XHJcblxyXG4gICAgZ2V0IGh0dHBSZXN0U2VydmljZSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5faHR0cFJlc3RTZXJ2aWNlO1xyXG4gICAgfTtcclxuXHJcbiAgICBzZXQgaHR0cFJlc3RTZXJ2aWNlKGh0dHBTZXIpIHtcclxuICAgICAgICB0aGlzLl9odHRwUmVzdFNlcnZpY2UgPSBodHRwU2VyO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5zY2hlbWVTZXJ2aWNlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2NoZW1lU2VydmljZS5zZXRSZXN0U2VydmljZShodHRwU2VyKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBncmlkUmVmczoge1trZXk6IHN0cmluZ106IERhdGFncmlkQ29tcG9uZW50fSA9IG51bGw7XHJcbiAgICBwcml2YXRlIGFjdGl2ZVNjaGVtZUl0ZW06IHtbc2NoZW1laWQ6IHN0cmluZ106IGFueX0gPSBudWxsO1xyXG5cclxuICAgIHByaXZhdGUgc2F2aW5nID0gZmFsc2U7XHJcbiAgICBwcml2YXRlIGNmcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyID0gbnVsbDtcclxuICAgIHByaXZhdGUgYXBwOiBBcHBsaWNhdGlvblJlZiA9IG51bGw7XHJcbiAgICBwcml2YXRlIHNjaGVtZUxpc3RTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbiA9IG51bGw7XHJcblxyXG4gICAgcHJpdmF0ZSBzY2hlbWVTZXJ2aWNlOiBEYXRhZ3JpZFNjaGVtZVNlcnZpY2U7XHJcbiAgICBwcml2YXRlIG5vdGlmeVNlcnZpY2U6IE5vdGlmeVNlcnZpY2U7XHJcblxyXG5cclxuICAgIHByaXZhdGUgY3VycmVudFNjaGVtZWl0ZW0gPSBudWxsO1xyXG4gICAgcHJpdmF0ZSBkZWJ1Z1NlcjogRGVidWdTZXJ2aWNlID0gbnVsbDtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGluamVjdG9yOiBJbmplY3RvciwgcHJpdmF0ZSBtb2RhbFNlcjogQnNNb2RhbFNlcnZpY2UsXHJcbiAgICAgICAgICAgICAgICBwcml2YXRlIG1lc3NhZ2VyOiBNZXNzYWdlclNlcnZpY2UsIHByaXZhdGUgaWRTZXJ2aWNlOiBJZFNlcnZpY2UsXHJcbiAgICAgICAgICAgICAgICBwcml2YXRlIGxvY2FsZVNlcjogTG9jYWxlU2VydmljZSkge1xyXG5cclxuICAgICAgICB0aGlzLmNmciA9IHRoaXMuaW5qZWN0b3IuZ2V0KENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcik7XHJcbiAgICAgICAgdGhpcy5hcHAgPSB0aGlzLmluamVjdG9yLmdldChBcHBsaWNhdGlvblJlZik7XHJcbiAgICAgICAgdGhpcy5ub3RpZnlTZXJ2aWNlID0gdGhpcy5pbmplY3Rvci5nZXQoTm90aWZ5U2VydmljZSwgbnVsbCk7XHJcbiAgICAgICAgdGhpcy5kZWJ1Z1NlciA9IHRoaXMuaW5qZWN0b3IuZ2V0KERlYnVnU2VydmljZSwgbnVsbCk7XHJcbiAgICAgICAgdGhpcy5zY2hlbWVTZXJ2aWNlID0gbmV3IERhdGFncmlkU2NoZW1lU2VydmljZSgpO1xyXG5cclxuICAgICAgICB0aGlzLmxvY2FsZVNlci5zZXRMb2NhbGVEYXRhKERBVEFHUklEX1NFVFRJTkdTX0xPQ0FMRURBVEEpO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBkZXN0cm95KGlkPzogc3RyaW5nKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZ3JpZFJlZnMpIHtcclxuICAgICAgICAgICAgaWYgKGlkICYmIHRoaXMuZ3JpZFJlZnNbaWRdKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmdyaWRSZWZzW2lkXSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5ncmlkUmVmc1tpZF07XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5rZXlzKHRoaXMuZ3JpZFJlZnMpLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZ3JpZFJlZnMgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuc2F2aW5nID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5zZXRBY3RpdmVTY2hlbWVJdGVtKGlkLCBudWxsKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHdyaXRlRGVidWdNc2cobXNnLCB0eXBlID0gJ3dhcm4nKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZGVidWdTZXIpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZGVidWdTZXJbdHlwZV0pIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGVidWdTZXJbdHlwZV0obXNnKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGVbdHlwZV0obXNnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZWdpc3RlckdyaWRJbnN0YW5jZShkZzogRGF0YWdyaWRDb21wb25lbnQpIHtcclxuICAgICAgICBpZiAoIWRnKSB7XHJcbiAgICAgICAgICAgIHRoaXMud3JpdGVEZWJ1Z01zZygnRGF0YWdyaWRTZXR0aW5nU2VydmljZTogZ3JpZCBpbnN0YW5jZSBpcyBudWxsLicpXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgaWQgPSBkZy5pZDtcclxuICAgICAgICB0aGlzLmdyaWRSZWZzID0gdGhpcy5ncmlkUmVmcyB8fCB7fTtcclxuICAgICAgICBpZiAoIXRoaXMuZ3JpZFJlZnNbaWRdKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZ3JpZFJlZnNbaWRdID0gZGc7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldEdyaWRJbnN0YW5jZShkZ0lEOiBzdHJpbmcpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5ncmlkUmVmcyA/IHRoaXMuZ3JpZFJlZnNbZGdJRF0gOiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKiDmm7TmlrDmlrnmoYjkuK3nmoTphY3nva7mlbDmja4gKi9cclxuICAgIHByaXZhdGUgdXBkYXRlU2NoZW1lU2V0dGluZ3Moc2NoZW1lSXRlbTogRGF0YWdyaWRTY2hlbWVNb2RlbCwgc2V0dGluZ3M6IFBhcnRpYWw8U2V0dGluZ01vZGVsPikge1xyXG4gICAgICAgIGlmIChzY2hlbWVJdGVtICYmIHNldHRpbmdzKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHNjaGVtZUNvbnRlbnRPYmogPSBzY2hlbWVJdGVtLnF1ZXJ5Q29uZGl0aW9uU3RyaW5nID8gSlNPTi5wYXJzZShzY2hlbWVJdGVtLnF1ZXJ5Q29uZGl0aW9uU3RyaW5nKSA6IHt9O1xyXG4gICAgICAgICAgICBpZiAoc2NoZW1lQ29udGVudE9iaikge1xyXG4gICAgICAgICAgICAgICAgaWYgKCBzY2hlbWVDb250ZW50T2JqW3RoaXMubG9jYWxlU2VyLmxvY2FsZUlkXSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNjaGVtZVNldHRpbmdzID0gc2NoZW1lQ29udGVudE9ialt0aGlzLmxvY2FsZVNlci5sb2NhbGVJZF0gfHwge307XHJcbiAgICAgICAgICAgICAgICAgICAgc2NoZW1lQ29udGVudE9ialt0aGlzLmxvY2FsZVNlci5sb2NhbGVJZF0gPSBPYmplY3QuYXNzaWduKHNjaGVtZVNldHRpbmdzLCBzZXR0aW5ncyk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHNjaGVtZUNvbnRlbnRPYmpbdGhpcy5sb2NhbGVTZXIubG9jYWxlSWRdID0gIHNldHRpbmdzO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgc2NoZW1lSXRlbS5xdWVyeUNvbmRpdGlvblN0cmluZyA9IEpTT04uc3RyaW5naWZ5KHNjaGVtZUNvbnRlbnRPYmopO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKiDmm7TmlrDlvZPliY3mlrnmoYjphY3nva7mlbDmja4gKi9cclxuICAgIHVwZGF0ZUFjdGl2ZVNjaGVtZUl0ZW1TZXR0aW5ncyhkZ0lkOiBzdHJpbmcsIHNldHRpbmdzOiBQYXJ0aWFsPFNldHRpbmdNb2RlbD4pIHtcclxuICAgICAgICBjb25zdCBzY2hlbWVJdGVtID0gdGhpcy5nZXRBY3RpdmVTY2hlbWVJdGVtKGRnSWQpO1xyXG4gICAgICAgIHRoaXMudXBkYXRlU2NoZW1lU2V0dGluZ3Moc2NoZW1lSXRlbSwgc2V0dGluZ3MpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKiDorr7nva7mtLvliqjnmoTmlrnmoYggKi9cclxuICAgIHNldEFjdGl2ZVNjaGVtZUl0ZW0oZGdJZDogc3RyaW5nLCBhY3RpdmVJdGVtOiBhbnkpIHtcclxuICAgICAgICBjb25zdCBzY2hlbWVrZXkgPSB0aGlzLnNjaGVtZVNlcnZpY2UuZ2V0U2NoZW1lS2V5KGRnSWQpO1xyXG4gICAgICAgIHRoaXMuYWN0aXZlU2NoZW1lSXRlbSA9IHRoaXMuYWN0aXZlU2NoZW1lSXRlbSB8fCB7fTtcclxuICAgICAgICB0aGlzLmFjdGl2ZVNjaGVtZUl0ZW1bc2NoZW1la2V5XSA9IGFjdGl2ZUl0ZW07XHJcbiAgICB9XHJcbiAgICAvKiog6I635Y+W5b2T5YmN5rS75Yqo55qE5pa55qGIICovXHJcbiAgICBnZXRBY3RpdmVTY2hlbWVJdGVtKGRnSWQ6IHN0cmluZyk6IERhdGFncmlkU2NoZW1lTW9kZWwge1xyXG4gICAgICAgIGNvbnN0IHNjaGVtZWtleSA9IHRoaXMuc2NoZW1lU2VydmljZS5nZXRTY2hlbWVLZXkoZGdJZCk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuYWN0aXZlU2NoZW1lSXRlbSA/IHRoaXMuYWN0aXZlU2NoZW1lSXRlbVtzY2hlbWVrZXldIDogbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBnZXRTZWFyY2hUeXBlcygpIHtcclxuICAgICAgICByZXR1cm4gW1xyXG4gICAgICAgICAgICB7IHZhbHVlOiAnYWxsJywgdGl0bGU6IHRoaXMubG9jYWxlU2VyLmdldFZhbHVlKCdkYXRhZ3JpZC5zZXR0aW5ncy5hbGxDb2x1bW5zJykgfSxcclxuICAgICAgICAgICAgeyB2YWx1ZTogJ3Zpc2libGUnLCB0aXRsZTogdGhpcy5sb2NhbGVTZXIuZ2V0VmFsdWUoJ2RhdGFncmlkLnNldHRpbmdzLnZpc2libGVDb2x1bW5zJykgfSxcclxuICAgICAgICAgICAgeyB2YWx1ZTogJ2hpZGRlbicsIHRpdGxlOiB0aGlzLmxvY2FsZVNlci5nZXRWYWx1ZSgnZGF0YWdyaWQuc2V0dGluZ3MuaGlkZGVuQ29sdW1ucycpIH1cclxuICAgICAgICBdO1xyXG4gICAgfVxyXG5cclxuICAgIHNob3dTaW1wbGUoZ3JpZEluc3RhbmNlOiBEYXRhZ3JpZENvbXBvbmVudCwgc2V0dGluZ3M/OiBTZXR0aW5nTW9kZWwsIHNlbGVjdGVkU2NoZW1lSXRlbT86IERhdGFncmlkU2NoZW1lTW9kZWwpIHtcclxuICAgICAgICBjb25zdCBjb2x1bW5zID0gdGhpcy5jb252ZXJ0Q29sdW1uc1RvU2ltcGxlKGdyaWRJbnN0YW5jZS5jb2x1bW5zKTtcclxuICAgICAgICBjb2x1bW5zWzBdID0gWy4uLmNvbHVtbnNbMF0uZmlsdGVyKG4gPT4gbi5maWVsZCAmJiBuLmZpZWxkICE9PSBncmlkSW5zdGFuY2UuQ29udHJvbFBhbmVsRmVpbGQpXTtcclxuXHJcbiAgICAgICAgY29uc3Qgc2VhcmNoVHlwZXMgPSB0aGlzLmdldFNlYXJjaFR5cGVzKCk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmNmcikge1xyXG4gICAgICAgICAgICBjb25zdCBjbXBGYWN0b3J5ID0gdGhpcy5jZnIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoU2ltcGxlQ29sdW1uc0NvbXBvbmVudCk7XHJcbiAgICAgICAgICAgIGxldCBzaW1wbGVSZWYgPSBjbXBGYWN0b3J5LmNyZWF0ZSh0aGlzLmluamVjdG9yKTtcclxuICAgICAgICAgICAgdGhpcy5hcHAuYXR0YWNoVmlldyhzaW1wbGVSZWYuaG9zdFZpZXcpO1xyXG4gICAgICAgICAgICBzaW1wbGVSZWYuaW5zdGFuY2UuY29sdW1ucyA9IGNvbHVtbnM7XHJcbiAgICAgICAgICAgIHNpbXBsZVJlZi5pbnN0YW5jZS5zZWFydFR5cGVzID0gc2VhcmNoVHlwZXM7XHJcbiAgICAgICAgICAgIHNpbXBsZVJlZi5pbnN0YW5jZS5ncmlkSW5zdGFuY2UgPSBncmlkSW5zdGFuY2U7XHJcblxyXG4gICAgICAgICAgICBpZiAoZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3BhZ2Utd3JhcHBlcicpKSB7XHJcbiAgICAgICAgICAgICAgICBzaW1wbGVSZWYuaW5zdGFuY2UudG9wID0gNzY7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHNpbXBsZVJlZi5pbnN0YW5jZS5lbmFibGVTY2hlbWUgPSBncmlkSW5zdGFuY2UuZW5hYmxlU2NoZW1lO1xyXG4gICAgICAgICAgICBpZiAoZ3JpZEluc3RhbmNlLmVuYWJsZVNjaGVtZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHNldHRpbmdzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGVjdGVkU2NoZW1lSXRlbSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVNjaGVtZVNldHRpbmdzKHNlbGVjdGVkU2NoZW1lSXRlbSwgc2V0dGluZ3MpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzaW1wbGVSZWYuaW5zdGFuY2UuY3VycmVudFNjaGVtZUl0ZW0gPSBzZWxlY3RlZFNjaGVtZUl0ZW07XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2ltcGxlUmVmLmluc3RhbmNlLmN1cnJlbnRTY2hlbWVJdGVtID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2ltcGxlUmVmLmluc3RhbmNlLnNldHRpbmdzID0gc2V0dGluZ3M7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBfY3VycmVudFNjaGVtdEl0ZW0gPSB0aGlzLmdldEFjdGl2ZVNjaGVtZUl0ZW0oZ3JpZEluc3RhbmNlLmlkKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRTY2hlbWVpdGVtID0gX2N1cnJlbnRTY2hlbXRJdGVtO1xyXG4gICAgICAgICAgICAgICAgICAgIHNpbXBsZVJlZi5pbnN0YW5jZS5jdXJyZW50U2NoZW1lSXRlbSA9IF9jdXJyZW50U2NoZW10SXRlbTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChzaW1wbGVSZWYubG9jYXRpb24ubmF0aXZlRWxlbWVudCk7XHJcblxyXG4gICAgICAgICAgICBzaW1wbGVSZWYuaW5zdGFuY2UuY2xvc2VkLnBpcGUoXHJcbiAgICAgICAgICAgICAgICBzd2l0Y2hNYXAoICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2ltcGxlUmVmKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNpbXBsZVJlZi5pbnN0YW5jZS5jb250YWluZXIubmF0aXZlRWxlbWVudC5zdHlsZS5yaWdodCA9ICctNTAwcHgnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGltZXIoNTAwKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICApLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBzaW1wbGVSZWYubG9jYXRpb24ubmF0aXZlRWxlbWVudC5yZW1vdmUoKTtcclxuICAgICAgICAgICAgICAgIHNpbXBsZVJlZi5kZXN0cm95KCk7XHJcbiAgICAgICAgICAgICAgICBzaW1wbGVSZWYgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2NoZW1lTGlzdFN1YnNjcmlwdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2NoZW1lTGlzdFN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IF9hY3RpdmVTY2hlbXRJdGVtID0gdGhpcy5nZXRBY3RpdmVTY2hlbWVJdGVtKGdyaWRJbnN0YW5jZS5pZCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoKCF0aGlzLmN1cnJlbnRTY2hlbWVpdGVtIHx8IChfYWN0aXZlU2NoZW10SXRlbSAmJiBfYWN0aXZlU2NoZW10SXRlbS5pZCAhPT0gdGhpcy5jdXJyZW50U2NoZW1laXRlbS5pZCkpICYmIChfYWN0aXZlU2NoZW10SXRlbSAmJl9hY3RpdmVTY2hlbXRJdGVtLnF1ZXJ5Q29uZGl0aW9uU3RyaW5nKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IF9jdXJyZW50U2V0dGluZ3MgPSBKU09OLnBhcnNlKF9hY3RpdmVTY2hlbXRJdGVtLnF1ZXJ5Q29uZGl0aW9uU3RyaW5nKVt0aGlzLmxvY2FsZVNlci5sb2NhbGVJZF07XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKF9jdXJyZW50U2V0dGluZ3MpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uc1swXS5mb3JFYWNoKGYgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZi52aXNpYmxlID0gX2N1cnJlbnRTZXR0aW5ncy52aWV3Q29sdW1ucy5pbmRleE9mKGYuZmllbGQpID4gLTE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuXHJcbiAgICAgICAgICAgIHNpbXBsZVJlZi5pbnN0YW5jZS5hZHZhbmNlZC5zdWJzY3JpYmUoKHsgdmlld0ZpZWxkcyB9KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAodmlld0ZpZWxkcyAmJiB2aWV3RmllbGRzLmxlbmd0aCl7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVTY2hlbWVTZXR0aW5ncyhzaW1wbGVSZWYuaW5zdGFuY2UuY3VycmVudFNjaGVtZUl0ZW0sIHt2aWV3Q29sdW1uczogdmlld0ZpZWxkc30pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGhpcy5zaG93QWR2YW5jZWQoZ3JpZEluc3RhbmNlLCBudWxsLCBzaW1wbGVSZWYuaW5zdGFuY2UuY3VycmVudFNjaGVtZUl0ZW0pO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHNpbXBsZVJlZi5pbnN0YW5jZS5zdWJtaXQuc3Vic2NyaWJlKCAoZTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBlLnRhcmdldC5kaXNhYmxlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zYXZpbmcpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuc2F2aW5nKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0QWN0aXZlU2NoZW1lSXRlbShncmlkSW5zdGFuY2UuaWQsIGUuY3VycmVudFNjaGVtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgXHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlR3JpZFZpZXcoZSwgZ3JpZEluc3RhbmNlLCBlLnRhcmdldCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgc2ltcGxlUmVmLmluc3RhbmNlLmZpZWxkc0NoYW5nZS5zdWJzY3JpYmUoKHZpc2libGVGaWVsZHM6IHN0cmluZ1tdKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUFjdGl2ZVNjaGVtZUl0ZW1TZXR0aW5ncyhncmlkSW5zdGFuY2UuaWQsIHt2aWV3Q29sdW1uczogdmlzaWJsZUZpZWxkc30pXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgLy8g5omT5byA5paw5aKe5pa55qGI56qX5Y+jXHJcbiAgICAgICAgICAgIHNpbXBsZVJlZi5pbnN0YW5jZS5hZGROZXdTY2hlbWUuc3Vic2NyaWJlKChlOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2hvd05ld1NjaGVtZURpYWxvZyhncmlkSW5zdGFuY2UsIGUsIHNpbXBsZVJlZik7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgc2ltcGxlUmVmLmluc3RhbmNlLnNjaGVtZUxpc3QgPSB0aGlzLnNjaGVtZVNlcnZpY2UuZ2V0U3RhdGVWYWx1ZShncmlkSW5zdGFuY2UuaWQsICdsaXN0JykgfHwgW107XHJcblxyXG4gICAgICAgICAgICAvLyDmiZPlvIDmlrnmoYjnrqHnkIbliJfooajnqpflj6NcclxuICAgICAgICAgICAgc2ltcGxlUmVmLmluc3RhbmNlLnNob3dTY2hlbWVMaXN0LnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNjaGVtZVNlcnZpY2UuZ2V0U2NoZW1lTGlzdChncmlkSW5zdGFuY2UuaWQpLnBpcGUoXHJcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoTWFwKCh0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNjaGVtZVNlcnZpY2UuY2hlY2tBdXRob3JpdHkoKS5waXBlKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFwKChhdXRoOiBTY2hlbWVBdXRoTW9kZWwpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXN0OiB0LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuLi5hdXRoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICApLnN1YnNjcmliZSgodDogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zY2hlbWVTZXJ2aWNlLnNldFNjaGVtZUxpc3QoZ3JpZEluc3RhbmNlLmlkLCB0Lmxpc3QgfHwgW10pO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd1NjaGVtZUxpc3REaWFsb2coZ3JpZEluc3RhbmNlLCBjbG9uZURlZXAodC5saXN0IHx8IFtdKSwgdCwgc2ltcGxlUmVmKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuc2NoZW1lTGlzdFN1YnNjcmlwdGlvbiA9IHRoaXMuc2NoZW1lU2VydmljZS5zY2hlbWVMaXN0JC5zdWJzY3JpYmUoKGxpc3Q6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgc2ltcGxlUmVmLmluc3RhbmNlLnNjaGVtZUxpc3QgPSBsaXN0O1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICghbGlzdCB8fCAhbGlzdC5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEFjdGl2ZVNjaGVtZUl0ZW0oZ3JpZEluc3RhbmNlLmlkLCBudWxsKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgX2FjdGl2ZVNjaGVtZUl0ZW0gPSB0aGlzLmdldEFjdGl2ZVNjaGVtZUl0ZW0oZ3JpZEluc3RhbmNlLmlkKTtcclxuICAgICAgICAgICAgICAgIGlmIChfYWN0aXZlU2NoZW1lSXRlbSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBoYXNBY3RpdmVJdGVtID0gbGlzdC5maW5kKG4gPT4gbi5pZCA9PT0gX2FjdGl2ZVNjaGVtZUl0ZW0uaWQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghaGFzQWN0aXZlSXRlbSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBoYXNBY3RpdmVJdGVtID0gdGhpcy5nZXREZWZhdWx0U2NoZW1lKGxpc3QpOyAvLyDojrflj5borr7nva7kuLrlvZPliY3mlrnmoYjnmoTpoblcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRBY3RpdmVTY2hlbWVJdGVtKGdyaWRJbnN0YW5jZS5pZCwgaGFzQWN0aXZlSXRlbSB8fCBudWxsKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHNpbXBsZVJlZi5pbnN0YW5jZS5jdXJyZW50U2NoZW1lSXRlbSA9IGhhc0FjdGl2ZUl0ZW07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgLy8g5YiH5o2i5pa55qGIXHJcbiAgICAgICAgICAgIC8vIHNpbXBsZVJlZi5pbnN0YW5jZS5hY3RpdmVJdGVtQ2hhbmdlLnN1YnNjcmliZSgocjogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIC8vICAgICB0aGlzLnNldEFjdGl2ZVNjaGVtZUl0ZW0oZ3JpZEluc3RhbmNlLmlkLCByKTtcclxuICAgICAgICAgICAgLy8gfSk7XHJcblxyXG4gICAgICAgICAgICBzaW1wbGVSZWYuaW5zdGFuY2Uuc2NoZW1lQ2hhbmdlZC5zdWJzY3JpYmUoKHQ6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50U2NoZW1laXRlbSA9IHQ7XHJcbiAgICAgICAgICAgIH0pXHJcblxyXG4gICAgICAgICAgICBzaW1wbGVSZWYuaG9zdFZpZXcuZGV0ZWN0Q2hhbmdlcygpO1xyXG5cclxuICAgICAgICAgICAgc2ltcGxlUmVmLmluc3RhbmNlLmNvbnRhaW5lci5uYXRpdmVFbGVtZW50LnN0eWxlLnJpZ2h0ID0gJzBweCc7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gc2ltcGxlUmVmO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG4gICAgc2hvdyhncmlkSW5zdGFuY2U6IERhdGFncmlkQ29tcG9uZW50LCBvcHRzPzogTW9kYWxPcHRpb25zKSB7XHJcbiAgICAgICAgdGhpcy5yZWdpc3RlckdyaWRJbnN0YW5jZShncmlkSW5zdGFuY2UpO1xyXG5cclxuICAgICAgICBpZiAoZ3JpZEluc3RhbmNlLmVuYWJsZVNpbXBsZU1vZGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2hvd1NpbXBsZShncmlkSW5zdGFuY2UpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnNob3dBZHZhbmNlZChncmlkSW5zdGFuY2UsIG9wdHMpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNob3dBZHZhbmNlZChncmlkSW5zdGFuY2U6IERhdGFncmlkQ29tcG9uZW50LCBvcHRzPzogTW9kYWxPcHRpb25zLCBzZWxlY3RlZFNjaGVtZUl0ZW0/OiBEYXRhZ3JpZFNjaGVtZU1vZGVsKSB7XHJcbiAgICAgICAgbGV0IF9lZGl0Q29sU29ydEluZm8gPSB0cnVlO1xyXG4gICAgICAgIGNvbnN0IGVkaXRDb2xTb3J0SW5mbyA9IHRoaXMuY2FuU2V0Q29sdW1uU29ydChncmlkSW5zdGFuY2UpO1xyXG4gICAgICAgIGlmIChlZGl0Q29sU29ydEluZm8gIT09IHRydWUpIHtcclxuICAgICAgICAgICAgLy8gdGhpcy5tZXNzYWdlci53YXJuaW5nKG1zZyk7XHJcbiAgICAgICAgICAgIC8vIHJldHVybjtcclxuICAgICAgICAgICAgX2VkaXRDb2xTb3J0SW5mbyA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3Qgc2hvd1NldENvbHVtbnNUYWIgPSAhdGhpcy5pc0hlYWRlckdyb3VwKGdyaWRJbnN0YW5jZSk7XHJcbiAgICAgICAgY29uc3QgZ2V0QWN0aXZlVGFiSW5kZXggPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChzaG93U2V0Q29sdW1uc1RhYikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIDE7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoX2VkaXRDb2xTb3J0SW5mbykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAyO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gLTE7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIGNvbnN0IGFjdGl2ZVRhYkluZGV4ID0gZ2V0QWN0aXZlVGFiSW5kZXgoKTtcclxuXHJcbiAgICAgICAgaWYgKGFjdGl2ZVRhYkluZGV4ID09PSAtMSkge1xyXG4gICAgICAgICAgICB0aGlzLm1lc3NhZ2VyLndhcm5pbmcodGhpcy5ub3RTaG93RGlhbG9nKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgY29sdW1ucyA9IHRoaXMuY29udmVydENvbHVtbnNUb1NpbXBsZShncmlkSW5zdGFuY2UuY29sdW1ucyk7XHJcblxyXG4gICAgICAgIC8vIOiOt+WPluW9k+WJjeaWueahiOS4reW9k+WJjeivreiogOeahOmFjee9ruaVsOaNrlxyXG4gICAgICAgIGxldCBjdXJyZW50U2V0dGluZ3M6IFNldHRpbmdNb2RlbCA9IG51bGw7XHJcbiAgICAgICAgaWYgKHNlbGVjdGVkU2NoZW1lSXRlbSAmJiBzZWxlY3RlZFNjaGVtZUl0ZW0ucXVlcnlDb25kaXRpb25TdHJpbmcpIHtcclxuICAgICAgICAgICAgY3VycmVudFNldHRpbmdzID0gSlNPTi5wYXJzZShzZWxlY3RlZFNjaGVtZUl0ZW0ucXVlcnlDb25kaXRpb25TdHJpbmcpW3RoaXMubG9jYWxlU2VyLmxvY2FsZUlkXTtcclxuXHJcbiAgICAgICAgICAgIGlmIChjdXJyZW50U2V0dGluZ3MuY29sdW1uRm9ybWF0ICYmIGN1cnJlbnRTZXR0aW5ncy5jb2x1bW5Gb3JtYXQubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICBjb2x1bW5zWzBdID0gY29sdW1uc1swXS5tYXAoKGNvbCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGZjb2wgPSBjdXJyZW50U2V0dGluZ3MuY29sdW1uRm9ybWF0LmZpbmQobiA9PiBuLmZpZWxkID09PSBjb2wuZmllbGQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChmY29sKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbCA9IE9iamVjdC5hc3NpZ24oY29sLCBmY29sKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbDtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoY3VycmVudFNldHRpbmdzLnZpZXdDb2x1bW5zICYmIGN1cnJlbnRTZXR0aW5ncy52aWV3Q29sdW1ucy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIGNvbHVtbnNbMF0uZm9yRWFjaChmID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBmLnZpc2libGUgPSBjdXJyZW50U2V0dGluZ3Mudmlld0NvbHVtbnMuaW5kZXhPZihmLmZpZWxkKSA+IC0xO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBjb2x1bW5zWzBdID0gY29sdW1uc1swXS5maWx0ZXIobiA9PiBuLmZpZWxkICYmIG4uZmllbGQgIT09IGdyaWRJbnN0YW5jZS5Db250cm9sUGFuZWxGZWlsZCk7XHJcbiAgICAgICAgY29uc3QgdHJlZURhdGEgPSB0aGlzLmNvbnZlcnRDb2x1bW5zMlRyZWVEYXRhKGNsb25lRGVlcChjb2x1bW5zKSwgdHJ1ZSk7XHJcbiAgICAgICAgY29uc3Qgdmlld0NvbHVtbnNUcmVlRGF0YSA9IHRoaXMuY29udmVydENvbHVtbnMyVHJlZURhdGEoY2xvbmVEZWVwKGNvbHVtbnMpLCBmYWxzZSk7XHJcbiAgICAgICAgdGhpcy5jaGVja1ZpZXdUcmVlTm9kZXModmlld0NvbHVtbnNUcmVlRGF0YSk7XHJcblxyXG4gICAgICAgIGxldCBtb2RhbFJlZiA9IG51bGw7XHJcblxyXG4gICAgICAgIGNvbnN0IG9rVGV4dCA9IHRoaXMubG9jYWxlU2VyLmdldFZhbHVlKCdkYXRhZ3JpZC5zZXR0aW5ncy5vaycpIHx8ICfnoa7lrponO1xyXG4gICAgICAgIGNvbnN0IGNhbmNlbFRleHQgPSB0aGlzLmxvY2FsZVNlci5nZXRWYWx1ZSgnZGF0YWdyaWQuc2V0dGluZ3MuY2FuY2VsJykgfHwgJ+WPlua2iCc7XHJcbiAgICAgICAgY29uc3QgcmVzZXRUZXh0ID0gIHRoaXMubG9jYWxlU2VyLmdldFZhbHVlKCdkYXRhZ3JpZC5zZXR0aW5ncy5yZXNldCcpIHx8ICfph43nva4nO1xyXG5cclxuICAgICAgICBjb25zdCBkZWZhdWx0T3B0cyA9IHtcclxuICAgICAgICAgICAgd2lkdGg6IDc2MCwgaGVpZ2h0OiA1NjAsIHNob3dIZWFkZXI6IGZhbHNlLCB0aXRsZTogJ+aOp+WItumdouadvycsXHJcbiAgICAgICAgICAgIGluaXRpYWxTdGF0ZToge1xyXG4gICAgICAgICAgICAgICAgY29sdW1ucyxcclxuICAgICAgICAgICAgICAgIHNvcnRUcmVlRGF0YTogdHJlZURhdGEsXHJcbiAgICAgICAgICAgICAgICB2aWV3VHJlZURhdGE6IHZpZXdDb2x1bW5zVHJlZURhdGEsXHJcbiAgICAgICAgICAgICAgICBncmlkSW5zdGFuY2UsXHJcbiAgICAgICAgICAgICAgICBjYW5TZXRDb2x1bW5Tb3J0OiBfZWRpdENvbFNvcnRJbmZvLFxyXG4gICAgICAgICAgICAgICAgY2FuU2V0Q29sdW1uVmlzaWJsZTogc2hvd1NldENvbHVtbnNUYWIsXHJcbiAgICAgICAgICAgICAgICBhY3RpdmVUYWJJbmRleCxcclxuICAgICAgICAgICAgICAgIHNjaGVtZUluZm86IGN1cnJlbnRTZXR0aW5nc1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBzaG93QnV0dG9uczogZmFsc2VcclxuICAgICAgICB9O1xyXG4gICAgICAgIGNvbnN0IG1vZGFsT3B0cyA9IE9iamVjdC5hc3NpZ24oZGVmYXVsdE9wdHMsIG9wdHMgfHwge30pO1xyXG5cclxuICAgICAgICBtb2RhbFJlZiA9IHRoaXMubW9kYWxTZXIuc2hvdyhEYXRhZ3JpZFNldHRpbmdzQ29tcG9uZW50LCBtb2RhbE9wdHMpO1xyXG4gICAgICAgIGNvbnN0IGluc3RhbmNlID0gbW9kYWxSZWYuY29udGVudCBhcyBEYXRhZ3JpZFNldHRpbmdzQ29tcG9uZW50O1xyXG4gICAgICAgIGluc3RhbmNlLmVuYWJsZVJlc2V0ID0gdHJ1ZTtcclxuICAgICAgICBpbnN0YW5jZS5tb2RhbFJlZiA9IG1vZGFsUmVmO1xyXG4gICAgICAgIGluc3RhbmNlLmNhblNldENvbHVtblNvcnQgPSBfZWRpdENvbFNvcnRJbmZvO1xyXG4gICAgICAgIGluc3RhbmNlLmNhblNldENvbHVtblZpc2libGUgPSAhdGhpcy5pc0hlYWRlckdyb3VwKGdyaWRJbnN0YW5jZSk7XHJcblxyXG4gICAgICAgIGluc3RhbmNlLnN1Ym1pdEhhbmRsZS5zdWJzY3JpYmUoKGUpID0+IHtcclxuICAgICAgICAgICAgZS50YXJnZXQuZGlzYWJsZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5zYXZpbmcpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIXRoaXMuc2F2aW5nKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoc2VsZWN0ZWRTY2hlbWVJdGVtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRBY3RpdmVTY2hlbWVJdGVtKGdyaWRJbnN0YW5jZS5pZCwgc2VsZWN0ZWRTY2hlbWVJdGVtKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlR3JpZFZpZXcobW9kYWxSZWYsIGdyaWRJbnN0YW5jZSwgZS50YXJnZXQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGluc3RhbmNlLmNhbmNlbEhhbmRsZS5zdWJzY3JpYmUoKGUpID0+IHtcclxuICAgICAgICAgICAgbW9kYWxSZWYuY2xvc2UoKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8g5YiH5o2i5Yiw5L6n6L655qCP566A5rSB5qih5byPXHJcbiAgICAgICAgaW5zdGFuY2UuY29uY2lzZS5zdWJzY3JpYmUoKGUpID0+IHtcclxuICAgICAgICAgICAgbW9kYWxSZWYuY2xvc2UoKTtcclxuICAgICAgICAgICAgY29uc3Qgc2V0dGluZ3MgPSBtb2RhbFJlZi5jb250ZW50O1xyXG4gICAgICAgICAgICBjb25zdCB7IHNvcnRJbmZvLCB2aWV3Q29sdW1ucywgY29sdW1uRm9ybWF0LCBncm91cEZpZWxkIH0gPSBzZXR0aW5ncztcclxuICAgICAgICAgICAgdGhpcy5zaG93U2ltcGxlKGdyaWRJbnN0YW5jZSwgeyBzb3J0SW5mbywgdmlld0NvbHVtbnMsIGNvbHVtbkZvcm1hdCwgZ3JvdXBGaWVsZCB9LCBzZWxlY3RlZFNjaGVtZUl0ZW0pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBjb25zdCBtb2RhbENvbnRhaW5lciA9IG1vZGFsUmVmLmRpYWxvZy5pbnN0YW5jZSBhcyBNb2RhbENvbnRhaW5lckNvbXBvbmVudDtcclxuICAgICAgICBtb2RhbENvbnRhaW5lci5kcmFnZ2Jhci5oYW5kbGUgPSBpbnN0YW5jZS5oZWFkZXIubmF0aXZlRWxlbWVudDtcclxuICAgICAgICByZXR1cm4gbW9kYWxSZWY7XHJcbiAgICB9XHJcblxyXG5cclxuXHJcbiAgICBwcml2YXRlIGNhblNldENvbHVtblNvcnQoZ3JpZEluc3RhbmNlOiBEYXRhZ3JpZENvbXBvbmVudCkge1xyXG4gICAgICAgIGlmIChncmlkSW5zdGFuY2UubXVsdGlTb3J0ICYmIHRoaXMuaGFzRW5hYmxlU29ydENvbHVtbnMoZ3JpZEluc3RhbmNlKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuaGFzRW5hYmxlU29ydENvbHVtbnMoZ3JpZEluc3RhbmNlKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29sdW1uc1NvcnRhYmxlTXNnO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKCFncmlkSW5zdGFuY2UubXVsdGlTb3J0KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5tdWx0aVNvcnRNc2c7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBoYXNFbmFibGVTb3J0Q29sdW1ucyhncmlkSW5zdGFuY2U6IERhdGFncmlkQ29tcG9uZW50KSB7XHJcbiAgICAgICAgY29uc3Qgc29ydENvbHVtbnNDb3VudCA9IGdyaWRJbnN0YW5jZS5mbGF0Q29sdW1ucy5yZWR1Y2UoKGMsIHIpID0+IHtcclxuICAgICAgICAgICAgaWYgKHIuc29ydGFibGUpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBjICsgMTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gYztcclxuICAgICAgICB9LCAwKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHNvcnRDb2x1bW5zQ291bnQgPiAwO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgaXNIZWFkZXJHcm91cChncmlkOiBEYXRhZ3JpZENvbXBvbmVudCkge1xyXG4gICAgICAgIGNvbnN0IGZsYWcgPSBncmlkLmNvbHVtbnMubGVuZ3RoID4gMTtcclxuICAgICAgICBpZiAoZmxhZykge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5ub3RTdXBwb3J0SGVhZGVyR3JvdXBNc2c7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBmbGFnO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0Q2hpbGRzKGNvbHMsIHJvd0luZGV4LCBjb2xTdGFydEluZGV4LCBjb2xDb3VudCwgZm9yU29ydCA9IGZhbHNlKSB7XHJcbiAgICAgICAgY29uc3QgY2hpbGRDb2xzID0gW107XHJcbiAgICAgICAgbGV0IF9jb3VudCA9IGNvbFN0YXJ0SW5kZXg7XHJcbiAgICAgICAgaWYgKCFjb2xzW3Jvd0luZGV4XSkge1xyXG4gICAgICAgICAgICByZXR1cm4gIFtdO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29sc1tyb3dJbmRleF0uc2xpY2UoKS5mb3JFYWNoKGVsZW1lbnQgPT4ge1xyXG4gICAgICAgICAgICBfY291bnQgPSBfY291bnQgKyBlbGVtZW50LmNvbHNwYW47XHJcbiAgICAgICAgICAgIGlmICggX2NvdW50IDw9IGNvbENvdW50ICkge1xyXG4gICAgICAgICAgICAgICAgY2hpbGRDb2xzLnB1c2goZWxlbWVudCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgY29sc1tyb3dJbmRleF0uc3BsaWNlKDAsIGNoaWxkQ29scy5sZW5ndGgpO1xyXG5cclxuICAgICAgICByZXR1cm4gY2hpbGRDb2xzLm1hcCgoYywgaSkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgbjogYW55ID0ge1xyXG4gICAgICAgICAgICAgICAgZGF0YTogYyxcclxuICAgICAgICAgICAgICAgIHNlbGVjdGFibGU6IGZvclNvcnQgPyAhIWMuc29ydGFibGUgOiB0cnVlXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBpZiAoYy5jb2xzcGFuICYmIGMuY29sc3BhbiA+IDEpIHtcclxuICAgICAgICAgICAgICAgIG4gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogYyxcclxuICAgICAgICAgICAgICAgICAgICBzZWxlY3RhYmxlOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICBleHBhbmRlZDogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICBjaGlsZHJlbjogdGhpcy5nZXRDaGlsZHMoY29scywgcm93SW5kZXggKyAxLCAwICwgYy5jb2xzcGFuKVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gbjtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIGNvbnZlcnRDb2x1bW5zMlRyZWVEYXRhKGNvbHM6IERhdGFDb2x1bW5bXVtdLCBmb3JTb3J0ID0gZmFsc2UpIHtcclxuICAgICAgICBjb25zdCBjb2x1bW5zID0gY29scy5tYXAoKGM6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBhYSA9IGMubWFwKChfKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoXy5maWVsZC5pbmRleE9mKCdmYXJyaXMtZGF0YWdyaWQtY29sdW1uXycpID09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgXy5jb2xzcGFuID0gXy5jb2xzcGFuIHx8IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF87XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiBhYS5maWx0ZXIobiA9PiBuKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBpZiAoY29sdW1ucy5sZW5ndGggPT09IDEpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGNvbHVtbnNbMF0ubWFwKGMgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICBkYXRhOiBjLFxyXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGFibGU6IGZvclNvcnQgPyAhIWMuc29ydGFibGUgOiB0cnVlXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gY29sdW1uc1swXS5tYXAoKGMsIGkpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChjLmNvbHNwYW4gJiYgYy5jb2xzcGFuID4gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IGMsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGFibGU6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBleHBhbmRlZDogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW46IHRoaXMuZ2V0Q2hpbGRzKGNvbHVtbnMsIDEsIDAsIGMuY29sc3BhbiwgZm9yU29ydClcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBjLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RhYmxlOiBmb3JTb3J0ID8gISFjLnNvcnRhYmxlIDogdHJ1ZVxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG4gICAgcHJpdmF0ZSBjaGVja1ZpZXdUcmVlTm9kZXModHJlZU5vZGVzOiBUcmVlTm9kZVtdKSB7XHJcbiAgICAgICAgdHJlZU5vZGVzLmZvckVhY2goKHRuOiBUcmVlTm9kZSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoIXRuLmNoaWxkcmVuIHx8ICF0bi5jaGlsZHJlbi5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHRuLnNlbGVjdGFibGUgPSB0cnVlO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdG4uc2VsZWN0YWJsZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jaGVja1ZpZXdUcmVlTm9kZXModG4uY2hpbGRyZW4pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfY29udmVydENvbHVtbnNUb1NpbXBsZShncmlkSW5zdGFuY2U6IGFueSkge1xyXG5cclxuICAgICAgICBsZXQgY29scyA9IGdyaWRJbnN0YW5jZS5jb2x1bW5zO1xyXG4gICAgICAgIC8vIOmHjee9ruWIl+mhuuW6j+S4uuacgOWIneiuvuiuoeaXtueahOmhuuW6j1xyXG4gICAgICAgIGNvbnN0IGdyaWRPcHRzID0gZ3JpZEluc3RhbmNlLmRmcy5fc3RhdGUuaW5pdGlhbE9wdGlvbnM7XHJcbiAgICAgICAgaWYgKGdyaWRPcHRzLmNvbHVtbkZpZWxkcykge1xyXG4gICAgICAgICAgICBsZXQgZGVzZ2luQ29scyA9IGdyaWRPcHRzLmNvbHVtbkZpZWxkcztcclxuICAgICAgICAgICAgY29uc3QgbmV3Q29sdW1ucyA9IFtdO1xyXG5cclxuICAgICAgICAgICAgZGVzZ2luQ29scy5mb3JFYWNoKGMgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKGMuZmllbGQgIT09ICdfZGF0YWdyaWQtc2V0dGluZy1jb250cm9sXycpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb2wgPSBncmlkSW5zdGFuY2UuY29sdW1uc1swXS5maW5kKChuOiBhbnkpID0+IG4uZmllbGQgPT09IGMuZmllbGQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjb2wpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3Q29sdW1ucy5wdXNoKGNvbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGNvbHMgPSBbbmV3Q29sdW1uc107XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gY29scztcclxuICAgIH1cclxuXHJcbiAgICBjb252ZXJ0Q29sdW1uc1RvU2ltcGxlKGNvbHM6IGFueSkge1xyXG4gICAgICAgIHJldHVybiBjb2xzLm1hcCggKF9jb2xzOiBEYXRhQ29sdW1uW10pID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIF9jb2xzLm1hcCggKGM6IERhdGFDb2x1bW4pID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChjLmZpZWxkICE9PSAnX2RhdGFncmlkLXNldHRpbmctY29udHJvbF8nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmllbGQ6IGMuZmllbGQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBjLnRpdGxlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xzcGFuOiBjLmNvbHNwYW4sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJvd3NwYW46IGMucm93c3BhbixcclxuICAgICAgICAgICAgICAgICAgICAgICAgc29ydGFibGU6IGMuc29ydGFibGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9yZGVyOiBjLm9yZGVyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBoYWxpZ246IGMuaGFsaWduIHx8ICdsZWZ0JyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWxpZ246IGMuYWxpZ24gfHwgJ2xlZnQnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2aXNpYmxlOiBjLnZpc2libGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFsbG93R3JvdXBpbmc6IGMuYWxsb3dHcm91cGluZyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXBGb290ZXI6IGMuZ3JvdXBGb290ZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvb3RlcjogYy5mb290ZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiBjLndpZHRoIHx8IDEwMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGU6IGMuZGF0YVR5cGUgfHwgJ3N0cmluZydcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KS5maWx0ZXIobiA9PiBuKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHJlc2V0R3JpZFZpZXcoZ3JpZEluc3RhbmNlOiBhbnkpIHtcclxuICAgICAgICBpZiAoIWdyaWRJbnN0YW5jZSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGRmcyA9IGdyaWRJbnN0YW5jZS5kZnM7XHJcbiAgICAgICAgaWYgKGRmcykge1xyXG4gICAgICAgICAgICBjb25zdCBvcHRpb25zID0gZGZzWydfc3RhdGUnXS5pbml0aWFsT3B0aW9ucztcclxuXHJcbiAgICAgICAgICAgIGlmIChvcHRpb25zLnNvcnQpIHtcclxuICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLnNvcnQuc29ydE5hbWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBncmlkSW5zdGFuY2Uuc29ydE5hbWUgPSBvcHRpb25zLnNvcnQuc29ydE5hbWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5zb3J0LnNvcnRPcmRlcikge1xyXG4gICAgICAgICAgICAgICAgICAgIGdyaWRJbnN0YW5jZS5zb3J0T3JkZXIgPSBvcHRpb25zLnNvcnQuc29ydE9yZGVyO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBncmlkSW5zdGFuY2UuZ3JvdXBGaWVsZCA9IG9wdGlvbnMuZ3JvdXBGaWVsZCB8fCAnJztcclxuICAgICAgICAgICAgLy8gVE9ETzog6L+Y6ZyA6KaB5L+u5q2j6buY6K6k5YiX55qE5pi+56S66aG65bqPXHJcbiAgICAgICAgICAgIGlmIChvcHRpb25zLmNvbHVtbkZpZWxkcyAmJiBvcHRpb25zLmNvbHVtbkZpZWxkcy5sZW5ndGgpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdDb2x1bW5zID0gW107XHJcbiAgICAgICAgICAgICAgICBvcHRpb25zLmNvbHVtbkZpZWxkcy5mb3JFYWNoKGMgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbCA9IGdyaWRJbnN0YW5jZS5jb2x1bW5zWzBdLmZpbmQoKG46IGFueSkgPT4gbi5maWVsZCA9PT0gYy5maWVsZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2wudmlzaWJsZSA9IGMudmlzaWJsZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29sLmhhbGlnbiA9IGMuaGFsaWduO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2wuYWxpZ24gPSBjLmFsaWduO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2wud2lkdGggPSBjLndpZHRoO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2wuZm9vdGVyID0gYy5mb290ZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbC5ncm91cEZvb3RlciA9IGMuZ3JvdXBGb290ZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld0NvbHVtbnMucHVzaChjb2wpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIGdyaWRJbnN0YW5jZS5jb2x1bW5zWzBdID0gbmV3Q29sdW1ucztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gZ3JpZEluc3RhbmNlWydjaGVja09wdGlvbnMnXSgpO1xyXG4gICAgICAgICAgICBncmlkSW5zdGFuY2VbJ2NvbHVtbnNDaGFuZ2VkJ10oKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSB1cGRhdGVHcmlkVmlldyhtb2RhbFJlZiwgZ3JpZEluc3RhbmNlLCBidG4gPSBudWxsKSB7XHJcbiAgICAgICAgY29uc3Qgc2V0dGluZ3MgPSBtb2RhbFJlZi5jb250ZW50O1xyXG5cclxuICAgICAgICBpZiAoc2V0dGluZ3MpIHtcclxuICAgICAgICAgICAgY29uc3QgeyBzb3J0SW5mbywgdmlld0NvbHVtbnMsIGNvbHVtbkZvcm1hdCwgZ3JvdXBGaWVsZCwgZ3JvdXBSb3dTdGF0ZSB9ID0gc2V0dGluZ3M7XHJcbiAgICAgICAgICAgIGNvbnN0IF9jb2xmb3JtYXRzID0gY29sdW1uRm9ybWF0ID8gdGhpcy5jb252ZXJ0Q29sdW1uc1RvU2ltcGxlKFtjb2x1bW5Gb3JtYXRdKVswXSA6IFtdO1xyXG5cclxuICAgICAgICAgICAgdGhpcy51cGRhdGVBY3RpdmVTY2hlbWVJdGVtU2V0dGluZ3MoZ3JpZEluc3RhbmNlLmlkLCB7c29ydEluZm8sIHZpZXdDb2x1bW5zLCBjb2x1bW5Gb3JtYXQ6IF9jb2xmb3JtYXRzLCBncm91cEZpZWxkfSk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLnNhdmluZyA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICBsZXQgX2dyb3VwRmllbGQgPSAnJztcclxuICAgICAgICAgICAgaWYgKGdyaWRJbnN0YW5jZS5ncm91cFJvd3MgJiYgZ3JvdXBGaWVsZCAmJiBncm91cEZpZWxkLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgX2dyb3VwRmllbGQgPSBncm91cEZpZWxkLmpvaW4oJywnKSA7XHJcblxyXG4gICAgICAgICAgICAgICAgZ3JpZEluc3RhbmNlLmV4cGFuZEdyb3VwUm93cyA9IGdyb3VwUm93U3RhdGU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZ3JpZEluc3RhbmNlLmdyb3VwRmllbGQgPSBfZ3JvdXBGaWVsZDtcclxuICAgICAgICAgICAgY29uc3Qgc2F2ZURhdGEgPSB7IHNvcnRJbmZvLCB2aWV3Q29sdW1ucywgZ3JvdXBGaWVsZDogX2dyb3VwRmllbGQsIGNvbHVtbkZvcm1hdDogX2NvbGZvcm1hdHMsIGV4cGFuZEdyb3VwUm93czogZ3JvdXBSb3dTdGF0ZSB9O1xyXG4gICAgICAgICAgICB0aGlzLnNldFVzZXJDb25maWcoZ3JpZEluc3RhbmNlLmlkLCBzYXZlRGF0YSkuc3Vic2NyaWJlKCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoYnRuKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYnRuLmRpc2FibGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNhdmluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgaWYgKHZpZXdDb2x1bW5zICYmIHZpZXdDb2x1bW5zLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGdyaWRJbnN0YW5jZS5jb2x1bW5zID0gZ3JpZEluc3RhbmNlLmNvbHVtbnMubWFwKGNvbHMgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUNvbHVtbkZvcm1hdChjb2xzLCBjb2x1bW5Gb3JtYXQsIGdyaWRJbnN0YW5jZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm5ld1Zpc2libGVPcmRlckNvbHVtbnMoY29scywgdmlld0NvbHVtbnMsIGNvbHVtbkZvcm1hdCwgZ3JpZEluc3RhbmNlKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBncmlkSW5zdGFuY2UuY29sdW1uc0NoYW5nZWQodHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoc29ydEluZm8gJiYgT2JqZWN0LmtleXMoc29ydEluZm8pLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgc29ydE5hbWUsIHNvcnRPcmRlciB9ID0gc29ydEluZm87XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNvcnROYW1lICYmIHNvcnROYW1lLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBncmlkSW5zdGFuY2Uuc29ydChzb3J0TmFtZS5qb2luKCcsJyksIHNvcnRPcmRlci5qb2luKCcsJykpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdyaWRJbnN0YW5jZS5jbGVhclNvcnQoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGdyaWRJbnN0YW5jZS5jbGVhclNvcnQoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBtb2RhbFJlZi5jbG9zZSgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBtb2RhbFJlZi5jbG9zZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG4gICAgbmV3VmlzaWJsZU9yZGVyQ29sdW1ucyhjb2xzOiBhbnksIHZpZXdDb2x1bW5zOiBhbnksIGNvbHVtbkZvcm1hdDogYW55LCBncmlkSW5zdGFuY2U6IGFueSkge1xyXG4gICAgICAgIGNvbnN0IGhpZGVDb2x1bW5zID0gW107XHJcbiAgICAgICAgY29scy5mb3JFYWNoKChlbGVtZW50LCBpbmRleCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5pc05ld0FkZENvbHVtbihlbGVtZW50LmZpZWxkLCBjb2x1bW5Gb3JtYXQpICYmIGVsZW1lbnQuZmllbGQgIT09ICdfZGF0YWdyaWQtc2V0dGluZy1jb250cm9sXycgJiYgIWdyaWRJbnN0YW5jZS5lbmFibGVTY2hlbWUpIHtcclxuICAgICAgICAgICAgICAgIHZpZXdDb2x1bW5zLnB1c2goZWxlbWVudC5maWVsZCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50LnZpc2libGUgPSB2aWV3Q29sdW1ucy5pbmNsdWRlcyhlbGVtZW50LmZpZWxkKTtcclxuICAgICAgICAgICAgICAgIGlmICghZWxlbWVudC52aXNpYmxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaGlkZUNvbHVtbnMucHVzaChlbGVtZW50KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyDmuIXnkIbkuI3lrZjlnKjnmoTliJdcclxuICAgICAgICBsZXQgbmV3Q29scyA9IHZpZXdDb2x1bW5zLm1hcCggZmllbGQgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gY29scy5maW5kKGMgPT4gYy5maWVsZCA9PT0gZmllbGQpO1xyXG4gICAgICAgIH0pLmZpbHRlcihuID0+IG4pO1xyXG5cclxuICAgICAgICBpZiAoaGlkZUNvbHVtbnMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIG5ld0NvbHMgPSBuZXdDb2xzLmNvbmNhdChoaWRlQ29sdW1ucyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gbmV3Q29scy5maWx0ZXIoYyA9PiBjICYmIGMuZmllbGQgJiYgYy5maWVsZCAhPT0gJ19kYXRhZ3JpZC1zZXR0aW5nLWNvbnRyb2xfJyApO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5piv5ZCm5Li65paw5aKe5Yqg55qE5a2X5q61XHJcbiAgICAgKiDmlrDlop7nmoTlrZfmrrXvvIzpnIDopoHlnKjliJfooajkuK3lsZXnpLrlh7rmnaXvvIzlubbkv53lrZjliLDkuKrmgKfljJborr7nva7kuK1cclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBpc05ld0FkZENvbHVtbihmaWVsZDogYW55LCBjb2x1bW5zOiBhbnkpIHtcclxuICAgICAgICBjb2x1bW5zID0gY29sdW1ucyB8fCBbXTtcclxuICAgICAgICByZXR1cm4gIWNvbHVtbnMuZmluZChjID0+IGMuZmllbGQgPT09IGZpZWxkKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgdXBkYXRlQ29sdW1uRm9ybWF0KGNvbHM6IGFueVtdLCBjb2x1bW5Gb3JtYXQ6IGFueVtdLCBncmlkSW5zdGFuY2UpIHtcclxuICAgICAgICBpZiAoY29sdW1uRm9ybWF0ICYmIGNvbHVtbkZvcm1hdC5sZW5ndGgpIHtcclxuICAgICAgICAgICAgY29scy5mb3JFYWNoKGNvbCA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBmb3JtYXRDb2wgPSBjb2x1bW5Gb3JtYXQuZmluZChmPT4gZi5maWVsZCA9PT0gY29sLmZpZWxkKTtcclxuICAgICAgICAgICAgICAgIGlmIChmb3JtYXRDb2wpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb2wud2lkdGggPSBmb3JtYXRDb2wud2lkdGg7XHJcbiAgICAgICAgICAgICAgICAgICAgY29sLmhhbGlnbiA9IGZvcm1hdENvbC5oYWxpZ24gfHwgJ2xlZnQnO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbC5hbGlnbiA9IGZvcm1hdENvbC5hbGlnbiB8fCAnbGVmdCc7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChncmlkSW5zdGFuY2UuZ3JvdXBSb3dzICYmIChjb2wuYWxsb3dHcm91cGluZyB8fCBjb2wuYWxsb3dHcm91cGluZyA9PT0gdW5kZWZpbmVkKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWNvbC5ncm91cEZvb3Rlcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sLmdyb3VwRm9vdGVyID0gZm9ybWF0Q29sLmdyb3VwRm9vdGVyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29sLmdyb3VwRm9vdGVyICYmIGNvbC5ncm91cEZvb3Rlci5vcHRpb25zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2wuZ3JvdXBGb290ZXIub3B0aW9ucy50ZXh0ID0gZm9ybWF0Q29sLmdyb3VwRm9vdGVyLm9wdGlvbnMudGV4dCB8fCAnJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbC5ncm91cEZvb3Rlci5vcHRpb25zLmNhbGN1bGF0aW9uVHlwZSA9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWF0Q29sLmdyb3VwRm9vdGVyLm9wdGlvbnMuY2FsY3VsYXRpb25UeXBlICE9PSB1bmRlZmluZWQgJiZcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXRDb2wuZ3JvdXBGb290ZXIub3B0aW9ucy5jYWxjdWxhdGlvblR5cGUgIT09IG51bGwgP1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlSW50KGZvcm1hdENvbC5ncm91cEZvb3Rlci5vcHRpb25zLmNhbGN1bGF0aW9uVHlwZSwgMTApIDogLTE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChncmlkSW5zdGFuY2Uuc2hvd0Zvb3RlciAmJiAhZ3JpZEluc3RhbmNlLmZvb3RlclRlbXBsYXRlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghY29sLmZvb3Rlcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sLmZvb3RlciA9IGZvcm1hdENvbC5mb290ZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb2wuZm9vdGVyICYmIGNvbC5mb290ZXIub3B0aW9ucykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sLmZvb3Rlci5vcHRpb25zLnRleHQgPSBmb3JtYXRDb2wuZm9vdGVyLm9wdGlvbnMudGV4dCB8fCAnJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbC5mb290ZXIub3B0aW9ucy5jYWxjdWxhdGlvblR5cGUgPVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdENvbC5mb290ZXIub3B0aW9ucy5jYWxjdWxhdGlvblR5cGUgIT09IHVuZGVmaW5lZCAmJlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdENvbC5mb290ZXIub3B0aW9ucy5jYWxjdWxhdGlvblR5cGUgIT09IG51bGwgP1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlSW50KGZvcm1hdENvbC5mb290ZXIub3B0aW9ucy5jYWxjdWxhdGlvblR5cGUsIDEwKSA6IC0xO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5Yib5bu65ZSv5LiAa2V5LCDnlLF1cmkgKyBncmlkSWQg57uE5oiQ77yM5bm25re35reGXHJcbiAgICBwcml2YXRlIGNyZWF0ZUNvbmZpZ0tleShncmlkSWQ6IHN0cmluZykge1xyXG4gICAgICAgIGNvbnN0IGdyaWQgPSB0aGlzLmdldEdyaWRJbnN0YW5jZShncmlkSWQpO1xyXG4gICAgICAgIGlmIChncmlkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBncmlkLmRncy5jcmVhdGVDb25maWdLZXkoZ3JpZElkKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLndyaXRlRGVidWdNc2coJ0RhdGFncmlkU2V0dGluZ1NlcnZpY2U6IENhbiBub3QgZmluZCB0aGUgZ3JpZCBpbnN0YW5jZS4nKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwcml2YXRlIGdldEN1cnJlbnRVc2VyU2V0dGluZ3MoZ3JpZElkOiBzdHJpbmcpIHtcclxuICAgICAgICBjb25zdCBncmlkSW5zdGFuY2UgPSB0aGlzLmdldEdyaWRJbnN0YW5jZShncmlkSWQpO1xyXG4gICAgICAgIGNvbnN0IGNvbmZpZyA9IHtzb3J0SW5mbzoge30sIHZpZXdDb2x1bW5zOiBbXSwgZ3JvdXBGaWVsZDogJycsIGNvbHVtbkZvcm1hdDogW119O1xyXG5cclxuICAgICAgICBpZiAoZ3JpZEluc3RhbmNlKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHsgc29ydE5hbWUsIHNvcnRPcmRlciwgY29sdW1uc30gPSBncmlkSW5zdGFuY2U7XHJcbiAgICAgICAgICAgIGlmIChzb3J0TmFtZSkge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgc29ydEluZm8gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc29ydE5hbWU6IHNvcnROYW1lLnNwbGl0KCcsJyksXHJcbiAgICAgICAgICAgICAgICAgICAgc29ydE9yZGVyOiBzb3J0T3JkZXIuc3BsaXQoJywnKVxyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25maWcuc29ydEluZm8gPSBzb3J0SW5mbztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY29uc3Qgdmlld0NvbHVtbnMgPSBjb2x1bW5zWzBdLmZpbHRlcihuID0+IG4udmlzaWJsZSB8fCBuLnZpc2libGUgPT09IHVuZGVmaW5lZCkubWFwKG4gPT4gbi5maWVsZCk7XHJcbiAgICAgICAgICAgIGNvbmZpZy52aWV3Q29sdW1ucyA9IHZpZXdDb2x1bW5zO1xyXG4gICAgICAgICAgICBjb25maWcuY29sdW1uRm9ybWF0ID0gdGhpcy5jb252ZXJ0Q29sdW1uc1RvU2ltcGxlKHRoaXMuX2NvbnZlcnRDb2x1bW5zVG9TaW1wbGUoZ3JpZEluc3RhbmNlKSlbMF07XHJcblxyXG4gICAgICAgICAgICBpZiAoZ3JpZEluc3RhbmNlLmdyb3VwUm93cykge1xyXG4gICAgICAgICAgICAgICAgY29uZmlnLmdyb3VwRmllbGQgPSBncmlkSW5zdGFuY2UuZ3JvdXBGaWVsZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gY29uZmlnO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBzYXZlVXNlckNvbmZpZyhncmlkSWQ6IHN0cmluZykge1xyXG4gICAgICAgIGNvbnN0IGNvbmZpZyA9IHRoaXMuZ2V0Q3VycmVudFVzZXJTZXR0aW5ncyhncmlkSWQpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLnNldFVzZXJDb25maWcoZ3JpZElkLCBjb25maWcpO1xyXG4gICAgfVxyXG5cclxuICAgIHNldFVzZXJDb25maWcoZ3JpZElkOiBzdHJpbmcsIGNvbmZpZzogYW55ICk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICAgICAgY29uc3Qga2V5ID0gdGhpcy5jcmVhdGVDb25maWdLZXkoZ3JpZElkKTtcclxuICAgICAgICBjb25zdCBMT0NBTEVJRCA9IHRoaXMubG9jYWxlU2VyLmxvY2FsZUlkO1xyXG4gICAgICAgIGNvbnN0IGN1cnJlbnRDb25maWcgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShrZXkpO1xyXG4gICAgICAgIGNvbnN0IF9jb25maWcgPSAoY3VycmVudENvbmZpZyA/IEpTT04ucGFyc2UoY3VycmVudENvbmZpZykgOiB7IH0pIHx8IHt9O1xyXG4gICAgICAgIGlmIChjb25maWcpIHtcclxuICAgICAgICAgICAgaWYgKF9jb25maWcpIHtcclxuICAgICAgICAgICAgICAgIF9jb25maWdbTE9DQUxFSURdID0gY29uZmlnO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShrZXksIEpTT04uc3RyaW5naWZ5KF9jb25maWcpKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShrZXkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5odHRwUmVzdFNlcnZpY2UpIHtcclxuICAgICAgICAgICAgY29uc3QgZ3JpZElucyA9IHRoaXMuZ2V0R3JpZEluc3RhbmNlKGdyaWRJZCk7XHJcbiAgICAgICAgICAgIGlmIChncmlkSW5zICYmIGdyaWRJbnMuZW5hYmxlU2NoZW1lKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBhY3RpdmVTY2hlbWUgPSB0aGlzLmdldEFjdGl2ZVNjaGVtZUl0ZW0oZ3JpZElkKTtcclxuICAgICAgICAgICAgICAgIGlmIChhY3RpdmVTY2hlbWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyByZXR1cm4gdGhpcy51cGRhdGVTY2hlbWUoZ3JpZElkLCBjb25maWcpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChhY3RpdmVTY2hlbWUudHlwZSA9PT0gJ3ByaXZhdGUnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNjaGVtZVNlcnZpY2Uuc2F2ZVNjaGVtZShhY3RpdmVTY2hlbWUsIGdyaWRJZCwgdHJ1ZSlcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zY2hlbWVTZXJ2aWNlLmNoZWNrQXV0aG9yaXR5KCkucGlwZShcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaE1hcCgodDogU2NoZW1lQXV0aE1vZGVsKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHQuc3VjY2Vzcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBoYXNPcmdBdXRob3JpdHkgPSB0LmF1dGhPcmdhbml6YXRpb25EYXRhICYmIHQuYXV0aE9yZ2FuaXphdGlvbkRhdGEubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWN0aXZlU2NoZW1lLnR5cGUgPT09ICdwdWJsaWMnIHx8IChhY3RpdmVTY2hlbWUudHlwZSA9PT0gJ29yZycgJiYgaGFzT3JnQXV0aG9yaXR5KSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2NoZW1lU2VydmljZS5zYXZlU2NoZW1lKGFjdGl2ZVNjaGVtZSwgZ3JpZElkLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvZih0cnVlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyDkv53lrZjoh7PmlbDmja7lupNcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NhdmVVc2VyQ29uZmlnKGtleSwgIGNvbmZpZyA/IF9jb25maWcgOiAgJycpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldFVzZXJDb25maWcoa2V5KTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgICAgICBpZiAodGhpcy5odHRwUmVzdFNlcnZpY2UpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2dldFVzZXJDb25maWcoa2V5KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zdCBjb25maWcgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShrZXkpO1xyXG4gICAgICAgICAgICBpZiAoY29uZmlnKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBjb24gPSBKU09OLnBhcnNlKGNvbmZpZyk7XHJcbiAgICAgICAgICAgICAgICBpZiAoY29uW3RoaXMubG9jYWxlU2VyLmxvY2FsZUlkXSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvZihjb25bdGhpcy5sb2NhbGVTZXIubG9jYWxlSWRdKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5rZXlzKGNvbikuaW5kZXhPZigndmlld0NvbHVtbnMnKSA+IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvZihjb24pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBvZihudWxsKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldERlZmF1bHRTY2hlbWUoc2NoZW1lTGlzdDogQXJyYXk8RGF0YWdyaWRTY2hlbWVNb2RlbD4pIHtcclxuICAgICAgICAvLyAx44CB5pyJ5Liq5Lq66buY6K6k55qE6L+U5Zue5Liq5Lq66buY6K6k5pa55qGIXHJcbiAgICAgICAgLy8gMuOAgeayoeacieS4quS6uum7mOiupOaWueahiOeahO+8jOi/lOWbnuWFrOWFseaWueahiOesrDHkuKpcclxuICAgICAgICAvLyAz44CB5rKh5pyJ5YWs5YWx5pa55qGI77yM6L+U5Zue57uE57uH5pa55qGI56ysMeS4qlxyXG4gICAgICAgIC8vIDTjgIHmsqHmnInnu4Tnu4fmlrnmoYjnmoQsIOi/lOWbnuS4quS6uuaWueahiOesrDHkuKpcclxuICAgICAgICAvLyA144CB5rKh5pyJ5Liq5Lq65pa55qGI55qE77yM6L+U5Zue57O757uf6aKE5Yi277yM5Y2z6KGo5Y2V6K6+6K6h5pe255qE5qC85byPXHJcblxyXG4gICAgICAgIGxldCBkZWZhdWx0U2NoZW1lID0gbnVsbDtcclxuICAgICAgICBpZiAoIXNjaGVtZUxpc3QgfHwgIXNjaGVtZUxpc3QubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBkZWZhdWx0U2NoZW1lO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGRlZmF1bHRTY2hlbWUgPSBzY2hlbWVMaXN0LmZpbmQobiA9PiBuLmlzRGVmYXVsdCk7XHJcbiAgICAgICAgICAgIGlmICghZGVmYXVsdFNjaGVtZSkge1xyXG4gICAgICAgICAgICAgICAgbGV0IHB1YmxpY1NjaGVtZXMgPSBzY2hlbWVMaXN0LmZpbHRlcihuID0+IG4udHlwZSA9PT0gJ3B1YmxpYycpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICghcHVibGljU2NoZW1lcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICBwdWJsaWNTY2hlbWVzID0gc2NoZW1lTGlzdC5maWx0ZXIobiA9PiBuLnR5cGUgPT09ICdvcmcnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAocHVibGljU2NoZW1lcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0U2NoZW1lID0gcHVibGljU2NoZW1lc1swXTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdFNjaGVtZSA9IHNjaGVtZUxpc3RbMF07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBkZWZhdWx0U2NoZW1lO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBnZXRTZXR0aW5ncyhncmlkSWQ6IHN0cmluZykge1xyXG4gICAgICAgIGNvbnN0IGtleSA9IHRoaXMuY3JlYXRlQ29uZmlnS2V5KGdyaWRJZCk7XHJcbiAgICAgICAgY29uc3QgZ3JpZElucyA9IHRoaXMuZ2V0R3JpZEluc3RhbmNlKGdyaWRJZCk7XHJcblxyXG4gICAgICAgIGxldCBzY2hlbWVMaXN0JCA9IG9mKFtdKTtcclxuICAgICAgICBpZiAoZ3JpZElucyAmJiBncmlkSW5zLmVuYWJsZVNjaGVtZSkge1xyXG4gICAgICAgICAgICBzY2hlbWVMaXN0JCA9IHRoaXMuZ2V0U2NoZW1lTGlzdChncmlkSWQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGZvcmtKb2luKHNjaGVtZUxpc3QkLCB0aGlzLmdldFVzZXJDb25maWcoa2V5KSwgdGhpcy5zY2hlbWVTZXJ2aWNlLmdldExhbmd1YWdlcygpKS5waXBlKFxyXG4gICAgICAgICAgICBtYXAoKFtzY2hlbWVMaXN0LCB1c2VyU2V0dGluZywgc3VwcG9ydGVkTGFuZ3VhZ2VzXSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgc2NoZW1lTGlzdCA9IHNjaGVtZUxpc3QgfHwgW107XHJcbiAgICAgICAgICAgICAgICB0aGlzLmxhbmd1YWdlcyA9IHN1cHBvcnRlZExhbmd1YWdlcztcclxuICAgICAgICAgICAgICAgIGlmICghc2NoZW1lTGlzdC5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXNlclNldHRpbmc7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIOe8k+WtmOaWueahiOWIl+ihqFxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0U2NoZW1lTGlzdChzY2hlbWVMaXN0LCBncmlkSWQpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIOafpeaJvum7mOiupOaWueahiFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGRlZmF1bHRTY2hlbWU6IERhdGFncmlkU2NoZW1lTW9kZWwgPSB0aGlzLmdldERlZmF1bHRTY2hlbWUoc2NoZW1lTGlzdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFkZWZhdWx0U2NoZW1lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1c2VyU2V0dGluZztcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEFjdGl2ZVNjaGVtZUl0ZW0oZ3JpZElkLCBkZWZhdWx0U2NoZW1lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHVzZXJTZXR0aW5ncyA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkZWZhdWx0U2NoZW1lLnF1ZXJ5Q29uZGl0aW9uU3RyaW5nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyU2V0dGluZ3MgPSBKU09OLnBhcnNlKGRlZmF1bHRTY2hlbWUucXVlcnlDb25kaXRpb25TdHJpbmcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1c2VyU2V0dGluZ3MpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxvY2FsZUlkID0gdGhpcy5sb2NhbGVTZXIubG9jYWxlSWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodXNlclNldHRpbmdzW2xvY2FsZUlkXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGtleSwgSlNPTi5zdHJpbmdpZnkodXNlclNldHRpbmdzKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVzZXJTZXR0aW5nc1tsb2NhbGVJZF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJTZXR0aW5nc1tsb2NhbGVJZF0gPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGtleSwgSlNPTi5zdHJpbmdpZnkodXNlclNldHRpbmdzKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwcml2YXRlIF9zYXZlVXNlckNvbmZpZyhrZXksIGNvbmZpZykge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHVzZXJDb25maWdTZXR0aW5nID0ge1xyXG4gICAgICAgICAgICAgICAgY29uZmlna2V5MToga2V5LFxyXG4gICAgICAgICAgICAgICAgY29uZmlna2V5MjogJycsXHJcbiAgICAgICAgICAgICAgICBjb25maWdrZXkzOiAnJyxcclxuICAgICAgICAgICAgICAgIHRleHR2YWx1ZTogY29uZmlnID8gSlNPTi5zdHJpbmdpZnkoY29uZmlnKSA6ICAnJ1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaHR0cFJlc3RTZXJ2aWNlLnNhdmVVc2VyU2V0dGluZ3ModXNlckNvbmZpZ1NldHRpbmcpO1xyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgdGhpcy53cml0ZURlYnVnTXNnKGUsICdlcnJvcicpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXNldFVzZXJDb25maWcoZ3JpZEluc3RhbmNlLCBtb2RhbFJlZikge1xyXG4gICAgICAgIGNvbnN0IHJlc3RvckRlZmF1bHRUZXh0ID0gdGhpcy5sb2NhbGVTZXIuZ2V0VmFsdWUoJ2RhdGFncmlkLnNldHRpbmdzLnJlc3RvcmVEZWZhdWx0U2V0dGluZ3NUZXh0JykgfHwgJ+ehruiupOimgeaBouWkjem7mOiupOiuvue9ruWQl++8nyc7XHJcbiAgICAgICAgdGhpcy5tZXNzYWdlci5jb25maXJtKHJlc3RvckRlZmF1bHRUZXh0KS5waXBlKFxyXG4gICAgICAgICAgICBzd2l0Y2hNYXAoICh0OiBib29sZWFuKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAodCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNldFVzZXJDb25maWcoZ3JpZEluc3RhbmNlLmlkLCAnJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gb2YodCk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgKS5zdWJzY3JpYmUoKHQ6IGJvb2xlYW4pID0+IHtcclxuICAgICAgICAgICAgaWYgKHQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVzZXRHcmlkVmlldyhncmlkSW5zdGFuY2UpO1xyXG4gICAgICAgICAgICAgICAgbW9kYWxSZWYuY2xvc2UoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgX2dldFVzZXJDb25maWcoa2V5KSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaHR0cFJlc3RTZXJ2aWNlLmdldFVzZXJTZXR0aW5ncyhrZXkpLnBpcGUoXHJcbiAgICAgICAgICAgICAgICBtYXAoKHVjczogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHVjcyAmJiB1Y3MudGV4dFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGMgPSBKU09OLnBhcnNlKHVjcy50ZXh0VmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNbdGhpcy5sb2NhbGVTZXIubG9jYWxlSWRdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oa2V5LCB1Y3MudGV4dFZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY1t0aGlzLmxvY2FsZVNlci5sb2NhbGVJZF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNbdGhpcy5sb2NhbGVTZXIubG9jYWxlSWRdID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShrZXksIEpTT04uc3RyaW5naWZ5KGMpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiAoT2JqZWN0LmtleXMoYykuaW5kZXhPZigndmlld0NvbHVtbnMnKSA+IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgIHJldHVybiBjO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmRlYnVnU2VyKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRlYnVnU2VyLmVycm9yKGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgYnVpbGRTdWJtaXREYXRhKGdyaWRJZDogc3RyaW5nLCBzZXR0aW5ncyA9IG51bGwpIHtcclxuICAgICAgICBjb25zdCBMT0NBTEVJRCA9IHRoaXMubG9jYWxlU2VyLmxvY2FsZUlkO1xyXG4gICAgICAgIGlmICghc2V0dGluZ3MpIHtcclxuICAgICAgICAgICAgc2V0dGluZ3MgPSB0aGlzLmdldEN1cnJlbnRVc2VyU2V0dGluZ3MoZ3JpZElkKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgbG9jYWxlS2V5ID0gdGhpcy5jcmVhdGVDb25maWdLZXkoZ3JpZElkKTtcclxuICAgICAgICBjb25zdCBjdXJyZW50Q29uZmlnID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0obG9jYWxlS2V5KTtcclxuICAgICAgICBjb25zdCBfY29uZmlnID0gKGN1cnJlbnRDb25maWcgPyBKU09OLnBhcnNlKGN1cnJlbnRDb25maWcpIDogeyB9KSB8fCB7fTtcclxuICAgICAgICBpZiAoX2NvbmZpZykge1xyXG4gICAgICAgICAgICBfY29uZmlnW0xPQ0FMRUlEXSA9IHNldHRpbmdzO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIF9jb25maWc7XHJcbiAgICB9XHJcblxyXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBcXFxcXHJcblxyXG4gICAgcHJpdmF0ZSBzaG93U2NoZW1lTGlzdERpYWxvZyhncmlkSW5zdGFuY2U6IGFueSwgc2NoZW1lTGlzdDogYW55LCBhdXRoSW5mbzogU2NoZW1lQXV0aE1vZGVsLCBzaW1wbGVSZWY6IGFueSkge1xyXG4gICAgICAgIGNvbnN0IG1vZGFsT3B0cyA9IHtcclxuICAgICAgICAgICAgd2lkdGg6IDc2MCwgaGVpZ2h0OiA1NzcsIHNob3dIZWFkZXI6IGZhbHNlLCB0aXRsZTogJ+aOp+WItumdouadvycsXHJcbiAgICAgICAgICAgIGluaXRpYWxTdGF0ZToge1xyXG4gICAgICAgICAgICAgICAgaXRlbXM6IHNjaGVtZUxpc3QgfHwgW10sXHJcbiAgICAgICAgICAgICAgICByZW1vdmVJdGVtOiBhdXRoSW5mby5zdWNjZXNzLFxyXG4gICAgICAgICAgICAgICAgY3VycmVudFVzZXJJZDogYXV0aEluZm8uY3VycmVudFVzZXJJZFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBzaG93QnV0dG9uczogZmFsc2VcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBjb25zdCBzY2hlbWVMaXN0RGxnID0gdGhpcy5tb2RhbFNlci5zaG93KFNjaGVtZUxpc3RDb21wb25lbnQsIG1vZGFsT3B0cyk7XHJcbiAgICAgICAgc2NoZW1lTGlzdERsZy5kaWFsb2cubG9jYXRpb24ubmF0aXZlRWxlbWVudC5zdHlsZS56SW5kZXggPSAyMDMxO1xyXG5cclxuICAgICAgICBjb25zdCBpbnN0YW5jZSA9IHNjaGVtZUxpc3REbGcuY29udGVudCBhcyBTY2hlbWVMaXN0Q29tcG9uZW50O1xyXG4gICAgICAgIGluc3RhbmNlLmNsb3NlTW9kYWwuc3Vic2NyaWJlKCAoKSA9PiB7XHJcbiAgICAgICAgICAgIHNjaGVtZUxpc3REbGcuY2xvc2UoKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaW5zdGFuY2Uuc3VibWl0TW9kYWwuc3Vic2NyaWJlKCh0OiBhbnkpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5zY2hlbWVTZXJ2aWNlLnVwZGF0ZVNjaGVtZSh0LCBncmlkSW5zdGFuY2UuaWQpLnN1YnNjcmliZSgoZTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZihlID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNjaGVtZUxpc3REbGcuY2xvc2UoKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjb25zdCBtc2cgPSAn5YiX6K6+572u5pa55qGI5L+d5a2Y5oiQ5Yqf44CCJztcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLm5vdGlmeVNlcnZpY2UpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm5vdGlmeVNlcnZpY2Uuc3VjY2Vzcyhtc2cpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm1lc3NhZ2VyLnN1Y2Nlc3MobXNnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZih0LmRlZmF1bHRJZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNjaGVtZUxpc3QuZm9yRWFjaChuID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbi5pc0RlZmF1bHQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG4uaWQgPT09IHQuZGVmYXVsdElkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLmlzRGVmYXVsdCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLnNldEFjdGl2ZVNjaGVtZUl0ZW0oZ3JpZEluc3RhbmNlLmlkLCBuKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGxldCBuZXdTY2hlbWVMaXN0ID0gc2NoZW1lTGlzdDtcclxuICAgICAgICAgICAgICAgIGlmICh0LmRlbGV0ZWRJZHMgJiYgdC5kZWxldGVkSWRzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5ld1NjaGVtZUxpc3QgPSBzY2hlbWVMaXN0LmZpbHRlcihuID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICF0LmRlbGV0ZWRJZHMuaW5jbHVkZXMobi5pZClcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLnNjaGVtZVNlcnZpY2Uuc2V0U2NoZW1lTGlzdChncmlkSW5zdGFuY2UuaWQsIG5ld1NjaGVtZUxpc3QpO1xyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRTY2hlbWUgPSB0aGlzLmdldEFjdGl2ZVNjaGVtZUl0ZW0oZ3JpZEluc3RhbmNlLmlkKTtcclxuICAgICAgICAgICAgICAgIGlmICghY3VycmVudFNjaGVtZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0QWN0aXZlU2NoZW1lSXRlbShncmlkSW5zdGFuY2UuaWQsIG51bGwpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNpbXBsZVJlZi5pbnN0YW5jZS5jdXJyZW50U2NoZW1lSXRlbSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgc2ltcGxlUmVmLmluc3RhbmNlLnJlc2V0MkRlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBzY2hlbWVMaXN0RGxnLmNsb3NlKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBjb25zdCBtb2RhbENvbnRhaW5lciA9IHNjaGVtZUxpc3REbGcuZGlhbG9nLmluc3RhbmNlIGFzIE1vZGFsQ29udGFpbmVyQ29tcG9uZW50O1xyXG4gICAgICAgIG1vZGFsQ29udGFpbmVyLmRyYWdnYmFyLmhhbmRsZSA9IGluc3RhbmNlLmhlYWRlci5uYXRpdmVFbGVtZW50O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOaWsOWinuaIluWPpuWtmOaWueahiFxyXG4gICAgcHJpdmF0ZSBzaG93TmV3U2NoZW1lRGlhbG9nKGdyaWRJbnN0YW5jZSwgZTogeyB0eXBlOiAnbmV3JyB8ICdzYXZlYXMnfSwgIHNpbXBsZVJlZjogYW55KSB7XHJcbiAgICAgICAgY29uc3QgbW9kYWxPcHRzID0ge1xyXG4gICAgICAgICAgICB3aWR0aDogNDgwLCBoZWlnaHQ6IDI2OSwgc2hvd0hlYWRlcjogZmFsc2UsIHRpdGxlOiAn5o6n5Yi26Z2i5p2/JyxcclxuICAgICAgICAgICAgaW5pdGlhbFN0YXRlOiB7XHJcbiAgICAgICAgICAgICAgICBsYW5ndWFnZXM6IHRoaXMubGFuZ3VhZ2VzXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHNob3dCdXR0b25zOiBmYWxzZSxcclxuICAgICAgICAgICAgcmVzaXphYmxlOiBmYWxzZVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGNvbnN0IG5ld1NjaGVtZURsZyA9IHRoaXMubW9kYWxTZXIuc2hvdyhOZXdTY2hlbWVDb21wb25lbnQsIG1vZGFsT3B0cyk7XHJcbiAgICAgICAgbmV3U2NoZW1lRGxnLmRpYWxvZy5sb2NhdGlvbi5uYXRpdmVFbGVtZW50LnN0eWxlLnpJbmRleCA9IDIwMzE7XHJcbiAgICAgICAgY29uc3QgaW5zdGFuY2UgPSBuZXdTY2hlbWVEbGcuY29udGVudCBhcyBOZXdTY2hlbWVDb21wb25lbnQ7XHJcbiAgICAgICAgaW5zdGFuY2UuY2xvc2VNb2RhbC5zdWJzY3JpYmUoICgpID0+IHtcclxuICAgICAgICAgICAgbmV3U2NoZW1lRGxnLmNsb3NlKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGluc3RhbmNlLnN1Ym1pdE1vZGFsLnBpcGUoXHJcbiAgICAgICAgICAgIHN3aXRjaE1hcCgodDogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVOZXdTY2hlbWUoZ3JpZEluc3RhbmNlLmlkLCB0LCBlLnR5cGUgPT09ICduZXcnLCBzaW1wbGVSZWYuaW5zdGFuY2UuY29sbGVjdFNldHRpbmdzKCkpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICkuc3Vic2NyaWJlKCh0OiBhbnkpID0+IHtcclxuICAgICAgICAgICAgaWYgKHQuZmxhZyA9PT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG1zZyA9IHQubXNnO1xyXG4gICAgICAgICAgICAgICAgbGV0IF9tc2cgPSBtc2c7XHJcbiAgICAgICAgICAgICAgICBpZiAobXNnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1zZy5pbmRleE9mKCd8JykgPiAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBfbXNnID0gbXNnLnNwbGl0KCd8JykubWFwKChsYW5nY29kZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubG9jYWxlU2VyLmdldFZhbHVlKCdkYXRhZ3JpZC1zZXR0aW5ncy4nKyBsYW5nY29kZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSkuam9pbignJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgX21zZyA9IHRoaXMubG9jYWxlU2VyLmdldFZhbHVlKCdkYXRhZ3JpZC1zZXR0aW5ncy4nKyBtc2cgKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMubm90aWZ5U2VydmljZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm5vdGlmeVNlcnZpY2UuaW5mbyhfbXNnKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1lc3NhZ2VyLmluZm8oX21zZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIOabtOaWsOaWueahiOWIl+ihqFxyXG4gICAgICAgICAgICBjb25zdCBzY2hlbWVMaXN0ID0gdGhpcy5zY2hlbWVTZXJ2aWNlLmdldFN0YXRlVmFsdWUoZ3JpZEluc3RhbmNlLmlkLCAnbGlzdCcpIHx8IFtdO1xyXG4gICAgICAgICAgICBpZiAodC5pc0RlZmF1bHQpIHtcclxuICAgICAgICAgICAgICAgIHNjaGVtZUxpc3QuZm9yRWFjaChuID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBuLmlzRGVmYXVsdCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2NoZW1lTGlzdC5wdXNoKHQpO1xyXG4gICAgICAgICAgICAvLyB0aGlzLnNldEFjdGl2ZVNjaGVtZUl0ZW0oZ3JpZEluc3RhbmNlLmlkLCB0KTtcclxuICAgICAgICAgICAgdGhpcy5zY2hlbWVTZXJ2aWNlLnNldFNjaGVtZUxpc3QoZ3JpZEluc3RhbmNlLmlkLCBzY2hlbWVMaXN0KTtcclxuXHJcbiAgICAgICAgICAgIC8vIOabtOaNouS4uuaWsOeahOaWueahiFxyXG4gICAgICAgICAgICBzaW1wbGVSZWYuaW5zdGFuY2Uub25TY2hlbWVJdGVtQ2xpY2sobnVsbCwgdCk7XHJcbiAgICAgICAgICAgIG5ld1NjaGVtZURsZy5jbG9zZSgpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpbnN0YW5jZS5jaGVja0F1dGhvcml0eS5waXBlKFxyXG4gICAgICAgICAgICBzd2l0Y2hNYXAoKHQ6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2NoZW1lU2VydmljZS5jaGVja0F1dGhvcml0eSgpLnBpcGUoXHJcbiAgICAgICAgICAgICAgICAgICAgbWFwKChhdXRoOiBTY2hlbWVBdXRoTW9kZWwpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IHQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuLi5hdXRoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICkuc3Vic2NyaWJlKCh0OiBhbnkpID0+IHtcclxuICAgICAgICAgICAgbGV0IGhhc0F1dGhvcml0eSA9IHsgcHVibGljOiB0cnVlLCBvcmc6IHRydWUgfTtcclxuICAgICAgICAgICAgLy8g5oKo5rKh5pyJ5bCG5pa55qGI55qE5L2/55So6IyD5Zu06K6+572u5Li65YWs5YWx55qE5p2D6ZmQ44CCXHJcbiAgICAgICAgICAgIGxldCBfbXNnID0gJ25vQXV0aC5wdWJsaWMnO1xyXG4gICAgICAgICAgICBpZiAodC50eXBlLnZhbHVlID09PSAnb3JnJykge1xyXG4gICAgICAgICAgICAgICAgLy8g5oKo5rKh5pyJ5bCG5pa55qGI55qE5L2/55So6IyD5Zu06K6+572u5Li657uE57uH55qE5p2D6ZmQ44CCXHJcbiAgICAgICAgICAgICAgICBfbXNnID0gJ25vQXV0aC5vcmcnO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjb25zdCBtc2cgPSB0aGlzLmxvY2FsZVNlci5nZXRWYWx1ZSgnZGF0YWdyaWQtc2V0dGluZ3MuJysgX21zZyApO1xyXG4gICAgICAgICAgICBpZiAodC5zdWNjZXNzKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBoYXNQdWJsaWNBdXRob3JpdHkgPSB0LmF1dGhPcGVyYXRpb25EYXRhICYmIHQuYXV0aE9wZXJhdGlvbkRhdGEubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgaGFzQXV0aG9yaXR5LnB1YmxpYyA9IGhhc1B1YmxpY0F1dGhvcml0eTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGhhc09yZ0F1dGhvcml0eSA9IHQuYXV0aE9yZ2FuaXphdGlvbkRhdGEgJiYgdC5hdXRoT3JnYW5pemF0aW9uRGF0YS5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICBoYXNBdXRob3JpdHkub3JnID0gaGFzT3JnQXV0aG9yaXR5O1xyXG4gICAgICAgICAgICAgICAgaWYgKHQudHlwZS52YWx1ZSA9PT0gJ3B1YmxpYycpIHtcclxuICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZS5zY2hlbWVJbmZvLnR5cGUgPSB0LnR5cGUudmFsdWU7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHQudHlwZS52YWx1ZSA9PT0gJ29yZycpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIWhhc09yZ0F1dGhvcml0eSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm5vdGlmeVNlcnZpY2Uud2FybmluZyhtc2cpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1lbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2Uuc2NoZW1lSW5mby50eXBlID0gdC50eXBlLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZS5zY2hlbWVJbmZvLm9yZ2lkcyA9IHQuYXV0aE9yZ2FuaXphdGlvbkRhdGEuam9pbignLCcpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGluc3RhbmNlLmRhdGFQZXJtaXNzaW9uSWRzID0gdC5hdXRoT3JnYW5pemF0aW9uRGF0YTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm5vdGlmeVNlcnZpY2Uud2FybmluZyhtc2cpO1xyXG4gICAgICAgICAgICAgICAgaGFzQXV0aG9yaXR5ID0geyBwdWJsaWM6IGZhbHNlLCBvcmc6IGZhbHNlIH07O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGluc3RhbmNlLnJlZnJlc2goaGFzQXV0aG9yaXR5KTtcclxuICAgICAgICB9KVxyXG5cclxuICAgICAgICBjb25zdCBtb2RhbENvbnRhaW5lciA9IG5ld1NjaGVtZURsZy5kaWFsb2cuaW5zdGFuY2UgYXMgTW9kYWxDb250YWluZXJDb21wb25lbnQ7XHJcbiAgICAgICAgbW9kYWxDb250YWluZXIuZHJhZ2diYXIuaGFuZGxlID0gaW5zdGFuY2UuaGVhZGVyLm5hdGl2ZUVsZW1lbnQ7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0U2NoZW1lTGlzdChncmlkSWQ6IHN0cmluZykge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnNjaGVtZVNlcnZpY2UuZ2V0U2NoZW1lTGlzdChncmlkSWQpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKiDmlrDlop7mlrnmoYhcclxuICAgICAqICBpc05ld1NjaGVtZe+8jOaYr+WQpuaWsOWKoOaWueahiO+8jOWQpuWImeS4uuWPpuWtmOS4ulxyXG4gICAgICogIGN1cnJlbnRTZXR0aW5nc++8miDlvZPliY3phY3nva7kv6Hmga9cclxuICAgICAqICBkYXRhOiDmlrDlu7rmlrnmoYjnqpflj6PkvKDpgJLmlbDmja5cclxuICAgICAqL1xyXG4gICAgY3JlYXRlTmV3U2NoZW1lKGdyaWRJZDogc3RyaW5nLCBkYXRhOiBhbnksIGlzTmV3U2NoZW1lID0gdHJ1ZSwgY3VycmVudFNldHRpbmdzOiBhbnkpIHtcclxuICAgICAgICBpZighZGF0YS5uYW1lKSB7XHJcbiAgICAgICAgICAgIC8vIG1zZyDor7fovpPlhaXmlrnmoYjlkI3np7BcclxuICAgICAgICAgICAgcmV0dXJuIG9mKHtmbGFnOiBmYWxzZSwgbXNnOiAncmVxdWlyZWQuc2NoZW1lTmFtZSd9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zdCBoYXNOYW1lID0gdGhpcy5zY2hlbWVTZXJ2aWNlLmhhc1NjaGVtZU5hbWUoZ3JpZElkLCBkYXRhLm5hbWUpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBoYXNOYW1lID09PSAnYm9vbGVhbicgJiYgaGFzTmFtZSkge1xyXG4gICAgICAgICAgICAgICAgLy8gbXNnICfmlrnmoYjlkI3np7Dlt7LlrZjlnKjvvIzor7fkv67mlLnjgIInXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gb2Yoe2ZsYWc6IGZhbHNlLCBtc2c6ICdoYXMuZXhpc3QnfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShoYXNOYW1lKSAmJiBoYXNOYW1lLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBjb25zdCBnZXRNZXNzYWdlQ29kZSA9IChsYW5nQ29kZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChsYW5nQ29kZSA9PT0gJ3poLUNIUycpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdoYXMuY2hzJzsgLy8g566A5L2T5Lit5paH5ZCN56ew5bey5a2Y5Zyo44CCXHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmKGxhbmdDb2RlID09PSAnemgtQ0hUJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ2hhcy5jaHQnOyAvLyDnuYHpq5TkuK3mloflkI3nqLHlt7LlrZjlnKjjgIJcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ2hhcy5lbic7IC8vIOiLseaWh+WQjeensOW3suWtmOWcqFxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoaGFzTmFtZS5pbmNsdWRlcyh0aGlzLmxvY2FsZVNlci5sb2NhbGVJZCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBtc2cgPSBnZXRNZXNzYWdlQ29kZSh0aGlzLmxvY2FsZVNlci5sb2NhbGVJZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9mKHtmbGFnOiBmYWxzZSwgbXNnfSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG1zZ3MgPSBoYXNOYW1lLm1hcChuID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldE1lc3NhZ2VDb2RlKG4pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2Yoe2ZsYWc6IGZhbHNlLCBtc2c6IG1zZ3Muam9pbignfCcpfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHJlcXVpcmVkTmFtZSA9IFtdO1xyXG5cclxuXHJcbiAgICAgICAgaWYgKCFkYXRhLm5hbWVbdGhpcy5sb2NhbGVTZXIubG9jYWxlSWRdKSB7XHJcbiAgICAgICAgICAgIHJlcXVpcmVkTmFtZS5wdXNoKHRoaXMubG9jYWxlU2VyLmxvY2FsZUlkKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIHRoaXMubGFuZ3VhZ2VzLmZvckVhY2gobiA9PiB7XHJcbiAgICAgICAgLy8gICAgIGlmIChkYXRhLm5hbWVbbi5jb2RlXSA9PT0gJycgfHwgZGF0YS5uYW1lW24uY29kZV0gPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIC8vICAgICAgICAgcmVxdWlyZWROYW1lLnB1c2gobi5jb2RlKTtcclxuICAgICAgICAvLyAgICAgfVxyXG4gICAgICAgIC8vIH0pO1xyXG5cclxuICAgICAgICBpZiAocmVxdWlyZWROYW1lLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBjb25zdCBtc2dzID0gcmVxdWlyZWROYW1lLm1hcChuID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChuID09PSAnemgtQ0hTJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAncmVxdWlyZWQuY2hzJzsgLy8n6K+36L6T5YWl566A5L2T5Lit5paH5ZCN56ew44CCJztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZihuID09PSAnemgtQ0hUJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAncmVxdWlyZWQuY2h0JzsgLy8n6K+36L6T5YWl57mB5L2T5Lit5paH5ZCN56ew44CCJztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdyZXF1aXJlZC5lbic7IC8vICfor7fovpPlhaXoi7HmloflkI3np7DjgIInO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIG9mKHtmbGFnOiBmYWxzZSwgbXNnOiBtc2dzLmpvaW4oJ3wnKX0pO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGlmIChkYXRhLnR5cGUgJiYgZGF0YS50eXBlID09PSAnb3JnJyAmJiAoIWRhdGEub3JnaWRzIHx8ICFkYXRhLm9yZ2lkcy5sZW5ndGgpKSB7XHJcbiAgICAgICAgICAgIC8vIG1zZyAn6K+36YCJ5oup57uE57uHJ1xyXG4gICAgICAgICAgICByZXR1cm4gb2Yoe2ZsYWc6IGZhbHNlLCBtc2c6ICdyZXF1aXJlZC5vcmcnfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCBfY29uZmlnID0gbnVsbDtcclxuXHJcbiAgICAgICAgaWYgKCFpc05ld1NjaGVtZSkge1xyXG4gICAgICAgICAgICBjb25zdCBMT0NBTEVJRCA9IHRoaXMubG9jYWxlU2VyLmxvY2FsZUlkO1xyXG5cclxuICAgICAgICAgICAgaWYgKGN1cnJlbnRTZXR0aW5ncyAmJiBjdXJyZW50U2V0dGluZ3MuY29sdW1uRm9ybWF0KSB7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50U2V0dGluZ3MuY29sdW1uRm9ybWF0ID0gdGhpcy5jb252ZXJ0Q29sdW1uc1RvU2ltcGxlKFtjdXJyZW50U2V0dGluZ3MuY29sdW1uRm9ybWF0XSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIF9jb25maWcgPXsgW0xPQ0FMRUlEXTogY3VycmVudFNldHRpbmdzIH07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBuZXdJZCA9IHRoaXMuaWRTZXJ2aWNlLmd1aWQoKTtcclxuICAgICAgICBsZXQgaXNEZWZhdWx0ID0gZGF0YS5pc0RlZmF1bHQ7XHJcbiAgICAgICAgaWYgKGlzRGVmYXVsdCkge1xyXG4gICAgICAgICAgICBpZiAoZGF0YS50eXBlICE9PSAncHJpdmF0ZScpIHtcclxuICAgICAgICAgICAgICAgIGlzRGVmYXVsdCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoZGF0YS5uYW1lICYmIHR5cGVvZiBkYXRhLm5hbWUgPT09ICdvYmplY3QnKSB7XHJcbiAgICAgICAgICAgIGRhdGEubmFtZSA9IEpTT04uc3RyaW5naWZ5KGRhdGEubmFtZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBzY2hlbWU6IERhdGFncmlkU2NoZW1lTW9kZWwgPSB7XHJcbiAgICAgICAgICAgIGlkOiBuZXdJZCxcclxuICAgICAgICAgICAgYmVsb25nSWQ6ICcnLFxyXG4gICAgICAgICAgICBjb2RlOiAnJyxcclxuICAgICAgICAgICAgbmFtZTogZGF0YS5uYW1lLFxyXG4gICAgICAgICAgICB0eXBlOiBkYXRhLnR5cGUsXHJcbiAgICAgICAgICAgIGlzRGVmYXVsdDogaXNEZWZhdWx0LFxyXG4gICAgICAgICAgICBpc1N5c3RlbTogZmFsc2UsXHJcbiAgICAgICAgICAgIGV4dGVuZElkOiAnZGF0YWdyaWQtc2V0dGluZ3Mtc2NoZW1lJyxcclxuICAgICAgICAgICAgZXh0ZW5kSW5mbzogdGhpcy5idWlsZE9yZ0FuZFNjaGVtZVJlbGF0aW9ucyhuZXdJZCwgZGF0YS5vcmdpZHMpLFxyXG4gICAgICAgICAgICBxdWVyeUNvbmRpdGlvblN0cmluZzogX2NvbmZpZz8gSlNPTi5zdHJpbmdpZnkoX2NvbmZpZyk6ICcnLFxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLnNjaGVtZVNlcnZpY2Uuc2F2ZVNjaGVtZShzY2hlbWUsIGdyaWRJZCkucGlwZShcclxuICAgICAgICAgICAgbWFwKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBzY2hlbWU7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRTY2hlbWVMaXN0KHNjaGVtZUxpc3Q6IERhdGFncmlkU2NoZW1lTW9kZWxbXSwgZ3JpZElkOiBzdHJpbmcpIHtcclxuICAgICAgICB0aGlzLnNjaGVtZVNlcnZpY2UudXBkYXRlKHtsaXN0OiBzY2hlbWVMaXN0fSwgZ3JpZElkKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGJ1aWxkT3JnQW5kU2NoZW1lUmVsYXRpb25zKHNjaGVtZUlkOiBzdHJpbmcsIG9yZ0lkczogYW55KSB7XHJcbiAgICAgICAgaWYgKCFvcmdJZHMgfHwgIW9yZ0lkcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgcmV0dXJuICBbXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYgKHR5cGVvZiBvcmdJZHMgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgIG9yZ0lkcyA9IG9yZ0lkcy5zcGxpdCgnLCcpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIG9yZ0lkcy5tYXAobiA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICBpZDogdGhpcy5pZFNlcnZpY2UuZ3VpZCgpLFxyXG4gICAgICAgICAgICAgICAgb3JnSWQ6IG4sXHJcbiAgICAgICAgICAgICAgICByZWxhdGVkSWQ6IHNjaGVtZUlkXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldEN1cnJlbnRTY2hlbWVTZXR0aW5ncyhncmlkSWQ6IHN0cmluZyk6IFNldHRpbmdNb2RlbCB7XHJcbiAgICAgICAgY29uc3QgYWN0aXZlU2NoZW1lID0gdGhpcy5nZXRBY3RpdmVTY2hlbWVJdGVtKGdyaWRJZCkgYXMgRGF0YWdyaWRTY2hlbWVNb2RlbDtcclxuICAgICAgICBpZiAoYWN0aXZlU2NoZW1lICYmIGFjdGl2ZVNjaGVtZS5xdWVyeUNvbmRpdGlvblN0cmluZykge1xyXG4gICAgICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShhY3RpdmVTY2hlbWUucXVlcnlDb25kaXRpb25TdHJpbmcpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxufVxyXG4iXX0=