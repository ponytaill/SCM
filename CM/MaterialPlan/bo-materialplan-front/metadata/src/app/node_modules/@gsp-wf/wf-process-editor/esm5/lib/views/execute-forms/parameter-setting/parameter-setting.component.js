/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, ViewChild, TemplateRef } from '@angular/core';
import { ExpressionService, InjectedType } from '@gsp-svc/expression';
import { ProcessDesignerUIState } from '../../../app/process-designer.uistate';
import { Subject } from 'rxjs';
import { DatagridComponent } from '@farris/ui-datagrid';
var ParameterSettingComponent = /** @class */ (function () {
    function ParameterSettingComponent(expr, designerState) {
        this.expr = expr;
        this.designerState = designerState;
        this.idField = 'Name';
        this._mode = 'bpmn';
        this.submit = new Subject();
        this.cancel = new Subject();
        this.formTypeCollection = [
            { text: '流程嵌表单', value: '0' },
            { text: '表单嵌流程', value: '1' },
        ];
        this.cols = new Array();
        this.parameters = new Array();
        this.formType = this.formTypeCollection[0].value;
        this.showFormType = false;
    }
    Object.defineProperty(ParameterSettingComponent.prototype, "mode", {
        get: /**
         * @return {?}
         */
        function () {
            return this._mode;
        },
        set: /**
         * @param {?} m
         * @return {?}
         */
        function (m) {
            var _this = this;
            this._mode = m;
            if (m === 'bpmn') {
                this.idField = 'Name';
                this.cols = [
                    { field: 'Name', width: 50, title: '编号' },
                    {
                        field: 'Value', width: 100, title: '参数值',
                        editor: {
                            type: 'input-group',
                            options: {
                                groupText: '<i class="f-icon f-icon-lookup"></i>',
                                editable: false,
                                clickHandle: (/**
                                 * @param {?} e
                                 * @return {?}
                                 */
                                function (e) {
                                    e.formControl.setValue(e.instance.value ? e.instance.value : '');
                                    _this.showExprHelp(e);
                                }),
                                clear: (/**
                                 * @param {?} e
                                 * @return {?}
                                 */
                                function (e) {
                                    console.log('clear', e);
                                })
                            }
                        }
                    }
                ];
            }
            else {
                this.idField = 'code';
                this.cols = [
                    { field: 'code', width: 50, title: '编号' },
                    { field: 'name', width: 50, title: '名称' },
                    {
                        field: 'value', width: 100, title: '参数值',
                        editor: {
                            type: 'input-group',
                            options: {
                                groupText: '<i class="f-icon f-icon-lookup"></i>',
                                editable: false,
                                clickHandle: (/**
                                 * @param {?} e
                                 * @return {?}
                                 */
                                function (e) {
                                    e.formControl.setValue(e.instance.value ? e.instance.value : '');
                                    _this.showExprHelp(e);
                                }),
                                clear: (/**
                                 * @param {?} e
                                 * @return {?}
                                 */
                                function (e) {
                                    console.log('clear', e);
                                })
                            }
                        }
                    }
                ];
            }
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    ParameterSettingComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @param {?} e
     * @return {?}
     */
    ParameterSettingComponent.prototype.showExprHelp = /**
     * @param {?} e
     * @return {?}
     */
    function (e) {
        var e_1, _a, e_2, _b, e_3, _c, e_4, _d, e_5, _e, e_6, _f;
        if (this.designerState.schemas.length > 0) {
            try {
                for (var _g = tslib_1.__values(this.designerState.schemas), _h = _g.next(); !_h.done; _h = _g.next()) {
                    var schema = _h.value;
                    this.expr.addSchema('Schema', schema);
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (_h && !_h.done && (_a = _g.return)) _a.call(_g);
                }
                finally { if (e_1) throw e_1.error; }
            }
            if (this.designerState.schemas[0].entityTypes && this.designerState.schemas[0].entityTypes.length > 0) {
                /** @type {?} */
                var entityType = this.designerState.schemas[0].entityTypes[0];
                this.expr.addInjectedEntity(entityType.name, 'Schema', entityType.name, InjectedType.EntityType);
            }
        }
        /** @type {?} */
        var context = new Array();
        if (this.designerState.procInstContext.length > 0) {
            try {
                for (var _j = tslib_1.__values(this.designerState.procInstContext), _k = _j.next(); !_k.done; _k = _j.next()) {
                    var variable = _k.value;
                    context.push(variable);
                    // this.expr.addContext(variable);
                }
            }
            catch (e_2_1) { e_2 = { error: e_2_1 }; }
            finally {
                try {
                    if (_k && !_k.done && (_b = _j.return)) _b.call(_j);
                }
                finally { if (e_2) throw e_2.error; }
            }
        }
        if (this.designerState.formalParameterContext.length > 0) {
            var _loop_1 = function (variable) {
                if (!context.some((/**
                 * @param {?} c
                 * @return {?}
                 */
                function (c) { return c.key === variable.key; }))) {
                    context.push(variable);
                }
            };
            try {
                for (var _l = tslib_1.__values(this.designerState.formalParameterContext), _m = _l.next(); !_m.done; _m = _l.next()) {
                    var variable = _m.value;
                    _loop_1(variable);
                }
            }
            catch (e_3_1) { e_3 = { error: e_3_1 }; }
            finally {
                try {
                    if (_m && !_m.done && (_c = _l.return)) _c.call(_l);
                }
                finally { if (e_3) throw e_3.error; }
            }
        }
        if (this.designerState.participantContext.length > 0) {
            var _loop_2 = function (variable) {
                if (!context.some((/**
                 * @param {?} c
                 * @return {?}
                 */
                function (c) { return c.key === variable.key; }))) {
                    context.push(variable);
                }
            };
            try {
                for (var _o = tslib_1.__values(this.designerState.participantContext), _p = _o.next(); !_p.done; _p = _o.next()) {
                    var variable = _p.value;
                    _loop_2(variable);
                }
            }
            catch (e_4_1) { e_4 = { error: e_4_1 }; }
            finally {
                try {
                    if (_p && !_p.done && (_d = _o.return)) _d.call(_o);
                }
                finally { if (e_4) throw e_4.error; }
            }
        }
        if (this.designerState.processVariableContext.length > 0) {
            var _loop_3 = function (variable) {
                if (!context.some((/**
                 * @param {?} c
                 * @return {?}
                 */
                function (c) { return c.key === variable.key; }))) {
                    context.push(variable);
                }
            };
            try {
                for (var _q = tslib_1.__values(this.designerState.processVariableContext), _r = _q.next(); !_r.done; _r = _q.next()) {
                    var variable = _r.value;
                    _loop_3(variable);
                }
            }
            catch (e_5_1) { e_5 = { error: e_5_1 }; }
            finally {
                try {
                    if (_r && !_r.done && (_e = _q.return)) _e.call(_q);
                }
                finally { if (e_5) throw e_5.error; }
            }
        }
        if (context.length > 0) {
            try {
                for (var context_1 = tslib_1.__values(context), context_1_1 = context_1.next(); !context_1_1.done; context_1_1 = context_1.next()) {
                    var v = context_1_1.value;
                    this.expr.addContext(v);
                }
            }
            catch (e_6_1) { e_6 = { error: e_6_1 }; }
            finally {
                try {
                    if (context_1_1 && !context_1_1.done && (_f = context_1.return)) _f.call(context_1);
                }
                finally { if (e_6) throw e_6.error; }
            }
        }
        this.expr.addExpressionText(e.instance.value);
        this.expr.buildExpression().then((/**
         * @param {?} d
         * @return {?}
         */
        function (d) {
            if (d) {
                e.formControl.setValue(d);
                e.instance.cd.detectChanges();
            }
        }));
    };
    /**
     * @return {?}
     */
    ParameterSettingComponent.prototype.clickOK = /**
     * @return {?}
     */
    function () {
        this.grid.endCellEdit();
        this.submit.next({ parameters: this.parameters, formType: this.formType });
    };
    /**
     * @return {?}
     */
    ParameterSettingComponent.prototype.clickCancel = /**
     * @return {?}
     */
    function () {
        this.cancel.next();
    };
    ParameterSettingComponent.decorators = [
        { type: Component, args: [{
                    selector: 'lib-parameter-setting',
                    template: "\r\n<div class=\"f-page f-page-is-managelist\">\r\n  <div class=\"f-page-main my-0\">\r\n    <div class=\"f-struct-wrapper f-utils-fill-flex-column\">\r\n      <farris-section class=\"f-section-grid f-section-in-managelist px-0\" [showHeader]=\"showFormType\" [mainTitle]=\"'\u53C2\u6570'\" [enableMaximize]=\"false\">\r\n        <ng-template farrisSectionToolbar>\r\n          <farris-combo-list [(ngModel)]=\"formType\" name=\"formType\" [idField]=\"'value'\" [textField]=\"'text'\"\r\n            [enableClear]=\"false\" [valueField]=\"'value'\" [data]=\"formTypeCollection\" [panelHeight]=\"'auto'\" [editable]=\"false\"\r\n            style=\"width: 130px;\">\r\n          </farris-combo-list>\r\n        </ng-template>\r\n        <farris-datagrid class=\"f-component-grid\" [columns]=\"cols\" [data]=\"parameters\" #grid\r\n          [idField]=\"idField\" [fit]=\"true\" [fitColumns]=\"true\" [editable]=\"true\" [editMode]=\"'cell'\" [pagination]=\"false\"\r\n          [showCheckbox]=\"false\" [multiSelect]=\"false\" [showLineNumber]=\"true\" [striped]=\"true\"\r\n          [virtualized]=\"true\">\r\n        </farris-datagrid>\r\n      </farris-section>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<ng-template #iconSelectFooter>\r\n  <button type=\"button\" class=\"btn btn-primary btn-sm mx-2\" (click)=\"clickOK()\">\u786E\u5B9A</button>\r\n  <button type=\"button\" class=\"btn btn-secondary btn-sm\" (click)=\"clickCancel()\">\u53D6\u6D88</button>\r\n</ng-template>",
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    ParameterSettingComponent.ctorParameters = function () { return [
        { type: ExpressionService },
        { type: ProcessDesignerUIState }
    ]; };
    ParameterSettingComponent.propDecorators = {
        modalFooter: [{ type: ViewChild, args: ['iconSelectFooter',] }],
        grid: [{ type: ViewChild, args: ['grid',] }]
    };
    return ParameterSettingComponent;
}());
export { ParameterSettingComponent };
if (false) {
    /** @type {?} */
    ParameterSettingComponent.prototype.modalFooter;
    /** @type {?} */
    ParameterSettingComponent.prototype.grid;
    /** @type {?} */
    ParameterSettingComponent.prototype.idField;
    /**
     * @type {?}
     * @private
     */
    ParameterSettingComponent.prototype._mode;
    /** @type {?} */
    ParameterSettingComponent.prototype.submit;
    /** @type {?} */
    ParameterSettingComponent.prototype.cancel;
    /** @type {?} */
    ParameterSettingComponent.prototype.formTypeCollection;
    /** @type {?} */
    ParameterSettingComponent.prototype.cols;
    /** @type {?} */
    ParameterSettingComponent.prototype.parameters;
    /** @type {?} */
    ParameterSettingComponent.prototype.formType;
    /** @type {?} */
    ParameterSettingComponent.prototype.showFormType;
    /**
     * @type {?}
     * @private
     */
    ParameterSettingComponent.prototype.expr;
    /**
     * @type {?}
     * @private
     */
    ParameterSettingComponent.prototype.designerState;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFyYW1ldGVyLXNldHRpbmcuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdzcC13Zi93Zi1wcm9jZXNzLWVkaXRvci8iLCJzb3VyY2VzIjpbImxpYi92aWV3cy9leGVjdXRlLWZvcm1zL3BhcmFtZXRlci1zZXR0aW5nL3BhcmFtZXRlci1zZXR0aW5nLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsU0FBUyxFQUFFLFdBQVcsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMxRSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsWUFBWSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDdEUsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sdUNBQXVDLENBQUM7QUFDL0UsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMvQixPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUV4RDtJQWlGRSxtQ0FDVSxJQUF1QixFQUN2QixhQUFxQztRQURyQyxTQUFJLEdBQUosSUFBSSxDQUFtQjtRQUN2QixrQkFBYSxHQUFiLGFBQWEsQ0FBd0I7UUF6RS9DLFlBQU8sR0FBb0IsTUFBTSxDQUFDO1FBRTFCLFVBQUssR0FBcUIsTUFBTSxDQUFDO1FBc0R6QyxXQUFNLEdBQUcsSUFBSSxPQUFPLEVBQU8sQ0FBQztRQUM1QixXQUFNLEdBQUcsSUFBSSxPQUFPLEVBQUUsQ0FBQztRQUN2Qix1QkFBa0IsR0FBRztZQUNuQixFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRTtZQUM3QixFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRTtTQUM5QixDQUFDO1FBRUYsU0FBSSxHQUFHLElBQUksS0FBSyxFQUFFLENBQUM7UUFFbkIsZUFBVSxHQUFHLElBQUksS0FBSyxFQUFFLENBQUM7UUFFekIsYUFBUSxHQUFHLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUM7UUFFNUMsaUJBQVksR0FBRyxLQUFLLENBQUM7SUFJOEIsQ0FBQztJQXRFcEQsc0JBQUksMkNBQUk7Ozs7UUFrRFI7WUFDRSxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUM7UUFDcEIsQ0FBQzs7Ozs7UUFwREQsVUFBUyxDQUFtQjtZQUE1QixpQkFnREM7WUEvQ0MsSUFBSSxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUM7WUFDZixJQUFJLENBQUMsS0FBSyxNQUFNLEVBQUU7Z0JBQ2hCLElBQUksQ0FBQyxPQUFPLEdBQUcsTUFBTSxDQUFDO2dCQUN0QixJQUFJLENBQUMsSUFBSSxHQUFHO29CQUNWLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsRUFBRSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUU7b0JBQ3pDO3dCQUNFLEtBQUssRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsS0FBSzt3QkFDeEMsTUFBTSxFQUFFOzRCQUNOLElBQUksRUFBRSxhQUFhOzRCQUNuQixPQUFPLEVBQUU7Z0NBQ1AsU0FBUyxFQUFFLHNDQUFzQztnQ0FDakQsUUFBUSxFQUFFLEtBQUs7Z0NBQ2YsV0FBVzs7OztnQ0FBRSxVQUFDLENBQUM7b0NBQ2IsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQztvQ0FDakUsS0FBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQztnQ0FDdkIsQ0FBQyxDQUFBO2dDQUNELEtBQUs7Ozs7Z0NBQUUsVUFBQyxDQUFDO29DQUNQLE9BQU8sQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxDQUFDO2dDQUMxQixDQUFDLENBQUE7NkJBQ0Y7eUJBQ0Y7cUJBQ0Y7aUJBQ0YsQ0FBQzthQUNIO2lCQUFNO2dCQUNMLElBQUksQ0FBQyxPQUFPLEdBQUcsTUFBTSxDQUFDO2dCQUN0QixJQUFJLENBQUMsSUFBSSxHQUFHO29CQUNWLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsRUFBRSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUU7b0JBQ3pDLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsRUFBRSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUU7b0JBQ3pDO3dCQUNFLEtBQUssRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsS0FBSzt3QkFDeEMsTUFBTSxFQUFFOzRCQUNOLElBQUksRUFBRSxhQUFhOzRCQUNuQixPQUFPLEVBQUU7Z0NBQ1AsU0FBUyxFQUFFLHNDQUFzQztnQ0FDakQsUUFBUSxFQUFFLEtBQUs7Z0NBQ2YsV0FBVzs7OztnQ0FBRSxVQUFDLENBQUM7b0NBQ2IsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQztvQ0FDakUsS0FBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQztnQ0FDdkIsQ0FBQyxDQUFBO2dDQUNELEtBQUs7Ozs7Z0NBQUUsVUFBQyxDQUFDO29DQUNQLE9BQU8sQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxDQUFDO2dDQUMxQixDQUFDLENBQUE7NkJBQ0Y7eUJBQ0Y7cUJBQ0Y7aUJBQ0YsQ0FBQzthQUNIO1FBQ0gsQ0FBQzs7O09BQUE7Ozs7SUF3QkQsNENBQVE7OztJQUFSO0lBQ0EsQ0FBQzs7Ozs7SUFFRCxnREFBWTs7OztJQUFaLFVBQWEsQ0FBTTs7UUFDakIsSUFBSSxJQUFJLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFOztnQkFDekMsS0FBcUIsSUFBQSxLQUFBLGlCQUFBLElBQUksQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFBLGdCQUFBLDRCQUFFO29CQUE1QyxJQUFNLE1BQU0sV0FBQTtvQkFDZixJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLEVBQUUsTUFBTSxDQUFDLENBQUM7aUJBQ3ZDOzs7Ozs7Ozs7WUFDRCxJQUFJLElBQUksQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLFdBQVcsSUFBSSxJQUFJLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTs7b0JBQy9GLFVBQVUsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDO2dCQUMvRCxJQUFJLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLFVBQVUsQ0FBQyxJQUFJLEVBQUUsUUFBUSxFQUNuRCxVQUFVLENBQUMsSUFBSSxFQUFFLFlBQVksQ0FBQyxVQUFVLENBQUMsQ0FBQzthQUM3QztTQUNGOztZQUNLLE9BQU8sR0FBRyxJQUFJLEtBQUssRUFBRTtRQUMzQixJQUFJLElBQUksQ0FBQyxhQUFhLENBQUMsZUFBZSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7O2dCQUNqRCxLQUF1QixJQUFBLEtBQUEsaUJBQUEsSUFBSSxDQUFDLGFBQWEsQ0FBQyxlQUFlLENBQUEsZ0JBQUEsNEJBQUU7b0JBQXRELElBQU0sUUFBUSxXQUFBO29CQUNqQixPQUFPLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO29CQUN2QixrQ0FBa0M7aUJBQ25DOzs7Ozs7Ozs7U0FDRjtRQUNELElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxzQkFBc0IsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO29DQUM3QyxRQUFRO2dCQUNqQixJQUFJLENBQUMsT0FBTyxDQUFDLElBQUk7Ozs7Z0JBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsR0FBRyxLQUFLLFFBQVEsQ0FBQyxHQUFHLEVBQXRCLENBQXNCLEVBQUMsRUFBRTtvQkFDOUMsT0FBTyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztpQkFDeEI7OztnQkFISCxLQUF1QixJQUFBLEtBQUEsaUJBQUEsSUFBSSxDQUFDLGFBQWEsQ0FBQyxzQkFBc0IsQ0FBQSxnQkFBQTtvQkFBM0QsSUFBTSxRQUFRLFdBQUE7NEJBQVIsUUFBUTtpQkFLbEI7Ozs7Ozs7OztTQUNGO1FBQ0QsSUFBSSxJQUFJLENBQUMsYUFBYSxDQUFDLGtCQUFrQixDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7b0NBQ3pDLFFBQVE7Z0JBQ2pCLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSTs7OztnQkFBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxHQUFHLEtBQUssUUFBUSxDQUFDLEdBQUcsRUFBdEIsQ0FBc0IsRUFBQyxFQUFFO29CQUM5QyxPQUFPLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO2lCQUN4Qjs7O2dCQUhILEtBQXVCLElBQUEsS0FBQSxpQkFBQSxJQUFJLENBQUMsYUFBYSxDQUFDLGtCQUFrQixDQUFBLGdCQUFBO29CQUF2RCxJQUFNLFFBQVEsV0FBQTs0QkFBUixRQUFRO2lCQUtsQjs7Ozs7Ozs7O1NBQ0Y7UUFDRCxJQUFJLElBQUksQ0FBQyxhQUFhLENBQUMsc0JBQXNCLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtvQ0FDN0MsUUFBUTtnQkFDakIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJOzs7O2dCQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLEdBQUcsS0FBSyxRQUFRLENBQUMsR0FBRyxFQUF0QixDQUFzQixFQUFDLEVBQUU7b0JBQzlDLE9BQU8sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7aUJBQ3hCOzs7Z0JBSEgsS0FBdUIsSUFBQSxLQUFBLGlCQUFBLElBQUksQ0FBQyxhQUFhLENBQUMsc0JBQXNCLENBQUEsZ0JBQUE7b0JBQTNELElBQU0sUUFBUSxXQUFBOzRCQUFSLFFBQVE7aUJBS2xCOzs7Ozs7Ozs7U0FDRjtRQUNELElBQUksT0FBTyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7O2dCQUN0QixLQUFnQixJQUFBLFlBQUEsaUJBQUEsT0FBTyxDQUFBLGdDQUFBLHFEQUFFO29CQUFwQixJQUFNLENBQUMsb0JBQUE7b0JBQ1YsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUM7aUJBQ3pCOzs7Ozs7Ozs7U0FDRjtRQUVELElBQUksQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUU5QyxJQUFJLENBQUMsSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDLElBQUk7Ozs7UUFBQyxVQUFDLENBQVM7WUFDekMsSUFBSSxDQUFDLEVBQUU7Z0JBQ0wsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQzFCLENBQUMsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLGFBQWEsRUFBRSxDQUFDO2FBQy9CO1FBQ0gsQ0FBQyxFQUFDLENBQUM7SUFDTCxDQUFDOzs7O0lBRUQsMkNBQU87OztJQUFQO1FBQ0UsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUN4QixJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFFLFVBQVUsRUFBRSxJQUFJLENBQUMsVUFBVSxFQUFFLFFBQVEsRUFBRSxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQztJQUM3RSxDQUFDOzs7O0lBRUQsK0NBQVc7OztJQUFYO1FBQ0UsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUNyQixDQUFDOztnQkF6SkYsU0FBUyxTQUFDO29CQUNULFFBQVEsRUFBRSx1QkFBdUI7b0JBQ2pDLG85Q0FBaUQ7O2lCQUVsRDs7OztnQkFUUSxpQkFBaUI7Z0JBQ2pCLHNCQUFzQjs7OzhCQVc1QixTQUFTLFNBQUMsa0JBQWtCO3VCQUM1QixTQUFTLFNBQUMsTUFBTTs7SUFtSm5CLGdDQUFDO0NBQUEsQUEzSkQsSUEySkM7U0F0SlkseUJBQXlCOzs7SUFFcEMsZ0RBQTZEOztJQUM3RCx5Q0FBMkM7O0lBRTNDLDRDQUFrQzs7Ozs7SUFFbEMsMENBQXlDOztJQXNEekMsMkNBQTRCOztJQUM1QiwyQ0FBdUI7O0lBQ3ZCLHVEQUdFOztJQUVGLHlDQUFtQjs7SUFFbkIsK0NBQXlCOztJQUV6Qiw2Q0FBNEM7O0lBRTVDLGlEQUFxQjs7Ozs7SUFHbkIseUNBQStCOzs7OztJQUMvQixrREFBNkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgVmlld0NoaWxkLCBUZW1wbGF0ZVJlZiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBFeHByZXNzaW9uU2VydmljZSwgSW5qZWN0ZWRUeXBlIH0gZnJvbSAnQGdzcC1zdmMvZXhwcmVzc2lvbic7XHJcbmltcG9ydCB7IFByb2Nlc3NEZXNpZ25lclVJU3RhdGUgfSBmcm9tICcuLi8uLi8uLi9hcHAvcHJvY2Vzcy1kZXNpZ25lci51aXN0YXRlJztcclxuaW1wb3J0IHsgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZENvbXBvbmVudCB9IGZyb20gJ0BmYXJyaXMvdWktZGF0YWdyaWQnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdsaWItcGFyYW1ldGVyLXNldHRpbmcnLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9wYXJhbWV0ZXItc2V0dGluZy5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vcGFyYW1ldGVyLXNldHRpbmcuY29tcG9uZW50LnNjc3MnXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgUGFyYW1ldGVyU2V0dGluZ0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XHJcblxyXG4gIEBWaWV3Q2hpbGQoJ2ljb25TZWxlY3RGb290ZXInKSBtb2RhbEZvb3RlcjogVGVtcGxhdGVSZWY8YW55PjtcclxuICBAVmlld0NoaWxkKCdncmlkJykgZ3JpZDogRGF0YWdyaWRDb21wb25lbnQ7XHJcblxyXG4gIGlkRmllbGQ6ICdOYW1lJyB8ICdjb2RlJyA9ICdOYW1lJztcclxuXHJcbiAgcHJpdmF0ZSBfbW9kZTogJ2JwbW4nIHwgJ3VzdWFsJyA9ICdicG1uJztcclxuICBzZXQgbW9kZShtOiAnYnBtbicgfCAndXN1YWwnKSB7XHJcbiAgICB0aGlzLl9tb2RlID0gbTtcclxuICAgIGlmIChtID09PSAnYnBtbicpIHtcclxuICAgICAgdGhpcy5pZEZpZWxkID0gJ05hbWUnO1xyXG4gICAgICB0aGlzLmNvbHMgPSBbXHJcbiAgICAgICAgeyBmaWVsZDogJ05hbWUnLCB3aWR0aDogNTAsIHRpdGxlOiAn57yW5Y+3JyB9LFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIGZpZWxkOiAnVmFsdWUnLCB3aWR0aDogMTAwLCB0aXRsZTogJ+WPguaVsOWAvCcsXHJcbiAgICAgICAgICBlZGl0b3I6IHtcclxuICAgICAgICAgICAgdHlwZTogJ2lucHV0LWdyb3VwJyxcclxuICAgICAgICAgICAgb3B0aW9uczoge1xyXG4gICAgICAgICAgICAgIGdyb3VwVGV4dDogJzxpIGNsYXNzPVwiZi1pY29uIGYtaWNvbi1sb29rdXBcIj48L2k+JyxcclxuICAgICAgICAgICAgICBlZGl0YWJsZTogZmFsc2UsXHJcbiAgICAgICAgICAgICAgY2xpY2tIYW5kbGU6IChlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBlLmZvcm1Db250cm9sLnNldFZhbHVlKGUuaW5zdGFuY2UudmFsdWUgPyBlLmluc3RhbmNlLnZhbHVlIDogJycpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zaG93RXhwckhlbHAoZSk7XHJcbiAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICBjbGVhcjogKGUpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdjbGVhcicsIGUpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgXTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuaWRGaWVsZCA9ICdjb2RlJztcclxuICAgICAgdGhpcy5jb2xzID0gW1xyXG4gICAgICAgIHsgZmllbGQ6ICdjb2RlJywgd2lkdGg6IDUwLCB0aXRsZTogJ+e8luWPtycgfSxcclxuICAgICAgICB7IGZpZWxkOiAnbmFtZScsIHdpZHRoOiA1MCwgdGl0bGU6ICflkI3np7AnIH0sXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgZmllbGQ6ICd2YWx1ZScsIHdpZHRoOiAxMDAsIHRpdGxlOiAn5Y+C5pWw5YC8JyxcclxuICAgICAgICAgIGVkaXRvcjoge1xyXG4gICAgICAgICAgICB0eXBlOiAnaW5wdXQtZ3JvdXAnLFxyXG4gICAgICAgICAgICBvcHRpb25zOiB7XHJcbiAgICAgICAgICAgICAgZ3JvdXBUZXh0OiAnPGkgY2xhc3M9XCJmLWljb24gZi1pY29uLWxvb2t1cFwiPjwvaT4nLFxyXG4gICAgICAgICAgICAgIGVkaXRhYmxlOiBmYWxzZSxcclxuICAgICAgICAgICAgICBjbGlja0hhbmRsZTogKGUpID0+IHtcclxuICAgICAgICAgICAgICAgIGUuZm9ybUNvbnRyb2wuc2V0VmFsdWUoZS5pbnN0YW5jZS52YWx1ZSA/IGUuaW5zdGFuY2UudmFsdWUgOiAnJyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNob3dFeHBySGVscChlKTtcclxuICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgIGNsZWFyOiAoZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2NsZWFyJywgZSk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICBdO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZ2V0IG1vZGUoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fbW9kZTtcclxuICB9XHJcbiAgc3VibWl0ID0gbmV3IFN1YmplY3Q8YW55PigpO1xyXG4gIGNhbmNlbCA9IG5ldyBTdWJqZWN0KCk7XHJcbiAgZm9ybVR5cGVDb2xsZWN0aW9uID0gW1xyXG4gICAgeyB0ZXh0OiAn5rWB56iL5bWM6KGo5Y2VJywgdmFsdWU6ICcwJyB9LFxyXG4gICAgeyB0ZXh0OiAn6KGo5Y2V5bWM5rWB56iLJywgdmFsdWU6ICcxJyB9LFxyXG4gIF07XHJcblxyXG4gIGNvbHMgPSBuZXcgQXJyYXkoKTtcclxuXHJcbiAgcGFyYW1ldGVycyA9IG5ldyBBcnJheSgpO1xyXG5cclxuICBmb3JtVHlwZSA9IHRoaXMuZm9ybVR5cGVDb2xsZWN0aW9uWzBdLnZhbHVlO1xyXG5cclxuICBzaG93Rm9ybVR5cGUgPSBmYWxzZTtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIGV4cHI6IEV4cHJlc3Npb25TZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBkZXNpZ25lclN0YXRlOiBQcm9jZXNzRGVzaWduZXJVSVN0YXRlKSB7IH1cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgfVxyXG5cclxuICBzaG93RXhwckhlbHAoZTogYW55KSB7XHJcbiAgICBpZiAodGhpcy5kZXNpZ25lclN0YXRlLnNjaGVtYXMubGVuZ3RoID4gMCkge1xyXG4gICAgICBmb3IgKGNvbnN0IHNjaGVtYSBvZiB0aGlzLmRlc2lnbmVyU3RhdGUuc2NoZW1hcykge1xyXG4gICAgICAgIHRoaXMuZXhwci5hZGRTY2hlbWEoJ1NjaGVtYScsIHNjaGVtYSk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKHRoaXMuZGVzaWduZXJTdGF0ZS5zY2hlbWFzWzBdLmVudGl0eVR5cGVzICYmIHRoaXMuZGVzaWduZXJTdGF0ZS5zY2hlbWFzWzBdLmVudGl0eVR5cGVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICBjb25zdCBlbnRpdHlUeXBlID0gdGhpcy5kZXNpZ25lclN0YXRlLnNjaGVtYXNbMF0uZW50aXR5VHlwZXNbMF07XHJcbiAgICAgICAgdGhpcy5leHByLmFkZEluamVjdGVkRW50aXR5KGVudGl0eVR5cGUubmFtZSwgJ1NjaGVtYScsXHJcbiAgICAgICAgICBlbnRpdHlUeXBlLm5hbWUsIEluamVjdGVkVHlwZS5FbnRpdHlUeXBlKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgY29uc3QgY29udGV4dCA9IG5ldyBBcnJheSgpO1xyXG4gICAgaWYgKHRoaXMuZGVzaWduZXJTdGF0ZS5wcm9jSW5zdENvbnRleHQubGVuZ3RoID4gMCkge1xyXG4gICAgICBmb3IgKGNvbnN0IHZhcmlhYmxlIG9mIHRoaXMuZGVzaWduZXJTdGF0ZS5wcm9jSW5zdENvbnRleHQpIHtcclxuICAgICAgICBjb250ZXh0LnB1c2godmFyaWFibGUpO1xyXG4gICAgICAgIC8vIHRoaXMuZXhwci5hZGRDb250ZXh0KHZhcmlhYmxlKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMuZGVzaWduZXJTdGF0ZS5mb3JtYWxQYXJhbWV0ZXJDb250ZXh0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgZm9yIChjb25zdCB2YXJpYWJsZSBvZiB0aGlzLmRlc2lnbmVyU3RhdGUuZm9ybWFsUGFyYW1ldGVyQ29udGV4dCkge1xyXG4gICAgICAgIGlmICghY29udGV4dC5zb21lKGMgPT4gYy5rZXkgPT09IHZhcmlhYmxlLmtleSkpIHtcclxuICAgICAgICAgIGNvbnRleHQucHVzaCh2YXJpYWJsZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIHRoaXMuZXhwci5hZGRDb250ZXh0KHZhcmlhYmxlKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMuZGVzaWduZXJTdGF0ZS5wYXJ0aWNpcGFudENvbnRleHQubGVuZ3RoID4gMCkge1xyXG4gICAgICBmb3IgKGNvbnN0IHZhcmlhYmxlIG9mIHRoaXMuZGVzaWduZXJTdGF0ZS5wYXJ0aWNpcGFudENvbnRleHQpIHtcclxuICAgICAgICBpZiAoIWNvbnRleHQuc29tZShjID0+IGMua2V5ID09PSB2YXJpYWJsZS5rZXkpKSB7XHJcbiAgICAgICAgICBjb250ZXh0LnB1c2godmFyaWFibGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyB0aGlzLmV4cHIuYWRkQ29udGV4dCh2YXJpYWJsZSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGlmICh0aGlzLmRlc2lnbmVyU3RhdGUucHJvY2Vzc1ZhcmlhYmxlQ29udGV4dC5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGZvciAoY29uc3QgdmFyaWFibGUgb2YgdGhpcy5kZXNpZ25lclN0YXRlLnByb2Nlc3NWYXJpYWJsZUNvbnRleHQpIHtcclxuICAgICAgICBpZiAoIWNvbnRleHQuc29tZShjID0+IGMua2V5ID09PSB2YXJpYWJsZS5rZXkpKSB7XHJcbiAgICAgICAgICBjb250ZXh0LnB1c2godmFyaWFibGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyB0aGlzLmV4cHIuYWRkQ29udGV4dCh2YXJpYWJsZSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGlmIChjb250ZXh0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgZm9yIChjb25zdCB2IG9mIGNvbnRleHQpIHtcclxuICAgICAgICB0aGlzLmV4cHIuYWRkQ29udGV4dCh2KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuZXhwci5hZGRFeHByZXNzaW9uVGV4dChlLmluc3RhbmNlLnZhbHVlKTtcclxuXHJcbiAgICB0aGlzLmV4cHIuYnVpbGRFeHByZXNzaW9uKCkudGhlbigoZDogc3RyaW5nKSA9PiB7IC8vIOe8lui+keWZqOi/lOWbnuWAvFxyXG4gICAgICBpZiAoZCkge1xyXG4gICAgICAgIGUuZm9ybUNvbnRyb2wuc2V0VmFsdWUoZCk7XHJcbiAgICAgICAgZS5pbnN0YW5jZS5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgY2xpY2tPSygpIHtcclxuICAgIHRoaXMuZ3JpZC5lbmRDZWxsRWRpdCgpO1xyXG4gICAgdGhpcy5zdWJtaXQubmV4dCh7IHBhcmFtZXRlcnM6IHRoaXMucGFyYW1ldGVycywgZm9ybVR5cGU6IHRoaXMuZm9ybVR5cGUgfSk7XHJcbiAgfVxyXG5cclxuICBjbGlja0NhbmNlbCgpIHtcclxuICAgIHRoaXMuY2FuY2VsLm5leHQoKTtcclxuICB9XHJcblxyXG59XHJcbiJdfQ==