/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ViewChild, ElementRef, Input, Output, EventEmitter, HostBinding, ChangeDetectorRef, Optional, Injector } from '@angular/core';
import { DomSanitizer } from '@angular/platform-browser';
import { forkJoin } from 'rxjs';
import { UiFlowchartService } from '../services/ui-flowchart.service';
import { WFFlowchartService } from '../wf-flowchart.service';
import { MessagerService } from '@farris/ui-messager';
import { FrameworkService } from '@gsp-sys/rtf-common';
export class UIFlowchartComponent {
    /**
     * @param {?} sanitizer
     * @param {?} service
     * @param {?} changeDetector
     * @param {?} injector
     * @param {?} chartService
     */
    constructor(sanitizer, service, changeDetector, injector, chartService) {
        this.sanitizer = sanitizer;
        this.service = service;
        this.changeDetector = changeDetector;
        this.injector = injector;
        this.chartService = chartService;
        // 消息监听处理方法
        this.cls = 'd-flex flex-fill h-100';
        this.modalHide = new EventEmitter();
        this.fcHtml = window.document.location.origin + '/platform/runtime/wf/web/designer/flowchart.html';
        this.theme = 'viewFlowChart';
        this._mode = 'complete';
        this.modeButton = this.service.getI18nValue('static.flowchart.simulation');
        this.typeList = [{
                value: 'complete', text: this.service.getI18nValue('static.flowchart.complete')
            },
            {
                value: 'simulation', text: this.service.getI18nValue('static.flowchart.simulation')
            }];
        // 监听事件处理
        this.eventHandler = (event) => {
            /** @type {?} */
            const origin = event.origin;
            /** @type {?} */
            const message = event.data;
            if (this.fcHtml.search(origin) > -1) {
                switch (message.action) {
                    case 'load':
                        this.viewFlowChart();
                        break;
                    case 'viewLogs':
                        this.viewLogs(message.data);
                        break;
                    case 'viewParent':
                        this.viewParent(message.data.superProcInstId);
                        break;
                    case 'viewChild':
                        this.viewChild(message.data.superActInstId, message.data.superProcInstId);
                        break;
                    case 'viewForm':
                        this.viewForm(message.data.procInstId, message.data.actInstId, message.data.bizInstId);
                        break;
                    case 'retryAifCreation':
                        this.retryAifCreation(message.data.procInstId, message.data.actInstId, message.data.bizInstId);
                        break;
                    default:
                        break;
                }
            }
        };
        this.message = this.injector.get(MessagerService);
        this.frameworkSvc = this.injector.get(FrameworkService);
        this.srcUrl = this.sanitizer.bypassSecurityTrustResourceUrl(this.fcHtml);
        if (UIFlowchartComponent.func) {
            window.removeEventListener('message', UIFlowchartComponent.func, false);
        }
        this.addMessageListener();
    }
    /**
     * @param {?} v
     * @return {?}
     */
    set mode(v) {
        this._mode = v;
        if (this._mode === 'simulation') {
            this.ifForecast = 'true';
            this.modeButton = this.service.getI18nValue('static.flowchart.complete');
        }
        else if (this._mode === 'complete') {
            this.modeButton = this.service.getI18nValue('static.flowchart.simulation');
        }
    }
    /**
     * @return {?}
     */
    get mode() {
        return this._mode;
    }
    /**
     * @param {?} procInstId
     * @return {?}
     */
    set ProcInstId(procInstId) {
        if (procInstId) {
            this.procInstId = procInstId;
        }
    }
    /**
     * @param {?} dataId
     * @return {?}
     */
    set DataId(dataId) {
        if (dataId) {
            this.dataId = dataId;
        }
    }
    /**
     * @return {?}
     */
    ngOnInit() {
    }
    /**
     * @private
     * @return {?}
     */
    addMessageListener() {
        window.addEventListener('message', this.eventHandler, false);
        UIFlowchartComponent.func = this.eventHandler;
    }
    /**
     * @private
     * @return {?}
     */
    viewFlowChart() {
        if (this.theme === 'viewFlowChart') {
            this.viewFlowChartByProcInstId();
        }
        else {
            this.processForecast();
        }
    }
    /**
     * @private
     * @param {?} superProcInstId
     * @return {?}
     */
    viewParent(superProcInstId) {
        // this.procInstId = superProcInstId;
        // this.viewFlowChartByProcInstId();
    }
    /**
     * @private
     * @param {?} superActInstId
     * @param {?} superProcInstId
     * @return {?}
     */
    viewChild(superActInstId, superProcInstId) {
        this.service.getSubProcessInstance(superActInstId, superProcInstId)
            .subscribe(re => {
            if (this.chartService) {
                this.chartService.viewFlowChartByDialog(re.id, this.mode);
            }
            else {
                throw Error('请升级查看流程公共包实现联查子流程图功能');
            }
        });
    }
    /**
     * @return {?}
     */
    modeSwitch() {
        if (this.mode === 'complete') {
            this.mode = 'simulation';
            this.ifForecast = 'true';
            this.modeButton = this.service.getI18nValue('static.flowchart.complete');
            this.service.getForecastProcessByProcInstId(this.procInstId).subscribe(r => {
                this.actInstList = r.activityInstanceSlims;
                this.transInsList = r.transitionInstanceSlims;
                this.postMessage('modeSwitch', {
                    mode: 'simulation',
                    actiInstList: r.activityInstanceSlims,
                    transInsList: r.transitionInstanceSlims
                });
            });
        }
        else {
            this.mode = 'complete';
            this.ifForecast = 'false';
            this.modeButton = this.service.getI18nValue('static.flowchart.simulation');
            this.service.getCompleteProcessInfoByProcInstId(this.procInstId).subscribe(r => {
                this.actInstList = r.activityInstanceSlims;
                this.transInsList = r.transitionInstanceSlims;
                this.postMessage('modeSwitch', {
                    mode: 'complete',
                    actiInstList: r.activityInstanceSlims,
                    transInsList: r.transitionInstanceSlims
                });
            });
        }
    }
    /**
     * @private
     * @param {?} data
     * @return {?}
     */
    viewLogs(data) {
        this.type = data.type;
        this.actDefId = data.actiDefId;
    }
    /**
     * @private
     * @return {?}
     */
    viewFlowChartByProcInstId() {
        this.content = '';
        if (this.procInstId) {
            if (this.mode === 'complete') {
                forkJoin(this.service.getProcInstanceById(this.procInstId), this.service.getBpmnModelbyProcInstId(this.procInstId), this.service.getCompleteProcessInfoByProcInstId(this.procInstId))
                    .subscribe((data) => {
                    this.processInstance = data[0];
                    this.content = JSON.stringify(data[1]);
                    this.actInstList = data[2].activityInstanceSlims;
                    this.transInsList = data[2].transitionInstanceSlims;
                    this.loadFlowChart();
                });
            }
            else {
                forkJoin(this.service.getProcInstanceById(this.procInstId), this.service.getBpmnModelbyProcInstId(this.procInstId), this.service.getForecastProcessByProcInstId(this.procInstId))
                    .subscribe((data) => {
                    this.processInstance = data[0];
                    this.content = JSON.stringify(data[1]);
                    this.actInstList = data[2].activityInstanceSlims;
                    this.transInsList = data[2].transitionInstanceSlims;
                    this.loadFlowChart();
                });
            }
        }
    }
    /**
     * @private
     * @return {?}
     */
    processForecast() {
        this.content = '';
        this.mode = 'simulation';
        // this.ifForecast = true;
        if (this.processForecastPayload.processDefinitionId && this.processForecastPayload.dataId) {
            forkJoin(this.service.getBpmnModelbyProcDefId(this.processForecastPayload.processDefinitionId), this.service.getForecastProcessByPayload(this.processForecastPayload))
                .subscribe((data) => {
                this.content = JSON.stringify(data[0]);
                this.actInstList = data[1].activityInstanceSlims;
                this.transInsList = data[1].transitionInstanceSlims;
                this.loadFlowChart();
            });
        }
    }
    /**
     * @private
     * @param {?} procInstId
     * @param {?} actInstId
     * @param {?} bizInstId
     * @return {?}
     */
    viewForm(procInstId, actInstId, bizInstId) {
        if (procInstId) {
            this.service.getFormInfoByActInstId(procInstId, actInstId).subscribe((re) => {
                /** @type {?} */
                const formInfo = re;
                if (!formInfo || !formInfo.appId) {
                    if (this.message) {
                        this.message.info('找不到单据，请联系管理员查看原因！');
                    }
                    return;
                }
                /** @type {?} */
                const options = {
                    appType: 'menu',
                    funcId: formInfo.appId,
                    appId: '',
                    appEntrance: '',
                    tabId: bizInstId,
                    isNewTab: true
                };
                // 传工作流上下文参数
                /** @type {?} */
                const parameters = new Map();
                parameters.set('procInstId', procInstId);
                parameters.set('actInstId', actInstId);
                formInfo.parameters.forEach((item) => parameters.set(item.code, item.value));
                options.queryStringParams = parameters;
                if (this.frameworkSvc) {
                    this.frameworkSvc.openMenu(options);
                }
                else {
                    throw Error('框架服务不存在！无法联查！');
                }
            });
        }
    }
    /**
     * @private
     * @param {?} procInstId
     * @param {?} actInstId
     * @param {?} bizInstId
     * @return {?}
     */
    retryAifCreation(procInstId, actInstId, bizInstId) {
        if (procInstId) {
            this.service.retryAifCreation(procInstId, actInstId, bizInstId).subscribe((re) => {
                this.viewFlowChart();
            }, (err) => {
                setTimeout(() => {
                    //todo 确定异常结构, 目前采用兼容取值方式
                    this.message.error(err.error == null ? err.message : (err.error.Message || err.error.message || err.message));
                }, 300);
                throw err;
            });
        }
    }
    /**
     * @return {?}
     */
    loadFlowChart() {
        if (this.content) {
            this.postMessage('load', {
                processInstance: this.processInstance,
                content: this.content,
                actiInstList: this.actInstList,
                transInsList: this.transInsList,
                mode: this.mode
            });
        }
    }
    /**
     * @param {?} action
     * @param {?} data
     * @return {?}
     */
    postMessage(action, data) {
        /** @type {?} */
        const message = { action, data };
        this.iframe.nativeElement.contentWindow.postMessage(message, this.fcHtml);
    }
    /**
     * @return {?}
     */
    fill() {
        this.cls = 'd-flex flex-fill h-100 f-utils-absolute-all';
    }
}
UIFlowchartComponent.func = null; // 消息监听处理方法
UIFlowchartComponent.decorators = [
    { type: Component, args: [{
                selector: 'wf-flowchart',
                template: "<layout [direction]=\"'h'\" [fill]=\"true\">\r\n    <layout-panel region=\"west\" [showBorder]=\"false\" [minWidth]=\"400\" style=\"width: 70%;\">\r\n        <farris-section [mainTitle]=\"'static.flowchart.flowChart' | translate\" [enableMaximize]=\"false\"\r\n            [enableAccordion]=\"false\" [fill]=\"true\" style=\"height: 100%;\" class=\"px-0 pb-0\">\r\n            <ng-template farrisSectionToolbar>   \r\n                <button *ngIf=\"theme==='viewFlowChart'\" class=\"btn btn-secondary mr-2\" (click)=\"modeSwitch()\">{{modeButton}}</button>\r\n                <div class=\"btn-group\" fDropdown>\r\n                    <button class=\"btn btn-secondary dropdown-toggle\" fDropdownToggle type=\"button\">\r\n                        {{'static.flowchart.sequenceColor' | translate}}\r\n                    </button>\r\n                    <div class=\"dropdown-menu\" fDropdownMenu>\r\n                        <table class=\"mx-2\">\r\n                            <tbody>\r\n                                <tr>\r\n                                    <td style=\"width:25px;\"><span\r\n                                            style=\"background:#595959;color:#fff;border-radius:0;display: block;width:15px;height:15px;\"></span>\r\n                                    </td>\r\n                        \r\n                                    <td style=\"width:60px;\">{{'static.flowchart.completed' | translate}}</td>\r\n                                </tr>\r\n                                <tr>\r\n                                    <td style=\"width:25px;\"><span\r\n                                            style=\"background:#f59c24;color:#fff;border-radius:0;display: block;width:15px;height:15px;\"></span>\r\n                                    </td>\r\n                                    <td style=\"width:60px;\">{{'static.flowchart.calculate' | translate}}</td>\r\n                                </tr>\r\n                                <tr>\r\n                                    <td style=\"width:25px;\"><span\r\n                                            style=\"background:#59A1FF;color:#fff;border-radius:0;display: block;width:15px;height:15px;\"></span>\r\n                                    </td>\r\n                                    <td style=\"width:60px;\">{{'static.flowchart.default' | translate}}</td>\r\n                                </tr>\r\n                                <tr>\r\n                                    <td style=\"width:25px;\"><span\r\n                                            style=\"background:#FF4040;color:#fff;border-radius:0;display: block;width:15px;height:15px;\"></span>\r\n                                    </td>\r\n                                    <td style=\"width:60px;\">{{'static.flowchart.suspend' | translate}}</td>\r\n                                </tr>\r\n                            </tbody>\r\n                        </table>\r\n                    </div>\r\n                </div>\r\n\r\n            </ng-template>\r\n            <div *ngIf=\"dataId || procInstId || processForecastPayload\" style=\"height: 100%;\">\r\n                <iframe #iframe class=\"flowChart\" [src]=\"srcUrl\" frameborder=\"0\">\r\n                </iframe>\r\n            </div>\r\n        </farris-section>\r\n    </layout-panel>\r\n    <layout-panel region=\"center\" [showBorder]=\"false\" [minWidth]=\"300\" style=\"overflow: auto; width: 30%;\">\r\n        <farris-section [enableMaximize]=\"false\" [enableAccordion]=\"false\" [showHeader]=\"false\" class=\"px-0\">\r\n            <wf-approval-logs\r\n                [ProcInstId]=\"procInstId\"\r\n                [DataId]=\"dataId\" \r\n                [IfForecast]=\"ifForecast\"\r\n                [ActivityDefinitionId]=\"actDefId\" \r\n                [Type]=\"type\"\r\n                [processForecastPayload] = \"processForecastPayload\"\r\n                [ShowHeader]=\"true\"\r\n                [ShowViewProcess]=\"false\"\r\n            >\r\n            </wf-approval-logs>\r\n        </farris-section>\r\n    </layout-panel>\r\n</layout>\r\n\r\n",
                styles: ["::ng-deep .chartModal .ant-modal{height:100%}::ng-deep .chartModal .ant-modal-content{height:100%}::ng-deep .chartModal .ant-modal-body{height:90%}.flowChart{height:100%;min-height:400px;width:100%}"]
            }] }
];
/** @nocollapse */
UIFlowchartComponent.ctorParameters = () => [
    { type: DomSanitizer },
    { type: UiFlowchartService },
    { type: ChangeDetectorRef },
    { type: Injector },
    { type: WFFlowchartService, decorators: [{ type: Optional }] }
];
UIFlowchartComponent.propDecorators = {
    cls: [{ type: HostBinding, args: ['class',] }],
    iframe: [{ type: ViewChild, args: ['iframe',] }],
    modalHide: [{ type: Output }],
    theme: [{ type: Input }],
    processForecastPayload: [{ type: Input }],
    mode: [{ type: Input }],
    ProcInstId: [{ type: Input }],
    DataId: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    UIFlowchartComponent.func;
    /** @type {?} */
    UIFlowchartComponent.prototype.cls;
    /** @type {?} */
    UIFlowchartComponent.prototype.iframe;
    /** @type {?} */
    UIFlowchartComponent.prototype.modalHide;
    /** @type {?} */
    UIFlowchartComponent.prototype.procInstId;
    /** @type {?} */
    UIFlowchartComponent.prototype.dataId;
    /** @type {?} */
    UIFlowchartComponent.prototype.actDefId;
    /** @type {?} */
    UIFlowchartComponent.prototype.ifForecast;
    /** @type {?} */
    UIFlowchartComponent.prototype.type;
    /** @type {?} */
    UIFlowchartComponent.prototype.srcUrl;
    /** @type {?} */
    UIFlowchartComponent.prototype.content;
    /** @type {?} */
    UIFlowchartComponent.prototype.actInstList;
    /** @type {?} */
    UIFlowchartComponent.prototype.transInsList;
    /** @type {?} */
    UIFlowchartComponent.prototype.processInstance;
    /** @type {?} */
    UIFlowchartComponent.prototype.fcHtml;
    /** @type {?} */
    UIFlowchartComponent.prototype.theme;
    /** @type {?} */
    UIFlowchartComponent.prototype.processForecastPayload;
    /**
     * @type {?}
     * @private
     */
    UIFlowchartComponent.prototype._mode;
    /** @type {?} */
    UIFlowchartComponent.prototype.modeButton;
    /** @type {?} */
    UIFlowchartComponent.prototype.typeList;
    /**
     * @type {?}
     * @private
     */
    UIFlowchartComponent.prototype.message;
    /**
     * @type {?}
     * @private
     */
    UIFlowchartComponent.prototype.frameworkSvc;
    /** @type {?} */
    UIFlowchartComponent.prototype.eventHandler;
    /**
     * @type {?}
     * @private
     */
    UIFlowchartComponent.prototype.sanitizer;
    /**
     * @type {?}
     * @private
     */
    UIFlowchartComponent.prototype.service;
    /**
     * @type {?}
     * @private
     */
    UIFlowchartComponent.prototype.changeDetector;
    /**
     * @type {?}
     * @private
     */
    UIFlowchartComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    UIFlowchartComponent.prototype.chartService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFzay1mbG93Y2hhcnQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdzcC13Zi91aS1mbG93Y2hhcnQvIiwic291cmNlcyI6WyJsaWIvdGFzay1mbG93Y2hhcnQvdGFzay1mbG93Y2hhcnQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUFVLFNBQVMsRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFDdkQsWUFBWSxFQUFFLFdBQVcsRUFBRSxpQkFBaUIsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUNqRSxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDekQsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNoQyxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUN0RSxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUM3RCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDdEQsT0FBTyxFQUFjLGdCQUFnQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFRbkUsTUFBTSxPQUFPLG9CQUFvQjs7Ozs7Ozs7SUFnRS9CLFlBQ1UsU0FBdUIsRUFDdkIsT0FBMkIsRUFDM0IsY0FBaUMsRUFDakMsUUFBa0IsRUFDTixZQUFnQztRQUo1QyxjQUFTLEdBQVQsU0FBUyxDQUFjO1FBQ3ZCLFlBQU8sR0FBUCxPQUFPLENBQW9CO1FBQzNCLG1CQUFjLEdBQWQsY0FBYyxDQUFtQjtRQUNqQyxhQUFRLEdBQVIsUUFBUSxDQUFVO1FBQ04saUJBQVksR0FBWixZQUFZLENBQW9COztRQWxFaEMsUUFBRyxHQUFHLHdCQUF3QixDQUFDO1FBRTNDLGNBQVMsR0FBRyxJQUFJLFlBQVksRUFBVyxDQUFDO1FBV2xELFdBQU0sR0FBRyxNQUFNLENBQUMsUUFB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QXZTTSx5QkFBSSxHQUFRLElBQUksQ0FBQyxDQUFDLFdBQVc7O1lBUnJDLFNBQVMsU0FBQztnQkFDVCxRQUFRLEVBQUUsY0FBYztnQkFDeEIsb2hJQUE4Qzs7YUFFL0M7Ozs7WUFYUSxZQUFZO1lBRVosa0JBQWtCO1lBSkUsaUJBQWlCO1lBQVksUUFBUTtZQUt6RCxrQkFBa0IsdUJBK0V0QixRQUFROzs7a0JBbEVWLFdBQVcsU0FBQyxPQUFPO3FCQUNuQixTQUFTLFNBQUMsUUFBUTt3QkFDbEIsTUFBTTtvQkFhTixLQUFLO3FDQUdMLEtBQUs7bUJBS0wsS0FBSzt5QkF3QkwsS0FBSztxQkFPTCxLQUFLOzs7O0lBdkROLDBCQUF3Qjs7SUFDeEIsbUNBQXFEOztJQUNyRCxzQ0FBd0M7O0lBQ3hDLHlDQUFrRDs7SUFDbEQsMENBQW1COztJQUNuQixzQ0FBZTs7SUFDZix3Q0FBaUI7O0lBQ2pCLDBDQUFtQjs7SUFDbkIsb0NBQVU7O0lBQ1Ysc0NBQVk7O0lBQ1osdUNBQWdCOztJQUNoQiwyQ0FBbUI7O0lBQ25CLDRDQUFvQjs7SUFDcEIsK0NBQXFCOztJQUNyQixzQ0FBOEY7O0lBRTlGLHFDQUN3Qjs7SUFFeEIsc0RBQzRCOzs7OztJQUU1QixxQ0FBMkI7O0lBZ0IzQiwwQ0FBc0U7O0lBQ3RFLHdDQUtHOzs7OztJQUNILHVDQUFpQzs7Ozs7SUFDakMsNENBQXVDOztJQTBDdkMsNENBMkJDOzs7OztJQXBEQyx5Q0FBK0I7Ozs7O0lBQy9CLHVDQUFtQzs7Ozs7SUFDbkMsOENBQXlDOzs7OztJQUN6Qyx3Q0FBMEI7Ozs7O0lBQzFCLDRDQUFvRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgQ29tcG9uZW50LCBPbkluaXQsIFZpZXdDaGlsZCwgRWxlbWVudFJlZiwgSW5wdXQsIE91dHB1dCxcclxuICBFdmVudEVtaXR0ZXIsIEhvc3RCaW5kaW5nLCBDaGFuZ2VEZXRlY3RvclJlZiwgT3B0aW9uYWwsIEluamVjdG9yXHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IERvbVNhbml0aXplciB9IGZyb20gJ0Bhbmd1bGFyL3BsYXRmb3JtLWJyb3dzZXInO1xyXG5pbXBvcnQgeyBmb3JrSm9pbiB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBVaUZsb3djaGFydFNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy91aS1mbG93Y2hhcnQuc2VydmljZSc7XHJcbmltcG9ydCB7IFdGRmxvd2NoYXJ0U2VydmljZSB9IGZyb20gJy4uL3dmLWZsb3djaGFydC5zZXJ2aWNlJztcclxuaW1wb3J0IHsgTWVzc2FnZXJTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1tZXNzYWdlcic7XHJcbmltcG9ydCB7IEFwcE9wdGlvbnMsIEZyYW1ld29ya1NlcnZpY2UgfSBmcm9tICdAZ3NwLXN5cy9ydGYtY29tbW9uJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnd2YtZmxvd2NoYXJ0JyxcclxuICB0ZW1wbGF0ZVVybDogJy4vdGFzay1mbG93Y2hhcnQuY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsczogWycuL3Rhc2stZmxvd2NoYXJ0LmNvbXBvbmVudC5jc3MnXVxyXG59KVxyXG5cclxuZXhwb3J0IGNsYXNzIFVJRmxvd2NoYXJ0Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuXHJcbiAgc3RhdGljIGZ1bmM6IGFueSA9IG51bGw7IC8vIOa2iOaBr+ebkeWQrOWkhOeQhuaWueazlVxyXG4gIEBIb3N0QmluZGluZygnY2xhc3MnKSBjbHMgPSAnZC1mbGV4IGZsZXgtZmlsbCBoLTEwMCc7XHJcbiAgQFZpZXdDaGlsZCgnaWZyYW1lJykgaWZyYW1lOiBFbGVtZW50UmVmO1xyXG4gIEBPdXRwdXQoKSBtb2RhbEhpZGUgPSBuZXcgRXZlbnRFbWl0dGVyPGJvb2xlYW4+KCk7XHJcbiAgcHJvY0luc3RJZDogc3RyaW5nOy8v5rWB56iL5a6e5L6LaWRcclxuICBkYXRhSWQ6IHN0cmluZzsvL+ihqOWNlWlkXHJcbiAgYWN0RGVmSWQ6IHN0cmluZzsvL+iKgueCueWumuS5iWlkXHJcbiAgaWZGb3JlY2FzdDogc3RyaW5nOy8v5piv5ZCm6aKE5rWLXHJcbiAgdHlwZTogYW55OyAvL3R5cGUgPSAncHJvY2Vzcyfmn6XnnIvmtYHnqIvml6Xlv5fvvJt0eXBlID0gJ2FjdGl2aXR5J++8jOafpeeci+iKgueCueaXpeW/l1xyXG4gIHNyY1VybDogYW55O1xyXG4gIGNvbnRlbnQ6IHN0cmluZzsgLy8gYnBtbk1vZGVsXHJcbiAgYWN0SW5zdExpc3Q6IGFueVtdOyAvLyDmtLvliqjlrp7kvotMaXN0XHJcbiAgdHJhbnNJbnNMaXN0OiBhbnlbXTsgIC8vIOa1gei9rOWunuS+i1xyXG4gIHByb2Nlc3NJbnN0YW5jZTogYW55O1xyXG4gIGZjSHRtbCA9IHdpbmRvdy5kb2N1bWVudC5sb2NhdGlvbi5vcmlnaW4gKyAnL3BsYXRmb3JtL3J1bnRpbWUvd2Yvd2ViL2Rlc2lnbmVyL2Zsb3djaGFydC5odG1sJztcclxuXHJcbiAgQElucHV0KClcclxuICB0aGVtZSA9ICd2aWV3Rmxvd0NoYXJ0JztcclxuXHJcbiAgQElucHV0KClcclxuICBwcm9jZXNzRm9yZWNhc3RQYXlsb2FkOiBhbnk7XHJcblxyXG4gIHByaXZhdGUgX21vZGUgPSAnY29tcGxldGUnO1xyXG5cclxuICBASW5wdXQoKVxyXG4gIHNldCBtb2RlKHY6IHN0cmluZykge1xyXG4gICAgdGhpcy5fbW9kZSA9IHY7XHJcbiAgICBpZiAodGhpcy5fbW9kZSA9PT0gJ3NpbXVsYXRpb24nKSB7XHJcbiAgICAgIHRoaXMuaWZGb3JlY2FzdCA9ICd0cnVlJztcclxuICAgICAgdGhpcy5tb2RlQnV0dG9uID0gdGhpcy5zZXJ2aWNlLmdldEkxOG5WYWx1ZSgnc3RhdGljLmZsb3djaGFydC5jb21wbGV0ZScpO1xyXG4gICAgfSBlbHNlIGlmICh0aGlzLl9tb2RlID09PSAnY29tcGxldGUnKSB7XHJcbiAgICAgIHRoaXMubW9kZUJ1dHRvbiA9IHRoaXMuc2VydmljZS5nZXRJMThuVmFsdWUoJ3N0YXRpYy5mbG93Y2hhcnQuc2ltdWxhdGlvbicpO1xyXG4gICAgfVxyXG4gIH1cclxuICBnZXQgbW9kZSgpIHtcclxuICAgIHJldHVybiB0aGlzLl9tb2RlO1xyXG4gIH1cclxuXHJcbiAgbW9kZUJ1dHRvbiA9IHRoaXMuc2VydmljZS5nZXRJMThuVmFsdWUoJ3N0YXRpYy5mbG93Y2hhcnQuc2ltdWxhdGlvbicpO1xyXG4gIHR5cGVMaXN0ID0gW3tcclxuICAgIHZhbHVlOiAnY29tcGxldGUnLCB0ZXh0OiB0aGlzLnNlcnZpY2UuZ2V0STE4blZhbHVlKCdzdGF0aWMuZmxvd2NoYXJ0LmNvbXBsZXRlJylcclxuICB9LFxyXG4gIHtcclxuICAgIHZhbHVlOiAnc2ltdWxhdGlvbicsIHRleHQ6IHRoaXMuc2VydmljZS5nZXRJMThuVmFsdWUoJ3N0YXRpYy5mbG93Y2hhcnQuc2ltdWxhdGlvbicpXHJcbiAgfV07XHJcbiAgcHJpdmF0ZSBtZXNzYWdlOiBNZXNzYWdlclNlcnZpY2U7XHJcbiAgcHJpdmF0ZSBmcmFtZXdvcmtTdmM6IEZyYW1ld29ya1NlcnZpY2U7XHJcblxyXG4gIEBJbnB1dCgpXHJcbiAgc2V0IFByb2NJbnN0SWQocHJvY0luc3RJZDogc3RyaW5nKSB7XHJcbiAgICBpZiAocHJvY0luc3RJZCkge1xyXG4gICAgICB0aGlzLnByb2NJbnN0SWQgPSBwcm9jSW5zdElkO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgQElucHV0KClcclxuICBzZXQgRGF0YUlkKGRhdGFJZDogc3RyaW5nKSB7XHJcbiAgICBpZiAoZGF0YUlkKSB7XHJcbiAgICAgIHRoaXMuZGF0YUlkID0gZGF0YUlkO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIHNhbml0aXplcjogRG9tU2FuaXRpemVyLFxyXG4gICAgcHJpdmF0ZSBzZXJ2aWNlOiBVaUZsb3djaGFydFNlcnZpY2UsXHJcbiAgICBwcml2YXRlIGNoYW5nZURldGVjdG9yOiBDaGFuZ2VEZXRlY3RvclJlZixcclxuICAgIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yLFxyXG4gICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSBjaGFydFNlcnZpY2U6IFdGRmxvd2NoYXJ0U2VydmljZSxcclxuICApIHtcclxuICAgIHRoaXMubWVzc2FnZSA9IHRoaXMuaW5qZWN0b3IuZ2V0KE1lc3NhZ2VyU2VydmljZSk7XHJcbiAgICB0aGlzLmZyYW1ld29ya1N2YyA9IHRoaXMuaW5qZWN0b3IuZ2V0KEZyYW1ld29ya1NlcnZpY2UpO1xyXG4gICAgdGhpcy5zcmNVcmwgPSB0aGlzLnNhbml0aXplci5ieXBhc3NTZWN1cml0eVRydXN0UmVzb3VyY2VVcmwodGhpcy5mY0h0bWwpO1xyXG4gICAgaWYgKFVJRmxvd2NoYXJ0Q29tcG9uZW50LmZ1bmMpIHtcclxuICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCBVSUZsb3djaGFydENvbXBvbmVudC5mdW5jLCBmYWxzZSk7XHJcbiAgICB9XHJcbiAgICB0aGlzLmFkZE1lc3NhZ2VMaXN0ZW5lcigpO1xyXG5cclxuICB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhZGRNZXNzYWdlTGlzdGVuZXIoKSB7XHJcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIHRoaXMuZXZlbnRIYW5kbGVyLCBmYWxzZSk7XHJcbiAgICBVSUZsb3djaGFydENvbXBvbmVudC5mdW5jID0gdGhpcy5ldmVudEhhbmRsZXI7XHJcbiAgfVxyXG5cclxuICAvLyDnm5HlkKzkuovku7blpITnkIZcclxuICBldmVudEhhbmRsZXIgPSAoZXZlbnQpID0+IHtcclxuICAgIGNvbnN0IG9yaWdpbiA9IGV2ZW50Lm9yaWdpbjtcclxuICAgIGNvbnN0IG1lc3NhZ2UgPSBldmVudC5kYXRhO1xyXG4gICAgaWYgKHRoaXMuZmNIdG1sLnNlYXJjaChvcmlnaW4pID4gLTEpIHtcclxuICAgICAgc3dpdGNoIChtZXNzYWdlLmFjdGlvbikge1xyXG4gICAgICAgIGNhc2UgJ2xvYWQnOlxyXG4gICAgICAgICAgdGhpcy52aWV3Rmxvd0NoYXJ0KCk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICd2aWV3TG9ncyc6XHJcbiAgICAgICAgICB0aGlzLnZpZXdMb2dzKG1lc3NhZ2UuZGF0YSk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICd2aWV3UGFyZW50JzpcclxuICAgICAgICAgIHRoaXMudmlld1BhcmVudChtZXNzYWdlLmRhdGEuc3VwZXJQcm9jSW5zdElkKTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ3ZpZXdDaGlsZCc6XHJcbiAgICAgICAgICB0aGlzLnZpZXdDaGlsZChtZXNzYWdlLmRhdGEuc3VwZXJBY3RJbnN0SWQsIG1lc3NhZ2UuZGF0YS5zdXBlclByb2NJbnN0SWQpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAndmlld0Zvcm0nOlxyXG4gICAgICAgICAgdGhpcy52aWV3Rm9ybShtZXNzYWdlLmRhdGEucHJvY0luc3RJZCwgbWVzc2FnZS5kYXRhLmFjdEluc3RJZCwgbWVzc2FnZS5kYXRhLmJpekluc3RJZCk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdyZXRyeUFpZkNyZWF0aW9uJzpcclxuICAgICAgICAgIHRoaXMucmV0cnlBaWZDcmVhdGlvbihtZXNzYWdlLmRhdGEucHJvY0luc3RJZCwgbWVzc2FnZS5kYXRhLmFjdEluc3RJZCwgbWVzc2FnZS5kYXRhLmJpekluc3RJZCk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgdmlld0Zsb3dDaGFydCgpIHtcclxuICAgIGlmICh0aGlzLnRoZW1lID09PSAndmlld0Zsb3dDaGFydCcpIHtcclxuICAgICAgdGhpcy52aWV3Rmxvd0NoYXJ0QnlQcm9jSW5zdElkKCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLnByb2Nlc3NGb3JlY2FzdCgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSB2aWV3UGFyZW50KHN1cGVyUHJvY0luc3RJZDogc3RyaW5nKSB7XHJcbiAgICAvLyB0aGlzLnByb2NJbnN0SWQgPSBzdXBlclByb2NJbnN0SWQ7XHJcbiAgICAvLyB0aGlzLnZpZXdGbG93Q2hhcnRCeVByb2NJbnN0SWQoKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgdmlld0NoaWxkKHN1cGVyQWN0SW5zdElkOiBzdHJpbmcsIHN1cGVyUHJvY0luc3RJZDogc3RyaW5nKSB7XHJcbiAgICB0aGlzLnNlcnZpY2UuZ2V0U3ViUHJvY2Vzc0luc3RhbmNlKHN1cGVyQWN0SW5zdElkLCBzdXBlclByb2NJbnN0SWQpXHJcbiAgICAgIC5zdWJzY3JpYmUocmUgPT4ge1xyXG4gICAgICAgIGlmICh0aGlzLmNoYXJ0U2VydmljZSkge1xyXG4gICAgICAgICAgdGhpcy5jaGFydFNlcnZpY2Uudmlld0Zsb3dDaGFydEJ5RGlhbG9nKHJlLmlkLCB0aGlzLm1vZGUpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0aHJvdyBFcnJvcign6K+35Y2H57qn5p+l55yL5rWB56iL5YWs5YWx5YyF5a6e546w6IGU5p+l5a2Q5rWB56iL5Zu+5Yqf6IO9Jyk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICB9XHJcblxyXG4gIG1vZGVTd2l0Y2goKSB7XHJcbiAgICBpZiAodGhpcy5tb2RlID09PSAnY29tcGxldGUnKSB7XHJcbiAgICAgIHRoaXMubW9kZSA9ICdzaW11bGF0aW9uJztcclxuICAgICAgdGhpcy5pZkZvcmVjYXN0ID0gJ3RydWUnO1xyXG4gICAgICB0aGlzLm1vZGVCdXR0b24gPSB0aGlzLnNlcnZpY2UuZ2V0STE4blZhbHVlKCdzdGF0aWMuZmxvd2NoYXJ0LmNvbXBsZXRlJyk7XHJcbiAgICAgIHRoaXMuc2VydmljZS5nZXRGb3JlY2FzdFByb2Nlc3NCeVByb2NJbnN0SWQodGhpcy5wcm9jSW5zdElkKS5zdWJzY3JpYmUociA9PiB7XHJcbiAgICAgICAgdGhpcy5hY3RJbnN0TGlzdCA9IHIuYWN0aXZpdHlJbnN0YW5jZVNsaW1zO1xyXG4gICAgICAgIHRoaXMudHJhbnNJbnNMaXN0ID0gci50cmFuc2l0aW9uSW5zdGFuY2VTbGltcztcclxuICAgICAgICB0aGlzLnBvc3RNZXNzYWdlKCdtb2RlU3dpdGNoJywge1xyXG4gICAgICAgICAgbW9kZTogJ3NpbXVsYXRpb24nLFxyXG4gICAgICAgICAgYWN0aUluc3RMaXN0OiByLmFjdGl2aXR5SW5zdGFuY2VTbGltcyxcclxuICAgICAgICAgIHRyYW5zSW5zTGlzdDogci50cmFuc2l0aW9uSW5zdGFuY2VTbGltc1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMubW9kZSA9ICdjb21wbGV0ZSc7XHJcbiAgICAgIHRoaXMuaWZGb3JlY2FzdCA9ICdmYWxzZSc7XHJcbiAgICAgIHRoaXMubW9kZUJ1dHRvbiA9IHRoaXMuc2VydmljZS5nZXRJMThuVmFsdWUoJ3N0YXRpYy5mbG93Y2hhcnQuc2ltdWxhdGlvbicpO1xyXG4gICAgICB0aGlzLnNlcnZpY2UuZ2V0Q29tcGxldGVQcm9jZXNzSW5mb0J5UHJvY0luc3RJZCh0aGlzLnByb2NJbnN0SWQpLnN1YnNjcmliZShyID0+IHtcclxuICAgICAgICB0aGlzLmFjdEluc3RMaXN0ID0gci5hY3Rpdml0eUluc3RhbmNlU2xpbXM7XHJcbiAgICAgICAgdGhpcy50cmFuc0luc0xpc3QgPSByLnRyYW5zaXRpb25JbnN0YW5jZVNsaW1zO1xyXG4gICAgICAgIHRoaXMucG9zdE1lc3NhZ2UoJ21vZGVTd2l0Y2gnLCB7XHJcbiAgICAgICAgICBtb2RlOiAnY29tcGxldGUnLFxyXG4gICAgICAgICAgYWN0aUluc3RMaXN0OiByLmFjdGl2aXR5SW5zdGFuY2VTbGltcyxcclxuICAgICAgICAgIHRyYW5zSW5zTGlzdDogci50cmFuc2l0aW9uSW5zdGFuY2VTbGltc1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgdmlld0xvZ3MoZGF0YTogYW55KSB7XHJcbiAgICB0aGlzLnR5cGUgPSBkYXRhLnR5cGU7XHJcbiAgICB0aGlzLmFjdERlZklkID0gZGF0YS5hY3RpRGVmSWQ7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHZpZXdGbG93Q2hhcnRCeVByb2NJbnN0SWQoKSB7XHJcbiAgICB0aGlzLmNvbnRlbnQgPSAnJztcclxuICAgIGlmICh0aGlzLnByb2NJbnN0SWQpIHtcclxuICAgICAgaWYgKHRoaXMubW9kZSA9PT0gJ2NvbXBsZXRlJykge1xyXG4gICAgICAgIGZvcmtKb2luKFxyXG4gICAgICAgICAgdGhpcy5zZXJ2aWNlLmdldFByb2NJbnN0YW5jZUJ5SWQodGhpcy5wcm9jSW5zdElkKSxcclxuICAgICAgICAgIHRoaXMuc2VydmljZS5nZXRCcG1uTW9kZWxieVByb2NJbnN0SWQodGhpcy5wcm9jSW5zdElkKSxcclxuICAgICAgICAgIHRoaXMuc2VydmljZS5nZXRDb21wbGV0ZVByb2Nlc3NJbmZvQnlQcm9jSW5zdElkKHRoaXMucHJvY0luc3RJZCkpXHJcbiAgICAgICAgICAuc3Vic2NyaWJlKChkYXRhOiBhbnlbXSkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnByb2Nlc3NJbnN0YW5jZSA9IGRhdGFbMF07XHJcbiAgICAgICAgICAgIHRoaXMuY29udGVudCA9IEpTT04uc3RyaW5naWZ5KGRhdGFbMV0pO1xyXG4gICAgICAgICAgICB0aGlzLmFjdEluc3RMaXN0ID0gZGF0YVsyXS5hY3Rpdml0eUluc3RhbmNlU2xpbXM7XHJcbiAgICAgICAgICAgIHRoaXMudHJhbnNJbnNMaXN0ID0gZGF0YVsyXS50cmFuc2l0aW9uSW5zdGFuY2VTbGltcztcclxuICAgICAgICAgICAgdGhpcy5sb2FkRmxvd0NoYXJ0KCk7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBmb3JrSm9pbihcclxuICAgICAgICAgIHRoaXMuc2VydmljZS5nZXRQcm9jSW5zdGFuY2VCeUlkKHRoaXMucHJvY0luc3RJZCksXHJcbiAgICAgICAgICB0aGlzLnNlcnZpY2UuZ2V0QnBtbk1vZGVsYnlQcm9jSW5zdElkKHRoaXMucHJvY0luc3RJZCksXHJcbiAgICAgICAgICB0aGlzLnNlcnZpY2UuZ2V0Rm9yZWNhc3RQcm9jZXNzQnlQcm9jSW5zdElkKHRoaXMucHJvY0luc3RJZCkpXHJcbiAgICAgICAgICAuc3Vic2NyaWJlKChkYXRhOiBhbnlbXSkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnByb2Nlc3NJbnN0YW5jZSA9IGRhdGFbMF07XHJcbiAgICAgICAgICAgIHRoaXMuY29udGVudCA9IEpTT04uc3RyaW5naWZ5KGRhdGFbMV0pO1xyXG4gICAgICAgICAgICB0aGlzLmFjdEluc3RMaXN0ID0gZGF0YVsyXS5hY3Rpdml0eUluc3RhbmNlU2xpbXM7XHJcbiAgICAgICAgICAgIHRoaXMudHJhbnNJbnNMaXN0ID0gZGF0YVsyXS50cmFuc2l0aW9uSW5zdGFuY2VTbGltcztcclxuICAgICAgICAgICAgdGhpcy5sb2FkRmxvd0NoYXJ0KCk7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBwcm9jZXNzRm9yZWNhc3QoKSB7XHJcbiAgICB0aGlzLmNvbnRlbnQgPSAnJztcclxuICAgIHRoaXMubW9kZSA9ICdzaW11bGF0aW9uJztcclxuICAgIC8vIHRoaXMuaWZGb3JlY2FzdCA9IHRydWU7XHJcbiAgICBpZiAodGhpcy5wcm9jZXNzRm9yZWNhc3RQYXlsb2FkLnByb2Nlc3NEZWZpbml0aW9uSWQgJiYgdGhpcy5wcm9jZXNzRm9yZWNhc3RQYXlsb2FkLmRhdGFJZCkge1xyXG4gICAgICBmb3JrSm9pbihcclxuICAgICAgICB0aGlzLnNlcnZpY2UuZ2V0QnBtbk1vZGVsYnlQcm9jRGVmSWQodGhpcy5wcm9jZXNzRm9yZWNhc3RQYXlsb2FkLnByb2Nlc3NEZWZpbml0aW9uSWQpLFxyXG4gICAgICAgIHRoaXMuc2VydmljZS5nZXRGb3JlY2FzdFByb2Nlc3NCeVBheWxvYWQodGhpcy5wcm9jZXNzRm9yZWNhc3RQYXlsb2FkKSlcclxuICAgICAgICAuc3Vic2NyaWJlKChkYXRhOiBhbnlbXSkgPT4ge1xyXG4gICAgICAgICAgdGhpcy5jb250ZW50ID0gSlNPTi5zdHJpbmdpZnkoZGF0YVswXSk7XHJcbiAgICAgICAgICB0aGlzLmFjdEluc3RMaXN0ID0gZGF0YVsxXS5hY3Rpdml0eUluc3RhbmNlU2xpbXM7XHJcbiAgICAgICAgICB0aGlzLnRyYW5zSW5zTGlzdCA9IGRhdGFbMV0udHJhbnNpdGlvbkluc3RhbmNlU2xpbXM7XHJcbiAgICAgICAgICB0aGlzLmxvYWRGbG93Q2hhcnQoKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgdmlld0Zvcm0ocHJvY0luc3RJZDogc3RyaW5nLCBhY3RJbnN0SWQ6IHN0cmluZywgYml6SW5zdElkOiBzdHJpbmcpIHtcclxuICAgIGlmIChwcm9jSW5zdElkKSB7XHJcbiAgICAgIHRoaXMuc2VydmljZS5nZXRGb3JtSW5mb0J5QWN0SW5zdElkKHByb2NJbnN0SWQsIGFjdEluc3RJZCkuc3Vic2NyaWJlKChyZTogYW55KSA9PiB7XHJcbiAgICAgICAgY29uc3QgZm9ybUluZm8gPSByZTtcclxuICAgICAgICBpZiAoIWZvcm1JbmZvIHx8ICFmb3JtSW5mby5hcHBJZCkge1xyXG4gICAgICAgICAgaWYgKHRoaXMubWVzc2FnZSkge1xyXG4gICAgICAgICAgICB0aGlzLm1lc3NhZ2UuaW5mbygn5om+5LiN5Yiw5Y2V5o2u77yM6K+36IGU57O7566h55CG5ZGY5p+l55yL5Y6f5Zug77yBJyk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IG9wdGlvbnM6IEFwcE9wdGlvbnMgPSB7XHJcbiAgICAgICAgICBhcHBUeXBlOiAnbWVudScsXHJcbiAgICAgICAgICBmdW5jSWQ6IGZvcm1JbmZvLmFwcElkLFxyXG4gICAgICAgICAgYXBwSWQ6ICcnLFxyXG4gICAgICAgICAgYXBwRW50cmFuY2U6ICcnLFxyXG4gICAgICAgICAgdGFiSWQ6IGJpekluc3RJZCxcclxuICAgICAgICAgIGlzTmV3VGFiOiB0cnVlXHJcbiAgICAgICAgfTtcclxuICAgICAgICAvLyDkvKDlt6XkvZzmtYHkuIrkuIvmloflj4LmlbBcclxuICAgICAgICBjb25zdCBwYXJhbWV0ZXJzID0gbmV3IE1hcDxzdHJpbmcsIGFueT4oKTtcclxuICAgICAgICBwYXJhbWV0ZXJzLnNldCgncHJvY0luc3RJZCcsIHByb2NJbnN0SWQpO1xyXG4gICAgICAgIHBhcmFtZXRlcnMuc2V0KCdhY3RJbnN0SWQnLCBhY3RJbnN0SWQpO1xyXG4gICAgICAgIGZvcm1JbmZvLnBhcmFtZXRlcnMuZm9yRWFjaCgoaXRlbTogYW55KSA9PlxyXG4gICAgICAgICAgcGFyYW1ldGVycy5zZXQoaXRlbS5jb2RlLCBpdGVtLnZhbHVlKVxyXG4gICAgICAgICk7XHJcbiAgICAgICAgb3B0aW9ucy5xdWVyeVN0cmluZ1BhcmFtcyA9IHBhcmFtZXRlcnM7XHJcbiAgICAgICAgaWYgKHRoaXMuZnJhbWV3b3JrU3ZjKSB7XHJcbiAgICAgICAgICB0aGlzLmZyYW1ld29ya1N2Yy5vcGVuTWVudShvcHRpb25zKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgdGhyb3cgRXJyb3IoJ+ahhuaetuacjeWKoeS4jeWtmOWcqO+8geaXoOazleiBlOafpe+8gScpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHJldHJ5QWlmQ3JlYXRpb24ocHJvY0luc3RJZDogc3RyaW5nLCBhY3RJbnN0SWQ6IHN0cmluZywgYml6SW5zdElkOiBzdHJpbmcpIHtcclxuICAgIGlmIChwcm9jSW5zdElkKSB7XHJcbiAgICAgIHRoaXMuc2VydmljZS5yZXRyeUFpZkNyZWF0aW9uKHByb2NJbnN0SWQsIGFjdEluc3RJZCwgYml6SW5zdElkKS5zdWJzY3JpYmUoXHJcbiAgICAgICAgKHJlOiBhbnkpID0+IHtcclxuICAgICAgICAgIHRoaXMudmlld0Zsb3dDaGFydCgpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgKGVycikgPT4ge1xyXG4gICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgIC8vdG9kbyDnoa7lrprlvILluLjnu5PmnoQsIOebruWJjemHh+eUqOWFvOWuueWPluWAvOaWueW8j1xyXG4gICAgICAgICAgICB0aGlzLm1lc3NhZ2UuZXJyb3IoZXJyLmVycm9yID09IG51bGwgPyBlcnIubWVzc2FnZSA6IChlcnIuZXJyb3IuTWVzc2FnZSB8fCBlcnIuZXJyb3IubWVzc2FnZSB8fCBlcnIubWVzc2FnZSkpO1xyXG4gICAgICAgICAgfSwgMzAwKTtcclxuICAgICAgICAgIHRocm93IGVycjtcclxuICAgICAgICB9XHJcbiAgICAgICk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgbG9hZEZsb3dDaGFydCgpIHtcclxuICAgIGlmICh0aGlzLmNvbnRlbnQpIHtcclxuICAgICAgdGhpcy5wb3N0TWVzc2FnZSgnbG9hZCcsIHtcclxuICAgICAgICBwcm9jZXNzSW5zdGFuY2U6IHRoaXMucHJvY2Vzc0luc3RhbmNlLFxyXG4gICAgICAgIGNvbnRlbnQ6IHRoaXMuY29udGVudCxcclxuICAgICAgICBhY3RpSW5zdExpc3Q6IHRoaXMuYWN0SW5zdExpc3QsXHJcbiAgICAgICAgdHJhbnNJbnNMaXN0OiB0aGlzLnRyYW5zSW5zTGlzdCxcclxuICAgICAgICBtb2RlOiB0aGlzLm1vZGVcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwb3N0TWVzc2FnZShhY3Rpb246IHN0cmluZywgZGF0YTogYW55KSB7XHJcbiAgICBjb25zdCBtZXNzYWdlID0geyBhY3Rpb24sIGRhdGEgfTtcclxuICAgIHRoaXMuaWZyYW1lLm5hdGl2ZUVsZW1lbnQuY29udGVudFdpbmRvdy5wb3N0TWVzc2FnZShtZXNzYWdlLCB0aGlzLmZjSHRtbCk7XHJcbiAgfVxyXG5cclxuICBmaWxsKCkge1xyXG4gICAgdGhpcy5jbHMgPSAnZC1mbGV4IGZsZXgtZmlsbCBoLTEwMCBmLXV0aWxzLWFic29sdXRlLWFsbCc7XHJcbiAgfVxyXG5cclxufVxyXG4iXX0=