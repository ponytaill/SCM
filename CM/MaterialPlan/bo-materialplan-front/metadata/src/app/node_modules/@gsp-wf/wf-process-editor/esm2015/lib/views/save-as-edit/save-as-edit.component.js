/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, Output, EventEmitter, ViewChild, TemplateRef } from '@angular/core';
import { of } from 'rxjs';
import { LookupGridComponent } from '@farris/ui-lookup';
export class SaveAsEditComponent {
    constructor() {
        this.submit = new EventEmitter();
        this.cancel = new EventEmitter();
        this.accessLevel = 'public';
        this.isAdministratorConfig = false;
        this.items = new Array();
        this.accessLevelCollection = [
            { value: 'public', text: '公有' },
            { value: 'private', text: '私有' }
        ];
        this.columns = [
            { title: '编号', field: 'code', width: '100', searchField: 'code' },
            { title: '名称', field: 'name', width: '100', searchField: 'name' },
        ];
        this.dictPicked = (/**
         * @param {?} data
         * @return {?}
         */
        (data) => {
            this.organizationName = data.name;
            this.organization = data.id;
            return of(true);
        });
    }
    /**
     * @param {?} data
     * @return {?}
     */
    set organizations(data) {
        this._organizations = data;
        if (this._organizations && this._organizations.length > 0) {
            this.items = this.makeTreeByParent(this._organizations, 'parentId', 'id');
        }
        else {
            this.items = new Array();
        }
    }
    /**
     * @return {?}
     */
    get organizations() {
        return this._organizations;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
    }
    /**
     * @return {?}
     */
    saveAsOK() {
        if (this.validator()) {
            this.submit.next({
                procName: this.procName,
                accessLevel: this.accessLevel,
                organization: this.organization,
                organizationName: this.organizationName
            });
        }
    }
    /**
     * @return {?}
     */
    saveAsCancel() {
        this.cancel.emit();
    }
    /**
     * @return {?}
     */
    validator() {
        return true;
    }
    /**
     * @param {?} data
     * @return {?}
     */
    search(data) {
        /** @type {?} */
        const tt = (/** @type {?} */ (this.lookUp.componentRef.instance));
        tt.searchHandle.search(data.field, data.value, 'client');
        // if (data.field === '*') {
        //   this.organizations = this.organizations.filter(o => o.code.indexOf(data.value) > -1 || o.name.indexOf(data.value) > -1);
        // } else {
        //   this.organizations = this.organizations.filter(o => o[data.field].indexOf(data.value) > -1);
        // }
    }
    /**
     * 按照parent码构造树
     * @private
     * @param {?} datas
     * @param {?} parentField
     * @param {?} keyField
     * @return {?}
     */
    makeTreeByParent(datas, parentField, keyField) {
        // 上級爲空，或者沒有上級的
        /** @type {?} */
        const pathLayerOnes = datas.filter((/**
         * @param {?} x
         * @return {?}
         */
        x => {
            if (!x[parentField]) {
                return true;
            }
            /** @type {?} */
            const p = datas.find((/**
             * @param {?} parent
             * @return {?}
             */
            parent => parent[keyField] === x[parentField]));
            if (!p) {
                return true;
            }
        }));
        /** @type {?} */
        const treedata = [];
        pathLayerOnes.forEach((/**
         * @param {?} x
         * @return {?}
         */
        x => {
            /** @type {?} */
            const entity = {};
            entity.data = x;
            entity.children = [];
            treedata.push(entity);
            // this.root = x['id'];
        }));
        treedata.forEach((/**
         * @param {?} item
         * @return {?}
         */
        item => {
            this.findChildrenByParent(item, datas, parentField, keyField);
        }));
        return treedata;
    }
    /**
     * 找到子节点
     * @private
     * @param {?} parent
     * @param {?} datas
     * @param {?} parentField
     * @param {?} keyField
     * @return {?}
     */
    findChildrenByParent(parent, datas, parentField, keyField) {
        /** @type {?} */
        const childList = datas.filter((/**
         * @param {?} childitem
         * @return {?}
         */
        childitem => {
            if (childitem[parentField] === parent.data[keyField]) {
                return true;
            }
        }));
        if (childList && childList.length > 0) {
            childList.forEach((/**
             * @param {?} child
             * @return {?}
             */
            child => {
                /** @type {?} */
                const childEntity = {};
                childEntity.data = child;
                childEntity.children = [];
                parent.children.push(childEntity);
                this.findChildrenByParent(childEntity, datas, parentField, keyField);
            }));
        }
    }
}
SaveAsEditComponent.decorators = [
    { type: Component, args: [{
                selector: 'app-save-as-edit',
                template: "<!-- <div class=\"f-page\">\r\n  <div class=\"f-page-main\">\r\n    <div class=\"d-flex m-2 py-2 farris-row\">\r\n      <div class=\"w-100 px-4\">\r\n        <label class=\"col-form-label\">\r\n          <span class=\"farris-label-text\">\u6D41\u7A0B\u540D\u79F0</span>\r\n        </label>\r\n        <div class=\"farris-input-wrap\">\r\n          <input type=\"text\" class=\"form-control\" [(ngModel)]=\"procName\" name=\"procName\" />\r\n          <div class=\"farris-feedback valid-feedback\"></div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div class=\"d-flex m-2 py-2 farris-row\">\r\n      <div class=\"px-4 w-100\">\r\n        <label class=\"col-form-label\">\r\n          <span class=\"farris-label-text\">\u6D41\u7A0BKey\u503C</span>\r\n        </label>\r\n        <div class=\"farris-input-wrap\">\r\n          <input type=\"text\" class=\"form-control\" [(ngModel)]=\"procKey\" name=\"procKey\" [readonly]=\"true\" />\r\n          <div class=\"farris-feedback valid-feedback\"></div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div> -->\r\n\r\n<div class=\"f-page f-page-card f-page-is-mainsubcard\">\r\n  <section class=\"f-page-main\">\r\n    <!--\u4E0D\u786E\u8BA4---------------------------\u5361\u7247\u7EC4\u4EF6\u4E0D\u540C\u7684Section\u662F\u5728\u4E0D\u540C\u7684\u7EC4\u4EF6\u91CC\uFF0C\u8FD8\u662F\u5728\u540C\u4E00\u4E2A\u5361\u7247\u7EC4\u4EF6\u91CC-->\r\n    <!--\u8868\u5355\u533A\u57DF-->\r\n    <!--\u9700\u8981\u5D4C\u5957\u7684\u5C42---------------------------IDE\u8F6C\u5316\u6210\u7EC4\u4EF6----------->\r\n    <div class=\"f-struct-wrapper\">\r\n      <farris-section class=\"f-section-form f-section-in-mainsubcard\" [enableAccordion]=\"''\" [mainTitle]=\"'\u57FA\u7840\u5C5E\u6027'\"\r\n        [subTitle]=\"''\" [enableMaximize]=\"false\">\r\n\r\n        <!--\u8F93\u5165\u63A7\u4EF6 \u6CA1\u6709\u5206\u7EC4-->\r\n        <div class=\"f-form-layout farris-form farris-form-controls-inline pr-4 m-2\">\r\n          <div class=\"col-12 px-0 my-2\">\r\n            <div class=\"farris-group-wrap\">\r\n              <div class=\"form-group farris-form-group\">\r\n                <label class=\"col-form-label\">\r\n                  <span class=\"farris-label-info text-danger\">*</span>\r\n                  <span class=\"farris-label-text\">\u6D41\u7A0B\u540D\u79F0</span>\r\n                </label>\r\n                <div class=\"farris-input-wrap\">\r\n                  <input type=\"text\" class=\"form-control\" [(ngModel)]=\"procName\" name=\"procName\" />\r\n                  <div class=\"farris-feedback valid-feedback\"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class=\"col-12 px-0 my-2\">\r\n            <div class=\"farris-group-wrap\">\r\n              <div class=\"form-group farris-form-group\">\r\n                <label class=\"col-form-label\">\r\n                  <span class=\"farris-label-text\">\u6D41\u7A0BKey\u503C</span>\r\n                </label>\r\n                <div class=\"farris-input-wrap\">\r\n                  <input type=\"text\" class=\"form-control\" [(ngModel)]=\"procKey\" name=\"procKey\" [readonly]=\"true\" />\r\n                  <div class=\"farris-feedback valid-feedback\"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class=\"col-12 px-0 my-2\">\r\n            <div class=\"farris-group-wrap\">\r\n              <div class=\"form-group farris-form-group\">\r\n                <label class=\"col-form-label\">\r\n                  <span class=\"farris-label-text\">\u7EF4\u62A4\u7EC4\u7EC7</span>\r\n                </label>\r\n                <div class=\"farris-input-wrap\">\r\n                  <farris-lookup-grid #lookup [(ngModel)]=\"organizationName\" name=\"orgName\"\r\n                    [columns]=\"columns\" [items]=\"items\" [singleSelect]=\"true\" [displayType]=\"'TreeList'\"\r\n                    [idField]=\"'id'\" [valueField]=\"'id'\" [textField]=\"'name'\" [dictPicked]=\"dictPicked\"\r\n                    [enableClear]=\"false\" (search)=\"search($event)\" [remoteSearch]=\"false\" [title]=\"'\u7EC4\u7EC7'\"\r\n                    [readonly]=\"!isAdministratorConfig\">\r\n                  </farris-lookup-grid>\r\n                  <div class=\"farris-feedback valid-feedback\"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class=\"col-12 px-0 my-2\">\r\n            <div class=\"farris-group-wrap\">\r\n              <div class=\"form-group farris-form-group\">\r\n                <label class=\"col-form-label\">\r\n                  <span class=\"farris-label-info text-danger\">*</span>\r\n                  <span class=\"farris-label-text\">\u8BBF\u95EE\u7EA7\u522B</span>\r\n                </label>\r\n                <div class=\"farris-input-wrap\">\r\n                  <farris-combo-list [(ngModel)]=\"accessLevel\" name=\"accessLevel\"\r\n                    [ngModelOptions]=\"{standalone: true}\" [idField]=\"'value'\" [textField]=\"'text'\"\r\n                    [valueField]=\"'value'\" [data]=\"accessLevelCollection\" [panelHeight]=\"'auto'\" [enableClear]=\"false\">\r\n                  </farris-combo-list>\r\n                  <div class=\"farris-feedback valid-feedback\"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </farris-section>\r\n    </div>\r\n  </section>\r\n</div>\r\n\r\n<ng-template #buttonRef>\r\n  <button type=\"button\" class=\"btn btn-sm btn-primary mx-2\" (click)=\"saveAsOK()\">\u786E\u5B9A</button>\r\n  <button type=\"button\" class=\"btn btn-secondary btn-sm mx-2\" (click)=\"saveAsCancel()\">\u53D6\u6D88</button>\r\n</ng-template>\r\n",
                styles: [""]
            }] }
];
/** @nocollapse */
SaveAsEditComponent.ctorParameters = () => [];
SaveAsEditComponent.propDecorators = {
    btnRef: [{ type: ViewChild, args: ['buttonRef',] }],
    procName: [{ type: Input }],
    procKey: [{ type: Input }],
    lookUp: [{ type: ViewChild, args: ['lookup',] }],
    submit: [{ type: Output }],
    cancel: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    SaveAsEditComponent.prototype.btnRef;
    /** @type {?} */
    SaveAsEditComponent.prototype.procName;
    /** @type {?} */
    SaveAsEditComponent.prototype.procKey;
    /** @type {?} */
    SaveAsEditComponent.prototype.lookUp;
    /** @type {?} */
    SaveAsEditComponent.prototype.submit;
    /** @type {?} */
    SaveAsEditComponent.prototype.cancel;
    /** @type {?} */
    SaveAsEditComponent.prototype.accessLevel;
    /** @type {?} */
    SaveAsEditComponent.prototype.organization;
    /** @type {?} */
    SaveAsEditComponent.prototype.organizationName;
    /** @type {?} */
    SaveAsEditComponent.prototype.isAdministratorConfig;
    /**
     * @type {?}
     * @private
     */
    SaveAsEditComponent.prototype._organizations;
    /** @type {?} */
    SaveAsEditComponent.prototype.items;
    /** @type {?} */
    SaveAsEditComponent.prototype.accessLevelCollection;
    /** @type {?} */
    SaveAsEditComponent.prototype.columns;
    /** @type {?} */
    SaveAsEditComponent.prototype.dictPicked;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2F2ZS1hcy1lZGl0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc3Atd2Yvd2YtcHJvY2Vzcy1lZGl0b3IvIiwic291cmNlcyI6WyJsaWIvdmlld3Mvc2F2ZS1hcy1lZGl0L3NhdmUtYXMtZWRpdC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsS0FBSyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsU0FBUyxFQUFFLFdBQVcsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUV2RyxPQUFPLEVBQUUsRUFBRSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQzFCLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBT3hELE1BQU0sT0FBTyxtQkFBbUI7SUE2QzlCO1FBbENVLFdBQU0sR0FBRyxJQUFJLFlBQVksRUFBTyxDQUFDO1FBQ2pDLFdBQU0sR0FBRyxJQUFJLFlBQVksRUFBTyxDQUFDO1FBRTNDLGdCQUFXLEdBQUcsUUFBUSxDQUFDO1FBSXZCLDBCQUFxQixHQUFHLEtBQUssQ0FBQztRQWM5QixVQUFLLEdBQUcsSUFBSSxLQUFLLEVBQUUsQ0FBQztRQUVwQiwwQkFBcUIsR0FBRztZQUN0QixFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBQztZQUM5QixFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRTtTQUNqQyxDQUFDO1FBRUYsWUFBTyxHQUFHO1lBQ1IsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxXQUFXLEVBQUUsTUFBTSxFQUFFO1lBQ2pFLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsV0FBVyxFQUFFLE1BQU0sRUFBRTtTQUNsRSxDQUFDO1FBbUNGLGVB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SUFDakIsc0NBQ2dCOztJQUVoQixxQ0FBd0Q7O0lBRXhELHFDQUEyQzs7SUFDM0MscUNBQTJDOztJQUUzQywwQ0FBdUI7O0lBQ3ZCLDJDQUFhOztJQUNiLCtDQUFpQjs7SUFFakIsb0RBQThCOzs7OztJQUU5Qiw2Q0FBOEI7O0lBWTlCLG9DQUFvQjs7SUFFcEIsb0RBR0U7O0lBRUYsc0NBR0U7O0lBbUNGLHlDQUlDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIElucHV0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgVmlld0NoaWxkLCBUZW1wbGF0ZVJlZiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBUcmVlVGFibGVDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLXRyZWV0YWJsZSc7XHJcbmltcG9ydCB7IG9mIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IExvb2t1cEdyaWRDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLWxvb2t1cCc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ2FwcC1zYXZlLWFzLWVkaXQnLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9zYXZlLWFzLWVkaXQuY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsczogWycuL3NhdmUtYXMtZWRpdC5jb21wb25lbnQuc2NzcyddXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBTYXZlQXNFZGl0Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuXHJcbiAgQFZpZXdDaGlsZCgnYnV0dG9uUmVmJykgYnRuUmVmOiBUZW1wbGF0ZVJlZjxhbnk+O1xyXG5cclxuICBASW5wdXQoKVxyXG4gIHByb2NOYW1lOiBzdHJpbmc7XHJcbiAgQElucHV0KClcclxuICBwcm9jS2V5OiBzdHJpbmc7XHJcblxyXG4gIEBWaWV3Q2hpbGQoJ2xvb2t1cCcpIHB1YmxpYyBsb29rVXA6IExvb2t1cEdyaWRDb21wb25lbnQ7XHJcblxyXG4gIEBPdXRwdXQoKSBzdWJtaXQgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuICBAT3V0cHV0KCkgY2FuY2VsID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcblxyXG4gIGFjY2Vzc0xldmVsID0gJ3B1YmxpYyc7XHJcbiAgb3JnYW5pemF0aW9uO1xyXG4gIG9yZ2FuaXphdGlvbk5hbWU7XHJcblxyXG4gIGlzQWRtaW5pc3RyYXRvckNvbmZpZyA9IGZhbHNlO1xyXG5cclxuICBwcml2YXRlIF9vcmdhbml6YXRpb25zOiBhbnlbXTtcclxuICBzZXQgb3JnYW5pemF0aW9ucyhkYXRhOiBhbnlbXSkge1xyXG4gICAgdGhpcy5fb3JnYW5pemF0aW9ucyA9IGRhdGE7XHJcbiAgICBpZiAodGhpcy5fb3JnYW5pemF0aW9ucyAmJiB0aGlzLl9vcmdhbml6YXRpb25zLmxlbmd0aCA+IDApIHtcclxuICAgICAgdGhpcy5pdGVtcyA9IHRoaXMubWFrZVRyZWVCeVBhcmVudCh0aGlzLl9vcmdhbml6YXRpb25zLCAncGFyZW50SWQnLCAnaWQnKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuaXRlbXMgPSBuZXcgQXJyYXkoKTtcclxuICAgIH1cclxuICB9XHJcbiAgZ2V0IG9yZ2FuaXphdGlvbnMoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fb3JnYW5pemF0aW9ucztcclxuICB9XHJcbiAgaXRlbXMgPSBuZXcgQXJyYXkoKTtcclxuXHJcbiAgYWNjZXNzTGV2ZWxDb2xsZWN0aW9uID0gW1xyXG4gICAgeyB2YWx1ZTogJ3B1YmxpYycsIHRleHQ6ICflhazmnIknfSxcclxuICAgIHsgdmFsdWU6ICdwcml2YXRlJywgdGV4dDogJ+engeaciScgfVxyXG4gIF07XHJcblxyXG4gIGNvbHVtbnMgPSBbXHJcbiAgICB7IHRpdGxlOiAn57yW5Y+3JywgZmllbGQ6ICdjb2RlJywgd2lkdGg6ICcxMDAnLCBzZWFyY2hGaWVsZDogJ2NvZGUnIH0sXHJcbiAgICB7IHRpdGxlOiAn5ZCN56ewJywgZmllbGQ6ICduYW1lJywgd2lkdGg6ICcxMDAnLCBzZWFyY2hGaWVsZDogJ25hbWUnIH0sXHJcbiAgXTtcclxuXHJcblxyXG4gIGNvbnN0cnVjdG9yKCkge31cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgfVxyXG4gIHNhdmVBc09LKCkge1xyXG4gICAgaWYgKHRoaXMudmFsaWRhdG9yKCkpIHtcclxuICAgICAgdGhpcy5zdWJtaXQubmV4dCh7XHJcbiAgICAgICAgcHJvY05hbWU6IHRoaXMucHJvY05hbWUsXHJcbiAgICAgICAgYWNjZXNzTGV2ZWw6IHRoaXMuYWNjZXNzTGV2ZWwsXHJcbiAgICAgICAgb3JnYW5pemF0aW9uOiB0aGlzLm9yZ2FuaXphdGlvbixcclxuICAgICAgICBvcmdhbml6YXRpb25OYW1lOiB0aGlzLm9yZ2FuaXphdGlvbk5hbWVcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIHNhdmVBc0NhbmNlbCgpIHtcclxuICAgIHRoaXMuY2FuY2VsLmVtaXQoKTtcclxuICB9XHJcblxyXG4gIHZhbGlkYXRvcigpIHtcclxuICAgIHJldHVybiB0cnVlO1xyXG4gIH1cclxuXHJcbiAgc2VhcmNoKGRhdGE6IGFueSkge1xyXG4gICAgY29uc3QgdHQgPSB0aGlzLmxvb2tVcC5jb21wb25lbnRSZWYuaW5zdGFuY2UgYXMgVHJlZVRhYmxlQ29tcG9uZW50O1xyXG4gICAgdHQuc2VhcmNoSGFuZGxlLnNlYXJjaChkYXRhLmZpZWxkLCBkYXRhLnZhbHVlLCAnY2xpZW50Jyk7XHJcbiAgICAvLyBpZiAoZGF0YS5maWVsZCA9PT0gJyonKSB7XHJcbiAgICAvLyAgIHRoaXMub3JnYW5pemF0aW9ucyA9IHRoaXMub3JnYW5pemF0aW9ucy5maWx0ZXIobyA9PiBvLmNvZGUuaW5kZXhPZihkYXRhLnZhbHVlKSA+IC0xIHx8IG8ubmFtZS5pbmRleE9mKGRhdGEudmFsdWUpID4gLTEpO1xyXG4gICAgLy8gfSBlbHNlIHtcclxuICAgIC8vICAgdGhpcy5vcmdhbml6YXRpb25zID0gdGhpcy5vcmdhbml6YXRpb25zLmZpbHRlcihvID0+IG9bZGF0YS5maWVsZF0uaW5kZXhPZihkYXRhLnZhbHVlKSA+IC0xKTtcclxuICAgIC8vIH1cclxuICB9XHJcblxyXG4gIGRpY3RQaWNrZWQgPSAoZGF0YTogYW55KSA9PiB7XHJcbiAgICB0aGlzLm9yZ2FuaXphdGlvbk5hbWUgPSBkYXRhLm5hbWU7XHJcbiAgICB0aGlzLm9yZ2FuaXphdGlvbiA9IGRhdGEuaWQ7XHJcbiAgICByZXR1cm4gb2YodHJ1ZSk7XHJcbiAgfVxyXG5cclxuICAvKiog5oyJ54WncGFyZW5056CB5p6E6YCg5qCRICovXHJcbiAgcHJpdmF0ZSBtYWtlVHJlZUJ5UGFyZW50KGRhdGFzOiBhbnlbXSwgcGFyZW50RmllbGQ6IHN0cmluZywga2V5RmllbGQ6IHN0cmluZyk6IGFueVtdIHtcclxuICAgIC8vIOS4iue0mueIsuepuu+8jOaIluiAheaykuacieS4iue0mueahFxyXG4gICAgY29uc3QgcGF0aExheWVyT25lcyA9IGRhdGFzLmZpbHRlcih4ID0+IHtcclxuICAgICAgaWYgKCF4W3BhcmVudEZpZWxkXSkge1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9XHJcbiAgICAgIGNvbnN0IHAgPSBkYXRhcy5maW5kKHBhcmVudCA9PiBwYXJlbnRba2V5RmllbGRdID09PSB4W3BhcmVudEZpZWxkXSk7XHJcbiAgICAgIGlmICghcCkge1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIGNvbnN0IHRyZWVkYXRhID0gW107XHJcbiAgICBwYXRoTGF5ZXJPbmVzLmZvckVhY2goeCA9PiB7XHJcbiAgICAgIGNvbnN0IGVudGl0eTogYW55ID0ge307XHJcbiAgICAgIGVudGl0eS5kYXRhID0geDtcclxuICAgICAgZW50aXR5LmNoaWxkcmVuID0gW107XHJcbiAgICAgIHRyZWVkYXRhLnB1c2goZW50aXR5KTtcclxuICAgICAgLy8gdGhpcy5yb290ID0geFsnaWQnXTtcclxuICAgIH0pO1xyXG4gICAgdHJlZWRhdGEuZm9yRWFjaChpdGVtID0+IHtcclxuICAgICAgdGhpcy5maW5kQ2hpbGRyZW5CeVBhcmVudChpdGVtLCBkYXRhcywgcGFyZW50RmllbGQsIGtleUZpZWxkKTtcclxuICAgIH1cclxuICAgICk7XHJcbiAgICByZXR1cm4gdHJlZWRhdGE7XHJcbiAgfVxyXG5cclxuICAvKiog5om+5Yiw5a2Q6IqC54K5ICovXHJcbiAgcHJpdmF0ZSBmaW5kQ2hpbGRyZW5CeVBhcmVudChwYXJlbnQ6IGFueSwgZGF0YXM6IGFueVtdLCBwYXJlbnRGaWVsZDogc3RyaW5nLCBrZXlGaWVsZDogc3RyaW5nKSB7XHJcbiAgICBjb25zdCBjaGlsZExpc3QgPSBkYXRhcy5maWx0ZXIoY2hpbGRpdGVtID0+IHtcclxuICAgICAgaWYgKGNoaWxkaXRlbVtwYXJlbnRGaWVsZF0gPT09IHBhcmVudC5kYXRhW2tleUZpZWxkXSkge1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIGlmIChjaGlsZExpc3QgJiYgY2hpbGRMaXN0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgY2hpbGRMaXN0LmZvckVhY2goY2hpbGQgPT4ge1xyXG4gICAgICAgIGNvbnN0IGNoaWxkRW50aXR5OiBhbnkgPSB7fTtcclxuICAgICAgICBjaGlsZEVudGl0eS5kYXRhID0gY2hpbGQ7XHJcbiAgICAgICAgY2hpbGRFbnRpdHkuY2hpbGRyZW4gPSBbXTtcclxuICAgICAgICBwYXJlbnQuY2hpbGRyZW4ucHVzaChjaGlsZEVudGl0eSk7XHJcbiAgICAgICAgdGhpcy5maW5kQ2hpbGRyZW5CeVBhcmVudChjaGlsZEVudGl0eSwgZGF0YXMsIHBhcmVudEZpZWxkLCBrZXlGaWVsZCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG4iXX0=