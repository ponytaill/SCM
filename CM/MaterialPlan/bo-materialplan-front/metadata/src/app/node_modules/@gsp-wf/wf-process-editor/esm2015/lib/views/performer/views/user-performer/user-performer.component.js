/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, HostBinding, ViewChild, Injector, NgZone, ElementRef } from '@angular/core';
import { SysFarrisLookupComponent } from '@gsp-sys/sysmgr-ui';
import { ProcessDesignerUIState } from '../../../../app/process-designer.uistate';
import { ExprEditMode, ExpressionService, InjectedType } from '@gsp-svc/expression';
import { UserPerformerEntity } from '../../entities/user-performer.entity';
import { PerformerConfigService } from '../../performer-config.service';
import { HttpService } from '@ecp-caf/caf-common';
import { MessagerService } from "@farris/ui-messager";
export class UserPerformerComponent {
    /**
     * @param {?} designerUIState
     * @param {?} expr
     * @param {?} injector
     * @param {?} lookupConfig
     * @param {?} ngZone
     * @param {?=} http
     * @param {?=} message
     */
    constructor(designerUIState, expr, injector, lookupConfig, ngZone, http, message) {
        this.designerUIState = designerUIState;
        this.expr = expr;
        this.injector = injector;
        this.lookupConfig = lookupConfig;
        this.ngZone = ngZone;
        this.http = http;
        this.message = message;
        this.cls = 'd-flex flex-fill h-100';
        this.showClearButton = false;
        this.bindingData = {};
        this.userTypeCollection = [
            { text: '固定用户', value: 'user' },
            { text: '变量参与者', value: 'variable' }
        ];
        this.userType = this.userTypeCollection[0].value;
        this.variableOrgTypes = [
            { name: '系统用户', value: 'Sys' },
            { name: '行政人员', value: 'Administrative_organization' }
        ];
        this.curOrgType = this.variableOrgTypes[0].value;
        this.hasAdminOrg = false;
        this.userTypeButtonNeedShow = false; // 用户类型单选按钮是否需要显示
        this.users = [];
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        /** @type {?} */
        let url = '/api/runtime/wf/v1.0/reportingOrgType/hasAdminOrg';
        this.http.get(url).subscribe((/**
         * @param {?} data
         * @return {?}
         */
        (data) => {
            this.hasAdminOrg = data;
        }));
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        this.ngZone.runOutsideAngular((/**
         * @return {?}
         */
        () => {
            this.inputGroup.nativeElement.addEventListener('mouseenter', this.onMouseEnter.bind(this));
            this.inputGroup.nativeElement.addEventListener('mouseleave', this.onMouseLeave.bind(this));
        }));
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onMouseEnter(event) {
        this.showClearButton = true;
        if (this.showClearButton) {
            this.toggleClearIcon(event, true);
        }
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onMouseLeave(event) {
        this.showClearButton = false;
        this.toggleClearIcon(event, false);
    }
    /**
     * @private
     * @param {?} event
     * @param {?=} isShow
     * @return {?}
     */
    toggleClearIcon(event, isShow = false) {
        /** @type {?} */
        const str = isShow ? '' : 'none';
        /** @type {?} */
        const clearIcon = event.target.querySelector('.input-group-clear');
        if (clearIcon) {
            clearIcon.style.display = str;
        }
    }
    /**
     * @param {?} data
     * @return {?}
     */
    userTypeChange(data) {
        // 切换类型时，清空users
        this.users = [];
        // 切换类型时，人员类型自动切换成系统用户
        this.orgTypeChange('Sys');
        // 有行政帮助并且切换到变量参与者才显示
        this.userTypeButtonNeedShow = this.hasAdminOrg && data.data.value === 'variable';
    }
    /**
     * @param {?} data
     * @return {?}
     */
    clear(data) {
        this.bindingData = {};
        this.users = [];
        this.variableOrgTypes = [
            { name: '系统用户', value: 'Sys' },
            { name: '行政人员', value: 'Administrative_organization' }
        ];
    }
    /**
     * @param {?} data
     * @return {?}
     */
    selectUsers(data) {
        // 固定用户
        if (this.userType === this.userTypeCollection[0].value) {
            this.lookupConfig.getLookupConfig().subscribe((/**
             * @param {?} re
             * @return {?}
             */
            re => {
                // 项目配置了自己的帮助时
                if (re.user && re.user.impl) {
                    System.import(re.user.impl)
                        .then((/**
                     * @param {?} moduleFactorys
                     * @return {?}
                     */
                    (moduleFactorys) => {
                        /** @type {?} */
                        const moduleFactory = Object.values(moduleFactorys)[0];
                        /** @type {?} */
                        const moduleRef = moduleFactory.create(this.injector);
                        moduleRef.instance.showHelp().subscribe((/**
                         * @param {?} data
                         * @return {?}
                         */
                        data => {
                            if (data && data.length > 0) {
                                this.users = data.map((/**
                                 * @param {?} u
                                 * @return {?}
                                 */
                                u => {
                                    /** @type {?} */
                                    const user = new UserPerformerEntity(u.id, u.name, 'wf.UserParticipant');
                                    user.orgId = u.orgId;
                                    user.orgName = u.orgName;
                                    user.userType = this.userTypeCollection[0].value;
                                    return user;
                                }));
                            }
                        }));
                    }));
                }
                else { // 加载默认帮助
                    this.userHelp.showHelp();
                }
            }));
        }
        else {
            this.showExprHelp();
        }
    }
    /**
     * @return {?}
     */
    editConditon() {
        if (this.designerUIState.schemas.length > 0) {
            for (const schema of this.designerUIState.schemas) {
                this.expr.addSchema('Schema', schema);
            }
            if (this.designerUIState.schemas[0].entityTypes && this.designerUIState.schemas[0].entityTypes.length > 0) {
                /** @type {?} */
                const entityType = this.designerUIState.schemas[0].entityTypes[0];
                this.expr.addInjectedEntity(entityType.name, 'Schema', entityType.name, InjectedType.EntityType);
            }
        }
        /** @type {?} */
        const context = new Array();
        if (this.designerUIState.procInstContext.length > 0) {
            for (const variable of this.designerUIState.procInstContext) {
                context.push(variable);
            }
        }
        if (this.designerUIState.formalParameterContext.length > 0) {
            for (const variable of this.designerUIState.formalParameterContext) {
                if (!context.some((/**
                 * @param {?} c
                 * @return {?}
                 */
                c => c.key === variable.key))) {
                    context.push(variable);
                }
            }
        }
        if (this.designerUIState.participantContext.length > 0) {
            for (const variable of this.designerUIState.participantContext) {
                if (!context.some((/**
                 * @param {?} c
                 * @return {?}
                 */
                c => c.key === variable.key))) {
                    context.push(variable);
                }
            }
        }
        if (this.designerUIState.processVariableContext.length > 0) {
            for (const variable of this.designerUIState.processVariableContext) {
                if (!context.some((/**
                 * @param {?} c
                 * @return {?}
                 */
                c => c.key === variable.key))) {
                    context.push(variable);
                }
            }
        }
        if (this.designerUIState.activityComponentContext.length > 0) {
            for (const variable of this.designerUIState.activityComponentContext) {
                if (!context.some((/**
                 * @param {?} c
                 * @return {?}
                 */
                c => c.key === variable.key))) {
                    context.push(variable);
                }
            }
        }
        if (context.length > 0) {
            for (const v of context) {
                this.expr.addContext(v);
            }
        }
        this.expr.setEditPattern(ExprEditMode.Conditional); // 表达式展现模式：默认简易版
        this.expr.addExpressionText(this.condition);
        this.expr.buildExpression().then((/**
         * @param {?} expressioninfo
         * @return {?}
         */
        (expressioninfo) => {
            this.condition = expressioninfo;
        }));
    }
    /**
     * @param {?} data
     * @return {?}
     */
    usersSelect(data) {
        this.users = data.map((/**
         * @param {?} u
         * @return {?}
         */
        u => {
            /** @type {?} */
            const user = new UserPerformerEntity(u.id, u.name, 'wf.UserParticipant');
            user.orgId = u.sysOrgId;
            user.orgName = u.sysOrgName;
            user.userType = this.userTypeCollection[0].value;
            return user;
        }));
    }
    /**
     * @return {?}
     */
    showExprHelp() {
        if (this.designerUIState.schemas.length > 0) {
            for (const schema of this.designerUIState.schemas) {
                this.expr.addSchema('Schema', schema);
            }
            if (this.designerUIState.schemas[0].entityTypes && this.designerUIState.schemas[0].entityTypes.length > 0) {
                /** @type {?} */
                const entityType = this.designerUIState.schemas[0].entityTypes[0];
                this.expr.addInjectedEntity(entityType.name, 'Schema', entityType.name, InjectedType.EntityType);
            }
        }
        /** @type {?} */
        const context = new Array();
        if (this.designerUIState.participantContext.length > 0) {
            for (const variable of this.designerUIState.participantContext) {
                context.push(variable);
            }
        }
        if (this.designerUIState.processVariableContext.length > 0) {
            for (const variable of this.designerUIState.processVariableContext) {
                if (!context.some((/**
                 * @param {?} c
                 * @return {?}
                 */
                c => c.key === variable.key))) {
                    context.push(variable);
                }
            }
        }
        if (context.length > 0) {
            for (const v of context) {
                this.expr.addContext(v);
            }
        }
        if (this.users.length > 0) {
            this.expr.addExpressionText(this.users[0].performerId);
        }
        else {
            this.expr.addExpressionText('');
        }
        this.expr.buildExpression().then((/**
         * @param {?} expressioninfo
         * @return {?}
         */
        (expressioninfo) => {
            /** @type {?} */
            const user = new UserPerformerEntity(expressioninfo, '', 'wf.UserParticipant');
            user.tag = 'expression';
            user.performerName = this.variableParticipantName(expressioninfo);
            user.userType = this.userTypeCollection[1].value;
            if (this.variableParticipantName(expressioninfo) === '') {
                this.message.error('行政人员类型不能使用上下文变量');
                this.users = [];
            }
            else {
                this.users = [user];
            }
            if (user.performerId.indexOf("GetContextParameter") >= 0) { // 根据表达式中的函数名判断是否使用的是上下文变量
                this.variableOrgTypes = [
                    { name: '系统用户', value: 'Sys' }
                ];
            }
            else {
                this.variableOrgTypes = [
                    { name: '系统用户', value: 'Sys' },
                    { name: '行政人员', value: 'Administrative_organization' }
                ];
            }
        }));
    }
    /**
     * @return {?}
     */
    getPerformers() {
        this.users.map((/**
         * @param {?} user
         * @return {?}
         */
        user => {
            if (user.orgId === undefined) {
                user.orgType = this.curOrgType;
                return user;
            }
        }));
        if (this.condition) {
            this.users = this.users.map((/**
             * @param {?} user
             * @return {?}
             */
            user => {
                user.condition = this.condition;
                return user;
            }));
        }
        return this.users;
    }
    /**
     * @private
     * @param {?} expr
     * @return {?}
     */
    variableParticipantName(expr) {
        for (const c of this.designerUIState.participantContext) {
            if (expr.indexOf(c.key) > -1) {
                if (this.curOrgType !== 'Sys') { // 行政人员类型不允许使用上下文变量
                    return '';
                }
                return c.name;
            }
        }
        for (const c of this.designerUIState.processVariableContext) {
            if (expr.indexOf(c.key) > -1) {
                return c.name;
            }
        }
        return '业务字段';
    }
    /**
     * @param {?} data
     * @return {?}
     */
    orgTypeChange(data) {
        if (data === 'Sys') {
            this.curOrgType = this.variableOrgTypes[0].value;
        }
        else {
            this.curOrgType = this.variableOrgTypes[1].value;
        }
    }
}
UserPerformerComponent.decorators = [
    { type: Component, args: [{
                selector: 'app-user-performer',
                template: "<div class=\"d-flex flex-fill farris-overflow-y-auto p-md-2\">\r\n  <form style=\"background: #F0F3F6; width: 100%;\" >\r\n    <div class=\"d-flex m-2 flex-column w-100\">\r\n      <div class=\"d-flex flex-column mx-5 my-4\" style=\"background: #FFF;\">\r\n        <div class=\"farris-form form-inline  farris-form-inline mr-5 my-2\">\r\n          <div class=\"col-12 farris-group-auto my-4\">\r\n            <div class=\"farris-group-wrap\">\r\n              <div class=\"form-group farris-form-group\">\r\n                <label class=\"col-form-label\">\r\n                  <span class=\"farris-label-info text-danger\">*</span>\r\n                  <span class=\"farris-label-text\">\u7528\u6237\u7C7B\u578B</span>\r\n                </label>\r\n                <div class=\"farris-input-wrap\">\r\n                  <farris-combo-list [(ngModel)]=\"userType\" name=\"userType\" [idField]=\"'value'\" [textField]=\"'text'\"\r\n                    [valueField]=\"'value'\" [data]=\"userTypeCollection\" [panelHeight]=\"60\" (selectChange)='userTypeChange($event)'>\r\n                  </farris-combo-list>\r\n                  <div class=\"farris-feedback valid-feedback\"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class=\"col-12 farris-group-auto my-4\">\r\n            <div class=\"farris-group-wrap\">\r\n              <div class=\"form-group farris-form-group\">\r\n                <label class=\"col-form-label\">\r\n                  <span class=\"farris-label-info text-danger\">*</span>\r\n                  <span class=\"farris-label-text\">\u7528\u6237</span>\r\n                </label>\r\n                <div class=\"farris-input-wrap\">\r\n                  <div #inputGroup class=\"input-group\">\r\n                    <input type=\"text\" class=\"form-control\" [value]=\"users | usersName \" name=\"users\" [readOnly]=\"true\" />\r\n                    <div class=\"input-group-append\">\r\n                      <span [style.display]=\"showClearButton ? '' : 'none'\" class=\"input-group-text input-group-clear\"\r\n                        (click)=\"clear($event)\">\r\n                        <i class=\"f-icon modal_close\"></i>\r\n                      </span>\r\n                      <span class=\"input-group-text\" (click)=\"selectUsers($event)\" style=\"background: #FFF;\">\r\n                        <i class=\"f-icon f-icon-lookup\"></i>\r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n                  <div class=\"farris-feedback valid-feedback\"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class=\"col-12 farris-group-auto my-4\" [ngStyle]=\"{'visibility' : userTypeButtonNeedShow ? 'visible' : 'hidden'}\">\r\n            <div class=\"farris-group-wrap\">\r\n              <div class=\"form-group farris-form-group\">\r\n                <label class=\"col-form-label\">\r\n                  <span class=\"farris-label-info text-danger\">*</span>\r\n                  <span class=\"farris-label-text\">\u4EBA\u5458\u7C7B\u578B</span>\r\n                </label>\r\n                <div class=\"farris-input-wrap\">\r\n                  <farris-radiogroup [data]=\"variableOrgTypes\" [horizontal]=\"true\"\r\n                                     [(ngModel)]=\"curOrgType\" name=\"referObject\"\r\n                                     (changeValue)=\"orgTypeChange($event)\"\r\n                  ></farris-radiogroup>\r\n                  <div class=\"farris-feedback valid-feedback\"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class=\"d-flex flex-column mx-5\" style=\"background: #FFF;\">\r\n        <div class=\"farris-form form-inline farris-form-inline mr-5\">\r\n          <div class=\"col-12 farris-group-auto my-4\">\r\n            <div class=\"farris-group-wrap\">\r\n              <div class=\"form-group farris-form-group\">\r\n                <label class=\"col-form-label\">\r\n                  <span class=\"farris-label-text\">\u542F\u7528\u6761\u4EF6</span>\r\n                </label>\r\n                <div class=\"farris-input-wrap\">\r\n                  <div class=\"input-group\">\r\n                    <input type=\"text\" class=\"form-control\" [(ngModel)]=\"condition\" name=\"conditon\" [readOnly]=\"true\" />\r\n                    <div class=\"input-group-append\">\r\n                      <span class=\"input-group-text\" (click)=\"editConditon()\" style=\"background: #FFF;\">\r\n                        <i class=\"f-icon f-icon-lookup\"></i>\r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n                  <div class=\"farris-feedback valid-feedback\"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </form>\r\n</div>\r\n\r\n<sys-farris-grid-lookup #userHelp style=\"display: none;\" [singleSelect]=\"false\" [displayTxt]=\"bindingData.name\"\r\n  [pagination]=\"true\" [pageSize]=\"20\" [title]=\"'\u7CFB\u7EDF\u7528\u6237'\" [sourceType]=\"'user'\" (afterConfirm)=\"usersSelect($event)\"\r\n  [bindingData]=\"bindingData\" [filter]=\"{notGetCurrentUser:false}\" [typeMode]=\"1\">\r\n</sys-farris-grid-lookup>\r\n",
                styles: [""]
            }] }
];
/** @nocollapse */
UserPerformerComponent.ctorParameters = () => [
    { type: ProcessDesignerUIState },
    { type: ExpressionService },
    { type: Injector },
    { type: PerformerConfigService },
    { type: NgZone },
    { type: HttpService },
    { type: MessagerService }
];
UserPerformerComponent.propDecorators = {
    cls: [{ type: HostBinding, args: ['class',] }],
    userHelp: [{ type: ViewChild, args: [SysFarrisLookupComponent,] }],
    inputGroup: [{ type: ViewChild, args: ['inputGroup',] }]
};
if (false) {
    /** @type {?} */
    UserPerformerComponent.prototype.cls;
    /** @type {?} */
    UserPerformerComponent.prototype.userHelp;
    /** @type {?} */
    UserPerformerComponent.prototype.inputGroup;
    /** @type {?} */
    UserPerformerComponent.prototype.showClearButton;
    /** @type {?} */
    UserPerformerComponent.prototype.bindingData;
    /** @type {?} */
    UserPerformerComponent.prototype.userTypeCollection;
    /** @type {?} */
    UserPerformerComponent.prototype.userType;
    /** @type {?} */
    UserPerformerComponent.prototype.variableOrgTypes;
    /** @type {?} */
    UserPerformerComponent.prototype.curOrgType;
    /** @type {?} */
    UserPerformerComponent.prototype.hasAdminOrg;
    /** @type {?} */
    UserPerformerComponent.prototype.userTypeButtonNeedShow;
    /** @type {?} */
    UserPerformerComponent.prototype.condition;
    /** @type {?} */
    UserPerformerComponent.prototype.users;
    /**
     * @type {?}
     * @private
     */
    UserPerformerComponent.prototype.designerUIState;
    /**
     * @type {?}
     * @private
     */
    UserPerformerComponent.prototype.expr;
    /**
     * @type {?}
     * @private
     */
    UserPerformerComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    UserPerformerComponent.prototype.lookupConfig;
    /**
     * @type {?}
     * @private
     */
    UserPerformerComponent.prototype.ngZone;
    /**
     * @type {?}
     * @private
     */
    UserPerformerComponent.prototype.http;
    /**
     * @type {?}
     * @private
     */
    UserPerformerComponent.prototype.message;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXNlci1wZXJmb3JtZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdzcC13Zi93Zi1wcm9jZXNzLWVkaXRvci8iLCJzb3VyY2VzIjpbImxpYi92aWV3cy9wZXJmb3JtZXIvdmlld3MvdXNlci1wZXJmb3JtZXIvdXNlci1wZXJmb3JtZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLFdBQVcsRUFBRSxTQUFTLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBaUIsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3ZILE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQzlELE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLDBDQUEwQyxDQUFDO0FBQ2xGLE9BQU8sRUFBRSxZQUFZLEVBQUUsaUJBQWlCLEVBQUUsWUFBWSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDcEYsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sc0NBQXNDLENBQUM7QUFDM0UsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFDeEUsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ2xELE9BQU8sRUFBQyxlQUFlLEVBQUMsTUFBTSxxQkFBcUIsQ0FBQztBQVFwRCxNQUFNLE9BQU8sc0JBQXNCOzs7Ozs7Ozs7O0lBMEJqQyxZQUNVLGVBQXVDLEVBQ3ZDLElBQXVCLEVBQ3ZCLFFBQWtCLEVBQ2xCLFlBQW9DLEVBQ3BDLE1BQWMsRUFDZCxJQUFrQixFQUNsQixPQUF5QjtRQU56QixvQkFBZSxHQUFmLGVBQWUsQ0FBd0I7UUFDdkMsU0FBSSxHQUFKLElBQUksQ0FBbUI7UUFDdkIsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUNsQixpQkFBWSxHQUFaLFlBQVksQ0FBd0I7UUFDcEMsV0FBTSxHQUFOLE1BQU0sQ0FBUTtRQUNkLFNBQUksR0FBSixJ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MUIseUNBQWlDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIEhvc3RCaW5kaW5nLCBWaWV3Q2hpbGQsIEluamVjdG9yLCBOZ1pvbmUsIEFmdGVyVmlld0luaXQsIEVsZW1lbnRSZWYgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgU3lzRmFycmlzTG9va3VwQ29tcG9uZW50IH0gZnJvbSAnQGdzcC1zeXMvc3lzbWdyLXVpJztcclxuaW1wb3J0IHsgUHJvY2Vzc0Rlc2lnbmVyVUlTdGF0ZSB9IGZyb20gJy4uLy4uLy4uLy4uL2FwcC9wcm9jZXNzLWRlc2lnbmVyLnVpc3RhdGUnO1xyXG5pbXBvcnQgeyBFeHByRWRpdE1vZGUsIEV4cHJlc3Npb25TZXJ2aWNlLCBJbmplY3RlZFR5cGUgfSBmcm9tICdAZ3NwLXN2Yy9leHByZXNzaW9uJztcclxuaW1wb3J0IHsgVXNlclBlcmZvcm1lckVudGl0eSB9IGZyb20gJy4uLy4uL2VudGl0aWVzL3VzZXItcGVyZm9ybWVyLmVudGl0eSc7XHJcbmltcG9ydCB7IFBlcmZvcm1lckNvbmZpZ1NlcnZpY2UgfSBmcm9tICcuLi8uLi9wZXJmb3JtZXItY29uZmlnLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBIdHRwU2VydmljZSB9IGZyb20gJ0BlY3AtY2FmL2NhZi1jb21tb24nO1xyXG5pbXBvcnQge01lc3NhZ2VyU2VydmljZX0gZnJvbSBcIkBmYXJyaXMvdWktbWVzc2FnZXJcIjtcclxuXHJcbmRlY2xhcmUgdmFyIFN5c3RlbTogYW55O1xyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ2FwcC11c2VyLXBlcmZvcm1lcicsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL3VzZXItcGVyZm9ybWVyLmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi91c2VyLXBlcmZvcm1lci5jb21wb25lbnQuc2NzcyddXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBVc2VyUGVyZm9ybWVyQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0IHtcclxuICBASG9zdEJpbmRpbmcoJ2NsYXNzJylcclxuICBjbHMgPSAnZC1mbGV4IGZsZXgtZmlsbCBoLTEwMCc7XHJcblxyXG4gIEBWaWV3Q2hpbGQoU3lzRmFycmlzTG9va3VwQ29tcG9uZW50KSB1c2VySGVscDogU3lzRmFycmlzTG9va3VwQ29tcG9uZW50O1xyXG5cclxuICBAVmlld0NoaWxkKCdpbnB1dEdyb3VwJykgaW5wdXRHcm91cDogRWxlbWVudFJlZjtcclxuICBzaG93Q2xlYXJCdXR0b24gPSBmYWxzZTtcclxuXHJcbiAgYmluZGluZ0RhdGE6IHsgaWQ/LCBuYW1lP30gPSB7fTtcclxuXHJcbiAgdXNlclR5cGVDb2xsZWN0aW9uID0gW1xyXG4gICAgeyB0ZXh0OiAn5Zu65a6a55So5oi3JywgdmFsdWU6ICd1c2VyJyB9LFxyXG4gICAgeyB0ZXh0OiAn5Y+Y6YeP5Y+C5LiO6ICFJywgdmFsdWU6ICd2YXJpYWJsZScgfVxyXG4gIF07XHJcbiAgdXNlclR5cGUgPSB0aGlzLnVzZXJUeXBlQ29sbGVjdGlvblswXS52YWx1ZTtcclxuICB2YXJpYWJsZU9yZ1R5cGVzID0gW1xyXG4gICAgeyBuYW1lOiAn57O757uf55So5oi3JywgdmFsdWU6ICdTeXMnIH0sXHJcbiAgICB7IG5hbWU6ICfooYzmlL/kurrlkZgnLCB2YWx1ZTogJ0FkbWluaXN0cmF0aXZlX29yZ2FuaXphdGlvbicgfVxyXG4gIF07XHJcbiAgY3VyT3JnVHlwZSA9IHRoaXMudmFyaWFibGVPcmdUeXBlc1swXS52YWx1ZTtcclxuICBoYXNBZG1pbk9yZyA9IGZhbHNlO1xyXG4gIHVzZXJUeXBlQnV0dG9uTmVlZFNob3cgPSBmYWxzZTsgLy8g55So5oi357G75Z6L5Y2V6YCJ5oyJ6ZKu5piv5ZCm6ZyA6KaB5pi+56S6XHJcblxyXG4gIGNvbmRpdGlvbjogc3RyaW5nO1xyXG4gIHVzZXJzOiBVc2VyUGVyZm9ybWVyRW50aXR5W10gPSBbXTtcclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgZGVzaWduZXJVSVN0YXRlOiBQcm9jZXNzRGVzaWduZXJVSVN0YXRlLFxyXG4gICAgcHJpdmF0ZSBleHByOiBFeHByZXNzaW9uU2VydmljZSxcclxuICAgIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yLFxyXG4gICAgcHJpdmF0ZSBsb29rdXBDb25maWc6IFBlcmZvcm1lckNvbmZpZ1NlcnZpY2UsXHJcbiAgICBwcml2YXRlIG5nWm9uZTogTmdab25lLFxyXG4gICAgcHJpdmF0ZSBodHRwPzogSHR0cFNlcnZpY2UsXHJcbiAgICBwcml2YXRlIG1lc3NhZ2U/OiBNZXNzYWdlclNlcnZpY2UsXHJcbiAgKSB7IH1cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICBsZXQgdXJsID0gJy9hcGkvcnVudGltZS93Zi92MS4wL3JlcG9ydGluZ09yZ1R5cGUvaGFzQWRtaW5PcmcnO1xyXG4gICAgdGhpcy5odHRwLmdldCh1cmwpLnN1YnNjcmliZSgoZGF0YTogYW55KSA9PiB7XHJcbiAgICAgIHRoaXMuaGFzQWRtaW5PcmcgPSBkYXRhO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBuZ0FmdGVyVmlld0luaXQoKTogdm9pZCB7XHJcbiAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XHJcbiAgICAgIHRoaXMuaW5wdXRHcm91cC5uYXRpdmVFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXHJcbiAgICAgICAgJ21vdXNlZW50ZXInLFxyXG4gICAgICAgIHRoaXMub25Nb3VzZUVudGVyLmJpbmQodGhpcylcclxuICAgICAgKTtcclxuICAgICAgdGhpcy5pbnB1dEdyb3VwLm5hdGl2ZUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcclxuICAgICAgICAnbW91c2VsZWF2ZScsXHJcbiAgICAgICAgdGhpcy5vbk1vdXNlTGVhdmUuYmluZCh0aGlzKVxyXG4gICAgICApO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBvbk1vdXNlRW50ZXIoZXZlbnQpIHtcclxuICAgIHRoaXMuc2hvd0NsZWFyQnV0dG9uID0gdHJ1ZTtcclxuICAgIGlmICh0aGlzLnNob3dDbGVhckJ1dHRvbikge1xyXG4gICAgICB0aGlzLnRvZ2dsZUNsZWFySWNvbihldmVudCwgdHJ1ZSk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIG9uTW91c2VMZWF2ZShldmVudCkge1xyXG4gICAgdGhpcy5zaG93Q2xlYXJCdXR0b24gPSBmYWxzZTtcclxuICAgIHRoaXMudG9nZ2xlQ2xlYXJJY29uKGV2ZW50LCBmYWxzZSk7XHJcbiAgfVxyXG4gIHByaXZhdGUgdG9nZ2xlQ2xlYXJJY29uKGV2ZW50OiBhbnksIGlzU2hvdyA9IGZhbHNlKSB7XHJcbiAgICBjb25zdCBzdHIgPSBpc1Nob3cgPyAnJyA6ICdub25lJztcclxuICAgIGNvbnN0IGNsZWFySWNvbiA9IGV2ZW50LnRhcmdldC5xdWVyeVNlbGVjdG9yKCcuaW5wdXQtZ3JvdXAtY2xlYXInKTtcclxuICAgIGlmIChjbGVhckljb24pIHtcclxuICAgICAgY2xlYXJJY29uLnN0eWxlLmRpc3BsYXkgPSBzdHI7XHJcbiAgICB9XHJcbiAgfVxyXG4gIHVzZXJUeXBlQ2hhbmdlKGRhdGEpIHtcclxuICAgIC8vIOWIh+aNouexu+Wei+aXtu+8jOa4heepunVzZXJzXHJcbiAgICB0aGlzLnVzZXJzID0gW107XHJcbiAgICAvLyDliIfmjaLnsbvlnovml7bvvIzkurrlkZjnsbvlnovoh6rliqjliIfmjaLmiJDns7vnu5/nlKjmiLdcclxuICAgIHRoaXMub3JnVHlwZUNoYW5nZSgnU3lzJyk7XHJcbiAgICAvLyDmnInooYzmlL/luK7liqnlubbkuJTliIfmjaLliLDlj5jph4/lj4LkuI7ogIXmiY3mmL7npLpcclxuICAgIHRoaXMudXNlclR5cGVCdXR0b25OZWVkU2hvdyA9IHRoaXMuaGFzQWRtaW5PcmcgJiYgZGF0YS5kYXRhLnZhbHVlID09PSAndmFyaWFibGUnO1xyXG4gIH1cclxuICBjbGVhcihkYXRhOiBhbnkpIHtcclxuICAgIHRoaXMuYmluZGluZ0RhdGEgPSB7fTtcclxuICAgIHRoaXMudXNlcnMgPSBbXTtcclxuICAgIHRoaXMudmFyaWFibGVPcmdUeXBlcyA9IFtcclxuICAgICAgeyBuYW1lOiAn57O757uf55So5oi3JywgdmFsdWU6ICdTeXMnIH0sXHJcbiAgICAgIHsgbmFtZTogJ+ihjOaUv+S6uuWRmCcsIHZhbHVlOiAnQWRtaW5pc3RyYXRpdmVfb3JnYW5pemF0aW9uJyB9XHJcbiAgICBdO1xyXG4gIH1cclxuICBzZWxlY3RVc2VycyhkYXRhOiBhbnkpIHtcclxuICAgIC8vIOWbuuWumueUqOaIt1xyXG4gICAgaWYgKHRoaXMudXNlclR5cGUgPT09IHRoaXMudXNlclR5cGVDb2xsZWN0aW9uWzBdLnZhbHVlKSB7XHJcbiAgICAgIHRoaXMubG9va3VwQ29uZmlnLmdldExvb2t1cENvbmZpZygpLnN1YnNjcmliZShyZSA9PiB7XHJcbiAgICAgICAgLy8g6aG555uu6YWN572u5LqG6Ieq5bex55qE5biu5Yqp5pe2XHJcbiAgICAgICAgaWYgKHJlLnVzZXIgJiYgcmUudXNlci5pbXBsKSB7XHJcbiAgICAgICAgICBTeXN0ZW0uaW1wb3J0KHJlLnVzZXIuaW1wbClcclxuICAgICAgICAgICAgLnRoZW4oKG1vZHVsZUZhY3RvcnlzOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICBjb25zdCBtb2R1bGVGYWN0b3J5OiBhbnkgPSBPYmplY3QudmFsdWVzKG1vZHVsZUZhY3RvcnlzKVswXTtcclxuICAgICAgICAgICAgICBjb25zdCBtb2R1bGVSZWYgPSBtb2R1bGVGYWN0b3J5LmNyZWF0ZSh0aGlzLmluamVjdG9yKTtcclxuICAgICAgICAgICAgICBtb2R1bGVSZWYuaW5zdGFuY2Uuc2hvd0hlbHAoKS5zdWJzY3JpYmUoZGF0YSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZGF0YSAmJiBkYXRhLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgdGhpcy51c2VycyA9IGRhdGEubWFwKHUgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHVzZXIgPSBuZXcgVXNlclBlcmZvcm1lckVudGl0eSh1LmlkLCB1Lm5hbWUsICd3Zi5Vc2VyUGFydGljaXBhbnQnKTtcclxuICAgICAgICAgICAgICAgICAgICB1c2VyLm9yZ0lkID0gdS5vcmdJZDtcclxuICAgICAgICAgICAgICAgICAgICB1c2VyLm9yZ05hbWUgPSB1Lm9yZ05hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgdXNlci51c2VyVHlwZSA9IHRoaXMudXNlclR5cGVDb2xsZWN0aW9uWzBdLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB1c2VyO1xyXG4gICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIHsgLy8g5Yqg6L296buY6K6k5biu5YqpXHJcbiAgICAgICAgICB0aGlzLnVzZXJIZWxwLnNob3dIZWxwKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuc2hvd0V4cHJIZWxwKCk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIGVkaXRDb25kaXRvbigpIHtcclxuICAgIGlmICh0aGlzLmRlc2lnbmVyVUlTdGF0ZS5zY2hlbWFzLmxlbmd0aCA+IDApIHtcclxuICAgICAgZm9yIChjb25zdCBzY2hlbWEgb2YgdGhpcy5kZXNpZ25lclVJU3RhdGUuc2NoZW1hcykge1xyXG4gICAgICAgIHRoaXMuZXhwci5hZGRTY2hlbWEoJ1NjaGVtYScsIHNjaGVtYSk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKHRoaXMuZGVzaWduZXJVSVN0YXRlLnNjaGVtYXNbMF0uZW50aXR5VHlwZXMgJiYgdGhpcy5kZXNpZ25lclVJU3RhdGUuc2NoZW1hc1swXS5lbnRpdHlUeXBlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgY29uc3QgZW50aXR5VHlwZSA9IHRoaXMuZGVzaWduZXJVSVN0YXRlLnNjaGVtYXNbMF0uZW50aXR5VHlwZXNbMF07XHJcbiAgICAgICAgdGhpcy5leHByLmFkZEluamVjdGVkRW50aXR5KGVudGl0eVR5cGUubmFtZSwgJ1NjaGVtYScsXHJcbiAgICAgICAgICBlbnRpdHlUeXBlLm5hbWUsIEluamVjdGVkVHlwZS5FbnRpdHlUeXBlKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgY29uc3QgY29udGV4dCA9IG5ldyBBcnJheSgpO1xyXG4gICAgaWYgKHRoaXMuZGVzaWduZXJVSVN0YXRlLnByb2NJbnN0Q29udGV4dC5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGZvciAoY29uc3QgdmFyaWFibGUgb2YgdGhpcy5kZXNpZ25lclVJU3RhdGUucHJvY0luc3RDb250ZXh0KSB7XHJcbiAgICAgICAgY29udGV4dC5wdXNoKHZhcmlhYmxlKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMuZGVzaWduZXJVSVN0YXRlLmZvcm1hbFBhcmFtZXRlckNvbnRleHQubGVuZ3RoID4gMCkge1xyXG4gICAgICBmb3IgKGNvbnN0IHZhcmlhYmxlIG9mIHRoaXMuZGVzaWduZXJVSVN0YXRlLmZvcm1hbFBhcmFtZXRlckNvbnRleHQpIHtcclxuICAgICAgICBpZiAoIWNvbnRleHQuc29tZShjID0+IGMua2V5ID09PSB2YXJpYWJsZS5rZXkpKSB7XHJcbiAgICAgICAgICBjb250ZXh0LnB1c2godmFyaWFibGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMuZGVzaWduZXJVSVN0YXRlLnBhcnRpY2lwYW50Q29udGV4dC5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGZvciAoY29uc3QgdmFyaWFibGUgb2YgdGhpcy5kZXNpZ25lclVJU3RhdGUucGFydGljaXBhbnRDb250ZXh0KSB7XHJcbiAgICAgICAgaWYgKCFjb250ZXh0LnNvbWUoYyA9PiBjLmtleSA9PT0gdmFyaWFibGUua2V5KSkge1xyXG4gICAgICAgICAgY29udGV4dC5wdXNoKHZhcmlhYmxlKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGlmICh0aGlzLmRlc2lnbmVyVUlTdGF0ZS5wcm9jZXNzVmFyaWFibGVDb250ZXh0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgZm9yIChjb25zdCB2YXJpYWJsZSBvZiB0aGlzLmRlc2lnbmVyVUlTdGF0ZS5wcm9jZXNzVmFyaWFibGVDb250ZXh0KSB7XHJcbiAgICAgICAgaWYgKCFjb250ZXh0LnNvbWUoYyA9PiBjLmtleSA9PT0gdmFyaWFibGUua2V5KSkge1xyXG4gICAgICAgICAgY29udGV4dC5wdXNoKHZhcmlhYmxlKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGlmICh0aGlzLmRlc2lnbmVyVUlTdGF0ZS5hY3Rpdml0eUNvbXBvbmVudENvbnRleHQubGVuZ3RoID4gMCkge1xyXG4gICAgICBmb3IgKGNvbnN0IHZhcmlhYmxlIG9mIHRoaXMuZGVzaWduZXJVSVN0YXRlLmFjdGl2aXR5Q29tcG9uZW50Q29udGV4dCkge1xyXG4gICAgICAgIGlmICghY29udGV4dC5zb21lKGMgPT4gYy5rZXkgPT09IHZhcmlhYmxlLmtleSkpIHtcclxuICAgICAgICAgIGNvbnRleHQucHVzaCh2YXJpYWJsZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAoY29udGV4dC5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGZvciAoY29uc3QgdiBvZiBjb250ZXh0KSB7XHJcbiAgICAgICAgdGhpcy5leHByLmFkZENvbnRleHQodik7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHRoaXMuZXhwci5zZXRFZGl0UGF0dGVybihFeHByRWRpdE1vZGUuQ29uZGl0aW9uYWwpOyAvLyDooajovr7lvI/lsZXnjrDmqKHlvI/vvJrpu5jorqTnroDmmJPniYhcclxuICAgIHRoaXMuZXhwci5hZGRFeHByZXNzaW9uVGV4dCh0aGlzLmNvbmRpdGlvbik7XHJcbiAgICB0aGlzLmV4cHIuYnVpbGRFeHByZXNzaW9uKCkudGhlbigoZXhwcmVzc2lvbmluZm86IHN0cmluZykgPT4ge1xyXG4gICAgICB0aGlzLmNvbmRpdGlvbiA9IGV4cHJlc3Npb25pbmZvO1xyXG4gICAgfSk7XHJcbiAgfVxyXG4gIHVzZXJzU2VsZWN0KGRhdGE6IGFueVtdKSB7XHJcbiAgICB0aGlzLnVzZXJzID0gZGF0YS5tYXAodSA9PiB7XHJcbiAgICAgIGNvbnN0IHVzZXIgPSBuZXcgVXNlclBlcmZvcm1lckVudGl0eSh1LmlkLCB1Lm5hbWUsICd3Zi5Vc2VyUGFydGljaXBhbnQnKTtcclxuICAgICAgdXNlci5vcmdJZCA9IHUuc3lzT3JnSWQ7XHJcbiAgICAgIHVzZXIub3JnTmFtZSA9IHUuc3lzT3JnTmFtZTtcclxuICAgICAgdXNlci51c2VyVHlwZSA9IHRoaXMudXNlclR5cGVDb2xsZWN0aW9uWzBdLnZhbHVlO1xyXG5cclxuICAgICAgcmV0dXJuIHVzZXI7XHJcbiAgICB9KTtcclxuICB9XHJcbiAgc2hvd0V4cHJIZWxwKCkge1xyXG4gICAgaWYgKHRoaXMuZGVzaWduZXJVSVN0YXRlLnNjaGVtYXMubGVuZ3RoID4gMCkge1xyXG4gICAgICBmb3IgKGNvbnN0IHNjaGVtYSBvZiB0aGlzLmRlc2lnbmVyVUlTdGF0ZS5zY2hlbWFzKSB7XHJcbiAgICAgICAgdGhpcy5leHByLmFkZFNjaGVtYSgnU2NoZW1hJywgc2NoZW1hKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAodGhpcy5kZXNpZ25lclVJU3RhdGUuc2NoZW1hc1swXS5lbnRpdHlUeXBlcyAmJiB0aGlzLmRlc2lnbmVyVUlTdGF0ZS5zY2hlbWFzWzBdLmVudGl0eVR5cGVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICBjb25zdCBlbnRpdHlUeXBlID0gdGhpcy5kZXNpZ25lclVJU3RhdGUuc2NoZW1hc1swXS5lbnRpdHlUeXBlc1swXTtcclxuICAgICAgICB0aGlzLmV4cHIuYWRkSW5qZWN0ZWRFbnRpdHkoZW50aXR5VHlwZS5uYW1lLCAnU2NoZW1hJyxcclxuICAgICAgICAgIGVudGl0eVR5cGUubmFtZSwgSW5qZWN0ZWRUeXBlLkVudGl0eVR5cGUpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBjb25zdCBjb250ZXh0ID0gbmV3IEFycmF5KCk7XHJcbiAgICBpZiAodGhpcy5kZXNpZ25lclVJU3RhdGUucGFydGljaXBhbnRDb250ZXh0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgZm9yIChjb25zdCB2YXJpYWJsZSBvZiB0aGlzLmRlc2lnbmVyVUlTdGF0ZS5wYXJ0aWNpcGFudENvbnRleHQpIHtcclxuICAgICAgICBjb250ZXh0LnB1c2godmFyaWFibGUpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5kZXNpZ25lclVJU3RhdGUucHJvY2Vzc1ZhcmlhYmxlQ29udGV4dC5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGZvciAoY29uc3QgdmFyaWFibGUgb2YgdGhpcy5kZXNpZ25lclVJU3RhdGUucHJvY2Vzc1ZhcmlhYmxlQ29udGV4dCkge1xyXG4gICAgICAgIGlmICghY29udGV4dC5zb21lKGMgPT4gYy5rZXkgPT09IHZhcmlhYmxlLmtleSkpIHtcclxuICAgICAgICAgIGNvbnRleHQucHVzaCh2YXJpYWJsZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAoY29udGV4dC5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGZvciAoY29uc3QgdiBvZiBjb250ZXh0KSB7XHJcbiAgICAgICAgdGhpcy5leHByLmFkZENvbnRleHQodik7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGlmICh0aGlzLnVzZXJzLmxlbmd0aCA+IDApIHtcclxuICAgICAgdGhpcy5leHByLmFkZEV4cHJlc3Npb25UZXh0KHRoaXMudXNlcnNbMF0ucGVyZm9ybWVySWQpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5leHByLmFkZEV4cHJlc3Npb25UZXh0KCcnKTtcclxuICAgIH1cclxuICAgIHRoaXMuZXhwci5idWlsZEV4cHJlc3Npb24oKS50aGVuKChleHByZXNzaW9uaW5mbzogc3RyaW5nKSA9PiB7XHJcbiAgICAgIGNvbnN0IHVzZXIgPSBuZXcgVXNlclBlcmZvcm1lckVudGl0eShleHByZXNzaW9uaW5mbywgJycsICd3Zi5Vc2VyUGFydGljaXBhbnQnKTtcclxuICAgICAgdXNlci50YWcgPSAnZXhwcmVzc2lvbic7XHJcbiAgICAgIHVzZXIucGVyZm9ybWVyTmFtZSA9IHRoaXMudmFyaWFibGVQYXJ0aWNpcGFudE5hbWUoZXhwcmVzc2lvbmluZm8pO1xyXG4gICAgICB1c2VyLnVzZXJUeXBlID0gdGhpcy51c2VyVHlwZUNvbGxlY3Rpb25bMV0udmFsdWU7XHJcbiAgICAgIGlmKHRoaXMudmFyaWFibGVQYXJ0aWNpcGFudE5hbWUoZXhwcmVzc2lvbmluZm8pID09PSAnJyl7XHJcbiAgICAgICAgdGhpcy5tZXNzYWdlLmVycm9yKCfooYzmlL/kurrlkZjnsbvlnovkuI3og73kvb/nlKjkuIrkuIvmloflj5jph48nKTtcclxuICAgICAgICB0aGlzLnVzZXJzID0gW107XHJcbiAgICAgIH1lbHNle1xyXG4gICAgICAgIHRoaXMudXNlcnMgPSBbdXNlcl07XHJcbiAgICAgIH1cclxuICAgICAgaWYodXNlci5wZXJmb3JtZXJJZC5pbmRleE9mKFwiR2V0Q29udGV4dFBhcmFtZXRlclwiKSA+PSAwKXsgLy8g5qC55o2u6KGo6L6+5byP5Lit55qE5Ye95pWw5ZCN5Yik5pat5piv5ZCm5L2/55So55qE5piv5LiK5LiL5paH5Y+Y6YePXHJcbiAgICAgICAgdGhpcy52YXJpYWJsZU9yZ1R5cGVzID0gW1xyXG4gICAgICAgICAgeyBuYW1lOiAn57O757uf55So5oi3JywgdmFsdWU6ICdTeXMnIH1cclxuICAgICAgICBdO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMudmFyaWFibGVPcmdUeXBlcyA9IFtcclxuICAgICAgICAgIHsgbmFtZTogJ+ezu+e7n+eUqOaItycsIHZhbHVlOiAnU3lzJyB9LFxyXG4gICAgICAgICAgeyBuYW1lOiAn6KGM5pS/5Lq65ZGYJywgdmFsdWU6ICdBZG1pbmlzdHJhdGl2ZV9vcmdhbml6YXRpb24nIH1cclxuICAgICAgICBdO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcbiAgZ2V0UGVyZm9ybWVycygpIHtcclxuICAgIHRoaXMudXNlcnMubWFwKHVzZXIgPT4ge1xyXG4gICAgICBpZiAodXNlci5vcmdJZCA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgdXNlci5vcmdUeXBlID0gdGhpcy5jdXJPcmdUeXBlO1xyXG4gICAgICAgIHJldHVybiB1c2VyO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIGlmICh0aGlzLmNvbmRpdGlvbikge1xyXG4gICAgICB0aGlzLnVzZXJzID0gdGhpcy51c2Vycy5tYXAodXNlciA9PiB7XHJcbiAgICAgICAgdXNlci5jb25kaXRpb24gPSB0aGlzLmNvbmRpdGlvbjtcclxuICAgICAgICByZXR1cm4gdXNlcjtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGhpcy51c2VycztcclxuICB9XHJcbiAgcHJpdmF0ZSB2YXJpYWJsZVBhcnRpY2lwYW50TmFtZShleHByOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgZm9yIChjb25zdCBjIG9mIHRoaXMuZGVzaWduZXJVSVN0YXRlLnBhcnRpY2lwYW50Q29udGV4dCkge1xyXG4gICAgICBpZiAoZXhwci5pbmRleE9mKGMua2V5KSA+IC0xKSB7XHJcbiAgICAgICAgaWYodGhpcy5jdXJPcmdUeXBlICE9PSAnU3lzJyl7IC8vIOihjOaUv+S6uuWRmOexu+Wei+S4jeWFgeiuuOS9v+eUqOS4iuS4i+aWh+WPmOmHj1xyXG4gICAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gYy5uYW1lO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBmb3IgKGNvbnN0IGMgb2YgdGhpcy5kZXNpZ25lclVJU3RhdGUucHJvY2Vzc1ZhcmlhYmxlQ29udGV4dCkge1xyXG4gICAgICBpZiAoZXhwci5pbmRleE9mKGMua2V5KSA+IC0xKSB7XHJcbiAgICAgICAgcmV0dXJuIGMubmFtZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuICfkuJrliqHlrZfmrrUnO1xyXG4gIH1cclxuICBvcmdUeXBlQ2hhbmdlKGRhdGE6IGFueSkge1xyXG4gICAgaWYgKGRhdGEgPT09ICdTeXMnKSB7XHJcbiAgICAgIHRoaXMuY3VyT3JnVHlwZSA9IHRoaXMudmFyaWFibGVPcmdUeXBlc1swXS52YWx1ZTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5jdXJPcmdUeXBlID0gdGhpcy52YXJpYWJsZU9yZ1R5cGVzWzFdLnZhbHVlO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG4iXX0=