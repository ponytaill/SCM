/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/services/bill-tracker-data-info.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from "@angular/core";
import { BpmnModelJsonHelper, DataType } from "@edp-aif/common-api";
import { BillTrackingDataShownMode, BillTrackingSettings, fullPathPrefix } from "@edp-bif/common-api";
export class BillTrackerDataInfoService {
    /**
     * 判断BillTrackingSettings是旧版还是新版
     * @param {?} bts
     * @return {?}
     */
    isNewBTS(bts) {
        if (typeof bts == "string") {
            /** @type {?} */
            const temp = new BillTrackingSettings();
            temp.LoadFromJson(bts);
            bts = temp;
        }
        return bts != null && bts.version === "1.0";
    }
    /**
     * @param {?} rows
     * @param {?} shownFields
     * @param {?} wholeFields
     * @param {?} idField
     * @return {?}
     */
    extractDataRows(rows, shownFields, wholeFields, idField) {
        /** @type {?} */
        let frows = [];
        for (let row of rows) {
            /** @type {?} */
            let obj = {};
            obj[idField] = row.dataId;
            // 先解析其他类型字段
            /** @type {?} */
            const decimalFFs = [];
            shownFields.forEach((/**
             * @param {?} f
             * @return {?}
             */
            f => {
                if (f.dataType == DataType.Decimal) {
                    decimalFFs.push(f);
                }
                else {
                    obj[f.fieldPath] = this.getFieldValue(f, row.GetFieldMap(), wholeFields);
                }
            }));
            // 再解析浮点型字段
            decimalFFs.forEach((/**
             * @param {?} f
             * @return {?}
             */
            f => {
                obj[f.fieldPath] = this.getFieldValue(f, row.GetFieldMap(), wholeFields);
            }));
            frows.push(obj);
        }
        return frows;
    }
    /**
     * @param {?} field
     * @return {?}
     */
    extractCaptionPath(field) {
        /** @type {?} */
        let s = field.caption;
        /** @type {?} */
        let tmp = (/** @type {?} */ (field));
        while (tmp.attachedField != null) {
            s = tmp.attachedField.caption + "." + s;
            tmp = (/** @type {?} */ (tmp.attachedField));
        }
        return s;
    }
    /**
     * @param {?} field
     * @return {?}
     */
    extractFieldPath(field) {
        /** @type {?} */
        let s = field.fieldName;
        /** @type {?} */
        let tmp = (/** @type {?} */ (field));
        while (tmp.attachedField != null) {
            s = tmp.attachedField.fieldName + "." + s;
            tmp = (/** @type {?} */ (tmp.attachedField));
        }
        return s;
    }
    /**
     *
     * @param {?} fields 子字段列表
     * @param {?} selectedFields 用户自定义展示字段列表
     * @param {?} showCustomFields 是否按用户自定义字段显示
     * @return {?}
     */
    extractFFields(fields, selectedFields, showCustomFields) {
        /** @type {?} */
        let ffields = [];
        fields.forEach((/**
         * @param {?} f
         * @return {?}
         */
        f => {
            f.show = true;
            //枚举或者枚举型单值UDT时默认取Name
            if (f.fieldType == "Enum" || f.fieldType == "EnumSingleUdt") {
                /** @type {?} */
                const tempFPath = this.extractFieldPath(f);
                /** @type {?} */
                let sf = null;
                if (showCustomFields) {
                    // 如果字段不在已配置字段列表中则跳过
                    sf = selectedFields.find((/**
                     * @param {?} sfield
                     * @return {?}
                     */
                    (sfield) => sfield.fieldPath == tempFPath));
                    if (sf == null) {
                        f.show = false;
                    }
                }
                f = (/** @type {?} */ (this.setExtendProps(f, sf, tempFPath + ".Name")));
                ffields.push(f);
            }
            else if (f.GetSubFieldList() != null && f.GetSubFieldList().length > 0) {
                ffields.push(...this.extractFFields(f.GetSubFieldList(), selectedFields, showCustomFields));
            }
            else {
                /** @type {?} */
                const tempFPath = this.extractFieldPath(f);
                /** @type {?} */
                let sf = null;
                if (showCustomFields) {
                    // 如果字段不在已配置字段列表中则跳过
                    sf = selectedFields.find((/**
                     * @param {?} sfield
                     * @return {?}
                     */
                    (sfield) => sfield.fieldPath == tempFPath));
                    if (sf == null) {
                        f.show = false;
                    }
                }
                f = (/** @type {?} */ (this.setExtendProps(f, sf, tempFPath)));
                ffields.push(f);
            }
        }));
        return ffields;
    }
    /**
     * 判定有子数据的条件为：子表可显示，且子表有数据
     * @param {?} row
     * @param {?} billInfo
     * @return {?}
     */
    hasChildData(row, billInfo) {
        /** @type {?} */
        let hasChildData = false;
        /** @type {?} */
        const schema = this.getBillTrackerSchema(billInfo);
        /** @type {?} */
        let children = row.GetChildTableList();
        for (let c of children) {
            /** @type {?} */
            let tableShow = false;
            /** @type {?} */
            let hasRows = false;
            /** @type {?} */
            let table = schema && schema[c.tableName];
            if (table != null && table.show != null) {
                tableShow = table.show;
            }
            else {
                // 兼容无show属性情形
                tableShow = true;
            }
            if (c.GetRowList() && c.GetRowList().length > 0) {
                hasRows = true;
            }
            hasChildData = tableShow && hasRows;
            if (hasChildData == true) {
                break;
            }
        }
        return hasChildData;
    }
    /**
     * @param {?} f
     * @param {?} rdfm
     * @param {?=} wholeFields
     * @return {?}
     */
    getFieldValue(f, rdfm, wholeFields) {
        /** @type {?} */
        let fields = f.fieldPath ? f.fieldPath.split(".") : [f.fieldName];
        /** @type {?} */
        let bdf = fields && rdfm[fields[0]];
        for (let i = 1; bdf != null && i < fields.length; i++) {
            /** @type {?} */
            const temp = bdf.GetSubFieldMap();
            if (temp == null) {
                break;
            }
            bdf = temp[fields[i]];
        }
        /** @type {?} */
        const textValue = bdf ? bdf.GetTextValue() : "";
        if (textValue == null) {
            return null;
        }
        if (f.dataType == DataType.String) {
            if (f.formatInfo != null) {
                /** @type {?} */
                const stringMapFormatter = f.formatInfo.stringMapFormatter;
                if (stringMapFormatter != null) {
                    /** @type {?} */
                    const v = stringMapFormatter[textValue] || textValue;
                    f.fieldValue = v;
                    return v;
                }
                else {
                    f.fieldValue = textValue;
                    return textValue || "";
                }
            }
            else {
                f.fieldValue = textValue;
                return textValue || "";
            }
        }
        else if (f.dataType == DataType.Decimal) {
            /** @type {?} */
            let scale = f.scale;
            if (f.formatInfo != null) {
                if (f.formatInfo.scale != null) {
                    scale = f.formatInfo.scale;
                }
                if (f.formatInfo.enableScaleExpression) {
                    if (f.formatInfo.scaleExpression != null) {
                        /** @type {?} */
                        const scaleField = this.getFieldInFields(wholeFields, f.formatInfo.scaleExpression);
                        /** @type {?} */
                        const tmp = scaleField && parseInt(String(this.getFieldValue(scaleField, rdfm)));
                        // const tmp = parseInt(this.getFieldValueInFieldsWithValue(extactedFields, f.formatInfo.scaleExpression));
                        if (tmp != null && !isNaN(tmp)) {
                            scale = tmp;
                        }
                    }
                }
            }
            f.fieldValue = parseFloat(String(textValue));
            /** @type {?} */
            let dec = parseFloat(String(textValue)).toFixed(scale).toString();
            return dec || "";
        }
        else if (f.dataType == DataType.Boolean) {
            if (textValue == "") {
                f.fieldValue = null;
                return textValue;
            }
            f.fieldValue = (/** @type {?} */ (JSON.parse(textValue)));
            return (/** @type {?} */ (JSON.parse(textValue)));
        }
        else if (f.dataType == DataType.DateTime) {
            /** @type {?} */
            let date = BpmnModelJsonHelper.DateTimeFromString(textValue);
            /** @type {?} */
            let formatter = "yyyy-MM-dd";
            formatter = f.formatInfo && f.formatInfo.dateFormatter || "yyyy-MM-dd";
            // if (f.fieldType == "DateTime") {
            //     formatter = f.formatInfo && f.formatInfo.dateFormatter || "yyyy-MM-dd HH:mm:ss.SSS";
            // } else if (f.fieldType == "Date") {
            //     formatter = f.formatInfo && f.formatInfo.dateFormatter || "yyyy-MM-dd";
            // } else {
            //     formatter = f.formatInfo && f.formatInfo.dateFormatter || "yyyy-MM-dd";
            // }
            f.fieldValue = date;
            return this.dateFormat(date, formatter);
        }
        else {
            f.fieldValue = textValue;
            return textValue || "";
        }
    }
    /**
     * 根据fullPath在字段列表中查找目标字段
     * @param {?} fields
     * @param {?} fullPath
     * @return {?}
     */
    getFieldInFields(fields, fullPath) {
        /** @type {?} */
        let v = null;
        for (let fv of fields) {
            /** @type {?} */
            const curFv = (/** @type {?} */ (fv));
            // 查找根字段
            /** @type {?} */
            let tmpFv = fv;
            while (tmpFv.attachedField) {
                tmpFv = tmpFv.attachedField;
            }
            /** @type {?} */
            const rootFv = (/** @type {?} */ (tmpFv));
            // 更新fullPath
            curFv.fullPath = fullPathPrefix + rootFv.attachedTable.tableName + "." + curFv.fieldPath;
            // 对比当前字段fullPath与目标fullPath
            if (fullPath == curFv.fullPath) {
                v = curFv;
                break;
            }
            // 递归查找子字段
            /** @type {?} */
            const subFlds = curFv.GetSubFieldList();
            if (subFlds && subFlds.length > 0) {
                v = this.getFieldInFields(subFlds, fullPath);
                if (v != null) {
                    break;
                }
            }
        }
        return v;
    }
    /**
     * @param {?} fieldsWithValue
     * @param {?} fullPath
     * @return {?}
     */
    getFieldValueInFieldsWithValue(fieldsWithValue, fullPath) {
        /** @type {?} */
        let v = null;
        for (let fv of fieldsWithValue) {
            while (fv.attachedField) {
                fv = fv.attachedField;
            }
            /** @type {?} */
            const rootFv = (/** @type {?} */ (fv));
            rootFv.fullPath = fullPathPrefix + rootFv.attachedTable.tableName + "." + rootFv.fieldPath;
            if (fullPath == rootFv.fullPath) {
                v = rootFv.fieldValue;
                break;
            }
        }
        return v;
    }
    /**
     * @param {?} billInfo
     * @param {?} schemaTable
     * @param {?} dataTable
     * @param {?=} filterFields
     * @return {?}
     */
    getBasicInfoFieldsWithValue(billInfo, schemaTable, dataTable, filterFields = true) {
        /** @type {?} */
        const fieldsWithValue = [];
        // 单据追踪配置
        /** @type {?} */
        let bts = new BillTrackingSettings();
        if (billInfo && billInfo.billTrackingSettings) {
            bts.LoadFromJson(billInfo.billTrackingSettings);
        }
        /** @type {?} */
        const schema = this.getBillTrackerSchema(billInfo);
        /** @type {?} */
        let selectedFields = schema && schema[schemaTable.tableName] && schema[schemaTable.tableName].fields;
        selectedFields = selectedFields ? selectedFields : [];
        /** @type {?} */
        let showCustomFields = bts.billTrackingDataShownMode === BillTrackingDataShownMode.CUSTOMFIELD;
        // 所有字段
        /** @type {?} */
        const fs = schemaTable.getFieldList();
        /** @type {?} */
        const r = dataTable.GetRowList()[0];
        // 主表字段
        /** @type {?} */
        const rdfm = r.GetFieldMap();
        // 提取展示字段
        /** @type {?} */
        const ffs = this.extractFFields(fs, selectedFields, showCustomFields);
        // 获取字段值
        // 先解析其他类型字段
        /** @type {?} */
        const decimalFfs = [];
        ffs.forEach((/**
         * @param {?} ff
         * @return {?}
         */
        ff => {
            if (ff.dataType == DataType.Decimal) {
                decimalFfs.push(ff);
            }
            else {
                ff.fieldValue = this.getFieldValue(ff, rdfm);
            }
        }));
        // 再解析浮点数字段
        decimalFfs.forEach((/**
         * @param {?} ff
         * @return {?}
         */
        ff => {
            ff.fieldValue = this.getFieldValue(ff, rdfm, fs);
        }));
        fieldsWithValue.push(...ffs);
        return fieldsWithValue;
    }
    /**
     * @param {?} f
     * @param {?} sf
     * @param {?} fieldPath
     * @param {?=} rdfm
     * @return {?}
     */
    setExtendProps(f, sf, fieldPath, rdfm) {
        f.captionPath = this.extractCaptionPath(f);
        f.fieldPath = fieldPath;
        if (sf) {
            f.displayName = sf.displayName;
            f.i18nCols = sf.i18nCols;
            f.formatInfo = sf.formatInfo;
            f.order = sf.order;
        }
        if (rdfm) {
            f.fieldValue = this.getFieldValue(f, rdfm);
        }
        return f;
    }
    /**
     * 字段列表按order属性排序
     * @param {?} fieldsWithValue
     * @return {?}
     */
    sortFieldsByOrder(fieldsWithValue) {
        return fieldsWithValue.sort((/**
         * @param {?} a
         * @param {?} b
         * @return {?}
         */
        (a, b) => {
            if (a.order != null && b.order != null) {
                return a.order - b.order;
            }
            else if (a.order != null && b.order == null) {
                return -1;
            }
            else if (a.order == null && b.order != null) {
                return 1;
            }
            else {
                return 0;
            }
        }));
    }
    /**
     * @param {?} date
     * @param {?} fmt
     * @return {?}
     */
    dateFormat(date, fmt) {
        /** @type {?} */
        let ret;
        /** @type {?} */
        const opt = {
            "y+": date.getUTCFullYear().toString(),
            // 年
            "M+": (date.getUTCMonth() + 1).toString(),
            // 月
            "d+": date.getUTCDate().toString(),
            // 日
            "H+": date.getUTCHours().toString(),
            // 时
            "m+": date.getUTCMinutes().toString(),
            // 分
            "s+": date.getUTCSeconds().toString(),
            // 秒
            "S+": date.getUTCMilliseconds().toString(),
        };
        for (let k in opt) {
            ret = new RegExp("(" + k + ")").exec(fmt);
            if (ret) {
                if (!String.prototype.padStart) {
                    fmt = fmt.replace(ret[1], (ret[1].length == 1) ? (opt[k]) : (this.myPadStart(opt[k], ret[1].length, "0")));
                }
                else {
                    fmt = fmt.replace(ret[1], (ret[1].length == 1) ? (opt[k]) : (opt[k].padStart(ret[1].length, "0")));
                }
            }
        }
        return fmt;
    }
    /**
     * @param {?} src
     * @param {?} targetLength
     * @param {?} padString
     * @return {?}
     */
    myPadStart(src, targetLength, padString) {
        targetLength = targetLength >> 0; //floor if number or convert non-number to 0;
        padString = String(typeof padString !== 'undefined' ? padString : ' ');
        if (src.length > targetLength) {
            return String(src);
        }
        else {
            targetLength = targetLength - src.length;
            if (targetLength > padString.length) {
                padString += padString.repeat(targetLength / padString.length); //append to original to ensure we are longer than needed
            }
            return padString.slice(0, targetLength) + String(src);
        }
    }
    /**
     * 解析字段名称
     * @param {?} f
     * @param {?=} langCode
     * @return {?}
     */
    getFieldLabel(f, langCode) {
        return (langCode && f.i18nCols && f.i18nCols.colI18nValues.displayName &&
            f.i18nCols.colI18nValues.displayName[langCode]) || f.displayName || f.captionPath || f.caption;
    }
    /**
     * 解析表名称
     * @param {?} billInfo
     * @param {?} schemaTable
     * @param {?=} langCode
     * @return {?}
     */
    getTableLabel(billInfo, schemaTable, langCode) {
        /** @type {?} */
        const schema = this.getBillTrackerSchema(billInfo);
        /** @type {?} */
        let table = schema && schema[schemaTable.tableName];
        if (table != null) {
            /** @type {?} */
            const i18nCols = table.i18nCols;
            /** @type {?} */
            const tmp = (langCode && i18nCols && i18nCols.colI18nValues.displayName && i18nCols.colI18nValues.displayName[langCode]) || table.displayName || table.caption || table.code;
            return tmp;
        }
        else {
            return schemaTable.caption;
        }
    }
    /**
     * 获取解析可展示子表
     * @param {?} billInfo
     * @param {?} schemaTable
     * @return {?}
     */
    getChildTables(billInfo, schemaTable) {
        /** @type {?} */
        let result = [];
        /** @type {?} */
        const schema = this.getBillTrackerSchema(billInfo);
        /** @type {?} */
        const children = schemaTable.GetChildTableList();
        children && children.forEach((/**
         * @param {?} child
         * @return {?}
         */
        (child) => {
            /** @type {?} */
            let trackerTable = schema && schema[child.tableName];
            if (trackerTable != null && trackerTable.show != null) {
                if (trackerTable.show == true) {
                    child.order = trackerTable.order;
                    result.push(child);
                }
            }
            else {
                // 兼容无show属性情形
                result.push(child);
            }
        }));
        result = this.sortTablesByOrder(result);
        return result;
    }
    /**
     * 表按sort字段排序
     * @param {?} schemaTables
     * @return {?}
     */
    sortTablesByOrder(schemaTables) {
        return schemaTables.sort((/**
         * @param {?} a
         * @param {?} b
         * @return {?}
         */
        (a, b) => {
            if (a.order != null && b.order != null) {
                return a.order - b.order;
            }
            else if (a.order != null && b.order == null) {
                return -1;
            }
            else if (a.order == null && b.order != null) {
                return 1;
            }
            else {
                return 0;
            }
        }));
    }
    /**
     * 解析billTrackerSchema
     * @param {?} billInfo
     * @return {?}
     */
    getBillTrackerSchema(billInfo) {
        /** @type {?} */
        let bts = new BillTrackingSettings();
        if (billInfo && billInfo.billTrackingSettings) {
            bts.LoadFromJson(billInfo.billTrackingSettings);
        }
        /** @type {?} */
        let fieldContent = bts.customFieldContent;
        /** @type {?} */
        let fieldConfig = fieldContent && (typeof fieldContent == "object" ? fieldContent : JSON.parse(fieldContent));
        /** @type {?} */
        let schema = fieldConfig && fieldConfig.schema;
        return schema;
    }
}
BillTrackerDataInfoService.decorators = [
    { type: Injectable }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmlsbC10cmFja2VyLWRhdGEtaW5mby5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGVkcC1iaWYvcnVudGltZS1hcGkvIiwic291cmNlcyI6WyJsaWIvYmlsbC10cmFja2VyL3NlcnZpY2VzL2JpbGwtdHJhY2tlci1kYXRhLWluZm8uc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUEwSSxtQkFBbUIsRUFBRSxRQUFRLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUM1TSxPQUFPLEVBQW9ELHlCQUF5QixFQUFFLG9CQUFvQixFQUFFLGNBQWMsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBSXhKLE1BQU0sT0FBTywwQkFBMEI7Ozs7OztJQU05QixRQUFRLENBQUMsR0FBa0M7UUFDaEQsSUFBSSxPQUFPLEdBQUcsSUFBSSxRQUFRLEVBQUU7O2tCQUNwQixJQUFJLEdBQUcsSUFBSSxvQkFBb0IsRUFBRTtZQUN2QyxJQUFJLENBQUMsWUFBWSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ3ZCLEdBQUcsR0FBRyxJQUFJLENBQUM7U0FDWjtRQUVELE9BQU8sR0FBRyxJQUFJLElBQUksSUFBSSxHQUFHLENBQUMsT0FBTyxLQUFLLEtBQUssQ0FBQztJQUM5QyxDQUFDOzs7Ozs7OztJQUVNLGVBQWUsQ0FBQyxJQUFtQixFQUFFLFdBQWtDLEVBQUUsV0FBa0MsRUFBRSxPQUFlOztZQUM3SCxLQUFLLEdBQUcsRUFBRTtRQUNkLEtBQUssSUFBSSxHQUFHLElBQUksSUFBSSxFQUFFOztnQkFDaEIsR0FBRyxHQUFHLEVBQUU7WUFDWixHQUFHLENBQUMsT0FBTyxDQUFDLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQzs7O2tCQUVwQixVQUFVLEdBQUcsRUFBRTtZQUNyQixXQUFXLENBQUMsT0FBTzs7OztZQUFDLENBQUMsQ0FBQyxFQUFFO2dCQUN0QixJQUFJLENB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QUksSUFBSSxDQUFDLENBQUMsS0FBSyxJQUFJLElBQUksRUFBRTtnQkFDN0MsT0FBTyxDQUFDLENBQUM7YUFDVjtpQkFBTTtnQkFDTCxPQUFPLENBQUMsQ0FBQzthQUNWO1FBQ0gsQ0FBQyxFQUFDLENBQUE7SUFDSixDQUFDOzs7Ozs7SUFLTSxvQkFBb0IsQ0FBQyxRQUFrQjs7WUFDeEMsR0FBRyxHQUF5QixJQUFJLG9CQUFvQixFQUFFO1FBQzFELElBQUksUUFBUSxJQUFJLFFBQVEsQ0FBQyxvQkFBb0IsRUFBRTtZQUM3QyxHQUFHLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO1NBQ2pEOztZQUVHLFlBQVksR0FBRyxHQUFHLENBQUMsa0JBQWtCOztZQUNyQyxXQUFXLEdBQWtDLFlBQVksSUFBSSxDQUFDLE9BQU8sWUFBWSxJQUFJLFFBQVEsQ0FBQyxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFlBQVksQ0FBQyxDQUFDOztZQUN4SSxNQUFNLEdBQUcsV0FBVyxJQUFJLFdBQVcsQ0FBQyxNQUFNO1FBRTlDLE9BQU8sTUFBTSxDQUFDO0lBQ2hCLENBQUM7OztZQXBkRixVQUFVIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XHJcbmltcG9ydCB7IEJpbGxEYXRhRmllbGQsIEJpbGxEYXRhUm93LCBCaWxsRGF0YVN1YkZpZWxkLCBCaWxsRGF0YVRhYmxlLCBCaWxsU2NoZW1hRmllbGQsIEJpbGxTY2hlbWFGaWVsZEJhc2UsIEJpbGxTY2hlbWFTdWJGaWVsZCwgQmlsbFNjaGVtYVRhYmxlLCBCcG1uTW9kZWxKc29uSGVscGVyLCBEYXRhVHlwZSB9IGZyb20gXCJAZWRwLWFpZi9jb21tb24tYXBpXCI7XHJcbmltcG9ydCB7IEJpbGxUcmFja2VyU2NoZW1hLCBCaWxsVHJhY2tlclNjaGVtYUZpZWxkQ29udGVudCwgQmlsbFRyYWNraW5nRGF0YVNob3duTW9kZSwgQmlsbFRyYWNraW5nU2V0dGluZ3MsIGZ1bGxQYXRoUHJlZml4IH0gZnJvbSBcIkBlZHAtYmlmL2NvbW1vbi1hcGlcIjtcclxuaW1wb3J0IHsgQmlsbEluZm8gfSBmcm9tIFwiLi4vLi4vZW50aXR5L3RyYWNraW5nL0JpbGxJbmZvXCI7XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBCaWxsVHJhY2tlckRhdGFJbmZvU2VydmljZSB7XHJcbiAgLyoqXHJcbiAgICog5Yik5patQmlsbFRyYWNraW5nU2V0dGluZ3PmmK/ml6fniYjov5jmmK/mlrDniYhcclxuICAgKiBAcGFyYW0gYnRzXHJcbiAgICogQHJldHVybnNcclxuICAgKi9cclxuICBwdWJsaWMgaXNOZXdCVFMoYnRzOiBzdHJpbmcgfCBCaWxsVHJhY2tpbmdTZXR0aW5ncyk6IGJvb2xlYW4ge1xyXG4gICAgaWYgKHR5cGVvZiBidHMgPT0gXCJzdHJpbmdcIikge1xyXG4gICAgICBjb25zdCB0ZW1wID0gbmV3IEJpbGxUcmFja2luZ1NldHRpbmdzKCk7XHJcbiAgICAgIHRlbXAuTG9hZEZyb21Kc29uKGJ0cyk7XHJcbiAgICAgIGJ0cyA9IHRlbXA7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGJ0cyAhPSBudWxsICYmIGJ0cy52ZXJzaW9uID09PSBcIjEuMFwiO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGV4dHJhY3REYXRhUm93cyhyb3dzOiBCaWxsRGF0YVJvd1tdLCBzaG93bkZpZWxkczogQmlsbFNjaGVtYUZpZWxkQmFzZVtdLCB3aG9sZUZpZWxkczogQmlsbFNjaGVtYUZpZWxkQmFzZVtdLCBpZEZpZWxkOiBzdHJpbmcpIHtcclxuICAgIGxldCBmcm93cyA9IFtdO1xyXG4gICAgZm9yIChsZXQgcm93IG9mIHJvd3MpIHtcclxuICAgICAgbGV0IG9iaiA9IHt9O1xyXG4gICAgICBvYmpbaWRGaWVsZF0gPSByb3cuZGF0YUlkO1xyXG4gICAgICAvLyDlhYjop6PmnpDlhbbku5bnsbvlnovlrZfmrrVcclxuICAgICAgY29uc3QgZGVjaW1hbEZGcyA9IFtdO1xyXG4gICAgICBzaG93bkZpZWxkcy5mb3JFYWNoKGYgPT4ge1xyXG4gICAgICAgIGlmIChmLmRhdGFUeXBlID09IERhdGFUeXBlLkRlY2ltYWwpIHtcclxuICAgICAgICAgIGRlY2ltYWxGRnMucHVzaChmKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgb2JqW2YuZmllbGRQYXRoXSA9IHRoaXMuZ2V0RmllbGRWYWx1ZShmLCByb3cuR2V0RmllbGRNYXAoKSwgd2hvbGVGaWVsZHMpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICAgIC8vIOWGjeino+aekOa1rueCueWei+Wtl+autVxyXG4gICAgICBkZWNpbWFsRkZzLmZvckVhY2goZiA9PiB7XHJcbiAgICAgICAgb2JqW2YuZmllbGRQYXRoXSA9IHRoaXMuZ2V0RmllbGRWYWx1ZShmLCByb3cuR2V0RmllbGRNYXAoKSwgd2hvbGVGaWVsZHMpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGZyb3dzLnB1c2gob2JqKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gZnJvd3M7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZXh0cmFjdENhcHRpb25QYXRoKGZpZWxkOiBCaWxsU2NoZW1hRmllbGQgfCBCaWxsU2NoZW1hU3ViRmllbGQpIHtcclxuICAgIGxldCBzID0gZmllbGQuY2FwdGlvbjtcclxuICAgIGxldCB0bXAgPSBmaWVsZCBhcyBCaWxsU2NoZW1hU3ViRmllbGQ7XHJcbiAgICB3aGlsZSAodG1wLmF0dGFjaGVkRmllbGQgIT0gbnVsbCkge1xyXG4gICAgICBzID0gdG1wLmF0dGFjaGVkRmllbGQuY2FwdGlvbiArIFwiLlwiICsgcztcclxuICAgICAgdG1wID0gdG1wLmF0dGFjaGVkRmllbGQgYXMgQmlsbFNjaGVtYVN1YkZpZWxkO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHM7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZXh0cmFjdEZpZWxkUGF0aChmaWVsZDogQmlsbFNjaGVtYUZpZWxkIHwgQmlsbFNjaGVtYVN1YkZpZWxkKSB7XHJcbiAgICBsZXQgcyA9IGZpZWxkLmZpZWxkTmFtZTtcclxuICAgIGxldCB0bXAgPSBmaWVsZCBhcyBCaWxsU2NoZW1hU3ViRmllbGQ7XHJcbiAgICB3aGlsZSAodG1wLmF0dGFjaGVkRmllbGQgIT0gbnVsbCkge1xyXG4gICAgICBzID0gdG1wLmF0dGFjaGVkRmllbGQuZmllbGROYW1lICsgXCIuXCIgKyBzO1xyXG4gICAgICB0bXAgPSB0bXAuYXR0YWNoZWRGaWVsZCBhcyBCaWxsU2NoZW1hU3ViRmllbGQ7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqXHJcbiAgICogQHBhcmFtIGZpZWxkcyDlrZDlrZfmrrXliJfooahcclxuICAgKiBAcGFyYW0gc2VsZWN0ZWRGaWVsZHMg55So5oi36Ieq5a6a5LmJ5bGV56S65a2X5q615YiX6KGoXHJcbiAgICogQHBhcmFtIHNob3dDdXN0b21GaWVsZHMg5piv5ZCm5oyJ55So5oi36Ieq5a6a5LmJ5a2X5q615pi+56S6XHJcbiAgICogQHJldHVybnNcclxuICAgKi9cclxuICBwdWJsaWMgZXh0cmFjdEZGaWVsZHMoZmllbGRzOiAoQmlsbFNjaGVtYUZpZWxkIHwgQmlsbFNjaGVtYVN1YkZpZWxkKVtdLCBzZWxlY3RlZEZpZWxkczogQmlsbFNjaGVtYUZpZWxkQmFzZVtdLCBzaG93Q3VzdG9tRmllbGRzOiBib29sZWFuKTogKEJpbGxTY2hlbWFGaWVsZCB8IEJpbGxTY2hlbWFTdWJGaWVsZClbXSB7XHJcbiAgICBsZXQgZmZpZWxkczogKEJpbGxTY2hlbWFGaWVsZCB8IEJpbGxTY2hlbWFTdWJGaWVsZClbXSA9IFtdO1xyXG4gICAgZmllbGRzLmZvckVhY2goZiA9PiB7XHJcbiAgICAgIGYuc2hvdyA9IHRydWU7XHJcbiAgICAgIC8v5p6a5Li+5oiW6ICF5p6a5Li+5Z6L5Y2V5YC8VURU5pe26buY6K6k5Y+WTmFtZVxyXG4gICAgICBpZiAoZi5maWVsZFR5cGUgPT0gXCJFbnVtXCIgfHwgZi5maWVsZFR5cGUgPT0gXCJFbnVtU2luZ2xlVWR0XCIpIHtcclxuICAgICAgICBjb25zdCB0ZW1wRlBhdGggPSB0aGlzLmV4dHJhY3RGaWVsZFBhdGgoZik7XHJcblxyXG4gICAgICAgIGxldCBzZiA9IG51bGw7XHJcbiAgICAgICAgaWYgKHNob3dDdXN0b21GaWVsZHMpIHtcclxuICAgICAgICAgIC8vIOWmguaenOWtl+auteS4jeWcqOW3sumFjee9ruWtl+auteWIl+ihqOS4reWImei3s+i/h1xyXG4gICAgICAgICAgc2YgPSBzZWxlY3RlZEZpZWxkcy5maW5kKChzZmllbGQpID0+IHNmaWVsZC5maWVsZFBhdGggPT0gdGVtcEZQYXRoKTtcclxuICAgICAgICAgIGlmIChzZiA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIGYuc2hvdyA9IGZhbHNlO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZiA9IHRoaXMuc2V0RXh0ZW5kUHJvcHMoZiwgc2YsIHRlbXBGUGF0aCArIFwiLk5hbWVcIikgYXMgQmlsbFNjaGVtYVN1YkZpZWxkO1xyXG5cclxuICAgICAgICBmZmllbGRzLnB1c2goZik7XHJcbiAgICAgIH0gZWxzZSBpZiAoZi5HZXRTdWJGaWVsZExpc3QoKSAhPSBudWxsICYmIGYuR2V0U3ViRmllbGRMaXN0KCkubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIGZmaWVsZHMucHVzaCguLi50aGlzLmV4dHJhY3RGRmllbGRzKGYuR2V0U3ViRmllbGRMaXN0KCksIHNlbGVjdGVkRmllbGRzLCBzaG93Q3VzdG9tRmllbGRzKSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uc3QgdGVtcEZQYXRoID0gdGhpcy5leHRyYWN0RmllbGRQYXRoKGYpO1xyXG5cclxuICAgICAgICBsZXQgc2YgPSBudWxsO1xyXG4gICAgICAgIGlmIChzaG93Q3VzdG9tRmllbGRzKSB7XHJcbiAgICAgICAgICAvLyDlpoLmnpzlrZfmrrXkuI3lnKjlt7LphY3nva7lrZfmrrXliJfooajkuK3liJnot7Pov4dcclxuICAgICAgICAgIHNmID0gc2VsZWN0ZWRGaWVsZHMuZmluZCgoc2ZpZWxkKSA9PiBzZmllbGQuZmllbGRQYXRoID09IHRlbXBGUGF0aCk7XHJcbiAgICAgICAgICBpZiAoc2YgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICBmLnNob3cgPSBmYWxzZTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGYgPSB0aGlzLnNldEV4dGVuZFByb3BzKGYsIHNmLCB0ZW1wRlBhdGgpIGFzIEJpbGxTY2hlbWFTdWJGaWVsZDtcclxuXHJcbiAgICAgICAgZmZpZWxkcy5wdXNoKGYpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gZmZpZWxkcztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWIpOWumuacieWtkOaVsOaNrueahOadoeS7tuS4uu+8muWtkOihqOWPr+aYvuekuu+8jOS4lOWtkOihqOacieaVsOaNrlxyXG4gICAqL1xyXG4gIHB1YmxpYyBoYXNDaGlsZERhdGEocm93OiBCaWxsRGF0YVJvdywgYmlsbEluZm86IEJpbGxJbmZvKSB7XHJcbiAgICBsZXQgaGFzQ2hpbGREYXRhID0gZmFsc2U7XHJcblxyXG4gICAgY29uc3Qgc2NoZW1hID0gdGhpcy5nZXRCaWxsVHJhY2tlclNjaGVtYShiaWxsSW5mbyk7XHJcbiAgICBsZXQgY2hpbGRyZW4gPSByb3cuR2V0Q2hpbGRUYWJsZUxpc3QoKTtcclxuICAgIGZvciAobGV0IGMgb2YgY2hpbGRyZW4pIHtcclxuICAgICAgbGV0IHRhYmxlU2hvdyA9IGZhbHNlO1xyXG4gICAgICBsZXQgaGFzUm93cyA9IGZhbHNlO1xyXG4gICAgICBsZXQgdGFibGUgPSBzY2hlbWEgJiYgc2NoZW1hW2MudGFibGVOYW1lXTtcclxuICAgICAgaWYgKHRhYmxlICE9IG51bGwgJiYgdGFibGUuc2hvdyAhPSBudWxsKSB7XHJcbiAgICAgICAgdGFibGVTaG93ID0gdGFibGUuc2hvdztcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyDlhbzlrrnml6BzaG935bGe5oCn5oOF5b2iXHJcbiAgICAgICAgdGFibGVTaG93ID0gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoYy5HZXRSb3dMaXN0KCkgJiYgYy5HZXRSb3dMaXN0KCkubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIGhhc1Jvd3MgPSB0cnVlO1xyXG4gICAgICB9XHJcbiAgICAgIGhhc0NoaWxkRGF0YSA9IHRhYmxlU2hvdyAmJiBoYXNSb3dzO1xyXG4gICAgICBpZiAoaGFzQ2hpbGREYXRhID09IHRydWUpIHtcclxuICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGhhc0NoaWxkRGF0YTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRGaWVsZFZhbHVlKGY6IEJpbGxTY2hlbWFGaWVsZEJhc2UsIHJkZm06IHsgW2tleTogc3RyaW5nXTogQmlsbERhdGFGaWVsZDsgfSwgd2hvbGVGaWVsZHM/OiBCaWxsU2NoZW1hRmllbGRCYXNlW10pIHtcclxuICAgIGxldCBmaWVsZHMgPSBmLmZpZWxkUGF0aCA/IGYuZmllbGRQYXRoLnNwbGl0KFwiLlwiKSA6IFtmLmZpZWxkTmFtZV07XHJcblxyXG4gICAgbGV0IGJkZjogQmlsbERhdGFGaWVsZCB8IEJpbGxEYXRhU3ViRmllbGQgPSBmaWVsZHMgJiYgcmRmbVtmaWVsZHNbMF1dO1xyXG4gICAgZm9yIChsZXQgaSA9IDE7IGJkZiAhPSBudWxsICYmIGkgPCBmaWVsZHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgY29uc3QgdGVtcCA9IGJkZi5HZXRTdWJGaWVsZE1hcCgpO1xyXG4gICAgICBpZiAodGVtcCA9PSBudWxsKSB7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgICAgYmRmID0gdGVtcFtmaWVsZHNbaV1dO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHRleHRWYWx1ZSA9IGJkZiA/IGJkZi5HZXRUZXh0VmFsdWUoKSA6IFwiXCI7XHJcbiAgICBpZiAodGV4dFZhbHVlID09IG51bGwpIHtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcbiAgICBpZiAoZi5kYXRhVHlwZSA9PSBEYXRhVHlwZS5TdHJpbmcpIHtcclxuICAgICAgaWYgKGYuZm9ybWF0SW5mbyAhPSBudWxsKSB7XHJcbiAgICAgICAgY29uc3Qgc3RyaW5nTWFwRm9ybWF0dGVyID0gZi5mb3JtYXRJbmZvLnN0cmluZ01hcEZvcm1hdHRlcjtcclxuICAgICAgICBpZiAoc3RyaW5nTWFwRm9ybWF0dGVyICE9IG51bGwpIHtcclxuICAgICAgICAgIGNvbnN0IHYgPSBzdHJpbmdNYXBGb3JtYXR0ZXJbdGV4dFZhbHVlXSB8fCB0ZXh0VmFsdWU7XHJcbiAgICAgICAgICBmLmZpZWxkVmFsdWUgPSB2O1xyXG4gICAgICAgICAgcmV0dXJuIHY7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGYuZmllbGRWYWx1ZSA9IHRleHRWYWx1ZTtcclxuICAgICAgICAgIHJldHVybiB0ZXh0VmFsdWUgfHwgXCJcIjtcclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgZi5maWVsZFZhbHVlID0gdGV4dFZhbHVlO1xyXG4gICAgICAgIHJldHVybiB0ZXh0VmFsdWUgfHwgXCJcIjtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIGlmIChmLmRhdGFUeXBlID09IERhdGFUeXBlLkRlY2ltYWwpIHtcclxuICAgICAgbGV0IHNjYWxlID0gZi5zY2FsZTtcclxuICAgICAgaWYgKGYuZm9ybWF0SW5mbyAhPSBudWxsKSB7XHJcbiAgICAgICAgaWYgKGYuZm9ybWF0SW5mby5zY2FsZSAhPSBudWxsKSB7XHJcbiAgICAgICAgICBzY2FsZSA9IGYuZm9ybWF0SW5mby5zY2FsZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGYuZm9ybWF0SW5mby5lbmFibGVTY2FsZUV4cHJlc3Npb24pIHtcclxuICAgICAgICAgIGlmIChmLmZvcm1hdEluZm8uc2NhbGVFeHByZXNzaW9uICE9IG51bGwpIHtcclxuICAgICAgICAgICAgY29uc3Qgc2NhbGVGaWVsZCA9IHRoaXMuZ2V0RmllbGRJbkZpZWxkcyh3aG9sZUZpZWxkcywgZi5mb3JtYXRJbmZvLnNjYWxlRXhwcmVzc2lvbik7XHJcbiAgICAgICAgICAgIGNvbnN0IHRtcCA9IHNjYWxlRmllbGQgJiYgcGFyc2VJbnQoU3RyaW5nKHRoaXMuZ2V0RmllbGRWYWx1ZShzY2FsZUZpZWxkLCByZGZtKSkpO1xyXG4gICAgICAgICAgICAvLyBjb25zdCB0bXAgPSBwYXJzZUludCh0aGlzLmdldEZpZWxkVmFsdWVJbkZpZWxkc1dpdGhWYWx1ZShleHRhY3RlZEZpZWxkcywgZi5mb3JtYXRJbmZvLnNjYWxlRXhwcmVzc2lvbikpO1xyXG4gICAgICAgICAgICBpZiAodG1wICE9IG51bGwgJiYgIWlzTmFOKHRtcCkpIHtcclxuICAgICAgICAgICAgICBzY2FsZSA9IHRtcDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBmLmZpZWxkVmFsdWUgPSBwYXJzZUZsb2F0KFN0cmluZyh0ZXh0VmFsdWUpKTtcclxuICAgICAgbGV0IGRlYyA9IHBhcnNlRmxvYXQoU3RyaW5nKHRleHRWYWx1ZSkpLnRvRml4ZWQoc2NhbGUpLnRvU3RyaW5nKCk7XHJcbiAgICAgIHJldHVybiBkZWMgfHwgXCJcIjtcclxuICAgIH0gZWxzZSBpZiAoZi5kYXRhVHlwZSA9PSBEYXRhVHlwZS5Cb29sZWFuKSB7XHJcbiAgICAgIGlmICh0ZXh0VmFsdWUgPT0gXCJcIikge1xyXG4gICAgICAgIGYuZmllbGRWYWx1ZSA9IG51bGw7XHJcbiAgICAgICAgcmV0dXJuIHRleHRWYWx1ZTtcclxuICAgICAgfVxyXG4gICAgICBmLmZpZWxkVmFsdWUgPSBKU09OLnBhcnNlKHRleHRWYWx1ZSkgYXMgYm9vbGVhbjtcclxuICAgICAgcmV0dXJuIEpTT04ucGFyc2UodGV4dFZhbHVlKSBhcyBib29sZWFuO1xyXG4gICAgfSBlbHNlIGlmIChmLmRhdGFUeXBlID09IERhdGFUeXBlLkRhdGVUaW1lKSB7XHJcbiAgICAgIGxldCBkYXRlID0gQnBtbk1vZGVsSnNvbkhlbHBlci5EYXRlVGltZUZyb21TdHJpbmcodGV4dFZhbHVlKTtcclxuICAgICAgbGV0IGZvcm1hdHRlciA9IFwieXl5eS1NTS1kZFwiO1xyXG4gICAgICBmb3JtYXR0ZXIgPSBmLmZvcm1hdEluZm8gJiYgZi5mb3JtYXRJbmZvLmRhdGVGb3JtYXR0ZXIgfHwgXCJ5eXl5LU1NLWRkXCI7XHJcbiAgICAgIC8vIGlmIChmLmZpZWxkVHlwZSA9PSBcIkRhdGVUaW1lXCIpIHtcclxuICAgICAgLy8gICAgIGZvcm1hdHRlciA9IGYuZm9ybWF0SW5mbyAmJiBmLmZvcm1hdEluZm8uZGF0ZUZvcm1hdHRlciB8fCBcInl5eXktTU0tZGQgSEg6bW06c3MuU1NTXCI7XHJcbiAgICAgIC8vIH0gZWxzZSBpZiAoZi5maWVsZFR5cGUgPT0gXCJEYXRlXCIpIHtcclxuICAgICAgLy8gICAgIGZvcm1hdHRlciA9IGYuZm9ybWF0SW5mbyAmJiBmLmZvcm1hdEluZm8uZGF0ZUZvcm1hdHRlciB8fCBcInl5eXktTU0tZGRcIjtcclxuICAgICAgLy8gfSBlbHNlIHtcclxuICAgICAgLy8gICAgIGZvcm1hdHRlciA9IGYuZm9ybWF0SW5mbyAmJiBmLmZvcm1hdEluZm8uZGF0ZUZvcm1hdHRlciB8fCBcInl5eXktTU0tZGRcIjtcclxuICAgICAgLy8gfVxyXG4gICAgICBmLmZpZWxkVmFsdWUgPSBkYXRlO1xyXG4gICAgICByZXR1cm4gdGhpcy5kYXRlRm9ybWF0KGRhdGUsIGZvcm1hdHRlcik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBmLmZpZWxkVmFsdWUgPSB0ZXh0VmFsdWU7XHJcbiAgICAgIHJldHVybiB0ZXh0VmFsdWUgfHwgXCJcIjtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOagueaNrmZ1bGxQYXRo5Zyo5a2X5q615YiX6KGo5Lit5p+l5om+55uu5qCH5a2X5q61XHJcbiAgICogQHBhcmFtIGZpZWxkc1xyXG4gICAqIEBwYXJhbSBmdWxsUGF0aFxyXG4gICAqIEByZXR1cm5zXHJcbiAgICovXHJcbiAgcHVibGljIGdldEZpZWxkSW5GaWVsZHMoZmllbGRzOiBCaWxsU2NoZW1hRmllbGRCYXNlW10sIGZ1bGxQYXRoOiBzdHJpbmcpIHtcclxuICAgIGxldCB2ID0gbnVsbDtcclxuICAgIGZvciAobGV0IGZ2IG9mIGZpZWxkcykge1xyXG4gICAgICBjb25zdCBjdXJGdiA9IGZ2IGFzIChCaWxsU2NoZW1hRmllbGQgfCBCaWxsU2NoZW1hU3ViRmllbGQpO1xyXG4gICAgICAvLyDmn6Xmib7moLnlrZfmrrVcclxuICAgICAgbGV0IHRtcEZ2OiBCaWxsU2NoZW1hRmllbGRCYXNlID0gZnY7XHJcbiAgICAgIHdoaWxlICh0bXBGdi5hdHRhY2hlZEZpZWxkKSB7XHJcbiAgICAgICAgdG1wRnYgPSB0bXBGdi5hdHRhY2hlZEZpZWxkO1xyXG4gICAgICB9XHJcbiAgICAgIGNvbnN0IHJvb3RGdiA9IHRtcEZ2IGFzIEJpbGxTY2hlbWFGaWVsZDtcclxuICAgICAgLy8g5pu05pawZnVsbFBhdGhcclxuICAgICAgY3VyRnYuZnVsbFBhdGggPSBmdWxsUGF0aFByZWZpeCArIHJvb3RGdi5hdHRhY2hlZFRhYmxlLnRhYmxlTmFtZSArIFwiLlwiICsgY3VyRnYuZmllbGRQYXRoO1xyXG4gICAgICAvLyDlr7nmr5TlvZPliY3lrZfmrrVmdWxsUGF0aOS4juebruagh2Z1bGxQYXRoXHJcbiAgICAgIGlmIChmdWxsUGF0aCA9PSBjdXJGdi5mdWxsUGF0aCkge1xyXG4gICAgICAgIHYgPSBjdXJGdjtcclxuICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgICAvLyDpgJLlvZLmn6Xmib7lrZDlrZfmrrVcclxuICAgICAgY29uc3Qgc3ViRmxkcyA9IGN1ckZ2LkdldFN1YkZpZWxkTGlzdCgpO1xyXG4gICAgICBpZiAoc3ViRmxkcyAmJiBzdWJGbGRzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICB2ID0gdGhpcy5nZXRGaWVsZEluRmllbGRzKHN1YkZsZHMsIGZ1bGxQYXRoKTtcclxuICAgICAgICBpZiAodiAhPSBudWxsKSB7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiB2O1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldEZpZWxkVmFsdWVJbkZpZWxkc1dpdGhWYWx1ZShmaWVsZHNXaXRoVmFsdWU6IEJpbGxTY2hlbWFGaWVsZEJhc2VbXSwgZnVsbFBhdGg6IHN0cmluZykge1xyXG4gICAgbGV0IHYgPSBudWxsO1xyXG4gICAgZm9yIChsZXQgZnYgb2YgZmllbGRzV2l0aFZhbHVlKSB7XHJcbiAgICAgIHdoaWxlIChmdi5hdHRhY2hlZEZpZWxkKSB7XHJcbiAgICAgICAgZnYgPSBmdi5hdHRhY2hlZEZpZWxkO1xyXG4gICAgICB9XHJcbiAgICAgIGNvbnN0IHJvb3RGdiA9IGZ2IGFzIEJpbGxTY2hlbWFGaWVsZDtcclxuICAgICAgcm9vdEZ2LmZ1bGxQYXRoID0gZnVsbFBhdGhQcmVmaXggKyByb290RnYuYXR0YWNoZWRUYWJsZS50YWJsZU5hbWUgKyBcIi5cIiArIHJvb3RGdi5maWVsZFBhdGg7XHJcbiAgICAgIGlmIChmdWxsUGF0aCA9PSByb290RnYuZnVsbFBhdGgpIHtcclxuICAgICAgICB2ID0gcm9vdEZ2LmZpZWxkVmFsdWU7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiB2O1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldEJhc2ljSW5mb0ZpZWxkc1dpdGhWYWx1ZShiaWxsSW5mbzogQmlsbEluZm8sIHNjaGVtYVRhYmxlOiBCaWxsU2NoZW1hVGFibGUsIGRhdGFUYWJsZTogQmlsbERhdGFUYWJsZSwgZmlsdGVyRmllbGRzOiBib29sZWFuID0gdHJ1ZSk6IChCaWxsU2NoZW1hRmllbGQgfCBCaWxsU2NoZW1hU3ViRmllbGQpW10ge1xyXG4gICAgY29uc3QgZmllbGRzV2l0aFZhbHVlOiAoQmlsbFNjaGVtYUZpZWxkIHwgQmlsbFNjaGVtYVN1YkZpZWxkKVtdID0gW107XHJcbiAgICAvLyDljZXmja7ov73ouKrphY3nva5cclxuICAgIGxldCBidHM6IEJpbGxUcmFja2luZ1NldHRpbmdzID0gbmV3IEJpbGxUcmFja2luZ1NldHRpbmdzKCk7XHJcbiAgICBpZiAoYmlsbEluZm8gJiYgYmlsbEluZm8uYmlsbFRyYWNraW5nU2V0dGluZ3MpIHtcclxuICAgICAgYnRzLkxvYWRGcm9tSnNvbihiaWxsSW5mby5iaWxsVHJhY2tpbmdTZXR0aW5ncyk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3Qgc2NoZW1hID0gdGhpcy5nZXRCaWxsVHJhY2tlclNjaGVtYShiaWxsSW5mbyk7XHJcbiAgICBsZXQgc2VsZWN0ZWRGaWVsZHMgPSBzY2hlbWEgJiYgc2NoZW1hW3NjaGVtYVRhYmxlLnRhYmxlTmFtZV0gJiYgc2NoZW1hW3NjaGVtYVRhYmxlLnRhYmxlTmFtZV0uZmllbGRzO1xyXG4gICAgc2VsZWN0ZWRGaWVsZHMgPSBzZWxlY3RlZEZpZWxkcyA/IHNlbGVjdGVkRmllbGRzIDogW107XHJcbiAgICBsZXQgc2hvd0N1c3RvbUZpZWxkcyA9IGJ0cy5iaWxsVHJhY2tpbmdEYXRhU2hvd25Nb2RlID09PSBCaWxsVHJhY2tpbmdEYXRhU2hvd25Nb2RlLkNVU1RPTUZJRUxEO1xyXG5cclxuICAgIC8vIOaJgOacieWtl+autVxyXG4gICAgY29uc3QgZnMgPSBzY2hlbWFUYWJsZS5nZXRGaWVsZExpc3QoKTtcclxuICAgIGNvbnN0IHIgPSBkYXRhVGFibGUuR2V0Um93TGlzdCgpWzBdO1xyXG4gICAgLy8g5Li76KGo5a2X5q61XHJcbiAgICBjb25zdCByZGZtID0gci5HZXRGaWVsZE1hcCgpO1xyXG5cclxuICAgIC8vIOaPkOWPluWxleekuuWtl+autVxyXG4gICAgY29uc3QgZmZzID0gdGhpcy5leHRyYWN0RkZpZWxkcyhmcywgc2VsZWN0ZWRGaWVsZHMsIHNob3dDdXN0b21GaWVsZHMpO1xyXG4gICAgLy8g6I635Y+W5a2X5q615YC8XHJcbiAgICAvLyDlhYjop6PmnpDlhbbku5bnsbvlnovlrZfmrrVcclxuICAgIGNvbnN0IGRlY2ltYWxGZnMgPSBbXTtcclxuICAgIGZmcy5mb3JFYWNoKGZmID0+IHtcclxuICAgICAgaWYgKGZmLmRhdGFUeXBlID09IERhdGFUeXBlLkRlY2ltYWwpIHtcclxuICAgICAgICBkZWNpbWFsRmZzLnB1c2goZmYpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGZmLmZpZWxkVmFsdWUgPSB0aGlzLmdldEZpZWxkVmFsdWUoZmYsIHJkZm0pO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIC8vIOWGjeino+aekOa1rueCueaVsOWtl+autVxyXG4gICAgZGVjaW1hbEZmcy5mb3JFYWNoKGZmID0+IHtcclxuICAgICAgZmYuZmllbGRWYWx1ZSA9IHRoaXMuZ2V0RmllbGRWYWx1ZShmZiwgcmRmbSwgZnMpO1xyXG4gICAgfSk7XHJcbiAgICBmaWVsZHNXaXRoVmFsdWUucHVzaCguLi5mZnMpO1xyXG5cclxuICAgIHJldHVybiBmaWVsZHNXaXRoVmFsdWU7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc2V0RXh0ZW5kUHJvcHMoZjogQmlsbFNjaGVtYUZpZWxkIHwgQmlsbFNjaGVtYVN1YkZpZWxkLCBzZjogQmlsbFNjaGVtYUZpZWxkIHwgQmlsbFNjaGVtYVN1YkZpZWxkLCBmaWVsZFBhdGg6IHN0cmluZywgcmRmbT86IHsgW2tleTogc3RyaW5nXTogQmlsbERhdGFGaWVsZDsgfSkge1xyXG4gICAgZi5jYXB0aW9uUGF0aCA9IHRoaXMuZXh0cmFjdENhcHRpb25QYXRoKGYpO1xyXG4gICAgZi5maWVsZFBhdGggPSBmaWVsZFBhdGg7XHJcbiAgICBpZiAoc2YpIHtcclxuICAgICAgZi5kaXNwbGF5TmFtZSA9IHNmLmRpc3BsYXlOYW1lO1xyXG4gICAgICBmLmkxOG5Db2xzID0gc2YuaTE4bkNvbHM7XHJcbiAgICAgIGYuZm9ybWF0SW5mbyA9IHNmLmZvcm1hdEluZm87XHJcbiAgICAgIGYub3JkZXIgPSBzZi5vcmRlcjtcclxuICAgIH1cclxuICAgIGlmIChyZGZtKSB7XHJcbiAgICAgIGYuZmllbGRWYWx1ZSA9IHRoaXMuZ2V0RmllbGRWYWx1ZShmLCByZGZtKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gZjtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWtl+auteWIl+ihqOaMiW9yZGVy5bGe5oCn5o6S5bqPXHJcbiAgICogQHBhcmFtIGZpZWxkc1dpdGhWYWx1ZVxyXG4gICAqIEByZXR1cm5zXHJcbiAgICovXHJcbiAgcHVibGljIHNvcnRGaWVsZHNCeU9yZGVyKGZpZWxkc1dpdGhWYWx1ZTogKEJpbGxTY2hlbWFGaWVsZCB8IEJpbGxTY2hlbWFTdWJGaWVsZClbXSk6IChCaWxsU2NoZW1hRmllbGQgfCBCaWxsU2NoZW1hU3ViRmllbGQpW10ge1xyXG4gICAgcmV0dXJuIGZpZWxkc1dpdGhWYWx1ZS5zb3J0KChhLCBiKSA9PiB7XHJcbiAgICAgIGlmIChhLm9yZGVyICE9IG51bGwgJiYgYi5vcmRlciAhPSBudWxsKSB7XHJcbiAgICAgICAgcmV0dXJuIGEub3JkZXIgLSBiLm9yZGVyO1xyXG4gICAgICB9IGVsc2UgaWYgKGEub3JkZXIgIT0gbnVsbCAmJiBiLm9yZGVyID09IG51bGwpIHtcclxuICAgICAgICByZXR1cm4gLTE7XHJcbiAgICAgIH0gZWxzZSBpZiAoYS5vcmRlciA9PSBudWxsICYmIGIub3JkZXIgIT0gbnVsbCkge1xyXG4gICAgICAgIHJldHVybiAxO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJldHVybiAwO1xyXG4gICAgICB9XHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgcHVibGljIGRhdGVGb3JtYXQoZGF0ZTogRGF0ZSwgZm10OiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgbGV0IHJldDtcclxuICAgIGNvbnN0IG9wdCA9IHtcclxuICAgICAgXCJ5K1wiOiBkYXRlLmdldFVUQ0Z1bGxZZWFyKCkudG9TdHJpbmcoKSwgICAgICAgIC8vIOW5tFxyXG4gICAgICBcIk0rXCI6IChkYXRlLmdldFVUQ01vbnRoKCkgKyAxKS50b1N0cmluZygpLCAgICAgLy8g5pyIXHJcbiAgICAgIFwiZCtcIjogZGF0ZS5nZXRVVENEYXRlKCkudG9TdHJpbmcoKSwgICAgICAgICAgICAvLyDml6VcclxuICAgICAgXCJIK1wiOiBkYXRlLmdldFVUQ0hvdXJzKCkudG9TdHJpbmcoKSwgICAgICAgICAgIC8vIOaXtlxyXG4gICAgICBcIm0rXCI6IGRhdGUuZ2V0VVRDTWludXRlcygpLnRvU3RyaW5nKCksICAgICAgICAgLy8g5YiGXHJcbiAgICAgIFwicytcIjogZGF0ZS5nZXRVVENTZWNvbmRzKCkudG9TdHJpbmcoKSwgICAgICAgICAvLyDnp5JcclxuICAgICAgXCJTK1wiOiBkYXRlLmdldFVUQ01pbGxpc2Vjb25kcygpLnRvU3RyaW5nKCksICAgIC8vIOenklxyXG4gICAgICAvLyDmnInlhbbku5bmoLzlvI/ljJblrZfnrKbpnIDmsYLlj6/ku6Xnu6fnu63mt7vliqDvvIzlv4XpobvovazljJbmiJDlrZfnrKbkuLJcclxuICAgIH07XHJcbiAgICBmb3IgKGxldCBrIGluIG9wdCkge1xyXG4gICAgICByZXQgPSBuZXcgUmVnRXhwKFwiKFwiICsgayArIFwiKVwiKS5leGVjKGZtdCk7XHJcbiAgICAgIGlmIChyZXQpIHtcclxuICAgICAgICBpZiAoIVN0cmluZy5wcm90b3R5cGUucGFkU3RhcnQpIHtcclxuICAgICAgICAgIGZtdCA9IGZtdC5yZXBsYWNlKHJldFsxXSwgKHJldFsxXS5sZW5ndGggPT0gMSkgPyAob3B0W2tdKSA6ICh0aGlzLm15UGFkU3RhcnQob3B0W2tdLCByZXRbMV0ubGVuZ3RoLCBcIjBcIikpKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgZm10ID0gZm10LnJlcGxhY2UocmV0WzFdLCAocmV0WzFdLmxlbmd0aCA9PSAxKSA/IChvcHRba10pIDogKG9wdFtrXS5wYWRTdGFydChyZXRbMV0ubGVuZ3RoLCBcIjBcIikpKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBmbXQ7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgbXlQYWRTdGFydChzcmM6IHN0cmluZywgdGFyZ2V0TGVuZ3RoOiBudW1iZXIsIHBhZFN0cmluZzogc3RyaW5nKSB7XHJcbiAgICB0YXJnZXRMZW5ndGggPSB0YXJnZXRMZW5ndGggPj4gMDsgLy9mbG9vciBpZiBudW1iZXIgb3IgY29udmVydCBub24tbnVtYmVyIHRvIDA7XHJcbiAgICBwYWRTdHJpbmcgPSBTdHJpbmcodHlwZW9mIHBhZFN0cmluZyAhPT0gJ3VuZGVmaW5lZCcgPyBwYWRTdHJpbmcgOiAnICcpO1xyXG4gICAgaWYgKHNyYy5sZW5ndGggPiB0YXJnZXRMZW5ndGgpIHtcclxuICAgICAgcmV0dXJuIFN0cmluZyhzcmMpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGFyZ2V0TGVuZ3RoID0gdGFyZ2V0TGVuZ3RoIC0gc3JjLmxlbmd0aDtcclxuICAgICAgaWYgKHRhcmdldExlbmd0aCA+IHBhZFN0cmluZy5sZW5ndGgpIHtcclxuICAgICAgICBwYWRTdHJpbmcgKz0gcGFkU3RyaW5nLnJlcGVhdCh0YXJnZXRMZW5ndGggLyBwYWRTdHJpbmcubGVuZ3RoKTsgLy9hcHBlbmQgdG8gb3JpZ2luYWwgdG8gZW5zdXJlIHdlIGFyZSBsb25nZXIgdGhhbiBuZWVkZWRcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gcGFkU3RyaW5nLnNsaWNlKDAsIHRhcmdldExlbmd0aCkgKyBTdHJpbmcoc3JjKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOino+aekOWtl+auteWQjeensFxyXG4gICAqIEBwYXJhbSBmXHJcbiAgICogQHBhcmFtIGxhbmdDb2RlXHJcbiAgICogQHJldHVybnNcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0RmllbGRMYWJlbChmOiBCaWxsU2NoZW1hRmllbGQgfCBCaWxsU2NoZW1hU3ViRmllbGQsIGxhbmdDb2RlPzogc3RyaW5nKSB7XHJcbiAgICByZXR1cm4gKGxhbmdDb2RlICYmIGYuaTE4bkNvbHMgJiYgZi5pMThuQ29scy5jb2xJMThuVmFsdWVzLmRpc3BsYXlOYW1lICYmXHJcbiAgICAgIGYuaTE4bkNvbHMuY29sSTE4blZhbHVlcy5kaXNwbGF5TmFtZVtsYW5nQ29kZV0pIHx8IGYuZGlzcGxheU5hbWUgfHwgZi5jYXB0aW9uUGF0aCB8fCBmLmNhcHRpb25cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOino+aekOihqOWQjeensFxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRUYWJsZUxhYmVsKGJpbGxJbmZvOiBCaWxsSW5mbywgc2NoZW1hVGFibGU6IEJpbGxTY2hlbWFUYWJsZSwgbGFuZ0NvZGU/OiBzdHJpbmcpIHtcclxuICAgIGNvbnN0IHNjaGVtYSA9IHRoaXMuZ2V0QmlsbFRyYWNrZXJTY2hlbWEoYmlsbEluZm8pO1xyXG4gICAgbGV0IHRhYmxlID0gc2NoZW1hICYmIHNjaGVtYVtzY2hlbWFUYWJsZS50YWJsZU5hbWVdO1xyXG4gICAgaWYgKHRhYmxlICE9IG51bGwpIHtcclxuICAgICAgY29uc3QgaTE4bkNvbHMgPSB0YWJsZS5pMThuQ29scztcclxuICAgICAgY29uc3QgdG1wID0gKGxhbmdDb2RlICYmIGkxOG5Db2xzICYmIGkxOG5Db2xzLmNvbEkxOG5WYWx1ZXMuZGlzcGxheU5hbWUgJiYgaTE4bkNvbHMuY29sSTE4blZhbHVlcy5kaXNwbGF5TmFtZVtsYW5nQ29kZV0pIHx8IHRhYmxlLmRpc3BsYXlOYW1lIHx8IHRhYmxlLmNhcHRpb24gfHwgdGFibGUuY29kZTtcclxuICAgICAgcmV0dXJuIHRtcDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiBzY2hlbWFUYWJsZS5jYXB0aW9uO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+W6Kej5p6Q5Y+v5bGV56S65a2Q6KGoXHJcbiAgICovXHJcbiAgcHVibGljIGdldENoaWxkVGFibGVzKGJpbGxJbmZvOiBCaWxsSW5mbywgc2NoZW1hVGFibGU6IEJpbGxTY2hlbWFUYWJsZSkge1xyXG4gICAgbGV0IHJlc3VsdDogQmlsbFNjaGVtYVRhYmxlW10gPSBbXTtcclxuXHJcbiAgICBjb25zdCBzY2hlbWEgPSB0aGlzLmdldEJpbGxUcmFja2VyU2NoZW1hKGJpbGxJbmZvKTtcclxuICAgIGNvbnN0IGNoaWxkcmVuID0gc2NoZW1hVGFibGUuR2V0Q2hpbGRUYWJsZUxpc3QoKTtcclxuICAgIGNoaWxkcmVuICYmIGNoaWxkcmVuLmZvckVhY2goKGNoaWxkKSA9PiB7XHJcbiAgICAgIGxldCB0cmFja2VyVGFibGUgPSBzY2hlbWEgJiYgc2NoZW1hW2NoaWxkLnRhYmxlTmFtZV07XHJcbiAgICAgIGlmICh0cmFja2VyVGFibGUgIT0gbnVsbCAmJiB0cmFja2VyVGFibGUuc2hvdyAhPSBudWxsKSB7XHJcbiAgICAgICAgaWYgKHRyYWNrZXJUYWJsZS5zaG93ID09IHRydWUpIHtcclxuICAgICAgICAgIGNoaWxkLm9yZGVyID0gdHJhY2tlclRhYmxlLm9yZGVyO1xyXG4gICAgICAgICAgcmVzdWx0LnB1c2goY2hpbGQpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyDlhbzlrrnml6BzaG935bGe5oCn5oOF5b2iXHJcbiAgICAgICAgcmVzdWx0LnB1c2goY2hpbGQpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXN1bHQgPSB0aGlzLnNvcnRUYWJsZXNCeU9yZGVyKHJlc3VsdCk7XHJcblxyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOihqOaMiXNvcnTlrZfmrrXmjpLluo9cclxuICAgKiBAcGFyYW0gc2NoZW1hVGFibGVzXHJcbiAgICogQHJldHVybnNcclxuICAgKi9cclxuICBwdWJsaWMgc29ydFRhYmxlc0J5T3JkZXIoc2NoZW1hVGFibGVzOiBCaWxsU2NoZW1hVGFibGVbXSk6IEJpbGxTY2hlbWFUYWJsZVtdIHtcclxuICAgIHJldHVybiBzY2hlbWFUYWJsZXMuc29ydCgoYSwgYikgPT4ge1xyXG4gICAgICBpZiAoYS5vcmRlciAhPSBudWxsICYmIGIub3JkZXIgIT0gbnVsbCkge1xyXG4gICAgICAgIHJldHVybiBhLm9yZGVyIC0gYi5vcmRlcjtcclxuICAgICAgfSBlbHNlIGlmIChhLm9yZGVyICE9IG51bGwgJiYgYi5vcmRlciA9PSBudWxsKSB7XHJcbiAgICAgICAgcmV0dXJuIC0xO1xyXG4gICAgICB9IGVsc2UgaWYgKGEub3JkZXIgPT0gbnVsbCAmJiBiLm9yZGVyICE9IG51bGwpIHtcclxuICAgICAgICByZXR1cm4gMTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXR1cm4gMDtcclxuICAgICAgfVxyXG4gICAgfSlcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6Kej5p6QYmlsbFRyYWNrZXJTY2hlbWFcclxuICAgKiBAcGFyYW0gYmlsbEluZm9cclxuICAgKi9cclxuICBwdWJsaWMgZ2V0QmlsbFRyYWNrZXJTY2hlbWEoYmlsbEluZm86IEJpbGxJbmZvKTogQmlsbFRyYWNrZXJTY2hlbWEge1xyXG4gICAgbGV0IGJ0czogQmlsbFRyYWNraW5nU2V0dGluZ3MgPSBuZXcgQmlsbFRyYWNraW5nU2V0dGluZ3MoKTtcclxuICAgIGlmIChiaWxsSW5mbyAmJiBiaWxsSW5mby5iaWxsVHJhY2tpbmdTZXR0aW5ncykge1xyXG4gICAgICBidHMuTG9hZEZyb21Kc29uKGJpbGxJbmZvLmJpbGxUcmFja2luZ1NldHRpbmdzKTtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgZmllbGRDb250ZW50ID0gYnRzLmN1c3RvbUZpZWxkQ29udGVudDtcclxuICAgIGxldCBmaWVsZENvbmZpZzogQmlsbFRyYWNrZXJTY2hlbWFGaWVsZENvbnRlbnQgPSBmaWVsZENvbnRlbnQgJiYgKHR5cGVvZiBmaWVsZENvbnRlbnQgPT0gXCJvYmplY3RcIiA/IGZpZWxkQ29udGVudCA6IEpTT04ucGFyc2UoZmllbGRDb250ZW50KSk7XHJcbiAgICBsZXQgc2NoZW1hID0gZmllbGRDb25maWcgJiYgZmllbGRDb25maWcuc2NoZW1hO1xyXG5cclxuICAgIHJldHVybiBzY2hlbWE7XHJcbiAgfVxyXG59XHJcbiJdfQ==