/**
 * @fileoverview added by tsickle
 * Generated from: lib/bif-manual-creation/components/pull-selector/pull-selector.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Inject, LOCALE_ID, ElementRef } from '@angular/core';
import { Subject } from 'rxjs';
import { SELECTOR_ARGS_INJECTOR } from '../../config/selector-args-injector.config';
import { BifDataService } from '../../service/bif-data.service';
import { FormGetBillCreationProcessEntityExArgs } from '../../../entity/form-rest/FormGetBillCreationProcessEntityExArgs';
import { LoadingService } from '@farris/ui-loading';
var PullSelectorComponent = /** @class */ (function () {
    function PullSelectorComponent(args, dataService, localeId, loading, elementRef) {
        var _this = this;
        this.dataService = dataService;
        this.loading = loading;
        this.elementRef = elementRef;
        //来源VoType列表
        this.voIdList = [];
        //来源VoType与来源VoName映射
        this.nameDict = {};
        //来源VoType与相应的生单规则列表映射
        this.entityDict = {};
        this.bsModalRef4BifSelector = null;
        this.subject4CreationProcess = new Subject();
        this.clickOk4BifSelector = (/**
         * @return {?}
         */
        function () {
            _this.subject4CreationProcess.next(_this.selectedEntity);
            _this.subject4CreationProcess.complete();
            _this.bsModalRef4BifSelector.close();
        });
        this.clickClose4BifSelector = (/**
         * @return {?}
         */
        function () {
            _this.bsModalRef4BifSelector.close();
        });
        this.args = new FormGetBillCreationProcessEntityExArgs();
        this.args.LoadFromJsonObject(args);
    }
    Object.defineProperty(PullSelectorComponent.prototype, "selectedVoId", {
        get: /**
         * @return {?}
         */
        function () {
            return this._selectedVoId;
        },
        set: /**
         * @param {?} voId
         * @return {?}
         */
        function (voId) {
            this._selectedVoId = voId;
            if (voId != null) {
                this.selectedEntity = this.entityDict[this._selectedVoId][0];
            }
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    PullSelectorComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.loadItems();
    };
    /**
     * @private
     * @return {?}
     */
    PullSelectorComponent.prototype.loadItems = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        this.loading.show({ container: this.elementRef });
        /** @type {?} */
        var list$ = null;
        if (this.args.upBillVoId == null) {
            // if (this.args.bizFlowchartId == null) {
            list$ = this.dataService.getSlimBillCreationProcessEntityExesByDownBillVoId4Pull(this.args.downBillVoId);
            // } else {
            // list$ = this.dataService.getSlimCreationRulesByTargetVoIdAndFlowchartId(this.args.targetVoId, this.args.bizFlowchartId);
            // }
        }
        else {
            // if (this.args.bizFlowchartId == null) {
            list$ = this.dataService.getSlimBillCreationProcessEntityExesByUpBillVoIdAndDownBillVoId4SpecificPull(this.args.upBillVoId, this.args.downBillVoId);
            // } else {
            // list$ = this.dataService.getSlimCreationRulesBySourceVoIdAndTargetVoIdAndFlowchartId(this.args.sourceVoId, this.args.targetVoId, this.args.bizFlowchartId);
            // }
        }
        list$.subscribe((/**
         * @param {?} result
         * @return {?}
         */
        function (result) {
            /** @type {?} */
            var list = result;
            list.forEach((/**
             * @param {?} elt
             * @return {?}
             */
            function (elt) {
                if (_this.voIdList.includes(elt.upBillVoId) === false) {
                    _this.voIdList.push(elt.upBillVoId);
                    _this.entityDict[elt.upBillVoId] = new Array();
                }
                _this.nameDict[elt.upBillVoId] = elt.upBillVoName;
                _this.entityDict[elt.upBillVoId].push(elt);
            }));
            _this.selectedVoId = _this.voIdList.length > 0 ? _this.voIdList[0] : null;
            _this.loading.close();
        }), (/**
         * @param {?} err
         * @return {?}
         */
        function (err) {
            _this.loading.close();
            throw err;
        }));
    };
    PullSelectorComponent.decorators = [
        { type: Component, args: [{
                    selector: 'lib-bif-pull-selector',
                    template: "<div class=\"g-main px-3 py-2\">\r\n  <!--  -->\r\n  <div class=\"form-group\" style=\"height: 150px;overflow-y: auto;\">\r\n    <div [hidden]=\"voIdList.length != 0\"><span style=\"color: red;\">{{ 'emptyResult' | locale }}</span></div>\r\n    <div>{{ 'selectUpstreamBill' | locale }}</div>\r\n    <div *ngFor=\"let voId of voIdList;let i=index\" class=\"col-sm-12 col-md-5 form-check form-check-inline\">\r\n      <input class=\"form-check-input\" type=\"radio\" [name]=\"'voId'+i\" [id]=\"voId\" [value]=\"voId\"\r\n        [(ngModel)]=\"selectedVoId\" />\r\n      <label class=\"form-check-label\" [for]=\"'voId'+i\">{{nameDict[voId]}}</label>\r\n    </div>\r\n  </div>\r\n\r\n  <!--  -->\r\n  <div class=\"form-group\" style=\"\">\r\n    <div>{{ 'selectCreationProcess' | locale }}</div>\r\n    <select class=\"form-control\" name=\"selectedEntity\" [(ngModel)]=\"selectedEntity\">\r\n      <option *ngFor=\"let cr of entityDict[selectedVoId];\" [ngValue]=\"cr\">\r\n        {{cr.name}}({{cr.code}})</option>\r\n    </select>\r\n  </div>\r\n\r\n  <!--  -->\r\n  <div class=\"form-group\" style=\"\">\r\n    <div>{{ 'processDesciption' | locale }}</div>\r\n    <textarea readonly class=\"form-control\" name=\"description\" rows=\"3\"\r\n      [ngModel]=\"selectedEntity&&selectedEntity.description\"></textarea>\r\n  </div>\r\n</div>",
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    PullSelectorComponent.ctorParameters = function () { return [
        { type: undefined, decorators: [{ type: Inject, args: [SELECTOR_ARGS_INJECTOR,] }] },
        { type: BifDataService },
        { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] },
        { type: LoadingService },
        { type: ElementRef }
    ]; };
    return PullSelectorComponent;
}());
export { PullSelectorComponent };
if (false) {
    /** @type {?} */
    PullSelectorComponent.prototype.voIdList;
    /** @type {?} */
    PullSelectorComponent.prototype.nameDict;
    /** @type {?} */
    PullSelectorComponent.prototype.entityDict;
    /**
     * @type {?}
     * @private
     */
    PullSelectorComponent.prototype._selectedVoId;
    /** @type {?} */
    PullSelectorComponent.prototype.selectedEntity;
    /** @type {?} */
    PullSelectorComponent.prototype.bsModalRef4BifSelector;
    /** @type {?} */
    PullSelectorComponent.prototype.subject4CreationProcess;
    /**
     * @type {?}
     * @private
     */
    PullSelectorComponent.prototype.args;
    /** @type {?} */
    PullSelectorComponent.prototype.clickOk4BifSelector;
    /** @type {?} */
    PullSelectorComponent.prototype.clickClose4BifSelector;
    /**
     * @type {?}
     * @private
     */
    PullSelectorComponent.prototype.dataService;
    /**
     * @type {?}
     * @private
     */
    PullSelectorComponent.prototype.loading;
    /**
     * @type {?}
     * @private
     */
    PullSelectorComponent.prototype.elementRef;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHVsbC1zZWxlY3Rvci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZWRwLWJpZi9ydW50aW1lLWFwaS8iLCJzb3VyY2VzIjpbImxpYi9iaWYtbWFudWFsLWNyZWF0aW9uL2NvbXBvbmVudHMvcHVsbC1zZWxlY3Rvci9wdWxsLXNlbGVjdG9yLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsTUFBTSxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFakYsT0FBTyxFQUFFLE9BQU8sRUFBYyxNQUFNLE1BQU0sQ0FBQztBQUMzQyxPQUFPLEVBQUUsc0JBQXNCLEVBQWdCLE1BQU0sNENBQTRDLENBQUM7QUFDbEcsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBRWhFLE9BQU8sRUFBRSxzQ0FBc0MsRUFBRSxNQUFNLGtFQUFrRSxDQUFDO0FBRTFILE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUVwRDtJQXVDRSwrQkFDa0MsSUFBa0IsRUFDMUMsV0FBMkIsRUFDaEIsUUFBZ0IsRUFDM0IsT0FBdUIsRUFDdkIsVUFBc0I7UUFMaEMsaUJBU0M7UUFQUyxnQkFBVyxHQUFYLFdBQVcsQ0FBZ0I7UUFFM0IsWUFBTyxHQUFQLE9BQU8sQ0FBZ0I7UUFDdkIsZUFBVSxHQUFWLFVBQVUsQ0FBWTs7UUFwQ2hDLGFBQVEsR0FBYSxFQUFFLENBQUM7O1FBR3hCLGFBQVEsR0FFSixFQUFFLENBQUM7O1FBR1AsZUFBVSxHQUVOLEVBQUUsQ0FBQztRQWlCUCwyQkFBc0IsR0FBZSxJQUFJLENBQUM7UUFDMUMsNEJBQXVCLEdBQWdELElBQUksT0FBTyxFQUFFLENBQUM7UUFrQnJGLHdCQUFtQjs7O1FBQUc7WUFDcEIsS0FBSSxDQUFDLHVCQUF1QixDQUFDLElBQUksQ0FBQyxLQUFJLENBQUMsY0FBYyxDQUFDLENBQUM7WUFDdkQs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RixLQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxDQUFDO1lBQ3JCLE1BQU0sR0FBRyxDQUFDO1FBQ1osQ0FBQyxFQUNGLENBQUM7SUFDSixDQUFDOztnQkFwR0YsU0FBUyxTQUFDO29CQUNULFFBQVEsRUFBRSx1QkFBdUI7b0JBQ2pDLHMwQ0FBNkM7O2lCQUU5Qzs7OztnREFvQ0ksTUFBTSxTQUFDLHNCQUFzQjtnQkE5Q3pCLGNBQWM7NkNBZ0RsQixNQUFNLFNBQUMsU0FBUztnQkE1Q1osY0FBYztnQkFSd0IsVUFBVTs7SUErR3pELDRCQUFDO0NBQUEsQUFyR0QsSUFxR0M7U0FoR1kscUJBQXFCOzs7SUFHaEMseUNBQXdCOztJQUd4Qix5Q0FFTzs7SUFHUCwyQ0FFTzs7Ozs7SUFHUCw4Q0FBOEI7O0lBWTlCLCtDQUFtRDs7SUFFbkQsdURBQTBDOztJQUMxQyx3REFBcUY7Ozs7O0lBRXJGLHFDQUFxRDs7SUFnQnJELG9EQUlFOztJQUVGLHVEQUVFOzs7OztJQXJCQSw0Q0FBbUM7Ozs7O0lBRW5DLHdDQUErQjs7Ozs7SUFDL0IsMkNBQThCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIEluamVjdCwgTE9DQUxFX0lELCBFbGVtZW50UmVmIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEJzTW9kYWxSZWYgfSBmcm9tICdAZmFycmlzL3VpLW1vZGFsJztcclxuaW1wb3J0IHsgU3ViamVjdCwgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBTRUxFQ1RPUl9BUkdTX0lOSkVDVE9SLCBTZWxlY3RvckFyZ3MgfSBmcm9tICcuLi8uLi9jb25maWcvc2VsZWN0b3ItYXJncy1pbmplY3Rvci5jb25maWcnO1xyXG5pbXBvcnQgeyBCaWZEYXRhU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2UvYmlmLWRhdGEuc2VydmljZSc7XHJcbmltcG9ydCB7IElSdFNsaW1CaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXggfSBmcm9tICdAZWRwLWJpZi9jb21tb24tYXBpJztcclxuaW1wb3J0IHsgRm9ybUdldEJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeEFyZ3MgfSBmcm9tICcuLi8uLi8uLi9lbnRpdHkvZm9ybS1yZXN0L0Zvcm1HZXRCaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXhBcmdzJztcclxuaW1wb3J0IHsgSUJpZkNyZWF0aW9uUHJvY2Vzc1NlbGVjdG9yQ29tcG9uZW50IH0gZnJvbSAnLi4vLi4vYmFzZS9JQmlmQ3JlYXRpb25Qcm9jZXNzU2VsZWN0b3JDb21wb25lbnQnO1xyXG5pbXBvcnQgeyBMb2FkaW5nU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbG9hZGluZyc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ2xpYi1iaWYtcHVsbC1zZWxlY3RvcicsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL3B1bGwtc2VsZWN0b3IuY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsczogWycuL3B1bGwtc2VsZWN0b3IuY29tcG9uZW50LmNzcyddXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBQdWxsU2VsZWN0b3JDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIElCaWZDcmVhdGlvblByb2Nlc3NTZWxlY3RvckNvbXBvbmVudCB7XHJcblxyXG4gIC8v5p2l5rqQVm9UeXBl5YiX6KGoXHJcbiAgdm9JZExpc3Q6IHN0cmluZ1tdID0gW107XHJcblxyXG4gIC8v5p2l5rqQVm9UeXBl5LiO5p2l5rqQVm9OYW1l5pig5bCEXHJcbiAgbmFtZURpY3Q6IHtcclxuICAgIFt2b0lkOiBzdHJpbmddOiBzdHJpbmdcclxuICB9ID0ge307XHJcblxyXG4gIC8v5p2l5rqQVm9UeXBl5LiO55u45bqU55qE55Sf5Y2V6KeE5YiZ5YiX6KGo5pig5bCEXHJcbiAgZW50aXR5RGljdDoge1xyXG4gICAgW3ZvSWQ6IHN0cmluZ106IElSdFNsaW1CaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXhbXVxyXG4gIH0gPSB7fTtcclxuXHJcbiAgLy/pgInkuK3nmoTmnaXmupBWb1R5cGVcclxuICBwcml2YXRlIF9zZWxlY3RlZFZvSWQ6IHN0cmluZztcclxuICBnZXQgc2VsZWN0ZWRWb0lkKCk6IHN0cmluZyB7XHJcbiAgICByZXR1cm4gdGhpcy5fc2VsZWN0ZWRWb0lkO1xyXG4gIH1cclxuICBzZXQgc2VsZWN0ZWRWb0lkKHZvSWQ6IHN0cmluZykge1xyXG4gICAgdGhpcy5fc2VsZWN0ZWRWb0lkID0gdm9JZDtcclxuICAgIGlmICh2b0lkICE9IG51bGwpIHtcclxuICAgICAgdGhpcy5zZWxlY3RlZEVudGl0eSA9IHRoaXMuZW50aXR5RGljdFt0aGlzLl9zZWxlY3RlZFZvSWRdWzBdO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy/pgInkuK3nmoTnlJ/ljZXop4TliJlcclxuICBzZWxlY3RlZEVudGl0eTogSVJ0U2xpbUJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeDtcclxuXHJcbiAgYnNNb2RhbFJlZjRCaWZTZWxlY3RvcjogQnNNb2RhbFJlZiA9IG51bGw7XHJcbiAgc3ViamVjdDRDcmVhdGlvblByb2Nlc3M6IFN1YmplY3Q8SVJ0U2xpbUJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeD4gPSBuZXcgU3ViamVjdCgpO1xyXG5cclxuICBwcml2YXRlIGFyZ3M6IEZvcm1HZXRCaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXhBcmdzO1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgQEluamVjdChTRUxFQ1RPUl9BUkdTX0lOSkVDVE9SKSBhcmdzOiBTZWxlY3RvckFyZ3MsXHJcbiAgICBwcml2YXRlIGRhdGFTZXJ2aWNlOiBCaWZEYXRhU2VydmljZSxcclxuICAgIEBJbmplY3QoTE9DQUxFX0lEKSBsb2NhbGVJZDogc3RyaW5nLFxyXG4gICAgcHJpdmF0ZSBsb2FkaW5nOiBMb2FkaW5nU2VydmljZSxcclxuICAgIHByaXZhdGUgZWxlbWVudFJlZjogRWxlbWVudFJlZixcclxuICApIHtcclxuICAgIHRoaXMuYXJncyA9IG5ldyBGb3JtR2V0QmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4QXJncygpO1xyXG4gICAgdGhpcy5hcmdzLkxvYWRGcm9tSnNvbk9iamVjdChhcmdzKTtcclxuICB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gICAgdGhpcy5sb2FkSXRlbXMoKTtcclxuICB9XHJcblxyXG4gIGNsaWNrT2s0QmlmU2VsZWN0b3IgPSAoKSA9PiB7XHJcbiAgICB0aGlzLnN1YmplY3Q0Q3JlYXRpb25Qcm9jZXNzLm5leHQodGhpcy5zZWxlY3RlZEVudGl0eSk7XHJcbiAgICB0aGlzLnN1YmplY3Q0Q3JlYXRpb25Qcm9jZXNzLmNvbXBsZXRlKCk7XHJcbiAgICB0aGlzLmJzTW9kYWxSZWY0QmlmU2VsZWN0b3IuY2xvc2UoKTtcclxuICB9O1xyXG5cclxuICBjbGlja0Nsb3NlNEJpZlNlbGVjdG9yID0gKCkgPT4ge1xyXG4gICAgdGhpcy5ic01vZGFsUmVmNEJpZlNlbGVjdG9yLmNsb3NlKCk7XHJcbiAgfTtcclxuXHJcbiAgcHJpdmF0ZSBsb2FkSXRlbXMoKTogdm9pZCB7XHJcbiAgICB0aGlzLmxvYWRpbmcuc2hvdyh7IGNvbnRhaW5lcjogdGhpcy5lbGVtZW50UmVmIH0pO1xyXG4gICAgbGV0IGxpc3QkOiBPYnNlcnZhYmxlPElSdFNsaW1CaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXhbXT4gPSBudWxsO1xyXG4gICAgaWYgKHRoaXMuYXJncy51cEJpbGxWb0lkID09IG51bGwpIHtcclxuICAgICAgLy8gaWYgKHRoaXMuYXJncy5iaXpGbG93Y2hhcnRJZCA9PSBudWxsKSB7XHJcbiAgICAgIGxpc3QkID0gdGhpcy5kYXRhU2VydmljZS5nZXRTbGltQmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4ZXNCeURvd25CaWxsVm9JZDRQdWxsKHRoaXMuYXJncy5kb3duQmlsbFZvSWQpO1xyXG4gICAgICAvLyB9IGVsc2Uge1xyXG4gICAgICAvLyBsaXN0JCA9IHRoaXMuZGF0YVNlcnZpY2UuZ2V0U2xpbUNyZWF0aW9uUnVsZXNCeVRhcmdldFZvSWRBbmRGbG93Y2hhcnRJZCh0aGlzLmFyZ3MudGFyZ2V0Vm9JZCwgdGhpcy5hcmdzLmJpekZsb3djaGFydElkKTtcclxuICAgICAgLy8gfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8gaWYgKHRoaXMuYXJncy5iaXpGbG93Y2hhcnRJZCA9PSBudWxsKSB7XHJcbiAgICAgIGxpc3QkID0gdGhpcy5kYXRhU2VydmljZS5nZXRTbGltQmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4ZXNCeVVwQmlsbFZvSWRBbmREb3duQmlsbFZvSWQ0U3BlY2lmaWNQdWxsKHRoaXMuYXJncy51cEJpbGxWb0lkLCB0aGlzLmFyZ3MuZG93bkJpbGxWb0lkKTtcclxuICAgICAgLy8gfSBlbHNlIHtcclxuICAgICAgLy8gbGlzdCQgPSB0aGlzLmRhdGFTZXJ2aWNlLmdldFNsaW1DcmVhdGlvblJ1bGVzQnlTb3VyY2VWb0lkQW5kVGFyZ2V0Vm9JZEFuZEZsb3djaGFydElkKHRoaXMuYXJncy5zb3VyY2VWb0lkLCB0aGlzLmFyZ3MudGFyZ2V0Vm9JZCwgdGhpcy5hcmdzLmJpekZsb3djaGFydElkKTtcclxuICAgICAgLy8gfVxyXG4gICAgfVxyXG4gICAgbGlzdCQuc3Vic2NyaWJlKFxyXG4gICAgICAocmVzdWx0OiBJUnRTbGltQmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4W10pID0+IHtcclxuICAgICAgICBjb25zdCBsaXN0ID0gcmVzdWx0O1xyXG4gICAgICAgIGxpc3QuZm9yRWFjaChlbHQgPT4ge1xyXG4gICAgICAgICAgaWYgKHRoaXMudm9JZExpc3QuaW5jbHVkZXMoZWx0LnVwQmlsbFZvSWQpID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICB0aGlzLnZvSWRMaXN0LnB1c2goZWx0LnVwQmlsbFZvSWQpO1xyXG4gICAgICAgICAgICB0aGlzLmVudGl0eURpY3RbZWx0LnVwQmlsbFZvSWRdID0gbmV3IEFycmF5PElSdFNsaW1CaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXg+KCk7XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgdGhpcy5uYW1lRGljdFtlbHQudXBCaWxsVm9JZF0gPSBlbHQudXBCaWxsVm9OYW1lO1xyXG4gICAgICAgICAgdGhpcy5lbnRpdHlEaWN0W2VsdC51cEJpbGxWb0lkXS5wdXNoKGVsdCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5zZWxlY3RlZFZvSWQgPSB0aGlzLnZvSWRMaXN0Lmxlbmd0aCA+IDAgPyB0aGlzLnZvSWRMaXN0WzBdIDogbnVsbDtcclxuICAgICAgICB0aGlzLmxvYWRpbmcuY2xvc2UoKTtcclxuICAgICAgfSxcclxuICAgICAgKGVycikgPT4ge1xyXG4gICAgICAgIHRoaXMubG9hZGluZy5jbG9zZSgpO1xyXG4gICAgICAgIHRocm93IGVycjtcclxuICAgICAgfVxyXG4gICAgKTtcclxuICB9XHJcbn1cclxuIl19