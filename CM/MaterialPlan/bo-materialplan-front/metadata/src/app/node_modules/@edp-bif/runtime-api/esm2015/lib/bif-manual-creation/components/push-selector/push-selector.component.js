/**
 * @fileoverview added by tsickle
 * Generated from: lib/bif-manual-creation/components/push-selector/push-selector.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Inject, LOCALE_ID, ElementRef } from '@angular/core';
import { Subject } from 'rxjs';
import { SELECTOR_ARGS_INJECTOR } from '../../config/selector-args-injector.config';
import { FormGetBillCreationProcessEntityExArgs } from '../../../entity/form-rest/FormGetBillCreationProcessEntityExArgs';
import { BifDataService } from '../../service/bif-data.service';
import { LoadingService } from '@farris/ui-loading';
export class PushSelectorComponent {
    /**
     * @param {?} args
     * @param {?} dataService
     * @param {?} localeId
     * @param {?} loading
     * @param {?} elementRef
     */
    constructor(args, dataService, localeId, loading, elementRef) {
        this.dataService = dataService;
        this.loading = loading;
        this.elementRef = elementRef;
        //目标VoId列表
        this.voIdList = [];
        //目标VoId与目标VoName映射
        this.nameDict = {};
        //目标VoId与相应的生单规则列表映射
        this.entityDict = {};
        this.bsModalRef4BifSelector = null;
        this.subject4CreationProcess = new Subject();
        this.clickOk4BifSelector = (/**
         * @return {?}
         */
        () => {
            this.subject4CreationProcess.next(this.selectedEntity);
            this.subject4CreationProcess.complete();
            this.bsModalRef4BifSelector.close();
        });
        this.clickClose4BifSelector = (/**
         * @return {?}
         */
        () => {
            this.bsModalRef4BifSelector.close();
        });
        this.args = new FormGetBillCreationProcessEntityExArgs();
        this.args.LoadFromJsonObject(args);
    }
    /**
     * @return {?}
     */
    get selectedVoId() {
        return this._selectedVoId;
    }
    /**
     * @param {?} id
     * @return {?}
     */
    set selectedVoId(id) {
        this._selectedVoId = id;
        if (id != null) {
            this.selectedEntity = this.entityDict[this._selectedVoId][0];
        }
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.loadItems();
    }
    /**
     * @private
     * @return {?}
     */
    loadItems() {
        this.loading.show({ container: this.elementRef });
        /** @type {?} */
        let list$ = null;
        if (this.args.downBillVoId == null) {
            // if (this.args.bizFlowchartId == null) {
            list$ = this.dataService.getSlimBillCreationProcessEntityExesByUpBillVoId4Push(this.args.upBillVoId);
            // } else {
            // list$ = this.dataService.getSlimCreationRulesBySourceVoIdAndFlowchartId(this.args.sourceVoId, this.args.bizFlowchartId);
            // }
        }
        else {
            // if (this.args.bizFlowchartId == null) {
            list$ = this.dataService.getSlimBillCreationProcessEntityExesByUpBillVoIdAndDownBillVoId4SpecificPush(this.args.upBillVoId, this.args.downBillVoId);
            // } else {
            // list$ = this.dataService.getSlimCreationRulesBySourceVoIdAndTargetVoIdAndFlowchartId(this.args.sourceVoId, this.args.downBillVoId, this.args.bizFlowchartId);
            // }
        }
        list$.subscribe((/**
         * @param {?} result
         * @return {?}
         */
        (result) => {
            /** @type {?} */
            const list = result;
            list.forEach((/**
             * @param {?} elt
             * @return {?}
             */
            elt => {
                if (this.voIdList.includes(elt.downBillVoId) === false) {
                    this.voIdList.push(elt.downBillVoId);
                    this.entityDict[elt.downBillVoId] = new Array();
                }
                this.nameDict[elt.downBillVoId] = elt.downBillVoName;
                this.entityDict[elt.downBillVoId].push(elt);
            }));
            this.selectedVoId = this.voIdList.length > 0 ? this.voIdList[0] : null;
            this.loading.close();
        }), (/**
         * @param {?} err
         * @return {?}
         */
        (err) => {
            this.loading.close();
            throw err;
        }));
    }
}
PushSelectorComponent.decorators = [
    { type: Component, args: [{
                selector: 'lib-bif-push-selector',
                template: "<div class=\"g-main px-3 py-2\">\r\n  <!--  -->\r\n  <div class=\"form-group\" style=\"height: 150px;overflow-y: auto;\">\r\n    <div [hidden]=\"voIdList.length != 0\"><span style=\"color: red;\">{{ 'emptyResult' | locale }}</span></div>\r\n    <div>{{ 'selectDownstreamBill' | locale }}</div>\r\n    <div *ngFor=\"let voId of voIdList;let i=index\" class=\"col-sm-12 col-md-5 form-check form-check-inline\">\r\n      <input class=\"form-check-input\" type=\"radio\" [name]=\"'voId'+i\" [id]=\"voId\" [value]=\"voId\"\r\n        [(ngModel)]=\"selectedVoId\" />\r\n      <label class=\"form-check-label\" [for]=\"'voId'+i\">{{nameDict[voId]}}</label>\r\n    </div>\r\n  </div>\r\n\r\n  <!--  -->\r\n  <div class=\"form-group\" style=\"\">\r\n    <div>{{ 'selectCreationProcess' | locale }}</div>\r\n    <select class=\"form-control\" name=\"selectedEntity\" [(ngModel)]=\"selectedEntity\">\r\n      <option *ngFor=\"let cr of entityDict[selectedVoId];\" [ngValue]=\"cr\">\r\n        {{cr.name}}({{cr.code}})</option>\r\n    </select>\r\n  </div>\r\n\r\n  <!--  -->\r\n  <div class=\"form-group\" style=\"\">\r\n    <div>{{ 'processDesciption' | locale }}</div>\r\n    <textarea readonly class=\"form-control\" name=\"description\" rows=\"3\"\r\n      [ngModel]=\"selectedEntity&&selectedEntity.description\"></textarea>\r\n  </div>\r\n</div>",
                styles: [""]
            }] }
];
/** @nocollapse */
PushSelectorComponent.ctorParameters = () => [
    { type: undefined, decorators: [{ type: Inject, args: [SELECTOR_ARGS_INJECTOR,] }] },
    { type: BifDataService },
    { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] },
    { type: LoadingService },
    { type: ElementRef }
];
if (false) {
    /** @type {?} */
    PushSelectorComponent.prototype.voIdList;
    /** @type {?} */
    PushSelectorComponent.prototype.nameDict;
    /** @type {?} */
    PushSelectorComponent.prototype.entityDict;
    /**
     * @type {?}
     * @private
     */
    PushSelectorComponent.prototype._selectedVoId;
    /** @type {?} */
    PushSelectorComponent.prototype.selectedEntity;
    /** @type {?} */
    PushSelectorComponent.prototype.bsModalRef4BifSelector;
    /** @type {?} */
    PushSelectorComponent.prototype.subject4CreationProcess;
    /**
     * @type {?}
     * @private
     */
    PushSelectorComponent.prototype.args;
    /** @type {?} */
    PushSelectorComponent.prototype.clickOk4BifSelector;
    /** @type {?} */
    PushSelectorComponent.prototype.clickClose4BifSelector;
    /**
     * @type {?}
     * @private
     */
    PushSelectorComponent.prototype.dataService;
    /**
     * @type {?}
     * @private
     */
    PushSelectorComponent.prototype.loading;
    /**
     * @type {?}
     * @private
     */
    PushSelectorComponent.prototype.elementRef;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHVzaC1zZWxlY3Rvci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZWRwLWJpZi9ydW50aW1lLWFwaS8iLCJzb3VyY2VzIjpbImxpYi9iaWYtbWFudWFsLWNyZWF0aW9uL2NvbXBvbmVudHMvcHVzaC1zZWxlY3Rvci9wdXNoLXNlbGVjdG9yLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsTUFBTSxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDakYsT0FBTyxFQUFFLE9BQU8sRUFBYyxNQUFNLE1BQU0sQ0FBQztBQUUzQyxPQUFPLEVBQUUsc0JBQXNCLEVBQWdCLE1BQU0sNENBQTRDLENBQUM7QUFFbEcsT0FBTyxFQUFFLHNDQUFzQyxFQUFFLE1BQU0sa0VBQWtFLENBQUM7QUFDMUgsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBRWhFLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQU9wRCxNQUFNLE9BQU8scUJBQXFCOzs7Ozs7OztJQWtDaEMsWUFDa0MsSUFBa0IsRUFDMUMsV0FBMkIsRUFDaEIsUUFBZ0IsRUFDM0IsT0FBdUIsRUFDdkIsVUFBc0I7UUFIdEIsZ0JBQVcsR0FBWCxXQUFXLENBQWdCO1FBRTNCLFlBQU8sR0FBUCxPQUFPLENBQWdCO1FBQ3ZCLGVBQVUsR0FBVixVQUFVLENBQVk7O1FBcENoQyxhQUFRLEdBQWEsRUFBRSxDQUFDOztRQUd4QixhQUFRLEdBRUosRUFBRSxDQUFDOztRQUdQLGVBQVUsR0FFTixFQUFFLENBQUM7UUFpQlAsMkJBQXNCLEdBQWUsSUFBSSxDQUFDO1FBQzFDLDRCQUF1QixHQUFnRCxJQUFJLE9BQU8sRUFBRSxDQUFDO1FBa0JyRix3QkFBbUI7OztRQUFHLEdBQUcsRUFBRTtZQUN6QixJQUFJLENBQUMsdUJBQXVCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FB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QyxHQUFHLEVBQUUsRUFBRTtZQUNOLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLENBQUM7WUFDckIsTUFBTSxHQUFHLENBQUM7UUFDWixDQUFDLEVBQ0YsQ0FBQztJQUNKLENBQUM7OztZQXBHRixTQUFTLFNBQUM7Z0JBQ1QsUUFBUSxFQUFFLHVCQUF1QjtnQkFDakMsdzBDQUE2Qzs7YUFFOUM7Ozs7NENBb0NJLE1BQU0sU0FBQyxzQkFBc0I7WUE1Q3pCLGNBQWM7eUNBOENsQixNQUFNLFNBQUMsU0FBUztZQTVDWixjQUFjO1lBUndCLFVBQVU7Ozs7SUFrQnZELHlDQUF3Qjs7SUFHeEIseUNBRU87O0lBR1AsMkNBRU87Ozs7O0lBR1AsOENBQThCOztJQVk5QiwrQ0FBbUQ7O0lBRW5ELHVEQUEwQzs7SUFDMUMsd0RBQXFGOzs7OztJQUVyRixxQ0FBcUQ7O0lBZ0JyRCxvREFJRTs7SUFFRix1REFFRTs7Ozs7SUFyQkEsNENBQW1DOzs7OztJQUVuQyx3Q0FBK0I7Ozs7O0lBQy9CLDJDQUE4QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBJbmplY3QsIExPQ0FMRV9JRCwgRWxlbWVudFJlZiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBTdWJqZWN0LCBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IEJzTW9kYWxSZWYgfSBmcm9tICdAZmFycmlzL3VpLW1vZGFsJztcclxuaW1wb3J0IHsgU0VMRUNUT1JfQVJHU19JTkpFQ1RPUiwgU2VsZWN0b3JBcmdzIH0gZnJvbSAnLi4vLi4vY29uZmlnL3NlbGVjdG9yLWFyZ3MtaW5qZWN0b3IuY29uZmlnJztcclxuaW1wb3J0IHsgSVJ0U2xpbUJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeCB9IGZyb20gJ0BlZHAtYmlmL2NvbW1vbi1hcGknO1xyXG5pbXBvcnQgeyBGb3JtR2V0QmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4QXJncyB9IGZyb20gJy4uLy4uLy4uL2VudGl0eS9mb3JtLXJlc3QvRm9ybUdldEJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeEFyZ3MnO1xyXG5pbXBvcnQgeyBCaWZEYXRhU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2UvYmlmLWRhdGEuc2VydmljZSc7XHJcbmltcG9ydCB7IElCaWZDcmVhdGlvblByb2Nlc3NTZWxlY3RvckNvbXBvbmVudCB9IGZyb20gJy4uLy4uL2Jhc2UvSUJpZkNyZWF0aW9uUHJvY2Vzc1NlbGVjdG9yQ29tcG9uZW50JztcclxuaW1wb3J0IHsgTG9hZGluZ1NlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWxvYWRpbmcnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdsaWItYmlmLXB1c2gtc2VsZWN0b3InLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9wdXNoLXNlbGVjdG9yLmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi9wdXNoLXNlbGVjdG9yLmNvbXBvbmVudC5jc3MnXSxcclxufSlcclxuZXhwb3J0IGNsYXNzIFB1c2hTZWxlY3RvckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgSUJpZkNyZWF0aW9uUHJvY2Vzc1NlbGVjdG9yQ29tcG9uZW50IHtcclxuXHJcbiAgLy/nm67moIdWb0lk5YiX6KGoXHJcbiAgdm9JZExpc3Q6IHN0cmluZ1tdID0gW107XHJcblxyXG4gIC8v55uu5qCHVm9JZOS4juebruagh1ZvTmFtZeaYoOWwhFxyXG4gIG5hbWVEaWN0OiB7XHJcbiAgICBbZG93bnN0cmVhbVZvSWQ6IHN0cmluZ106IHN0cmluZ1xyXG4gIH0gPSB7fTtcclxuXHJcbiAgLy/nm67moIdWb0lk5LiO55u45bqU55qE55Sf5Y2V6KeE5YiZ5YiX6KGo5pig5bCEXHJcbiAgZW50aXR5RGljdDoge1xyXG4gICAgW2Rvd25zdHJlYW1Wb0lkOiBzdHJpbmddOiBJUnRTbGltQmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4W11cclxuICB9ID0ge307XHJcblxyXG4gIC8v6YCJ5Lit55qE55uu5qCHVm9JZFxyXG4gIHByaXZhdGUgX3NlbGVjdGVkVm9JZDogc3RyaW5nO1xyXG4gIGdldCBzZWxlY3RlZFZvSWQoKTogc3RyaW5nIHtcclxuICAgIHJldHVybiB0aGlzLl9zZWxlY3RlZFZvSWQ7XHJcbiAgfVxyXG4gIHNldCBzZWxlY3RlZFZvSWQoaWQ6IHN0cmluZykge1xyXG4gICAgdGhpcy5fc2VsZWN0ZWRWb0lkID0gaWQ7XHJcbiAgICBpZiAoaWQgIT0gbnVsbCkge1xyXG4gICAgICB0aGlzLnNlbGVjdGVkRW50aXR5ID0gdGhpcy5lbnRpdHlEaWN0W3RoaXMuX3NlbGVjdGVkVm9JZF1bMF07XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvL+mAieS4reeahOeUn+WNleinhOWImVxyXG4gIHNlbGVjdGVkRW50aXR5OiBJUnRTbGltQmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4O1xyXG5cclxuICBic01vZGFsUmVmNEJpZlNlbGVjdG9yOiBCc01vZGFsUmVmID0gbnVsbDtcclxuICBzdWJqZWN0NENyZWF0aW9uUHJvY2VzczogU3ViamVjdDxJUnRTbGltQmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4PiA9IG5ldyBTdWJqZWN0KCk7XHJcblxyXG4gIHByaXZhdGUgYXJnczogRm9ybUdldEJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeEFyZ3M7XHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBASW5qZWN0KFNFTEVDVE9SX0FSR1NfSU5KRUNUT1IpIGFyZ3M6IFNlbGVjdG9yQXJncyxcclxuICAgIHByaXZhdGUgZGF0YVNlcnZpY2U6IEJpZkRhdGFTZXJ2aWNlLFxyXG4gICAgQEluamVjdChMT0NBTEVfSUQpIGxvY2FsZUlkOiBzdHJpbmcsXHJcbiAgICBwcml2YXRlIGxvYWRpbmc6IExvYWRpbmdTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBlbGVtZW50UmVmOiBFbGVtZW50UmVmLFxyXG4gICkge1xyXG4gICAgdGhpcy5hcmdzID0gbmV3IEZvcm1HZXRCaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXhBcmdzKCk7XHJcbiAgICB0aGlzLmFyZ3MuTG9hZEZyb21Kc29uT2JqZWN0KGFyZ3MpO1xyXG4gIH1cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICB0aGlzLmxvYWRJdGVtcygpO1xyXG4gIH1cclxuXHJcbiAgY2xpY2tPazRCaWZTZWxlY3RvciA9ICgpID0+IHtcclxuICAgIHRoaXMuc3ViamVjdDRDcmVhdGlvblByb2Nlc3MubmV4dCh0aGlzLnNlbGVjdGVkRW50aXR5KTtcclxuICAgIHRoaXMuc3ViamVjdDRDcmVhdGlvblByb2Nlc3MuY29tcGxldGUoKTtcclxuICAgIHRoaXMuYnNNb2RhbFJlZjRCaWZTZWxlY3Rvci5jbG9zZSgpO1xyXG4gIH07XHJcblxyXG4gIGNsaWNrQ2xvc2U0QmlmU2VsZWN0b3IgPSAoKSA9PiB7XHJcbiAgICB0aGlzLmJzTW9kYWxSZWY0QmlmU2VsZWN0b3IuY2xvc2UoKTtcclxuICB9O1xyXG5cclxuICBwcml2YXRlIGxvYWRJdGVtcygpOiB2b2lkIHtcclxuICAgIHRoaXMubG9hZGluZy5zaG93KHsgY29udGFpbmVyOiB0aGlzLmVsZW1lbnRSZWYgfSk7XHJcbiAgICBsZXQgbGlzdCQ6IE9ic2VydmFibGU8SVJ0U2xpbUJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeFtdPiA9IG51bGw7XHJcbiAgICBpZiAodGhpcy5hcmdzLmRvd25CaWxsVm9JZCA9PSBudWxsKSB7XHJcbiAgICAgIC8vIGlmICh0aGlzLmFyZ3MuYml6Rmxvd2NoYXJ0SWQgPT0gbnVsbCkge1xyXG4gICAgICBsaXN0JCA9IHRoaXMuZGF0YVNlcnZpY2UuZ2V0U2xpbUJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeGVzQnlVcEJpbGxWb0lkNFB1c2godGhpcy5hcmdzLnVwQmlsbFZvSWQpO1xyXG4gICAgICAvLyB9IGVsc2Uge1xyXG4gICAgICAvLyBsaXN0JCA9IHRoaXMuZGF0YVNlcnZpY2UuZ2V0U2xpbUNyZWF0aW9uUnVsZXNCeVNvdXJjZVZvSWRBbmRGbG93Y2hhcnRJZCh0aGlzLmFyZ3Muc291cmNlVm9JZCwgdGhpcy5hcmdzLmJpekZsb3djaGFydElkKTtcclxuICAgICAgLy8gfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8gaWYgKHRoaXMuYXJncy5iaXpGbG93Y2hhcnRJZCA9PSBudWxsKSB7XHJcbiAgICAgIGxpc3QkID0gdGhpcy5kYXRhU2VydmljZS5nZXRTbGltQmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4ZXNCeVVwQmlsbFZvSWRBbmREb3duQmlsbFZvSWQ0U3BlY2lmaWNQdXNoKHRoaXMuYXJncy51cEJpbGxWb0lkLCB0aGlzLmFyZ3MuZG93bkJpbGxWb0lkKTtcclxuICAgICAgLy8gfSBlbHNlIHtcclxuICAgICAgLy8gbGlzdCQgPSB0aGlzLmRhdGFTZXJ2aWNlLmdldFNsaW1DcmVhdGlvblJ1bGVzQnlTb3VyY2VWb0lkQW5kVGFyZ2V0Vm9JZEFuZEZsb3djaGFydElkKHRoaXMuYXJncy5zb3VyY2VWb0lkLCB0aGlzLmFyZ3MuZG93bkJpbGxWb0lkLCB0aGlzLmFyZ3MuYml6Rmxvd2NoYXJ0SWQpO1xyXG4gICAgICAvLyB9XHJcbiAgICB9XHJcbiAgICBsaXN0JC5zdWJzY3JpYmUoXHJcbiAgICAgIChyZXN1bHQ6IElSdFNsaW1CaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXhbXSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGxpc3QgPSByZXN1bHQ7XHJcbiAgICAgICAgbGlzdC5mb3JFYWNoKGVsdCA9PiB7XHJcbiAgICAgICAgICBpZiAodGhpcy52b0lkTGlzdC5pbmNsdWRlcyhlbHQuZG93bkJpbGxWb0lkKSA9PT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgdGhpcy52b0lkTGlzdC5wdXNoKGVsdC5kb3duQmlsbFZvSWQpO1xyXG4gICAgICAgICAgICB0aGlzLmVudGl0eURpY3RbZWx0LmRvd25CaWxsVm9JZF0gPSBuZXcgQXJyYXk8SVJ0U2xpbUJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeD4oKTtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICB0aGlzLm5hbWVEaWN0W2VsdC5kb3duQmlsbFZvSWRdID0gZWx0LmRvd25CaWxsVm9OYW1lO1xyXG4gICAgICAgICAgdGhpcy5lbnRpdHlEaWN0W2VsdC5kb3duQmlsbFZvSWRdLnB1c2goZWx0KTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLnNlbGVjdGVkVm9JZCA9IHRoaXMudm9JZExpc3QubGVuZ3RoID4gMCA/IHRoaXMudm9JZExpc3RbMF0gOiBudWxsO1xyXG4gICAgICAgIHRoaXMubG9hZGluZy5jbG9zZSgpO1xyXG4gICAgICB9LFxyXG4gICAgICAoZXJyKSA9PiB7XHJcbiAgICAgICAgdGhpcy5sb2FkaW5nLmNsb3NlKCk7XHJcbiAgICAgICAgdGhyb3cgZXJyO1xyXG4gICAgICB9XHJcbiAgICApO1xyXG4gIH1cclxufVxyXG4iXX0=